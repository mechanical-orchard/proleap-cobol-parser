000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    APKCS323.                                         00020001
000300 AUTHOR.        MARC BLAZICH. G&R.                                00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  06-06-94.                                         00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800*----------------------------------------------------------------*00080012
000900*    TRANID      - A323                                          *00090012
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2           *00100012
001100*    DESCRIPTION - AP - INVOICE ENTRY, UPDATE, DELETE            *00110012
001200*    MAPSET      - APKM323                                       *00120012
001300*                                                                *00130012
001400*    THIS PROGRAM WILL ADD, UPDATE OR DELETE HIGH LEVEL INVOICE  *00140012
001500*    DATA.                                                       *00150012
001600*----------------------------------------------------------------*00160012
001700*                                                                *00170012
001800* CHANGE LOG:                                                    *00180012
001900*                                                                *00190012
002000*                                                                *00200012
002100* 03/02/98  M BESKE                             WR 4164          *00210012
002200*           REMOVED ALL REFERENCES TO THE DB2 TABLE TACCTYP.     *00220012
002300*           REPLACED THE CODE IN 3140-EDIT-IMPORT-CHRG-CDE TO    *00230012
002400*           CHECK ASC-NEW-IMPRT-CHRG-CDE AGAINST THE 3 CURRENT   *00240012
002500*           MI VALID VALUES OF 1ST, 1LC AND AMC, RATHER THAN DO  *00250012
002600*           A SELECT ON TACCTYP WHICH ALSO CONTAINS VALID        *00260012
002700*           ACCOUNT TYPES FOR EI'S.  DELETED THE OBSOLETED       *00270012
002800*           PARAGRAPH 3145-GET-IMPORT-CHRG-CDE.                  *00280012
002900*                                                                *00290012
003000* 03/27/98  M BESKE                             WR 4164          *00300012
003100*           ADDED CODE THAT WILL MAKE THE TOTAL NUMBER OF PIECES *00310012
003200*           A REQUIRED FIELD WHEN ADDING AN IMPORT MI.  THIS     *00320012
003300*           WILL NOT BE SO WITH DOMESTIC MIS OR ANY KIND OF EI.  *00330012
003400*           A NEW MESSAGE (NUMBER 1699) WAS CREATED FOR THIS     *00340012
003500*           CHANGE.                                              *00350012
003600*                                                                *00360012
003700* 04/10/98  M BESKE                             WR 4164          *00370012
003800*           NEW LOGIC WAS ADDED THROUGHOUT THE PROGRAM TO        *00380012
003900*           ACCOMPLISH THE FOLLOWING FUNCTIONALITY:  BEFORE A    *00390012
004000*           NEW MERCHANDISE INVOICE IS ADDED FOR AN IMPORT PO,   *00400012
004100*           THERE IS A CHECK (4101-CHECK-JOURNALIZED-STATUS) FOR *00410012
004200*           ANY PREVIOUSLY JOURNALIZED MI'S FOR THAT PO.  IF     *00420012
004300*           ANY ARE FOUND THEN A WARNING MESSAGE (NUMBER 1700)   *00430012
004400*           IS DISPLAYED SAYING 'PO HAS BEEN JOURNALIZED PRESS   *00440012
004500*           F13 TO CONFIRM ADD'. AFTER F13(CONFIRM) HAS BEEN     *00450012
004600*           PRESSED, THE NEW MI WILL BE ADDED TO THE DATABASE.   *00460012
004700*           ALL OTHER INVOICE ADDS (EXPENSE, DOMESTIC MERCHAN-   *00470012
004800*           DISE AND NON-JOURNALIZED IMPORT MERCHANDISE) WILL    *00480012
004900*           NOT DISPLAY THE WARNING AND NOT REQUIRE A CONFIRM TO *00490012
005000*           ADD TO THE DATABASE.  THE WARNING MESSAGE IS DIS-    *00500012
005100*           PLAYED ABOVE ANY OTHER ERROR MESSAGES UNTIL F13 HAS  *00510012
005200*           BEEN PRESSED.  TO DO THIS LOGIC, A NEW SWITCH WAS    *00520012
005300*           WAS CREATED ASC-ADD-REQUESTED TO WORK WITH THE       *00530012
005400*           EXISTING SWITCH ASC-ADD-PENDING.                     *00540012
005500*                                                                *00550012
005600* 05/05/98  ADDED THE PROCESSING NECESSARY TO MAINTAIN AP        *00560012
005700*           PROCESS CODE ON ALL INVOICES.  THIS CODE WAS         *00570012
005800*           NEEDED BECAUSE THE STATUS CODE IS NO LONGER          *00580012
005900*           SUFFICIENT TO INDICATE IF THE INVOICES FOR A PO      *00590012
006000*           HAVE BEEN JOURNALIZED.  THE LOGIC HAS BEEN MODIF     *00600012
006100*           TO INSERT ROWS INTO TINVOIC AND PLACE VALUES IN      *00610012
006200*           TWO NEW COLUMNS:                                     *00620012
006300*               - AP-PRC-CDE                                     *00630012
006400*               - AP-PRC-DTE                                     *00640012
006500*           BY:  ROBIN BERNOSKI               WR/PIT 4164        *00650012
006600*                                                                *00660012
006700* 08/17/98  REMOVE CONSIGNMENT PROCESSING FOR DEPARTMENT         *00670012
006800*           #127.                                                *00680012
006900*           BY:  CAROLYN GIFFORD              WR/PIT 10199       *00690012
007000*                                                                *00700012
007100* 10/14/98  PEOPLESOFT CONVERSION.  ELIMINATED ALL IMS CODE.     *00710012
007200*           ADDED CODE TO INSERT THE NEW TRADE DISCOUNT PERCENT  *00720012
007300*           FROM TPOAGMT TO TALCHRG.  IT WILL CARRY A CHARGE     *00730012
007400*           CODE OF 'DSC'.  PARAS DELETED 4125-                  *00740012
007500*           4180-, 4185-, 9000-SCHEDULE, 9100-TERMINATE, 9910-.  *00750012
007600*           PARAS MODIFIED 3195-.                                *00760012
007700*           BY:  MIKE BESKE                   WR/PIT ????        *00770012
007800*                                                                *00780012
007900* 01/21/2000 MIKE BESKE                      WR/IR #: 20704      *00790012
008000*            - REMOVED THE DEFAULT OF 30 DAYS BEING MOVED TO     *00800012
008100*              ASC-NEW-IN-DISC-DUE-DAY-QTY FOR MI.  THIS ONLY    *00810012
008200*              HAPPENED WHEN THE DISCOUNT PERCENTAGE FOR INVOICE *00820012
008300*              TERMS WAS 0%.  NOW THE USER IS REQUIRED TO ENTER  *00830012
008400*              SOME NUMBER FOR THE DAY QUANTITY.                 *00840012
008500*                                                                *00850012
008600* 04/11/2000 MIKE BESKE                      WR/IR #: 20997      *00860012
008700*            - ADDED A NEW PO TYPE CODE VALUE TO THE 88 LEVEL OF *00870012
008800*              ASC-IMPORT-PO. THIS IS PART OF THE PROJECT THAT   *00880012
008900*              THE PO TEAM IS DOING.  THEY ARE ADDING 4 NEW PO   *00890012
009000*              TYPE CODES TO TPURCHS.  THE VALUE ADDED HERE IS   *00900012
009100*              'IE'.                                             *00910012
009200*                                                                *00920012
009300* 04/13/2000 MIKE BESKE                      WR/IR #: 20997      *00930012
009400*            - ADDED A NEW PO TYPE CODE VALUE TO THE 88 LEVEL OF *00940012
009500*              ASC-IMPORT-PO. THE VALUE ADDED HERE IS 'IF'.      *00950012
009600*                                                                *00960012
009700* 08/08/2000 W A EHMKE                       WR/IR #: 21186      *00970012
009800*            - THE EXPENSE INVOICE TABLE (TEXINVC) HAS BEEN      *00980012
009900*              EXPANDED WITH A NEW COLUMN WHICH WILL CONTAIN A   *00990012
010000*              'BOL' BILL OF LADING NUMBER.  MODIFY THE PROGRAM  *01000012
010100*              LOGIC TO ALLOW / EDIT THE KEYING OF THIS FIELD    *01010012
010200*              AND ADD / UPDATE OF THIS FIELD ON THE DATABASE.   *01020012
010300*              THIS NEW FIELD MUST INTERFACE TO PEOPLESOFT AND   *01030012
010400*              MODIFICATIONS TO PUT THIS FIELD WITH LABEL INTO   *01040012
010500*              THE COMMENTS ON THE VOCHER ARE REQUIRED.          *01050012
010600*                                                                *01060012
010700*              PROCESS THE NEW FIELD WHEN ENTERED. DUE TO NO     *01070012
010800*              AVAILIABLE SPACE ON THE SCREEN AN EXISTING FIELD  *01080012
010900*              IS TO BE SHARED (EXINVC-IMPRT-ENTR-NBR). AN '*'   *01090012
011000*              IS BEING KEYED AS THE FIRST POSITION OF THE FIELD *01100012
011100*              TO INDICATE THAT A 'BOL' NUMBER IS PRESENT RATHER *01110012
011200*              THAN A EXINVC-IMPRT-ENTE-NBR.                     *01120012
011300*                                                                *01130012
011400*              THE '*' WILL NOT BE CARRIED ON THE DATABASE.      *01140012
011500*                                                                *01150012
011600* 08/30/00   MIKE BESKE                      WR/IR #: 20224      *01160012
011700*            - ADDED CODE THAT WILL INSERT A ROW INTO TALCHRG    *01170012
011800*              FOR EACH OF THE NEW INCENTIVE DISCOUNTS IF THEY   *01180012
011900*              ARE PRESENT ON THE TPOAGMT TABLE.  THE NEW DISCS  *01190012
012000*              ARE MARK OUT OF STOCK(MOS), TRADE(TRD) AND ADVER- *01200012
012100*              TISING(ADV).  CODE WAS ALSO ADDED TO PICK UP THE  *01210012
012200*              ADDITIONAL EXTENDED DAYS USED FOR CALCULATING THE *01220012
012300*              PAYMENT DUE DATE.                                 *01230012
012400*                                                                *01240012
012500* 08/09/01   MIKE BESKE                      WR/IR #: 21437      *01250012
012600*            - ADDED CODE TO ALLOW THE USER TO UPDATE THE HOLD   *01260012
012700*              STATUS FOR EDI INVOICES (PARAS 3000- 3201- 4020-) *01270012
012800*                                                                *01280012
012900* 09/26/01   ALEXIS KEIKER                   WR/IR #: 22684      *01290012
013000*            - CHANGED THE PAYMENT DAYS FROM 5 TO 10 DAYS        *01300012
013100*              FOR VENDOR #000567768.                            *01310012
013200*                                                                *01320012
013300* 09/27/01   MIKE BESKE                      WR/IR #: 20530      *01330012
013400*            - ADDED CODE FOR A NEW FUNCTION KEY (PF17) THAT     *01340012
013500*              ALLOWS THE USER TO TOGGLE THE INVOICE STATUS CODE *01350012
013600*              FROM 'PR' (PENDING REVIEW) TO 'EN' (ENTERED) OR   *01360012
013700*              FROM 'EN' TO 'PR'.  THIS WILL ONLY WORK FOR       *01370012
013800*              EXPENSE INVOICES THAT HAVE AN ENTRY METHOD CODE   *01380012
013900*              OF 'EE'. (PARAS FOR5- 4020- 6000- 6175- 6500-)    *01390012
014000*                                                                *01400012
014100* 11/14/01   MIKE BESKE                      WR/IR #: 22902      *01410012
014200*            - CHANGED CODE TO ALLOW USER TO CHANGE THE INVOICE  *01420012
014300*              PAYMENT TERMS DAYS FOR EXPENSE INVOICES EXCEPT    *01430012
014400*              FOR VENDOR # 000567768.                           *01440012
014500*                                                                *01450012
014600* 02/04/02   NANCY EILBES                    WR/IR #: 20530      *01460012
014700*            MODIFIED LOGIC WHICH DECIDES WHETHER TO DISPLAY     *01470012
014800*            THE BOL ID OR THE ENTRY NUMBER FOR IMPORT EXPENSE   *01480012
014900*            INVOICES TO CHECK THE ENTRY NUMBER FIRST.  WITH     *01490012
015000*            THE LOADING OF EDI210 INVOICES FOR EXPEDITORS,      *01500012
015100*            BOTH FIELDS CAN NOW HAVE A VALUE ON THE DATABASE,   *01510012
015200*            AND IN THIS CASE, THE ENTRY NUMBER SHOULD DISPLAY.  *01520012
015300*                                                                *01530012
015400* 02/07/02   NANCY EILBES                    WR/IR #: 448294     *01540012
015500*            - INCREASED LENGTH OF CARTON COUNT FIELD FROM 4     *01550012
015600*              TO 5.  ADDED AN EDIT TO ENSURE VALUE ENTERED IS   *01560012
015700*              NOT GREATER THAN 32767 - MAX FOR SMALLINT FIELD.  *01570012
015800*                                                                *01580012
015900* 05/06/02   MIKE BESKE                      WR/IR #: 23500      *01590012
016000*            - CHANGED SQL INVOLVING INSERTS AND UPDATES TO      *01600012
016100*              TINVOIC, TMDINVC AND TEXINVC TO INCLUDE PO_NBR    *01610012
016200*              AND INVC_ID.  THESE TWO COLUMNS WILL BE THE NEW   *01620012
016300*              KEY THAT WILL REPLACE THE USE OF PAYT_REQ_SEQ_NBR *01630012
016400*              AND INVC_ID.  THESE COLUMNS CAN NEVER BE UPDATED  *01640012
016500*              AGAIN BECAUSE THEY ARE NOW THE KEYS TO THE AP     *01650012
016600*              DATABASES.                                        *01660012
016700*                                                                *01670012
016800* 06/18/02   MIKE BESKE                      WR/IR #: 23500      *01680012
016900*            - ADDED UPDATE OF RMIT_VND_ID ON TINVOIC IN PARA    *01690012
017000*              6200-.                                            *01700012
017100*                                                                *01710012
017200* 08/22/02  ARK PO PROJECT PHASE 2.  REPLACE REFERENCES TO       *01720012
017300*           PAYT-REQ-SEQ-NBR WITH NEW INDEX OF PO_NBR AND        *01730012
017400*           INVC_ID.  PARAGRAPHS MODIFIED ARE 4150, 4155, 4160,  *01740012
017500*           4170, 4175, 6300, 6310, 6315, 7100, 8600, AND 8700.  *01750012
017600*       BY: KEVIN CATLIN                   WR #: 23500           *01760012
017700*                                                                *01770012
017800* 11/04/02   - COLBY DATING PROJECT.  ADDED THE NEW STATUS DESC  *01780012
017900*              FOR NEW 'PJ' CODE.  ADDED 'PJ' TO VARIOUS PARAS   *01790012
018000*              TO NOT ALLOW THESE INVOICES TO BE UPDATED OR      *01800012
018100*              DELETED.                                          *01810012
018200*       BY: MIKE BESKE                     WR #: 23750           *01820012
018300*                                                                *01830012
018400* 11/18/03   - ADDED 'DISC_PCT > 0' TO THE WHERE CONDITIONS OF   *01840012
018500*              THE POAGMT_CSR AND THE SQL IN PARA 4141-GET-ADDL- *01850012
018600*              TPOAGMT-DATA.  THIS WILL CORRECT THE PROBLEM OF   *01860012
018700*              LOADING 0% ROWS ON TALCHRG CAUSING A OUT-OF-      *01870012
018800*              BALANCE STATUS WHEN A NEW INVOICE IS ENTERED.     *01880012
018900*              THIS EFFECTS ONLY MOS, TRD, ADV & NSD DISCOUNTS.  *01890012
019000*       BY: MIKE BESKE                     IR #: P000609638      *01900012
019100*                                                                *01910012
019200* 04/27/04   - INCREASED THE SIZE OF VARIOUS STORE NUMBER FIELDS *01920012
019300*              TO 4 DIGITS AS PART OF THE STORE CONSTRAINTS      *01930012
019400*              PROJECT.  REPLACED TSTR000 WITH XFT00003 AND      *01940012
019500*              XFT00005.  CHANGED THE EXISTENCE CHECK SQL IN     *01950012
019600*              3062-VALIDATE-STORE TO NOT USE SYSDUMMY1 BECAUSE  *01960012
019700*              THIS TABLE RESIDES IN BOTH DB2P AND DB3P AND WAS  *01970012
019800*              CAUSING A -512 DB2 ERROR WHEN A BIND WAS DONE ON  *01980012
019900*              OF THIS PROGRAM DURING THE COMPILE PROCESS.  THE  *01990012
020000*              DBA RECOMMENDED THAT A NORMAL SELECT STMT WITH A  *02000012
020100*              'FETCH FIRST ROW ONLY' PARM AT THE END OF THE     *02010012
020200*              SQL BE USED.                                      *02020012
020300*       BY: MIKE BESKE                     WR #: WR25805         *02030012
020400*                                                                *02040012
020500* 05/09/2005 - E-COMM DIRECT TO CONSUMER PROJECT                 *02050012
020600*              ADDED A NEW PO TYPE CODE (ASC-CNSMR-DIR-PO)       *02060012
020700*              WITH A VALUE OF 'CD' TO WORKING STORAGE.  ALSO    *02070012
020800*              ALTERED THE PARAGRAPHS 3015- AND 4100- TO         *02080012
020900*              GENERATE MESSAGE NUMBER 3390 IF THE PURCHASE      *02090012
021000*              ORDER IS AN IMPORT AND HAS A TYPE OF 'CD'.        *02100012
021100*       BY: KRYSTEN LEARY                  WR #: WR28461         *02110012
021200*                                                                *02120012
021300* 07/15/2005 - ADDED 10 TO THE LIST OF TYP-CDE VALUES FOR        *02130012
021400*              PROCESSING OF THE 'COP' RECORDS. CHANGED          *02140012
021500*              CODE IN PAPAGRAPH 8020- TO ADD LOGIC FOR 'COP'    *02150012
021600*              RECORDS. INCLUDED 'COP' IN THE VALID ALLOWANCE    *02160012
021700*              CODES FOR COPYBOOKS APRD050, APRD051, APRD052,    *02170012
021800*              AND APRD056.                                      *02180012
021900*       BY: RACHEL GILBERTSON              WR #: WR28651         *02190012
022000*                                                                *02200012
022100* 05/25/2006 - MODIFIED POAGMT_CSR TO INCLUDE THE NEW TYPE CODE  *02210012
022200*              VALUE '11' FOR 'PROFIT ASSIST/AD CO-OP            *02220012
022300*              ALLOWANCES'.  MODIFIED PROCESSING OF THE ROWS     *02230012
022400*              PROCESSED BY THIS CURSOR TO USE A VALUE OF 'ALW'  *02240012
022500*              WHEN THE TYPE CODE IS '11'.                       *02250012
022600*       BY: MICHELE RINDFLEISCH            WR #: WR30028         *02260012
022700*                                                                *02270012
022800* 03/11/2007 - MATCH BY DC -- CREATED WORKING STORAGE FIELDS FOR *02280012
022900*       PS-BY-DC-SW, PC-DC-NBR, ASC-OLD-DC-NBR, ASC-NEW-DC-NBR,  *02290012
023000*       PV-TOTAL-BY-DC, ASC-MTCH-LVL-CDE, ASC-DUE-DTE-SRC-CDE,   *02300012
023100*       AND ASC-CALC-DUE-DTE.  EDITED PARAGRAPH                  *02310012
023200*       3060-DATABASE-EDITS TO ENSURE THAT THE STORE NUMBER      *02320012
023300*       UPDATED BY THE USER IS VALID FOR THE MATCH LEVEL.  IF IT *02330012
023400*       IS VALID, THE DC NUMBER IS UPDATED AUTOMATICALLY BY THE  *02340012
023500*       PROGRAM.  IF IT IS NOT VALID, AN ERROR MESSAGE IS        *02350012
023600*       GENERATED.  IN PARAGRAPH 4130-GET-TPURCHS-DATA, ADDED    *02360012
023700*       THE FIELD DIR_STR_IND TO THE SELECT AND INTO STATEMENTS  *02370012
023800*       OF THE QUERY.  ALTERED THE QUERY IN PARARGRAPH           *02380012
023900*       3062-VALIDATE-STORE TO RETURN THE LOC_TYP_CDE AND        *02390012
024000*       DIST_NBR FROM THE FI_XFT_LOC TABLE.  CREATED PARAGRAPH   *02400012
024100*       3062-DETERMINE-DC-NBR TO OBTAIN THE DC_NBR FROM THE      *02410012
024200*       FI_XFT_LOC_ASGMT TABLE FOR THOSE PURCHASE ORDERS WITH A  *02420012
024300*       LOCATION TYPE CODE OF 'DS'.                              *02430012
024400*                                                                *02440012
024500*       CHANGED THE WHERE CLAUSE LOGIC IN PARAGRAPH              *02450012
024600*       3061-COUNT-NON-ZERO-INVC-STR FROM B.STR_NBR > +0 TO BE   *02460012
024700*       B.MTCH_LVL_CDE = 'S'.  CREATED PARAGRAPH                 *02470012
024800*       3061-COUNT-NON-ZERO-INVC-DC BASED ON THE STORE VERSION   *02480012
024900*       OF THE PARAGRAPH AND CHANGED THE MATCH LEVEL IN THE      *02490012
025000*       QUERY FROM 'S' TO 'D'.  MOVED PC-DC-NBR TO THE           *02500012
025100*       ASC-NEW-DC-NBR FIELD IN PARAGRAPHS 4000-BUILD-INITIAL-   *02510012
025200*       PANEL AND 4005-VALIDATE-KEY-FIELDS.  INCLUDED DC-NBR,    *02520012
025300*       MTCH_LVL_CDE, DUE_DTE_SRC_CDE, AND CALC_DUE_DTE IN THE   *02530012
025400*       SELECT STATEMENT OF THE QUERY IN PARAGRAPH               *02540012
025500*       4010-VALIDATE-INVC-PO-COMBO.  ALSO INCLUDED THESE FIELDS *02550012
025600*       IN THE 4200-MOVE-DATABASE-TO-COMMAREA AND                *02560012
025700*       4400-MOVE-COMMAREA-TO-SCREEN PARAGRAPHS.                 *02570012
025800*                                                                *02580012
025900*       IN PARAGRAPH 6000-UPDATE-DATABASE, INCLUDED DC NUMBER    *02590012
026000*       AND IN THE COMPARISON LOGIC TO DETERMINE IF THE INVOICE  *02600012
026100*       SHOULD BE UPDATED.  ADDED DC_NBR TO THE UPDATE           *02610012
026200*       STATEMENTS IN PARAGRAPHS 6100-UPDATE-TINVOIC AND         *02620012
026300*       6150-UPDATE-TINVOIC AND TO THE INSERT STATEMENT IN       *02630012
026400*       PARAGRAPH 8300-INSERT-TINVOIC.  IN PARAGRAPH             *02640012
026500*       8800-CHECK-IF-PROCESSED, REPLACED THE STORE COMPARISON   *02650012
026600*       LOGIC IN THE WHERE CLAUSE OF THE QUERY WITH A MATCH      *02660012
026700*       LEVEL COMPARISON (A.MTCH_LVL_CDE = ASC-MTCH-LVL-CDE).    *02670012
026800*       UPDATED THE APKM323 MAP TO INCLUDE THE FIELDS ADCNBR,    *02680012
026900*       AMTCHCD, ADUESRC, ACALCMM, ACALCDD, AND ACALCYY.         *02690012
027000*       LASTLY, REMOVED ALL REFERENCES TO TABLE TPAYREQ FROM THE *02700012
027100*       PROGRAM (INCLUDED DELETING THE PARAGRAPH                 *02710012
027200*       8200-INSERT-TPAYREQ).  ALSO REMOVED ALL REFERENCES TO    *02720012
027300*       TABLE TAUDINC FROM THE PROGRAM (INCLUDED DELETING THE    *02730012
027400*       PARAGRAPH 8700-INSERT-AUDIT-ROW).                        *02740012
027500*       BY: KRYSTEN LEARY                  WR #: WR21578         *02750012
027600*                                                                *02760012
027700* 03/23/2007 - MOVED THE VALUE OF THE PURCHS-DIR-STR-IND TO THE  *02770012
027800*       ASC-DIR-STR-IND FIELD.  THIS GUARANTEES THAT THE VALUE   *02780012
027900*       IS NOT BEING LOST WHEN THE USER PERFORMS AN UPDATE OR AN *02790012
028000*       ADD.  REPLACED ALL INSTANCES OF PURCHS-DIR-STR-IND WITH  *02800012
028100*       ASC-DIR-STR-IND IN PARAGRAPH 3060-DATABASE-EDITS.        *02810012
028200*       BY: KRYSTEN LEARY                  WR #: P000997412      *02820012
028300*                                                                *02830012
028400* DATE  03/27/2007                                               *02840012
028500*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE      *02850012
028600*     CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.        *02860012
028700*     MADE BY: KEVIN CATLIN            WR/IR #: WR31452          *02870012
028800*                                                                *02880012
028900* DATE  03/19/2008                                               *02890012
029000*     CHANGE MADE: TEMPORARY REMOVAL OF CONSUMER DIRECT          *02900012
029100*     RESTRICTION                                                *02910012
029200*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *02920012
029300*                                                                *02930012
029400* DATE  04/29/2008                                               *02940012
029500*     CHANGE MADE: TEMPORARY REMOVAL OF CONSUMER DIRECT          *02950012
029600*     RESTRICTION                                                *02960012
029700*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *02970012
029800*                                                                *02980012
029900* DATE  04/29/2008                                               *02990012
030000*     CHANGE MADE: TEMPORARY REMOVAL OF CONSUMER DIRECT          *03000012
030100*     RESTRICTION                                                *03010012
030200*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *03020012
030300*                                                                *03030012
030400* DATE  04/30/2008                                               *03040012
030500*     CHANGE MADE: REPLACE CONSUMER DIRECT RESTRICTION           *03050012
030600*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *03060012
030700*                                                                *03070012
030800* DATE  05/15/2008                                               *03080012
030900*     CHANGE MADE: TEMPORARY REMOVAL OF CONSUMER DIRECT          *03090012
031000*     RESTRICTION                                                *03100012
031100*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *03110012
031200*                                                                *03120012
031300* DATE  10/20/2008                                               *03130012
031400*     CHANGE MADE: REPLACE CONSUMER DIRECT RESTRICTION           *03140012
031500*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *03150012
031600*                                                                *03160012
031700* DATE  11/18/2008                                               *03170012
031800*     CHANGE MADE: TEMPORARY REMOVAL OF CONSUMER DIRECT          *03180012
031900*     RESTRICTION                                                *03190012
032000*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *03200012
032100*                                                                 03210001
032200* DATE  10/20/2009                                               *03220012
032300*     CHANGE MADE: ADDED NEW TEXINVC COLUMNS TO THE INSERT       *03230012
032400*     STATEMENT IN PARAGRAPH 8450.                               *03240012
032500*     MADE BY: PAUL STROEDE            WR/IR #: WR23145          *03250012
032600*                                                                *03260012
032700* DATE  01/11/2010                                               *03270012
032800*     CHANGE MADE: REMOVED PO INSTRUCTIONS SECTION AND REPLACED  *03280012
032900*     WITH THE NEW TEXINVC COLUMNS.                              *03290012
033000*     MADE BY: PAUL STROEDE            WR/IR #: WR23145          *03300012
033100*                                                                *03310012
033200* DATE  04/28/2010                                               *03320012
033300*     CHANGE MADE: MODIFIED CODE TO ALLOW AUTHORIZED USERS TO    *03330012
033400*     UPDATE IMPORT MERCHANDISE INVOICES AND EXPENSE INVOICES    *03340012
033500*     THAT HAVE A STATUS OF OP OR PJ TO A STATUS OF              *03350012
033600*     DELETED (DE). THIS IS DONE USING THE PF18 KEY.  NEW CODE   *03360012
033700*     WAS ADDED TO DETERMINE IF THE USER IS AUTHORIZED TO        *03370012
033800*     TO USE THE FUNCTION APIMPDEL (PARA 1110-).  CODE FOR       *03380012
033900*     PROCESSING THE PF18 KEY WAS ADDED IN THE FOLLOWING PARAS:  *03390012
034000*     2100- 2105- 6180- 6510-.   WR35587                         *03400012
034100*     MADE BY: MIKE BESKE              WR/IR #: PKE000000003890  *03410012
034200*                                                                *03420012
034300* DATE  06/30/2012                                               *03430012
034400*     CHANGE MADE: ACCEPT THE OPEN ACCOUNT PROCESSING OPTION     *03440012
034500*                  BY ADDING VALUE '1OA'                         *03450012
034600*     MADE BY: TOM MARTIN              WR/IR #: WR39735          *03460012
034700*                                                                *03470012
034800* DATE  09/06/2011                                               *03480012
034900*   THE PEOPLESOFT FINANCIALS UPGRADE TO VERSION 9.1 REQUIRES    *03490012
035000*   A RE-PLATFORM OF THE APPLICATION FROM DB2 ON OS/390          *03500012
035100*   (MAINFRAME) TO AN ORACLE DATABASE. SO, AS PART OF THIS       *03510012
035200*   UPGRAGE THE FINANCIALS DOMAIN LOCATION TABLES FI_XFT_LOC AND *03520012
035300*   FI-XFT_LOC_ASGMT WILL NOW BE NAMED XFT_LOC AND XFT_LOC_ASGMT *03530012
035400*   RESPECTIVELY.                                                *03540012
035500*                                                                *03550012
035600*   CHANGE OF FINANCE DOMAIN TABLE FOR LOCATION INFORMATION      *03560012
035700*      FI_XFT_LOC       --> XFT_LOC(XFT00017)                    *03570012
035800*      FI-XFT_LOC_ASGMT --> XFT_LOC_ASGMT (XFT00018)             *03580012
035900*      MADE BY : NIRANJAN(CTS)       WR/IR  #: W37038            *03590012
036000*                                                                *03600012
036100* DATE  03/14/2014                                               *03610012
036200*     CHANGE MADE: BPO PHASE2 BARCODE CHANGES.                   *03620012
036300*   BARCODE LABEL HAS BEEN CHANGED TO WI/BARCODE AND CAN ACCEPT  *03630012
036400*   NON-NUMERIC VALUES.                                          *03640012
036500*     MADE BY: VIKRAM                  WR/IR #: CHG0078414       *03650012
036600*                                                                *03660012
036700* DATE  10/17/2014                                               *03670012
036800*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                    *03680012
036900*   EXTENDED PO# FROM 7 TO 9                                     *03690012
037000*     MADE BY: COGNIZANT               WR/IR #: CHG0094517       *03700012
037100*                                                                *03710012
037200* DATE  10/23/2014                                               *03720012
037300*     CHANGE MADE: CHANGES MADE TO CHECK FOR THE CONDITION IF    *03730012
037400*    AP_PRC_CDE<> 'J' BEFORE PERFORMING ANY UPDATES ON           *03740012
037500*    IMPORT MI & EI INVOICES STATUS FROM 'OP' OR 'PJ' TO 'DE'    *03750012
037600*    IN 2105-CONTINUE-LOCAL-GO-CHECKS PARA.                      *03760012
037700*     MADE BY: COGNIZANT               WR/IR #: CHG0101913       *03770012
037800*                                                                *03780012
037900* DATE  07/20/2016                                               *03790012
038000*     CHANGE MADE: MODIFIED THE EXISTING LOGIC IN                *03800012
038100*     8000-ADD-INVOICE TO PERFORM A NEW PARAGRAPH,               *03810012
038200*     8005-BUILD-ALLOWANCES. MOVED THE CODE IN 8000-, STARTING   *03820012
038300*     FROM "MOVE ZERO TO PV-ALW-CHRG-SEQ-NBR" THROUGH THE END    *03830012
038400*     OF THE PARA TO THE NEW PARA (8005-).                       *03840012
038500*     MADE BY: SRINATH(COGNIZANT)      WR/IR #: CHG0146972       *03850012
038510*                                                                *03851012
038700* DATE  09/20/2018                                               *03870012
038800*     CHANGE MADE: MAINFRAME REFACTORING - REMOVED COMMENTED     *03880012
038900*                  REFERENCES TO CGU042MC AND CGU040MC.          *03890012
039000*     MADE BY: JIM HUNTER              WR/IR #: CHG0208819       *03900012
039001*                                                                *03900112
039020* DATE  04/01/2019                                               *03902012
039030*     CHANGE MADE: REMOVED BARCODE FIELD FROM APKM323 AND ALL    *03903012
039040*     RELATED REFERENCES FROM THE PROGRAM.  THIS FIELD IS BEING  *03904012
039041*     REPURPOSED TO HOLD CHECK NUMBER AS PART OF ERP MIGRATION.  *03904112
039042*     MADE BY: COGNIZANT               WR/IR #: CHG0221352       *03904212
039043*                                                                *03904312
039045* DATE  09/01/2021                                               *03904512
039046*            - CHANGE CALL OF 'DPKUT100' TO                      *03904612
039047*              CALL DP010I-NUMERIC-EDIT-ROUTINE                  *03904712
039048*              MAKING THE CALL DYNAMIC VS STATIC                 *03904812
039049*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053       *03904912
039050*                                                                *03905012
039051* DATE  10/21/2022                                               *03905112
039052*     CHANGE MADE:                                               *03905212
039053*            - ADD COPYBOOK DPWS930                              *03905312
039054*              CHANGE CICS ARCHITECTURE CALL TO USE              *03905412
039055*              DP930-CICS-ARCH-API                               *03905512
039056*            - ADD LIVINGSTON TO ASC-IMPORT-ENTRY-REQ FIELD      *03905612
039057*     AP DIRECT IMPORT MODIFICATIONS:                            *03905712
039058*     ADD VALUE '1NX' TO IMPRT-CHRG-PRC-CDE-VALID LIST. REMOVED  *03905812
039059*     'AMC' FROM SAME.                                           *03905912
039060*     MADE BY:  BOB MCASEY                  WR #: CHG0276864     *03906012
039050*                                                                *03906113
039051* DATE  05/17/2023                                               *03906213
039052*     CHANGE MADE:                                               *03906313
039053*            - ADDED 'PJ' TO THE VALUE LIST IN THE SQL IN:       *03906413
039054*              3061-COUNT-NON-ZERO-INVC-STR                      *03906513
039055*              3061-COUNT-NON-ZERO-INVC-DC                       *03906613
039057*     IMPACTS ONLY SEPHORA VENDOR INVOICES                        03906813
039060*     MADE BY:  BOB MCASEY                  WR #: CHG0288631     *03907113
039061*----------------------------------------------------------------*03907213
039062                                                                  03907313
039063 ENVIRONMENT DIVISION.                                            03907413
039064 DATA DIVISION.                                                   03907513
039065                                                                  03907613
039066 WORKING-STORAGE SECTION.                                         03907713
039067                                                                  03907813
039068 01  DK-DB2-KEYS.                                                 03907913
039069     05  DK-INVC-ID                   PIC  X(22).                 03908013
039070     05  DK-PO-NBR-LOW                PIC S9(09) VALUE +0         03908113
039080                                                 COMP.            03908213
039090     05  DK-PO-NBR-HIGH               PIC S9(09) VALUE +0         03909001
039100                                                 COMP.            03910001
039200     05  DK-ENT-ID                    PIC S9(09) VALUE +0         03920001
039300                                                 COMP.            03930001
039400     05  DK-INVC-TYP-CDE1             PIC  X(02)                  03940001
039500                                             VALUE LOW-VALUES.    03950001
039600     05  DK-INVC-TYP-CDE2             PIC  X(02)                  03960001
039700                                             VALUE HIGH-VALUES.   03970001
039800                                                                  03980001
039900 01  PC-PROGRAM-CONSTANTS.                                        03990001
040000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         04000001
040100                                                    'AP323A  '.   04010001
040200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         04020001
040300                                                    'APKM323 '.   04030001
040400     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     04040001
040500                                                    COMP.         04050001
040600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         04060001
040700                                                    'APKCS323'.   04070001
041000     05  PC-NULL-DATE                   PIC  X(10)  VALUE         04100001
041100                                                    '9999-09-09'. 04110001
041200     05  PC-NET-COST-ENTRY-DATE         PIC  X(10)  VALUE         04120001
041300                                                    '1997-05-01'. 04130001
041400     05  PC-NULL-TIMESTAMP              PIC  X(26)  VALUE         04140001
041500                                    '9999-09-09-09.09.09.999999'. 04150001
041600     05  PC-INVC-DTE-BEG-LIMIT          PIC  X(10)  VALUE         04160001
041700                                                    '1988-01-01'. 04170001
041800     05  PC-PRIME1                      PIC S9(05)   COMP-3       04180001
041900                                            VALUE +38543.         04190001
042000     05  PC-PRIME2                      PIC S9(05)   COMP-3       04200001
042100                                            VALUE +58889.         04210001
042200     05  PC-ONE-BILLION                 PIC S9(11)   COMP-3       04220001
042300                                            VALUE +1000000000.    04230001
042400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      04240001
042500                                                    COMP-3.       04250001
042600     05  PC-N-CODE                      PIC X(01)   VALUE 'N'.    04260001
042700     05  PC-STR-MTCH-LVL                PIC X(01)   VALUE 'S'.    04270001
042800     05  PC-DC-MTCH-LVL                 PIC X(01)   VALUE 'D'.    04280001
042900     05  PC-BULK-MTCH-LVL               PIC X(01)   VALUE 'P'.    04290001
043000                                                                  04300001
043100     05  PC-TSYMSG-NUMBERS.                                       04310001
043200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 04320001
043300         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 04330001
043400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 04340001
043500         10  PC-TSYMSG-00009            PIC  9(05)  VALUE  00009. 04350001
043600         10  PC-TSYMSG-00010            PIC  9(05)  VALUE  00010. 04360001
043700         10  PC-TSYMSG-00017            PIC  9(05)  VALUE  00017. 04370001
043800         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 04380001
043900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE  00047. 04390001
044000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 04400001
044100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 04410001
044200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 04420001
044300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 04430001
044400         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 04440001
044500         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 04450001
044600         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 04460001
044700         10  PC-TSYMSG-00118            PIC  9(05)  VALUE  00118. 04470001
044800         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 04480001
044900         10  PC-TSYMSG-00170            PIC  9(05)  VALUE  00170. 04490001
045000         10  PC-TSYMSG-00316            PIC  9(05)  VALUE  00316. 04500001
045100         10  PC-TSYMSG-00354            PIC  9(05)  VALUE  00354. 04510001
045200         10  PC-TSYMSG-00482            PIC  9(05)  VALUE  00482. 04520001
045300         10  PC-TSYMSG-00494            PIC  9(05)  VALUE  00494. 04530001
045400         10  PC-TSYMSG-00527            PIC  9(05)  VALUE  00527. 04540001
045500         10  PC-TSYMSG-00587            PIC  9(05)  VALUE  00587. 04550001
045600         10  PC-TSYMSG-00601            PIC  9(05)  VALUE  00601. 04560001
045700         10  PC-TSYMSG-00608            PIC  9(05)  VALUE  00608. 04570001
045800         10  PC-TSYMSG-00726            PIC  9(05)  VALUE  00726. 04580001
045900         10  PC-TSYMSG-00849            PIC  9(05)  VALUE  00849. 04590001
046000         10  PC-TSYMSG-00851            PIC  9(05)  VALUE  00851. 04600001
046100         10  PC-TSYMSG-00852            PIC  9(05)  VALUE  00852. 04610001
046200         10  PC-TSYMSG-00855            PIC  9(05)  VALUE  00855. 04620001
046300         10  PC-TSYMSG-00857            PIC  9(05)  VALUE  00857. 04630001
046400         10  PC-TSYMSG-00858            PIC  9(05)  VALUE  00858. 04640001
046500         10  PC-TSYMSG-00933            PIC  9(05)  VALUE  00933. 04650001
046600         10  PC-TSYMSG-00935            PIC  9(05)  VALUE  00935. 04660001
046700         10  PC-TSYMSG-00947            PIC  9(05)  VALUE  00947. 04670001
046800         10  PC-TSYMSG-00949            PIC  9(05)  VALUE  00949. 04680001
046900         10  PC-TSYMSG-00951            PIC  9(05)  VALUE  00951. 04690001
047000         10  PC-TSYMSG-00952            PIC  9(05)  VALUE  00952. 04700001
047100         10  PC-TSYMSG-00961            PIC  9(05)  VALUE  00961. 04710001
047200         10  PC-TSYMSG-00970            PIC  9(05)  VALUE  00970. 04720001
047300         10  PC-TSYMSG-00974            PIC  9(05)  VALUE  00974. 04730001
047400         10  PC-TSYMSG-01073            PIC  9(05)  VALUE  01073. 04740001
047500         10  PC-TSYMSG-01239            PIC  9(05)  VALUE  01239. 04750001
047600         10  PC-TSYMSG-01314            PIC  9(05)  VALUE  01314. 04760001
047700         10  PC-TSYMSG-01517            PIC  9(05)  VALUE  01517. 04770001
047800         10  PC-TSYMSG-01518            PIC  9(05)  VALUE  01518. 04780001
047900         10  PC-TSYMSG-01564            PIC  9(05)  VALUE  01564. 04790001
048000         10  PC-TSYMSG-01565            PIC  9(05)  VALUE  01565. 04800001
048100         10  PC-TSYMSG-01566            PIC  9(05)  VALUE  01566. 04810001
048200         10  PC-TSYMSG-01567            PIC  9(05)  VALUE  01567. 04820001
048300         10  PC-TSYMSG-01597            PIC  9(05)  VALUE  01597. 04830001
048400         10  PC-TSYMSG-01699            PIC  9(05)  VALUE  01699. 04840001
048500         10  PC-TSYMSG-01700            PIC  9(05)  VALUE  01700. 04850001
048600         10  PC-TSYMSG-01701            PIC  9(05)  VALUE  01701. 04860001
048700         10  PC-TSYMSG-02695            PIC  9(05)  VALUE  02695. 04870001
048800         10  PC-TSYMSG-02696            PIC  9(05)  VALUE  02696. 04880001
048900         10  PC-TSYMSG-03390            PIC  9(05)  VALUE  03390. 04890001
049000         10  PC-TSYMSG-03522            PIC  9(05)  VALUE  03522. 04900001
049100         10  PC-TSYMSG-03523            PIC  9(05)  VALUE  03523. 04910001
049200         10  PC-TSYMSG-03524            PIC  9(05)  VALUE  03524. 04920001
049300         10  PC-TSYMSG-03525            PIC  9(05)  VALUE  03525. 04930001
049400         10  PC-TSYMSG-03526            PIC  9(05)  VALUE  03526. 04940001
049500         10  PC-TSYMSG-03531            PIC  9(05)  VALUE  03531. 04950001
049600         10  PC-TSYMSG-03532            PIC  9(05)  VALUE  03532. 04960001
049700         10  PC-TSYMSG-03682            PIC  9(05)  VALUE  03682. 04970001
049800         10  PC-TSYMSG-03683            PIC  9(05)  VALUE  03683. 04980001
049900         10  PC-TSYMSG-03684            PIC  9(05)  VALUE  03684. 04990001
050000         10  PC-TSYMSG-03686            PIC  9(05)  VALUE  03686. 05000001
050100                                                                  05010001
050200     05  PC-TYP-CDE-CHARGE              PIC  X(01)  VALUE 'C'.    05020001
050300     05  PC-IMPRT-ENTR-NBR              PIC  X(17)                05030001
050400                                    VALUE 'IMPORT ENTRY NBR:'.    05040001
050500     05  PC-BILL-OF-LADING              PIC  X(15)                05050001
050600                                    VALUE 'BILL OF LADING:'.      05060001
050700     05  PC-EXPENSE-STR-NBR             PIC  9(04)  VALUE  90.    05070001
050800     05  PC-BULK-STR-NBR                PIC  9(04)  VALUE  0.     05080001
050900     05  PC-DC-NBR                      PIC  9(05)  VALUE  0.     05090001
051000                                                                  05100001
051100 01  PV-TIMESTAMP                   PIC X(26)  VALUE SPACES.      05110001
051200 01  FILLER  REDEFINES PV-TIMESTAMP.                              05120001
051300     10  FILLER                     PIC X(14).                    05130001
051400     10  PV-MINUTE                  PIC X(02).                    05140001
051500     10  FILLER                     PIC X(02).                    05150001
051600     10  PV-SECOND                  PIC X(01).                    05160001
051700     10  FILLER                     PIC X(01).                    05170001
051800     10  PV-NANOSEC-1               PIC X(03).                    05180001
051900     10  PV-NANOSEC-2               PIC X(03).                    05190001
052000                                                                  05200001
052100 01  PV-PROGRAM-VARIABLES.                                        05210001
052200     05  PV-ONE                         PIC X      VALUE SPACES.  05220001
052300     05  PV-INVOIC-STATUS-CDE           PIC X(02)  VALUE SPACES.  05230001
052400     05  PV-INVOIC-TYP-CDE              PIC X(02)  VALUE SPACES.  05240001
052500     05  PV-INVOIC-ENTR-MTHD-CDE        PIC X(02)  VALUE SPACES.  05250001
052600     05  PV-PURCHS-PO-TYP-CDE           PIC X(02)  VALUE SPACES.  05260001
052700*PRB42514 START                                                   05270001
052800     05  PV-INVOIC-AP-PRC-CDE           PIC X(01)  VALUE SPACES.  05280001
052900*PRB42514 END                                                     05290001
053000                                                                  05300001
053100     05  PV-RANDOM-KEY                  PIC 9(09)  VALUE ZERO.    05310001
053200     05  FILLER  REDEFINES PV-RANDOM-KEY.                         05320001
053300         10  PV-RANDOM-KEY-NANOSEC-1    PIC X(03).                05330001
053400         10  PV-RANDOM-KEY-NANOSEC-2    PIC X(03).                05340001
053500         10  PV-RANDOM-KEY-MINUTE       PIC X(02).                05350001
053600         10  PV-RANDOM-KEY-SECOND       PIC X(01).                05360001
053700                                                                  05370001
053800                                                                  05380001
053900     05  PV-RANDOM-KEY-INT              PIC S9(9) COMP VALUE ZERO.05390001
054000                                                                  05400001
054100     05  PV-IMPORT-VENDOR               PIC X(9)    VALUE         05410001
054200                                                      '000567768'.05420001
054300                                                                  05430001
054400     05  PV-TOTAL-INVC-ITEMS            PIC S9(8)   VALUE +0      05440001
054500                                                    COMP SYNC.    05450001
054600     05  PV-TOTAL-PIECES                PIC S9(8)   VALUE +0      05460001
054700                                                    COMP SYNC.    05470001
054800     05  PV-PER-UNIT-COST               PIC S9(10)V9(3)           05480001
054900                                                    COMP-3.       05490001
055000     05  PV-DISC-PAY-DAY-QTY            PIC  S9(4) COMP.          05500001
055100     05  PV-DISC-PCT                    PIC  SV9(4) COMP-3.       05510001
055200     05  PV-ALW-CHRG-SEQ-NBR            PIC  S9(4) COMP.          05520001
055300     05  PV-TYP-CDE                     PIC  S9(4) COMP.          05530001
055400     05  PV-NULL-INDICATORS.                                      05540001
055500         10  ALCHRG-AMOUNT-NN           PIC S9(4) COMP.           05550001
055600     05  PV-PO-DUN-NBR                  PIC X(9)  VALUE SPACES.   05560001
055700     05  PV-STRING                      PIC X(22).                05570001
055800     05  PV-START                       PIC S9(04) COMP.          05580001
055900                                                                  05590001
056000     05  PV-SUM-OF-THE-CHARGES          PIC S9(11)V9(2)           05600001
056100                                                      COMP-3      05610001
056200                                                      VALUE +0.   05620001
056300     05  PV-SUM-OF-ALLOWANCES           PIC S9(11)V9(2)           05630001
056400                                                      COMP-3      05640001
056500                                                      VALUE +0.   05650001
056600     05  PV-NET-INVC-AMT                PIC S9(09)V99 COMP-3      05660001
056700                                                      VALUE +0.   05670001
056800     05  PV-DB2-COUNT                   PIC S9(9) COMP.           05680001
056900     05  PV-INVC-COUNT                  PIC S9(9) COMP.           05690001
057000     05  PV-TOTAL-BY-STORE              PIC S9(9) COMP.           05700001
057100     05  PV-TOTAL-BY-DC                 PIC S9(9) COMP.           05710001
057200     05  PV-TOTAL-BY-BULK               PIC S9(9) COMP.           05720001
057300     05  PV-NUM3                        PIC ZZ9.                  05730001
057400     05  PV-NUM3-X REDEFINES                                      05740001
057500         PV-NUM3                        PIC X(3).                 05750001
057600     05  PV-NUM3-9 REDEFINES                                      05760001
057700         PV-NUM3                        PIC 9(3).                 05770001
057800     05  PV-NUM4                        PIC ZZZ9.                 05780001
057900     05  PV-NUM4-X REDEFINES                                      05790001
058000         PV-NUM4                        PIC X(4).                 05800001
058100     05  PV-NUM4-9 REDEFINES                                      05810001
058200         PV-NUM4                        PIC 9(4).                 05820001
058300     05  PV-NUM5                        PIC ZZZZZ.                05830001
058400     05  PV-NUM5-X REDEFINES PV-NUM5    PIC X(5).                 05840001
058500     05  PV-NUM5-9 REDEFINES PV-NUM5    PIC 9(5).                 05850001
058600*    05  PV-NUM7                        PIC Z(9).                 05860001
058700*    05  PV-NUM7-X REDEFINES                                      05870001
058800*        PV-NUM7                        PIC X(9).                 05880001
058900     05  PV-NUM09                       PIC Z(09).                05890001
059000     05  PV-NUM09-X REDEFINES                                     05900001
059100         PV-NUM09                       PIC X(09).                05910001
059200     05  PV-NUM11                       PIC Z(11).                05920001
059300     05  PV-NUM11-X REDEFINES                                     05930001
059400         PV-NUM11                       PIC X(11).                05940001
059500     05  PV-8V99                        PIC Z(8).99.              05950001
059600     05  PV-8V99-X REDEFINES                                      05960001
059700         PV-8V99                        PIC X(11).                05970001
059800     05  PV-3V99                        PIC Z(3).99.              05980001
059900     05  PV-3V99-X REDEFINES                                      05990001
060000         PV-3V99                        PIC X(06).                06000001
060100     05  PV-2V99                        PIC Z(2).99.              06010001
060200     05  PV-2V99-X REDEFINES                                      06020001
060300         PV-2V99                        PIC X(05).                06030001
060400     05  PV-WHOLE-PCT                   PIC 9(3).                 06040001
060500     05  PV-WHOLE-PCT-X REDEFINES                                 06050001
060600         PV-WHOLE-PCT                   PIC X(3).                 06060001
060700                                                                  06070001
060800     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      06080001
060900                                                    COMP SYNC.    06090001
061000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      06100001
061100                                                    COMP SYNC.    06110001
061200     05  PV-WORK-FIELD                   PIC S9(17)   COMP-3      06120001
061300                                                      VALUE +0.   06130001
061400     05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3      06140001
061500                                                      VALUE +0.   06150001
061600                                                                  06160001
061700     05  PV-CCYYMMDD-DATE               PIC  X(10).               06170001
061800     05  PV-CCYYMMDD-DATE-RDF           REDEFINES                 06180001
061900         PV-CCYYMMDD-DATE.                                        06190001
062000         10  PV-CCYY                    PIC  X(04).               06200001
062100         10  PV-CCYY-9   REDEFINES PV-CCYY                        06210001
062200                                        PIC  9(04).               06220001
062300         10  PV-CCYY-RDF REDEFINES PV-CCYY.                       06230001
062400             15  PV-CC                  PIC  9(02).               06240001
062500             15  PV-YY                  PIC  9(02).               06250001
062600         10  PV-DASH1                   PIC  X(01).               06260001
062700         10  PV-MM                      PIC  X(02).               06270001
062800         10  PV-MM-9     REDEFINES PV-MM                          06280001
062900                                        PIC  9(02).               06290001
063000         10  PV-DASH2                   PIC  X(01).               06300001
063100         10  PV-DD                      PIC  X(02).               06310001
063200         10  PV-DD-9     REDEFINES PV-DD                          06320001
063300                                        PIC  9(02).               06330001
063400     05  PV-DUP-COUNTER                 PIC S9(04) COMP.          06340001
063500                                                                  06350001
063600     05  PV-IMPRT-CHRG-PRC-CDE   PIC X(03)     VALUE SPACE.       06360001
063700         88  IMPRT-CHRG-PRC-CDE-VALID          VALUE              06370001
063800                                  '1OA', '1ST', '1LC', '1NX'.     06380012
063900                                                                  06390001
064000 01  PS-PROGRAM-SWITCHES.                                         06400001
064100     05  PS-VALID-DATE-SW               PIC  X(01).               06410001
064200         88  PS-VALID-DATE                          VALUE 'Y'.    06420001
064300         88  PS-INVALID-DATE                        VALUE 'N'.    06430001
064400         88  PS-DATE-RANGE-ERROR                    VALUE 'E'.    06440001
064500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    06450001
064600         88  PS-NO-ERROR                            VALUE 'Y'.    06460001
064700         88  PS-ERROR                               VALUE 'N'.    06470001
064800     05  PS-NET-AMT-SW                  PIC  X(01)  VALUE 'Y'.    06480001
064900         88  PS-NET-AMT-ENTERED                     VALUE 'Y'.    06490001
065000         88  PS-NET-AMT-NOT-ENTERED                 VALUE 'N'.    06500001
065100     05  PS-COST-AMT-SW                 PIC  X(01)  VALUE 'Y'.    06510001
065200         88  PS-COST-AMT-CHANGED                    VALUE 'Y'.    06520001
065300         88  PS-COST-AMT-NOT-CHANGED                VALUE 'N'.    06530001
065400     05  PS-TALCHRG-EXISTS-SW           PIC X.                    06540001
065500     05  PS-TPURCHS-EXISTS-SW           PIC X       VALUE 'N'.    06550001
065600         88  PS-TPURCHS-FOUND                       VALUE 'Y'.    06560001
065700         88  PS-TPURCHS-NOT-FOUND                   VALUE 'N'.    06570001
065800     05  PS-TPOAGMT-EXISTS-SW           PIC X       VALUE 'Y'.    06580001
065900         88  PS-TPOAGMT-MORE                        VALUE 'Y'.    06590001
066000         88  PS-TPOAGMT-NO-MORE                     VALUE 'N'.    06600001
066100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    06610001
066200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    06620001
066300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    06630001
066400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    06640001
066500         88  PS-DONE                                VALUE 'Y'.    06650001
066600         88  PS-NOT-DONE                            VALUE 'N'.    06660001
066700     05  MI-IMPORT-CODE-VALID-SW        PIC  X(01)  VALUE 'Y'.    06670001
066800         88  MI-IMPORT-CODE-VALID                   VALUE 'Y'.    06680001
066900         88  MI-IMPORT-CODE-INVALID                 VALUE 'N'.    06690001
067000     05  PS-BY-STORE-SW                 PIC  X(01)  VALUE 'N'.    06700001
067100         88  PS-BY-STORE-NF                         VALUE 'N'.    06710001
067200         88  PS-BY-STORE                            VALUE 'Y'.    06720001
067300     05  PS-BY-DC-SW                    PIC  X(01)  VALUE 'N'.    06730001
067400         88  PS-BY-DC-NF                            VALUE 'N'.    06740001
067500         88  PS-BY-DC                               VALUE 'Y'.    06750001
067600     05  PS-BY-BULK-SW                  PIC  X(01)  VALUE 'N'.    06760001
067700         88  PS-BY-BULK-NF                          VALUE 'N'.    06770001
067800         88  PS-BY-BULK                             VALUE 'Y'.    06780001
067900     05  PS-FIRST-INVC-SW               PIC  X(01)  VALUE 'N'.    06790001
068000         88  PS-FIRST-INVC-NF                       VALUE 'N'.    06800001
068100         88  PS-FIRST-INVC                          VALUE 'Y'.    06810001
068200     05  PS-IMPRT-ENTR-NBR-SW           PIC  X(01)  VALUE 'N'.    06820001
068300         88  PS-IMPRT-ENTR-NBR-YES                  VALUE 'Y'.    06830001
068400         88  PS-IMPRT-ENTR-NBR-NO                   VALUE 'N'.    06840001
068500     05  PS-TALCHRG-PASS-SW             PIC  X(01)  VALUE '1'.    06850001
068600         88  PS-1ST-TALCHRG-PASS                    VALUE '1'.    06860001
068700         88  PS-2ND-TALCHRG-PASS                    VALUE '2'.    06870001
068800                                                                  06880001
068900*--------------------------------------------------------------*  06890001
069000* RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     *  06900001
069100*--------------------------------------------------------------*  06910001
069200     COPY APWS301.                                                06920001
069300                                                                  06930001
069400*--------------------------------------------------------------*  06940001
069500* MAP LAYOUT                                                   *  06950001
069600*--------------------------------------------------------------*  06960001
069700     COPY APKM323.                                                06970001
069800                                                                  06980001
069900*--------------------------------------------------------------*  06990001
070000* ATTRIBUTE SETTINGS COPYBOOK.                                 *  07000001
070100*--------------------------------------------------------------*  07010001
070200     COPY DPWS015.                                                07020001
070300                                                                  07030001
070400*--------------------------------------------------------------*  07040001
070500* FUNCTION KEYS COPYBOOK.                                      *  07050001
070600*--------------------------------------------------------------*  07060001
070700     COPY DPWS016.                                                07070001
070800                                                                  07080001
070900*--------------------------------------------------------------*  07090001
071000* WORK AREA PASSED IN CALL TO DPKUT500 DATE ROUTINE            *  07100001
071100*--------------------------------------------------------------*  07110001
071200     COPY DPWS500.                                                07120001
071300                                                                  07130001
071400*--------------------------------------------------------------*  07140001
071500* WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                *  07150001
071600*--------------------------------------------------------------*  07160001
071700     COPY DPWS010I.                                               07170001
071800                                                                  07180001
071900*--------------------------------------------------------------*  07190001
072000* PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).     *  07200001
072100*--------------------------------------------------------------*  07210001
072200     COPY DPWS030.                                                07220001
072210     COPY DPWS930.                                                07221007
072300                                                                  07230001
072400*--------------------------------------------------------------*  07240001
072500* STANDARD COMMAREA.                                           *  07250001
072600*--------------------------------------------------------------*  07260001
072700     COPY DPWS020.                                                07270001
072800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                07280001
072900                                                                  07290001
073000*--------------------------------------------------------------*  07300001
073100* INTER-APPLICATION COMMAREA.                                  *  07310001
073200*--------------------------------------------------------------*  07320001
073300         10  INTER-APPL-COMM-AREA       PIC X(200).               07330001
073400     COPY APWS300.                                                07340001
073500                                                                  07350001
073600*--------------------------------------------------------------*  07360001
073700* THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *  07370001
073800*--------------------------------------------------------------*  07380001
073900         10  ASC-SPECIFIC-COMMAREA.                               07390001
074000             15  ASC-INT-APPL-FORMAT-IND    PIC X(01).            07400001
074100                 88  ASC-INTER-APPL-ADD          VALUE ' '.       07410001
074200                 88  ASC-INTER-APPL-CRIT-UPDATE  VALUE '1'.       07420001
074300                 88  ASC-INTER-APPL-CRIT-DELETE  VALUE '2'.       07430001
074400                 88  ASC-INTER-APPL-LIST-UPDATE  VALUE '5'.       07440001
074500                 88  ASC-INTER-APPL-LIST-DELETE  VALUE '6'.       07450001
074600             15  ASC-RETURN-SW              PIC X(01).            07460001
074700                 88  ASC-RETURN-FROM-VENDOR VALUE 'V'.            07470001
074800                 88  ASC-OTHER-RETURN       VALUE ' '.            07480001
074900             15  ASC-REQUEST-SW             PIC X(03).            07490001
075000                 88  ASC-DELETE-REQUESTED   VALUE 'DEL'.          07500001
075100                 88  ASC-UPDATE-REQUESTED   VALUE 'UPD'.          07510001
075200                 88  ASC-ADD-REQUESTED      VALUE 'ADD'.          07520001
075300             15  ASC-ADD-CONF-STATUS-SW     PIC X(03).            07530001
075400                 88  ASC-CONF-REQ           VALUE 'REQ'.          07540001
075500                 88  ASC-CONF-OBT           VALUE 'OBT'.          07550001
075600                 88  ASC-CONF-NOT-OBT       VALUE '   '.          07560001
075700             15  ASC-ACTION-SW              PIC X(03).            07570001
075800                 88  ASC-DELETE-ALLOWED     VALUE '   '.          07580001
075900                 88  ASC-NO-CHANGES-ALLOWED VALUE 'NOC'.          07590001
076000                 88  ASC-DELETE-PENDING     VALUE 'DEL'.          07600001
076100                 88  ASC-UPDATE-PENDING     VALUE 'UPD'.          07610001
076200                 88  ASC-ADD-PENDING        VALUE 'ADD'.          07620001
076300                 88  ASC-RETURN             VALUE 'RET'.          07630001
076400             15  ASC-DELETE-SUCCESSFUL-SW   PIC X(01).            07640001
076500                 88  ASC-DELETE-SUCCESSFUL  VALUE 'Y'.            07650001
076600             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            07660001
076700                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            07670001
076800                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            07680001
076900             15  ASC-FIELDS-MODIFIED-SW     PIC X(01).            07690001
077000                 88  ASC-FIELDS-MODIFIED    VALUE 'Y'.            07700001
077100             15  ASC-NET-ZERO-SW            PIC  X(01).           07710001
077200                 88  ASC-NET-AMT-NOT-ZERO    VALUE 'N'.           07720001
077300                 88  ASC-NET-AMT-ZERO        VALUE 'Y'.           07730001
077400             15  ASC-INVOICE-FOUND-SW       PIC X(01).            07740001
077500                 88  ASC-INVOICE-FOUND      VALUE 'Y'.            07750001
077600                 88  ASC-INVOICE-NOT-FOUND  VALUE 'N'.            07760001
077700                 88  ASC-MULTIPLE-INVOICES  VALUE 'M'.            07770001
077800             15  ASC-TALCHRG-EXISTS-SW      PIC X(01).            07780001
077900                 88  ASC-TALCHRG-EXISTS     VALUE 'Y'.            07790001
078000             15  ASC-TINVCTM-EXISTS-SW      PIC X(01).            07800001
078100                 88  ASC-TINVCTM-EXISTS     VALUE 'Y'.            07810001
078200             15  ASC-DUNS-ENTERED-SW        PIC  X(01).           07820001
078300                 88  ASC-DUNS-NOT-ENTERED   VALUE 'N'.            07830001
078400                 88  ASC-DUNS-ENTERED       VALUE 'Y'.            07840001
078500             15  ASC-IMPORT-DEL-AUTH-SW     PIC  X(01).           07850001
078600                 88  ASC-NO-IMPORT-DEL-AUTH VALUE 'N'.            07860001
078700                 88  ASC-IMPORT-DEL-AUTH    VALUE 'Y'.            07870001
078800             15  ASC-STAT-UPDATED-TO-DE-SW  PIC  X(01).           07880001
078900                 88  ASC-STAT-UPDATED-TO-DE VALUE 'Y'.            07890001
079000             15  ASC-KEY-FIELDS.                                  07900001
079100                 20  ASC-KEY-PAYT-REQ-SEQ-NBR     PIC S9(09) COMP.07910001
079200                 20  ASC-KEY-PO-NBR               PIC S9(09) COMP.07920001
079300*                20  ASC-KEY-VER-NBR              PIC S9(09) COMP.07930001
079400                 20  ASC-KEY-INVC-ID              PIC  X(22).     07940001
079500                 20  ASC-KEY-INVC-STATUS          PIC  X(02).     07950001
079600                 20  ASC-KEY-INVC-TYP-CDE         PIC  X(02).     07960001
079700                     88  ASC-VALID-ADD-TYP                        07970001
079800                                         VALUE 'EI', 'MI', '  '.  07980001
079900                     88  ASC-VALID-INVC-TYP                       07990001
080000                                         VALUE 'EI', 'MI', '  ',  08000001
080100                                               'RI', 'WO'.        08010001
080200                     88  ASC-EXPENSE-INVC        VALUE 'EI'.      08020001
080300                     88  ASC-MDSE-INVC           VALUE 'MI'.      08030001
080400             15  ASC-ORIGINAL-FIELD-VALUES.                       08040001
080500                 20  ASC-OLD-INVC-ID              PIC  X(22).     08050001
080600                 20  ASC-OLD-INVC-STATUS          PIC  X(02).     08060001
080700                 20  ASC-OLD-PO-NBR               PIC S9(09) COMP.08070001
080800                 20  ASC-OLD-RMIT-VND-ID          PIC  X(09).     08080001
080900                 20  ASC-OLD-HOLD-IND             PIC  X(01).     08090001
081000                 20  ASC-OLD-INVC-DTE             PIC  X(10).     08100001
081100                 20  ASC-OLD-INVC-DTE-RDF REDEFINES               08110001
081200                     ASC-OLD-INVC-DTE.                            08120001
081300                     25  ASC-OLD-INVC-DTE-CC      PIC  X(02).     08130001
081400                     25  ASC-OLD-INVC-DTE-YY      PIC  X(02).     08140001
081500                     25  FILLER                   PIC  X(01).     08150001
081600                     25  ASC-OLD-INVC-DTE-MM      PIC  X(02).     08160001
081700                     25  FILLER                   PIC  X(01).     08170001
081800                     25  ASC-OLD-INVC-DTE-DD      PIC  X(02).     08180001
081900                 20  ASC-OLD-BAR-CDE              PIC  X(09).     08190001
082000                 20  ASC-OLD-STR-NBR              PIC S9(04) COMP.08200001
082100                 20  ASC-OLD-GRO-COST-AMT         PIC S9(08)V99   08210001
082200                                                       COMP-3.    08220001
082300                 20  ASC-OLD-NET-INVC-AMT         PIC S9(08)V99   08230001
082400                                                       COMP-3.    08240001
082500                 20  ASC-OLD-TOT-INVC-PC-QTY      PIC S9(09) COMP.08250001
082600                 20  ASC-OLD-TERM-SEL-CDE         PIC  X(01).     08260001
082700                 20  ASC-OLD-PO-SEL               PIC  X(01).     08270001
082800                 20  ASC-OLD-IN-SEL               PIC  X(01).     08280001
082900                 20  ASC-OLD-IN-DISC-PCT          PIC SV9(4)      08290001
083000                                                       COMP-3.    08300001
083100                 20  ASC-OLD-IN-DISC-PCT-NUM      PIC  99V99.     08310001
083200                 20  ASC-OLD-IN-DISC-DUE-DAY-QTY  PIC S9(04) COMP.08320001
083300                 20  ASC-OLD-IN-EOM               PIC  X(01).     08330001
083400                 20  ASC-OLD-IN-TERM-TYP-CDE      PIC  X(02).     08340001
083500                 20  ASC-OLD-IN-EXTD-DAYS-QTY     PIC S9(04) COMP.08350001
083600                 20  ASC-OLD-IN-SPLIT-TERMS-IND   PIC  X(01).     08360001
083700                 20  ASC-OLD-KOHLS-FRGT-PCT       PIC S9V9(04)    08370001
083800                                                       COMP-3.    08380001
083900                 20  ASC-OLD-VEND-FRGT-PCT        PIC S9V9(04)    08390001
084000                                                       COMP-3.    08400001
084100                 20  ASC-OLD-KOHLS-FRGT-PCT-NUM   PIC   9(03).    08410001
084200                 20  ASC-OLD-VEND-FRGT-PCT-NUM    PIC   9(03).    08420001
084300                                                                  08430001
084400                 20  ASC-OLD-BOL-ID               PIC   X(30).    08440001
084500                 20  ASC-OLD-CARTON-CNT           PIC S9(05) COMP.08450001
084600                 20  ASC-OLD-IMPRT-CHRG-CDE       PIC  X(03).     08460001
084700                 20  ASC-OLD-DC-NBR               PIC S9(04) COMP.08470001
084800                 20  ASC-OLD-CNTNR-ID             PIC   X(12).    08480001
084900                 20  ASC-OLD-REF-NBR              PIC   X(15).    08490001
085000                 20  ASC-OLD-ENT-NBR              PIC   X(16).    08500001
085100                                                                  08510001
085200             15  ASC-NEWLY-ENTERED-FIELD-VALUES.                  08520001
085300                 20  ASC-NEW-INVC-ID              PIC  X(22).     08530001
085400                 20  ASC-NEW-INVC-STATUS          PIC  X(02).     08540001
085500                 20  ASC-NEW-PO-NBR               PIC S9(09) COMP.08550001
085600                 20  ASC-NEW-RMIT-VND-ID          PIC  X(09).     08560001
085700*  THIS 88 LEVEL # 1 CONTAINS THE DUN NBRS FOR VENDORS            08570001
085800*  EXPEDITORS INT'L/LA AND MAERSK.                                08580001
085900*                                                                 08590001
086000*  ALL OF EXPEDITORS' EXPENSE INVOICES MUST HAVE AN IMPORT        08600001
086100*  ENTRY NUMBER. THEY ARE THE ONLY VENDOR THAT WE REQUIRE IT FOR. 08610001
086200*                                                                 08620001
086300*  ALL OF MAERSK'S INVOICES MUST HAVE AN IMPORT BOL-ID.  THEY ARE 08630001
086400*  THE ONLY VENDOR FOR WHICH THIS FIELD IS REQUIRED.              08640001
086500                     88  ASC-IMPORT-ENTRY-REQ   VALUE '009207259',08650001
086600                                                      '001182576',08660011
086610                                                      '000520247'.08661009
086700                 20  ASC-NEW-HOLD-IND             PIC  X(01).     08670001
086800                 20  ASC-NEW-INVC-DTE             PIC  X(10).     08680001
086900                 20  ASC-NEW-INVC-DTE-RDF REDEFINES               08690001
087000                     ASC-NEW-INVC-DTE.                            08700001
087100                     25  ASC-NEW-INVC-DTE-CC      PIC  X(02).     08710001
087200                     25  ASC-NEW-INVC-DTE-YY      PIC  X(02).     08720001
087300                     25  FILLER                   PIC  X(01).     08730001
087400                     25  ASC-NEW-INVC-DTE-MM      PIC  X(02).     08740001
087500                     25  FILLER                   PIC  X(01).     08750001
087600                     25  ASC-NEW-INVC-DTE-DD      PIC  X(02).     08760001
087700                 20  ASC-NEW-BAR-CDE              PIC  X(09).     08770001
087800                 20  ASC-NEW-STR-NBR              PIC S9(04) COMP.08780001
087900                     88  ASC-EXPENSE-STR-NBR    VALUE 90, 820.    08790001
088000                     88  ASC-IMPORT-MI-STR-NBR  VALUE 0.          08800001
088100                 20  ASC-NEW-GRO-COST-AMT         PIC S9(08)V99   08810001
088200                                                       COMP-3.    08820001
088300                 20  ASC-NEW-NET-INVC-AMT         PIC S9(08)V99   08830001
088400                                                       COMP-3.    08840001
088500                 20  ASC-NEW-TOT-INVC-PC-QTY      PIC S9(09) COMP.08850001
088600                 20  ASC-NEW-TERM-SEL-CDE         PIC  X(01).     08860001
088700                 20  ASC-NEW-PO-SEL               PIC  X(01).     08870001
088800                 20  ASC-NEW-INVC-SELECTIONS.                     08880001
088900                     25  ASC-NEW-IN-SEL           PIC  X(01).     08890001
089000                     25  ASC-NEW-IN-DISC-PCT      PIC SV9(4)      08900001
089100                                                       COMP-3.    08910001
089200                     25  ASC-NEW-IN-DISC-PCT-NUM  PIC  99V99.     08920001
089300                     25  ASC-NEW-IN-DISC-DUE-DAY-QTY              08930001
089400                                                  PIC S9(04) COMP.08940001
089500                     25  ASC-NEW-IN-EOM           PIC  X(01).     08950001
089600                     25  ASC-NEW-IN-TERM-TYP-CDE  PIC  X(02).     08960001
089700                     25  ASC-NEW-IN-EXTD-DAYS-QTY                 08970001
089800                                                  PIC S9(04) COMP.08980001
089900                     25  ASC-NEW-IN-SPLIT-TERMS-IND               08990001
090000                                                  PIC  X(01).     09000001
090100                 20  ASC-NEW-KOHLS-FRGT-PCT       PIC S9V9(04)    09010001
090200                                                       COMP-3.    09020001
090300                 20  ASC-NEW-VEND-FRGT-PCT        PIC S9V9(04)    09030001
090400                                                       COMP-3.    09040001
090500                 20  ASC-NEW-KOHLS-FRGT-PCT-NUM   PIC   9(03).    09050001
090600                 20  ASC-NEW-VEND-FRGT-PCT-NUM    PIC   9(03).    09060001
090700                                                                  09070001
090800                 20  ASC-NEW-BOL-ID               PIC  X(30).     09080001
090900                 20  ASC-NEW-CARTON-CNT           PIC S9(05) COMP.09090001
091000                 20  ASC-NEW-IMPRT-CHRG-CDE       PIC  X(03).     09100001
091100                 20  ASC-NEW-DC-NBR               PIC S9(04) COMP.09110001
091200                 20  ASC-NEW-CNTNR-ID             PIC  X(12).     09120001
091300                 20  ASC-NEW-REF-NBR              PIC  X(15).     09130001
091400                 20  ASC-NEW-ENT-NBR              PIC  X(16).     09140001
091500                                                                  09150001
091600             15  ASC-ALPHA-COUNTERPARTS.                          09160001
091700                 20  ASC-ALP-PO-NBR.                              09170001
091800                     25  ASC-ALP-PO-NBR-NUM       PIC 9(9).       09180001
091900                 20  ASC-ALP-STR-NBR              PIC X(4).       09190001
092000                 20  ASC-ALP-STR-NBR-NUM REDEFINES                09200001
092100                     ASC-ALP-STR-NBR              PIC 9(4).       09210001
092200                 20  ASC-ALP-GRO-COST-AMT.                        09220001
092300                     25  ASC-ALP-GRO-COST-AMT-NUM PIC 9(9)V99.    09230001
092400                                                                  09240001
092500                 20  ASC-ALP-NET-INVC-AMT.                        09250001
092600                     25  ASC-ALP-NET-INVC-AMT-NUM PIC 9(9)V99.    09260001
092700                 20  ASC-ALP-TOT-INVC-PC-QTY.                     09270001
092800                     25  ASC-ALP-TOT-INVC-PC-QTY-NUM              09280001
092900                                                  PIC 9(9).       09290001
093000                                                                  09300001
093100                 20  ASC-ALP-INVC-FIELDS.                         09310001
093200                     25  ASC-ALP-DISC-PCT         PIC X(5).       09320001
093300                     25  ASC-ALP-DISC-PCT-NUM REDEFINES           09330001
093400                             ASC-ALP-DISC-PCT     PIC 9(3)V99.    09340001
093500                     25  ASC-ALP-DISC-DUE-DAY-QTY PIC X(3).       09350001
093600                     25  ASC-ALP-DISC-DUE-DAY-QTY-NUM REDEFINES   09360001
093700                             ASC-ALP-DISC-DUE-DAY-QTY             09370001
093800                                                  PIC 9(3).       09380001
093900                     25  ASC-ALP-EXTD-DAYS-QTY    PIC X(3).       09390001
094000                     25  ASC-ALP-EXTD-DAYS-QTY-NUM REDEFINES      09400001
094100                             ASC-ALP-EXTD-DAYS-QTY                09410001
094200                                                  PIC 9(3).       09420001
094300                 20  ASC-ALP-KOHLS-FRGT-PCT.                      09430001
094400                     25  ASC-ALP-KOHLS-FRGT-PCT-NUM               09440001
094500                                                  PIC 9(3).       09450001
094600                 20  ASC-ALP-VEND-FRGT-PCT.                       09460001
094700                     25  ASC-ALP-VEND-FRGT-PCT-NUM                09470001
094800                                                  PIC 9(3).       09480001
094900                 20  ASC-ALP-CARTON-CNT.                          09490001
095000                     25  ASC-ALP-CARTON-CNT-NUM   PIC 9(5).       09500001
095100                                                                  09510001
095200             15  ASC-OTHER-FIELDS.                                09520001
095300                 20  ASC-PREVIOUSLY-ENTERED-FIELDS.               09530001
095400* NO NEED TO EDIT EVERY TIME UNLESS THE "NEW" DOESN'T EQUAL THE   09540001
095500* "PREV"                                                          09550001
095600                     25  ASC-PREV-PO-NBR          PIC S9(09) COMP.09560001
095700                     25  ASC-PREV-DUN-NBR         PIC  X(09).     09570001
095800                     25  ASC-PREV-BAR-CDE         PIC  X(09).     09580001
095900                     25  ASC-PREV-INVC-ID         PIC  X(22).     09590001
096000                     25  ASC-DIR-STR-IND          PIC  X(01).     09600001
096100                     25  ASC-PO-TYP-CDE           PIC  X(02).     09610001
096200                         88  ASC-IMPORT-PO           VALUES 'IM', 09620001
096300                                                            'IE', 09630001
096400                                                            'IF'. 09640001
096500                         88  ASC-CNSMR-DIR-PO        VALUE 'CD'.  09650001
096600                 20  ASC-CALC-PREQIT-COST            PIC S9(9)V99 09660001
096700                                                     COMP-3.      09670001
096800                 20  ASC-HOLD-PO-DUN-NBR          PIC  X(09).     09680001
096900                 20  ASC-ENT-DATA.                                09690001
097000                     25  ASC-HOLD-VENDOR          PIC  X.         09700001
097100                     25  ASC-ENT-NAME-DESC        PIC  X(40).     09710001
097200                     25  ASC-ADDRESS-LINE1-DESC   PIC  X(40).     09720001
097300                     25  ASC-ADDRESS-LINE2-DESC   PIC  X(40).     09730001
097400                     25  ASC-CITY-NAME            PIC  X(15).     09740001
097500                     25  ASC-STATE-CDE            PIC  X(02).     09750001
097600                     25  ASC-ZIP-CDE              PIC  X(12).     09760001
097700                     25  ASC-DEPT-NBR             PIC  X(03).     09770001
097800                 20  ASC-MTCH-LVL-CDE             PIC  X(01).     09780001
097900                 20  ASC-NEW-STR-PO-IND           PIC  X(01).     09790001
098000                 20  ASC-TALCHRG-COST-WITH-ADJSTMT                09800001
098100                                                  PIC S9(09)V99   09810001
098200                                                       COMP-3.    09820001
098300                 20  ASC-PO-DISCOUNT-PCT          PIC  99V99.     09830001
098400                 20  ASC-PO-DISCOUNT-DAYS-QTY     PIC S9(04) COMP.09840001
098500                 20  ASC-PO-DUE-DAY-FR-DTE-TXT    PIC  X(17).     09850001
098600                 20  ASC-PO-DISC-PAY-DAY-QTY      PIC S9(04) COMP.09860001
098700                 20  ASC-ENTR-MTHD-CDE            PIC  X(02).     09870001
098800                 20  ASC-POAGMT-DISC-PCT          PIC SV9(4)      09880001
098900                                                       COMP-3.    09890001
099000                 20  ASC-DUE-DTE-SRC-CDE          PIC  X(01).     09900001
099100                 20  ASC-CALC-DUE-DTE             PIC  X(10).     09910001
099200                 20  ASC-CALC-DUE-DTE-RDF REDEFINES               09920001
099300                     ASC-CALC-DUE-DTE.                            09930001
099400                     25  ASC-CALC-DUE-DTE-CC      PIC  X(02).     09940001
099500                     25  ASC-CALC-DUE-DTE-YY      PIC  X(02).     09950001
099600                     25  FILLER                   PIC  X(01).     09960001
099700                     25  ASC-CALC-DUE-DTE-MM      PIC  X(02).     09970001
099800                     25  FILLER                   PIC  X(01).     09980001
099900                     25  ASC-CALC-DUE-DTE-DD      PIC  X(02).     09990001
100000                 20  ASC-SPEC-INST.                               10000001
100100                     25  ASC-SPEC-INST1           PIC  X(50).     10010001
100200                     25  ASC-SPEC-INST2           PIC  X(50).     10020001
100300                     25  ASC-SPEC-INST3           PIC  X(50).     10030001
100400                                                                  10040001
100500                 20  ASC-CURRENT-TIMESTAMP        PIC  X(26).     10050001
100600                 20  ASC-CURRENT-TS-RDF       REDEFINES           10060001
100700                     ASC-CURRENT-TIMESTAMP.                       10070001
100800                     25  ASC-CURRENT-DATE     PIC X(10).          10080001
100900                     25  FILLER               PIC X(01).          10090001
101000                     25  ASC-CURRENT-TIME.                        10100001
101100                         30  ASC-HH           PIC 9(02).          10110001
101200                         30  FILLER           PIC X(01).          10120001
101300                         30  ASC-MIN          PIC 9(02).          10130001
101400                         30  FILLER           PIC X(01).          10140001
101500                         30  ASC-SEC          PIC 9(02).          10150001
101600                         30  FILLER           PIC X(01).          10160001
101700                         30  ASC-MILLI-SEC    PIC 9(06).          10170001
101800             15  ASC-USE-SELECTION-QUEUE-IND                      10180001
101900                                        PIC  X(01).               10190001
102000                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    10200001
102100             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               10210001
102200             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       10220001
102300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     10230001
102400                                        PIC S9(09)  COMP-3.       10240001
102500             15  ASC-SEL-SUB            PIC S9(04)  COMP.         10250001
102600             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         10260001
102700             15  ASC-INTER-APPL-COPY    PIC X(200).               10270001
102800                                                                  10280001
102900*--------------------------------------------------------------*  10290001
103000* ABEND PROCESSING COPYBOOK.                                   *  10300001
103100*--------------------------------------------------------------*  10310001
103200     COPY DPWS013.                                                10320001
103300                                                                  10330001
103400*----------------------------------------------------------------*10340001
103500*    CICSAUTH PROCESSING COPYBOOK.                               *10350001
103600*----------------------------------------------------------------*10360001
103700     COPY DPWS008.                                                10370001
103800                                                                  10380001
103900*--------------------------------------------------------------*  10390001
104000* EXTERNAL ENTERPRISE ENTITY TABLE                             *  10400001
104100*--------------------------------------------------------------*  10410001
104200     EXEC SQL INCLUDE TEXTENT  END-EXEC.                          10420001
104300                                                                  10430001
104400*--------------------------------------------------------------*  10440001
104500* BUSINESS LOCATION TABLE                                      *  10450001
104600*--------------------------------------------------------------*  10460001
104700     EXEC SQL INCLUDE TBUSLOC  END-EXEC.                          10470001
104800                                                                  10480001
104900*--------------------------------------------------------------*  10490001
105000* EXTERNAL ENTERPRISE ENTITY NAME TABLE                        *  10500001
105100*--------------------------------------------------------------*  10510001
105200     EXEC SQL INCLUDE TENTNME  END-EXEC.                          10520001
105300                                                                  10530001
105400*--------------------------------------------------------------*  10540001
105500* PAYMENT TERMS TABLE                                          *  10550001
105600*--------------------------------------------------------------*  10560001
105700     EXEC SQL INCLUDE TPAYTRM  END-EXEC.                          10570001
105800                                                                  10580001
105900*--------------------------------------------------------------*  10590001
106000* PURCHASE ORDER TABLE                                         *  10600001
106100*--------------------------------------------------------------*  10610001
106200     EXEC SQL INCLUDE TPURCHS  END-EXEC.                          10620001
106300                                                                  10630001
106400*--------------------------------------------------------------*  10640001
106500* PLANNED SHIPMENT TABLE                                       *  10650001
106600*--------------------------------------------------------------*  10660001
106700     EXEC SQL INCLUDE TPLNSHP  END-EXEC.                          10670001
106800                                                                  10680001
106900*--------------------------------------------------------------*  10690001
107000* PO INSTRUCTIONS TABLE                                        *  10700001
107100*--------------------------------------------------------------*  10710001
107200     EXEC SQL INCLUDE TPOINST  END-EXEC.                          10720001
107300                                                                  10730001
107400*--------------------------------------------------------------*  10740001
107500* SPECIAL INSTRUCTIONS CODE TABLE                              *  10750001
107600*--------------------------------------------------------------*  10760001
107700     EXEC SQL INCLUDE TINSTCD  END-EXEC.                          10770001
107800                                                                  10780001
107900*--------------------------------------------------------------*  10790001
108000* PURCHASE ORDER AGREEMENT TABLE                               *  10800001
108100*--------------------------------------------------------------*  10810001
108200     EXEC SQL INCLUDE TPOAGMT  END-EXEC.                          10820001
108300                                                                  10830001
108400*--------------------------------------------------------------*  10840001
108500* INVOICE TABLE                                                *  10850001
108600*--------------------------------------------------------------*  10860001
108700     EXEC SQL INCLUDE TINVOIC  END-EXEC.                          10870001
108800                                                                  10880001
108900*--------------------------------------------------------------*  10890001
109000* AP MERCHANDISE INVOICE TABLE                                 *  10900001
109100*--------------------------------------------------------------*  10910001
109200     EXEC SQL INCLUDE TMDINVC  END-EXEC.                          10920001
109300                                                                  10930001
109400*--------------------------------------------------------------*  10940001
109500* EXPENSE INVOICE TABLE                                        *  10950001
109600*--------------------------------------------------------------*  10960001
109700     EXEC SQL INCLUDE TEXINVC  END-EXEC.                          10970001
109800                                                                  10980001
109900*--------------------------------------------------------------*  10990001
110000* AP INVOICE PAYMENT TERMS TABLE                               *  11000001
110100*--------------------------------------------------------------*  11010001
110200     EXEC SQL INCLUDE TINVCTM  END-EXEC.                          11020001
110300                                                                  11030001
110400*--------------------------------------------------------------*  11040001
110500* ALLOWANCE/CHARGE TABLE                                       *  11050001
110600*--------------------------------------------------------------*  11060001
110700     EXEC SQL INCLUDE TALCHRG  END-EXEC.                          11070001
110800                                                                  11080001
110900*--------------------------------------------------------------*  11090001
111000* XF DOMAIN LOCATION TABLE                                     *  11100001
111100*--------------------------------------------------------------*  11110001
111200     EXEC SQL INCLUDE XFT00017  END-EXEC.                         11120001
111300                                                                  11130001
111400*--------------------------------------------------------------*  11140001
111500* XF DOMAIN LOCATION ASSIGNMENT TABLE                          *  11150001
111600*--------------------------------------------------------------*  11160001
111700     EXEC SQL INCLUDE XFT00018  END-EXEC.                         11170001
111800                                                                  11180001
111900*--------------------------------------------------------------*  11190001
112000* INVOICE ITEM TABLE                                           *  11200001
112100*--------------------------------------------------------------*  11210001
112200     EXEC SQL INCLUDE TPREQIT  END-EXEC.                          11220001
112300                                                                  11230001
112400*--------------------------------------------------------------*  11240001
112500* PO STORE TABLE                                               *  11250001
112600*--------------------------------------------------------------*  11260001
112700     EXEC SQL INCLUDE TPOSTRR  END-EXEC.                          11270001
112800                                                                  11280001
112900*--------------------------------------------------------------*  11290001
113000* TABLE USED FOR EXISTENCE CHECKING                            *  11300001
113100*--------------------------------------------------------------*  11310001
113200     EXEC SQL INCLUDE SYSDUMMY  END-EXEC.                         11320001
113300                                                                  11330001
113400*--------------------------------------------------------------*  11340001
113500* DB2 AREA FOR COMMUNICATIONS                                  *  11350001
113600*--------------------------------------------------------------*  11360001
113700     EXEC SQL                                                     11370001
113800          INCLUDE  SQLCA                                          11380001
113900     END-EXEC.                                                    11390001
114000                                                                  11400001
114100*--------------------------------------------------------------*  11410001
114200* PREQIT_CSR CURSOR                                            *  11420001
114300*--------------------------------------------------------------*  11430001
114400     EXEC SQL                                                     11440001
114500          DECLARE PREQIT_CSR CURSOR FOR                           11450001
114600           SELECT PAY_REQ_LNE_QTY                                 11460001
114700                , UNT_COST_AMT                                    11470001
114800            FROM  TPREQIT                                         11480001
114900           WHERE  PAYT_REQ_SEQ_NBR = :PREQIT-PAYT-REQ-SEQ-NBR     11490001
115000     END-EXEC.                                                    11500001
115100                                                                  11510001
115200*--------------------------------------------------------------*  11520001
115300* POAGMT_CSR CURSOR                                            *  11530001
115400*--------------------------------------------------------------*  11540001
115500     EXEC SQL                                                     11550001
115600          DECLARE POAGMT_CSR CURSOR FOR                           11560001
115700           SELECT B.TYP_CDE                                       11570001
115800                , B.DISC_PCT                                      11580001
115900             FROM TPOAGMT B                                       11590001
116000            WHERE B.PO_NBR         = :INVOIC-PO-NBR               11600001
116100              AND B.VER_STATUS_CDE = 'A'                          11610001
116200              AND B.AGRMT_TYP_ID   = '5'                          11620001
116300              AND B.TYP_CDE       IN (7,8,9,10,11)                11630001
116400              AND B.DISC_PCT       > 0                            11640001
116500     END-EXEC.                                                    11650001
116600                                                                  11660001
116700*---------------------*                                           11670001
116800 LINKAGE SECTION.                                                 11680001
116900*---------------------*                                           11690001
117000 01  DFHCOMMAREA.                                                 11700001
117100     05  FILLER                         OCCURS  1 TO 4072 TIMES   11710001
117200                                        DEPENDING ON EIBCALEN.    11720001
117300         10  FILLER                     PIC X.                    11730001
117400                                                                  11740001
117500*---------------------------*                                     11750001
117600 PROCEDURE DIVISION.                                              11760001
117700*---------------------------*                                     11770001
117800*--------------------------------------------------------------*  11780001
117900* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *  11790001
118000* FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *  11800001
118100* PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *  11810001
118200*--------------------------------------------------------------*  11820001
118300 0000-MAIN-MODULE.                                                11830001
118400                                                                  11840001
118500     INITIALIZE DP030-CICS-API-FIELDS.                            11850001
118600                                                                  11860001
118700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       11870001
118800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          11880001
118900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         11890001
119000                                                                  11900001
119100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       11910001
119200                                                                  11920001
119300     MOVE LENGTH OF AP323AI        TO DP030-MAP-LENGTH (1).       11930001
119400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     11940001
119500                                                                  11950001
119600     PERFORM 0001-CALL-CICS-ARCH-API.                             11960001
119700     PERFORM 1000-CONTROL-PROCESSING                              11970001
119800                                                                  11980001
119900     IF DP020-MSG-FATAL                                           11990001
120000         SET ASC-CONF-NOT-OBT TO TRUE                             12000001
120100     END-IF.                                                      12010001
120200                                                                  12020001
120300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     12030001
120400     PERFORM 0001-CALL-CICS-ARCH-API.                             12040001
120500                                                                  12050001
120600*--------------------------------------------------------------*  12060001
120700* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *  12070001
120800* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *  12080001
120900*--------------------------------------------------------------*  12090001
121000 0001-CALL-CICS-ARCH-API.                                         12100001
121100                                                                  12110001
121210     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     12121007
121300                                     DFHCOMMAREA                  12130007
121400                                     DP030-CICS-API-FIELDS        12140007
121500                                     DP020-STANDARD-COMMAREA      12150007
121600                                     AP323AI.                     12160007
121700                                                                  12170001
121800     IF  DP030-RC-CALL-SUCCESSFUL                                 12180001
121900         CONTINUE                                                 12190001
122000     ELSE                                                         12200001
122100         SET DP013-NO-ROLLBACK                                    12210001
122200             DP013-XCTL-DISPLAY-RESTART                           12220001
122300             DP013-CICS-ABEND      TO TRUE                        12230001
122400         MOVE '0001-CALL-CICS-ARCH-API'                           12240001
122500                                   TO DP013-PARAGRAPH             12250001
122710         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O12271007
122720-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      12272007
122800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      12280001
122900         PERFORM DP013-0000-PROCESS-ABEND                         12290001
123000     END-IF.                                                      12300001
123100                                                                  12310001
123200*--------------------------------------------------------------*  12320001
123300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    *  12330001
123400* COURSE OF ACTION IS FOR THIS TRANSACTION.                    *  12340001
123500*--------------------------------------------------------------*  12350001
123600 1000-CONTROL-PROCESSING.                                         12360001
123700                                                                  12370001
123800     EVALUATE TRUE                                                12380001
123900         WHEN DP020-NEXT-ACT-INITIAL                              12390001
124000              PERFORM 1100-FIND-OBJECT-KEYS                       12400001
124100              IF  PS-ERROR                                        12410001
124200                  CONTINUE                                        12420001
124300              ELSE                                                12430001
124400                  PERFORM 4000-BUILD-INITIAL-PANEL                12440001
124500                  PERFORM 3200-RESET-ATTRIBUTES                   12450001
124600*                 IF ASC-ADD-PENDING                              12460001
124700                  IF ASC-ADD-REQUESTED                            12470001
124800                      CONTINUE                                    12480001
124900                  ELSE                                            12490001
125000                      PERFORM 3500-SAVE-SCREEN-FIELDS             12500001
125100                  END-IF                                          12510001
125200                  IF PS-NO-ERROR                                  12520001
125300                      IF  ASC-INVOICE-FOUND                       12530001
125400                          IF  ASC-DELETE-REQUESTED                12540001
125500                              SET ASC-DELETE-PENDING TO TRUE      12550001
125600**-->                     ** PRESS PF2 TO CONFIRM DELETE **       12560001
125700                              MOVE PC-TSYMSG-00354                12570001
125800                                         TO DP020-MSG-NUMBER      12580001
125900                              SET DP020-MSG-INFORMATIONAL         12590001
126000                                         TO TRUE                  12600001
126100                          END-IF                                  12610001
126200                      ELSE                                        12620001
126300                          IF ASC-INVOICE-NOT-FOUND                12630001
126400*                             IF ASC-ADD-PENDING                  12640001
126500                              IF ASC-ADD-REQUESTED                12650001
126600                                  CONTINUE                        12660001
126700                              ELSE                                12670001
126800                                  SET DP020-NEXT-ACT-APPL-ERROR   12680001
126900                                         TO TRUE                  12690001
127000                                  MOVE PC-TSYMSG-00148            12700001
127100                                         TO DP020-MSG-NUMBER      12710001
127200                                  SET DP020-MSG-INFORMATIONAL     12720001
127300                                         TO TRUE                  12730001
127400                              END-IF                              12740001
127500                          END-IF                                  12750001
127600                      END-IF                                      12760001
127700                  END-IF                                          12770001
127800              END-IF                                              12780001
127900                                                                  12790001
128000         WHEN DP020-NEXT-ACT-READ-MAP                             12800001
128100             MOVE ASC-INTER-APPL-COPY TO INTER-APPL-COMM-AREA     12810001
128200             PERFORM 2000-PROCESS-PANEL                           12820001
128300                                                                  12830001
128400         WHEN DP020-NEXT-ACT-RETURN                               12840001
128500             IF ASC-RETURN-FROM-VENDOR                            12850001
128600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12860001
128700                 PERFORM 3200-RESET-ATTRIBUTES                    12870001
128800                 SET ASC-OTHER-RETURN TO TRUE                     12880001
128900                 IF ASC-UPDATE-PENDING                            12890001
129000                     PERFORM 3500-SAVE-SCREEN-FIELDS              12900001
129100                 END-IF                                           12910001
129200             ELSE                                                 12920001
129300                 SET ASC-DUNS-NOT-ENTERED   TO TRUE               12930001
129400* UNLESS I WANT TO ADD THE DUNS TO THE AP300- COPYBOOK            12940001
129500* AND MOVE AP300-DUNS- TO ASC-KEY- , ASC-NEW-                     12950001
129600* THEN I CAN LEAVE THE SW- SET TO 'ENTERED'                       12960001
129700                 MOVE AP300-INVC-TYP-CDE                          12970001
129800                                      TO ASC-KEY-INVC-TYP-CDE     12980001
129900                 MOVE AP300-PO-NBR    TO ASC-KEY-PO-NBR           12990001
130000* JUST ADDED AN 'EI' AND AM RETURNING                             13000001
130100* NEED TO GET ALL THE WAY BACK TO SELECTION SCREEN                13010001
130200                 IF ASC-INTER-APPL-ADD                            13020001
130300                     IF ASC-EXPENSE-INVC                          13030001
130400                     AND ASC-NEW-RMIT-VND-ID = ASC-HOLD-PO-DUN-NBR13040001
130500* EXPENSE INVOICE ADDED.                                          13050001
130600*** WARNING! VENDOR NUMBER MATCHES PO VENDOR                      13060001
130700                         SET DP020-MSG-WARNING                    13070001
130800                                      TO TRUE                     13080001
130900                         MOVE PC-TSYMSG-01597                     13090001
131000                                      TO DP020-MSG-NUMBER         13100001
131100                     ELSE                                         13110001
131200* PREVIOUS INVOICE HAS BEEN ADDED SUCCESSFULLY                    13120001
131300                         SET DP020-MSG-INFORMATIONAL              13130001
131400                                      TO TRUE                     13140001
131500                         MOVE PC-TSYMSG-00949                     13150001
131600                                      TO DP020-MSG-NUMBER         13160001
131700                     END-IF                                       13170001
131800                 END-IF                                           13180001
131900* JUST RETURNED FROM DEL FUNCTION TO UPDATE, SO I NEED TO SET     13190001
132000* LOGIC BACK TO UPDATE MODE, REFRESH ATTRBS, ETC.                 13200001
132100                 IF ASC-INTER-APPL-CRIT-UPDATE                    13210001
132200                   OR ASC-INTER-APPL-LIST-UPDATE                  13220001
132300                     MOVE ASC-INT-APPL-FORMAT-IND                 13230001
132400                                     TO DP020-INT-APPL-FORMAT-IND 13240001
132500                     SET ASC-UPDATE-PENDING                       13250001
132600                         ASC-UPDATE-REQUESTED                     13260001
132700                                      TO TRUE                     13270001
132800                 END-IF                                           13280001
132900                 PERFORM 4000-BUILD-INITIAL-PANEL                 13290001
133000                 PERFORM 3200-RESET-ATTRIBUTES                    13300001
133100                 IF ASC-UPDATE-PENDING                            13310001
133200                     PERFORM 3500-SAVE-SCREEN-FIELDS              13320001
133300                     IF ASC-INVOICE-NOT-FOUND                     13330001
133400                         SET DP020-NEXT-ACT-APPL-ERROR            13340001
133500                                      TO TRUE                     13350001
133600                         MOVE PC-TSYMSG-00148                     13360001
133700                                      TO DP020-MSG-NUMBER         13370001
133800                         SET DP020-MSG-INFORMATIONAL              13380001
133900                                      TO TRUE                     13390001
134000                     END-IF                                       13400001
134100                 END-IF                                           13410001
134200             END-IF                                               13420001
134300                                                                  13430001
134400         WHEN OTHER                                               13440001
134500             SET DP013-LOGIC-ABEND TO TRUE                        13450001
134600             SET DP013-NO-ROLLBACK TO TRUE                        13460001
134700             MOVE '1000-CONTROL-PROCESSING'                       13470001
134800                                   TO DP013-PARAGRAPH             13480001
134900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   13490001
135000                                   TO DP013-MESSAGE-TEXT(1)       13500001
135100             MOVE DP020-NEXT-APPL-ACTIVITY                        13510001
135200                                   TO DP013-MESSAGE-TEXT(2)       13520001
135300             PERFORM DP013-0000-PROCESS-ABEND                     13530001
135400     END-EVALUATE.                                                13540001
135500                                                                  13550001
135600     MOVE INTER-APPL-COMM-AREA TO ASC-INTER-APPL-COPY.            13560001
135700                                                                  13570001
135800*--------------------------------------------------------------*  13580001
135900* DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   *  13590001
136000* INTER-APPLICATION FORMAT CODE.                               *  13600001
136100*--------------------------------------------------------------*  13610001
136200 1100-FIND-OBJECT-KEYS.                                           13620001
136300                                                                  13630001
136400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            13640001
136500                                                                  13650001
136600     PERFORM 1110-CHECK-AUTHORIZATIONS.                           13660001
136700                                                                  13670001
136800     MOVE AP300-INVC-ID          TO ASC-KEY-INVC-ID               13680001
136900     MOVE AP300-PO-NBR           TO ASC-KEY-PO-NBR                13690001
137000     MOVE AP300-INVC-TYP-CDE     TO ASC-KEY-INVC-TYP-CDE          13700001
137100                                                                  13710001
137200     MOVE DP020-INT-APPL-FORMAT-IND                               13720001
137300                                 TO ASC-INT-APPL-FORMAT-IND       13730001
137400     SET ASC-DUNS-NOT-ENTERED     TO TRUE                         13740001
137500     EVALUATE TRUE                                                13750001
137600                                                                  13760001
137700         WHEN ASC-INTER-APPL-CRIT-UPDATE                          13770001
137800         WHEN ASC-INTER-APPL-CRIT-DELETE                          13780001
137900             IF ASC-INTER-APPL-CRIT-UPDATE                        13790001
138000                 SET ASC-UPDATE-PENDING                           13800001
138100                     ASC-UPDATE-REQUESTED                         13810001
138200                             TO TRUE                              13820001
138300             ELSE                                                 13830001
138400                 SET ASC-DELETE-REQUESTED                         13840001
138500                             TO TRUE                              13850001
138600             END-IF                                               13860001
138700             IF ASC-KEY-INVC-ID > SPACES                          13870001
138800                 CONTINUE                                         13880001
138900             ELSE                                                 13890001
139000                 MOVE PC-TSYMSG-00849     TO DP020-MSG-NUMBER     13900001
139100                 SET DP020-MSG-FATAL                              13910001
139200                     DP020-NEXT-ACT-APPL-ERROR                    13920001
139300                     PS-ERROR        TO TRUE                      13930001
139400             END-IF                                               13940001
139500                                                                  13950001
139600         WHEN ASC-INTER-APPL-LIST-UPDATE                          13960001
139700         WHEN ASC-INTER-APPL-LIST-DELETE                          13970001
139800             IF ASC-INTER-APPL-LIST-UPDATE                        13980001
139900                 SET ASC-UPDATE-PENDING                           13990001
140000                     ASC-UPDATE-REQUESTED                         14000001
140100                             TO TRUE                              14010001
140200             ELSE                                                 14020001
140300                 SET ASC-DELETE-REQUESTED                         14030001
140400                             TO TRUE                              14040001
140500             END-IF                                               14050001
140600             SET ASC-USE-SELECTION-QUEUE                          14060001
140700                             TO TRUE                              14070001
140800             MOVE AP300-NUMBER-OF-SELECTED-ITEMS                  14080001
140900                             TO ASC-NUMBER-OF-SELECTED-ITEMS      14090001
141000             MOVE AP300-NUMBER-OF-TS-ITEMS                        14100001
141100                             TO ASC-NUMBER-OF-TS-ITEMS            14110001
141200             MOVE AP300-SEL-QUEUE-NAME                            14120001
141300                             TO ASC-SEL-QUEUE-NAME                14130001
141400* THIS CAUSES A PROBLEM COMING FROM APKCS327 PGM - APLIITEM       14140001
141500*  IN APLIITEM WE DON'T WANT USERS 'S'ELECTING A LIST ITEM        14150001
141600*                                                                 14160001
141700*            IF AP300-NUMBER-OF-SELECTED-ITEMS = +0               14170001
141800*                MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         14180001
141900*                SET DP020-MSG-FATAL                              14190001
142000*                    DP020-NEXT-ACT-APPL-ERROR                    14200001
142100*                    PS-ERROR        TO TRUE                      14210001
142200*            ELSE                                                 14220001
142300                 PERFORM 1120-PREPARE-LIST-ENTRY                  14230001
142400*            END-IF                                               14240001
142500                                                                  14250001
142600         WHEN ASC-INTER-APPL-ADD                                  14260001
142700*            SET  ASC-ADD-PENDING        TO TRUE                  14270001
142800             SET  ASC-ADD-REQUESTED      TO TRUE                  14280001
142900             SET  ASC-CONF-NOT-OBT       TO TRUE                  14290001
143000                                                                  14300001
143100         WHEN OTHER                                               14310001
143200             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             14320001
143300             SET DP020-MSG-FATAL                                  14330001
143400                 DP020-NEXT-ACT-APPL-ERROR                        14340001
143500                 PS-ERROR        TO TRUE                          14350001
143600     END-EVALUATE.                                                14360001
143700                                                                  14370001
143800*----------------------------------------------------------------*14380001
143900*  IF THE USER IS AUTHORIZED FOR FUNCTION APIMPDEL, THEN THE     *14390001
144000*  USER CAN UPDATE IMPORT MERCHANDISE INVOICES AND EXPENSE       *14400001
144100*  INVOICES FROM A STATUS VALUE OF 'OP' TO A VALUE OF 'DE' VIA   *14410001
144200*  THE PF18 KEY.                                                 *14420001
144300*----------------------------------------------------------------*14430001
144400 1110-CHECK-AUTHORIZATIONS.                                       14440001
144500                                                                  14450001
144600     SET DP008-RSRC-TYPE-FUNC        TO TRUE.                     14460001
144700     MOVE 'APIMPDEL'                 TO DP008-FUNCTION-NAME.      14470001
144800     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     14480001
144900                                                                  14490001
145000     EXEC CICS                                                    14500001
145100          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               14510001
145200               COMMAREA (DP008-SECURITY-COMMAREA)                 14520001
145300               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          14530001
145400               RESP     (PV-CICS-RESPONSE)                        14540001
145500     END-EXEC.                                                    14550001
145600                                                                  14560001
145700     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       14570001
145800         IF  DP008-CALL-SUCCESSFUL                                14580001
145900             IF  DP008-ACCESS-ALLOWED                             14590001
146000                 SET ASC-IMPORT-DEL-AUTH    TO TRUE               14600001
146100             ELSE                                                 14610001
146200                 SET ASC-NO-IMPORT-DEL-AUTH TO TRUE               14620001
146300             END-IF                                               14630001
146400         ELSE                                                     14640001
146500             SET DP013-NO-ROLLBACK                                14650001
146600                 DP013-XCTL-DISPLAY-RESTART                       14660001
146700                 DP013-CICS-ABEND  TO TRUE                        14670001
146800             MOVE '1110-CHECK-AUTHORIZATIONS'                     14680001
146900                                   TO DP013-PARAGRAPH             14690001
147000             MOVE 'INVALID RETURN CODE AUTH CALL - IMPORT DEL'    14700001
147100                                   TO DP013-MESSAGE-TEXT (1)      14710001
147200             MOVE DP008-ERROR-CODE                                14720001
147300                                   TO DP013-MESSAGE-TEXT (2)      14730001
147400             PERFORM DP013-0000-PROCESS-ABEND                     14740001
147500         END-IF                                                   14750001
147600     ELSE                                                         14760001
147700         SET DP013-NO-ROLLBACK                                    14770001
147800             DP013-XCTL-DISPLAY-RESTART                           14780001
147900             DP013-CICS-ABEND      TO TRUE                        14790001
148000         MOVE '1110-CHECK-AUTHORIZATIONS'                         14800001
148100                                   TO DP013-PARAGRAPH             14810001
148200         MOVE 'FAILED CALL OF AUTH ROUTINE - IMPORT DEL'          14820001
148300                                   TO DP013-MESSAGE-TEXT (1)      14830001
148400         PERFORM DP013-0000-PROCESS-ABEND                         14840001
148500     END-IF.                                                      14850001
148600                                                                  14860001
148700*--------------------------------------------------------------*  14870001
148800* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP   *  14880001
148900* STORAGE QUEUE PASSED FROM THE LIST.                          *  14890001
149000*--------------------------------------------------------------*  14900001
149100 1120-PREPARE-LIST-ENTRY.                                         14910001
149200                                                                  14920001
149300     MOVE AP301-MAX-ITEMS          TO ASC-SEL-SUB.                14930001
149400     MOVE ZERO                     TO ASC-SEL-ITEM.               14940001
149500     PERFORM 2110-GET-NEXT-RECORD.                                14950001
149600                                                                  14960001
149700*--------------------------------------------------------------*  14970001
149800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA *  14980001
149900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT *  14990001
150000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST*  15000001
150100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID    *  15010001
150200* FUNCTION KEYS CAN GET THIS FAR.                              *  15020001
150300*--------------------------------------------------------------*  15030001
150400 2000-PROCESS-PANEL.                                              15040001
150500                                                                  15050001
150600     EVALUATE TRUE                                                15060001
150700         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    15070001
150800             EVALUATE TRUE                                        15080001
150900                 WHEN ASC-DELETE-SUCCESSFUL                       15090001
151000                     MOVE PC-TSYMSG-00116                         15100001
151100                                       TO DP020-MSG-NUMBER        15110001
151200                     SET DP020-MSG-FATAL                          15120001
151300                         PS-ERROR      TO TRUE                    15130001
151400                     PERFORM 3200-RESET-ATTRIBUTES                15140001
151500                                                                  15150001
151600                 WHEN ASC-DELETE-PENDING                          15160001
151700                     SET ASC-INVOICE-NOT-FOUND TO TRUE            15170001
151800                     PERFORM 6500-SELECT-CURR-INVC-STATUS         15180001
151900                     IF ASC-INVOICE-FOUND                         15190001
152000                        IF PV-INVOIC-TYP-CDE = 'WO'               15200001
152100                           SET DP020-MSG-FATAL                    15210001
152200                               DP030-OVERRIDE-GO                  15220001
152300                               PS-ERROR         TO TRUE           15230001
152400                           MOVE PC-TSYMSG-01518 TO                15240001
152500                                          DP020-MSG-NUMBER        15250001
152600                        ELSE                                      15260001
152700                           IF PV-INVOIC-STATUS-CDE = 'PD' OR 'DE' 15270001
152800                                                  OR 'RL' OR 'OP' 15280001
152900                                                  OR 'PJ'         15290001
153000                              SET DP020-MSG-FATAL                 15300001
153100                                  DP030-OVERRIDE-GO               15310001
153200                                  PS-ERROR         TO TRUE        15320001
153300                              MOVE  PC-TSYMSG-00170 TO            15330015
153400                                                DP020-MSG-NUMBER  15340001
153500                           END-IF                                 15350001
153600                        END-IF                                    15360001
153700                     END-IF                                       15370001
153800                     IF PS-NO-ERROR                               15380001
153900                       SET DP030-CONTINUE-GO                      15390001
154000                                         TO TRUE                  15400001
154100                       PERFORM 7000-DELETE-PROCESS                15410001
154200                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       15420001
154300                       SET ASC-DELETE-SUCCESSFUL TO TRUE          15430001
154400                     END-IF                                       15440001
154500                                                                  15450001
154600                 WHEN (ASC-NO-CHANGES-ALLOWED AND                 15460001
154700                       ASC-DELETE-REQUESTED)                      15470001
154800**-->                ** CAN'T DO IT FOR THIS STATUS  **           15480001
154900                     MOVE PC-TSYMSG-00170                         15490001
155000                                       TO DP020-MSG-NUMBER        15500001
155100                     SET DP020-MSG-FATAL                          15510001
155200                         PS-ERROR      TO TRUE                    15520001
155300                     PERFORM 3200-RESET-ATTRIBUTES                15530001
155400                                                                  15540001
155500                 WHEN OTHER                                       15550001
155600**-->                ** DELETE OR ADD MUST BE REQUESTED BEFORE**  15560001
155700**-->                ** CONFIRM                                   15570001
155800*                    MOVE PC-TSYMSG-00118                         15580001
155900                     MOVE PC-TSYMSG-01701                         15590001
156000                                       TO DP020-MSG-NUMBER        15600001
156100                     SET DP020-MSG-FATAL                          15610001
156200                         PS-ERROR      TO TRUE                    15620001
156300                     PERFORM 3200-RESET-ATTRIBUTES                15630001
156400             END-EVALUATE                                         15640001
156500                                                                  15650001
156600         WHEN DP020-SRC-AID = DP016-CLEAR                         15660001
156700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15670001
156800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15680001
156900                                                                  15690001
157000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    15700001
157100*            -- THE REASON THAT 1100- IS PERFORMED ON A REFRESH   15710001
157200*            -- IS BECAUSE THE PROGRAM MAY HAVE ORIGINALLY BEEN   15720001
157300*            -- INVOKED IN UPDATE MODE, THEN SWITCHED TO DELETE   15730001
157400*            -- MODE.  1100- LOOKS AT INTER-APPL-FORMAT-IND TO    15740001
157500*            -- DETERMINE WHICH MODE IT S/B.  ALSO, THIS ASSURES  15750001
157600*            -- THAT THE PO/INVC THAT WERE ORIGINALLY SUPPLIED ARE15760001
157700*            -- USED FOR THE REFRESH.                             15770001
157800             MOVE ASC-INTER-APPL-COPY TO INTER-APPL-COMM-AREA     15780001
157900             PERFORM 1100-FIND-OBJECT-KEYS                        15790001
158000             IF  PS-ERROR                                         15800001
158100                 CONTINUE                                         15810001
158200             ELSE                                                 15820001
158300                 PERFORM 4000-BUILD-INITIAL-PANEL                 15830001
158400                 PERFORM 3200-RESET-ATTRIBUTES                    15840001
158500*                IF ASC-ADD-PENDING                               15850001
158600                 IF ASC-ADD-REQUESTED                             15860001
158700                     CONTINUE                                     15870001
158800                 ELSE                                             15880001
158900                     PERFORM 3500-SAVE-SCREEN-FIELDS              15890001
159000                 END-IF                                           15900001
159100                 IF  ASC-INVOICE-FOUND                            15910001
159200                     IF  ASC-DELETE-REQUESTED                     15920001
159300                         SET ASC-DELETE-PENDING TO TRUE           15930001
159400*-->                     ** PRESS PF2 TO CONFIRM DELETE **        15940001
159500                         MOVE PC-TSYMSG-00354                     15950001
159600                                    TO DP020-MSG-NUMBER           15960001
159700                         SET DP020-MSG-INFORMATIONAL              15970001
159800                                    TO TRUE                       15980001
159900                     END-IF                                       15990001
160000                 ELSE                                             16000001
160100                     IF ASC-INVOICE-NOT-FOUND                     16010001
160200*                        IF ASC-ADD-PENDING                       16020001
160300                         IF ASC-ADD-REQUESTED                     16030001
160400                             CONTINUE                             16040001
160500                         ELSE                                     16050001
160600                             SET DP020-NEXT-ACT-APPL-ERROR        16060001
160700                                        TO TRUE                   16070001
160800                             MOVE PC-TSYMSG-00148                 16080001
160900                                        TO DP020-MSG-NUMBER       16090001
161000                             SET DP020-MSG-INFORMATIONAL          16100001
161100                                        TO TRUE                   16110001
161200                         END-IF                                   16120001
161300                     END-IF                                       16130001
161400                 END-IF                                           16140001
161500             END-IF                                               16150001
161600                                                                  16160001
161700             PERFORM 4000-BUILD-INITIAL-PANEL                     16170001
161800             PERFORM 3200-RESET-ATTRIBUTES                        16180001
161900             PERFORM 3500-SAVE-SCREEN-FIELDS                      16190001
162000                                                                  16200001
162100         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             16210001
162200             IF  ASC-USE-SELECTION-QUEUE                          16220001
162300                 PERFORM 2110-GET-NEXT-RECORD                     16230001
162400                 PERFORM 4000-BUILD-INITIAL-PANEL                 16240001
162500                 PERFORM 3200-RESET-ATTRIBUTES                    16250001
162600                 PERFORM 3500-SAVE-SCREEN-FIELDS                  16260001
162700             ELSE                                                 16270001
162800*                --- BOTTOM OF LIST ---                           16280001
162900                 MOVE PC-TSYMSG-00070                             16290001
163000                                   TO DP020-MSG-NUMBER            16300001
163100                 SET DP020-MSG-INFORMATIONAL                      16310001
163200                                   TO TRUE                        16320001
163300             END-IF                                               16330001
163400                                                                  16340001
163500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             16350001
163600             IF  ASC-USE-SELECTION-QUEUE                          16360001
163700                 PERFORM 2120-GET-PREV-RECORD                     16370001
163800                 PERFORM 4000-BUILD-INITIAL-PANEL                 16380001
163900                 PERFORM 3200-RESET-ATTRIBUTES                    16390001
164000                 PERFORM 3500-SAVE-SCREEN-FIELDS                  16400001
164100             ELSE                                                 16410001
164200*                --- TOP OF LIST ---                              16420001
164300                 MOVE PC-TSYMSG-00069                             16430001
164400                                   TO DP020-MSG-NUMBER            16440001
164500                 SET DP020-MSG-INFORMATIONAL                      16450001
164600                                   TO TRUE                        16460001
164700             END-IF                                               16470001
164800                                                                  16480001
164900         WHEN OTHER                                               16490001
165000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 16500001
165100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   16510001
165200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16520001
165300             IF  PS-NO-ERROR OR                                   16530001
165400                 DP020-MSG-WARNING                                16540001
165500                 SET DP030-CONTINUE-GO                            16550001
165600                                   TO TRUE                        16560001
165700                 PERFORM 2100-CHECK-FUNCTION-KEY                  16570001
165800             ELSE                                                 16580001
165900                 SET DP030-OVERRIDE-GO                            16590001
166000                                   TO TRUE                        16600001
166100             END-IF                                               16610001
166200     END-EVALUATE.                                                16620001
166300                                                                  16630001
166400*--------------------------------------------------------------*  16640001
166500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     *  16650001
166600* FIRST. NOTE THAT INVALID FUNCTIONS KEYS WILL NOT BE RETURNED *  16660001
166700* FROM THE CICS ARCHITECTURE API.                              *  16670001
166800*--------------------------------------------------------------*  16680001
166900 2100-CHECK-FUNCTION-KEY.                                         16690001
167000                                                                  16700001
167100     EVALUATE TRUE                                                16710001
167200         WHEN DP020-SRC-AID = DP016-ENTER                         16720001
167300             CONTINUE                                             16730001
167400                                                                  16740001
167500         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID) OR              16750001
167600              DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR           16760001
167700              DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              16770001
167800             IF ASC-ADD-REQUESTED AND                             16780001
167900                ASC-CONF-REQ AND                                  16790001
168000                ASC-IMPORT-PO                                     16800001
168100                 SET DP030-OVERRIDE-GO TO TRUE                    16810001
168200             END-IF                                               16820001
168300             IF ASC-ADD-REQUESTED AND                             16830001
168400                ASC-CONF-OBT AND                                  16840001
168500                ASC-IMPORT-PO AND                                 16850001
168600                NOT ASC-ADD-PENDING                               16860001
168700                 SET ASC-ADD-PENDING TO TRUE                      16870001
168800             END-IF                                               16880001
168900                                                                  16890001
169000             PERFORM 2105-CONTINUE-LOCAL-GO-CHECKS                16900001
169100                     THRU 2105-EXIT                               16910001
169200                                                                  16920001
169300             MOVE ASC-NEW-PO-NBR       TO AP300-PO-NBR            16930001
169400             MOVE ASC-NEW-INVC-ID      TO AP300-INVC-ID           16940001
169500             MOVE ASC-NEW-INVC-STATUS  TO AP300-INVC-STATUS       16950001
169600             MOVE ASC-NEW-STR-NBR      TO AP300-STORE-NBR         16960001
169700             MOVE ASC-NEW-NET-INVC-AMT TO AP300-NET-INVC-AMT      16970001
169800             MOVE ASC-NEW-DC-NBR       TO AP300-DC-NBR            16980001
169900                                                                  16990001
170000         WHEN OTHER                                               17000001
170100             SET DP013-NO-ROLLBACK                                17010001
170200                 DP013-XCTL-DISPLAY-RESTART                       17020001
170300                 DP013-CICS-ABEND  TO TRUE                        17030001
170400             MOVE '2100-CHECK-FUNCTION-KEY'                       17040001
170500                                   TO DP013-PARAGRAPH             17050001
170600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      17060001
170700                                   TO DP013-MESSAGE-TEXT (1)      17070001
170800             PERFORM DP013-0000-PROCESS-ABEND                     17080001
170900     END-EVALUATE.                                                17090001
171000                                                                  17100001
171100*--------------------------------------------------------------*  17110001
171200* CONTINUE WITH CHECKS/EDITS                                   *  17120001
171300*--------------------------------------------------------------*  17130001
171400 2105-CONTINUE-LOCAL-GO-CHECKS.                                   17140001
171500                                                                  17150001
171600     IF DP020-SRC-AID = DP016-PF24                                17160001
171700         SET ASC-RETURN-FROM-VENDOR TO TRUE                       17170001
171800         GO TO 2105-EXIT.                                         17180001
171900                                                                  17190001
172000     IF DP020-SRC-AID = DP016-PF17                                17200001
172100**-->   CAME IN IN UPDATE MODE, BUT NOW REQUESTING                17210001
172200***     PF17 UPDATES EDI ORIGINATED EXPENSE INVOICES BETWEEN      17220001
172300***          STATUS 'PR' AND 'EN'                                 17230001
172400        PERFORM 6500-SELECT-CURR-INVC-STATUS                      17240001
172500        IF PV-INVOIC-TYP-CDE = 'EI'                               17250001
172600           IF PV-INVOIC-ENTR-MTHD-CDE = 'EE'                      17260001
172700              IF PV-INVOIC-STATUS-CDE = 'PR' OR 'EN'              17270001
172800                 PERFORM 6175-TOGGLE-PENDING-STATUS               17280001
172900                 MOVE PV-INVOIC-STATUS-CDE                        17290001
173000                              TO ASC-KEY-INVC-STATUS              17300001
173100                                 ASC-NEW-INVC-STATUS              17310001
173200              ELSE                                                17320001
173300***              THIS FUNCTION IS ONLY VALID FOR INVOICES         17330001
173400***              WITH STATUS 'PR' OR 'EN'                         17340001
173500                 MOVE PC-TSYMSG-02696                             17350001
173600                              TO DP020-MSG-NUMBER                 17360001
173700                 SET DP020-MSG-FATAL                              17370001
173800                     DP030-OVERRIDE-GO                            17380001
173900                     PS-ERROR TO TRUE                             17390001
174000              END-IF                                              17400001
174100           ELSE                                                   17410001
174200***           THIS FUNCTION IS ONLY VALID FOR EXPENSE INVOICES    17420001
174300***           ENTERED VIA EDI                                     17430001
174400              MOVE PC-TSYMSG-02695 TO DP020-MSG-NUMBER            17440001
174500              SET DP020-MSG-FATAL                                 17450001
174600                  DP030-OVERRIDE-GO                               17460001
174700                  PS-ERROR         TO TRUE                        17470001
174800           END-IF                                                 17480001
174900        ELSE                                                      17490001
175000***        THIS IS NOT A VALID INVOICE TYPE FOR THE               17500001
175100***        REQUESTED FUNCTION                                     17510001
175200           MOVE PC-TSYMSG-01565 TO DP020-MSG-NUMBER               17520001
175300           SET DP020-MSG-FATAL                                    17530001
175400               DP030-OVERRIDE-GO                                  17540001
175500               PS-ERROR         TO TRUE                           17550001
175600        END-IF                                                    17560001
175700     END-IF.                                                      17570001
175800                                                                  17580001
175900     IF DP020-SRC-AID = DP016-PF18                                17590001
176000        IF ASC-IMPORT-DEL-AUTH                                    17600001
176100**-->      CAME IN UPDATE MODE, BUT NOW REQUESTING                17610001
176200***        PF18 UPDATES IMPORT MI & EI STATUS FROM                17620001
176300***        'OP' OR 'PJ' TO 'DE' IF USER IS AUTHORIZED TO DO THIS  17630001
176400           PERFORM 6510-SELECT-PO-TYP-CDE                         17640001
176500           IF PV-PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'         17650001
176600              PERFORM 6500-SELECT-CURR-INVC-STATUS                17660001
176700              IF PV-INVOIC-TYP-CDE = 'MI' OR 'EI'                 17670001
176800*PRB42514 START                                                   17680001
176900                 IF (PV-INVOIC-STATUS-CDE = 'OP' OR 'PJ')         17690001
177000                    AND PV-INVOIC-AP-PRC-CDE NOT = 'J'            17700001
177100*PRB42514 END                                                     17710001
177200                    PERFORM 6180-UPDATE-IMPINVC-TO-DE             17720001
177300                    MOVE 'DE'    TO ASC-KEY-INVC-STATUS           17730001
177400                                    ASC-NEW-INVC-STATUS           17740001
177500                 ELSE                                             17750001
177600***                 THIS FUNCTION IS ONLY VALID FOR IMPORT        17760001
177700***                 INVOICES THAT ARE NOT JOURNALIZED             17770001
177800                    MOVE PC-TSYMSG-03683                          17780001
177900                                 TO DP020-MSG-NUMBER              17790001
178000                    SET DP020-MSG-FATAL                           17800001
178100                        DP030-OVERRIDE-GO                         17810001
178200                        PS-ERROR TO TRUE                          17820001
178300                 END-IF                                           17830001
178400              ELSE                                                17840001
178500***              THIS IS NOT A VALID INVOICE TYPE FOR THE         17850001
178600***              REQUESTED FUNCTION                               17860001
178700                 MOVE PC-TSYMSG-01565 TO DP020-MSG-NUMBER         17870001
178800                 SET DP020-MSG-FATAL                              17880001
178900                     DP030-OVERRIDE-GO                            17890001
179000                     PS-ERROR         TO TRUE                     17900001
179100              END-IF                                              17910001
179200           ELSE                                                   17920001
179300***           THIS FUNCTION IS ONLY VALID FOR IMPORT              17930001
179400***           'MI'S AND 'EI'S                                     17940001
179500              MOVE PC-TSYMSG-03682 TO DP020-MSG-NUMBER            17950001
179600              SET DP020-MSG-FATAL                                 17960001
179700                  DP030-OVERRIDE-GO                               17970001
179800                  PS-ERROR         TO TRUE                        17980001
179900           END-IF                                                 17990001
180000        ELSE                                                      18000001
180100***        YOU ARE NOT AUTHORIZED TO PERFORM THIS FUNCTION        18010001
180200           MOVE PC-TSYMSG-03684 TO DP020-MSG-NUMBER               18020001
180300           SET DP020-MSG-FATAL                                    18030001
180400               DP030-OVERRIDE-GO                                  18040001
180500               PS-ERROR         TO TRUE                           18050001
180600        END-IF                                                    18060001
180700     END-IF.                                                      18070001
180800                                                                  18080001
180900     IF DP020-SRC-AID = DP016-PF16                                18090001
181000**-->    ** CAME IN IN UPDATE MODE, BUT NOW REQUESTING A DELETE   18100001
181100         IF ASC-NEW-INVC-STATUS = 'EN' OR 'ER' OR 'OB' OR 'IB'    18110001
181200            OR 'RC'                                               18120001
181300                                                                  18130001
181400             MOVE ZEROS TO PV-DB2-COUNT                           18140001
181500             IF ASC-KEY-INVC-TYP-CDE = 'RI'                       18150001
181600                 PERFORM 8800-CHECK-IF-PROCESSED                  18160001
181700             END-IF                                               18170001
181800                                                                  18180001
181900             IF PV-DB2-COUNT > 0  OR ASC-KEY-INVC-TYP-CDE = 'WO'  18190001
182000                 SET ASC-NO-CHANGES-ALLOWED                       18200001
182100                     ASC-DELETE-REQUESTED   TO TRUE               18210001
182200                 IF ASC-KEY-INVC-TYP-CDE = 'WO'                   18220001
182300                    MOVE PC-TSYMSG-01518 TO                       18230001
182400                         DP020-MSG-NUMBER                         18240001
182500                 ELSE                                             18250001
182600                    MOVE PC-TSYMSG-00961 TO                       18260001
182700                         DP020-MSG-NUMBER                         18270001
182800                 END-IF                                           18280001
182900                 SET DP020-MSG-FATAL                              18290001
183000                     DP030-OVERRIDE-GO                            18300001
183100                     PS-ERROR         TO TRUE                     18310001
183200             ELSE                                                 18320001
183300                 SET ASC-DELETE-PENDING                           18330001
183400                     ASC-DELETE-REQUESTED  TO TRUE                18340001
183500                 MOVE PC-TSYMSG-00354                             18350001
183600                                 TO DP020-MSG-NUMBER              18360001
183700                 SET DP020-MSG-INFORMATIONAL                      18370001
183800                                 TO TRUE                          18380001
183900             END-IF                                               18390001
184000         ELSE                                                     18400001
184100             SET ASC-NO-CHANGES-ALLOWED                           18410001
184200                 ASC-DELETE-REQUESTED   TO TRUE                   18420001
184300             IF ASC-KEY-INVC-TYP-CDE = 'WO'                       18430001
184400                MOVE PC-TSYMSG-01518 TO  DP020-MSG-NUMBER         18440001
184500             ELSE                                                 18450001
184600                MOVE PC-TSYMSG-00170 TO  DP020-MSG-NUMBER         18460001
184700             END-IF                                               18470001
184800             SET DP020-MSG-FATAL                                  18480001
184900                 DP030-OVERRIDE-GO                                18490001
185000                 PS-ERROR         TO TRUE                         18500001
185100         END-IF                                                   18510001
185200     END-IF.                                                      18520001
185300                                                                  18530001
185400     IF ASC-ADD-PENDING                                           18540001
185500         PERFORM 8000-ADD-INVOICE                                 18550001
185600         MOVE ASC-NEW-PO-NBR TO AP300-PO-NBR                      18560001
185700         SET DP020-MSG-INFORMATIONAL TO TRUE                      18570001
185800         IF ASC-KEY-INVC-STATUS = 'OB'                            18580001
185900             INITIALIZE ASC-KEY-FIELDS                            18590001
186000*            --   'ADD SUCCESSFUL - ADJUSTMENTS REQUIRED'         18600001
186100*            --   SEND 'EM GO TO THE ALLW/CHRG SCREEN             18610001
186200             MOVE PC-TSYMSG-00933  TO DP020-MSG-NUMBER            18620001
186300         ELSE                                                     18630001
186400             IF DP020-SRC-AID = DP016-PF22                        18640001
186500                 INITIALIZE ASC-KEY-FIELDS                        18650001
186600*                --   'ADD SUCCESSFUL'                            18660001
186700*                --   SEND 'EM GO TO THE ALLW/CHRG SCREEN         18670001
186800                 MOVE PC-TSYMSG-00949  TO DP020-MSG-NUMBER        18680001
186900             ELSE                                                 18690001
187000*                --    ADD SUCCESSFUL (BUT KEEP IT HERE...)       18700001
187100                 INITIALIZE ASC-KEY-FIELDS                        18710001
187200                 SET ASC-DUNS-NOT-ENTERED TO TRUE                 18720001
187300                 MOVE AP300-PO-NBR     TO ASC-KEY-PO-NBR          18730001
187400                 MOVE AP300-INVC-TYP-CDE                          18740001
187500                                       TO ASC-KEY-INVC-TYP-CDE    18750001
187600                 PERFORM 4000-BUILD-INITIAL-PANEL                 18760001
187700                 SET DP030-OVERRIDE-GO TO TRUE                    18770001
187800                 IF DP020-MSG-NUMBER NOT > ZERO                   18780001
187900                     MOVE PC-TSYMSG-00949  TO DP020-MSG-NUMBER    18790001
188000                 END-IF                                           18800001
188100             END-IF                                               18810001
188200         END-IF                                                   18820001
188300     END-IF.                                                      18830001
188400                                                                  18840001
188500     IF ASC-UPDATE-PENDING                                        18850001
188600         PERFORM 3600-CHECK-IF-FIELDS-CHANGED                     18860001
188700         IF  ASC-FIELDS-MODIFIED                                  18870001
188800             SET ASC-INVOICE-NOT-FOUND TO TRUE                    18880001
188900             PERFORM 6500-SELECT-CURR-INVC-STATUS                 18890001
189000             IF ASC-INVOICE-FOUND                                 18900001
189100                IF PV-INVOIC-TYP-CDE = 'WO'                       18910001
189200                   MOVE PC-TSYMSG-01517 TO DP020-MSG-NUMBER       18920001
189300                   SET DP020-MSG-FATAL                            18930001
189400                       DP030-OVERRIDE-GO                          18940001
189500                       PS-ERROR         TO TRUE                   18950001
189600                ELSE                                              18960001
189700                   IF (PV-INVOIC-STATUS-CDE = 'PD' OR 'DE' OR     18970001
189800                                      'PJ' OR 'RL' OR 'OP')       18980001
189900                      MOVE PC-TSYMSG-00170 TO DP020-MSG-NUMBER    18990001
190000                      SET DP020-MSG-FATAL                         19000001
190100                          DP030-OVERRIDE-GO                       19010001
190200                          PS-ERROR         TO TRUE                19020001
190300                   END-IF                                         19030001
190400                END-IF                                            19040001
190500             END-IF                                               19050001
190600             IF PS-NO-ERROR                                       19060001
190700                PERFORM 6000-UPDATE-DATABASE                      19070001
190800                MOVE ASC-NEW-PO-NBR       TO ASC-KEY-PO-NBR       19080001
190900                MOVE ASC-NEW-INVC-ID      TO ASC-KEY-INVC-ID      19090001
191000                PERFORM 3500-SAVE-SCREEN-FIELDS                   19100001
191100                IF DP020-SRC-AID = DP016-PF22                     19110001
191200*                --  UPDATE(S) SUCCESSFUL                         19120001
191300*                --  SEND 'EM GO TO THE ALLW/CHRG SCREEN          19130001
191400                    MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER     19140001
191500                ELSE                                              19150001
191600*                --UPDATE SUCCESSFUL (BUT KEEP IT HERE...)        19160001
191700                    SET DP030-OVERRIDE-GO TO TRUE                 19170001
191800                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN          19180001
191900                END-IF                                            19190001
192000             END-IF                                               19200001
192100         ELSE                                                     19210001
192200             IF DP020-SRC-AID = DP016-PF22                        19220001
192300*                --  SEND 'EM GO TO THE ALLW/CHRG SCREEN          19230001
192400                 CONTINUE                                         19240001
192500             ELSE                                                 19250001
192600                 SET DP030-OVERRIDE-GO TO TRUE                    19260001
192700                 MOVE PC-TSYMSG-00046                             19270001
192800                                 TO DP020-MSG-NUMBER              19280001
192900                 SET DP020-MSG-INFORMATIONAL                      19290001
193000                                 TO TRUE                          19300001
193100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             19310001
193200             END-IF                                               19320001
193300         END-IF                                                   19330001
193400     ELSE                                                         19340001
193500         IF ASC-UPDATE-REQUESTED AND                              19350001
193600            ASC-NO-CHANGES-ALLOWED                                19360001
193700            EVALUATE TRUE                                         19370001
193800                WHEN ASC-STAT-UPDATED-TO-DE-SW = 'Y'              19380001
193900                  MOVE PC-TSYMSG-03686                            19390001
194000                                   TO DP020-MSG-NUMBER            19400001
194100                  SET DP020-MSG-INFORMATIONAL TO TRUE             19410001
194200                WHEN  ASC-ENTR-MTHD-CDE = 'ED'                    19420001
194300                  MOVE PC-TSYMSG-00851                            19430001
194400                                   TO DP020-MSG-NUMBER            19440001
194500                  SET DP020-MSG-FATAL         TO TRUE             19450001
194600                WHEN ASC-KEY-INVC-TYP-CDE = 'RI'                  19460001
194700                  MOVE PC-TSYMSG-00970                            19470001
194800                                   TO DP020-MSG-NUMBER            19480001
194900                  SET DP020-MSG-FATAL         TO TRUE             19490001
195000                WHEN ASC-KEY-INVC-TYP-CDE = 'WO'                  19500001
195100                  MOVE PC-TSYMSG-01517                            19510001
195200                                   TO DP020-MSG-NUMBER            19520001
195300                  SET DP020-MSG-FATAL         TO TRUE             19530001
195400                WHEN OTHER                                        19540001
195500                  MOVE PC-TSYMSG-00170                            19550001
195600                                   TO DP020-MSG-NUMBER            19560001
195700                  SET DP020-MSG-FATAL         TO TRUE             19570001
195800            END-EVALUATE                                          19580001
195900*            SET DP020-MSG-FATAL                                  19590001
196000             SET DP030-OVERRIDE-GO                                19600001
196100                 PS-ERROR         TO TRUE                         19610001
196200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19620001
196300         END-IF                                                   19630001
196400     END-IF.                                                      19640001
196500                                                                  19650001
196600     PERFORM 3200-RESET-ATTRIBUTES.                               19660001
196700                                                                  19670001
196800*--------------------------------------------------------------*  19680001
196900* EXIT THE ROUTINE                                             *  19690001
197000*--------------------------------------------------------------*  19700001
197100 2105-EXIT.                                                       19710001
197200     EXIT.                                                        19720001
197300                                                                  19730001
197400*--------------------------------------------------------------*  19740001
197500* OBTAIN THE NEXT RECORD                                       *  19750001
197600*--------------------------------------------------------------*  19760001
197700 2110-GET-NEXT-RECORD.                                            19770001
197800                                                                  19780001
197900     ADD +1                        TO ASC-SEL-SUB.                19790001
198000     IF  ASC-SEL-SUB > AP301-MAX-ITEMS                            19800001
198100         ADD +1                    TO ASC-SEL-ITEM                19810001
198200         MOVE +1                   TO ASC-SEL-SUB                 19820001
198300     END-IF.                                                      19830001
198400                                                                  19840001
198500* FIND OUT WHAT THE ORIGINIAL LIST ACTION REQUESTED WAS. CONTINUE 19850001
198600*  THAT ACTION. THIS IS A NEW PO/INVC. COMBINATION.               19860001
198700                                                                  19870001
198800     EVALUATE TRUE                                                19880001
198900                                                                  19890001
199000         WHEN ASC-INTER-APPL-LIST-UPDATE                          19900001
199100         WHEN ASC-INTER-APPL-LIST-DELETE                          19910001
199200             IF ASC-INTER-APPL-LIST-UPDATE                        19920001
199300                 SET ASC-UPDATE-PENDING                           19930001
199400                     ASC-UPDATE-REQUESTED                         19940001
199500                             TO TRUE                              19950001
199600             ELSE                                                 19960001
199700                 SET ASC-DELETE-REQUESTED                         19970001
199800                             TO TRUE                              19980001
199900             END-IF                                               19990001
200000                                                                  20000001
200100         WHEN OTHER                                               20010001
200200             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             20020001
200300             SET DP020-MSG-FATAL                                  20030001
200400                 DP020-NEXT-ACT-APPL-ERROR                        20040001
200500                 PS-ERROR        TO TRUE                          20050001
200600     END-EVALUATE.                                                20060001
200700                                                                  20070001
200800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                20080001
200900         PERFORM 9100-READ-SEL-QUEUE                              20090001
201000         IF  AP301-ITEM (ASC-SEL-SUB) > ZERO                      20100001
201100             MOVE AP301-PO-NBR      (ASC-SEL-SUB)                 20110001
201200                                   TO ASC-KEY-PO-NBR              20120001
201300             MOVE AP301-INVC-ID  (ASC-SEL-SUB)                    20130001
201400                                   TO ASC-KEY-INVC-ID             20140001
201500             MOVE SPACE            TO ASC-KEY-INVC-TYP-CDE        20150001
201600*-->         IT'S POSSIBLE THAT THE USER DID AN UPDATE, DID A     20160001
201700*-->         "PREV", AND DID A NEXT TO RE-DISPLAY THIS RECORD.    20170001
201800*-->         IF SO, AP301-ACTION-SW WOULD EQUAL 'U', AND SHOULD   20180001
201900*-->         STAY THAT WAY.  THAT WAY, WHEN PF3'ING BACK TO THE   20190001
202000*-->         LIST, "UPD" WILL SHOW UP BESIDE THE UPDATED REC.     20200001
202100             IF AP301-ACTION-SW (ASC-SEL-SUB) > SPACES            20210001
202200                 CONTINUE                                         20220001
202300             ELSE                                                 20230001
202400                 SET AP301-INQ (ASC-SEL-SUB)                      20240001
202500                                       TO TRUE                    20250001
202600                 PERFORM 9200-REWRITE-LIST-QUEUE                  20260001
202700             END-IF                                               20270001
202800         ELSE                                                     20280001
202900             SUBTRACT +1 FROM ASC-SEL-SUB                         20290001
203000*            --- BOTTOM OF LIST ---                               20300001
203100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            20310001
203200             SET DP020-MSG-INFORMATIONAL                          20320001
203300                                   TO TRUE                        20330001
203400         END-IF                                                   20340001
203500     ELSE                                                         20350001
203600         SUBTRACT +1 FROM ASC-SEL-ITEM                            20360001
203700         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 20370001
203800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            20380001
203900         SET DP020-MSG-INFORMATIONAL                              20390001
204000                                   TO TRUE                        20400001
204100     END-IF.                                                      20410001
204200                                                                  20420001
204300*--------------------------------------------------------------*  20430001
204400* OBTAIN THE PREVIOUS RECORD                                   *  20440001
204500*--------------------------------------------------------------*  20450001
204600 2120-GET-PREV-RECORD.                                            20460001
204700                                                                  20470001
204800     SUBTRACT +1 FROM ASC-SEL-SUB.                                20480001
204900     IF  ASC-SEL-SUB < +1                                         20490001
205000         SUBTRACT +1 FROM ASC-SEL-ITEM                            20500001
205100         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 20510001
205200     END-IF.                                                      20520001
205300                                                                  20530001
205400* FIND OUT WHAT THE ORIGINIAL LIST ACTION REQUESTED WAS. CONTINUE 20540001
205500*  THAT ACTION. THIS IS A NEW PO/INVC. COMBINATION.               20550001
205600                                                                  20560001
205700     EVALUATE TRUE                                                20570001
205800                                                                  20580001
205900         WHEN ASC-INTER-APPL-LIST-UPDATE                          20590001
206000         WHEN ASC-INTER-APPL-LIST-DELETE                          20600001
206100             IF ASC-INTER-APPL-LIST-UPDATE                        20610001
206200                 SET ASC-UPDATE-PENDING                           20620001
206300                     ASC-UPDATE-REQUESTED                         20630001
206400                             TO TRUE                              20640001
206500             ELSE                                                 20650001
206600                 SET ASC-DELETE-REQUESTED                         20660001
206700                             TO TRUE                              20670001
206800             END-IF                                               20680001
206900                                                                  20690001
207000         WHEN OTHER                                               20700001
207100             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             20710001
207200             SET DP020-MSG-FATAL                                  20720001
207300                 DP020-NEXT-ACT-APPL-ERROR                        20730001
207400                 PS-ERROR        TO TRUE                          20740001
207500     END-EVALUATE.                                                20750001
207600                                                                  20760001
207700     IF  ASC-SEL-ITEM > ZERO                                      20770001
207800         PERFORM 9100-READ-SEL-QUEUE                              20780001
207900         MOVE AP301-PO-NBR      (ASC-SEL-SUB)                     20790001
208000                               TO ASC-KEY-PO-NBR                  20800001
208100         MOVE AP301-INVC-ID  (ASC-SEL-SUB)                        20810001
208200                               TO ASC-KEY-INVC-ID                 20820001
208300         MOVE SPACE              TO ASC-KEY-INVC-TYP-CDE          20830001
208400     ELSE                                                         20840001
208500         MOVE +1                 TO ASC-SEL-ITEM                  20850001
208600                                    ASC-SEL-SUB                   20860001
208700*        --- TOP OF LIST ---                                      20870001
208800         MOVE PC-TSYMSG-00069    TO DP020-MSG-NUMBER              20880001
208900         SET DP020-MSG-INFORMATIONAL                              20890001
209000                                 TO TRUE                          20900001
209100     END-IF.                                                      20910001
209200                                                                  20920001
209300*--------------------------------------------------------------*  20930001
209400* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    *  20940001
209500* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. *  20950001
209600*--------------------------------------------------------------*  20960001
209700 2200-MOVE-SCREEN-TO-COMMAREA.                                    20970001
209800                                                                  20980001
209900*  THE DUNS-ENTERED SWITCH INSURES THAT DEFAULT DATA DOESN'T      20990001
210000*  OVERLAY KEYED DATA. WHEN A NEW PO OR INVOICE NUMBER IS         21000001
210100*  KEYED, THE PO REMIT-TO-VENDOR-NBR IS RETREIVED. THE OLD LOGIC  21010001
210200*  WOULD HAVE USED THAT VALUE, EVEN IF A REMIT-TO-VENDOR-NBR      21020001
210300*  WAS KEYED IN.                                                  21030001
210400                                                                  21040001
210500     IF  APONUML > ZERO                                           21050001
210600         MOVE APONUMI              TO ASC-ALP-PO-NBR              21060001
210700     ELSE                                                         21070001
210800         IF  APONUMF = DP015-ERASE-EOF                            21080001
210900             MOVE SPACES           TO ASC-ALP-PO-NBR              21090001
211000         END-IF                                                   21100001
211100     END-IF.                                                      21110001
211200                                                                  21120001
211300     IF  AINVNBRL > ZERO                                          21130001
211400         MOVE AINVNBRI             TO ASC-NEW-INVC-ID             21140001
211500     ELSE                                                         21150001
211600         IF  AINVNBRF = DP015-ERASE-EOF                           21160001
211700             MOVE SPACES           TO ASC-NEW-INVC-ID             21170001
211800         END-IF                                                   21180001
211900     END-IF.                                                      21190001
212000                                                                  21200001
212100     IF  AHLDINDL > ZERO                                          21210001
212200         MOVE AHLDINDI             TO ASC-NEW-HOLD-IND            21220001
212300     ELSE                                                         21230001
212400         IF  AHLDINDF = DP015-ERASE-EOF                           21240001
212500             MOVE SPACE            TO ASC-NEW-HOLD-IND            21250001
212600         END-IF                                                   21260001
212700     END-IF.                                                      21270001
212800                                                                  21280001
212900     IF  ADUNNBRL > ZERO                                          21290001
213000         MOVE ADUNNBRI             TO ASC-NEW-RMIT-VND-ID         21300001
213100         SET ASC-DUNS-ENTERED      TO TRUE                        21310001
213200     ELSE                                                         21320001
213300         IF  ADUNNBRF = DP015-ERASE-EOF                           21330001
213400             MOVE SPACE            TO ASC-NEW-RMIT-VND-ID         21340001
213500             SET ASC-DUNS-NOT-ENTERED                             21350001
213600                                   TO TRUE                        21360001
213700         END-IF                                                   21370001
213800     END-IF.                                                      21380001
213900                                                                  21390001
214000     IF  AINVMML > ZERO                                           21400001
214100         MOVE AINVMMI              TO ASC-NEW-INVC-DTE-MM         21410001
214200     ELSE                                                         21420001
214300         IF  AINVMMF = DP015-ERASE-EOF                            21430001
214400             MOVE SPACE            TO ASC-NEW-INVC-DTE-MM         21440001
214500         END-IF                                                   21450001
214600     END-IF.                                                      21460001
214700                                                                  21470001
214800     IF  AINVDDL > ZERO                                           21480001
214900         MOVE AINVDDI              TO ASC-NEW-INVC-DTE-DD         21490001
215000     ELSE                                                         21500001
215100         IF  AINVDDF = DP015-ERASE-EOF                            21510001
215200             MOVE SPACE            TO ASC-NEW-INVC-DTE-DD         21520001
215300         END-IF                                                   21530001
215400     END-IF.                                                      21540001
215500                                                                  21550001
215600     IF  AINVYYL > ZERO                                           21560001
215700         MOVE AINVYYI              TO ASC-NEW-INVC-DTE-YY         21570001
215800     ELSE                                                         21580001
215900         IF  AINVYYF = DP015-ERASE-EOF                            21590001
216000             MOVE SPACE            TO ASC-NEW-INVC-DTE-YY         21600001
216100         END-IF                                                   21610001
216200     END-IF.                                                      21620001
216300                                                                  21630001
216400     IF  ASTRNBRL > ZERO                                          21640001
216500         MOVE ASTRNBRI             TO ASC-ALP-STR-NBR             21650001
216600     ELSE                                                         21660001
216700         IF  ASTRNBRF = DP015-ERASE-EOF                           21670001
216800             MOVE SPACE            TO ASC-ALP-STR-NBR             21680001
216900         END-IF                                                   21690001
217000     END-IF.                                                      21700001
217100                                                                  21710001
217200     IF  ATOTCSTL > ZERO                                          21720001
217300         MOVE ATOTCSTI             TO ASC-ALP-GRO-COST-AMT        21730001
217400     ELSE                                                         21740001
217500         IF  ATOTCSTF = DP015-ERASE-EOF                           21750001
217600             MOVE SPACE            TO ASC-ALP-GRO-COST-AMT        21760001
217700         END-IF                                                   21770001
217800     END-IF.                                                      21780001
217900                                                                  21790001
218000     IF  ANETCSTL > ZERO                                          21800001
218100         MOVE ANETCSTI             TO ASC-ALP-NET-INVC-AMT        21810001
218200     ELSE                                                         21820001
218300         IF  ANETCSTF = DP015-ERASE-EOF                           21830001
218400             MOVE SPACE            TO ASC-ALP-NET-INVC-AMT        21840001
218500         END-IF                                                   21850001
218600     END-IF.                                                      21860001
218700                                                                  21870001
218800     IF  APOSELL > ZERO                                           21880001
218900         MOVE APOSELI              TO ASC-NEW-PO-SEL              21890001
219000     ELSE                                                         21900001
219100         IF  APOSELF = DP015-ERASE-EOF                            21910001
219200             MOVE SPACE            TO ASC-NEW-PO-SEL              21920001
219300         END-IF                                                   21930001
219400     END-IF.                                                      21940001
219500                                                                  21950001
219600     IF  AINSELL > ZERO                                           21960001
219700         MOVE AINSELI              TO ASC-NEW-IN-SEL              21970001
219800     ELSE                                                         21980001
219900         IF  AINSELF = DP015-ERASE-EOF                            21990001
220000             MOVE SPACE            TO ASC-NEW-IN-SEL              22000001
220100         END-IF                                                   22010001
220200     END-IF.                                                      22020001
220300                                                                  22030001
220400     IF  AINPCTL > ZERO                                           22040001
220500         MOVE AINPCTI              TO ASC-ALP-DISC-PCT            22050001
220600     ELSE                                                         22060001
220700         IF  AINPCTF = DP015-ERASE-EOF                            22070001
220800             IF ASC-EXPENSE-INVC                                  22080001
220900                 MOVE 'NET'        TO ASC-ALP-DISC-PCT            22090001
221000             ELSE                                                 22100001
221100                 MOVE SPACE        TO ASC-ALP-DISC-PCT            22110001
221200             END-IF                                               22120001
221300         END-IF                                                   22130001
221400     END-IF.                                                      22140001
221500                                                                  22150001
221600     IF  AINDAYL > ZERO                                           22160001
221700         MOVE AINDAYI              TO ASC-ALP-DISC-DUE-DAY-QTY    22170001
221800     ELSE                                                         22180001
221900         IF  AINDAYF = DP015-ERASE-EOF                            22190001
222000             IF ASC-EXPENSE-INVC                                  22200001
222100                IF ASC-NEW-RMIT-VND-ID = PV-IMPORT-VENDOR         22210001
222200                   MOVE '005'   TO ASC-ALP-DISC-DUE-DAY-QTY       22220001
222300                ELSE                                              22230001
222400                   MOVE '010'   TO ASC-ALP-DISC-DUE-DAY-QTY       22240001
222500                END-IF                                            22250001
222600             ELSE                                                 22260001
222700                MOVE SPACE    TO ASC-ALP-DISC-DUE-DAY-QTY         22270001
222800             END-IF                                               22280001
222900         END-IF                                                   22290001
223000     END-IF.                                                      22300001
223100                                                                  22310001
223200     IF  AINEOML > ZERO                                           22320001
223300         MOVE AINEOMI              TO ASC-NEW-IN-EOM              22330001
223400     ELSE                                                         22340001
223500         IF  AINEOMF = DP015-ERASE-EOF                            22350001
223600             IF ASC-EXPENSE-INVC                                  22360001
223700                 MOVE 'N'          TO ASC-NEW-IN-EOM              22370001
223800             ELSE                                                 22380001
223900                 MOVE SPACE        TO ASC-NEW-IN-EOM              22390001
224000             END-IF                                               22400001
224100         END-IF                                                   22410001
224200     END-IF.                                                      22420001
224300                                                                  22430001
224400     IF  AINEXTL > ZERO                                           22440001
224500         MOVE AINEXTI              TO ASC-ALP-EXTD-DAYS-QTY       22450001
224600     ELSE                                                         22460001
224700         IF  AINEXTF = DP015-ERASE-EOF                            22470001
224800             IF ASC-EXPENSE-INVC                                  22480001
224900                 MOVE '000'        TO ASC-ALP-EXTD-DAYS-QTY       22490001
225000             ELSE                                                 22500001
225100                 MOVE SPACE        TO ASC-ALP-EXTD-DAYS-QTY       22510001
225200             END-IF                                               22520001
225300         END-IF                                                   22530001
225400     END-IF.                                                      22540001
225500                                                                  22550001
225600     IF  ASPLITL > ZERO                                           22560001
225700         MOVE ASPLITI              TO ASC-NEW-IN-SPLIT-TERMS-IND  22570001
225800     ELSE                                                         22580001
225900         IF  ASPLITF = DP015-ERASE-EOF                            22590001
226000             IF ASC-EXPENSE-INVC                                  22600001
226100                 MOVE 'N'          TO ASC-NEW-IN-SPLIT-TERMS-IND  22610001
226200             ELSE                                                 22620001
226300                 MOVE SPACE        TO ASC-NEW-IN-SPLIT-TERMS-IND  22630001
226400             END-IF                                               22640001
226500         END-IF                                                   22650001
226600     END-IF.                                                      22660001
226700                                                                  22670001
226800     IF  ATOTINVL > ZERO                                          22680001
226900         MOVE ATOTINVI             TO ASC-ALP-TOT-INVC-PC-QTY     22690001
227000     ELSE                                                         22700001
227100         IF  ATOTCSTF = DP015-ERASE-EOF                           22710001
227200             MOVE SPACE            TO ASC-ALP-TOT-INVC-PC-QTY     22720001
227300         END-IF                                                   22730001
227400     END-IF.                                                      22740001
227500                                                                  22750001
227600     IF  ACMPFRTL > ZERO                                          22760001
227700         MOVE ACMPFRTI             TO ASC-ALP-KOHLS-FRGT-PCT      22770001
227800     ELSE                                                         22780001
227900         IF  ACMPFRTF = DP015-ERASE-EOF                           22790001
228000             MOVE SPACE            TO ASC-ALP-KOHLS-FRGT-PCT      22800001
228100         END-IF                                                   22810001
228200     END-IF.                                                      22820001
228300                                                                  22830001
228400     IF  AVNDFRTL > ZERO                                          22840001
228500         MOVE AVNDFRTI             TO ASC-ALP-VEND-FRGT-PCT       22850001
228600     ELSE                                                         22860001
228700         IF  AVNDFRTF = DP015-ERASE-EOF                           22870001
228800             MOVE SPACE            TO ASC-ALP-VEND-FRGT-PCT       22880001
228900         END-IF                                                   22890001
229000     END-IF.                                                      22900001
229100                                                                  22910001
229200     IF  ACARTCTL > ZERO                                          22920001
229300         MOVE ACARTCTI             TO ASC-ALP-CARTON-CNT          22930001
229400     ELSE                                                         22940001
229500         IF  ACARTCTF = DP015-ERASE-EOF                           22950001
229600             MOVE SPACES           TO ASC-ALP-CARTON-CNT          22960001
229700         END-IF                                                   22970001
229800     END-IF.                                                      22980001
229900                                                                  22990001
230000     IF  ACHRGCDL > ZERO                                          23000001
230100         MOVE ACHRGCDI             TO ASC-NEW-IMPRT-CHRG-CDE      23010001
230200     ELSE                                                         23020001
230300         IF  ACHRGCDF = DP015-ERASE-EOF                           23030001
230400             MOVE SPACES           TO ASC-NEW-IMPRT-CHRG-CDE      23040001
230500         END-IF                                                   23050001
230600     END-IF.                                                      23060001
230700                                                                  23070001
230800     IF  ABOLNBRL > ZERO                                          23080001
230900         MOVE ABOLNBRI             TO ASC-NEW-BOL-ID              23090001
231000     ELSE                                                         23100001
231100         IF  ABOLNBRF = DP015-ERASE-EOF                           23110001
231200             MOVE SPACE            TO ASC-NEW-BOL-ID              23120001
231300         END-IF                                                   23130001
231400* THIS LAST END-IF ADD 4-28-97   CKUNSTMANN                       23140001
231500     END-IF.                                                      23150001
231600                                                                  23160001
231700     IF  ACNTNRL > ZERO                                           23170001
231800         MOVE ACNTNRI             TO ASC-NEW-CNTNR-ID             23180001
231900     ELSE                                                         23190001
232000         IF  ACNTNRF = DP015-ERASE-EOF                            23200001
232100             MOVE SPACE            TO ASC-NEW-CNTNR-ID            23210001
232200         END-IF                                                   23220001
232300     END-IF.                                                      23230001
232400                                                                  23240001
232500     IF  AENTRYL > ZERO                                           23250001
232600         MOVE AENTRYI             TO ASC-NEW-ENT-NBR              23260001
232700     ELSE                                                         23270001
232800         IF  AENTRYF = DP015-ERASE-EOF                            23280001
232900             MOVE SPACE            TO ASC-NEW-ENT-NBR             23290001
233000         END-IF                                                   23300001
233100     END-IF.                                                      23310001
233200                                                                  23320001
233300     IF  AREFNBRL > ZERO                                          23330001
233400         MOVE AREFNBRI            TO ASC-NEW-REF-NBR              23340001
233500     ELSE                                                         23350001
233600         IF  AREFNBRF = DP015-ERASE-EOF                           23360001
233700             MOVE SPACE            TO ASC-NEW-REF-NBR             23370001
233800         END-IF                                                   23380001
233900     END-IF.                                                      23390001
234000                                                                  23400001
234100*----------------------------------------------------------------*23410001
234200* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *23420001
234300* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *23430001
234400* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *23440001
234500*----------------------------------------------------------------*23450001
234600 3000-EDIT-DATA-IN-COMMAREA.                                      23460001
234700                                                                  23470001
234800     PERFORM 3200-RESET-ATTRIBUTES.                               23480001
234900                                                                  23490001
235000     IF DP020-SRC-AID = DP016-PF16                                23500001
235100         CONTINUE                                                 23510001
235200     ELSE                                                         23520001
235300         IF ASC-ADD-REQUESTED AND DP020-SRC-AID = DP016-ENTER     23530001
235400             PERFORM 3010-EDIT-PO-NBR                             23540001
235500             PERFORM 3018-EDIT-INVC-ID                            23550001
235600             PERFORM 3020-EDIT-DUN-NBR                            23560001
235700             SET DP030-SET-CURSOR-APPL-1   TO TRUE                23570001
235800             IF PS-NO-ERROR                                       23580001
235900                 MOVE -1                   TO AINVNBRL            23590001
236000             END-IF                                               23600001
236100         ELSE                                                     23610001
236200             IF ASC-UPDATE-PENDING OR                             23620001
236300                ASC-ADD-REQUESTED                                 23630001
236400*WR5091 ADD LOGIC TO CHECK FOR 'ED' - ONLY TERMS SEL UPDATEABLE   23640001
236500                IF  ASC-ENTR-MTHD-CDE = 'ED' OR 'EE'              23650001
236600                    PERFORM 3030-EDIT-HOLD-IND                    23660001
236700                    PERFORM 3090-EDIT-PAY-TERMS-BOX               23670001
236800                 ELSE                                             23680001
236900                    PERFORM 3010-EDIT-PO-NBR                      23690001
237000                    PERFORM 3018-EDIT-INVC-ID                     23700001
237100                    PERFORM 3020-EDIT-DUN-NBR                     23710001
237200                    PERFORM 3030-EDIT-HOLD-IND                    23720001
237300                    PERFORM 3040-EDIT-INVC-DTE                    23730001
237400                    PERFORM 3060-EDIT-STR-NBR                     23740001
237500                    IF ASC-MDSE-INVC                              23750001
237600                        PERFORM 3070-EDIT-GRO-COST-AMT            23760001
237700                        PERFORM 3080-EDIT-TOT-INVC-PC-QTY         23770001
237800                    END-IF                                        23780001
237900                                                                  23790001
238000                    PERFORM 3085-EDIT-NET-INVC-AMT                23800001
238100                    PERFORM 3090-EDIT-PAY-TERMS-BOX               23810001
238200                    IF ASC-MDSE-INVC                              23820001
238300                        PERFORM 3100-EDIT-KOHLS-FRGT-PCT          23830001
238400                        PERFORM 3110-EDIT-VEND-FRGT-PCT           23840001
238500                        PERFORM 3120-EDIT-CARTON-CNT              23850001
238600                        PERFORM 3140-EDIT-IMPORT-CHRG-CDE         23860001
238700                    END-IF                                        23870001
238800                    IF ASC-EXPENSE-INVC                           23880001
238900                      AND ASC-IMPORT-ENTRY-REQ                    23890001
239000                        PERFORM 3170-EDIT-ENT-NBR                 23900001
239100                    END-IF                                        23910001
239200                 END-IF                                           23920001
239300                                                                  23930001
239400                 SET DP030-SET-CURSOR-APPL-1   TO TRUE            23940001
239500                                                                  23950001
239600                 IF PS-NO-ERROR                                   23960001
239700                     MOVE -1                   TO AINVNBRL        23970001
239800                 END-IF                                           23980001
239900             END-IF                                               23990001
240000         END-IF                                                   24000001
240100     END-IF.                                                      24010001
240200                                                                  24020001
240300*--------------------------------------------------------------*  24030001
240400* EDIT THE PURCHASE ORDER NUMBER                               *  24040001
240500*--------------------------------------------------------------*  24050001
240600 3010-EDIT-PO-NBR.                                                24060001
240700                                                                  24070001
240800     IF ASC-ALP-PO-NBR  = SPACES                                  24080001
240900      OR ASC-ALP-PO-NBR-NUM  = ZEROS                              24090001
241000         MOVE +0                   TO ASC-NEW-PO-NBR              24100001
241100         SET DP020-MSG-FATAL       TO TRUE                        24110001
241200*        -- MUST EXIST --                                         24120001
241300         MOVE DP015-UNP-ALP-BRT-OFF                               24130001
241400                                   TO APONUMA                     24140001
241500         MOVE DP015-RED            TO APONUMC                     24150001
241600         MOVE DP015-REVERSE        TO APONUMH                     24160001
241700         MOVE -1                   TO APONUML                     24170001
241800         IF PS-NO-ERROR                                           24180001
241900             MOVE PC-TSYMSG-00852  TO DP020-MSG-NUMBER            24190001
242000         END-IF                                                   24200001
242100         SET PS-ERROR              TO TRUE                        24210001
242200     ELSE                                                         24220001
242300         MOVE ASC-ALP-PO-NBR      TO DP010I-UNEDITED-FIELD        24230001
242400*        MOVE 9                   TO DP010I-MAXIMUM-DIGITS        24240001
242500         MOVE LENGTH OF ASC-ALP-PO-NBR TO DP010I-MAXIMUM-DIGITS   24250001
242600         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      24260001
242700         SET  DP010I-NEGATIVE-NOT-ALLOWED                         24270001
242800                                  TO TRUE                         24280001
242910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         24291003
242920                         USING DP010I-NUMERIC-EDIT-AREA           24292003
243000         IF DP010I-ERROR-DETECTED                                 24300001
243100             SET DP020-MSG-FATAL  TO TRUE                         24310001
243200*            -- MUST BE NUMERIC --                                24320001
243300             MOVE DP015-UNP-ALP-BRT-OFF                           24330001
243400                                  TO APONUMA                      24340001
243500             MOVE DP015-RED       TO APONUMC                      24350001
243600             MOVE DP015-REVERSE   TO APONUMH                      24360001
243700             MOVE -1                  TO APONUML                  24370001
243800             IF PS-NO-ERROR                                       24380001
243900                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         24390001
244000             END-IF                                               24400001
244100             SET PS-ERROR         TO TRUE                         24410001
244200         ELSE                                                     24420001
244300             MOVE DP010I-NUMERIC-FIELD TO ASC-NEW-PO-NBR          24430001
244400                                          ASC-ALP-PO-NBR-NUM      24440001
244500                                          DK-PO-NBR-LOW           24450001
244600                                          DK-PO-NBR-HIGH          24460001
244700             IF ASC-NEW-INVC-ID > SPACES                          24470001
244800*            OR ASC-ADD-PENDING                                   24480001
244900             OR ASC-ADD-REQUESTED                                 24490001
245000                 IF (ASC-NEW-PO-NBR  NOT = ASC-PREV-PO-NBR)  OR   24500001
245100                    (ASC-NEW-INVC-ID NOT = ASC-PREV-INVC-ID) OR   24510001
245200                    (ASC-CONF-NOT-OBT)                            24520001
245300                     IF ASC-OLD-PO-NBR > +0 OR                    24530001
245400*                       ASC-ADD-PENDING                           24540001
245500                        ASC-ADD-REQUESTED                         24550001
245600                         PERFORM 3014-SUBSEQUENT-PO-NBR           24560001
245700                     ELSE                                         24570001
245800                         PERFORM 3012-INIT-PO-NBR                 24580001
245900                     END-IF                                       24590001
246000                     IF PS-NO-ERROR                               24600001
246100                         MOVE ASC-NEW-PO-NBR  TO ASC-PREV-PO-NBR  24610001
246200                         MOVE ASC-NEW-INVC-ID TO ASC-PREV-INVC-ID 24620001
246300                     END-IF                                       24630001
246400                 ELSE                                             24640001
246500                     IF ASC-IMPORT-PO AND ASC-CONF-REQ            24650001
246600                         SET ASC-CONF-OBT TO TRUE                 24660001
246700                     END-IF                                       24670001
246800                 END-IF                                           24680001
246900             END-IF                                               24690001
247000         END-IF                                                   24700001
247100     END-IF.                                                      24710001
247200                                                                  24720001
247300*--------------------------------------------------------------*  24730001
247400* THIS PARA IS INVOKED WHEN THE USER DID NOT INITIALLY SUPPLY  *  24740001
247500* A PO_NBR, AND THERE IS MORE THAN ONE PO_NBR RELATED TO THE   *  24750001
247600* ASC-KEY-INVC-ID.  THIS IS BASICALLY FIRST-TIME-IN LOGIC.     *  24760001
247700*--------------------------------------------------------------*  24770001
247800 3012-INIT-PO-NBR.                                                24780001
247900                                                                  24790001
248000     MOVE ASC-NEW-PO-NBR TO ASC-KEY-PO-NBR                        24800001
248100     SET ASC-DUNS-NOT-ENTERED     TO TRUE                         24810001
248200                                                                  24820001
248300     PERFORM 4000-BUILD-INITIAL-PANEL                             24830001
248400     PERFORM 3200-RESET-ATTRIBUTES                                24840001
248500                                                                  24850001
248600*    IF ASC-ADD-PENDING                                           24860001
248700     IF ASC-ADD-REQUESTED                                         24870001
248800         CONTINUE                                                 24880001
248900     ELSE                                                         24890001
249000         PERFORM 3500-SAVE-SCREEN-FIELDS                          24900001
249100     END-IF.                                                      24910001
249200                                                                  24920001
249300*--------------------------------------------------------------*  24930001
249400* HERE'S WHERE THE USER CHANGED THE PO_NBR, FROM SOMETHING TO  *  24940001
249500* SOMETHING ELSE (AS OPPOSED TO FROM NOTHING TO SOMETHING).    *  24950001
249600* IF THE INVC/PO COMBO EXISTS, BUT THE "NEW" EQUALS WHAT WAS   *  24960001
249700* ORIGINALLY ENTERED, THAT'S O.K. (I.E. THE USER CHANGED THE   *  24970001
249800* PO FROM 1 TO 3 AND BACK TO 1 AGAIN), OTHERWISE, IF THE PO    *  24980001
249900* NBR/INVC IS FOUND, IT'S AN ERRANT CONDITION.                 *  24990001
250000*--------------------------------------------------------------*  25000001
250100 3014-SUBSEQUENT-PO-NBR.                                          25010001
250200                                                                  25020001
250300     MOVE ASC-NEW-INVC-ID TO DK-INVC-ID                           25030001
250400                                                                  25040001
250500     SET ASC-INVOICE-NOT-FOUND     TO TRUE                        25050001
250600     PERFORM 4010-VALIDATE-INVC-PO-COMBO                          25060001
250700                                                                  25070001
250800     IF ASC-INVOICE-FOUND                                         25080001
250900         MOVE INVOIC-PAYT-REQ-SEQ-NBR TO ASC-KEY-PAYT-REQ-SEQ-NBR 25090001
251000         MOVE INVOIC-STATUS-CDE       TO ASC-KEY-INVC-STATUS      25100001
251100         IF ASC-NEW-PO-NBR = ASC-OLD-PO-NBR AND                   25110001
251200*           NOT ASC-ADD-PENDING                                   25120001
251300            NOT ASC-ADD-REQUESTED                                 25130001
251400            IF ASC-UPDATE-PENDING  AND                            25140001
251500              (INVOIC-STATUS-CDE = 'PD' OR 'DE' OR 'RL' OR        25150001
251600                                   'PJ' OR 'OP' OR 'BM')          25160001
251700                SET DP020-MSG-FATAL   TO TRUE                     25170001
251800*****           -- THE INVOICE IS NOT UPDATEABLE STATUS CODE      25180001
251900                MOVE DP015-UNP-ALP-BRT-OFF                        25190001
252000                                     TO AINVNBRA                  25200001
252100                MOVE DP015-RED       TO AINVNBRC                  25210001
252200                MOVE DP015-REVERSE   TO AINVNBRH                  25220001
252300                MOVE -1              TO AINVNBRL                  25230001
252400                IF PS-NO-ERROR                                    25240001
252500                    MOVE PC-TSYMSG-01239                          25250001
252600                                 TO DP020-MSG-NUMBER              25260001
252700                END-IF                                            25270001
252800                SET PS-ERROR         TO TRUE                      25280001
252900            ELSE                                                  25290001
253000               PERFORM 3015-GET-PO-INFO                           25300001
253100            END-IF                                                25310001
253200         ELSE                                                     25320001
253300             SET DP020-MSG-FATAL   TO TRUE                        25330001
253400**           -- THE PO_NBR/INVC ALREADY EXISTS --                 25340001
253500             MOVE DP015-UNP-ALP-BRT-OFF                           25350001
253600                                  TO APONUMA                      25360001
253700                                     AINVNBRA                     25370001
253800             MOVE DP015-RED       TO APONUMC                      25380001
253900                                     AINVNBRC                     25390001
254000             MOVE DP015-REVERSE   TO APONUMH                      25400001
254100                                     AINVNBRH                     25410001
254200             MOVE -1              TO AINVNBRL                     25420001
254300             IF PS-NO-ERROR                                       25430001
254400                 MOVE PC-TSYMSG-00857                             25440001
254500                              TO DP020-MSG-NUMBER                 25450001
254600             END-IF                                               25460001
254700             SET PS-ERROR         TO TRUE                         25470001
254800         END-IF                                                   25480001
254900     ELSE                                                         25490001
255000         IF ASC-MULTIPLE-INVOICES                                 25500001
255100*            -- SEVERE DATA CORRUPTION - CONTACT DP --            25510001
255200             SET DP020-MSG-FATAL   TO TRUE                        25520001
255300             MOVE DP015-UNP-ALP-BRT-OFF                           25530001
255400                                  TO AINVNBRA                     25540001
255500             MOVE DP015-RED       TO AINVNBRC                     25550001
255600             MOVE DP015-REVERSE   TO AINVNBRH                     25560001
255700             MOVE -1              TO AINVNBRL                     25570001
255800             IF PS-NO-ERROR                                       25580001
255900                 MOVE PC-TSYMSG-00858 TO DP020-MSG-NUMBER         25590001
256000             END-IF                                               25600001
256100             SET PS-ERROR TO TRUE                                 25610001
256200         ELSE                                                     25620001
256300             IF ASC-ADD-REQUESTED OR                              25630001
256400                ASC-ADD-PENDING                                   25640001
256500                 PERFORM 4101-CHECK-JOURNALIZED-STATUS            25650001
256600             END-IF                                               25660001
256700             PERFORM 3015-GET-PO-INFO                             25670001
256800         END-IF                                                   25680001
256900     END-IF.                                                      25690001
257000                                                                  25700001
257100*--------------------------------------------------------------*  25710001
257200* OBTAIN THE PURCHASE ORDER INFORMATION                        *  25720001
257300*--------------------------------------------------------------*  25730001
257400 3015-GET-PO-INFO.                                                25740001
257500                                                                  25750001
257600     INITIALIZE DCLTPURCHS                                        25760001
257700                DCLTPAYTRM                                        25770001
257800                                                                  25780001
257900     MOVE ASC-NEW-PO-NBR   TO INVOIC-PO-NBR                       25790001
258000     PERFORM 4130-GET-TPURCHS-DATA                                25800001
258100                                                                  25810001
258200     IF PS-TPURCHS-FOUND                                          25820001
258300        MOVE PURCHS-PO-TYP-CDE TO ASC-PO-TYP-CDE                  25830001
258400        MOVE PURCHS-DIR-STR-IND TO ASC-DIR-STR-IND                25840001
258500*WR28461                                                          25850001
258600*       IF ASC-CNSMR-DIR-PO                                       25860001
258700*          MOVE PC-TSYMSG-03390  TO DP020-MSG-NUMBER              25870001
258800*          SET DP020-MSG-FATAL   TO TRUE                          25880001
258900*          MOVE DP015-UNP-ALP-BRT-OFF                             25890001
259000*                                TO APONUMA                       25900001
259100*          MOVE DP015-RED        TO APONUMC                       25910001
259200*          MOVE DP015-REVERSE    TO APONUMH                       25920001
259300*          MOVE -1               TO APONUML                       25930001
259400*          SET PS-ERROR          TO TRUE                          25940001
259500*       ELSE                                                      25950001
259600           IF ASC-IMPORT-PO                                       25960001
259700              IF ASC-MDSE-INVC                                    25970001
259800                 MOVE DP015-UNP-ALP-NOR-OFF                       25980001
259900                                       TO ACHRGCDA                25990001
260000                 MOVE DP015-GREEN      TO ACHRGCDC                26000001
260100                 MOVE DP015-UNDERLINE  TO ACHRGCDH                26010001
260200              END-IF                                              26020001
260300           ELSE                                                   26030001
260400* MUST BE AN IMPORT PO TO HAVE AN EXPENSE INVOICE ENTERED         26040001
260500              IF ASC-EXPENSE-INVC                                 26050001
260600                 SET DP020-MSG-FATAL   TO TRUE                    26060001
260700                 MOVE DP015-UNP-ALP-BRT-OFF                       26070001
260800                                       TO APONUMA                 26080001
260900                 MOVE DP015-RED        TO APONUMC                 26090001
261000                                          AINVTYPC                26100001
261100                 MOVE DP015-REVERSE    TO APONUMH                 26110001
261200                                          AINVTYPH                26120001
261300                 MOVE -1               TO APONUML                 26130001
261400                 IF PS-NO-ERROR                                   26140001
261500* INVALID PURCHASE ORDER TYPE CODE FOR THIS FUNCTION * MSG        26150001
261600                    MOVE PC-TSYMSG-00587                          26160001
261700                                      TO DP020-MSG-NUMBER         26170001
261800                 END-IF                                           26180001
261900                 SET PS-ERROR          TO TRUE                    26190001
262000              ELSE                                                26200001
262100                 MOVE DP015-PRO-NOR-OFF                           26210001
262200                                       TO ACHRGCDA                26220001
262300                 MOVE DP015-BLUE       TO ACHRGCDC                26230001
262400                 MOVE DP015-HL-OFF     TO ACHRGCDH                26240001
262500                 MOVE SPACE            TO ACHRGCDO                26250001
262600                                          ASC-NEW-IMPRT-CHRG-CDE  26260001
262700                                          ASC-OLD-IMPRT-CHRG-CDE  26270001
262800              END-IF                                              26280001
262900           END-IF                                                 26290001
263000*       END-IF                                                    26300001
263100        IF PS-NO-ERROR                                            26310001
263200            MOVE PURCHS-DEPT-NBR       TO ASC-DEPT-NBR            26320001
263300            MOVE PURCHS-NEW-STR-PO-IND TO ASC-NEW-STR-PO-IND      26330001
263400* 4104- DATA IS NOT PERTINENT TO EXPENSE INVOICES                 26340001
263500            IF ASC-MDSE-INVC                                      26350001
263600                PERFORM 4104-GET-PLNSHP                           26360001
263700            END-IF                                                26370001
263800            PERFORM 4105-GET-INST                                 26380001
263900          IF ASC-DUNS-NOT-ENTERED                                 26390001
264000            PERFORM 4107-GET-ENT-DATA-USING-ENT-ID                26400001
264100            MOVE EXTENT-DUN-NBR TO ASC-NEW-RMIT-VND-ID            26410001
264200                                   PV-PO-DUN-NBR                  26420001
264300                                   ASC-HOLD-PO-DUN-NBR            26430001
264400          ELSE                                                    26440001
264500            MOVE ASC-NEW-RMIT-VND-ID TO                           26450001
264600                                   PV-PO-DUN-NBR                  26460001
264700          END-IF                                                  26470001
264800            IF ASC-EXPENSE-INVC                                   26480001
264900               IF ASC-NEW-RMIT-VND-ID = PV-IMPORT-VENDOR          26490001
265000                  MOVE '005'   TO ASC-ALP-DISC-DUE-DAY-QTY        26500001
265100               END-IF                                             26510001
265200            END-IF                                                26520001
265300            PERFORM 4140-GET-TPAYTRM-DATA                         26530001
265400            COMPUTE ASC-PO-DISCOUNT-PCT =                         26540001
265500                    PAYTRM-DISCOUNT-PCT * 100                     26550001
265600                                                                  26560001
265700            IF PAYTRM-DISCOUNT-PCT = 0                            26570001
265800               MOVE PAYTRM-DUE-DAY-QTY TO ASC-PO-DISCOUNT-DAYS-QTY26580001
265900            ELSE                                                  26590001
266000               MOVE PAYTRM-DISCOUNT-DAYS-QTY                      26600001
266100                                     TO ASC-PO-DISCOUNT-DAYS-QTY  26610001
266200            END-IF                                                26620001
266300                                                                  26630001
266400            MOVE PAYTRM-DUE-DAY-FR-DTE-TXT                        26640001
266500                                     TO ASC-PO-DUE-DAY-FR-DTE-TXT 26650001
266600            MOVE POAGMT-DISC-PCT     TO ASC-POAGMT-DISC-PCT       26660001
266700            MOVE POAGMT-DISC-PAY-DAY-QTY                          26670001
266800                                     TO ASC-PO-DISC-PAY-DAY-QTY   26680001
266900            IF ASC-NEW-INVC-ID > SPACES                           26690001
267000               PERFORM 4195-CHECK-VEND-INVC-COMBO                 26700001
267100            END-IF                                                26710001
267200         END-IF                                                   26720001
267300     ELSE                                                         26730001
267400         SET DP020-MSG-FATAL   TO TRUE                            26740001
267500         MOVE DP015-UNP-ALP-BRT-OFF                               26750001
267600                              TO APONUMA                          26760001
267700         MOVE DP015-RED       TO APONUMC                          26770001
267800         MOVE DP015-REVERSE   TO APONUMH                          26780001
267900**       -- PO_NBR NOT FOUND ON TPURCHS --                        26790001
268000         MOVE -1               TO APONUML                         26800001
268100         IF PS-NO-ERROR                                           26810001
268200             MOVE PC-TSYMSG-00726                                 26820001
268300                               TO DP020-MSG-NUMBER                26830001
268400         END-IF                                                   26840001
268500         SET PS-ERROR          TO TRUE                            26850001
268600     END-IF.                                                      26860001
268700                                                                  26870001
268800*--------------------------------------------------------------*  26880001
268900* EDIT THE INVOICE ID                                          *  26890001
269000*--------------------------------------------------------------*  26900001
269100 3018-EDIT-INVC-ID.                                               26910001
269200                                                                  26920001
269300     IF ASC-NEW-INVC-ID = SPACES                                  26930001
269400       OR ASC-NEW-INVC-ID = ZEROES                                26940001
269500         SET DP020-MSG-FATAL       TO TRUE                        26950001
269600*        -- MUST EXIST --                                         26960001
269700         MOVE DP015-UNP-ALP-BRT-OFF                               26970001
269800                                   TO AINVNBRA                    26980001
269900         MOVE DP015-RED            TO AINVNBRC                    26990001
270000         MOVE DP015-REVERSE        TO AINVNBRH                    27000001
270100         MOVE -1                   TO AINVNBRL                    27010001
270200         IF PS-NO-ERROR                                           27020001
270300             MOVE PC-TSYMSG-00849  TO DP020-MSG-NUMBER            27030001
270400         END-IF                                                   27040001
270500         SET PS-ERROR              TO TRUE                        27050001
270600*    ELSE                                                         27060001
270700*        MOVE ASC-NEW-INVC-ID      TO ASC-PREV-INVC-ID            27070001
270800     END-IF.                                                      27080001
270900                                                                  27090001
271000*--------------------------------------------------------------*  27100001
271100* EDIT THE PO NUMBER                                           *  27110001
271200*--------------------------------------------------------------*  27120001
271300 3020-EDIT-DUN-NBR.                                               27130001
271400                                                                  27140001
271500     IF ASC-NEW-RMIT-VND-ID = SPACES                              27150001
271600         SET DP020-MSG-FATAL       TO TRUE                        27160001
271700*        -- MUST EXIST --                                         27170001
271800         MOVE DP015-UNP-ALP-BRT-OFF                               27180001
271900                                   TO ADUNNBRA                    27190001
272000         MOVE DP015-RED            TO ADUNNBRC                    27200001
272100         MOVE DP015-REVERSE        TO ADUNNBRH                    27210001
272200         MOVE -1                   TO ADUNNBRL                    27220001
272300         IF PS-NO-ERROR                                           27230001
272400             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            27240001
272500         END-IF                                                   27250001
272600         SET PS-ERROR              TO TRUE                        27260001
272700         INITIALIZE ASC-ENT-DATA                                  27270001
272800     ELSE                                                         27280001
272900         IF ASC-NEW-RMIT-VND-ID NOT = ASC-PREV-DUN-NBR            27290001
273000           OR ASC-ENT-NAME-DESC = SPACES                          27300001
273100                                                                  27310001
273200             MOVE ASC-NEW-RMIT-VND-ID TO INVOIC-RMIT-VND-ID       27320001
273300             INITIALIZE DCLTEXTENT                                27330001
273400                        DCLTBUSLOC                                27340001
273500             PERFORM 4110-GET-ENT-NAME                            27350001
273600             PERFORM 4120-GET-BUSLOC-DATA                         27360001
273700             IF ENTNME-ENT-NAME-DESC > SPACES                     27370001
273800                 MOVE ENTNME-ENT-NAME-DESC       TO               27380001
273900                      ASC-ENT-NAME-DESC                           27390001
274000                 MOVE BUSLOC-ADDRESS-LINE1-DESC  TO               27400001
274100                      ASC-ADDRESS-LINE1-DESC                      27410001
274200                 MOVE BUSLOC-ADDRESS-LINE2-DESC  TO               27420001
274300                      ASC-ADDRESS-LINE2-DESC                      27430001
274400                 MOVE BUSLOC-CITY-NAME           TO               27440001
274500                      ASC-CITY-NAME                               27450001
274600                 MOVE BUSLOC-STATE-CDE           TO               27460001
274700                      ASC-STATE-CDE                               27470001
274800                 MOVE BUSLOC-ZIP-CDE             TO               27480001
274900                      ASC-ZIP-CDE                                 27490001
275000                 MOVE ASC-NEW-RMIT-VND-ID        TO               27500001
275100                      ASC-PREV-DUN-NBR                            27510001
275200             ELSE                                                 27520001
275300                 INITIALIZE ASC-ENT-DATA                          27530001
275400                 SET DP020-MSG-FATAL   TO TRUE                    27540001
275500*                -- INVALID VALUE --                              27550001
275600                 MOVE DP015-UNP-ALP-BRT-OFF                       27560001
275700                                       TO ADUNNBRA                27570001
275800                 MOVE DP015-RED        TO ADUNNBRC                27580001
275900                 MOVE DP015-REVERSE    TO ADUNNBRH                27590001
276000                 MOVE -1                   TO ADUNNBRL            27600001
276100                 IF PS-NO-ERROR                                   27610001
276200                     MOVE PC-TSYMSG-00608  TO DP020-MSG-NUMBER    27620001
276300                 END-IF                                           27630001
276400                 SET PS-ERROR          TO TRUE                    27640001
276500             END-IF                                               27650001
276600         END-IF                                                   27660001
276700         MOVE ASC-NEW-RMIT-VND-ID TO PV-PO-DUN-NBR                27670001
276800         PERFORM 4195-CHECK-VEND-INVC-COMBO                       27680001
276900     END-IF.                                                      27690001
277000                                                                  27700001
277100*--------------------------------------------------------------*  27710001
277200* EDIT THE HOLDING INDICATOR                                   *  27720001
277300*--------------------------------------------------------------*  27730001
277400 3030-EDIT-HOLD-IND.                                              27740001
277500                                                                  27750001
277600     IF ASC-NEW-HOLD-IND = SPACES                                 27760001
277700         MOVE 'N'                  TO ASC-NEW-HOLD-IND            27770001
277800     END-IF.                                                      27780001
277900                                                                  27790001
278000     IF ASC-NEW-HOLD-IND       = 'N'                              27800001
278100         IF ASC-NEW-IN-SPLIT-TERMS-IND = 'Y' OR                   27810001
278200            ASC-HOLD-VENDOR         = 'Y'                         27820001
278300             SET DP020-MSG-FATAL   TO TRUE                        27830001
278400*            -- INVALID VALUE  --                                 27840001
278500             MOVE DP015-UNP-ALP-BRT-OFF                           27850001
278600                                   TO AHLDINDA                    27860001
278700             MOVE DP015-RED        TO AHLDINDC                    27870001
278800             MOVE DP015-REVERSE    TO AHLDINDH                    27880001
278900             MOVE -1               TO AHLDINDL                    27890001
279000             IF PS-NO-ERROR                                       27900001
279100                 MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER        27910001
279200             END-IF                                               27920001
279300             SET PS-ERROR          TO TRUE                        27930001
279400         END-IF                                                   27940001
279500     ELSE                                                         27950001
279600         IF ASC-NEW-HOLD-IND = 'Y'                                27960001
279700             CONTINUE                                             27970001
279800         ELSE                                                     27980001
279900             SET DP020-MSG-FATAL   TO TRUE                        27990001
280000*            -- INVALID VALUE  --                                 28000001
280100             MOVE DP015-UNP-ALP-BRT-OFF                           28010001
280200                                   TO AHLDINDA                    28020001
280300             MOVE DP015-RED        TO AHLDINDC                    28030001
280400             MOVE DP015-REVERSE    TO AHLDINDH                    28040001
280500             MOVE -1                   TO AHLDINDL                28050001
280600             IF PS-NO-ERROR                                       28060001
280700                 MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER        28070001
280800             END-IF                                               28080001
280900         END-IF                                                   28090001
281000     END-IF.                                                      28100001
281100                                                                  28110001
281200*--------------------------------------------------------------*  28120001
281300* EDIT THE INVOICE DATE                                        *  28130001
281400*--------------------------------------------------------------*  28140001
281500 3040-EDIT-INVC-DTE.                                              28150001
281600                                                                  28160001
281700     IF ASC-NEW-INVC-DTE-MM = SPACES                              28170001
281800         SET DP020-MSG-FATAL       TO TRUE                        28180001
281900*        -- REQUIRED --                                           28190001
282000         MOVE DP015-UNP-ALP-BRT-OFF                               28200001
282100                                   TO AINVMMA                     28210001
282200         MOVE DP015-RED            TO AINVMMC                     28220001
282300         MOVE DP015-REVERSE        TO AINVMMH                     28230001
282400         MOVE -1                   TO AINVMML                     28240001
282500         IF PS-NO-ERROR                                           28250001
282600             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        28260001
282700         END-IF                                                   28270001
282800         SET PS-ERROR              TO TRUE                        28280001
282900     END-IF                                                       28290001
283000                                                                  28300001
283100     IF ASC-NEW-INVC-DTE-DD = SPACES                              28310001
283200         SET DP020-MSG-FATAL       TO TRUE                        28320001
283300*        -- REQUIRED --                                           28330001
283400         MOVE DP015-UNP-ALP-BRT-OFF                               28340001
283500                                   TO AINVDDA                     28350001
283600         MOVE DP015-RED            TO AINVDDC                     28360001
283700         MOVE DP015-REVERSE        TO AINVDDH                     28370001
283800         MOVE -1                       TO AINVDDL                 28380001
283900         IF PS-NO-ERROR                                           28390001
284000             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        28400001
284100         END-IF                                                   28410001
284200         SET PS-ERROR              TO TRUE                        28420001
284300     END-IF                                                       28430001
284400                                                                  28440001
284500     IF ASC-NEW-INVC-DTE-YY = SPACES                              28450001
284600         SET DP020-MSG-FATAL       TO TRUE                        28460001
284700*        -- REQUIRED --                                           28470001
284800         MOVE DP015-UNP-ALP-BRT-OFF                               28480001
284900                                   TO AINVYYA                     28490001
285000         MOVE DP015-RED            TO AINVYYC                     28500001
285100         MOVE DP015-REVERSE        TO AINVYYH                     28510001
285200         MOVE -1                       TO AINVYYL                 28520001
285300         IF PS-NO-ERROR                                           28530001
285400             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        28540001
285500         END-IF                                                   28550001
285600         SET PS-ERROR              TO TRUE                        28560001
285700     END-IF                                                       28570001
285800                                                                  28580001
285900     IF AINVMML = -1 OR                                           28590001
286000        AINVDDL = -1 OR                                           28600001
286100        AINVYYL = -1                                              28610001
286200         CONTINUE                                                 28620001
286300     ELSE                                                         28630001
286400         MOVE ASC-NEW-INVC-DTE TO PV-CCYYMMDD-DATE                28640001
286500         PERFORM 3195-EDIT-DATE                                   28650001
286600         MOVE PV-CCYYMMDD-DATE TO ASC-NEW-INVC-DTE                28660001
286700         IF PS-VALID-DATE                                         28670001
286800             IF PV-CCYYMMDD-DATE > ASC-CURRENT-DATE               28680001
286900                AND PS-NO-ERROR                                   28690001
287000                 SET DP020-MSG-FATAL       TO TRUE                28700001
287100*                -- INVOICE DATE > CURRENT DATE; IF INVOICE DATE  28710001
287200*                -- IS TOO FAR INTO THE FUTURE, THERE WILL BE NO  28720001
287300*                -- CHECK RUN DATE FOUND ON THE CHECK DATE IMS DB 28730001
287400*                -- AND THE OTP PROGRAM APKUP253 WILL ABEND.      28740001
287500                 MOVE DP015-UNP-ALP-BRT-OFF                       28750001
287600                                       TO AINVMMA                 28760001
287700                                          AINVDDA                 28770001
287800                                          AINVYYA                 28780001
287900                 MOVE DP015-RED        TO AINVMMC                 28790001
288000                                          AINVDDC                 28800001
288100                                          AINVYYC                 28810001
288200                 MOVE DP015-REVERSE    TO AINVMMH                 28820001
288300                                          AINVDDH                 28830001
288400                                          AINVYYH                 28840001
288500                 MOVE -1               TO AINVMML                 28850001
288600                 IF PS-NO-ERROR                                   28860001
288700                     MOVE PC-TSYMSG-00952  TO DP020-MSG-NUMBER    28870001
288800                 END-IF                                           28880001
288900                 SET PS-ERROR              TO TRUE                28890001
289000             END-IF                                               28900001
289100         ELSE                                                     28910001
289200*        ---- INVALID DATE ----                                   28920001
289300             MOVE DP015-UNP-ALP-BRT-OFF                           28930001
289400                                   TO AINVMMA                     28940001
289500                                      AINVDDA                     28950001
289600                                      AINVYYA                     28960001
289700             MOVE DP015-RED        TO AINVMMC                     28970001
289800                                      AINVDDC                     28980001
289900                                      AINVYYC                     28990001
290000             MOVE DP015-REVERSE    TO AINVMMH                     29000001
290100                                      AINVDDH                     29010001
290200                                      AINVYYH                     29020001
290300             MOVE -1               TO AINVMML                     29030001
290400             IF PS-NO-ERROR                                       29040001
290500                IF PS-INVALID-DATE                                29050001
290600                   MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER      29060001
290700                ELSE                                              29070001
290800                   MOVE PC-TSYMSG-00951  TO DP020-MSG-NUMBER      29080001
290900                END-IF                                            29090001
291000             END-IF                                               29100001
291100             SET PS-ERROR                                         29110001
291200                 DP020-MSG-FATAL   TO TRUE                        29120001
291300         END-IF                                                   29130001
291400     END-IF.                                                      29140001
291500                                                                  29150001
291600*--------------------------------------------------------------*  29160001
291700* PERFORMS EDIT VALIDATIONS ON THE STORE NUMBER                *  29170001
291800*--------------------------------------------------------------*  29180001
291900 3060-EDIT-STR-NBR.                                               29190001
292000                                                                  29200001
292100     IF ASC-ALP-STR-NBR = SPACES                                  29210001
292200         SET DP020-MSG-FATAL       TO TRUE                        29220001
292300*        -- REQUIRED --                                           29230001
292400         MOVE DP015-UNP-ALP-BRT-OFF                               29240001
292500                                   TO ASTRNBRA                    29250001
292600         MOVE DP015-RED            TO ASTRNBRC                    29260001
292700         MOVE DP015-REVERSE        TO ASTRNBRH                    29270001
292800         MOVE -1                       TO ASTRNBRL                29280001
292900         IF PS-NO-ERROR                                           29290001
293000             MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER        29300001
293100         END-IF                                                   29310001
293200         SET PS-ERROR              TO TRUE                        29320001
293300     ELSE                                                         29330001
293400         MOVE ASC-ALP-STR-NBR     TO DP010I-UNEDITED-FIELD        29340001
293500         MOVE 4                   TO DP010I-MAXIMUM-DIGITS        29350001
293600         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      29360001
293700         SET  DP010I-NEGATIVE-NOT-ALLOWED                         29370001
293800                                  TO TRUE                         29380001
293920         CALL DP010I-NUMERIC-EDIT-ROUTINE                         29392003
293930                         USING DP010I-NUMERIC-EDIT-AREA           29393003
294000         IF DP010I-ERROR-DETECTED                                 29400001
294100             SET DP020-MSG-FATAL  TO TRUE                         29410001
294200*            -- MUST BE NUMERIC --                                29420001
294300             MOVE DP015-UNP-ALP-BRT-OFF                           29430001
294400                                  TO ASTRNBRA                     29440001
294500             MOVE DP015-RED       TO ASTRNBRC                     29450001
294600             MOVE DP015-REVERSE   TO ASTRNBRH                     29460001
294700             MOVE -1              TO ASTRNBRL                     29470001
294800             IF PS-NO-ERROR                                       29480001
294900                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         29490001
295000             END-IF                                               29500001
295100             SET PS-ERROR         TO TRUE                         29510001
295200         ELSE                                                     29520001
295300             MOVE DP010I-NUMERIC-FIELD                            29530001
295400                                  TO ASC-NEW-STR-NBR              29540001
295500                                     ASC-ALP-STR-NBR-NUM          29550001
295600             IF ASC-EXPENSE-INVC                                  29560001
295700                 IF NOT ASC-EXPENSE-STR-NBR                       29570001
295800                     SET DP020-MSG-FATAL                          29580001
295900                                      TO TRUE                     29590001
296000                     MOVE DP015-UNP-ALP-BRT-OFF                   29600001
296100                                      TO ASTRNBRA                 29610001
296200                     MOVE DP015-RED   TO ASTRNBRC                 29620001
296300                     MOVE DP015-REVERSE TO ASTRNBRH               29630001
296400                     MOVE -1          TO ASTRNBRL                 29640001
296500                     IF PS-NO-ERROR                               29650001
296600*       -- THIS STORE CANNOT BE SELECTED FOR THIS FUNCTION --     29660001
296700                         MOVE PC-TSYMSG-01567                     29670001
296800                                      TO DP020-MSG-NUMBER         29680001
296900                     END-IF                                       29690001
297000                     SET PS-ERROR     TO TRUE                     29700001
297100                 END-IF                                           29710001
297200             ELSE                                                 29720001
297300                 IF ASC-IMPORT-PO                                 29730001
297400                   AND NOT ASC-IMPORT-MI-STR-NBR                  29740001
297500                     MOVE DP015-UNP-ALP-BRT-OFF                   29750001
297600                                 TO ASTRNBRA                      29760001
297700                     MOVE DP015-RED     TO ASTRNBRC               29770001
297800                     MOVE DP015-REVERSE TO ASTRNBRH               29780001
297900                     MOVE -1     TO ASTRNBRL                      29790001
298000                     IF PS-NO-ERROR                               29800001
298100*       -- THIS STORE CANNOT BE SELECTED FOR THIS FUNCTION --     29810001
298200                         MOVE PC-TSYMSG-01567                     29820001
298300                                 TO DP020-MSG-NUMBER              29830001
298400                     END-IF                                       29840001
298500                     SET PS-ERROR                                 29850001
298600                         DP020-MSG-FATAL                          29860001
298700                                 TO TRUE                          29870001
298800                 ELSE                                             29880001
298900                     PERFORM 3060-DATABASE-EDITS                  29890001
299000                 END-IF                                           29900001
299100             END-IF                                               29910001
299200         END-IF                                                   29920001
299300     END-IF.                                                      29930001
299400                                                                  29940001
299500*--------------------------------------------------------------*  29950001
299600* THIS PARAGRAPH ENSURES THAT THE STORE NUMBER UPDATED OR ADDED*  29960001
299700* BY THE USER IS VALID.                                        *  29970001
299800*                                                              *  29980001
299900* IF THE STORE NUMBER IS UPDATED, IT MUST BE VALID FOR THE     *  29990001
300000* MATCH LEVEL INDICATED.  IF IT IS VALID, THE DC NUMBER IS     *  30000001
300100* UPDATED AUTOMATICALLY BY THE PROGRAM.                        *  30010001
300200*    A) FOR A MATCH LEVEL OF BY-STORE, THE STORE NUMBER CAN BE *  30020001
300300*       UPDATED ONLY WHEN THE LOCATION TYPE CODE IS 'CS' OR    *  30030001
300400*       'DS'.  WITH EITHER LOCATION TYPE CODE, IF THE PO IS NOT*  30040001
300500*       A DIRECT STORE PO (ASC-DIR-STR-IND = 'N'), THE DC      *  30050001
300600*       NUMBER IS MOVED TO THE DC FIELD.  IF THE PO IS A DIRECT*  30060001
300700*       STORE PO, THE STORE NUMBER IS MOVED TO THE DC FIELD.   *  30070001
300800*       DIRECT STORE PURCHASE ORDERS ARE SHIPPED DIRECTLY TO   *  30080001
300900*       THE STORE; NO DC IS INVOLVED.  A LOCATION TYPE CODE OF *  30090001
301000*       'DC' WILL GENERATE AN ERROR MESSAGE SINCE A DC DOES NOT*  30100001
301100*       HAVE A MATCH LEVEL OF BY-STORE.                        *  30110001
301200*    B) FOR A MATCH LEVEL OF BY-DC, THE STORE NUMBER CAN BE    *  30120001
301300*       UPDATED ONLY WHEN THE LOCATION TYPE CODE IS 'DC'.      *  30130001
301400*       IF THE PO IS NOT A DIRECT STORE PO                     *  30140001
301500*       (ASC-DIR-STR-IND = 'N'), THE DC NUMBER IS MOVED TO     *  30150001
301600*       THE DC FIELD.  IF THE PO IS A DIRECT STORE PO, AN ERROR*  30160001
301700*       MESSAGE IS ISSUED SINCE A DC IS NOT A VALID VALUE FOR  *  30170001
301800*       A DIRECT STORE PO.  A LOCATION TYPE CODE OF 'CS' OR    *  30180001
301900*       'DS' WILL ALSO GENERATE AN ERROR MESSAGE SINCE THEY DO *  30190001
302000*       NOT CORRELATE WITH A MATCH LEVEL OF BY-DC.             *  30200001
302100*    C) FOR A MATCH LEVEL OF BY-BULK, THE STORE NUMBER CAN ONLY*  30210001
302200*       BE UPDATED TO A VALUE OF ZEROS.  IF THE PO IS NOT A    *  30220001
302300*       DIRECT STORE PO (ASC-DIR-STR-IND = 'N'), THE STORE     *  30230001
302400*       NUMBER (ALWAYS ZERO) IS MOVED TO THE DC FIELD.  IF THE *  30240001
302500*       PO IS A DIRECT STORE PO, AN ERROR MESSAGE IS ISSUED    *  30250001
302600*       SINCE ZEROS IS NOT A VALID VALUE FOR A DIRECT STORE PO.*  30260001
302700*                                                              *  30270001
302800* WHEN A NEW INVOICE IS ADDED FOR A PO, THE MATCH LEVEL AND DC *  30280001
302900* NUMBER ARE AUTOMATICALLY UPDATED BY THE PROGRAM BASED ON THE *  30290001
303000* STORE NUMBER'S LOCATION TYPE CODE.  HOWEVER, A NEW INVOICE   *  30300001
303100* CAN ONLY BE ADDED IF ITS MATCH LEVEL IS EQUAL TO THE EXISTING*  30310001
303200* INVOICE'S MATCH LEVELS.  FOR EXAMPLE, A NEW INVOICE CANNOT   *  30320001
303300* BE ADDED WITH A MATCH LEVEL OF BY-STORE WHEN THE EXISTING    *  30330001
303400* INVOICES FOR THAT PO HAVE A MATCH LEVEL OF BY-DC.            *  30340001
303500*                                                              *  30350001
303600*    A) IF THE EXISTING INVOICES ARE BY-STORE AND THE NEW      *  30360001
303700*       INVOICE BEING ADDED BY THE USER IS BY-STORE OR THERE   *  30370001
303800*       ARE NO EXISTING INVOICES FOR THAT PO, THE LOCATION TYPE*  30380001
303900*       CODE IS EVALUATED.  IF THE LOCATION TYPE CODE IS 'CS'  *  30390001
304000*       OR 'DS' AND THE PO IS NOT A DIRECT STORE PO            *  30400001
304100*       (ASC-DIR-STR-IND = 'N'), THE DC NUMBER IS MOVED TO     *  30410001
304200*       THE DC FIELD AND THE MATCH LEVEL IS SET TO 'S' FOR     *  30420001
304300*       BY-STORE.  IF THE PO IS A DIRECT STORE PO, THE STORE   *  30430001
304400*       NUMBER IS MOVED TO THE DC FIELD AND THE MATCH LEVEL IS *  30440001
304500*       SET TO 'S' FOR BY-STORE.                               *  30450001
304600*       IF THE EXISTING INVOICES ARE BY-STORE AND THE NEW      *  30460001
304700*       INVOICE BEING ADDED BY THE USER IS NOT BY-STORE, AN    *  30470001
304800*       ERROR MESSAGE IS GENERATED.                            *  30480001
304900*    B) IF THE EXISTING INVOICES ARE BY-DC AND THE NEW INVOICE *  30490001
305000*       BEING ADDED BY THE USER IS BY-DC OR THERE ARE NO       *  30500001
305100*       EXISTING INVOICES FOR THAT PO, THE LOCATION TYPE CODE  *  30510001
305200*       IS EVALUATED.  IF THE LOCATION TYPE CODE IS 'DC' AND   *  30520001
305300*       THE PO IS NOT A DIRECT STORE PO                        *  30530001
305400*       (ASC-DIR-STR-IND = 'N'), THE DC NUMBER IS MOVED TO     *  30540001
305500*       THE DC FIELD AND THE MATCH LEVEL IS SET TO 'D' FOR     *  30550001
305600*       BY-DC.  IF THE PO IS A DIRECT STORE PO, AN ERROR       *  30560001
305700*       MESSAGE IS GENERATED SINCE A DC IS NOT A VALID VALUE   *  30570001
305800*       FOR A DIRECT STORE PO.                                 *  30580001
305900*       IF THE EXISTING INVOICES ARE BY-DC AND THE NEW INVOICE *  30590001
306000*       BEING ADDED BY THE USER IS NOT BY-DC, AN ERROR MESSAGE *  30600001
306100*       IS GENERATED.                                          *  30610001
306200*    C) IF THE EXISTING INVOICES ARE BY-BULK AND THE NEW       *  30620001
306300*       INVOICE BEING ADDED BY THE USER IS BY-BULK OR THERE ARE*  30630001
306400*       NO EXISTING INVOICES FOR THAT PO, THE DIRECT STORE     *  30640001
306500*       INDICATOR IS EVALUATED.  IF THE PO IS NOT A DIRECT     *  30650001
306600*       STORE PO (ASC-DIR-STR-IND = 'N'), THE DC NUMBER IS     *  30660001
306700*       TO ZERO AND THE MATCH LEVEL IS SET TO 'P' FOR BY-BULK. *  30670001
306800*       AN ERROR MESSAGE IS GENERATED IF THE PO IS A DIRECT    *  30680001
306900*       STORE PO SINCE ZERO IS NOT A VALID VALUE FOR A DIRECT  *  30690001
307000*       STORE PO.                                              *  30700001
307100*       IF THE EXISTING INVOICES ARE BY-BULK AND THE NEW       *  30710001
307200*       INVOICE BEING ADDED BY THE USER IS NOT BY-BULK, AN     *  30720001
307300*       ERROR MESSAGE IS GENERATED.                            *  30730001
307400*--------------------------------------------------------------*  30740001
307500 3060-DATABASE-EDITS.                                             30750001
307600                                                                  30760001
307700     PERFORM 3061-COUNT-NON-ZERO-INVC-STR.                        30770001
307800     PERFORM 3061-COUNT-NON-ZERO-INVC-DC.                         30780001
307900     PERFORM 3063-COUNT-ZERO-INVC.                                30790001
308000                                                                  30800001
308100     IF PV-TOTAL-BY-STORE > ZERO                                  30810001
308200        SET PS-BY-STORE         TO TRUE                           30820001
308300     END-IF.                                                      30830001
308400     IF PV-TOTAL-BY-DC > ZERO                                     30840001
308500        SET PS-BY-DC            TO TRUE                           30850001
308600     END-IF.                                                      30860001
308700     IF PV-TOTAL-BY-BULK > ZERO                                   30870001
308800        SET PS-BY-BULK          TO TRUE                           30880001
308900     END-IF.                                                      30890001
309000                                                                  30900001
309100** IF THERE ARE NO EXISTING INVOICES FOR THE PO AT ANY MATCH LEVEL30910001
309200** THE PS-FIRST-INVC IS SET SO THAT A USER CAN ADD THE FIRST      30920001
309300** INVOICE FOR THE PO AT ANY MATCH LEVEL                          30930001
309400     IF PV-TOTAL-BY-STORE = ZERO AND                              30940001
309500        PV-TOTAL-BY-DC = ZERO AND                                 30950001
309600        PV-TOTAL-BY-BULK = ZERO                                   30960001
309700        SET PS-FIRST-INVC       TO TRUE                           30970001
309800     END-IF.                                                      30980001
309900                                                                  30990001
310000     IF PS-BY-STORE AND PS-BY-DC AND PS-BY-BULK                   31000001
310100** WARNING: INVOICES WITH CONFLICTING MATCH LEVELS EXIST FOR      31010001
310200**          THIS PO                                               31020001
310300        MOVE PC-TSYMSG-03524     TO DP020-MSG-NUMBER              31030001
310400        SET DP020-MSG-WARNING    TO TRUE                          31040001
310500     END-IF.                                                      31050001
310600                                                                  31060001
310700     IF ASC-UPDATE-PENDING                                        31070001
310800        IF ASC-ALP-STR-NBR-NUM > ZERO                             31080001
310900           PERFORM 3062-VALIDATE-STORE                            31090001
311000           IF PS-BY-STORE                                         31100001
311100              EVALUATE XFT00017-LOC-TYP-CDE                       31110001
311200                WHEN 'CS'                                         31120001
311300                  IF ASC-DIR-STR-IND = 'N'                        31130001
311400                     MOVE XFT00017-DIST-NBR TO ASC-NEW-DC-NBR     31140001
311500                  ELSE                                            31150001
311600                     MOVE XFT00017-LOC-NBR  TO ASC-NEW-DC-NBR     31160001
311700                  END-IF                                          31170001
311800                WHEN 'DS'                                         31180001
311900                  IF ASC-DIR-STR-IND = 'N'                        31190001
312000                     PERFORM 3062-DETERMINE-DC-NBR                31200001
312100                     MOVE XFT00018-DC-NBR   TO ASC-NEW-DC-NBR     31210001
312200                  ELSE                                            31220001
312300                     MOVE XFT00017-LOC-NBR  TO ASC-NEW-DC-NBR     31230001
312400                  END-IF                                          31240001
312500                WHEN 'DC'                                         31250001
312600                  MOVE DP015-UNP-ALP-BRT-OFF  TO ASTRNBRA         31260001
312700                  MOVE DP015-RED              TO ASTRNBRC         31270001
312800                  MOVE DP015-REVERSE          TO ASTRNBRH         31280001
312900                  MOVE -1                     TO ASTRNBRL         31290001
313000                  IF ASC-DIR-STR-IND = 'N'                        31300001
313100                     IF PS-NO-ERROR                               31310001
313200**  ERROR: INVALID STORE NUMBER FOR S MATCH LEVEL                 31320001
313300                        MOVE PC-TSYMSG-03525                      31330001
313400                          TO DP020-MSG-NUMBER                     31340001
313500                        SET DP020-MSG-FATAL      TO TRUE          31350001
313600                        SET PS-ERROR             TO TRUE          31360001
313700                     END-IF                                       31370001
313800                  ELSE                                            31380001
313900                     IF PS-NO-ERROR                               31390001
314000**  ERROR: INVALID STORE NUMBER FOR DIRECT STORE PO               31400001
314100                        MOVE PC-TSYMSG-03531                      31410001
314200                          TO DP020-MSG-NUMBER                     31420001
314300                        SET DP020-MSG-FATAL    TO TRUE            31430001
314400                        SET PS-ERROR           TO TRUE            31440001
314500                     END-IF                                       31450001
314600                  END-IF                                          31460001
314700              END-EVALUATE                                        31470001
314800           ELSE                                                   31480001
314900              IF PS-BY-DC                                         31490001
315000                 EVALUATE XFT00017-LOC-TYP-CDE                    31500001
315100                   WHEN 'DC'                                      31510001
315200                     IF ASC-DIR-STR-IND = 'N'                     31520001
315300                        MOVE XFT00017-LOC-NBR    TO ASC-NEW-DC-NBR31530001
315400                     ELSE                                         31540001
315500                        MOVE DP015-UNP-ALP-BRT-OFF TO ASTRNBRA    31550001
315600                        MOVE DP015-RED             TO ASTRNBRC    31560001
315700                        MOVE DP015-REVERSE         TO ASTRNBRH    31570001
315800                        MOVE -1                    TO ASTRNBRL    31580001
315900                        IF PS-NO-ERROR                            31590001
316000**  ERROR: INVALID STORE NUMBER FOR DIRECT STORE PO               31600001
316100                           MOVE PC-TSYMSG-03531                   31610001
316200                             TO DP020-MSG-NUMBER                  31620001
316300                           SET DP020-MSG-FATAL TO TRUE            31630001
316400                           SET PS-ERROR        TO TRUE            31640001
316500                        END-IF                                    31650001
316600                     END-IF                                       31660001
316700                   WHEN OTHER                                     31670001
316800                     MOVE DP015-UNP-ALP-BRT-OFF  TO ASTRNBRA      31680001
316900                     MOVE DP015-RED              TO ASTRNBRC      31690001
317000                     MOVE DP015-REVERSE          TO ASTRNBRH      31700001
317100                     MOVE -1                     TO ASTRNBRL      31710001
317200                     IF PS-NO-ERROR                               31720001
317300**  ERROR: INVALID STORE NUMBER FOR D MATCH LEVEL                 31730001
317400                        MOVE PC-TSYMSG-03526 TO DP020-MSG-NUMBER  31740001
317500                        SET DP020-MSG-FATAL  TO TRUE              31750001
317600                        SET PS-ERROR         TO TRUE              31760001
317700                     END-IF                                       31770001
317800                 END-EVALUATE                                     31780001
317900              ELSE                                                31790001
318000                 IF PS-BY-BULK                                    31800001
318100                    MOVE DP015-PRO-NOR-OFF       TO ASTRNBRA      31810001
318200                    MOVE DP015-BLUE              TO ASTRNBRC      31820001
318300                    MOVE DP015-HL-OFF            TO ASTRNBRH      31830001
318400                 END-IF                                           31840001
318500              END-IF                                              31850001
318600           END-IF                                                 31860001
318700        ELSE                                                      31870001
318800           IF ASC-ALP-STR-NBR-NUM = ZERO                          31880001
318900              IF PS-BY-STORE                                      31890001
319000                 MOVE DP015-UNP-ALP-BRT-OFF      TO ASTRNBRA      31900001
319100                 MOVE DP015-RED                  TO ASTRNBRC      31910001
319200                 MOVE DP015-REVERSE              TO ASTRNBRH      31920001
319300                 MOVE -1                         TO ASTRNBRL      31930001
319400                 IF ASC-DIR-STR-IND = 'N'                         31940001
319500                    IF PS-NO-ERROR                                31950001
319600**  ERROR: INVALID STORE NUMBER FOR S MATCH LEVEL                 31960001
319700                      MOVE PC-TSYMSG-03525                        31970001
319800                        TO DP020-MSG-NUMBER                       31980001
319900                       SET DP020-MSG-FATAL      TO TRUE           31990001
320000                       SET PS-ERROR             TO TRUE           32000001
320100                    END-IF                                        32010001
320200                 ELSE                                             32020001
320300                    IF PS-NO-ERROR                                32030001
320400** ERROR: INVALID STORE NUMBER FOR DIRECT STORE PO                32040001
320500                       MOVE PC-TSYMSG-03531                       32050001
320600                         TO DP020-MSG-NUMBER                      32060001
320700                       SET DP020-MSG-FATAL      TO TRUE           32070001
320800                       SET PS-ERROR             TO TRUE           32080001
320900                    END-IF                                        32090001
321000                 END-IF                                           32100001
321100              ELSE                                                32110001
321200                 IF PS-BY-DC                                      32120001
321300                    MOVE DP015-UNP-ALP-BRT-OFF   TO ASTRNBRA      32130001
321400                    MOVE DP015-RED               TO ASTRNBRC      32140001
321500                    MOVE DP015-REVERSE           TO ASTRNBRH      32150001
321600                    MOVE -1                      TO ASTRNBRL      32160001
321700                    IF ASC-DIR-STR-IND = 'N'                      32170001
321800                       IF PS-NO-ERROR                             32180001
321900**  ERROR: INVALID STORE NUMBER FOR D MATCH LEVEL                 32190001
322000                         MOVE PC-TSYMSG-03526                     32200001
322100                           TO DP020-MSG-NUMBER                    32210001
322200                          SET DP020-MSG-FATAL    TO TRUE          32220001
322300                          SET PS-ERROR           TO TRUE          32230001
322400                       END-IF                                     32240001
322500                    ELSE                                          32250001
322600                       IF PS-NO-ERROR                             32260001
322700** ERROR: INVALID STORE NUMBER FOR DIRECT STORE PO                32270001
322800                          MOVE PC-TSYMSG-03531                    32280001
322900                            TO DP020-MSG-NUMBER                   32290001
323000                          SET DP020-MSG-FATAL   TO TRUE           32300001
323100                          SET PS-ERROR          TO TRUE           32310001
323200                       END-IF                                     32320001
323300                    END-IF                                        32330001
323400                 ELSE                                             32340001
323500                    IF PS-BY-BULK                                 32350001
323600                       IF ASC-DIR-STR-IND = 'N'                   32360001
323700                          MOVE ASC-ALP-STR-NBR-NUM                32370001
323800                            TO ASC-NEW-DC-NBR                     32380001
323900                       ELSE                                       32390001
324000                          MOVE DP015-PRO-NOR-OFF     TO ASTRNBRA  32400001
324100                          MOVE DP015-BLUE            TO ASTRNBRC  32410001
324200                          MOVE DP015-HL-OFF          TO ASTRNBRH  32420001
324300                          MOVE -1                    TO ASTRNBRL  32430001
324400                       END-IF                                     32440001
324500                    END-IF                                        32450001
324600                 END-IF                                           32460001
324700              END-IF                                              32470001
324800           END-IF                                                 32480001
324900        END-IF                                                    32490001
325000     END-IF.                                                      32500001
325100                                                                  32510001
325200     IF ASC-ADD-REQUESTED                                         32520001
325300        IF ASC-ALP-STR-NBR-NUM > ZERO                             32530001
325400           PERFORM 3062-VALIDATE-STORE                            32540001
325500           IF SQLCODE = +0                                        32550001
325600              EVALUATE XFT00017-LOC-TYP-CDE                       32560001
325700                WHEN 'CS'                                         32570001
325800                  IF PS-BY-STORE OR PS-FIRST-INVC                 32580001
325900                     IF ASC-DIR-STR-IND = 'N'                     32590001
326000                        MOVE XFT00017-DIST-NBR  TO ASC-NEW-DC-NBR 32600001
326100                     ELSE                                         32610001
326200                        MOVE XFT00017-LOC-NBR   TO ASC-NEW-DC-NBR 32620001
326300                     END-IF                                       32630001
326400                     MOVE PC-STR-MTCH-LVL TO ASC-MTCH-LVL-CDE     32640001
326500                  ELSE                                            32650001
326600                     MOVE DP015-UNP-ALP-BRT-OFF   TO ASTRNBRA     32660001
326700                     MOVE DP015-RED               TO ASTRNBRC     32670001
326800                     MOVE DP015-REVERSE           TO ASTRNBRH     32680001
326900                     MOVE -1                      TO ASTRNBRL     32690001
327000                     IF PS-NO-ERROR                               32700001
327100** ERROR: MATCH LEVEL CONFLICTS WITH THE MATCH LEVEL OF EXISTING  32710001
327200**        INVOICES FOR THIS PO                                    32720001
327300                        MOVE PC-TSYMSG-03532                      32730001
327400                          TO DP020-MSG-NUMBER                     32740001
327500                        SET DP020-MSG-FATAL      TO TRUE          32750001
327600                        SET PS-ERROR             TO TRUE          32760001
327700                     END-IF                                       32770001
327800                  END-IF                                          32780001
327900                WHEN 'DS'                                         32790001
328000                  IF PS-BY-STORE OR PS-FIRST-INVC                 32800001
328100                     IF ASC-DIR-STR-IND = 'N'                     32810001
328200                        PERFORM 3062-DETERMINE-DC-NBR             32820001
328300                        MOVE XFT00018-DC-NBR    TO ASC-NEW-DC-NBR 32830001
328400                     ELSE                                         32840001
328500                        MOVE XFT00017-LOC-NBR   TO ASC-NEW-DC-NBR 32850001
328600                     END-IF                                       32860001
328700                     MOVE PC-STR-MTCH-LVL    TO ASC-MTCH-LVL-CDE  32870001
328800                  ELSE                                            32880001
328900                     MOVE DP015-UNP-ALP-BRT-OFF   TO ASTRNBRA     32890001
329000                     MOVE DP015-RED               TO ASTRNBRC     32900001
329100                     MOVE DP015-REVERSE           TO ASTRNBRH     32910001
329200                     MOVE -1                      TO ASTRNBRL     32920001
329300                     IF PS-NO-ERROR                               32930001
329400** ERROR: MATCH LEVEL CONFLICTS WITH THE MATCH LEVEL OF EXISTING  32940001
329500**        INVOICES FOR THIS PO                                    32950001
329600                        MOVE PC-TSYMSG-03532                      32960001
329700                          TO DP020-MSG-NUMBER                     32970001
329800                        SET DP020-MSG-FATAL      TO TRUE          32980001
329900                        SET PS-ERROR             TO TRUE          32990001
330000                     END-IF                                       33000001
330100                  END-IF                                          33010001
330200                WHEN 'DC'                                         33020001
330300                  IF PS-BY-DC OR PS-FIRST-INVC                    33030001
330400                     IF ASC-DIR-STR-IND = 'N'                     33040001
330500                        MOVE XFT00017-DIST-NBR  TO ASC-NEW-DC-NBR 33050001
330600                        MOVE PC-DC-MTCH-LVL                       33060001
330700                          TO ASC-MTCH-LVL-CDE                     33070001
330800                     ELSE                                         33080001
330900                        MOVE DP015-UNP-ALP-BRT-OFF  TO ASTRNBRA   33090001
331000                        MOVE DP015-RED              TO ASTRNBRC   33100001
331100                        MOVE DP015-REVERSE          TO ASTRNBRH   33110001
331200                        MOVE -1                     TO ASTRNBRL   33120001
331300                        IF PS-NO-ERROR                            33130001
331400** ERROR: INVALID STORE NUMBER FOR DIRECT STORE PO                33140001
331500                           MOVE PC-TSYMSG-03531                   33150001
331600                             TO DP020-MSG-NUMBER                  33160001
331700                           SET DP020-MSG-FATAL      TO TRUE       33170001
331800                           SET PS-ERROR             TO TRUE       33180001
331900                        END-IF                                    33190001
332000                     END-IF                                       33200001
332100                  ELSE                                            33210001
332200                     MOVE DP015-UNP-ALP-BRT-OFF  TO ASTRNBRA      33220001
332300                     MOVE DP015-RED              TO ASTRNBRC      33230001
332400                     MOVE DP015-REVERSE          TO ASTRNBRH      33240001
332500                     MOVE -1                     TO ASTRNBRL      33250001
332600                     IF PS-NO-ERROR                               33260001
332700** ERROR: MATCH LEVEL CONFLICTS WITH THE MATCH LEVEL OF EXISTING  33270001
332800**        INVOICES FOR THIS PO                                    33280001
332900                        MOVE PC-TSYMSG-03532                      33290001
333000                          TO DP020-MSG-NUMBER                     33300001
333100                        SET DP020-MSG-FATAL      TO TRUE          33310001
333200                        SET PS-ERROR             TO TRUE          33320001
333300                     END-IF                                       33330001
333400                  END-IF                                          33340001
333500              END-EVALUATE                                        33350001
333600           ELSE                                                   33360001
333700              MOVE DP015-UNP-ALP-BRT-OFF   TO ASTRNBRA            33370001
333800              MOVE DP015-RED               TO ASTRNBRC            33380001
333900              MOVE DP015-REVERSE           TO ASTRNBRH            33390001
334000              MOVE -1                      TO ASTRNBRL            33400001
334100              IF PS-NO-ERROR                                      33410001
334200** ERROR: STORE NUMBER IS NOT VALID FOR THIS INVOICE TYPE         33420001
334300                 MOVE PC-TSYMSG-01567      TO DP020-MSG-NUMBER    33430001
334400                 SET DP020-MSG-FATAL       TO TRUE                33440001
334500                 SET PS-ERROR              TO TRUE                33450001
334600              END-IF                                              33460001
334700        ELSE                                                      33470001
334800           IF ASC-ALP-STR-NBR-NUM = ZERO                          33480001
334900              IF PS-BY-BULK OR PS-FIRST-INVC                      33490001
335000                 IF ASC-DIR-STR-IND = 'N'                         33500001
335100                    MOVE ASC-ALP-STR-NBR-NUM TO ASC-NEW-DC-NBR    33510001
335200                    MOVE PC-BULK-MTCH-LVL    TO ASC-MTCH-LVL-CDE  33520001
335300                 ELSE                                             33530001
335400                    MOVE DP015-UNP-ALP-BRT-OFF TO ASTRNBRA        33540001
335500                    MOVE DP015-RED             TO ASTRNBRC        33550001
335600                    MOVE DP015-REVERSE         TO ASTRNBRH        33560001
335700                    MOVE -1                    TO ASTRNBRL        33570001
335800                    IF PS-NO-ERROR                                33580001
335900** ERROR: INVALID STORE NUMBER FOR DIRECT STORE PO                33590001
336000                       MOVE PC-TSYMSG-03531                       33600001
336100                         TO DP020-MSG-NUMBER                      33610001
336200                       SET DP020-MSG-FATAL     TO TRUE            33620001
336300                       SET PS-ERROR            TO TRUE            33630001
336400                    END-IF                                        33640001
336500                 END-IF                                           33650001
336600              ELSE                                                33660001
336700                 MOVE DP015-UNP-ALP-BRT-OFF   TO ASTRNBRA         33670001
336800                 MOVE DP015-RED               TO ASTRNBRC         33680001
336900                 MOVE DP015-REVERSE           TO ASTRNBRH         33690001
337000                 MOVE -1                      TO ASTRNBRL         33700001
337100                 IF PS-NO-ERROR                                   33710001
337200** ERROR: MATCH LEVEL CONFLICTS WITH THE MATCH LEVEL OF EXISTING  33720001
337300**        INVOICES FOR THIS PO                                    33730001
337400                    MOVE PC-TSYMSG-03532                          33740001
337500                      TO DP020-MSG-NUMBER                         33750001
337600                    SET DP020-MSG-FATAL       TO TRUE             33760001
337700                    SET PS-ERROR              TO TRUE             33770001
337800                 END-IF                                           33780001
337900              END-IF                                              33790001
338000           END-IF                                                 33800001
338100        END-IF                                                    33810001
338200     END-IF.                                                      33820001
338300                                                                  33830001
338400*----------------------------------------------------------------*33840001
338500* COUNT NUMBER OF NON-ZERO STORES ON TABLE WITH A MATCH LEVEL OF *33850001
338600* 'S'.                                                           *33860001
338700*----------------------------------------------------------------*33870001
338800 3061-COUNT-NON-ZERO-INVC-STR.                                    33880001
338900                                                                  33890001
339000     INITIALIZE PV-TOTAL-BY-STORE.                                33900001
339100     PERFORM                                                      33910001
339200         WITH TEST AFTER                                          33920001
339300         VARYING PV-RETRY-COUNTER                                 33930001
339400         FROM 1 BY 1                                              33940001
339500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               33950001
339600                   OR (SQLCODE = ZERO)                            33960001
339700                   OR (SQLCODE = +100))                           33970001
339800                                                                  33980001
339900         EXEC SQL                                                 33990001
340000             SELECT COUNT(*)                                      34000001
340100             INTO   :PV-TOTAL-BY-STORE                            34010001
340200             FROM   TINVOIC B                                     34020001
340300             WHERE  B.PO_NBR           = :ASC-NEW-PO-NBR          34030001
340400               AND  B.MTCH_LVL_CDE     = 'S'                      34040001
340500               AND  B.INVC_TYP_CDE     ^= 'EI'                    34050001
340600               AND  B.STATUS_CDE      IN ('EN','RC','OB','IB'     34060001
0523RM*                                        ,'RL','BM')              34070013
0523RM                                         ,'RL','BM','PJ')         34071013
340800         END-EXEC                                                 34080001
340900                                                                  34090001
341000         EVALUATE TRUE                                            34100001
341100             WHEN SQLCODE = ZERO                                  34110001
341200             WHEN SQLCODE = -904                                  34120001
341300             WHEN SQLCODE = -913                                  34130001
341400                 CONTINUE                                         34140001
341500             WHEN SQLCODE = +100                                  34150001
341600                 MOVE +0         TO PV-TOTAL-BY-STORE             34160001
341700             WHEN SQLWARN0 NOT = SPACES                           34170001
341800             WHEN SQLCODE < ZERO                                  34180001
341900             WHEN SQLCODE > ZERO                                  34190001
342000                 MOVE '3061-COUNT-NON-ZERO-INVC-STR'              34200001
342100                                   TO DP013-PARAGRAPH             34210001
342200                 MOVE 'SELECT INVC COUNT      '                   34220001
342300                                   TO DP013-MESSAGE-TEXT (1)      34230001
342400                 MOVE SQLCA        TO DP013-SQLCA                 34240001
342500                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    34250001
342600                 SET DP013-DB2-ABEND                              34260001
342700                     DP013-XCTL-DISPLAY-RESTART                   34270001
342800                                   TO TRUE                        34280001
342900                 PERFORM DP013-0000-PROCESS-ABEND                 34290001
343000         END-EVALUATE                                             34300001
343100     END-PERFORM.                                                 34310001
343200                                                                  34320001
343300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34330001
343400         MOVE '3061-COUNT-NON-ZERO-INVC-STR'                      34340001
343500                                   TO DP013-PARAGRAPH             34350001
343600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     34360001
343700                                   TO DP013-MESSAGE-TEXT (1)      34370001
343800         MOVE 'INVOICES     '      TO DP013-MESSAGE-TEXT (2)      34380001
343900         MOVE SQLCA                TO DP013-SQLCA                 34390001
344000         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    34400001
344100         SET DP013-DB2-ABEND                                      34410001
344200             DP013-XCTL-DISPLAY-RESTART                           34420001
344300                                   TO TRUE                        34430001
344400         PERFORM DP013-0000-PROCESS-ABEND                         34440001
344500     END-IF.                                                      34450001
344600                                                                  34460001
344700*----------------------------------------------------------------*34470001
344800* COUNT NUMBER OF NON-ZERO STORES ON TABLE WITH A MATCH LEVEL OF *34480001
344900* 'D'.                                                           *34490001
345000*----------------------------------------------------------------*34500001
345100 3061-COUNT-NON-ZERO-INVC-DC.                                     34510001
345200                                                                  34520001
345300     INITIALIZE PV-TOTAL-BY-DC.                                   34530001
345400     PERFORM                                                      34540001
345500         WITH TEST AFTER                                          34550001
345600         VARYING PV-RETRY-COUNTER                                 34560001
345700         FROM 1 BY 1                                              34570001
345800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               34580001
345900                   OR (SQLCODE = ZERO)                            34590001
346000                   OR (SQLCODE = +100))                           34600001
346100                                                                  34610001
346200         EXEC SQL                                                 34620001
346300             SELECT COUNT(*)                                      34630001
346400             INTO   :PV-TOTAL-BY-DC                               34640001
346500             FROM   TINVOIC B                                     34650001
346600             WHERE  B.PO_NBR           = :ASC-NEW-PO-NBR          34660001
346700               AND  B.MTCH_LVL_CDE     = 'D'                      34670001
346800               AND  B.INVC_TYP_CDE     ^= 'EI'                    34680001
346900               AND  B.STATUS_CDE      IN ('EN','RC','OB','IB'     34690001
0523RM*                                        ,'RL','BM')              34700013
0523RM                                         ,'RL','BM','PJ')         34701013
347100* ADDED 'RL' & 'BM' 5-23-97                                       34710001
347100* ADDED 'PJ' 5-17-23                                              34711013
347200         END-EXEC                                                 34720001
347300                                                                  34730001
347400         EVALUATE TRUE                                            34740001
347500             WHEN SQLCODE = ZERO                                  34750001
347600             WHEN SQLCODE = -904                                  34760001
347700             WHEN SQLCODE = -913                                  34770001
347800                 CONTINUE                                         34780001
347900             WHEN SQLCODE = +100                                  34790001
348000                 MOVE +0         TO PV-TOTAL-BY-DC                34800001
348100             WHEN SQLWARN0 NOT = SPACES                           34810001
348200             WHEN SQLCODE < ZERO                                  34820001
348300             WHEN SQLCODE > ZERO                                  34830001
348400                 MOVE '3061-COUNT-NON-ZERO-INVC-DC'               34840001
348500                                   TO DP013-PARAGRAPH             34850001
348600                 MOVE 'SELECT INVC COUNT      '                   34860001
348700                                   TO DP013-MESSAGE-TEXT (1)      34870001
348800                 MOVE SQLCA        TO DP013-SQLCA                 34880001
348900                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    34890001
349000                 SET DP013-DB2-ABEND                              34900001
349100                     DP013-XCTL-DISPLAY-RESTART                   34910001
349200                                   TO TRUE                        34920001
349300                 PERFORM DP013-0000-PROCESS-ABEND                 34930001
349400         END-EVALUATE                                             34940001
349500     END-PERFORM.                                                 34950001
349600                                                                  34960001
349700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34970001
349800         MOVE '3061-COUNT-NON-ZERO-INVC-DC'                       34980001
349900                                   TO DP013-PARAGRAPH             34990001
350000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     35000001
350100                                   TO DP013-MESSAGE-TEXT (1)      35010001
350200         MOVE 'INVOICES     '      TO DP013-MESSAGE-TEXT (2)      35020001
350300         MOVE SQLCA                TO DP013-SQLCA                 35030001
350400         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    35040001
350500         SET DP013-DB2-ABEND                                      35050001
350600             DP013-XCTL-DISPLAY-RESTART                           35060001
350700                                   TO TRUE                        35070001
350800         PERFORM DP013-0000-PROCESS-ABEND                         35080001
350900     END-IF.                                                      35090001
351000                                                                  35100001
351100*----------------------------------------------------------------*35110001
351200* CHECK IF VALID STORE NUMBER                                    *35120001
351300*----------------------------------------------------------------*35130001
351400 3062-VALIDATE-STORE.                                             35140001
351500                                                                  35150001
351600     MOVE ASC-ALP-STR-NBR-NUM TO XFT00017-LOC-NBR.                35160001
351700                                                                  35170001
351800     PERFORM                                                      35180001
351900         WITH TEST AFTER                                          35190001
352000         VARYING PV-RETRY-COUNTER                                 35200001
352100         FROM 1 BY 1                                              35210001
352200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               35220001
352300                   OR (SQLCODE = ZERO)                            35230001
352400                   OR (SQLCODE = +100))                           35240001
352500                                                                  35250001
352600         EXEC SQL                                                 35260001
352700           SELECT LOC_TYP_CDE                                     35270001
352800                , DIST_NBR                                        35280001
352900                , LOC_NBR                                         35290001
353000             INTO :XFT00017-LOC-TYP-CDE                           35300001
353100                , :XFT00017-DIST-NBR                              35310001
353200                , :XFT00017-LOC-NBR                               35320001
353300             FROM XFT_LOC                                         35330001
353400             WHERE LOC_NBR = :XFT00017-LOC-NBR                    35340001
353500               AND LOC_TYP_CDE IN ('DS','CS','DC')                35350001
353600               AND CURRENT DATE <= FINCL_CLO_DTE                  35360001
353700         END-EXEC                                                 35370001
353800                                                                  35380001
353900         EVALUATE TRUE                                            35390001
354000             WHEN SQLCODE = ZERO                                  35400001
354100             WHEN SQLCODE = +100                                  35410001
354200             WHEN SQLCODE = -904                                  35420001
354300             WHEN SQLCODE = -913                                  35430001
354400                 CONTINUE                                         35440001
354500             WHEN SQLWARN0 NOT = SPACES                           35450001
354600             WHEN SQLCODE < ZERO                                  35460001
354700             WHEN SQLCODE > ZERO                                  35470001
354800                 MOVE '3062-VALIDATE-STORE'                       35480001
354900                                   TO DP013-PARAGRAPH             35490001
355000                 MOVE 'SELECT STORE           '                   35500001
355100                                   TO DP013-MESSAGE-TEXT (1)      35510001
355200                 MOVE SQLCA        TO DP013-SQLCA                 35520001
355300                 MOVE 'XFT00017'   TO DP013-DB2-TABLE-NAME (1)    35530001
355400                 MOVE 'XFT00018'   TO DP013-DB2-TABLE-NAME (2)    35540001
355500                 SET DP013-DB2-ABEND                              35550001
355600                     DP013-XCTL-DISPLAY-RESTART                   35560001
355700                                   TO TRUE                        35570001
355800                 PERFORM DP013-0000-PROCESS-ABEND                 35580001
355900         END-EVALUATE                                             35590001
356000     END-PERFORM.                                                 35600001
356100                                                                  35610001
356200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        35620001
356300         MOVE '3062-VALIDATE-STORE'                               35630001
356400                                   TO DP013-PARAGRAPH             35640001
356500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     35650001
356600                                   TO DP013-MESSAGE-TEXT (1)      35660001
356700         MOVE 'STORE        '      TO DP013-MESSAGE-TEXT (2)      35670001
356800         MOVE SQLCA                TO DP013-SQLCA                 35680001
356900         MOVE 'XFT00017'           TO DP013-DB2-TABLE-NAME (1)    35690001
357000         MOVE 'XFT00018'           TO DP013-DB2-TABLE-NAME (2)    35700001
357100         SET DP013-DB2-ABEND                                      35710001
357200             DP013-XCTL-DISPLAY-RESTART                           35720001
357300                                   TO TRUE                        35730001
357400         PERFORM DP013-0000-PROCESS-ABEND                         35740001
357500     END-IF.                                                      35750001
357600                                                                  35760001
357700*----------------------------------------------------------------*35770001
357800* DETERMINE THE DC NUMBER IF THE LOC_TYP_CDE IS 'DS'             *35780001
357900*----------------------------------------------------------------*35790001
358000 3062-DETERMINE-DC-NBR.                                           35800001
358100                                                                  35810001
358200     MOVE ASC-ALP-STR-NBR-NUM   TO XFT00018-LOC-NBR.              35820001
358300                                                                  35830001
358400     PERFORM                                                      35840001
358500         WITH TEST AFTER                                          35850001
358600         VARYING PV-RETRY-COUNTER                                 35860001
358700         FROM 1 BY 1                                              35870001
358800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               35880001
358900                   OR (SQLCODE = ZERO)                            35890001
359000                   OR (SQLCODE = +100))                           35900001
359100                                                                  35910001
359200         EXEC SQL                                                 35920001
359300           SELECT DC_NBR                                          35930001
359400            INTO :XFT00018-DC-NBR                                 35940001
359500            FROM XFT_LOC_ASGMT A                                  35950001
359600           WHERE A.LOC_NBR = :XFT00018-LOC-NBR                    35960001
359700             AND CURRENT DATE >= A.PO_STRT_DTE                    35970001
359800             AND A.EFF_BEG_DTE =                                  35980001
359900                      (SELECT MAX(A1.EFF_BEG_DTE)                 35990001
360000                         FROM XFT_LOC_ASGMT A1                    36000001
360100                        WHERE A1.LOC_NBR = A.LOC_NBR              36010001
360200                          AND A1.EFF_BEG_DTE <=                   36020001
360300                             :PLNSHP-CAN-IFNOT-SHIP-DTE)          36030001
360400         END-EXEC                                                 36040001
360500                                                                  36050001
360600         EVALUATE TRUE                                            36060001
360700             WHEN SQLCODE = ZERO                                  36070001
360800             WHEN SQLCODE = +100                                  36080001
360900             WHEN SQLCODE = -904                                  36090001
361000             WHEN SQLCODE = -913                                  36100001
361100                 CONTINUE                                         36110001
361200             WHEN SQLWARN0 NOT = SPACES                           36120001
361300             WHEN SQLCODE < ZERO                                  36130001
361400             WHEN SQLCODE > ZERO                                  36140001
361500                 MOVE '3062-VALIDATE-DC-XFT-LOC'                  36150001
361600                                   TO DP013-PARAGRAPH             36160001
361700                 MOVE 'SELECT DC              '                   36170001
361800                                   TO DP013-MESSAGE-TEXT (1)      36180001
361900                 MOVE SQLCA        TO DP013-SQLCA                 36190001
362000                 MOVE 'XFT00017'   TO DP013-DB2-TABLE-NAME (1)    36200001
362100                 MOVE SPACES       TO DP013-DB2-TABLE-NAME (2)    36210001
362200                 SET DP013-DB2-ABEND                              36220001
362300                     DP013-XCTL-DISPLAY-RESTART                   36230001
362400                                   TO TRUE                        36240001
362500                 PERFORM DP013-0000-PROCESS-ABEND                 36250001
362600         END-EVALUATE                                             36260001
362700     END-PERFORM.                                                 36270001
362800                                                                  36280001
362900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        36290001
363000         MOVE '3062-VALIDATE-DC-XFT-LOC'                          36300001
363100                                   TO DP013-PARAGRAPH             36310001
363200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     36320001
363300                                   TO DP013-MESSAGE-TEXT (1)      36330001
363400         MOVE 'DC           '      TO DP013-MESSAGE-TEXT (2)      36340001
363500         MOVE SQLCA                TO DP013-SQLCA                 36350001
363600         MOVE 'XFT00017'           TO DP013-DB2-TABLE-NAME (1)    36360001
363700         MOVE SPACES               TO DP013-DB2-TABLE-NAME (2)    36370001
363800         SET DP013-DB2-ABEND                                      36380001
363900             DP013-XCTL-DISPLAY-RESTART                           36390001
364000                                   TO TRUE                        36400001
364100         PERFORM DP013-0000-PROCESS-ABEND                         36410001
364200     END-IF.                                                      36420001
364300                                                                  36430001
364400*----------------------------------------------------------------*36440001
364500* COUNT NUMBER OF ZERO STORES ON TABLE                           *36450001
364600*----------------------------------------------------------------*36460001
364700 3063-COUNT-ZERO-INVC.                                            36470001
364800                                                                  36480001
364900     INITIALIZE PV-TOTAL-BY-BULK.                                 36490001
365000     PERFORM                                                      36500001
365100         WITH TEST AFTER                                          36510001
365200         VARYING PV-RETRY-COUNTER                                 36520001
365300         FROM 1 BY 1                                              36530001
365400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               36540001
365500                   OR (SQLCODE = ZERO)                            36550001
365600                   OR (SQLCODE = +100))                           36560001
365700                                                                  36570001
365800         EXEC SQL                                                 36580001
365900             SELECT COUNT(*)                                      36590001
366000             INTO   :PV-TOTAL-BY-BULK                             36600001
366100             FROM   TINVOIC B                                     36610001
366200             WHERE  B.PO_NBR           = :ASC-NEW-PO-NBR          36620001
366300               AND  B.MTCH_LVL_CDE     = 'P'                      36630001
366400               AND  B.INVC_TYP_CDE     ^= 'EI'                    36640001
366500               AND  B.STATUS_CDE      IN ('EN','RC','OB','IB'     36650001
366600                                         ,'RL','BM')              36660001
366700* ADDED 'RL' & 'BM' 5-23-97                                       36670001
366800         END-EXEC                                                 36680001
366900                                                                  36690001
367000         EVALUATE TRUE                                            36700001
367100             WHEN SQLCODE = ZERO                                  36710001
367200             WHEN SQLCODE = -904                                  36720001
367300             WHEN SQLCODE = -913                                  36730001
367400                 CONTINUE                                         36740001
367500             WHEN SQLCODE = +100                                  36750001
367600                 MOVE +0         TO PV-TOTAL-BY-BULK              36760001
367700             WHEN SQLWARN0 NOT = SPACES                           36770001
367800             WHEN SQLCODE < ZERO                                  36780001
367900             WHEN SQLCODE > ZERO                                  36790001
368000                 MOVE '3063-COUNT-ZERO-INVC'                      36800001
368100                                   TO DP013-PARAGRAPH             36810001
368200                 MOVE 'SELECT INVC COUNT      '                   36820001
368300                                   TO DP013-MESSAGE-TEXT (1)      36830001
368400                 MOVE SQLCA        TO DP013-SQLCA                 36840001
368500                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    36850001
368600                 SET DP013-DB2-ABEND                              36860001
368700                     DP013-XCTL-DISPLAY-RESTART                   36870001
368800                                   TO TRUE                        36880001
368900                 PERFORM DP013-0000-PROCESS-ABEND                 36890001
369000         END-EVALUATE                                             36900001
369100     END-PERFORM.                                                 36910001
369200                                                                  36920001
369300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        36930001
369400         MOVE '3063-COUNT-ZERO-INVC'                              36940001
369500                                   TO DP013-PARAGRAPH             36950001
369600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     36960001
369700                                   TO DP013-MESSAGE-TEXT (1)      36970001
369800         MOVE 'INVOICES     '      TO DP013-MESSAGE-TEXT (2)      36980001
369900         MOVE SQLCA                TO DP013-SQLCA                 36990001
370000         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    37000001
370100         SET DP013-DB2-ABEND                                      37010001
370200             DP013-XCTL-DISPLAY-RESTART                           37020001
370300                                   TO TRUE                        37030001
370400         PERFORM DP013-0000-PROCESS-ABEND                         37040001
370500     END-IF.                                                      37050001
370600                                                                  37060001
370700*--------------------------------------------------------------*  37070001
370800* EDIT THE GROSS COST AMOUNT                                   *  37080001
370900*--------------------------------------------------------------*  37090001
371000 3070-EDIT-GRO-COST-AMT.                                          37100001
371100                                                                  37110001
371200     SET PS-COST-AMT-NOT-CHANGED TO TRUE                          37120001
371300                                                                  37130001
371400     MOVE ASC-ALP-GRO-COST-AMT TO DP010I-UNEDITED-FIELD           37140001
371500     MOVE 9                    TO DP010I-MAXIMUM-DIGITS           37150001
371600     MOVE 2                    TO DP010I-MAXIMUM-DECIMALS         37160001
371700     SET  DP010I-NEGATIVE-NOT-ALLOWED                             37170001
371800                              TO TRUE                             37180001
371920     CALL DP010I-NUMERIC-EDIT-ROUTINE                             37192003
371930                         USING DP010I-NUMERIC-EDIT-AREA           37193003
372000     IF DP010I-ERROR-DETECTED                                     37200001
372100         SET DP020-MSG-FATAL  TO TRUE                             37210001
372200*        -- MUST BE NUMERIC --                                    37220001
372300         MOVE DP015-UNP-ALP-BRT-OFF                               37230001
372400                              TO ATOTCSTA                         37240001
372500         MOVE DP015-RED       TO ATOTCSTC                         37250001
372600         MOVE DP015-REVERSE   TO ATOTCSTH                         37260001
372700         MOVE -1                  TO ATOTCSTL                     37270001
372800         IF PS-NO-ERROR                                           37280001
372900             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             37290001
373000         END-IF                                                   37300001
373100         SET PS-ERROR         TO TRUE                             37310001
373200     ELSE                                                         37320001
373300         MOVE DP010I-NUMERIC-FIELD                                37330001
373400                              TO ASC-NEW-GRO-COST-AMT             37340001
373500                                 ASC-ALP-GRO-COST-AMT-NUM         37350001
373600         IF (ASC-NEW-GRO-COST-AMT NOT = ASC-OLD-GRO-COST-AMT)     37360001
373700             AND                                                  37370001
373800             ASC-UPDATE-PENDING                                   37380001
373900             SET PS-COST-AMT-CHANGED     TO TRUE                  37390001
374000             MOVE ASC-KEY-PAYT-REQ-SEQ-NBR  TO                    37400001
374100                  INVOIC-PAYT-REQ-SEQ-NBR                         37410001
374200             MOVE ASC-NEW-GRO-COST-AMT TO INVOIC-GRO-COST-AMT     37420001
374300             PERFORM 4170-GET-TALCHRG-DATA                        37430001
374400             PERFORM 4175-ACCUM-ALLOWANCES                        37440001
374500         END-IF                                                   37450001
374600     END-IF.                                                      37460001
374700                                                                  37470001
374800*--------------------------------------------------------------*  37480001
374900* EDIT THE TOTAL INVOICE QUANTITY FOR NON-IMPORTS              *  37490001
375000*--------------------------------------------------------------*  37500001
375100 3080-EDIT-TOT-INVC-PC-QTY.                                       37510001
375200                                                                  37520001
375300     IF ASC-IMPORT-PO                                             37530001
375400        PERFORM 3081-IMPT-EDIT-TOT-INVC-PC-QTY                    37540001
375500     ELSE                                                         37550001
375600        IF ASC-ALP-TOT-INVC-PC-QTY = SPACES                       37560001
375700           MOVE 0                   TO ASC-NEW-TOT-INVC-PC-QTY    37570001
375800        ELSE                                                      37580001
375900           MOVE ASC-ALP-TOT-INVC-PC-QTY TO DP010I-UNEDITED-FIELD  37590001
376000           MOVE 9                       TO DP010I-MAXIMUM-DIGITS  37600001
376100           MOVE 0                       TO DP010I-MAXIMUM-DECIMALS37610001
376200           SET  DP010I-NEGATIVE-NOT-ALLOWED                       37620001
376300                                    TO TRUE                       37630001
376420           CALL DP010I-NUMERIC-EDIT-ROUTINE                       37642003
376430                         USING DP010I-NUMERIC-EDIT-AREA           37643003
376500           IF DP010I-ERROR-DETECTED                               37650001
376600              SET DP020-MSG-FATAL  TO TRUE                        37660001
376700*          --  MUST BE NUMERIC --                                 37670001
376800              MOVE DP015-UNP-ALP-BRT-OFF                          37680001
376900                                   TO ATOTINVA                    37690001
377000              MOVE DP015-RED       TO ATOTINVC                    37700001
377100              MOVE DP015-REVERSE   TO ATOTINVH                    37710001
377200              MOVE -1                  TO ATOTINVL                37720001
377300              IF PS-NO-ERROR                                      37730001
377400                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         37740001
377500              END-IF                                              37750001
377600              SET PS-ERROR         TO TRUE                        37760001
377700           ELSE                                                   37770001
377800              MOVE DP010I-NUMERIC-FIELD                           37780001
377900                                   TO ASC-NEW-TOT-INVC-PC-QTY     37790001
378000                                      ASC-ALP-TOT-INVC-PC-QTY-NUM 37800001
378100           END-IF                                                 37810001
378200        END-IF                                                    37820001
378300     END-IF.                                                      37830001
378400                                                                  37840001
378500*--------------------------------------------------------------*  37850001
378600* EDIT THE TOTAL INVOICE QUANTITY FOR IMPORTS                  *  37860001
378700*--------------------------------------------------------------*  37870001
378800 3081-IMPT-EDIT-TOT-INVC-PC-QTY.                                  37880001
378900                                                                  37890001
379000     IF ASC-ALP-TOT-INVC-PC-QTY = SPACES                          37900001
379100        SET DP020-MSG-FATAL        TO TRUE                        37910001
379200*    -- TOTAL INV PIECES IS REQUIRED FOR IMPORT MI --             37920001
379300        MOVE DP015-UNP-ALP-BRT-OFF TO ATOTINVA                    37930001
379400        MOVE DP015-RED             TO ATOTINVC                    37940001
379500        MOVE DP015-REVERSE         TO ATOTINVH                    37950001
379600        MOVE -1                    TO ATOTINVL                    37960001
379700        IF PS-NO-ERROR                                            37970001
379800           MOVE PC-TSYMSG-01699 TO DP020-MSG-NUMBER               37980001
379900        END-IF                                                    37990001
380000        SET PS-ERROR               TO TRUE                        38000001
380100     ELSE                                                         38010001
380200        MOVE ASC-ALP-TOT-INVC-PC-QTY TO DP010I-UNEDITED-FIELD     38020001
380300        MOVE 9                       TO DP010I-MAXIMUM-DIGITS     38030001
380400        MOVE 0                       TO DP010I-MAXIMUM-DECIMALS   38040001
380500        SET  DP010I-NEGATIVE-NOT-ALLOWED                          38050001
380600                                   TO TRUE                        38060001
380720        CALL DP010I-NUMERIC-EDIT-ROUTINE                          38072003
380730                         USING DP010I-NUMERIC-EDIT-AREA           38073003
380800        IF DP010I-ERROR-DETECTED                                  38080001
380900           SET DP020-MSG-FATAL  TO TRUE                           38090001
381000*       -- MUST BE NUMERIC --                                     38100001
381100           MOVE DP015-UNP-ALP-BRT-OFF                             38110001
381200                                TO ATOTINVA                       38120001
381300           MOVE DP015-RED       TO ATOTINVC                       38130001
381400           MOVE DP015-REVERSE   TO ATOTINVH                       38140001
381500           MOVE -1              TO ATOTINVL                       38150001
381600           IF PS-NO-ERROR                                         38160001
381700              MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER            38170001
381800           END-IF                                                 38180001
381900           SET PS-ERROR         TO TRUE                           38190001
382000        ELSE                                                      38200001
382100           MOVE DP010I-NUMERIC-FIELD                              38210001
382200                                TO ASC-NEW-TOT-INVC-PC-QTY        38220001
382300                                   ASC-ALP-TOT-INVC-PC-QTY-NUM    38230001
382400        END-IF                                                    38240001
382500     END-IF.                                                      38250001
382600                                                                  38260001
382700*--------------------------------------------------------------*  38270001
382800* EDIT THE NET INVOICE AMOUNT                                  *  38280001
382900*--------------------------------------------------------------*  38290001
383000 3085-EDIT-NET-INVC-AMT.                                          38300001
383100                                                                  38310001
383200     IF ASC-ALP-NET-INVC-AMT > SPACES                             38320001
383300         SET PS-NET-AMT-ENTERED     TO TRUE                       38330001
383400     ELSE                                                         38340001
383500         SET PS-NET-AMT-NOT-ENTERED TO TRUE                       38350001
383600     END-IF.                                                      38360001
383700                                                                  38370001
383800     MOVE ASC-ALP-NET-INVC-AMT TO DP010I-UNEDITED-FIELD           38380001
383900     MOVE 9                    TO DP010I-MAXIMUM-DIGITS           38390001
384000     MOVE 2                    TO DP010I-MAXIMUM-DECIMALS         38400001
384100     SET  DP010I-NEGATIVE-NOT-ALLOWED                             38410001
384200                              TO TRUE                             38420001
384300                                                                  38430001
384420     CALL DP010I-NUMERIC-EDIT-ROUTINE                             38442003
384430                         USING DP010I-NUMERIC-EDIT-AREA           38443003
384500                                                                  38450001
384600     IF DP010I-ERROR-DETECTED                                     38460001
384700        OR (ASC-ALP-NET-INVC-AMT = SPACES AND                     38470001
384800                                     DP020-SRC-AID = DP016-PF22)  38480001
384900        OR (ASC-ALP-NET-INVC-AMT = SPACES AND                     38490001
385000                          (ASC-ADD-REQUESTED OR ASC-ADD-PENDING)) 38500001
385100        OR (ASC-ALP-NET-INVC-AMT = SPACES AND PS-COST-AMT-CHANGED)38510001
385200         SET DP020-MSG-FATAL  TO TRUE                             38520001
385300*        -- MUST BE NUMERIC --                                    38530001
385400         MOVE DP015-UNP-ALP-BRT-OFF                               38540001
385500                              TO ANETCSTA                         38550001
385600         MOVE DP015-RED       TO ANETCSTC                         38560001
385700         MOVE DP015-REVERSE   TO ANETCSTH                         38570001
385800         MOVE -1                  TO ANETCSTL                     38580001
385900         IF PS-NO-ERROR                                           38590001
386000             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             38600001
386100         END-IF                                                   38610001
386200         SET PS-ERROR         TO TRUE                             38620001
386300     ELSE                                                         38630001
386400         IF DP010I-NUMERIC-FIELD = ZERO                           38640001
386500           AND ASC-EXPENSE-INVC                                   38650001
386600             SET DP020-MSG-FATAL  TO TRUE                         38660001
386700*            -- MUST BE GREATER THAN ZERO --                      38670001
386800             MOVE DP015-UNP-ALP-BRT-OFF                           38680001
386900                                  TO ANETCSTA                     38690001
387000             MOVE DP015-RED       TO ANETCSTC                     38700001
387100             MOVE DP015-REVERSE   TO ANETCSTH                     38710001
387200             MOVE -1              TO ANETCSTL                     38720001
387300             IF PS-NO-ERROR                                       38730001
387400                 MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER         38740001
387500             END-IF                                               38750001
387600             SET PS-ERROR         TO TRUE                         38760001
387700         ELSE                                                     38770001
387800             MOVE DP010I-NUMERIC-FIELD                            38780001
387900                              TO ASC-NEW-NET-INVC-AMT             38790001
388000                                 ASC-ALP-NET-INVC-AMT-NUM         38800001
388100     END-IF.                                                      38810001
388200                                                                  38820001
388300*--------------------------------------------------------------*  38830001
388400* EDIT THE PAYMENT TERMS                                       *  38840001
388500*--------------------------------------------------------------*  38850001
388600 3090-EDIT-PAY-TERMS-BOX.                                         38860001
388700                                                                  38870001
388800     IF ASC-NEW-PO-SEL = SPACES OR 'S'                            38880001
388900         CONTINUE                                                 38890001
389000     ELSE                                                         38900001
389100         SET DP020-MSG-FATAL                                      38910001
389200                                   TO TRUE                        38920001
389300*        -- INVALID VALUE  --                                     38930001
389400         MOVE DP015-UNP-ALP-BRT-OFF                               38940001
389500                                   TO APOSELA                     38950001
389600         MOVE DP015-RED            TO APOSELC                     38960001
389700         MOVE DP015-REVERSE        TO APOSELH                     38970001
389800         MOVE -1                       TO APOSELL                 38980001
389900         IF PS-NO-ERROR                                           38990001
390000             MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER        39000001
390100         END-IF                                                   39010001
390200         SET PS-ERROR              TO TRUE                        39020001
390300     END-IF.                                                      39030001
390400                                                                  39040001
390500     IF ASC-NEW-PO-SEL = SPACES AND                               39050001
390600        ASC-NEW-IN-SEL = SPACES                                   39060001
390700         SET DP020-MSG-FATAL                                      39070001
390800                                   TO TRUE                        39080001
390900*        -- MUST MAKE CHOICE --                                   39090001
391000         MOVE DP015-UNP-ALP-BRT-OFF                               39100001
391100                                   TO APOSELA                     39110001
391200                                      AINSELA                     39120001
391300         MOVE DP015-RED            TO APOSELC                     39130001
391400                                      AINSELC                     39140001
391500         MOVE DP015-REVERSE        TO APOSELH                     39150001
391600                                      AINSELH                     39160001
391700         MOVE -1                       TO APOSELL                 39170001
391800         IF PS-NO-ERROR                                           39180001
391900             MOVE PC-TSYMSG-00057      TO DP020-MSG-NUMBER        39190001
392000         END-IF                                                   39200001
392100         SET PS-ERROR              TO TRUE                        39210001
392200     END-IF.                                                      39220001
392300                                                                  39230001
392400     IF ASC-NEW-PO-SEL = 'S' AND                                  39240001
392500        ASC-NEW-IN-SEL = 'S'                                      39250001
392600         SET DP020-MSG-FATAL                                      39260001
392700                                   TO TRUE                        39270001
392800*        -- MUST CHOOSE 1 --                                      39280001
392900         MOVE DP015-UNP-ALP-BRT-OFF                               39290001
393000                                   TO APOSELA                     39300001
393100                                      AINSELA                     39310001
393200         MOVE DP015-RED            TO APOSELC                     39320001
393300                                      AINSELC                     39330001
393400         MOVE DP015-REVERSE        TO APOSELH                     39340001
393500                                      AINSELH                     39350001
393600         MOVE -1                       TO APOSELL                 39360001
393700         IF PS-NO-ERROR                                           39370001
393800             MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBER        39380001
393900         END-IF                                                   39390001
394000         SET PS-ERROR              TO TRUE                        39400001
394100     END-IF.                                                      39410001
394200                                                                  39420001
394300     IF ASC-NEW-IN-SEL = SPACES OR 'S'                            39430001
394400         CONTINUE                                                 39440001
394500     ELSE                                                         39450001
394600         SET DP020-MSG-FATAL                                      39460001
394700                                   TO TRUE                        39470001
394800*        -- INVALID VALUE --                                      39480001
394900         MOVE DP015-UNP-ALP-BRT-OFF                               39490001
395000                                   TO AINSELA                     39500001
395100         MOVE DP015-RED            TO AINSELC                     39510001
395200         MOVE DP015-REVERSE        TO AINSELH                     39520001
395300         MOVE -1                       TO AINSELL                 39530001
395400         IF PS-NO-ERROR                                           39540001
395500             MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER        39550001
395600         END-IF                                                   39560001
395700         SET PS-ERROR              TO TRUE                        39570001
395800     END-IF.                                                      39580001
395900                                                                  39590001
396000     IF ASC-NEW-IN-SEL = 'S'                                      39600001
396100         MOVE 'I' TO ASC-NEW-TERM-SEL-CDE                         39610001
396200         PERFORM 3095-EDIT-INVC-TERMS                             39620001
396300     ELSE                                                         39630001
396400*WR5091 IF EDI TERMS - THEY CANNOT BE CHANGED OR DELETED          39640001
396500         IF ASC-ENTR-MTHD-CDE = 'ED'                              39650001
396600            CONTINUE                                              39660001
396700         ELSE                                                     39670001
396800            INITIALIZE ASC-NEW-INVC-SELECTIONS                    39680001
396900                       ASC-ALP-INVC-FIELDS                        39690001
397000         END-IF                                                   39700001
397100         IF ASC-NEW-PO-SEL = 'S'                                  39710001
397200             MOVE 'P' TO ASC-NEW-TERM-SEL-CDE                     39720001
397300         END-IF                                                   39730001
397400     END-IF.                                                      39740001
397500                                                                  39750001
397600*--------------------------------------------------------------*  39760001
397700* EDIT THE INVOICE TERMS                                       *  39770001
397800*--------------------------------------------------------------*  39780001
397900 3095-EDIT-INVC-TERMS.                                            39790001
398000                                                                  39800001
398100     IF ASC-ALP-DISC-PCT = SPACES                                 39810001
398200*            -- MUST BE NUMERIC --                                39820001
398300         MOVE DP015-UNP-ALP-BRT-OFF                               39830001
398400                               TO AINPCTA                         39840001
398500         MOVE DP015-RED        TO AINPCTC                         39850001
398600         MOVE DP015-REVERSE    TO AINPCTH                         39860001
398700         MOVE -1               TO AINPCTL                         39870001
398800         IF PS-NO-ERROR                                           39880001
398900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            39890001
399000         END-IF                                                   39900001
399100         SET PS-ERROR                                             39910001
399200             DP020-MSG-FATAL   TO TRUE                            39920001
399300     ELSE                                                         39930001
399400     IF ASC-ALP-DISC-PCT = 'NET' OR ZEROS                         39940001
399500         MOVE 0                    TO ASC-NEW-IN-DISC-PCT-NUM     39950001
399600         MOVE 'NET'                TO ASC-ALP-DISC-PCT            39960001
399700     ELSE                                                         39970001
399800         MOVE ASC-ALP-DISC-PCT     TO DP010I-UNEDITED-FIELD       39980001
399900         MOVE 2                    TO DP010I-MAXIMUM-DIGITS       39990001
400000         MOVE 2                    TO DP010I-MAXIMUM-DECIMALS     40000001
400100         SET DP010I-NEGATIVE-NOT-ALLOWED                          40010001
400200                                   TO TRUE                        40020001
400320         CALL DP010I-NUMERIC-EDIT-ROUTINE                         40032003
400330                         USING DP010I-NUMERIC-EDIT-AREA           40033003
400400         IF  DP010I-ERROR-DETECTED                                40040001
400500*            -- MUST BE NUMERIC --                                40050001
400600             MOVE DP015-UNP-ALP-BRT-OFF                           40060001
400700                                   TO AINPCTA                     40070001
400800             MOVE DP015-RED        TO AINPCTC                     40080001
400900             MOVE DP015-REVERSE    TO AINPCTH                     40090001
401000             MOVE -1               TO AINPCTL                     40100001
401100             IF PS-NO-ERROR                                       40110001
401200                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        40120001
401300             END-IF                                               40130001
401400             SET PS-ERROR                                         40140001
401500                 DP020-MSG-FATAL   TO TRUE                        40150001
401600         ELSE                                                     40160001
401700             MOVE DP010I-NUMERIC-FIELD                            40170001
401800                                   TO ASC-NEW-IN-DISC-PCT-NUM     40180001
401900                                      ASC-ALP-DISC-PCT-NUM        40190001
402000         END-IF                                                   40200001
402100     END-IF                                                       40210001
402200     END-IF.                                                      40220001
402300                                                                  40230001
402400     IF ASC-ALP-DISC-DUE-DAY-QTY = SPACES                         40240001
402500         SET DP020-MSG-FATAL  TO TRUE                             40250001
402600*            -- MUST BE NUMERIC --                                40260001
402700         MOVE DP015-UNP-ALP-BRT-OFF                               40270001
402800                              TO AINDAYA                          40280001
402900         MOVE DP015-RED       TO AINDAYC                          40290001
403000         MOVE DP015-REVERSE   TO AINDAYH                          40300001
403100         MOVE -1                  TO AINDAYL                      40310001
403200         IF PS-NO-ERROR                                           40320001
403300             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             40330001
403400         END-IF                                                   40340001
403500         SET PS-ERROR         TO TRUE                             40350001
403600     ELSE                                                         40360001
403700         MOVE ASC-ALP-DISC-DUE-DAY-QTY                            40370001
403800                                  TO DP010I-UNEDITED-FIELD        40380001
403900         MOVE 3                   TO DP010I-MAXIMUM-DIGITS        40390001
404000         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      40400001
404100         SET  DP010I-NEGATIVE-NOT-ALLOWED                         40410001
404200                                  TO TRUE                         40420001
404320         CALL DP010I-NUMERIC-EDIT-ROUTINE                         40432003
404330                         USING DP010I-NUMERIC-EDIT-AREA           40433003
404400         IF DP010I-ERROR-DETECTED                                 40440001
404500             SET DP020-MSG-FATAL  TO TRUE                         40450001
404600*            -- MUST BE NUMERIC --                                40460001
404700             MOVE DP015-UNP-ALP-BRT-OFF                           40470001
404800                                  TO AINDAYA                      40480001
404900             MOVE DP015-RED       TO AINDAYC                      40490001
405000             MOVE DP015-REVERSE   TO AINDAYH                      40500001
405100             MOVE -1                  TO AINDAYL                  40510001
405200             IF PS-NO-ERROR                                       40520001
405300                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         40530001
405400             END-IF                                               40540001
405500             SET PS-ERROR         TO TRUE                         40550001
405600         ELSE                                                     40560001
405700             MOVE DP010I-NUMERIC-FIELD                            40570001
405800                                  TO ASC-NEW-IN-DISC-DUE-DAY-QTY  40580001
405900                                     ASC-ALP-DISC-DUE-DAY-QTY-NUM 40590001
406000             IF ASC-ALP-DISC-DUE-DAY-QTY-NUM = ZERO               40600001
406100                 IF ASC-ALP-DISC-PCT = 'NET'                      40610001
406200                     IF ASC-EXPENSE-INVC                          40620001
406300                        IF ASC-NEW-RMIT-VND-ID = PV-IMPORT-VENDOR 40630001
406400                            MOVE +05 TO                           40640001
406500                                    ASC-NEW-IN-DISC-DUE-DAY-QTY   40650001
406600                        ELSE                                      40660001
406700                            MOVE +10 TO                           40670001
406800                                    ASC-NEW-IN-DISC-DUE-DAY-QTY   40680001
406900                        END-IF                                    40690001
407000                     END-IF                                       40700001
407100                 ELSE                                             40710001
407200                     MOVE +0      TO ASC-NEW-IN-DISC-DUE-DAY-QTY  40720001
407300                 END-IF                                           40730001
407400             ELSE                                                 40740001
407500                 IF ASC-NEW-IN-DISC-DUE-DAY-QTY > +365            40750001
407600                     SET DP020-MSG-FATAL TO TRUE                  40760001
407700*                    -- DATE RANGE &VAR DAYS --                   40770001
407800                     MOVE DP015-UNP-ALP-BRT-OFF                   40780001
407900                                         TO AINDAYA               40790001
408000                     MOVE DP015-RED      TO AINDAYC               40800001
408100                     MOVE DP015-REVERSE  TO AINDAYH               40810001
408200                     MOVE -1             TO AINDAYL               40820001
408300                     IF PS-NO-ERROR                               40830001
408400                         MOVE PC-TSYMSG-00601                     40840001
408500                                         TO DP020-MSG-NUMBER      40850001
408600                         MOVE '365'      TO DP020-MSG-TEXT        40860001
408700                     END-IF                                       40870001
408800                     SET PS-ERROR        TO TRUE                  40880001
408900                 END-IF                                           40890001
409000             END-IF                                               40900001
409100         END-IF                                                   40910001
409200     END-IF.                                                      40920001
409300                                                                  40930001
409400     IF ASC-NEW-IN-EOM = 'N'                                      40940001
409500         MOVE 'N'                  TO ASC-NEW-IN-EOM              40950001
409600     ELSE                                                         40960001
409700         IF ASC-NEW-IN-EOM = 'Y'                                  40970001
409800             CONTINUE                                             40980001
409900         ELSE                                                     40990001
410000             SET DP020-MSG-FATAL                                  41000001
410100                                   TO TRUE                        41010001
410200*            -- INVALID VALUE --                                  41020001
410300             MOVE DP015-UNP-ALP-BRT-OFF                           41030001
410400                                   TO AINEOMA                     41040001
410500             MOVE DP015-RED        TO AINEOMC                     41050001
410600             MOVE DP015-REVERSE    TO AINEOMH                     41060001
410700             MOVE -1               TO AINEOML                     41070001
410800             IF PS-NO-ERROR                                       41080001
410900                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         41090001
411000             END-IF                                               41100001
411100             SET PS-ERROR          TO TRUE                        41110001
411200         END-IF                                                   41120001
411300     END-IF.                                                      41130001
411400                                                                  41140001
411500     IF  ASC-ALP-EXTD-DAYS-QTY = SPACES                           41150001
411600         SET DP020-MSG-FATAL  TO TRUE                             41160001
411700*            -- MUST BE NUMERIC --                                41170001
411800         MOVE DP015-UNP-ALP-BRT-OFF                               41180001
411900                              TO AINEXTA                          41190001
412000         MOVE DP015-RED       TO AINEXTC                          41200001
412100         MOVE DP015-REVERSE   TO AINEXTH                          41210001
412200         MOVE -1                  TO AINEXTL                      41220001
412300         IF PS-NO-ERROR                                           41230001
412400             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             41240001
412500         END-IF                                                   41250001
412600         SET PS-ERROR         TO TRUE                             41260001
412700     ELSE                                                         41270001
412800         MOVE ASC-ALP-EXTD-DAYS-QTY                               41280001
412900                                  TO DP010I-UNEDITED-FIELD        41290001
413000         MOVE 3                   TO DP010I-MAXIMUM-DIGITS        41300001
413100         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      41310001
413200         SET  DP010I-NEGATIVE-NOT-ALLOWED                         41320001
413300                                  TO TRUE                         41330001
413420         CALL DP010I-NUMERIC-EDIT-ROUTINE                         41342003
413430                         USING DP010I-NUMERIC-EDIT-AREA           41343003
413500         IF DP010I-ERROR-DETECTED                                 41350001
413600             SET DP020-MSG-FATAL  TO TRUE                         41360001
413700*            -- MUST BE NUMERIC --                                41370001
413800             MOVE DP015-UNP-ALP-BRT-OFF                           41380001
413900                                  TO AINEXTA                      41390001
414000             MOVE DP015-RED       TO AINEXTC                      41400001
414100             MOVE DP015-REVERSE   TO AINEXTH                      41410001
414200             MOVE -1                  TO AINEXTL                  41420001
414300             IF PS-NO-ERROR                                       41430001
414400                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         41440001
414500             END-IF                                               41450001
414600             SET PS-ERROR         TO TRUE                         41460001
414700         ELSE                                                     41470001
414800             MOVE DP010I-NUMERIC-FIELD                            41480001
414900                                  TO ASC-NEW-IN-EXTD-DAYS-QTY     41490001
415000                                     ASC-ALP-EXTD-DAYS-QTY-NUM    41500001
415100             IF ASC-NEW-IN-EXTD-DAYS-QTY > +365                   41510001
415200                 SET DP020-MSG-FATAL TO TRUE                      41520001
415300*                -- DATE RANGE &VAR DAYS --                       41530001
415400                 MOVE DP015-UNP-ALP-BRT-OFF                       41540001
415500                                  TO AINEXTA                      41550001
415600                 MOVE DP015-RED   TO AINEXTC                      41560001
415700                 MOVE DP015-REVERSE TO AINEXTH                    41570001
415800                 MOVE -1              TO AINEXTL                  41580001
415900                 IF PS-NO-ERROR                                   41590001
416000                     MOVE PC-TSYMSG-00601 TO DP020-MSG-NUMBER     41600001
416100                     MOVE '365'           TO DP020-MSG-TEXT       41610001
416200                 END-IF                                           41620001
416300                 SET PS-ERROR     TO TRUE                         41630001
416400             END-IF                                               41640001
416500         END-IF                                                   41650001
416600     END-IF.                                                      41660001
416700                                                                  41670001
416800*WR5091 ADD LOGIC TO CHECK FOR SPLIT TERMS IND = ' '              41680001
416900     IF ASC-NEW-IN-SPLIT-TERMS-IND = 'N' OR ' '                   41690001
417000         MOVE 'N'                  TO ASC-NEW-IN-SPLIT-TERMS-IND  41700001
417100     ELSE                                                         41710001
417200         IF ASC-NEW-IN-SPLIT-TERMS-IND = 'Y'                      41720001
417300             IF ASC-NEW-IN-SEL = 'S'                              41730001
417400                 CONTINUE                                         41740001
417500             ELSE                                                 41750001
417600                 SET DP020-MSG-FATAL                              41760001
417700                                   TO TRUE                        41770001
417800*            -- INVALID VALUE --                                  41780001
417900                 MOVE DP015-UNP-ALP-BRT-OFF                       41790001
418000                                   TO ASPLITA                     41800001
418100                 MOVE DP015-RED    TO ASPLITC                     41810001
418200                 MOVE DP015-REVERSE TO ASPLITH                    41820001
418300                 MOVE -1               TO ASPLITL                 41830001
418400                 IF PS-NO-ERROR                                   41840001
418500                     MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER     41850001
418600                 END-IF                                           41860001
418700                 SET PS-ERROR      TO TRUE                        41870001
418800             END-IF                                               41880001
418900         ELSE                                                     41890001
419000             SET DP020-MSG-FATAL                                  41900001
419100                                   TO TRUE                        41910001
419200*            -- INVALID VALUE --                                  41920001
419300             MOVE DP015-UNP-ALP-BRT-OFF                           41930001
419400                                   TO ASPLITA                     41940001
419500             MOVE DP015-RED        TO ASPLITC                     41950001
419600             MOVE DP015-REVERSE    TO ASPLITH                     41960001
419700             MOVE -1                   TO ASPLITL                 41970001
419800             IF PS-NO-ERROR                                       41980001
419900                 MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER        41990001
420000             END-IF                                               42000001
420100             SET PS-ERROR          TO TRUE                        42010001
420200         END-IF                                                   42020001
420300     END-IF.                                                      42030001
420400                                                                  42040001
420500*--------------------------------------------------------------*  42050001
420600* EDIT THE KOHLDS FREIGHT PERCENT                              *  42060001
420700*--------------------------------------------------------------*  42070001
420800 3100-EDIT-KOHLS-FRGT-PCT.                                        42080001
420900                                                                  42090001
421000     IF ASC-ALP-KOHLS-FRGT-PCT = SPACES                           42100001
421100         MOVE 0                    TO ASC-NEW-KOHLS-FRGT-PCT-NUM  42110001
421200                                      ASC-ALP-KOHLS-FRGT-PCT-NUM  42120001
421300     ELSE                                                         42130001
421400         MOVE ASC-ALP-KOHLS-FRGT-PCT                              42140001
421500                                   TO DP010I-UNEDITED-FIELD       42150001
421600         MOVE 3                    TO DP010I-MAXIMUM-DIGITS       42160001
421700         MOVE 0                    TO DP010I-MAXIMUM-DECIMALS     42170001
421800         SET DP010I-NEGATIVE-NOT-ALLOWED                          42180001
421900                                   TO TRUE                        42190001
422020         CALL DP010I-NUMERIC-EDIT-ROUTINE                         42202003
422030                         USING DP010I-NUMERIC-EDIT-AREA           42203003
422100         IF DP010I-ERROR-DETECTED                                 42210001
422200             SET DP020-MSG-FATAL   TO TRUE                        42220001
422300*            -- MUST BE NUMERIC --                                42230001
422400             MOVE DP015-UNP-ALP-BRT-OFF                           42240001
422500                                   TO ACMPFRTA                    42250001
422600             MOVE DP015-RED        TO ACMPFRTC                    42260001
422700             MOVE DP015-REVERSE    TO ACMPFRTH                    42270001
422800             MOVE -1                   TO ACMPFRTL                42280001
422900             IF PS-NO-ERROR                                       42290001
423000                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        42300001
423100             END-IF                                               42310001
423200             SET PS-ERROR          TO TRUE                        42320001
423300         ELSE                                                     42330001
423400             MOVE DP010I-NUMERIC-FIELD                            42340001
423500                                   TO ASC-ALP-KOHLS-FRGT-PCT-NUM  42350001
423600                                      ASC-NEW-KOHLS-FRGT-PCT-NUM  42360001
423700         END-IF                                                   42370001
423800     END-IF.                                                      42380001
423900                                                                  42390001
424000*--------------------------------------------------------------*  42400001
424100* EDIT THE VENDOR FREIGHT PERCENT                              *  42410001
424200*--------------------------------------------------------------*  42420001
424300 3110-EDIT-VEND-FRGT-PCT.                                         42430001
424400                                                                  42440001
424500     IF ASC-ALP-VEND-FRGT-PCT = SPACES                            42450001
424600         MOVE 0                    TO ASC-NEW-VEND-FRGT-PCT-NUM   42460001
424700                                      ASC-ALP-VEND-FRGT-PCT-NUM   42470001
424800     ELSE                                                         42480001
424900         MOVE ASC-ALP-VEND-FRGT-PCT                               42490001
425000                                   TO DP010I-UNEDITED-FIELD       42500001
425100         MOVE 3                    TO DP010I-MAXIMUM-DIGITS       42510001
425200         MOVE 0                    TO DP010I-MAXIMUM-DECIMALS     42520001
425300         SET DP010I-NEGATIVE-NOT-ALLOWED                          42530001
425400                                   TO TRUE                        42540001
425520         CALL DP010I-NUMERIC-EDIT-ROUTINE                         42552003
425530                         USING DP010I-NUMERIC-EDIT-AREA           42553003
425600         IF DP010I-ERROR-DETECTED                                 42560001
425700             SET DP020-MSG-FATAL   TO TRUE                        42570001
425800*        -- MUST BE NUMERIC --                                    42580001
425900             MOVE DP015-UNP-ALP-BRT-OFF                           42590001
426000                                   TO AVNDFRTA                    42600001
426100             MOVE DP015-RED        TO AVNDFRTC                    42610001
426200             MOVE DP015-REVERSE    TO AVNDFRTH                    42620001
426300             MOVE -1                   TO AVNDFRTL                42630001
426400             IF PS-NO-ERROR                                       42640001
426500                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        42650001
426600             END-IF                                               42660001
426700             SET PS-ERROR          TO TRUE                        42670001
426800         ELSE                                                     42680001
426900             MOVE DP010I-NUMERIC-FIELD                            42690001
427000                                   TO ASC-NEW-VEND-FRGT-PCT-NUM   42700001
427100                                      ASC-ALP-VEND-FRGT-PCT-NUM   42710001
427200         END-IF                                                   42720001
427300     END-IF.                                                      42730001
427400                                                                  42740001
427500     IF ASC-ALP-KOHLS-FRGT-PCT    NUMERIC AND                     42750001
427600        ASC-ALP-VEND-FRGT-PCT     NUMERIC                         42760001
427700         IF (ASC-ALP-KOHLS-FRGT-PCT-NUM +                         42770001
427800             ASC-ALP-VEND-FRGT-PCT-NUM  = 100)                    42780001
427900             CONTINUE                                             42790001
428000         ELSE                                                     42800001
428100             SET DP020-MSG-FATAL       TO TRUE                    42810001
428200*            --  PCT MUST = 100 --                                42820001
428300             MOVE DP015-UNP-ALP-BRT-OFF                           42830001
428400                                       TO AVNDFRTA                42840001
428500             MOVE DP015-RED            TO AVNDFRTC                42850001
428600             MOVE DP015-REVERSE        TO AVNDFRTH                42860001
428700             MOVE DP015-UNP-ALP-BRT-OFF                           42870001
428800                                       TO ACMPFRTA                42880001
428900             MOVE DP015-RED            TO ACMPFRTC                42890001
429000             MOVE DP015-REVERSE        TO ACMPFRTH                42900001
429100             MOVE -1                       TO AVNDFRTL            42910001
429200             IF PS-NO-ERROR                                       42920001
429300                 MOVE PC-TSYMSG-00494      TO DP020-MSG-NUMBER    42930001
429400             END-IF                                               42940001
429500             SET PS-ERROR              TO TRUE                    42950001
429600         END-IF                                                   42960001
429700     END-IF.                                                      42970001
429800                                                                  42980001
429900*--------------------------------------------------------------*  42990001
430000* EDIT THE CARTON COUNT                                        *  43000001
430100*--------------------------------------------------------------*  43010001
430200 3120-EDIT-CARTON-CNT.                                            43020001
430300                                                                  43030001
430400     IF ASC-ALP-CARTON-CNT    = SPACES                            43040001
430500         MOVE 0                    TO ASC-NEW-CARTON-CNT          43050001
430600                                      ASC-ALP-CARTON-CNT-NUM      43060001
430700     ELSE                                                         43070001
430800         MOVE ASC-ALP-CARTON-CNT                                  43080001
430900                                   TO DP010I-UNEDITED-FIELD       43090001
431000         MOVE 5                    TO DP010I-MAXIMUM-DIGITS       43100001
431100         MOVE 0                    TO DP010I-MAXIMUM-DECIMALS     43110001
431200         SET DP010I-NEGATIVE-NOT-ALLOWED                          43120001
431300                                   TO TRUE                        43130001
431420         CALL DP010I-NUMERIC-EDIT-ROUTINE                         43142003
431430                         USING DP010I-NUMERIC-EDIT-AREA           43143003
431500         IF DP010I-ERROR-DETECTED                                 43150001
431600             SET DP020-MSG-FATAL   TO TRUE                        43160001
431700*        -- MUST BE NUMERIC --                                    43170001
431800             MOVE DP015-UNP-ALP-BRT-OFF                           43180001
431900                                   TO ACARTCTA                    43190001
432000             MOVE DP015-RED        TO ACARTCTC                    43200001
432100             MOVE DP015-REVERSE    TO ACARTCTH                    43210001
432200             MOVE -1                   TO ACARTCTL                43220001
432300             IF PS-NO-ERROR                                       43230001
432400                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        43240001
432500             END-IF                                               43250001
432600             SET PS-ERROR          TO TRUE                        43260001
432700         ELSE                                                     43270001
432800            MOVE DP010I-NUMERIC-FIELD TO ASC-ALP-CARTON-CNT-NUM   43280001
432900                                         ASC-NEW-CARTON-CNT       43290001
433000            IF DP010I-NUMERIC-FIELD > +32767                      43300001
433100               SET DP020-MSG-FATAL   TO TRUE                      43310001
433200*   -- MUST NOT EXCEED 32767 - MAX VALUE FOR SMALLINT FIELD --    43320001
433300               MOVE DP015-UNP-ALP-BRT-OFF TO ACARTCTA             43330001
433400               MOVE DP015-RED             TO ACARTCTC             43340001
433500               MOVE DP015-REVERSE         TO ACARTCTH             43350001
433600               MOVE -1                    TO ACARTCTL             43360001
433700               IF PS-NO-ERROR                                     43370001
433800                   MOVE PC-TSYMSG-01314   TO DP020-MSG-NUMBER     43380001
433900               END-IF                                             43390001
434000               SET PS-ERROR TO TRUE                               43400001
434100            END-IF                                                43410001
434200         END-IF                                                   43420001
434300     END-IF.                                                      43430001
434400                                                                  43440001
434500*--------------------------------------------------------------*  43450001
434600* EDIT THE BILL OF LADING NUMBER                               *  43460001
434700*--------------------------------------------------------------*  43470001
434800 3130-EDIT-BOL-NBR.                                               43480001
434900                                                                  43490001
435000     IF ASC-NEW-BOL-ID = SPACE                                    43500001
435100         SET DP020-MSG-FATAL      TO TRUE                         43510001
435200         MOVE DP015-UNP-ALP-BRT-OFF                               43520001
435300                                  TO ABOLNBRA                     43530001
435400         MOVE DP015-RED           TO ABOLNBRC                     43540001
435500         MOVE DP015-REVERSE       TO ABOLNBRH                     43550001
435600         MOVE -1                  TO ABOLNBRL                     43560001
435700         IF PS-NO-ERROR                                           43570001
435800*            -- REQUIRED ENTRY --                                 43580001
435900             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             43590001
436000         END-IF                                                   43600001
436100         SET PS-ERROR      TO TRUE                                43610001
436200     END-IF.                                                      43620001
436300                                                                  43630001
436400*--------------------------------------------------------------*  43640001
436500* EDIT THE IMPORT CHARGE CODE -- ONLY VALID FOR MERCHANDISE    *  43650001
436600* INVOICES ON IMPORT PO'S.                                     *  43660001
436700*--------------------------------------------------------------*  43670001
436800 3140-EDIT-IMPORT-CHRG-CDE.                                       43680001
436900                                                                  43690001
437000     IF ASC-IMPORT-PO                                             43700001
437100         IF ASC-NEW-IMPRT-CHRG-CDE = SPACE                        43710001
437200             SET DP020-MSG-FATAL      TO TRUE                     43720001
437300*        -- INVALID VALUE --                                      43730001
437400             MOVE DP015-UNP-ALP-BRT-OFF TO ACHRGCDA               43740001
437500             MOVE DP015-RED           TO ACHRGCDC                 43750001
437600             MOVE DP015-REVERSE       TO ACHRGCDH                 43760001
437700             MOVE -1                  TO ACHRGCDL                 43770001
437800             IF PS-NO-ERROR                                       43780001
437900                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         43790001
438000             END-IF                                               43800001
438100             SET PS-ERROR             TO TRUE                     43810001
438200         ELSE                                                     43820001
438300             MOVE ASC-NEW-IMPRT-CHRG-CDE TO                       43830001
438400                               PV-IMPRT-CHRG-PRC-CDE              43840001
438500             IF NOT IMPRT-CHRG-PRC-CDE-VALID                      43850001
438600                 SET DP020-MSG-FATAL  TO TRUE                     43860001
438700*            -- INVALID VALUE --                                  43870001
438800                 MOVE DP015-UNP-ALP-BRT-OFF                       43880001
438900                                      TO ACHRGCDA                 43890001
439000                 MOVE DP015-RED       TO ACHRGCDC                 43900001
439100                 MOVE DP015-REVERSE   TO ACHRGCDH                 43910001
439200                 MOVE -1              TO ACHRGCDL                 43920001
439300                 IF PS-NO-ERROR                                   43930001
439400                     MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER     43940001
439500                 END-IF                                           43950001
439600                 SET PS-ERROR         TO TRUE                     43960001
439700             END-IF                                               43970001
439800         END-IF                                                   43980001
439900     ELSE                                                         43990001
440000         MOVE SPACE            TO ACHRGCDO                        44000001
440100                                  ASC-NEW-IMPRT-CHRG-CDE          44010001
440200                                  ASC-OLD-IMPRT-CHRG-CDE          44020001
440300     END-IF.                                                      44030001
440400                                                                  44040001
440500*--------------------------------------------------------------*  44050001
440600* EDIT THE ENTRY NUMBER                                        *  44060001
440700*--------------------------------------------------------------*  44070001
440800 3170-EDIT-ENT-NBR.                                               44080001
440900                                                                  44090001
441000     IF ASC-NEW-ENT-NBR = SPACE                                   44100001
441100         SET DP020-MSG-FATAL      TO TRUE                         44110001
441200         MOVE DP015-UNP-ALP-BRT-OFF                               44120001
441300                                  TO AENTRYA                      44130001
441400         MOVE DP015-RED           TO AENTRYC                      44140001
441500         MOVE DP015-REVERSE       TO AENTRYH                      44150001
441600         MOVE -1                  TO AENTRYL                      44160001
441700         IF PS-NO-ERROR                                           44170001
441800*            -- REQUIRED ENTRY --                                 44180001
441900             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             44190001
442000         END-IF                                                   44200001
442100         SET PS-ERROR      TO TRUE                                44210001
442200     END-IF.                                                      44220001
442300                                                                  44230001
442400*--------------------------------------------------------------*  44240001
442500* EDIT THE DATE                                                *  44250001
442600*--------------------------------------------------------------*  44260001
442700 3195-EDIT-DATE.                                                  44270001
442800                                                                  44280001
442900     IF PV-MM NUMERIC                                             44290001
443000     OR PV-MM = SPACE                                             44300001
443100         CONTINUE                                                 44310001
443200     ELSE                                                         44320001
443300         MOVE PV-MM                  TO DP010I-UNEDITED-FIELD     44330001
443400         MOVE 2                      TO DP010I-MAXIMUM-DIGITS     44340001
443500         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   44350001
443600         SET DP010I-NEGATIVE-NOT-ALLOWED                          44360001
443700                                     TO TRUE                      44370001
443820         CALL DP010I-NUMERIC-EDIT-ROUTINE                         44382003
443830                         USING DP010I-NUMERIC-EDIT-AREA           44383003
443900         IF DP010I-ERROR-DETECTED                                 44390001
444000             CONTINUE                                             44400001
444100         ELSE                                                     44410001
444200             MOVE DP010I-NUMERIC-FIELD                            44420001
444300                                     TO PV-MM-9                   44430001
444400         END-IF                                                   44440001
444500     END-IF                                                       44450001
444600                                                                  44460001
444700     IF PV-DD NUMERIC                                             44470001
444800     OR PV-DD = SPACE                                             44480001
444900         CONTINUE                                                 44490001
445000     ELSE                                                         44500001
445100         MOVE PV-DD                  TO DP010I-UNEDITED-FIELD     44510001
445200         MOVE 2                      TO DP010I-MAXIMUM-DIGITS     44520001
445300         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   44530001
445400         SET DP010I-NEGATIVE-NOT-ALLOWED                          44540001
445500                                     TO TRUE                      44550001
445620         CALL DP010I-NUMERIC-EDIT-ROUTINE                         44562003
445630                         USING DP010I-NUMERIC-EDIT-AREA           44563003
445700         IF DP010I-ERROR-DETECTED                                 44570001
445800             CONTINUE                                             44580001
445900         ELSE                                                     44590001
446000             MOVE DP010I-NUMERIC-FIELD                            44600001
446100                                     TO PV-DD-9                   44610001
446200         END-IF                                                   44620001
446300     END-IF                                                       44630001
446400                                                                  44640001
446500     IF PV-CCYY = SPACE                                           44650001
446600         CONTINUE                                                 44660001
446700     ELSE                                                         44670001
446800         IF PV-CCYY NUMERIC                                       44680001
446900             IF PV-YY < 81                                        44690001
447000                 MOVE 20             TO PV-CC                     44700001
447100             ELSE                                                 44710001
447200                 MOVE 19             TO PV-CC                     44720001
447300             END-IF                                               44730001
447400         ELSE                                                     44740001
447500             MOVE PV-CCYY            TO DP010I-UNEDITED-FIELD     44750001
447600             MOVE 4                  TO DP010I-MAXIMUM-DIGITS     44760001
447700             MOVE 0                  TO DP010I-MAXIMUM-DECIMALS   44770001
447800             SET DP010I-NEGATIVE-NOT-ALLOWED                      44780001
447900                                         TO TRUE                  44790001
448020             CALL DP010I-NUMERIC-EDIT-ROUTINE                     44802003
448030                         USING DP010I-NUMERIC-EDIT-AREA           44803003
448100             IF DP010I-ERROR-DETECTED                             44810001
448200                 CONTINUE                                         44820001
448300             ELSE                                                 44830001
448400                 MOVE DP010I-NUMERIC-FIELD                        44840001
448500                                         TO PV-CCYY-9             44850001
448600*-->             ALLOW THEM TO ENTER A TWO DIGIT YEAR W/OUT CENT  44860001
448700                 IF PV-YY < 81                                    44870001
448800                     MOVE 20             TO PV-CC                 44880001
448900                 ELSE                                             44890001
449000                     MOVE 19             TO PV-CC                 44900001
449100                 END-IF                                           44910001
449200             END-IF                                               44920001
449300         END-IF                                                   44930001
449400     END-IF                                                       44940001
449500                                                                  44950001
449600     SET PS-VALID-DATE TO TRUE                                    44960001
449700                                                                  44970001
449800     INITIALIZE DPG51                                             44980001
449900                DPG52                                             44990001
450000                DPG53                                             45000001
450100                DPG54                                             45010001
450200                DPG55                                             45020001
450300                DPG56                                             45030001
450400                                                                  45040001
450500     MOVE 'F2'                 TO DPG51-CALENDAR-TYPE             45050001
450600                                                                  45060001
450700     SET DPG51-DO-NOT-INCR-DECR-DATE                              45070001
450800         DPG52-LK-DTE-ISO-FMT  TO TRUE                            45080001
450900                                                                  45090001
451000     IF PV-CCYY NUMERIC AND                                       45100001
451100        PV-MM   NUMERIC AND                                       45110001
451200        PV-DD   NUMERIC                                           45120001
451300         MOVE '-'      TO PV-DASH1                                45130001
451400                          PV-DASH2                                45140001
451500         MOVE PV-CCYYMMDD-DATE  TO DPG52-LK-DATE-INPUT            45150001
451600                                                                  45160001
451700         CALL DP500-KOHLS-CALENDAR-ROUTINE                        45170001
451800             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            45180001
451900                                                                  45190001
452000         IF (DPG54-WARNING-ERROR OR                               45200001
452100             DPG54-SEVERE-ERROR)                                  45210001
452200             SET PS-INVALID-DATE TO TRUE                          45220001
452300         ELSE                                                     45230001
452400             IF PV-CCYYMMDD-DATE < PC-INVC-DTE-BEG-LIMIT          45240001
452500                SET PS-DATE-RANGE-ERROR TO TRUE                   45250001
452600             END-IF                                               45260001
452700         END-IF                                                   45270001
452800     ELSE                                                         45280001
452900         SET PS-INVALID-DATE    TO TRUE                           45290001
453000     END-IF.                                                      45300001
453100                                                                  45310001
453200*----------------------------------------------------------------*45320001
453300* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *45330001
453400* MAP.                                                           *45340001
453500*  ANY NEW FIELDS ADDED TO THIS MAP MUST BE REFERRED TO IN PGM   *45350001
453600*   PARAGRAPH 3201-                                              *45360001
453700*----------------------------------------------------------------*45370001
453800 3200-RESET-ATTRIBUTES.                                           45380001
453900                                                                  45390001
454000* THESE ARE THE FIELDS FOR BOTH MERCHANDISE AND EXPENSE INVOICES. 45400001
454100     IF ASC-UPDATE-PENDING OR                                     45410001
454200*       ASC-ADD-PENDING OR                                        45420001
454300        ASC-ADD-REQUESTED OR                                      45430001
454400        ASC-RETURN                                                45440001
454500*WR5091 ADD LOGIC TO ALLOW UPDATE OF SEL CODES FOR EDI            45450001
454600        IF ASC-ENTR-MTHD-CDE = 'ED'                               45460001
454700           PERFORM 3201-SET-EDI-ATTR                              45470001
454800        ELSE                                                      45480001
454900           MOVE DP015-UNP-ALP-NOR-OFF TO AINVNBRA                 45490001
455000                                         APONUMA                  45500001
455100                                         AHLDINDA                 45510001
455200                                         AINVMMA                  45520001
455300                                         AINVDDA                  45530001
455400                                         AINVYYA                  45540001
455500                                         ADUNNBRA                 45550001
455600                                         ASTRNBRA                 45560001
455700                                         AINPCTA                  45570001
455800                                         AINDAYA                  45580001
455900                                         AINEOMA                  45590001
456000                                         AINEXTA                  45600001
456100                                         ANETCSTA                 45610001
456200                                         ABOLNBRA                 45620001
456300           MOVE DP015-GREEN           TO AINVNBRC                 45630001
456400                                         APONUMC                  45640001
456500                                         AHLDINDC                 45650001
456600                                         AINVMMC                  45660001
456700                                         AINVDDC                  45670001
456800                                         AINVYYC                  45680001
456900                                         ADUNNBRC                 45690001
457000                                         ASTRNBRC                 45700001
457100                                         AINPCTC                  45710001
457200                                         AINDAYC                  45720001
457300                                         AINEOMC                  45730001
457400                                         AINEXTC                  45740001
457500                                         ANETCSTC                 45750001
457600                                         ABOLNBRC                 45760001
457700           MOVE DP015-UNDERLINE       TO AINVNBRH                 45770001
457800                                         APONUMH                  45780001
457900                                         AHLDINDH                 45790001
458000                                         AINVMMH                  45800001
458100                                         AINVDDH                  45810001
458200                                         AINVYYH                  45820001
458300                                         ADUNNBRH                 45830001
458400                                         ASTRNBRH                 45840001
458500                                         AINPCTH                  45850001
458600                                         AINDAYH                  45860001
458700                                         AINEOMH                  45870001
458800                                         AINEXTH                  45880001
458900                                         ANETCSTH                 45890001
459000                                         ABOLNBRH                 45900001
459100        END-IF                                                    45910001
459200        IF ASC-UPDATE-PENDING OR                                  45920001
459300           ASC-RETURN                                             45930001
459400           MOVE DP015-PRO-NOR-OFF     TO AINVNBRA                 45940001
459500                                         APONUMA                  45950001
459600           MOVE DP015-BLUE            TO AINVNBRC                 45960001
459700                                         APONUMC                  45970001
459800           MOVE DP015-HL-OFF          TO AINVNBRH                 45980001
459900                                         APONUMH                  45990001
460000        END-IF                                                    46000001
460100        IF ASC-UPDATE-PENDING                                     46010001
460200           IF ASC-MTCH-LVL-CDE = 'P'                              46020001
460300              MOVE DP015-PRO-NOR-OFF  TO ASTRNBRA                 46030001
460400              MOVE DP015-BLUE         TO ASTRNBRC                 46040001
460500              MOVE DP015-HL-OFF       TO ASTRNBRH                 46050001
460600           END-IF                                                 46060001
460700        END-IF                                                    46070001
460800     ELSE                                                         46080001
460900         MOVE DP015-PRO-NOR-OFF       TO AINVNBRA                 46090001
461000                                         APONUMA                  46100001
461100                                         AHLDINDA                 46110001
461200                                         AINVMMA                  46120001
461300                                         AINVDDA                  46130001
461400                                         AINVYYA                  46140001
461500                                         ADUNNBRA                 46150001
461600                                         ASTRNBRA                 46160001
461700                                         AINPCTA                  46170001
461800                                         AINDAYA                  46180001
461900                                         AINEOMA                  46190001
462000                                         AINEXTA                  46200001
462100                                         ANETCSTA                 46210001
462200                                         ABOLNBRA                 46220001
462300                                         ACNTNRA                  46230001
462400                                         AREFNBRA                 46240001
462500                                         AENTRYA                  46250001
462600                                         ACHRGCDA                 46260001
462700         MOVE DP015-BLUE              TO AINVNBRC                 46270001
462800                                         APONUMC                  46280001
462900                                         AHLDINDC                 46290001
463000                                         AINVMMC                  46300001
463100                                         AINVDDC                  46310001
463200                                         AINVYYC                  46320001
463300                                         ADUNNBRC                 46330001
463400                                         ASTRNBRC                 46340001
463500                                         AINPCTC                  46350001
463600                                         AINDAYC                  46360001
463700                                         AINEOMC                  46370001
463800                                         AINEXTC                  46380001
463900                                         ANETCSTC                 46390001
464000                                         ABOLNBRC                 46400001
464100                                         ACNTNRC                  46410001
464200                                         AREFNBRC                 46420001
464300                                         AENTRYC                  46430001
464400                                         ACHRGCDC                 46440001
464500         MOVE DP015-HL-OFF            TO AINVNBRH                 46450001
464600                                         APONUMH                  46460001
464700                                         AHLDINDH                 46470001
464800                                         AINVMMH                  46480001
464900                                         AINVDDH                  46490001
465000                                         AINVYYH                  46500001
465100                                         ADUNNBRH                 46510001
465200                                         ASTRNBRH                 46520001
465300                                         AINPCTH                  46530001
465400                                         AINDAYH                  46540001
465500                                         AINEOMH                  46550001
465600                                         AINEXTH                  46560001
465700                                         ANETCSTH                 46570001
465800                                         ABOLNBRH                 46580001
465900                                         ACNTNRH                  46590001
466000                                         AREFNBRH                 46600001
466100                                         AENTRYH                  46610001
466200                                         ACHRGCDH                 46620001
466300     END-IF.                                                      46630001
466400                                                                  46640001
466500     IF ASC-EXPENSE-INVC                                          46650001
466600*WR5091 ADD LOGIC TO ALLOW UPDATE OF SEL CODES FOR EDI            46660001
466700        IF ASC-ENTR-MTHD-CDE = 'ED'                               46670001
466800           CONTINUE                                               46680001
466900        ELSE                                                      46690001
467000         IF ASC-UPDATE-PENDING OR                                 46700001
467100*           ASC-ADD-PENDING OR                                    46710001
467200            ASC-ADD-REQUESTED OR                                  46720001
467300            ASC-RETURN                                            46730001
467400             MOVE DP015-UNP-ALP-NOR-OFF                           46740001
467500                                      TO ASPLITA                  46750001
467600             MOVE DP015-GREEN         TO ASPLITC                  46760001
467700             MOVE DP015-UNDERLINE     TO ASPLITH                  46770001
467800         END-IF                                                   46780001
467900         MOVE DP015-PRO-NOR-OFF       TO ATOTCSTA                 46790001
468000                                         APOSELA                  46800001
468100                                         AINSELA                  46810001
468200                                         ATOTINVA                 46820001
468300                                         ACMPFRTA                 46830001
468400                                         AVNDFRTA                 46840001
468500                                         ACARTCTA                 46850001
468600                                         ACHRGCDA                 46860001
468700         MOVE DP015-BLUE              TO ATOTCSTC                 46870001
468800                                         APOSELC                  46880001
468900                                         AINSELC                  46890001
469000                                         ATOTINVC                 46900001
469100                                         ACMPFRTC                 46910001
469200                                         AVNDFRTC                 46920001
469300                                         ACARTCTC                 46930001
469400                                         ACHRGCDC                 46940001
469500         MOVE DP015-HL-OFF            TO ATOTCSTH                 46950001
469600                                         APOSELH                  46960001
469700                                         AINSELH                  46970001
469800                                         ATOTINVH                 46980001
469900                                         ACMPFRTH                 46990001
470000                                         AVNDFRTH                 47000001
470100                                         ACARTCTH                 47010001
470200                                         ACHRGCDH                 47020001
470300        END-IF                                                    47030001
470400     ELSE                                                         47040001
470500         IF ASC-UPDATE-PENDING OR                                 47050001
470600*           ASC-ADD-PENDING OR                                    47060001
470700            ASC-ADD-REQUESTED OR                                  47070001
470800            ASC-RETURN                                            47080001
470900*WR5091 ADD LOGIC TO ALLOW UPDATE OF SEL CODES FOR EDI            47090001
471000             IF ASC-ENTR-MTHD-CDE = 'ED'                          47100001
471100                 CONTINUE                                         47110001
471200             ELSE                                                 47120001
471300                 MOVE DP015-UNP-ALP-NOR-OFF                       47130001
471400                                      TO ATOTCSTA                 47140001
471500                                         APOSELA                  47150001
471600                                         AINSELA                  47160001
471700                                         ASPLITA                  47170001
471800                                         ATOTINVA                 47180001
471900                                         ACMPFRTA                 47190001
472000                                         AVNDFRTA                 47200001
472100                                         ACARTCTA                 47210001
472200                 MOVE DP015-GREEN     TO ATOTCSTC                 47220001
472300                                         APOSELC                  47230001
472400                                         AINSELC                  47240001
472500                                         ASPLITC                  47250001
472600                                         ATOTINVC                 47260001
472700                                         ACMPFRTC                 47270001
472800                                         AVNDFRTC                 47280001
472900                                         ACARTCTC                 47290001
473000                 MOVE DP015-UNDERLINE TO ATOTCSTH                 47300001
473100                                         APOSELH                  47310001
473200                                         AINSELH                  47320001
473300                                         ASPLITH                  47330001
473400                                         ATOTINVH                 47340001
473500                                         ACMPFRTH                 47350001
473600                                         AVNDFRTH                 47360001
473700                                         ACARTCTH                 47370001
473800                 MOVE DP015-HL-OFF    TO ACNTNRH                  47380001
473900                                         AENTRYH                  47390001
474000                                         AREFNBRH                 47400001
474100                 IF ASC-IMPORT-PO                                 47410001
474200* MDSE INVOICE FOR AN IMPORT PO. IMPORT CHRG CDE IS REQUIRED      47420001
474300                     MOVE DP015-UNP-ALP-NOR-OFF                   47430001
474400                                      TO ACHRGCDA                 47440001
474500                     MOVE DP015-GREEN TO ACHRGCDC                 47450001
474600                     MOVE DP015-UNDERLINE                         47460001
474700                                      TO ACHRGCDH                 47470001
474800                 END-IF                                           47480001
474900             END-IF                                               47490001
475000         ELSE                                                     47500001
475100             MOVE DP015-PRO-NOR-OFF   TO ASTRNBRA                 47510001
475200                                         ATOTCSTA                 47520001
475300                                         APOSELA                  47530001
475400                                         AINSELA                  47540001
475500                                         ASPLITA                  47550001
475600                                         ATOTINVA                 47560001
475700                                         ACMPFRTA                 47570001
475800                                         AVNDFRTA                 47580001
475900                                         ACARTCTA                 47590001
476000             MOVE DP015-BLUE          TO ASTRNBRC                 47600001
476100                                         ATOTCSTC                 47610001
476200                                         APOSELC                  47620001
476300                                         AINSELC                  47630001
476400                                         ASPLITC                  47640001
476500                                         ATOTINVC                 47650001
476600                                         ACMPFRTC                 47660001
476700                                         AVNDFRTC                 47670001
476800                                         ACARTCTC                 47680001
476900             MOVE DP015-HL-OFF        TO ASTRNBRH                 47690001
477000                                         ATOTCSTH                 47700001
477100                                         APOSELH                  47710001
477200                                         AINSELH                  47720001
477300                                         ASPLITH                  47730001
477400                                         ATOTINVH                 47740001
477500                                         ACMPFRTH                 47750001
477600                                         AVNDFRTH                 47760001
477700                                         ACARTCTH                 47770001
477800         END-IF                                                   47780001
477900     END-IF.                                                      47790001
478000                                                                  47800001
478100*--------------------------------------------------------------*  47810001
478200* ALLOW UPDATE OF 'SEL' CODES FOR EDI IF INVOICE TERMS EXIST   *  47820001
478300* WR5091                                                       *  47830001
478400*--------------------------------------------------------------*  47840001
478500 3201-SET-EDI-ATTR.                                               47850001
478600                                                                  47860001
478700     IF ASC-TINVCTM-EXISTS                                        47870001
478800        MOVE DP015-UNP-ALP-NOR-OFF TO APOSELA                     47880001
478900                                      AINSELA                     47890001
479000        MOVE DP015-GREEN           TO APOSELC                     47900001
479100                                      AINSELC                     47910001
479200        MOVE DP015-UNDERLINE       TO APOSELH                     47920001
479300                                      AINSELH                     47930001
479400     ELSE                                                         47940001
479500        MOVE DP015-PRO-NOR-OFF     TO APOSELA                     47950001
479600                                      AINSELA                     47960001
479700        MOVE DP015-BLUE            TO APOSELC                     47970001
479800                                      AINSELC                     47980001
479900        MOVE DP015-HL-OFF          TO APOSELH                     47990001
480000                                      AINSELH                     48000001
480100     END-IF.                                                      48010001
480200                                                                  48020001
480300     MOVE DP015-UNP-ALP-NOR-OFF    TO AHLDINDA.                   48030001
480400     MOVE DP015-GREEN              TO AHLDINDC.                   48040001
480500     MOVE DP015-UNDERLINE          TO AHLDINDH.                   48050001
480600                                                                  48060001
480700     MOVE DP015-PRO-NOR-OFF        TO AINVNBRA                    48070001
480800                                      APONUMA                     48080001
480900                                      AINVNBRA                    48090001
481000                                      AINVMMA                     48100001
481100                                      AINVDDA                     48110001
481200                                      AINVYYA                     48120001
481300                                      ADUNNBRA                    48130001
481400                                      ASTRNBRA                    48140001
481500                                      ATOTCSTA                    48150001
481600                                      AINPCTA                     48160001
481700                                      AINDAYA                     48170001
481800                                      AINEOMA                     48180001
481900                                      AINEXTA                     48190001
482000                                      ASPLITA                     48200001
482100                                      ATOTINVA                    48210001
482200                                      ANETCSTA                    48220001
482300                                      ACMPFRTA                    48230001
482400                                      AVNDFRTA                    48240001
482500                                      ABOLNBRA                    48250001
482600                                      ACNTNRA                     48260001
482700                                      AREFNBRA                    48270001
482800                                      AENTRYA                     48280001
482900                                      ACARTCTA                    48290001
483000                                      ACHRGCDA.                   48300001
483100     MOVE DP015-BLUE               TO AINVNBRC                    48310001
483200                                      APONUMC                     48320001
483300                                      AINVNBRC                    48330001
483400                                      AINVMMC                     48340001
483500                                      AINVDDC                     48350001
483600                                      AINVYYC                     48360001
483700                                      ADUNNBRC                    48370001
483800                                      ASTRNBRC                    48380001
483900                                      ATOTCSTC                    48390001
484000                                      AINPCTC                     48400001
484100                                      AINDAYC                     48410001
484200                                      AINEOMC                     48420001
484300                                      AINEXTC                     48430001
484400                                      ASPLITC                     48440001
484500                                      ATOTINVC                    48450001
484600                                      ANETCSTC                    48460001
484700                                      ACMPFRTC                    48470001
484800                                      AVNDFRTC                    48480001
484900                                      ABOLNBRC                    48490001
485000                                      ACNTNRC                     48500001
485100                                      AREFNBRC                    48510001
485200                                      AENTRYC                     48520001
485300                                      ACARTCTC                    48530001
485400                                      ACHRGCDC.                   48540001
485500     MOVE DP015-HL-OFF             TO AINVNBRH                    48550001
485600                                      APONUMH                     48560001
485700                                      AINVNBRH                    48570001
485800                                      AINVMMH                     48580001
485900                                      AINVDDH                     48590001
486000                                      AINVYYH                     48600001
486100                                      ADUNNBRH                    48610001
486200                                      ASTRNBRH                    48620001
486300                                      ATOTCSTH                    48630001
486400                                      AINPCTH                     48640001
486500                                      AINDAYH                     48650001
486600                                      AINEOMH                     48660001
486700                                      AINEXTH                     48670001
486800                                      ASPLITH                     48680001
486900                                      ATOTINVH                    48690001
487000                                      ANETCSTH                    48700001
487100                                      ACMPFRTH                    48710001
487200                                      AVNDFRTH                    48720001
487300                                      ABOLNBRH                    48730001
487400                                      ACNTNRH                     48740001
487500                                      AREFNBRH                    48750001
487600                                      AENTRYH                     48760001
487700                                      ACARTCTH                    48770001
487800                                      ACHRGCDH.                   48780001
487900                                                                  48790001
488000*-------------------------------------------------------------*   48800001
488100* SAVE SCREEN FIELDS FOR LATER COMPARISONS                    *   48810001
488200*-------------------------------------------------------------*   48820001
488300 3500-SAVE-SCREEN-FIELDS.                                         48830001
488400                                                                  48840001
488500     MOVE ASC-NEWLY-ENTERED-FIELD-VALUES  TO                      48850001
488600          ASC-ORIGINAL-FIELD-VALUES.                              48860001
488700                                                                  48870001
488800*-------------------------------------------------------------*   48880001
488900* CHECK TO SEE IF ANY FIELDS CHANGED.                         *   48890001
489000*-------------------------------------------------------------*   48900001
489100 3600-CHECK-IF-FIELDS-CHANGED.                                    48910001
489200                                                                  48920001
489300     MOVE 'N'                    TO ASC-FIELDS-MODIFIED-SW        48930001
489400                                                                  48940001
489500     IF ASC-NEWLY-ENTERED-FIELD-VALUES  NOT =                     48950001
489600        ASC-ORIGINAL-FIELD-VALUES                                 48960001
489700         SET ASC-FIELDS-MODIFIED TO TRUE                          48970001
489800     END-IF.                                                      48980001
489900                                                                  48990001
490000*--------------------------------------------------------------*  49000001
490100* VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST      *  49010001
490200*    ENTRY.                                                    *  49020001
490300*--------------------------------------------------------------*  49030001
490400 4000-BUILD-INITIAL-PANEL.                                        49040001
490500                                                                  49050001
490600     SET PS-NO-ERROR TO TRUE                                      49060001
490700                                                                  49070001
490800     INITIALIZE DCLTEXTENT                                        49080001
490900                DCLTBUSLOC                                        49090001
491000                DCLTENTNME                                        49100001
491100                DCLTPAYTRM                                        49110001
491200                DCLTPURCHS                                        49120001
491300                DCLTPLNSHP                                        49130001
491400                DCLTPOINST                                        49140001
491500                DCLTINSTCD                                        49150001
491600                DCLTPOAGMT                                        49160001
491700                DCLTINVOIC                                        49170001
491800                DCLTMDINVC                                        49180001
491900                DCLTEXINVC                                        49190001
492000                DCLTINVCTM                                        49200001
492100                DCLTALCHRG                                        49210001
492200                DK-DB2-KEYS                                       49220001
492300                ASC-NEWLY-ENTERED-FIELD-VALUES                    49230001
492400                ASC-ORIGINAL-FIELD-VALUES                         49240001
492500                ASC-ALPHA-COUNTERPARTS                            49250001
492600                ASC-OTHER-FIELDS.                                 49260001
492700                                                                  49270001
492800     EXEC SQL                                                     49280001
492900         SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           49290001
493000     END-EXEC                                                     49300001
493100                                                                  49310001
493200     MOVE ASC-KEY-INVC-ID         TO DK-INVC-ID                   49320001
493300                                                                  49330001
493400     IF ASC-KEY-PO-NBR > +0                                       49340001
493500         MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR-LOW                49350001
493600                                     DK-PO-NBR-HIGH               49360001
493700     ELSE                                                         49370001
493800         MOVE +0                  TO DK-PO-NBR-LOW                49380001
493900         MOVE +999999999          TO DK-PO-NBR-HIGH               49390001
494000     END-IF.                                                      49400001
494100                                                                  49410001
494200* DEFAULT TO UPDATE WHATEVER INVOICE TYPE IS ON DB                49420001
494300     IF ASC-KEY-INVC-TYP-CDE = SPACE                              49430001
494400*      OR ASC-ADD-PENDING                                         49440001
494500       OR ASC-ADD-REQUESTED                                       49450001
494600         MOVE LOW-VALUES          TO DK-INVC-TYP-CDE1             49460001
494700         MOVE HIGH-VALUES         TO DK-INVC-TYP-CDE2             49470001
494800     ELSE                                                         49480001
494900         MOVE ASC-KEY-INVC-TYP-CDE TO DK-INVC-TYP-CDE1            49490001
495000                                      DK-INVC-TYP-CDE2            49500001
495100     END-IF.                                                      49510001
495200                                                                  49520001
495300     IF ASC-EXPENSE-INVC                                          49530001
495400         MOVE PC-EXPENSE-STR-NBR  TO ASC-ALP-STR-NBR              49540001
495500                                     ASC-NEW-STR-NBR              49550001
495600         MOVE PC-DC-NBR           TO ASC-NEW-DC-NBR               49560001
495700         MOVE 'S'                 TO ASC-NEW-IN-SEL               49570001
495800         MOVE 'NET'               TO ASC-ALP-DISC-PCT             49580001
495900                                                                  49590001
496000         IF ASC-NEW-RMIT-VND-ID = PV-IMPORT-VENDOR                49600001
496100            MOVE 005              TO ASC-ALP-DISC-DUE-DAY-QTY     49610001
496200                                     ASC-NEW-IN-DISC-DUE-DAY-QTY  49620001
496300         ELSE                                                     49630001
496400            MOVE 010              TO ASC-ALP-DISC-DUE-DAY-QTY     49640001
496500                                     ASC-NEW-IN-DISC-DUE-DAY-QTY  49650001
496600         END-IF                                                   49660001
496700                                                                  49670001
496800         MOVE 'N'                 TO ASC-NEW-IN-EOM               49680001
496900         MOVE ZERO                TO ASC-ALP-EXTD-DAYS-QTY        49690001
497000                                     ASC-NEW-IN-EXTD-DAYS-QTY     49700001
497100         MOVE 'N'                 TO ASC-NEW-IN-SPLIT-TERMS-IND   49710001
497200     ELSE                                                         49720001
497300         MOVE PC-BULK-STR-NBR     TO ASC-ALP-STR-NBR              49730001
497400                                     ASC-NEW-STR-NBR              49740001
497500         MOVE PC-DC-NBR           TO ASC-NEW-DC-NBR               49750001
497600     END-IF.                                                      49760001
497700                                                                  49770001
497800     SET ASC-INVOICE-NOT-FOUND    TO TRUE                         49780001
497900                                                                  49790001
498000     IF PS-NO-ERROR                                               49800001
498100*        IF ASC-ADD-PENDING                                       49810001
498200         IF ASC-ADD-REQUESTED                                     49820001
498300             PERFORM 4001-ADD-PENDING-LOGIC                       49830001
498400         ELSE                                                     49840001
498500             PERFORM 4005-VALIDATE-KEY-FIELDS                     49850001
498600         END-IF                                                   49860001
498700     ELSE                                                         49870001
498800         SET DP020-NEXT-ACT-APPL-ERROR                            49880001
498900                                  TO TRUE                         49890001
499000     END-IF.                                                      49900001
499100                                                                  49910001
499200*--------------------------------------------------------------*  49920001
499300* DETERMINE WHEN DATA CAN BE ADDED RELATED TO A INVOICE/PO     *  49930001
499400* COMBINATION                                                  *  49940001
499500*--------------------------------------------------------------*  49950001
499600 4001-ADD-PENDING-LOGIC.                                          49960001
499700                                                                  49970001
499800     MOVE ASC-KEY-INVC-ID TO ASC-NEW-INVC-ID                      49980001
499900     MOVE ASC-KEY-PO-NBR  TO ASC-NEW-PO-NBR                       49990001
500000                             ASC-ALP-PO-NBR-NUM                   50000001
500100                                                                  50010001
500200     IF ASC-ALP-PO-NBR = SPACES                                   50020001
500300       OR ASC-ALP-PO-NBR-NUM = ZEROS                              50030001
500400         MOVE +0                 TO ASC-NEW-PO-NBR                50040001
500500         SET DP020-MSG-FATAL     TO TRUE                          50050001
500600*        -- MUST EXIST --                                         50060001
500700         MOVE DP015-UNP-ALP-BRT-OFF                               50070001
500800                                 TO APONUMA                       50080001
500900         MOVE DP015-RED          TO APONUMC                       50090001
501000         MOVE DP015-REVERSE      TO APONUMH                       50100001
501100         MOVE -1                 TO APONUML                       50110001
501200         IF PS-NO-ERROR                                           50120001
501300             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             50130001
501400         END-IF                                                   50140001
501500         SET PS-ERROR            TO TRUE                          50150001
501600     ELSE                                                         50160001
501700         MOVE ASC-ALP-PO-NBR     TO DP010I-UNEDITED-FIELD         50170001
501800         MOVE 9                  TO DP010I-MAXIMUM-DIGITS         50180001
501900         MOVE 0                  TO DP010I-MAXIMUM-DECIMALS       50190001
502000         SET  DP010I-NEGATIVE-NOT-ALLOWED                         50200001
502100                                 TO TRUE                          50210001
502220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         50222003
502230                         USING DP010I-NUMERIC-EDIT-AREA           50223003
502300         IF DP010I-ERROR-DETECTED                                 50230001
502400             SET DP020-MSG-FATAL TO TRUE                          50240001
502500*            -- MUST BE NUMERIC --                                50250001
502600             MOVE DP015-UNP-ALP-BRT-OFF                           50260001
502700                                 TO APONUMA                       50270001
502800             MOVE DP015-RED      TO APONUMC                       50280001
502900             MOVE DP015-REVERSE  TO APONUMH                       50290001
503000             MOVE -1             TO APONUML                       50300001
503100             IF PS-NO-ERROR                                       50310001
503200                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         50320001
503300             END-IF                                               50330001
503400             SET PS-ERROR        TO TRUE                          50340001
503500         END-IF                                                   50350001
503600     END-IF                                                       50360001
503700                                                                  50370001
503800     IF ASC-VALID-INVC-TYP                                        50380001
503900         IF NOT ASC-VALID-ADD-TYP                                 50390001
504000             SET DP020-MSG-FATAL TO TRUE                          50400001
504100             MOVE DP015-UNP-ALP-BRT-OFF                           50410001
504200                                 TO AINVNBRA                      50420001
504300             MOVE DP015-RED      TO AINVNBRC                      50430001
504400             MOVE DP015-REVERSE  TO AINVNBRH                      50440001
504500             MOVE -1             TO AINVNBRL                      50450001
504600             IF PS-NO-ERROR                                       50460001
504700* INVALID INVOICE TYPE FOR THE FUNCTION REQUESTED                 50470001
504800                 MOVE PC-TSYMSG-01565                             50480001
504900                                 TO DP020-MSG-NUMBER              50490001
505000             END-IF                                               50500001
505100             SET PS-ERROR        TO TRUE                          50510001
505200         END-IF                                                   50520001
505300     ELSE                                                         50530001
505400         SET DP020-MSG-FATAL     TO TRUE                          50540001
505500         MOVE DP015-UNP-ALP-BRT-OFF                               50550001
505600                                 TO AINVNBRA                      50560001
505700         MOVE DP015-RED          TO AINVNBRC                      50570001
505800         MOVE DP015-REVERSE      TO AINVNBRH                      50580001
505900         MOVE -1                 TO AINVNBRL                      50590001
506000         IF PS-NO-ERROR                                           50600001
506100* -- TYPE CODE DOES NOT EXIST --                                  50610001
506200             MOVE PC-TSYMSG-00527 TO DP020-MSG-NUMBER             50620001
506300         END-IF                                                   50630001
506400         SET PS-ERROR            TO TRUE                          50640001
506500     END-IF                                                       50650001
506600                                                                  50660001
506700     IF ASC-KEY-INVC-ID > SPACES AND                              50670001
506800        ASC-KEY-PO-NBR >  +0                                      50680001
506900                                                                  50690001
507000         PERFORM 4010-VALIDATE-INVC-PO-COMBO                      50700001
507100         IF ASC-INVOICE-NOT-FOUND                                 50710001
507200             CONTINUE                                             50720001
507300         ELSE                                                     50730001
507400             SET DP020-MSG-FATAL  TO TRUE                         50740001
507500*           -- THE PO_NBR/INVC ALREADY EXISTS --                  50750001
507600             IF PS-NO-ERROR                                       50760001
507700                 MOVE PC-TSYMSG-00857                             50770001
507800                                  TO DP020-MSG-NUMBER             50780001
507900             END-IF                                               50790001
508000             SET PS-ERROR         TO TRUE                         50800001
508100         END-IF                                                   50810001
508200     END-IF                                                       50820001
508300                                                                  50830001
508400     IF PS-NO-ERROR                                               50840001
508500         MOVE ASC-KEY-PO-NBR          TO INVOIC-PO-NBR            50850001
508600         PERFORM 4130-GET-TPURCHS-DATA                            50860001
508700                                                                  50870001
508800         IF PS-TPURCHS-NOT-FOUND                                  50880001
508900             SET DP020-MSG-FATAL  TO TRUE                         50890001
509000             MOVE DP015-UNP-ALP-BRT-OFF                           50900001
509100                                  TO APONUMA                      50910001
509200             MOVE DP015-RED      TO APONUMC                       50920001
509300             MOVE DP015-REVERSE  TO APONUMH                       50930001
509400*            -- PO_NBR NOT FOUND ON TPURCHS --                    50940001
509500             MOVE -1              TO APONUML                      50950001
509600             IF PS-NO-ERROR                                       50960001
509700                 MOVE PC-TSYMSG-00726                             50970001
509800                                   TO DP020-MSG-NUMBER            50980001
509900             END-IF                                               50990001
510000             SET PS-ERROR         TO TRUE                         51000001
510100         END-IF                                                   51010001
510200                                                                  51020001
510300         IF PS-TPURCHS-FOUND                                      51030001
510400             MOVE PURCHS-PO-TYP-CDE   TO ASC-PO-TYP-CDE           51040001
510500             MOVE PURCHS-DIR-STR-IND  TO ASC-DIR-STR-IND          51050001
510600             IF ASC-KEY-INVC-TYP-CDE = SPACE                      51060001
510700                 IF ASC-IMPORT-PO                                 51070001
510800                     SET DP020-MSG-FATAL TO TRUE                  51080001
510900                     MOVE DP015-UNP-ALP-BRT-OFF                   51090001
511000                                      TO AINVNBRA                 51100001
511100                     MOVE DP015-RED   TO AINVNBRC                 51110001
511200                     MOVE DP015-REVERSE TO AINVNBRH               51120001
511300                     MOVE -1          TO AINVNBRL                 51130001
511400                     IF PS-NO-ERROR                               51140001
511500* INVALID INVOICE TYPE FOR THE FUNCTION REQUESTED                 51150001
511600                         MOVE PC-TSYMSG-01565 TO DP020-MSG-NUMBER 51160001
511700                     END-IF                                       51170001
511800                     SET PS-ERROR     TO TRUE                     51180001
511900                 ELSE                                             51190001
512000* DEFAULT TO ADD A MERCHANDISE INVOICE FOR DOMESTIC PO'S          51200001
512100                     SET ASC-MDSE-INVC TO TRUE                    51210001
512200                 END-IF                                           51220001
512300             END-IF                                               51230001
512400             IF ASC-IMPORT-PO                                     51240001
512500                 IF ASC-MDSE-INVC                                 51250001
512600                     MOVE DP015-UNP-ALP-NOR-OFF                   51260001
512700                                      TO ACHRGCDA                 51270001
512800                     MOVE DP015-GREEN TO ACHRGCDC                 51280001
512900                     MOVE DP015-UNDERLINE TO ACHRGCDH             51290001
513000                 END-IF                                           51300001
513100             ELSE                                                 51310001
513200* MUST BE AN IMPORT PO TO HAVE AN EXPENSE INVOICE ENTERED         51320001
513300                 IF ASC-EXPENSE-INVC                              51330001
513400                     SET DP020-MSG-FATAL TO TRUE                  51340001
513500                     MOVE DP015-UNP-ALP-BRT-OFF                   51350001
513600                                      TO APONUMA                  51360001
513700*                                        AINVTYPA                 51370001
513800                     MOVE DP015-RED   TO APONUMC                  51380001
513900                                         AINVTYPC                 51390001
514000                     MOVE DP015-REVERSE TO APONUMH                51400001
514100                                           AINVTYPH               51410001
514200                     MOVE -1          TO AINVTYPL                 51420001
514300                     IF PS-NO-ERROR                               51430001
514400* INVALID INVOICE TYPE FOR FOR DOMESTIC PURCHASE ORDER            51440001
514500                         MOVE PC-TSYMSG-01566                     51450001
514600                                      TO DP020-MSG-NUMBER         51460001
514700                     END-IF                                       51470001
514800                     SET PS-ERROR     TO TRUE                     51480001
514900                 END-IF                                           51490001
515000             END-IF                                               51500001
515100             IF PS-NO-ERROR                                       51510001
515200                MOVE PURCHS-DEPT-NBR  TO ASC-DEPT-NBR             51520001
515300                MOVE PURCHS-NEW-STR-PO-IND      TO                51530001
515400                     ASC-NEW-STR-PO-IND                           51540001
515500* 4104- MERCHANDISE INVOICE DATA ONLY                             51550001
515600                IF NOT ASC-EXPENSE-INVC                           51560001
515700                    PERFORM 4104-GET-PLNSHP                       51570001
515800                END-IF                                            51580001
515900                PERFORM 4105-GET-INST                             51590001
516000                IF ASC-DUNS-NOT-ENTERED                           51600001
516100                    PERFORM 4107-GET-ENT-DATA-USING-ENT-ID        51610001
516200                    MOVE EXTENT-DUN-NBR                           51620001
516300                                 TO ASC-NEW-RMIT-VND-ID           51630001
516400                                    PV-PO-DUN-NBR                 51640001
516500                                    ASC-HOLD-PO-DUN-NBR           51650001
516600                ELSE                                              51660001
516700                    MOVE ASC-NEW-RMIT-VND-ID                      51670001
516800                                 TO PV-PO-DUN-NBR                 51680001
516900                END-IF                                            51690001
517000                IF ASC-EXPENSE-INVC                               51700001
517100                   IF ASC-NEW-RMIT-VND-ID = PV-IMPORT-VENDOR      51710001
517200                      MOVE 005 TO ASC-ALP-DISC-DUE-DAY-QTY        51720001
517300                                  ASC-NEW-IN-DISC-DUE-DAY-QTY     51730001
517400                   END-IF                                         51740001
517500                END-IF                                            51750001
517600                PERFORM 4140-GET-TPAYTRM-DATA                     51760001
517700                COMPUTE ASC-PO-DISCOUNT-PCT =                     51770001
517800                        PAYTRM-DISCOUNT-PCT * 100                 51780001
517900                                                                  51790001
518000                IF PAYTRM-DISCOUNT-PCT = 0                        51800001
518100                   MOVE PAYTRM-DUE-DAY-QTY           TO           51810001
518200                              ASC-PO-DISCOUNT-DAYS-QTY            51820001
518300                ELSE                                              51830001
518400                   MOVE PAYTRM-DISCOUNT-DAYS-QTY TO               51840001
518500                              ASC-PO-DISCOUNT-DAYS-QTY            51850001
518600                END-IF                                            51860001
518700                                                                  51870001
518800                MOVE PAYTRM-DUE-DAY-FR-DTE-TXT       TO           51880001
518900                              ASC-PO-DUE-DAY-FR-DTE-TXT           51890001
519000                MOVE POAGMT-DISC-PCT  TO ASC-POAGMT-DISC-PCT      51900001
519100                MOVE POAGMT-DISC-PAY-DAY-QTY    TO                51910001
519200                              ASC-PO-DISC-PAY-DAY-QTY             51920001
519300                IF ASC-NEW-INVC-ID > SPACES                       51930001
519400                    PERFORM 4195-CHECK-VEND-INVC-COMBO            51940001
519500                END-IF                                            51950001
519600                                                                  51960001
519700                MOVE ASC-NEW-RMIT-VND-ID TO                       51970001
519800                     INVOIC-RMIT-VND-ID                           51980001
519900                INITIALIZE DCLTEXTENT                             51990001
520000                           DCLTBUSLOC                             52000001
520100                PERFORM 4110-GET-ENT-NAME                         52010001
520200                PERFORM 4120-GET-BUSLOC-DATA                      52020001
520300                IF ENTNME-ENT-NAME-DESC > SPACES                  52030001
520400                    MOVE ENTNME-ENT-NAME-DESC           TO        52040001
520500                         ASC-ENT-NAME-DESC                        52050001
520600                    MOVE BUSLOC-ADDRESS-LINE1-DESC      TO        52060001
520700                         ASC-ADDRESS-LINE1-DESC                   52070001
520800                    MOVE BUSLOC-ADDRESS-LINE2-DESC      TO        52080001
520900                         ASC-ADDRESS-LINE2-DESC                   52090001
521000                    MOVE BUSLOC-CITY-NAME               TO        52100001
521100                         ASC-CITY-NAME                            52110001
521200                    MOVE BUSLOC-STATE-CDE               TO        52120001
521300                         ASC-STATE-CDE                            52130001
521400                    MOVE BUSLOC-ZIP-CDE                 TO        52140001
521500                         ASC-ZIP-CDE                              52150001
521600                    MOVE ASC-NEW-RMIT-VND-ID            TO        52160001
521700                         ASC-PREV-DUN-NBR                         52170001
521800                ELSE                                              52180001
521900                    INITIALIZE ASC-ENT-DATA                       52190001
522000                    SET DP020-MSG-FATAL       TO TRUE             52200001
522100*               ------ VENDOR NOT FOUND                           52210001
522200                    MOVE DP015-UNP-ALP-BRT-OFF                    52220001
522300                                      TO ADUNNBRA                 52230001
522400                    MOVE DP015-RED    TO ADUNNBRC                 52240001
522500                    MOVE DP015-REVERSE TO ADUNNBRH                52250001
522600                    MOVE -1           TO ADUNNBRL                 52260001
522700                    IF PS-NO-ERROR                                52270001
522800                    MOVE PC-TSYMSG-00608      TO DP020-MSG-NUMBER 52280001
522900                    END-IF                                        52290001
523000                    SET PS-ERROR      TO TRUE                     52300001
523100                END-IF                                            52310001
523200             END-IF                                               52320001
523300         END-IF                                                   52330001
523400     END-IF.                                                      52340001
523500                                                                  52350001
523600     IF PS-NO-ERROR                                               52360001
523700         IF PS-TPURCHS-FOUND                                      52370001
523800             MOVE ASC-KEY-PO-NBR      TO ASC-PREV-PO-NBR          52380001
523900         END-IF                                                   52390001
524000         IF ASC-KEY-INVC-ID > SPACES                              52400001
524100             MOVE ASC-KEY-INVC-ID     TO ASC-PREV-INVC-ID         52410001
524200         END-IF                                                   52420001
524300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     52430001
524400     ELSE                                                         52440001
524500         SET DP020-NEXT-ACT-APPL-ERROR                            52450001
524600                                      TO TRUE                     52460001
524700     END-IF.                                                      52470001
524800                                                                  52480001
524900*--------------------------------------------------------------*  52490001
525000* VALIDATE THE KEY CICS SCREEN FIELDS                          *  52500001
525100*--------------------------------------------------------------*  52510001
525200 4005-VALIDATE-KEY-FIELDS.                                        52520001
525300                                                                  52530001
525400     PERFORM 4010-VALIDATE-INVC-PO-COMBO.                         52540001
525500* ADDED THIS IF, FOR UPDATES WHEN NO TYP CDE IS REQUESTED.        52550001
525600     IF ASC-KEY-INVC-TYP-CDE = '  '                               52560001
525700         MOVE INVOIC-INVC-TYP-CDE TO ASC-KEY-INVC-TYP-CDE         52570001
525800         IF ASC-EXPENSE-INVC                                      52580001
525900             MOVE PC-EXPENSE-STR-NBR TO ASC-ALP-STR-NBR           52590001
526000                                        ASC-NEW-STR-NBR           52600001
526100             MOVE PC-DC-NBR          TO ASC-NEW-DC-NBR            52610001
526200             MOVE 'S'                TO ASC-NEW-IN-SEL            52620001
526300             MOVE 'NET'              TO ASC-ALP-DISC-PCT          52630001
526400             IF ASC-NEW-RMIT-VND-ID = PV-IMPORT-VENDOR            52640001
526500                MOVE 05             TO ASC-ALP-DISC-DUE-DAY-QTY   52650001
526600                                       ASC-NEW-IN-DISC-DUE-DAY-QTY52660001
526700             ELSE                                                 52670001
526800                MOVE 10          TO ASC-ALP-DISC-DUE-DAY-QTY      52680001
526900                                    ASC-NEW-IN-DISC-DUE-DAY-QTY   52690001
527000             END-IF                                               52700001
527100                                                                  52710001
527200             MOVE 'N'             TO ASC-NEW-IN-EOM               52720001
527300             MOVE ZERO            TO ASC-ALP-EXTD-DAYS-QTY        52730001
527400                                     ASC-NEW-IN-EXTD-DAYS-QTY     52740001
527500             MOVE 'N'             TO ASC-NEW-IN-SPLIT-TERMS-IND   52750001
527600         END-IF                                                   52760001
527700     END-IF.                                                      52770001
527800                                                                  52780001
527900     IF NOT ASC-VALID-INVC-TYP                                    52790001
528000         SET DP020-MSG-FATAL     TO TRUE                          52800001
528100         MOVE DP015-UNP-ALP-BRT-OFF                               52810001
528200                                 TO AINVNBRA                      52820001
528300         MOVE DP015-RED          TO AINVNBRC                      52830001
528400         MOVE DP015-REVERSE      TO AINVNBRH                      52840001
528500         MOVE -1                 TO AINVNBRL                      52850001
528600         IF PS-NO-ERROR                                           52860001
528700* -- TYPE CODE DOES NOT EXIST --                                  52870001
528800             MOVE PC-TSYMSG-00527 TO DP020-MSG-NUMBER             52880001
528900         END-IF                                                   52890001
529000         SET PS-ERROR            TO TRUE                          52900001
529100     END-IF                                                       52910001
529200                                                                  52920001
529300     IF ASC-INVOICE-NOT-FOUND OR                                  52930001
529400        ASC-MULTIPLE-INVOICES                                     52940001
529500         IF ASC-MULTIPLE-INVOICES                                 52950001
529600             IF DK-PO-NBR-LOW = +0                                52960001
529700*                -- PO NBR REQUIRED TO BREAK THE TIE --           52970001
529800                 MOVE PC-TSYMSG-00852 TO DP020-MSG-NUMBER         52980001
529900                 MOVE DP015-UNP-ALP-BRT-OFF                       52990001
530000                                     TO APONUMA                   53000001
530100                 MOVE DP015-RED      TO APONUMC                   53010001
530200                 MOVE DP015-REVERSE  TO APONUMH                   53020001
530300                 MOVE -1             TO APONUML                   53030001
530400                 MOVE +0             TO INVOIC-PO-NBR             53040001
530500                                        ASC-OLD-PO-NBR            53050001
530600                                        ASC-KEY-PO-NBR            53060001
530700                 PERFORM 4020-GET-REST-OF-DATA                    53070001
530800             ELSE                                                 53080001
530900*                -- SEVERE DATA CORRUPTION - CONTACT DP --        53090001
531000                 MOVE PC-TSYMSG-00858 TO DP020-MSG-NUMBER         53100001
531100                 IF DP020-NEXT-ACT-INITIAL                        53110001
531200                     SET DP020-NEXT-ACT-APPL-ERROR                53120001
531300                                     TO TRUE                      53130001
531400                 END-IF                                           53140001
531500             END-IF                                               53150001
531600         ELSE                                                     53160001
531700             MOVE PC-TSYMSG-01564    TO DP020-MSG-NUMBER          53170001
531800             IF DP020-NEXT-ACT-INITIAL                            53180001
531900                 SET DP020-NEXT-ACT-APPL-ERROR                    53190001
532000                                     TO TRUE                      53200001
532100             END-IF                                               53210001
532200         END-IF                                                   53220001
532300         SET PS-ERROR                                             53230001
532400             DP020-MSG-FATAL         TO TRUE                      53240001
532500     ELSE                                                         53250001
532600         PERFORM 4020-GET-REST-OF-DATA                            53260001
532700     END-IF.                                                      53270001
532800                                                                  53280001
532900*--------------------------------------------------------------*  53290001
533000* VALIDATE THE INVOICE/PO COMBINATION                          *  53300001
533100*--------------------------------------------------------------*  53310001
533200 4010-VALIDATE-INVC-PO-COMBO.                                     53320001
533300                                                                  53330001
533400     SET ASC-NET-AMT-NOT-ZERO        TO TRUE.                     53340001
533500     PERFORM                                                      53350001
533600         WITH TEST AFTER                                          53360001
533700         VARYING PV-RETRY-COUNTER                                 53370001
533800         FROM 1 BY 1                                              53380001
533900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               53390001
534000            OR (SQLCODE = +0)                                     53400001
534100            OR (SQLCODE = +100)                                   53410001
534200            OR (SQLCODE = -811))                                  53420001
534300                                                                  53430001
534400**       ***   THE "VALUE" FUNCTION REPLACES NULL VALUES WITH     53440001
534500**       ***   WHATEVER VALUE IS SPECIFIED.  IN THIS CASE,        53450001
534600**       ***   ALL NULL PO_NBR'S  WILL BE TREATED AS IF THEIR     53460001
534700**       ***   PO_NBR'S WERE ZERO, AND WOULD NOT BE RETURNED      53470001
534800**       ***   IF AN ACTUAL ASC-KEY-PO-NBR WAS SPECIFIED, BUT     53480001
534900**       ***   WOULD BE RETURNED IF NO ASC-KEY-PO-NBR WAS         53490001
535000**       ***   SUPPLIED.                                          53500001
535100                                                                  53510001
535200         EXEC SQL                                                 53520001
535300           SELECT  PAYT_REQ_SEQ_NBR                               53530001
535400                  ,INVC_ID                                        53540001
535500                  ,STR_NBR                                        53550001
535600                  ,INVC_TYP_CDE                                   53560001
535700                  ,STATUS_CDE                                     53570001
535800                  ,INVC_DTE                                       53580001
535900                  ,HOLD_IND                                       53590001
536000                  ,ENTR_MTHD_CDE                                  53600001
536100                  ,PAYT_RLSE_TMST                                 53610001
536200                  ,PAYT_DTE                                       53620001
536300                  ,GRO_COST_AMT                                   53630001
536400                  ,BAR_CDE                                        53640001
536500                  ,SPLIT_TERMS_IND                                53650001
536600                  ,INVC_CART_CT                                   53660001
536700                  ,INVC_NET_COST_AMT                              53670001
536800                  ,RMIT_VND_ID                                    53680001
536900                  ,CRE_BY_USR_ID                                  53690001
537000                  ,CRE_DTE                                        53700001
537100                  ,VALUE(PO_NBR,+0)                               53710001
537200                  ,DC_NBR                                         53720001
537300                  ,MTCH_LVL_CDE                                   53730001
537400                  ,DUE_DTE_SRC_CDE                                53740001
537500                  ,CALC_DUE_DTE                                   53750001
537600            INTO   :INVOIC-PAYT-REQ-SEQ-NBR                       53760001
537700                  ,:INVOIC-INVC-ID                                53770001
537800                  ,:INVOIC-STR-NBR                                53780001
537900                  ,:INVOIC-INVC-TYP-CDE                           53790001
538000                  ,:INVOIC-STATUS-CDE                             53800001
538100                  ,:INVOIC-INVC-DTE                               53810001
538200                  ,:INVOIC-HOLD-IND                               53820001
538300                  ,:INVOIC-ENTR-MTHD-CDE                          53830001
538400                  ,:INVOIC-PAYT-RLSE-TMST                         53840001
538500                  ,:INVOIC-PAYT-DTE                               53850001
538600                  ,:INVOIC-GRO-COST-AMT                           53860001
538700                  ,:INVOIC-BAR-CDE                                53870001
538800                  ,:INVOIC-SPLIT-TERMS-IND                        53880001
538900                  ,:INVOIC-INVC-CART-CT                           53890001
539000                  ,:INVOIC-INVC-NET-COST-AMT                      53900001
539100                  ,:INVOIC-RMIT-VND-ID                            53910001
539200                  ,:INVOIC-CRE-BY-USR-ID                          53920001
539300                  ,:INVOIC-CRE-DTE                                53930001
539400                  ,:INVOIC-PO-NBR                                 53940001
539500                  ,:INVOIC-DC-NBR                                 53950001
539600                  ,:INVOIC-MTCH-LVL-CDE                           53960001
539700                  ,:INVOIC-DUE-DTE-SRC-CDE                        53970001
539800                  ,:INVOIC-CALC-DUE-DTE                           53980001
539900             FROM   TINVOIC                                       53990001
540000            WHERE   INVC_ID                = :DK-INVC-ID          54000001
540100              AND   INVC_TYP_CDE    BETWEEN :DK-INVC-TYP-CDE1     54010001
540200                                        AND :DK-INVC-TYP-CDE2     54020001
540300              AND   PO_NBR      IS NOT NULL                       54030001
540400              AND   PO_NBR      BETWEEN :DK-PO-NBR-LOW            54040001
540500                                    AND :DK-PO-NBR-HIGH           54050001
540600         END-EXEC                                                 54060001
540700                                                                  54070001
540800         EVALUATE TRUE                                            54080001
540900             WHEN SQLCODE = +0                                    54090001
541000                 SET ASC-INVOICE-FOUND         TO TRUE            54100001
541100             WHEN SQLCODE = -904                                  54110001
541200             WHEN SQLCODE = -913                                  54120001
541300                 CONTINUE                                         54130001
541400             WHEN SQLCODE = -811                                  54140001
541500                                                                  54150001
541600                 SET ASC-MULTIPLE-INVOICES     TO TRUE            54160001
541700                                                                  54170001
541800             WHEN SQLCODE = +100                                  54180001
541900                                                                  54190001
542000                 SET ASC-INVOICE-NOT-FOUND     TO TRUE            54200001
542100                                                                  54210001
542200             WHEN SQLWARN0 NOT = SPACES                           54220001
542300             WHEN SQLCODE < ZERO                                  54230001
542400             WHEN SQLCODE > ZERO                                  54240001
542500                 MOVE '4010-SELECT-TINVOIC'                       54250001
542600                                   TO DP013-PARAGRAPH             54260001
542700                 MOVE 'SELECT ON TINVOIC'                         54270001
542800                                   TO DP013-MESSAGE-TEXT (1)      54280001
542900                 MOVE SQLCA        TO DP013-SQLCA                 54290001
543000                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    54300001
543100                 MOVE SPACES       TO DP013-DB2-TABLE-NAME (2)    54310001
543200                 SET DP013-DB2-ABEND                              54320001
543300                     DP013-XCTL-DISPLAY-RESTART                   54330001
543400                                   TO TRUE                        54340001
543500                 PERFORM DP013-0000-PROCESS-ABEND                 54350001
543600         END-EVALUATE                                             54360001
543700     END-PERFORM.                                                 54370001
543800                                                                  54380001
543900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        54390001
544000         MOVE '4010-SELECT-TINVOIC'                               54400001
544100                                   TO DP013-PARAGRAPH             54410001
544200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     54420001
544300                                   TO DP013-MESSAGE-TEXT (1)      54430001
544400         MOVE SQLCA                TO DP013-SQLCA                 54440001
544500         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    54450001
544600         MOVE SPACES               TO DP013-DB2-TABLE-NAME (2)    54460001
544700         SET DP013-DB2-ABEND                                      54470001
544800             DP013-XCTL-DISPLAY-RESTART                           54480001
544900                                   TO TRUE                        54490001
545000         PERFORM DP013-0000-PROCESS-ABEND                         54500001
545100     END-IF.                                                      54510001
545200                                                                  54520001
545300*--------------------------------------------------------------*  54530001
545400* GENERATE ERROR AND WARNING MESSAGES ON CICS SCREENS          *  54540001
545500*--------------------------------------------------------------*  54550001
545600 4020-GET-REST-OF-DATA.                                           54560001
545700                                                                  54570001
545800     PERFORM 4100-GET-REMAINING-DATA.                             54580001
545900                                                                  54590001
546000     IF PS-NO-ERROR                                               54600001
546100         PERFORM 4200-MOVE-DATABASE-TO-COMMAREA                   54610001
546200         IF ASC-UPDATE-REQUESTED                                  54620001
546300             EVALUATE TRUE                                        54630001
546400*WR5091 NO UPDATE IF TERMS DO NOT EXIST                           54640001
546500                WHEN ASC-ENTR-MTHD-CDE        = 'ED'              54650001
546600*                   IF ASC-TINVCTM-EXISTS AND                     54660001
546700*                     (ASC-KEY-INVC-STATUS = 'EN' OR 'OB' OR      54670001
546800*                                            'IB' OR 'RC')        54680001
546900*                      CONTINUE                                   54690001
547000*                   ELSE                                          54700001
547100                    IF (ASC-KEY-INVC-STATUS = 'EN' OR 'OB' OR     54710001
547200                                              'IB' OR 'RC')       54720001
547300                       CONTINUE                                   54730001
547400                    ELSE                                          54740001
547500                       SET ASC-NO-CHANGES-ALLOWED TO TRUE         54750001
547600                       SET DP020-MSG-FATAL        TO TRUE         54760001
547700                       SET PS-ERROR               TO TRUE         54770001
547800                       MOVE PC-TSYMSG-00851 TO DP020-MSG-NUMBER   54780001
547900                    END-IF                                        54790001
548000*                   END-IF                                        54800001
548100                WHEN ASC-KEY-INVC-TYP-CDE     = 'RI'              54810001
548200                    SET ASC-NO-CHANGES-ALLOWED TO TRUE            54820001
548300                    SET DP020-MSG-FATAL        TO TRUE            54830001
548400                    SET PS-ERROR               TO TRUE            54840001
548500                    MOVE PC-TSYMSG-00970      TO DP020-MSG-NUMBER 54850001
548600                WHEN ASC-KEY-INVC-TYP-CDE     = 'WO'              54860001
548700                    SET ASC-NO-CHANGES-ALLOWED TO TRUE            54870001
548800                    SET DP020-MSG-FATAL        TO TRUE            54880001
548900                    SET PS-ERROR               TO TRUE            54890001
549000                    MOVE PC-TSYMSG-01517      TO DP020-MSG-NUMBER 54900001
549100                WHEN  ASC-KEY-INVC-STATUS     = 'EN'              54910001
549200                WHEN  ASC-KEY-INVC-STATUS     = 'PR'              54920001
549300                WHEN  ASC-KEY-INVC-STATUS     = 'OB'              54930001
549400                WHEN  ASC-KEY-INVC-STATUS     = 'IB'              54940001
549500                WHEN  ASC-KEY-INVC-STATUS     = 'RC'              54950001
549600                    CONTINUE                                      54960001
549700                WHEN  OTHER                                       54970001
549800                    SET ASC-NO-CHANGES-ALLOWED TO TRUE            54980001
549900                    SET DP020-MSG-FATAL        TO TRUE            54990001
550000                    SET PS-ERROR               TO TRUE            55000001
550100                    MOVE PC-TSYMSG-00170     TO DP020-MSG-NUMBER  55010001
550200             END-EVALUATE                                         55020001
550300         ELSE                                                     55030001
550400             IF ASC-DELETE-REQUESTED                              55040001
550500                EVALUATE TRUE                                     55050001
550600                  WHEN                                            55060001
550700                    ASC-KEY-INVC-TYP-CDE       = 'RI'  AND        55070001
550800                    ASC-KEY-INVC-STATUS        = 'EN'  AND        55080001
550900                    INVOIC-CRE-DTE             = ASC-CURRENT-DATE 55090001
551000                    SET ASC-NO-CHANGES-ALLOWED TO TRUE            55100001
551100                    SET DP020-MSG-FATAL        TO TRUE            55110001
551200                    SET PS-ERROR               TO TRUE            55120001
551300                    MOVE PC-TSYMSG-01073      TO DP020-MSG-NUMBER 55130001
551400                  WHEN                                            55140001
551500                    ASC-KEY-INVC-TYP-CDE       = 'WO'             55150001
551600                    SET ASC-NO-CHANGES-ALLOWED TO TRUE            55160001
551700                    SET DP020-MSG-FATAL        TO TRUE            55170001
551800                    SET PS-ERROR               TO TRUE            55180001
551900                    MOVE PC-TSYMSG-01518      TO DP020-MSG-NUMBER 55190001
552000                  WHEN                                            55200001
552100                    ASC-KEY-INVC-STATUS = 'EN' OR 'ER' OR         55210001
552200                                          'OB' OR 'IB' OR 'RC'    55220001
552300                    SET ASC-DELETE-PENDING     TO TRUE            55230001
552400                  WHEN OTHER                                      55240001
552500                    SET ASC-NO-CHANGES-ALLOWED TO TRUE            55250001
552600                    SET DP020-MSG-FATAL        TO TRUE            55260001
552700                    SET PS-ERROR               TO TRUE            55270001
552800                    MOVE PC-TSYMSG-00170    TO DP020-MSG-NUMBER   55280001
552900                 END-EVALUATE                                     55290001
553000             END-IF                                               55300001
553100         END-IF                                                   55310001
553200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     55320001
553300     ELSE                                                         55330001
553400         SET DP020-MSG-FATAL                                      55340001
553500             DP020-NEXT-ACT-APPL-ERROR                            55350001
553600                               TO TRUE                            55360001
553700     END-IF.                                                      55370001
553800                                                                  55380001
553900*--------------------------------------------------------------*  55390001
554000* OBTAIN THE REMAINING DATA RELATING TO THE INVOICE/PO         *  55400001
554100*--------------------------------------------------------------*  55410001
554200 4100-GET-REMAINING-DATA.                                         55420001
554300                                                                  55430001
554400     IF INVOIC-RMIT-VND-ID      > SPACES                          55440001
554500         PERFORM 4110-GET-ENT-NAME                                55450001
554600         PERFORM 4120-GET-BUSLOC-DATA                             55460001
554700     END-IF                                                       55470001
554800                                                                  55480001
554900     IF INVOIC-PO-NBR > +0                                        55490001
555000         PERFORM 4130-GET-TPURCHS-DATA                            55500001
555100         MOVE PURCHS-PO-TYP-CDE       TO ASC-PO-TYP-CDE           55510001
555200         MOVE PURCHS-DIR-STR-IND      TO ASC-DIR-STR-IND          55520001
555300* MUST BE AN IMPORT PO TO HAVE AN EXPENSE INVOICE ENTERED         55530001
555400         IF ASC-EXPENSE-INVC                                      55540001
555500           AND NOT ASC-IMPORT-PO                                  55550001
555600             SET DP020-MSG-FATAL          TO TRUE                 55560001
555700             MOVE DP015-UNP-ALP-BRT-OFF                           55570001
555800                                          TO APONUMA              55580001
555900             MOVE DP015-RED               TO APONUMC              55590001
556000                                             AINVTYPC             55600001
556100             MOVE DP015-REVERSE           TO APONUMH              55610001
556200                                             AINVTYPH             55620001
556300             MOVE -1                      TO APONUML              55630001
556400             IF PS-NO-ERROR                                       55640001
556500* INVALID PURCHASE ORDER TYPE CODE FOR THIS FUNCTION * MSG        55650001
556600                 MOVE PC-TSYMSG-00587                             55660001
556700                                          TO DP020-MSG-NUMBER     55670001
556800             END-IF                                               55680001
556900             SET PS-ERROR                 TO TRUE                 55690001
557000*        ELSE                                                     55700001
557100*WR28461                                                          55710001
557200*          IF ASC-CNSMR-DIR-PO                                    55720001
557300*             MOVE PC-TSYMSG-03390  TO DP020-MSG-NUMBER           55730001
557400*             SET DP020-MSG-FATAL   TO TRUE                       55740001
557500*             MOVE DP015-UNP-ALP-BRT-OFF                          55750001
557600*                                   TO APONUMA                    55760001
557700*             MOVE DP015-RED        TO APONUMC                    55770001
557800*             MOVE DP015-REVERSE    TO APONUMH                    55780001
557900*             MOVE -1               TO APONUML                    55790001
558000*             SET PS-ERROR          TO TRUE                       55800001
558100*          END-IF                                                 55810001
558200         END-IF                                                   55820001
558300     END-IF                                                       55830001
558400                                                                  55840001
558500     IF INVOIC-PO-NBR > +0                                        55850001
558600       AND PS-NO-ERROR                                            55860001
558700         PERFORM 4108-GET-PO-DUN-NBR                              55870001
558800         IF SQLCODE = +0                                          55880001
558900            MOVE PURCHS-PO-TYP-CDE    TO ASC-PO-TYP-CDE           55890001
559000            PERFORM 4140-GET-TPAYTRM-DATA                         55900001
559100         ELSE                                                     55910001
559200             SET DP020-MSG-FATAL   TO TRUE                        55920001
559300             MOVE DP015-UNP-ALP-BRT-OFF                           55930001
559400                                  TO APONUMA                      55940001
559500             MOVE DP015-RED       TO APONUMC                      55950001
559600             MOVE DP015-REVERSE   TO APONUMH                      55960001
559700**           -- PO_NBR NOT FOUND ON TPURCHS --                    55970001
559800             MOVE -1               TO APONUML                     55980001
559900             IF PS-NO-ERROR                                       55990001
560000                 MOVE PC-TSYMSG-00726                             56000001
560100                                   TO DP020-MSG-NUMBER            56010001
560200             END-IF                                               56020001
560300             SET PS-ERROR          TO TRUE                        56030001
560400         END-IF                                                   56040001
560500     END-IF                                                       56050001
560600                                                                  56060001
560700     IF ASC-EXPENSE-INVC                                          56070001
560800         PERFORM 4155-GET-TEXINVC-DATA                            56080001
560900     ELSE                                                         56090001
561000         PERFORM 4150-GET-TMDINVC-DATA                            56100001
561100     END-IF                                                       56110001
561200                                                                  56120001
561300     PERFORM 4160-GET-TINVCTM-DATA                                56130001
561400                                                                  56140001
561500     PERFORM 4170-GET-TALCHRG-DATA                                56150001
561600     PERFORM 4175-ACCUM-ALLOWANCES                                56160001
561700                                                                  56170001
561800     IF INVOIC-PO-NBR > +0                                        56180001
561900         PERFORM 4195-CHECK-VEND-INVC-COMBO                       56190001
562000     END-IF.                                                      56200001
562100                                                                  56210001
562200     MOVE INVOIC-PAYT-REQ-SEQ-NBR TO PREQIT-PAYT-REQ-SEQ-NBR.     56220001
562300     PERFORM 4190-CALC-PREQIT-TOT-COST.                           56230001
562400                                                                  56240001
562500*----------------------------------------------------------------*56250001
562600* DETERMINES THE COUNT OF THE NUMBER OF JOURNALIZED MERCHANDISE  *56260001
562700* INVOICES FOR IMPORT PURCHASE ORDERS.                           *56270001
562800*----------------------------------------------------------------*56280001
562900 4101-CHECK-JOURNALIZED-STATUS.                                   56290001
563000                                                                  56300001
563100     INITIALIZE PV-INVC-COUNT.                                    56310001
563200                                                                  56320001
563300     IF ASC-IMPORT-PO                                             56330001
563400                                                                  56340001
563500        IF ASC-NEW-PO-NBR NOT = ASC-PREV-PO-NBR                   56350001
563600            SET ASC-CONF-NOT-OBT TO TRUE                          56360001
563700        ELSE                                                      56370001
563800           IF ASC-CONF-REQ                                        56380001
563900               SET ASC-CONF-OBT TO TRUE                           56390001
564000           END-IF                                                 56400001
564100        END-IF                                                    56410001
564200                                                                  56420001
564300        IF ASC-CONF-NOT-OBT                                       56430001
564400           PERFORM                                                56440001
564500               WITH TEST AFTER                                    56450001
564600               VARYING PV-RETRY-COUNTER                           56460001
564700               FROM 1 BY 1                                        56470001
564800               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)         56480001
564900                   OR (SQLCODE = +0))                             56490001
565000                                                                  56500001
565100               EXEC SQL                                           56510001
565200                    SELECT COUNT(*)                               56520001
565300                     INTO :PV-INVC-COUNT                          56530001
565400                     FROM TINVOIC B                               56540001
565500                    WHERE B.PO_NBR    = :ASC-NEW-PO-NBR           56550001
565600                      AND B.STATUS_CDE IN ('OP', 'PD')            56560001
565700                      AND B.INVC_TYP_CDE IN ('MI')                56570001
565800               END-EXEC                                           56580001
565900                                                                  56590001
566000               EVALUATE TRUE                                      56600001
566100                   WHEN SQLCODE = +0                              56610001
566200                   WHEN SQLCODE = -305                            56620001
566300                   WHEN SQLCODE = -904                            56630001
566400                   WHEN SQLCODE = -913                            56640001
566500                        CONTINUE                                  56650001
566600                                                                  56660001
566700                   WHEN SQLWARN0 NOT = SPACES                     56670001
566800                   WHEN SQLCODE NOT = ZERO                        56680001
566900                        MOVE '4101-CHECK-JOURNALIZED-STATUS'      56690001
567000                                        TO DP013-PARAGRAPH        56700001
567100                        MOVE 'UNSUCCESSFUL SELECT COUNT'          56710001
567200                                        TO DP013-MESSAGE-TEXT (1) 56720001
567300                        MOVE SQLCA   TO DP013-SQLCA               56730001
567400                      MOVE 'TINVOIC ' TO DP013-DB2-TABLE-NAME (1) 56740001
567500                      MOVE SPACES     TO DP013-DB2-TABLE-NAME (2) 56750001
567600                        SET DP013-DB2-ABEND                       56760001
567700                            DP013-XCTL-DISPLAY-RESTART            56770001
567800                                     TO TRUE                      56780001
567900                        PERFORM DP013-0000-PROCESS-ABEND          56790001
568000               END-EVALUATE                                       56800001
568100           END-PERFORM                                            56810001
568200                                                                  56820001
568300           IF PV-RETRY-COUNTER > PC-MAX-RETRIES                   56830001
568400               MOVE '4101-CHECK-JOURNALIZED-STATUS'               56840001
568500                                        TO DP013-PARAGRAPH        56850001
568600               MOVE 'MAX RETRIES EXCEEDED FOR SELECT COUNT'       56860001
568700                                        TO DP013-MESSAGE-TEXT (1) 56870001
568800               MOVE SQLCA            TO DP013-SQLCA               56880001
568900               MOVE 'TINVOIC '       TO DP013-DB2-TABLE-NAME (1)  56890001
569000               MOVE SPACES           TO DP013-DB2-TABLE-NAME (2)  56900001
569100               SET DP013-DB2-ABEND                                56910001
569200                   DP013-XCTL-DISPLAY-RESTART                     56920001
569300                                        TO TRUE                   56930001
569400               PERFORM DP013-0000-PROCESS-ABEND                   56940001
569500           END-IF                                                 56950001
569600                                                                  56960001
569700           IF SQLCODE = ZERO AND PV-INVC-COUNT > ZERO             56970001
569800              SET DP020-MSG-WARNING TO TRUE                       56980001
569900              MOVE PC-TSYMSG-01700 TO DP020-MSG-NUMBER            56990001
570000              SET ASC-CONF-REQ TO TRUE                            57000001
570100           ELSE                                                   57010001
570200              IF PV-INVC-COUNT = ZERO                             57020001
570300                  SET ASC-ADD-PENDING TO TRUE                     57030001
570400              END-IF                                              57040001
570500           END-IF                                                 57050001
570600        END-IF                                                    57060001
570700     ELSE                                                         57070001
570800        SET ASC-ADD-PENDING TO TRUE                               57080001
570900     END-IF.                                                      57090001
571000                                                                  57100001
571100*--------------------------------------------------------------*  57110001
571200* SELECT FREIGHT PCTS                                          *  57120001
571300*--------------------------------------------------------------*  57130001
571400 4104-GET-PLNSHP.                                                 57140001
571500                                                                  57150001
571600     INITIALIZE DCLTPLNSHP                                        57160001
571700                                                                  57170001
571800     PERFORM                                                      57180001
571900         WITH TEST AFTER                                          57190001
572000         VARYING PV-RETRY-COUNTER                                 57200001
572100         FROM 1 BY 1                                              57210001
572200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               57220001
572300                   OR (SQLCODE = ZERO)                            57230001
572400                   OR (SQLCODE = +100))                           57240001
572500                                                                  57250001
572600         EXEC SQL                                                 57260001
572700             SELECT FRGT_PAYT_CDE,                                57270001
572800                    VEND_FRGT_PCT,                                57280001
572900                    KOHLS_FRGT_PCT,                               57290001
573000                    CAN_IFNOT_SHIP_DTE                            57300001
573100             INTO   :PLNSHP-FRGT-PAYT-CDE,                        57310001
573200                    :PLNSHP-VEND-FRGT-PCT,                        57320001
573300                    :PLNSHP-KOHLS-FRGT-PCT,                       57330001
573400                    :PLNSHP-CAN-IFNOT-SHIP-DTE                    57340001
573500             FROM   TPLNSHP                                       57350001
573600             WHERE  PO_NBR = :ASC-NEW-PO-NBR                      57360001
573700               AND  VER_STATUS_CDE = 'A'                          57370001
573800         END-EXEC                                                 57380001
573900                                                                  57390001
574000         EVALUATE TRUE                                            57400001
574100             WHEN SQLCODE = ZERO                                  57410001
574200                 IF (ASC-ALP-VEND-FRGT-PCT <= SPACES AND          57420001
574300                     ASC-ALP-KOHLS-FRGT-PCT <= SPACES)            57430001
574400                 OR (ASC-ALP-VEND-FRGT-PCT-NUM = ZEROS AND        57440001
574500                     ASC-ALP-KOHLS-FRGT-PCT-NUM = ZEROS)          57450001
574600                     IF PLNSHP-FRGT-PAYT-CDE = 'V' OR ' '         57460001
574700                         MOVE 100    TO ASC-ALP-VEND-FRGT-PCT-NUM 57470001
574800                                        ASC-NEW-VEND-FRGT-PCT-NUM 57480001
574900                         MOVE 0      TO ASC-ALP-KOHLS-FRGT-PCT-NUM57490001
575000                                        ASC-NEW-KOHLS-FRGT-PCT-NUM57500001
575100                     END-IF                                       57510001
575200                     IF PLNSHP-FRGT-PAYT-CDE = 'K'                57520001
575300                         MOVE 100    TO ASC-ALP-KOHLS-FRGT-PCT-NUM57530001
575400                                        ASC-NEW-KOHLS-FRGT-PCT-NUM57540001
575500                         MOVE 0      TO ASC-ALP-VEND-FRGT-PCT-NUM 57550001
575600                                        ASC-NEW-VEND-FRGT-PCT-NUM 57560001
575700                     END-IF                                       57570001
575800                     IF PLNSHP-FRGT-PAYT-CDE = 'B'                57580001
575900                         COMPUTE ASC-ALP-KOHLS-FRGT-PCT-NUM =     57590001
576000                                 PLNSHP-KOHLS-FRGT-PCT * 100      57600001
576100                         MOVE ASC-ALP-KOHLS-FRGT-PCT-NUM          57610001
576200                                    TO ASC-NEW-KOHLS-FRGT-PCT-NUM 57620001
576300                         COMPUTE ASC-ALP-VEND-FRGT-PCT-NUM =      57630001
576400                                 PLNSHP-VEND-FRGT-PCT * 100       57640001
576500                         MOVE ASC-ALP-VEND-FRGT-PCT-NUM           57650001
576600                                    TO ASC-NEW-VEND-FRGT-PCT-NUM  57660001
576700                     END-IF                                       57670001
576800                 END-IF                                           57680001
576900             WHEN SQLCODE = +100                                  57690001
577000                     MOVE 0      TO ASC-ALP-VEND-FRGT-PCT-NUM     57700001
577100                                    ASC-NEW-VEND-FRGT-PCT-NUM     57710001
577200                     MOVE 0      TO ASC-ALP-KOHLS-FRGT-PCT-NUM    57720001
577300                                    ASC-NEW-KOHLS-FRGT-PCT-NUM    57730001
577400             WHEN SQLCODE = -904                                  57740001
577500             WHEN SQLCODE = -913                                  57750001
577600                 CONTINUE                                         57760001
577700             WHEN SQLWARN0 NOT = SPACES                           57770001
577800             WHEN SQLCODE < ZERO                                  57780001
577900             WHEN SQLCODE > ZERO                                  57790001
578000                 MOVE '4104-GET-PLNSHP'                           57800001
578100                                   TO DP013-PARAGRAPH             57810001
578200                 MOVE 'SELECT FRGT PCT        '                   57820001
578300                                   TO DP013-MESSAGE-TEXT (1)      57830001
578400                 MOVE SQLCA        TO DP013-SQLCA                 57840001
578500                 MOVE 'TPLNSHP'    TO DP013-DB2-TABLE-NAME (1)    57850001
578600                 SET DP013-DB2-ABEND                              57860001
578700                     DP013-XCTL-DISPLAY-RESTART                   57870001
578800                                   TO TRUE                        57880001
578900                 PERFORM DP013-0000-PROCESS-ABEND                 57890001
579000         END-EVALUATE                                             57900001
579100     END-PERFORM.                                                 57910001
579200                                                                  57920001
579300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        57930001
579400         MOVE '4104-GET-PLNSHP       '                            57940001
579500                                   TO DP013-PARAGRAPH             57950001
579600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     57960001
579700                                   TO DP013-MESSAGE-TEXT (1)      57970001
579800         MOVE 'FRGT PCTS    '      TO DP013-MESSAGE-TEXT (2)      57980001
579900         MOVE SQLCA                TO DP013-SQLCA                 57990001
580000         MOVE 'TPLNSHP'            TO DP013-DB2-TABLE-NAME (1)    58000001
580100         SET DP013-DB2-ABEND                                      58010001
580200             DP013-XCTL-DISPLAY-RESTART                           58020001
580300                                   TO TRUE                        58030001
580400         PERFORM DP013-0000-PROCESS-ABEND                         58040001
580500     END-IF.                                                      58050001
580600                                                                  58060001
580700*--------------------------------------------------------------*  58070001
580800* SELECT INSTRUCTIONS                                          *  58080001
580900*--------------------------------------------------------------*  58090001
581000 4105-GET-INST.                                                   58100001
581100                                                                  58110001
581200     PERFORM                                                      58120001
581300         WITH TEST AFTER                                          58130001
581400         VARYING PV-RETRY-COUNTER                                 58140001
581500         FROM 1 BY 1                                              58150001
581600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               58160001
581700                   OR (SQLCODE = ZERO)                            58170001
581800                   OR (SQLCODE = +100))                           58180001
581900                                                                  58190001
582000         EXEC SQL                                                 58200001
582100             SELECT B.INSTR_DESC                                  58210001
582200             INTO   :INSTCD-INSTR-DESC                            58220001
582300             FROM   TPOINST A,                                    58230001
582400                    TINSTCD B                                     58240001
582500             WHERE  A.PO_NBR = :ASC-NEW-PO-NBR                    58250001
582600               AND  A.RECIP_CDE = 'AP'                            58260001
582700               AND  B.INSTR_NBR = A.INSTR_NBR                     58270001
582800               AND  A.INSTR_NBR =                                 58280001
582900                    (SELECT MAX(INSTR_NBR)                        58290001
583000                     FROM   TPOINST                               58300001
583100                     WHERE  PO_NBR = :ASC-NEW-PO-NBR              58310001
583200                       AND  RECIP_CDE = 'AP')                     58320001
583300         END-EXEC                                                 58330001
583400                                                                  58340001
583500         EVALUATE TRUE                                            58350001
583600             WHEN SQLCODE = ZERO                                  58360001
583700                 MOVE INSTCD-INSTR-DESC                           58370001
583800                                     TO ASC-SPEC-INST             58380001
583900             WHEN SQLCODE = +100                                  58390001
584000                 MOVE SPACES         TO ASC-SPEC-INST             58400001
584100             WHEN SQLCODE = -904                                  58410001
584200             WHEN SQLCODE = -913                                  58420001
584300                 CONTINUE                                         58430001
584400             WHEN SQLWARN0 NOT = SPACES                           58440001
584500             WHEN SQLCODE < ZERO                                  58450001
584600             WHEN SQLCODE > ZERO                                  58460001
584700                 MOVE '4105-GET-INST  '                           58470001
584800                                   TO DP013-PARAGRAPH             58480001
584900                 MOVE 'SELECT SPEC INST'                          58490001
585000                                   TO DP013-MESSAGE-TEXT (1)      58500001
585100                 MOVE SQLCA        TO DP013-SQLCA                 58510001
585200                 MOVE 'TPOINST'    TO DP013-DB2-TABLE-NAME (1)    58520001
585300                 SET DP013-DB2-ABEND                              58530001
585400                     DP013-XCTL-DISPLAY-RESTART                   58540001
585500                                   TO TRUE                        58550001
585600                 PERFORM DP013-0000-PROCESS-ABEND                 58560001
585700         END-EVALUATE                                             58570001
585800     END-PERFORM.                                                 58580001
585900                                                                  58590001
586000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        58600001
586100         MOVE '4105-GET-INST         '                            58610001
586200                                   TO DP013-PARAGRAPH             58620001
586300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     58630001
586400                                   TO DP013-MESSAGE-TEXT (1)      58640001
586500         MOVE 'SPEC INST    '      TO DP013-MESSAGE-TEXT (2)      58650001
586600         MOVE SQLCA                TO DP013-SQLCA                 58660001
586700         MOVE 'TPOINST'            TO DP013-DB2-TABLE-NAME (1)    58670001
586800         SET DP013-DB2-ABEND                                      58680001
586900             DP013-XCTL-DISPLAY-RESTART                           58690001
587000                                   TO TRUE                        58700001
587100         PERFORM DP013-0000-PROCESS-ABEND                         58710001
587200     END-IF.                                                      58720001
587300                                                                  58730001
587400                                                                  58740001
587500*--------------------------------------------------------------*  58750001
587600* GET THE ENTITY'S NAME                                        *  58760001
587700*--------------------------------------------------------------*  58770001
587800 4107-GET-ENT-DATA-USING-ENT-ID.                                  58780001
587900                                                                  58790001
588000     PERFORM                                                      58800001
588100         WITH TEST AFTER                                          58810001
588200         VARYING PV-RETRY-COUNTER                                 58820001
588300         FROM 1 BY 1                                              58830001
588400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               58840001
588500            OR (SQLCODE = +0)                                     58850001
588600            OR (SQLCODE = +100))                                  58860001
588700                                                                  58870001
588800         EXEC SQL                                                 58880001
588900           SELECT     A.ENT_ID                                    58890001
589000                     ,DUN_NBR                                     58900001
589100                     ,ENT_NAME_DESC                               58910001
589200             INTO    :EXTENT-ENT-ID                               58920001
589300                    ,:EXTENT-DUN-NBR                              58930001
589400                    ,:ENTNME-ENT-NAME-DESC                        58940001
589500             FROM    TEXTENT A                                    58950001
589600                    ,TENTNME B                                    58960001
589700            WHERE    A.ENT_ID   = :PURCHS-ENT-ID                  58970001
589800              AND    A.ENT_ID   = B.ENT_ID                        58980001
589900              AND    B.TYPE_CDE = '01'                            58990001
590000         END-EXEC                                                 59000001
590100                                                                  59010001
590200         EVALUATE TRUE                                            59020001
590300             WHEN SQLCODE = +0                                    59030001
590400             WHEN SQLCODE = -904                                  59040001
590500             WHEN SQLCODE = -913                                  59050001
590600             WHEN SQLCODE = +100                                  59060001
590700                 CONTINUE                                         59070001
590800             WHEN SQLWARN0 NOT = SPACES                           59080001
590900             WHEN SQLCODE < ZERO                                  59090001
591000             WHEN SQLCODE > ZERO                                  59100001
591100                 MOVE '4107-GET-ENT-DATA'                         59110001
591200                                   TO DP013-PARAGRAPH             59120001
591300                 MOVE 'SELECT ON TENTNME'                         59130001
591400                                   TO DP013-MESSAGE-TEXT (1)      59140001
591500                 MOVE SQLCA        TO DP013-SQLCA                 59150001
591600                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    59160001
591700                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (2)    59170001
591800                 SET DP013-DB2-ABEND                              59180001
591900                     DP013-XCTL-DISPLAY-RESTART                   59190001
592000                                   TO TRUE                        59200001
592100                 PERFORM DP013-0000-PROCESS-ABEND                 59210001
592200         END-EVALUATE                                             59220001
592300     END-PERFORM.                                                 59230001
592400                                                                  59240001
592500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        59250001
592600         MOVE '4107-GET-ENT-DATA'                                 59260001
592700                                   TO DP013-PARAGRAPH             59270001
592800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     59280001
592900                                   TO DP013-MESSAGE-TEXT (1)      59290001
593000         MOVE SQLCA                TO DP013-SQLCA                 59300001
593100         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    59310001
593200         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (2)    59320001
593300         SET DP013-DB2-ABEND                                      59330001
593400             DP013-XCTL-DISPLAY-RESTART                           59340001
593500                                   TO TRUE                        59350001
593600         PERFORM DP013-0000-PROCESS-ABEND                         59360001
593700     END-IF.                                                      59370001
593800                                                                  59380001
593900*--------------------------------------------------------------*  59390001
594000* GET THE PO NUMBER                                            *  59400001
594100*--------------------------------------------------------------*  59410001
594200 4108-GET-PO-DUN-NBR.                                             59420001
594300                                                                  59430001
594400     PERFORM                                                      59440001
594500         WITH TEST AFTER                                          59450001
594600         VARYING PV-RETRY-COUNTER                                 59460001
594700         FROM 1 BY 1                                              59470001
594800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               59480001
594900            OR (SQLCODE = +0)                                     59490001
595000            OR (SQLCODE = +100))                                  59500001
595100                                                                  59510001
595200         EXEC SQL                                                 59520001
595300           SELECT     DUN_NBR                                     59530001
595400             INTO    :PV-PO-DUN-NBR                               59540001
595500             FROM    TEXTENT A                                    59550001
595600            WHERE    A.ENT_ID   = :PURCHS-ENT-ID                  59560001
595700         END-EXEC                                                 59570001
595800                                                                  59580001
595900         EVALUATE TRUE                                            59590001
596000             WHEN SQLCODE = +0                                    59600001
596100             WHEN SQLCODE = -904                                  59610001
596200             WHEN SQLCODE = -913                                  59620001
596300             WHEN SQLCODE = +100                                  59630001
596400                 CONTINUE                                         59640001
596500             WHEN SQLWARN0 NOT = SPACES                           59650001
596600             WHEN SQLCODE < ZERO                                  59660001
596700             WHEN SQLCODE > ZERO                                  59670001
596800                 MOVE '4108-GET-PO-DUN-NBR'                       59680001
596900                                   TO DP013-PARAGRAPH             59690001
597000                 MOVE 'SELECT ON TENTNME'                         59700001
597100                                   TO DP013-MESSAGE-TEXT (1)      59710001
597200                 MOVE SQLCA        TO DP013-SQLCA                 59720001
597300                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    59730001
597400                 SET DP013-DB2-ABEND                              59740001
597500                     DP013-XCTL-DISPLAY-RESTART                   59750001
597600                                   TO TRUE                        59760001
597700                 PERFORM DP013-0000-PROCESS-ABEND                 59770001
597800         END-EVALUATE                                             59780001
597900     END-PERFORM.                                                 59790001
598000                                                                  59800001
598100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        59810001
598200         MOVE '4108-GET-PO-DUN-NBR'                               59820001
598300                                   TO DP013-PARAGRAPH             59830001
598400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     59840001
598500                                   TO DP013-MESSAGE-TEXT (1)      59850001
598600         MOVE SQLCA                TO DP013-SQLCA                 59860001
598700         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    59870001
598800         SET DP013-DB2-ABEND                                      59880001
598900             DP013-XCTL-DISPLAY-RESTART                           59890001
599000                                   TO TRUE                        59900001
599100         PERFORM DP013-0000-PROCESS-ABEND                         59910001
599200     END-IF.                                                      59920001
599300                                                                  59930001
599400*--------------------------------------------------------------*  59940001
599500* DETERMINE THE ENTITY'S NAME                                  *  59950001
599600*--------------------------------------------------------------*  59960001
599700 4110-GET-ENT-NAME.                                               59970001
599800                                                                  59980001
599900     PERFORM                                                      59990001
600000         WITH TEST AFTER                                          60000001
600100         VARYING PV-RETRY-COUNTER                                 60010001
600200         FROM 1 BY 1                                              60020001
600300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               60030001
600400            OR (SQLCODE = +0)                                     60040001
600500            OR (SQLCODE = +100))                                  60050001
600600                                                                  60060001
600700         EXEC SQL                                                 60070001
600800           SELECT     A.ENT_ID                                    60080001
600900                     ,ENT_NAME_DESC                               60090001
601000             INTO    :EXTENT-ENT-ID                               60100001
601100                    ,:ENTNME-ENT-NAME-DESC                        60110001
601200             FROM    TEXTENT A                                    60120001
601300                    ,TENTNME B                                    60130001
601400            WHERE    DUN_NBR    = :INVOIC-RMIT-VND-ID             60140001
601500              AND    A.ENT_ID   = B.ENT_ID                        60150001
601600              AND    B.TYPE_CDE = '01'                            60160001
601700         END-EXEC                                                 60170001
601800                                                                  60180001
601900         EVALUATE TRUE                                            60190001
602000             WHEN SQLCODE = +0                                    60200001
602100             WHEN SQLCODE = -904                                  60210001
602200             WHEN SQLCODE = -913                                  60220001
602300             WHEN SQLCODE = +100                                  60230001
602400                 CONTINUE                                         60240001
602500             WHEN SQLWARN0 NOT = SPACES                           60250001
602600             WHEN SQLCODE < ZERO                                  60260001
602700             WHEN SQLCODE > ZERO                                  60270001
602800                 MOVE '4110-GET-ENT-NAME'                         60280001
602900                                   TO DP013-PARAGRAPH             60290001
603000                 MOVE 'SELECT ON TENTNME'                         60300001
603100                                   TO DP013-MESSAGE-TEXT (1)      60310001
603200                 MOVE SQLCA        TO DP013-SQLCA                 60320001
603300                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    60330001
603400                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (2)    60340001
603500                 SET DP013-DB2-ABEND                              60350001
603600                     DP013-XCTL-DISPLAY-RESTART                   60360001
603700                                   TO TRUE                        60370001
603800                 PERFORM DP013-0000-PROCESS-ABEND                 60380001
603900         END-EVALUATE                                             60390001
604000     END-PERFORM.                                                 60400001
604100                                                                  60410001
604200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        60420001
604300         MOVE '4110-GET-ENT-NAME'                                 60430001
604400                                   TO DP013-PARAGRAPH             60440001
604500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     60450001
604600                                   TO DP013-MESSAGE-TEXT (1)      60460001
604700         MOVE SQLCA                TO DP013-SQLCA                 60470001
604800         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    60480001
604900         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (2)    60490001
605000         SET DP013-DB2-ABEND                                      60500001
605100             DP013-XCTL-DISPLAY-RESTART                           60510001
605200                                   TO TRUE                        60520001
605300         PERFORM DP013-0000-PROCESS-ABEND                         60530001
605400     END-IF.                                                      60540001
605500                                                                  60550001
605600*--------------------------------------------------------------*  60560001
605700* GET BUSINESS LOCATION DATA RELATING TO ADDRESSES             *  60570001
605800*--------------------------------------------------------------*  60580001
605900 4120-GET-BUSLOC-DATA.                                            60590001
606000                                                                  60600001
606100     PERFORM                                                      60610001
606200         WITH TEST AFTER                                          60620001
606300         VARYING PV-RETRY-COUNTER                                 60630001
606400         FROM 1 BY 1                                              60640001
606500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               60650001
606600            OR (SQLCODE = +0)                                     60660001
606700            OR (SQLCODE = +100))                                  60670001
606800                                                                  60680001
606900         EXEC SQL                                                 60690001
607000           SELECT     ADDRESS_LINE1_DESC                          60700001
607100                     ,ADDRESS_LINE2_DESC                          60710001
607200                     ,CITY_NAME                                   60720001
607300                     ,STATE_CDE                                   60730001
607400                     ,ZIP_CDE                                     60740001
607500             INTO    :BUSLOC-ADDRESS-LINE1-DESC                   60750001
607600                    ,:BUSLOC-ADDRESS-LINE2-DESC                   60760001
607700                    ,:BUSLOC-CITY-NAME                            60770001
607800                    ,:BUSLOC-STATE-CDE                            60780001
607900                    ,:BUSLOC-ZIP-CDE                              60790001
608000             FROM    TBUSLOC                                      60800001
608100            WHERE    ENT_ID       = :EXTENT-ENT-ID                60810001
608200              AND    FUNCTION_ID  = +9                            60820001
608300              AND    SEQ_NBR =                                    60830001
608400                (SELECT MIN(SEQ_NBR)                              60840001
608500                   FROM TBUSLOC                                   60850001
608600                  WHERE ENT_ID       = :EXTENT-ENT-ID             60860001
608700                    AND FUNCTION_ID  = +9)                        60870001
608800         END-EXEC                                                 60880001
608900                                                                  60890001
609000         EVALUATE TRUE                                            60900001
609100             WHEN SQLCODE = +0                                    60910001
609200             WHEN SQLCODE = -904                                  60920001
609300             WHEN SQLCODE = -913                                  60930001
609400             WHEN SQLCODE = +100                                  60940001
609500                 CONTINUE                                         60950001
609600                                                                  60960001
609700             WHEN SQLWARN0 NOT = SPACES                           60970001
609800             WHEN SQLCODE < ZERO                                  60980001
609900             WHEN SQLCODE > ZERO                                  60990001
610000                 MOVE '4120-GET-BUSLOC-DATA'                      61000001
610100                                   TO DP013-PARAGRAPH             61010001
610200                 MOVE 'SELECT ON BUSLOC'                          61020001
610300                                   TO DP013-MESSAGE-TEXT (1)      61030001
610400                 MOVE SQLCA        TO DP013-SQLCA                 61040001
610500                 MOVE 'TBUSLOC'    TO DP013-DB2-TABLE-NAME (1)    61050001
610600                 SET DP013-DB2-ABEND                              61060001
610700                     DP013-XCTL-DISPLAY-RESTART                   61070001
610800                                   TO TRUE                        61080001
610900                 PERFORM DP013-0000-PROCESS-ABEND                 61090001
611000         END-EVALUATE                                             61100001
611100     END-PERFORM.                                                 61110001
611200                                                                  61120001
611300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        61130001
611400         MOVE '4120-GET-BUSLOC-DATA'                              61140001
611500                                   TO DP013-PARAGRAPH             61150001
611600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     61160001
611700                                   TO DP013-MESSAGE-TEXT (1)      61170001
611800         MOVE SQLCA                TO DP013-SQLCA                 61180001
611900         MOVE 'TBUSLOC'            TO DP013-DB2-TABLE-NAME (1)    61190001
612000         SET DP013-DB2-ABEND                                      61200001
612100             DP013-XCTL-DISPLAY-RESTART                           61210001
612200                                   TO TRUE                        61220001
612300         PERFORM DP013-0000-PROCESS-ABEND                         61230001
612400     END-IF.                                                      61240001
612500                                                                  61250001
612600*--------------------------------------------------------------*  61260001
612700* GET PURCHASE ORDER DATA                                      *  61270001
612800*--------------------------------------------------------------*  61280001
612900 4130-GET-TPURCHS-DATA.                                           61290001
613000                                                                  61300001
613100     PERFORM                                                      61310001
613200         WITH TEST AFTER                                          61320001
613300         VARYING PV-RETRY-COUNTER                                 61330001
613400         FROM 1 BY 1                                              61340001
613500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               61350001
613600            OR (SQLCODE = +0)                                     61360001
613700            OR (SQLCODE = +100))                                  61370001
613800                                                                  61380001
613900         EXEC SQL                                                 61390001
614000           SELECT    DISTINCT DEPT_NBR                            61400001
614100                     ,NEW_STR_PO_IND                              61410001
614200                     ,ENT_ID                                      61420001
614300                     ,PO_TYP_CDE                                  61430001
614400                     ,DIR_STR_IND                                 61440001
614500             INTO    :PURCHS-DEPT-NBR                             61450001
614600                    ,:PURCHS-NEW-STR-PO-IND                       61460001
614700                    ,:PURCHS-ENT-ID                               61470001
614800                    ,:PURCHS-PO-TYP-CDE                           61480001
614900                    ,:PURCHS-DIR-STR-IND                          61490001
615000             FROM    TPURCHS                                      61500001
615100            WHERE    PO_NBR         = :INVOIC-PO-NBR              61510001
615200              AND    PO_CATEG_CDE   = 'MR'                        61520001
615300              AND    VER_STATUS_CDE = 'A'                         61530001
615400         END-EXEC                                                 61540001
615500                                                                  61550001
615600         EVALUATE TRUE                                            61560001
615700             WHEN SQLCODE = +0                                    61570001
615800                 SET PS-TPURCHS-FOUND      TO TRUE                61580001
615900             WHEN SQLCODE = +100                                  61590001
616000                 SET PS-TPURCHS-NOT-FOUND  TO TRUE                61600001
616100             WHEN SQLCODE = -904                                  61610001
616200             WHEN SQLCODE = -913                                  61620001
616300                 CONTINUE                                         61630001
616400                                                                  61640001
616500             WHEN SQLWARN0 NOT = SPACES                           61650001
616600             WHEN SQLCODE < ZERO                                  61660001
616700             WHEN SQLCODE > ZERO                                  61670001
616800                 MOVE '4130-GET-TPURCHS-DATA'                     61680001
616900                                   TO DP013-PARAGRAPH             61690001
617000                 MOVE 'SELECT ON TPURCHS'                         61700001
617100                                   TO DP013-MESSAGE-TEXT (1)      61710001
617200                 MOVE SQLCA        TO DP013-SQLCA                 61720001
617300                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    61730001
617400                 SET DP013-DB2-ABEND                              61740001
617500                     DP013-XCTL-DISPLAY-RESTART                   61750001
617600                                   TO TRUE                        61760001
617700                 PERFORM DP013-0000-PROCESS-ABEND                 61770001
617800         END-EVALUATE                                             61780001
617900     END-PERFORM.                                                 61790001
618000                                                                  61800001
618100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        61810001
618200         MOVE '4130-GET-TPURCHS-DATA'                             61820001
618300                                   TO DP013-PARAGRAPH             61830001
618400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     61840001
618500                                   TO DP013-MESSAGE-TEXT (1)      61850001
618600         MOVE SQLCA                TO DP013-SQLCA                 61860001
618700         MOVE 'TPURCHS'            TO DP013-DB2-TABLE-NAME (1)    61870001
618800         SET DP013-DB2-ABEND                                      61880001
618900             DP013-XCTL-DISPLAY-RESTART                           61890001
619000                                   TO TRUE                        61900001
619100         PERFORM DP013-0000-PROCESS-ABEND                         61910001
619200     END-IF.                                                      61920001
619300                                                                  61930001
619400*--------------------------------------------------------------*  61940001
619500* GET PAYMENT TERMS DATA                                       *  61950001
619600*--------------------------------------------------------------*  61960001
619700 4140-GET-TPAYTRM-DATA.                                           61970001
619800                                                                  61980001
619900     INITIALIZE DCLTPAYTRM                                        61990001
620000                DCLTPOAGMT                                        62000001
620100                                                                  62010001
620200     PERFORM                                                      62020001
620300         WITH TEST AFTER                                          62030001
620400         VARYING PV-RETRY-COUNTER                                 62040001
620500         FROM 1 BY 1                                              62050001
620600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               62060001
620700            OR (SQLCODE = +0)                                     62070001
620800            OR (SQLCODE = +100))                                  62080001
620900                                                                  62090001
621000         EXEC SQL                                                 62100001
621100           SELECT    A.DISCOUNT_PCT                               62110001
621200                    ,A.DISCOUNT_DAYS_QTY                          62120001
621300                    ,A.DUE_DAY_FR_DTE_TXT                         62130001
621400                    ,A.DUE_DAY_QTY                                62140001
621500                    ,B.DISC_PAY_DAY_QTY                           62150001
621600                    ,B.DISC_PCT                                   62160001
621700             INTO    :PAYTRM-DISCOUNT-PCT                         62170001
621800                    ,:PAYTRM-DISCOUNT-DAYS-QTY                    62180001
621900                    ,:PAYTRM-DUE-DAY-FR-DTE-TXT                   62190001
622000                    ,:PAYTRM-DUE-DAY-QTY                          62200001
622100                    ,:POAGMT-DISC-PAY-DAY-QTY                     62210001
622200                    ,:POAGMT-DISC-PCT                             62220001
622300             FROM    TPAYTRM A                                    62230001
622400                    ,TPOAGMT B                                    62240001
622500            WHERE    B.PO_NBR         = :INVOIC-PO-NBR            62250001
622600              AND    B.AGRMT_TYP_ID   = '2'                       62260001
622700              AND    B.VER_STATUS_CDE = 'A'                       62270001
622800              AND    A.PAY_TERM_ID    = B.PAYT_TERM_ID            62280001
622900         END-EXEC                                                 62290001
623000                                                                  62300001
623100         EVALUATE TRUE                                            62310001
623200             WHEN SQLCODE = +0                                    62320001
623300             WHEN SQLCODE = +100                                  62330001
623400             WHEN SQLCODE = -904                                  62340001
623500             WHEN SQLCODE = -913                                  62350001
623600                 CONTINUE                                         62360001
623700                                                                  62370001
623800             WHEN SQLWARN0 NOT = SPACES                           62380001
623900             WHEN SQLCODE < ZERO                                  62390001
624000             WHEN SQLCODE > ZERO                                  62400001
624100                 MOVE '4140-GET-TPAYTRM-DATA'                     62410001
624200                                   TO DP013-PARAGRAPH             62420001
624300                 MOVE 'SELECT ON TPAYTRM'                         62430001
624400                                   TO DP013-MESSAGE-TEXT (1)      62440001
624500                 MOVE SQLCA        TO DP013-SQLCA                 62450001
624600                 MOVE 'TPAYTRM'    TO DP013-DB2-TABLE-NAME (1)    62460001
624700                 MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (2)    62470001
624800                 SET DP013-DB2-ABEND                              62480001
624900                     DP013-XCTL-DISPLAY-RESTART                   62490001
625000                                   TO TRUE                        62500001
625100                 PERFORM DP013-0000-PROCESS-ABEND                 62510001
625200         END-EVALUATE                                             62520001
625300     END-PERFORM.                                                 62530001
625400                                                                  62540001
625500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        62550001
625600         MOVE '4140-GET-TPAYTRM-DATA'                             62560001
625700                                   TO DP013-PARAGRAPH             62570001
625800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     62580001
625900                                   TO DP013-MESSAGE-TEXT (1)      62590001
626000         MOVE SQLCA                TO DP013-SQLCA                 62600001
626100         MOVE 'TPAYTRM'            TO DP013-DB2-TABLE-NAME (1)    62610001
626200         MOVE 'TPOAGMT'            TO DP013-DB2-TABLE-NAME (2)    62620001
626300         SET DP013-DB2-ABEND                                      62630001
626400             DP013-XCTL-DISPLAY-RESTART                           62640001
626500                                   TO TRUE                        62650001
626600         PERFORM DP013-0000-PROCESS-ABEND                         62660001
626700     END-IF.                                                      62670001
626800                                                                  62680001
626900     PERFORM 4141-GET-ADDL-TPOAGMT-DATA.                          62690001
627000                                                                  62700001
627100*--------------------------------------------------------------*  62710001
627200* GET PURCHASE ORDER AGREEMENT DATA                            *  62720001
627300*--------------------------------------------------------------*  62730001
627400 4141-GET-ADDL-TPOAGMT-DATA.                                      62740001
627500                                                                  62750001
627600     MOVE ZERO TO PV-DISC-PAY-DAY-QTY                             62760001
627700                  PV-DISC-PCT.                                    62770001
627800                                                                  62780001
627900     PERFORM                                                      62790001
628000         WITH TEST AFTER                                          62800001
628100         VARYING PV-RETRY-COUNTER                                 62810001
628200         FROM 1 BY 1                                              62820001
628300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               62830001
628400            OR (SQLCODE = +0)                                     62840001
628500            OR (SQLCODE = +100))                                  62850001
628600                                                                  62860001
628700         EXEC SQL                                                 62870001
628800           SELECT    B.DISC_PAY_DAY_QTY                           62880001
628900                    ,B.DISC_PCT                                   62890001
629000             INTO    :PV-DISC-PAY-DAY-QTY                         62900001
629100                    ,:PV-DISC-PCT                                 62910001
629200             FROM    TPOAGMT B                                    62920001
629300            WHERE    B.PO_NBR         = :INVOIC-PO-NBR            62930001
629400              AND    B.VER_STATUS_CDE = 'A'                       62940001
629500              AND    B.AGRMT_TYP_ID   = '5'                       62950001
629600              AND    B.TYP_CDE        =  1                        62960001
629700              AND    B.DISC_PCT       >  0                        62970001
629800         END-EXEC                                                 62980001
629900                                                                  62990001
630000         EVALUATE TRUE                                            63000001
630100             WHEN SQLCODE = +0                                    63010001
630200                ADD PV-DISC-PAY-DAY-QTY TO POAGMT-DISC-PAY-DAY-QTY63020001
630300                ADD PV-DISC-PCT         TO POAGMT-DISC-PCT        63030001
630400                                                                  63040001
630500             WHEN SQLCODE = +100                                  63050001
630600             WHEN SQLCODE = -904                                  63060001
630700             WHEN SQLCODE = -913                                  63070001
630800                 CONTINUE                                         63080001
630900                                                                  63090001
631000             WHEN SQLWARN0 NOT = SPACES                           63100001
631100             WHEN SQLCODE < ZERO                                  63110001
631200             WHEN SQLCODE > ZERO                                  63120001
631300                 MOVE '4141-GET-ADDL-TPOAGMT-DATA'                63130001
631400                                   TO DP013-PARAGRAPH             63140001
631500                 MOVE 'SELECT ON TPOAGMT'                         63150001
631600                                   TO DP013-MESSAGE-TEXT (1)      63160001
631700                 MOVE SQLCA        TO DP013-SQLCA                 63170001
631800                 MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (1)    63180001
631900                 MOVE SPACE        TO DP013-DB2-TABLE-NAME (2)    63190001
632000                 SET DP013-DB2-ABEND                              63200001
632100                     DP013-XCTL-DISPLAY-RESTART                   63210001
632200                                   TO TRUE                        63220001
632300                 PERFORM DP013-0000-PROCESS-ABEND                 63230001
632400         END-EVALUATE                                             63240001
632500     END-PERFORM.                                                 63250001
632600                                                                  63260001
632700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        63270001
632800         MOVE '4141-GET-ADDL-TPOAGMT-DATA'                        63280001
632900                                   TO DP013-PARAGRAPH             63290001
633000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     63300001
633100                                   TO DP013-MESSAGE-TEXT (1)      63310001
633200         MOVE SQLCA                TO DP013-SQLCA                 63320001
633300         MOVE 'TPOAGMT'            TO DP013-DB2-TABLE-NAME (1)    63330001
633400         MOVE SPACE                TO DP013-DB2-TABLE-NAME (2)    63340001
633500         SET DP013-DB2-ABEND                                      63350001
633600             DP013-XCTL-DISPLAY-RESTART                           63360001
633700                                   TO TRUE                        63370001
633800         PERFORM DP013-0000-PROCESS-ABEND                         63380001
633900     END-IF.                                                      63390001
634000                                                                  63400001
634100*--------------------------------------------------------------*  63410001
634200* GET MERCHANDISE INVOICE DATA                                 *  63420001
634300*--------------------------------------------------------------*  63430001
634400 4150-GET-TMDINVC-DATA.                                           63440001
634500                                                                  63450001
634600     PERFORM                                                      63460001
634700         WITH TEST AFTER                                          63470001
634800         VARYING PV-RETRY-COUNTER                                 63480001
634900         FROM 1 BY 1                                              63490001
635000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               63500001
635100            OR (SQLCODE = +0)                                     63510001
635200            OR (SQLCODE = +100))                                  63520001
635300                                                                  63530001
635400         EXEC SQL                                                 63540001
635500           SELECT    TOT_INVC_PC_QTY                              63550001
635600                    ,TERM_SEL_CDE                                 63560001
635700                    ,KOHLS_FRGT_PCT                               63570001
635800                    ,VEND_FRGT_PCT                                63580001
635900                    ,BOL_ID                                       63590001
636000                    ,IMPRT_CHRG_PRC_CDE                           63600001
636100             INTO    :MDINVC-TOT-INVC-PC-QTY                      63610001
636200                    ,:MDINVC-TERM-SEL-CDE                         63620001
636300                    ,:MDINVC-KOHLS-FRGT-PCT                       63630001
636400                    ,:MDINVC-VEND-FRGT-PCT                        63640001
636500                    ,:MDINVC-BOL-ID                               63650001
636600                    ,:MDINVC-IMPRT-CHRG-PRC-CDE                   63660001
636700             FROM    TMDINVC                                      63670001
636800**KPC       WHERE    PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR  63680001
636900            WHERE    PO_NBR   = :INVOIC-PO-NBR                    63690001
637000              AND    INVC_ID  = :INVOIC-INVC-ID                   63700001
637100         END-EXEC                                                 63710001
637200                                                                  63720001
637300         EVALUATE TRUE                                            63730001
637400             WHEN SQLCODE = +0                                    63740001
637500             WHEN SQLCODE = +100                                  63750001
637600             WHEN SQLCODE = -904                                  63760001
637700             WHEN SQLCODE = -913                                  63770001
637800                 CONTINUE                                         63780001
637900                                                                  63790001
638000             WHEN SQLWARN0 NOT = SPACES                           63800001
638100             WHEN SQLCODE < ZERO                                  63810001
638200             WHEN SQLCODE > ZERO                                  63820001
638300                 MOVE '4150-GET-TMDINVC-DATA'                     63830001
638400                                   TO DP013-PARAGRAPH             63840001
638500                 MOVE 'SELECT ON TMDINVC'                         63850001
638600                                   TO DP013-MESSAGE-TEXT (1)      63860001
638700                 MOVE SQLCA        TO DP013-SQLCA                 63870001
638800                 MOVE 'TMDINVC'    TO DP013-DB2-TABLE-NAME (1)    63880001
638900                 SET DP013-DB2-ABEND                              63890001
639000                     DP013-XCTL-DISPLAY-RESTART                   63900001
639100                                   TO TRUE                        63910001
639200                 PERFORM DP013-0000-PROCESS-ABEND                 63920001
639300         END-EVALUATE                                             63930001
639400     END-PERFORM.                                                 63940001
639500                                                                  63950001
639600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        63960001
639700         MOVE '4150-GET-TMDINVC-DATA'                             63970001
639800                                   TO DP013-PARAGRAPH             63980001
639900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     63990001
640000                                   TO DP013-MESSAGE-TEXT (1)      64000001
640100         MOVE SQLCA                TO DP013-SQLCA                 64010001
640200         MOVE 'TMDINVC'            TO DP013-DB2-TABLE-NAME (1)    64020001
640300         SET DP013-DB2-ABEND                                      64030001
640400             DP013-XCTL-DISPLAY-RESTART                           64040001
640500                                   TO TRUE                        64050001
640600         PERFORM DP013-0000-PROCESS-ABEND                         64060001
640700     END-IF.                                                      64070001
640800                                                                  64080001
640900*--------------------------------------------------------------*  64090001
641000* GET EXPENSE INVOICE DATA                                     *  64100001
641100*--------------------------------------------------------------*  64110001
641200 4155-GET-TEXINVC-DATA.                                           64120001
641300                                                                  64130001
641400     PERFORM                                                      64140001
641500         WITH TEST AFTER                                          64150001
641600         VARYING PV-RETRY-COUNTER                                 64160001
641700         FROM 1 BY 1                                              64170001
641800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               64180001
641900            OR (SQLCODE = +0)                                     64190001
642000            OR (SQLCODE = +100))                                  64200001
642100                                                                  64210001
642200         EXEC SQL                                                 64220001
642300           SELECT    IMPRT_ENTR_NBR,                              64230001
642400                     IMPRT_BOL_ID,                                64240001
642500                     INVC_CONTNR_ID,                              64250001
642600                     IMPRT_BKR_REF_NBR                            64260001
642700             INTO    :EXINVC-IMPRT-ENTR-NBR,                      64270001
642800                     :EXINVC-IMPRT-BOL-ID,                        64280001
642900                     :EXINVC-INVC-CONTNR-ID,                      64290001
643000                     :EXINVC-IMPRT-BKR-REF-NBR                    64300001
643100             FROM    TEXINVC                                      64310001
643200**KPC       WHERE    PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR  64320001
643300            WHERE    PO_NBR  = :INVOIC-PO-NBR                     64330001
643400              AND    INVC_ID = :INVOIC-INVC-ID                    64340001
643500         END-EXEC                                                 64350001
643600                                                                  64360001
643700         EVALUATE TRUE                                            64370001
643800             WHEN SQLCODE = +0                                    64380001
643900             WHEN SQLCODE = +100                                  64390001
644000             WHEN SQLCODE = -904                                  64400001
644100             WHEN SQLCODE = -913                                  64410001
644200                 CONTINUE                                         64420001
644300                                                                  64430001
644400             WHEN SQLWARN0 NOT = SPACES                           64440001
644500             WHEN SQLCODE < ZERO                                  64450001
644600             WHEN SQLCODE > ZERO                                  64460001
644700                 MOVE '4155-GET-TEXINVC-DATA'                     64470001
644800                                   TO DP013-PARAGRAPH             64480001
644900                 MOVE 'SELECT ON TEXINVC'                         64490001
645000                                   TO DP013-MESSAGE-TEXT (1)      64500001
645100                 MOVE SQLCA        TO DP013-SQLCA                 64510001
645200                 MOVE 'TEXINVC'    TO DP013-DB2-TABLE-NAME (1)    64520001
645300                 SET DP013-DB2-ABEND                              64530001
645400                     DP013-XCTL-DISPLAY-RESTART                   64540001
645500                                   TO TRUE                        64550001
645600                 PERFORM DP013-0000-PROCESS-ABEND                 64560001
645700         END-EVALUATE                                             64570001
645800     END-PERFORM.                                                 64580001
645900                                                                  64590001
646000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        64600001
646100         MOVE '4155-GET-TEXINVC-DATA'                             64610001
646200                                   TO DP013-PARAGRAPH             64620001
646300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     64630001
646400                                   TO DP013-MESSAGE-TEXT (1)      64640001
646500         MOVE SQLCA                TO DP013-SQLCA                 64650001
646600         MOVE 'TEXINVC'            TO DP013-DB2-TABLE-NAME (1)    64660001
646700         SET DP013-DB2-ABEND                                      64670001
646800             DP013-XCTL-DISPLAY-RESTART                           64680001
646900                                   TO TRUE                        64690001
647000         PERFORM DP013-0000-PROCESS-ABEND                         64700001
647100     END-IF.                                                      64710001
647200                                                                  64720001
647300*--------------------------------------------------------------*  64730001
647400* GET INVOICE PAYMENT TERMS DATA                               *  64740001
647500*--------------------------------------------------------------*  64750001
647600 4160-GET-TINVCTM-DATA.                                           64760001
647700                                                                  64770001
647800*WR5091 ADD CHECK FOR ROW EXISTS                                  64780001
647900*WR5091 ADD 'AND TERM_SEQ_NBR = 1 TO WHERE                        64790001
648000     MOVE 'N'  TO ASC-TINVCTM-EXISTS-SW.                          64800001
648100                                                                  64810001
648200     PERFORM                                                      64820001
648300         WITH TEST AFTER                                          64830001
648400         VARYING PV-RETRY-COUNTER                                 64840001
648500         FROM 1 BY 1                                              64850001
648600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               64860001
648700            OR (SQLCODE = +0)                                     64870001
648800            OR (SQLCODE = +100))                                  64880001
648900                                                                  64890001
649000         EXEC SQL                                                 64900001
649100           SELECT  DISC_PCT                                       64910001
649200                  ,DISC_DUE_DAY_QTY                               64920001
649300                  ,NET_DUE_DAY_QTY                                64930001
649400                  ,TERM_TYP_CDE                                   64940001
649500                  ,EXTD_DAYS_QTY                                  64950001
649600             INTO  :INVCTM-DISC-PCT                               64960001
649700                  ,:INVCTM-DISC-DUE-DAY-QTY                       64970001
649800                  ,:INVCTM-NET-DUE-DAY-QTY                        64980001
649900                  ,:INVCTM-TERM-TYP-CDE                           64990001
650000                  ,:INVCTM-EXTD-DAYS-QTY                          65000001
650100             FROM  TINVCTM                                        65010001
650200            WHERE  PO_NBR       = :INVOIC-PO-NBR                  65020001
650300              AND  INVC_ID      = :INVOIC-INVC-ID                 65030001
650400              AND  TERM_SEQ_NBR = 1                               65040001
650500         END-EXEC                                                 65050001
650600                                                                  65060001
650700         EVALUATE TRUE                                            65070001
650800             WHEN SQLCODE = +0                                    65080001
650900                  MOVE 'Y'  TO ASC-TINVCTM-EXISTS-SW              65090001
651000                                                                  65100001
651100             WHEN SQLCODE = +100                                  65110001
651200             WHEN SQLCODE = -904                                  65120001
651300             WHEN SQLCODE = -913                                  65130001
651400                 CONTINUE                                         65140001
651500                                                                  65150001
651600             WHEN SQLWARN0 NOT = SPACES                           65160001
651700             WHEN SQLCODE < ZERO                                  65170001
651800             WHEN SQLCODE > ZERO                                  65180001
651900                 MOVE '4160-GET-TINVCTM-DATA'                     65190001
652000                                   TO DP013-PARAGRAPH             65200001
652100                 MOVE 'SELECT ON TINVCTM'                         65210001
652200                                   TO DP013-MESSAGE-TEXT (1)      65220001
652300                 MOVE SQLCA        TO DP013-SQLCA                 65230001
652400                 MOVE 'TINVCTM'    TO DP013-DB2-TABLE-NAME (1)    65240001
652500                 SET DP013-DB2-ABEND                              65250001
652600                     DP013-XCTL-DISPLAY-RESTART                   65260001
652700                                   TO TRUE                        65270001
652800                 PERFORM DP013-0000-PROCESS-ABEND                 65280001
652900         END-EVALUATE                                             65290001
653000     END-PERFORM.                                                 65300001
653100                                                                  65310001
653200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        65320001
653300         MOVE '4160-GET-TINVCTM-DATA'                             65330001
653400                                   TO DP013-PARAGRAPH             65340001
653500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     65350001
653600                                   TO DP013-MESSAGE-TEXT (1)      65360001
653700         MOVE SQLCA                TO DP013-SQLCA                 65370001
653800         MOVE 'TINVCTM'            TO DP013-DB2-TABLE-NAME (1)    65380001
653900         SET DP013-DB2-ABEND                                      65390001
654000             DP013-XCTL-DISPLAY-RESTART                           65400001
654100                                   TO TRUE                        65410001
654200         PERFORM DP013-0000-PROCESS-ABEND                         65420001
654300     END-IF.                                                      65430001
654400                                                                  65440001
654500*--------------------------------------------------------------*  65450001
654600* GET ALLOWANCE/CHARGE DATA                                    *  65460001
654700*--------------------------------------------------------------*  65470001
654800 4170-GET-TALCHRG-DATA.                                           65480001
654900                                                                  65490001
655000     MOVE 'N'                 TO PS-TALCHRG-EXISTS-SW             65500001
655100     MOVE +1                  TO ALCHRG-AMOUNT-NN                 65510001
655200                                                                  65520001
655300     INITIALIZE PV-SUM-OF-THE-CHARGES                             65530001
655400                PV-DB2-COUNT.                                     65540001
655500                                                                  65550001
655600     MOVE INVOIC-GRO-COST-AMT TO ASC-TALCHRG-COST-WITH-ADJSTMT    65560001
655700                                                                  65570001
655800*---------------------------------------------------------------* 65580001
655900*    NOTES: - SINCE THE DECIMAL FUNCTION DOES NOT ROUND, 0.005  * 65590001
656000*             MUST BE ADDED TO THE RESULT TO ENFORCE ROUNDING   * 65600001
656100*           - TO AVOID OVERFLOW, SETUP AN INTERNAL S9(11)V99    * 65610001
656200*             WORK VALUE (DENOTED BY "13,2")                    * 65620001
656300*           - THE CALL TAKES INTO ACCOUNT THAT CHARGES MAY BE   * 65630001
656400*             EXPRESSED AS A PERCENT OR AN ACTUAL AMOUNT        * 65640001
656500*             (NOTE THAT FOR A GIVEN CHARGE, PCT/AMT ARE        * 65650001
656600*             MUTUALLY EXCLUSIVE).                              * 65660001
656700*           - WE ALSO NEED TO CHECK IF ANY CHARGES ARE PRESENT, * 65670001
656800*             BUT THEY HAPPEN TO NET OUT TO ZERO TO SET THE     * 65680001
656900*             ALLW/CHARGES FIELD ON THE SCREEN.                 * 65690001
657000*---------------------------------------------------------------* 65700001
657100                                                                  65710001
657200     PERFORM                                                      65720001
657300         WITH TEST AFTER                                          65730001
657400         VARYING PV-RETRY-COUNTER                                 65740001
657500         FROM 1 BY 1                                              65750001
657600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               65760001
657700                   OR (SQLCODE = ZERO)                            65770001
657800                   OR (SQLCODE = +100))                           65780001
657900         EXEC SQL                                                 65790001
658000            SELECT  SUM(DECIMAL                                   65800001
658100                       (((I.GRO_COST_AMT * A.ALW_CHRG_PCT)        65810001
658200                       + 0.005),13,2)                             65820001
658300                       + A.ALW_CHRG_AMT)                          65830001
658400                   ,COUNT(*)                                      65840001
658500              INTO  :PV-SUM-OF-THE-CHARGES                        65850001
658600                                  :ALCHRG-AMOUNT-NN               65860001
658700                   ,:PV-DB2-COUNT                                 65870001
658800              FROM  TINVOIC I                                     65880001
658900                   ,TALCHRG A                                     65890001
659000             WHERE  I.PO_NBR    = :INVOIC-PO-NBR                  65900001
659100               AND  I.INVC_ID   = :INVOIC-INVC-ID                 65910001
659200               AND  I.PO_NBR    = A.PO_NBR                        65920001
659300               AND  I.INVC_ID   = A.INVC_ID                       65930001
659400               AND  A.ALW_CHRG_TYP_CDE = 'C'                      65940001
659500         END-EXEC                                                 65950001
659600                                                                  65960001
659700         EVALUATE TRUE                                            65970001
659800             WHEN SQLCODE = ZERO                                  65980001
659900                 IF PV-DB2-COUNT > 0                              65990001
660000                     MOVE 'Y'    TO PS-TALCHRG-EXISTS-SW          66000001
660100                 END-IF                                           66010001
660200                 IF PV-SUM-OF-THE-CHARGES > +0                    66020001
660300                     ADD PV-SUM-OF-THE-CHARGES                    66030001
660400                                 TO ASC-TALCHRG-COST-WITH-ADJSTMT 66040001
660500                 END-IF                                           66050001
660600                                                                  66060001
660700             WHEN SQLCODE = +100                                  66070001
660800             WHEN SQLCODE = -305                                  66080001
660900                 CONTINUE                                         66090001
661000                                                                  66100001
661100             WHEN SQLCODE = -904                                  66110001
661200             WHEN SQLCODE = -913                                  66120001
661300                 MOVE '4170-GET-TALCHRG-DATA'                     66130001
661400                                 TO DP013-PARAGRAPH               66140001
661500                 MOVE 'SUM CHARGES'                               66150001
661600                                 TO DP013-MESSAGE-TEXT (1)        66160001
661700                 MOVE 'TINVOIC'  TO DP013-DB2-TABLE-NAME (1)      66170001
661800                 MOVE 'TALCHRG'  TO DP013-DB2-TABLE-NAME (2)      66180001
661900                 MOVE SQLCA      TO DP013-SQLCA                   66190001
662000                 SET DP013-LINK-RETURN                            66200001
662100                     DP013-DB2-ABEND                              66210001
662200                     DP013-ROLLBACK TO TRUE                       66220001
662300                 PERFORM DP013-0000-PROCESS-ABEND                 66230001
662400                 MOVE 'TALCHRG'  TO DP020-MSG-TEXT                66240001
662500                 SET DP020-MSG-FATAL TO TRUE                      66250001
662600*                --- CONFLICT FOR DATABASE ---                    66260001
662700                 MOVE PC-TSYMSG-00482                             66270001
662800                                 TO DP020-MSG-NUMBER              66280001
662900                 SET PS-ERROR    TO TRUE                          66290001
663000                                                                  66300001
663100             WHEN OTHER                                           66310001
663200                 MOVE '4170-GET-TALCHRG-DATA'                     66320001
663300                                 TO DP013-PARAGRAPH               66330001
663400                 MOVE 'SUM CHARGES'                               66340001
663500                                 TO DP013-MESSAGE-TEXT (1)        66350001
663600                 MOVE 'TINVOIC'  TO DP013-DB2-TABLE-NAME (1)      66360001
663700                 MOVE 'TALCHRG'  TO DP013-DB2-TABLE-NAME (2)      66370001
663800                 MOVE SQLCA      TO DP013-SQLCA                   66380001
663900                 SET DP013-DB2-ABEND                              66390001
664000                     DP013-XCTL-DISPLAY-RESTART                   66400001
664100                                 TO TRUE                          66410001
664200                 PERFORM DP013-0000-PROCESS-ABEND                 66420001
664300         END-EVALUATE                                             66430001
664400     END-PERFORM.                                                 66440001
664500                                                                  66450001
664600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        66460001
664700         MOVE '4170-GET-TALCHRG-DATA'                             66470001
664800                                 TO DP013-PARAGRAPH               66480001
664900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     66490001
665000                                 TO DP013-MESSAGE-TEXT (1)        66500001
665100         MOVE 'ALLOWANCES   '    TO DP013-MESSAGE-TEXT (2)        66510001
665200         MOVE SQLCA              TO DP013-SQLCA                   66520001
665300         MOVE 'TALCHRG'          TO DP013-DB2-TABLE-NAME (1)      66530001
665400         SET DP013-DB2-ABEND                                      66540001
665500             DP013-XCTL-DISPLAY-RESTART                           66550001
665600                                 TO TRUE                          66560001
665700         PERFORM DP013-0000-PROCESS-ABEND                         66570001
665800     END-IF.                                                      66580001
665900                                                                  66590001
666000*---------------------------------------------------------------* 66600001
666100*    NOTES: - ACCUMULATE ALLOWANCES ENTERED AS AMOUNTS. THESE   * 66610001
666200*             WILL BE SUBTRACTED FROM THE GROSS INVOICE AMOUNT  * 66620001
666300*             TO GET THE TOTAL INVOICE AMOUNT.                  * 66630001
666400*      ***  DON'T ACCUMULATE ALLOWANCES ENTERED AS PERCENTAGES. * 66640001
666500*           - WE ALSO NEED TO SET THE PS-TALCHRG-EXISTS-SW IF   * 66650001
666600*             ANY ALLOWANCWES ARE FOUND.                        * 66660001
666700*             4170 ACCUMULATES ALL NET CHARGES, AND SETS        * 66670001
666800*             PS-TALCHRG-EXISTS-SW IF ANY CHARGES ARE FOUND.    * 66680001
666900*---------------------------------------------------------------* 66690001
667000 4175-ACCUM-ALLOWANCES.                                           66700001
667100                                                                  66710001
667200     INITIALIZE PV-SUM-OF-ALLOWANCES                              66720001
667300                PV-DB2-COUNT.                                     66730001
667400     PERFORM                                                      66740001
667500         WITH TEST AFTER                                          66750001
667600         VARYING PV-RETRY-COUNTER                                 66760001
667700         FROM 1 BY 1                                              66770001
667800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               66780001
667900                   OR (SQLCODE = ZERO)                            66790001
668000                   OR (SQLCODE = +100))                           66800001
668100                                                                  66810001
668200         EXEC SQL                                                 66820001
668300            SELECT  SUM(ALW_CHRG_AMT)                             66830001
668400                   ,COUNT(*)                                      66840001
668500              INTO  :PV-SUM-OF-ALLOWANCES                         66850001
668600                             :ALCHRG-AMOUNT-NN                    66860001
668700                   ,:PV-DB2-COUNT                                 66870001
668800              FROM  TALCHRG                                       66880001
668900             WHERE  PO_NBR   = :INVOIC-PO-NBR                     66890001
669000               AND  INVC_ID  = :INVOIC-INVC-ID                    66900001
669100               AND  ALW_CHRG_TYP_CDE = 'A'                        66910001
669200         END-EXEC                                                 66920001
669300                                                                  66930001
669400         EVALUATE TRUE                                            66940001
669500             WHEN SQLCODE = ZERO                                  66950001
669600                 IF PV-DB2-COUNT > 0                              66960001
669700                     MOVE 'Y'    TO PS-TALCHRG-EXISTS-SW          66970001
669800                 END-IF                                           66980001
669900                 IF PV-SUM-OF-ALLOWANCES > +0                     66990001
670000                     SUBTRACT PV-SUM-OF-ALLOWANCES FROM           67000001
670100                          ASC-TALCHRG-COST-WITH-ADJSTMT           67010001
670200                 END-IF                                           67020001
670300             WHEN SQLCODE = -904                                  67030001
670400             WHEN SQLCODE = -913                                  67040001
670500             WHEN SQLCODE = +100                                  67050001
670600                 CONTINUE                                         67060001
670700             WHEN OTHER                                           67070001
670800                 MOVE '4175-ACCUM-ALLOWANCES    '                 67080001
670900                                 TO DP013-PARAGRAPH               67090001
671000                 MOVE 'ACCUMULATE ALLOWANCES    '                 67100001
671100                                 TO DP013-MESSAGE-TEXT (1)        67110001
671200                 MOVE 'TALCHRG'  TO DP013-DB2-TABLE-NAME (1)      67120001
671300                 MOVE SQLCA      TO DP013-SQLCA                   67130001
671400                 SET DP013-DB2-ABEND                              67140001
671500                     DP013-XCTL-DISPLAY-RESTART                   67150001
671600                                 TO TRUE                          67160001
671700                 PERFORM DP013-0000-PROCESS-ABEND                 67170001
671800         END-EVALUATE                                             67180001
671900     END-PERFORM.                                                 67190001
672000                                                                  67200001
672100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        67210001
672200         MOVE '4175-ACCUM-ALLOWANCES   '                          67220001
672300                                 TO DP013-PARAGRAPH               67230001
672400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     67240001
672500                                 TO DP013-MESSAGE-TEXT (1)        67250001
672600         MOVE 'ALLOWANCES   '    TO DP013-MESSAGE-TEXT (2)        67260001
672700         MOVE SQLCA              TO DP013-SQLCA                   67270001
672800         MOVE 'TALCHRG'          TO DP013-DB2-TABLE-NAME (1)      67280001
672900         SET DP013-DB2-ABEND                                      67290001
673000             DP013-XCTL-DISPLAY-RESTART                           67300001
673100                                 TO TRUE                          67310001
673200         PERFORM DP013-0000-PROCESS-ABEND                         67320001
673300     END-IF.                                                      67330001
673400                                                                  67340001
673500*--------------------------------------------------------------*  67350001
673600* FOR TOTAL UNIT COST, WE NEED TO GET THE WEIGHTED AVERAGE     *  67360001
673700*--------------------------------------------------------------*  67370001
673800 4190-CALC-PREQIT-TOT-COST.                                       67380001
673900                                                                  67390001
674000     MOVE +0 TO PV-TOTAL-PIECES                                   67400001
674100                PV-TOTAL-INVC-ITEMS                               67410001
674200                PV-PER-UNIT-COST                                  67420001
674300                ASC-CALC-PREQIT-COST                              67430001
674400                                                                  67440001
674500     EXEC SQL                                                     67450001
674600         OPEN PREQIT_CSR                                          67460001
674700     END-EXEC.                                                    67470001
674800                                                                  67480001
674900     EVALUATE TRUE                                                67490001
675000         WHEN SQLCODE = +0                                        67500001
675100             CONTINUE                                             67510001
675200         WHEN OTHER                                               67520001
675300             MOVE '4190-...           '                           67530001
675400                               TO DP013-PARAGRAPH                 67540001
675500             MOVE 'OPEN CURSOR'                                   67550001
675600                               TO DP013-MESSAGE-TEXT(1)           67560001
675700             MOVE SQLCA        TO DP013-SQLCA                     67570001
675800             MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)        67580001
675900             SET DP013-DB2-ABEND                                  67590001
676000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               67600001
676100             PERFORM DP013-0000-PROCESS-ABEND                     67610001
676200     END-EVALUATE                                                 67620001
676300                                                                  67630001
676400     PERFORM UNTIL SQLCODE = +100                                 67640001
676500                                                                  67650001
676600         EXEC SQL                                                 67660001
676700             FETCH PREQIT_CSR                                     67670001
676800             INTO :PV-TOTAL-PIECES                                67680001
676900                 ,:PV-PER-UNIT-COST                               67690001
677000         END-EXEC                                                 67700001
677100                                                                  67710001
677200         EVALUATE TRUE                                            67720001
677300             WHEN SQLCODE = +0                                    67730001
677400                 ADD 1 TO PV-TOTAL-INVC-ITEMS                     67740001
677500                 COMPUTE ASC-CALC-PREQIT-COST =                   67750001
677600                         ASC-CALC-PREQIT-COST +                   67760001
677700                        (PV-PER-UNIT-COST * PV-TOTAL-PIECES)      67770001
677800             WHEN SQLCODE = +100                                  67780001
677900                 CONTINUE                                         67790001
678000             WHEN OTHER                                           67800001
678100                 MOVE '4190-...           '                       67810001
678200                                   TO DP013-PARAGRAPH             67820001
678300                 MOVE 'FETCH CURSOR'                              67830001
678400                                   TO DP013-MESSAGE-TEXT(1)       67840001
678500                 MOVE SQLCA        TO DP013-SQLCA                 67850001
678600                 MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)    67860001
678700                 SET DP013-DB2-ABEND                              67870001
678800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           67880001
678900                 PERFORM DP013-0000-PROCESS-ABEND                 67890001
679000         END-EVALUATE                                             67900001
679100     END-PERFORM.                                                 67910001
679200                                                                  67920001
679300     EXEC SQL                                                     67930001
679400        CLOSE PREQIT_CSR                                          67940001
679500     END-EXEC.                                                    67950001
679600                                                                  67960001
679700     EVALUATE TRUE                                                67970001
679800         WHEN SQLCODE = +0                                        67980001
679900             CONTINUE                                             67990001
680000         WHEN OTHER                                               68000001
680100             MOVE '4190-...           '                           68010001
680200                               TO DP013-PARAGRAPH                 68020001
680300             MOVE 'CLOSE CURSOR'                                  68030001
680400                               TO DP013-MESSAGE-TEXT(1)           68040001
680500             MOVE SQLCA        TO DP013-SQLCA                     68050001
680600             MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)        68060001
680700             SET DP013-DB2-ABEND                                  68070001
680800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               68080001
680900             PERFORM DP013-0000-PROCESS-ABEND                     68090001
681000     END-EVALUATE.                                                68100001
681100                                                                  68110001
681200*--------------------------------------------------------------*  68120001
681300* DETERMINE IF A VENDOR/INVOICE COMBINATION ALREAYD EXISTS     *  68130001
681400*--------------------------------------------------------------*  68140001
681500 4195-CHECK-VEND-INVC-COMBO.                                      68150001
681600                                                                  68160001
681700     PERFORM                                                      68170001
681800         WITH TEST AFTER                                          68180001
681900         VARYING PV-RETRY-COUNTER                                 68190001
682000         FROM 1 BY 1                                              68200001
682100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               68210001
682200            OR (SQLCODE = +0)                                     68220001
682300            OR (SQLCODE = +100)                                   68230001
682400            OR (SQLCODE = -811))                                  68240001
682500                                                                  68250001
682600         EXEC SQL                                                 68260001
682700           SELECT '1'                                             68270001
682800            INTO  :PV-ONE                                         68280001
682900             FROM SYSIBM.SYSDUMMY1 X                              68290001
683000            WHERE EXISTS (SELECT 1                                68300001
683100                            FROM TINVOIC                          68310001
683200                           WHERE INVC_ID = :ASC-NEW-INVC-ID       68320001
683300                             AND PO_NBR IS NOT NULL               68330001
683400                             AND PO_NBR ^= :ASC-NEW-PO-NBR        68340001
683500                             AND RMIT_VND_ID = :PV-PO-DUN-NBR     68350001
683600                             AND X.IBMREQD = X.IBMREQD)           68360001
683700         END-EXEC                                                 68370001
683800                                                                  68380001
683900         EVALUATE TRUE                                            68390001
684000             WHEN SQLCODE = +0                                    68400001
684100             WHEN SQLCODE = -811                                  68410001
684200                 SET DP020-MSG-FATAL       TO TRUE                68420001
684300***              -- VENDOR/INVC ALREADY EXISTS --                 68430001
684400                 MOVE DP015-UNP-ALP-BRT-OFF                       68440001
684500                                           TO AINVNBRA            68450001
684600                                      ADUNNBRA                    68460001
684700                 MOVE DP015-RED            TO AINVNBRC            68470001
684800                                      ADUNNBRC                    68480001
684900                 MOVE DP015-REVERSE        TO AINVNBRH            68490001
685000                                      ADUNNBRH                    68500001
685100                 SET DP030-SET-CURSOR-APPL-1                      68510001
685200                                           TO TRUE                68520001
685300                 IF PS-NO-ERROR                                   68530001
685400                     MOVE PC-TSYMSG-00974  TO DP020-MSG-NUMBER    68540001
685500                     MOVE -1               TO AINVNBRL            68550001
685600                 END-IF                                           68560001
685700                 SET PS-ERROR              TO TRUE                68570001
685800             WHEN SQLCODE = -904                                  68580001
685900             WHEN SQLCODE = -913                                  68590001
686000                 CONTINUE                                         68600001
686100                                                                  68610001
686200             WHEN SQLCODE = +100                                  68620001
686300                 CONTINUE                                         68630001
686400                                                                  68640001
686500             WHEN SQLWARN0 NOT = SPACES                           68650001
686600             WHEN SQLCODE < ZERO                                  68660001
686700             WHEN SQLCODE > ZERO                                  68670001
686800                 MOVE '4195-CHECK-VEND-INVC'                      68680001
686900                                   TO DP013-PARAGRAPH             68690001
687000                 MOVE 'SELECT ON TINVOIC'                         68700001
687100                                   TO DP013-MESSAGE-TEXT (1)      68710001
687200                 MOVE SQLCA        TO DP013-SQLCA                 68720001
687300                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    68730001
687400                 MOVE SPACES       TO DP013-DB2-TABLE-NAME (2)    68740001
687500                                      DP013-DB2-TABLE-NAME (3)    68750001
687600                 SET DP013-DB2-ABEND                              68760001
687700                     DP013-XCTL-DISPLAY-RESTART                   68770001
687800                                   TO TRUE                        68780001
687900                 PERFORM DP013-0000-PROCESS-ABEND                 68790001
688000         END-EVALUATE                                             68800001
688100     END-PERFORM.                                                 68810001
688200                                                                  68820001
688300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        68830001
688400         MOVE '4195-CHECK-VEND-INVC'                              68840001
688500                                   TO DP013-PARAGRAPH             68850001
688600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     68860001
688700                                   TO DP013-MESSAGE-TEXT (1)      68870001
688800         MOVE SQLCA                TO DP013-SQLCA                 68880001
688900         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    68890001
689000         MOVE SPACES               TO DP013-DB2-TABLE-NAME (2)    68900001
689100                                      DP013-DB2-TABLE-NAME (3)    68910001
689200         SET DP013-DB2-ABEND                                      68920001
689300             DP013-XCTL-DISPLAY-RESTART                           68930001
689400                                   TO TRUE                        68940001
689500         PERFORM DP013-0000-PROCESS-ABEND                         68950001
689600     END-IF.                                                      68960001
689700                                                                  68970001
689800*--------------------------------------------------------------*  68980001
689900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.   *  68990001
690000*--------------------------------------------------------------*  69000001
690100 4200-MOVE-DATABASE-TO-COMMAREA.                                  69010001
690200                                                                  69020001
690300     MOVE  INVOIC-PAYT-REQ-SEQ-NBR    TO ASC-KEY-PAYT-REQ-SEQ-NBR 69030001
690400     MOVE  ASC-KEY-INVC-ID            TO ASC-OLD-INVC-ID          69040001
690500                                         ASC-PREV-INVC-ID         69050001
690600                                                                  69060001
690700     MOVE  INVOIC-STR-NBR             TO ASC-OLD-STR-NBR          69070001
690800                                         ASC-ALP-STR-NBR-NUM      69080001
690900     MOVE  INVOIC-INVC-TYP-CDE        TO ASC-KEY-INVC-TYP-CDE     69090001
691000     MOVE  INVOIC-STATUS-CDE          TO ASC-OLD-INVC-STATUS      69100001
691100                                         ASC-KEY-INVC-STATUS      69110001
691200     MOVE  INVOIC-INVC-DTE            TO ASC-OLD-INVC-DTE         69120001
691300     MOVE  INVOIC-HOLD-IND            TO ASC-OLD-HOLD-IND         69130001
691400     MOVE  INVOIC-ENTR-MTHD-CDE       TO ASC-ENTR-MTHD-CDE        69140001
691500     MOVE  INVOIC-GRO-COST-AMT        TO ASC-OLD-GRO-COST-AMT     69150001
691600                                         ASC-ALP-GRO-COST-AMT-NUM 69160001
691700     MOVE  MDINVC-TOT-INVC-PC-QTY     TO                          69170001
691800                                      ASC-OLD-TOT-INVC-PC-QTY     69180001
691900                                      ASC-ALP-TOT-INVC-PC-QTY-NUM 69190001
692000     MOVE  INVOIC-DC-NBR              TO ASC-OLD-DC-NBR           69200001
692100     MOVE  INVOIC-MTCH-LVL-CDE        TO ASC-MTCH-LVL-CDE         69210001
692200     MOVE  INVOIC-CALC-DUE-DTE        TO ASC-CALC-DUE-DTE         69220001
692300     MOVE  INVOIC-DUE-DTE-SRC-CDE     TO ASC-DUE-DTE-SRC-CDE      69230001
692400                                                                  69240001
692500***************************************************************** 69250001
692600*    5-20-97   CJK                                                69260001
692700*  INVOIC-INVC-NET-COST-AMT IS A NEW COLUMN (DEFAULT ZERO) THAT   69270001
692800*   HOLDS THE NET COST ORIGINALLY ENTERED WHEN ADDING INVOICES.   69280001
692900*   UPDATES AND ADDS SINCE THIS PROMOTE WILL UPDATE THAT FIELD.   69290001
693000*  THE IF/END-IF ATTEMPTS TO HANDLE ANY ROWS WERE THAT COLUMN     69300001
693100*   HASN'T BEEN POPULATED. THAT CODE CAN BE REMOVED WHEN WE'RE    69310001
693200*   SURE THAT NO UPDATABLE DATA EXISTS WITH ZERO NET AMOUNT.      69320001
693300***************************************************************** 69330001
693400     MOVE INVOIC-INVC-NET-COST-AMT                                69340001
693500                                 TO ASC-OLD-NET-INVC-AMT          69350001
693600                                    ASC-ALP-NET-INVC-AMT-NUM      69360001
693700     IF ASC-OLD-INVC-STATUS NOT = 'OB'                            69370001
693800       AND INVOIC-INVC-NET-COST-AMT = 0                           69380001
693900         MOVE ASC-TALCHRG-COST-WITH-ADJSTMT                       69390001
694000                                 TO ASC-OLD-NET-INVC-AMT          69400001
694100                                    ASC-ALP-NET-INVC-AMT-NUM      69410001
694200         SET ASC-NET-AMT-ZERO    TO TRUE                          69420001
694300     END-IF.                                                      69430001
694400                                                                  69440001
694500     MOVE  INVOIC-SPLIT-TERMS-IND   TO ASC-OLD-IN-SPLIT-TERMS-IND 69450001
694600                                                                  69460001
694700     MOVE  INVOIC-INVC-CART-CT        TO ASC-OLD-CARTON-CNT       69470001
694800                                         ASC-ALP-CARTON-CNT-NUM   69480001
694900                                                                  69490001
695000     MOVE  INVOIC-RMIT-VND-ID         TO ASC-OLD-RMIT-VND-ID      69500001
695100                                         ASC-PREV-DUN-NBR         69510001
695200     MOVE  INVOIC-PO-NBR              TO ASC-KEY-PO-NBR           69520001
695300                                         ASC-OLD-PO-NBR           69530001
695400                                         ASC-PREV-PO-NBR          69540001
695500                                         ASC-ALP-PO-NBR-NUM       69550001
695600     MOVE  ENTNME-ENT-NAME-DESC       TO ASC-ENT-NAME-DESC        69560001
695700     MOVE  BUSLOC-ADDRESS-LINE1-DESC  TO ASC-ADDRESS-LINE1-DESC   69570001
695800     MOVE  BUSLOC-ADDRESS-LINE2-DESC  TO ASC-ADDRESS-LINE2-DESC   69580001
695900     MOVE  BUSLOC-CITY-NAME           TO ASC-CITY-NAME            69590001
696000     MOVE  BUSLOC-STATE-CDE           TO ASC-STATE-CDE            69600001
696100     MOVE  BUSLOC-ZIP-CDE             TO ASC-ZIP-CDE              69610001
696200                                                                  69620001
696300     MOVE  PURCHS-DEPT-NBR            TO ASC-DEPT-NBR             69630001
696400     MOVE  PURCHS-NEW-STR-PO-IND      TO ASC-NEW-STR-PO-IND       69640001
696500                                                                  69650001
696600     MOVE  POAGMT-DISC-PCT            TO ASC-POAGMT-DISC-PCT      69660001
696700                                                                  69670001
696800     COMPUTE ASC-PO-DISCOUNT-PCT = PAYTRM-DISCOUNT-PCT * 100      69680001
696900                                                                  69690001
697000     IF PAYTRM-DISCOUNT-PCT = 0                                   69700001
697100        MOVE PAYTRM-DUE-DAY-QTY TO ASC-PO-DISCOUNT-DAYS-QTY       69710001
697200     ELSE                                                         69720001
697300        MOVE PAYTRM-DISCOUNT-DAYS-QTY TO ASC-PO-DISCOUNT-DAYS-QTY 69730001
697400     END-IF                                                       69740001
697500                                                                  69750001
697600     MOVE  PAYTRM-DUE-DAY-FR-DTE-TXT  TO ASC-PO-DUE-DAY-FR-DTE-TXT69760001
697700     MOVE  POAGMT-DISC-PAY-DAY-QTY    TO ASC-PO-DISC-PAY-DAY-QTY  69770001
697800                                                                  69780001
697900     MOVE  MDINVC-TERM-SEL-CDE        TO ASC-OLD-TERM-SEL-CDE     69790001
698000                                                                  69800001
698100     IF ASC-OLD-TERM-SEL-CDE = 'P'                                69810001
698200         MOVE 'S'                   TO ASC-OLD-PO-SEL             69820001
698300         MOVE ' '                   TO ASC-OLD-IN-SEL             69830001
698400     ELSE                                                         69840001
698500         MOVE ' '                   TO ASC-OLD-PO-SEL             69850001
698600         MOVE 'S'                   TO ASC-OLD-IN-SEL             69860001
698700     END-IF                                                       69870001
698800                                                                  69880001
698900     MOVE  INVCTM-DISC-PCT            TO ASC-OLD-IN-DISC-PCT      69890001
699000     COMPUTE ASC-OLD-IN-DISC-PCT-NUM   = ASC-OLD-IN-DISC-PCT * 10069900001
699100     MOVE  ASC-OLD-IN-DISC-PCT-NUM    TO ASC-ALP-DISC-PCT-NUM     69910001
699200                                                                  69920001
699300     IF INVCTM-DISC-PCT = .0000                                   69930001
699400         MOVE INVCTM-NET-DUE-DAY-QTY  TO                          69940001
699500                                      ASC-OLD-IN-DISC-DUE-DAY-QTY 69950001
699600                                      ASC-ALP-DISC-DUE-DAY-QTY-NUM69960001
699700                                                                  69970001
699800     ELSE                                                         69980001
699900         MOVE INVCTM-DISC-DUE-DAY-QTY TO                          69990001
700000                                      ASC-OLD-IN-DISC-DUE-DAY-QTY 70000001
700100                                      ASC-ALP-DISC-DUE-DAY-QTY-NUM70010001
700200     END-IF                                                       70020001
700300                                                                  70030001
700400     MOVE  INVCTM-TERM-TYP-CDE        TO ASC-OLD-IN-TERM-TYP-CDE  70040001
700500     IF ASC-OLD-IN-TERM-TYP-CDE = '02'                            70050001
700600         MOVE 'Y'                     TO ASC-OLD-IN-EOM           70060001
700700     ELSE                                                         70070001
700800         MOVE 'N'                     TO ASC-OLD-IN-EOM           70080001
700900     END-IF                                                       70090001
701000     MOVE  INVCTM-EXTD-DAYS-QTY       TO ASC-OLD-IN-EXTD-DAYS-QTY 70100001
701100                                         ASC-ALP-EXTD-DAYS-QTY-NUM70110001
701200                                                                  70120001
701300     MOVE  PS-TALCHRG-EXISTS-SW       TO ASC-TALCHRG-EXISTS-SW.   70130001
701400                                                                  70140001
701500     MOVE  MDINVC-KOHLS-FRGT-PCT      TO ASC-OLD-KOHLS-FRGT-PCT   70150001
701600                                                                  70160001
701700     COMPUTE ASC-OLD-KOHLS-FRGT-PCT-NUM =                         70170001
701800             ASC-OLD-KOHLS-FRGT-PCT   * 100                       70180001
701900     MOVE ASC-OLD-KOHLS-FRGT-PCT-NUM TO ASC-ALP-KOHLS-FRGT-PCT-NUM70190001
702000                                                                  70200001
702100     MOVE  MDINVC-VEND-FRGT-PCT       TO ASC-OLD-VEND-FRGT-PCT    70210001
702200     COMPUTE ASC-OLD-VEND-FRGT-PCT-NUM =                          70220001
702300             ASC-OLD-VEND-FRGT-PCT    * 100                       70230001
702400     MOVE ASC-OLD-VEND-FRGT-PCT-NUM   TO ASC-ALP-VEND-FRGT-PCT-NUM70240001
702500                                                                  70250001
702600     SET PS-IMPRT-ENTR-NBR-NO   TO TRUE                           70260001
702700                                                                  70270001
702800     IF ASC-EXPENSE-INVC                                          70280001
702900        MOVE EXINVC-IMPRT-ENTR-NBR    TO ASC-OLD-ENT-NBR          70290001
703000        MOVE EXINVC-IMPRT-BOL-ID      TO ASC-OLD-BOL-ID           70300001
703100        MOVE EXINVC-INVC-CONTNR-ID    TO ASC-OLD-CNTNR-ID         70310001
703200        MOVE EXINVC-IMPRT-BKR-REF-NBR TO ASC-OLD-REF-NBR          70320001
703300     ELSE                                                         70330001
703400         MOVE MDINVC-BOL-ID           TO ASC-OLD-BOL-ID           70340001
703500         MOVE MDINVC-IMPRT-CHRG-PRC-CDE                           70350001
703600                                      TO ASC-OLD-IMPRT-CHRG-CDE   70360001
703700     END-IF                                                       70370001
703800                                                                  70380001
703900     MOVE ASC-ORIGINAL-FIELD-VALUES   TO                          70390001
704000          ASC-NEWLY-ENTERED-FIELD-VALUES.                         70400001
704100                                                                  70410001
704200*--------------------------------------------------------------*  70420001
704300* MOVE COMMAREA TO SCREEN                                      *  70430001
704400*--------------------------------------------------------------*  70440001
704500 4400-MOVE-COMMAREA-TO-SCREEN.                                    70450001
704600                                                                  70460001
704700* INITIALIZE UNWANTED FIELDS FOR EXPENSE INVOICES.                70470001
704800     IF ASC-EXPENSE-INVC                                          70480001
704900         INITIALIZE                                               70490001
705000                       ASC-ALP-GRO-COST-AMT                       70500001
705100                       ASC-ALP-TOT-INVC-PC-QTY                    70510001
705200                       ASC-NEW-PO-SEL                             70520001
705300                       ASC-ALP-KOHLS-FRGT-PCT                     70530001
705400                       ASC-ALP-VEND-FRGT-PCT                      70540001
705500                       ASC-ALP-CARTON-CNT                         70550001
705600     END-IF                                                       70560001
705700                                                                  70570001
705800     MOVE ASC-NEW-INVC-ID           TO AINVNBRO                   70580001
705900                                                                  70590001
706000     MOVE DP015-BLUE                TO ASTATUSC                   70600001
706100     EVALUATE ASC-NEW-INVC-STATUS                                 70610001
706200         WHEN 'EN'                                                70620001
706300             MOVE 'ENTERED    '     TO ASTATUSO                   70630001
706400         WHEN 'RC'                                                70640001
706500             MOVE 'RECONCILE  '     TO ASTATUSO                   70650001
706600         WHEN 'RL'                                                70660001
706700             MOVE 'RELEASED   '     TO ASTATUSO                   70670001
706800         WHEN 'OP'                                                70680001
706900             MOVE 'OPEN TO PAY'     TO ASTATUSO                   70690001
707000         WHEN 'PD'                                                70700001
707100             MOVE 'PAID       '     TO ASTATUSO                   70710001
707200         WHEN 'PJ'                                                70720001
707300             MOVE 'PENDNG JRNL'     TO ASTATUSO                   70730001
707400         WHEN 'DE'                                                70740001
707500             MOVE 'DELETED    '     TO ASTATUSO                   70750001
707600         WHEN 'PR'                                                70760001
707700             MOVE 'PENDING RVW'     TO ASTATUSO                   70770001
707800             MOVE DP015-YELLOW      TO ASTATUSC                   70780001
707900         WHEN 'OB'                                                70790001
708000             MOVE 'OUT OF BAL '     TO ASTATUSO                   70800001
708100             MOVE DP015-YELLOW      TO ASTATUSC                   70810001
708200         WHEN 'IB'                                                70820001
708300             MOVE DP015-YELLOW      TO ASTATUSC                   70830001
708400             MOVE 'ITM IMBALNC'     TO ASTATUSO                   70840001
708500         WHEN 'BM'                                                70850001
708600             MOVE DP015-YELLOW      TO ASTATUSC                   70860001
708700             MOVE 'BATCH MATCH'     TO ASTATUSO                   70870001
708800     END-EVALUATE                                                 70880001
708900                                                                  70890001
709000     IF ASC-ALP-PO-NBR NUMERIC                                    70900001
709100         MOVE ASC-NEW-PO-NBR        TO PV-NUM09                   70910001
709200         MOVE PV-NUM09-X            TO APONUMO                    70920001
709300     ELSE                                                         70930001
709400         MOVE ASC-ALP-PO-NBR        TO APONUMO                    70940001
709500     END-IF                                                       70950001
709600                                                                  70960001
709700     MOVE ASC-NEW-RMIT-VND-ID       TO ADUNNBRO                   70970001
709800     MOVE ASC-NEW-HOLD-IND          TO AHLDINDO                   70980001
709900     MOVE ASC-NEW-INVC-DTE-MM       TO AINVMMO                    70990001
710000     MOVE ASC-NEW-INVC-DTE-DD       TO AINVDDO                    71000001
710100     MOVE ASC-NEW-INVC-DTE-YY       TO AINVYYO                    71010001
710200     MOVE ASC-ENT-NAME-DESC         TO ANAMEO                     71020001
710300     MOVE ASC-ADDRESS-LINE1-DESC    TO AADDR1O                    71030001
710400                                                                  71040001
710500     IF ASC-ALP-STR-NBR NUMERIC                                   71050001
710600         MOVE ASC-NEW-STR-NBR       TO PV-NUM4-9                  71060001
710700         MOVE PV-NUM4-X             TO ASTRNBRO                   71070001
710800     ELSE                                                         71080001
710900         MOVE ASC-ALP-STR-NBR       TO ASTRNBRO                   71090001
711000     END-IF                                                       71100001
711100                                                                  71110001
711200     MOVE ASC-NEW-DC-NBR            TO PV-NUM4-9                  71120001
711300     MOVE PV-NUM4-X                 TO ADCNBRO                    71130001
711400     MOVE ASC-MTCH-LVL-CDE          TO AMTCHCDO                   71140001
711500                                                                  71150001
711600     MOVE ASC-ADDRESS-LINE2-DESC    TO AADDR2O                    71160001
711700     MOVE ASC-DEPT-NBR              TO ADPTNBRO                   71170001
711800     MOVE ASC-CITY-NAME             TO ACITYO                     71180001
711900     MOVE ASC-STATE-CDE             TO ASTATEO                    71190001
712000     MOVE ASC-ZIP-CDE               TO AZIPO                      71200001
712100                                                                  71210001
712200     IF ASC-ALP-GRO-COST-AMT NUMERIC                              71220001
712300         IF ASC-NEW-GRO-COST-AMT = +0                             71230001
712400             MOVE SPACES            TO ATOTCSTO                   71240001
712500                                       ASC-ALP-GRO-COST-AMT       71250001
712600         ELSE                                                     71260001
712700             MOVE ASC-NEW-GRO-COST-AMT                            71270001
712800                                    TO PV-8V99                    71280001
712900             MOVE PV-8V99-X         TO ATOTCSTO                   71290001
713000                                       ASC-ALP-GRO-COST-AMT       71300001
713100         END-IF                                                   71310001
713200     ELSE                                                         71320001
713300         MOVE ASC-ALP-GRO-COST-AMT  TO ATOTCSTO                   71330001
713400     END-IF                                                       71340001
713500                                                                  71350001
713600     IF ASC-ALP-CARTON-CNT      NUMERIC                           71360001
713700*        IF ASC-NEW-CARTON-CNT      = +0                          71370001
713800         IF ASC-NEW-CARTON-CNT      = ZEROES                      71380001
713900             MOVE SPACES            TO ACARTCTO                   71390001
714000                                       ASC-ALP-CARTON-CNT         71400001
714100         ELSE                                                     71410001
714200             MOVE ASC-NEW-CARTON-CNT                              71420001
714300                                    TO PV-NUM5                    71430001
714400             MOVE PV-NUM5-X         TO ACARTCTO                   71440001
714500                                       ASC-ALP-CARTON-CNT         71450001
714600         END-IF                                                   71460001
714700     ELSE                                                         71470001
714800         MOVE ASC-ALP-CARTON-CNT                                  71480001
714900                                    TO ACARTCTO                   71490001
715000     END-IF                                                       71500001
715100                                                                  71510001
715200     IF ASC-ALP-TOT-INVC-PC-QTY NUMERIC                           71520001
715300         IF ASC-NEW-TOT-INVC-PC-QTY = +0                          71530001
715400             MOVE SPACES            TO ATOTINVO                   71540001
715500                                       ASC-ALP-TOT-INVC-PC-QTY    71550001
715600         ELSE                                                     71560001
715700             MOVE ASC-NEW-TOT-INVC-PC-QTY                         71570001
715800                                    TO PV-NUM09                   71580001
715900             MOVE PV-NUM09-X        TO ATOTINVO                   71590001
716000                                       ASC-ALP-TOT-INVC-PC-QTY    71600001
716100         END-IF                                                   71610001
716200     ELSE                                                         71620001
716300         MOVE ASC-ALP-TOT-INVC-PC-QTY                             71630001
716400                                    TO ATOTINVO                   71640001
716500     END-IF                                                       71650001
716600                                                                  71660001
716700     IF ASC-ALP-NET-INVC-AMT NUMERIC                              71670001
716800         IF ASC-NEW-NET-INVC-AMT = +0                             71680001
716900             MOVE SPACES            TO ANETCSTO                   71690001
717000                                       ASC-ALP-NET-INVC-AMT       71700001
717100         ELSE                                                     71710001
717200             MOVE ASC-NEW-NET-INVC-AMT                            71720001
717300                                    TO PV-8V99                    71730001
717400             MOVE PV-8V99-X         TO ANETCSTO                   71740001
717500                                       ASC-ALP-NET-INVC-AMT       71750001
717600         END-IF                                                   71760001
717700     ELSE                                                         71770001
717800         MOVE ASC-ALP-NET-INVC-AMT  TO ANETCSTO                   71780001
717900     END-IF                                                       71790001
718000                                                                  71800001
718100     MOVE ASC-CALC-DUE-DTE-MM      TO ACALCMMO                    71810001
718200     MOVE ASC-CALC-DUE-DTE-DD      TO ACALCDDO                    71820001
718300     MOVE ASC-CALC-DUE-DTE-YY      TO ACALCYYO                    71830001
718400                                                                  71840001
718500** BMW  9/7 PO TERMS SHOULD ALWAYS DISPLAY                        71850001
718600     PERFORM 4410-FILL-PO-FIELDS                                  71860001
718700                                                                  71870001
718800     IF ASC-NEW-PO-SEL = 'S'                                      71880001
718900         MOVE 'S'                       TO APOSELO                71890001
719000         MOVE 'P'                       TO ASC-NEW-TERM-SEL-CDE   71900001
719100     ELSE                                                         71910001
719200         MOVE ' '                       TO APOSELO                71920001
719300                                                                  71930001
719400     END-IF                                                       71940001
719500**   ELSE                                                         71950001
719600**       IF ASC-NEW-PO-SEL = ' '                                  71960001
719700**           MOVE SPACES            TO APOSELO                    71970001
719800**                                     APOPCTO                    71980001
719900**                                     APODAYO                    71990001
720000**                                     APOEOMO                    72000001
720100**                                     APOEXTO                    72010001
720200**       END-IF                                                   72020001
720300**   END-IF                                                       72030001
720400** BMW  END  9/7                                                  72040001
720500                                                                  72050001
720600*WR5091 ADD LOGIC TO ALWAYS DISPLAY THE INVOICE TERMS             72060001
720700*WR5091 IF TERMS EXIST                                            72070001
720800     IF ASC-TINVCTM-EXISTS                                        72080001
720900        OR ASC-NEW-IN-SEL = 'S'                                   72090001
721000        PERFORM 4420-FILL-INVC-FIELDS                             72100001
721100     END-IF.                                                      72110001
721200                                                                  72120001
721300     IF ASC-NEW-IN-SEL = 'S'                                      72130001
721400         MOVE 'S'                     TO AINSELO                  72140001
721500         MOVE 'I'                     TO ASC-NEW-TERM-SEL-CDE     72150001
721600     ELSE                                                         72160001
721700         IF ASC-TINVCTM-EXISTS-SW = 'N'                           72170001
721800             MOVE SPACES              TO AINSELO                  72180001
721900                                         AINPCTO                  72190001
722000                                         AINDAYO                  72200001
722100                                         AINEOMO                  72210001
722200                                         AINEXTO                  72220001
722300                                         ASPLITO                  72230001
722400         ELSE                                                     72240001
722500            MOVE ' '                  TO AINSELO                  72250001
722600         END-IF                                                   72260001
722700     END-IF                                                       72270001
722800                                                                  72280001
722900     MOVE '+--------------------------------------------+'        72290001
723000                                      TO ABOXBOTO.                72300001
723100                                                                  72310001
723200     MOVE PC-BILL-OF-LADING           TO ABOLLBLO                 72320001
723300                                                                  72330001
723400                                                                  72340001
723500     EVALUATE TRUE                                                72350001
723600        WHEN  ASC-KEY-INVC-TYP-CDE = 'MI'                         72360001
723700              MOVE 'MERCHANDISE'      TO AINVTYPO                 72370001
723800        WHEN  ASC-KEY-INVC-TYP-CDE = 'WO'                         72380001
723900              MOVE 'WRITE OFF  '      TO AINVTYPO                 72390001
724000        WHEN  ASC-KEY-INVC-TYP-CDE = 'RI'                         72400001
724100              MOVE 'REMAINDER  '      TO AINVTYPO                 72410001
724200        WHEN  ASC-KEY-INVC-TYP-CDE = 'EI'                         72420001
724300              MOVE 'EXPENSE    '      TO AINVTYPO                 72430001
724400        WHEN  OTHER                                               72440001
724500              MOVE 'NOT DEFINED'      TO AINVTYPO                 72450001
724600     END-EVALUATE                                                 72460001
724700                                                                  72470001
724800     IF ASC-ALP-KOHLS-FRGT-PCT NUMERIC                            72480001
724900         MOVE ASC-NEW-KOHLS-FRGT-PCT-NUM                          72490001
725000                                      TO PV-NUM3                  72500001
725100         MOVE PV-NUM3-X               TO ACMPFRTO                 72510001
725200     ELSE                                                         72520001
725300         MOVE ASC-ALP-KOHLS-FRGT-PCT  TO ACMPFRTO                 72530001
725400     END-IF                                                       72540001
725500                                                                  72550001
725600     IF ASC-ALP-VEND-FRGT-PCT NUMERIC                             72560001
725700         MOVE ASC-NEW-VEND-FRGT-PCT-NUM                           72570001
725800                                      TO PV-NUM3                  72580001
725900         MOVE PV-NUM3-X               TO AVNDFRTO                 72590001
726000     ELSE                                                         72600001
726100         MOVE ASC-ALP-VEND-FRGT-PCT   TO AVNDFRTO                 72610001
726200     END-IF                                                       72620001
726300                                                                  72630001
726400     MOVE ASC-ENTR-MTHD-CDE           TO AENTMTHO                 72640001
726500* THE BOL FIELD WILL CONTAIN IMPORT ENTRY NUMBER FOR EXPENSE INVC 72650001
726600     MOVE ASC-NEW-BOL-ID              TO ABOLNBRO                 72660001
726700     MOVE ASC-TALCHRG-EXISTS-SW       TO AALLWCHO                 72670001
726800                                                                  72680001
726900                                                                  72690001
727000     MOVE ASC-NEW-IMPRT-CHRG-CDE      TO ACHRGCDO                 72700001
727100     IF ASC-EXPENSE-INVC                                          72710001
727200         MOVE 'CONTAINER ID..:'   TO ACNTNRAPO                    72720001
727300         MOVE ASC-NEW-CNTNR-ID    TO ACNTNRO                      72730001
727400         MOVE 'REFERENCE NBR.:'   TO AREFNCAPO                    72740001
727500         MOVE ASC-NEW-REF-NBR     TO AREFNBRO                     72750001
727600         MOVE 'ENTRY NUMBER..:'   TO AENTRYAPO                    72760001
727700         MOVE ASC-NEW-ENT-NBR     TO AENTRYO                      72770001
727800     ELSE                                                         72780001
727900         MOVE SPACES              TO ACNTNRAPO                    72790001
728000         MOVE SPACES              TO ACNTNRO                      72800001
728100         MOVE SPACES              TO AREFNCAPO                    72810001
728200         MOVE SPACES              TO AREFNBRO                     72820001
728300         MOVE SPACES              TO AENTRYAPO                    72830001
728400         MOVE SPACES              TO AENTRYO                      72840001
728500     END-IF                                                       72850001
728600*    MOVE ASC-NEW-CALC-DUE-DT-MM      TO ACALCMMO                 72860001
728700*    MOVE ASC-NEW-CALC-DUE-DT-DD      TO ACALCDDO                 72870001
728800*    MOVE ASC-NEW-CALC-DUE-DT-YY      TO ACALCYYO                 72880001
728900                                                                  72890001
729000     MOVE DP015-PRO-DRK-OFF           TO AITMCAPA                 72900001
729100                                         AITMSUMA                 72910001
729200                                                                  72920001
729300     EVALUATE TRUE                                                72930001
729400       WHEN ASC-DUE-DTE-SRC-CDE = 'I'                             72940001
729500            MOVE 'INVOICE  '   TO ADUESRCO                        72950001
729600       WHEN ASC-DUE-DTE-SRC-CDE = 'R'                             72960001
729700            MOVE 'RECEIVER '   TO ADUESRCO                        72970001
729800       WHEN ASC-DUE-DTE-SRC-CDE = 'X'                             72980001
729900            MOVE 'EXCEPTION'   TO ADUESRCO                        72990001
730000       WHEN OTHER                                                 73000001
730100            MOVE 'UNKNOWN  '   TO ADUESRCO                        73010001
730200     END-EVALUATE                                                 73020001
730300                                                                  73030001
730400     IF PS-NO-ERROR                                               73040001
730500         IF ASC-DELETE-PENDING                                    73050001
730600             CONTINUE                                             73060001
730700         ELSE                                                     73070001
730800             SET DP030-SET-CURSOR-APPL-1                          73080001
730900                                      TO TRUE                     73090001
731000             MOVE -1                  TO AINVNBRL                 73100001
731100             IF ASC-UPDATE-PENDING AND                            73110001
731200               (ASC-CALC-PREQIT-COST NOT = ASC-NEW-GRO-COST-AMT)  73120001
731300                  AND                                             73130001
731400                ASC-CALC-PREQIT-COST > +0                         73140001
731500                  MOVE PC-TSYMSG-00935  TO DP020-MSG-NUMBER       73150001
731600                  SET DP020-MSG-WARNING TO TRUE                   73160001
731700                  MOVE ASC-CALC-PREQIT-COST                       73170001
731800                                      TO PV-8V99                  73180001
731900                  MOVE PV-8V99-X      TO AITMSUMO                 73190001
732000                  MOVE DP015-PRO-NOR-OFF         TO AITMCAPA      73200001
732100                                                    AITMSUMA      73210001
732200                  MOVE DP015-YELLOW   TO AITMSUMC                 73220001
732300             END-IF                                               73230001
732400         END-IF                                                   73240001
732500     END-IF.                                                      73250001
732600                                                                  73260001
732700*--------------------------------------------------------------*  73270001
732800* POPULATE THE PO CICS SCREEN FIELDS                           *  73280001
732900*--------------------------------------------------------------*  73290001
733000 4410-FILL-PO-FIELDS.                                             73300001
733100                                                                  73310001
733200     IF ASC-PO-DISCOUNT-PCT = 0                                   73320001
733300         MOVE 'NET'                 TO APOPCTO                    73330001
733400     ELSE                                                         73340001
733500         MOVE ASC-PO-DISCOUNT-PCT   TO PV-2V99                    73350001
733600         MOVE PV-2V99-X             TO APOPCTO                    73360001
733700     END-IF                                                       73370001
733800                                                                  73380001
733900     MOVE ASC-PO-DISCOUNT-DAYS-QTY  TO PV-NUM3                    73390001
734000     MOVE PV-NUM3-X                 TO APODAYO                    73400001
734100                                                                  73410001
734200     IF ASC-PO-DUE-DAY-FR-DTE-TXT = 'EOM'                         73420001
734300         MOVE 'Y'                   TO APOEOMO                    73430001
734400     ELSE                                                         73440001
734500         MOVE 'N'                   TO APOEOMO                    73450001
734600     END-IF                                                       73460001
734700                                                                  73470001
734800     MOVE ASC-PO-DISC-PAY-DAY-QTY   TO PV-NUM3                    73480001
734900     MOVE PV-NUM3-X                 TO APOEXTO.                   73490001
735000                                                                  73500001
735100*--------------------------------------------------------------*  73510001
735200* POPULATE THE INVOICE CICS SCREEN FIELDS                      *  73520001
735300*--------------------------------------------------------------*  73530001
735400 4420-FILL-INVC-FIELDS.                                           73540001
735500                                                                  73550001
735600     IF ASC-ALP-DISC-PCT = 'NET'                                  73560001
735700         MOVE 'NET'                 TO AINPCTO                    73570001
735800                                       ASC-ALP-DISC-PCT           73580001
735900     ELSE                                                         73590001
736000         IF ASC-ALP-DISC-PCT NUMERIC                              73600001
736100             IF ASC-NEW-IN-DISC-PCT-NUM = 0                       73610001
736200                 MOVE 'NET'             TO AINPCTO                73620001
736300                                           ASC-ALP-DISC-PCT       73630001
736400             ELSE                                                 73640001
736500                 MOVE ASC-NEW-IN-DISC-PCT-NUM                     73650001
736600                                        TO PV-2V99                73660001
736700                 MOVE PV-2V99-X         TO AINPCTO                73670001
736800                                           ASC-ALP-DISC-PCT       73680001
736900             END-IF                                               73690001
737000         ELSE                                                     73700001
737100             MOVE ASC-ALP-DISC-PCT      TO AINPCTO                73710001
737200         END-IF                                                   73720001
737300     END-IF                                                       73730001
737400                                                                  73740001
737500     IF ASC-ALP-DISC-DUE-DAY-QTY NUMERIC                          73750001
737600         MOVE  ASC-NEW-IN-DISC-DUE-DAY-QTY TO PV-NUM3             73760001
737700         MOVE  PV-NUM3-X                TO AINDAYO                73770001
737800     ELSE                                                         73780001
737900         MOVE  ASC-ALP-DISC-DUE-DAY-QTY TO AINDAYO                73790001
738000     END-IF                                                       73800001
738100                                                                  73810001
738200     MOVE  ASC-NEW-IN-EOM           TO AINEOMO                    73820001
738300                                                                  73830001
738400     IF ASC-ALP-EXTD-DAYS-QTY NUMERIC                             73840001
738500         MOVE  ASC-NEW-IN-EXTD-DAYS-QTY                           73850001
738600                                        TO PV-NUM3                73860001
738700         MOVE  PV-NUM3-X                TO AINEXTO                73870001
738800     ELSE                                                         73880001
738900         MOVE  ASC-ALP-EXTD-DAYS-QTY    TO AINEXTO                73890001
739000     END-IF                                                       73900001
739100                                                                  73910001
739200     MOVE ASC-NEW-IN-SPLIT-TERMS-IND TO ASPLITO.                  73920001
739300                                                                  73930001
739400*--------------------------------------------------------------*  73940001
739500* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS*  73950001
739600* OBJECT WAS UPDATED.                                          *  73960001
739700*--------------------------------------------------------------*  73970001
739800 5200-UPDATE-SELECTION-QUEUE.                                     73980001
739900                                                                  73990001
740000     PERFORM 9100-READ-SEL-QUEUE.                                 74000001
740100                                                                  74010001
740200     IF  ASC-DELETE-SUCCESSFUL                                    74020001
740300         SET AP301-DEL (ASC-SEL-SUB)     TO TRUE                  74030001
740400     ELSE                                                         74040001
740500**       THEY MAY HAVE UPDATED THE NETWORK OR VENDOR INCHG INFO,  74050001
740600**       SO BE SURE TO UPDATE THE CORRESPONDING TS REC TOO.       74060001
740700         SET AP301-UPD (ASC-SEL-SUB)     TO TRUE                  74070001
740800     END-IF.                                                      74080001
740900                                                                  74090001
741000     PERFORM 9200-REWRITE-LIST-QUEUE.                             74100001
741100                                                                  74110001
741200     IF DP020-MSG-NUMBER NOT > ZERO                               74120001
741300         MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER          74130001
741400         SET DP020-MSG-INFORMATIONAL TO TRUE                      74140001
741500     END-IF.                                                      74150001
741600                                                                  74160001
741700**   PERFORM 3500-SAVE-SCREEN-FIELDS.                             74170001
741800                                                                  74180001
741900*--------------------------------------------------------------*  74190001
742000* PERFORM CHECKS TO DETERMINE IF THE TINVOIC AND TMDINVC       *  74200001
742100* TABLES NEED TO BE UPDATED.                                   *  74210001
742200*--------------------------------------------------------------*  74220001
742300 6000-UPDATE-DATABASE.                                            74230001
742400                                                                  74240001
742500*  CJK  6-2-97   ADDED CHECK IF ASC-NET-AMT-ZERO, THEN UPDATE     74250001
742600*       INVOIC-INVC-NET-COST-AMT WITH THE CALCULATED NET INVOICE  74260001
742700*       AMOUNT. THIS FORCES THE PHYSUCAL UPDATE OF THE TINVOIC    74270001
742800*       ROW, EVEN IF THE USER HASN'T CHANGED ANY OF THE DATA.     74280001
742900     IF DP020-SRC-AID = DP016-PF17                                74290001
743000        NEXT SENTENCE                                             74300001
743100     ELSE                                                         74310001
743200        PERFORM 6010-DETERMINE-INVC-STATUS                        74320001
743300     END-IF.                                                      74330001
743400                                                                  74340001
743500     IF ASC-KEY-INVC-STATUS     NOT = ASC-OLD-INVC-STATUS     OR  74350001
743600        ASC-NEW-HOLD-IND        NOT = ASC-OLD-HOLD-IND        OR  74360001
743700        ASC-NEW-INVC-DTE        NOT = ASC-OLD-INVC-DTE        OR  74370001
743800        ASC-NEW-STR-NBR         NOT = ASC-OLD-STR-NBR         OR  74380001
743900        ASC-NEW-GRO-COST-AMT    NOT = ASC-OLD-GRO-COST-AMT    OR  74390001
744000        ASC-NEW-NET-INVC-AMT    NOT = ASC-OLD-NET-INVC-AMT    OR  74400001
744100        ASC-NEW-RMIT-VND-ID     NOT = ASC-OLD-RMIT-VND-ID     OR  74410001
744200        ASC-NEW-IN-SPLIT-TERMS-IND                                74420001
744300                                NOT = ASC-OLD-IN-SPLIT-TERMS-IND  74430001
744400                                                              OR  74440001
744500        ASC-NEW-CARTON-CNT      NOT = ASC-OLD-CARTON-CNT      OR  74450001
744600        ASC-NEW-DC-NBR          NOT = ASC-OLD-DC-NBR          OR  74460001
744700        ASC-NET-AMT-ZERO                                          74470001
744800        IF ASC-KEY-INVC-STATUS  NOT = ASC-OLD-INVC-STATUS         74480001
744900           PERFORM 6150-UPDATE-TINVOIC                            74490001
745000*          -- FOR EXPENSE INVOICES ONLY, IF THE STATUS        --  74500001
745100*          -- IS CHANGED TO 'EN' FROM 'IB', 'OB, 'PR', UPDATE --  74510001
745200*          -- THE ENTER DATE ON TINVOIC TO TODAY'S DATE.      --  74520001
745300           IF PV-INVOIC-TYP-CDE = 'EI'                            74530001
745400              IF ASC-KEY-INVC-STATUS  = 'EN' AND                  74540001
745500                 (ASC-OLD-INVC-STATUS = 'IB' OR 'OB' OR 'PR')     74550001
745600                 PERFORM 6210-UPDATE-ENTER-DATE                   74560001
745700              END-IF                                              74570001
745800           END-IF                                                 74580001
745900        ELSE                                                      74590001
746000           PERFORM 6100-UPDATE-TINVOIC                            74600001
746100        END-IF                                                    74610001
746200     END-IF.                                                      74620001
746300                                                                  74630001
746400     IF ASC-NEW-RMIT-VND-ID     NOT = ASC-OLD-RMIT-VND-ID         74640001
746500         PERFORM 6200-UPDATE-REMIT-VENDOR-ID                      74650001
746600     END-IF.                                                      74660001
746700                                                                  74670001
746800     IF ASC-NEW-IN-SEL = 'S'                                      74680001
746900         IF ASC-OLD-IN-SEL = 'S'                                  74690001
747000             IF ASC-NEW-IN-DISC-PCT-NUM  NOT =                    74700001
747100                ASC-OLD-IN-DISC-PCT-NUM                         OR74710001
747200                ASC-NEW-IN-DISC-DUE-DAY-QTY NOT =                 74720001
747300                ASC-OLD-IN-DISC-DUE-DAY-QTY                     OR74730001
747400                ASC-NEW-IN-EOM           NOT =                    74740001
747500                ASC-OLD-IN-EOM                                  OR74750001
747600                ASC-NEW-IN-TERM-TYP-CDE  NOT =                    74760001
747700                ASC-OLD-IN-TERM-TYP-CDE                         OR74770001
747800                ASC-NEW-IN-EXTD-DAYS-QTY NOT =                    74780001
747900                ASC-OLD-IN-EXTD-DAYS-QTY                          74790001
748000                 MOVE ASC-KEY-PAYT-REQ-SEQ-NBR TO                 74800001
748100                      INVOIC-PAYT-REQ-SEQ-NBR                     74810001
748200                 PERFORM 6300-UPDATE-TINVCTM                      74820001
748300             END-IF                                               74830001
748400         ELSE                                                     74840001
748500*WR5091 CHECK IF INSERT OR UPDATE                                 74850001
748600             MOVE ASC-KEY-PAYT-REQ-SEQ-NBR TO                     74860001
748700                  INVOIC-PAYT-REQ-SEQ-NBR                         74870001
748800             IF ASC-TINVCTM-EXISTS                                74880001
748900                PERFORM 6300-UPDATE-TINVCTM                       74890001
749000             ELSE                                                 74900001
749100                PERFORM 6310-INSERT-TINVCTM                       74910001
749200             END-IF                                               74920001
749300         END-IF                                                   74930001
749400     ELSE                                                         74940001
749500         IF ASC-OLD-IN-SEL = 'S'                                  74950001
749600*WR5091 ADD LOGIC TO NOT DELETE THE INVOIC TERMS IF EDI           74960001
749700*WR5091 INVOICE - ONLY THE SELECTION IND SHOULD CHG               74970001
749800            IF ASC-ENTR-MTHD-CDE = 'ED'                           74980001
749900               CONTINUE                                           74990001
750000            ELSE                                                  75000001
750100               PERFORM 7100-DELETE-TINVCTM                        75010001
750200            END-IF                                                75020001
750300         END-IF                                                   75030001
750400     END-IF.                                                      75040001
750500                                                                  75050001
750600     IF ASC-EXPENSE-INVC                                          75060001
750700* THE BOL FIELD WILL CONTAIN IMPORT ENTRY NUMBER FOR EXPENSE INVC 75070001
750800         IF ASC-NEW-BOL-ID           NOT =                        75080001
750900            ASC-OLD-BOL-ID                                        75090001
751000             PERFORM 6450-UPDATE-TEXINVC                          75100001
751100         END-IF                                                   75110001
751200         IF ASC-NEW-CNTNR-ID        NOT =                         75120001
751300            ASC-OLD-CNTNR-ID                                      75130001
751400             PERFORM 6450-UPDATE-TEXINVC                          75140001
751500         END-IF                                                   75150001
751600         IF ASC-NEW-REF-NBR         NOT =                         75160001
751700            ASC-OLD-REF-NBR                                       75170001
751800             PERFORM 6450-UPDATE-TEXINVC                          75180001
751900         END-IF                                                   75190001
752000         IF ASC-NEW-ENT-NBR         NOT =                         75200001
752100            ASC-OLD-ENT-NBR                                       75210001
752200             PERFORM 6450-UPDATE-TEXINVC                          75220001
752300         END-IF                                                   75230001
752400     ELSE                                                         75240001
752500         IF ASC-NEW-TOT-INVC-PC-QTY  NOT =                        75250001
752600            ASC-OLD-TOT-INVC-PC-QTY               OR              75260001
752700            ASC-NEW-KOHLS-FRGT-PCT-NUM NOT =                      75270001
752800            ASC-OLD-KOHLS-FRGT-PCT-NUM            OR              75280001
752900            ASC-NEW-VEND-FRGT-PCT-NUM NOT =                       75290001
753000            ASC-OLD-VEND-FRGT-PCT-NUM             OR              75300001
753100            ASC-NEW-TERM-SEL-CDE     NOT =                        75310001
753200            ASC-OLD-TERM-SEL-CDE                  OR              75320001
753300            ASC-NEW-BOL-ID           NOT =                        75330001
753400            ASC-OLD-BOL-ID                        OR              75340001
753500            ASC-NEW-IMPRT-CHRG-CDE   NOT =                        75350001
753600            ASC-OLD-IMPRT-CHRG-CDE                                75360001
753700             PERFORM 6400-UPDATE-TMDINVC                          75370001
753800         END-IF                                                   75380001
753900     END-IF.                                                      75390001
754000                                                                  75400001
754100     IF DP020-MSG-NUMBER NOT > ZERO                               75410001
754200         MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER          75420001
754300         SET DP020-MSG-INFORMATIONAL TO TRUE                      75430001
754400     END-IF.                                                      75440001
754500                                                                  75450001
754600     IF ASC-USE-SELECTION-QUEUE                                   75460001
754700       AND ASC-NUMBER-OF-SELECTED-ITEMS GREATER THAN ZERO         75470001
754800         PERFORM 5200-UPDATE-SELECTION-QUEUE                      75480001
754900     END-IF.                                                      75490001
755000                                                                  75500001
755100     EXEC CICS                                                    75510001
755200         SYNCPOINT                                                75520001
755300     END-EXEC.                                                    75530001
755400                                                                  75540001
755500*--------------------------------------------------------------*  75550001
755600* DETERMINE THE INVOICE STATUS CODE                            *  75560001
755700*--------------------------------------------------------------*  75570001
755800 6010-DETERMINE-INVC-STATUS.                                      75580001
755900                                                                  75590001
756000**    IF THE NET AMOUNT HAS BEEN ENTERED, THEN CHECK IF THE       75600001
756100**    INVOICE IS IN BALANCE; OTHERWISE LEAVE THE STATUS AS IT IS. 75610001
756200**    (THE NET AMOUNT IS REQUIRED DURING UPDATE IF THE COST AMT   75620001
756300**    CHANGES.)                                                   75630001
756400                                                                  75640001
756500     IF PS-NET-AMT-ENTERED                                        75650001
756600                                                                  75660001
756700        MOVE ASC-KEY-PAYT-REQ-SEQ-NBR TO PREQIT-PAYT-REQ-SEQ-NBR  75670001
756800        PERFORM 4190-CALC-PREQIT-TOT-COST                         75680001
756900                                                                  75690001
757000        EVALUATE TRUE                                             75700001
757100           WHEN ASC-NEW-NET-INVC-AMT NOT =                        75710001
757200                                     ASC-TALCHRG-COST-WITH-ADJSTMT75720001
757300*               -- INVOICE OUT OF BALANCE --                      75730001
757400                MOVE 'OB'                  TO ASC-KEY-INVC-STATUS 75740001
757500                                              ASC-NEW-INVC-STATUS 75750001
757600                                                                  75760001
757700           WHEN ((ASC-NEW-GRO-COST-AMT NOT = ASC-CALC-PREQIT-COST)75770001
757800                     AND                                          75780001
757900                 PV-TOTAL-INVC-ITEMS > +0 )                       75790001
758000*               -- ITEM IMBALANCE - THE SUM OF THE DETAILS DOESN'T75800001
758100*               -- MATCH THE SCREEN'S GRO_COST_AMT FIELD          75810001
758200                MOVE 'IB'                  TO ASC-KEY-INVC-STATUS 75820001
758300                                              ASC-NEW-INVC-STATUS 75830001
758400                                                                  75840001
758500           WHEN OTHER                                             75850001
758600*               -- EVERYTHING IS IN BALANCE --                    75860001
758700                IF ASC-OLD-INVC-STATUS = 'RC'                     75870001
758800                    MOVE 'RC'              TO ASC-KEY-INVC-STATUS 75880001
758900                                              ASC-NEW-INVC-STATUS 75890001
759000                ELSE                                              75900001
759100                   IF (ASC-OLD-INVC-STATUS = 'PR')                75910001
759200*                  IF (ASC-OLD-INVC-STATUS = 'PR') AND            75920001
759300*                     (ASC-NEW-INVC-STATUS = 'PR')                75930001
759400                       NEXT SENTENCE                              75940001
759500                   ELSE                                           75950001
759600                       MOVE 'EN' TO ASC-KEY-INVC-STATUS           75960001
759700                                    ASC-NEW-INVC-STATUS           75970001
759800                   END-IF                                         75980001
759900                END-IF                                            75990001
760000        END-EVALUATE.                                             76000001
760100                                                                  76010001
760200*--------------------------------------------------------------*  76020001
760300* UPDATE THE TINVOIC TABLE                                     *  76030001
760400*--------------------------------------------------------------*  76040001
760500 6100-UPDATE-TINVOIC.                                             76050001
760600                                                                  76060001
760700                                                                  76070001
760800     PERFORM                                                      76080001
760900         WITH TEST AFTER                                          76090001
761000         VARYING PV-RETRY-COUNTER                                 76100001
761100         FROM 1 BY 1                                              76110001
761200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               76120001
761300             OR (SQLCODE = +0))                                   76130001
761400                                                                  76140001
761500         EXEC SQL UPDATE TINVOIC                                  76150001
761600             SET HOLD_IND          = :ASC-NEW-HOLD-IND            76160001
761700                ,INVC_DTE          = :ASC-NEW-INVC-DTE            76170001
761800                ,STR_NBR           = :ASC-NEW-STR-NBR             76180001
761900                ,GRO_COST_AMT      = :ASC-NEW-GRO-COST-AMT        76190001
762000                ,SPLIT_TERMS_IND   = :ASC-NEW-IN-SPLIT-TERMS-IND  76200001
762100                ,INVC_CART_CT      = :ASC-NEW-CARTON-CNT          76210001
762200                ,STATUS_CDE        = :ASC-KEY-INVC-STATUS         76220001
762300                ,INVC_NET_COST_AMT = :ASC-NEW-NET-INVC-AMT        76230001
762400                ,DC_NBR            = :ASC-NEW-DC-NBR              76240001
762500          WHERE PO_NBR             = :ASC-KEY-PO-NBR              76250001
762600            AND INVC_ID            = :ASC-KEY-INVC-ID             76260001
762700                                                                  76270001
762800         END-EXEC                                                 76280001
762900                                                                  76290001
763000         EVALUATE TRUE                                            76300001
763100             WHEN SQLCODE = +0                                    76310001
763200             WHEN SQLCODE = -904                                  76320001
763300             WHEN SQLCODE = -913                                  76330001
763400                 CONTINUE                                         76340001
763500                                                                  76350001
763600             WHEN SQLWARN0 NOT = SPACES                           76360001
763700             WHEN SQLCODE < +0                                    76370001
763800             WHEN SQLCODE > +0                                    76380001
763900                 MOVE '6100-UPDATE-TINVOIC'                       76390001
764000                                   TO DP013-PARAGRAPH             76400001
764100                 MOVE 'UPDATE A ROW ON TINVOIC'                   76410001
764200                                   TO DP013-MESSAGE-TEXT(1)       76420001
764300                 MOVE SQLCA        TO DP013-SQLCA                 76430001
764400                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    76440001
764500                 SET DP013-DB2-ABEND                              76450001
764600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           76460001
764700                 PERFORM DP013-0000-PROCESS-ABEND                 76470001
764800         END-EVALUATE                                             76480001
764900     END-PERFORM.                                                 76490001
765000                                                                  76500001
765100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        76510001
765200         MOVE '6100-UPDATE-TINVOIC' TO DP013-PARAGRAPH            76520001
765300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              76530001
765400                                   TO DP013-MESSAGE-TEXT (1)      76540001
765500         MOVE 'TO UPDATE A TINVOIC ROW'                           76550001
765600                                   TO DP013-MESSAGE-TEXT (2)      76560001
765700         MOVE SQLCA                TO DP013-SQLCA                 76570001
765800         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    76580001
765900         SET DP013-DB2-ABEND                                      76590001
766000             DP013-XCTL-DISPLAY-RESTART                           76600001
766100                                   TO TRUE                        76610001
766200         PERFORM DP013-0000-PROCESS-ABEND                         76620001
766300     END-IF.                                                      76630001
766400                                                                  76640001
766500*--------------------------------------------------------------*  76650001
766600* UPDATE THE TINVOIC TABLE INCLUDING THE STATUS_CHG_TMST       *  76660001
766700*--------------------------------------------------------------*  76670001
766800 6150-UPDATE-TINVOIC.                                             76680001
766900                                                                  76690001
767000                                                                  76700001
767100     PERFORM                                                      76710001
767200         WITH TEST AFTER                                          76720001
767300         VARYING PV-RETRY-COUNTER                                 76730001
767400         FROM 1 BY 1                                              76740001
767500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               76750001
767600             OR (SQLCODE = +0))                                   76760001
767700                                                                  76770001
767800         EXEC SQL UPDATE TINVOIC                                  76780001
767900             SET HOLD_IND          = :ASC-NEW-HOLD-IND            76790001
768000                ,INVC_DTE          = :ASC-NEW-INVC-DTE            76800001
768100                ,STR_NBR           = :ASC-NEW-STR-NBR             76810001
768200                ,GRO_COST_AMT      = :ASC-NEW-GRO-COST-AMT        76820001
768300                ,SPLIT_TERMS_IND   = :ASC-NEW-IN-SPLIT-TERMS-IND  76830001
768400                ,INVC_CART_CT      = :ASC-NEW-CARTON-CNT          76840001
768500                ,STATUS_CDE        = :ASC-KEY-INVC-STATUS         76850001
768600                ,STATUS_CHG_TMST   =  CURRENT TIMESTAMP           76860001
768700                ,INVC_NET_COST_AMT = :ASC-NEW-NET-INVC-AMT        76870001
768800                ,DC_NBR            = :ASC-NEW-DC-NBR              76880001
768900          WHERE PO_NBR             = :ASC-KEY-PO-NBR              76890001
769000            AND INVC_ID            = :ASC-KEY-INVC-ID             76900001
769100         END-EXEC                                                 76910001
769200                                                                  76920001
769300         EVALUATE TRUE                                            76930001
769400             WHEN SQLCODE = +0                                    76940001
769500             WHEN SQLCODE = -904                                  76950001
769600             WHEN SQLCODE = -913                                  76960001
769700                 CONTINUE                                         76970001
769800                                                                  76980001
769900             WHEN SQLWARN0 NOT = SPACES                           76990001
770000             WHEN SQLCODE < +0                                    77000001
770100             WHEN SQLCODE > +0                                    77010001
770200                 MOVE '6150-UPDATE-TINVOIC'                       77020001
770300                                   TO DP013-PARAGRAPH             77030001
770400                 MOVE 'UPDATE A ROW ON TINVOIC'                   77040001
770500                                   TO DP013-MESSAGE-TEXT(1)       77050001
770600                 MOVE SQLCA        TO DP013-SQLCA                 77060001
770700                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    77070001
770800                 SET DP013-DB2-ABEND                              77080001
770900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           77090001
771000                 PERFORM DP013-0000-PROCESS-ABEND                 77100001
771100         END-EVALUATE                                             77110001
771200     END-PERFORM.                                                 77120001
771300                                                                  77130001
771400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        77140001
771500         MOVE '6150-UPDATE-TINVOIC' TO DP013-PARAGRAPH            77150001
771600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              77160001
771700                                   TO DP013-MESSAGE-TEXT (1)      77170001
771800         MOVE 'TO UPDATE A TINVOIC ROW'                           77180001
771900                                   TO DP013-MESSAGE-TEXT (2)      77190001
772000         MOVE SQLCA                TO DP013-SQLCA                 77200001
772100         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    77210001
772200         SET DP013-DB2-ABEND                                      77220001
772300             DP013-XCTL-DISPLAY-RESTART                           77230001
772400                                   TO TRUE                        77240001
772500         PERFORM DP013-0000-PROCESS-ABEND                         77250001
772600     END-IF.                                                      77260001
772700                                                                  77270001
772800*--------------------------------------------------------------*  77280001
772900* UPDATE THE STATUS ON TINVOIC TABLE                           *  77290001
773000*--------------------------------------------------------------*  77300001
773100 6175-TOGGLE-PENDING-STATUS.                                      77310001
773200                                                                  77320001
773300     IF PV-INVOIC-STATUS-CDE = 'PR'                               77330001
773400        MOVE 'EN' TO PV-INVOIC-STATUS-CDE                         77340001
773500     ELSE                                                         77350001
773600        IF PV-INVOIC-STATUS-CDE = 'EN'                            77360001
773700           MOVE 'PR' TO PV-INVOIC-STATUS-CDE                      77370001
773800        END-IF                                                    77380001
773900     END-IF.                                                      77390001
774000                                                                  77400001
774100     PERFORM                                                      77410001
774200         WITH TEST AFTER                                          77420001
774300         VARYING PV-RETRY-COUNTER                                 77430001
774400         FROM 1 BY 1                                              77440001
774500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               77450001
774600             OR (SQLCODE = +0))                                   77460001
774700                                                                  77470001
774800         EXEC SQL UPDATE TINVOIC                                  77480001
774900             SET STATUS_CDE        = :PV-INVOIC-STATUS-CDE        77490001
775000          WHERE PO_NBR             = :ASC-KEY-PO-NBR              77500001
775100            AND INVC_ID            = :ASC-KEY-INVC-ID             77510001
775200         END-EXEC                                                 77520001
775300                                                                  77530001
775400         EVALUATE TRUE                                            77540001
775500             WHEN SQLCODE = +0                                    77550001
775600             WHEN SQLCODE = -904                                  77560001
775700             WHEN SQLCODE = -913                                  77570001
775800                 CONTINUE                                         77580001
775900                                                                  77590001
776000             WHEN SQLWARN0 NOT = SPACES                           77600001
776100             WHEN SQLCODE < +0                                    77610001
776200             WHEN SQLCODE > +0                                    77620001
776300                 MOVE '6175-TOGGLE-PENDING-STATUS'                77630001
776400                                   TO DP013-PARAGRAPH             77640001
776500                 MOVE 'UPDATE INVOICE STATUS ON TINVOIC'          77650001
776600                                   TO DP013-MESSAGE-TEXT(1)       77660001
776700                 MOVE SQLCA        TO DP013-SQLCA                 77670001
776800                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    77680001
776900                 SET DP013-DB2-ABEND                              77690001
777000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           77700001
777100                 PERFORM DP013-0000-PROCESS-ABEND                 77710001
777200         END-EVALUATE                                             77720001
777300     END-PERFORM.                                                 77730001
777400                                                                  77740001
777500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        77750001
777600         MOVE '6175-TOGGLE-PENDING-STATUS' TO DP013-PARAGRAPH     77760001
777700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              77770001
777800                                   TO DP013-MESSAGE-TEXT (1)      77780001
777900         MOVE 'TO UPDATE A TINVOIC ROW'                           77790001
778000                                   TO DP013-MESSAGE-TEXT (2)      77800001
778100         MOVE SQLCA                TO DP013-SQLCA                 77810001
778200         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    77820001
778300         SET DP013-DB2-ABEND                                      77830001
778400             DP013-XCTL-DISPLAY-RESTART                           77840001
778500                                   TO TRUE                        77850001
778600         PERFORM DP013-0000-PROCESS-ABEND                         77860001
778700     END-IF.                                                      77870001
778800                                                                  77880001
778900*--------------------------------------------------------------*  77890001
779000* UPDATE THE STATUS ON TINVOIC TABLE FROM OP OR PJ TO DE FOR   *  77900001
779100* IMPORT INVOICES.                                             *  77910001
779200*--------------------------------------------------------------*  77920001
779300 6180-UPDATE-IMPINVC-TO-DE.                                       77930001
779400                                                                  77940001
779500     MOVE 'N' TO ASC-STAT-UPDATED-TO-DE-SW.                       77950001
779600                                                                  77960001
779700     PERFORM                                                      77970001
779800         WITH TEST AFTER                                          77980001
779900         VARYING PV-RETRY-COUNTER                                 77990001
780000         FROM 1 BY 1                                              78000001
780100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               78010001
780200             OR (SQLCODE = +0))                                   78020001
780300                                                                  78030001
780400         EXEC SQL UPDATE TINVOIC                                  78040001
780500             SET STATUS_CDE        = 'DE'                         78050001
780600          WHERE PO_NBR             = :ASC-KEY-PO-NBR              78060001
780700            AND INVC_ID            = :ASC-KEY-INVC-ID             78070001
780800         END-EXEC                                                 78080001
780900                                                                  78090001
781000         EVALUATE TRUE                                            78100001
781100             WHEN SQLCODE = +0                                    78110001
781200                 SET ASC-STAT-UPDATED-TO-DE TO TRUE               78120001
781300             WHEN SQLCODE = -904                                  78130001
781400             WHEN SQLCODE = -913                                  78140001
781500                 CONTINUE                                         78150001
781600                                                                  78160001
781700             WHEN SQLWARN0 NOT = SPACES                           78170001
781800             WHEN SQLCODE < +0                                    78180001
781900             WHEN SQLCODE > +0                                    78190001
782000                 MOVE '6180-UPDATE-IMPINVC-OP-TO-DE'              78200001
782100                                   TO DP013-PARAGRAPH             78210001
782200                 MOVE 'UPDATE INVOICE STATUS ON TINVOIC'          78220001
782300                                   TO DP013-MESSAGE-TEXT(1)       78230001
782400                 MOVE SQLCA        TO DP013-SQLCA                 78240001
782500                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    78250001
782600                 SET DP013-DB2-ABEND                              78260001
782700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           78270001
782800                 PERFORM DP013-0000-PROCESS-ABEND                 78280001
782900         END-EVALUATE                                             78290001
783000     END-PERFORM.                                                 78300001
783100                                                                  78310001
783200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        78320001
783300         MOVE '6180-UPDATE-IMPINVC-OP-TO-DE' TO DP013-PARAGRAPH   78330001
783400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              78340001
783500                                   TO DP013-MESSAGE-TEXT (1)      78350001
783600         MOVE 'TO UPDATE A TINVOIC ROW'                           78360001
783700                                   TO DP013-MESSAGE-TEXT (2)      78370001
783800         MOVE SQLCA                TO DP013-SQLCA                 78380001
783900         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    78390001
784000         SET DP013-DB2-ABEND                                      78400001
784100             DP013-XCTL-DISPLAY-RESTART                           78410001
784200                                   TO TRUE                        78420001
784300         PERFORM DP013-0000-PROCESS-ABEND                         78430001
784400     END-IF.                                                      78440001
784500                                                                  78450001
784600*--------------------------------------------------------------*  78460001
784700* UPDATE THE REMIT VENDOR ID ON THE TINVOIC TABLE              *  78470001
784800*--------------------------------------------------------------*  78480001
784900 6200-UPDATE-REMIT-VENDOR-ID.                                     78490001
785000                                                                  78500001
785100     PERFORM                                                      78510001
785200         WITH TEST AFTER                                          78520001
785300         VARYING PV-RETRY-COUNTER                                 78530001
785400         FROM 1 BY 1                                              78540001
785500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               78550001
785600             OR (SQLCODE = +0))                                   78560001
785700                                                                  78570001
785800         EXEC SQL UPDATE TINVOIC                                  78580001
785900             SET RMIT_VND_ID       = :ASC-NEW-RMIT-VND-ID         78590001
786000          WHERE PO_NBR             = :ASC-KEY-PO-NBR              78600001
786100            AND INVC_ID            = :ASC-KEY-INVC-ID             78610001
786200         END-EXEC                                                 78620001
786300                                                                  78630001
786400         EVALUATE TRUE                                            78640001
786500             WHEN SQLCODE = +0                                    78650001
786600             WHEN SQLCODE = -904                                  78660001
786700             WHEN SQLCODE = -913                                  78670001
786800                 CONTINUE                                         78680001
786900                                                                  78690001
787000             WHEN SQLWARN0 NOT = SPACES                           78700001
787100             WHEN SQLCODE < +0                                    78710001
787200             WHEN SQLCODE > +0                                    78720001
787300                 MOVE '6200-UPDATE-REMIT-VENDOR-ID'               78730001
787400                                   TO DP013-PARAGRAPH             78740001
787500                 MOVE 'UPDATE A ROW ON TINVOIC'                   78750001
787600                                   TO DP013-MESSAGE-TEXT(1)       78760001
787700                 MOVE SQLCA        TO DP013-SQLCA                 78770001
787800                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    78780001
787900                 SET DP013-DB2-ABEND                              78790001
788000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           78800001
788100                 PERFORM DP013-0000-PROCESS-ABEND                 78810001
788200         END-EVALUATE                                             78820001
788300     END-PERFORM.                                                 78830001
788400                                                                  78840001
788500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        78850001
788600         MOVE '6200-UPDATE-REMIT-VENDOR-ID' TO DP013-PARAGRAPH    78860001
788700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              78870001
788800                                   TO DP013-MESSAGE-TEXT (1)      78880001
788900         MOVE 'TO UPDATE A TINVOIC ROW'                           78890001
789000                                   TO DP013-MESSAGE-TEXT (2)      78900001
789100         MOVE SQLCA                TO DP013-SQLCA                 78910001
789200         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    78920001
789300         SET DP013-DB2-ABEND                                      78930001
789400             DP013-XCTL-DISPLAY-RESTART                           78940001
789500                                   TO TRUE                        78950001
789600         PERFORM DP013-0000-PROCESS-ABEND                         78960001
789700     END-IF.                                                      78970001
789800                                                                  78980001
789900*--------------------------------------------------------------*  78990001
790000* UPDATE THE ENTER DATE ON THE TINVOIC TABLE                   *  79000001
790100*--------------------------------------------------------------*  79010001
790200 6210-UPDATE-ENTER-DATE.                                          79020001
790300                                                                  79030001
790400     PERFORM                                                      79040001
790500         WITH TEST AFTER                                          79050001
790600         VARYING PV-RETRY-COUNTER                                 79060001
790700         FROM 1 BY 1                                              79070001
790800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               79080001
790900             OR (SQLCODE = +0))                                   79090001
791000                                                                  79100001
791100         EXEC SQL UPDATE TINVOIC                                  79110001
791200             SET CRE_DTE           = :ASC-CURRENT-DATE            79120001
791300          WHERE PO_NBR             = :ASC-KEY-PO-NBR              79130001
791400            AND INVC_ID            = :ASC-KEY-INVC-ID             79140001
791500         END-EXEC                                                 79150001
791600                                                                  79160001
791700         EVALUATE TRUE                                            79170001
791800             WHEN SQLCODE = +0                                    79180001
791900             WHEN SQLCODE = -904                                  79190001
792000             WHEN SQLCODE = -913                                  79200001
792100                 CONTINUE                                         79210001
792200                                                                  79220001
792300             WHEN SQLWARN0 NOT = SPACES                           79230001
792400             WHEN SQLCODE < +0                                    79240001
792500             WHEN SQLCODE > +0                                    79250001
792600                 MOVE '6210-UPDATE-ENTER-DATE'                    79260001
792700                                   TO DP013-PARAGRAPH             79270001
792800                 MOVE 'UNSUCCESSFUL UPDATE ON TINVOIC'            79280001
792900                                   TO DP013-MESSAGE-TEXT(1)       79290001
793000                 MOVE SQLCA        TO DP013-SQLCA                 79300001
793100                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    79310001
793200                 SET DP013-DB2-ABEND                              79320001
793300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           79330001
793400                 PERFORM DP013-0000-PROCESS-ABEND                 79340001
793500         END-EVALUATE                                             79350001
793600     END-PERFORM.                                                 79360001
793700                                                                  79370001
793800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        79380001
793900         MOVE '6210-UPDATE-ENTER-DATE' TO DP013-PARAGRAPH         79390001
794000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              79400001
794100                                   TO DP013-MESSAGE-TEXT (1)      79410001
794200         MOVE 'TO UPDATE A TINVOIC ROW'                           79420001
794300                                   TO DP013-MESSAGE-TEXT (2)      79430001
794400         MOVE SQLCA                TO DP013-SQLCA                 79440001
794500         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    79450001
794600         SET DP013-DB2-ABEND                                      79460001
794700             DP013-XCTL-DISPLAY-RESTART                           79470001
794800                                   TO TRUE                        79480001
794900         PERFORM DP013-0000-PROCESS-ABEND                         79490001
795000     END-IF.                                                      79500001
795100                                                                  79510001
795200*--------------------------------------------------------------*  79520001
795300* UPDATE RECORD ON TINVCTM TABLE                               *  79530001
795400*--------------------------------------------------------------*  79540001
795500 6300-UPDATE-TINVCTM.                                             79550001
795600                                                                  79560001
795700     PERFORM 6315-POPULATE-INVCTM-COLS                            79570001
795800                                                                  79580001
795900*WR5091 ADD 'AND TERM_SEQ_NBR = 1' TO WHERE                       79590001
796000     PERFORM                                                      79600001
796100         WITH TEST AFTER                                          79610001
796200         VARYING PV-RETRY-COUNTER                                 79620001
796300         FROM 1 BY 1                                              79630001
796400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               79640001
796500             OR (SQLCODE = +0))                                   79650001
796600                                                                  79660001
796700         EXEC SQL UPDATE TINVCTM                                  79670001
796800            SET TERM_TYP_CDE      = :INVCTM-TERM-TYP-CDE          79680001
796900               ,DISC_PCT          = :INVCTM-DISC-PCT              79690001
797000               ,NET_DUE_DAY_QTY   = :INVCTM-NET-DUE-DAY-QTY       79700001
797100               ,DISC_DUE_DAY_QTY  = :INVCTM-DISC-DUE-DAY-QTY      79710001
797200               ,EXTD_DAYS_QTY     = :INVCTM-EXTD-DAYS-QTY         79720001
797300          WHERE PO_NBR            = :ASC-KEY-PO-NBR               79730001
797400            AND INVC_ID           = :ASC-KEY-INVC-ID              79740001
797500            AND TERM_SEQ_NBR      = 1                             79750001
797600         END-EXEC                                                 79760001
797700                                                                  79770001
797800         EVALUATE TRUE                                            79780001
797900             WHEN SQLCODE = +0                                    79790001
798000             WHEN SQLCODE = -904                                  79800001
798100             WHEN SQLCODE = -913                                  79810001
798200                 CONTINUE                                         79820001
798300                                                                  79830001
798400             WHEN SQLWARN0 NOT = SPACES                           79840001
798500             WHEN SQLCODE < +0                                    79850001
798600             WHEN SQLCODE > +0                                    79860001
798700                 MOVE '6300-UPDATE-TINVCTM'                       79870001
798800                                   TO DP013-PARAGRAPH             79880001
798900                 MOVE 'UPDATE A ROW ON TINVCTM'                   79890001
799000                                   TO DP013-MESSAGE-TEXT(1)       79900001
799100                 MOVE SQLCA        TO DP013-SQLCA                 79910001
799200                 MOVE 'TINVCTM'    TO DP013-DB2-TABLE-NAME (1)    79920001
799300                 SET DP013-DB2-ABEND                              79930001
799400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           79940001
799500                 PERFORM DP013-0000-PROCESS-ABEND                 79950001
799600         END-EVALUATE                                             79960001
799700     END-PERFORM.                                                 79970001
799800                                                                  79980001
799900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        79990001
800000         MOVE '6300-UPDATE-TINVCTM' TO DP013-PARAGRAPH            80000001
800100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              80010001
800200                                   TO DP013-MESSAGE-TEXT (1)      80020001
800300         MOVE 'TO UPDATE A TINVCTM ROW'                           80030001
800400                                   TO DP013-MESSAGE-TEXT (2)      80040001
800500         MOVE SQLCA                TO DP013-SQLCA                 80050001
800600         MOVE 'TINVCTM'            TO DP013-DB2-TABLE-NAME (1)    80060001
800700         SET DP013-DB2-ABEND                                      80070001
800800             DP013-XCTL-DISPLAY-RESTART                           80080001
800900                                   TO TRUE                        80090001
801000         PERFORM DP013-0000-PROCESS-ABEND                         80100001
801100     END-IF.                                                      80110001
801200                                                                  80120001
801300*--------------------------------------------------------------*  80130001
801400* INSERT RECORD INTO TINVCTM TABLE                             *  80140001
801500*--------------------------------------------------------------*  80150001
801600 6310-INSERT-TINVCTM.                                             80160001
801700                                                                  80170001
801800     PERFORM 6315-POPULATE-INVCTM-COLS                            80180001
801900                                                                  80190001
802000     MOVE 1                       TO INVCTM-TERM-SEQ-NBR.         80200001
802100     MOVE '03'                    TO INVCTM-TERM-BASIS-DTE-CDE.   80210001
802200     MOVE '9999-09-09'            TO INVCTM-EFF-DTE.              80220001
802300     MOVE +0                      TO INVCTM-DISC-AMT.             80230001
802400     MOVE '9999-09-09'            TO INVCTM-DISC-DUE-DTE.         80240001
802500     MOVE '9999-09-09'            TO INVCTM-NET-DUE-DTE.          80250001
802600                                                                  80260001
802700*WR5091 ADD LOGIC TO SET ASC-TINVCTM TO 'Y'                       80270001
802800     PERFORM                                                      80280001
802900         WITH TEST AFTER                                          80290001
803000         VARYING PV-RETRY-COUNTER                                 80300001
803100         FROM 1 BY 1                                              80310001
803200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               80320001
803300             OR (SQLCODE = +0))                                   80330001
803400                                                                  80340001
803500         EXEC SQL                                                 80350001
803600              INSERT INTO TINVCTM                                 80360001
803700                     ( PO_NBR                                     80370001
803800                      ,INVC_ID                                    80380001
803900                      ,TERM_SEQ_NBR                               80390001
804000                      ,TERM_TYP_CDE                               80400001
804100                      ,TERM_BASIS_DTE_CDE                         80410001
804200                      ,EFF_DTE                                    80420001
804300                      ,DISC_PCT                                   80430001
804400                      ,DISC_AMT                                   80440001
804500                      ,DISC_DUE_DTE                               80450001
804600                      ,DISC_DUE_DAY_QTY                           80460001
804700                      ,NET_DUE_DTE                                80470001
804800                      ,NET_DUE_DAY_QTY                            80480001
804900                      ,EXTD_DAYS_QTY )                            80490001
805000              VALUES ( :INVCTM-PO-NBR                             80500001
805100                      ,:INVCTM-INVC-ID                            80510001
805200                      ,:INVCTM-TERM-SEQ-NBR                       80520001
805300                      ,:INVCTM-TERM-TYP-CDE                       80530001
805400                      ,:INVCTM-TERM-BASIS-DTE-CDE                 80540001
805500                      ,:INVCTM-EFF-DTE                            80550001
805600                      ,:INVCTM-DISC-PCT                           80560001
805700                      ,:INVCTM-DISC-AMT                           80570001
805800                      ,:INVCTM-DISC-DUE-DTE                       80580001
805900                      ,:INVCTM-DISC-DUE-DAY-QTY                   80590001
806000                      ,:INVCTM-NET-DUE-DTE                        80600001
806100                      ,:INVCTM-NET-DUE-DAY-QTY                    80610001
806200                      ,:INVCTM-EXTD-DAYS-QTY )                    80620001
806300         END-EXEC                                                 80630001
806400                                                                  80640001
806500         EVALUATE TRUE                                            80650001
806600             WHEN SQLCODE = +0                                    80660001
806700                  MOVE 'Y'  TO ASC-TINVCTM-EXISTS-SW              80670001
806800                                                                  80680001
806900             WHEN SQLCODE = -904                                  80690001
807000             WHEN SQLCODE = -913                                  80700001
807100                  CONTINUE                                        80710001
807200                                                                  80720001
807300             WHEN SQLWARN0 NOT = SPACES                           80730001
807400             WHEN SQLCODE < +0                                    80740001
807500             WHEN SQLCODE > +0                                    80750001
807600                  MOVE '6310-INSERT-TINVCTM'                      80760001
807700                                  TO DP013-PARAGRAPH              80770001
807800                  MOVE 'UNSUCCESSFUL INSERT FOR TINVCTM'          80780001
807900                                  TO DP013-MESSAGE-TEXT (1)       80790001
808000                  MOVE SQLCA      TO DP013-SQLCA                  80800001
808100                  MOVE 'TINVCTM ' TO DP013-DB2-TABLE-NAME (1)     80810001
808200                  SET DP013-DB2-ABEND                             80820001
808300                      DP013-XCTL-DISPLAY-RESTART                  80830001
808400                                  TO TRUE                         80840001
808500                  PERFORM DP013-0000-PROCESS-ABEND                80850001
808600         END-EVALUATE                                             80860001
808700     END-PERFORM.                                                 80870001
808800                                                                  80880001
808900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        80890001
809000         MOVE '6310-INSERT-TINVCTM'                               80900001
809100                                  TO DP013-PARAGRAPH              80910001
809200         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TINVCTM'        80920001
809300                                  TO DP013-MESSAGE-TEXT (1)       80930001
809400         MOVE SQLCA               TO DP013-SQLCA                  80940001
809500         MOVE 'TINVCTM '          TO DP013-DB2-TABLE-NAME (1)     80950001
809600         SET DP013-DB2-ABEND                                      80960001
809700             DP013-XCTL-DISPLAY-RESTART                           80970001
809800                                  TO TRUE                         80980001
809900         PERFORM DP013-0000-PROCESS-ABEND                         80990001
810000     END-IF.                                                      81000001
810100                                                                  81010001
810200*--------------------------------------------------------------*  81020001
810300* POPULATE TINVCTM TABLE COLUMNS                               *  81030001
810400*--------------------------------------------------------------*  81040001
810500 6315-POPULATE-INVCTM-COLS.                                       81050001
810600                                                                  81060001
810700     INITIALIZE DCLTINVCTM                                        81070001
810800                                                                  81080001
810900     MOVE INVOIC-PO-NBR           TO INVCTM-PO-NBR.               81090001
811000     MOVE INVOIC-INVC-ID          TO INVCTM-INVC-ID.              81100001
811100                                                                  81110001
811200     IF ASC-NEW-IN-EOM = 'Y'                                      81120001
811300         MOVE '02'                TO INVCTM-TERM-TYP-CDE          81130001
811400     ELSE                                                         81140001
811500         MOVE '01'                TO INVCTM-TERM-TYP-CDE          81150001
811600     END-IF.                                                      81160001
811700                                                                  81170001
811800     COMPUTE INVCTM-DISC-PCT = ASC-NEW-IN-DISC-PCT-NUM / 100.     81180001
811900                                                                  81190001
812000     IF INVCTM-DISC-PCT = .0000                                   81200001
812100         MOVE +0                  TO INVCTM-DISC-DUE-DAY-QTY      81210001
812200         MOVE ASC-NEW-IN-DISC-DUE-DAY-QTY                         81220001
812300                                  TO INVCTM-NET-DUE-DAY-QTY       81230001
812400     ELSE                                                         81240001
812500         MOVE ASC-NEW-IN-DISC-DUE-DAY-QTY                         81250001
812600                                  TO INVCTM-DISC-DUE-DAY-QTY      81260001
812700         MOVE +30                 TO INVCTM-NET-DUE-DAY-QTY       81270001
812800     END-IF.                                                      81280001
812900                                                                  81290001
813000     MOVE ASC-NEW-IN-EXTD-DAYS-QTY TO INVCTM-EXTD-DAYS-QTY.       81300001
813100                                                                  81310001
813200*--------------------------------------------------------------*  81320001
813300* UPDATE RECORD ON TMDINVC TABLE                               *  81330001
813400*--------------------------------------------------------------*  81340001
813500 6400-UPDATE-TMDINVC.                                             81350001
813600                                                                  81360001
813700     COMPUTE MDINVC-KOHLS-FRGT-PCT =                              81370001
813800             ASC-NEW-KOHLS-FRGT-PCT-NUM / 100                     81380001
813900                                                                  81390001
814000     COMPUTE MDINVC-VEND-FRGT-PCT =                               81400001
814100             ASC-NEW-VEND-FRGT-PCT-NUM / 100                      81410001
814200                                                                  81420001
814300     MOVE ASC-NEW-TOT-INVC-PC-QTY TO MDINVC-TOT-INVC-PC-QTY       81430001
814400     MOVE ASC-NEW-TERM-SEL-CDE    TO MDINVC-TERM-SEL-CDE          81440001
814500     MOVE ASC-NEW-BOL-ID          TO MDINVC-BOL-ID                81450001
814600     MOVE ASC-NEW-IMPRT-CHRG-CDE  TO MDINVC-IMPRT-CHRG-PRC-CDE    81460001
814700                                                                  81470001
814800     PERFORM                                                      81480001
814900         WITH TEST AFTER                                          81490001
815000         VARYING PV-RETRY-COUNTER                                 81500001
815100         FROM 1 BY 1                                              81510001
815200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               81520001
815300             OR (SQLCODE = +0))                                   81530001
815400                                                                  81540001
815500         EXEC SQL UPDATE TMDINVC                                  81550001
815600             SET KOHLS_FRGT_PCT       = :MDINVC-KOHLS-FRGT-PCT    81560001
815700                ,VEND_FRGT_PCT        = :MDINVC-VEND-FRGT-PCT     81570001
815800                ,TERM_SEL_CDE         = :MDINVC-TERM-SEL-CDE      81580001
815900                ,BOL_ID               = :MDINVC-BOL-ID            81590001
816000                ,TOT_INVC_PC_QTY      = :MDINVC-TOT-INVC-PC-QTY   81600001
816100                ,IMPRT_CHRG_PRC_CDE   = :MDINVC-IMPRT-CHRG-PRC-CDE81610001
816200          WHERE PO_NBR                = :ASC-KEY-PO-NBR           81620001
816300            AND INVC_ID               = :ASC-KEY-INVC-ID          81630001
816400         END-EXEC                                                 81640001
816500                                                                  81650001
816600         EVALUATE TRUE                                            81660001
816700             WHEN SQLCODE = +0                                    81670001
816800             WHEN SQLCODE = -904                                  81680001
816900             WHEN SQLCODE = -913                                  81690001
817000                 CONTINUE                                         81700001
817100                                                                  81710001
817200             WHEN SQLWARN0 NOT = SPACES                           81720001
817300             WHEN SQLCODE < +0                                    81730001
817400             WHEN SQLCODE > +0                                    81740001
817500                 MOVE '6400-UPDATE-TMDINVC'                       81750001
817600                                   TO DP013-PARAGRAPH             81760001
817700                 MOVE 'UPDATE A ROW ON TMDINVC'                   81770001
817800                                   TO DP013-MESSAGE-TEXT(1)       81780001
817900                 MOVE SQLCA        TO DP013-SQLCA                 81790001
818000                 MOVE 'TMDINVC'    TO DP013-DB2-TABLE-NAME (1)    81800001
818100                 SET DP013-DB2-ABEND                              81810001
818200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           81820001
818300                 PERFORM DP013-0000-PROCESS-ABEND                 81830001
818400         END-EVALUATE                                             81840001
818500     END-PERFORM.                                                 81850001
818600                                                                  81860001
818700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        81870001
818800         MOVE '6400-UPDATE-TMDINVC' TO DP013-PARAGRAPH            81880001
818900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              81890001
819000                                   TO DP013-MESSAGE-TEXT (1)      81900001
819100         MOVE 'TO UPDATE A TMDINVC ROW'                           81910001
819200                                   TO DP013-MESSAGE-TEXT (2)      81920001
819300         MOVE SQLCA                TO DP013-SQLCA                 81930001
819400         MOVE 'TMDINVC'            TO DP013-DB2-TABLE-NAME (1)    81940001
819500         SET DP013-DB2-ABEND                                      81950001
819600             DP013-XCTL-DISPLAY-RESTART                           81960001
819700                                   TO TRUE                        81970001
819800         PERFORM DP013-0000-PROCESS-ABEND                         81980001
819900     END-IF.                                                      81990001
820000                                                                  82000001
820100*--------------------------------------------------------------*  82010001
820200* UPDATE RECORD ON TEXINVC TABLE                               *  82020001
820300*--------------------------------------------------------------*  82030001
820400 6450-UPDATE-TEXINVC.                                             82040001
820500                                                                  82050001
820600* THE BOL FIELD WILL CONTAIN IMPORT ENTRY NUMBER FOR EXPENSE INVC 82060001
820700                                                                  82070001
820800     SET PS-IMPRT-ENTR-NBR-NO     TO TRUE                         82080001
820900                                                                  82090001
821000     MOVE ASC-NEW-BOL-ID      TO EXINVC-IMPRT-BOL-ID              82100001
821100     MOVE ASC-NEW-CNTNR-ID    TO EXINVC-INVC-CONTNR-ID            82110001
821200     MOVE ASC-NEW-REF-NBR     TO EXINVC-IMPRT-BKR-REF-NBR         82120001
821300     MOVE ASC-NEW-ENT-NBR     TO EXINVC-IMPRT-ENTR-NBR            82130001
821400                                                                  82140001
821500     PERFORM                                                      82150001
821600         WITH TEST AFTER                                          82160001
821700         VARYING PV-RETRY-COUNTER                                 82170001
821800         FROM 1 BY 1                                              82180001
821900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               82190001
822000             OR (SQLCODE = +0))                                   82200001
822100                                                                  82210001
822200          EXEC SQL UPDATE TEXINVC                                 82220001
822300              SET IMPRT_ENTR_NBR     = :EXINVC-IMPRT-ENTR-NBR,    82230001
822400                  IMPRT_BOL_ID       = :EXINVC-IMPRT-BOL-ID,      82240001
822500                  INVC_CONTNR_ID     = :EXINVC-INVC-CONTNR-ID,    82250001
822600                  IMPRT_BKR_REF_NBR  = :EXINVC-IMPRT-BKR-REF-NBR  82260001
822700              WHERE PO_NBR           = :ASC-KEY-PO-NBR            82270001
822800                AND INVC_ID          = :ASC-KEY-INVC-ID           82280001
822900          END-EXEC                                                82290001
823000                                                                  82300001
823100         EVALUATE TRUE                                            82310001
823200             WHEN SQLCODE = +0                                    82320001
823300             WHEN SQLCODE = -904                                  82330001
823400             WHEN SQLCODE = -913                                  82340001
823500                 CONTINUE                                         82350001
823600                                                                  82360001
823700             WHEN SQLWARN0 NOT = SPACES                           82370001
823800             WHEN SQLCODE < +0                                    82380001
823900             WHEN SQLCODE > +0                                    82390001
824000                 MOVE '6450-UPDATE-TEXINVC'                       82400001
824100                                   TO DP013-PARAGRAPH             82410001
824200                 MOVE 'UPDATE A ROW ON TEXINVC'                   82420001
824300                                   TO DP013-MESSAGE-TEXT(1)       82430001
824400                 MOVE SQLCA        TO DP013-SQLCA                 82440001
824500                 MOVE 'TEXINVC'    TO DP013-DB2-TABLE-NAME (1)    82450001
824600                 SET DP013-DB2-ABEND                              82460001
824700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           82470001
824800                 PERFORM DP013-0000-PROCESS-ABEND                 82480001
824900         END-EVALUATE                                             82490001
825000     END-PERFORM.                                                 82500001
825100                                                                  82510001
825200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        82520001
825300         MOVE '6450-UPDATE-TEXINVC' TO DP013-PARAGRAPH            82530001
825400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              82540001
825500                                   TO DP013-MESSAGE-TEXT (1)      82550001
825600         MOVE 'TO UPDATE A TEXINVC ROW'                           82560001
825700                                   TO DP013-MESSAGE-TEXT (2)      82570001
825800         MOVE SQLCA                TO DP013-SQLCA                 82580001
825900         MOVE 'TEXINVC'            TO DP013-DB2-TABLE-NAME (1)    82590001
826000         SET DP013-DB2-ABEND                                      82600001
826100             DP013-XCTL-DISPLAY-RESTART                           82610001
826200                                   TO TRUE                        82620001
826300         PERFORM DP013-0000-PROCESS-ABEND                         82630001
826400     END-IF.                                                      82640001
826500                                                                  82650001
826600*--------------------------------------------------------------*  82660001
826700* DETERMINE THE CURRENT INVOICE STATUS                         *  82670001
826800*--------------------------------------------------------------*  82680001
826900 6500-SELECT-CURR-INVC-STATUS.                                    82690001
827000                                                                  82700001
827100     PERFORM                                                      82710001
827200         WITH TEST AFTER                                          82720001
827300         VARYING PV-RETRY-COUNTER                                 82730001
827400         FROM 1 BY 1                                              82740001
827500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               82750001
827600            OR (SQLCODE = +0)                                     82760001
827700            OR (SQLCODE = +100))                                  82770001
827800                                                                  82780001
827900         EXEC SQL                                                 82790001
828000           SELECT  STATUS_CDE                                     82800001
828100                 , INVC_TYP_CDE                                   82810001
828200                 , ENTR_MTHD_CDE                                  82820001
828300*PRB42514 START                                                   82830001
828400                 , AP_PRC_CDE                                     82840001
828500*PRB42514 END                                                     82850001
828600            INTO   :PV-INVOIC-STATUS-CDE                          82860001
828700                 , :PV-INVOIC-TYP-CDE                             82870001
828800                 , :PV-INVOIC-ENTR-MTHD-CDE                       82880001
828900*PRB42514 START                                                   82890001
829000                 , :PV-INVOIC-AP-PRC-CDE                          82900001
829100*PRB42514 END                                                     82910001
829200             FROM   TINVOIC                                       82920001
829300          WHERE PO_NBR           = :ASC-KEY-PO-NBR                82930001
829400            AND INVC_ID          = :ASC-KEY-INVC-ID               82940001
829500         END-EXEC                                                 82950001
829600                                                                  82960001
829700         EVALUATE TRUE                                            82970001
829800             WHEN SQLCODE = +0                                    82980001
829900                 SET ASC-INVOICE-FOUND         TO TRUE            82990001
830000             WHEN SQLCODE = -904                                  83000001
830100             WHEN SQLCODE = -913                                  83010001
830200                 CONTINUE                                         83020001
830300             WHEN SQLCODE = +100                                  83030001
830400                 SET ASC-INVOICE-NOT-FOUND     TO TRUE            83040001
830500                                                                  83050001
830600             WHEN SQLWARN0 NOT = SPACES                           83060001
830700             WHEN SQLCODE < ZERO                                  83070001
830800             WHEN SQLCODE > ZERO                                  83080001
830900                 MOVE '6500-SELECT-CURRENT'                       83090001
831000                                   TO DP013-PARAGRAPH             83100001
831100                 MOVE 'SELECT ON TINVOIC        '                 83110001
831200                                   TO DP013-MESSAGE-TEXT (1)      83120001
831300                 MOVE SQLCA        TO DP013-SQLCA                 83130001
831400                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    83140001
831500                 MOVE '       '    TO DP013-DB2-TABLE-NAME (2)    83150001
831600                 SET DP013-DB2-ABEND                              83160001
831700                     DP013-XCTL-DISPLAY-RESTART                   83170001
831800                                   TO TRUE                        83180001
831900                 PERFORM DP013-0000-PROCESS-ABEND                 83190001
832000         END-EVALUATE                                             83200001
832100     END-PERFORM.                                                 83210001
832200                                                                  83220001
832300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        83230001
832400         MOVE '6500-SELECT-CURRENT'                               83240001
832500                                   TO DP013-PARAGRAPH             83250001
832600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     83260001
832700                                   TO DP013-MESSAGE-TEXT (1)      83270001
832800         MOVE SQLCA                TO DP013-SQLCA                 83280001
832900         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    83290001
833000         MOVE '       '            TO DP013-DB2-TABLE-NAME (2)    83300001
833100         SET DP013-DB2-ABEND                                      83310001
833200             DP013-XCTL-DISPLAY-RESTART                           83320001
833300                                   TO TRUE                        83330001
833400         PERFORM DP013-0000-PROCESS-ABEND                         83340001
833500     END-IF.                                                      83350001
833600                                                                  83360001
833700*--------------------------------------------------------------*  83370001
833800* DETERMINE THE PO TYPE CODE                                   *  83380001
833900*--------------------------------------------------------------*  83390001
834000 6510-SELECT-PO-TYP-CDE.                                          83400001
834100                                                                  83410001
834200     PERFORM                                                      83420001
834300         WITH TEST AFTER                                          83430001
834400         VARYING PV-RETRY-COUNTER                                 83440001
834500         FROM 1 BY 1                                              83450001
834600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               83460001
834700            OR (SQLCODE = +0)                                     83470001
834800            OR (SQLCODE = +100))                                  83480001
834900                                                                  83490001
835000         EXEC SQL                                                 83500001
835100           SELECT  PO_TYP_CDE                                     83510001
835200             INTO :PV-PURCHS-PO-TYP-CDE                           83520001
835300             FROM  TPURCHS                                        83530001
835400            WHERE PO_NBR         = :ASC-KEY-PO-NBR                83540001
835500              AND PO_CATEG_CDE   = 'MR'                           83550001
835600              AND VER_STATUS_CDE = 'A'                            83560001
835700         END-EXEC                                                 83570001
835800                                                                  83580001
835900         EVALUATE TRUE                                            83590001
836000             WHEN SQLCODE = +0                                    83600001
836100             WHEN SQLCODE = -904                                  83610001
836200             WHEN SQLCODE = -913                                  83620001
836300                 CONTINUE                                         83630001
836400             WHEN SQLCODE = +100                                  83640001
836500             WHEN SQLWARN0 NOT = SPACES                           83650001
836600             WHEN SQLCODE < ZERO                                  83660001
836700             WHEN SQLCODE > ZERO                                  83670001
836800                 MOVE '6510-SELECT-PO-TYP-CDE'                    83680001
836900                                   TO DP013-PARAGRAPH             83690001
837000                 MOVE 'SELECT ON TPURCHS        '                 83700001
837100                                   TO DP013-MESSAGE-TEXT (1)      83710001
837200                 MOVE SQLCA        TO DP013-SQLCA                 83720001
837300                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    83730001
837400                 MOVE '       '    TO DP013-DB2-TABLE-NAME (2)    83740001
837500                 SET DP013-DB2-ABEND                              83750001
837600                     DP013-XCTL-DISPLAY-RESTART                   83760001
837700                                   TO TRUE                        83770001
837800                 PERFORM DP013-0000-PROCESS-ABEND                 83780001
837900         END-EVALUATE                                             83790001
838000     END-PERFORM.                                                 83800001
838100                                                                  83810001
838200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        83820001
838300         MOVE '6510-SELECT-PO-TYP-CDE'                            83830001
838400                                   TO DP013-PARAGRAPH             83840001
838500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     83850001
838600                                   TO DP013-MESSAGE-TEXT (1)      83860001
838700         MOVE SQLCA                TO DP013-SQLCA                 83870001
838800         MOVE 'TPURCHS'            TO DP013-DB2-TABLE-NAME (1)    83880001
838900         MOVE '       '            TO DP013-DB2-TABLE-NAME (2)    83890001
839000         SET DP013-DB2-ABEND                                      83900001
839100             DP013-XCTL-DISPLAY-RESTART                           83910001
839200                                   TO TRUE                        83920001
839300         PERFORM DP013-0000-PROCESS-ABEND                         83930001
839400     END-IF.                                                      83940001
839500                                                                  83950001
839600*--------------------------------------------------------------*  83960001
839700* UPDATE RECORD ON TINVOIC TABLE                               *  83970001
839800*--------------------------------------------------------------*  83980001
839900 7000-DELETE-PROCESS.                                             83990001
840000                                                                  84000001
840100     PERFORM                                                      84010001
840200         WITH TEST AFTER                                          84020001
840300         VARYING PV-RETRY-COUNTER                                 84030001
840400         FROM 1 BY 1                                              84040001
840500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               84050001
840600             OR (SQLCODE = +0))                                   84060001
840700                                                                  84070001
840800         EXEC SQL UPDATE TINVOIC                                  84080001
840900             SET STATUS_CDE       = 'DE'                          84090001
841000               , STATUS_CHG_TMST  = CURRENT TIMESTAMP             84100001
841100           WHERE PO_NBR           = :ASC-KEY-PO-NBR               84110001
841200             AND INVC_ID          = :ASC-KEY-INVC-ID              84120001
841300         END-EXEC                                                 84130001
841400                                                                  84140001
841500         EVALUATE TRUE                                            84150001
841600             WHEN SQLCODE = +0                                    84160001
841700             WHEN SQLCODE = -904                                  84170001
841800             WHEN SQLCODE = -913                                  84180001
841900                 CONTINUE                                         84190001
842000                                                                  84200001
842100             WHEN SQLWARN0 NOT = SPACES                           84210001
842200             WHEN SQLCODE < +0                                    84220001
842300             WHEN SQLCODE > +0                                    84230001
842400                 MOVE '7000-DELETE-PROCESS'                       84240001
842500                                   TO DP013-PARAGRAPH             84250001
842600                 MOVE 'UPDATE A ROW ON TINVOIC'                   84260001
842700                                   TO DP013-MESSAGE-TEXT(1)       84270001
842800                 MOVE SQLCA        TO DP013-SQLCA                 84280001
842900                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    84290001
843000                 SET DP013-DB2-ABEND                              84300001
843100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           84310001
843200                 PERFORM DP013-0000-PROCESS-ABEND                 84320001
843300         END-EVALUATE                                             84330001
843400     END-PERFORM.                                                 84340001
843500                                                                  84350001
843600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        84360001
843700         MOVE '7000-DELETE-PROCESS' TO DP013-PARAGRAPH            84370001
843800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              84380001
843900                                   TO DP013-MESSAGE-TEXT (1)      84390001
844000         MOVE 'TO UPDATE A TINVOIC ROW'                           84400001
844100                                   TO DP013-MESSAGE-TEXT (2)      84410001
844200         MOVE SQLCA                TO DP013-SQLCA                 84420001
844300         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    84430001
844400         SET DP013-DB2-ABEND                                      84440001
844500             DP013-XCTL-DISPLAY-RESTART                           84450001
844600                                   TO TRUE                        84460001
844700         PERFORM DP013-0000-PROCESS-ABEND                         84470001
844800     END-IF.                                                      84480001
844900                                                                  84490001
845000     MOVE 'DE' TO ASC-KEY-INVC-STATUS                             84500001
845100                  ASC-NEW-INVC-STATUS                             84510001
845200     SET ASC-DELETE-SUCCESSFUL TO TRUE                            84520001
845300                                                                  84530001
845400     MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER              84540001
845500     SET DP020-MSG-INFORMATIONAL TO TRUE.                         84550001
845600                                                                  84560001
845700     IF ASC-USE-SELECTION-QUEUE                                   84570001
845800       AND ASC-NUMBER-OF-SELECTED-ITEMS GREATER THAN ZERO         84580001
845900         PERFORM 5200-UPDATE-SELECTION-QUEUE                      84590001
846000     END-IF.                                                      84600001
846100                                                                  84610001
846200     EXEC CICS                                                    84620001
846300         SYNCPOINT                                                84630001
846400     END-EXEC.                                                    84640001
846500                                                                  84650001
846600*--------------------------------------------------------------*  84660001
846700* DELETE RECORD FROM TINVCTM TABLE                             *  84670001
846800*--------------------------------------------------------------*  84680001
846900 7100-DELETE-TINVCTM.                                             84690001
847000                                                                  84700001
847100*WR5091 ADD LOGIC TO SET ASC-TINVCTM TO 'N'                       84710001
847200     PERFORM                                                      84720001
847300         WITH TEST AFTER                                          84730001
847400         VARYING PV-RETRY-COUNTER                                 84740001
847500         FROM 1 BY 1                                              84750001
847600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               84760001
847700             OR (SQLCODE = +0))                                   84770001
847800                                                                  84780001
847900         EXEC SQL DELETE FROM TINVCTM                             84790001
848000           WHERE PO_NBR     = :ASC-KEY-PO-NBR                     84800001
848100             AND INVC_ID    = :ASC-KEY-INVC-ID                    84810001
848200         END-EXEC                                                 84820001
848300                                                                  84830001
848400         EVALUATE TRUE                                            84840001
848500             WHEN SQLCODE = +0                                    84850001
848600                  MOVE 'N'  TO ASC-TINVCTM-EXISTS-SW              84860001
848700                                                                  84870001
848800             WHEN SQLCODE = -904                                  84880001
848900             WHEN SQLCODE = -913                                  84890001
849000                 CONTINUE                                         84900001
849100                                                                  84910001
849200             WHEN SQLWARN0 NOT = SPACES                           84920001
849300             WHEN SQLCODE < +0                                    84930001
849400             WHEN SQLCODE > +0                                    84940001
849500                 MOVE '7100-DELETE-TINVCTM'                       84950001
849600                                   TO DP013-PARAGRAPH             84960001
849700                 MOVE 'DELETE A ROW ON TINVOIC'                   84970001
849800                                   TO DP013-MESSAGE-TEXT(1)       84980001
849900                 MOVE SQLCA        TO DP013-SQLCA                 84990001
850000                 MOVE 'TINVCTM'    TO DP013-DB2-TABLE-NAME (1)    85000001
850100                 SET DP013-DB2-ABEND                              85010001
850200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           85020001
850300                 PERFORM DP013-0000-PROCESS-ABEND                 85030001
850400         END-EVALUATE                                             85040001
850500     END-PERFORM.                                                 85050001
850600                                                                  85060001
850700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        85070001
850800         MOVE '7100-DELETE-TINVCTM' TO DP013-PARAGRAPH            85080001
850900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              85090001
851000                                   TO DP013-MESSAGE-TEXT (1)      85100001
851100         MOVE 'TO DELETE A TINVCTM ROW'                           85110001
851200                                   TO DP013-MESSAGE-TEXT (2)      85120001
851300         MOVE SQLCA                TO DP013-SQLCA                 85130001
851400         MOVE 'TINVCTM'            TO DP013-DB2-TABLE-NAME (1)    85140001
851500         SET DP013-DB2-ABEND                                      85150001
851600             DP013-XCTL-DISPLAY-RESTART                           85160001
851700                                   TO TRUE                        85170001
851800         PERFORM DP013-0000-PROCESS-ABEND                         85180001
851900     END-IF.                                                      85190001
852000                                                                  85200001
852100*--------------------------------------------------------------*  85210001
852200* CONTROLS ADDING INVOICE TO TABLES                            *  85220001
852300*--------------------------------------------------------------*  85230001
852400 8000-ADD-INVOICE.                                                85240001
852500                                                                  85250001
852600     PERFORM 8300-INSERT-TINVOIC.                                 85260001
852700     IF ASC-EXPENSE-INVC                                          85270001
852800         PERFORM 8450-INSERT-TEXINVC                              85280001
852900     ELSE                                                         85290001
853000         PERFORM 8400-INSERT-TMDINVC                              85300001
853100*PRB0056264 START                                                 85310001
853200         PERFORM 8005-BUILD-ALLOWANCES                            85320001
853300*PRB0056264 END                                                   85330001
853400     END-IF.                                                      85340001
853500                                                                  85350001
853600     IF ASC-NEW-IN-SEL = 'S'                                      85360001
853700         PERFORM 6310-INSERT-TINVCTM                              85370001
853800     END-IF.                                                      85380001
853900*--------------------------------------------------------------*  85390001
854000*CONTROLS THE ALLOWANCE PERCENTAGES FOR EACH INVOICE              85400001
854100*--------------------------------------------------------------*  85410001
854200*PRB0056264 START                                                 85420001
854300 8005-BUILD-ALLOWANCES.                                           85430001
854400                                                                  85440001
854500     MOVE ZERO TO PV-ALW-CHRG-SEQ-NBR.                            85450001
854600                                                                  85460001
854700     IF ASC-POAGMT-DISC-PCT > .0000                               85470001
854800        ADD +1 TO PV-ALW-CHRG-SEQ-NBR                             85480001
854900        MOVE ASC-POAGMT-DISC-PCT     TO ALCHRG-ALW-CHRG-PCT       85490001
855000        IF ASC-NEW-STR-PO-IND = 'Y'                               85500001
855100            MOVE 'NSD'               TO ALCHRG-ALW-CHRG-CDE       85510001
855200        ELSE                                                      85520001
855300            MOVE 'TTD'               TO ALCHRG-ALW-CHRG-CDE       85530001
855400        END-IF                                                    85540001
855500        PERFORM 8600-INSERT-TALCHRG                               85550001
855600     END-IF.                                                      85560001
855700                                                                  85570001
855800     PERFORM 8010-OPEN-POAGMT-CSR.                                85580001
855900                                                                  85590001
856000     SET PS-TPOAGMT-MORE TO TRUE.                                 85600001
856100     PERFORM 8020-FETCH-POAGMT-CSR UNTIL PS-TPOAGMT-NO-MORE.      85610001
856200                                                                  85620001
856300     PERFORM 8030-CLOSE-POAGMT-CSR.                               85630001
856400                                                                  85640001
856500     SET PS-1ST-TALCHRG-PASS TO TRUE.                             85650001
856600*PRB0056264 END                                                   85660001
856700*----------------------------------------------------------------*85670001
856800* OPEN THE POAGMT_CSR CURSOR                                     *85680001
856900*----------------------------------------------------------------*85690001
857000 8010-OPEN-POAGMT-CSR.                                            85700001
857100                                                                  85710001
857200     EXEC SQL                                                     85720001
857300         OPEN POAGMT_CSR                                          85730001
857400     END-EXEC.                                                    85740001
857500                                                                  85750001
857600     EVALUATE TRUE                                                85760001
857700         WHEN SQLCODE = +0                                        85770001
857800             CONTINUE                                             85780001
857900         WHEN OTHER                                               85790001
858000             MOVE '8010-OPEN-POAGMT-CSR'                          85800001
858100                               TO DP013-PARAGRAPH                 85810001
858200             MOVE 'OPEN CURSOR'                                   85820001
858300                               TO DP013-MESSAGE-TEXT(1)           85830001
858400             MOVE SQLCA        TO DP013-SQLCA                     85840001
858500             MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (1)        85850001
858600             SET DP013-DB2-ABEND                                  85860001
858700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               85870001
858800             PERFORM DP013-0000-PROCESS-ABEND                     85880001
858900     END-EVALUATE.                                                85890001
859000                                                                  85900001
859100*----------------------------------------------------------------*85910001
859200* FETCH A ROW FROM THE POAGMT_CSR CURSOR                         *85920001
859300*----------------------------------------------------------------*85930001
859400 8020-FETCH-POAGMT-CSR.                                           85940001
859500                                                                  85950001
859600     MOVE ZERO TO PV-DISC-PCT.                                    85960001
859700                                                                  85970001
859800     EXEC SQL                                                     85980001
859900         FETCH POAGMT_CSR                                         85990001
860000         INTO :PV-TYP-CDE                                         86000001
860100             ,:PV-DISC-PCT                                        86010001
860200     END-EXEC.                                                    86020001
860300                                                                  86030001
860400     EVALUATE TRUE                                                86040001
860500         WHEN SQLCODE = +0                                        86050001
860600             SET PS-2ND-TALCHRG-PASS TO TRUE                      86060001
860700             EVALUATE TRUE                                        86070001
860800                WHEN PV-TYP-CDE = 7                               86080001
860900                   MOVE 'MOS' TO ALCHRG-ALW-CHRG-CDE              86090001
861000                WHEN PV-TYP-CDE = 8                               86100001
861100                   MOVE 'TRD' TO ALCHRG-ALW-CHRG-CDE              86110001
861200                WHEN PV-TYP-CDE = 9                               86120001
861300                   MOVE 'ADV' TO ALCHRG-ALW-CHRG-CDE              86130001
861400                WHEN PV-TYP-CDE = 10                              86140001
861500                   MOVE 'COP' TO ALCHRG-ALW-CHRG-CDE              86150001
861600                WHEN PV-TYP-CDE = 11                              86160001
861700                   MOVE 'ALW' TO ALCHRG-ALW-CHRG-CDE              86170001
861800             END-EVALUATE                                         86180001
861900             PERFORM 8600-INSERT-TALCHRG                          86190001
862000                                                                  86200001
862100         WHEN SQLCODE = +100                                      86210001
862200             SET PS-TPOAGMT-NO-MORE TO TRUE                       86220001
862300                                                                  86230001
862400         WHEN OTHER                                               86240001
862500             MOVE '8020-FETCH-POAGMT-CSR'                         86250001
862600                               TO DP013-PARAGRAPH                 86260001
862700             MOVE 'FETCH CURSOR'                                  86270001
862800                               TO DP013-MESSAGE-TEXT(1)           86280001
862900             MOVE SQLCA        TO DP013-SQLCA                     86290001
863000             MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (1)        86300001
863100             SET DP013-DB2-ABEND                                  86310001
863200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               86320001
863300             PERFORM DP013-0000-PROCESS-ABEND                     86330001
863400     END-EVALUATE.                                                86340001
863500                                                                  86350001
863600*----------------------------------------------------------------*86360001
863700* CLOSE THE POAGMT_CSR CURSOR.                                   *86370001
863800*----------------------------------------------------------------*86380001
863900 8030-CLOSE-POAGMT-CSR.                                           86390001
864000                                                                  86400001
864100     EXEC SQL                                                     86410001
864200        CLOSE POAGMT_CSR                                          86420001
864300     END-EXEC.                                                    86430001
864400                                                                  86440001
864500     EVALUATE TRUE                                                86450001
864600         WHEN SQLCODE = +0                                        86460001
864700             CONTINUE                                             86470001
864800         WHEN OTHER                                               86480001
864900             MOVE '8030-CLOSE-POAGMT-CSR'                         86490001
865000                               TO DP013-PARAGRAPH                 86500001
865100             MOVE 'CLOSE CURSOR'                                  86510001
865200                               TO DP013-MESSAGE-TEXT(1)           86520001
865300             MOVE SQLCA        TO DP013-SQLCA                     86530001
865400             MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (1)        86540001
865500             SET DP013-DB2-ABEND                                  86550001
865600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               86560001
865700             PERFORM DP013-0000-PROCESS-ABEND                     86570001
865800     END-EVALUATE.                                                86580001
865900                                                                  86590001
866000*----------------------------------------------------------------*86600001
866100* INSERTS RECORD INTO TINVOIC TABLE                              *86610001
866200*----------------------------------------------------------------*86620001
866300 8300-INSERT-TINVOIC.                                             86630001
866400                                                                  86640001
866500     MOVE ASC-NEW-PO-NBR          TO INVOIC-PO-NBR.               86650001
866600     MOVE ASC-NEW-INVC-ID         TO INVOIC-INVC-ID.              86660001
866700     MOVE ASC-KEY-INVC-TYP-CDE    TO INVOIC-INVC-TYP-CDE.         86670001
866800     MOVE 'MN'                    TO INVOIC-ENTR-MTHD-CDE.        86680001
866900     MOVE DP020-USERID            TO INVOIC-CRE-BY-USR-ID.        86690001
867000     MOVE SPACES                  TO INVOIC-BAR-CDE.              86700001
867100     IF ASC-NEW-IN-SPLIT-TERMS-IND = SPACES                       86710001
867200         MOVE 'N'                 TO INVOIC-SPLIT-TERMS-IND       86720001
867300     ELSE                                                         86730001
867400         MOVE ASC-NEW-IN-SPLIT-TERMS-IND                          86740001
867500                                  TO INVOIC-SPLIT-TERMS-IND       86750001
867600     END-IF.                                                      86760001
867700                                                                  86770001
867800     MOVE PC-N-CODE               TO INVOIC-DTL-ENTR-IND.         86780001
867900     MOVE ASC-NEW-CARTON-CNT      TO INVOIC-INVC-CART-CT.         86790001
868000     IF ASC-IMPORT-PO                                             86800001
868100        MOVE 'N'                  TO INVOIC-PPD-RVRSL-IND         86810001
868200     ELSE                                                         86820001
868300        MOVE SPACE                TO INVOIC-PPD-RVRSL-IND         86830001
868400     END-IF.                                                      86840001
868500     MOVE ASC-NEW-INVC-DTE        TO INVOIC-INVC-DTE.             86850001
868600     MOVE ASC-NEW-GRO-COST-AMT    TO INVOIC-GRO-COST-AMT.         86860001
868700     MOVE ASC-NEW-NET-INVC-AMT    TO INVOIC-INVC-NET-COST-AMT.    86870001
868800     MOVE ASC-NEW-RMIT-VND-ID     TO INVOIC-RMIT-VND-ID.          86880001
868900     MOVE ASC-NEW-STR-NBR         TO INVOIC-STR-NBR               86890001
869000     MOVE ASC-NEW-HOLD-IND        TO INVOIC-HOLD-IND.             86900001
869100     MOVE SPACE                   TO INVOIC-DUE-DTE-SRC-CDE.      86910001
869200     MOVE '0001-01-01'            TO INVOIC-CALC-DUE-DTE.         86920001
869300     MOVE PC-NULL-DATE            TO INVOIC-PAYT-DTE.             86930001
869400     MOVE '9999-09-09'            TO INVOIC-AP-PRC-DTE.           86940001
869500     MOVE SPACE                   TO INVOIC-AP-PRC-CDE.           86950001
869600     MOVE PC-NULL-TIMESTAMP       TO INVOIC-PAYT-RLSE-TMST.       86960001
869700     MOVE ASC-NEW-DC-NBR          TO INVOIC-DC-NBR.               86970001
869800     MOVE ASC-MTCH-LVL-CDE        TO INVOIC-MTCH-LVL-CDE.         86980001
869900                                                                  86990001
870000*** WHEN INSERTING AN INVOICE THERE ARE NO CHARGES YET, SO        87000001
870100*** THE CHARGE AMOUNT IS NOT CONSIDERED WHEN DETERMINING AN       87010001
870200*** OUT OF BALANCE CONDITION.                                     87020001
870300     IF ASC-NEW-NET-INVC-AMT NOT = ASC-NEW-GRO-COST-AMT           87030001
870400* WAS A CHECK FOR NET > GROSS, AND FLAG THE INVC 'OUT OF BAL'     87040001
870500* CHANGED TO NOT =                                                87050001
870600         MOVE 'OB'                TO INVOIC-STATUS-CDE            87060001
870700                                     ASC-KEY-INVC-STATUS          87070001
870800                                     ASC-NEW-INVC-STATUS          87080001
870900     ELSE                                                         87090001
871000         MOVE 'EN'                TO INVOIC-STATUS-CDE            87100001
871100                                     ASC-KEY-INVC-STATUS          87110001
871200                                     ASC-NEW-INVC-STATUS          87120001
871300     END-IF.                                                      87130001
871400     MOVE ASC-CURRENT-TIMESTAMP   TO INVOIC-STATUS-CHG-TMST.      87140001
871500                                                                  87150001
871600     PERFORM                                                      87160001
871700         WITH TEST AFTER                                          87170001
871800         VARYING PV-RETRY-COUNTER                                 87180001
871900         FROM 1 BY 1                                              87190001
872000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               87200001
872100             OR (SQLCODE = +0))                                   87210001
872200                                                                  87220001
872300         EXEC SQL                                                 87230001
872400              SET :PV-TIMESTAMP = CURRENT TIMESTAMP               87240001
872500         END-EXEC                                                 87250001
872600                                                                  87260001
872700         IF SQLCODE NOT = ZERO                                    87270001
872800            MOVE '8300-INSERT-TINVOIC' TO DP013-PARAGRAPH         87280001
872900            MOVE 'UNSUCCESSFUL SET CURRENT TIMESTAMP'             87290001
873000              TO DP013-MESSAGE-TEXT (1)                           87300001
873100            MOVE SQLCA                 TO DP013-SQLCA             87310001
873200            SET DP013-DB2-ABEND                                   87320001
873300                DP013-XCTL-DISPLAY-RESTART TO TRUE                87330001
873400                 PERFORM DP013-0000-PROCESS-ABEND                 87340001
873500         END-IF                                                   87350001
873600                                                                  87360001
873700         MOVE PV-NANOSEC-2       TO PV-RANDOM-KEY-NANOSEC-1       87370001
873800         MOVE PV-NANOSEC-1       TO PV-RANDOM-KEY-NANOSEC-2       87380001
873900         MOVE PV-MINUTE          TO PV-RANDOM-KEY-MINUTE          87390001
874000         MOVE PV-SECOND          TO PV-RANDOM-KEY-SECOND          87400001
874100         MOVE PV-RANDOM-KEY      TO PV-RANDOM-KEY-INT             87410001
874200         MOVE PV-RANDOM-KEY-INT  TO INVOIC-PAYT-REQ-SEQ-NBR       87420001
874300                                                                  87430001
874400                                                                  87440001
874500         EXEC SQL                                                 87450001
874600              INSERT INTO TINVOIC                                 87460001
874700                     ( PO_NBR                                     87470001
874800                      ,INVC_ID                                    87480001
874900                      ,PAYT_REQ_SEQ_NBR                           87490001
875000                      ,INVC_TYP_CDE                               87500001
875100                      ,ENTR_MTHD_CDE                              87510001
875200                      ,CRE_BY_USR_ID                              87520001
875300                      ,BAR_CDE                                    87530001
875400                      ,SPLIT_TERMS_IND                            87540001
875500                      ,DTL_ENTR_IND                               87550001
875600                      ,INVC_CART_CT                               87560001
875700                      ,CRE_DTE                                    87570001
875800                      ,PPD_RVRSL_IND                              87580001
875900                      ,INVC_DTE                                   87590001
876000                      ,GRO_COST_AMT                               87600001
876100                      ,INVC_NET_COST_AMT                          87610001
876200                      ,RMIT_VND_ID                                87620001
876300                      ,STR_NBR                                    87630001
876400                      ,HOLD_IND                                   87640001
876500                      ,DUE_DTE_SRC_CDE                            87650001
876600                      ,CALC_DUE_DTE                               87660001
876700                      ,PAYT_DTE                                   87670001
876800                      ,AP_PRC_DTE                                 87680001
876900                      ,AP_PRC_CDE                                 87690001
877000                      ,PAYT_RLSE_TMST                             87700001
877100                      ,STATUS_CDE                                 87710001
877200                      ,STATUS_CHG_TMST                            87720001
877300                      ,DC_NBR                                     87730001
877400                      ,MTCH_LVL_CDE )                             87740001
877500              VALUES ( :INVOIC-PO-NBR                             87750001
877600                      ,:INVOIC-INVC-ID                            87760001
877700                      ,:INVOIC-PAYT-REQ-SEQ-NBR                   87770001
877800                      ,:INVOIC-INVC-TYP-CDE                       87780001
877900                      ,:INVOIC-ENTR-MTHD-CDE                      87790001
878000                      ,:INVOIC-CRE-BY-USR-ID                      87800001
878100                      ,:INVOIC-BAR-CDE                            87810001
878200                      ,:INVOIC-SPLIT-TERMS-IND                    87820001
878300                      ,:INVOIC-DTL-ENTR-IND                       87830001
878400                      ,:INVOIC-INVC-CART-CT                       87840001
878500                      ,CURRENT DATE                               87850001
878600                      ,:INVOIC-PPD-RVRSL-IND                      87860001
878700                      ,:INVOIC-INVC-DTE                           87870001
878800                      ,:INVOIC-GRO-COST-AMT                       87880001
878900                      ,:INVOIC-INVC-NET-COST-AMT                  87890001
879000                      ,:INVOIC-RMIT-VND-ID                        87900001
879100                      ,:INVOIC-STR-NBR                            87910001
879200                      ,:INVOIC-HOLD-IND                           87920001
879300                      ,:INVOIC-DUE-DTE-SRC-CDE                    87930001
879400                      ,:INVOIC-CALC-DUE-DTE                       87940001
879500                      ,:INVOIC-PAYT-DTE                           87950001
879600                      ,:INVOIC-AP-PRC-DTE                         87960001
879700                      ,:INVOIC-AP-PRC-CDE                         87970001
879800                      ,:INVOIC-PAYT-RLSE-TMST                     87980001
879900                      ,:INVOIC-STATUS-CDE                         87990001
880000                      ,CURRENT TIMESTAMP                          88000001
880100                      ,:INVOIC-DC-NBR                             88010001
880200                      ,:INVOIC-MTCH-LVL-CDE )                     88020001
880300         END-EXEC                                                 88030001
880400                                                                  88040001
880500         EVALUATE TRUE                                            88050001
880600             WHEN SQLCODE = +0                                    88060001
880700             WHEN SQLCODE = -803                                  88070001
880800             WHEN SQLCODE = -904                                  88080001
880900             WHEN SQLCODE = -913                                  88090001
881000                  CONTINUE                                        88100001
881100                                                                  88110001
881200             WHEN SQLWARN0 NOT = SPACES                           88120001
881300             WHEN SQLCODE < +0                                    88130001
881400             WHEN SQLCODE > +0                                    88140001
881500                  MOVE '8300-INSERT-TINVOIC'                      88150001
881600                                  TO DP013-PARAGRAPH              88160001
881700                  MOVE 'UNSUCCESSFUL INSERT FOR TINVOIC'          88170001
881800                                  TO DP013-MESSAGE-TEXT (1)       88180001
881900                  MOVE SQLCA      TO DP013-SQLCA                  88190001
882000                  MOVE 'TINVOIC ' TO DP013-DB2-TABLE-NAME (1)     88200001
882100                  SET DP013-DB2-ABEND                             88210001
882200                      DP013-XCTL-DISPLAY-RESTART                  88220001
882300                                  TO TRUE                         88230001
882400                  PERFORM DP013-0000-PROCESS-ABEND                88240001
882500         END-EVALUATE                                             88250001
882600     END-PERFORM.                                                 88260001
882700                                                                  88270001
882800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        88280001
882900         MOVE '8300-INSERT-TINVOIC'                               88290001
883000                                  TO DP013-PARAGRAPH              88300001
883100         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TINVOIC'        88310001
883200                                  TO DP013-MESSAGE-TEXT (1)       88320001
883300         MOVE SQLCA               TO DP013-SQLCA                  88330001
883400         MOVE 'TINVOIC '          TO DP013-DB2-TABLE-NAME (1)     88340001
883500         SET DP013-DB2-ABEND                                      88350001
883600             DP013-XCTL-DISPLAY-RESTART                           88360001
883700                                  TO TRUE                         88370001
883800         PERFORM DP013-0000-PROCESS-ABEND                         88380001
883900     END-IF.                                                      88390001
884000                                                                  88400001
884100                                                                  88410001
884200*----------------------------------------------------------------*88420001
884300* INSERTS RECORD INTO TMDINVC TABLE                              *88430001
884400*----------------------------------------------------------------*88440001
884500 8400-INSERT-TMDINVC.                                             88450001
884600                                                                  88460001
884700     MOVE ASC-NEW-PO-NBR          TO MDINVC-PO-NBR.               88470001
884800     MOVE ASC-NEW-INVC-ID         TO MDINVC-INVC-ID.              88480001
884900     MOVE ASC-NEW-BOL-ID          TO MDINVC-BOL-ID.               88490001
885000                                                                  88500001
885100     COMPUTE MDINVC-VEND-FRGT-PCT =                               88510001
885200         ASC-NEW-VEND-FRGT-PCT-NUM / 100.                         88520001
885300     COMPUTE MDINVC-KOHLS-FRGT-PCT =                              88530001
885400         ASC-NEW-KOHLS-FRGT-PCT-NUM / 100.                        88540001
885500                                                                  88550001
885600     IF ASC-NEW-PO-SEL = 'S'                                      88560001
885700         MOVE 'P'                 TO MDINVC-TERM-SEL-CDE          88570001
885800     ELSE                                                         88580001
885900         MOVE 'I'                 TO MDINVC-TERM-SEL-CDE          88590001
886000     END-IF.                                                      88600001
886100                                                                  88610001
886200     MOVE ASC-NEW-TOT-INVC-PC-QTY TO MDINVC-TOT-INVC-PC-QTY.      88620001
886300     MOVE ASC-NEW-IMPRT-CHRG-CDE  TO MDINVC-IMPRT-CHRG-PRC-CDE.   88630001
886400     MOVE INVOIC-PAYT-REQ-SEQ-NBR TO MDINVC-PAYT-REQ-SEQ-NBR.     88640001
886500                                                                  88650001
886600     PERFORM                                                      88660001
886700         WITH TEST AFTER                                          88670001
886800         VARYING PV-RETRY-COUNTER                                 88680001
886900         FROM 1 BY 1                                              88690001
887000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               88700001
887100             OR (SQLCODE = +0))                                   88710001
887200                                                                  88720001
887300         EXEC SQL                                                 88730001
887400              INSERT INTO TMDINVC                                 88740001
887500                     ( PO_NBR                                     88750001
887600                      ,INVC_ID                                    88760001
887700                      ,BOL_ID                                     88770001
887800                      ,VEND_FRGT_PCT                              88780001
887900                      ,KOHLS_FRGT_PCT                             88790001
888000                      ,TERM_SEL_CDE                               88800001
888100                      ,TOT_INVC_PC_QTY                            88810001
888200                      ,IMPRT_CHRG_PRC_CDE                         88820001
888300                      ,PAYT_REQ_SEQ_NBR )                         88830001
888400              VALUES ( :MDINVC-PO-NBR                             88840001
888500                      ,:MDINVC-INVC-ID                            88850001
888600                      ,:MDINVC-BOL-ID                             88860001
888700                      ,:MDINVC-VEND-FRGT-PCT                      88870001
888800                      ,:MDINVC-KOHLS-FRGT-PCT                     88880001
888900                      ,:MDINVC-TERM-SEL-CDE                       88890001
889000                      ,:MDINVC-TOT-INVC-PC-QTY                    88900001
889100                      ,:MDINVC-IMPRT-CHRG-PRC-CDE                 88910001
889200                      ,:MDINVC-PAYT-REQ-SEQ-NBR )                 88920001
889300         END-EXEC                                                 88930001
889400                                                                  88940001
889500         EVALUATE TRUE                                            88950001
889600             WHEN SQLCODE = +0                                    88960001
889700             WHEN SQLCODE = -904                                  88970001
889800             WHEN SQLCODE = -913                                  88980001
889900                  CONTINUE                                        88990001
890000                                                                  89000001
890100             WHEN SQLWARN0 NOT = SPACES                           89010001
890200             WHEN SQLCODE < +0                                    89020001
890300             WHEN SQLCODE > +0                                    89030001
890400                  MOVE '8400-INSERT-TMDINVC'                      89040001
890500                                  TO DP013-PARAGRAPH              89050001
890600                  MOVE 'UNSUCCESSFUL INSERT FOR TMDINVC'          89060001
890700                                  TO DP013-MESSAGE-TEXT (1)       89070001
890800                  MOVE SQLCA      TO DP013-SQLCA                  89080001
890900                  MOVE 'TMDINVC ' TO DP013-DB2-TABLE-NAME (1)     89090001
891000                  SET DP013-DB2-ABEND                             89100001
891100                      DP013-XCTL-DISPLAY-RESTART                  89110001
891200                                  TO TRUE                         89120001
891300                  PERFORM DP013-0000-PROCESS-ABEND                89130001
891400         END-EVALUATE                                             89140001
891500     END-PERFORM.                                                 89150001
891600                                                                  89160001
891700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        89170001
891800         MOVE '8400-INSERT-TMDINVC'                               89180001
891900                                  TO DP013-PARAGRAPH              89190001
892000         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TMDINVC'        89200001
892100                                  TO DP013-MESSAGE-TEXT (1)       89210001
892200         MOVE SQLCA               TO DP013-SQLCA                  89220001
892300         MOVE 'TMDINVC '          TO DP013-DB2-TABLE-NAME (1)     89230001
892400         SET DP013-DB2-ABEND                                      89240001
892500             DP013-XCTL-DISPLAY-RESTART                           89250001
892600                                  TO TRUE                         89260001
892700         PERFORM DP013-0000-PROCESS-ABEND                         89270001
892800     END-IF.                                                      89280001
892900                                                                  89290001
893000*----------------------------------------------------------------*89300001
893100* INSERTS RECORD INTO TEXINVC TABLE                              *89310001
893200*----------------------------------------------------------------*89320001
893300 8450-INSERT-TEXINVC.                                             89330001
893400                                                                  89340001
893500     MOVE ASC-NEW-PO-NBR          TO EXINVC-PO-NBR.               89350001
893600     MOVE ASC-NEW-INVC-ID         TO EXINVC-INVC-ID.              89360001
893700     MOVE SPACES                  TO EXINVC-INVC-CONTNR-ID.       89370001
893800     MOVE SPACES                  TO EXINVC-IMPRT-BKR-REF-NBR.    89380001
893900                                                                  89390001
894000* THE BOL FIELD WILL CONTAIN IMPORT ENTRY NUMBER FOR EXPENSE INVC 89400001
894100                                                                  89410001
894200     SET PS-IMPRT-ENTR-NBR-NO     TO TRUE.                        89420001
894300                                                                  89430001
894400     MOVE ASC-NEW-BOL-ID          TO EXINVC-IMPRT-BOL-ID          89440001
894500     MOVE EXINVC-IMPRT-BOL-ID     TO ASC-NEW-BOL-ID               89450001
894600     MOVE ASC-NEW-CNTNR-ID        TO EXINVC-INVC-CONTNR-ID.       89460001
894700     MOVE ASC-NEW-REF-NBR         TO EXINVC-IMPRT-BKR-REF-NBR.    89470001
894800     MOVE ASC-NEW-ENT-NBR         TO EXINVC-IMPRT-ENTR-NBR.       89480001
894900     MOVE INVOIC-PAYT-REQ-SEQ-NBR TO EXINVC-PAYT-REQ-SEQ-NBR.     89490001
895000                                                                  89500001
895100     PERFORM                                                      89510001
895200         WITH TEST AFTER                                          89520001
895300         VARYING PV-RETRY-COUNTER                                 89530001
895400         FROM 1 BY 1                                              89540001
895500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               89550001
895600             OR (SQLCODE = +0))                                   89560001
895700                                                                  89570001
895800         EXEC SQL                                                 89580001
895900             INSERT INTO TEXINVC                                  89590001
896000                    ( PO_NBR                                      89600001
896100                     ,INVC_ID                                     89610001
896200                     ,IMPRT_ENTR_NBR                              89620001
896300                     ,IMPRT_BOL_ID                                89630001
896400                     ,PAYT_REQ_SEQ_NBR                            89640001
896500                     ,INVC_CONTNR_ID                              89650001
896600                     ,IMPRT_BKR_REF_NBR )                         89660001
896700             VALUES ( :EXINVC-PO-NBR                              89670001
896800                     ,:EXINVC-INVC-ID                             89680001
896900                     ,:EXINVC-IMPRT-ENTR-NBR                      89690001
897000                     ,:EXINVC-IMPRT-BOL-ID                        89700001
897100                     ,:EXINVC-PAYT-REQ-SEQ-NBR                    89710001
897200                     ,:EXINVC-INVC-CONTNR-ID                      89720001
897300                     ,:EXINVC-IMPRT-BKR-REF-NBR )                 89730001
897400         END-EXEC                                                 89740001
897500                                                                  89750001
897600         EVALUATE TRUE                                            89760001
897700             WHEN SQLCODE = +0                                    89770001
897800             WHEN SQLCODE = -904                                  89780001
897900             WHEN SQLCODE = -913                                  89790001
898000                  CONTINUE                                        89800001
898100                                                                  89810001
898200             WHEN SQLWARN0 NOT = SPACES                           89820001
898300             WHEN SQLCODE < +0                                    89830001
898400             WHEN SQLCODE > +0                                    89840001
898500                  MOVE '8450-INSERT-TEXINVC'                      89850001
898600                                  TO DP013-PARAGRAPH              89860001
898700                  MOVE 'UNSUCCESSFUL INSERT FOR TEXINVC'          89870001
898800                                  TO DP013-MESSAGE-TEXT (1)       89880001
898900                  MOVE SQLCA      TO DP013-SQLCA                  89890001
899000                  MOVE 'TEXINVC ' TO DP013-DB2-TABLE-NAME (1)     89900001
899100                  SET DP013-DB2-ABEND                             89910001
899200                      DP013-XCTL-DISPLAY-RESTART                  89920001
899300                                  TO TRUE                         89930001
899400                  PERFORM DP013-0000-PROCESS-ABEND                89940001
899500         END-EVALUATE                                             89950001
899600     END-PERFORM.                                                 89960001
899700                                                                  89970001
899800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        89980001
899900         MOVE '8450-INSERT-TEXINVC'                               89990001
900000                                  TO DP013-PARAGRAPH              90000001
900100         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TEXINVC'        90010001
900200                                  TO DP013-MESSAGE-TEXT (1)       90020001
900300         MOVE SQLCA               TO DP013-SQLCA                  90030001
900400         MOVE 'TEXINVC '          TO DP013-DB2-TABLE-NAME (1)     90040001
900500         SET DP013-DB2-ABEND                                      90050001
900600             DP013-XCTL-DISPLAY-RESTART                           90060001
900700                                  TO TRUE                         90070001
900800         PERFORM DP013-0000-PROCESS-ABEND                         90080001
900900     END-IF.                                                      90090001
901000                                                                  90100001
901100*----------------------------------------------------------------*90110001
901200* INSERTS RECORD INTO TALCHRG TABLE                              *90120001
901300*----------------------------------------------------------------*90130001
901400 8600-INSERT-TALCHRG.                                             90140001
901500                                                                  90150001
901600     MOVE INVOIC-PO-NBR           TO ALCHRG-PO-NBR.               90160001
901700     MOVE INVOIC-INVC-ID          TO ALCHRG-INVC-ID.              90170001
901800     MOVE +1                      TO ALCHRG-ALW-CHRG-SEQ-NBR.     90180001
901900     MOVE 'A'                     TO ALCHRG-ALW-CHRG-TYP-CDE.     90190001
902000     IF PS-1ST-TALCHRG-PASS                                       90200001
902100        IF ASC-NEW-STR-PO-IND = 'Y'                               90210001
902200            MOVE 'NSD'               TO ALCHRG-ALW-CHRG-CDE       90220001
902300        ELSE                                                      90230001
902400            MOVE 'TTD'               TO ALCHRG-ALW-CHRG-CDE       90240001
902500        END-IF                                                    90250001
902600     END-IF.                                                      90260001
902700     MOVE SPACES                  TO ALCHRG-ALW-CHRG-SER-CDE.     90270001
902800     MOVE ASC-POAGMT-DISC-PCT     TO ALCHRG-ALW-CHRG-PCT          90280001
902900     MOVE +0                      TO ALCHRG-ALW-CHRG-AMT.         90290001
903000     IF PS-2ND-TALCHRG-PASS                                       90300001
903100        ADD +1 TO PV-ALW-CHRG-SEQ-NBR                             90310001
903200        MOVE PV-ALW-CHRG-SEQ-NBR TO ALCHRG-ALW-CHRG-SEQ-NBR       90320001
903300        MOVE PV-DISC-PCT TO ALCHRG-ALW-CHRG-PCT                   90330001
903400     END-IF.                                                      90340001
903500                                                                  90350001
903600     PERFORM                                                      90360001
903700         WITH TEST AFTER                                          90370001
903800         VARYING PV-RETRY-COUNTER                                 90380001
903900         FROM 1 BY 1                                              90390001
904000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               90400001
904100             OR (SQLCODE = +0))                                   90410001
904200                                                                  90420001
904300         EXEC SQL                                                 90430001
904400              INSERT INTO TALCHRG                                 90440001
904500                     ( PO_NBR                                     90450001
904600                      ,INVC_ID                                    90460001
904700                      ,ALW_CHRG_SEQ_NBR                           90470001
904800                      ,ALW_CHRG_TYP_CDE                           90480001
904900                      ,ALW_CHRG_CDE                               90490001
905000                      ,ALW_CHRG_SER_CDE                           90500001
905100                      ,ALW_CHRG_PCT                               90510001
905200                      ,ALW_CHRG_AMT )                             90520001
905300              VALUES ( :ALCHRG-PO-NBR                             90530001
905400                      ,:ALCHRG-INVC-ID                            90540001
905500                      ,:ALCHRG-ALW-CHRG-SEQ-NBR                   90550001
905600                      ,:ALCHRG-ALW-CHRG-TYP-CDE                   90560001
905700                      ,:ALCHRG-ALW-CHRG-CDE                       90570001
905800                      ,:ALCHRG-ALW-CHRG-SER-CDE                   90580001
905900                      ,:ALCHRG-ALW-CHRG-PCT                       90590001
906000                      ,:ALCHRG-ALW-CHRG-AMT )                     90600001
906100         END-EXEC                                                 90610001
906200                                                                  90620001
906300         EVALUATE TRUE                                            90630001
906400             WHEN SQLCODE = +0                                    90640001
906500             WHEN SQLCODE = -904                                  90650001
906600             WHEN SQLCODE = -913                                  90660001
906700                  CONTINUE                                        90670001
906800                                                                  90680001
906900             WHEN SQLWARN0 NOT = SPACES                           90690001
907000             WHEN SQLCODE < +0                                    90700001
907100             WHEN SQLCODE > +0                                    90710001
907200                  MOVE '8600-INSERT-TALCHRG'                      90720001
907300                                  TO DP013-PARAGRAPH              90730001
907400                  MOVE 'UNSUCCESSFUL INSERT FOR TALCHRG'          90740001
907500                                  TO DP013-MESSAGE-TEXT (1)       90750001
907600                  MOVE SQLCA      TO DP013-SQLCA                  90760001
907700                  MOVE 'TALCHRG ' TO DP013-DB2-TABLE-NAME (1)     90770001
907800                  SET DP013-DB2-ABEND                             90780001
907900                      DP013-XCTL-DISPLAY-RESTART                  90790001
908000                                  TO TRUE                         90800001
908100                  PERFORM DP013-0000-PROCESS-ABEND                90810001
908200         END-EVALUATE                                             90820001
908300     END-PERFORM.                                                 90830001
908400                                                                  90840001
908500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        90850001
908600         MOVE '8600-INSERT-TALCHRG'                               90860001
908700                                  TO DP013-PARAGRAPH              90870001
908800         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TALCHRG'        90880001
908900                                  TO DP013-MESSAGE-TEXT (1)       90890001
909000         MOVE SQLCA               TO DP013-SQLCA                  90900001
909100         MOVE 'TALCHRG '          TO DP013-DB2-TABLE-NAME (1)     90910001
909200         SET DP013-DB2-ABEND                                      90920001
909300             DP013-XCTL-DISPLAY-RESTART                           90930001
909400                                  TO TRUE                         90940001
909500         PERFORM DP013-0000-PROCESS-ABEND                         90950001
909600     END-IF.                                                      90960001
909700                                                                  90970001
909800*--------------------------------------------------------------*  90980001
909900* DETERMINE IF THE PO/MATCH LEVEL COMBINATION HAS ALREADY BEEN *  90990001
910000* PROCESSED.                                                   *  91000001
910100*--------------------------------------------------------------*  91010001
910200 8800-CHECK-IF-PROCESSED.                                         91020001
910300                                                                  91030001
910400     PERFORM                                                      91040001
910500         WITH TEST AFTER                                          91050001
910600         VARYING PV-RETRY-COUNTER                                 91060001
910700         FROM 1 BY 1                                              91070001
910800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               91080001
910900             OR (SQLCODE = +0))                                   91090001
911000                                                                  91100001
911100         EXEC SQL                                                 91110001
911200             SELECT COUNT(*)                                      91120001
911300               INTO :PV-DB2-COUNT                                 91130001
911400               FROM TPOSTRR A                                     91140001
911500              WHERE A.PO_NBR       = :ASC-NEW-PO-NBR              91150001
911600                AND A.MTCH_LVL_CDE = :ASC-MTCH-LVL-CDE            91160001
911700                AND A.STATUS_CDE   = ' '                          91170001
911800         END-EXEC                                                 91180001
911900                                                                  91190001
912000         EVALUATE TRUE                                            91200001
912100             WHEN SQLCODE = +0                                    91210001
912200             WHEN SQLCODE = -305                                  91220001
912300             WHEN SQLCODE = -904                                  91230001
912400             WHEN SQLCODE = -913                                  91240001
912500                  CONTINUE                                        91250001
912600                                                                  91260001
912700             WHEN SQLWARN0 NOT = SPACES                           91270001
912800             WHEN SQLCODE  NOT = ZERO                             91280001
912900                  MOVE '8800-CHECK-IF-PROCESSED'                  91290001
913000                                  TO DP013-PARAGRAPH              91300001
913100                  MOVE 'UNSUCCESSFUL SELECT COUNT'                91310001
913200                                  TO DP013-MESSAGE-TEXT (1)       91320001
913300                  MOVE SQLCA      TO DP013-SQLCA                  91330001
913400                  MOVE 'TPOSTRR ' TO DP013-DB2-TABLE-NAME (1)     91340001
913500                  SET DP013-DB2-ABEND                             91350001
913600                      DP013-XCTL-DISPLAY-RESTART                  91360001
913700                                  TO TRUE                         91370001
913800                  PERFORM DP013-0000-PROCESS-ABEND                91380001
913900         END-EVALUATE                                             91390001
914000     END-PERFORM.                                                 91400001
914100                                                                  91410001
914200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        91420001
914300         MOVE '8800-CHECK-IF-PROCESSED'                           91430001
914400                                  TO DP013-PARAGRAPH              91440001
914500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT COUNT'             91450001
914600                                  TO DP013-MESSAGE-TEXT (1)       91460001
914700         MOVE SQLCA               TO DP013-SQLCA                  91470001
914800         MOVE 'TPOSTRR '          TO DP013-DB2-TABLE-NAME (1)     91480001
914900         SET DP013-DB2-ABEND                                      91490001
915000             DP013-XCTL-DISPLAY-RESTART                           91500001
915100                                  TO TRUE                         91510001
915200         PERFORM DP013-0000-PROCESS-ABEND                         91520001
915300     END-IF.                                                      91530001
915400                                                                  91540001
915500     IF SQLCODE = ZERO AND PV-DB2-COUNT > ZERO                    91550001
915600         MOVE DP015-UNP-ALP-BRT-OFF                               91560001
915700                              TO APONUMA                          91570001
915800         MOVE DP015-RED       TO APONUMC                          91580001
915900         MOVE DP015-REVERSE   TO APONUMH                          91590001
916000         SET PS-ERROR         TO TRUE                             91600001
916100     END-IF.                                                      91610001
916200                                                                  91620001
916300*--------------------------------------------------------------*  91630001
916400* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.     *  91640001
916500*--------------------------------------------------------------*  91650001
916600 9100-READ-SEL-QUEUE.                                             91660001
916700                                                                  91670001
916800     EXEC CICS                                                    91680001
916900         READQ TS                                                 91690001
917000             QUEUE (ASC-SEL-QUEUE-NAME)                           91700001
917100             INTO  (AP301-INVC-LIST-TS-RCRD)                      91710001
917200             ITEM  (ASC-SEL-ITEM)                                 91720001
917300             RESP  (PV-CICS-RESPONSE)                             91730001
917400     END-EXEC.                                                    91740001
917500                                                                  91750001
917600     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   91760001
917700         CONTINUE                                                 91770001
917800     ELSE                                                         91780001
917900         SET DP013-LOGIC-ABEND                                    91790001
918000             DP013-NO-ROLLBACK     TO TRUE                        91800001
918100         MOVE '9100-READ-SEL-QUEUE'                               91810001
918200                                   TO DP013-PARAGRAPH             91820001
918300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   91830001
918400                                   TO DP013-MESSAGE-TEXT (1)      91840001
918500         PERFORM DP013-0000-PROCESS-ABEND                         91850001
918600     END-IF.                                                      91860001
918700                                                                  91870001
918800*--------------------------------------------------------------*  91880001
918900* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.     *  91890001
919000*--------------------------------------------------------------*  91900001
919100 9200-REWRITE-LIST-QUEUE.                                         91910001
919200                                                                  91920001
919300     EXEC CICS                                                    91930001
919400          WRITEQ TS                                               91940001
919500              QUEUE  (ASC-SEL-QUEUE-NAME)                         91950001
919600              FROM   (AP301-INVC-LIST-TS-RCRD)                    91960001
919700              ITEM   (ASC-SEL-ITEM)                               91970001
919800              RESP   (PV-CICS-RESPONSE)                           91980001
919900              REWRITE                                             91990001
920000     END-EXEC.                                                    92000001
920100                                                                  92010001
920200     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               92020001
920300         SET DP013-CICS-ABEND                                     92030001
920400             DP013-NO-ROLLBACK     TO TRUE                        92040001
920500         MOVE '9200-REWRITE-LIST-QUEUE'                           92050001
920600                                   TO DP013-PARAGRAPH             92060001
920700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   92070001
920800                                   TO DP013-MESSAGE-TEXT (1)      92080001
920900         PERFORM DP013-0000-PROCESS-ABEND                         92090001
921000     END-IF.                                                      92100001
921100                                                                  92110001
921200*--------------------------------------------------------------*  92120001
921300* ABEND PROCESSOR MODULE                                       *  92130001
921400*--------------------------------------------------------------*  92140001
921500     COPY DPPD013.                                                92150001
921600                                                                  92160001
