000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKUT116.                                00050001
000600 AUTHOR.                 LARRY SCHLEICHER.                        00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            MARCH, 2006.                             00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*----------------------------------------------------------------*00110001
001200* THIS PROGRAM WILL READ IN THE INACTIVE CARTONS FILE (SURD067)  *00120001
001300* AND SELECT ADDITIONAL INFORMATION AND OUTPUT FILE LAYOUT       *00130001
001400* SURD068.                                                       *00140001
001500*----------------------------------------------------------------*00150001
001600                                                                  00160001
001700******************************************************************00170001
001800 ENVIRONMENT DIVISION.                                            00180001
001900******************************************************************00190001
002000 INPUT-OUTPUT SECTION.                                            00200001
002100                                                                  00210001
002200 FILE-CONTROL.                                                    00220001
002300                                                                  00230001
002400     SELECT INACTIVE-INPUT-FILE   ASSIGN TO INP01.                00240001
002500     SELECT INACTIVE-OUTPUT-FILE  ASSIGN TO OUT01.                00250001
002600                                                                  00260001
002700******************************************************************00270001
002800 DATA DIVISION.                                                   00280001
002900******************************************************************00290001
003000 FILE SECTION.                                                    00300001
003100*                                                                 00310001
003200*                                                                 00320001
003300 FD  INACTIVE-INPUT-FILE                                          00330002
003400     RECORDING MODE IS F                                          00340001
003500     LABEL RECORDS ARE STANDARD                                   00350001
003600     BLOCK CONTAINS 0 RECORDS.                                    00360001
003700 01  INACTIVE-INPUT-RECORD       PIC X(150).                      00370010
003800*                                                                 00380001
003900 FD  INACTIVE-OUTPUT-FILE                                         00390002
004000     RECORDING MODE IS F                                          00400001
004100     LABEL RECORDS ARE STANDARD                                   00410001
004200     BLOCK CONTAINS 0 RECORDS.                                    00420001
004300 01  INACTIVE-OUTPUT-RECORD      PIC X(100).                      00430010
004400*                                                                 00440001
004500***************************************************************** 00450001
004600 WORKING-STORAGE SECTION.                                         00460001
004700                                                                  00470001
004800 01  PS-PROGRAM-SWITCHES.                                         00480001
004900     05  PS-END-OF-PO-CSR-SW      PIC X(01)   VALUE 'N'.          00490001
005000         88  PS-EOC-PO-CSR                    VALUE 'Y'.          00500001
005100         88  PS-NOT-EOC-PO-CSR                VALUE 'N'.          00510001
005200     05  PS-END-OF-INPUT-SW       PIC X(01)   VALUE 'N'.          00520001
005300         88  PS-END-OF-INPUT-FILE             VALUE 'Y'.          00530001
005400         88  PS-NOT-END-OF-INPUT-FILE         VALUE 'N'.          00540001
005500     05  PS-CHECK-DISTHD-SW       PIC X(01)   VALUE 'N'.          00550008
005600         88  PS-CHECK-DISTHD                  VALUE 'Y'.          00560008
005700         88  PS-DONT-CHECK-DISTHD             VALUE 'N'.          00570008
           05  PS-ROW-FOUND-SW          PIC X(01)   VALUE 'Y'.          00571030
               88  PS-ROW-FOUND-NO                  VALUE 'N'.          00572030
               88  PS-ROW-FOUND-YES                 VALUE 'Y'.          00573030
005800*                                                                 00580001
005900 01  PV-PROGRAM-VARIABLES.                                        00590001
006000     05  PV-SAVE-PO-NBR               PIC S9(9) COMP VALUE ZERO.  00600009
006100     05  PV-SAVE-RCVR-SEQ-NBR         PIC S9(9) COMP VALUE ZERO.  00610009
006200     05  PV-ACTIVE-CARTONS            PIC S9(9) COMP VALUE ZERO.  00620009
006300     05  PV-INACTIVE-CARTONS          PIC S9(9) COMP VALUE ZERO.  00630007
006400     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    00640001
006500     05  PV-DB2-TABLE-NAME1           PIC  X(08) VALUE SPACES.    00650001
006600     05  PV-DB2-TABLE-NAME2           PIC  X(08) VALUE SPACES.    00660001
006700     05  PV-DISP-FIELD-1              PIC  9(18).                 00670001
006800     05  PV-DISP-FIELD-2              PIC  9(18).                 00680001
006900     05  PV-DISP-FIELD-3              PIC  9(18).                 00690001
007000                                                                  00700001
007100     05  PV-READ-COUNTER              PIC S9(09) VALUE ZERO       00710001
007200                                                  COMP SYNC.      00720001
007300     05  PV-FETCH-COUNTER             PIC S9(09) VALUE ZERO       00730001
007400                                                  COMP SYNC.      00740001
007500     05  PV-WRITE-COUNTER             PIC S9(09) VALUE ZERO       00750001
007600                                                  COMP SYNC.      00760001
007700     05  PV-UNT-QTY-SUM               PIC S9(09) VALUE ZERO       00770005
007800                                                  COMP.           00780005
007900     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00790001
008000                                                                  00800001
008100     05  PV-DISPLAY-PO-NBR               PIC 999999999-.          00810001
008200     05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          00820001
008300     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          00830001
008400                                                                  00840001
008500 01  DK-DB-KEYS.                                                  00850001
008600     05  DK-SHIPT-UNT-ID             PIC S9(18)V COMP-3.          00860008
008700     05  DK-PO-NBR                   PIC S9(09) COMP.             00870001
008800     05  DK-REC-SEQ-NBR              PIC S9(09) COMP.             00880001
008900     05  DK-LINE-NBR                 PIC S9(09) VALUE ZERO        00890002
009000                                                COMP.             00900002
009100                                                                  00910001
009200 01 PC-PROGRAM-CONSTANTS.                                         00920001
009300     05  PC-CRTN-STATUS-PGM          PIC  X(08)    VALUE          00930002
009400         'PCKUT713'.                                              00940002
009500     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT116'. 00950001
009600                                                                  00960001
009700 01  PV-ABEND-FIELDS.                                             00970001
009800     05  PV-DB2-FUNCTION             PIC X(30) VALUE SPACE.       00980001
009900     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00990001
010000                                                 COMP SYNC.       01000001
010100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT116'.01010001
010200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01020001
010300     05  PV-ABEND-OPERATION1          PIC  X(51) VALUE SPACES.    01030001
010400     05  PV-ABEND-OPERATION2          PIC  X(51) VALUE SPACES.    01040001
010500     05  PV-ABEND-OPERATION3          PIC  X(51) VALUE SPACES.    01050001
010600                                                                  01060001
010700                                                                  01070001
010800     COPY SURD067.                                                01080004
010900                                                                  01090002
011000     COPY SURD068.                                                01100004
011100                                                                  01110002
011200*COPYBOOK FOR CARTON STATUS MODULE - PCKUT713                     01120001
011300     COPY PCWS046.                                                01130001
011400                                                                  01140001
011500*----------------------------------------------------------------*01150001
011600*    ABEND PROCESSING COPYBOOK.                                  *01160001
011700*----------------------------------------------------------------*01170001
011800                                                                  01180001
011900     COPY DPWS013.                                                01190001
012000                                                                  01200008
012100******************************************************************01210008
012200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVING          01220008
012300*  TABLE                                                          01230008
012400******************************************************************01240008
012500     EXEC SQL                                                     01250008
012600         INCLUDE TRECEIV                                          01260008
012700     END-EXEC.                                                    01270008
012800                                                                  01280008
012900*----------------------------------------------------------------*01290001
013000*DB2 AREA FOR SUT_OTBND_LOC TABLE                                 01300001
013100     EXEC SQL                                                     01310001
013200          INCLUDE SUT00027                                        01320001
013300     END-EXEC.                                                    01330001
013400                                                                  01340001
013500*DB2 AREA FOR SUT_OTBND_UPC TABLE                                 01350001
013600     EXEC SQL                                                     01360001
013700          INCLUDE SUT00028                                        01370001
013800     END-EXEC.                                                    01380001
013900                                                                  01390001
014000*DB2 AREA FOR XLT_UPC TABLE                                       01400001
014100     EXEC SQL                                                     01410001
014200          INCLUDE XLT00006                                        01420001
014300     END-EXEC.                                                    01430001
014400                                                                  01440001
014500*DB2 AREA FOR XLT_SKU TABLE                                       01450001
014600     EXEC SQL                                                     01460001
014700          INCLUDE XLT00003                                        01470001
014800     END-EXEC.                                                    01480001
014900                                                                  01490001
015000*DB2 AREA FOR XLT_VND_STYL TABLE                                  01500001
015100     EXEC SQL                                                     01510001
015200          INCLUDE XLT00004                                        01520001
015300     END-EXEC.                                                    01530001
015400                                                                  01540001
015500*DB2 AREA FOR DC-DISTRIBUTION TRANSACTION HEADER TABLE            01550001
015600     EXEC SQL                                                     01560001
015700          INCLUDE TDISTHD                                         01570001
015800     END-EXEC.                                                    01580001
015900                                                                  01590001
016000*DB2 AREA FOR SUT_OTBND_CART TABLE                                01600001
016100     EXEC SQL                                                     01610001
016200          INCLUDE SUT00024                                        01620001
016300     END-EXEC.                                                    01630001
016400******************************************************************01640001
016500*   DB2 SQL COMMUNICATION AREA                                    01650001
016600******************************************************************01660001
016700     EXEC SQL                                                     01670001
016800          INCLUDE SQLCA                                           01680001
016900     END-EXEC.                                                    01690001
017000                                                                  01700001
017100*DB2 AREA FOR COMMUNICATIONS AREA2                                01710001
017200     COPY SQLCA2.                                                 01720001
017300                                                                  01730001
017400     EXEC SQL                                                     01740001
017500         DECLARE POS_IN_CARTON_CSR CURSOR                         01750001
017600             FOR SELECT                                           01760001
017700                 A.TRN_NBR                                        01770001
017800               , A.RCVR_SEQ_NBR                                   01780001
017900               , A.TRN_LNE_NBR                                    01790001
018000               , C.SKU_NBR                                        01800001
018100               , SUM(A.SHPD_UNT_QTY)                              01810001
018200               , D.DEPT_NBR                                       01820001
018300               , D.SUB_CL_NBR                                     01830001
018400             FROM SUT_OTBND_UPC  A                                01840001
018500                , XLT_UPC B                                       01850001
018600                , XLT_SKU C                                       01860001
018700                , XLT_VND_STYL D                                  01870001
018800             WHERE A.SHIPT_UNT_ID = :DK-SHIPT-UNT-ID              01880008
018900               AND A.UPC_NBR      = B.UPC_NBR                     01890001
019000               AND B.INTR_UPC_ID  = C.INTR_UPC_ID                 01900001
019100               AND C.STYL_ID      = D.STYL_ID                     01910001
019200             GROUP BY                                             01920001
019300                      A.TRN_NBR                                   01930001
019400                    , A.RCVR_SEQ_NBR                              01940001
019500                    , A.TRN_LNE_NBR                               01950001
019600                    , C.SKU_NBR                                   01960001
019700                    , D.DEPT_NBR                                  01970001
019800                    , D.SUB_CL_NBR                                01980001
019900     END-EXEC.                                                    01990001
020000                                                                  02000001
020100***********************************************************       02010001
020200*  RECORD LAYOUT FOR THE CARTON EXCEPTION EXTRACT FILE            02020001
020300***********************************************************       02030001
020400     COPY SURD036.                                                02040001
020500                                                                  02050001
020600 EJECT                                                            02060001
020700                                                                  02070001
020800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02080001
020900 PROCEDURE DIVISION.                                              02090001
021000* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02100001
021100                                                                  02110001
021200***************************************************************** 02120001
021300 0000-MAINLINE.                                                   02130001
021400***************************************************************** 02140001
021500*    DISPLAY '***BEGINNING SUKUT116***'.                          02150001
021600     PERFORM 1000-INITIALIZE.                                     02160001
021700                                                                  02170001
021800     PERFORM 2000-PROCESS-PO-FILE                                 02180001
021900         UNTIL PS-END-OF-INPUT-FILE.                              02190008
022000                                                                  02200001
022100     MOVE PV-READ-COUNTER TO PV-DISPLAY-COUNT.                    02210001
022200     DISPLAY 'TOTAL RECORDS READ    '          PV-DISPLAY-COUNT.  02220001
022300                                                                  02230001
022400     MOVE PV-FETCH-COUNTER TO PV-DISPLAY-COUNT.                   02240008
022500     DISPLAY 'TOTAL FETCHED RECORDS '          PV-DISPLAY-COUNT.  02250008
022600                                                                  02260008
022700     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                   02270001
022800     DISPLAY 'TOTAL REPORT RECS WRITTEN '  PV-DISPLAY-COUNT.      02280001
022900                                                                  02290001
023000     CLOSE INACTIVE-INPUT-FILE                                    02300003
023100           INACTIVE-OUTPUT-FILE.                                  02310003
023200                                                                  02320001
023300     GOBACK.                                                      02330001
023400                                                                  02340001
023500                                                                  02350001
023600***************************************************************** 02360001
023700 1000-INITIALIZE.                                                 02370001
023800***************************************************************** 02380001
023900     SET PS-NOT-END-OF-INPUT-FILE TO TRUE.                        02390008
024000                                                                  02400008
024100     OPEN INPUT  INACTIVE-INPUT-FILE                              02410003
024200          OUTPUT INACTIVE-OUTPUT-FILE.                            02420003
024500                                                                  02450001
024600*FIRST READ                                                       02460001
024700     PERFORM 7100-READ-INPUT-FILE                                 02470001
024800                                                                  02480001
024900     IF PS-END-OF-INPUT-FILE                                      02490001
025000         DISPLAY '** INPUT FILE IS EMPTY **'                      02500001
025100     END-IF.                                                      02510001
025200                                                                  02520001
025300                                                                  02530001
025400***************************************************************** 02540001
025500 2000-PROCESS-PO-FILE.                                            02550001
025600***************************************************************** 02560001
025700     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       02570001
025800                                                                  02580001
025900     INITIALIZE PC046-COMMAREA-REC                                02590022
024400                SU068-EXTRACT-RECORD.                             02591022
026000     MOVE SU067-SHIPT-UNT-ID    TO PC046-CARTON-ID                02600008
026100                                   DK-SHIPT-UNT-ID.               02610008
026200     PERFORM 2100-SELECT-CARTON.                                  02620008
026300     IF PC046-INACTIVATED                                         02630008
026400         PERFORM 2200-SELECT-OTBND-LOC                            02640008
026500         PERFORM 2500-GET-POS-IN-CARTON                           02650009
026600     END-IF.                                                      02660008
026700                                                                  02670001
026800*NEXT READ                                                        02680008
026900     PERFORM 7100-READ-INPUT-FILE.                                02690009
027000                                                                  02700008
027100 2100-SELECT-CARTON.                                              02710008
027200                                                                  02720001
           MOVE PC-PROGRAM-NAME TO PC046-CALLING-PGM-NME                02721019
027300     CALL PC-CRTN-STATUS-PGM                                      02730001
027400        USING PC046-COMMAREA-REC.                                 02740001
027500                                                                  02750001
027700     IF  PC046-SUCCESSFUL                                         02770001
027800         CONTINUE                                                 02780012
027900     ELSE                                                         02790008
028800         DISPLAY '** ABEND - PROGRAM ' PC-PROGRAM-NAME            02880019
029000         DISPLAY '** BAD CALL TO CRTN STATUS PGM PCKUT713'        02900019
027600         DISPLAY 'PC046-CRA-RET-CDE = ' PC046-CRA-RET-CDE         02901019
029100         DISPLAY PC046-CRA-RET-MSG                                02910019
029200         MOVE +4019 TO PV-ABEND-CODE                              02920019
029300         CALL 'ILBOABN0' USING PV-ABEND-CODE                      02930019
030100     END-IF.                                                      03010001
030200                                                                  03020001
030300                                                                  03030001
030400 2200-SELECT-OTBND-LOC.                                           03040008
030500     EXEC SQL                                                     03050001
030600         SELECT A.SCN_CDE                                         03060001
030700             ,  A.CRE_USR_ID                                      03070001
030800         INTO   :SUT00027-SCN-CDE                                 03080001
030900            ,   :SUT00027-CRE-USR-ID                              03090001
031000         FROM   SUT_OTBND_LOC A                                   03100001
031100         WHERE  SHIPT_UNT_ID             = :DK-SHIPT-UNT-ID       03110008
031200           AND  A.CRE_TMST =                                      03120001
031300           (SELECT MAX(B.CRE_TMST)                                03130001
031400            FROM   SUT_OTBND_LOC B                                03140001
031500            WHERE  SHIPT_UNT_ID          = :DK-SHIPT-UNT-ID)      03150021
031600     END-EXEC.                                                    03160001
031700                                                                  03170001
031800     EVALUATE TRUE                                                03180001
031900         WHEN SQLCODE = ZERO                                      03190001
032000             SET PS-DONT-CHECK-DISTHD  TO TRUE                    03200008
032100             IF SUT00027-SCN-CDE = 'NUSE'                         03210001
032200                 SET SU068-UNUSED  TO TRUE                        03220001
032300                 MOVE SUT00027-CRE-USR-ID                         03230005
032400                                       TO SU068-INACTIVE-USER-ID  03240005
032500             ELSE                                                 03250001
032600             IF SUT00027-SCN-CDE = 'RCLM'                         03260001
032700                 SET SU068-RECLAIM TO TRUE                        03270001
032800                 MOVE SUT00027-CRE-USR-ID                         03280005
032900                                       TO SU068-INACTIVE-USER-ID  03290005
033000             ELSE                                                 03300001
033100             IF PC046-SRC-SMOOTHING                               03310001
033200                 SET SU068-UNSMOOTHED TO TRUE                     03320001
033300             ELSE                                                 03330001
033400             IF PC046-SRC-MSTR-CNTR                               03340001
033500                 SET SU068-UNKNOWN      TO TRUE                   03350016
033600             ELSE                                                 03360016
033700                 SET SU068-CSEPK-DELETE TO TRUE                   03370016
033800                 SET PS-CHECK-DISTHD  TO TRUE                     03380016
033900             END-IF                                               03390001
034000             END-IF                                               03400016
034100             END-IF                                               03410001
034200             END-IF                                               03420001
034300         WHEN SQLCODE = +100                                      03430001
033100             IF PC046-SRC-SMOOTHING                               03431029
033200                 SET SU068-UNSMOOTHED TO TRUE                     03432029
033300             ELSE                                                 03433029
034400             IF PC046-SRC-MSTR-CNTR                               03440001
034500                 SET SU068-UNKNOWN      TO TRUE                   03450001
034600             ELSE                                                 03460001
034700                 SET SU068-CSEPK-DELETE TO TRUE                   03470001
034800                 SET PS-CHECK-DISTHD  TO TRUE                     03480016
034900             END-IF                                               03490001
034200             END-IF                                               03491029
035000                                                                  03500001
035100         WHEN SQLWARN0 NOT = SPACES                               03510001
035200         WHEN SQLCODE < ZERO                                      03520001
035300         WHEN SQLCODE > ZERO                                      03530001
035400             MOVE '2200-SELECT-OTBND-LOC'                         03540008
035500                           TO PV-ABEND-PARAGRAPH                  03550002
035600             MOVE 'SELECT'            TO PV-DB2-FUNCTION          03560001
035700             MOVE 'SUT_OTBND_LOC  '   TO PV-DB2-TABLE-NAME        03570001
035800             PERFORM 9100-SQL-ABEND                               03580002
035900     END-EVALUATE.                                                03590001
036000                                                                  03600001
036100                                                                  03610001
036200******************************************************************03620001
036300* GET TOTAL UNITS VERIFIED                                        03630001
036400******************************************************************03640001
036500 2500-GET-POS-IN-CARTON.                                          03650001
036600                                                                  03660001
036700     SET  PS-NOT-EOC-PO-CSR TO TRUE.                              03670001
036800                                                                  03680001
036900     PERFORM 4010-OPEN-POS-IN-CARTON-CSR.                         03690001
037000                                                                  03700022
037100     MOVE ZERO                   TO PV-SAVE-PO-NBR                03710008
037200                                    PV-SAVE-RCVR-SEQ-NBR.         03720008
037300     PERFORM 4015-FETCH-POS-IN-CARTON-CSR.                        03730001
037400     MOVE DK-SHIPT-UNT-ID   TO PV-DISP-FIELD-1.                   03740011
037600     PERFORM 4030-PROCESS-POS-IN-CARTON-CSR                       03760001
037700         UNTIL PS-EOC-PO-CSR.                                     03770001
037800                                                                  03780001
037900     PERFORM 4020-CLOSE-POS-IN-CARTON-CSR.                        03790001
038000                                                                  03800001
038100******************************************************************03810001
038200 4010-OPEN-POS-IN-CARTON-CSR.                                     03820001
038300******************************************************************03830001
038400                                                                  03840001
038500     EXEC SQL                                                     03850001
038600         OPEN POS_IN_CARTON_CSR                                   03860001
038700     END-EXEC.                                                    03870001
038800                                                                  03880001
038900     EVALUATE TRUE                                                03890001
039000         WHEN SQLCODE = ZERO                                      03900001
039100             CONTINUE                                             03910001
039200         WHEN SQLWARN0 NOT = SPACES                               03920001
039300         WHEN SQLCODE < +0                                        03930001
039400         WHEN SQLCODE > ZERO                                      03940001
039500             MOVE '4010-OPEN-POS-IN-CARTON-CSR'                   03950001
039600                                TO PV-ABEND-PARAGRAPH             03960001
039700             MOVE 'OPEN POS-IN-CARTON-CSR'                        03970001
039800                                TO PV-ABEND-OPERATION1            03980001
039900             PERFORM 9100-SQL-ABEND                               03990001
040000     END-EVALUATE.                                                04000001
040100                                                                  04010001
040200                                                                  04020001
040300******************************************************************04030001
040400 4015-FETCH-POS-IN-CARTON-CSR.                                    04040001
040500******************************************************************04050001
040600     EXEC SQL                                                     04060001
040700         FETCH POS_IN_CARTON_CSR                                  04070001
040800         INTO  :SUT00028-TRN-NBR                                  04080001
040900              ,:SUT00028-RCVR-SEQ-NBR                             04090001
041000              ,:SUT00028-TRN-LNE-NBR                              04100001
041100              ,:XLT00003-SKU-NBR                                  04110001
041200              ,:PV-UNT-QTY-SUM                                    04120001
041300              ,:XLT00004-DEPT-NBR                                 04130001
041400              ,:XLT00004-SUB-CL-NBR                               04140001
041500     END-EXEC.                                                    04150001
041600                                                                  04160001
041700     EVALUATE TRUE                                                04170001
041800         WHEN SQLCODE = ZERO                                      04180001
041900             ADD 1   TO PV-FETCH-COUNTER                          04190008
042100         WHEN SQLCODE = +100                                      04210001
042200             SET PS-EOC-PO-CSR TO TRUE                            04220001
042300         WHEN SQLWARN0 NOT = SPACES                               04230001
042400         WHEN SQLCODE < +0                                        04240001
042500         WHEN SQLCODE > ZERO                                      04250001
042600             MOVE '4015-FETCH-POS-IN-CARTON-CSR'                  04260001
042700                                TO PV-ABEND-PARAGRAPH             04270001
042800             MOVE 'FETCH POS-IN-CARTON-CSR'                       04280001
042900                                TO PV-ABEND-OPERATION1            04290001
043000             MOVE 'TRECDIS'     TO PV-DB2-TABLE-NAME              04300001
043100             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        04310001
043200             STRING 'PO NBR: '         DELIMITED BY SIZE          04320001
043300                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          04330001
043400                           INTO PV-ABEND-OPERATION2               04340008
043500             MOVE DK-REC-SEQ-NBR                                  04350001
043600                             TO PV-DISPLAY-RCVR-SEQ-NBR           04360001
043700             STRING 'RECV SEQ: '       DELIMITED BY SIZE          04370001
043800                 PV-DISPLAY-RCVR-SEQ-NBR                          04380001
043900                                       DELIMITED BY SIZE          04390001
044000                           INTO PV-ABEND-OPERATION3               04400008
044100             MOVE DK-LINE-NBR      TO PV-DISPLAY-PO-LINE-NBR      04410001
044200             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          04420001
044300                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          04430001
044400                           INTO PV-ABEND-OPERATION3               04440001
044500             PERFORM 9100-SQL-ABEND                               04450001
044600     END-EVALUATE.                                                04460001
044700                                                                  04470001
044800                                                                  04480001
044900******************************************************************04490001
045000 4020-CLOSE-POS-IN-CARTON-CSR.                                    04500001
045100******************************************************************04510001
045200     EXEC SQL                                                     04520001
045300         CLOSE POS_IN_CARTON_CSR                                  04530001
045400     END-EXEC.                                                    04540001
045500                                                                  04550001
045600     EVALUATE TRUE                                                04560001
045700         WHEN SQLCODE = ZERO                                      04570001
045800             CONTINUE                                             04580001
045900                                                                  04590001
046000         WHEN SQLWARN0 NOT = SPACES                               04600001
046100         WHEN SQLCODE < +0                                        04610001
046200         WHEN SQLCODE > ZERO                                      04620001
046300             MOVE '4020-CLOSE-POS-IN-CARTON-CSR'                  04630001
046400                                 TO PV-ABEND-PARAGRAPH            04640001
046500             MOVE 'CLOSE POS-IN-CARTON-CSR'                       04650001
046600                                 TO PV-ABEND-OPERATION1           04660001
046700             PERFORM 9100-SQL-ABEND                               04670001
046800     END-EVALUATE.                                                04680001
046900                                                                  04690001
047000                                                                  04700001
047100 4030-PROCESS-POS-IN-CARTON-CSR.                                  04710002
047200     MOVE SUT00028-TRN-NBR      TO DK-PO-NBR.                     04720008
047300     MOVE SUT00028-RCVR-SEQ-NBR TO DK-REC-SEQ-NBR.                04730008
047400     MOVE SUT00028-TRN-LNE-NBR  TO DK-LINE-NBR.                   04740008
047500                                                                  04750008
047600     IF SUT00028-TRN-NBR NOT = PV-SAVE-PO-NBR OR                  04760008
047700        SUT00028-RCVR-SEQ-NBR NOT = PV-SAVE-RCVR-SEQ-NBR          04770008
047800         MOVE SUT00028-TRN-NBR       TO PV-SAVE-PO-NBR            04780008
047900         MOVE SUT00028-RCVR-SEQ-NBR  TO PV-SAVE-RCVR-SEQ-NBR      04790008
048000                                                                  04800008
048100         IF PS-CHECK-DISTHD                                       04810008
048200             PERFORM 5000-CHECK-DELETED-CASEPACK                  04820008
048300             MOVE DISTHD-DLT-REQ-SRC-ID TO SU068-INACTIVE-USER-ID 04830008
048400         END-IF                                                   04840008
048500         PERFORM 5100-SELECT-RECEIVER                             04850008
               IF PS-ROW-FOUND-NO                                       04851030
                   MOVE ZERO TO PV-INACTIVE-CARTONS                     04852030
                                PV-ACTIVE-CARTONS                       04853030
               ELSE                                                     04854030
048600             IF RECEIV-PACK-BY-ST-IND = 'Y'                       04860030
048700                 PERFORM 5200-CNT-INACTIVE-CARTONS-PBS            04870030
048800                 PERFORM 5400-COUNT-ACTIVE-CARTONS-PBS            04880030
048900             ELSE                                                 04890030
049000                 PERFORM 5300-COUNT-INACTIVE-CARTONS              04900030
049100                 PERFORM 5500-COUNT-ACTIVE-CARTONS                04910030
049200             END-IF                                               04920030
049300         END-IF                                                   04930030
049700     END-IF.                                                      04970001
                                                                        04970123
049400     PERFORM 4050-MOVE-TO-OUTPUT                                  04971023
049500     PERFORM 8000-WRITE-EXTRACT                                   04972023
049600*    INITIALIZE SU068-EXTRACT-RECORD                              04973027
049800                                                                  04980001
049900     PERFORM 4015-FETCH-POS-IN-CARTON-CSR.                        04990008
050000                                                                  05000008
050100 4050-MOVE-TO-OUTPUT.                                             05010001
050200     MOVE SU067-SHIPT-UNT-ID     TO SU068-SHIPT-UNT-ID.           05020002
050300     MOVE SU067-LOC-NBR          TO SU068-LOC-NBR.                05030002
050300     MOVE SU067-DIVERT-DOOR      TO SU068-DIVERT-DOOR.            05031026
050400     MOVE SUT00028-TRN-NBR       TO SU068-PO-NBR                  05040001
050500     MOVE SUT00028-RCVR-SEQ-NBR  TO SU068-RCVR-SEQ                05050001
050600     MOVE SUT00028-TRN-LNE-NBR   TO SU068-LINE-NBR.               05060008
050700     MOVE PC046-OTBD-TRIP-ID     TO SU068-OUTBOUND-TRIP.          05070008
050800     MOVE PC046-SHPUNT-SRC-ID    TO SU068-SRC-ID.                 05080008
050900     MOVE PV-ACTIVE-CARTONS      TO SU068-ACTIVE-CARTONS.         05090008
051000     MOVE PV-INACTIVE-CARTONS    TO SU068-INACTIVE-CARTONS.       05100008
051100     MOVE PC046-DEST-OPER-UNT-ID TO SU068-DEST-OPER-UNIT-ID.      05110008
051200     MOVE XLT00004-DEPT-NBR      TO SU068-DEPT-NUMBER.            05120002
051300     MOVE XLT00004-SUB-CL-NBR    TO SU068-SUB-CLASS.              05130002
051400     MOVE XLT00003-SKU-NBR       TO SU068-SKU.                    05140002
051500     MOVE PV-UNT-QTY-SUM         TO SU068-UNIT-COUNT.             05150002
051600                                                                  05160001
051700 5000-CHECK-DELETED-CASEPACK.                                     05170001
051800                                                                  05180001
051900     EXEC SQL                                                     05190001
052000       SELECT  DLT_REQ_SRC_ID                                     05200001
052100         INTO  :DISTHD-DLT-REQ-SRC-ID                             05210001
052200         FROM  TDISTHD                                            05220001
052300        WHERE  ORD_NBR             = :DK-PO-NBR                   05230001
052400          AND  RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR              05240001
052500          AND  ORD_LNE_NBR         = :DK-LINE-NBR                 05250001
052600     END-EXEC.                                                    05260001
052700                                                                  05270001
052800     EVALUATE TRUE                                                05280001
052900         WHEN SQLCODE = ZERO                                      05290001
053000             CONTINUE                                             05300001
053100         WHEN SQLCODE = +100                                      05310018
053200             MOVE SPACES TO DISTHD-DLT-REQ-SRC-ID                 05320018
053300         WHEN SQLWARN0 NOT = SPACE                                05330001
053400         WHEN SQLCODE  NOT = +0                                   05340001
053500             MOVE '5000-CHECK-DELETED-CASEPACK'                   05350001
053600                                TO PV-ABEND-PARAGRAPH             05360001
053700             MOVE 'SELECT TDISTHD'                                05370001
053800                                 TO PV-ABEND-OPERATION1           05380001
053900             MOVE 'TDISTHD' TO PV-DB2-TABLE-NAME                  05390001
054000             MOVE DK-PO-NBR      TO PV-DISP-FIELD-1               05400001
054100             MOVE DK-REC-SEQ-NBR TO PV-DISP-FIELD-2               05410001
054200             MOVE DK-LINE-NBR    TO PV-DISP-FIELD-3               05420001
054300             PERFORM 9100-SQL-ABEND                               05430001
054400     END-EVALUATE.                                                05440001
054500                                                                  05450001
054600 5100-SELECT-RECEIVER.                                            05460008
054700                                                                  05470008
054800     EXEC SQL                                                     05480008
054900        SELECT  PKGNG_CDE                                         05490008
055000              , PACK_BY_ST_IND                                    05500008
055100          INTO  :RECEIV-PKGNG-CDE                                 05510008
055200              , :RECEIV-PACK-BY-ST-IND                            05520008
055300          FROM  TRECEIV                                           05530008
055400          WHERE ORD_NBR           = :DK-PO-NBR                    05540008
055500            AND REC_SEQ_NBR       = :DK-REC-SEQ-NBR               05550008
055600     END-EXEC.                                                    05560008
055700                                                                  05570008
055800     EVALUATE TRUE                                                05580008
055900         WHEN SQLCODE = ZERO                                      05590008
056000             SET PS-ROW-FOUND-YES                                 05600030
                                      TO TRUE                           05601030
               WHEN SQLCODE = +100                                      05602030
                   SET PS-ROW-FOUND-NO                                  05603030
                                      TO TRUE                           05604030
056100         WHEN SQLWARN0 NOT = SPACE                                05610008
056200         WHEN SQLCODE  NOT = +0                                   05620008
056300             MOVE '5100-SELECT-RECEIVER'                          05630008
056400                                TO PV-ABEND-PARAGRAPH             05640008
056500             MOVE 'SELECT RECEIVER'                               05650008
056600                                 TO PV-ABEND-OPERATION1           05660008
056700             MOVE 'TRECEIV'      TO PV-DB2-TABLE-NAME             05670008
056800             MOVE DK-PO-NBR      TO PV-DISP-FIELD-1               05680008
056900             MOVE DK-REC-SEQ-NBR TO PV-DISP-FIELD-2               05690008
057000             PERFORM 9100-SQL-ABEND                               05700008
057100     END-EVALUATE.                                                05710008
057200                                                                  05720008
057300 5200-CNT-INACTIVE-CARTONS-PBS.                                   05730008
057400                                                                  05740008
057500     EXEC SQL                                                     05750008
057600       SELECT  COUNT(DISTINCT(A.SHIPT_UNT_ID))                    05760024
057700         INTO  :PV-INACTIVE-CARTONS                               05770008
057800         FROM  SUT_OTBND_UPC A                                    05780008
057900              ,SUT_OTBND_CART B                                   05790008
058000        WHERE  A.TRN_NBR           = :DK-PO-NBR                   05800008
058100          AND  A.RCVR_SEQ_NBR      = :DK-REC-SEQ-NBR              05810008
058200          AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID               05820008
058300          AND  B.ACTV_IND          = 'N'                          05830008
058400     END-EXEC.                                                    05840008
058500                                                                  05850008
058600     EVALUATE TRUE                                                05860008
058700         WHEN SQLCODE = ZERO                                      05870008
058800             CONTINUE                                             05880008
058900         WHEN SQLWARN0 NOT = SPACE                                05890008
059000         WHEN SQLCODE  NOT = +0                                   05900008
059100             MOVE '5200-CNT-INACTIVE-CARTONS-PBS'                 05910008
059200                                TO PV-ABEND-PARAGRAPH             05920008
059300             MOVE 'SELECT INACTIVE'                               05930008
059400                                 TO PV-ABEND-OPERATION1           05940008
059500             MOVE 'SUT00024'     TO PV-DB2-TABLE-NAME             05950008
059600             MOVE 'SUT00028'     TO PV-DB2-TABLE-NAME1            05960008
059700             MOVE DK-PO-NBR      TO PV-DISP-FIELD-1               05970008
059800             MOVE DK-REC-SEQ-NBR TO PV-DISP-FIELD-2               05980008
059900             PERFORM 9100-SQL-ABEND                               05990008
060000     END-EVALUATE.                                                06000008
060100                                                                  06010008
060200 5300-COUNT-INACTIVE-CARTONS.                                     06020008
060300                                                                  06030001
060400     EXEC SQL                                                     06040001
060500       SELECT  COUNT(DISTINCT(A.SHIPT_UNT_ID))                    06050024
060600         INTO  :PV-INACTIVE-CARTONS                               06060001
060700         FROM  SUT_OTBND_UPC A                                    06070001
060800              ,SUT_OTBND_CART B                                   06080001
060900        WHERE  A.TRN_NBR           = :DK-PO-NBR                   06090001
061000          AND  A.TRN_LNE_NBR       = :DK-LINE-NBR                 06100001
061100          AND  A.RCVR_SEQ_NBR      = :DK-REC-SEQ-NBR              06110001
061200          AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID               06120001
061300          AND  B.ACTV_IND          = 'N'                          06130001
061400     END-EXEC.                                                    06140001
061500                                                                  06150001
061600     EVALUATE TRUE                                                06160001
061700         WHEN SQLCODE = ZERO                                      06170001
061800             CONTINUE                                             06180001
061900         WHEN SQLWARN0 NOT = SPACE                                06190001
062000         WHEN SQLCODE  NOT = +0                                   06200001
062100             MOVE '5300-COUNT-INACTIVE-CARTONS'                   06210008
062200                                TO PV-ABEND-PARAGRAPH             06220001
062300             MOVE 'SELECT INACTIVE'                               06230001
062400                                 TO PV-ABEND-OPERATION1           06240001
062500             MOVE 'SUT00024'     TO PV-DB2-TABLE-NAME             06250001
062600             MOVE 'SUT00028'     TO PV-DB2-TABLE-NAME1            06260001
062700             MOVE DK-PO-NBR      TO PV-DISP-FIELD-1               06270001
062800             MOVE DK-REC-SEQ-NBR TO PV-DISP-FIELD-2               06280001
062900             MOVE DK-LINE-NBR    TO PV-DISP-FIELD-3               06290001
063000             PERFORM 9100-SQL-ABEND                               06300001
063100     END-EVALUATE.                                                06310001
063200                                                                  06320001
063300 5400-COUNT-ACTIVE-CARTONS-PBS.                                   06330008
063400                                                                  06340001
063500     EXEC SQL                                                     06350001
063600       SELECT  COUNT(DISTINCT(A.SHIPT_UNT_ID))                    06360024
063700         INTO  :PV-ACTIVE-CARTONS                                 06370025
063800         FROM  SUT_OTBND_UPC A                                    06380001
063900              ,SUT_OTBND_CART B                                   06390001
064000        WHERE  A.TRN_NBR           = :DK-PO-NBR                   06400001
064100          AND  A.RCVR_SEQ_NBR      = :DK-REC-SEQ-NBR              06410001
064200          AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID               06420001
064300          AND  B.ACTV_IND          = 'Y'                          06430001
064400     END-EXEC.                                                    06440001
064500                                                                  06450001
064600     EVALUATE TRUE                                                06460001
064700         WHEN SQLCODE = ZERO                                      06470001
064800             CONTINUE                                             06480001
064900         WHEN SQLWARN0 NOT = SPACE                                06490001
065000         WHEN SQLCODE  NOT = +0                                   06500001
065100             MOVE '5400-COUNT-ACTIVE-CARTONS-PBS'                 06510008
065200                                TO PV-ABEND-PARAGRAPH             06520001
065300             MOVE 'SELECT ACTIVE'                                 06530001
065400                                 TO PV-ABEND-OPERATION1           06540001
065500             MOVE 'SUT00024'     TO PV-DB2-TABLE-NAME             06550001
065600             MOVE 'SUT00028'     TO PV-DB2-TABLE-NAME1            06560001
065700             MOVE DK-PO-NBR      TO PV-DISP-FIELD-1               06570001
065800             MOVE DK-REC-SEQ-NBR TO PV-DISP-FIELD-2               06580001
065900             PERFORM 9100-SQL-ABEND                               06590001
066000     END-EVALUATE.                                                06600001
066100                                                                  06610008
066200 5500-COUNT-ACTIVE-CARTONS.                                       06620008
066300                                                                  06630008
066400     EXEC SQL                                                     06640008
066500       SELECT  COUNT(DISTINCT(A.SHIPT_UNT_ID))                    06650024
066600         INTO  :PV-ACTIVE-CARTONS                                 06660025
066700         FROM  SUT_OTBND_UPC A                                    06670008
066800              ,SUT_OTBND_CART B                                   06680008
066900        WHERE  A.TRN_NBR           = :DK-PO-NBR                   06690008
067000          AND  A.TRN_LNE_NBR       = :DK-LINE-NBR                 06700008
067100          AND  A.RCVR_SEQ_NBR      = :DK-REC-SEQ-NBR              06710008
067200          AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID               06720008
067300          AND  B.ACTV_IND          = 'Y'                          06730008
067400     END-EXEC.                                                    06740008
067500                                                                  06750008
067600                                                                  06760008
067700     EVALUATE TRUE                                                06770008
067800         WHEN SQLCODE = ZERO                                      06780008
067900             CONTINUE                                             06790008
068000         WHEN SQLWARN0 NOT = SPACE                                06800008
068100         WHEN SQLCODE  NOT = +0                                   06810008
068200             MOVE '5500-COUNT-ACTIVE-CARTONS'                     06820008
068300                                TO PV-ABEND-PARAGRAPH             06830008
068400             MOVE 'SELECT ACTIVE'                                 06840008
068500                                 TO PV-ABEND-OPERATION1           06850008
068600             MOVE 'SUT00024'     TO PV-DB2-TABLE-NAME             06860008
068700             MOVE 'SUT00028'     TO PV-DB2-TABLE-NAME1            06870008
068800             MOVE DK-PO-NBR      TO PV-DISP-FIELD-1               06880008
068900             MOVE DK-REC-SEQ-NBR TO PV-DISP-FIELD-2               06890008
069000             MOVE DK-LINE-NBR    TO PV-DISP-FIELD-3               06900008
069100             PERFORM 9100-SQL-ABEND                               06910008
069200     END-EVALUATE.                                                06920008
069300                                                                  06930008
069400***************************************************************** 06940001
069500 7100-READ-INPUT-FILE.                                            06950001
069600******************************************************************06960001
069700     READ INACTIVE-INPUT-FILE INTO SU067-EXTRACT-RECORD           06970003
069800        AT END                                                    06980001
069900           SET PS-END-OF-INPUT-FILE TO TRUE                       06990001
070000        NOT AT END                                                07000001
070100           ADD +1 TO PV-READ-COUNTER                              07010001
070200     END-READ.                                                    07020001
070300                                                                  07030001
070400***************************************************************** 07040001
070500 8000-WRITE-EXTRACT.                                              07050001
070600***************************************************************** 07060001
070700     WRITE INACTIVE-OUTPUT-RECORD                                 07070001
070800       FROM SU068-EXTRACT-RECORD.                                 07080001
070900     ADD 1  TO PV-WRITE-COUNTER.                                  07090008
071000                                                                  07100001
071100***************************************************************** 07110001
071200 9100-SQL-ABEND.                                                  07120001
071300***************************************************************** 07130001
071400     MOVE SQLCODE                     TO SQLCODE2.                07140001
071500     MOVE SQLERRD(3)                  TO SQLERRD3.                07150001
071600                                                                  07160001
071700     DISPLAY '** ABEND **         ** = SQLERROR'.                 07170001
071800     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                07180001
071900     DISPLAY '** PO NUMBER ** = ' PV-DISPLAY-PO-NBR.              07190001
072000     DISPLAY '** RECEIVER  ** = ' PV-DISPLAY-RCVR-SEQ-NBR.        07200001
072100     DISPLAY '** PO LNE NBR** = ' PV-DISPLAY-PO-LINE-NBR.         07210001
072200                                                                  07220001
072300                                                                  07230001
072400     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07240001
072500     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                07250001
072600     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME.              07260001
072700     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             07270001
072800     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             07280001
072900     DISPLAY '** FIELD 1   ** = ' PV-DISP-FIELD-1.                07290001
073000     DISPLAY '** FIELD 2   ** = ' PV-DISP-FIELD-2.                07300001
073100     DISPLAY '** FIELD 3   ** = ' PV-DISP-FIELD-3.                07310001
073200     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                07320001
073300     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                07330001
073400     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 07340001
073500     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                07350001
073600                                                                  07360001
073700                                                                  07370001
073800     MOVE +4013                       TO PV-ABEND-CODE.           07380001
073900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07390001
