000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300******************************************************************00030004
000400                                                                  00040004
000500 PROGRAM-ID.             TMKUT002.                                00050004
000600 AUTHOR.                 TAMARA KOLTUN.                           00060004
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070004
000800 DATE-WRITTEN            9-10-96.                                 00080004
000900 DATE-COMPILED.                                                   00090004
001000                                                                  00100004
001100*----------------------------------------------------------------*00110004
001200* THIS PROGRAM EXTRACTS "TROUBLE" INFORMATION FROM THE TROUBLE   *00120004
001300* TABLES FOR REPORTING.                                          *00130004
001400*----------------------------------------------------------------*00140004
001500                                                                  00150004
001600******************************************************************00160004
001700 ENVIRONMENT DIVISION.                                            00170004
001800******************************************************************00180004
001900                                                                  00190004
002000 CONFIGURATION SECTION.                                           00200004
002100                                                                  00210004
002200 SOURCE-COMPUTER.        IBM-3090.                                00220004
002300 OBJECT-COMPUTER.        IBM-3090.                                00230004
002400                                                                  00240004
002500 INPUT-OUTPUT SECTION.                                            00250004
002600                                                                  00260004
002700 FILE-CONTROL.                                                    00270004
002800                                                                  00280004
002900      SELECT EXTRACT-TROUBLE-FILE   ASSIGN TO OUT01.              00290004
003000                                                                  00300004
003100******************************************************************00310004
003200 DATA DIVISION.                                                   00320004
003300******************************************************************00330004
003400                                                                  00340004
003500 FILE SECTION.                                                    00350004
003600 FD  EXTRACT-TROUBLE-FILE                                         00360004
003700     LABEL RECORDS ARE STANDARD                                   00370004
003800     BLOCK CONTAINS 0 RECORDS                                     00380004
003900     RECORDING MODE IS F                                          00390004
004000     RECORD CONTAINS 400 CHARACTERS                               00400004
004100     DATA RECORD IS TE-TROUBLE-EXTRACT-RECORD.                    00410004
004200                                                                  00420004
004300 01  TE-TROUBLE-EXTRACT-RECORD       PIC X(400).                  00430004
004400*------------------------------------------------------*          00440004
004500 WORKING-STORAGE SECTION.                                         00450004
004600*------------------------------------------------------*          00460004
004700 01 PC-PROGRAM-CONSTANTS.                                         00470004
004800    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT002'.  00480004
004900    05 PC-DEFAULT-CC-DATE            PIC X(10) VALUE '9999-09-09'.00490004
005000    05 PC-DEFAULT-DATE-TIME          PIC X(14) VALUE              00500004
005100                                                 '99990909090909'.00510004
005200    05 PC-DEFAULT-TIMESTAMP          PIC X(26) VALUE              00520004
005300                                     '9999-09-09-09.09.09.999999'.00530004
005400    05 PC-ZERO                       PIC 9(01) VALUE 0.           00540004
005500    05 PC-ONE                        PIC 9(01) VALUE 1.           00550004
005600    05 PC-TWO                        PIC 9(01) VALUE 2.           00560004
005700    05 PC-SEVEN                      PIC 9(02) VALUE 7.           00570004
005800    05 PC-TWENTY-EIGHT               PIC 9(02) VALUE 28.          00580004
005900    05 PC-RESOLVED                   PIC X(01) VALUE 'R'.         00590004
006000    05 PC-APPROVED                   PIC X(01) VALUE 'A'.         00600004
006100    05 PC-NEW                        PIC X(01) VALUE 'N'.         00610004
006200    05 PC-VE                         PIC X(02) VALUE 'VE'.        00620004
006300    05 PC-SPRING                     PIC X(06) VALUE 'SPRING'.    00630004
006400    05 PC-FALL                       PIC X(06) VALUE '  FALL'.    00640004
006500    05 PC-A                          PIC X(01) VALUE 'A'.         00650004
006600    05 PC-T                          PIC X(01) VALUE 'T'.         00660004
006700    05 PC-3ZEROS                     PIC X(03) VALUE '000'.       00670004
006800    05 PC-HOURS-PER-DAY              PIC 9(02) VALUE 24.          00680004
006900    05 PC-MINUTES-PER-HOUR           PIC 9(02) VALUE 60.          00690004
007000    05 PC-DAY-BEGIN-TIME             PIC X(15)                    00700004
007100                                     VALUE '00.00.00.000001'.     00710004
007200    05 PC-DAY-END-TIME               PIC X(15)                    00720004
007300                                     VALUE '24.00.00.000000'.     00730004
007400 01 DK-DATABASE-KEYS.                                             00740004
007500    05 DK-START-EXTRACT              PIC X(26) VALUE SPACE.       00750004
007600    05 DK-END-EXTRACT                PIC X(26) VALUE SPACE.       00760004
007700                                                                  00770004
007800 01 PV-PROGRAM-VARIABLES.                                         00780004
007900    05 PV-ABEND-CODE                 PIC  9(04) VALUE 0.          00790004
008000    05 PV-CURRENT-DB2-DATE-ONE       PIC  X(10).                  00800004
008100    05 PV-CURRENT-DB2-DATE           PIC  X(10).                  00810004
008200    05 PV-CURRENT-DB2-DATE-ONEYR     PIC  X(10)  VALUE SPACES.    00820004
008300    05 FILLER REDEFINES PV-CURRENT-DB2-DATE-ONEYR.                00830004
008400       10 PV-CDD-ONEYR-CCYY          PIC  9(04).                  00840004
008500       10 FILLER                     PIC  X(06).                  00850004
008600    05 PV-CURR-DATE.                                              00860004
008700       10 PV-CURRENT-DB2-CCYY.                                    00870004
008800          15 PV-CURRENT-DB2-CC       PIC  9(02)    VALUE 0.       00880004
008900          15 PV-CURRENT-DB2-YY       PIC  9(02)    VALUE 0.       00890004
009000       10 FILLER                     PIC  X(01)    VALUE '-'.     00900004
009100       10 PV-CURRENT-DB2-MM          PIC  9(02)    VALUE 0.       00910004
009200       10 FILLER                     PIC  X(01)    VALUE '-'.     00920004
009300       10 PV-CURRENT-DB2-DD          PIC  9(02)    VALUE 0.       00930004
009400    05 PV-CURRENT-DATE.                                           00940004
009500       10 PV-CURRENT-CCYY.                                        00950004
009600          15 PV-CURRENT-CC           PIC  9(02)    VALUE 0.       00960004
009700          15 PV-CURRENT-YY           PIC  9(02)    VALUE 0.       00970004
009800       10 PV-CURRENT-MM              PIC  9(02)    VALUE 0.       00980004
009900       10 PV-CURRENT-DD              PIC  9(02)    VALUE 0.       00990004
010000    05 PV-CURRENT-YYMMDD-DATE.                                    01000004
010100       10 PV-CURRENT-YYMMDD-YY       PIC  9(02)    VALUE 0.       01010004
010200       10 PV-CURRENT-YYMMDD-MM       PIC  9(02)    VALUE 0.       01020004
010300       10 PV-CURRENT-YYMMDD-DD       PIC  9(02)    VALUE 0.       01030004
010400    05 PV-PARA-NAME                  PIC  X(30)    VALUE SPACE.   01040004
010500    05 PV-YEAR-FORMAT.                                            01050004
010600       10 PV-YEAR-FORMAT-CC          PIC  9(02)    VALUE 0.       01060004
010700       10 PV-YEAR-FORMAT-YY          PIC  9(02)    VALUE 0.       01070004
010800    05 PV-BEG-DATE.                                               01080004
010900       10 PV-BEG-YYYY.                                            01090004
011000          15 PV-BEG-CC               PIC  9(02)    VALUE 0.       01100004
011100          15 PV-BEG-YY               PIC  9(02)    VALUE 0.       01110004
011200       10 PV-BEG-MM                  PIC  9(02)    VALUE 0.       01120004
011300       10 PV-BEG-DD                  PIC  9(02)    VALUE 0.       01130004
011400    05 PV-END-DATE.                                               01140004
011500       10 PV-END-YYYY.                                            01150004
011600          15 PV-END-CC               PIC  9(02)    VALUE 0.       01160004
011700          15 PV-END-YY               PIC  9(02)    VALUE 0.       01170004
011800       10 PV-END-MM                  PIC  9(02)    VALUE 0.       01180004
011900       10 PV-END-DD                  PIC  9(02)    VALUE 0.       01190004
012000    05 PV-RESOLVE-CHECK-DATE.                                     01200004
012100       10 PV-RESOLVE-CHECK-YYYY      PIC 9(04)     VALUE 0.       01210004
012200       10 PV-RESOLVE-CHECK-MM        PIC 9(02)     VALUE 0.       01220004
012300       10 PV-RESOLVE-CHECK-DD        PIC 9(02)     VALUE 0.       01230004
012400    05 PV-DATE-AREA.                                              01240004
012500       10 PV-DATE-AREA-MM            PIC  9(02)    VALUE 0.       01250004
012600       10 PV-DATE-AREA-DD            PIC  9(02)    VALUE 0.       01260004
012700       10 PV-DATE-AREA-CC            PIC  9(02)    VALUE 0.       01270004
012800       10 PV-DATE-AREA-YY            PIC  9(02)    VALUE 0.       01280004
012900    05 PV-REFORMAT-TMST.                                          01290004
013000       10 PV-RF-YYYY                 PIC 9(04)     VALUE 0.       01300004
013100       10 FILLER                     PIC X(01)     VALUE SPACE.   01310004
013200       10 PV-RF-MM                   PIC 9(02)     VALUE 0.       01320004
013300       10 FILLER                     PIC X(01)     VALUE SPACE.   01330004
013400       10 PV-RF-DD                   PIC 9(02)     VALUE 0.       01340004
013500       10 FILLER                     PIC X(01)     VALUE SPACE.   01350004
013600       10 PV-RF-HH                   PIC 9(02)     VALUE 0.       01360004
013700       10 FILLER                     PIC X(01)     VALUE SPACE.   01370004
013800       10 PV-RF-MIN                  PIC 9(02)     VALUE 0.       01380004
013900       10 FILLER                     PIC X(01)     VALUE SPACE.   01390004
014000       10 PV-RF-SS                   PIC 9(02)     VALUE 0.       01400004
014100       10 FILLER                     PIC X(01)     VALUE SPACE.   01410004
014200       10 PV-RF-MSS                  PIC 9(06)     VALUE 0.       01420004
014300    05 PV-REFORMATED-TMST.                                        01430004
014400       10 PV-RFMTED-DATE.                                         01440004
014500          15 PV-RFMTED-YYYY          PIC 9(04)     VALUE 0.       01450004
014600          15 PV-RFMTED-MM            PIC 9(02)     VALUE 0.       01460004
014700          15 PV-RFMTED-DD            PIC 9(02)     VALUE 0.       01470004
014800       10 PV-RFMTED-TIME.                                         01480004
014900          15 PV-RFMTED-HH            PIC 9(02)     VALUE 0.       01490004
015000          15 PV-RFMTED-MIN           PIC 9(02)     VALUE 0.       01500004
015100          15 PV-RFMTED-SS            PIC 9(02)     VALUE 0.       01510004
015200    05 PV-START-EXTRACT              PIC X(10)     VALUE SPACE.   01520004
015300    05 FILLER  REDEFINES PV-START-EXTRACT.                        01530004
015400       10 PV-START-EXTRACT-YYYY      PIC 9999.                    01540004
015500       10 PV-START-EXTRACT-1ST       PIC X.                       01550004
015600       10 PV-START-EXTRACT-MM        PIC 99.                      01560004
015700       10 PV-START-EXTRACT-2ND       PIC X.                       01570004
015800       10 PV-START-EXTRACT-DD        PIC 99.                      01580004
015900    05 PV-END-EXTRACT                PIC X(10)     VALUE SPACE.   01590004
016000    05 FILLER  REDEFINES PV-END-EXTRACT.                          01600004
016100       10 PV-END-EXTRACT-YYYY        PIC 9999.                    01610004
016200       10 PV-END-EXTRACT-1ST         PIC X.                       01620004
016300       10 PV-END-EXTRACT-MM          PIC 99.                      01630004
016400       10 PV-END-EXTRACT-2ND         PIC X.                       01640004
016500       10 PV-END-EXTRACT-DD          PIC 99.                      01650004
016600    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   01660004
016700    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   01670004
016800    05 PV-DB2-OPERATION-MSG-2        PIC X(40)     VALUE SPACE.   01680004
016900    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   01690004
017000    05 PV-SQLCODE                    PIC Z(8)9-.                  01700004
017100    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   01710004
017200    05 PV-RESOLVED-DAYS              PIC S9(07)    VALUE 0 COMP-3.01720004
017300    05 PV-RESOLVED-HOURS             PIC S9(07)    VALUE 0 COMP-3.01730004
017400    05 PV-RESOLVED-MINUTES           PIC S9(07)    VALUE 0 COMP-3.01740004
017500    05 PV-RECORD-COUNT               PIC S9(08)    VALUE 0        01750004
017600                                                   COMP.          01760004
017700    05 PV-NOTIF-NBR                  PIC  9(09)    VALUE 0.       01770004
017800    05 PV-RECORD-COUNT-DISPLAY       PIC Z(07)9    VALUE ZEROS.   01780004
017900    05 PV-RCVRS-VRFYD-QTY            PIC S9(9)     COMP-3 VALUE 0.01790004
018000    05 PV-RCVRS-TRBL-QTY             PIC S9(9)     COMP-3 VALUE 0.01800004
018100    05 PV-SEASON-DESC                PIC X(06)     VALUE SPACES.  01810004
018200    05  PV-START-RCVR.                                            01820004
018300        10  PV-START-RCVR-DATE.                                   01830004
018400            15  PV-START-RCVR-DATE-YYYY PIC  X(04).               01840004
018500            15  FILLER                  PIC  X(01)  VALUE '-'.    01850004
018600            15  PV-START-RCVR-DATE-MM   PIC  X(02).               01860004
018700            15  FILLER                  PIC  X(01)  VALUE '-'.    01870004
018800            15  PV-START-RCVR-DATE-DD   PIC  X(02).               01880004
018900        10  PV-START-RCVR-TIME          PIC  X(16)  VALUE         01890004
019000                  '-00.00.00.000000'.                             01900004
019100    05  PV-START-RCVR-TMST REDEFINES PV-START-RCVR PIC X(26).     01910004
019200                                                                  01920004
019300    05  PV-END-RCVR.                                              01930004
019400        10  PV-END-RCVR-DATE.                                     01940004
019500            15  PV-END-RCVR-DATE-YYYY PIC    X(04).               01950004
019600            15  FILLER                  PIC  X(01)  VALUE '-'.    01960004
019700            15  PV-END-RCVR-DATE-MM     PIC  X(02).               01970004
019800            15  FILLER                  PIC  X(01)  VALUE '-'.    01980004
019900            15  PV-END-RCVR-DATE-DD     PIC  X(02).               01990004
020000        10  PV-END-RCVR-TIME            PIC  X(16)  VALUE         02000004
020100                  '-23.59.59.999999'.                             02010004
020200    05  PV-END-RCVR-TMST REDEFINES PV-END-RCVR PIC X(26).         02020004
020300 01 PS-PROGRAM-SWITCHES.                                          02030004
020400    05 PS-END-OF-DATA-SW             PIC X(01)     VALUE SPACE.   02040004
020500       88 PS-EOD                     VALUE 'Y'.                   02050004
020600       88 PS-NOT-EOD                 VALUE 'N'.                   02060004
020700    05 PS-RUN-TYPE-SW                PIC X(01)     VALUE SPACE.   02070004
020800       88 PS-SPECIAL-RUN             VALUE 'S'.                   02080004
020900       88 PS-NORMAL-RUN              VALUE 'N'.                   02090004
021000 01 PS-DETERMINE-DATE-RANGE-SW       PIC X(01)     VALUE SPACE.   02100004
021100    88 PS-DETERMINE-DT-RANGE         VALUE 'Y'.                   02110004
021200    88 PS-DO-NOT-DETERMINE-DT-RANGE  VALUE 'N'.                   02120004
021300 01 PS-MONDAY-SW                     PIC X(01)     VALUE SPACE.   02130004
021400    88 PS-MONDAY                     VALUE 'M'.                   02140004
021500    88 PS-NOT-MONDAY                 VALUE 'N'.                   02150004
021600                                                                  02160004
021700 01 CC-CONTROL-CARD-PARAMETERS.                                   02170004
021800    05 CC-BEG-DATE.                                               02180004
021900       10 CC-BEG-YYYY                 PIC 9(04) VALUE 0.          02190004
022000       10 FILLER                      PIC X(01) VALUE SPACE.      02200004
022100       10 CC-BEG-MM                   PIC 9(02) VALUE 0.          02210004
022200       10 FILLER                      PIC X(01) VALUE SPACE.      02220004
022300       10 CC-BEG-DD                   PIC 9(02) VALUE 0.          02230004
022400    05 FILLER                       PIC X(01) VALUE SPACE.        02240004
022500    05 CC-END-DATE.                                               02250004
022600       10 CC-END-YYYY                 PIC 9(04) VALUE 0.          02260004
022700       10 FILLER                      PIC X(01) VALUE SPACE.      02270004
022800       10 CC-END-MM                   PIC 9(02) VALUE 0.          02280004
022900       10 FILLER                      PIC X(01) VALUE SPACE.      02290004
023000       10 CC-END-DD                   PIC 9(02) VALUE 0.          02300004
023100    05 FILLER                       PIC X(01) VALUE SPACE.        02310004
023200    05 CC-MODE-IND                  PIC X(01) VALUE SPACE.        02320004
023300       88 CC-VALID-MODE-IND         VALUE 'D', 'W', 'M',          02330004
023400                                          'F', 'C', 'S'.          02340004
023500       88 CC-DAILY-EXTRACT          VALUE 'D'.                    02350004
023600       88 CC-WEEKLY-EXTRACT         VALUE 'W'.                    02360004
023700       88 CC-MONTHLY-EXTRACT        VALUE 'M'.                    02370004
023800       88 CC-FISCAL-EXTRACT         VALUE 'F'.                    02380004
023900       88 CC-CALENDAR-EXTRACT       VALUE 'C'.                    02390004
024000       88 CC-SEASONAL-EXTRACT       VALUE 'S'.                    02400004
024100    05 FILLER                       PIC X(01) VALUE SPACE.        02410004
024200    05 CC-TIMEFRAME-IND             PIC X(01) VALUE SPACE.        02420004
024300       88 CC-VALID-TIMEFRAME-IND    VALUE ' ', 'A'.               02430004
024400       88 CC-ACTUAL-TIMEFRAME       VALUE 'A'.                    02440004
024500    05 FILLER                       PIC X(59) VALUE SPACE.        02450004
024600                                                                  02460004
024700                                                                  02470004
024800     COPY DPWS500.                                                02480004
024900                                                                  02490004
025000     COPY TMRD001.                                                02500004
025100                                                                  02510004
025200*** DB2 MESSAGE AREAS ****                                        02520004
025300     COPY DPWS004.                                                02530004
025400*                                                                 02540004
025500     EXEC SQL                                                     02550004
025600          INCLUDE SQLCA                                           02560004
025700     END-EXEC.                                                    02570004
025800                                                                  02580004
025900     EXEC SQL                                                     02590004
026000          INCLUDE TRECEIV                                         02600004
026100     END-EXEC.                                                    02610004
026200                                                                  02620004
026300     EXEC SQL                                                     02630004
026400          INCLUDE TTRBNTF                                         02640004
026500     END-EXEC.                                                    02650004
026600                                                                  02660004
026700     EXEC SQL                                                     02670004
026800          INCLUDE TTRBRSN                                         02680004
026900     END-EXEC.                                                    02690004
027000                                                                  02700004
027100     EXEC SQL                                                     02710004
027200          INCLUDE TCOCNTL                                         02720004
027300     END-EXEC.                                                    02730004
027400                                                                  02740004
027500     EXEC SQL                                                     02750004
027600          INCLUDE TPURCHS                                         02760004
027700     END-EXEC.                                                    02770004
027800                                                                  02780004
027900      EXEC SQL                                                    02790004
028000          DECLARE TTRBNTF-READ-CRS CURSOR FOR                     02800004
028100             SELECT                                               02810004
028200                   NOTIF_NBR                                      02820004
028300                  ,OPER_UNT_ID                                    02830004
028400                  ,FCLTY_ID                                       02840004
028500                  ,DEPT_NBR                                       02850004
028600                  ,ENT_ID                                         02860004
028700                  ,PO_NBR                                         02870004
028800                  ,PO_LNE_NBR                                     02880004
028900                  ,REC_SEQ_NBR                                    02890004
029000                  ,A.TRBL_RSN_CDE                                 02900004
029100                  ,NOTIF_TMST                                     02910004
029200                  ,NOTIF_UID                                      02920004
029300                  ,RESOLVED_IND                                   02930004
029400                  ,RESOLVED_TMST                                  02940004
029500                  ,RESOLVED_UID                                   02950004
029600                  ,ACKNOWLG_TMST                                  02960004
029700                  ,ACKNOWLG_UID                                   02970004
029800                  ,CNTCT_EXT                                      02980004
029900                  ,FCLTY_AREA_ID                                  02990004
030000                  ,OVER_SHT_PCT                                   03000004
030100                  ,LAST_DTL_CRE_TMST                              03010004
030200                  ,CRE_IND                                        03020004
030300                  ,PRORATE_IND                                    03030004
030400                  ,RTV_IND                                        03040004
030500                  ,RTV_RESPONSE_TMST                              03050004
030600                  ,PREPK_ID                                       03060004
030700             FROM TTRBNTF A                                       03070004
030800                 ,TTRBRSN B                                       03080004
030900             WHERE DATE(NOTIF_TMST)    <= :PV-END-EXTRACT         03090004
031000               AND DATE(RESOLVED_TMST) >= :PV-START-EXTRACT       03100004
031100               AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE              03110004
031200               AND B.TRBL_INITR_CDE <> :PC-T                      03120004
031310            FOR FETCH ONLY                                        03131004
031320               WITH UR                                            03132005
031400      END-EXEC.                                                   03140004
031500                                                                  03150004
031600******************************************************************03160004
031700* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS  29     *03170004
031800******************************************************************03180004
031900                                                                  03190004
032000********************************************************          03200004
032100 PROCEDURE DIVISION.                                              03210004
032200********************************************************          03220004
032300 0000-MAIN.                                                       03230004
032400                                                                  03240004
032500     PERFORM 1000-INITIALIZATION         THRU 1000-EXIT.          03250004
032600     PERFORM 2000-MAIN-LOOP              THRU 2000-EXIT           03260004
032700                            UNTIL PS-EOD.                         03270004
032800     PERFORM 3000-CLOSE-TTRBNTF-CRS      THRU 3000-EXIT.          03280004
032900     CLOSE  EXTRACT-TROUBLE-FILE.                                 03290004
033000     MOVE PV-RECORD-COUNT           TO PV-RECORD-COUNT-DISPLAY.   03300004
033100     DISPLAY 'DETAIL RECORDS WRITTEN ' PV-RECORD-COUNT-DISPLAY.   03310004
033200 0000-EXIT.  STOP RUN.                                            03320004
033300                                                                  03330004
033400 1000-INITIALIZATION.                                             03340004
033500                                                                  03350004
033600     EXEC SQL                                                     03360004
033700         SELECT (CURRENT DATE - 1 DAY)                            03370004
033800               , CURRENT DATE                                     03380004
033900               , (CURRENT DATE - 1 YEAR)                          03390004
034000           INTO  :PV-CURRENT-DB2-DATE-ONE                         03400004
034100               , :PV-CURRENT-DB2-DATE                             03410004
034200               , :PV-CURRENT-DB2-DATE-ONEYR                       03420004
034300           FROM  TCOCNTL                                          03430004
034400          WHERE  OPER_UNT_ID = 90                                 03440004
034410               WITH UR                                            03441005
034500     END-EXEC.                                                    03450004
034600                                                                  03460004
034700     EVALUATE TRUE                                                03470004
034800         WHEN SQLCODE = ZERO                                      03480004
034900             MOVE PV-CURRENT-DB2-DATE    TO PV-CURR-DATE          03490004
035000             MOVE PV-CURRENT-DB2-CC      TO PV-CURRENT-CC         03500004
035100             MOVE PV-CURRENT-DB2-YY      TO PV-CURRENT-YY         03510004
035200                                            PV-CURRENT-YYMMDD-YY  03520004
035300             MOVE PV-CURRENT-DB2-MM      TO PV-CURRENT-MM         03530004
035400                                            PV-CURRENT-YYMMDD-MM  03540004
035500             MOVE PV-CURRENT-DB2-DD      TO PV-CURRENT-DD         03550004
035600                                            PV-CURRENT-YYMMDD-DD  03560004
035700         WHEN OTHER                                               03570004
035800              MOVE '1100-INITIALIZATION'      TO                  03580004
035900                   PV-ABEND-PARA-NAME                             03590004
036000              MOVE 'SET DATE   '       TO PV-DB2-OPERATION-MSG-1  03600004
036100              MOVE 'NONE   '           TO PV-DB2-TABLE-NAME       03610004
036200              PERFORM 9998-SQL-ABEND   THRU 9998-EXIT             03620004
036300      END-EVALUATE.                                               03630004
036400     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                03640004
036500                                                                  03650004
036600     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS:  '             03660004
036700             CC-CONTROL-CARD-PARAMETERS.                          03670004
036800                                                                  03680004
036900       PERFORM 1100-CHECK-CC-PARAMETERS THRU 1100-EXIT.           03690004
037000       PERFORM 1200-SET-DATABASE-KEYS   THRU 1200-EXIT            03700004
037100       OPEN OUTPUT EXTRACT-TROUBLE-FILE.                          03710004
037200       PERFORM 1400-COUNT-VRFYD-RECEIPTS.                         03720004
037300       PERFORM 1410-COUNT-VRFYD-TROUBLE.                          03730004
037400       PERFORM 1500-WRITE-HEADER-RECORD THRU 1500-EXIT.           03740004
037500       PERFORM 1600-OPEN-TTRBNTF-CRS    THRU 1600-EXIT.           03750004
037600                                                                  03760004
037700 1000-EXIT.  EXIT.                                                03770004
037800                                                                  03780004
037900 1100-CHECK-CC-PARAMETERS.                                        03790004
038000     MOVE '1100-CHECK-CC-PARAMETERS'   TO PV-PARA-NAME            03800004
038100                                                                  03810004
038200     IF NOT CC-VALID-MODE-IND                                     03820004
038300        DISPLAY '***************************'                     03830004
038400        DISPLAY 'CONTROL PARAMETERS: '                            03840004
038500                 CC-CONTROL-CARD-PARAMETERS                       03850004
038600        DISPLAY 'MODE INDICATOR "' CC-MODE-IND '"'                03860004
038700                ' IS INVALID.'                                    03870004
038800        DISPLAY 'RUN ABORTED'                                     03880004
038900        DISPLAY '***************************'                     03890004
039000        MOVE 4003  TO PV-ABEND-CODE                               03900004
039100        PERFORM 9999-ABORT   THRU 9999-EXIT                       03910004
039200     END-IF                                                       03920004
039300                                                                  03930004
039400     IF NOT CC-VALID-TIMEFRAME-IND                                03940004
039500        DISPLAY '***************************'                     03950004
039600        DISPLAY 'CONTROL PARAMETERS: '                            03960004
039700                 CC-CONTROL-CARD-PARAMETERS                       03970004
039800        DISPLAY 'TIME INDICATOR "' CC-TIMEFRAME-IND '"'           03980004
039900                ' IS INVALID.'                                    03990004
040000        DISPLAY 'RUN ABORTED'                                     04000004
040100        DISPLAY '***************************'                     04010004
040200        MOVE 4003  TO PV-ABEND-CODE                               04020004
040300        PERFORM 9999-ABORT   THRU 9999-EXIT                       04030004
040400     END-IF                                                       04040004
040500                                                                  04050004
040600     IF CC-BEG-DATE IS  = PC-DEFAULT-CC-DATE AND                  04060004
040700        CC-END-DATE IS  = PC-DEFAULT-CC-DATE                      04070004
040800        SET PS-NORMAL-RUN           TO TRUE                       04080004
040900        GO TO 1100-EXIT                                           04090004
041000     END-IF.                                                      04100004
041100                                                                  04110004
041200     SET PS-SPECIAL-RUN    TO TRUE                                04120004
041300                                                                  04130004
041400     MOVE CC-BEG-YYYY      TO PV-BEG-YYYY                         04140004
041500     MOVE CC-BEG-MM        TO PV-BEG-MM                           04150004
041600     MOVE CC-BEG-DD        TO PV-BEG-DD                           04160004
041700     MOVE CC-END-YYYY      TO PV-END-YYYY                         04170004
041800     MOVE CC-END-MM        TO PV-END-MM                           04180004
041900     MOVE CC-END-DD        TO PV-END-DD                           04190004
042000                                                                  04200004
042100     IF  PV-BEG-DATE IS NOT < PV-END-DATE  AND                    04210004
042200         PV-BEG-DATE IS NOT = PV-END-DATE                         04220004
042300         DISPLAY '***************************'                    04230004
042400         DISPLAY 'CONTROL PARAMETERS: '                           04240004
042500                  CC-CONTROL-CARD-PARAMETERS                      04250004
042600         DISPLAY                                                  04260004
042700           'THE BEGINNING DATE MUST BE LESS THAN OR EQUAL TO THE E04270004
042800-          'NDING DATE'                                           04280004
042900         DISPLAY 'RUN ABORTED'                                    04290004
043000         DISPLAY '***************************'                    04300004
043100         MOVE 4003  TO PV-ABEND-CODE                              04310004
043200         PERFORM 9999-ABORT   THRU 9999-EXIT                      04320004
043300     END-IF                                                       04330004
043400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04340004
043500     SET DPG51-FISCAL-454-CALENDAR   TO TRUE                      04350004
043600     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                      04360004
043700     SET DPG52-LK-DTE-GREG-CC        TO TRUE                      04370004
043800                                                                  04380004
043900     MOVE PV-BEG-CC                  TO PV-DATE-AREA-CC           04390004
044000     MOVE PV-BEG-YY                  TO PV-DATE-AREA-YY           04400004
044100     MOVE PV-BEG-MM                  TO PV-DATE-AREA-MM           04410004
044200     MOVE PV-BEG-DD                  TO PV-DATE-AREA-DD           04420004
044300     MOVE PV-DATE-AREA               TO DPG52-LK-DATE-INPUT       04430004
044400     DISPLAY 'JUST BEFORE CALL TO 9100 IN PARA 1100'              04440004
044500     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               04450004
044600     DISPLAY 'JUST AFTER  CALL TO 9100 IN PARA 1100'              04460004
044700     IF DPG54-DATE-INVALID                                        04470004
044800        DISPLAY '***************************'                     04480004
044900        DISPLAY 'CONTROL PARAMETERS: '                            04490004
045000                 CC-CONTROL-CARD-PARAMETERS                       04500004
045100        DISPLAY 'BEGINNING DATE  '                                04510004
045200                CC-BEG-DATE                                       04520004
045300                ' IS INVALID.'                                    04530004
045400        DISPLAY 'RUN ABORTED'                                     04540004
045500        DISPLAY '***************************'                     04550004
045600        MOVE 4003  TO PV-ABEND-CODE                               04560004
045700        PERFORM 9999-ABORT   THRU 9999-EXIT                       04570004
045800     END-IF.                                                      04580004
045900                                                                  04590004
046000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04600004
046100     SET DPG51-FISCAL-454-CALENDAR   TO TRUE                      04610004
046200     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                      04620004
046300     SET DPG52-LK-DTE-GREG-CC        TO TRUE                      04630004
046400                                                                  04640004
046500     MOVE PV-END-CC                  TO PV-DATE-AREA-CC           04650004
046600     MOVE PV-END-YY                  TO PV-DATE-AREA-YY           04660004
046700     MOVE PV-END-MM                  TO PV-DATE-AREA-MM           04670004
046800     MOVE PV-END-DD                  TO PV-DATE-AREA-DD           04680004
046900     MOVE PV-DATE-AREA               TO DPG52-LK-DATE-INPUT       04690004
047000                                                                  04700004
047100     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               04710004
047200                                                                  04720004
047300     IF DPG54-DATE-INVALID                                        04730004
047400        DISPLAY '***************************'                     04740004
047500        DISPLAY 'CONTROL PARAMETERS: '                            04750004
047600                 CC-CONTROL-CARD-PARAMETERS                       04760004
047700        DISPLAY 'ENDING DATE '                                    04770004
047800                CC-END-DATE                                       04780004
047900                ' IS INVALID.'                                    04790004
048000        DISPLAY 'RUN ABORTED'                                     04800004
048100        DISPLAY '***************************'                     04810004
048200        MOVE 4003  TO PV-ABEND-CODE                               04820004
048300        PERFORM 9999-ABORT   THRU 9999-EXIT                       04830004
048400     END-IF.                                                      04840004
048500                                                                  04850004
048600 1100-EXIT.   EXIT.                                               04860004
048700                                                                  04870004
048800 1200-SET-DATABASE-KEYS.                                          04880004
048900     IF PS-NORMAL-RUN                                             04890004
049000        PERFORM 1210-DETERMINE-DATE-RANGE THRU 1210-EXIT          04900004
049100     ELSE                                                         04910004
049200        MOVE CC-BEG-DATE         TO PV-START-EXTRACT              04920004
049300        MOVE CC-END-DATE         TO PV-END-EXTRACT                04930004
049400     END-IF.                                                      04940004
049500                                                                  04950004
049600     DISPLAY '**************************************************'.04960004
049610     DISPLAY 'EXTRACT START:  ' PV-START-EXTRACT.                 04961004
049700     DISPLAY 'EXTRACT END  :  ' PV-END-EXTRACT.                   04970004
049710     DISPLAY '**************************************************'.04971004
049800                                                                  04980004
049900 1200-EXIT.   EXIT.                                               04990004
050000                                                                  05000004
050100 1210-DETERMINE-DATE-RANGE.                                       05010004
050200                                                                  05020004
050300     EVALUATE TRUE                                                05030004
050400       WHEN CC-DAILY-EXTRACT                                      05040004
050500            IF CC-ACTUAL-TIMEFRAME                                05050004
050600                MOVE PV-CURRENT-DB2-DATE TO PV-END-EXTRACT        05060004
050700                                            PV-START-EXTRACT      05070004
050800            ELSE                                                  05080004
050900                PERFORM 1211-DAILY-RPT-DTE-RANGE                  05090004
051000                                        THRU 1211-EXIT            05100004
051100            END-IF                                                05110004
051200       WHEN CC-WEEKLY-EXTRACT                                     05120004
051300            PERFORM 1212-WEEKLY-RPT-DTE-RANGE                     05130004
051400                                           THRU 1212-EXIT         05140004
051500       WHEN CC-MONTHLY-EXTRACT                                    05150004
051600                PERFORM 1213-MONTHLY-RPT-DTE-RANGE                05160004
051700                                           THRU 1213-EXIT         05170004
051800       WHEN CC-FISCAL-EXTRACT                                     05180004
051900                PERFORM 1214-FISCAL-RPT-DTE-RANGE                 05190004
052000                                           THRU 1214-EXIT         05200004
052100       WHEN CC-CALENDAR-EXTRACT                                   05210004
052200                PERFORM 1215-CALENDAR-RPT-DTE-RANGE               05220004
052300                                           THRU 1215-EXIT         05230004
052400       WHEN CC-SEASONAL-EXTRACT                                   05240004
052500                PERFORM 1216-SEASONAL-RPT-DTE-RANGE               05250004
052600                                           THRU 1216-EXIT         05260004
052700     END-EVALUATE.                                                05270004
052800                                                                  05280004
052900 1210-EXIT.   EXIT.                                               05290004
053000                                                                  05300004
053100 1211-DAILY-RPT-DTE-RANGE.                                        05310004
053200     MOVE '1211-DAILY-RPT-DTE-RANGE(1)'  TO PV-PARA-NAME.         05320004
053300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05330004
053400*** CHECK WHETHER THE RUN DAY IS MONDAY.                          05340004
053500     IF  PS-NORMAL-RUN                                            05350004
053600         MOVE PV-CURRENT-CC     TO PV-DATE-AREA-CC                05360004
053700         MOVE PV-CURRENT-YY     TO PV-DATE-AREA-YY                05370004
053800         MOVE PV-CURRENT-MM     TO PV-DATE-AREA-MM                05380004
053900         MOVE PV-CURRENT-DD     TO PV-DATE-AREA-DD                05390004
054000     END-IF.                                                      05400004
054100     MOVE   PV-DATE-AREA       TO  DPG52-LK-DATE-INPUT.           05410004
054200*    MOVE   PV-CURRENT-YYMMDD-DATE TO DPG51-SYSTEM-DATE.          05420004
054300                                                                  05430004
054400     DISPLAY 'PV-DATE-AREA ' PV-DATE-AREA.                        05440004
054500     DISPLAY 'PV-CURRENT-DATE ' PV-CURRENT-DATE.                  05450004
054600     DISPLAY 'PV-CURRENT-YYMMDD-DATE ' PV-CURRENT-YYMMDD-DATE.    05460004
054700                                                                  05470004
054800     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                      05480004
054900     SET DPG52-LK-DTE-GREG-CC        TO TRUE                      05490004
055000     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE                      05500004
055100                                                                  05510004
055200     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               05520004
055300                                                                  05530004
055400     IF DPG55-ALPHA-WEEK-DAY-MONDAY                               05540004
055500        INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            05550004
055600        SET PS-MONDAY    TO TRUE                                  05560004
055700        MOVE PC-TWO      TO DPG51-INCR-DECR-DAYS-9                05570004
055800     ELSE                                                         05580004
055900        INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            05590004
056000        SET PS-NOT-MONDAY  TO TRUE                                05600004
056100        MOVE PC-ONE        TO DPG51-INCR-DECR-DAYS-9              05610004
056200     END-IF                                                       05620004
056300                                                                  05630004
056400     IF  PS-NORMAL-RUN                                            05640004
056500         MOVE PV-CURRENT-CC     TO PV-DATE-AREA-CC                05650004
056600         MOVE PV-CURRENT-YY     TO PV-DATE-AREA-YY                05660004
056700         MOVE PV-CURRENT-MM     TO PV-DATE-AREA-MM                05670004
056800         MOVE PV-CURRENT-DD     TO PV-DATE-AREA-DD                05680004
056900     END-IF.                                                      05690004
057000     MOVE   PV-DATE-AREA       TO  DPG52-LK-DATE-INPUT.           05700004
057100                                                                  05710004
057200     DISPLAY 'PV-DATE-AREA (2)' PV-DATE-AREA.                     05720004
057300     DISPLAY 'PV-CURRENT-DATE (2)' PV-CURRENT-DATE.               05730004
057400     DISPLAY 'PV-CURRENT-YYMMDD-DATE (2)' PV-CURRENT-YYMMDD-DATE. 05740004
057500                                                                  05750004
057600     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05760004
057700     SET DPG51-DECREMENT-DATE       TO TRUE.                      05770004
057800     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      05780004
057900                                                                  05790004
058000     MOVE '1211-DAILY-RPT-DTE-RANGE(2)'  TO PV-PARA-NAME.         05800004
058100                                                                  05810004
058200     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               05820004
058300                                                                  05830004
058400     IF PS-NOT-MONDAY                                             05840004
058500        MOVE DPG55-DB2-ISO-DATE-FMT     TO  PV-START-EXTRACT      05850004
058600                                            PV-END-EXTRACT        05860004
058700     ELSE                                                         05870004
058800        MOVE DPG55-DB2-ISO-DATE-FMT    TO  PV-START-EXTRACT       05880004
058900        INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            05890004
059000        MOVE PC-ONE                    TO DPG51-INCR-DECR-DAYS-9  05900004
059100        MOVE PV-DATE-AREA              TO DPG52-LK-DATE-INPUT     05910004
059200        SET DPG51-FISCAL-454-CALENDAR  TO TRUE                    05920004
059300        SET DPG51-DECREMENT-DATE       TO TRUE                    05930004
059400        SET DPG52-LK-DTE-GREG-CC       TO TRUE                    05940004
059500        PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT            05950004
059600        MOVE DPG55-DB2-ISO-DATE-FMT     TO  PV-END-EXTRACT        05960004
059700     END-IF.                                                      05970004
059800 1211-EXIT.  EXIT.                                                05980004
059900                                                                  05990004
060000 1212-WEEKLY-RPT-DTE-RANGE.                                       06000004
060100     MOVE '1212-WEEKLY-RPT-DTE-RANGE'  TO PV-PARA-NAME            06010004
060200**** GET START/END DATES OF THE PREVIOUS WEEK.                    06020004
060300     MOVE   PV-CURRENT-CC      TO  PV-DATE-AREA-CC.               06030004
060400     MOVE   PV-CURRENT-YY      TO  PV-DATE-AREA-YY.               06040004
060500     MOVE   PV-CURRENT-MM      TO  PV-DATE-AREA-MM.               06050004
060600     MOVE   PV-CURRENT-DD      TO  PV-DATE-AREA-DD.               06060004
060700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               06070004
060800     MOVE   PV-DATE-AREA       TO  DPG52-LK-DATE-INPUT.           06080004
060900     MOVE   PC-SEVEN           TO DPG51-INCR-DECR-DAYS-9.         06090004
061000                                                                  06100004
061100     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      06110004
061200     SET DPG51-DECREMENT-DATE       TO TRUE.                      06120004
061300     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      06130004
061400                                                                  06140004
061500     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               06150004
061600                                                                  06160004
061700     IF DPG54-DATE-VALID                                          06170004
061800         MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO PV-START-EXTRACT      06180004
061900         MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO PV-END-EXTRACT        06190004
062000     END-IF.                                                      06200004
062100 1212-EXIT. EXIT.                                                 06210004
062200                                                                  06220004
062300 1213-MONTHLY-RPT-DTE-RANGE.                                      06230004
062400     MOVE '1213-MONTHLY-RPT-DTE-RANGE'  TO PV-PARA-NAME           06240004
062500*** GET START/END DATES OF THE PREVIOUS MONTH.                    06250004
062600     MOVE   PV-CURRENT-CC      TO  PV-DATE-AREA-CC                06260004
062700     MOVE   PV-CURRENT-YY      TO  PV-DATE-AREA-YY                06270004
062800     MOVE   PV-CURRENT-MM      TO  PV-DATE-AREA-MM                06280004
062900     MOVE   PV-CURRENT-DD      TO  PV-DATE-AREA-DD                06290004
063000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               06300004
063100     MOVE   PV-DATE-AREA       TO  DPG52-LK-DATE-INPUT            06310004
063200                                                                  06320004
063300     MOVE PC-TWENTY-EIGHT      TO DPG51-INCR-DECR-DAYS-9          06330004
063400                                                                  06340004
063500     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      06350004
063600     SET DPG51-DECREMENT-DATE       TO TRUE.                      06360004
063700     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      06370004
063800                                                                  06380004
063900     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               06390004
064000     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO                           06400004
064100                                  PV-START-EXTRACT                06410004
064200     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO                           06420004
064300                                  PV-END-EXTRACT.                 06430004
064400 1213-EXIT. EXIT.                                                 06440004
064500                                                                  06450004
064600 1214-FISCAL-RPT-DTE-RANGE.                                       06460004
064700     MOVE '1214-FISCAL-RPT-DTE-RANGE'  TO PV-PARA-NAME            06470004
064800*** GET START/END DATES OF THE PREVIOUS MONTH.                    06480004
064900     MOVE   PV-CURRENT-CC      TO  PV-DATE-AREA-CC.               06490004
065000     MOVE   PV-CURRENT-YY      TO  PV-DATE-AREA-YY.               06500004
065100     MOVE   PV-CURRENT-MM      TO  PV-DATE-AREA-MM.               06510004
065200     MOVE   PV-CURRENT-DD      TO  PV-DATE-AREA-DD.               06520004
065300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               06530004
065400     MOVE   PV-DATE-AREA       TO  DPG52-LK-DATE-INPUT            06540004
065500                                                                  06550004
065600     MOVE PC-TWENTY-EIGHT      TO DPG51-INCR-DECR-DAYS-9.         06560004
065700                                                                  06570004
065800     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      06580004
065900     SET DPG51-DECREMENT-DATE       TO TRUE.                      06590004
066000     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      06600004
066100                                                                  06610004
066200     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT               06620004
066300     IF DPG56-FISCAL-PERIOD-NBR = 12 THEN                         06630004
066400         MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO                       06640004
066500                                  PV-START-EXTRACT                06650004
066600         MOVE DPG56-LAST-FD-DB2-ISO-FMT  TO                       06660004
066700                                  PV-END-EXTRACT                  06670004
066800     ELSE                                                         06680004
066900         MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO                       06690004
067000                                  PV-START-EXTRACT                06700004
067100         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           06710004
067200         MOVE PC-ONE                   TO DPG51-INCR-DECR-DAYS-9  06720004
067300         MOVE PV-DATE-AREA             TO DPG52-LK-DATE-INPUT     06730004
067400         SET DPG51-FISCAL-454-CALENDAR TO TRUE                    06740004
067500         SET DPG51-DECREMENT-DATE      TO TRUE                    06750004
067600         SET DPG52-LK-DTE-GREG-CC      TO TRUE                    06760004
067700         PERFORM 9100-CALL-DATE-MODULE  THRU 9100-EXIT            06770004
067800         MOVE DPG55-DB2-ISO-DATE-FMT    TO  PV-END-EXTRACT.       06780004
067900 1214-EXIT. EXIT.                                                 06790004
068000                                                                  06800004
068100 1215-CALENDAR-RPT-DTE-RANGE.                                     06810004
068200     MOVE '1215-CALENDAR-RPT-DTE-RANGE' TO PV-PARA-NAME           06820004
068300     IF PV-CURRENT-MM = 01 THEN                                   06830004
068400****   IF JANUARY WANT TO CREATE REPORT FOR PREV. CALENDAR YEAR   06840004
068500         MOVE PV-CDD-ONEYR-CCYY         TO PV-START-EXTRACT-YYYY  06850004
068600                                           PV-END-EXTRACT-YYYY    06860004
068700         MOVE  '-'     TO  PV-START-EXTRACT-1ST                   06870004
068800         MOVE  01      TO  PV-START-EXTRACT-MM                    06880004
068900         MOVE  '-'     TO  PV-START-EXTRACT-2ND                   06890004
069000         MOVE  01      TO  PV-START-EXTRACT-DD                    06900004
069100         MOVE  '-'     TO  PV-END-EXTRACT-1ST                     06910004
069200         MOVE   12     TO  PV-END-EXTRACT-MM                      06920004
069300         MOVE  '-'     TO  PV-END-EXTRACT-2ND                     06930004
069400         MOVE   31     TO  PV-END-EXTRACT-DD                      06940004
069500     ELSE                                                         06950004
069600*        CURRENT MONTH > 01                                       06960004
069700*                          BEGINNING DATE = CURRENT YEAR, 01, 01  06970004
069800*                          ENDING DATE    = CURRENT DATE - 1      06980004
069900         MOVE PV-CURRENT-CCYY TO PV-START-EXTRACT-YYYY            06990004
070000         MOVE  '-'     TO  PV-START-EXTRACT-1ST                   07000004
070100         MOVE  01      TO  PV-START-EXTRACT-MM                    07010004
070200         MOVE  '-'     TO  PV-START-EXTRACT-2ND                   07020004
070300         MOVE  01      TO  PV-START-EXTRACT-DD                    07030004
070400                                                                  07040004
070500         MOVE PV-CURRENT-DB2-DATE-ONE TO PV-END-EXTRACT           07050004
070600     END-IF.                                                      07060004
070700                                                                  07070004
070800 1215-EXIT. EXIT.                                                 07080004
070900                                                                  07090004
071000 1216-SEASONAL-RPT-DTE-RANGE.                                     07100004
071100     MOVE '1216-SEASONAL-RPT-DTE-RANGE' TO PV-PARA-NAME.          07110004
071200*** GET START/END DATES OF THE PREVIOUS MONTH.                    07120004
071300     MOVE   PV-CURRENT-CC      TO  PV-DATE-AREA-CC.               07130004
071400     MOVE   PV-CURRENT-YY      TO  PV-DATE-AREA-YY.               07140004
071500     MOVE   PV-CURRENT-MM      TO  PV-DATE-AREA-MM.               07150004
071600     MOVE   PV-CURRENT-DD      TO  PV-DATE-AREA-DD.               07160004
071700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               07170004
071800     MOVE   PV-DATE-AREA       TO  DPG52-LK-DATE-INPUT.           07180004
071900                                                                  07190004
072000     MOVE PC-TWENTY-EIGHT      TO DPG51-INCR-DECR-DAYS-9.         07200004
072100                                                                  07210004
072200     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      07220004
072300     SET DPG51-DECREMENT-DATE       TO TRUE.                      07230004
072400     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      07240004
072500                                                                  07250004
072600     PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT.              07260004
072700                                                                  07270004
072800     IF DPG56-FISCAL-PERIOD-NBR < 7                               07280004
072900        MOVE PC-SPRING TO PV-SEASON-DESC                          07290004
073000     ELSE                                                         07300004
073100        MOVE PC-FALL   TO PV-SEASON-DESC                          07310004
073200     END-IF.                                                      07320004
073300     IF DPG56-FISCAL-PERIOD-NBR < 6 THEN                          07330004
073400         MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO                       07340004
073500                                  PV-START-EXTRACT                07350004
073600         MOVE PV-CURRENT-DB2-DATE-ONE TO                          07360004
073700                           PV-END-EXTRACT                         07370004
073800     END-IF.                                                      07380004
073900     IF DPG56-FISCAL-PERIOD-NBR = 6 THEN                          07390004
074000         MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO                       07400004
074100                                  PV-START-EXTRACT                07410004
074200         MOVE DPG56-LAST-FD-DB2-ISO-FMT  TO                       07420004
074300                                  PV-END-EXTRACT                  07430004
074400     END-IF.                                                      07440004
074500     IF DPG56-FISCAL-PERIOD-NBR = 7 THEN                          07450004
074600         MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO                       07460004
074700                                  PV-START-EXTRACT                07470004
074800         MOVE PV-CURRENT-DB2-DATE-ONE TO                          07480004
074900                                  PV-END-EXTRACT                  07490004
075000     END-IF.                                                      07500004
075100     IF DPG56-FISCAL-PERIOD-NBR > 7 THEN                          07510004
075200         MOVE PV-CURRENT-DB2-DATE-ONE TO                          07520004
075300                                  PV-END-EXTRACT                  07530004
075400     END-IF.                                                      07540004
075500     IF DPG56-FISCAL-PERIOD-NBR = 12 THEN                         07550004
075600         MOVE DPG56-LAST-FD-DB2-ISO-FMT  TO                       07560004
075700                                  PV-END-EXTRACT                  07570004
075800     END-IF.                                                      07580004
075900     IF DPG56-FISCAL-PERIOD-NBR > 7 THEN                          07590004
076000         MOVE   DPG56-FIRST-FD-DB2-ISO-FMT-YR                     07600004
076100                               TO  PV-YEAR-FORMAT                 07610004
076200         MOVE   PV-YEAR-FORMAT-CC TO                              07620004
076300                                   PV-DATE-AREA-CC                07630004
076400         MOVE   PV-YEAR-FORMAT-YY TO                              07640004
076500                                   PV-DATE-AREA-YY                07650004
076600         MOVE   01             TO  PV-DATE-AREA-MM                07660004
076700         MOVE   01             TO  PV-DATE-AREA-DD                07670004
076800         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           07680004
076900         MOVE   PV-DATE-AREA   TO  DPG52-LK-DATE-INPUT            07690004
077000         MOVE 220              TO DPG51-INCR-DECR-DAYS-9          07700004
077100         SET DPG51-FISCAL-454-CALENDAR  TO TRUE                   07710004
077200         SET DPG51-INCREMENT-DATE       TO TRUE                   07720004
077300         SET DPG52-LK-DTE-GREG-CC       TO TRUE                   07730004
077400         PERFORM 9100-CALL-DATE-MODULE   THRU 9100-EXIT           07740004
077500         MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO                       07750004
077600                                  PV-START-EXTRACT                07760004
077700     END-IF.                                                      07770004
077800 1216-EXIT. EXIT.                                                 07780004
077900                                                                  07790004
078000 1400-COUNT-VRFYD-RECEIPTS.                                       07800004
078100                                                                  07810004
078200     MOVE PV-START-EXTRACT TO                                     07820004
078300          PV-START-RCVR-DATE.                                     07830004
078400                                                                  07840004
078500     MOVE PV-END-EXTRACT TO                                       07850004
078600          PV-END-RCVR-DATE.                                       07860004
078700                                                                  07870004
078800      EXEC SQL                                                    07880004
078900           SELECT COUNT (*)                                       07890004
079000             INTO :PV-RCVRS-VRFYD-QTY                             07900004
079100            FROM  TRECEIV                                         07910004
079200           WHERE (STATUS_CDE         =  :PC-VE                    07920004
079300             AND  VERFYD_TMST        >= :PV-START-RCVR-TMST       07930004
079400             AND  VERFYD_TMST        <= :PV-END-RCVR-TMST         07940004
079500             AND  VER_STATUS_CDE     =  :PC-A)                    07950004
079510               WITH UR                                            07951005
079600      END-EXEC.                                                   07960004
079700                                                                  07970004
079800      EVALUATE TRUE                                               07980004
079900         WHEN SQLCODE = ZERO                                      07990004
080000              CONTINUE                                            08000004
080100         WHEN OTHER                                               08010004
080200              MOVE '1400-COUNT-VRFYD-RECEIPTS' TO                 08020004
080300                   PV-ABEND-PARA-NAME                             08030004
080400              MOVE 'SELECT     '       TO PV-DB2-OPERATION-MSG-1  08040004
080500              MOVE 'TRECEIV'           TO PV-DB2-TABLE-NAME       08050004
080600              PERFORM 9998-SQL-ABEND   THRU 9998-EXIT             08060004
080700      END-EVALUATE.                                               08070004
080800                                                                  08080004
080900 1410-COUNT-VRFYD-TROUBLE.                                        08090004
081000                                                                  08100004
081100      EXEC SQL                                                    08110004
081200           SELECT COUNT (*)                                       08120004
081300             INTO :PV-RCVRS-TRBL-QTY                              08130004
081400            FROM  TRECEIV A                                       08140004
081500           WHERE  A.STATUS_CDE         =  :PC-VE                  08150004
081600             AND  A.VERFYD_TMST        >= :PV-START-RCVR-TMST     08160004
081700             AND  A.VERFYD_TMST        <= :PV-END-RCVR-TMST       08170004
081800             AND  A.VER_STATUS_CDE     =  :PC-A                   08180004
081900             AND (A.IN_TRBL_TMST       = :PC-DEFAULT-TIMESTAMP   08190004
082000              OR  A.IN_TRBL_MIN_CNT    = 0                       08200004
082100              OR  A.IN_TRBL_HOUR_CNT   = 0)                      08210004
082200             AND  EXISTS (SELECT *                                08220004
082300                             FROM TTRBNTF B                       08230004
082400                                , TTRBRSN C                       08240004
082500                            WHERE B.PO_NBR = A.ORD_NBR            08250004
082600                              AND B.REC_SEQ_NBR = A.REC_SEQ_NBR   08260004
082700                              AND B.TRBL_RSN_CDE = C.TRBL_RSN_CDE 08270004
082800                              AND C.NOTIF_IND    = :PC-T)         08280004
082810               WITH UR                                            08281005
082900      END-EXEC.                                                   08290004
083000                                                                  08300004
083100      EVALUATE TRUE                                               08310004
083200         WHEN SQLCODE = ZERO                                      08320004
083300              CONTINUE                                            08330004
083400         WHEN OTHER                                               08340004
083500              MOVE '1410-COUNT-VRFYD-TROUBLE' TO                  08350004
083600                   PV-ABEND-PARA-NAME                             08360004
083700              MOVE 'SELECT     '       TO PV-DB2-OPERATION-MSG-1  08370004
083800              MOVE 'TRECEIV'           TO PV-DB2-TABLE-NAME       08380004
083900              PERFORM 9998-SQL-ABEND   THRU 9998-EXIT             08390004
084000      END-EVALUATE.                                               08400004
084100                                                                  08410004
084200 1500-WRITE-HEADER-RECORD.                                        08420004
084300      INITIALIZE TM001-HEADER-LAYOUT.                             08430004
084400      SET TM001-RECORD-TYPE-HEADER    TO TRUE.                    08440004
084500      SET TM001-RPT-DIV-NA            TO TRUE.                    08450004
084600      MOVE PS-RUN-TYPE-SW             TO TM001-RUN-TYPE-CDE.      08460004
084700      MOVE CC-MODE-IND                TO TM001-RUN-FREQ-CDE.      08470004
084800      MOVE PV-START-EXTRACT           TO TM001-RUN-BEGIN-DATE.    08480004
084900      MOVE PV-END-EXTRACT             TO TM001-RUN-END-DATE.      08490004
085000      MOVE PV-RCVRS-VRFYD-QTY         TO TM001-RCVRS-VRFYD-QTY.   08500004
085100      MOVE PV-RCVRS-TRBL-QTY          TO TM001-VRFYD-TRBL-QTY.    08510004
085200      MOVE PV-SEASON-DESC             TO TM001-SEASONAL-DESC.     08520004
085300      WRITE TE-TROUBLE-EXTRACT-RECORD FROM                        08530004
085400                                  TM001-TROUBLE-EXT-RECORD.       08540004
085500      MOVE TM001-END-YYYY TO                                      08550004
085600           PV-RESOLVE-CHECK-YYYY.                                 08560004
085700      MOVE TM001-END-MM TO                                        08570004
085800           PV-RESOLVE-CHECK-MM.                                   08580004
085900      MOVE TM001-END-DD TO                                        08590004
086000           PV-RESOLVE-CHECK-DD.                                   08600004
086100                                                                  08610004
086200      DISPLAY 'TROUBLE PULL BEGIN DATE IS:  '                     08620004
086300              TM001-RUN-BEGIN-DATE                                08630004
086400              '  AND TROUBLE PULL END DATE IS:    '               08640004
086500              TM001-RUN-END-DATE.                                 08650004
086600 1500-EXIT.   EXIT.                                               08660004
086700                                                                  08670004
086800 1600-OPEN-TTRBNTF-CRS.                                           08680004
086900        EXEC SQL                                                  08690004
087000             OPEN TTRBNTF-READ-CRS                                08700004
087100        END-EXEC.                                                 08710004
087200                                                                  08720004
087300        EVALUATE TRUE                                             08730004
087400           WHEN SQLCODE = ZERO                                    08740004
087500                CONTINUE                                          08750004
087600           WHEN OTHER                                             08760004
087700                MOVE '1600-TTRBNTF-CRS'  TO PV-ABEND-PARA-NAME    08770004
087800                MOVE 'OPEN CURSOR'       TO PV-DB2-OPERATION-MSG-108780004
087900                MOVE 'TTRBNTF'           TO PV-DB2-TABLE-NAME     08790004
088000                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           08800004
088100        END-EVALUATE.                                             08810004
088200 1600-EXIT.   EXIT.                                               08820004
088300                                                                  08830004
088400 3000-CLOSE-TTRBNTF-CRS.                                          08840004
088500        EXEC SQL                                                  08850004
088600            CLOSE TTRBNTF-READ-CRS                                08860004
088700        END-EXEC.                                                 08870004
088800 3000-EXIT.   EXIT.                                               08880004
088900                                                                  08890004
089000 2000-MAIN-LOOP.                                                  08900004
089100        EXEC SQL                                                  08910004
089200          FETCH TTRBNTF-READ-CRS                                  08920004
089300           INTO  :TRBNTF-NOTIF-NBR                                08930004
089400                ,:TRBNTF-OPER-UNT-ID                              08940004
089500                ,:TRBNTF-FCLTY-ID                                 08950004
089600                ,:TRBNTF-DEPT-NBR                                 08960004
089700                ,:TRBNTF-ENT-ID                                   08970004
089800                ,:TRBNTF-PO-NBR                                   08980004
089900                ,:TRBNTF-PO-LNE-NBR                               08990004
090000                ,:TRBNTF-REC-SEQ-NBR                              09000004
090100                ,:TRBNTF-TRBL-RSN-CDE                             09010004
090200                ,:TRBNTF-NOTIF-TMST                               09020004
090300                ,:TRBNTF-NOTIF-UID                                09030004
090400                ,:TRBNTF-RESOLVED-IND                             09040004
090500                ,:TRBNTF-RESOLVED-TMST                            09050004
090600                ,:TRBNTF-RESOLVED-UID                             09060004
090700                ,:TRBNTF-ACKNOWLG-TMST                            09070004
090800                ,:TRBNTF-ACKNOWLG-UID                             09080004
090900                ,:TRBNTF-CNTCT-EXT                                09090004
091000                ,:TRBNTF-FCLTY-AREA-ID                            09100004
091100                ,:TRBNTF-OVER-SHT-PCT                             09110004
091200                ,:TRBNTF-LAST-DTL-CRE-TMST                        09120004
091300                ,:TRBNTF-CRE-IND                                  09130004
091400                ,:TRBNTF-PRORATE-IND                              09140004
091500                ,:TRBNTF-RTV-IND                                  09150004
091600                ,:TRBNTF-RTV-RESPONSE-TMST                        09160004
091700                ,:TRBNTF-PREPK-ID                                 09170004
091800        END-EXEC.                                                 09180004
091900                                                                  09190004
092000       EVALUATE TRUE                                              09200004
092100            WHEN SQLCODE = ZERO                                   09210004
092200                PERFORM 2100-PROCESS-ROW THRU 2100-EXIT           09220004
092300            WHEN SQLCODE = +100                                   09230004
092400                SET  PS-EOD              TO TRUE                  09240004
092500            WHEN OTHER                                            09250004
092600                MOVE '2000-MAIN-LOOP'    TO PV-ABEND-PARA-NAME    09260004
092700                MOVE 'FETCH TTRBNTF-READ-CRS'                     09270004
092800                                         TO PV-DB2-OPERATION-MSG-109280004
092900                MOVE 'TTRBNTF'           TO PV-DB2-TABLE-NAME     09290004
093000                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           09300004
093100        END-EVALUATE.                                             09310004
093200 2000-EXIT.  EXIT.                                                09320004
093300                                                                  09330004
093400 2100-PROCESS-ROW.                                                09340004
093500     INITIALIZE TM001-TROUBLE-EXT-RECORD.                         09350004
093600                                                                  09360004
093700     SET TM001-RECORD-TYPE-DETAIL   TO TRUE.                      09370004
093800     SET TM001-RPT-DIV-NA           TO TRUE.                      09380004
093900     MOVE  TRBNTF-NOTIF-NBR         TO TM001-NOTIF-NBR            09390004
094000     MOVE  TRBNTF-OPER-UNT-ID       TO TM001-OPER-UNT-ID          09400004
094100     MOVE  TRBNTF-FCLTY-ID          TO TM001-FCLTY-ID             09410004
094200     IF TRBNTF-DEPT-NBR = PC-3ZEROS                               09420004
094300         PERFORM 2130-TPURCHS-DEPTENT                             09430004
094400     ELSE                                                         09440004
094500         MOVE  TRBNTF-DEPT-NBR      TO TM001-DEPT-NBR             09450004
094600         MOVE  TRBNTF-ENT-ID        TO TM001-ENT-ID               09460004
094700     END-IF                                                       09470004
095610     MOVE  TRBNTF-PO-NBR            TO TM001-PO-NBR               09561004
095630     MOVE  TRBNTF-PREPK-ID          TO TM001-PREPK-ID             09563004
095640     MOVE  TRBNTF-PO-LNE-NBR        TO TM001-PO-LNE-NBR           09564004
095700     MOVE  TRBNTF-REC-SEQ-NBR       TO TM001-REC-SEQ-NBR          09570004
095900     MOVE  TRBNTF-TRBL-RSN-CDE      TO TM001-TRBL-RSN-CDE         09590004
096000     MOVE  TRBNTF-NOTIF-TMST        TO PV-REFORMAT-TMST.          09600004
096100     PERFORM 2110-REFORMAT-TMST     THRU 2110-EXIT.               09610004
096200     MOVE  PV-REFORMATED-TMST       TO TM001-NOTIF-TMST.          09620004
096300     MOVE  TRBNTF-RESOLVED-TMST     TO PV-REFORMAT-TMST.          09630004
096400     PERFORM 2110-REFORMAT-TMST     THRU 2110-EXIT.               09640004
096500* IF THIS RUN IS SUPPOSED TO USED THE "ACTUAL" TIMEFRAME, MOVE    09650004
096600* THE CURRENT TABLE VALUES TO THE FILE                            09660004
096700     IF PV-RFMTED-DATE > PV-RESOLVE-CHECK-DATE                    09670004
096800     AND NOT CC-ACTUAL-TIMEFRAME                                  09680004
096900        MOVE PC-NEW                  TO TM001-RESOLVED-IND        09690004
097000        MOVE PC-DEFAULT-DATE-TIME    TO TM001-RESOLVED-TMST       09700004
097100     ELSE                                                         09710004
097200         MOVE  TRBNTF-RESOLVED-IND      TO TM001-RESOLVED-IND     09720004
097300         MOVE  PV-REFORMATED-TMST       TO TM001-RESOLVED-TMST    09730004
097400     END-IF.                                                      09740004
097500     MOVE  TRBNTF-FCLTY-AREA-ID     TO TM001-FCLTY-AREA-ID        09750004
097600     MOVE  TRBNTF-OVER-SHT-PCT      TO TM001-OVER-SHT-PCT         09760004
097700     MOVE  TRBNTF-CRE-IND           TO TM001-CRE-IND              09770004
097800                                                                  09780004
097900     EVALUATE TRUE                                                09790004
098000       WHEN TRBNTF-RESOLVED-IND = PC-RESOLVED                     09800004
098100       WHEN TRBNTF-RESOLVED-IND = PC-APPROVED                     09810004
098210         PERFORM 2120-GET-RESOLVED-TIME  THRU 2120-EXIT           09821004
098300         COMPUTE PV-RESOLVED-HOURS =                              09830004
098400          PV-RESOLVED-DAYS * PC-HOURS-PER-DAY + PV-RESOLVED-HOURS 09840004
098500          IF PV-RESOLVED-MINUTES < 0                              09850004
098600             SUBTRACT PC-ONE FROM PV-RESOLVED-HOURS               09860004
098700             COMPUTE PV-RESOLVED-MINUTES =                        09870004
098800                  PV-RESOLVED-MINUTES + PC-MINUTES-PER-HOUR       09880004
098900          END-IF                                                  09890004
099000       WHEN OTHER                                                 09900004
099100          MOVE 0         TO PV-RESOLVED-HOURS                     09910004
099200          MOVE 0         TO PV-RESOLVED-MINUTES                   09920004
099300     END-EVALUATE                                                 09930004
099400                                                                  09940004
099500     MOVE PV-RESOLVED-HOURS    TO TM001-RESOLVED-HOURS.           09950004
099600     MOVE PV-RESOLVED-MINUTES  TO TM001-RESOLVED-MINUTES.         09960004
099700                                                                  09970004
099800     WRITE TE-TROUBLE-EXTRACT-RECORD FROM                         09980004
099900                                  TM001-TROUBLE-EXT-RECORD.       09990004
100000     ADD  1      TO PV-RECORD-COUNT.                              10000004
100100 2100-EXIT.  EXIT.                                                10010004
100200                                                                  10020004
100300 2110-REFORMAT-TMST.                                              10030004
100400     MOVE PV-RF-YYYY    TO PV-RFMTED-YYYY.                        10040004
100500     MOVE PV-RF-MM      TO PV-RFMTED-MM.                          10050004
100600     MOVE PV-RF-DD      TO PV-RFMTED-DD.                          10060004
100700     MOVE PV-RF-HH      TO PV-RFMTED-HH.                          10070004
100800     MOVE PV-RF-MIN     TO PV-RFMTED-MIN.                         10080004
100900     MOVE PV-RF-SS      TO PV-RFMTED-SS.                          10090004
101000 2110-EXIT.  EXIT.                                                10100004
101100                                                                  10110004
101200 2120-GET-RESOLVED-TIME.                                          10120004
101300        EXEC SQL                                                  10130004
101400         SELECT   (DAYS(RESOLVED_TMST)   - DAYS(NOTIF_TMST))      10140004
101500                 ,(HOUR(RESOLVED_TMST)   - HOUR(NOTIF_TMST))      10150004
101600                 ,(MINUTE(RESOLVED_TMST) - MINUTE(NOTIF_TMST))    10160004
101700         INTO    :PV-RESOLVED-DAYS                                10170004
101800                ,:PV-RESOLVED-HOURS                               10180004
101900                ,:PV-RESOLVED-MINUTES                             10190004
102000         FROM   TTRBNTF                                           10200004
102100         WHERE  NOTIF_NBR = :TM001-NOTIF-NBR                      10210004
102110               WITH UR                                            10211005
102200        END-EXEC.                                                 10220004
102300                                                                  10230004
102400       EVALUATE TRUE                                              10240004
102500            WHEN SQLCODE = ZERO                                   10250004
102600                CONTINUE                                          10260004
102700            WHEN OTHER                                            10270004
102800                MOVE '2120-GET-RESOLVED-TIME'                     10280004
102900                                         TO PV-ABEND-PARA-NAME    10290004
103000                MOVE 'SELECT '           TO PV-DB2-OPERATION-MSG-110300004
103100                MOVE TM001-NOTIF-NBR     TO PV-NOTIF-NBR          10310004
103200                STRING 'NOTIF NBR: '   DELIMITED BY SIZE          10320004
103300                       PV-NOTIF-NBR    DELIMITED BY SIZE          10330004
103400                                       INTO PV-DB2-OPERATION-MSG-210340004
103500                MOVE 'TTRBNTF'           TO PV-DB2-TABLE-NAME     10350004
103600                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           10360004
103700        END-EVALUATE.                                             10370004
103800 2120-EXIT.  EXIT.                                                10380004
103900                                                                  10390004
104000 2130-TPURCHS-DEPTENT.                                            10400004
104100     EXEC SQL                                                     10410004
104200         SELECT A.PO_NBR                                          10420004
104300              , A.ENT_ID                                          10430004
104400              , A.DEPT_NBR                                        10440004
104500         INTO   :PURCHS-PO-NBR                                    10450004
104600              , :PURCHS-ENT-ID                                    10460004
104700              , :PURCHS-DEPT-NBR                                  10470004
104800         FROM   TPURCHS A                                         10480004
104900         WHERE  A.PO_NBR     = :TRBNTF-PO-NBR                     10490004
105000           AND  A.VER_STATUS_CDE = 'A'                            10500004
105100               WITH UR                                            10510005
105110     END-EXEC.                                                    10511004
105200                                                                  10520004
105300     EVALUATE TRUE                                                10530004
105400         WHEN SQLCODE = +0                                        10540004
105500             MOVE PURCHS-ENT-ID    TO TM001-ENT-ID                10550004
105600             MOVE PURCHS-DEPT-NBR  TO TM001-DEPT-NBR              10560004
105700         WHEN SQLCODE = +100                                      10570004
105800             DISPLAY '* * * * * * * * * * * * * * * * * * * * *'  10580004
105900             DISPLAY '**** PURCHASE ORDER NOT FOUND ON TPURCHS'   10590004
106000             DISPLAY '**** TRBNTF-DEPT = ZEROS                '   10600004
106100             DISPLAY '**** TTRBNTF PO      :' TRBNTF-PO-NBR       10610004
106200             DISPLAY '**** TTRBNTF REC SEQ :' TRBNTF-REC-SEQ-NBR  10620004
106300             DISPLAY '**** TTRBNTF TRBL RSN:' TRBNTF-TRBL-RSN-CDE 10630004
106400             DISPLAY '* * * * * * * * * * * * * * * * * * * * *'  10640004
106500         WHEN OTHER                                               10650004
106600             MOVE '2130-TPURCHS-DEPTENT  ' TO PV-ABEND-PARA-NAME  10660004
106700             MOVE 'SELECT ON TPURCHS     '                        10670004
106800                                      TO PV-DB2-OPERATION-MSG-1   10680004
106900             MOVE 'TPURCHS'           TO PV-DB2-TABLE-NAME        10690004
107000             PERFORM 9998-SQL-ABEND                               10700004
107100     END-EVALUATE.                                                10710004
110000                                                                  11000004
110120 9100-CALL-DATE-MODULE.                                           11012004
110200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            11020004
110300                           USING DPG51 DPG52 DPG53                11030004
110400                                 DPG54 DPG55 DPG56.               11040004
110500     IF  PV-PARA-NAME = '1100-CHECK-CC-PARAMETERS'                11050004
110600         IF DPG54-DATE-INVALID                                    11060004
110700            GO TO 9100-EXIT                                       11070004
110800         END-IF                                                   11080004
110900     END-IF                                                       11090004
111000                                                                  11100004
111100     EVALUATE TRUE                                                11110004
111200         WHEN DPG54-SEVERE-ERROR                                  11120004
111300             DISPLAY '** ABEND **'                                11130004
111400             DISPLAY '** PGM = TMKUT002'                          11140004
111500             DISPLAY PV-PARA-NAME                                 11150004
111600             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. '  11160004
111700             DISPLAY '** ERROR MESSAGE = '                        11170004
111800                     DPG54-ERROR-MESSAGE                          11180004
111900             DISPLAY '** DPG51 = ' DPG51                          11190004
112000             DISPLAY '** DPG52 = ' DPG52                          11200004
112100             DISPLAY '** DPG53 = ' DPG53                          11210004
112200             DISPLAY '** DPG54 = ' DPG54                          11220004
112300             MOVE +4003 TO PV-ABEND-CODE                          11230004
112400             CALL 'ILBOABN0' USING PV-ABEND-CODE                  11240004
112500         WHEN OTHER                                               11250004
112600             CONTINUE                                             11260004
112700     END-EVALUATE.                                                11270004
112800 9100-EXIT.   EXIT.                                               11280004
112900                                                                  11290004
113000 9998-SQL-ABEND.                                                  11300004
113100     MOVE SQLCODE     TO PV-SQLCODE.                              11310004
113200     DISPLAY '** ABEND           ** = SQLABEND'.                  11320004
113300     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          11330004
113400     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME        11340004
113500     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        11350004
113600     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   11360004
113700     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MSG-2.   11370004
113800     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               11380004
113900     COPY DPPD004.                                                11390004
114000                                                                  11400004
114100     MOVE +4013                  TO PV-ABEND-CODE.                11410004
114200     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       11420004
114300 9998-EXIT.  EXIT.                                                11430004
114400                                                                  11440004
114500 9999-ABORT.                                                      11450004
114600      DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                    11460004
114700      CALL 'ILBOABN0'   USING PV-ABEND-CODE.                      11470004
114800 9999-EXIT.  EXIT.                                                11480004
114900                                                                  11490004
