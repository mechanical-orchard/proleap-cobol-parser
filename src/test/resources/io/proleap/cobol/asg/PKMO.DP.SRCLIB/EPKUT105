000100 IDENTIFICATION DIVISION.                                         00010059
000200 PROGRAM-ID.      EPKUT105.                                       00020059
000300 AUTHOR.          PAUL OMAN.                                      00030059
000400 DATE-WRITTEN.    MARCH 2003.                                     00040059
000500                                                                  00050059
000600*--------------------------------------------------------------*  00060059
000700*                                                              *  00070059
000800*  INPUTS:                                                     *  00080059
000900*      EPCC105   CONTAINS TIMESTAMP WHEN PROCESS WAS LAST RUN. *  00090059
001000*     (EPWS105)  USED IN CURSORS.                              *  00100059
001100*                                                              *  00110059
001200*      EPCC112   CONTAINS TOMORROW'S DATE, BASED ON THE JOB    *  00120059
001300*     (EPWS112)  SCHEDULED DATE.                               *  00130059
001400*                                                              *  00140059
001500* OUTPUTS:                                                     *  00150059
001600*                                                              *  00160059
001700*      EPRD074   FILE OF ADDED DUMMY DATA. USED BY EPKUT104    *  00170059
001800*     (EPRD074)  TO DRIVE GETTING CORRESPONDING XREF DATA      *  00180059
001900*                INCLUDED IN THAT EXTRACT FILE.                *  00190059
002000*                                                              *  00200059
002100*      EPRD219   FILE OF EXTRACTED SKU DATA FOR SQL SERVER.    *  00210059
002200*     (EPRD219)                                                *  00220059
002300*                                                              *  00230059
002400*      EPRD220   FILE OF EXTRACTED SKU PRICING DATA            *  00240059
002500*     (EPRD220)                        FOR SQL SERVER.         *  00250059
002600*                                                              *  00260059
002700* DESCRIPTION:                                                 *  00270059
002800*                                                              *  00280059
002900*      PROGRAM CONTAINS SIX CURSORS WHICH ARE GROUPED INTO     *  00290059
003000*  THREE DIFFERENT PROCESSES.                                  *  00300059
003100*      THE FIRST PROCESS EXTRACTS CHANGES THAT HAVE OCCURRED   *  00310059
003200*  AT THE DEPARTMENT AND SUB CLASS LEVEL WITH ONE CURSOR. A    *  00320059
003300*  SECOND CURSOR IS THEN USED TO EXTRACT ALL OF THE RELATED    *  00330059
003400*  SKUS THAT NEED TO HAVE UPDATES APPLIED TO THEM. OUTPUT      *  00340059
003500*  PLU RECORDS ARE CREATED FOR EACH OF THE EXTRACTED SKUS.     *  00350059
003600*      IF THERE HAVE BEEN SUB CLASS ADDS OR UPDATES, DUMMY     *  00360059
003700*  PLU RECORDS ARE CREATED AND DUMMY XREF RECORDS IF REQUIRED. *  00370059
003800*  SUBCLASS ADDS WILL TRIGGER CREATION OF ADD RECORDS FOR THE  *  00380059
003900*  RESULTING DUMMY SKUS, FOR THE SKU AND SKU PRICING OUTPUT    *  00390059
004000*  FILES FOR SQL SERVER.                                       *  00400059
004100*  A SUBCLASS UPDATE WILL TRIGGER CREATION OF AN UPDATE RECORD *  00410059
004200*  FOR THE DUMMY SKU FOR THE SKU FILE FOR SQL SERVER.          *  00420059
004300*                                                              *  00430059
004400*      THE SECOND PROCESS EXTRACTS CHANGES THAT HAVE OCCURRED  *  00440059
004500*  AT THE VENDOR LEVEL WITH ONE CURSOR. A SECOND CURSOR IS     *  00450059
004600*  THEN USED TO EXTRACT ALL OF THE RELATED SKUS THAT NEED TO   *  00460059
004700*  HAVE UPDATES APPLIED TO THEM. OUTPUT PLU RECORDS ARE        *  00470059
004800*  CREATED FOR EACH OF THE EXTRACTED SKUS.                     *  00480059
004900*  NO RECORDS WILL BE CREATED BY THIS PROCESS FOR SQL SERVER.  *  00490059
005000*                                                              *  00500059
005100*      THE THIRD PROCESS EXTRACTS CHANGES THAT HAVE OCCURRED   *  00510059
005200*  AT THE VENDOR DEPARTMENT LEVEL WITH ONE CURSOR. A SECOND    *  00520059
005300*  CURSOR IS USED TO EXTRACT ALL OF THE RELATED SKUS THAT      *  00530059
005400*  NEED TO HAVE UPDATES APPLIED TO THEM.  OUTPUT PLU RECORDS   *  00540059
005500*  ARE CREATED FOR EACH OF THE EXTRACTED SKUS.                 *  00550059
005600*  NO RECORDS WILL BE CREATED BY THIS PROCESS FOR SQL SERVER.  *  00560059
005700*                                                              *  00570059
005800*  NOTE: ONE PARAGRAPH IS USED TO OPEN ALL OF THE CURSORS AND  *  00580059
005900*        ONE PARAGRAPH IS USED TO CLOSE ALL OF THE CURSORS.    *  00590059
006000*        SWITCHES ARE USED TO CONTROL WHICH ONE TO OPEN OR     *  00600059
006100*        CLOSE.                                                *  00610059
006200*                                                              *  00620059
006300*--------------------------------------------------------------*  00630059
006400* HISTORY LOG:                                                    00640059
006500*--------------------------------------------------------------*  00650059
006600* DATE:  APRIL 2010                                               00660059
006700* WR/IR#: WR38172                                                 00670059
006800* PROGRAMMER: DAVE WELLER                                         00680059
006900* DESCRIPTION: - E_BUS_ITM_IND SENT TO STORES SET TO              00690059
007000*                TWEBITM COLUMN WEB_EXCLV_IND                     00700059
007100*--------------------------------------------------------------*  00710059
007200* DATE:  MARCH 2009                                               00720059
007300* WR/IR#: WR35484                                                 00730059
007400* PROGRAMMER: CHUCK HERO                                          00740059
007500* DESCRIPTION: - ADD SKU AND SKU PRICING LAYOUT OUTPUT FILES      00750059
007600*                FOR NEW SQL SERVER STORE DATABASE                00760059
007700*              - RENUMBERED PARAGRAPHS TO FACILITATE FLOW OF NEW  00770059
007800*              - CORRECTED POS MDSE DESCR. POPULATION TO FMS FILE 00780059
007900*                                                                 00790059
008000*--------------------------------------------------------------*  00800059
008100* DATE:  07 JUNE 2011                                             00810059
008200* WR/IR#: PKE#8048                                                00820059
008300* PROGRAMMER: COGNIZANT                                           00830059
008400* DESCRIPTION: - CHANGED THE MERCH-CHGS-CSR CURSOR TO ALSO        00840059
008500*                CHECK THE LAST UPDATED TIMESTAMP WITH CURRENT    00850059
008600*                EXTRACT RUN TIMESTAMP.                           00860059
008700*                                                                 00870059
008800*--------------------------------------------------------------*  00880059
008900* DATE:                                                           00890059
009000* WR/IR#:                                                         00900059
009100* PROGRAMMER:                                                     00910059
009200* DESCRIPTION:                                                    00920059
009300*                                                                 00930059
009400*--------------------------------------------------------------*  00940059
009500 ENVIRONMENT DIVISION.                                            00950059
009600*--------------------------------------------------------------*  00960059
009700 CONFIGURATION SECTION.                                           00970059
009800 SOURCE-COMPUTER.        IBM-3090.                                00980059
009900 OBJECT-COMPUTER.        IBM-3090.                                00990059
010000                                                                  01000059
010100 INPUT-OUTPUT SECTION.                                            01010059
010200                                                                  01020059
010300 FILE-CONTROL.                                                    01030059
010400                                                                  01040059
010500     SELECT CONTROL-CARD-TIMESTAMP                                01050059
010600            ASSIGN TO INP01.                                      01060059
010700                                                                  01070059
010800     SELECT CONTROL-CARD-BATCH-DATE                               01080059
010900            ASSIGN TO INP02.                                      01090059
011000                                                                  01100059
011100     SELECT DUMMY-XREF-DRIVER                                     01110059
011200            ASSIGN TO OUT01.                                      01120062
011300                                                                  01130059
011400     SELECT SKU-CHG-GLOBAL-FILE                                   01140059
011500            ASSIGN TO OUT02.                                      01150062
011600                                                                  01160059
011700     SELECT SKU-PRICING-CHG-GLOBAL-FILE                           01170059
011800            ASSIGN TO OUT03.                                      01180062
011900                                                                  01190059
012000 DATA DIVISION.                                                   01200059
012100 FILE SECTION.                                                    01210059
012200                                                                  01220059
012300                                                                  01230059
012400 FD  CONTROL-CARD-TIMESTAMP                                       01240059
012500     RECORDING MODE F                                             01250059
012600     BLOCK CONTAINS 0 RECORDS                                     01260059
012700     LABEL RECORDS ARE OMITTED                                    01270059
012800     DATA RECORD IS CONTROL-TIMESTAMP-RECORD.                     01280059
012900 01  CONTROL-TIMESTAMP-RECORD     PIC  X(080).                    01290059
013000                                                                  01300059
013100 FD  CONTROL-CARD-BATCH-DATE                                      01310059
013200     RECORDING MODE F                                             01320059
013300     BLOCK CONTAINS 0 RECORDS                                     01330059
013400     LABEL RECORDS ARE OMITTED                                    01340059
013500     DATA RECORD IS CONTROL-BATCH-DATE-RECORD.                    01350059
013600 01  CONTROL-BATCH-DATE-RECORD    PIC  X(080).                    01360059
013700                                                                  01370059
013800 FD  DUMMY-XREF-DRIVER                                            01380059
013900     RECORDING MODE F                                             01390059
014000     BLOCK CONTAINS 0 RECORDS                                     01400059
014100     LABEL RECORDS ARE OMITTED                                    01410059
014200     DATA RECORD IS DUMMY-XREF-RECORD.                            01420059
014300 01  DUMMY-XREF-RECORD               PIC  X(050).                 01430059
014400                                                                  01440059
014500 FD  SKU-CHG-GLOBAL-FILE                                          01450059
014600     RECORDING MODE F                                             01460059
014700     BLOCK CONTAINS 0 RECORDS                                     01470059
014800     LABEL RECORDS ARE OMITTED                                    01480059
014900     DATA RECORD IS SKU-CHG-GLOBAL-RECORD.                        01490059
015000 01  SKU-CHG-GLOBAL-RECORD           PIC X(170).                  01500059
015100                                                                  01510059
015200 FD  SKU-PRICING-CHG-GLOBAL-FILE                                  01520059
015300     RECORDING MODE F                                             01530059
015400     BLOCK CONTAINS 0 RECORDS                                     01540059
015500     LABEL RECORDS ARE OMITTED                                    01550059
015600     DATA RECORD IS SKU-PRICING-CHG-GLOBAL-RECORD.                01560059
015700 01  SKU-PRICING-CHG-GLOBAL-RECORD   PIC X(260).                  01570059
015800                                                                  01580059
015900 WORKING-STORAGE SECTION.                                         01590059
016000*--------------------------------------------------------------*  01600059
016100* PS - PROGRAM SWITCHES                                           01610059
016200*--------------------------------------------------------------*  01620059
016300 01  PS-PROGRAM-SWITCHES.                                         01630059
016400     05  PS-END-OF-CNTL-CRD-SW        PIC  X(001).                01640059
016500         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      01650059
016600         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      01660059
016700                                                                  01670059
016800     05  PS-END-OF-MERCH-CHGS-CSR-SW  PIC  X(001).                01680059
016900         88  PS-END-OF-MERCH-CHGS-CSR             VALUE 'Y'.      01690059
017000         88  PS-NOT-END-OF-MERCH-CHGS-CSR         VALUE 'N'.      01700059
017100                                                                  01710059
017200     05  PS-OPEN-CURSOR-SW              PIC  X(001).              01720059
017300         88  PS-OPEN-MERCH-CHGS-CSR                 VALUE 'A'.    01730059
017400                                                                  01740059
017500     05  PS-CLOSE-CURSOR-SW             PIC  X(001).              01750059
017600         88  PS-CLOSE-MERCH-CHGS-CSR                VALUE 'A'.    01760059
017700                                                                  01770059
017800*--------------------------------------------------------------*  01780059
017900* PROGRAM CONSTANTS                                               01790059
018000*--------------------------------------------------------------*  01800059
018100 01  PC-PROGRAM-CONSTANTS.                                        01810059
018200     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'EPKUT105'.     01820059
018300     05  PC-MAX-RETRIES           PIC S9(9) VALUE +5.             01830059
018400     05  PC-FIVE-BLANKS           PIC X(05) VALUE SPACES.         01840059
018500     05  PC-TEN-BLANKS            PIC X(10) VALUE SPACES.         01850059
018600     05  PC-ASTERISK-LINE         PIC X(80) VALUE ALL '*'.        01860059
018700                                                                  01870059
018800     05  PC-PRIC-EFF-TIME-STD      PIC X(08)  VALUE '03:00:00'.   01880059
018900     05  PC-MDSE-HIER-SKU          PIC X(03)  VALUE 'SKU'.        01890059
019000     05  PC-NULL-CHAR              PIC X(01)  VALUE '~'.          01900059
019100     05  PC-DUMMY-STATUS           PIC X(02)  VALUE '00'.         01910059
019200     05  PC-STR-GRP-TYP-CDE-CORP   PIC 9(05)  VALUE 1000.         01920059
019300     05  PC-STR-GRP-ID-CORP        PIC 9(10)  VALUE 0000000001.   01930059
019400                                                                  01940059
019500*--------------------------------------------------------------*  01950059
019600* PV- PROGRAM VARIABLES                                           01960059
019700*--------------------------------------------------------------*  01970059
019800 01  PV-PROGRAM-VARAIBLES.                                        01980059
019900     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       01990059
020000     05  PV-CURSOR-NAME           PIC X(18)   VALUE SPACES.       02000059
020100     05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       02010059
020200     05  PV-SQL-SUB               PIC S9(04)  VALUE 0  COMP.      02020059
020300     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      02030059
020400                                                                  02040059
020500     05  PV-RETRY-COUNT           PIC S9(04)  VALUE ZERO          02050059
020600                                              COMP SYNC.          02060059
020700     05  PV-DISPLAY-INTERNAL      PIC  9(10) VALUE ZERO.          02070059
020800     05  PV-STRING-DEPT-NBR       PIC  9(4) VALUE 0.              02080059
020900     05  PV-STRING-SUB-CL-NBR     PIC  9(4) VALUE 0.              02090059
021000                                                                  02100059
021100     05  PV-SAVE-DEPT-NBR          PIC 9(04)  VALUE 0.            02110059
021200     05  FILLER REDEFINES PV-SAVE-DEPT-NBR.                       02120059
021300         10  FILLER                PIC X(01).                     02130059
021400         10  PV-SAVE-DEPT-NBR-X    PIC X(03).                     02140059
021500     05  PV-SAVE-SUB-CL-NBR        PIC 9(04)  VALUE 0.            02150059
021600     05  FILLER REDEFINES PV-SAVE-SUB-CL-NBR.                     02160059
021700         10  FILLER                PIC X(02).                     02170059
021800         10  PV-SAVE-SUB-CL-NBR-X  PIC X(02).                     02180059
021900                                                                  02190059
022000     05  PV-INTR-UPC-ID-DUMMY.                                    02200059
022100         10  PV-INTR-UPC-ID-99     PIC X(02)  VALUE '99'.         02210059
022200         10  PV-INTR-UPC-ID-DEPT   PIC X(03)  VALUE SPACES.       02220059
022300         10  PV-INTR-UPC-ID-CLASS  PIC X(02)  VALUE SPACES.       02230059
022400         10  PV-INTR-UPC-ID-ZEROES PIC X(05)  VALUE '00000'.      02240059
022500                                                                  02250059
022600     05  PV-SKU-NBR-DUMMY.                                        02260059
022700         10  PV-SKU-NBR-DEPT       PIC X(03)  VALUE SPACES.       02270059
022800         10  PV-SKU-NBR-CLASS      PIC X(02)  VALUE SPACES.       02280059
022900         10  PV-SKU-NBR-ZEROES     PIC X(03)  VALUE '000'.        02290059
023000                                                                  02300059
023100     05  PV-PRIC-EFF-TMST.                                        02310059
023200         10  PV-PRIC-EFF-DTE              PIC X(10).              02320059
023300         10  FILLER                       PIC X(01) VALUE SPACE.  02330059
023400         10  PV-PRIC-EFF-TIME             PIC X(08).              02340059
023500                                                                  02350059
023600*--------------------------------------------------------------*  02360059
023700* PV- DB2 VARIABLES.                                              02370059
023800*--------------------------------------------------------------*  02380059
023900 01  PV-DB2-VARAIBLES.                                            02390059
024000     05  PV-DB2-DEPT-NBR          PIC S9(4)V COMP-3 VALUE 0.      02400059
024100     05  PV-DB2-MAJ-CL-NBR        PIC S9(4)V COMP-3 VALUE 0.      02410059
024200     05  PV-DB2-SUB-CL-NBR        PIC S9(4)V COMP-3 VALUE 0.      02420059
024300                                                                  02430059
024400*--------------------------------------------------------------*  02440059
024500* EPWS105 CONTROL CARD LAYOUT - TIMESTAMP CONTROL CARD            02450059
024600*--------------------------------------------------------------*  02460059
024700     COPY EPWS105.                                                02470059
024800                                                                  02480059
024900*--------------------------------------------------------------*  02490059
025000* EPWS112 CONTROL CARD LAYOUT - BATCH RUN DATE                    02500059
025100*--------------------------------------------------------------*  02510059
025200     COPY EPWS112.                                                02520059
025300                                                                  02530059
025400*--------------------------------------------------------------*  02540059
025500* EPRD074 DUMMY XREF DRIVER                                       02550059
025600*--------------------------------------------------------------*  02560059
025700     COPY EPRD074.                                                02570059
025800                                                                  02580059
025900*--------------------------------------------------------------*  02590059
026000* EPRD219 SKU FILE RECORD LAYOUT FOR SQL SERVER                   02600059
026100*--------------------------------------------------------------*  02610059
026200     COPY EPRD219.                                                02620059
026300                                                                  02630059
026400*--------------------------------------------------------------*  02640059
026500* EPRD220 SKU PRICING FILE RECORD LAYOUT FOR SQL SERVER           02650059
026600*--------------------------------------------------------------*  02660059
026700     COPY EPRD220.                                                02670059
026800                                                                  02680059
026900*--------------------------------------------------------------*  02690059
027000* DATE ROUTINE COPY MEMBERS                                       02700059
027100*--------------------------------------------------------------*  02710059
027200     COPY DPWS500.                                                02720059
027300                                                                  02730059
027400*--------------------------------------------------------------*  02740059
027500* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02750059
027600*--------------------------------------------------------------*  02760059
027700     COPY DPWS004.                                                02770059
027800                                                                  02780059
027900*--------------------------------------------------------------*  02790059
028000* DB2 ABEND COPYBOOK                                              02800059
028100*--------------------------------------------------------------*  02810059
028200     COPY DPWS900.                                                02820059
028300                                                                  02830059
028400*--------------------------------------------------------------*  02840059
028500* DB2 MESSAGE AREA                                                02850059
028600*--------------------------------------------------------------*  02860059
028700     COPY SQLCA2.                                                 02870059
028800                                                                  02880059
028900*--------------------------------------------------------------*  02890059
029000* PROGRAM COUNTERS                                                02900059
029100*--------------------------------------------------------------*  02910059
029200 01  PV-PROGRAM-COUNTERS             COMP-3.                      02920059
029300     05  PV-MERCH-CHGS-FETCHES       PIC 9(9) VALUE 0.            02930059
029400                                                                  02940059
029500     05  PV-CNT-OUTPUT-RECORDS       PIC 9(9) VALUE 0.            02950059
029600     05  PV-CNT-EP074-RECORDS        PIC 9(9) VALUE 0.            02960059
029700                                                                  02970059
029800     05  PV-CNT-SKU-DUMMY-ADDS       PIC 9(9) VALUE 0.            02980059
029900     05  PV-CNT-SKU-PRICG-DUMMY-ADDS PIC 9(9) VALUE 0.            02990059
030000     05  PV-CNT-SKU-DUMMY-UPDS       PIC 9(9) VALUE 0.            03000059
030100     05  PV-CNT-EP219-RECORDS        PIC 9(9) VALUE 0.            03010059
030200     05  PV-CNT-EP220-RECORDS        PIC 9(9) VALUE 0.            03020059
030300                                                                  03030059
030400*--------------------------------------------------------------*  03040059
030500* ERROR HANDLING                                                  03050059
030600*--------------------------------------------------------------*  03060059
030700 01  PV-MISC-ABEND-FIELDS.                                        03070059
030800     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          03080059
030900     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          03090059
031000     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          03100059
031100                                                                  03110059
031200 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    03120059
031300     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           03130059
031400     88  ABEND-4013-DB2-ERROR              VALUE +4013.           03140059
031500     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           03150059
031600     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           03160059
031700     88  ABEND-4008-PGM-LOGIC-ERROR        VALUE +4008.           03170059
031800     88  ABEND-4005                        VALUE +4005.           03180059
031900                                                                  03190059
032000*--------------------------------------------------------------*  03200059
032100* DB2 COMMUNICATIONS AREA                                         03210059
032200*--------------------------------------------------------------*  03220059
032300     EXEC SQL                                                     03230059
032400       INCLUDE SQLCA                                              03240059
032500     END-EXEC.                                                    03250059
032600                                                                  03260059
032700*--------------------------------------------------------------*  03270059
032800* DB2 TABLE XST00014 (XST_SUB_CL) - SUB CLASS                     03280059
032900*--------------------------------------------------------------*  03290059
033000     EXEC SQL                                                     03300059
033100       INCLUDE XST00014                                           03310059
033200     END-EXEC.                                                    03320059
033300                                                                  03330059
033400*--------------------------------------------------------------*  03340059
033500*  CURSOR TO IDENTIFY CHANGES TO THE DEPARTMENT OR SUBCLASS    *  03350059
033600*  TABLES.                                                     *  03360059
033700*--------------------------------------------------------------*  03370059
033800     EXEC SQL                                                     03380059
033900       DECLARE MERCH-CHGS-CSR CURSOR FOR                          03390059
034000                                                                  03400059
034100         SELECT  SUBCL.DEPT_NBR                                   03410059
034200                ,SUBCL.MAJ_CL_NBR                                 03420059
034300                ,SUBCL.SUB_CL_NBR                                 03430059
034400                ,SUBCL.POS_MDSE_DESC                              03440059
034500                ,SUBCL.LAST_UPD_TMST                              03450059
034600                ,SUBCL.CRE_TMST                                   03460059
034700                                                                  03470059
034800           FROM  XST_SUB_CL  SUBCL                                03480059
034900                                                                  03490059
035000         WHERE (SUBCL.LAST_UPD_TMST > :CC-EPCC105-PREV-TIMESTAMP  03500060
035100           AND SUBCL.LAST_UPD_TMST <= :CC-EPCC105-CRNT-TIMESTAMP) 03510059
035200                                                                  03520059
035300         FOR FETCH ONLY                                           03530059
035400         WITH UR                                                  03540059
035500                                                                  03550059
035600     END-EXEC.                                                    03560059
035700                                                                  03570059
035800 LINKAGE SECTION.                                                 03580059
035900                                                                  03590059
036000*--------------------------------------------------------------*  03600059
036100 PROCEDURE DIVISION.                                              03610059
036200*--------------------------------------------------------------*  03620059
036300 0000-MAINLINE.                                                   03630059
036400                                                                  03640059
036500     PERFORM 1000-INITIALIZATION.                                 03650059
036600                                                                  03660059
036700     PERFORM 2000-CREATE-MERCH-CHANGES-LIST.                      03670059
036800                                                                  03680059
036900     PERFORM 9999-WRAPUP.                                         03690059
037000                                                                  03700059
037100     GOBACK.                                                      03710059
037200                                                                  03720059
037300*0000-EXIT.                                                       03730059
037400                                                                  03740059
037500                                                                  03750059
037600*--------------------------------------------------------------*  03760059
037700* 1000-INITIALIZATION.                                            03770059
037800*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      03780059
037900*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      03790059
038000*     PARAMETERS IT MAY NEED.                                     03800059
038100*--------------------------------------------------------------*  03810059
038200 1000-INITIALIZATION.                                             03820059
038300                                                                  03830059
038400     OPEN INPUT  CONTROL-CARD-BATCH-DATE                          03840059
038500                 CONTROL-CARD-TIMESTAMP.                          03850059
038600     OPEN OUTPUT DUMMY-XREF-DRIVER                                03860059
038700                 SKU-CHG-GLOBAL-FILE                              03870059
038800                 SKU-PRICING-CHG-GLOBAL-FILE.                     03880059
038900     DISPLAY ' '.                                                 03890059
039000     DISPLAY '*********************************************'.     03900059
039100     DISPLAY '       PROGRAM NAME: ' PC-PROGRAM-NAME.             03910059
039200     DISPLAY '*********************************************'.     03920059
039300     DISPLAY ' '.                                                 03930059
039400                                                                  03940059
039500     PERFORM 1030-READ-BATCH-DATE-RECORD.                         03950059
039600     PERFORM 1040-READ-TIMESTAMP-RECORD.                          03960059
039700                                                                  03970059
039800     MOVE CC-EPCC112-TOMORROW-DATE  TO PV-PRIC-EFF-DTE.           03980059
039900     MOVE PC-PRIC-EFF-TIME-STD      TO PV-PRIC-EFF-TIME.          03990059
040000     DISPLAY 'PRIC EFF TMST TO SQLS: ' PV-PRIC-EFF-TMST.          04000059
040100                                                                  04010059
040200*1000-EXIT.                                                       04020059
040300                                                                  04030059
040400*--------------------------------------------------------------*  04040059
040500* 1030-READ-BATCH-DATE-RECORD.                                    04050059
040600*     READ CONTROL CARD EPCC112. THIS CONTROL CARD CONTAINS       04060059
040700*     THE CURRENT BATCH DATE.                                     04070059
040800*--------------------------------------------------------------*  04080059
040900 1030-READ-BATCH-DATE-RECORD.                                     04090059
041000                                                                  04100059
041100     READ CONTROL-CARD-BATCH-DATE                                 04110059
041200                               INTO CC-EPCC112-CONTROL-CARD       04120059
041300       AT END                                                     04130059
041400          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    04140059
041500                                                                  04150059
041600     IF PS-END-OF-CNTL-CRD-FILE                                   04160059
041700       DISPLAY ' '                                                04170059
041800       DISPLAY '** ABEND     **'                                  04180059
041900       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              04190059
042000       DISPLAY '** PARAGRAPH **  = 1030-READ-BATCH-DATE-RECORD'   04200059
042100       DISPLAY '** CONTROL FILE IS EMPTY  '                       04210059
042200       DISPLAY ' '                                                04220059
042300       MOVE +4003 TO ABEND-CODE                                   04230059
042400       CALL 'ILBOABN0' USING ABEND-CODE                           04240059
042500     ELSE                                                         04250059
042600       DISPLAY '** CURRENT BATCH DATE CONTROL CARD    **'         04260059
042700       DISPLAY '** EPCC112       **  = ' CC-EPCC112-TOMORROW-DATE 04270059
042800       DISPLAY ' '                                                04280059
042900                                                                  04290059
043000     END-IF.                                                      04300059
043100                                                                  04310059
043200*1030-EXIT.                                                       04320059
043300                                                                  04330059
043400*--------------------------------------------------------------*  04340059
043500* 1040-READ-TIMESTAMP-RECORD.                                     04350059
043600*     READ CONTROL CARD EPCC105. THIS CONTROL CARD CONTAINS       04360059
043700*     THE PREVIOUS RUNS TIMESTAMP                                 04370059
043800*--------------------------------------------------------------*  04380059
043900 1040-READ-TIMESTAMP-RECORD.                                      04390059
044000                                                                  04400059
044100     READ CONTROL-CARD-TIMESTAMP                                  04410059
044200                               INTO CC-EPCC105-CONTROL-CARD       04420059
044300       AT END                                                     04430059
044400          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    04440059
044500                                                                  04450059
044600     IF PS-END-OF-CNTL-CRD-FILE                                   04460059
044700       DISPLAY ' '                                                04470059
044800       DISPLAY '** ABEND     **'                                  04480059
044900       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              04490059
045000       DISPLAY '** PARAGRAPH **  = 1040-TIMESTAMP-RECORD'         04500059
045100       DISPLAY '** CONTROL FILE IS EMPTY  '                       04510059
045200       DISPLAY ' '                                                04520059
045300       MOVE +4002 TO ABEND-CODE                                   04530059
045400       CALL 'ILBOABN0' USING ABEND-CODE                           04540059
045500     ELSE                                                         04550059
045600       DISPLAY '** TIMESTAMP CONTROL CARD               **'       04560059
045700       DISPLAY '** EPCC105 CRNT TIMESTAMP  **  = '                04570059
045800                CC-EPCC105-CRNT-TIMESTAMP                         04580059
045900       DISPLAY ' '                                                04590059
046000       DISPLAY '** EPCC105 PREV TIMESTAMP  **  = '                04600059
046100                CC-EPCC105-PREV-TIMESTAMP                         04610059
046200       DISPLAY ' '                                                04620059
046300     END-IF.                                                      04630059
046400                                                                  04640059
046500*1040-EXIT.                                                       04650059
046600                                                                  04660059
046700*--------------------------------------------------------------*  04670059
046800* 2000-CREATE-MERCH-CHANGES-LIST                               *  04680059
046900*                                                              *  04690059
047000*      THIS PROCESS EXTRACTS CHANGES THAT HAVE OCCURRED        *  04700059
047100*  AT THE DEPARTMENT AND SUB CLASS LEVEL WITH ONE CURSOR. A    *  04710059
047200*  SECOND CURSOR IS THEN USED TO EXTRACT ALL OF THE RELATED    *  04720059
047300*  SKUS THAT NEED TO HAVE UPDATES APPLIED TO THEM. OUTPUT      *  04730059
047400*  PLU RECORDS ARE CREATED FOR EACH OF THE EXTRACTED SKUS.     *  04740059
047500*      IF THERE HAVE BEEN SUB CLASS ADDS OR UPDATES, DUMMY     *  04750059
047600*  PLU RECORDS ARE CREATED AND DUMMY XREF RECORDS IF REQUIRED. *  04760059
047700* (ALONG WITH DUMMY SKU SKU AND SKU PRICING RECORDS WR #35484) *  04770059
047800*--------------------------------------------------------------*  04780059
047900 2000-CREATE-MERCH-CHANGES-LIST.                                  04790059
048000                                                                  04800059
048100     DISPLAY ' '.                                                 04810059
048200     DISPLAY PC-ASTERISK-LINE.                                    04820059
048300     DISPLAY '     START OF MERCH CHANGES CURSOR'.                04830059
048400     DISPLAY PC-ASTERISK-LINE.                                    04840059
048500                                                                  04850059
048600     SET PS-OPEN-MERCH-CHGS-CSR TO TRUE.                          04860059
048700     PERFORM 6600-OPEN-CURSOR.                                    04870059
048800                                                                  04880059
048900     SET PS-NOT-END-OF-MERCH-CHGS-CSR TO TRUE.                    04890059
049000                                                                  04900059
049100     PERFORM 2200-FETCH-MERCH-CHGS-CSR.                           04910059
049200                                                                  04920059
049300     PERFORM UNTIL PS-END-OF-MERCH-CHGS-CSR                       04930059
049400                                                                  04940059
049500       PERFORM 2900-CHECK-SUB-CLASS                               04950061
049600                                                                  04960059
049700       PERFORM 2200-FETCH-MERCH-CHGS-CSR                          04970059
049800                                                                  04980059
049900     END-PERFORM.                                                 04990059
050000                                                                  05000059
050100     SET PS-CLOSE-MERCH-CHGS-CSR TO TRUE.                         05010059
050200     PERFORM 6800-CLOSE-CURSOR.                                   05020059
050300                                                                  05030059
050400*2000-EXIT.                                                       05040059
050500                                                                  05050059
050600*--------------------------------------------------------------*  05060059
050700* 2200-FETCH-MERCH-CHGS-CSR.                                   *  05070059
050800*--------------------------------------------------------------*  05080059
050900 2200-FETCH-MERCH-CHGS-CSR.                                       05090059
051000                                                                  05100059
051100     MOVE '2200-FETCH-MERCH-CHGS-CSR' TO PV-PARAGRAPH-NAME.       05110059
051200                                                                  05120059
051300     EXEC SQL                                                     05130059
051400          FETCH  MERCH-CHGS-CSR                                   05140059
051500                                                                  05150059
051600           INTO  :XST00014-DEPT-NBR                               05160059
051700                ,:XST00014-MAJ-CL-NBR                             05170059
051800                ,:XST00014-SUB-CL-NBR                             05180059
051900                ,:XST00014-POS-MDSE-DESC                          05190059
052000                ,:XST00014-LAST-UPD-TMST                          05200059
052100                ,:XST00014-CRE-TMST                               05210059
052200                                                                  05220059
052300     END-EXEC.                                                    05230059
052400                                                                  05240059
052500     EVALUATE TRUE                                                05250059
052600       WHEN SQLCODE = 0                                           05260059
052700         ADD 1 TO PV-MERCH-CHGS-FETCHES                           05270059
052800                                                                  05280059
052900         MOVE XST00014-DEPT-NBR      TO PV-DB2-DEPT-NBR           05290059
053000         MOVE XST00014-MAJ-CL-NBR    TO PV-DB2-MAJ-CL-NBR         05300059
053100         MOVE XST00014-SUB-CL-NBR    TO PV-DB2-SUB-CL-NBR         05310059
053200                                                                  05320059
053300       WHEN SQLCODE = +100                                        05330059
053400         SET PS-END-OF-MERCH-CHGS-CSR TO TRUE                     05340059
053500                                                                  05350059
053600       WHEN OTHER                                                 05360059
053700         MOVE 'ERROR ON FETCH OF MERCH-CHGS-CSR CURSOR'           05370059
053800                            TO PV-DB2-OPERATION                   05380059
053900         PERFORM 9900-SQL-ABEND-ROUTINE                           05390059
054000                                                                  05400059
054100     END-EVALUATE.                                                05410059
054200                                                                  05420059
054300*2200-EXIT.                                                       05430059
054400                                                                  05440059
054500*--------------------------------------------------------------*  05450059
054600* 2900-CHECK-SUB-CLASS                                         *  05460059
054700*                                                              *  05470059
054800*        IF THE SUB CLASS CREATE TIMESTAMP IS GREATER THAN     *  05480059
054900*   THE CONTROL CARD TIMESTAMP, CREATE ONE DUMMY ADD RECORD    *  05490059
055000*   FOR THAT DEPARTMENT, SUB CLASS.                            *  05500059
055100*        ELSE IF THE SUB CLASS UPDATE TIMESTAMP IS GREATER THAN*  05510059
055200*   THE CONTROL CARD TIMESTAMP, CREATE ONE DUMMY UPDATE RECORD *  05520059
055300*   FOR THAT DEPARTMENT, SUB CLASS.                            *  05530059
055400*                                                              *  05540059
055500*--------------------------------------------------------------*  05550059
055600 2900-CHECK-SUB-CLASS.                                            05560059
055700                                                                  05570059
055800     IF XST00014-CRE-TMST > CC-EPCC105-PREV-TIMESTAMP             05580059
055900       PERFORM 3000-CREATE-DUMMY-SKU-ADD-RECS                     05590059
056000       PERFORM 8200-WRITE-XREF-RECORD                             05600059
056100     ELSE                                                         05610059
056200       IF XST00014-LAST-UPD-TMST > CC-EPCC105-PREV-TIMESTAMP      05620059
056300         PERFORM 3100-CREATE-DUMMY-SKU-UPDT-REC                   05630059
056400       END-IF                                                     05640059
056500     END-IF.                                                      05650059
056600                                                                  05660059
056700*2900-EXIT.                                                       05670059
056800                                                                  05680059
056900*--------------------------------------------------------------*  05690059
057000* 3000-CREATE-DUMMY-SKU-ADD-RECS.                              *  05700059
057100*                                                              *  05710059
057200*      THIS PROCESS BUILDS AND OUTPUTS A SKU ADD RECORD AND    *  05720059
057300*  A SKU PRICING ADD RECORD FOR THE DUMMY SKU ASSOCIATED       *  05730059
057400*  WITH A SUB-CLASS IDENTIFIED AS NEW.                         *  05740059
057500*                                                              *  05750059
057600*--------------------------------------------------------------*  05760059
057700 3000-CREATE-DUMMY-SKU-ADD-RECS.                                  05770059
057800                                                                  05780059
057900     INITIALIZE EP219-XST-SKU-RECORD.                             05790059
058000     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       05800059
058100                                                                  05810059
058200     PERFORM 6000-POPULATE-GLOBAL-SKU-HDR.                        05820059
058300     PERFORM 6100-POP-GLOBAL-SKU-PRICG-HDR.                       05830059
058400                                                                  05840059
058500     PERFORM 3200-BUILD-DUMMY-SKU-SKU-UPC.                        05850059
058600     PERFORM 6200-POP-DUMMY-SKU-ADD-RCD.                          05860059
058700     PERFORM 6300-POP-DUMMY-SKU-PRICG-RCD.                        05870059
058800                                                                  05880059
058900     PERFORM 8300-WRITE-SKU-GLBL-REC.                             05890059
059000     PERFORM 8400-WRITE-SKU-PRICG-GLBL-REC.                       05900059
059100                                                                  05910059
059200*3000-EXIT.                                                       05920059
059300*--------------------------------------------------------------*  05930059
059400* 3100-CREATE-DUMMY-SKU-UPDT-REC.                              *  05940059
059500*                                                              *  05950059
059600*      THIS PROCESS BUILDS AND OUTPUTS A SKU UPDATE RECORD     *  05960059
059700*  FOR THE DUMMY SKU ASSOCIATED WITH EACH CHANGED SUB-CLASS.   *  05970059
059800*                                                              *  05980059
059900*--------------------------------------------------------------*  05990059
060000 3100-CREATE-DUMMY-SKU-UPDT-REC.                                  06000059
060100                                                                  06010059
060200     INITIALIZE EP219-XST-SKU-RECORD.                             06020059
060300                                                                  06030059
060400     PERFORM 6000-POPULATE-GLOBAL-SKU-HDR.                        06040059
060500                                                                  06050059
060600     PERFORM 3200-BUILD-DUMMY-SKU-SKU-UPC.                        06060059
060700                                                                  06070059
060800     PERFORM 6400-POP-DUMMY-SKU-UPDATE-RCD.                       06080059
060900                                                                  06090059
061000     PERFORM 8300-WRITE-SKU-GLBL-REC.                             06100059
061100                                                                  06110059
061200*3100-EXIT.                                                       06120059
061300*--------------------------------------------------------------*  06130059
061400* 3200-BUILD-DUMMY-SKU-SKU-UPC.                                *  06140059
061500*                                                              *  06150059
061600*      THIS PROCESS BUILDS DUMMY UPC-NBR AND SKU-NBR FOR       *  06160059
061700*     EACH DUMMY SKU ASSOCIATED WITH EACH CHANGED SUB-CLASS.   *  06170059
061800*                                                              *  06180059
061900*--------------------------------------------------------------*  06190059
062000 3200-BUILD-DUMMY-SKU-SKU-UPC.                                    06200059
062100                                                                  06210059
062200     MOVE PV-DB2-DEPT-NBR          TO PV-SAVE-DEPT-NBR.           06220059
062300     MOVE PV-DB2-SUB-CL-NBR        TO PV-SAVE-SUB-CL-NBR.         06230059
062400                                                                  06240059
062500     MOVE PV-SAVE-DEPT-NBR-X       TO PV-INTR-UPC-ID-DEPT         06250059
062600                                      PV-SKU-NBR-DEPT.            06260059
062700                                                                  06270059
062800     MOVE PV-SAVE-SUB-CL-NBR-X     TO PV-INTR-UPC-ID-CLASS        06280059
062900                                      PV-SKU-NBR-CLASS.           06290059
063000                                                                  06300059
063100*3200-EXIT.                                                       06310059
063200*----------------------------------------------------------       06320059
063300* 6000-POPULATE-GLOBAL-SKU-HDR.                                   06330059
063400*     POPULATES SKU GLOBAL RECORD HEADER FIELDS.                  06340059
063500*----------------------------------------------------------       06350059
063600 6000-POPULATE-GLOBAL-SKU-HDR.                                    06360059
063700                                                                  06370059
063800     MOVE CC-EPCC112-TOMORROW-DATE TO EP219-PRICG-EFFECT-DTE.     06380059
063900                                                                  06390059
064000     MOVE PC-STR-GRP-TYP-CDE-CORP  TO EP219-STR-GRP-TYP-CDE.      06400059
064100     MOVE PC-STR-GRP-ID-CORP       TO EP219-STR-GRP-ID.           06410059
064200                                                                  06420059
064300     SET EP219-FILE-CHANGE         TO TRUE.                       06430059
064400     SET EP219-APPLY-NIGHTLY       TO TRUE.                       06440059
064500                                                                  06450059
064600*6000-EXIT.                                                       06460059
064700*----------------------------------------------------------       06470059
064800* 6100-POP-GLOBAL-SKU-PRICG-HDR.                                  06480059
064900*     POPULATES SKU PRICING GLOBAL CHG RECORD HEADER FIELDS.      06490059
065000*----------------------------------------------------------       06500059
065100 6100-POP-GLOBAL-SKU-PRICG-HDR.                                   06510059
065200                                                                  06520059
065300     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       06530059
065400                                                                  06540059
065500     MOVE CC-EPCC112-TOMORROW-DATE TO EP220-PRICG-EFFECT-DTE.     06550059
065600                                                                  06560059
065700     MOVE PC-STR-GRP-TYP-CDE-CORP  TO EP220-STR-GRP-TYP-CDE.      06570059
065800     MOVE PC-STR-GRP-ID-CORP       TO EP220-STR-GRP-ID.           06580059
065900                                                                  06590059
066000     SET EP220-FILE-CHANGE         TO TRUE.                       06600059
066100     SET EP220-APPLY-NIGHTLY       TO TRUE.                       06610059
066200                                                                  06620059
066300*6100-EXIT.                                                       06630059
066400*----------------------------------------------------------       06640059
066500* 6200-POP-DUMMY-SKU-ADD-RCD.                                     06650059
066600*   POPULATES SKU GLOBAL ADD RECORD FOR A DUMMY SKU.              06660059
066700*----------------------------------------------------------       06670059
066800 6200-POP-DUMMY-SKU-ADD-RCD.                                      06680059
066900                                                                  06690059
067000     SET EP219-RECORD-ADD          TO TRUE.                       06700059
067100                                                                  06710059
067200     SET EP219-SKU-NBR-YES         TO TRUE.                       06720059
067300     MOVE PV-SKU-NBR-DUMMY         TO EP219-SKU-NBR.              06730059
067400                                                                  06740059
067500     SET EP219-INTR-UPC-ID-YES     TO TRUE.                       06750059
067600     MOVE PV-INTR-UPC-ID-DUMMY     TO EP219-INTR-UPC-ID.          06760059
067700                                                                  06770059
067800     SET EP219-SKU-DESC-YES        TO TRUE.                       06780059
067900     MOVE XST00014-POS-MDSE-DESC   TO EP219-SKU-DESC.             06790059
068000                                                                  06800059
068100     SET EP219-E-BUS-ITM-IND-YES   TO TRUE.                       06810059
068200     MOVE 'N'                      TO EP219-E-BUS-ITM-IND         06820067
068300                                                                  06830059
068400     SET EP219-E-BUS-PRD-GP-NBR-YES    TO TRUE.                   06840059
068500     MOVE ZEROES                TO EP219-E-BUS-PRD-GP-NBR.        06850059
068600                                                                  06860059
068700     SET EP219-NRF-CLOR-DESC-YES       TO TRUE.                   06870059
068800     SET EP219-SIZE-DESC-YES           TO TRUE.                   06880059
068900     MOVE SPACES                TO EP219-NRF-CLOR-DESC            06890059
069000                                   EP219-SIZE-DESC.               06900059
069100                                                                  06910059
069200     SET EP219-TAX-PRD-CDE-YES         TO TRUE.                   06920059
069300     MOVE '61000'               TO EP219-TAX-PRD-CDE.             06930059
069400                                                                  06940059
069500     SET EP219-MDSE-TX-CDE-YES         TO TRUE.                   06950059
069600     MOVE '01'                  TO EP219-MDSE-TX-CDE.             06960059
069700                                                                  06970059
069800     SET EP219-MKDN-SGN-CDE-YES        TO TRUE.                   06980059
069900     MOVE PC-NULL-CHAR          TO EP219-MKDN-SGN-CDE.            06990059
070000                                                                  07000059
070100     SET  EP219-STYL-ID-YES            TO TRUE.                   07010059
070200     MOVE 0                     TO EP219-STYL-ID.                 07020059
070300                                                                  07030059
070400     SET  EP219-DMY-SKU-IND-YES        TO TRUE.                   07040059
070500     SET  EP219-IS-DUMMY-SKU    TO TRUE.                          07050059
070600                                                                  07060059
070700     ADD 1           TO PV-CNT-SKU-DUMMY-ADDS.                    07070059
070800                                                                  07080059
070900*6200-EXIT.                                                       07090059
071000*----------------------------------------------------------       07100059
071100* 6300-POP-DUMMY-SKU-PRICG-RCD.                                   07110059
071200*   POPULATES SKU PRICING GLOBAL ADD RECORD FOR A DUMMY SKU.      07120059
071300*----------------------------------------------------------       07130059
071400 6300-POP-DUMMY-SKU-PRICG-RCD.                                    07140059
071500                                                                  07150059
071600     SET EP220-RECORD-ADD          TO TRUE.                       07160059
071700                                                                  07170059
071800     SET EP220-SKU-PRICG-ID-NO         TO TRUE.                   07180059
071900                                                                  07190059
072000     SET EP220-PRIC-EFF-TMST-YES       TO TRUE.                   07200059
072100     MOVE PV-PRIC-EFF-TMST         TO EP220-PRIC-EFF-TMST.        07210059
072200                                                                  07220059
072300     SET EP220-MDSE-HIER-CDE-YES       TO TRUE.                   07230059
072400     MOVE PC-MDSE-HIER-SKU      TO EP220-MDSE-HIER-CDE.           07240059
072500                                                                  07250059
072600*    DEPT AND SUB CLASS ARE POPULATED FOR DUMMY SKUS              07260059
072700*    -- MAJOR CLASS AS WELL, AS IT IS NEEDED BY LOOK UP.          07270059
072800*    STYLE ID IS NULL FOR DUMMY SKUS                              07280059
072900     SET EP220-DEPT-NBR-YES            TO TRUE.                   07290059
073000     MOVE PV-DB2-DEPT-NBR       TO EP220-DEPT-NBR.                07300059
073100                                                                  07310059
073200     SET EP220-MAJ-CL-NBR-YES          TO TRUE.                   07320059
073300     MOVE PV-DB2-MAJ-CL-NBR     TO EP220-MAJ-CL-NBR.              07330059
073400                                                                  07340059
073500     SET EP220-STYL-ID-YES             TO TRUE.                   07350059
073600     MOVE PC-NULL-CHAR          TO EP220-STYL-ID-NUL.             07360059
073700                                                                  07370059
073800     SET EP220-SUB-CL-NBR-YES          TO TRUE.                   07380059
073900     MOVE PV-DB2-SUB-CL-NBR     TO EP220-SUB-CL-NBR.              07390059
074000                                                                  07400059
074100     SET EP220-EXCL-MDSE-IND-YES       TO TRUE.                   07410059
074200     MOVE PC-NULL-CHAR          TO EP220-EXCL-MDSE-IND.           07420059
074300                                                                  07430059
074400     SET EP220-SKU-NBR-YES             TO TRUE.                   07440059
074500     MOVE PV-SKU-NBR-DUMMY      TO EP220-SKU-NBR.                 07450059
074600                                                                  07460059
074700     SET EP220-UNT-RTL-AMT-YES         TO TRUE.                   07470059
074800     SET EP220-LAST-NCLR-RTL-AMT-YES   TO TRUE.                   07480059
074900     SET EP220-N-RCPT-RT-RTL-AMT-Y     TO TRUE.                   07490059
075000     MOVE ZEROES                TO EP220-UNT-RTL-AMT              07500059
075100                                   EP220-LAST-NCLR-RTL-AMT        07510059
075200                                   EP220-N-RCPT-RT-UNT-RTL-AMT.   07520059
075300                                                                  07530059
075400*   SET  LOC_SKU_STAT_CDE, CHAR(2) NOT NULL, TO '00', FOR DUMMY   07540059
075500     SET EP220-LOC-SKU-STAT-CDE-YES    TO TRUE.                   07550059
075600     MOVE PC-DUMMY-STATUS       TO EP220-LOC-SKU-STAT-CDE.        07560059
075700                                                                  07570059
075800*    SET  TKT_CLOR_CDE TO 'W' (WHITE, ACTIVE) FOR DUMMY SKUS      07580059
075900     SET EP220-TKT-CLOR-CDE-YES        TO TRUE.                   07590059
076000     MOVE 'W'                   TO EP220-TKT-CLOR-CDE.            07600059
076100                                                                  07610059
076200*    LAST_PRCHG_TMST, DATETIME NOT NULL, IS SENT AS SPACES FOR    07620059
076300*     DUMMY SKU - FILE APPLY PROCESS ENTERS CURRENT TIMESTAMP     07630059
076400     SET EP220-LAST-PRCHG-TMST-YES     TO TRUE.                   07640059
076500     MOVE SPACES                TO EP220-LAST-PRCHG-TMST.         07650059
076600                                                                  07660059
076700*    SET PRMPT_FOR_PRIC_IND, CHAR(1) NOT NULL, TO 'Y' FOR DUMMY   07670059
076800     SET EP220-PRMPT-FOR-PRIC-IND-YES  TO TRUE.                   07680059
076900     MOVE 'Y'                   TO EP220-PRMPT-FOR-PRIC-IND.      07690059
077000                                                                  07700059
077100*    ALWAYS SET PERM_PRCHG_DIRN_CDE, CHAR(1) NULLABLE, TO 'N'     07710059
077200     SET EP220-PERM-PRCHG-DIRN-CDE-YES TO TRUE.                   07720059
077300     MOVE 'N'                   TO EP220-PERM-PRCHG-DIRN-CDE.     07730059
077400                                                                  07740059
077500*    SET MLT_PRPT_IND, CHAR(1) NOT NULL, TO 'Y', FOR DUMMY SKU    07750059
077600     SET EP220-MLT-PRPT-IND-YES        TO TRUE.                   07760059
077700     MOVE 'Y'                   TO EP220-MLT-PRPT-IND.            07770059
077800                                                                  07780059
077900*    PRCHG_APLBL_TKT_CLOR_CDE, CHAR(2) NULLABLE, NULL FOR CURRENT 07790059
078000     SET EP220-PRCHG-APL-TKT-CLR-CD-Y  TO TRUE.                   07800059
078100     MOVE PC-NULL-CHAR          TO EP220-PRCHG-APLBL-TKT-CLOR-CDE.07810059
078200                                                                  07820059
078300*  THE FOLLOWING FIELDS ARE NULL FOR DUMMY SKUS, IN SQL SERVER:   07830059
078400     SET EP220-GP-RTL-AMT-YES          TO TRUE.                   07840059
078500     SET EP220-GP-RTL-QTY-YES          TO TRUE.                   07850059
078600     SET EP220-GP-PRIC-ID-YES          TO TRUE.                   07860059
078700     MOVE PC-NULL-CHAR          TO EP220-GP-RTL-AMT-NUL           07870059
078800                                   EP220-GP-RTL-QTY-NUL           07880059
078900                                   EP220-GP-PRIC-ID-NUL.          07890059
079000                                                                  07900059
079100*  THE FOLLOWING FIELDS ARE NEVER SENT FOR CURRENT PRICING:       07910059
079200*  ... BUT, NEED TO SEND NULLS SO FILE APPLY CAN HANDLE READILY   07920059
079300     SET EP220-LO-UNT-RTL-AMT-YES      TO TRUE.                   07930059
079400     SET EP220-HGH-UNT-RTL-AMT-YES     TO TRUE.                   07940059
079500     MOVE PC-NULL-CHAR          TO EP220-LO-UNT-RTL-AMT-NUL       07950059
079600                                   EP220-HGH-UNT-RTL-AMT-NUL.     07960059
079700                                                                  07970059
079800     ADD 1           TO PV-CNT-SKU-PRICG-DUMMY-ADDS.              07980059
079900                                                                  07990059
080000*6300-EXIT.                                                       08000059
080100*----------------------------------------------------------       08010059
080200* 6400-POP-DUMMY-SKU-UPDATE-RCD.                                  08020059
080300*   POPULATES SKU GLOBAL UPDATE RECORD FOR A DUMMY SKU.           08030059
080400*----------------------------------------------------------       08040059
080500 6400-POP-DUMMY-SKU-UPDATE-RCD.                                   08050059
080600                                                                  08060059
080700     SET EP219-RECORD-UPDATE       TO TRUE.                       08070059
080800                                                                  08080059
080900     SET EP219-SKU-NBR-YES         TO TRUE.                       08090059
081000     MOVE PV-SKU-NBR-DUMMY         TO EP219-SKU-NBR.              08100059
081100                                                                  08110059
081200     SET EP219-SKU-DESC-YES        TO TRUE.                       08120059
081300     MOVE XST00014-POS-MDSE-DESC   TO EP219-SKU-DESC.             08130059
081400                                                                  08140059
081500     SET EP219-INTR-UPC-ID-NO      TO TRUE.                       08150059
081600     SET EP219-E-BUS-ITM-IND-NO    TO TRUE.                       08160059
081700     SET EP219-E-BUS-PRD-GP-NBR-NO TO TRUE.                       08170059
081800     SET EP219-NRF-CLOR-DESC-NO    TO TRUE.                       08180059
081900     SET EP219-SIZE-DESC-NO        TO TRUE.                       08190059
082000     SET EP219-TAX-PRD-CDE-NO      TO TRUE.                       08200059
082100     SET EP219-MDSE-TX-CDE-NO      TO TRUE.                       08210059
082200     SET EP219-MKDN-SGN-CDE-NO     TO TRUE.                       08220059
082300     SET EP219-STYL-ID-NO          TO TRUE.                       08230059
082400     SET EP219-DMY-SKU-IND-NO      TO TRUE.                       08240059
082500                                                                  08250059
082600     ADD 1           TO PV-CNT-SKU-DUMMY-UPDS.                    08260059
082700                                                                  08270059
082800*6400-EXIT.                                                       08280059
082900*--------------------------------------------------------------*  08290059
083000* 6600-OPEN-CURSOR.                                            *  08300059
083100*    TRY TO OPEN THE CURSOR UP TO FIVE TIMES.                  *  08310059
083200*    PARAGRAPH OPENS ANY OF THE CURSORS USED IN THIS PROGRAM.  *  08320059
083300*    SWITCHES ARE SET TO SELECT THE RIGHT CURSOR.              *  08330059
083400*                                                              *  08340059
083500*--------------------------------------------------------------*  08350059
083600 6600-OPEN-CURSOR.                                                08360059
083700                                                                  08370059
083800     MOVE '6600-OPEN-CURSOR' TO PV-PARAGRAPH-NAME.                08380059
083900                                                                  08390059
084000     PERFORM                                                      08400059
084100         WITH TEST AFTER                                          08410059
084200         VARYING PV-SQL-SUB                                       08420059
084300         FROM 1 BY 1                                              08430059
084400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08440059
084500                   OR  SQLCODE = 0)                               08450059
084600                                                                  08460059
084700         EVALUATE TRUE                                            08470059
084800           WHEN PS-OPEN-MERCH-CHGS-CSR                            08480059
084900             MOVE 'MERCH-CHGS-CSR' TO PV-CURSOR-NAME              08490059
085000             EXEC SQL                                             08500059
085100               OPEN MERCH-CHGS-CSR                                08510059
085200             END-EXEC                                             08520059
085300                                                                  08530059
085400           WHEN OTHER                                             08540059
085500             DISPLAY PC-ASTERISK-LINE                             08550059
085600             DISPLAY 'NO CURSOR SELECTED FOR OPEN '               08560059
085700             DISPLAY PC-ASTERISK-LINE                             08570059
085800             PERFORM 9900-SQL-ABEND-ROUTINE                       08580059
085900                                                                  08590059
086000         END-EVALUATE                                             08600059
086100                                                                  08610059
086200         EVALUATE TRUE                                            08620059
086300           WHEN SQLCODE = -904                                    08630059
086400           WHEN SQLCODE = -911                                    08640059
086500           WHEN SQLCODE = -913                                    08650059
086600             CONTINUE                                             08660059
086700                                                                  08670059
086800           WHEN SQLCODE = 0                                       08680059
086900             CONTINUE                                             08690059
087000                                                                  08700059
087100           WHEN SQLWARN0 NOT EQUAL SPACE                          08710059
087200           WHEN SQLCODE NOT EQUAL ZERO                            08720059
087300             STRING 'ERROR ON OPEN OF '                           08730059
087400                     PV-CURSOR-NAME                               08740059
087500                     DELIMITED BY SIZE INTO PV-DB2-OPERATION      08750059
087600             PERFORM 9900-SQL-ABEND-ROUTINE                       08760059
087700                                                                  08770059
087800         END-EVALUATE                                             08780059
087900     END-PERFORM.                                                 08790059
088000                                                                  08800059
088100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08810059
088200       STRING 'OPEN RETRIES EXCEEDED FOR ' PV-CURSOR-NAME         08820059
088300               DELIMITED BY SIZE INTO PV-DB2-OPERATION            08830059
088400       PERFORM 9900-SQL-ABEND-ROUTINE                             08840059
088500     END-IF.                                                      08850059
088600                                                                  08860059
088700*6600-EXIT.                                                       08870059
088800                                                                  08880059
088900*--------------------------------------------------------------*  08890059
089000* 6800-CLOSE-CURSOR.                                           *  08900059
089100*    TRY TO CLOSE THE CURSOR UP TO FIVE TIMES.                 *  08910059
089200*    PARAGRAPH CLOSES ANY OF THE CURSORS USED IN THIS PROGRAM. *  08920059
089300*    SWITCHES ARE SET TO SELECT THE RIGHT CURSOR.              *  08930059
089400*                                                              *  08940059
089500*--------------------------------------------------------------*  08950059
089600 6800-CLOSE-CURSOR.                                               08960059
089700                                                                  08970059
089800     MOVE '6800-CLOSE-CURSOR' TO PV-PARAGRAPH-NAME.               08980059
089900                                                                  08990059
090000     PERFORM                                                      09000059
090100         WITH TEST AFTER                                          09010059
090200         VARYING PV-SQL-SUB                                       09020059
090300         FROM 1 BY 1                                              09030059
090400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09040059
090500                   OR  SQLCODE = 0)                               09050059
090600                                                                  09060059
090700         EVALUATE TRUE                                            09070059
090800           WHEN PS-CLOSE-MERCH-CHGS-CSR                           09080059
090900             MOVE 'MERCH-CHGS-CSR' TO PV-CURSOR-NAME              09090059
091000             EXEC SQL                                             09100059
091100               CLOSE MERCH-CHGS-CSR                               09110059
091200             END-EXEC                                             09120059
091300                                                                  09130059
091400           WHEN OTHER                                             09140059
091500             DISPLAY PC-ASTERISK-LINE                             09150059
091600             DISPLAY 'NO CURSOR SELECTED FOR CLOSE '              09160059
091700             DISPLAY PC-ASTERISK-LINE                             09170059
091800             PERFORM 9900-SQL-ABEND-ROUTINE                       09180059
091900                                                                  09190059
092000         END-EVALUATE                                             09200059
092100                                                                  09210059
092200         EVALUATE TRUE                                            09220059
092300           WHEN SQLCODE = -904                                    09230059
092400           WHEN SQLCODE = -911                                    09240059
092500           WHEN SQLCODE = -913                                    09250059
092600             CONTINUE                                             09260059
092700                                                                  09270059
092800           WHEN SQLCODE = 0                                       09280059
092900             CONTINUE                                             09290059
093000                                                                  09300059
093100           WHEN SQLWARN0 NOT EQUAL SPACE                          09310059
093200           WHEN SQLCODE NOT EQUAL ZERO                            09320059
093300             STRING 'ERROR ON CLOSE OF '                          09330059
093400                     PV-CURSOR-NAME                               09340059
093500                     DELIMITED BY SIZE INTO PV-DB2-OPERATION      09350059
093600             PERFORM 9900-SQL-ABEND-ROUTINE                       09360059
093700         END-EVALUATE                                             09370059
093800     END-PERFORM.                                                 09380059
093900                                                                  09390059
094000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09400059
094100       STRING 'CLOSE RETRIES EXCEEDED FOR ' PV-CURSOR-NAME        09410059
094200               DELIMITED BY SIZE INTO PV-DB2-OPERATION            09420059
094300       PERFORM 9900-SQL-ABEND-ROUTINE                             09430059
094400     END-IF.                                                      09440059
094500                                                                  09450059
094600*6800-EXIT.                                                       09460059
094700                                                                  09470059
094800*--------------------------------------------------------------*  09480067
094900* 8200-WRITE-XREF-RECORD.                                         09490059
095000*                                                                 09500059
095100*--------------------------------------------------------------*  09510059
095200 8200-WRITE-XREF-RECORD.                                          09520059
095300                                                                  09530059
095400     MOVE '8200-WRITE-XREF-RECORD   ' TO PV-PARAGRAPH-NAME.       09540059
095500                                                                  09550059
095600     INITIALIZE EP074-XREF-DRIVE-RECORD.                          09560059
095700                                                                  09570059
095800     MOVE PV-DB2-DEPT-NBR          TO PV-STRING-DEPT-NBR.         09580063
095900     MOVE PV-DB2-SUB-CL-NBR        TO PV-STRING-SUB-CL-NBR        09590063
096000                                                                  09600063
096100     STRING '99'                                                  09610059
096200            PV-STRING-DEPT-NBR (2:3)                              09620059
096300            PV-STRING-SUB-CL-NBR (3:2)                            09630059
096400            '00000'                                               09640059
096500            DELIMITED BY SIZE                                     09650059
096600            INTO EP074-INTERNAL-UPC-ID.                           09660059
096700                                                                  09670059
096800     STRING PV-STRING-DEPT-NBR (2:3)                              09680059
096900            PV-STRING-SUB-CL-NBR (3:2)                            09690059
097000            '000'                                                 09700059
097100            DELIMITED BY SIZE                                     09710059
097200            INTO EP074-SKU-NBR.                                   09720059
097300                                                                  09730059
097400     WRITE DUMMY-XREF-RECORD FROM EP074-XREF-DRIVE-RECORD.        09740059
097500                                                                  09750059
097600     ADD 1           TO PV-CNT-OUTPUT-RECORDS                     09760059
097700                        PV-CNT-EP074-RECORDS.                     09770059
097800                                                                  09780059
097900*8200-EXIT.                                                       09790059
098000                                                                  09800059
098100*--------------------------------------------------------------*  09810059
098200* 8300-WRITE-SKU-GLBL-REC.                                        09820059
098300*    WRITE SKU GLOBAL RECORD FROM OUTPUT RECORD LAYOUT            09830059
098400*--------------------------------------------------------------*  09840059
098500 8300-WRITE-SKU-GLBL-REC.                                         09850059
098600                                                                  09860059
098700     MOVE '8300-WRITE-SKU-GLBL-REC     ' TO PV-PARAGRAPH-NAME.    09870059
098800                                                                  09880059
098900     WRITE SKU-CHG-GLOBAL-RECORD FROM EP219-XST-SKU-RECORD.       09890059
099000                                                                  09900059
099100     ADD 1           TO PV-CNT-OUTPUT-RECORDS                     09910059
099200                        PV-CNT-EP219-RECORDS.                     09920059
099300                                                                  09930059
099400*8300-EXIT.                                                       09940059
099500*--------------------------------------------------------------*  09950059
099600* 8400-WRITE-SKU-PRICG-GLBL-REC.                                  09960059
099700*    WRITE SKU PRICING GLOBAL RECORD FROM OUTPUT RECORD LAYOUT    09970059
099800*--------------------------------------------------------------*  09980059
099900 8400-WRITE-SKU-PRICG-GLBL-REC.                                   09990059
100000                                                                  10000059
100100     MOVE '8400-WRITE-SKU-PRICG-GLBL-REC' TO PV-PARAGRAPH-NAME.   10010059
100200                                                                  10020059
100300     WRITE SKU-PRICING-CHG-GLOBAL-RECORD                          10030059
100400                             FROM EP220-XST-SKU-PRICG-RECORD.     10040059
100500                                                                  10050059
100600     ADD 1           TO PV-CNT-OUTPUT-RECORDS                     10060059
100700                        PV-CNT-EP220-RECORDS.                     10070059
100800                                                                  10080059
100900*8400-EXIT.                                                       10090059
101000*--------------------------------------------------------------*  10100059
101100* 9900-SQL-ABEND-ROUTINE.                                         10110059
101200*     SQL ABEND ROUTINE.                                          10120059
101300*--------------------------------------------------------------*  10130059
101400 9900-SQL-ABEND-ROUTINE.                                          10140059
101500                                                                  10150059
101600     DISPLAY '** ABEND     **'.                                   10160059
101700     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                10170059
101800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10180059
101900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               10190059
102000                                                                  10200059
102100     COPY DPPD004.                                                10210059
102200     SET ABEND-4013-DB2-ERROR TO TRUE.                            10220059
102300     CALL 'ILBOABN0' USING ABEND-CODE.                            10230059
102400                                                                  10240059
102500*9900-EXIT.                                                       10250059
102600                                                                  10260059
102700                                                                  10270059
102800*--------------------------------------------------------------*  10280059
102900* 9999-WRAPUP.                                                    10290059
103000*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      10300059
103100*     ANY DATA FROM THE PROGRAM.                                  10310059
103200*--------------------------------------------------------------*  10320059
103300 9999-WRAPUP.                                                     10330059
103400                                                                  10340059
103500     CLOSE CONTROL-CARD-BATCH-DATE                                10350059
103600           CONTROL-CARD-TIMESTAMP                                 10360059
103700           DUMMY-XREF-DRIVER                                      10370059
103800           SKU-CHG-GLOBAL-FILE                                    10380059
103900           SKU-PRICING-CHG-GLOBAL-FILE.                           10390059
104000                                                                  10400059
104100     DISPLAY ' '.                                                 10410059
104200     DISPLAY '*********************************************'.     10420059
104300     DISPLAY '       PROGRAM NAME: ' PC-PROGRAM-NAME.             10430059
104400     DISPLAY '*********************************************'.     10440059
104500     DISPLAY ' '.                                                 10450059
104600     DISPLAY 'NUMBER OF MERCH CHGS FETCHED:           '           10460059
104700              PV-MERCH-CHGS-FETCHES.                              10470059
104800     DISPLAY ' '.                                                 10480059
104900     DISPLAY 'NUMBER OF OUTPUT RECORDS WRITTEN:       '           10490059
105000              PV-CNT-OUTPUT-RECORDS.                              10500059
105100     DISPLAY PC-FIVE-BLANKS.                                      10510059
105200     DISPLAY PC-FIVE-BLANKS                                       10520059
105300             'NUMBER OF EP074 RECORDS WRITTEN:        '           10530059
105400              PV-CNT-EP074-RECORDS                                10540059
105500             ' - DD OUT01'.                                       10550064
105600     DISPLAY PC-FIVE-BLANKS.                                      10560059
105700     DISPLAY PC-FIVE-BLANKS                                       10570059
105800             'NUMBER OF SKU FILE RECORDS WRITTEN:     '           10580059
105900              PV-CNT-EP219-RECORDS                                10590059
106000             ' - DD OUT02'.                                       10600064
106100     DISPLAY PC-FIVE-BLANKS.                                      10610059
106200     DISPLAY PC-TEN-BLANKS                                        10620059
106300             '   NUMBER OF DUMMY ADD SKU RECORDS WRITTEN:  '      10630059
106400              PV-CNT-SKU-DUMMY-ADDS.                              10640059
106500     DISPLAY PC-TEN-BLANKS                                        10650059
106600             'NUMBER OF DUMMY UPDATE SKU RECORDS WRITTEN: '       10660059
106700              PV-CNT-SKU-DUMMY-UPDS.                              10670059
106800     DISPLAY PC-FIVE-BLANKS.                                      10680059
106900     DISPLAY PC-FIVE-BLANKS                                       10690059
107000             'NUMBER OF SKU PRICG RECORDS WRITTEN:    '           10700059
107100              PV-CNT-EP220-RECORDS                                10710059
107200             ' - DD OUT03'.                                       10720064
107300     DISPLAY PC-TEN-BLANKS                                        10730059
107400             'NBR OF DUMMY ADD SKU PRICG RECORDS WRITTEN:  '      10740059
107500              PV-CNT-SKU-PRICG-DUMMY-ADDS.                        10750059
107600     DISPLAY PC-FIVE-BLANKS.                                      10760059
107700     DISPLAY ' '.                                                 10770059
107800                                                                  10780059
107900*9999-EXIT.                                                       10790059
