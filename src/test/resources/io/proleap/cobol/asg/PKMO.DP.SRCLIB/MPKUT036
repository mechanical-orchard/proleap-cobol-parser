000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.    MPKUT036.                                         00020002
000300 AUTHOR.        MICHAEL WALTERS.                                  00030002
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040002
000500 DATE-WRITTEN.  08/12/97.                                         00050002
000600 DATE-COMPILED.                                                   00060002
000700******************************************************************00070002
000800* DAILY RECEIPT/ADJUSTMENTS DEFERRED REPORT EXTRACT PROGRAM      *00160002
000900******************************************************************00161002
001000                                                                  00170002
001100 ENVIRONMENT DIVISION.                                            00180002
001200 CONFIGURATION SECTION.                                           00190002
001300 INPUT-OUTPUT SECTION.                                            00200002
001400 FILE-CONTROL.                                                    00210002
001500                                                                  00220002
001600     SELECT DAILY-RECEIPTS-FILE                                   00230002
001700         ASSIGN TO INP01.                                         00240002
001800                                                                  00260002
001900     SELECT PROCESS-DATE-FILE                                     00270004
002000         ASSIGN TO INP02.                                         00280002
002100                                                                  00290002
002200     SELECT CC-DEFERRED-PARM-FILE                                 00300002
002300         ASSIGN TO INP03.                                         00310002
002400                                                                  00320002
002500     SELECT MERCH-REPORT-FILE                                     00862002
002600         ASSIGN TO OUT01.                                         00863013
002700                                                                  00870002
002800     SELECT DEFERRED-REPORT-FILE                                  00880013
002900         ASSIGN TO OUT02.                                         00890013
003000                                                                  00900013
003100                                                                  00940002
003200 DATA DIVISION.                                                   00950002
003300 FILE SECTION.                                                    00960002
003301                                                                  00970002
003302 FD  DAILY-RECEIPTS-FILE                                          00970102
003303     RECORDING MODE IS F                                          00970201
003304     LABEL RECORDS ARE STANDARD                                   00970301
003305     BLOCK CONTAINS 0 RECORDS.                                    00970401
003306                                                                  00970501
003307 01  DAILY-RECEIPTS-RECORD          PIC X(300).                   00970602
003308                                                                  00971001
003309 FD  PROCESS-DATE-FILE                                            00972004
003310     RECORDING MODE IS F                                          00973002
003311     LABEL RECORDS ARE STANDARD                                   00974002
003312     BLOCK CONTAINS 0 RECORDS.                                    00975002
003313 01  PROCESS-DATE-RECORD                 PIC X(80).               00977004
003314                                                                  00978602
003315 FD  CC-DEFERRED-PARM-FILE                                        00979002
003316     RECORDING MODE IS F                                          00979102
003317     LABEL RECORDS ARE STANDARD                                   00979202
003318     BLOCK CONTAINS 0 RECORDS.                                    00979302
003319                                                                  00980403
003320 01  CC-DEFERRED-PARM-RECORD        PIC X(80).                    00980502
003330                                                                  00980602
003340 FD  DEFERRED-REPORT-FILE                                         00981002
003350     RECORDING  MODE IS F.                                        00990002
003351 01  DEFERRED-REPORT-RECORD         PIC X(300).                   01000002
003352                                                                  01001002
003353 FD  MERCH-REPORT-FILE                                            01002002
003354     RECORDING  MODE IS F.                                        01003002
003355 01  MERCH-REPORT-RECORD            PIC X(300).                   01004002
003356                                                                  01010002
003357                                                                  01840002
003358 EJECT                                                            01850002
003359 WORKING-STORAGE SECTION.                                         01860002
003360                                                                  01870002
003370 01  TABLE-VARIABLES.                                             01871002
003380     05  DT-SUB                            PIC 9(03) VALUE 0.     01880002
003390     05  DT-DEPT-TABLE.                                           01881002
003400         10  DT-DEPT-TBL  OCCURS 999 TIMES.                       01890002
003500             15  DT-DEPT-NBR               PIC X(03).             01910002
003600             15  DT-GMA-NBR                PIC X(02).             01920002
003700             15  DT-DMA-NBR                PIC X(02).             01930002
003800             15  DT-BYR-NBR                PIC X(03).             01940002
003900                                                                  01950002
004000     05  VT-DIVISION-FIELDS.                                      01960002
004100         10  VT-SUB-X.                                            01970002
004200             15  VT-SUB                    PIC 9(02)  VALUE 0.    01970217
004300         10  VT-DIV-TBL-MAX                PIC S9(03) COMP-3      01970317
004400                                           VALUE +099.            01971017
004500         10  VT-DIVISION-TABLE.                                   01980002
004600             15  VT-DIV-TBL                OCCURS 099 TIMES.      01990017
004700                 20  VT-DIV-NBR            PIC X(02).             02012018
004800                                                                  02020002
004900***************************************************************** 02670002
005000*  CONTROLS WHICH DIVISIONS MAY BE CHECKED FOR DEFERRED RECEIPTS. 02680002
005100***************************************************************** 02690002
005200 01  CD-CNTL-DEF-RCPTS-CARD.                                      02700002
005300     05  CD-DEFER-RCPT-NBR-DAYS          PIC 9(02).               02710002
005400     05  CD-DEFER-DIVISION-IND           PIC X.                   02720002
005500     05  FILLER                          PIC X(77).               02730002
005600 01  CD-CNTL-DEF-DIV-SPECIFIC  REDEFINES  CD-CNTL-DEF-RCPTS-CARD. 02740002
005700     05  CD-DEFER-DIV-NBR                PIC X(02).               02750002
005800     05  FILLER                          PIC X(78).               02760002
005900                                                                  02760104
006000***************************************************************** 02760204
006100*  CONTROL CARD TO INPUT THE PROCESS DATE                         02760304
006101***************************************************************** 02760404
006102 01  CC-PROCESS-DATE-RECORD.                                      02761004
006103     05  CC-PROCESS-DATE.                                         02762004
006104         10  CC-PROCESS-MM               PIC 9(02).               02763004
006105         10  CC-PROCESS-DD               PIC 9(02).               02764004
006106         10  CC-PROCESS-YY               PIC 9(02).               02765004
006107     05  FILLER                          PIC X.                   02766004
006108     05  CC-CALENDAR-TYPE                PIC X(02).               02767004
006109     05  FILLER                          PIC X(71).               02768004
006110                                                                  02769004
006120                                                                  02770003
006130 01  CPU-DATE.                                                    02780002
006140     05  CPU-YEAR                    PIC X(02)     VALUE SPACES.  02790002
006150     05  CPU-MONTH                   PIC X(02)     VALUE SPACES.  02800002
006160     05  CPU-DAY                     PIC X(02)     VALUE SPACES.  02810002
006170                                                                  02820002
006180 01  CPU-TIME.                                                    02830002
006190     05  CPU-HOUR                    PIC X(02)     VALUE SPACES.  02840002
006200     05  CPU-MINUTE                  PIC X(02)     VALUE SPACES.  02850002
006300     05  FILLER                      PIC X(02)     VALUE SPACES.  02860002
006400                                                                  02870002
006500 01  SKIP-CLASS-RECORD.                                           02880002
006600     05  SKIP-CLASS-NBR          PIC X(05).                       02890002
006700     05  FILLER                  PIC X(75).                       02900002
006800                                                                  02910002
006900 01  SKIP-CLASS-TABLE.                                            02920002
007000     05  SKIP-CLASS              OCCURS     30                    02930002
007100                                 INDEXED    SKIP-IDX              02940002
007200                                 PIC X(5).                        02950002
007300                                                                  02960002
007400 01  PA-PROGRAM-ACCUMULATORS.                                     02970004
007500     05  PA-RECEIPT-FILE-IN              PIC 9(09).               02970111
007600     05  PA-DEFERRED-FILE-OUT            PIC 9(09).               02971011
007700     05  PA-MERCH-FILE-OUT               PIC 9(09).               02980011
007800                                                                  04071104
007900 01  PV-PROGRAM-VARIABLES.                                        04072004
008000     05  PV-AP-TRANS-CDE                 PIC X(2).                04073004
008100         88  PV-AP-TRANS-CDE-RECEIPT              VALUE '01'.     04074004
008200         88  PV-AP-TRANS-CDE-TRANSFER                             04080002
008300                                                  VALUE '52' '53' 04090002
008400                                                        '54' '55'.04100002
008500     05  PV-WORK-DIVISION.                                        04104118
008600         10  FILLER                      PIC  X(1).               04104218
008700         10  PV-DIVISION                 PIC  X(2).               04104318
008800     05  PV-PREV-MMDDYY-X.                                        04104418
008900         10  PV-PREV-MMDDYY-MM           PIC  9(2).               04104518
009000         10  PV-PREV-MMDDYY-DD           PIC  9(2).               04104618
009100         10  PV-PREV-MMDDYY-YY           PIC  9(2).               04105002
009200     05  PV-ISO-DTE                      PIC X(10).               04110002
009300     05  PV-ISO-DTEX  REDEFINES          PV-ISO-DTE.              04120002
009400         10  PV-ISO-CC                   PIC 9(02).               04130002
009500         10  PV-ISO-YY                   PIC X(02).               04140002
009600         10  PV-ISO-SL1                  PIC X(01).               04150002
009700         10  PV-ISO-MM                   PIC X(02).               04160002
009800         10  PV-ISO-SL2                  PIC X(01).               04170002
009900         10  PV-ISO-DD                   PIC X(02).               04180002
010000                                                                  04190002
010100     05  PV-PROCESS-DATE                 PIC X(10).               04200002
010200     05  PV-PROCESS-DATEX REDEFINES      PV-PROCESS-DATE.         04210002
010300         10  PV-PROC-CC                  PIC 9(02).               04220002
010400         10  PV-PROC-YY                  PIC 9(02).               04230002
010500         10  FILLER                      PIC X(01).               04240002
010600         10  PV-PROC-MM                  PIC 9(02).               04250002
010700         10  FILLER                      PIC X(01).               04260002
010800         10  PV-PROC-DD                  PIC 9(02).               04270002
010900                                                                  04280002
011000     05  PV-RETRY-CNT                    PIC S9(04) VALUE +0      04290002
011100                                             COMP SYNC.           04300002
011200     05  PV-DEPT-NBR-X                   PIC X(03).               04310002
011300     05  FILLER  REDEFINES  PV-DEPT-NBR-X.                        04320002
011400         10  PV-DEPT-NBR-9               PIC 9(03).               04330002
011500     05  PV-DEPT-NBR-B                   PIC S9(04) VALUE +0      04340002
011600                                             COMP SYNC.           04350002
011700     05  PV-PARAGRAPH-NAME               PIC X(30).               04360002
011800     05  PV-DB2-OPERATION                PIC X(30)  VALUE SPACE.  04370002
011900     05  PV-DEF-RCPT-DAYS-BACKOFF        PIC 9(02)  VALUE 0.      04380002
012000     05  PV-DEF-CUTOFF-DTE-ISO.                                   04400002
012100         10  PV-DEF-CUTOFF-MM            PIC 9(02).               04410002
012200         10  PV-DEF-CUTOFF-DD            PIC 9(02).               04420002
012300         10  PV-DEF-CUTOFF-CC            PIC 9(02).               04430002
012400         10  PV-DEF-CUTOFF-YY            PIC 9(02).               04440002
012500     05  PV-CUT-CCYYMMDD                 PIC 9(08).               04441002
012600     05  PV-CUT-CCYYMMDD-X   REDEFINES  PV-CUT-CCYYMMDD.          04442002
012700         10  PV-CUT-CCYYMMDD-CC          PIC 9(02).               04447202
012800         10  PV-CUT-CCYYMMDD-YY          PIC 9(02).               04447302
012900         10  PV-CUT-CCYYMMDD-MM          PIC 9(02).               04447402
013000         10  PV-CUT-CCYYMMDD-DD          PIC 9(02).               04447502
013100     05  PV-LAST-CCYYMMDD                PIC 9(08).               04447602
013200     05  PV-LAST-CCYYMMDD-X  REDEFINES  PV-LAST-CCYYMMDD.         04447702
013300         10  PV-LAST-CCYYMMDD-CC         PIC 9(02).               04447802
013400         10  PV-LAST-CCYYMMDD-YY         PIC 9(02).               04447902
013500         10  PV-LAST-CCYYMMDD-MM         PIC 9(02).               04448002
013600         10  PV-LAST-CCYYMMDD-DD         PIC 9(02).               04448102
013700     05  PV-WORK-CCYYMMDD                PIC 9(08).               04448203
013800     05  PV-WORK-CCYYMMDD-X  REDEFINES  PV-WORK-CCYYMMDD.         04448304
013900         10  PV-WORK-CCYYMMDD-CC         PIC 9(02).               04448403
014000         10  PV-WORK-CCYYMMDD-YY         PIC 9(02).               04448503
014100         10  PV-WORK-CCYYMMDD-MM         PIC 9(02).               04448603
014200         10  PV-WORK-CCYYMMDD-DD         PIC 9(02).               04448703
014300     05  PV-TRAN-CCYYMMDD                PIC 9(08).               04448803
014400     05  PV-TRAN-CCYYMMDD-X  REDEFINES  PV-TRAN-CCYYMMDD.         04448903
014500         10  PV-TRAN-CCYYMMDD-CC         PIC 9(02).               04449003
014600         10  PV-TRAN-CCYYMMDD-YY         PIC 9(02).               04449103
014700         10  PV-TRAN-CCYYMMDD-MM         PIC 9(02).               04449203
014800         10  PV-TRAN-CCYYMMDD-DD         PIC 9(02).               04449303
014900     05  PV-DEFER-DIV-SW                 PIC X(01)   VALUE 'N'.   04450002
015000         88  PV-DEFER-DIV-NONE                       VALUE 'N'.   04460002
015100         88  PV-DEFER-DIV-ALL                        VALUE 'A'.   04470002
015200         88  PV-DEFER-DIV-SPEC                       VALUE 'S'.   04480002
015300     05  PV-DEFER-TYPE-SW                PIC X(01)   VALUE 'N'.   04490002
015400         88  PV-NOT-DEFER-TYPE                       VALUE 'N'.   04500002
015500         88  PV-DEFER-TYPE                           VALUE 'Y'.   04510002
015600     05  PV-DEFERRED-TRAN-SW             PIC X(01)   VALUE 'N'.   04520002
015700         88  PV-NOT-DEFERRED-TRAN                    VALUE 'N'.   04530002
015800         88  PV-DEFERRED-TRAN                        VALUE 'Y'.   04540002
015900     05  PV-PREV-DEFERRED-TRAN-SW        PIC X(01)   VALUE 'N'.   04540102
016000         88  PV-NOT-PREV-DEFERRED-TRAN               VALUE 'N'.   04540202
016100         88  PV-PREV-DEFERRED-TRAN                   VALUE 'Y'.   04540302
016200     05  PV-TEMP-CCYY                    PIC X(04).               04541002
016300                                                                  04550002
016400 01  PS-SWITCHES.                                                 04560002
016500     05  PS-ERROR-SW                   PIC X       VALUE 'N'.     04570002
016600         88  PS-NO-ERROR                           VALUE 'N'.     04580002
016700         88  PS-ERROR                              VALUE 'Y'.     04590002
016800     05  PS-DATE-ERROR-SW              PIC X(01)   VALUE 'N'.     04600003
016900         88  PS-NO-DATE-ERROR                      VALUE 'N'.     04610003
017000         88  PS-DATE-ERROR                         VALUE 'Y'.     04620003
017100     05  PS-EOF-RECEIPT-FILE-SW        PIC X(01)   VALUE 'N'.     04630003
017200         88  PS-NOT-EOF-RECEIPT                    VALUE 'N'.     04640003
017300         88  PS-EOF-RECEIPT                        VALUE 'Y'.     04650003
017400     05  PS-EOF-CNTL-DEF-FILE-SW       PIC X(01)   VALUE 'N'.     04660004
017500         88  PS-NOT-EOF-CNTL-DEF-FILE              VALUE 'N'.     04670004
017600         88  PS-EOF-CNTL-DEF-FILE                  VALUE 'Y'.     04680004
017700     05  PS-DEFER-RECORD-SW            PIC X(01)   VALUE 'N'.     04690004
017800         88  PS-DONT-DEFER-RECORD                  VALUE 'N'.     04700004
017900         88  PS-DEFER-RECORD                       VALUE 'Y'.     04710004
018000                                                                  04990002
018100 01  PC-PROGRAM-CONSTANTS.                                        05000002
018200     05  PC-MAX-RETRIES                  PIC S9(4)   VALUE +3     05010002
018300                                                     COMP-3.      05020002
018400     05  PC-MAX-RPT-ITEMS                PIC S9(3)   VALUE +20    05030002
018500                                                     COMP-3.      05040002
018600     05  PC-MORE-THAN-MAX-RETRY          PIC S9(4)   VALUE +4.    05050002
018700     05  PC-END-OF-REPORT                PIC  X(133) VALUE        05060002
018800         '-*** END OF REPORT ***'.                                05070002
018900     05  PC-MAX-SKIP-RECS                PIC S9(4)   VALUE +30.   05080002
019000     05  PC-AP-TRANS-CDE-TRANSFER        PIC  X(2)   VALUE '54'.  05090002
019100     05  PC-TYP-CDE-TRANSFER             PIC  X      VALUE '2'.   05100002
019200     05  PC-DPKUT500                     PIC  X(08)  VALUE        05110002
019300         'DPKUT500'.                                              05120002
019400                                                                  05130002
019500                                                                  06400002
019600***************************************************************** 06410002
019700*  WORK AREA PASSED IN CALL TO DPKUT500                          *06420002
019800***************************************************************** 06430002
019900     COPY DPWS500.                                                06440002
020000                                                                  06450002
020100***************************************************************** 06452003
020200*                                                                *06453003
020300***************************************************************** 06454003
020400     COPY STOREEXT.                                               06455003
020500                                                                  06456003
020600******************************************************************06460002
020700*  DB2 FORMATTED MESSAGES                                        *06470002
020800******************************************************************06480002
020900     COPY DPWS004.                                                06490002
021000                                                                  06500002
021100 01  ABEND-CODE                          PIC S9(04)  VALUE +0     06800002
021200                                                     COMP SYNC.   06810002
021300     88  ABEND-4003                                  VALUE +4003. 06820002
021400     EJECT                                                        06830002
021500 PROCEDURE DIVISION.                                              07200002
021600                                                                  07210002
021700 0000-MAIN-MODULE.                                                07220002
021800******************************************************************07230002
021900*  MAIN PROCESSING.                                               07240002
022000******************************************************************07250002
022100                                                                  07260002
022200     PERFORM 1000-HOUSEKEEPING.                                   07270002
022300                                                                  07280002
022400     PERFORM 2000-PROCESS-INPUT-FILES                             07290003
022500         UNTIL PS-EOF-RECEIPT.                                    07291004
022600                                                                  07300002
022700     PERFORM 9000-END-OF-PROGRAM.                                 07310003
022800                                                                  07320002
022900     STOP RUN.                                                    07330002
023000*                                                                 07340002
023100 1000-HOUSEKEEPING.                                               07350002
023200******************************************************************07360002
023300******************************************************************07370002
023400                                                                  07380002
023500     OPEN  INPUT DAILY-RECEIPTS-FILE                              07390002
023600                 PROCESS-DATE-FILE                                07400005
023700                 CC-DEFERRED-PARM-FILE                            07410002
023800          OUTPUT DEFERRED-REPORT-FILE                             07420002
023900                 MERCH-REPORT-FILE.                               07430002
024000                                                                  07460002
024100     INITIALIZE PV-PROGRAM-VARIABLES                              07470002
024200                PA-PROGRAM-ACCUMULATORS.                          07471011
024300                                                                  07910002
024400     PERFORM 1100-PROCESS-CNTL-DATE.                              07920004
024500     PERFORM 1200-PROCESS-CNTL-DEFERRED.                          07930004
024600                                                                  07931004
024700     ACCEPT CPU-DATE FROM DATE.                                   07940002
024800                                                                  07980002
024900     ACCEPT CPU-TIME FROM TIME.                                   07990002
025000                                                                  08050002
025100     IF  NOT (PV-DEFER-DIV-NONE)                                  08051002
025200         PERFORM 1220-GET-DEFERRED-RCPTS-DATE                     08060003
025300     END-IF.                                                      08071002
025400                                                                  08071103
025500     PERFORM 7000-READ-RECEIPTS-FILE.                             08071204
025600                                                                  08072002
025700     EJECT.                                                       08080002
025800                                                                  08090002
025900***************************************************************   08091003
026000*  1100-PROCESS-CNTL-DATE.  READ/VALIDATE THE CONTROL CARD    *   08092003
026100*       THAT CONTAINS THE CONTROL DATE                        *   08092103
026200***************************************************************   08093003
026300 1100-PROCESS-CNTL-DATE.                                          08100003
026400                                                                  08110002
026500     MOVE '1100-PROCESS-CNTL-DATE' TO PV-PARAGRAPH-NAME.          08120003
026600                                                                  08130002
026700     READ PROCESS-DATE-FILE INTO CC-PROCESS-DATE-RECORD           08140004
026800         AT END                                                   08150002
026900             DISPLAY '** PROGRAM ABEND **'                        08160002
027000             DISPLAY 'MPKUT036  - CONTROL DATE EMPTY'             08170003
027100             DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME              08171006
027200             MOVE +4003              TO ABEND-CODE                08180002
027300             PERFORM 9999-ABEND.                                  08190004
027400                                                                  08200002
027500     DISPLAY '**************************************************' 08210012
027600     DISPLAY '** MPKUT036 CONTROL CARD: ' CC-PROCESS-DATE-RECORD  08210112
027700     DISPLAY '**          PROCESS DATE: ' CC-PROCESS-DATE         08210212
027800     DISPLAY '**         CALENDAR TYPE: ' CC-CALENDAR-TYPE        08210312
027900                                                                  08220002
028000     IF CC-PROCESS-YY > 95                                        08270009
028100        MOVE 19               TO PV-ISO-CC                        08270103
028200     ELSE                                                         08270203
028300        MOVE 20               TO PV-ISO-CC                        08270303
028400     END-IF.                                                      08270403
028500     MOVE CC-PROCESS-MM       TO PV-ISO-MM.                       08270503
028600     MOVE CC-PROCESS-DD       TO PV-ISO-DD.                       08270603
028700     MOVE CC-PROCESS-YY       TO PV-ISO-YY.                       08270703
028800     MOVE '-'                 TO PV-ISO-SL1                       08270806
028900                                 PV-ISO-SL2.                      08270906
029000                                                                  08280002
029100     PERFORM 9220-SPECIAL-DATE-CALL.                              08290006
029200                                                                  08300002
029300     IF  PS-DATE-ERROR                                            08310003
029400         DISPLAY '** PROGRAM ABEND **'                            08320002
029500         DISPLAY 'MPKUT036  - INVALID CONTROL DATE CARD: '        08330003
029600             CC-PROCESS-DATE-RECORD                               08340003
029700         DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME                  08341006
029800         MOVE +4003              TO ABEND-CODE                    08350002
029900         PERFORM 9999-ABEND                                       08360003
030000     END-IF.                                                      08361003
030100                                                                  08500002
030200     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-PROCESS-DATE             08650002
030300     MOVE PV-PROC-CC               TO PV-LAST-CCYYMMDD-CC         08840002
030400     MOVE PV-PROC-YY               TO PV-LAST-CCYYMMDD-YY         08850002
030500     MOVE PV-PROC-MM               TO PV-LAST-CCYYMMDD-MM         08870002
030600     MOVE PV-PROC-DD               TO PV-LAST-CCYYMMDD-DD.        08890002
030700                                                                  09220002
030800     EJECT                                                        09230002
030900                                                                  09240002
031000                                                                  09241003
031100***************************************************************   09242003
031200*  1200-PROCESS-CNTL-DEFERRED  READ/VALIDATE THE CONTROL CARD *   09243003
031300*       THAT CONTAINS THE DEFERRED CONTROL DATA               *   09244003
031400***************************************************************   09245003
031500 1200-PROCESS-CNTL-DEFERRED.                                      09250003
031600     MOVE '1200-PROCESS-CNTL-DEFERRED' TO PV-PARAGRAPH-NAME       09260003
031700                                                                  09270002
031800     READ CC-DEFERRED-PARM-FILE INTO CD-CNTL-DEF-RCPTS-CARD       09280003
031900         AT END                                                   09290002
032000             DISPLAY '** PROGRAM ABEND **'                        09300002
032100             DISPLAY 'MPKUT036  - CONTROL DEFERRED RCPTS EMPTY'   09310003
032200             DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME              09311006
032300             MOVE +4003              TO ABEND-CODE                09320002
032400             PERFORM 9999-ABEND                                   09330003
032500     END-READ.                                                    09331003
032600                                                                  09340002
032700     DISPLAY '**************************************************' 09341012
032800     DISPLAY '** MPKUT036 CONTROL DEFERRED: '                     09350010
032900                    CD-CNTL-DEF-RCPTS-CARD.                       09351003
033000     DISPLAY '**   DEFERRED NUMBER OF DAYS: '                     09351110
033100                    CD-DEFER-RCPT-NBR-DAYS.                       09352010
033200     DISPLAY '**     DEFERRED DIVISION IND: '                     09352110
033300                     CD-DEFER-DIVISION-IND.                       09353010
033400                                                                  09360002
033500*    SUBTRACT 1 FROM THE NUMBER OF DEFERRED DAYS SO THE DATE      09361003
033600*    ROUTINE WILL SELECT A DATE THAT WILL INCLUDE THE LAST DAY    09362003
033700*    OF THE MONTH                                                 09363003
033800     EVALUATE CD-DEFER-RCPT-NBR-DAYS                              09370002
033900         WHEN 00 THRU 99                                          09380002
034000              DISPLAY CD-DEFER-RCPT-NBR-DAYS                      09390002
034100                '    = #DAYS TO DEFER RCPTS BEFORE (& INCLUDING)' 09400002
034200                ' THE LAST DAY OF THE MONTH'                      09401002
034300              MOVE CD-DEFER-RCPT-NBR-DAYS TO                      09401214
034400                       PV-DEF-RCPT-DAYS-BACKOFF                   09401302
034500         WHEN OTHER                                               09410002
034600              DISPLAY '** ABEND **'                               09420002
034700              DISPLAY '** PROGRAM MPKUT036 **'                    09430003
034800              DISPLAY '** PARAGRAPH ' PV-PARAGRAPH-NAME           09440002
034900              DISPLAY 'NON-NUMERIC #DAYS TO DEFER RECPTS'         09450002
035000              MOVE +4003 TO ABEND-CODE                            09460002
035100              PERFORM 9999-ABEND                                  09470003
035200     END-EVALUATE.                                                09480003
035300                                                                  09490002
035400     EVALUATE CD-DEFER-DIVISION-IND                               09500002
035500         WHEN 'N'                                                 09510002
035600              DISPLAY '**    ' CD-DEFER-DIVISION-IND       095200 09520010
035700                '     = DEFERRED RECEIPTS FOR NO DIVISIONS'       09530002
035800              SET PV-DEFER-DIV-NONE TO TRUE                       09540002
035900                                                                  09550002
036000         WHEN 'A'                                                 09560002
036100              DISPLAY '**    ' CD-DEFER-DIVISION-IND              09570010
036200                '     = DEFERRED RECEIPTS FOR ALL DIVISIONS'      09580002
036300              SET PV-DEFER-DIV-ALL  TO TRUE                       09590002
036400                                                                  09600002
036500         WHEN 'S'                                                 09610002
036600              DISPLAY '**    ' CD-DEFER-DIVISION-IND              09620010
036700                '     = DEFERRED RECEIPTS FOR SPECIFIC DIVISIONS' 09630002
036800              SET PV-DEFER-DIV-SPEC TO TRUE                       09640002
036900              PERFORM 1210-LOAD-DEFER-DIV-TBL                     09650004
037000                                                                  09660002
037100         WHEN OTHER                                               09670002
037200              DISPLAY '** ABEND **'                               09680002
037300              DISPLAY '** PROGRAM MPKUT036 **'                    09690003
037400              DISPLAY '** PARAGRAPH ' PV-PARAGRAPH-NAME           09700002
037500              DISPLAY 'INVALID DEFERRED RECEIPTS DIVISION SWITCH' 09710002
037600              MOVE +4003 TO ABEND-CODE                            09720002
037700              PERFORM 9999-ABEND                                  09730003
037800     END-EVALUATE.                                                09740002
037900                                                                  09740102
038000*    IF THE DEFERRED RECPTS DAYS IS 0, IT ESSENTIALLY MEANS THAT  09740203
038100*    NOTHING WILL BE DEFERRED                                     09740303
038200     IF  CD-DEFER-RCPT-NBR-DAYS = 00 AND                          09741002
038300         NOT (PV-DEFER-DIV-NONE)                                  09741102
038400         SET PV-DEFER-DIV-NONE TO TRUE                            09741202
038500         DISPLAY '**    ' PV-DEFER-DIV-SW                         09742010
038600           '     = FORCE NO DEFERRED RECEIPTS'                    09743002
038700     END-IF.                                                      09745002
038800                                                                  09746002
038900     EJECT                                                        09750002
039000                                                                  09760002
039100 1210-LOAD-DEFER-DIV-TBL.                                         09770004
039200     MOVE HIGH-VALUES TO VT-DIVISION-TABLE                        09780002
039300                                                                  09800002
039400     READ CC-DEFERRED-PARM-FILE INTO CD-CNTL-DEF-RCPTS-CARD       09800103
039500       AT END                                                     09802002
039600         SET PS-EOF-CNTL-DEF-FILE TO TRUE                         09803004
039700     END-READ.                                                    09804003
039800                                                                  09804103
039900     IF  PS-EOF-CNTL-DEF-FILE                                     09805004
040000         DISPLAY '** PROGRAM ABEND **'                            09806002
040100         DISPLAY '** MPKUT036 NO DIVISIONS SPECIFIED BUT '        09807003
040200                 'DEF RECEIPTS FOR SPECIFIC DIV IND: '            09809002
040300                  CD-DEFER-DIVISION-IND                           09809102
040400         DISPLAY '**       PARAGRAPH: ' PV-PARAGRAPH-NAME         09809211
040500         MOVE +4003              TO ABEND-CODE                    09809302
040600         PERFORM 9999-ABEND                                       09809403
040700     END-IF.                                                      09809503
040800                                                                  09809602
040900*    FOR EACH DIVISION ON THE DEFERRED CONTROL CARD, MOVE IT TO   09809703
041000*    THE TABLE MEMBER EQUAL TO THE DIVISION NUMBER (DIRECTLY      09809803
041100*    ACCESS THE TABLE BY DIVISION NUMBER)                         09809903
041200     PERFORM UNTIL PS-EOF-CNTL-DEF-FILE                           09810004
041300         IF PS-NOT-EOF-CNTL-DEF-FILE                              09890004
041400             IF  CD-DEFER-DIV-NBR  NUMERIC                        09900102
041500                 MOVE CD-DEFER-DIV-NBR   TO VT-SUB-X              09910002
041600                 MOVE CD-DEFER-DIV-NBR   TO VT-DIV-NBR (VT-SUB)   09910102
041700                 DISPLAY '**    SELECTED DIVISION NUMBER: '       09910315
041800                         CD-DEFER-DIV-NBR                         09910415
041900             ELSE                                                 09911002
042000                 DISPLAY '** PROGRAM ABEND **'                    09911102
042100                 DISPLAY '** MPKUT036 DIVISION NON-NUMERIC: '     09911303
042200                         CD-DEFER-DIV-NBR                         09911402
042300                         '. DEF RECEIPTS FOR SPECIFIC DIV IND: '  09911502
042400                          CD-DEFER-DIVISION-IND                   09911602
042500                 DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME          09911706
042600                 MOVE +4003              TO ABEND-CODE            09911802
042700                 PERFORM 9999-ABEND                               09911903
042800             END-IF                                               09920002
042900         END-IF                                                   09921002
043000                                                                  09921102
043100         READ CC-DEFERRED-PARM-FILE INTO CD-CNTL-DEF-RCPTS-CARD   09921203
043200           AT END                                                 09923002
043300             SET PS-EOF-CNTL-DEF-FILE TO TRUE                     09924004
043400         END-READ                                                 09925002
043500                                                                  09926002
043600     END-PERFORM.                                                 09930002
043700                                                                  09940002
043800     EJECT                                                        09970002
043900                                                                  09980002
044000****************************************************************  09981003
044100* 1220-GET-DEFERRED-RCPTS-DATE                                 *  09982003
044200* USING THE LAST DAY OF THE FISCAL MONTH (FROM THE PREVIOUS    *  09982103
044300* CALL TO THE CALENDAR ROUTINE) PULL BACK THE NUMBER OF DAYS   *  09982203
044400* RETRIEVED FROM THE CONTROL CARD.  THIS WILL BE THE REPORT    *  09982303
044500* CUTOFF DATE.                                                 *  09982403
044600****************************************************************  09983003
044700 1220-GET-DEFERRED-RCPTS-DATE.                                    09990003
044800     MOVE CC-CALENDAR-TYPE      TO DPG51-CALENDAR-TYPE.           10000003
044900                                                                  10010002
045000***  USE LAST DAY OF FISCAL MONTH OUTPUT AS INPUT TO CUTOFF DATE. 10020002
045100     MOVE DPG56-LAST-FP-DB2-ISO-FMT TO DPG52-LK-DATE-INPUT.       10030010
045200     DISPLAY '**  LAST DAY OF FISCAL MONTH: '                     10040011
045300             DPG56-LAST-FP-DB2-ISO-FMT.                           10041011
045400     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   10050003
045500     SET  DPG51-DECREMENT-DATE         TO TRUE.                   10060003
045600     MOVE PV-DEF-RCPT-DAYS-BACKOFF                                10070002
045700                                TO DPG51-INCR-DECR-DAYS-9.        10072003
045800                                                                  10073002
045900     CALL PC-DPKUT500                                             10090002
046000         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               10100003
046100                                                                  10110002
046200     IF (DPG54-DATE-INVALID OR                                    10120002
046300         DPG54-SEVERE-ERROR)                                      10130002
046400         DISPLAY '** PROGRAM ABEND **'                            10150002
046500         DISPLAY 'MPKUT036  - INVALID DEFERRED DATE CALC'         10151003
046600         DISPLAY 'PARAGRAPH: ' PV-PARAGRAPH-NAME                  10152006
046700         MOVE +4003          TO ABEND-CODE                        10153002
046800         PERFORM 9999-ABEND                                       10154003
046900     ELSE                                                         10160002
047000         MOVE DPG55-GREG-CC-DATE TO PV-DEF-CUTOFF-DTE-ISO         10170002
047100         MOVE PV-DEF-CUTOFF-MM   TO PV-CUT-CCYYMMDD-MM            10171002
047200         MOVE PV-DEF-CUTOFF-DD   TO PV-CUT-CCYYMMDD-DD            10172002
047300         MOVE PV-DEF-CUTOFF-CC   TO PV-CUT-CCYYMMDD-CC            10172102
047400         MOVE PV-DEF-CUTOFF-YY   TO PV-CUT-CCYYMMDD-YY            10174002
047500     END-IF.                                                      10180003
047600                                                                  10190002
047700     DISPLAY '**      CUTOFF DATE MMDDCCYY: '                     10200011
047800             PV-DEF-CUTOFF-DTE-ISO.                               10210002
047900     EJECT                                                        10220002
048000*                                                                 11610002
048100*                                                                 11620002
048200******************************************************************11830003
048300*    FOR EACH RECORD ON THE FILE, COMPARE TO THE CUTOFF DATE, AND 11840003
048400*    WRITE TO THE APPROPRIATE FILE.                               11841003
048500******************************************************************11850003
048600                                                                  11860003
048700 2000-PROCESS-INPUT-FILES.                                        15650003
048800     EVALUATE TRUE                                                15651003
048900         WHEN PV-DEFER-DIV-NONE                                   15651103
049000             PERFORM 7200-WRITE-MERCH-FILE                        15651203
049100                                                                  15651303
049200         WHEN OTHER                                               15651603
049300             PERFORM 2100-CHECK-CUTOFF                            15652203
049400             IF PS-DEFER-RECORD                                   15652303
049500             AND PV-DEFER-DIV-SPEC                                15652403
049600                 PERFORM 2200-CHECK-DIVISION                      15652503
049700             END-IF                                               15652603
049800             IF PS-DEFER-RECORD                                   15652703
049900                 PERFORM 7100-WRITE-DEFER-FILE                    15652803
050000             ELSE                                                 15652903
050100                 PERFORM 7200-WRITE-MERCH-FILE                    15653003
050200             END-IF                                               15653103
050300                                                                  15653203
050400     END-EVALUATE.                                                15653303
050500                                                                  15655007
050600     PERFORM 7000-READ-RECEIPTS-FILE.                             15656007
050700                                                                  15661003
050800******************************************************************15661103
050900*    READ THE NEXT RECORD ON THE RECEIPTS FILE                    15661203
051000******************************************************************15661403
051100 2100-CHECK-CUTOFF.                                               15661603
051200                                                                  15661703
051210*   IF THE RECORD IS A DIRECT STORE RECEIPT, THEN DO NOT DEFER            
051300*   THE RECEIPT.  IF THE RECORD IS AN ADJUSTMENT RECORD OR A      15661803
051400*   DC RECEIPT RECORD, THEN USE THE VERIFIED DATE TO DETERMINE    15661903
051500*   IF IT SHOULD BE DEFERRED.                                           06
051501*                                                                         
051502*    IF THE VERIFIED DATE IS GREATER THAN THE CUTOFF DATE,              04
051503*    DEFER THE RECORD.                                            15664304
051510                                                                          
051600     IF  SE-RECEIVING-LOCATION = 'DS'                                   04
051610         SET PS-DONT-DEFER-RECORD  TO TRUE                        15    66
052600     ELSE                                                         15663104
052700         MOVE SE-DV-MM         TO PV-WORK-CCYYMMDD-MM             15663204
052800         MOVE SE-DV-DD         TO PV-WORK-CCYYMMDD-DD             15663304
052900         MOVE SE-DV-YY         TO PV-WORK-CCYYMMDD-YY             15663404
053000         IF  SE-DV-YY > 80                                              04
053100             MOVE 19           TO PV-WORK-CCYYMMDD-CC                   04
053200         ELSE                                                           04
053300             MOVE 20           TO PV-WORK-CCYYMMDD-CC                   04
053400         END-IF                                                         04
053410         IF  PV-WORK-CCYYMMDD > PV-CUT-CCYYMMDD                         66
053420             SET PS-DEFER-RECORD       TO TRUE                          66
053430         ELSE                                                           66
053440             SET PS-DONT-DEFER-RECORD  TO TRUE                          66
053450         END-IF                                                         66
053500     END-IF.                                                            04
053600                                                                  15664104
054400                                                                  15665303
054500                                                                  15665403
054600******************************************************************15665503
054700*    READ THE NEXT RECORD ON THE RECEIPTS FILE                    15665603
054800******************************************************************15665703
054801 2200-CHECK-DIVISION.                                             15665803
054802     MOVE SE-DIVISION-SEQNO TO PV-WORK-DIVISION                   15665918
054803     MOVE PV-DIVISION       TO VT-SUB-X                           15666018
054804     IF  VT-DIV-NBR (VT-SUB) = PV-DIVISION                        15666318
054805        SET PS-DEFER-RECORD       TO TRUE                         15666403
054806     ELSE                                                         15666918
054807        SET PS-DONT-DEFER-RECORD  TO TRUE                         15667118
054808     END-IF.                                                      15667618
054809                                                                  15667718
054810                                                                  15667818
054820******************************************************************15667918
054830*    READ THE NEXT RECORD ON THE RECEIPTS FILE                    15668018
054840******************************************************************15668118
054850                                                                  15668218
054860 7000-READ-RECEIPTS-FILE.                                         15668318
054870                                                                  15668418
054880     READ DAILY-RECEIPTS-FILE INTO STORE-EXTRACT-LINE             15668518
054890       AT END                                                     15668618
054900         SET PS-EOF-RECEIPT TO TRUE                               15668718
055000     END-READ.                                                    15668818
055100     IF NOT PS-EOF-RECEIPT                                        15668918
055200         ADD +1 TO PA-RECEIPT-FILE-IN                             15669018
055300     END-IF.                                                      15669118
055400                                                                  15669218
055500******************************************************************15669318
055600* 7100-WRITE-DEFER-FILE                                           15669418
055700*    WRITE THE CURRENT RECORD TO THE DEFERRED RECEIPTS FILE       15669518
055800******************************************************************15669618
055900                                                                  15669718
056000 7100-WRITE-DEFER-FILE.                                           15669818
056100                                                                  15669918
056200      WRITE DEFERRED-REPORT-RECORD                                15670018
056300          FROM STORE-EXTRACT-LINE.                                15670118
056301     ADD +1 TO PA-DEFERRED-FILE-OUT.                              15670218
056302                                                                  15670318
056303******************************************************************15670418
056304* 7200-WRITE-MERCH-FILE                                           15670518
056305*    WRITE THE CURRENT RECORD TO THE MERCHANT RECEIPTS FILE       15670618
056306******************************************************************15670718
056307                                                                  15670818
056308 7200-WRITE-MERCH-FILE.                                           15670918
056309                                                                  15671018
056310      WRITE MERCH-REPORT-RECORD                                   15671118
056320          FROM STORE-EXTRACT-LINE.                                15671218
056330     ADD +1 TO PA-MERCH-FILE-OUT.                                 15671318
056340                                                                  15672003
056350                                                                  15680003
056360                                                                  16380002
056370                                                                  23741002
056380******************************************************************23742003
056390* 9220-SPECIAL-DATE-CALL.                                         23743003
056400*    CALL THE CALENDAR ROUTINE TO VERIFY THE INPUT DATE,  AND TO  23744003
056500*    GET THE FISCAL MONTH END DATE USED TO CALCULATE THE CUTOFF   23744103
056600*    DATE.                                                        23744203
056700******************************************************************23745003
056800                                                                  23746003
056900 9220-SPECIAL-DATE-CALL.                                          23750003
057000                                                                  23760002
057100     INITIALIZE DPG51                                             23770002
057200                DPG52                                             23780002
057300                DPG53                                             23790002
057400                DPG54                                             23800002
057500                DPG55                                             23810002
057600                DPG56                                             23820002
057700                                                                  23830002
057800     SET DPG51-DO-NOT-INCR-DECR-DATE                              23840002
057900                                TO TRUE                           23850002
058000                                                                  23860002
058100     MOVE PV-ISO-DTE            TO DPG52-LK-DATE-INPUT            23870002
058200                                                                  23880002
058300     MOVE CC-CALENDAR-TYPE      TO DPG51-CALENDAR-TYPE            23930002
058400     SET  DPG52-LK-DTE-ISO-FMT  TO TRUE                           23940002
058500                                                                  23950002
058600     CALL PC-DPKUT500                                             23960002
058700         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                23970002
058800                                                                  23980002
058900     IF (DPG54-DATE-INVALID OR                                    23990002
059000         DPG54-SEVERE-ERROR)                                      24000002
059100         SET PS-DATE-ERROR  TO TRUE                               24010003
059200         DISPLAY 'DPKUT500 ERROR = ' DPG54-ERROR-MESSAGE          24020003
059300     END-IF.                                                      24030002
059400     EJECT                                                        24040002
059500                                                                  26190002
059600 9000-END-OF-PROGRAM.                                             26200003
059700******************************************************************26210003
059800*    CLOSE THE FILES AND DISPLAY COUNTS                           26220003
059900******************************************************************26221003
060000                                                                  26222003
060100     DISPLAY '**************************************************' 26222112
060200     DISPLAY '**        INPUT RECORDS READ: '                     26223011
060300         PA-RECEIPT-FILE-IN.                                      26224011
060400     DISPLAY '**  DEFERRED RECORDS WRITTEN: '                     26224111
060500         PA-DEFERRED-FILE-OUT.                                    26225011
060600     DISPLAY '**     MERCH RECORDS WRITTEN: '                     26225111
060700         PA-MERCH-FILE-OUT.                                       26226011
060800                                                                  26227011
060900     CLOSE DAILY-RECEIPTS-FILE                                    26229204
061000           PROCESS-DATE-FILE                                      26229305
061100           CC-DEFERRED-PARM-FILE                                  26229404
061200           DEFERRED-REPORT-FILE                                   26229504
061300           MERCH-REPORT-FILE.                                     26229604
061400                                                                  26230003
061500 9999-ABEND.                                                      26240003
061600                                                                  26250003
061700     CALL 'ILBOABN0'             USING ABEND-CODE.                26260003
061800                                                                  26270003
