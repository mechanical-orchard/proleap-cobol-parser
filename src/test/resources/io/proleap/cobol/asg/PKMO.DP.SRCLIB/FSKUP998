       IDENTIFICATION DIVISION.                                                 
      ******************************************************************        
                                                                                
       PROGRAM-ID.   FSKUP998.                                                  
       AUTHOR.       HEMAVATHY.                                                 
       INSTALLATION. KOHLS DEPARTMENT STORES.                                   
       DATE-WRITTEN. 03/14/2019.                                                
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * READ INPUT FILES,CHECK ITEM NUMBER IN TSKXREF AND UPDATE  TSKST*        
      ******************************************************************        
      ******************************************************************        
      * CHANGE HISTORY:                                                         
      *  WR/PBI        DATE        DESCRIPTION OF CHANGES                       
      *  ----------    --------    ------------------------------------         
      *                03/14/19    ONE TIME PROGRAM.                            
      *                03/22/19    COPIED FROM FSKUP998 AND TWEAKED             
      *                            CORRECT MAX LAST RECEIPT                     
      *                            AND     MIN LAST RECEIPT                     
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.                        IBM-3090.                        
       OBJECT-COMPUTER.                        IBM-3090.                        
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT INPUT-SKU-FILE ASSIGN TO INP01.                               
           SELECT INPUT-FRD-FILE ASSIGN TO INP02.                               
           SELECT INPUT-SKU-LRD  ASSIGN TO INP03.                               
           SELECT INPUT-SKU-FRD  ASSIGN TO INP04.                               
           SELECT OUTPUT-AUDIT-FILE ASSIGN TO OUT01.                    00630007
                                                                        00650007
                                                                                
      ******************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
       FILE SECTION.                                                            
                                                                                
       FD  INPUT-SKU-FILE                                                       
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INPUT-SKU-RECORD             PIC X(32).                              
                                                                                
       FD  INPUT-FRD-FILE                                                       
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INPUT-FRD-RECORD             PIC X(80).                              
                                                                                
       FD  INPUT-SKU-LRD                                                        
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INPUT-SKU-LRD-REC            PIC X(32).                              
                                                                                
       FD  INPUT-SKU-FRD                                                        
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INPUT-SKU-FRD-REC            PIC X(80).                              
                                                                                
       FD  OUTPUT-AUDIT-FILE                                                    
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUTPUT-AUDIT-REC             PIC X(80).                              
                                                                                
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      * PROGRAM VARIABLES.                                             *        
      ******************************************************************        
       01  PV-PROGRAM-VARIABLES.                                                
           05 PV-COMMIT-COUNT               PIC 9(04)  VALUE ZEROES.            
           05 PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.           
           05 PV-PARAGRAPH-NAME             PIC X(30)  VALUE SPACES.            
           05 PV-DB2-OPERATION-ATTEMPTED    PIC X(30)  VALUE SPACES.            
           05 PV-SQLCODE-DISPLAY            PIC +(8)9  VALUE ZEROES.            
           05 PV-SKU-NBR                    PIC X(08)  VALUE ZEROES.            
           05 PV-SKU-NBR-NMR                PIC 9(08)  VALUE ZEROES.            
           05 PV-LOC-NBR                    PIC 9(04)  VALUE ZEROES.            
           05 PV-LAST-RCVD-DATE             PIC X(06)  VALUE ZEROES.            
           05 PV-LAST-RCVD-DATE1            PIC 9(06)  VALUE ZEROES.            
           05 PV-SKU-NBR1                   PIC X(08)  VALUE ZEROES.            
           05 PV-SKU-NBR-NMR1               PIC 9(08)  VALUE ZEROES.            
           05 PV-LOC-NBR1                   PIC 9(04)  VALUE ZEROES.            
           05 PV-FIRST-RCVD-DATE            PIC X(06)  VALUE ZEROES.            
           05 PV-FIRST-RCVD-DATE1           PIC 9(06)  VALUE ZEROES.            
           05 PV-NULL-INDICATOR             PIC S9(04) COMP SYNC                
                                                       VALUE ZERO.              
           05 PV-NULL-INDICAT1              PIC S9(04) COMP SYNC                
                                                       VALUE ZERO.              
RONNA      05 PV-COMPARE-DTE-B4Y2KCY.                                           
RONNA         10 PV-COMPARE-DTE-B4Y2KC      PIC X(02)  VALUE '19'.              
RONNA         10 PV-COMPARE-DTE-B4Y2K       PIC X(07)  VALUE ZEROES.            
                                                                                
RONNA      05 PV-COMPARE-DTE-AFY2KCY.                                           
RONNA         10 PV-COMPARE-DTE-AFY2KC      PIC X(02)  VALUE '20'.              
RONNA         10 PV-COMPARE-DTE-AFY2K       PIC X(07)  VALUE ZEROES.            
                                                                                
       01  PV-COMPARE-DTE-ZEROES            PIC X(07)  VALUE ZEROES.            
                                                                                
       01  PV-INPUT-FILE-LAYOUT             PIC X(32)  VALUE ZEROES.            
       01  PV-INPUT-FRD-LAYOUT              PIC X(80)  VALUE ZEROES.            
                                                                                
       01  PV-INPUT-SKU1-LAYOUT.                                                
           05 PV-LRD-SKU                    PIC 9(08)  VALUE ZEROES.            
           05 FILLER                        PIC X(24)  VALUE SPACES.            
                                                                                
       01  PV-INPUT-SKU2-LAYOUT.                                                
           05 PV-FRD-SKU                    PIC 9(08)  VALUE ZEROES.            
           05 FILLER                        PIC X(72)  VALUE SPACES.            
                                                                                
       01  PV-OUTPUT-FILE-LAYOUT.                                               
           05 PV-OUT-SKU                    PIC X(08)  VALUE ZEROES.            
           05 FILLER                        PIC X(01)  VALUE ','.               
           05 PV-OUT-LOC                    PIC 9(04)  VALUE ZEROES.            
           05 FILLER                        PIC X(01)  VALUE ','.               
           05 PV-OUT-DATE                   PIC X(06)  VALUE SPACES.            
           05 FILLER                        PIC X(60)  VALUE SPACES.            
      ******************************************************************        
      * PROGRAM SWITCHES.                                              *        
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-NOT-END-OF-INPUT-SKU-FILE      PIC X(01)  VALUE 'N'.          
               88  PS-END-OF-INPUT-FILE                 VALUE 'Y'.              
               88  PS-NOT-END-OF-INPUT-SKU              VALUE 'N'.              
                                                                                
           05  PS-NOT-END-OF-INPUT-FRD-FILE      PIC X(01)  VALUE 'N'.          
               88  PS-END-OF-INPUT-FRD                  VALUE 'Y'.              
               88  PS-NOT-END-OF-INPUT-FRD              VALUE 'N'.              
                                                                                
           05  PS-NOT-END-OF-SKU-LRD-FILE        PIC X(01)  VALUE 'N'.          
               88  PS-END-OF-SKU-LRD                   VALUE 'Y'.               
               88  PS-NOT-END-OF-SKU-LRD                VALUE 'N'.              
                                                                                
           05  PS-NOT-END-OF-SKU-FRD-FILE        PIC X(01)  VALUE 'N'.          
               88  PS-END-OF-SKU-FRD                   VALUE 'Y'.               
               88  PS-NOT-END-OF-SKU-FRD                VALUE 'N'.              
                                                                                
           05  PS-SKU-FOUND-TSKXREF              PIC X(01)  VALUE 'N'.          
               88  PS-SKU-NOT-FOUND-XREF                VALUE 'Y'.              
               88  PS-SKU-FOUND-XREF                    VALUE 'N'.              
                                                                                
           05  PS-ITMLOC-FOUND-TSKST             PIC X(01)  VALUE 'N'.          
               88  PS-ITMLOC-NOT-FOUND                  VALUE 'Y'.              
               88  PS-ITMLOC-FOUND                      VALUE 'N'.              
                                                                                
      ******************************************************************        
      * PROGRAM ACCUMULATORS.                                          *        
      ******************************************************************        
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-INPUT-ROWS-READ           PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PA-INPUT1-ROWS-READ          PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PA-INPUT2-ROWS-READ          PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PA-INPUT3-ROWS-READ          PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PV-TSKXREF-SELECT-CNT        PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PV-TSKXREF-SKIP-CNT          PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PV-TSKST-SKIP-CNT            PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PV-TSKST-LRD-LOC0-CNT        PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PV-TSKST-FRD-LOC0-CNT        PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PA-TSKST-ROW-UPDATED         PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PA-COMMIT-TAKEN              PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
           05  PA-NOT-UPDATD-CNT            PIC S9(09) COMP-3                   
                                                       VALUE ZEROES.            
       01  ABEND-CODE                       PIC S9(04) COMP SYNC                
                                                       VALUE 0.                 
           88  ABEND-4001-CC-MISSING-ERR               VALUE +4001.             
           88  ABEND-4002-CC-INVALID-ERR               VALUE +4002.             
                                                                                
      *****************************************************************         
      * PROGRAM CONSTANTS                                                       
      *****************************************************************         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-CURRENT-PROGRAM-NAME       PIC X(08)                          
                                                   VALUE 'FSKUP999'.            
           05  PC-MAX-RETRIES                PIC S9(04) VALUE +5 COMP.          
           05  PC-COMMIT-MAX                 PIC 9(09) VALUE   999.             
                                                                                
      *****************************************************************         
      * TSKST TABLE DCLGEN.                                                     
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TSKST                                                    
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TSKXREF TABLE DCLGEN.                                                   
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TSKXREF                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA.                        
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * COMMUNICATION WORK AREA.                                                
      *****************************************************************         
           COPY SQLCA2.                                                         
                                                                                
      *****************************************************************         
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004.                
      *****************************************************************         
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
       LINKAGE SECTION.                                                         
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
      ******************************************************************        
      * 0000-MAINLINE-PARA.                                            *        
      ******************************************************************        
       0000-MAINLINE-PARA.                                                      
                                                                                
           PERFORM 1000-INITIALIZE.                                             
                                                                                
           PERFORM 4000-READ-SKU-LRD.                                           
                                                                                
           PERFORM 4300-PROCESS-SKU-LRD-CORP                                    
             UNTIL PS-END-OF-SKU-LRD.                                           
                                                                                
           MOVE '****END OF FRD RECORD****' TO OUTPUT-AUDIT-REC                 
           WRITE OUTPUT-AUDIT-REC.                                              
                                                                                
RONNA *    PERFORM 5000-READ-SKU-FRD.                                           
RONNA *                                                                         
RONNA *    PERFORM 5300-PROCESS-SKU-FRD-CORP                                    
RONNA *      UNTIL PS-END-OF-SKU-FRD.                                           
                                                                                
           PERFORM 8000-EOJ-ROUTINE.                                            
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      * 1000-INITIALIZE.                                               *        
      ******************************************************************        
       1000-INITIALIZE.                                                         
           INITIALIZE PV-INPUT-FILE-LAYOUT                                      
           INITIALIZE PV-INPUT-FRD-LAYOUT                                       
           INITIALIZE PV-INPUT-SKU1-LAYOUT                                      
           INITIALIZE PV-INPUT-SKU2-LAYOUT                                      
           INITIALIZE PV-OUTPUT-FILE-LAYOUT                                     
           OPEN INPUT  INPUT-SKU-FILE                                           
                       INPUT-FRD-FILE                                           
                       INPUT-SKU-LRD                                            
                       INPUT-SKU-FRD                                            
                OUTPUT OUTPUT-AUDIT-FILE.                                       
                                                                                
      ******************************************************************        
      * 4000-READ-SKU-LRD.                                                      
      ******************************************************************        
       4000-READ-SKU-LRD.                                                       
                                                                                
           INITIALIZE PV-INPUT-SKU1-LAYOUT                                      
                                                                                
           READ INPUT-SKU-LRD                                                   
           INTO PV-INPUT-SKU1-LAYOUT                                            
             AT END                                                             
               SET PS-END-OF-SKU-LRD TO TRUE                                    
               DISPLAY '*******************************'                        
               DISPLAY 'END OF INPUT '                                          
               DISPLAY '*******************************'                        
             NOT AT END                                                         
               DISPLAY '*******************************'                        
               DISPLAY 'INPUT RECORD READ ' PV-INPUT-SKU1-LAYOUT                
               ADD +1                    TO  PA-INPUT2-ROWS-READ                
           END-READ.                                                            
                                                                                
RONNA *                                                                         
RONNA ******************************************************************        
RONNA * 5000-READ-SKU-FRD.                                                      
RONNA ******************************************************************        
RONNA *5000-READ-SKU-FRD.                                                       
RONNA *                                                                         
RONNA *    INITIALIZE PV-INPUT-SKU2-LAYOUT                                      
RONNA *                                                                         
RONNA *    READ INPUT-SKU-FRD                                                   
RONNA *    INTO PV-INPUT-SKU2-LAYOUT                                            
RONNA *      AT END                                                             
RONNA *        SET PS-END-OF-SKU-FRD TO TRUE                                    
RONNA *      NOT AT END                                                         
RONNA *        ADD +1                    TO  PA-INPUT3-ROWS-READ                
RONNA *    END-READ.                                                            
RONNA *                                                                         
RONNA ******************************************************************        
RONNA * 3000-PROCESS-RECORDS                                                    
RONNA ******************************************************************        
RONNA *3000-PROCESS-RECORDS.                                                    
RONNA *                                                                         
RONNA *      UNSTRING PV-INPUT-FILE-LAYOUT  DELIMITED BY ','                    
RONNA *          INTO PV-SKU-NBR                                                
RONNA *               PV-LOC-NBR                                                
RONNA *               PV-LAST-RCVD-DATE                                         
RONNA *                                                                         
RONNA *    COMPUTE PV-SKU-NBR-NMR =                                             
RONNA *                 FUNCTION NUMVAL(PV-SKU-NBR)                             
RONNA *    COMPUTE PV-LAST-RCVD-DATE1 =                                         
RONNA *                 FUNCTION NUMVAL(PV-LAST-RCVD-DATE)                      
RONNA *                                                                         
RONNA *    INITIALIZE SKXREF-SKU                                                
RONNA *               TSKST-LOC-NBR                                             
RONNA *               TSKST-LAST-RCVD-DATE                                      
RONNA *               TSKST-ITEM-NMBR                                           
RONNA *           MOVE PV-SKU-NBR-NMR      TO SKXREF-SKU                        
RONNA *           MOVE PV-LOC-NBR          TO TSKST-LOC-NBR                     
RONNA *                                                                         
RONNA *          PERFORM 3100-GET-ITM-NBR                                       
RONNA *                                                                         
RONNA *    IF PS-SKU-FOUND-XREF                                                 
RONNA *                                                                         
RONNA *          MOVE SKXREF-ITM-NBR   TO TSKST-ITEM-NMBR                       
RONNA *           PERFORM 3400-SELECT-TSKST                                     
RONNA *                                                                         
RONNA *      IF PS-ITMLOC-FOUND                                                 
RONNA *                                                                         
RONNA *           IF TSKST-LAST-RCVD-DATE < 190311                              
RONNA *           AND PV-LAST-RCVD-DATE1 < 190311                               
RONNA *                                                                         
RONNA *             MOVE PV-LAST-RCVD-DATE1  TO TSKST-LAST-RCVD-DATE            
RONNA *                                                                         
RONNA *              PERFORM 3200-UPDATE-TSKST                                  
RONNA *                                                                         
RONNA *              IF TSKST-LAST-RCVD-DATE = 0                                
RONNA *               MOVE 0 TO TSKST-FIRST-RCVD-DATE                           
RONNA *               PERFORM 3700-UPDATE-TSKST-FRD                             
RONNA *              END-IF                                                     
RONNA *                                                                         
RONNA *              MOVE PV-SKU-NBR-NMR TO PV-OUT-SKU                          
RONNA *              MOVE PV-LOC-NBR TO PV-OUT-LOC                              
RONNA *              MOVE PV-LAST-RCVD-DATE1 TO PV-OUT-DATE                     
RONNA *                                                                         
RONNA *              WRITE OUTPUT-AUDIT-REC FROM PV-OUTPUT-FILE-LAYOUT          
RONNA *                                                                         
RONNA *           ELSE                                                          
RONNA *             DISPLAY '*********NOT UPDATED************'                  
RONNA *             DISPLAY 'LAST RECVD DATE IS >= 190311'                      
RONNA *             DISPLAY 'SKU NUMBER: ' PV-SKU-NBR-NMR                       
RONNA *             DISPLAY 'LOC: ' PV-LOC-NBR                                  
RONNA *             DISPLAY 'TSKST LRD: ' TSKST-LAST-RCVD-DATE                  
RONNA *             DISPLAY 'FILE LRD: ' PV-LAST-RCVD-DATE1                     
RONNA *             DISPLAY '********************************'                  
RONNA *             ADD  +1              TO PA-NOT-UPDATD-CNT                   
RONNA *           END-IF                                                        
RONNA *      END-IF                                                             
RONNA *    END-IF                                                               
RONNA *                                                                         
RONNA *       PERFORM 2000-READ-INPUT-FILE.                                     
RONNA *                                                                         
RONNA ******************************************************************        
RONNA * 3600-PROCESS-FRD-RECORDS                                                
RONNA ******************************************************************        
RONNA *3600-PROCESS-FRD-RECORDS.                                                
RONNA *                                                                         
RONNA *      UNSTRING PV-INPUT-FRD-LAYOUT  DELIMITED BY ','                     
RONNA *          INTO PV-SKU-NBR1                                               
RONNA *               PV-LOC-NBR1                                               
RONNA *               PV-FIRST-RCVD-DATE                                        
RONNA *                                                                         
RONNA *     COMPUTE PV-SKU-NBR-NMR1 =                                           
RONNA *                  FUNCTION NUMVAL(PV-SKU-NBR1)                           
RONNA *     COMPUTE PV-FIRST-RCVD-DATE1 =                                       
RONNA *                  FUNCTION NUMVAL(PV-FIRST-RCVD-DATE)                    
RONNA *                                                                         
RONNA *    INITIALIZE SKXREF-SKU                                                
RONNA *               TSKST-LOC-NBR                                             
RONNA *               TSKST-FIRST-RCVD-DATE                                     
RONNA *               TSKST-ITEM-NMBR                                           
RONNA *           MOVE PV-SKU-NBR-NMR1     TO SKXREF-SKU                        
RONNA *           MOVE PV-LOC-NBR1         TO TSKST-LOC-NBR                     
RONNA *           MOVE PV-FIRST-RCVD-DATE1 TO TSKST-FIRST-RCVD-DATE             
RONNA *                                                                         
RONNA *    PERFORM 3100-GET-ITM-NBR                                             
RONNA *                                                                         
RONNA *     IF PS-SKU-FOUND-XREF                                                
RONNA *                                                                         
RONNA *        MOVE SKXREF-ITM-NBR   TO TSKST-ITEM-NMBR                         
RONNA *         PERFORM 3400-SELECT-TSKST                                       
RONNA *                                                                         
RONNA *           IF PS-ITMLOC-FOUND                                            
RONNA *                                                                         
RONNA *              PERFORM 3700-UPDATE-TSKST-FRD                              
RONNA *                                                                         
RONNA *              MOVE PV-SKU-NBR-NMR1 TO PV-OUT-SKU                         
RONNA *              MOVE PV-LOC-NBR1 TO PV-OUT-LOC                             
RONNA *              MOVE PV-FIRST-RCVD-DATE1 TO PV-OUT-DATE                    
RONNA *                                                                         
RONNA *              WRITE OUTPUT-AUDIT-REC FROM PV-OUTPUT-FILE-LAYOUT          
RONNA *                                                                         
RONNA *           END-IF                                                        
RONNA *                                                                         
RONNA *     END-IF                                                              
RONNA *                                                                         
RONNA *     PERFORM 3300-READ-FRD-FILE.                                         
RONNA *                                                                         
RONNA *                                                                         
      ******************************************************************        
      * 4300-PROCESS-SKU-LRD-CORP                                               
      ******************************************************************        
       4300-PROCESS-SKU-LRD-CORP.                                               
                                                                                
RONNA *    DISPLAY '**4300-PROCESS-SKU-LRD-CORP TOP '                           
           INITIALIZE SKXREF-SKU                                                
                      TSKST-LOC-NBR                                             
                      TSKST-ITEM-NMBR                                           
                  MOVE PV-LRD-SKU          TO SKXREF-SKU                        
                  MOVE 0                   TO TSKST-LOC-NBR.                    
                                                                                
           PERFORM 3100-GET-ITM-NBR.                                            
                                                                                
           IF PS-SKU-FOUND-XREF                                                 
                                                                                
              MOVE SKXREF-ITM-NBR   TO TSKST-ITEM-NMBR                          
                                                                                
RONNA *       DISPLAY '******** START OF MAX LAST RECEIVE DATE '                
RONNA *       DISPLAY '******** ITEM NMBR : ' TSKST-ITEM-NMBR                   
     *********** FIGURE OUT THE LAST RECEVE DATE FOR STORE 0 ROW                
     *********** READ MAX BEFORE Y2K                                            
              PERFORM 7000-READ-TSKST-MAX-RCVD-DTE                              
RONNA         MOVE TSKST-LAST-RCVD-DATE TO PV-COMPARE-DTE-B4Y2K                 
RONNA*********** READ MAX AFTER  Y2K                                            
RONNA         PERFORM 7001-READ-TSKST-MAX-RCVD-DTE                              
RONNA         MOVE TSKST-LAST-RCVD-DATE TO PV-COMPARE-DTE-AFY2K                 
RONNA                                                                           
RONNA *       DISPLAY '******* MAX LRD BEFORE Y2K '                             
RONNA *       DISPLAY 'PV-COMPARE-DTE-B4Y2KCY : ' PV-COMPARE-DTE-B4Y2KCY        
RONNA *       DISPLAY '******* MAX LRD AFTER Y2K  '                             
RONNA *       DISPLAY 'PV-COMPARE-DTE-AFY2KCY : ' PV-COMPARE-DTE-AFY2KCY        
RONNA*                                                                          
RONNA*                                                                          
RONNA**COMPARE THE BEFORE Y2K DATE WITH THE                                     
RONNA**            AFTER Y2K DATE                                               
RONNA**            TO FIGURE OUT WHICH DATE IS REALLY THE MAX                   
RONNA**        WHEN THE BEFORE DATE IS 0 THEN LRD AFTER Y2K                     
RONNA         IF PV-COMPARE-DTE-B4Y2K = PV-COMPARE-DTE-ZEROES                   
RONNA *          DISPLAY 'NOTHING BEFORE Y2K'                                   
RONNA            MOVE PV-COMPARE-DTE-AFY2K TO TSKST-LAST-RCVD-DATE              
RONNA         ELSE                                                              
RONNA**          WHEN THE AFTER DATE IS 0 THEN FRD BEFORE Y2K                   
RONNA            IF PV-COMPARE-DTE-AFY2K = PV-COMPARE-DTE-ZEROES                
RONNA *            DISPLAY 'NOTHING AFTER Y2K'                                  
RONNA              MOVE PV-COMPARE-DTE-B4Y2K TO TSKST-LAST-RCVD-DATE            
RONNA            ELSE                                                           
RONNA *            DISPLAY 'BOTH BEFORE AND AFTER Y2K'                          
RONNA              MOVE PV-COMPARE-DTE-AFY2K TO TSKST-LAST-RCVD-DATE            
RONNA            END-IF                                                         
RONNA         END-IF                                                            
RONNA *    DISPLAY '******* REAL MAX LRD    '                                   
RONNA *    DISPLAY 'NEW MAX TSKST-LAST-RCVD-DATE: ' TSKST-LAST-RCVD-DATE        
                                                                                
     *********** FIGURE OUT THE FIRST RECEVE DATE FOR STORE 0 ROW               
     *********** READ MIN BEFORE Y2K                                            
              PERFORM 7500-READ-TSKST-MIN-FRD-DTE                               
RONNA         MOVE TSKST-FIRST-RCVD-DATE TO PV-COMPARE-DTE-B4Y2K                
RONNA*********** READ MIN AFTER  Y2K                                            
RONNA         PERFORM 7501-READ-TSKST-MIN-FRD-DTE                               
RONNA         MOVE TSKST-FIRST-RCVD-DATE TO PV-COMPARE-DTE-AFY2K                
RONNA                                                                           
RONNA *     DISPLAY '******* MIN FRD BEFORE Y2K '                               
RONNA *     DISPLAY 'PV-COMPARE-DTE-B4Y2KCY : ' PV-COMPARE-DTE-B4Y2KCY          
RONNA *     DISPLAY 'PV-COMPARE-DTE-B4Y2K   : ' PV-COMPARE-DTE-B4Y2K            
RONNA *     DISPLAY '******* MIN FRD AFTER Y2K  '                               
RONNA *     DISPLAY 'PV-COMPARE-DTE-AFY2KCY : ' PV-COMPARE-DTE-AFY2KCY          
RONNA *     DISPLAY 'PV-COMPARE-DTE-AFY2K   : ' PV-COMPARE-DTE-AFY2K            
RONNA*                                                                          
RONNA**                                                                         
RONNA**                                                                         
RONNA**COMPARE THE BEFORE Y2K DATE WITH THE                                     
RONNA**            AFTER Y2K DATE                                               
RONNA**            TO FIGURE OUT WHICH DATE IS REALLY THE MIN                   
RONNA**        WHEN THE BEFORE DATE IS 0 THEN FRD AFTER Y2K                     
RONNA          IF PV-COMPARE-DTE-B4Y2K = PV-COMPARE-DTE-ZEROES                  
RONNA *           DISPLAY 'NOTHING BEFORE Y2K'                                  
RONNA             MOVE PV-COMPARE-DTE-AFY2K TO TSKST-FIRST-RCVD-DATE            
RONNA          ELSE                                                             
RONNA**           WHEN THE AFTER DATE IS 0 THEN FRD BEFORE Y2K                  
RONNA             IF PV-COMPARE-DTE-AFY2K = PV-COMPARE-DTE-ZEROES               
RONNA *             DISPLAY 'NOTHING AFTER Y2K'                                 
RONNA               MOVE PV-COMPARE-DTE-B4Y2K TO TSKST-FIRST-RCVD-DATE          
RONNA             ELSE                                                          
RONNA**              WHEN DATES FALL BOTH BEFORE AND AFTER COMPARE              
RONNA *              MOVE THE BEFORE DATE                                       
RONNA *              DISPLAY 'BOTH BEFORE AND AFTER Y2K'                        
RONNA                MOVE PV-COMPARE-DTE-B4Y2K                                  
                          TO TSKST-FIRST-RCVD-DATE                              
RONNA             END-IF                                                        
RONNA          END-IF                                                           
RONNA                                                                           
RONNA *     DISPLAY '******* REAL MIN FRD    '                                  
RONNA *     DISPLAY 'NEW MIN TSKST-FIRST-RCVD-DATE: '                           
RONNA *              TSKST-FIRST-RCVD-DATE                                      
                                                                                
RONNA *     DISPLAY 'PS-ITMLOC-FOUND IS : ' PS-ITMLOC-FOUND-TSKST               
      *        IF PS-ITMLOC-FOUND                                               
      * ALWAYS UPDATE BECAUSE ASSUMPTION THAT IF THERE IS BOSS                  
      * ACTIVITY THERE HAS TO BE A HISTORY OF A RECEIPT                         
                  PERFORM 3200-UPDATE-TSKST                                     
      *        END-IF                                                           
                                                                                
            END-IF.                                                             
                                                                                
            PERFORM 4000-READ-SKU-LRD.                                          
RONNA *                                                                         
RONNA ******************************************************************        
RONNA * 5300-PROCESS-SKU-FRD-CORP                                               
RONNA ******************************************************************        
RONNA *5300-PROCESS-SKU-FRD-CORP.                                               
RONNA *                                                                         
RONNA *    INITIALIZE SKXREF-SKU                                                
RONNA *               TSKST-LOC-NBR                                             
RONNA *               TSKST-ITEM-NMBR                                           
RONNA *           MOVE PV-FRD-SKU          TO SKXREF-SKU                        
RONNA *           MOVE 0                   TO TSKST-LOC-NBR                     
RONNA *                                                                         
RONNA *    PERFORM 3100-GET-ITM-NBR                                             
RONNA *                                                                         
RONNA *     IF PS-SKU-FOUND-XREF                                                
RONNA *                                                                         
RONNA *           MOVE SKXREF-ITM-NBR   TO TSKST-ITEM-NMBR                      
RONNA *                                                                         
RONNA *           PERFORM 7500-READ-TSKST-MIN-FRD-DTE                           
RONNA *                                                                         
RONNA *         IF PS-ITMLOC-FOUND                                              
RONNA *            PERFORM 3700-UPDATE-TSKST-FRD                                
RONNA *         END-IF                                                          
RONNA *                                                                         
RONNA *     END-IF                                                              
RONNA *                                                                         
RONNA *     PERFORM 5000-READ-SKU-FRD.                                          
                                                                                
      ******************************************************************        
      * 3100-GET-ITM-NBR.                                                       
      ******************************************************************        
       3100-GET-ITM-NBR.                                                        
                                                                                
RONNA *    DISPLAY '********3100-GET-ITM-NBR FOR SKU : ' SKXREF-SKU             
                                                                                
           INITIALIZE SKXREF-ITM-NBR.                                           
                                                                                
               EXEC SQL                                                         
                 SELECT ITM_NBR                                                 
                   INTO :SKXREF-ITM-NBR                                         
                   FROM TSKXREF                                                 
                  WHERE SKU = :SKXREF-SKU                                       
                  WITH UR                                                       
               END-EXEC                                                         
                                                                                
               EVALUATE SQLCODE                                                 
                   WHEN +0                                                      
                       ADD  +1              TO PV-TSKXREF-SELECT-CNT            
                       SET PS-SKU-FOUND-XREF    TO TRUE                         
                   WHEN +100                                                    
                       ADD  +1              TO PV-TSKXREF-SKIP-CNT              
                       DISPLAY '*********SKU SKIPPED***************'            
                       DISPLAY 'SKU NOT FOUND IN TSKXREF ' PV-SKU-NBR           
                       DISPLAY '***********************************'            
                       SET PS-SKU-NOT-FOUND-XREF TO TRUE                        
                   WHEN OTHER                                                   
                       MOVE '3100-GET-ITM-NBR'                                  
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'GET ITEM FROM TSKXREF'                             
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'SKU NUMBER = ' SKXREF-SKU                       
                       DISPLAY 'LOC: ' TSKST-LOC-NBR                            
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE.                                                    
                                                                                
      ******************************************************************        
      * 3400-SELECT-TSKST.                                                      
      ******************************************************************        
       3400-SELECT-TSKST.                                                       
                                                                                
           INITIALIZE TSKST-LAST-RCVD-DATE.                                     
                                                                                
               EXEC SQL                                                         
                 SELECT LAST_RCVD_DATE                                          
                   INTO :TSKST-LAST-RCVD-DATE                                   
                   FROM TSKST                                                   
                  WHERE ITEM_NMBR = :TSKST-ITEM-NMBR                            
                  AND LOC_NBR = :TSKST-LOC-NBR                                  
                 WITH UR                                                        
               END-EXEC                                                         
                                                                                
               EVALUATE SQLCODE                                                 
                   WHEN +0                                                      
                       ADD  +1              TO PV-TSKXREF-SELECT-CNT            
                       SET PS-ITMLOC-FOUND  TO TRUE                             
                   WHEN +100                                                    
                       ADD  +1              TO PV-TSKST-SKIP-CNT                
                       DISPLAY '**************************'                     
                       DISPLAY 'ITM/LOC NOT FOUND IN TSKST'                     
                       DISPLAY 'ITEM: ' TSKST-ITEM-NMBR                         
                       DISPLAY 'SKU: '  SKXREF-SKU                              
                       DISPLAY 'LOC: ' TSKST-LOC-NBR                            
                       DISPLAY '**************************'                     
                       SET PS-ITMLOC-NOT-FOUND  TO TRUE                         
                   WHEN OTHER                                                   
                       MOVE '3400-SELECT-TSKST'                                 
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'GET LRD FROM TSKST'                                
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'ITEM: ' TSKST-ITEM-NMBR                         
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY 'LOC: ' TSKST-LOC-NBR                            
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE.                                                    
                                                                                
      *****************************************************************         
      * 3200-UPDATE-TSKST.                                                      
      *****************************************************************         
       3200-UPDATE-TSKST.                                                       
                                                                                
               EXEC SQL                                                         
                   UPDATE TSKST                                                 
                      SET LAST_RCVD_DATE  = :TSKST-LAST-RCVD-DATE               
                         ,FIRST_RCVD_DATE = :TSKST-FIRST-RCVD-DATE              
                         ,LAST_UPD_TMST = CURRENT TIMESTAMP                     
                   WHERE ITEM_NMBR       = :TSKST-ITEM-NMBR                     
                   AND   LOC_NBR       = :TSKST-LOC-NBR                         
               END-EXEC.                                                        
                                                                                
             EVALUATE TRUE                                                      
               WHEN SQLCODE = ZERO                                              
                 ADD +1  TO PA-TSKST-ROW-UPDATED                                
                 ADD +1         TO PV-COMMIT-COUNT                              
                  IF TSKST-LOC-NBR = 0                                          
                     ADD  +1              TO PV-TSKST-LRD-LOC0-CNT              
                  END-IF                                                        
                 IF PV-COMMIT-COUNT > PC-COMMIT-MAX                             
                    MOVE 0 TO PV-COMMIT-COUNT                                   
                    PERFORM 3500-UPDATE-COMMIT                                  
                 END-IF                                                         
               WHEN OTHER                                                       
                       MOVE '3200-UPDATE-TSKST'                                 
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'UPDATE TABLE TSKST'                                
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'ITEM NUMBER = ' TSKST-ITEM-NMBR                 
                       DISPLAY 'SKU: ' PV-LRD-SKU                               
                       DISPLAY 'LOC: ' TSKST-LOC-NBR                            
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
             END-EVALUATE.                                                      
RONNA *                                                                         
RONNA *****************************************************************         
RONNA * 3700-UPDATE-TSKST-FRD.                                                  
RONNA *****************************************************************         
RONNA *3700-UPDATE-TSKST-FRD.                                                   
RONNA *                                                                         
RONNA *        EXEC SQL                                                         
RONNA *            UPDATE TSKST                                                 
RONNA *               SET FIRST_RCVD_DATE = :TSKST-FIRST-RCVD-DATE              
RONNA *                  ,LAST_UPD_TMST = CURRENT TIMESTAMP                     
RONNA *            WHERE ITEM_NMBR       = :TSKST-ITEM-NMBR                     
RONNA *            AND   LOC_NBR        = :TSKST-LOC-NBR                        
RONNA *        END-EXEC.                                                        
RONNA *                                                                         
RONNA *      EVALUATE TRUE                                                      
RONNA *        WHEN SQLCODE = ZERO                                              
RONNA *          ADD +1  TO PA-TSKST-ROW-UPDATED                                
RONNA *          ADD +1         TO PV-COMMIT-COUNT                              
RONNA *           IF TSKST-LOC-NBR = 0                                          
RONNA *              ADD  +1              TO PV-TSKST-FRD-LOC0-CNT              
RONNA *           END-IF                                                        
RONNA *          IF PV-COMMIT-COUNT > PC-COMMIT-MAX                             
RONNA *             MOVE 0 TO PV-COMMIT-COUNT                                   
RONNA *             PERFORM 3500-UPDATE-COMMIT                                  
RONNA *          END-IF                                                         
RONNA *        WHEN OTHER                                                       
RONNA *                MOVE '3700-UPDATE-TSKST-FRD'                             
RONNA *                                 TO PV-PARAGRAPH-NAME                    
RONNA *                MOVE 'UPDATE TABLE TSKST FRD'                            
RONNA *                                 TO PV-DB2-OPERATION-ATTEMPTED           
RONNA *                DISPLAY '*******************************'                
RONNA *                DISPLAY 'ITEM NUMBER = ' TSKST-ITEM-NMBR                 
RONNA *                DISPLAY 'SKU: ' SKXREF-SKU                               
RONNA *                DISPLAY 'LOC: ' TSKST-LOC-NBR                            
RONNA *                DISPLAY '*******************************'                
RONNA *                PERFORM 9100-SQL-ABEND                                   
RONNA *      END-EVALUATE.                                                      
                                                                                
      ******************************************************************        
      * 7000-READ-TSKST-MAX-RCVD-DTE.      BEFORE Y2K                           
      ******************************************************************        
       7000-READ-TSKST-MAX-RCVD-DTE.                                            
                                                                                
           INITIALIZE TSKST-LAST-RCVD-DATE                                      
           MOVE ZEROES TO PV-NULL-INDICATOR                                     
                                                                                
               EXEC SQL                                                         
                 SELECT MAX(LAST_RCVD_DATE)                                     
                   INTO :TSKST-LAST-RCVD-DATE :PV-NULL-INDICATOR                
                   FROM TSKST                                                   
                    WHERE ITEM_NMBR       = :TSKST-ITEM-NMBR                    
                    AND LOC_NBR       <> 0                                      
                    AND LAST_RCVD_DATE > 200000                                 
                  WITH UR                                                       
               END-EXEC                                                         
                                                                                
               EVALUATE SQLCODE                                                 
                   WHEN +0                                                      
                                                                                
                       SET PS-ITMLOC-FOUND TO TRUE                              
RONNA **               DISPLAY 'LAST RECEIPT BEFORE Y2K: '                      
RONNA **                       TSKST-LAST-RCVD-DATE                             
                                                                                
                   IF PV-NULL-INDICATOR < 0                                     
                       ADD  +1              TO PV-TSKST-SKIP-CNT                
                       DISPLAY '****7000-*****************'                     
                       DISPLAY 'MAX NOT FOUND IN TSKST'                         
                       DISPLAY 'ITEM: ' TSKST-ITEM-NMBR                         
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY '**************************'                     
                       SET PS-ITMLOC-NOT-FOUND  TO TRUE                         
                   END-IF                                                       
                   CONTINUE                                                     
                                                                                
                   WHEN OTHER                                                   
                       MOVE '7000-READ-TSKST-MAX-RCVD-DTE'                      
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'GET MAX OF LAST RCVD DTE FOR LOC0'                 
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'ITM NUMBER = ' TSKST-ITEM-NMBR                  
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE.                                                    
                                                                                
      ******************************************************************        
      * 7001-READ-TSKST-MAX-RCVD-DTE.   AFTER Y2K                               
      ******************************************************************        
       7001-READ-TSKST-MAX-RCVD-DTE.                                            
                                                                                
           INITIALIZE TSKST-LAST-RCVD-DATE                                      
           MOVE ZEROES TO PV-NULL-INDICATOR                                     
                                                                                
               EXEC SQL                                                         
                 SELECT MAX(LAST_RCVD_DATE)                                     
                   INTO :TSKST-LAST-RCVD-DATE :PV-NULL-INDICATOR                
                   FROM TSKST                                                   
                    WHERE ITEM_NMBR       = :TSKST-ITEM-NMBR                    
                    AND LOC_NBR       <> 0                                      
RONNA               AND LAST_RCVD_DATE BETWEEN 1 AND 200000                     
                  WITH UR                                                       
               END-EXEC                                                         
                                                                                
               EVALUATE SQLCODE                                                 
                   WHEN +0                                                      
                                                                                
                       SET PS-ITMLOC-FOUND TO TRUE                              
RONNA *                DISPLAY 'LAST RECEIPT AFTER  Y2K: '                      
RONNA *                        TSKST-LAST-RCVD-DATE                             
                                                                                
                   IF PV-NULL-INDICATOR < 0                                     
                       ADD  +1              TO PV-TSKST-SKIP-CNT                
                       DISPLAY '****7001-*****************'                     
                       DISPLAY 'MAX NOT FOUND IN TSKST'                         
                       DISPLAY 'ITEM: ' TSKST-ITEM-NMBR                         
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY '**************************'                     
                       SET PS-ITMLOC-NOT-FOUND  TO TRUE                         
                   END-IF                                                       
                   CONTINUE                                                     
                                                                                
                   WHEN OTHER                                                   
                       MOVE '7000-READ-TSKST-MAX-RCVD-DTE'                      
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'GET MAX OF LAST RCVD DTE FOR LOC0'                 
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'ITM NUMBER = ' TSKST-ITEM-NMBR                  
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE.                                                    
                                                                                
      ******************************************************************        
      * 7500-READ-TSKST-MIN-FRD-DTE.      BEFORE Y2K                            
      ******************************************************************        
       7500-READ-TSKST-MIN-FRD-DTE.                                             
                                                                                
           INITIALIZE TSKST-FIRST-RCVD-DATE                                     
           MOVE ZEROES TO PV-NULL-INDICAT1                                      
                                                                                
               EXEC SQL                                                         
                 SELECT MIN(FIRST_RCVD_DATE)                                    
                   INTO :TSKST-FIRST-RCVD-DATE :PV-NULL-INDICAT1                
                   FROM TSKST                                                   
                    WHERE ITEM_NMBR       = :TSKST-ITEM-NMBR                    
                    AND FIRST_RCVD_DATE <> 0                                    
                    AND LOC_NBR       <> 0                                      
RONNA               AND FIRST_RCVD_DATE > 200000                                
                  WITH UR                                                       
               END-EXEC                                                         
                                                                                
               EVALUATE SQLCODE                                                 
                   WHEN +0                                                      
                       SET PS-ITMLOC-FOUND TO TRUE                              
                                                                                
                       IF PV-NULL-INDICAT1 < 0                                  
                        ADD  +1              TO PV-TSKST-SKIP-CNT               
                        DISPLAY '****7500-*****************'                    
                        DISPLAY 'MIN NOT FOUND IN TSKST'                        
                        DISPLAY 'ITEM: ' TSKST-ITEM-NMBR                        
                        DISPLAY 'SKU: ' SKXREF-SKU                              
                        DISPLAY '**************************'                    
                        SET PS-ITMLOC-NOT-FOUND  TO TRUE                        
                       END-IF                                                   
                                                                                
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       MOVE '7500-READ-TSKST-MIN-FRD-DTE'                       
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'GET MIN OF FIRST RCVD DTE FOR LOC0'                
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'ITM NUMBER = ' TSKST-ITEM-NMBR                  
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE.                                                    
                                                                                
      ******************************************************************        
      * 7501-READ-TSKST-MIN-FRD-DTE.     AFTER Y2K                              
      ******************************************************************        
       7501-READ-TSKST-MIN-FRD-DTE.                                             
                                                                                
           INITIALIZE TSKST-FIRST-RCVD-DATE                                     
           MOVE ZEROES TO PV-NULL-INDICAT1                                      
                                                                                
               EXEC SQL                                                         
                 SELECT MIN(FIRST_RCVD_DATE)                                    
                   INTO :TSKST-FIRST-RCVD-DATE :PV-NULL-INDICAT1                
                   FROM TSKST                                                   
                    WHERE ITEM_NMBR       = :TSKST-ITEM-NMBR                    
                    AND FIRST_RCVD_DATE <> 0                                    
                    AND LOC_NBR       <> 0                                      
RONNA               AND FIRST_RCVD_DATE BETWEEN 1 AND 200000                    
                  WITH UR                                                       
               END-EXEC                                                         
                                                                                
               EVALUATE SQLCODE                                                 
                   WHEN +0                                                      
                       SET PS-ITMLOC-FOUND TO TRUE                              
                                                                                
                       IF PV-NULL-INDICAT1 < 0                                  
                        ADD  +1              TO PV-TSKST-SKIP-CNT               
                        DISPLAY '***7501-******************'                    
                        DISPLAY 'MIN NOT FOUND IN TSKST'                        
                        DISPLAY 'ITEM: ' TSKST-ITEM-NMBR                        
                        DISPLAY 'SKU: ' SKXREF-SKU                              
                        DISPLAY '**************************'                    
                        SET PS-ITMLOC-NOT-FOUND  TO TRUE                        
                       END-IF                                                   
                                                                                
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       MOVE '7500-READ-TSKST-MIN-FRD-DTE'                       
                                        TO PV-PARAGRAPH-NAME                    
                       MOVE 'GET MIN OF FIRST RCVD DTE FOR LOC0'                
                                        TO PV-DB2-OPERATION-ATTEMPTED           
                       DISPLAY '*******************************'                
                       DISPLAY 'ITM NUMBER = ' TSKST-ITEM-NMBR                  
                       DISPLAY 'SKU: ' SKXREF-SKU                               
                       DISPLAY '*******************************'                
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE.                                                    
                                                                                
      ******************************************************************        
      * 3500-UPDATE-COMMIT.                                                     
      ******************************************************************        
       3500-UPDATE-COMMIT.                                                      
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                         
                         OR  SQLCODE = 0)                                       
                                                                                
               EXEC SQL                                                         
                   COMMIT                                                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = 0                                             
                       ADD +1 TO PA-COMMIT-TAKEN                                
                       DISPLAY '***********COMMIT TAKEN*********'               
                       DISPLAY 'COMMIT COUNT: ' PA-COMMIT-TAKEN                 
                       DISPLAY 'LAST RECORD READ: ' PV-INPUT-SKU1-LAYOUT        
                       DISPLAY 'LOC: ' TSKST-LOC-NBR                            
                       DISPLAY '********************************'               
                       CONTINUE                                                 
                   WHEN SQLWARN NOT EQUAL SPACES                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                       MOVE '3500-UPDATE-COMMIT'                                
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'COMMIT FAILURE'                                    
                                    TO  PV-DB2-OPERATION-ATTEMPTED              
                       PERFORM 9100-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
            IF PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE '3500-UPDATE-COMMIT'                                        
                                    TO  PV-PARAGRAPH-NAME                       
               MOVE 'COMMIT RETRIES EXCEEDED'                                   
                                    TO  PV-DB2-OPERATION-ATTEMPTED              
               PERFORM 9100-SQL-ABEND                                           
            END-IF.                                                             
                                                                                
      *****************************************************************         
      * 8000-EOJ-ROUTINE.                                                       
      ******************************************************************        
       8000-EOJ-ROUTINE.                                                        
                                                                                
           PERFORM 3500-UPDATE-COMMIT.                                          
                                                                                
           CLOSE INPUT-SKU-FILE                                                 
                 INPUT-FRD-FILE                                                 
                 INPUT-SKU-LRD                                                  
                 INPUT-SKU-FRD                                                  
                 OUTPUT-AUDIT-FILE.                                             
                                                                                
           PERFORM 9005-DISPLAY-TOTALS.                                         
                                                                                
      ******************************************************************        
      * 9100-SQL-ABEND.                                                         
      ******************************************************************        
       9100-SQL-ABEND.                                                          
                                                                                
           MOVE SQLCODE TO PV-SQLCODE-DISPLAY.                                  
           DISPLAY ' '.                                                         
           DISPLAY '9100-SQL-ABEND'.                                            
           DISPLAY '** ABEND     **'.                                           
           DISPLAY '** PROGRAM   ** = FSKUP999'.                                
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
           DISPLAY '** SQL CODE  ** = ' PV-SQLCODE-DISPLAY.                     
                                                                                
           PERFORM 9005-DISPLAY-TOTALS.                                         
                                                                                
           COPY DPPD004.                                                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      ******************************************************************        
      * 9005-DISPLAY-TOTALS.                                                    
      ******************************************************************        
       9005-DISPLAY-TOTALS.                                                     
           DISPLAY '******** FSKUP999 TOTALS *********'.                        
           DISPLAY ' INPUT LRD RECS READ  : ' PA-INPUT-ROWS-READ.               
           DISPLAY ' INPUT FRD RECS READ  : ' PA-INPUT1-ROWS-READ.              
           DISPLAY ' INPUT LRD SKUS READ  : ' PA-INPUT2-ROWS-READ.              
           DISPLAY ' INPUT FRD SKUS READ  : ' PA-INPUT3-ROWS-READ.              
           DISPLAY ' TOTAL ITEM SELECT    : ' PV-TSKXREF-SELECT-CNT.            
           DISPLAY ' SKU NOT FOUND IN XREF: ' PV-TSKXREF-SKIP-CNT.              
           DISPLAY ' ITM/LOC NOT IN  TSKST: ' PV-TSKST-SKIP-CNT.                
           DISPLAY ' TOTAL ROWS UPDATED   : ' PA-TSKST-ROW-UPDATED.             
           DISPLAY ' TOTAL ROWS NOT UPDT  : ' PA-NOT-UPDATD-CNT.                
           DISPLAY ' TOTAL LOC0 LRD UPDT  : ' PV-TSKST-LRD-LOC0-CNT.            
           DISPLAY ' TOTAL LOC0 FRD UPDT  : ' PV-TSKST-FRD-LOC0-CNT.            
           DISPLAY ' NUMBER OF COMMIT TAKN: ' PA-COMMIT-TAKEN.                  
           DISPLAY '***** END OF FSKUP999 TOTALS *****'.                        
           DISPLAY ' '.                                                         
