000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MPKCS027.                                00050000
000600 AUTHOR.                 WILLIAM B. BURT.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            APRIL, 1991.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE MERCHANDISE PROCESSING MENU ON THE    00120000
001300* LRT (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM    00130000
001400* WHICH PROCESSES THE SELECTED FUNCTION.                          00140000
001500******************************************************************00150000
263627*----------------------------------------------------------------*00151000
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00152000
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00153000
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00154000
263627*----------------------------------------------------------------*00155000
001600                                                                  00156000
001700******************************************************************00157000
001800 ENVIRONMENT DIVISION.                                            00158000
001900******************************************************************00159000
002000                                                                  00160000
002100******************************************************************00170000
002200 DATA DIVISION.                                                   00180000
002300******************************************************************00190000
002400                                                                  00200000
002500******************************************************************00210000
002600 WORKING-STORAGE SECTION.                                         00220000
002700******************************************************************00230000
002800     COPY MPWS026.                                                00240000
002900                                                                  00250000
003000* * *  COMMAREA TO PCKRF901                                       00260000
003100 01  PC056-COMMAREA.                                              00270000
003200     COPY PCWS056.                                                00280000
003300                                                                  00290000
003400 01  PC-PROGRAM-CONSTANTS.                                        00300000
003500     05  PC-TRANSFER-DOWN-LENGTH         PIC S9(04)  VALUE +11    00310000
003600                                                     COMP.        00320000
003700     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00330000
003800         'MPKCS027'.                                              00340000
003900     05  PC-LOGON-TRAN-ID                PIC  X(04)  VALUE 'Z028'.00350000
004000     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'M027'.00360000
004100     05  PC-CHECK-AUTH-FOR-TRAN-M026     PIC  X(04)  VALUE 'M026'.00370000
004200     05  PC-CHECK-AUTH-FOR-TRAN-E270     PIC  X(04)  VALUE 'E270'.00380000
004300     05  PC-CHECK-AUTH-FOR-TRAN-E850     PIC  X(04)  VALUE 'E850'.00390000
004400     05  PC-CHECK-AUTH-FOR-TRAN-D453     PIC  X(04)  VALUE 'D453'.00400000
004500     05  PC-CHECK-AUTH-FOR-TRAN-T020     PIC  X(04)  VALUE 'T020'.00410000
004700     05  PC-CHECK-AUTH-FOR-TRAN-S500     PIC  X(04)  VALUE 'S500'.00420000
004800     05  PC-CHECK-AUTH-FOR-TRAN-E868     PIC  X(04)  VALUE 'E868'.00430000
004900     05  PC-CHECK-AUTH-FOR-TRAN-G901     PIC  X(04)  VALUE 'G901'.00440000
005000     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00450000
005100         'END OF SESSION     '.                                   00460000
005200     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00470000
005300         'INVALID SELECTION  '.                                   00480000
005400     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00490000
005500         'UNRECOGNIZED PF KEY'.                                   00500000
005600     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00510000
005700         'USER NOT AUTHORIZED'.                                   00520000
005800     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00530000
005900         'NUMERIC VALUE REQ. '.                                   00540000
006000     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00550000
006100         'F0 =END            '.                                   00560000
006200     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00570000
006300         'TRANS NOT AVAILABLE'.                                   00580000
006400     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00590000
006500         'CICS ABEND -CALL DP'.                                   00600000
006600     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00610000
006700         'CICSAUTH BAD RETURN'.                                   00620000
006800     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00630000
006900         'SELECTION NOT AVAIL'.                                   00640000
007000     05  PC-DC-NOT-VALID-FOR-P4-MSG      PIC X(19)   VALUE        00650000
007100         'NO SHARE FOR DC    '.                                   00660000
007200* JAK 04/2007 - ADD NEW MESSAGE                                   00670000
007300     05  PC-DC-IN-WMOS-MSG               PIC X(19)   VALUE        00680000
007400         'ERR - DC IS ON WMS'.                                    00690000
007410     05  PC-CICS-FATAL-ERROR-MSG         PIC  X(19)  VALUE        00700000
007420         'CICS ERR/HELP DESK '.                                   00710000
007500                                                                  00720000
007600 01  PN-PGM-NAME-DATA.                                            00730000
007700     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00740000
007800         'MPKCS026'.                                              00750000
007900     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00760000
008000         'RCKCS270'.                                              00770000
008100     05  PN-SELECTION-03-PROGRAM         PIC  X(08)  VALUE        00780000
008300         'PCKRF850'.                                              00790000
008400     05  PN-SELECTION-04-PROGRAM         PIC  X(08)  VALUE        00800000
008500         'DLKRF453'.                                              00810000
008600     05  PN-SELECTION-05-PROGRAM         PIC  X(08)  VALUE        00820000
008700         '        '.                                              00830000
008800     05  PN-SELECTION-06-PROGRAM         PIC  X(08)  VALUE        00840000
008900         'SUKRF500'.                                              00850000
009000     05  PN-SELECTION-07-PROGRAM         PIC  X(08)  VALUE        00860000
009100         'PCKRF868'.                                              00870000
009200     05  PN-SELECTION-08-PROGRAM         PIC  X(08)  VALUE        00880000
009300         'PCKRF901'.                                              00890000
009400                                                                  00900000
009500 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00910000
009600     05  PN-PGM-NAME  OCCURS 8 TIMES                              00920000
009700                      INDEXED BY PN-INDX                          00930000
009800                                         PIC  X(08).              00940000
009900                                                                  00950000
010000 01  PS-PROGRAM-SWITCHES.                                         00960000
010100     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00970000
010200         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00980000
010300         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00990000
010400     05  PS-VALID-P4-FACILITY-SW         PIC  X(01)  VALUE 'N'.   01000000
010500         88  PS-VALID-P4-FACILITY-NO                 VALUE 'N'.   01010000
010600         88  PS-VALID-P4-FACILITY                    VALUE 'Y'.   01020000
010700* JAK 04/2007 - ADD WMOS SWITCH                                   01030000
010800     05  PS-DC-ON-WMOS-SW               PIC  X       VALUE 'N'.   01040000
010900         88  PS-DC-ON-WMOS-YES                       VALUE 'Y'.   01050000
011000         88  PS-DC-ON-WMOS-NO                        VALUE 'N'.   01060000
011100                                                                  01070000
011200 01  PV-PROGRAM-VARIABLES.                                        01080000
011210     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01090000
011220                                                    COMP SYNC.    01100000
011300     05  PV-CSSL-MSG                     PIC  X(100) VALUE SPACE. 01110000
011301     05  PV-CSSL-MSG-LENGTH              PIC S9(04)  VALUE +0     01120000
011302                                                     COMP SYNC.   01130000
011310     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01131000
011400                                                     COMP.        01132000
011500     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01133000
011600     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01134000
011700                                                     COMP SYNC.   01135000
011800     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01136000
011900     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01137000
012000     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  01138000
012100                                                     COMP.        01139000
012200     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  01140000
012300                                                     COMP.        01150000
012400     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01160000
012500                                                     COMP.        01170000
012600     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01180000
012700                                                     COMP SYNC.   01190000
012800     05  PV-CURRENT-TMST                 PIC X(26)  VALUE SPACES. 01200000
012900                                                                  01210000
013000     05  PV-SYSTEM-ID.                                            01220000
013100         10  FILLER              PIC  X(04)  VALUE SPACE.         01230000
013200         10  PV-REGION-IND       PIC  X(01).                      01240000
013300             88  PV-TEST-CICS                VALUE 'T'.           01250000
013400             88  PV-QA-CICS                  VALUE 'Q'.           01260000
013500             88  PV-PROD-CICS                VALUE 'P'.           01270000
013600             88  PV-LEARN-CICS               VALUE 'L'.           01280000
013700         10  FILLER              PIC  X(03)  VALUE SPACES.        01290000
013800*                                                                 01300000
013900 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  01310000
014000     05  TS-INFO-QUEUE-NAME.                                      01320000
014100         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 01330000
014200         10  FILLER                      PIC  X(04)  VALUE 'INFO'.01340000
014300                                                                  01350000
014400* JAK 04/2007 - ADD KEY FIELDS                                    01360000
014500 01  DK-DB2-KEYS.                                                 01370000
014600     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         01380000
014700     05  DK-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.01390000
014800******************************************************************01400000
014900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01410000
015000******************************************************************01420000
015100     COPY DPWS013.                                                01430000
015200                                                                  01440000
015300******************************************************************01450000
015400*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01460000
015500******************************************************************01470000
015600     COPY DPWS008.                                                01480000
015700                                                                  01490000
015800******************************************************************01500000
015900*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01510000
016000********M*********************************************************01520000
016100     COPY DPWS010I.                                               01530000
016200                                                                  01540000
016300******************************************************************01550000
016400*  TEMPORARY STORAGE QUEUE LAYOUT FOR LOGON/UNIT RELATED          01560000
016500*  INFORMATION CAPTURED BY THE NAVIGATOR AT LOGON TIME            01570000
016600******************************************************************01580000
016700     COPY DPWS026.                                                01590000
016800                                                                  01600000
016900******************************************************************01610000
017000*  GENERATED DSECT FOR THE MPKM027 MAPSET                         01620000
017100******************************************************************01630000
017200     COPY MPKM027.                                                01640000
017300                                                                  01650000
018000******************************************************************01660000
018100* DLX (LABOR COMMAREA)                                            01670000
018200******************************************************************01680000
018300     COPY DLWS010.                                                01690000
018400                                                                  01700000
018500******************************************************************01710000
018600* HELP SCREEN COMMAREA                                            01720000
018700******************************************************************01730000
018800     COPY PCWS192.                                                01740000
018900******************************************************************01750000
019000* HELP SCREEN WORK AREA                                           01760000
019100******************************************************************01770000
019200     COPY PCWS188.                                                01780000
019300******************************************************************01790000
019400*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01800000
019500******************************************************************01810000
019600     COPY DPWS015.                                                01820000
019700                                                                  01830000
019800******************************************************************01840000
019900*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01850000
020000******************************************************************01860000
020100     COPY DFHAID.                                                 01870000
020200                                                                  01880000
020300******************************************************************01890000
020400*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 01900000
020500******************************************************************01910000
020600     EXEC SQL                                                     01920000
020700          INCLUDE TKRPRPM                                         01930000
020800     END-EXEC.                                                    01940000
020900* JAK 04/2007 - ADD WST00008/9/10                                 01950000
021000******************************************************************01960000
021100*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 01970000
021200******************************************************************01980000
021300     EXEC SQL                                                     01990000
021400          INCLUDE WST00008                                        02000000
021500     END-EXEC.                                                    02010000
021600******************************************************************02020000
021700*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   02030000
021800******************************************************************02040000
021900     EXEC SQL                                                     02050000
022000          INCLUDE WST00009                                        02060000
022100     END-EXEC.                                                    02070000
022200******************************************************************02080000
022300*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   02090000
022400******************************************************************02100000
022500     EXEC SQL                                                     02110000
022600          INCLUDE WST00010                                        02120000
022700     END-EXEC.                                                    02130000
022800                                                                  02140000
022900******************************************************************02150000
023000*  COMMUNICATIONS AREA FOR DB2                                    02160000
023100******************************************************************02170000
023200     EXEC SQL                                                     02180000
023300         INCLUDE SQLCA                                            02190000
023400     END-EXEC.                                                    02200000
023500                                                                  02210000
023600******************************************************************02220000
023700 LINKAGE SECTION.                                                 02230000
023800******************************************************************02240000
023900 01  DFHCOMMAREA.                                                 02250000
024000     05  FILLER                       OCCURS 1 TO 4072 TIMES      02260000
024100                                      DEPENDING ON EIBCALEN.      02270000
024200         10  FILLER                   PIC X.                      02280000
024300                                                                  02290000
024400******************************************************************02300000
024500 PROCEDURE DIVISION.                                              02310000
024600******************************************************************02320000
024700 0000-PROGRAM-MAINLINE.                                           02330000
024800*    EXEC SQL                                                     02340000
024900*        SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 02350000
025000*    END-EXEC.                                                    02360000
025100                                                                  02370000
025200     EVALUATE EIBTRNID                                            02380000
025300     WHEN 'Z278'                                                  02390000
025400*    IF EIBTRNID = 'Z278'                                         02400000
025500         MOVE DFHCOMMAREA            TO PC192-COMMAREA            02410000
025600         MOVE PC192-HOST-SAVE-AREA   TO MP026-COMMAREA            02420000
025700*    ELSE                                                         02430000
025800     WHEN 'D453'                                                  02440000
025900*    IF EIBTRNID = 'D453'                                         02450000
026000         MOVE DFHCOMMAREA            TO DL010-COMMAREA            02460000
026100         MOVE MP026-MP-SAVE-AREA     TO MP026-COMMAREA            02470000
026200         SET MP026-INITIALIZE-SCREEN TO TRUE                      02480000
026300*    ELSE                                                         02490000
026400     WHEN 'G901'                                                  02500000
026500         MOVE DFHCOMMAREA            TO PC056-COMMAREA            02510000
026600         MOVE PC056-HOST-SAVE-AREA   TO MP026-COMMAREA            02520000
026700     WHEN OTHER                                                   02530000
026800         MOVE DFHCOMMAREA            TO MP026-COMMAREA            02540000
026900     END-EVALUATE.                                                02550000
027000*    END-IF.                                                      02560000
027100     MOVE LOW-VALUES                 TO MP027AI.                  02570000
027200                                                                  02580000
027300     EVALUATE TRUE                                                02590000
027400         WHEN EIBCALEN = ZERO                                     02600000
027500         WHEN EIBAID = DFHCLEAR                                   02610000
027600         WHEN MP026-INITIALIZE-SCREEN                             02620000
027700              INITIALIZE MP026-COMMAREA                           02630000
027800              MOVE PC-PROGRAM-FUNCTION-KEYS                       02640000
027900                                     TO AMSGLNO                   02650000
028000              PERFORM 1200-FIND-SYSTEM-ID                         02660000
028100              PERFORM 1300-FIND-LOGON-INFO                        02670000
028200              PERFORM 8000-SEND-MAP                               02680000
028300              PERFORM 8200-RETURN-TRANID                          02690000
028400         WHEN EIBAID = DFHENTER                                   02700000
028500              PERFORM 1000-RECEIVE-MAP                            02710000
028600              PERFORM 1100-EDIT-SELECTION                         02720000
028700                                                                  02730000
028800*  NOTE !!!!!  THE FUNCTION KEY F3=END WILL NOT DISPLAY ON THE    02740000
028900*  SCREEN.  THIS IS ONLY HERE FOR TESTING PURPOSES ON THE         02750000
029000*  MAINFRAME.   THE LOGOFF KEY WHEN USING THE LRT WILL BE F0.     02760000
029100*  COMMENT OUT THE 'F3' LOGIC BEFORE MOVING THIS PROGRAM TO PROD. 02770000
029200                                                                  02780000
029300         WHEN EIBAID = DFHPF10                                    02790000
029400             PERFORM 2010-CHECK-CICS-NETWORK                      02800000
029500             PERFORM 8300-LOGOFF-TO-VTAM-SCREEN                   02810000
029600                                                                  02820000
029700*        WHEN EIBAID = DFHPF3                                     02830000
029800*            EXEC CICS                                            02840000
029900*                RETURN                                           02850000
030000*            END-EXEC                                             02860000
030100                                                                  02870000
030200         WHEN EIBAID = DFHPF1                                     02880000
030300              PERFORM 1400-HELP-SCREEN                            02890000
030400         WHEN OTHER                                               02900000
030500              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     02910000
030600                                     TO AMSGLNO                   02920000
030700              MOVE MP026-OPER-UNIT-ID                             02930000
030800                                     TO ADCO                      02940000
030900              PERFORM 8100-SEND-DATA-ONLY                         02950000
031000              PERFORM 8200-RETURN-TRANID                          02960000
031100     END-EVALUATE.                                                02970000
031200                                                                  02980000
031300     GOBACK.                                                      02990000
031400*                                                                 03000000
031500*                                                                 03010000
031600 1000-RECEIVE-MAP.                                                03020000
031700     EXEC CICS                                                    03030000
031800         RECEIVE MAP    ('MP027A')                                03040000
031900                 MAPSET ('MPKM027')                               03050000
032000                 RESP   (PV-CICS-RESPONSE)                        03060000
032100     END-EXEC.                                                    03070000
032200                                                                  03080000
032300     EVALUATE TRUE                                                03090000
032400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03100000
032500              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  03110000
032600         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                03120000
032700              CONTINUE                                            03130000
032800         WHEN OTHER                                               03140000
032900              MOVE '1000-RECEIVE-MAP'                             03150000
033000                                     TO DP013-PARAGRAPH           03160000
033100              MOVE 'UNABLE TO RECEIVE MAP'                        03170000
033200                                     TO DP013-MESSAGE-TEXT (1)    03180000
033300              SET DP013-LOGIC-ABEND  TO TRUE                      03190000
033400              SET DP013-NO-ROLLBACK  TO TRUE                      03200000
033500              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03210000
033600     END-EVALUATE.                                                03220000
033700*                                                                 03230000
033800*                                                                 03240000
033900 1010-RECEIVE-SCREEN-FIELDS.                                      03250000
034000     IF  ASELECTL > ZERO                                          03260000
034100         MOVE ASELECTI               TO MP026-SELECTION-X         03270000
034200     END-IF.                                                      03280000
034300*                                                                 03290000
034400*                                                                 03300000
034500 1100-EDIT-SELECTION.                                             03310000
034600     MOVE MP026-SELECTION-X          TO DP010I-UNEDITED-FIELD.    03320000
034700     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    03330000
034800     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03340000
034900     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03350000
035000                                                                  03360000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03370000
263627          USING DP010I-NUMERIC-EDIT-AREA.                         03380000
035200                                                                  03390000
035300     IF  DP010I-ERROR-DETECTED                                    03400000
035400         MOVE PC-NON-NUMERIC-SELECTION-MSG                        03410000
035500                                     TO AMSGLNO                   03420000
035600         MOVE MP026-OPER-UNIT-ID     TO ADCO                      03430000
035700         PERFORM 8100-SEND-DATA-ONLY                              03440000
035800         PERFORM 8200-RETURN-TRANID                               03450000
035900     ELSE                                                         03460000
036000         MOVE DP010I-NUMERIC-FIELD   TO MP026-SELECTION           03470000
036100     END-IF.                                                      03480000
036200     EVALUATE TRUE                                                03490000
036300     WHEN MP026-VALID-SELECTION                                   03500000
036400         PERFORM 2000-PROCESS-SELECTION                           03510000
036500*    WHEN MP026-UNAVAILABLE-SELECTION                             03520000
036600*        MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  03530000
036700*        MOVE PC-UNAVAIL-SELECTION-MSG                            03540000
036800*                                    TO AMSGLNO                   03550000
036900*        MOVE MP026-OPER-UNIT-ID     TO ADCO                      03560000
037000*        PERFORM 8100-SEND-DATA-ONLY                              03570000
037100*        PERFORM 8200-RETURN-TRANID                               03580000
037200     WHEN OTHER                                                   03590000
037300         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  03600000
037400         MOVE PC-INVALID-SELECTION-MSG                            03610000
037500                                     TO AMSGLNO                   03620000
037600         MOVE MP026-OPER-UNIT-ID     TO ADCO                      03630000
037700         PERFORM 8100-SEND-DATA-ONLY                              03640000
037800         PERFORM 8200-RETURN-TRANID                               03650000
037900     END-EVALUATE.                                                03660000
038000*                                                                 03670000
038100******************************************************************03680000
038200* DETERMINE IF WE ARE RUNNING IN A SINGLE CICS REGION (CICST1),   03690000
038300* OR IF WE ARE RUNNING IN A SPLIT CICS REGION (CICSP1 AND CICSP4).03700000
038400* PV-SYSID WILL BE SPACES IF WE ARE RUNNING IN A SINGLE REGION.   03710000
038500******************************************************************03720000
038600 1200-FIND-SYSTEM-ID.                                             03730000
038700     EXEC CICS                                                    03740000
038800         INQUIRE                                                  03750000
038900             TRANSACTION   (PC-LOGON-TRAN-ID)                     03760000
039000             REMOTESYSTEM  (PV-SYSID)                             03770000
039100             RESP          (PV-CICS-RESPONSE)                     03780000
039200     END-EXEC.                                                    03790000
039300                                                                  03800000
039400     EVALUATE TRUE                                                03810000
039500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03820000
039600             CONTINUE                                             03830000
039700         WHEN OTHER                                               03840000
039800             MOVE '1200-FIND-SYSTEM-ID'                           03850000
039900                 TO DP013-PARAGRAPH                               03860000
040000             MOVE 'UNABLE TO DETERMINE SYSTEM ID'                 03870000
040100                 TO DP013-MESSAGE-TEXT (1)                        03880000
040200             SET DP013-CICS-ABEND      TO  TRUE                   03890000
040300             SET DP013-NO-ROLLBACK     TO  TRUE                   03900000
040400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03910000
040500             MOVE PC-CICS-FATAL-ERROR-MSG                         03920000
040600                                       TO  AMSGLNO                03930000
040700             SET MP026-PROCESS-SCREEN  TO  TRUE                   03940000
040800             PERFORM 8100-SEND-DATA-ONLY                          03950000
040900             PERFORM 8200-RETURN-TRANID                           03960000
041000     END-EVALUATE.                                                03970000
041100*                                                                 03980000
041200*                                                                 03990000
041300******************************************************************04000000
041400*  FIND THE LOCATION OF THE TERMINAL OR PC AND THE USERID OF THE  04010000
041500*  PERSON THAT IS CURRENTLY LOGGED ON.  IF WE ARE RUNNING IN      04020000
041600*  CICST1, PV-SYSID WILL BE SPACES BECAUSE THE TERMINAL AND       04030000
041700*  APPLICATION REGIONS ARE BOTH CICST1.  IF WE ARE IN PRODUCTION, 04040000
041800*  PV-SYSID WILL NOT BE SPACES BECAUSE OF THE SPLIT REGION        04050000
041900*  PROCESSING.  IN PRODUCTION, THE APPLICATION REGION IS CICSP4,  04060000
042000*  WHILE THE TERMINAL REGION (WHERE WE NEED TO GET OUR REQUESTED  04070000
042100*  INFORMATION) IS CICSP1.                                        04080000
042200******************************************************************04090000
042300 1300-FIND-LOGON-INFO.                                            04100000
042400     MOVE LENGTH OF DP026-SIGN-ON-INFO                            04110000
042500                    TO  PV-SIGN-ON-INFO-LENGTH.                   04120000
042600     MOVE EIBTRMID  TO  TS-INFO-QUEUE-TERMINAL.                   04130000
042700     MOVE +1        TO  PV-TS-ITEM.                               04140000
042800                                                                  04150000
042900     IF PV-SYSID = SPACES                                         04160000
043000         EXEC CICS                                                04170000
043100             READQ TS                                             04180000
043200                 QUEUE  (TS-INFO-QUEUE-NAME)                      04190000
043300                 ITEM   (PV-TS-ITEM)                              04200000
043400                 INTO   (DP026-SIGN-ON-INFO)                      04210000
043500                 RESP   (PV-CICS-RESPONSE)                        04220000
043600         END-EXEC                                                 04230000
043700     ELSE                                                         04240000
043800         EXEC CICS                                                04250000
043900             READQ TS                                             04260000
044000                 QUEUE   (TS-INFO-QUEUE-NAME)                     04270000
044100                 SYSID   (PV-SYSID)                               04280000
044200                 ITEM    (PV-TS-ITEM)                             04290000
044300                 INTO    (DP026-SIGN-ON-INFO)                     04300000
044400                 LENGTH  (PV-SIGN-ON-INFO-LENGTH)                 04310000
044500                 RESP    (PV-CICS-RESPONSE)                       04320000
044600         END-EXEC                                                 04330000
044700     END-IF.                                                      04340000
044800                                                                  04350000
044970     EVALUATE TRUE                                                04360000
045000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04370000
045100             MOVE DP026-LOCATION-NBR  TO MP026-OPER-UNIT-ID       04380000
045200                                      ADCO                        04390000
045300             MOVE DP026-USERID    TO MP026-USERID                 04400000
045400         WHEN OTHER                                               04410000
046502*                                                                 04420000
046503*** ADDED 7/2/10 - DMH BEGIN                                      04430000
046504*                                                                 04440000
046505             PERFORM 2010-CHECK-CICS-NETWORK                      04450000
046506                                                                  04460000
046507             INITIALIZE PV-CSSL-MSG                               04470000
046508             STRING ' MPKCS027 1300-FIND-LOGON-INFO'              04480000
046509                    ' CANT READ LOGON TSQ -'                      04490000
046510                    ' PV-SYSID:'  PV-SYSID                        04500000
046511                    ' USER:'      DP026-USERID                    04510000
046512                    ' RGN:'       PV-SYSTEM-ID                    04520000
046513                    DELIMITED BY SIZE INTO PV-CSSL-MSG            04530000
046514              MOVE LENGTH OF PV-CSSL-MSG                          04540000
046515                TO PV-CSSL-MSG-LENGTH                             04550000
046516              EXEC CICS                                           04560000
046517                   WRITEQ TD                                      04570000
046518                    QUEUE  ('CSSL')                               04580000
046519                     FROM  (PV-CSSL-MSG)                          04590000
046520                   LENGTH  (PV-CSSL-MSG-LENGTH)                   04600000
046521                     RESP  (PV-CICS-RESP)                         04610000
046522              END-EXEC                                            04620000
046523                                                                  04630000
046524             PERFORM 8400-DISCONNECT-CICS                         04640000
046540*                                                                 04650000
046550*** ADDED 7/2/10 - DMH END                                        04651000
046560*                                                                 04652000
046600     END-EVALUATE.                                                04653000
046610                                                                  04654000
046620                                                                  04655000
046700*                                                                 04656000
046800 1400-HELP-SCREEN.                                                04657000
046900     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      04658000
047000     MOVE 'MPKCS027'                  TO PC192-PROGRAM-NAME       04659000
047100     COPY PCPD188.                                                04660000
047200     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      04670000
047300     PERFORM 2200-XCTL-TO-HELP.                                   04680000
047400                                                                  04690000
047500 2000-PROCESS-SELECTION.                                          04700000
047600     SET PN-INDX                     TO MP026-SELECTION.          04710000
047700     IF MP026-SELECTION < 9                                       04720000
047800         PERFORM 9000-CHECK-RACF                                  04730000
047900     ELSE                                                         04740000
048000         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       04750000
048100         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    04760000
048200     END-IF.                                                      04770000
048300                                                                  04780000
048400* JAK 04/2007 - START                                             04790000
048500     PERFORM 2060-GET-CURR-TMST.                                  04800000
048600     MOVE MP026-OPER-UNIT-ID         TO DK-OPER-UNT-ID.           04810000
048700     PERFORM 2070-CHECK-DC-WMOS.                                  04820000
048800                                                                  04830000
048900* IF THE DC IS SET UP ON WMOS, THEN THE ONLY OPTION AVAILABLE     04840000
049000* FROM THIS SCREEN IS 1-UPC.                                      04850000
049001*                                                                 04860000
049010* ADDED OPTION 3 FOR EFC'S TO BE ABLE TO GET TO CARTON STATUS     04870000
049020* ADDITIONAL BLOCK PUT IN PCKRF850 & PCKRF884 TO BLOCK THE EFC'S  04880000
049021* DMH 9/2/15                                                      04890000
049030*                                                                 04900000
049100     IF PS-DC-ON-WMOS-YES                                         04910000
049200        AND MP026-SELECTION-X NOT = '1'                           04920000
049300        AND MP026-SELECTION-X NOT = '6'                           04930000
049310        AND MP026-SELECTION-X NOT = '3'                           04931000
049400*        MOVE '2000-PROCESS-SELECTIONS'                           04932000
049500*                                    TO DP013-PARAGRAPH           04933000
049600*        MOVE 'DC IS ON WMOS - CANNOT PROCESS REQUEST'            04934000
049700*                                    TO DP013-MESSAGE-TEXT (1)    04935000
049800*        MOVE PV-TRANSFER-PROGRAM                                 04936000
049900*                                    TO DP013-MESSAGE-TEXT (2)    04937000
050000*        SET DP013-CICS-ABEND        TO TRUE                      04938000
050100*        SET DP013-NO-ROLLBACK       TO TRUE                      04939000
050200*        PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04940000
050300         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  04950000
050400         MOVE PC-DC-IN-WMOS-MSG                                   04960000
050500                                     TO AMSGLNO                   04970000
050600*        SET MP026-PROCESS-SCREEN TO TRUE                         04980000
050700         MOVE MP026-OPER-UNIT-ID     TO ADCO                      04990000
050800         PERFORM 8100-SEND-DATA-ONLY                              05000000
050900         PERFORM 8200-RETURN-TRANID                               05010000
051000     END-IF.                                                      05020000
051100* JAK 04/2007 - END                                               05030000
051200                                                                  05040000
051300     IF MP026-SELECTION = 4                                       05050000
051400         PERFORM 2050-VALIDATE-P4-FACILITY                        05060000
051500         IF PS-VALID-P4-FACILITY                                  05070000
051600             MOVE MP026-SELECTION     TO DL010-SELECTION          05080000
051700             MOVE MP026-USERID        TO DL010-USERID             05090000
051800         ELSE                                                     05100000
051900             MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA              05110000
052000             MOVE MP026-OPER-UNIT-ID     TO ADCO                  05120000
052100             MOVE PC-DC-NOT-VALID-FOR-P4-MSG                      05130000
052200                                         TO AMSGLNO               05140000
052300             PERFORM 8100-SEND-DATA-ONLY                          05150000
052400             PERFORM 8200-RETURN-TRANID                           05160000
052500         END-IF                                                   05170000
052600     END-IF.                                                      05180000
052700                                                                  05190000
052800     IF  PS-ACCESS-ALLOWED                                        05200000
052900         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       05210000
053000         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    05220000
053100     ELSE                                                         05230000
053200         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  05240000
053300         MOVE MP026-OPER-UNIT-ID     TO ADCO                      05250000
053400         PERFORM 8100-SEND-DATA-ONLY                              05260000
053500         PERFORM 8200-RETURN-TRANID                               05270000
053600     END-IF.                                                      05280000
053700*                                                                 05290000
053800*----------------------------------------------------------------*05300000
053900*  DETERMINE WHAT CICS NETWORK YOU ARE WORKING IN                 05310000
054000*----------------------------------------------------------------*05320000
054100 2010-CHECK-CICS-NETWORK.                                         05330000
054200                                                                  05340000
054300      EXEC CICS                                                   05350000
054400          ASSIGN                                                  05360000
054500              APPLID(PV-SYSTEM-ID)                                05370000
054600      END-EXEC.                                                   05380000
054601                                                                  05390000
054710                                                                  05400000
054800*----------------------------------------------------------------*05410000
054900*---------------------------------------------------------------- 05420000
055000* MAKE SURE THIS DC LOCATION IS VALID FOR ACCESSING THE P4 MENU   05430000
055100*---------------------------------------------------------------- 05440000
055200 2050-VALIDATE-P4-FACILITY.                                       05450000
055300     SET PS-VALID-P4-FACILITY-NO      TO TRUE.                    05460000
055400                                                                  05470000
055500     EXEC SQL                                                     05480000
055600          SELECT LOC_ID                                           05490000
055700          INTO :KRPRPM-LOC-ID                                     05500000
055800          FROM TKRPRPM                                            05510000
055900          WHERE LOC_ID = :MP026-OPER-UNIT-ID                      05520000
056000            AND INTFC_SYS_CDE = 'DLX'                             05530000
056100            AND SYS_PRC_FUNC_CDE = 'DLLBIN'                       05540000
056200            AND FUNC_PRC_STAT_CDE = 'AC'                          05550000
056300            AND FUNC_TXT = 'Y'                                    05560000
056400            AND (CURRENT DATE                                     05570000
056500        BETWEEN DATE(FUNC_BEG_TMST) AND                           05580000
056600                DATE(FUNC_END_TMST) )                             05590000
056700     END-EXEC.                                                    05600000
056800                                                                  05610000
056900     EVALUATE TRUE                                                05620000
057000         WHEN SQLCODE = +0                                        05630000
057100              SET PS-VALID-P4-FACILITY     TO TRUE                05640000
057200         WHEN OTHER                                               05650000
057300              SET PS-VALID-P4-FACILITY-NO  TO TRUE                05660000
057400     END-EVALUATE.                                                05670000
057500*---------------------------------------------------------------- 05680000
057600                                                                  05690000
057700* JAK 04/2007 - START                                             05700000
057800 2060-GET-CURR-TMST.                                              05710000
057900                                                                  05720000
058000         EXEC SQL                                                 05730000
058100             SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP        05740000
058200         END-EXEC.                                                05750000
058300                                                                  05760000
058400                                                                  05770000
058500 2070-CHECK-DC-WMOS.                                              05780000
058600                                                                  05790000
058700     EXEC SQL                                                     05800000
058800          SELECT   A.INTGRTN_TYP_DESC                             05810000
058900            INTO  :WST00008-INTGRTN-TYP-DESC                      05820000
059000            FROM                                                  05830000
059100                  WST_INTGRTN_TYP  A                              05840000
059200               ,  WST_ATTR_DEFN    B                              05850000
059300               ,  WST_ATTR_ELEM    C                              05860000
059400               ,  WST_ATTR_ELEM    D                              05870000
059500               ,  WST_ATTR_ELEM    E                              05880000
059600            WHERE                                                 05890000
059700                  A.INTGRTN_TYP_CDE   = 'WMOSON'                  05900000
059800              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         05910000
059900              AND B.ATTR_DEFN_SEQ_NBR = 1                         05920000
060000              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         05930000
060100              AND C.ATTR_DEFN_SEQ_NBR = 1                         05940000
060200              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         05950000
060300              AND D.ATTR_DEFN_SEQ_NBR = 2                         05960000
060400              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         05970000
060500              AND E.ATTR_DEFN_SEQ_NBR = 3                         05980000
060600              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       05990000
060700              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       06000000
060800              AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID           06010000
060900              AND E.ATTR_ELEM_TMST   <= :DK-CURRENT-TIMESTAMP     06020000
061000     END-EXEC.                                                    06030000
061100                                                                  06040000
061200     EVALUATE TRUE                                                06050000
061300         WHEN SQLCODE = ZERO                                      06060000
061400             SET PS-DC-ON-WMOS-YES      TO TRUE                   06070000
061500         WHEN OTHER                                               06080000
061600             SET PS-DC-ON-WMOS-NO       TO TRUE                   06090000
061700     END-EVALUATE.                                                06100000
061800* JAK 04/2007 - END                                               06110000
061900                                                                  06120000
062000                                                                  06130000
062100 2100-XCTL-TO-SELECTED-PROGRAM.                                   06140000
062200     IF PV-TRANSFER-PROGRAM = 'PCKRF901'                          06150000
062300         PERFORM 2120-XCTL-TO-PCKRF901                            06160000
062400     ELSE                                                         06170000
062500         PERFORM 2110-XCTL-TO-SELECTIONS                          06180000
062600     END-IF.                                                      06190000
062700 2110-XCTL-TO-SELECTIONS.                                         06200000
062800     SET MP026-INITIALIZE-SCREEN     TO TRUE.                     06210000
062900     MOVE PC-CURRENT-PROGRAM-NAME    TO MP026-LAST-PROGRAM.       06220000
063000     MOVE LENGTH OF MP026-COMMAREA   TO PC-TRANSFER-DOWN-LENGTH.  06230000
063100                                                                  06240000
063200     EXEC CICS                                                    06250000
063300         XCTL                                                     06260000
063400             PROGRAM   (PV-TRANSFER-PROGRAM)                      06270000
063500             COMMAREA  (MP026-COMMAREA)                           06280000
063600             LENGTH    (PC-TRANSFER-DOWN-LENGTH)                  06290000
063700             RESP      (PV-CICS-RESPONSE)                         06300000
063800     END-EXEC.                                                    06310000
063900                                                                  06320000
064000     EVALUATE TRUE                                                06330000
064100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06340000
064200              CONTINUE                                            06350000
064300         WHEN OTHER                                               06360000
064400              MOVE '2110-XCTL-TO-SELECTIONS'                      06370000
064500                                     TO DP013-PARAGRAPH           06380000
064600              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       06390000
064700                                     TO DP013-MESSAGE-TEXT (1)    06400000
064800              MOVE PV-TRANSFER-PROGRAM                            06410000
064900                                     TO DP013-MESSAGE-TEXT (2)    06420000
065000              SET DP013-CICS-ABEND   TO TRUE                      06430000
065100              SET DP013-NO-ROLLBACK  TO TRUE                      06440000
065200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              06450000
065300              MOVE PC-TRANS-UNAVAILABLE-MSG                       06460000
065400                                     TO AMSGLNO                   06470000
065500              SET MP026-PROCESS-SCREEN TO TRUE                    06480000
065600              MOVE MP026-OPER-UNIT-ID                             06490000
065700                                     TO ADCO                      06500000
065800              PERFORM 8100-SEND-DATA-ONLY                         06510000
065900              PERFORM 8200-RETURN-TRANID                          06520000
066000     END-EVALUATE.                                                06530000
066100*                                                                 06540000
066200 2120-XCTL-TO-PCKRF901.                                           06550000
066300     INITIALIZE PC056-PROGRAM-CONTROL-SW                          06560000
066400     SET MP026-INITIALIZE-SCREEN      TO TRUE.                    06570000
066500     MOVE PC-CURRENT-PROGRAM-NAME     TO MP026-LAST-PROGRAM       06580000
066600                                         PC056-LAST-PROGRAM.      06590000
066700     MOVE MP026-OPER-UNIT-ID          TO PC056-SIGNON-OPER-UNT.   06600000
066800     MOVE MP026-COMMON-DATA           TO PC056-HOST-SAVE-AREA.    06610000
066900     MOVE LENGTH OF PC056-COMMAREA    TO PC-TRANSFER-DOWN-LENGTH. 06620000
067000                                                                  06630000
067100     EXEC CICS                                                    06640000
067200         XCTL                                                     06650000
067300             PROGRAM   (PV-TRANSFER-PROGRAM)                      06660000
067400             COMMAREA  (PC056-COMMAREA)                           06670000
067500             LENGTH    (PC-TRANSFER-DOWN-LENGTH)                  06680000
067600             RESP      (PV-CICS-RESPONSE)                         06690000
067700     END-EXEC.                                                    06700000
067800                                                                  06710000
067900     EVALUATE TRUE                                                06720000
068000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06730000
068100              CONTINUE                                            06740000
068200         WHEN OTHER                                               06750000
068300              MOVE '2120-XCTL-TO-PCKRF901'                        06760000
068400                                     TO DP013-PARAGRAPH           06770000
068500              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       06780000
068600                                     TO DP013-MESSAGE-TEXT (1)    06790000
068700              MOVE PV-TRANSFER-PROGRAM                            06800000
068800                                     TO DP013-MESSAGE-TEXT (2)    06810000
068900              SET DP013-CICS-ABEND   TO TRUE                      06820000
069000              SET DP013-NO-ROLLBACK  TO TRUE                      06830000
069100              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              06840000
069200              MOVE PC-TRANS-UNAVAILABLE-MSG                       06850000
069300                                     TO AMSGLNO                   06860000
069400              SET MP026-PROCESS-SCREEN TO TRUE                    06870000
069500              MOVE MP026-OPER-UNIT-ID                             06880000
069600                                     TO ADCO                      06890000
069700              PERFORM 8100-SEND-DATA-ONLY                         06900000
069800              PERFORM 8200-RETURN-TRANID                          06910000
069900     END-EVALUATE.                                                06920000
070000*                                                                 06930000
070100 2200-XCTL-TO-HELP.                                               06940000
070200                                                                  06950000
070300     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      06960000
070400     SET MP026-INITIALIZE-SCREEN      TO TRUE.                    06970000
070500     MOVE MP026-COMMAREA              TO PC192-HOST-SAVE-AREA.    06980000
070600                                                                  06990000
070700     EXEC CICS                                                    07000000
070800         XCTL                                                     07010000
070900             PROGRAM   (PV-TRANSFER-PROGRAM)                      07020000
071000             COMMAREA  (PC192-COMMAREA)                           07030000
071100             LENGTH    (PV-COMMAREA-LENGTH)                       07040000
071200             RESP      (PV-CICS-RESPONSE)                         07050000
071300     END-EXEC.                                                    07060000
071400                                                                  07070000
071500     EVALUATE TRUE                                                07080000
071600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07090000
071700              CONTINUE                                            07100000
071800         WHEN OTHER                                               07110000
071900              MOVE '2200-XCTL-TO-HELP'                            07120000
072000                                     TO DP013-PARAGRAPH           07130000
072100              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       07140000
072200                                     TO DP013-MESSAGE-TEXT (1)    07150000
072300              MOVE PV-TRANSFER-PROGRAM                            07160000
072400                                     TO DP013-MESSAGE-TEXT (2)    07170000
072500              SET DP013-CICS-ABEND   TO TRUE                      07180000
072600              SET DP013-NO-ROLLBACK  TO TRUE                      07190000
072700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07200000
072800              MOVE PC-TRANS-UNAVAILABLE-MSG                       07210000
072900                                     TO AMSGLNO                   07220000
073000              SET MP026-PROCESS-SCREEN TO TRUE                    07230000
073100              PERFORM 8100-SEND-DATA-ONLY                         07240000
073200              PERFORM 8200-RETURN-TRANID                          07250000
073300     END-EVALUATE.                                                07260000
073400*                                                                 07270000
073500 8000-SEND-MAP.                                                   07280000
073600     EXEC CICS                                                    07290000
073700         SEND MAP       ('MP027A')                                07300000
073800              MAPSET    ('MPKM027')                               07310000
073900              ERASE                                               07320000
074000              RESP      (PV-CICS-RESPONSE)                        07330000
074100     END-EXEC.                                                    07340000
074200                                                                  07350000
074300     EVALUATE TRUE                                                07360000
074400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07370000
074500              CONTINUE                                            07380000
074600         WHEN OTHER                                               07390000
074700              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           07400000
074800              MOVE 'UNABLE TO SEND MAP'                           07410000
074900                                     TO DP013-MESSAGE-TEXT (1)    07420000
075000              SET DP013-CICS-ABEND   TO TRUE                      07430000
075100              SET DP013-NO-ROLLBACK  TO TRUE                      07440000
075200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07450000
075300     END-EVALUATE.                                                07460000
075400*                                                                 07470000
075500*                                                                 07480000
075600 8100-SEND-DATA-ONLY.                                             07490000
075700     MOVE -1 TO ASELECTL.                                         07500000
075800                                                                  07510000
075900     EXEC CICS                                                    07520000
076000         SEND MAP       ('MP027A')                                07530000
076100              MAPSET    ('MPKM027')                               07540000
076200              CURSOR                                              07550000
076300              DATAONLY                                            07560000
076400              RESP      (PV-CICS-RESPONSE)                        07570000
076500     END-EXEC.                                                    07580000
076600                                                                  07590000
076700     EVALUATE TRUE                                                07600000
076800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07610000
076900              CONTINUE                                            07620000
077000         WHEN OTHER                                               07630000
077100              MOVE '8100-SEND-DATA-ONLY'                          07640000
077200                                     TO DP013-PARAGRAPH           07650000
077300              MOVE 'UNABLE TO SEND DATA'                          07660000
077400                                     TO DP013-MESSAGE-TEXT (1)    07670000
077500              SET DP013-CICS-ABEND   TO TRUE                      07680000
077600              SET DP013-NO-ROLLBACK  TO TRUE                      07690000
077700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07700000
077800     END-EVALUATE.                                                07710000
077900*                                                                 07720000
078000*                                                                 07730000
078100 8200-RETURN-TRANID.                                              07740000
078200     MOVE LENGTH OF MP026-COMMAREA    TO PV-COMMAREA-LENGTH       07750000
078300     EXEC CICS                                                    07760000
078400         RETURN TRANSID   (PC-MENU-TRANID)                        07770000
078500                COMMAREA  (MP026-COMMAREA)                        07780000
078600                LENGTH    (PV-COMMAREA-LENGTH)                    07790000
078700                RESP      (PV-CICS-RESPONSE)                      07800000
078800     END-EXEC.                                                    07810000
078900                                                                  07820000
079000     EVALUATE TRUE                                                07830000
079100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07840000
079200              CONTINUE                                            07850000
079300         WHEN OTHER                                               07860000
079400              MOVE '8200-RETURN-TRANID'                           07870000
079500                                     TO DP013-PARAGRAPH           07880000
079600              MOVE 'UNABLE TO RETURN TO TRANID'                   07890000
079700                                     TO DP013-MESSAGE-TEXT (1)    07900000
079800              SET DP013-CICS-ABEND   TO TRUE                      07910000
079900              SET DP013-NO-ROLLBACK  TO TRUE                      07920000
080000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              07930000
080100     END-EVALUATE.                                                07940000
080200*                                                                 07950000
080300*                                                                 07960000
080400 8300-LOGOFF-TO-VTAM-SCREEN.                                      07970000
080500     IF PV-TEST-CICS OR                                           07980000
080600        PV-QA-CICS                                                07990000
080700         EXEC CICS                                                08000000
080800             START TRANSID  ('Z007')                              08010000
080900                   TERMID   (EIBTRMID)                            08020000
081000                   NOHANDLE                                       08030000
081100         END-EXEC                                                 08040000
081200     ELSE                                                         08050000
081300         EXEC CICS                                                08060000
081400             START TRANSID  ('Z011')                              08070000
081500                   TERMID   (EIBTRMID)                            08080000
081600                   NOHANDLE                                       08090000
081700         END-EXEC                                                 08100000
081800     END-IF.                                                      08110000
081900                                                                  08120000
081901******************************************************************08130000
081902*  DISCONNECT FROM CICS                                           08140000
081903******************************************************************08150000
081910 8400-DISCONNECT-CICS.                                            08160000
081920       EXEC CICS                                                  08170000
081921            ISSUE                                                 08180000
081930                DISCONNECT                                        08190000
081940                NOHANDLE                                          08191000
081950       END-EXEC.                                                  08192000
081960                                                                  08193000
081970                                                                  08194000
082000*                                                                 08195000
082100 9000-CHECK-RACF.                                                 08196000
082200******************************************************************08197000
082300*  CHECK ACCESSS AUTHORITY OF USER                                08198000
082400******************************************************************08199000
082500     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     08200000
082600     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     08210000
082700                                                                  08220000
082800     EVALUATE TRUE                                                08230000
082900         WHEN MP026-SELECTION-ONE                                 08240000
083000              MOVE PC-CHECK-AUTH-FOR-TRAN-M026                    08250000
083100                                     TO DP008-RESOURCE-NAME       08260000
083200         WHEN MP026-SELECTION-TWO                                 08270000
083300              MOVE PC-CHECK-AUTH-FOR-TRAN-E270                    08280000
083400                                     TO DP008-RESOURCE-NAME       08290000
083500         WHEN MP026-SELECTION-THREE                               08300000
083600              MOVE PC-CHECK-AUTH-FOR-TRAN-E850                    08310000
083700                                     TO DP008-RESOURCE-NAME       08320000
083800         WHEN MP026-SELECTION-FOUR                                08330000
083900              MOVE PC-CHECK-AUTH-FOR-TRAN-D453                    08340000
084000                                     TO DP008-RESOURCE-NAME       08350000
084400         WHEN MP026-SELECTION-SIX                                 08360000
084500              MOVE PC-CHECK-AUTH-FOR-TRAN-S500                    08370000
084600                                     TO DP008-RESOURCE-NAME       08380000
084700         WHEN MP026-SELECTION-EIGHT                               08390000
084800              MOVE PC-CHECK-AUTH-FOR-TRAN-G901                    08400000
084900                                     TO DP008-RESOURCE-NAME       08410000
085000         WHEN MP026-SELECTION-SEVEN                               08420000
085100              MOVE PC-CHECK-AUTH-FOR-TRAN-E868                    08430000
085200                                     TO DP008-RESOURCE-NAME       08440000
085300     END-EVALUATE.                                                08450000
085400                                                                  08460000
085500     EXEC CICS                                                    08470000
085600          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               08480000
085700               COMMAREA (DP008-SECURITY-COMMAREA)                 08490000
085800               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          08500000
085900               RESP     (PV-CICS-RESPONSE)                        08510000
086000     END-EXEC.                                                    08520000
086100                                                                  08530000
086200     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       08540000
086300         IF  DP008-CALL-SUCCESSFUL                                08550000
086400             IF  DP008-ACCESS-ALLOWED                             08560000
086500                 SET PS-ACCESS-ALLOWED                            08570000
086600                                     TO TRUE                      08580000
086700             ELSE                                                 08590000
086800                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   08600000
086900                                     TO AMSGLNO                   08610000
087000             END-IF                                               08620000
087100         ELSE                                                     08630000
087200             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   08640000
087300         END-IF                                                   08650000
087400     ELSE                                                         08660000
087500         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           08670000
087600         MOVE 'BAD LINK TO RACF PROGRAM'                          08680000
087700                                     TO DP013-MESSAGE-TEXT (1)    08690000
087800         SET DP013-CICS-ABEND        TO TRUE                      08700000
087900         SET DP013-NO-ROLLBACK       TO TRUE                      08710000
088000         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   08720000
088100     END-IF.                                                      08730000
088200*                                                                 08740000
088300*                                                                 08750000
088400 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  08760000
088500     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            08770000
088600     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           08780000
088700     INITIALIZE DP013-SRC-TASK-NUMBER                             08790000
088800                DP013-STACK.                                      08800000
088900     SET DP013-LINK-RETURN           TO TRUE.                     08810000
089000                                                                  08820000
089100     EXEC CICS                                                    08830000
089200         LINK                                                     08840000
089300             PROGRAM   (DP013-NAME)                               08850000
089400             COMMAREA  (DP013-PARAMETERS)                         08860000
089500             LENGTH    (DP013-LENGTH)                             08870000
089600     END-EXEC.                                                    08880000
