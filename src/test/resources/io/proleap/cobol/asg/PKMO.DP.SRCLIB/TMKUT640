000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.   TMKUT640.                                                  
000600 AUTHOR.       MIKE FRIESS.                                               
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                                   
000800 DATE-WRITTEN. JUNE, 1999.                                                
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200* THIS PROGRAM READS THE EDITED DETAIL RECORDS FROM THE EXCEPTION         
001300* REPORTING SYSTEM AND CREATES A FLAT FILE TO BE E-MAILED BACK TO         
001400* SEVERAL INTERNAL AND EXTERNAL MAILING LISTS.                            
001500******************************************************************        
004200* 10/31/03  TKMA643                                                       
004300*              CHANGED TO GET IMPRT VENDOR NAME FROM 'TENTNME'            
004400*              INSTEAD OF 'TPURCHS'.                                      
004600*****************************************************************         
001600                                                                          
001700******************************************************************        
001800 ENVIRONMENT DIVISION.                                                    
001900******************************************************************        
002000                                                                          
002100 CONFIGURATION SECTION.                                                   
002200                                                                          
002300 SOURCE-COMPUTER.        IBM-3090.                                        
002400 OBJECT-COMPUTER.        IBM-3090.                                        
002500                                                                          
002600 INPUT-OUTPUT SECTION.                                                    
002700                                                                          
002800 FILE-CONTROL.                                                            
002900                                                                          
003000     SELECT EXCEPTION-FILE                                                
003100         ASSIGN TO INP01.                                                 
003200                                                                          
003501     SELECT FOB-INT-EI-EMAIL-FILE                                         
003502         ASSIGN TO OUTIFOBE.                                              
003503                                                                          
003510     SELECT FOB-EXT-EI-EMAIL-FILE                                         
003520         ASSIGN TO OUTXFOBE.                                              
003530                                                                          
003531     SELECT FOB-INT-OCS-EMAIL-FILE                                        
003532         ASSIGN TO OUTIFOBO.                                              
003533                                                                          
003534     SELECT FOB-EXT-OCS-EMAIL-FILE                                        
003535         ASSIGN TO OUTXFOBO.                                              
003536                                                                          
003537     SELECT FOB-INT-BC-EMAIL-FILE                                         
003538         ASSIGN TO OUTIFOBB.                                              
003539                                                                          
003540     SELECT FOB-EXT-BC-EMAIL-FILE                                         
003541         ASSIGN TO OUTXFOBB.                                              
003542                                                                          
003543     SELECT FOB-INT-XCPT-EMAIL-FILE                                       
003544         ASSIGN TO OUTIFOBX.                                              
003545                                                                          
003546     SELECT CSTM-INT-EMAIL-FILE                                           
003550         ASSIGN TO OUTICSTM.                                              
003560                                                                          
003570     SELECT CSTM-EXT-EMAIL-FILE                                           
003580         ASSIGN TO OUTXCSTM.                                              
003590                                                                          
003591     SELECT DECON-INT-EMAIL-FILE                                          
003592         ASSIGN TO OUTIDCON.                                              
003593                                                                          
003594     SELECT DECON-EXT-EMAIL-FILE                                          
003595         ASSIGN TO OUTXDCON.                                              
003596                                                                          
003600******************************************************************        
003700 DATA DIVISION.                                                           
003800******************************************************************        
003900                                                                          
004000 FILE SECTION.                                                            
004100                                                                          
004200 FD  EXCEPTION-FILE                                                       
004300     RECORDING MODE IS F                                                  
004400     LABEL RECORDS ARE STANDARD                                           
004500     BLOCK CONTAINS 0 RECORDS.                                            
004600                                                                          
004700 01  EXCEPTION-RECORD.                                                    
004800     05  FILLER                 PIC  X(023).                              
004900     05  EX-GROUP-TYP-CDE       PIC  X(002).                              
005000     05  FILLER                 PIC  X(483).                              
005100                                                                          
005200 FD  FOB-INT-EI-EMAIL-FILE                                                
005300     RECORDING MODE IS F                                                  
005400     LABEL RECORDS ARE STANDARD                                           
005500     BLOCK CONTAINS 0 RECORDS.                                            
005700 01  FOB-INT-EI-EMAIL-RECORD PIC X(80).                                   
005800                                                                          
005801 FD  FOB-EXT-EI-EMAIL-FILE                                                
005802     RECORDING MODE IS F                                                  
005803     LABEL RECORDS ARE STANDARD                                           
005804     BLOCK CONTAINS 0 RECORDS.                                            
005807 01  FOB-EXT-EI-EMAIL-RECORD PIC X(80).                                   
005810                                                                          
005811 FD  FOB-INT-OCS-EMAIL-FILE                                               
005812     RECORDING MODE IS F                                                  
005813     LABEL RECORDS ARE STANDARD                                           
005814     BLOCK CONTAINS 0 RECORDS.                                            
005816 01  FOB-INT-OCS-EMAIL-RECORD PIC X(80).                                  
005817                                                                          
005818 FD  FOB-EXT-OCS-EMAIL-FILE                                               
005819     RECORDING MODE IS F                                                  
005820     LABEL RECORDS ARE STANDARD                                           
005821     BLOCK CONTAINS 0 RECORDS.                                            
005823 01  FOB-EXT-OCS-EMAIL-RECORD PIC X(80).                                  
005824                                                                          
005825 FD  FOB-INT-BC-EMAIL-FILE                                                
005826     RECORDING MODE IS F                                                  
005827     LABEL RECORDS ARE STANDARD                                           
005828     BLOCK CONTAINS 0 RECORDS.                                            
005830 01  FOB-INT-BC-EMAIL-RECORD PIC X(80).                                   
005831                                                                          
005832 FD  FOB-EXT-BC-EMAIL-FILE                                                
005833     RECORDING MODE IS F                                                  
005834     LABEL RECORDS ARE STANDARD                                           
005835     BLOCK CONTAINS 0 RECORDS.                                            
005837 01  FOB-EXT-BC-EMAIL-RECORD PIC X(80).                                   
005838                                                                          
005839 FD  FOB-INT-XCPT-EMAIL-FILE                                              
005840     RECORDING MODE IS F                                                  
005841     LABEL RECORDS ARE STANDARD                                           
005842     BLOCK CONTAINS 0 RECORDS.                                            
005844 01  FOB-INT-XCPT-EMAIL-RECORD PIC X(80).                                 
005845                                                                          
005846 FD  CSTM-INT-EMAIL-FILE                                                  
005847     RECORDING MODE IS F                                                  
005848     LABEL RECORDS ARE STANDARD                                           
005850     BLOCK CONTAINS 0 RECORDS.                                            
005870 01  CSTM-INT-EMAIL-RECORD PIC X(80).                                     
005880                                                                          
005890 FD  CSTM-EXT-EMAIL-FILE                                                  
005891     RECORDING MODE IS F                                                  
005892     LABEL RECORDS ARE STANDARD                                           
005893     BLOCK CONTAINS 0 RECORDS.                                            
005895 01  CSTM-EXT-EMAIL-RECORD PIC X(80).                                     
005896                                                                          
005897 FD  DECON-INT-EMAIL-FILE                                                 
005898     RECORDING MODE IS F                                                  
005899     LABEL RECORDS ARE STANDARD                                           
005900     BLOCK CONTAINS 0 RECORDS.                                            
005902 01  DECON-INT-EMAIL-RECORD PIC X(80).                                    
005903                                                                          
005904 FD  DECON-EXT-EMAIL-FILE                                                 
005905     RECORDING MODE IS F                                                  
005906     LABEL RECORDS ARE STANDARD                                           
005907     BLOCK CONTAINS 0 RECORDS.                                            
005909 01  DECON-EXT-EMAIL-RECORD PIC X(80).                                    
005910                                                                          
005920******************************************************************        
006000                                                                          
006100                                                                          
006200 WORKING-STORAGE SECTION.                                                 
006300                                                                          
006400                                                                          
006500******************************************************************        
006600*  DB2 FORMATTED MESSAGE AREA                                             
006700******************************************************************        
006800     COPY DPWS004.                                                        
006900                                                                          
007000******************************************************************        
007100*  COMMUNICATIONS AREA FOR DB2                                            
007200******************************************************************        
007300     EXEC SQL                                                             
007400          INCLUDE SQLCA                                                   
007500     END-EXEC.                                                            
007600                                                                          
007610******************************************************************        
007620*  DB2 TABLE DECLARATION -  PURCHASE ORDER TABLE.                         
007630******************************************************************        
007640     EXEC SQL                                                             
007650          INCLUDE TPURCHS                                                 
007660     END-EXEC.                                                            
007670                                                                          
007700******************************************************************        
007800*  DB2 TABLE DECLARATION -  TROUBLE NOTIFICATION TABLE.                   
007900*      (TTRBNTF)                                                          
008000******************************************************************        
008100     EXEC SQL                                                             
008200          INCLUDE TTRBNTF                                                 
008300     END-EXEC.                                                            
008400                                                                          
008500******************************************************************        
008600*  DB2 TABLE DECLARATION -  VENDOR TABLE.                                 
008700*      (TENTNME)                                                          
008800******************************************************************        
008900     EXEC SQL                                                             
009000          INCLUDE TENTNME                                                 
009100     END-EXEC.                                                            
009200                                                                          
009300******************************************************************        
009400*  DB2 TABLE DECLARATION -  PLAN SHIP TABLE.                              
009500*      (TPLNSHP)                                                          
009600******************************************************************        
009700     EXEC SQL                                                             
009800          INCLUDE TPLNSHP                                                 
009900     END-EXEC.                                                            
010000                                                                          
010100******************************************************************        
010200*  DB2 TABLE DECLARATION -  SHIPPED PO.                                   
010300*      (TSHPTPO)                                                          
010400******************************************************************        
010500     EXEC SQL                                                             
010600          INCLUDE TSHPTPO                                                 
010700     END-EXEC.                                                            
010800                                                                          
010900******************************************************************        
011000*  DB2 TABLE DECLARATION -  BOOKING PO.                                   
011100*      (TIMBKPO)                                                          
011200******************************************************************        
011300     EXEC SQL                                                             
011400          INCLUDE TIMBKPO                                                 
011500     END-EXEC.                                                            
011600                                                                          
011700******************************************************************        
011800*  DB2 TABLE DECLARATION -  SHIPMENT                                      
011900*      (TSHIPMT)                                                          
012000******************************************************************        
012100     EXEC SQL                                                             
012200          INCLUDE TSHIPMT                                                 
012300     END-EXEC.                                                            
012400                                                                          
012500******************************************************************        
012600*  DB2 TABLE DECLARATION -  TRIP                                          
012700*      (TVHTRIP)                                                          
012800******************************************************************        
012900     EXEC SQL                                                             
013000          INCLUDE TVHTRIP                                                 
013100     END-EXEC.                                                            
013200                                                                          
013300******************************************************************        
013400*  DB2 TABLE DECLARATION -  VEHICLE                                       
013500*      (TVEHICL)                                                          
013600******************************************************************        
013700     EXEC SQL                                                             
013800          INCLUDE TVEHICL                                                 
013900     END-EXEC.                                                            
014000                                                                          
014100******************************************************************        
014200*  DB2 TABLE DECLARATION -  TROUBLE REASON TABLE.                         
014300*      (TTRBRSN)                                                          
014400******************************************************************        
014500     EXEC SQL                                                             
014600          INCLUDE TTRBRSN                                                 
014700     END-EXEC.                                                            
014800                                                                          
014810******************************************************************        
014820*  DB2 TABLE DECLARATION -  CUSTOMS PO TABLE.                             
014830*      (TTRBRSN)                                                          
014840******************************************************************        
014850     EXEC SQL                                                             
014860          INCLUDE TIMCSPO                                                 
014870     END-EXEC.                                                            
014871                                                                          
014872******************************************************************        
014873*  DB2 TABLE DECLARATION -  CUSTOMS ENTRY TABLE.                          
014874*      (TTRBRSN)                                                          
014875******************************************************************        
014876     EXEC SQL                                                             
014877          INCLUDE TIMCSEN                                                 
014878     END-EXEC.                                                            
014879                                                                          
014880******************************************************************        
014881*  DB2 TABLE DECLARATION                                                  
014882*      (TIMPORL)                                                          
014883******************************************************************        
014884     EXEC SQL                                                             
014885          INCLUDE TIMPORL                                                 
014886     END-EXEC.                                                            
014887                                                                          
014888 EJECT                                                                    
014890                                                                          
014900     COPY TMRD602.                                                        
015000                                                                          
015100     COPY TMRD604.                                                        
015200 EJECT                                                                    
015300                                                                          
015400 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
015500                                                   COMP SYNC.             
015600 01  PA-PROGRAM-ACCUMULATORS.                                             
015700     05  PA-TOTALS.                                                       
015800         10 PA-TOTAL-RECORDS-READ     PIC  S9(09)  VALUE +0               
015900                                                     COMP-3.              
016000         10 PA-INT-FOB-WRITTEN-XCPT   PIC  S9(09)  VALUE +0               
016100                                                     COMP-3.              
016110         10 PA-INT-FOB-WRITTEN-EI     PIC  S9(09)  VALUE +0               
016111                                                     COMP-3.              
016112         10 PA-INT-FOB-WRITTEN-OCS    PIC  S9(09)  VALUE +0               
016113                                                     COMP-3.              
016114         10 PA-INT-FOB-WRITTEN-BC     PIC  S9(09)  VALUE +0               
016115                                                     COMP-3.              
016116         10 PA-EXT-FOB-WRITTEN-EI     PIC  S9(09)  VALUE +0               
016117                                                     COMP-3.              
016118         10 PA-EXT-FOB-WRITTEN-OCS    PIC  S9(09)  VALUE +0               
016119                                                     COMP-3.              
016120         10 PA-EXT-FOB-WRITTEN-BC     PIC  S9(09)  VALUE +0               
016121                                                     COMP-3.              
016124         10 PA-EXT-FOB-WRITTEN        PIC  S9(09)  VALUE +0               
016125                                                     COMP-3.              
016126         10 PA-INT-CSTM-WRITTEN       PIC  S9(09)  VALUE +0               
016130                                                     COMP-3.              
016140         10 PA-EXT-CSTM-WRITTEN       PIC  S9(09)  VALUE +0               
016150                                                     COMP-3.              
016160         10 PA-INT-DCONSLR-WRITTEN    PIC  S9(09)  VALUE +0               
016170                                                     COMP-3.              
016180         10 PA-EXT-DCONSLR-WRITTEN    PIC  S9(09)  VALUE +0               
016190                                                     COMP-3.              
016200 01  PS-PROGRAM-SWITCHES.                                                 
016300     05  PS-END-OF-EXCEPTIONS-SW       PIC  X(01)    VALUE 'N'.           
016400         88  PS-END-OF-EXCEPTIONS                    VALUE 'Y'.           
016500         88  PS-END-OF-EXCEPTIONS-NO                 VALUE 'N'.           
016600     05  PS-TROUBLE-ACTIVE-SW          PIC  X(01)    VALUE 'N'.           
016700         88  PS-TROUBLE-ACTIVE                       VALUE 'Y'.           
016800         88  PS-TROUBLE-NOT-ACTIVE                   VALUE 'N'.           
016900     05  PS-MATCH-SW                   PIC  X(01)    VALUE 'N'.           
017000         88  PS-GOOD-MATCH                           VALUE 'Y'.           
017100         88  PS-BAD-MATCH                            VALUE 'N'.           
017200     05  PS-DATA-SW                    PIC  X(01)    VALUE 'N'.           
017300         88  PS-GOOD-DATA                            VALUE 'Y'.           
017400         88  PS-BAD-DATA                             VALUE 'N'.           
017410                                                                          
017420*----------------------------------------------------------------*        
017430* EMAIL GROUPS AND INTERNAL AND EXTERNAL DESTINATIONS ARE BASED  *        
017431* ON THE FOLLOWING TROUBLE REASON CODES:                         *        
017440*----------------------------------------------------------------*        
017441* TRBL                                                                    
017442* RSN   DESC                     PRCS APPL TRAN                           
017443* ---   ---------------------    ---------------------------              
017444* 700   MISSING BKNG             WITHIN STRT XFACT BOUNDRY                
017445* 701   MISS BKNG W/IN           WITHIN STRT XFACT BOUNDRY                
017446* 702   EARLY BOOKING            BOOKING TRANSMISSION ADDED               
017447* 703   EARLY BOOKING W/IN       BOOKING TRANSMISSION ADDED               
017448* 704   LATE BOOKING             BOOKING TRANSMISSION DELETED             
017449* 705   LATE BOOKING W/IN        BOOKING TRANSMISSION ADDED               
017450* 708   MISSING RCVG             WITHIN LAST XFACT BOUNDRY                
017451* 709   MISS RCVG W/IN           WITHIN LAST XFACT BOUNDRY                
017452* 710   EARLY RECEIVING          RECEIPT TRANSMISSION ADDED               
017453* 711   EARLY RECEIVING W/IN     RECEIPT TRANSMISSION ADDED               
017454* 712   LATE RECEIVING           RECEIPT TRANSMISSION ADDED               
017455* 713   LATE RECEIVING W/IN      RECEIPT TRANSMISSION ADDED               
017456* 714   MISS CONT MANF           WITHIN EST DPRTR DT BOUNDRY              
017457* 715   MISS CONT MANF W/IN      WITHIN EST DPRTR DT BOUNDRY              
017458* 716   MISS CSTMS RLSE          WITHIN POE ARRIVAL BOUNDRY               
017459* 717   MISS CSTMS RLSE W/IN     WITHIN POE ARRIVAL BOUNDRY               
017460* 718   MISS DEVAN DT            WITHIN POE ARRIVAL BOUNDRY               
017461* 719   MISS DEVAN DT W/IN       WITHIN POE ARRIVAL BOUNDRY               
017462* 720   MISS CSTM FLNG           WITHIN POE ARRIVAL BOUNDRY               
017463* 721   MISS CSTM FLNG W/IN      WITHIN POE ARRIVAL BOUNDRY               
017464* 722   MISS CONT PKUP           WITHIN POE ARRIVAL BOUNDRY               
017465* 723   MISS CONT PKUP W/IN      WITHIN POE ARRIVAL BOUNDRY               
017466* 724   LATE CONT PKUP           CONTAINER PICK UP DATE ADD               
017467* 725   LATE CONT PKUP W/IN      CONTAINER PICK UP DATE ADD               
017470*----------------------------------------------------------------*        
017500     05  PS-EMAIL-GROUP                PIC  9(04) VALUE ZERO.             
017600         88  PS-EMAIL-GROUP-FOB                 VALUE 700                 
017601                                                      701                 
017602                                                      702                 
017603                                                      703                 
017604                                                      704                 
017605                                                      705                 
017606                                                      708                 
017607                                                      709                 
017608                                                      710                 
017609                                                      711                 
017610                                                      712                 
017611                                                      713                 
017612                                                      714                 
017613                                                      715.                
017615         88  PS-EMAIL-GROUP-CUSTOMS             VALUE 716                 
017616                                                      717                 
017617                                                      720                 
017618                                                      721.                
017619         88  PS-EMAIL-GROUP-DECON               VALUE 718                 
017620                                                      722                 
017621                                                      723                 
017622                                                      724                 
017623                                                      725.                
017624     05  PS-EMAIL-DEST                 PIC  9(04) VALUE ZERO.             
017625         88  PS-EMAIL-DEST-EXTERNAL             VALUE 700                 
017626                                                      701                 
017631                                                      708                 
017632                                                      709                 
017633                                                      714                 
017634                                                      715                 
017635                                                      716                 
017636                                                      717                 
017637                                                      718                 
017638                                                      720                 
017639                                                      721                 
017640                                                      722                 
017641                                                      723.                
017642         88  PS-EMAIL-DEST-INTERNAL             VALUE 702                 
017643                                                      703                 
017644                                                      704                 
017645                                                      705                 
017646                                                      710                 
017647                                                      711                 
017648                                                      712                 
017649                                                      713                 
017652                                                      724                 
017653                                                      725.                
017800                                                                          
017810     05  PS-ENTID       PIC  9(11) VALUE ZERO.                            
017820         88  PS-ENTID-EXPEDITOR    VALUE 10594.                           
017821         88  PS-ENTID-OCS          VALUE 30692.                           
017822         88  PS-ENTID-MAERSK       VALUE 40425.                           
017823                                                                          
017900 01  PC-PROGRAM-CONSTANTS.                                                
018000     05  PC-DEFAULT-DATE             PIC X(10)                            
018100                                          VALUE '0001-01-01'.             
018200     05  PC-X-01                     PIC X(02)    VALUE '01'.             
018300     05  PC-X-02                     PIC X(02)    VALUE '02'.             
018400     05  PC-X-03                     PIC X(02)    VALUE '03'.             
018500     05  PC-A                        PIC X(01)    VALUE 'A'.              
018510     05  PC-AV                       PIC X(02)    VALUE 'AV'.             
018600     05  PC-D                        PIC X(01)    VALUE 'D'.              
018700     05  PC-E                        PIC X(01)    VALUE 'E'.              
018800     05  PC-R                        PIC X(01)    VALUE 'R'.              
018900     05  PC-T                        PIC X(01)    VALUE 'T'.              
019000     05  PC-SLASH                    PIC X(01)    VALUE '/'.              
019100     05  PC-REASON-NOT-FOUND         PIC X(20)                            
019200                   VALUE 'TRBL REASN NOT FOUND'.                          
019300                                                                          
019400 01  PV-PROGRAM-VARIABLES.                                                
019500       05  PV-CURRENT-PO-NBR            PIC ZZZZZZZZ9.                    
019600       05  PV-CURRENT-CNTRL-NBR         PIC ZZZZZZZZ9.                    
019700       05  PV-ERROR-TEXT                PIC X(30) VALUE SPACES.           
019701       05  PV-AIR-SHIP-CNTR             PIC S9(8) VALUE ZERO              
019710                                                     COMP.                
019800                                                                          
019900 01  PV-MATCH-RECORD.                                                     
020000     05 PV-MATCH-KEY.                                                     
020100        10  PV-KEY-RECORD-TYP      PIC  X(01)  VALUE SPACES.              
020200        10  PV-KEY-PO-NBR          PIC  9(09)  VALUE ZEROES.              
020300        10  PV-KEY-PO-NBR-X REDEFINES                                     
020400            PV-KEY-PO-NBR          PIC  X(09).                            
020500        10  PV-KEY-CNTRL-NBR       PIC  9(09)  VALUE ZEROES.              
020600        10  PV-KEY-CNTRL-NBR-X REDEFINES                                  
020700            PV-KEY-CNTRL-NBR       PIC  X(09).                            
020800        10  PV-KEY-TRBL-RSN-CDE    PIC  9(04)  VALUE ZEROES.              
020900        10  PV-KEY-TRBL-RSN-CDE-X REDEFINES                               
021000            PV-KEY-TRBL-RSN-CDE    PIC  X(04).                            
021100        10  PV-KEY-GROUP-TYP-CDE   PIC  X(02)  VALUE SPACES.              
021200        10  PV-KEY-GROUP-SEQ-NBR   PIC  9(04)  VALUE ZEROES.              
021300        10  PV-KEY-GROUP-SEQ-NBR-X REDEFINES                              
021400            PV-KEY-GROUP-SEQ-NBR   PIC  X(04).                            
021500     05 FILLER                     PIC  X(479) VALUE SPACES.              
021600                                                                          
021700 01  EMPTY-FILE-LINE.                                                     
021800     05  FILLER                     PIC  X(10)   VALUE SPACES.            
021900     05  FILLER                     PIC  X(25)   VALUE                    
022000         '*** NO DATA TO REPORT ***'.                                     
022100     05  FILLER                     PIC  X(45)   VALUE SPACES.            
022200                                                                          
022300 01  FOB-EMAIL-LINE.                                                      
022400     05  FOB-PO-NBR                  PIC  ZZZZZZZZ9.                      
022500     05  FILLER                      PIC  X(01)  VALUE SPACES.            
022600     05  FOB-TROUBLE-TYP             PIC  X(03)  VALUE SPACES.            
022700     05  FILLER                      PIC  X(01)  VALUE SPACES.            
022800     05  FOB-VENDOR                  PIC  X(08)  VALUE SPACES.            
022900     05  FILLER                      PIC  X(02)  VALUE SPACES.            
023000     05  FOB-MAKER                   PIC  X(08)  VALUE SPACES.            
023100     05  FILLER                      PIC  X(01)  VALUE SPACES.            
023200     05  FOB-FOB-CDE                 PIC  X(03)  VALUE SPACES.            
023300     05  FILLER                      PIC  X(01)  VALUE SPACES.            
023400     05  FOB-STRT-FCTRY-DTE.                                              
023500          10  FOB-STRT-FCTRY-MM      PIC  X(02)  VALUE SPACES.            
023600          10  FOB-STRT-FCTRY-SLASH   PIC  X(01)  VALUE SPACES.            
023700          10  FOB-STRT-FCTRY-DD      PIC  X(02)  VALUE SPACES.            
023800     05  FILLER                      PIC  X(02)  VALUE SPACES.            
023900     05  FOB-LAST-FCTRY-DTE.                                              
024000          10  FOB-LAST-FCTRY-MM      PIC  X(02)  VALUE SPACES.            
024100          10  FOB-LAST-FCTRY-SLASH   PIC  X(01)  VALUE SPACES.            
024200          10  FOB-LAST-FCTRY-DD      PIC  X(02)  VALUE SPACES.            
024300     05  FILLER                      PIC  X(02)  VALUE SPACES.            
024400     05  FOB-EXP-DELV-DATE.                                               
024500          10  FOB-EXP-DELV-MM        PIC  X(02)  VALUE SPACES.            
024600          10  FOB-EXP-DELV-SLASH     PIC  X(01)  VALUE SPACES.            
024700          10  FOB-EXP-DELV-DD        PIC  X(02)  VALUE SPACES.            
024800     05  FILLER                      PIC  X(02)  VALUE SPACES.            
024900     05  FOB-TRBL-SHORT-DESC         PIC  X(10)  VALUE SPACES.            
025000     05  FILLER                      PIC  X(13)  VALUE SPACES.            
025010                                                                          
025020 01  CSTM-EMAIL-LINE.                                                     
025030     05  CSTM-PO-NBR                 PIC  ZZZZZZZZ9.                      
025031     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025032     05  CSTM-TROUBLE-TYP            PIC  X(03)  VALUE SPACES.            
025033     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025034     05  CSTM-POE-CDE                PIC  X(03)  VALUE SPACES.            
025035     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025036     05  CSTM-CSTM-ENTR-ID           PIC  X(12)  VALUE SPACES.            
025037     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025038     05  CSTM-CONTNR-ID              PIC  X(12)  VALUE SPACES.            
025039     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025040     05  CSTM-MOM-POE-DELY-DTE.                                           
025041          10  CSTM-MOM-POE-DELY-MM   PIC  X(02)  VALUE SPACES.            
025042          10  CSTM-MOM-POE-DELY-SLASH PIC  X(01)  VALUE SPACES.           
025043          10  CSTM-MOM-POE-DELY-DD   PIC  X(02)  VALUE SPACES.            
025044     05  FILLER                      PIC  X(03)  VALUE SPACES.            
025045     05  CSTM-CSTM-FILD-DTE.                                              
025046          10  CSTM-CSTM-FILD-MM      PIC  X(02)  VALUE SPACES.            
025047          10  CSTM-CSTM-FILD-SLASH   PIC  X(01)  VALUE SPACES.            
025048          10  CSTM-CSTM-FILD-DD      PIC  X(02)  VALUE SPACES.            
025049     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025050     05  CSTM-TRBL-SHORT-DESC        PIC  X(10)  VALUE SPACES.            
025051     05  FILLER                      PIC  X(20)  VALUE SPACES.            
025053                                                                          
025054 01  DCONSLR-EMAIL-LINE.                                                  
025055     05  DCONSLR-PO-NBR              PIC  ZZZZZZZZ9.                      
025056     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025057     05  DCONSLR-TROUBLE-TYP         PIC  X(03)  VALUE SPACES.            
025058     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025059     05  DCONSLR-POE-CDE             PIC  X(03)  VALUE SPACES.            
025060     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025061     05  DCONSLR-CONTNR-ID           PIC  X(12)  VALUE SPACES.            
025062     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025063     05  DCONSLR-MOM-POE-DELY-DTE.                                        
025064          10  DCONSLR-MOM-POE-DELY-MM PIC X(02)  VALUE SPACES.            
025065          10  DCONSLR-MOM-POE-DELY-SLASH PIC X(01) VALUE SPACES.          
025066          10  DCONSLR-MOM-POE-DELY-DD PIC X(02)  VALUE SPACES.            
025067     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025068     05  DCONSLR-CSTM-ACTL-CLR-DTE.                                       
025069          10  DCONSLR-CSTM-ACTL-CLR-MM PIC X(02) VALUE SPACES.            
025070          10  DCONSLR-CSTM-ACTL-CLR-SLASH PIC X(01) VALUE SPACES.         
025071          10  DCONSLR-CSTM-ACTL-CLR-DD PIC X(02) VALUE SPACES.            
025072     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025073     05  DCONSLR-CONTNR-PKUP-DTE.                                         
025074          10  DCONSLR-CONTNR-PKUP-MM PIC X(02) VALUE SPACES.              
025075          10  DCONSLR-CONTNR-PKUP-SLASH PIC X(01) VALUE SPACES.           
025076          10  DCONSLR-CONTNR-PKUP-DD PIC X(02) VALUE SPACES.              
025077     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025078     05  DCONSLR-DONT-SHIP-BEF-DTE.                                       
025079          10  DCONSLR-DONT-SHIP-BEF-MM PIC X(02) VALUE SPACES.            
025080          10  DCONSLR-DONT-SHIP-BEF-SLASH PIC X(01) VALUE SPACES.         
025081          10  DCONSLR-DONT-SHIP-BEF-DD PIC X(02) VALUE SPACES.            
025082     05  FILLER                      PIC  X(01)  VALUE SPACES.            
025083     05  DCONSLR-SPLIT-DTE.                                               
025084          10  DCONSLR-SPLIT-MM       PIC  X(02)  VALUE SPACES.            
025085          10  DCONSLR-SPLIT-SLASH    PIC  X(01)  VALUE SPACES.            
025086          10  DCONSLR-SPLIT-DD       PIC  X(02)  VALUE SPACES.            
025087     05  FILLER                      PIC  X(02)  VALUE SPACES.            
025088     05  DCONSLR-TRBL-SHORT-DESC     PIC  X(10)  VALUE SPACES.            
025089     05  FILLER                      PIC  X(13)  VALUE SPACES.            
025092                                                                          
025093 EJECT                                                                    
025100                                                                          
025200 PROCEDURE DIVISION.                                                      
025300                                                                          
025400******************************************************************        
025500*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *        
025600******************************************************************        
025700                                                                          
025800 0000-PROGRAM-MAINLINE.                                                   
025900                                                                          
026000     PERFORM 1000-INITIALIZE.                                             
026100                                                                          
026200     PERFORM 6000-READ-EXCEPTIONS.                                        
026300                                                                          
026400     IF NOT   PS-END-OF-EXCEPTIONS                                        
026500       PERFORM 2000-PROCESS-EXCEPTIONS                                    
026600         UNTIL PS-END-OF-EXCEPTIONS                                       
026700     END-IF.                                                              
026800                                                                          
026900     PERFORM 8000-EOJ-ROUTINE.                                            
027000                                                                          
027100     STOP RUN.                                                            
027200                                                                          
027300******************************************************************        
027400                                                                          
027500 1000-INITIALIZE.                                                         
027600                                                                          
027700     OPEN INPUT  EXCEPTION-FILE                                           
027800          OUTPUT FOB-INT-EI-EMAIL-FILE                                    
027810                 FOB-EXT-EI-EMAIL-FILE                                    
027811                 FOB-INT-OCS-EMAIL-FILE                                   
027812                 FOB-EXT-OCS-EMAIL-FILE                                   
027813                 FOB-INT-BC-EMAIL-FILE                                    
027814                 FOB-EXT-BC-EMAIL-FILE                                    
027815                 FOB-INT-XCPT-EMAIL-FILE                                  
027820                 CSTM-INT-EMAIL-FILE                                      
027830                 CSTM-EXT-EMAIL-FILE                                      
027840                 DECON-INT-EMAIL-FILE                                     
027850                 DECON-EXT-EMAIL-FILE.                                    
027851                                                                          
027860      INITIALIZE   PV-MATCH-RECORD                                        
027870                   TM602-RECORD                                           
027880                   TM604-RECORD                                           
027890                   DCLTPURCHS                                             
027891                   DCLTTRBNTF                                             
027892                   DCLTENTNME                                             
027893                   DCLTPLNSHP                                             
027894                   DCLTIMBKPO                                             
027895                   DCLTSHIPMT                                             
027896                   DCLTVHTRIP                                             
027897                   DCLTVEHICL                                             
027898                   DCLTTRBRSN                                             
027899                   DCLTIMCSPO                                             
027900                   DCLTIMCSEN.                                            
028000                                                                          
028600 EJECT                                                                    
028700                                                                          
028800******************************************************************        
028900* ONLY PROCESS MATCHING '01' AND '03' RECORDS.  IF '03', TRY TO           
029000* MATCH IT TO THE '01' RECORD HELD IN TM602-RECORD COPYBOOK.              
029100******************************************************************        
029200                                                                          
029300 2000-PROCESS-EXCEPTIONS.                                                 
029400                                                                          
029500      SET PS-BAD-MATCH    TO TRUE.                                        
029600      SET PS-BAD-DATA     TO TRUE.                                        
029696                                                                          
029700                                                                          
029800      EVALUATE EX-GROUP-TYP-CDE                                           
029900         WHEN PC-X-01                                                     
030000           MOVE EXCEPTION-RECORD TO PV-MATCH-RECORD                       
030100                                    TM602-RECORD                          
030200           MOVE PC-X-03          TO PV-KEY-GROUP-TYP-CDE                  
030300         WHEN PC-X-03                                                     
030400           MOVE EXCEPTION-RECORD TO TM604-RECORD                          
030500           MOVE TM604-PO-NBR     TO PV-CURRENT-PO-NBR                     
030600           MOVE TM604-CNTRL-NBR  TO PV-CURRENT-CNTRL-NBR                  
030700           PERFORM 3000-MATCH-RECORDS                                     
030800      END-EVALUATE.                                                       
030900                                                                          
031000      IF PS-GOOD-MATCH                                                    
031100         PERFORM 4000-VALIDATE-DATA                                       
031200         IF PS-GOOD-DATA                                                  
031300           PERFORM 5000-CREATE-EMAIL                                      
031400         END-IF                                                           
031500      END-IF.                                                             
031600                                                                          
031700                                                                          
031800      PERFORM 6000-READ-EXCEPTIONS.                                       
031900                                                                          
032000 EJECT                                                                    
032100                                                                          
032200******************************************************************        
032300* YOU JUST READ AN '03' RECORD.  IF IT MATCHES THE '01' YOU ARE  *        
032400* HOLDING AND THE TROUBLE IS UNRESOLVED, SET A SWITCH TO SAY WE *         
032500* HAVE A GOOD MATCH.                                             *        
032600******************************************************************        
032700                                                                          
032800 3000-MATCH-RECORDS.                                                      
032900                                                                          
033000     IF TM604-RPT-PAR-1-ODR-KEY = PV-MATCH-KEY                            
033100       AND TM604-TRBL-ACTION-CDE = PC-T                                   
033200        MOVE TM604-NOTIF-NBR   TO TRBNTF-NOTIF-NBR                        
033300        PERFORM 3100-SELECT-TTRBNTF                                       
033400        IF PS-TROUBLE-ACTIVE                                              
033500          SET PS-GOOD-MATCH TO TRUE                                       
033600        END-IF                                                            
033700     END-IF.                                                              
033800                                                                          
033900******************************************************************        
034000* MAKE SURE THE TROUBLE IS STILL ACTIVE - NOT RESOLVED.          *        
034100******************************************************************        
034200                                                                          
034300 3100-SELECT-TTRBNTF.                                                     
034400                                                                          
034500       EXEC SQL                                                           
034600          SELECT A.RESOLVED_IND                                           
034700                ,A.ENT_ID                                                 
034800                ,B.NOTIF_IND                                              
034900            INTO :TRBNTF-RESOLVED-IND                                     
035000                ,:TRBNTF-ENT-ID                                           
035100                ,:TRBRSN-NOTIF-IND                                        
035200            FROM TTRBNTF A                                                
035300                ,TTRBRSN B                                                
035400           WHERE NOTIF_NBR =  :TRBNTF-NOTIF-NBR                           
035500           AND   A.TRBL_RSN_CDE = B.TRBL_RSN_CDE                          
035600       END-EXEC                                                           
035700                                                                          
035800       EVALUATE TRUE                                                      
035900         WHEN SQLCODE = ZERO                                              
036000           IF TRBNTF-RESOLVED-IND = 'N'                                   
036100            OR TRBRSN-NOTIF-IND = 'N'                                     
036200             SET PS-TROUBLE-ACTIVE     TO TRUE                            
036300           ELSE                                                           
036400             SET PS-TROUBLE-NOT-ACTIVE TO TRUE                            
036500           END-IF                                                         
036600         WHEN SQLCODE = +100                                              
036700           SET PS-TROUBLE-NOT-ACTIVE   TO TRUE                            
036800         WHEN SQLWARN0 NOT EQUAL SPACE                                    
036900           MOVE 'SEVERE SQL ERROR - TTRBNTF    '                          
037000                                      TO PV-ERROR-TEXT                    
037100           PERFORM 9100-SQL-ABEND                                         
037200       END-EVALUATE.                                                      
037300                                                                          
037400 EJECT                                                                    
037500                                                                          
037600******************************************************************        
037700* THE '01' AND '03' RECORDS MATCH FOR AN UNRESOLVED TROUBLE. NOW *        
037800* DETERMINE IF THIS TROUBLE SHOULD APPEAR ON EMAIL OR NOT.       *        
037900******************************************************************        
038000                                                                          
038100 4000-VALIDATE-DATA.                                                      
038200                                                                          
038310      INITIALIZE PV-AIR-SHIP-CNTR.                                        
038320      MOVE TM604-PO-NBR TO SHPTPO-PO-NBR.                                 
038400      PERFORM 4100-CHECK-IF-AIR.                                          
038501      IF PV-AIR-SHIP-CNTR = ZERO                                          
038700        SET PS-GOOD-DATA  TO TRUE                                         
038810      ELSE                                                                
038820        SET PS-BAD-DATA  TO TRUE                                          
038830      END-IF.                                                             
038900                                                                          
039000******************************************************************        
039100* EXCLUDE AIR SHIPMENTS FROM E-MAIL                              *        
039200******************************************************************        
039300                                                                          
039400 4100-CHECK-IF-AIR.                                                       
039500                                                                          
039600       EXEC SQL                                                           
039700           SELECT COUNT(*)                                                
039710           INTO :PV-AIR-SHIP-CNTR                                         
039800           FROM  TSHPTPO A                                                
039900                ,TSHIPMT B                                                
040000                ,TVHTRIP C                                                
040100                ,TVEHICL D                                                
040200           WHERE A.SHIPT_ID         = B.SHIPT_ID                          
040300           AND   B.TRIP_ID          = C.TRIP_ID                           
040400           AND   C.OWNER_SCAC_ID    = D.OWNER_SCAC_ID                     
040500           AND   C.VEH_NBR          = D.VEH_NBR                           
040600           AND   D.VEH_TYP_CDE      = :PC-AV                              
040700           AND   A.PO_NBR           = :SHPTPO-PO-NBR                      
040800       END-EXEC                                                           
040900                                                                          
041000       EVALUATE TRUE                                                      
041100         WHEN SQLCODE = ZERO                                              
041200           CONTINUE                                                       
041300         WHEN SQLCODE = +100                                              
041400           CONTINUE                                                       
041500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
041600           MOVE 'SEVERE SQL ERROR - CHECK AIR  '                          
041700                                      TO PV-ERROR-TEXT                    
041800           PERFORM 9100-SQL-ABEND                                         
041900       END-EVALUATE.                                                      
042000                                                                          
042100 EJECT                                                                    
042200                                                                          
042300******************************************************************        
042400* FORMAT AND PRINT AN EMAIL RECORD                               *        
042500******************************************************************        
042600                                                                          
042700 5000-CREATE-EMAIL.                                                       
042800                                                                          
042810      INITIALIZE FOB-EMAIL-LINE                                           
042820                 CSTM-EMAIL-LINE                                          
042830                 DCONSLR-EMAIL-LINE.                                      
042840                                                                          
042900      MOVE TM602-PO-NBR            TO  FOB-PO-NBR                         
042901                                       CSTM-PO-NBR                        
042902                                       DCONSLR-PO-NBR.                    
042910                                                                          
042920      IF TRBRSN-NOTIF-IND = 'T'                                           
042930         MOVE 'TRB' TO FOB-TROUBLE-TYP                                    
042931                       CSTM-TROUBLE-TYP                                   
042932                       DCONSLR-TROUBLE-TYP                                
042940      ELSE                                                                
042950         MOVE 'NTF' TO FOB-TROUBLE-TYP                                    
042951                       CSTM-TROUBLE-TYP                                   
042952                       DCONSLR-TROUBLE-TYP                                
042960      END-IF.                                                             
042970                                                                          
042980      MOVE TM602-TRBL-RSN-CDE         TO TRBRSN-TRBL-RSN-CDE.             
042990      PERFORM 7100-SELECT-TTRBRSN.                                        
042991      MOVE TRBRSN-TRBL-SHT-DESC (1:10) TO FOB-TRBL-SHORT-DESC             
042992                                          CSTM-TRBL-SHORT-DESC            
042993                                          DCONSLR-TRBL-SHORT-DESC.        
043000                                                                          
043010      MOVE TM602-TRBL-RSN-CDE         TO PS-EMAIL-GROUP                   
043011                                         PS-EMAIL-DEST.                   
043020                                                                          
043030      EVALUATE TRUE                                                       
043040                                                                          
043050       WHEN PS-EMAIL-GROUP-FOB                                            
043060         PERFORM 5100-CREATE-FOB-EMAIL                                    
043100                                                                          
043101       WHEN PS-EMAIL-GROUP-CUSTOMS                                        
043102         PERFORM 5200-CREATE-CUSTOMS-EMAIL                                
043103                                                                          
043104       WHEN PS-EMAIL-GROUP-DECON                                          
043105         PERFORM 5300-CREATE-DECON-EMAIL                                  
043106                                                                          
043107      END-EVALUATE.                                                       
043108                                                                          
043122                                                                          
043123*-----------------------------------------------------------------        
043124 5100-CREATE-FOB-EMAIL.                                                   
043125                                                                          
043130      MOVE TM602-FOB-CDE            TO FOB-FOB-CDE.                       
043140                                                                          
043200      PERFORM 7000-GET-VENDOR-SHORT-NAME.                                 
043300      IF  SQLCODE = +100                                                  
043400          PERFORM 7005-GET-VENDOR-PRIMARY-NAME                            
043500      END-IF.                                                             
043600      MOVE ENTNME-ENT-NAME-DESC TO FOB-VENDOR.                            
044300                                                                          
044400      MOVE TM602-PO-NBR             TO PLNSHP-PO-NBR.                     
044500      MOVE TM602-PLNSHP-VER-NBR     TO PLNSHP-VER-NBR.                    
044600      PERFORM 7010-SELECT-PLNSHP.                                         
044700                                                                          
044800      MOVE PLNSHP-LAST-FCTRY-DTE(6:2)  TO FOB-LAST-FCTRY-MM.              
044810      IF FOB-LAST-FCTRY-MM = SPACE                                        
044900        MOVE SPACE                     TO FOB-LAST-FCTRY-SLASH            
044910      ELSE                                                                
044920        MOVE PC-SLASH                  TO FOB-LAST-FCTRY-SLASH            
044930      END-IF.                                                             
045000      MOVE PLNSHP-LAST-FCTRY-DTE(9:2)  TO FOB-LAST-FCTRY-DD.              
045100                                                                          
045200      MOVE PLNSHP-STRT-FCTRY-DTE (6:2) TO FOB-STRT-FCTRY-MM.              
045210      IF FOB-STRT-FCTRY-MM = SPACES                                       
045220        MOVE SPACE                     TO FOB-STRT-FCTRY-SLASH            
045230      ELSE                                                                
045240        MOVE PC-SLASH                  TO FOB-STRT-FCTRY-SLASH            
045250      END-IF.                                                             
045400      MOVE PLNSHP-STRT-FCTRY-DTE (9:2) TO FOB-STRT-FCTRY-DD.              
045500                                                                          
045600      EVALUATE TRUE                                                       
045601                                                                          
045602       WHEN TM602-TRBL-RSN-CDE = 708 OR 709                               
045610        MOVE TM604-PO-NBR TO IMBKPO-PO-NBR                                
045700        PERFORM 7200-GET-BOOKING-DATE                                     
045800        IF SQLCODE = ZERO                                                 
045900          MOVE IMBKPO-PO-BKG-DELY-TMST (6:2) TO FOB-EXP-DELV-MM           
045910          IF FOB-EXP-DELV-MM = SPACE                                      
045920            MOVE SPACE                 TO FOB-EXP-DELV-SLASH              
045930          ELSE                                                            
045940            MOVE PC-SLASH              TO FOB-EXP-DELV-SLASH              
045950          END-IF                                                          
046100          MOVE IMBKPO-PO-BKG-DELY-TMST (9:2) TO FOB-EXP-DELV-DD           
046200        END-IF                                                            
046201                                                                          
046210       WHEN TM602-TRBL-RSN-CDE = 702 OR 703 OR 704 OR 705                 
046220          MOVE TM602-PO-BKG-DELY-DTE    (6:2) TO FOB-EXP-DELV-MM          
046221          IF FOB-EXP-DELV-MM = SPACES                                     
046222            MOVE SPACE                 TO FOB-EXP-DELV-SLASH              
046223          ELSE                                                            
046224            MOVE PC-SLASH              TO FOB-EXP-DELV-SLASH              
046225          END-IF                                                          
046226          MOVE IMBKPO-PO-BKG-DELY-TMST (9:2) TO FOB-EXP-DELV-DD           
046228          MOVE TM602-PO-BKG-DELY-DTE    (9:2) TO FOB-EXP-DELV-DD          
046230                                                                          
046240       WHEN TM602-TRBL-RSN-CDE = 710 OR 711 OR 712 OR 713                 
046250          MOVE TM602-PO-RCVD-DELY-DTE   (6:2) TO FOB-EXP-DELV-MM          
046251          IF FOB-EXP-DELV-MM = SPACES                                     
046252            MOVE SPACE                 TO FOB-EXP-DELV-SLASH              
046253          ELSE                                                            
046254            MOVE PC-SLASH              TO FOB-EXP-DELV-SLASH              
046255          END-IF                                                          
046270          MOVE TM602-PO-RCVD-DELY-DTE   (9:2) TO FOB-EXP-DELV-DD          
046280                                                                          
046300      END-EVALUATE.                                                       
046800                                                                          
            INITIALIZE ENTNME-ENT-NAME-DESC.                                    
046811      MOVE TM604-PO-NBR TO PURCHS-PO-NBR.                                 
046820      PERFORM 7300-GET-MAKER.                                             
            MOVE ENTNME-ENT-NAME-DESC (1:8)  TO FOB-MAKER.                      
046840                                                                          
046850                                                                          
046851      MOVE TM602-CONSLR-ENT-ID    TO PS-ENTID.                            
046852                                                                          
046860      EVALUATE TRUE                                                       
046870                                                                          
046871        WHEN PS-ENTID-EXPEDITOR                                           
046872                                                                          
046880         IF PS-EMAIL-DEST-INTERNAL                                        
046881          MOVE FOB-EMAIL-LINE  TO FOB-INT-EI-EMAIL-RECORD                 
046890          PERFORM 6100-WRITE-FOB-INTERNAL-EI                              
046891         END-IF                                                           
046892                                                                          
046893         IF PS-EMAIL-DEST-EXTERNAL                                        
046894          MOVE FOB-EMAIL-LINE  TO FOB-EXT-EI-EMAIL-RECORD                 
046895          PERFORM 6110-WRITE-FOB-EXTERNAL-EI                              
046896         END-IF                                                           
046897                                                                          
046898        WHEN PS-ENTID-OCS                                                 
046899                                                                          
046900         IF PS-EMAIL-DEST-INTERNAL                                        
046910          MOVE FOB-EMAIL-LINE  TO FOB-INT-OCS-EMAIL-RECORD                
046920          PERFORM 6120-WRITE-FOB-INTERNAL-OCS                             
046930         END-IF                                                           
046940                                                                          
046950         IF PS-EMAIL-DEST-EXTERNAL                                        
046960          MOVE FOB-EMAIL-LINE  TO FOB-EXT-OCS-EMAIL-RECORD                
046970          PERFORM 6130-WRITE-FOB-EXTERNAL-OCS                             
046980         END-IF                                                           
046990                                                                          
046991        WHEN PS-ENTID-MAERSK                                              
046992                                                                          
046993         IF PS-EMAIL-DEST-INTERNAL                                        
046994          MOVE FOB-EMAIL-LINE  TO FOB-INT-BC-EMAIL-RECORD                 
046995          PERFORM 6140-WRITE-FOB-INTERNAL-BC                              
046996         END-IF                                                           
046997                                                                          
046998         IF PS-EMAIL-DEST-EXTERNAL                                        
046999          MOVE FOB-EMAIL-LINE  TO FOB-EXT-BC-EMAIL-RECORD                 
047000          PERFORM 6150-WRITE-FOB-EXTERNAL-BC                              
047001         END-IF                                                           
047002                                                                          
047003        WHEN OTHER                                                        
047004                                                                          
047006         MOVE FOB-EMAIL-LINE  TO FOB-INT-XCPT-EMAIL-RECORD                
047007         PERFORM 6160-WRITE-FOB-INTERNAL-XCPT                             
047014                                                                          
047020      END-EVALUATE.                                                       
047100                                                                          
047200 EJECT                                                                    
047300*-----------------------------------------------------------------        
047400 5200-CREATE-CUSTOMS-EMAIL.                                               
047700                                                                          
047701      MOVE TM602-POE-CDE             TO CSTM-POE-CDE.                     
052402      MOVE TM602-CONTNR-ID           TO CSTM-CONTNR-ID.                   
052403                                                                          
052404      INITIALIZE DCLTIMCSPO                                               
052405                 DCLTIMCSEN.                                              
052406      MOVE TM602-PO-NBR              TO IMCSPO-PO-NBR.                    
052407      PERFORM 7400-SELECT-TIMCSEN.                                        
052408      MOVE IMCSEN-CSTM-ENTR-ID       TO CSTM-CSTM-ENTR-ID.                
052409                                                                          
052410      MOVE TM602-MOM-POE-DELY-DTE(6:2) TO CSTM-MOM-POE-DELY-MM.           
052411      IF CSTM-MOM-POE-DELY-MM = SPACES                                    
052412        MOVE SPACE                  TO CSTM-MOM-POE-DELY-SLASH            
052413      ELSE                                                                
052414        MOVE PC-SLASH               TO CSTM-MOM-POE-DELY-SLASH            
052415      END-IF.                                                             
052417      MOVE TM602-MOM-POE-DELY-DTE(9:2) TO CSTM-MOM-POE-DELY-DD.           
052418                                                                          
052419      MOVE IMCSEN-FILD-TMST(6:2)    TO CSTM-CSTM-FILD-MM.                 
052420      IF CSTM-CSTM-FILD-MM = SPACES                                       
052421        MOVE SPACE                  TO CSTM-CSTM-FILD-SLASH               
052422      ELSE                                                                
052423        MOVE PC-SLASH               TO CSTM-CSTM-FILD-SLASH               
052424      END-IF.                                                             
052426      MOVE IMCSEN-FILD-TMST(9:2)    TO CSTM-CSTM-FILD-DD.                 
052427                                                                          
052428      IF CSTM-CSTM-FILD-DTE = '01/01' OR '  /  '                          
052429         MOVE SPACES TO CSTM-CSTM-FILD-DTE                                
052430      END-IF.                                                             
052431                                                                          
052432      EVALUATE TRUE                                                       
052433                                                                          
052434       WHEN PS-EMAIL-DEST-INTERNAL                                        
052435        MOVE CSTM-EMAIL-LINE         TO CSTM-INT-EMAIL-RECORD             
052436        PERFORM 6520-WRITE-CSTM-INTERNAL                                  
052437                                                                          
052438       WHEN PS-EMAIL-DEST-EXTERNAL                                        
052439        MOVE CSTM-EMAIL-LINE         TO CSTM-EXT-EMAIL-RECORD             
052440        PERFORM 6530-WRITE-CSTM-EXTERNAL                                  
052441                                                                          
052442      END-EVALUATE.                                                       
052443                                                                          
052444 EJECT                                                                    
052445*-----------------------------------------------------------------        
052446 5300-CREATE-DECON-EMAIL.                                                 
052447                                                                          
052448      MOVE TM602-POE-CDE             TO DCONSLR-POE-CDE.                  
052449      MOVE TM602-CONTNR-ID           TO DCONSLR-CONTNR-ID.                
052450                                                                          
052451      INITIALIZE  DCLTIMCSPO                                              
052452                 DCLTIMCSEN.                                              
052453      MOVE TM602-PO-NBR              TO IMCSPO-PO-NBR.                    
052454      PERFORM 7400-SELECT-TIMCSEN.                                        
052455                                                                          
052456      MOVE TM602-MOM-POE-DELY-DTE(6:2) TO DCONSLR-MOM-POE-DELY-MM.        
052457      IF DCONSLR-MOM-POE-DELY-MM = SPACES                                 
052458        MOVE SPACE                  TO DCONSLR-MOM-POE-DELY-SLASH         
052459      ELSE                                                                
052460        MOVE PC-SLASH               TO DCONSLR-MOM-POE-DELY-SLASH         
052461      END-IF.                                                             
052462      MOVE TM602-MOM-POE-DELY-DTE(9:2) TO DCONSLR-MOM-POE-DELY-DD.        
052464                                                                          
052465      MOVE IMCSEN-ACTL-CLR-TMST(6:2)                                      
052466                                TO DCONSLR-CSTM-ACTL-CLR-MM.              
052467      IF DCONSLR-CSTM-ACTL-CLR-MM = SPACES                                
052468        MOVE SPACE             TO DCONSLR-CSTM-ACTL-CLR-SLASH             
052469      ELSE                                                                
052470        MOVE PC-SLASH          TO DCONSLR-CSTM-ACTL-CLR-SLASH             
052471      END-IF.                                                             
052473      MOVE IMCSEN-ACTL-CLR-TMST(9:2)                                      
052474                                TO DCONSLR-CSTM-ACTL-CLR-DD.              
052475                                                                          
052476      IF DCONSLR-CSTM-ACTL-CLR-DTE = '01/01' OR '  /  '                   
052477         MOVE SPACES TO DCONSLR-CSTM-ACTL-CLR-DTE                         
052478      END-IF.                                                             
052479                                                                          
052480      MOVE TM602-CONTNR-PKUP-DTE(6:2)                                     
052481                                TO DCONSLR-CONTNR-PKUP-MM.                
052482      IF DCONSLR-CONTNR-PKUP-MM = SPACES                                  
052483        MOVE SPACE              TO DCONSLR-CONTNR-PKUP-SLASH              
052484      ELSE                                                                
052485        MOVE PC-SLASH           TO DCONSLR-CONTNR-PKUP-SLASH              
052486      END-IF.                                                             
052488      MOVE TM602-CONTNR-PKUP-DTE(9:2)                                     
052489                                TO DCONSLR-CONTNR-PKUP-DD.                
052490                                                                          
052491      IF DCONSLR-CONTNR-PKUP-DTE = '01/01' OR '  /  '                     
052492         MOVE SPACES TO DCONSLR-CONTNR-PKUP-DTE                           
052493      END-IF.                                                             
052494                                                                          
052495      MOVE TM602-PO-NBR             TO PLNSHP-PO-NBR.                     
052496      MOVE TM602-PLNSHP-VER-NBR     TO PLNSHP-VER-NBR.                    
052497      PERFORM 7010-SELECT-PLNSHP.                                         
052498                                                                          
052499      MOVE PLNSHP-DONT-SHIP-BEF-DTE(6:2)                                  
052500                                TO DCONSLR-DONT-SHIP-BEF-MM.              
052501      IF DCONSLR-DONT-SHIP-BEF-MM = SPACES                                
052502        MOVE SPACE              TO DCONSLR-DONT-SHIP-BEF-SLASH            
052503      ELSE                                                                
052504        MOVE PC-SLASH           TO DCONSLR-DONT-SHIP-BEF-SLASH            
052505      END-IF.                                                             
052507      MOVE PLNSHP-DONT-SHIP-BEF-DTE(9:2)                                  
052508                                TO DCONSLR-DONT-SHIP-BEF-DD.              
052509                                                                          
052510      MOVE TM602-PO-NBR              TO IMPORL-PO-NBR.                    
052511      PERFORM 7500-SELECT-TIMPORL.                                        
052512                                                                          
052513      MOVE IMPORL-DCONSLR-ACTL-DTE(6:2) TO DCONSLR-SPLIT-MM.              
052514      IF DCONSLR-SPLIT-MM = SPACES                                        
052515        MOVE SPACE                  TO DCONSLR-SPLIT-SLASH                
052516      ELSE                                                                
052517        MOVE PC-SLASH               TO DCONSLR-SPLIT-SLASH                
052518      END-IF.                                                             
052520      MOVE IMPORL-DCONSLR-ACTL-DTE(9:2) TO DCONSLR-SPLIT-DD.              
052521                                                                          
052522      EVALUATE TRUE                                                       
052523                                                                          
052524       WHEN PS-EMAIL-DEST-INTERNAL                                        
052525        MOVE DCONSLR-EMAIL-LINE      TO DECON-INT-EMAIL-RECORD            
052526        PERFORM 6540-WRITE-DECON-INTERNAL                                 
052527                                                                          
052528       WHEN PS-EMAIL-DEST-EXTERNAL                                        
052529        MOVE DCONSLR-EMAIL-LINE      TO DECON-EXT-EMAIL-RECORD            
052530        PERFORM 6550-WRITE-DECON-EXTERNAL                                 
052531                                                                          
052532      END-EVALUATE.                                                       
052533                                                                          
052534 EJECT                                                                    
052535******************************************************************        
052540                                                                          
052600 6000-READ-EXCEPTIONS.                                                    
052800                                                                          
052900      READ EXCEPTION-FILE                                                 
053000          AT END                                                          
053100          SET PS-END-OF-EXCEPTIONS            TO TRUE.                    
053200                                                                          
053300      IF PS-END-OF-EXCEPTIONS                                             
053400        CONTINUE                                                          
053500      ELSE                                                                
053600        ADD +1             TO PA-TOTAL-RECORDS-READ.                      
053700                                                                          
053800*-----------------------------------------------------------------        
053900                                                                          
054000 6100-WRITE-FOB-INTERNAL-EI.                                              
054200                                                                          
054300      WRITE FOB-INT-EI-EMAIL-RECORD                                       
054400      ADD +1               TO PA-INT-FOB-WRITTEN-EI.                      
054500                                                                          
054701*-----------------------------------------------------------------        
054702                                                                          
054703 6110-WRITE-FOB-EXTERNAL-EI.                                              
054705                                                                          
054706      WRITE FOB-EXT-EI-EMAIL-RECORD.                                      
054707      ADD +1               TO PA-EXT-FOB-WRITTEN-EI.                      
054708                                                                          
054720*-----------------------------------------------------------------        
054721 6120-WRITE-FOB-INTERNAL-OCS.                                             
054722                                                                          
054723      WRITE FOB-INT-OCS-EMAIL-RECORD                                      
054724      ADD +1               TO PA-INT-FOB-WRITTEN-OCS.                     
054725                                                                          
054726*-----------------------------------------------------------------        
054727                                                                          
054728 6130-WRITE-FOB-EXTERNAL-OCS.                                             
054729                                                                          
054730      WRITE FOB-EXT-OCS-EMAIL-RECORD.                                     
054731      ADD +1               TO PA-EXT-FOB-WRITTEN-OCS.                     
054732                                                                          
054733*-----------------------------------------------------------------        
054734                                                                          
054735 6140-WRITE-FOB-INTERNAL-BC.                                              
054736                                                                          
054737      WRITE FOB-INT-BC-EMAIL-RECORD                                       
054738      ADD +1               TO PA-INT-FOB-WRITTEN-BC.                      
054739                                                                          
054740*-----------------------------------------------------------------        
054741                                                                          
054742 6150-WRITE-FOB-EXTERNAL-BC.                                              
054743                                                                          
054744      WRITE FOB-EXT-BC-EMAIL-RECORD.                                      
054745      ADD +1               TO PA-EXT-FOB-WRITTEN-BC.                      
054746                                                                          
054747*-----------------------------------------------------------------        
054748                                                                          
054749 6160-WRITE-FOB-INTERNAL-XCPT.                                            
054750                                                                          
054751      WRITE FOB-INT-XCPT-EMAIL-RECORD.                                    
054752      ADD +1               TO PA-INT-FOB-WRITTEN-XCPT.                    
054753                                                                          
054754*-----------------------------------------------------------------        
054755                                                                          
054756 6520-WRITE-CSTM-INTERNAL.                                                
054757                                                                          
054760      WRITE CSTM-INT-EMAIL-RECORD                                         
054770      ADD +1               TO PA-INT-CSTM-WRITTEN.                        
054780                                                                          
054792*-----------------------------------------------------------------        
054793                                                                          
054794 6530-WRITE-CSTM-EXTERNAL.                                                
054795                                                                          
054796      WRITE CSTM-EXT-EMAIL-RECORD.                                        
054797      ADD +1               TO PA-EXT-CSTM-WRITTEN.                        
054798                                                                          
054799*-----------------------------------------------------------------        
054800                                                                          
054801 6540-WRITE-DECON-INTERNAL.                                               
054802                                                                          
054803      WRITE DECON-INT-EMAIL-RECORD                                        
054804      ADD +1               TO PA-INT-DCONSLR-WRITTEN.                     
054807                                                                          
054808*-----------------------------------------------------------------        
054809                                                                          
054810 6550-WRITE-DECON-EXTERNAL.                                               
054811                                                                          
054812      WRITE DECON-EXT-EMAIL-RECORD.                                       
054813      ADD +1               TO PA-EXT-DCONSLR-WRITTEN.                     
054814                                                                          
054815 EJECT                                                                    
054816                                                                          
054820*----------------------------------------------------------------*        
054900* GET THE VENDOR SHORT NAME                                      *        
055000*----------------------------------------------------------------*        
055100                                                                          
055200 7000-GET-VENDOR-SHORT-NAME.                                              
055300                                                                          
055400     EXEC SQL                                                             
055500         SELECT ENT_NAME_DESC                                             
055600              , ENT_ID                                                    
055700          INTO  :ENTNME-ENT-NAME-DESC                                     
055800              , :ENTNME-ENT-ID                                            
055900          FROM  TENTNME                                                   
056000          WHERE ENT_ID   = :TRBNTF-ENT-ID                                 
056100            AND TYPE_CDE = '04'                                           
056200     END-EXEC.                                                            
056300                                                                          
056400     EVALUATE TRUE                                                        
056500         WHEN SQLCODE = +0                                                
056600             CONTINUE                                                     
056700         WHEN SQLCODE = +100                                              
056800             MOVE SPACES TO ENTNME-ENT-NAME-DESC                          
056900         WHEN SQLWARN0 NOT = SPACE                                        
057000         WHEN SQLCODE < +0                                                
057100         WHEN SQLCODE > +0                                                
057200            MOVE 'SEVERE SQL ERROR - TENTNME    '                         
057300                                       TO PV-ERROR-TEXT                   
057400             PERFORM 9100-SQL-ABEND                                       
057500     END-EVALUATE.                                                        
057600 EJECT                                                                    
057700*----------------------------------------------------------------*        
057800* GET THE VENDOR PRIMARY NAME                                    *        
057900*----------------------------------------------------------------*        
058000                                                                          
058100 7005-GET-VENDOR-PRIMARY-NAME.                                            
058200                                                                          
058300     EXEC SQL                                                             
058400         SELECT ENT_NAME_DESC                                             
058500              , ENT_ID                                                    
058600          INTO  :ENTNME-ENT-NAME-DESC                                     
058700              , :ENTNME-ENT-ID                                            
058800          FROM  TENTNME                                                   
058900          WHERE ENT_ID   = :TRBNTF-ENT-ID                                 
059000            AND TYPE_CDE = '01'                                           
059100     END-EXEC.                                                            
059200                                                                          
059300     EVALUATE TRUE                                                        
059400         WHEN SQLCODE = +0                                                
059500             CONTINUE                                                     
059600         WHEN SQLCODE = +100                                              
059700             MOVE SPACES TO ENTNME-ENT-NAME-DESC                          
059800         WHEN SQLWARN0 NOT = SPACE                                        
059900         WHEN SQLCODE < +0                                                
060000         WHEN SQLCODE > +0                                                
060100            MOVE 'SEVERE SQL ERROR - TENTNME    '                         
060200                                       TO PV-ERROR-TEXT                   
060300             PERFORM 9100-SQL-ABEND                                       
060400     END-EVALUATE.                                                        
060500 EJECT                                                                    
060600*----------------------------------------------------------------*        
060700* GET THE VENDOR PRIMARY NAME                                    *        
060800*----------------------------------------------------------------*        
060900                                                                          
061000 7010-SELECT-PLNSHP.                                                      
061100                                                                          
061200     EXEC SQL                                                             
061300         SELECT STRT_FCTRY_DTE                                            
061400              , LAST_FCTRY_DTE                                            
061410              , DONT_SHIP_BEF_DTE                                         
061500          INTO  :PLNSHP-STRT-FCTRY-DTE                                    
061600              , :PLNSHP-LAST-FCTRY-DTE                                    
061610              , :PLNSHP-DONT-SHIP-BEF-DTE                                 
061700          FROM  TPLNSHP                                                   
061800          WHERE PO_NBR   = :PLNSHP-PO-NBR                                 
061900*****       AND VER_NBR  = :PLNSHP-VER-NBR                                
061910            AND VER_STATUS_CDE  = :PC-A                                   
062000     END-EXEC.                                                            
062100                                                                          
062200     EVALUATE TRUE                                                        
062300         WHEN SQLCODE = +0 OR -811                                        
062400             CONTINUE                                                     
062500         WHEN SQLCODE = +100                                              
062600             MOVE SPACES TO PLNSHP-STRT-FCTRY-DTE                         
062700             MOVE SPACES TO PLNSHP-LAST-FCTRY-DTE                         
062800         WHEN SQLWARN0 NOT = SPACE                                        
062900         WHEN SQLCODE < +0                                                
063000         WHEN SQLCODE > +0                                                
063100            MOVE 'SEVERE SQL ERROR - TPLNSHP    '                         
063200                                       TO PV-ERROR-TEXT                   
063300             PERFORM 9100-SQL-ABEND                                       
063400     END-EVALUATE.                                                        
063500 EJECT                                                                    
063501******************************************************************        
063502* GET THE LONG DESCRIPTION FROM THE TROUBLE REASON TABLE         *        
063503******************************************************************        
063504                                                                          
063505 7100-SELECT-TTRBRSN.                                                     
063506                                                                          
063507      EXEC SQL                                                            
063508         SELECT TRBL_SHT_DESC                                             
063509           INTO :TRBRSN-TRBL-SHT-DESC                                     
063510           FROM TTRBRSN                                                   
063511          WHERE TRBL_RSN_CDE  = :TRBRSN-TRBL-RSN-CDE                      
063512      END-EXEC.                                                           
063513                                                                          
063514      EVALUATE TRUE                                                       
063515        WHEN SQLCODE = ZERO                                               
063516          CONTINUE                                                        
063517        WHEN SQLCODE = +100                                               
063518          MOVE PC-REASON-NOT-FOUND  TO TRBRSN-TRBL-SHT-DESC               
063519        WHEN SQLWARN0 NOT EQUAL SPACE                                     
063520          MOVE 'SEVERE SQL ERROR - TTRBRSN    '                           
063521                                     TO PV-ERROR-TEXT                     
063522          PERFORM 9100-SQL-ABEND                                          
063523      END-EVALUATE.                                                       
063524                                                                          
063525 EJECT                                                                    
063526                                                                          
063527******************************************************************        
063528* GET THE BOOKIN DATE FOR MISSING RECEIVING TROUBLES             *        
063529******************************************************************        
063530                                                                          
063531 7200-GET-BOOKING-DATE.                                                   
063532                                                                          
063533      EXEC SQL                                                            
063534        SELECT MAX(A.PO_BKG_DELY_TMST)                                    
063535        INTO :IMBKPO-PO-BKG-DELY-TMST                                     
063536        FROM TIMBKPO A                                                    
063537        WHERE A.PO_NBR = :IMBKPO-PO-NBR                                   
063538      END-EXEC.                                                           
063539                                                                          
063540      EVALUATE TRUE                                                       
063541        WHEN SQLCODE = ZERO                                               
063542          CONTINUE                                                        
063543        WHEN SQLCODE = +100                                               
063544          CONTINUE                                                        
063545        WHEN SQLWARN0 NOT EQUAL SPACE                                     
063546          MOVE 'SEVERE SQL ERROR - BOOKING DATE'                          
063547                                     TO PV-ERROR-TEXT                     
063548          PERFORM 9100-SQL-ABEND                                          
063549      END-EVALUATE.                                                       
063550                                                                          
063551 EJECT                                                                    
063552                                                                          
063553******************************************************************        
063554                                                                          
063555 7300-GET-MAKER.                                                          
063556                                                                          
063568     EXEC SQL                                                             
063569        SELECT IMPRT_VND_ID                                               
063570          INTO :PURCHS-IMPRT-VND-ID                                       
063571          FROM TPURCHS                                                    
063572         WHERE PO_NBR              =  :PURCHS-PO-NBR                      
063573           AND VER_STATUS_CDE      =  :PC-A                               
063574     END-EXEC.                                                            
063575                                                                          
063576     EVALUATE TRUE                                                        
063577       WHEN  SQLCODE = ZERO                                               
063578       WHEN  SQLCODE = -811                                               
               IF PURCHS-IMPRT-VND-ID > 0                                       
                   PERFORM 7310-GET-IMPRT-VEND-NAME                             
063579         END-IF                                                           
063580       WHEN  SQLCODE = +100                                               
063581         DISPLAY 'TPURCHS NOT FOUND FOR PO NUMBER - '                     
063582                 PV-CURRENT-PO-NBR                                        
063583       WHEN SQLCODE NOT EQUAL ZERO                                        
063584       WHEN SQLWARN0 NOT EQUAL SPACE                                      
063585         MOVE 'SEVERE SQL ERROR TPURCHS      '                            
063586                                    TO PV-ERROR-TEXT                      
063587         PERFORM 9100-SQL-ABEND                                           
063588     END-EVALUATE.                                                        
063589                                                                          
063590 EJECT                                                                    
063553******************************************************************        
063554                                                                          
063555 7310-GET-IMPRT-VEND-NAME.                                                
063556                                                                          
                                                                                
063568     EXEC SQL                                                             
105100         SELECT ENT_NAME_DESC                                             
105200         INTO  :ENTNME-ENT-NAME-DESC                                      
105300         FROM   TENTNME                                                   
105400         WHERE  ENT_ID = :PURCHS-IMPRT-VND-ID                             
105500         AND    TYPE_CDE = '01'                                           
063574     END-EXEC.                                                            
063575                                                                          
063576     EVALUATE TRUE                                                        
063577       WHEN  SQLCODE = ZERO                                               
063578       WHEN  SQLCODE = -811                                               
               CONTINUE                                                         
063580       WHEN  SQLCODE = +100                                               
               MOVE SPACES        TO ENTNME-ENT-NAME-DESC                       
063583       WHEN SQLCODE NOT EQUAL ZERO                                        
063584       WHEN SQLWARN0 NOT EQUAL SPACE                                      
063585         MOVE 'SEVERE SQL ERROR TENTNME      '                            
063586                                    TO PV-ERROR-TEXT                      
063587         PERFORM 9100-SQL-ABEND                                           
063588     END-EVALUATE.                                                        
063589                                                                          
063590 EJECT                                                                    
063591*----------------------------------------------------------------*        
063592                                                                          
063593 7400-SELECT-TIMCSEN.                                                     
063594                                                                          
063595     EXEC SQL                                                             
063596         SELECT A.ACTL_CLR_TMST                                           
063597              , A.FILD_TMST                                               
063598              , A.CSTM_ENTR_ID                                            
063599          INTO  :IMCSEN-ACTL-CLR-TMST                                     
063600              , :IMCSEN-FILD-TMST                                         
063601              , :IMCSEN-CSTM-ENTR-ID                                      
063602          FROM  TIMCSEN A                                                 
063603              , TIMCSPO B                                                 
063604          WHERE B.PO_NBR   = :IMCSPO-PO-NBR                               
063605            AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID                           
063606     END-EXEC.                                                            
063607                                                                          
063608     EVALUATE TRUE                                                        
063609         WHEN SQLCODE = +0 OR -811                                        
063610             CONTINUE                                                     
063611         WHEN SQLCODE = +100                                              
063612             DISPLAY 'TMKUT640 - TIMCSEN NOT FOUND'                       
063613         WHEN SQLWARN0 NOT = SPACE                                        
063614         WHEN SQLCODE < +0                                                
063615         WHEN SQLCODE > +0                                                
063616            MOVE 'SEVERE SQL ERROR - TIMCSEN    '                         
063617                                       TO PV-ERROR-TEXT                   
063618             PERFORM 9100-SQL-ABEND                                       
063619     END-EVALUATE.                                                        
063620 EJECT                                                                    
063621*----------------------------------------------------------------*        
063622                                                                          
073105 7500-SELECT-TIMPORL.                                                     
073106                                                                          
073107     EXEC SQL                                                             
073108                                                                          
073109       SELECT                                                             
073110           DCONSLR_RLSE_CDE                                               
073121          ,DCONSLR_ACTL_DTE                                               
073123          INTO                                                            
073136           :IMPORL-DCONSLR-RLSE-CDE                                       
073137          ,:IMPORL-DCONSLR-ACTL-DTE                                       
073139       FROM TIMPORL                                                       
073140       WHERE PO_NBR       = :IMPORL-PO-NBR                                
073141       AND VER_STATUS_CDE IN (:PC-A, :PC-R)                               
073142                                                                          
073143     END-EXEC.                                                            
073144                                                                          
073145     EVALUATE TRUE                                                        
073146                                                                          
073147        WHEN SQLCODE = ZERO                                               
073148          CONTINUE                                                        
073176        WHEN SQLCODE = +100                                               
073177          MOVE PC-DEFAULT-DATE                                            
073178                            TO IMPORL-DCONSLR-ACTL-DTE                    
073179        WHEN SQLWARN0 NOT EQUAL SPACE                                     
073180          MOVE 'SEVERE SQL ERROR - TIMPORL    '                           
073181                                     TO PV-ERROR-TEXT                     
073182          PERFORM 9100-SQL-ABEND                                          
073183                                                                          
074600     END-EVALUATE.                                                        
074601******************************************************************        
074602* DISPLAYS THE SUMMARY STATISTICS FOR THE PROGRAM.               *        
074603* CLOSES THE FLAT FILE.                                          *        
074604******************************************************************        
074605                                                                          
074606 8000-EOJ-ROUTINE.                                                        
074607                                                                          
074608     DISPLAY ' --------------------------------------------'.             
074609     DISPLAY '     * TMKUT640 SUMMARY STATISTICS *         '.             
074610     DISPLAY '       ---------------------------           '.             
074611     DISPLAY ' TOTAL RECORDS READ:    ' PA-TOTAL-RECORDS-READ.            
074612     DISPLAY '                                             '.             
074613     DISPLAY ' TOTAL EI     INT FOB WRITTEN: '                            
074614                                PA-INT-FOB-WRITTEN-EI.                    
074615     DISPLAY '                                             '.             
074616     DISPLAY ' TOTAL EI     EXT FOB WRITTEN: '                            
074617                                PA-EXT-FOB-WRITTEN-EI.                    
074618     DISPLAY '                                             '.             
074619     DISPLAY ' TOTAL OCS    INT FOB WRITTEN: '                            
074620                                PA-INT-FOB-WRITTEN-OCS.                   
074621     DISPLAY '                                             '.             
074622     DISPLAY ' TOTAL OCS    EXT FOB WRITTEN: '                            
074623                                PA-EXT-FOB-WRITTEN-OCS.                   
074624     DISPLAY '                                             '.             
074625     DISPLAY ' TOTAL MAERSK INT FOB WRITTEN: '                            
074626                                PA-INT-FOB-WRITTEN-BC.                    
074627     DISPLAY '                                             '.             
074628     DISPLAY ' TOTAL MAERSK EXT FOB WRITTEN: '                            
074629                                PA-EXT-FOB-WRITTEN-BC.                    
074630     DISPLAY '                                             '.             
074631     DISPLAY ' TOTAL FOB W/OUT VALID ENTID:  '                            
074632                                PA-INT-FOB-WRITTEN-XCPT.                  
074633     DISPLAY '                                             '.             
074634     DISPLAY ' TOTAL INT CST WRITTEN:        '                            
074635                                PA-INT-CSTM-WRITTEN.                      
074636     DISPLAY '                                             '.             
074637     DISPLAY ' TOTAL EXT CST WRITTEN:        '                            
074638                                PA-EXT-CSTM-WRITTEN.                      
074639     DISPLAY '                                             '.             
074640     DISPLAY ' TOTAL INT DCN WRITTEN:        '                            
074641                                PA-INT-DCONSLR-WRITTEN.                   
074642     DISPLAY '                                             '.             
074643     DISPLAY ' TOTAL EXT DCN WRITTEN:        '                            
074644                                PA-EXT-DCONSLR-WRITTEN.                   
074645     DISPLAY '                                             '.             
074646     DISPLAY '---------------------------------------------'.             
074647                                                                          
074648     IF PA-INT-FOB-WRITTEN-EI = ZERO                                      
074649       MOVE EMPTY-FILE-LINE TO FOB-INT-EI-EMAIL-RECORD                    
074650       PERFORM 6100-WRITE-FOB-INTERNAL-EI.                                
074651                                                                          
074652     IF PA-EXT-FOB-WRITTEN-EI = ZERO                                      
074653       MOVE EMPTY-FILE-LINE TO FOB-EXT-EI-EMAIL-RECORD                    
074654       PERFORM 6110-WRITE-FOB-EXTERNAL-EI.                                
074655                                                                          
074656     IF PA-INT-FOB-WRITTEN-OCS = ZERO                                     
074657       MOVE EMPTY-FILE-LINE TO FOB-INT-OCS-EMAIL-RECORD                   
074658       PERFORM 6120-WRITE-FOB-INTERNAL-OCS.                               
074659                                                                          
074660     IF PA-EXT-FOB-WRITTEN-OCS = ZERO                                     
074661       MOVE EMPTY-FILE-LINE TO FOB-EXT-OCS-EMAIL-RECORD                   
074662       PERFORM 6130-WRITE-FOB-EXTERNAL-OCS.                               
074663                                                                          
074664     IF PA-INT-FOB-WRITTEN-BC  = ZERO                                     
074665       MOVE EMPTY-FILE-LINE TO FOB-INT-BC-EMAIL-RECORD                    
074666       PERFORM 6140-WRITE-FOB-INTERNAL-BC.                                
074667                                                                          
074668     IF PA-EXT-FOB-WRITTEN-BC  = ZERO                                     
074669       MOVE EMPTY-FILE-LINE TO FOB-EXT-BC-EMAIL-RECORD                    
074670       PERFORM 6150-WRITE-FOB-EXTERNAL-BC.                                
074671                                                                          
074672***--------------------------------------------------------------         
074673***  WE WANT AN EMPTY FILE WHEN THERE ARE NO BAD FOBS SO THAT AN          
074674***    E-MAIL DOESN'T GET SENT.                                           
074675***--------------------------------------------------------------         
074676***  IF PA-INT-FOB-WRITTEN-XCPT = ZERO                                    
074677***    MOVE EMPTY-FILE-LINE TO FOB-INT-XCPT-EMAIL-RECORD                  
074678***    PERFORM 6160-WRITE-FOB-INTERNAL-XCPT.                              
074679                                                                          
074680     IF PA-INT-CSTM-WRITTEN = ZERO                                        
074681       MOVE EMPTY-FILE-LINE TO CSTM-INT-EMAIL-RECORD                      
074682       PERFORM 6520-WRITE-CSTM-INTERNAL.                                  
074683                                                                          
074684     IF PA-EXT-CSTM-WRITTEN = ZERO                                        
074685       MOVE EMPTY-FILE-LINE TO CSTM-EXT-EMAIL-RECORD                      
074686       PERFORM 6530-WRITE-CSTM-EXTERNAL.                                  
074687                                                                          
074688     IF PA-INT-DCONSLR-WRITTEN = ZERO                                     
074689       MOVE EMPTY-FILE-LINE TO DECON-INT-EMAIL-RECORD                     
074690       PERFORM 6540-WRITE-DECON-INTERNAL.                                 
074691                                                                          
074692     IF PA-EXT-DCONSLR-WRITTEN = ZERO                                     
074693       MOVE EMPTY-FILE-LINE TO DECON-EXT-EMAIL-RECORD                     
074694       PERFORM 6550-WRITE-DECON-EXTERNAL.                                 
074695                                                                          
074696     CLOSE EXCEPTION-FILE                                                 
074697           FOB-INT-EI-EMAIL-FILE                                          
074698           FOB-EXT-EI-EMAIL-FILE                                          
074699           FOB-INT-OCS-EMAIL-FILE                                         
074700           FOB-EXT-OCS-EMAIL-FILE                                         
074701           FOB-INT-BC-EMAIL-FILE                                          
074702           FOB-EXT-BC-EMAIL-FILE                                          
074703           FOB-INT-XCPT-EMAIL-FILE                                        
074704           CSTM-INT-EMAIL-FILE                                            
074705           CSTM-EXT-EMAIL-FILE                                            
074706           DECON-INT-EMAIL-FILE                                           
074707           DECON-EXT-EMAIL-FILE.                                          
074708                                                                          
074709 EJECT                                                                    
074710                                                                          
074711******************************************************************        
074712* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *        
074713* ERROR OR WARNING CODE OCCURS.                                  *        
074714******************************************************************        
074715 9100-SQL-ABEND.                                                          
074716******************************************************************        
074717* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *        
074718* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *        
074719* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *        
074720* FORMAT.                                                        *        
074721******************************************************************        
074722                                                                          
074723     COPY DPPD004.                                                        
074724                                                                          
074725     DISPLAY '***********************************'.                       
074726     DISPLAY 'EMAIL PROGRAM ABEND                '.                       
074727     DISPLAY '***********************************'.                       
074728     DISPLAY 'CURRENT PO AT ABEND: ' PV-CURRENT-PO-NBR.                   
074729     DISPLAY 'CURRENT CNTRL NBR  : ' PV-CURRENT-CNTRL-NBR.                
074730     DISPLAY 'ERROR TEXT         : ' PV-ERROR-TEXT.                       
074731     DISPLAY '***********************************'.                       
074732     MOVE +0284 TO ABEND-CODE.                                            
074733     CALL 'ILBOABN0' USING ABEND-CODE.                                    
074734                                                                          
074740 EJECT                                                                    
074800                                                                          
