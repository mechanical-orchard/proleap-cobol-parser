000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             CMKUT001.                                00050000
000600 AUTHOR.                 RICK TULLOCH.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           07-09-03.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*       THIS PROGRAM READS THROUGH THE SYSOUT GENERATED BY THE   *00120000
001300*  EXECUTION OF A STAGED SQL REQUEST FOR A PRODUCTION DATA       *00130000
001400*  CHANGE, AND EVALUATES THE SUCCESS OR FAILURE OF EACH          *00140000
001500*  SQL STATEMENT IN THE STAGED REQUEST.  THROUGHOUT THE          *00150000
001600*  EVALUATION, AN AUDIT ENTRY IS PREPARED FOR THE OVERALL        *00160000
001700*  REQUEST, AN E-MAIL MESSAGE IS FORMATTED TO COMMUNICATE THE    *00170000
001800*  RESULTS OF THE EXECUTION OF THE REQUEST AND THE NEXT STEPS/   *00180000
001900*  CORRECTIVE ACTIONS TO BE TAKEN BY THE PARTIES INVOLVED IN     *00190000
002000*  THE REQUEST, A SUMMARY RECORD FOR SUBSEQUENT EVALUATION OF    *00200000
002100*  RESULTS OF THE REQUEST IS CREATED, AND A ROW PER SQL          *00210000
002200*  STATEMENT THAT COULD CHANGE DATA IS POSTED TO THE PRODUCTION  *00220000
002300*  DATA CHANGE RESULTS TABLE.                                    *00230000
002400*                                                                *00240000
002500*       EACH STATEMENT WILL BE IDENTIFIED BY A SPECIFIC          *00250000
002600*  POSITIONAL INPUT STATEMENT STRING IN THE SYSOUT REPORT.       *00260000
002700*  FOLLOWING THE INPUT STATEMENT STRING IS THE SQL EXECUTED.     *00270000
002800*  THE SQL IS PARSED TO DETERMINE THE ACTION OF THE STATEMENT,   *00280000
002900*  AND THE TABLE INVOLVED, IF IT IS A STATEMENT THAT CAN CHANGE  *00290000
003000*  DATA.  SUBSEQUENT SECTIONS OF THE SYSOUT REPORT WILL ONLY BE  *00300000
003100*  CONDITIONALLY PRESENT, DEPENDING ON THE ACTION AND THE        *00310000
003200*  SUCCESS OR FAILURE OF EXECUTING THE STATEMENT.  AN ERROR      *00320000
003300*  INDICATION LINE OR THE START OF THE RESULTS SPECIFICATION     *00330000
003400*  MAY BE PRESENT WITH INFORMATION TO BE CAPTURED FOR THE AUDIT  *00340000
003500*  BEFORE THE NEXT INPUT STATEMENT.                              *00350000
003600*                                                                *00360000
003700*       IF ANYTHING IS DETECTED THAT IS NOT EXPECTED DURING THE  *00370000
003800*  ANALYSIS OF THE SYSOUT REPORT, PARSING ERRORS WILL BE         *00380000
003900*  GENERATED, AND COMMUNICATED TO CHANGE MANAGEMENT IN THE       *00390000
004000*  E-MAIL MESSAGE.  UPGRADES OR PATCHES TO DB2 OR DB2 UTILITIES  *00400000
004100*  COULD IMPACT THE FORMAT OF THE SYSOUT REPORT, AND THE         *00410000
004200*  ABILITY OF THIS PROCESS TO EVALUATE THE RESULTS.              *00420000
004300*                                                                *00430000
004400*        A CUSTOM RETURN CODE MAY BE SET AT THE END OF THIS      *00440000
004500*  PROCESS FOR ISSUES THAT REQUIRE SPECIFIC FOLLOW-UP AND        *00450000
004600*  DISTINCT PROBLEM TICKET ROUTING.                              *00460000
004700*                                                                *00470000
004800*        4060 - NO PART OF THE REQUEST WAS SUCCESSFUL, AND THE   *00480000
004900*               PERMANENT RETENTION AND FREEZE OF THE SQL MEMBER *00490000
005000*               SHOULD NOT BE COMPLETED.                         *00500000
005100*                                                                *00510000
005200*        4055 - NO SQL STATEMENTS OR NO SQL STATEMENTS THAT      *00520000
005300*               COULD CHANGE DATA WERE DETECTED.  THIS COULD     *00530000
005400*               ALSO BE A PARSING ERROR.                         *00540000
005500*                                                                *00550000
005600*        4050 - ALL OR PART OF THE REQUEST WAS SUCCESSFUL, AND   *00560000
005700*         OR    IF THE REQUEST IS ONLY PARTIALLY SUCCESSFUL,     *00570000
005800*        0000   THE PERMANENT RETENTION AND FREEZE OF THE SQL    *00580000
005900*               MEMBER WILL STILL BE EXECUTED, BUT THE REQUESTER *00590000
006000*               MUST BUILD A SEPARATE REQUEST TO CORRECT THE     *00600000
006100*               ISSUES AND COMPLETE THE INTENT OF THE ORIGINAL   *00610000
006200*               REQUEST.                                         *00620000
006300*                                                                *00630000
006400*        4050 - A PARSING ERROR OCCURRED WHEN EVALUATING THE     *00640000
006500*               SYSOUT OF THE EXECUTION OF THE SQL.              *00650000
006600******************************************************************00660000
006700                                                                  00670000
006800******************************************************************00680000
006900 ENVIRONMENT DIVISION.                                            00690000
007000******************************************************************00700000
007100                                                                  00710000
007200 CONFIGURATION SECTION.                                           00720000
007300                                                                  00730000
007400 SOURCE-COMPUTER.        IBM-3090.                                00740000
007500 OBJECT-COMPUTER.        IBM-3090.                                00750000
007600                                                                  00760000
007700 INPUT-OUTPUT SECTION.                                            00770000
007800                                                                  00780000
007900 FILE-CONTROL.                                                    00790000
008000                                                                  00800000
008100     SELECT SQL-EXEC-SYSOUT-FILE                                  00810000
008200         ASSIGN TO INP01.                                         00820000
008300                                                                  00830000
008400     SELECT PROD-DATA-CNTL-FILE                                   00840000
008500         ASSIGN TO INP02.                                         00850000
008600                                                                  00860000
008700     SELECT RESULTS-AUDIT-FILE                                    00870000
008800         ASSIGN TO OUT01.                                         00880000
008900                                                                  00890000
009000     SELECT RESULTS-EMAIL-FILE                                    00900000
009100         ASSIGN TO OUT02.                                         00910000
009200                                                                  00920000
009300     SELECT RESULTS-SUMMARY-FILE                                  00930000
009400         ASSIGN TO OUT03.                                         00940000
009500                                                                  00950000
009600******************************************************************00960000
009700 DATA DIVISION.                                                   00970000
009800******************************************************************00980000
009900                                                                  00990000
010000 FILE SECTION.                                                    01000000
010100                                                                  01010000
010200 FD  SQL-EXEC-SYSOUT-FILE                                         01020000
010300     RECORDING MODE IS F                                          01030000
010400     LABEL RECORDS ARE STANDARD                                   01040000
010500     BLOCK CONTAINS 0 RECORDS                                     01050000
010600     RECORD CONTAINS 133 CHARACTERS                               01060000
010700     DATA RECORDS IS SE-SQL-EXEC-SYSOUT-RECORD.                   01070000
010800                                                                  01080000
010900 01  SE-SQL-EXEC-SYSOUT-RECORD   PIC X(133).                      01090000
011000                                                                  01100000
011100 FD  PROD-DATA-CNTL-FILE                                          01110000
011200     RECORDING MODE IS F                                          01120000
011300     LABEL RECORDS ARE STANDARD                                   01130000
011400     BLOCK CONTAINS 0 RECORDS                                     01140000
011500     RECORD CONTAINS 120 CHARACTERS                               01150000
011600     DATA RECORDS IS PD-PROD-DATA-CNTL-RECORD.                    01160000
011700                                                                  01170000
011800 01  PD-PROD-DATA-CNTL-RECORD    PIC X(120).                      01180000
011900                                                                  01190000
012000 FD  RESULTS-AUDIT-FILE                                           01200000
012100     RECORDING MODE IS F                                          01210000
012200     LABEL RECORDS ARE STANDARD                                   01220000
012300     BLOCK CONTAINS 0 RECORDS                                     01230000
012400     RECORD CONTAINS 80 CHARACTERS                                01240000
012500     DATA RECORDS IS RA-RESULTS-AUDIT-RECORD.                     01250000
012600                                                                  01260000
012700 01  RA-RESULTS-AUDIT-RECORD     PIC X(80).                       01270000
012800                                                                  01280000
012900 FD  RESULTS-EMAIL-FILE                                           01290000
013000     RECORDING MODE IS F                                          01300000
013100     LABEL RECORDS ARE STANDARD                                   01310000
013200     BLOCK CONTAINS 0 RECORDS                                     01320000
013300     RECORD CONTAINS 80 CHARACTERS                                01330000
013400     DATA RECORDS IS RE-RESULTS-EMAIL-RECORD.                     01340000
013500                                                                  01350000
013600 01  RE-RESULTS-EMAIL-RECORD     PIC X(80).                       01360000
013700                                                                  01370000
013800 FD  RESULTS-SUMMARY-FILE                                         01380000
013900     RECORDING MODE IS F                                          01390000
014000     LABEL RECORDS ARE STANDARD                                   01400000
014100     BLOCK CONTAINS 0 RECORDS                                     01410000
014200     RECORD CONTAINS 40 CHARACTERS                                01420000
014300     DATA RECORDS IS RS-RESULTS-SUMMARY-RECORD.                   01430000
014400                                                                  01440000
014500 01  RS-RESULTS-SUMMARY-RECORD   PIC X(40).                       01450000
014600                                                                  01460000
014700 WORKING-STORAGE SECTION.                                         01470000
014800                                                                  01480000
014900*                                                                 01490000
015000*  PARAMETER LIST FOR CALLING THE "GET CURRENT JOB INFORMATION"   01500000
015100*  ROUTINE.                                                       01510000
015200*                                                                 01520000
015300                                                                  01530000
015400     COPY DPWS085.                                                01540000
015500                                                                  01550000
015600*                                                                 01560000
015700*  PRODUCTION DATA CHANGE CONTROL FILE LAYOUT                     01570000
015800*                                                                 01580000
015900                                                                  01590000
016000     COPY CMRD001.                                                01600000
016100                                                                  01610000
016200*                                                                 01620000
016300*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01630000
016400*                                                                 01640000
016500                                                                  01650000
016600     COPY DPWS004.                                                01660000
016700                                                                  01670000
016800 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          01680000
016900                                              COMP SYNC.          01690000
017000     88  AC-CONTROL-CARD-ERROR                VALUE +4003.        01700000
017100     88  AC-FILE-SEQUENCE-ERROR               VALUE +4007.        01710000
017200     88  AC-DB2-ERROR                         VALUE +4013.        01720000
017300                                                                  01730000
017400 01  PS-PROGRAM-SWITCHES.                                         01740000
017500     05  PS-END-OF-SYSOUT-FILE-SW                                 01750000
017600                                 PIC X(1)     VALUE 'N'.          01760000
017700         88  PS-END-OF-SYSOUT-FILE            VALUE 'Y'.          01770000
017800     05  PS-END-OF-CNTL-FILE-SW  PIC X(1)     VALUE 'N'.          01780000
017900         88  PS-END-OF-CNTL-FILE              VALUE 'Y'.          01790000
018000                                                                  01800000
018100 01  PC-PROGRAM-CONSTANTS.                                        01810000
018200     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'CMKUT001'.   01820000
018300     05  PC-TEST-JOB-NAME-PREFIX PIC X(2)     VALUE 'TK'.         01830000
018400     05  PC-MAXIMUM-RETRY-COUNT  PIC S9(4)    VALUE +2            01840000
018500                                              COMP SYNC.          01850000
018600     05  PC-MAX-ROWS-AFFECTED-LENGTH                              01860000
018700                                 PIC S9(4)    VALUE +9            01870000
018800                                              COMP SYNC.          01880000
018900     05  PV-MAX-CHG-MGMT-DTL-ACT-LINES                            01890000
019000                                 PIC S9(4)    VALUE +1000         01900000
019100                                              COMP SYNC.          01910000
019200     05  PC-MAX-DISPLAY-ROWS-AFFECTED                             01920000
019300                                 PIC 9(6)     VALUE 999999.       01930000
019400     05  PC-UNKNOWN-ID           PIC X(7)     VALUE '* UNK *'.    01940000
019500     05  PC-SQL-COMMENT          PIC X(2)     VALUE '--'.         01950000
019600     05  PC-PERIOD               PIC X(1)     VALUE '.'.          01960000
019700     05  PC-SQLCODE              PIC X(7)     VALUE 'SQLCODE'.    01970000
019800     05  PC-EQUAL-SYMBOL         PIC X(1)     VALUE '='.          01980000
019900     05  PC-COMMA                PIC X(1)     VALUE ','.          01990000
020000     05  PC-PLUS-SIGN            PIC X(1)     VALUE '+'.          02000000
020100     05  PC-COLON                PIC X(1)     VALUE ':'.          02010000
020200     05  PC-OPEN-PARENTHESIS     PIC X(1)     VALUE '('.          02020000
020300     05  PC-SEMICOLON            PIC X(1)     VALUE ';'.          02030000
020400     05  PC-SUCCESSFUL-SQLCODE   PIC S9(9)    VALUE ZEROS         02040000
020500                                              COMP SYNC.          02050000
020600     05  PC-RESOURCE-NOT-AVAIL-SQLCODE                            02060000
020700                                 PIC S9(9)    VALUE -904          02070000
020800                                              COMP SYNC.          02080000
020900     05  PC-DEADLOCK-W-ROLLBCK-SQLCODE                            02090000
021000                                 PIC S9(9)    VALUE -911          02100000
021100                                              COMP SYNC.          02110000
021200     05  PC-DEADLOCK-WO-ROLLBCK-SQLCODE                           02120000
021300                                 PIC S9(9)    VALUE -913          02130000
021400                                              COMP SYNC.          02140000
021500     05  PC-PARSING-ERRORS-RET-CODE                               02150000
021600                                 PIC S9(4)    VALUE +4050         02160000
021700                                              COMP SYNC.          02170000
021800     05  PC-NO-STMT-FOUND-RET-CODE                                02180000
021900                                 PIC S9(4)    VALUE +4055         02190000
022000                                              COMP SYNC.          02200000
022100     05  PC-NO-SUCCESSFUL-STMT-RET-CODE                           02210000
022200                                 PIC S9(4)    VALUE +4060         02220000
022300                                              COMP SYNC.          02230000
022400                                                                  02240000
022500 01  PV-PROGRAM-VARIABLES.                                        02250000
022600     05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZEROS         02260000
022700                                              COMP SYNC.          02270000
022800     05  PV-TALLY                PIC S9(4)    VALUE ZEROS         02280000
022900                                              COMP SYNC.          02290000
023000     05  PV-AUDIT-TMST.                                           02300000
023100         10  PV-AT-YEAR          PIC X(4).                        02310000
023200         10  FILLER              PIC X(1)     VALUE '-'.          02320000
023300         10  PV-AT-MONTH         PIC X(2).                        02330000
023400         10  FILLER              PIC X(1)     VALUE '-'.          02340000
023500         10  PV-AT-DAY           PIC X(2).                        02350000
023600         10  FILLER              PIC X(1)     VALUE '-'.          02360000
023700         10  PV-AT-HOUR          PIC X(2).                        02370000
023800         10  FILLER              PIC X(1)     VALUE '.'.          02380000
023900         10  PV-AT-MINUTE        PIC X(2).                        02390000
024000         10  FILLER              PIC X(1)     VALUE '.'.          02400000
024100         10  PV-AT-SECOND        PIC X(2).                        02410000
024200         10  FILLER              PIC X(7)     VALUE '.000000'.    02420000
024300     05  PV-PREV-SQL-MBR-STMTS   PIC S9(9)    VALUE ZEROS         02430000
024400                                              COMP SYNC.          02440000
024500     05  PV-CHG-MGMT-DTL-ACTION-LINE                              02450000
024600                                 PIC S9(4)    VALUE ZEROS         02460000
024700                                              COMP SYNC.          02470000
024800     05  PV-CHG-MGMT-DTL-OVERFLOW-LINES                           02480000
024900                                 PIC S9(9)    VALUE ZEROS         02490000
025000                                              COMP SYNC.          02500000
025100     05  PV-LAST-DB2-ACTION      PIC X(50)    VALUE SPACES.       02510000
025200         88  PV-SELECT-RESULT-COUNT           VALUE               02520000
025300             'SELECT PREVIOUS RESULT COUNT (TCMCHNG)          '.  02530000
025400         88  PV-DELETE-RESULT-ROWS            VALUE               02540000
025500             'DELETE PREVIOUS RESULT ROWS (TCMCHNG)           '.  02550000
025600         88  PV-INSERT-RESULT-ROW             VALUE               02560000
025700             'INSERT A RESULT ROW (TCMCHNG)                   '.  02570000
025800                                                                  02580000
025900 01  PT-PROGRAM-TOTALS.                                           02590000
026000     05  PT-SQL-SYSOUT-RCDS-READ PIC S9(7)    VALUE ZEROS         02600000
026100                                              COMP-3.             02610000
026200     05  PT-SQL-STATEMENT-COUNT  PIC S9(7)    VALUE ZEROS         02620000
026300                                              COMP-3.             02630000
026400     05  PT-SQL-STATEMENT-LOG-COUNT                               02640000
026500                                 PIC S9(7)    VALUE ZEROS         02650000
026600                                              COMP-3.             02660000
026700     05  PT-RES-AUDIT-RCDS-WRITTEN                                02670000
026800                                 PIC S9(7)    VALUE ZEROS         02680000
026900                                              COMP-3.             02690000
027000     05  PT-RES-EMAIL-RCDS-WRITTEN                                02700000
027100                                 PIC S9(7)    VALUE ZEROS         02710000
027200                                              COMP-3.             02720000
027300                                                                  02730000
027400 01  SI-STATEMENT-INFORMATION.                                    02740000
027500     05  SI-SQL-ACTION           PIC X(6)     VALUE SPACES.       02750000
027600         88  SI-SA-INSERT                     VALUE 'INSERT'.     02760000
027700         88  SI-SA-UPDATE                     VALUE 'UPDATE'.     02770000
027800         88  SI-SA-DELETE                     VALUE 'DELETE'.     02780000
027900         88  SI-SA-SELECT                     VALUE 'SELECT'.     02790000
028000         88  SI-SA-COMMIT                     VALUE 'COMMIT'.     02800000
028100         88  SI-SA-LOCK                       VALUE 'LOCK'.       02810000
028200         88  SI-SA-SET                        VALUE 'SET'.        02820000
028300         88  SI-SA-UNKNOWN                    VALUE '**UNK*'.     02830000
028400     05  SI-ORIGINAL-SQL-ACTION  PIC X(6)     VALUE SPACES.       02840000
028500     05  SI-SQL-KEYWORD-REQUIRED PIC X(4)     VALUE SPACES.       02850000
028600         88  SI-SK-NONE                       VALUE SPACES.       02860000
028700         88  SI-SK-INTO                       VALUE 'INTO'.       02870000
028800         88  SI-SK-FROM                       VALUE 'FROM'.       02880000
028900     05  SI-SQL-STMT-WORDS-REQD  PIC S9(1)    VALUE ZEROS.        02890000
029000         88  SI-SS-NO-TABLE-NAME-REQD         VALUE ZEROS.        02900000
029100         88  SI-SS-JUST-TABLE-NAME-REQD       VALUE +1.           02910000
029200         88  SI-SS-KEYWORD-TABLE-NAME-REQD    VALUE +2.           02920000
029300     05  SI-TABLE-LOCATION       PIC X(8)     VALUE SPACES.       02930000
029400     05  SI-TABLE-OWNER          PIC X(8)     VALUE SPACES.       02940000
029500     05  SI-TABLE-NAME           PIC X(18)    VALUE SPACES.       02950000
029600     05  SI-TABLE-NAME-B4-DELIM  PIC X(18)    VALUE SPACES.       02960000
029700     05  SI-TABLE-NAME-AFT-DELIM PIC X(18)    VALUE SPACES.       02970000
029800     05  SI-SD-STMT-DTL-SW       PIC X(1)     VALUE SPACES.       02980000
029900         88  SI-SD-STMT-DTL-WRITTEN           VALUE 'Y'.          02990000
030000         88  SI-SD-STMT-DTL-NOT-WRITTEN       VALUE 'N'.          03000000
030100     05  SI-SQL-ERROR-LINE-SW    PIC X(1)     VALUE SPACES.       03010000
030200         88  SI-SE-SQL-ERROR-LINE-FOUND       VALUE 'Y'.          03020000
030300     05  SI-SQLCODE              PIC X(4)     VALUE SPACES.       03030000
030400         88  SI-SUCCESSFUL-SQLCODE            VALUE '+000'.       03040000
030500         88  SI-NOT-FOUND-SQLCODE             VALUE '+100'.       03050000
030600     05  FILLER                  REDEFINES SI-SQLCODE.            03060000
030700         10  SI-SQLCODE-SIGN     PIC X(1).                        03070000
030800             88  SI-VALID-SQLCODE-SIGN        VALUE '+', '-'.     03080000
030900         10  SI-SQLCODE-VALUE    PIC X(3).                        03090000
031000     05  SI-SQLCODE-LENGTH       PIC S9(4)    VALUE ZEROS         03100000
031100                                              COMP SYNC.          03110000
031200         88  SI-SL-SIGNED                     VALUE +4.           03120000
031300         88  SI-SL-UNSIGNED                   VALUE +3.           03130000
031400     05  SI-SQLCODE-MESSAGE      PIC X(25)    VALUE SPACES.       03140000
031500     05  SI-SQLCODE-ERROR-SW     PIC X(1)     VALUE SPACES.       03150000
031600         88  SI-SE-SQLCODE-ERROR              VALUE 'Y'.          03160000
031700     05  SI-ROWS-AFFECTED-X      PIC X(9)     VALUE SPACES.       03170000
031800         88  SI-ALL-ROWS-AFFECTED             VALUE '      ALL'.  03180000
031900     05  SI-ROWS-AFFECTED        REDEFINES SI-ROWS-AFFECTED-X     03190000
032000                                 PIC 9(9).                        03200000
032100     05  SI-ROWS-AFFECTED-LENGTH PIC S9(4)    VALUE ZEROS         03210000
032200                                              COMP SYNC.          03220000
032300     05  SI-ALL-ROWS-AFFECTED-SW PIC X(1)     VALUE SPACES.       03230000
032400         88  SI-ALL-ROWS-AFFECTED-FOUND       VALUE 'Y'.          03240000
032500         88  SI-ALL-ROWS-AFFECTED-NOT-FOUND   VALUE 'N'.          03250000
032600                                                                  03260000
032700 01  UA-UNSTRING-AREA.                                            03270000
032800     05  UA-WORD-1               PIC X(27)    VALUE SPACES.       03280000
032900     05  UA-WORD-2               PIC X(27)    VALUE SPACES.       03290000
033000     05  UA-WORD-3               PIC X(27)    VALUE SPACES.       03300000
033100     05  UA-WORD-4               PIC X(27)    VALUE SPACES.       03310000
033200     05  UA-WORD-5               PIC X(27)    VALUE SPACES.       03320000
033300     05  UA-OVERFLOW-POINTER     PIC S9(4)    VALUE ZEROS         03330000
033400                                              COMP SYNC.          03340000
033500     05  UA-OVERFLOW             PIC X(80)    VALUE SPACES.       03350000
033600                                                                  03360000
033700 01  CC-CONTROL-CARD.                                             03370000
033800     05  CC-CONTROL-CARD-DISPLAY.                                 03380000
033900         10  CC-RELEASED-BY-USERID                                03390000
034000                                 PIC X(8).                        03400000
034100     05  CC-CONTROL-CARD-FILLER  PIC X(72).                       03410000
034200                                                                  03420000
034300 01  SS-SQL-SYSOUT-RECORD.                                        03430000
034400     05  SS-CONTROL-CHARACTER    PIC X(1)     VALUE SPACE.        03440000
034500     05  SS-RECORD               PIC X(132)   VALUE SPACE.        03450000
034600     05  FILLER                  REDEFINES SS-RECORD.             03460000
034700         10  FILLER              PIC X(4).                        03470000
034800             88  SS-PAGE-HEADER-ID            VALUE 'PAGE'.       03480000
034900         10  FILLER              PIC X(128).                      03490000
035000     05  FILLER                  REDEFINES SS-RECORD.             03500000
035100         10  FILLER              PIC X(19).                       03510000
035200             88  SS-INPUT-STATEMENT-ID        VALUE               03520000
035300                 '***INPUT STATEMENT:'.                           03530000
035400         10  FILLER              PIC X(113).                      03540000
035500     05  FILLER                  REDEFINES SS-RECORD.             03550000
035600         10  FILLER              PIC X(12).                       03560000
035700             88  SS-SQL-ERROR-ID              VALUE               03570000
035800                 'SQLERROR ON '.                                  03580000
035900         10  FILLER              PIC X(120).                      03590000
036000     05  FILLER                  REDEFINES SS-RECORD.             03600000
036100         10  FILLER              PIC X(25).                       03610000
036200             88  SS-SQL-RESULT-ID             VALUE               03620000
036300                 ' RESULT OF SQL STATEMENT:'.                     03630000
036400         10  FILLER              PIC X(107).                      03640000
036500     05  FILLER                  REDEFINES SS-RECORD.             03650000
036600         10  FILLER              PIC X(11).                       03660000
036700             88  SS-SQL-SUCCESS-ID            VALUE               03670000
036800                 'SUCCESSFUL '.                                   03680000
036900         10  FILLER              PIC X(121).                      03690000
037000                                                                  03700000
037100 01  RS-RESULTS-SUMMARY-RCD.                                      03710000
037200*                                                                 03720000
037300*  A SELECT, COMMIT, LOCK OR SET WILL NOT COUNT AS A SUCCESSFUL   03730000
037400*  STATEMENT                                                      03740000
037500*                                                                 03750000
037600     05  RS-SQL-MEMBER-NAME      PIC X(8)     VALUE SPACES.       03760000
037700     05  RS-SUCCESSFUL-STMT-SW   PIC X(1)     VALUE 'N'.          03770000
037800         88  RS-NO-SUCCESSFUL-STMT-FOUND      VALUE 'N'.          03780000
037900         88  RS-SUCCESSFUL-STMT-FOUND         VALUE 'Y'.          03790000
038000     05  RS-UNSUCCESSFUL-STMT-SW                                  03800000
038100                                 PIC X(1)     VALUE 'N'.          03810000
038200         88  RS-NO-UNSUCCESSFUL-STMT-FOUND    VALUE 'N'.          03820000
038300         88  RS-UNSUCCESSFUL-STMT-FOUND       VALUE 'Y'.          03830000
038400     05  RS-NOT-FOUND-STMT-SW    PIC X(1)     VALUE 'N'.          03840000
038500         88  RS-NO-NOT-FOUND-STMT-FOUND       VALUE 'N'.          03850000
038600         88  RS-NOT-FOUND-STMT-FOUND          VALUE 'Y'.          03860000
038700     05  RS-PARSING-ERROR-SW     PIC X(1)     VALUE 'N'.          03870000
038800         88  RS-NO-PARSING-ERRORS             VALUE 'N'.          03880000
038900         88  RS-PARSING-ERRORS-DETECTED       VALUE 'Y'.          03890000
039000     05  RS-SQL-STATEMENT-COUNT  PIC 9(7)     VALUE ZEROS.        03900000
039100     05  RS-SQL-STATEMENT-LOG-COUNT                               03910000
039200                                 PIC 9(7)     VALUE ZEROS.        03920000
039300     05  RS-RELEASED-BY-USERID   PIC X(8)     VALUE SPACES.       03930000
039400     05  FILLER                  PIC X(6)     VALUE SPACES.       03940000
039500                                                                  03950000
039600 01  CM-CHG-MGMT-DTL-ACTION-LINES.                                03960000
039700     05  CM-CHG-MGMT-DTL-ACTION-LINE                              03970000
039800                                 OCCURS 1000 TIMES                03980000
039900                                 INDEXED BY CM-INDEX              03990000
040000                                 PIC X(80).                       04000000
040100                                                                  04010000
040200 01  AH-AUDIT-HEADER-LINE.                                        04020000
040300     05  AH-AUDIT-DATE.                                           04030000
040400         10  AH-AD-YEAR          PIC X(4)     VALUE SPACES.       04040000
040500         10  FILLER              PIC X(1)     VALUE '/'.          04050000
040600         10  AH-AD-MONTH         PIC X(2)     VALUE SPACES.       04060000
040700         10  FILLER              PIC X(1)     VALUE '/'.          04070000
040800         10  AH-AD-DAY           PIC X(2)     VALUE SPACES.       04080000
040900     05  FILLER                  PIC X(1)     VALUE SPACES.       04090000
041000     05  AH-AUDIT-TIME.                                           04100000
041100         10  AH-AT-HOUR          PIC X(2)     VALUE SPACES.       04110000
041200         10  FILLER              PIC X(1)     VALUE ':'.          04120000
041300         10  AH-AT-MINUTE        PIC X(2)     VALUE SPACES.       04130000
041400         10  FILLER              PIC X(1)     VALUE ':'.          04140000
041500         10  AH-AT-SECOND        PIC X(2)     VALUE SPACES.       04150000
041600     05  FILLER                  PIC X(1)     VALUE SPACES.       04160000
041700     05  AH-REQUESTER-USERID     PIC X(8)     VALUE SPACES.       04170000
041800     05  AH-SQL-MEMBER-NAME      PIC X(8)     VALUE SPACES.       04180000
041900     05  FILLER                  PIC X(1)     VALUE SPACES.       04190000
042000     05  FILLER                  PIC X(4)     VALUE 'PRD:'.       04200000
042100     05  AH-REQUEST-REASON       PIC X(38)    VALUE SPACES.       04210000
042200                                                                  04220000
042300 01  AR-AUDIT-RELEASE-LINE.                                       04230000
042400     05  FILLER                  PIC X(41)    VALUE SPACES.       04240000
042500     05  FILLER                  PIC X(4)     VALUE 'SYS:'.       04250000
042600     05  AR-SUBSYSTEM-ID         PIC X(4)     VALUE SPACES.       04260000
042700     05  FILLER                  PIC X(1)     VALUE SPACES.       04270000
042800     05  FILLER                  PIC X(4)     VALUE 'MGR:'.       04280000
042900     05  AR-REQUESTER-MANAGER-USERID                              04290000
043000                                 PIC X(8)     VALUE SPACES.       04300000
043100     05  FILLER                  PIC X(7)     VALUE 'REL_BY:'.    04310000
043200     05  AR-RELEASED-BY-USERID   PIC X(8)     VALUE SPACES.       04320000
043300     05  FILLER                  PIC X(3)     VALUE SPACES.       04330000
043400                                                                  04340000
043500 01  AJ-AUDIT-JOB-LINE.                                           04350000
043600     05  FILLER                  PIC X(41)    VALUE SPACES.       04360000
043700     05  FILLER                  PIC X(9)     VALUE 'JOB NAME:'.  04370000
043800     05  AJ-JOB-NAME             PIC X(8)     VALUE SPACES.       04380000
043900     05  FILLER                  PIC X(1)     VALUE SPACES.       04390000
044000     05  FILLER                  PIC X(7)     VALUE 'JOB ID:'.    04400000
044100     05  AJ-JOB-ID               PIC X(8)     VALUE SPACES.       04410000
044200     05  FILLER                  PIC X(6)     VALUE SPACES.       04420000
044300                                                                  04430000
044400 01  DP-DELETE-PREV-RESULTS-LINE.                                 04440000
044500     05  FILLER                  PIC X(41)    VALUE SPACES.       04450000
044600     05  FILLER                  PIC X(27)    VALUE               04460000
044700         'DELETE PREVIOUS RESULTS FOR'.                           04470000
044800     05  DP-PREV-SQL-MBR-STMTS   PIC ZZZ9     VALUE ZEROS.        04480000
044900     05  FILLER                  PIC X(8)     VALUE ' STMT(S)'.   04490000
045000                                                                  04500000
045100 01  AS-AUDIT-STATEMENT-LINE.                                     04510000
045200     05  FILLER                  PIC X(41)    VALUE SPACES.       04520000
045300     05  FILLER                  PIC X(9)     VALUE 'STATEMENT'.  04530000
045400     05  AS-STATEMENT-NUMBER     PIC ZZZ9     VALUE ZEROS.        04540000
045500     05  FILLER                  PIC X(1)     VALUE ':'.          04550000
045600     05  AS-SQL-ACTION           PIC X(6)     VALUE SPACES.       04560000
045700     05  FILLER                  PIC X(1)     VALUE SPACES.       04570000
045800     05  FILLER                  PIC X(18)    VALUE SPACES.       04580000
045900                                                                  04590000
046000 01  AT-AUDIT-TABLE-LINE.                                         04600000
046100     05  FILLER                  PIC X(42)    VALUE SPACES.       04610000
046200     05  AT-TABLE-OWNER          PIC X(8)     VALUE SPACES.       04620000
046300     05  FILLER                  PIC X(1)     VALUE SPACES.       04630000
046400     05  AT-TABLE-NAME           PIC X(18)    VALUE SPACES.       04640000
046500     05  AT-ROWS-AFFECTED-X      PIC X(6)     VALUE SPACES.       04650000
046600         88  AT-ALL-ROWS-AFFECTED             VALUE '   ALL'.     04660000
046700         88  AT-MAX-DISPLAY-ROWS-AFFECTED     VALUE '999999'.     04670000
046800     05  AT-ROWS-AFFECTED        REDEFINES AT-ROWS-AFFECTED-X     04680000
046900                                 PIC ZZZZZ9.                      04690000
047000     05  AT-ROWS-AFFECTED-CONTINUATION                            04700000
047100                                 PIC X(1)     VALUE SPACES.       04710000
047200         88  AT-GT-DISPLAY-ROWS-AFFECTED      VALUE '+'.          04720000
047300     05  FILLER                  PIC X(4)     VALUE 'ROWS'.       04730000
047400                                                                  04740000
047500 01  AE-AUDIT-ERROR-LINE.                                         04750000
047600     05  FILLER                  PIC X(42)    VALUE SPACES.       04760000
047700     05  AE-ERROR-MESSAGE        PIC X(38)    VALUE SPACES.       04770000
047800     05  FILLER                  REDEFINES AE-ERROR-MESSAGE.      04780000
047900         10  FILLER              PIC X(8).                        04790000
048000             88  AE-SQLCODE-ID                VALUE 'SQLCODE:'.   04800000
048100         10  AE-SQLCODE          PIC X(4).                        04810000
048200         10  FILLER              PIC X(1).                        04820000
048300             88  AE-SQLCODE-MESSAGE-ID        VALUE ';'.          04830000
048400         10  AE-SQLCODE-MESSAGE  PIC X(25).                       04840000
048500                                                                  04850000
048600 01  AN-AUDIT-NO-STATEMENT-LINE.                                  04860000
048700     05  FILLER                  PIC X(41)    VALUE SPACES.       04870000
048800     05  FILLER                  PIC X(32)    VALUE               04880000
048900         '** NO SQL STATEMENTS DETECTED **'.                      04890000
049000     05  FILLER                  PIC X(7)     VALUE SPACES.       04900000
049100                                                                  04910000
049200 01  EN-EMAIL-NOTICE-LINES.                                       04920000
049300     05  EN-TEST-SUBMISSION-NOTE PIC X(80)    VALUE               04930000
049400         '  ***** THIS WAS NOT GENERATED FROM PRODUCTION *****'.  04940000
049500     05  EN-TITLE                PIC X(80)    VALUE               04950000
049600         'PRODUCTION DATA CHANGE RESULTS NOTIFICATION'.           04960000
049700     05  EN-AUDIT-SECTION-TAG    PIC X(80)    VALUE               04970000
049800         'AUDIT LINES:'.                                          04980000
049900     05  EN-CHANGE-MGMT-ACTION-TAG                                04990000
050000                                 PIC X(80)    VALUE               05000000
050100         'REQUIRED CHANGE MANAGEMENT ACTION(S):'.                 05010000
050200     05  EN-LOCATION-SPECIFIED-MSG-1.                             05020000
050300         10  FILLER              PIC X(44)    VALUE               05030000
050400             'PRESUMED 3-PART TABLE NAME DETECTED - CHECK '.      05040000
050500         10  FILLER              PIC X(36)    VALUE               05050000
050600             'IF CORRECT TABLE IMPACTED/IN AUDITS.'.              05060000
050700     05  EN-LOCATION-SPECIFIED-MSG-2.                             05070000
050800         10  FILLER              PIC X(45)    VALUE               05080000
050900             '  PRESUMED QUALIFIED TABLE NAME IN STATEMENT '.     05090000
051000         10  EN-STATEMENT-NUMBER PIC ZZZ9     VALUE ZEROS.        05100000
051100         10  FILLER              PIC X(4)     VALUE ' IS '.       05110000
051200         10  EN-QUALIFIED-TABLE  PIC X(27)    VALUE SPACES.       05120000
051300     05  EN-OVERFLOW-ERROR-MESSAGE.                               05130000
051400         10  FILLER              PIC X(9)     VALUE '** NOTE: '.  05140000
051500         10  EN-CHG-MGMT-DTL-OVERFLOW-LINES                       05150000
051600                                 PIC Z(8)9    VALUE ZEROS.        05160000
051700         10  FILLER              PIC X(62)    VALUE               05170000
051800             ' ADDITIONAL ACTION LINES COULD NOT BE PRESENTED.'.  05180000
051900     05  EN-PARSING-ERROR-MESSAGE.                                05190000
052000         10  FILLER              PIC X(50)    VALUE               05200000
052100             '** NOTE: PARSING ERRORS OCCURRED IN PREPARING THE '.05210000
052200         10  FILLER              PIC X(30)    VALUE               05220000
052300             'AUDIT INFORMATION.'.                                05230000
052400     05  EN-SET-CURRENT-SQLID-MESSAGE-1                           05240000
052500                                 PIC X(80)    VALUE               05250000
052600         '** NOTE: SET CURRENT SQLID SHOULD NOT BE USED.'.        05260000
052700     05  EN-SET-CURRENT-SQLID-MESSAGE-2                           05270000
052800                                 PIC X(80)    VALUE               05280000
052900         '  TABLE NAMES SHOULD BE FULLY QUALIFIED IN THE SQL.'.   05290000
053000     05  EN-SET-CURRENT-SQLID-MESSAGE-3.                          05300000
053100         10  FILLER              PIC X(47)    VALUE               05310000
053200             '  REVIEW AUDIT DETAILS, AND FOLLOW UP WITH THE '.   05320000
053300         10  FILLER              PIC X(53)    VALUE               05330000
053400             'REQUESTER.'.                                        05340000
053500     05  EN-NO-ACTION-MESSAGE    PIC X(80)    VALUE               05350000
053600         'NO ACTIONS REQUIRED.'.                                  05360000
053700     05  EN-REQUESTER-ACTION-TAG PIC X(80)    VALUE               05370000
053800         'REQUIRED REQUESTER ACTION(S):'.                         05380000
053900     05  EN-REVIEW-SYSOUT-DATA-MESSAGE                            05390000
054000                                 PIC X(80)    VALUE               05400000
054100         'REVIEW SYSOUT AND AFFECTED ROWS FOR CORRECT RESULTS.'.  05410000
054200     05  EN-NOT-FOUND-MESSAGE-1.                                  05420000
054300         10  FILLER              PIC X(50)    VALUE               05430000
054400             '** NOTE: THERE WERE STATEMENTS THAT GENERATED "NOT'.05440000
054500         10  FILLER              PIC X(30)    VALUE               05450000
054600             ' FOUND" CONDITIONS.  REVIEW'.                       05460000
054700     05  EN-NOT-FOUND-MESSAGE-2.                                  05470000
054800         10  FILLER              PIC X(50)    VALUE               05480000
054900             '         THE AUDIT AND SYSOUT TO DETERMINE IF THAT'.05490000
055000         10  FILLER              PIC X(30)    VALUE               05500000
055100             ' WAS THE CORRECT RESULT.'.                          05510000
055200     05  EN-FAILURE-MESSAGE.                                      05520000
055300         10  FILLER              PIC X(50)    VALUE               05530000
055400             '** NOTE: THERE WERE FAILURES THAT MUST BE RESOLVED'.05540000
055500         10  FILLER              PIC X(30)    VALUE               05550000
055600             '; REVIEW THE AUDIT AND SYSOUT.'.                    05560000
055700     05  EN-NO-STATEMENT-MESSAGE.                                 05570000
055800         10  FILLER              PIC X(50)    VALUE               05580000
055900             '** NOTE: NO SQL STATEMENTS WERE DETECTED; REVIEW T'.05590000
056000         10  FILLER              PIC X(30)    VALUE               05600000
056100             'HE AUDIT AND SYSOUT.'.                              05610000
056200     05  EN-NO-CHANGE-STATEMENT-MESSAGE.                          05620000
056300         10  FILLER              PIC X(50)    VALUE               05630000
056400             '** NOTE: NO SQL STATEMENTS THAT COULD CHANGE DATA '.05640000
056500         10  FILLER              PIC X(30)    VALUE               05650000
056600             'WERE DETECTED; REVIEW SYSOUT.'.                     05660000
056700     05  EN-NEW-SQL-REQUIRED-MESSAGE.                             05670000
056800         10  FILLER              PIC X(50)    VALUE               05680000
056900             '** NOTE: A NEW SQL MEMBER MUST BE USED TO EXECUTE '.05690000
057000         10  FILLER              PIC X(30)    VALUE               05700000
057100             'CORRECTED SQL STATEMENTS.'.                         05710000
057200                                                                  05720000
057300 01  TD-TOTAL-DISPLAY-MESSAGE.                                    05730000
057400     05  TD-TOTAL-ID             PIC X(51)    VALUE SPACES.       05740000
057500         88  TD-SQL-SYSOUT-RCDS-READ-ID       VALUE               05750000
057600             'SYSOUT RECORDS READ (FROM SQL EXECUTION) . . . . .'.05760000
057700         88  TD-SQL-STATEMENT-COUNT-ID        VALUE               05770000
057800             'SQL INPUT STATEMENTS FOUND . . . . . . . . . . . .'.05780000
057900         88  TD-SQL-STATEMENT-LOG-COUNT-ID    VALUE               05790000
058000             'SQL INPUT STATEMENTS W/CHGS EXECUTED & LOGGED  . .'.05800000
058100         88  TD-RES-AUDIT-RCDS-WRITTEN-ID     VALUE               05810000
058200             'PRODUCTION DATA CHANGE AUDIT RECORDS WRITTEN . . .'.05820000
058300         88  TD-RES-EMAIL-RCDS-WRITTEN-ID     VALUE               05830000
058400             'E-MAIL NOTIFICATION MESSAGE RECORDS WRITTEN  . . .'.05840000
058500     05  TD-TOTAL-AMOUNT         PIC Z,ZZZ,ZZ9                    05850000
058600                                              VALUE ZEROS.        05860000
058700                                                                  05870000
058800*                                                                 05880000
058900*  SQL AND COBOL DECLARATIONS FOR THE PRODUCTION DATA CHANGE      05890000
059000*  RESULTS TABLE (TCMCHNG)                                        05900000
059100*                                                                 05910000
059200                                                                  05920000
059300     EXEC SQL                                                     05930000
059400         INCLUDE TCMCHNG                                          05940000
059500     END-EXEC.                                                    05950000
059600                                                                  05960000
059700*                                                                 05970000
059800*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                05980000
059900*                                                                 05990000
060000                                                                  06000000
060100     EXEC SQL                                                     06010000
060200         INCLUDE SQLCA                                            06020000
060300     END-EXEC.                                                    06030000
060400                                                                  06040000
060500******************************************************************06050000
060600 PROCEDURE DIVISION.                                              06060000
060700******************************************************************06070000
060800                                                                  06080000
060900 0000-MAINLINE.                                                   06090000
061000                                                                  06100000
061100     PERFORM 1000-INITIALIZE.                                     06110000
061200                                                                  06120000
061300     PERFORM 2000-PROCESS-INPUT-STATEMENT                         06130000
061400         UNTIL PS-END-OF-SYSOUT-FILE                              06140000
061500                                                                  06150000
061600     IF (PT-SQL-STATEMENT-COUNT = 0)                              06160000
061700         MOVE AN-AUDIT-NO-STATEMENT-LINE TO                       06170000
061800                   RA-RESULTS-AUDIT-RECORD                        06180000
061900                   RE-RESULTS-EMAIL-RECORD                        06190000
062000         PERFORM 8000-WRITE-RES-AUDIT-RECORD                      06200000
062100         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06210000
062200     END-IF.                                                      06220000
062300                                                                  06230000
062400*                                                                 06240000
062500*  COMPLETE THE E-MAIL COMMUNICATION BY ADDING SECTIONS FOR       06250000
062600*  CHANGE MANAGEMENT AND REQUESTER ISSUES AND CORRECTIVE ACTIONS. 06260000
062700*                                                                 06270000
062800                                                                  06280000
062900     INITIALIZE RE-RESULTS-EMAIL-RECORD.                          06290000
063000     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         06300000
063100     MOVE EN-CHANGE-MGMT-ACTION-TAG TO RE-RESULTS-EMAIL-RECORD.   06310000
063200     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         06320000
063300     IF (PV-CHG-MGMT-DTL-ACTION-LINE > ZERO)                      06330000
063400         PERFORM                                                  06340000
063500                 VARYING CM-INDEX                                 06350000
063600                 FROM 1 BY 1                                      06360000
063700                 UNTIL CM-INDEX > PV-CHG-MGMT-DTL-ACTION-LINE     06370000
063800             MOVE CM-CHG-MGMT-DTL-ACTION-LINE (CM-INDEX) TO       06380000
063900                       RE-RESULTS-EMAIL-RECORD                    06390000
064000             PERFORM 8100-WRITE-RES-EMAIL-RECORD                  06400000
064100         END-PERFORM                                              06410000
064200     END-IF.                                                      06420000
064300     IF PV-CHG-MGMT-DTL-OVERFLOW-LINES > ZERO                     06430000
064400         MOVE PV-CHG-MGMT-DTL-OVERFLOW-LINES TO                   06440000
064500                   EN-CHG-MGMT-DTL-OVERFLOW-LINES                 06450000
064600         MOVE EN-OVERFLOW-ERROR-MESSAGE TO RE-RESULTS-EMAIL-RECORD06460000
064700         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06470000
064800     END-IF.                                                      06480000
064900     IF RS-PARSING-ERRORS-DETECTED                                06490000
065000         MOVE EN-PARSING-ERROR-MESSAGE TO RE-RESULTS-EMAIL-RECORD 06500000
065100         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06510000
065200     ELSE                                                         06520000
065300         MOVE EN-NO-ACTION-MESSAGE TO RE-RESULTS-EMAIL-RECORD     06530000
065400         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06540000
065500     END-IF.                                                      06550000
065600     INITIALIZE RE-RESULTS-EMAIL-RECORD.                          06560000
065700     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         06570000
065800     MOVE EN-REQUESTER-ACTION-TAG TO RE-RESULTS-EMAIL-RECORD.     06580000
065900     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         06590000
066000     MOVE EN-REVIEW-SYSOUT-DATA-MESSAGE TO                        06600000
066100               RE-RESULTS-EMAIL-RECORD.                           06610000
066200     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         06620000
066300     IF RS-NOT-FOUND-STMT-FOUND                                   06630000
066400         MOVE EN-NOT-FOUND-MESSAGE-1 TO RE-RESULTS-EMAIL-RECORD   06640000
066500         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06650000
066600         MOVE EN-NOT-FOUND-MESSAGE-2 TO RE-RESULTS-EMAIL-RECORD   06660000
066700         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06670000
066800     END-IF.                                                      06680000
066900     IF RS-UNSUCCESSFUL-STMT-FOUND                                06690000
067000         MOVE EN-FAILURE-MESSAGE TO RE-RESULTS-EMAIL-RECORD       06700000
067100         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      06710000
067200         IF RS-SUCCESSFUL-STMT-FOUND                              06720000
067300             MOVE EN-NEW-SQL-REQUIRED-MESSAGE TO                  06730000
067400                       RE-RESULTS-EMAIL-RECORD                    06740000
067500             PERFORM 8100-WRITE-RES-EMAIL-RECORD                  06750000
067600         END-IF                                                   06760000
067700     ELSE                                                         06770000
067800         IF RS-NO-SUCCESSFUL-STMT-FOUND                           06780000
067900             IF (PT-SQL-STATEMENT-COUNT = 0)                      06790000
068000                 MOVE EN-NO-STATEMENT-MESSAGE TO                  06800000
068100                           RE-RESULTS-EMAIL-RECORD                06810000
068200                 PERFORM 8100-WRITE-RES-EMAIL-RECORD              06820000
068300             ELSE                                                 06830000
068400                 IF (PT-SQL-STATEMENT-LOG-COUNT = 0)              06840000
068500                     MOVE EN-NO-CHANGE-STATEMENT-MESSAGE TO       06850000
068600                               RE-RESULTS-EMAIL-RECORD            06860000
068700                     PERFORM 8100-WRITE-RES-EMAIL-RECORD          06870000
068800                 END-IF                                           06880000
068900             END-IF                                               06890000
069000         END-IF                                                   06900000
069100     END-IF.                                                      06910000
069200                                                                  06920000
069300     PERFORM 1500-DISPLAY-PROGRAM-TOTALS.                         06930000
069400                                                                  06940000
069500*                                                                 06950000
069600*  FORMAT AND WRITE OUT THE SQL EXECUTION RESULTS SUMMARY RECORD  06960000
069700*  FOR USE IN FINALIZING THE AUDIT.                               06970000
069800*                                                                 06980000
069900                                                                  06990000
070000     MOVE AH-SQL-MEMBER-NAME TO RS-SQL-MEMBER-NAME.               07000000
070100     MOVE AR-RELEASED-BY-USERID TO RS-RELEASED-BY-USERID.         07010000
070200     MOVE PT-SQL-STATEMENT-COUNT TO RS-SQL-STATEMENT-COUNT.       07020000
070300     MOVE PT-SQL-STATEMENT-LOG-COUNT TO                           07030000
070400               RS-SQL-STATEMENT-LOG-COUNT.                        07040000
070500     PERFORM 8400-WRITE-RES-SUMMARY-RECORD.                       07050000
070600                                                                  07060000
070700     PERFORM 9000-EOJ-ROUTINE.                                    07070000
070800                                                                  07080000
070900*                                                                 07090000
071000*  SET FINAL RETURN CODE FOR ISSUES THAT REQUIRE SPECIFIC         07100000
071100*  FOLLOW-UP AND DISTINCT PROBLEM TICKET ROUTING.                 07110000
071200*                                                                 07120000
071300                                                                  07130000
071400     IF RS-NO-SUCCESSFUL-STMT-FOUND                               07140000
071500         IF ((PT-SQL-STATEMENT-COUNT = 0)                         07150000
071600                 OR (PT-SQL-STATEMENT-LOG-COUNT = 0))             07160000
071700             MOVE PC-NO-STMT-FOUND-RET-CODE TO RETURN-CODE        07170000
071800         ELSE                                                     07180000
071900             MOVE PC-NO-SUCCESSFUL-STMT-RET-CODE TO RETURN-CODE   07190000
072000         END-IF                                                   07200000
072100     ELSE                                                         07210000
072200         IF RS-PARSING-ERRORS-DETECTED                            07220000
072300             MOVE PC-PARSING-ERRORS-RET-CODE TO RETURN-CODE       07230000
072400         END-IF                                                   07240000
072500     END-IF.                                                      07250000
072600                                                                  07260000
072700     GOBACK.                                                      07270000
072800                                                                  07280000
072900******************************************************************07290000
073000*  INITIALIZE FOR PROGRAM PROCESSING.  ACCEPT AND VALIDATE THE   *07300000
073100*  RELEASED BY USERID CONTROL CARD.  OPEN ALL FILES.  SET UP THE *07310000
073200*  DATE AND TIME OF THIS AUDIT.  READ THE PRODUCTION DATA CHANGE *07320000
073300*  CONTROL FILE CREATED DURING THE STAGING REQUEST AND SAVE THE  *07330000
073400*  INFORMATION.  GET THE CURRENT JOB INFORMATION FOR USE IN THE  *07340000
073500*  AUDIT AND COMMUNICATIONS.  READ THE SQL EXECUTION SYSOUT      *07350000
073600*  FILE UNTIL THE DELIMITER FOR THE FIRST INPUT STATEMENT IS     *07360000
073700*  FOUND.  SET UP THE PRELIMINARY AUDIT AND E-MAIL COMMUNICATION *07370000
073800*  INFORMATION, AND WRITE OUT ALL OPENING/HEADER INFORMATION.    *07380000
073900*  CHECK TCMCHNG FOR PREVIOUSLY LOGGED RESULTS FOR THIS SQL      *07390000
074000*  MEMBER, AND IF SO, DELETE THEM AND ADD THAT INFORMATION TO    *07400000
074100*  THE AUDIT.                                                    *07410000
074200******************************************************************07420000
074300                                                                  07430000
074400 1000-INITIALIZE.                                                 07440000
074500     ACCEPT CC-CONTROL-CARD.                                      07450000
074600     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD = ('       07460000
074700               CC-CONTROL-CARD-DISPLAY  ')'.                      07470000
074800                                                                  07480000
074900     MOVE 0 TO PV-TALLY.                                          07490000
075000*                                                                 07500000
075100*  WHILE USERIDS REMAIN SEVEN CHARACTERS, THIS CHECK WILL ENSURE  07510000
075200*  COMPLETE ENTRY.  THIS MAY BECOME EIGHT OR EITHER SEVEN OR EIGHT07520000
075300*  IN THE FUTURE.                                                 07530000
075400*                                                                 07540000
075500     INSPECT CC-RELEASED-BY-USERID (1:7)                          07550000
075600         TALLYING PV-TALLY                                        07560000
075700         FOR ALL SPACES LOW-VALUES.                               07570000
075800     IF ((PV-TALLY > 0)                                           07580000
075900             OR (CC-CONTROL-CARD-FILLER NOT = SPACES))            07590000
076000         DISPLAY '** ABEND **'                                    07600000
076100         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD '      07610000
076200                   'MUST BE A SEVEN-CHARACTER "RELEASED BY" '     07620000
076300                   'USERID'                                       07630000
076400         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - COMPLETE CONTROL '  07640000
076500                   'CARD = ('  CC-CONTROL-CARD  ')'               07650000
076600         SET AC-CONTROL-CARD-ERROR TO TRUE                        07660000
076700         CALL 'ILBOABN0' USING ABEND-CODE                         07670000
076800     ELSE                                                         07680000
076900         MOVE CC-RELEASED-BY-USERID TO AR-RELEASED-BY-USERID      07690000
077000     END-IF.                                                      07700000
077100                                                                  07710000
077200     OPEN INPUT SQL-EXEC-SYSOUT-FILE                              07720000
077300                PROD-DATA-CNTL-FILE                               07730000
077400          OUTPUT RESULTS-AUDIT-FILE                               07740000
077500                 RESULTS-EMAIL-FILE                               07750000
077600                 RESULTS-SUMMARY-FILE.                            07760000
077700                                                                  07770000
077800     MOVE FUNCTION CURRENT-DATE (1:4) TO AH-AD-YEAR               07780000
077900                                         PV-AT-YEAR.              07790000
078000     MOVE FUNCTION CURRENT-DATE (5:2) TO AH-AD-MONTH              07800000
078100                                         PV-AT-MONTH.             07810000
078200     MOVE FUNCTION CURRENT-DATE (7:2) TO AH-AD-DAY                07820000
078300                                         PV-AT-DAY.               07830000
078400     MOVE FUNCTION CURRENT-DATE (9:2) TO AH-AT-HOUR               07840000
078500                                         PV-AT-HOUR.              07850000
078600     MOVE FUNCTION CURRENT-DATE (11:2) TO AH-AT-MINUTE            07860000
078700                                          PV-AT-MINUTE.           07870000
078800     MOVE FUNCTION CURRENT-DATE (13:2) TO AH-AT-SECOND            07880000
078900                                          PV-AT-SECOND.           07890000
079000     INITIALIZE PV-CHG-MGMT-DTL-ACTION-LINE                       07900000
079100                PV-CHG-MGMT-DTL-OVERFLOW-LINES                    07910000
079200                CM-CHG-MGMT-DTL-ACTION-LINES.                     07920000
079300     SET CM-INDEX TO 1.                                           07930000
079400                                                                  07940000
079500*                                                                 07950000
079600*  READ THE PRODUCTION DATA CHANGE CONTROL FILE CREATED DURING THE07960000
079700*  STAGING REQUEST AND ADD THAT INFORMATION INTO THE AUDIT LINES. 07970000
079800*                                                                 07980000
079900                                                                  07990000
080000     PERFORM 7000-READ-DATA-CHG-CNTL-FILE.                        08000000
080100                                                                  08010000
080200     IF (NOT PS-END-OF-CNTL-FILE)                                 08020000
080300         PERFORM 7000-READ-DATA-CHG-CNTL-FILE                     08030000
080400         IF (NOT PS-END-OF-CNTL-FILE)                             08040000
080500             DISPLAY '** ABEND **'                                08050000
080600             DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MULTIPLE '      08060000
080700                       'PRODUCTION DATA CHANGE CONTROL CARDS '    08070000
080800                       'DETECTED'                                 08080000
080900             SET AC-FILE-SEQUENCE-ERROR TO TRUE                   08090000
081000             CALL 'ILBOABN0' USING ABEND-CODE                     08100000
081100         END-IF                                                   08110000
081200     ELSE                                                         08120000
081300         DISPLAY '** ABEND **'                                    08130000
081400         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - NO '                08140000
081500                   'PRODUCTION DATA CHANGE CONTROL CARD '         08150000
081600                   'DETECTED'                                     08160000
081700         SET AC-FILE-SEQUENCE-ERROR TO TRUE                       08170000
081800         CALL 'ILBOABN0' USING ABEND-CODE                         08180000
081900     END-IF.                                                      08190000
082000                                                                  08200000
082100     MOVE CM001-SQL-MEMBER-NAME TO AH-SQL-MEMBER-NAME.            08210000
082200     MOVE CM001-REQUESTER-USERID TO AH-REQUESTER-USERID.          08220000
082300     MOVE CM001-REQUESTER-MANAGER-USERID TO                       08230000
082400               AR-REQUESTER-MANAGER-USERID.                       08240000
082500     MOVE CM001-SUBSYSTEM-ID TO AR-SUBSYSTEM-ID.                  08250000
082600     MOVE CM001-REQUEST-REASON TO AH-REQUEST-REASON.              08260000
082700                                                                  08270000
082800*                                                                 08280000
082900*  GET CURRENT JOB INFORMATION FOR USE IN THE AUDIT AND           08290000
083000*  COMMUNICATIONS.                                                08300000
083100*                                                                 08310000
083200                                                                  08320000
083300     CALL DP085-GET-CURR-JOB-INFO-PGM                             08330000
083400         USING DP085-GET-CURR-JOB-INFO-PARMS.                     08340000
083500     MOVE DP085-JOB-NAME TO AJ-JOB-NAME.                          08350000
083600     MOVE DP085-JOB-NUMBER TO AJ-JOB-ID.                          08360000
083700                                                                  08370000
083800     PERFORM 7200-READ-SQL-SYSOUT-FILE                            08380000
083900         WITH TEST AFTER                                          08390000
084000         UNTIL ((PS-END-OF-SYSOUT-FILE)                           08400000
084100                 OR (SS-INPUT-STATEMENT-ID)).                     08410000
084200                                                                  08420000
084300*                                                                 08430000
084400*  WRITE OUT TITLE AND OPENING INFORMATION TO THE E-MAIL          08440000
084500*  COMMUNICATION FILE.                                            08450000
084600*                                                                 08460000
084700                                                                  08470000
084800     IF (AJ-JOB-NAME(1:2) = PC-TEST-JOB-NAME-PREFIX)              08480000
084900         MOVE EN-TEST-SUBMISSION-NOTE TO RE-RESULTS-EMAIL-RECORD  08490000
085000         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      08500000
085100     END-IF.                                                      08510000
085200     MOVE EN-TITLE TO RE-RESULTS-EMAIL-RECORD.                    08520000
085300     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         08530000
085400     INITIALIZE RE-RESULTS-EMAIL-RECORD.                          08540000
085500     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         08550000
085600     MOVE EN-AUDIT-SECTION-TAG TO RE-RESULTS-EMAIL-RECORD.        08560000
085700     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         08570000
085800                                                                  08580000
085900*                                                                 08590000
086000*  SET UP AND WRITE OUT AUDIT AND E-MAIL COMMUNICATION HEADING AND08600000
086100*  REQUEST LEVEL PRE-EXECUTION INFORMATION                        08610000
086200*                                                                 08620000
086300                                                                  08630000
086400     MOVE AH-AUDIT-HEADER-LINE TO RA-RESULTS-AUDIT-RECORD         08640000
086500                                  RE-RESULTS-EMAIL-RECORD.        08650000
086600     PERFORM 8000-WRITE-RES-AUDIT-RECORD.                         08660000
086700     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         08670000
086800                                                                  08680000
086900     MOVE AR-AUDIT-RELEASE-LINE TO RA-RESULTS-AUDIT-RECORD        08690000
087000                                   RE-RESULTS-EMAIL-RECORD.       08700000
087100     PERFORM 8000-WRITE-RES-AUDIT-RECORD.                         08710000
087200     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         08720000
087300                                                                  08730000
087400     MOVE AJ-AUDIT-JOB-LINE TO RA-RESULTS-AUDIT-RECORD            08740000
087500                               RE-RESULTS-EMAIL-RECORD.           08750000
087600     PERFORM 8000-WRITE-RES-AUDIT-RECORD.                         08760000
087700     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         08770000
087800                                                                  08780000
087900*                                                                 08790000
088000*  CHECK TCMCHNG FOR PREVIOUSLY LOGGED RESULTS FOR THIS SQL       08800000
088100*  MEMBER.  IF STATEMENTS WERE PREVIOUSLY LOGGED, DELETE THEM     08810000
088200*  AND ADD A COUNT OF DELETED STATEMENTS TO THE AUDIT.            08820000
088300*                                                                 08830000
088400                                                                  08840000
088500     MOVE AH-SQL-MEMBER-NAME TO CMCHNG-SQL-MEM-NM.                08850000
088600     MOVE +0 TO PV-PREV-SQL-MBR-STMTS.                            08860000
088700     PERFORM 7100-COUNT-PREVIOUS-RESULTS.                         08870000
088800                                                                  08880000
088900     IF (PV-PREV-SQL-MBR-STMTS > 0)                               08890000
089000         PERFORM 8200-DELETE-PREVIOUS-RESULTS                     08900000
089100         MOVE PV-PREV-SQL-MBR-STMTS TO                            08910000
089200                   DP-PREV-SQL-MBR-STMTS                          08920000
089300         MOVE DP-DELETE-PREV-RESULTS-LINE TO                      08930000
089400                   RA-RESULTS-AUDIT-RECORD                        08940000
089500                   RE-RESULTS-EMAIL-RECORD                        08950000
089600         PERFORM 8000-WRITE-RES-AUDIT-RECORD                      08960000
089700         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      08970000
089800     END-IF.                                                      08980000
089900*1000-EXIT.                                                       08990000
090000                                                                  09000000
090100******************************************************************09010000
090200*  DISPLAY SUMMARY TOTALS OF I/O ACTIVITY.                       *09020000
090300******************************************************************09030000
090400                                                                  09040000
090500 1500-DISPLAY-PROGRAM-TOTALS.                                     09050000
090600     SET TD-SQL-SYSOUT-RCDS-READ-ID TO TRUE.                      09060000
090700     MOVE PT-SQL-SYSOUT-RCDS-READ TO TD-TOTAL-AMOUNT.             09070000
090800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       09080000
090900               TD-TOTAL-DISPLAY-MESSAGE.                          09090000
091000                                                                  09100000
091100     SET TD-SQL-STATEMENT-COUNT-ID TO TRUE.                       09110000
091200     MOVE PT-SQL-STATEMENT-COUNT TO TD-TOTAL-AMOUNT.              09120000
091300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       09130000
091400               TD-TOTAL-DISPLAY-MESSAGE.                          09140000
091500                                                                  09150000
091600     SET TD-SQL-STATEMENT-LOG-COUNT-ID TO TRUE.                   09160000
091700     MOVE PT-SQL-STATEMENT-LOG-COUNT TO TD-TOTAL-AMOUNT.          09170000
091800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       09180000
091900               TD-TOTAL-DISPLAY-MESSAGE.                          09190000
092000                                                                  09200000
092100     DISPLAY ' '.                                                 09210000
092200                                                                  09220000
092300     SET TD-RES-AUDIT-RCDS-WRITTEN-ID TO TRUE.                    09230000
092400     MOVE PT-RES-AUDIT-RCDS-WRITTEN TO TD-TOTAL-AMOUNT.           09240000
092500     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       09250000
092600               TD-TOTAL-DISPLAY-MESSAGE.                          09260000
092700                                                                  09270000
092800     SET TD-RES-EMAIL-RCDS-WRITTEN-ID TO TRUE.                    09280000
092900     MOVE PT-RES-EMAIL-RCDS-WRITTEN TO TD-TOTAL-AMOUNT.           09290000
093000     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       09300000
093100               TD-TOTAL-DISPLAY-MESSAGE.                          09310000
093200*1500-EXIT.                                                       09320000
093300                                                                  09330000
093400******************************************************************09340000
093500*  PROCESS AN INPUT STATEMENT AS IDENTIFIED BY PARSING THROUGH   *09350000
093600*  THE RELATED LINES OF THE SQL EXECUTION SYSOUT FILE.  THE      *09360000
093700*  FILE WILL BE POSITIONED AT AN INPUT STATEMENT DELIMITER.      *09370000
093800*  READ TO THE NEXT RECORD, AND EVALUATE THE SQL STATEMENT       *09380000
093900*  IDENTIFIED TO CAPTURE INFORMATION ABOUT THE REQUEST.  READ    *09390000
094000*  AHEAD TO THE NEXT SIGNIFICANT SECTION OF THE SYSOUT:  AN      *09400000
094100*  ERROR INDICATION LINE, THE START OF THE RESULTS SPECIFICATION *09410000
094200*  OR THE NEXT INPUT STATEMENT.  IF THE NEXT SIGNIFICANT AREA    *09420000
094300*  IS AN ERROR INDICATION LINE, FLAG THE ERROR, AND READ AHEAD   *09430000
094400*  TO THE NEXT SIGNIFICANT SECTION OF THE SYSOUT.  IF THE NEXT   *09440000
094500*  SIGNIFICANT AREA IS THE START OF THE RESULTS SPECIFICATION,   *09450000
094600*  CAPTURE THE RESULTS UP TO THE START OF THE NEXT INPUT         *09460000
094700*  STATEMENT.  IF THE RESULTS OF THE EXECUTION OF THE SQL INPUT  *09470000
094800*  STATEMENT HAVE NOT ALREADY BEEN POSTED AS A RESULT OF THE     *09480000
094900*  STANDARD SEQUENTIAL PRESENTATION OF RESULTS IN THE SYSOUT,    *09490000
095000*  AND SOME PORTION OF RESULTS THAT COULD RELATE TO A SQL        *09500000
095100*  STATEMENT THAT COULD CHANGE DATA HAS BEEN COLLECTED, WRITE    *09510000
095200*  OUT THE DETAIL AT THIS TIME (KNOWN END OF SYSOUT REGARDING    *09520000
095300*  THAT STATEMENT).                                              *09530000
095400******************************************************************09540000
095500                                                                  09550000
095600 2000-PROCESS-INPUT-STATEMENT.                                    09560000
095700     ADD +1 TO PT-SQL-STATEMENT-COUNT.                            09570000
095800                                                                  09580000
095900     INITIALIZE SI-STATEMENT-INFORMATION.                         09590000
096000     MOVE ZEROS TO SI-ROWS-AFFECTED.                              09600000
096100                                                                  09610000
096200     PERFORM 7200-READ-SQL-SYSOUT-FILE                            09620000
096300         WITH TEST AFTER                                          09630000
096400         UNTIL ((PS-END-OF-SYSOUT-FILE)                           09640000
096500                 OR (SS-SQL-SYSOUT-RECORD NOT = SPACES)).         09650000
096600                                                                  09660000
096700     PERFORM 2100-EVALUATE-SQL-STATEMENT.                         09670000
096800                                                                  09680000
096900*                                                                 09690000
097000*  READ AHEAD TO THE NEXT SIGNIFICANT SECTION OF THE SYSOUT:  AN  09700000
097100*  ERROR INDICATION LINE, THE START OF THE RESULTS SPECIFICATION, 09710000
097200*  OR THE NEXT INPUT STATEMENT.                                   09720000
097300*                                                                 09730000
097400                                                                  09740000
097500     PERFORM 7200-READ-SQL-SYSOUT-FILE                            09750000
097600         UNTIL ((PS-END-OF-SYSOUT-FILE)                           09760000
097700                 OR (SS-SQL-ERROR-ID)                             09770000
097800                 OR (SS-SQL-RESULT-ID)                            09780000
097900                 OR (SS-INPUT-STATEMENT-ID)).                     09790000
098000                                                                  09800000
098100*                                                                 09810000
098200*  IF THE NEXT SIGNIFICANT AREA IS AN ERROR INDICATION LINE, FLAG 09820000
098300*  THE ERROR, AND READ AHEAD TO THE NEXT SIGNIFICANT SECTION OF   09830000
098400*  THE SYSOUT.                                                    09840000
098500*                                                                 09850000
098600                                                                  09860000
098700     IF SS-SQL-ERROR-ID                                           09870000
098800         SET SI-SE-SQL-ERROR-LINE-FOUND TO TRUE                   09880000
098900         PERFORM 7200-READ-SQL-SYSOUT-FILE                        09890000
099000             UNTIL ((PS-END-OF-SYSOUT-FILE)                       09900000
099100                     OR (SS-SQL-RESULT-ID)                        09910000
099200                     OR (SS-INPUT-STATEMENT-ID))                  09920000
099300     END-IF.                                                      09930000
099400                                                                  09940000
099500     SET SI-SD-STMT-DTL-NOT-WRITTEN TO TRUE.                      09950000
099600                                                                  09960000
099700*                                                                 09970000
099800*  IF THE NEXT SIGNIFICANT AREA IS THE START OF THE RESULTS       09980000
099900*  SPECIFICATION, CAPTURE THE RESULTS UP TO THE START OF THE      09990000
100000*  NEXT INPUT STATEMENT.                                          10000000
100100*                                                                 10010000
100200                                                                  10020000
100300     IF SS-SQL-RESULT-ID                                          10030000
100400         PERFORM 2200-EVALUATE-SQL-RESULT                         10040000
100500             UNTIL ((PS-END-OF-SYSOUT-FILE)                       10050000
100600                     OR (SS-INPUT-STATEMENT-ID))                  10060000
100700     END-IF.                                                      10070000
100800                                                                  10080000
100900     IF (SI-ROWS-AFFECTED-X NOT NUMERIC)                          10090000
101000         MOVE ZERO TO SI-ROWS-AFFECTED                            10100000
101100     END-IF.                                                      10110000
101200                                                                  10120000
101300*                                                                 10130000
101400*  IF THE RESULTS OF THE EXECUTION OF THE SQL INPUT STATEMENT     10140000
101500*  HAVE NOT ALREADY BEEN POSTED AS A RESULT OF THE STANDARD       10150000
101600*  SEQUENTIAL PRESENTATION OF RESULTS IN THE SYSOUT, AND SOME     10160000
101700*  PORTION OF RESULTS THAT COULD RELATE TO A SQL STATEMENT THAT   10170000
101800*  COULD CHANGE DATA HAS BEEN COLLECTED, WRITE OUT THE DETAIL AT  10180000
101900*  THIS TIME (KNOWN END OF SYSOUT REGARDING THAT STATEMENT).      10190000
102000*                                                                 10200000
102100                                                                  10210000
102200     IF ((SI-SD-STMT-DTL-NOT-WRITTEN)                             10220000
102300             AND (NOT SI-SA-SELECT)                               10230000
102400             AND ((SI-TABLE-OWNER NOT = SPACES)                   10240000
102500             OR (SI-TABLE-NAME NOT = SPACES)                      10250000
102600             OR (SI-ROWS-AFFECTED > ZEROS)                        10260000
102700             OR (SI-SE-SQL-ERROR-LINE-FOUND)                      10270000
102800             OR ((SI-SQLCODE NOT = SPACES)                        10280000
102900             AND (NOT SI-SUCCESSFUL-SQLCODE))))                   10290000
103000         PERFORM 3000-WRITE-STATEMENT-DETAIL                      10300000
103100     END-IF.                                                      10310000
103200*2000-EXIT.                                                       10320000
103300                                                                  10330000
103400******************************************************************10340000
103500*  EVALUATE THE SQL STATEMENT REPRESENTED IN THE INPUT STATEMENT *10350000
103600*  OF THE SYSOUT EXECUTION RESULTS.  PARSING WILL CONTINUE       *10360000
103700*  DYNAMICALLY WORD BY WORD, AND LINE BY LINE UNTIL THE          *10370000
103800*  REQUESTED ACTION AND THE TABLE INFORMATION HAS BEEN           *10380000
103900*  IDENTIFIED.  GENERATE A PARSING ERROR IF AN UNKNOWN STATEMENT *10390000
104000*  HAS BEEN DETECTED, OR IT APPEARS IN AN UNRECOGNIZABLE FORMAT. *10400000
104100*  BASED ON THE ACTION IDENTIFIED, DETERMINE IF A TABLE NAME     *10410000
104200*  IS TO BE IDENTIFIED, AND WHAT KEYWORDS MAY APPEAR BEFORE      *10420000
104300*  THE TABLE NAME.  SKIP OVER ANY PAGE ADVANCES IN THE SYSOUT    *10430000
104400*  REPORT, AND UNSTRING EACH NEW LINE INTO WORD COMPONENTS,      *10440000
104500*  SHIFTING EACH WORD UP ONE WORD POSITION AS EACH WORD IS       *10450000
104600*  POSITIONALLY EVALUATED.  REMOVE THE KEYWORD REQUIREMENT AS    *10460000
104700*  ANY REQUIRED KEYWORD IS DETECTED.  PARSE A FULLY QUALIFIED    *10470000
104800*  TABLE NAME INTO TABLE OWNER AND TABLE NAME.                   *10480000
104900******************************************************************10490000
105000                                                                  10500000
105100 2100-EVALUATE-SQL-STATEMENT.                                     10510000
105200     PERFORM 5000-UNSTRING-SYSOUT-LINE.                           10520000
105300                                                                  10530000
105400     MOVE UA-WORD-1 TO SI-SQL-ACTION.                             10540000
105500                                                                  10550000
105600     EVALUATE TRUE                                                10560000
105700         WHEN SI-SA-INSERT                                        10570000
105800             SET SI-SK-INTO TO TRUE                               10580000
105900             SET SI-SS-KEYWORD-TABLE-NAME-REQD TO TRUE            10590000
106000         WHEN SI-SA-UPDATE                                        10600000
106100             SET SI-SK-NONE TO TRUE                               10610000
106200             SET SI-SS-JUST-TABLE-NAME-REQD TO TRUE               10620000
106300         WHEN SI-SA-DELETE                                        10630000
106400             SET SI-SK-FROM TO TRUE                               10640000
106500             SET SI-SS-KEYWORD-TABLE-NAME-REQD TO TRUE            10650000
106600         WHEN SI-SA-SELECT                                        10660000
106700             SET SI-SK-NONE TO TRUE                               10670000
106800             SET SI-SS-NO-TABLE-NAME-REQD TO TRUE                 10680000
106900         WHEN SI-SA-COMMIT                                        10690000
107000             SET SI-SK-NONE TO TRUE                               10700000
107100             SET SI-SS-NO-TABLE-NAME-REQD TO TRUE                 10710000
107200         WHEN SI-SA-LOCK                                          10720000
107300             SET SI-SK-NONE TO TRUE                               10730000
107400             SET SI-SS-NO-TABLE-NAME-REQD TO TRUE                 10740000
107500         WHEN SI-SA-SET                                           10750000
107600             SET SI-SK-NONE TO TRUE                               10760000
107700             SET SI-SS-NO-TABLE-NAME-REQD TO TRUE                 10770000
107800             SET RS-PARSING-ERRORS-DETECTED TO TRUE               10780000
107900             IF ((PV-CHG-MGMT-DTL-ACTION-LINE + 2) <              10790000
108000                                    PV-MAX-CHG-MGMT-DTL-ACT-LINES)10800000
108100                 MOVE EN-SET-CURRENT-SQLID-MESSAGE-1 TO           10810000
108200                           CM-CHG-MGMT-DTL-ACTION-LINE (CM-INDEX) 10820000
108300                 ADD +1 TO PV-CHG-MGMT-DTL-ACTION-LINE            10830000
108400                 SET CM-INDEX UP BY 1                             10840000
108500                 MOVE EN-SET-CURRENT-SQLID-MESSAGE-2 TO           10850000
108600                           CM-CHG-MGMT-DTL-ACTION-LINE (CM-INDEX) 10860000
108700                 ADD +1 TO PV-CHG-MGMT-DTL-ACTION-LINE            10870000
108800                 SET CM-INDEX UP BY 1                             10880000
108900                 MOVE EN-SET-CURRENT-SQLID-MESSAGE-3 TO           10890000
109000                           CM-CHG-MGMT-DTL-ACTION-LINE (CM-INDEX) 10900000
109100                 ADD +1 TO PV-CHG-MGMT-DTL-ACTION-LINE            10910000
109200                 SET CM-INDEX UP BY 1                             10920000
109300             ELSE                                                 10930000
109400                 ADD +3 TO PV-CHG-MGMT-DTL-OVERFLOW-LINES         10940000
109500             END-IF                                               10950000
109600         WHEN OTHER                                               10960000
109700             SET RS-PARSING-ERRORS-DETECTED TO TRUE               10970000
109800             MOVE PT-SQL-STATEMENT-COUNT TO AS-STATEMENT-NUMBER   10980000
109900             MOVE SI-SQL-ACTION TO SI-ORIGINAL-SQL-ACTION         10990000
110000             SET SI-SA-UNKNOWN TO TRUE                            11000000
110100             MOVE SI-SQL-ACTION TO AS-SQL-ACTION                  11010000
110200             MOVE AS-AUDIT-STATEMENT-LINE TO                      11020000
110300                       RA-RESULTS-AUDIT-RECORD                    11030000
110400                       RE-RESULTS-EMAIL-RECORD                    11040000
110500             PERFORM 8000-WRITE-RES-AUDIT-RECORD                  11050000
110600             PERFORM 8100-WRITE-RES-EMAIL-RECORD                  11060000
110700             INITIALIZE AE-ERROR-MESSAGE                          11070000
110800             STRING 'UNKNOWN SQL ACTION OF "'  DELIMITED BY SIZE  11080000
110900                    SI-ORIGINAL-SQL-ACTION     DELIMITED BY SIZE  11090000
111000                    '" PARSED'                 DELIMITED BY SIZE  11100000
111100                 INTO AE-ERROR-MESSAGE                            11110000
111200             MOVE AE-AUDIT-ERROR-LINE TO RA-RESULTS-AUDIT-RECORD  11120000
111300                                         RE-RESULTS-EMAIL-RECORD  11130000
111400             PERFORM 8000-WRITE-RES-AUDIT-RECORD                  11140000
111500             PERFORM 8100-WRITE-RES-EMAIL-RECORD                  11150000
111600             SET SI-SK-NONE TO TRUE                               11160000
111700             SET SI-SS-NO-TABLE-NAME-REQD TO TRUE                 11170000
111800     END-EVALUATE.                                                11180000
111900                                                                  11190000
112000     IF (NOT SI-SA-UNKNOWN)                                       11200000
112100         MOVE PT-SQL-STATEMENT-COUNT TO AS-STATEMENT-NUMBER       11210000
112200         MOVE SI-SQL-ACTION TO AS-SQL-ACTION                      11220000
112300         MOVE AS-AUDIT-STATEMENT-LINE TO RA-RESULTS-AUDIT-RECORD  11230000
112400                                         RE-RESULTS-EMAIL-RECORD  11240000
112500         PERFORM 8000-WRITE-RES-AUDIT-RECORD                      11250000
112600         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      11260000
112700     END-IF.                                                      11270000
112800                                                                  11280000
112900*                                                                 11290000
113000*  PARSE WORD BY WORD, AND LINE BY LINE TO IDENTIFY THE TABLE     11300000
113100*  NAME IN THE STATEMENT.  SKIP OVER ANY PAGE ADVANCES IN THE     11310000
113200*  SYSOUT REPORT.  UNSTRING EACH NEW LINE INTO WORD COMPONENTS,   11320000
113300*  AND SHIFT EACH WORD UP ONE WORD POSITION AS EACH WORD IS       11330000
113400*  POSITIONALLY EVALUATED.  REMOVE THE KEYWORD REQUIREMENT AS     11340000
113500*  ANY REQUIRED KEYWORD IS DETECTED.  PARSE A FULLY QUALIFIED     11350000
113600*  TABLE NAME INTO TABLE OWNER AND TABLE NAME.                    11360000
113700*                                                                 11370000
113800                                                                  11380000
113900     PERFORM                                                      11390000
114000             UNTIL ((PS-END-OF-SYSOUT-FILE)                       11400000
114100                     OR (SI-SS-NO-TABLE-NAME-REQD)                11410000
114200                     OR (SS-SQL-ERROR-ID)                         11420000
114300                     OR (SS-SQL-RESULT-ID)                        11430000
114400                     OR (SS-INPUT-STATEMENT-ID))                  11440000
114500         IF (UA-WORD-1 = SPACES)                                  11450000
114600             PERFORM 7200-READ-SQL-SYSOUT-FILE                    11460000
114700                 WITH TEST AFTER                                  11470000
114800                 UNTIL ((PS-END-OF-SYSOUT-FILE)                   11480000
114900                         OR (NOT SS-PAGE-HEADER-ID))              11490000
115000             PERFORM 5000-UNSTRING-SYSOUT-LINE                    11500000
115100         ELSE                                                     11510000
115200             MOVE UA-WORD-2 TO UA-WORD-1                          11520000
115300             MOVE UA-WORD-3 TO UA-WORD-2                          11530000
115400             MOVE UA-WORD-4 TO UA-WORD-3                          11540000
115500             MOVE UA-WORD-5 TO UA-WORD-4                          11550000
115600             INITIALIZE UA-WORD-5                                 11560000
115700         END-IF                                                   11570000
115800         EVALUATE TRUE                                            11580000
115900             WHEN UA-WORD-1 = SPACES                              11590000
116000                 CONTINUE                                         11600000
116100             WHEN SI-SS-KEYWORD-TABLE-NAME-REQD                   11610000
116200                 IF SI-SQL-KEYWORD-REQUIRED = UA-WORD-1           11620000
116300                     SET SI-SS-JUST-TABLE-NAME-REQD TO TRUE       11630000
116400                 ELSE                                             11640000
116500                     SET RS-PARSING-ERRORS-DETECTED TO TRUE       11650000
116600                     INITIALIZE AE-ERROR-MESSAGE                  11660000
116700                     STRING '"'                 DELIMITED BY SIZE 11670000
116800                            SI-SQL-KEYWORD-REQUIRED               11680000
116900                                                DELIMITED BY SIZE 11690000
117000                            '" MISSING - NO TABLE NAME PARSED'    11700000
117100                                                DELIMITED BY SIZE 11710000
117200                         INTO AE-ERROR-MESSAGE                    11720000
117300                     MOVE AE-AUDIT-ERROR-LINE TO                  11730000
117400                               RA-RESULTS-AUDIT-RECORD            11740000
117500                               RE-RESULTS-EMAIL-RECORD            11750000
117600                     PERFORM 8000-WRITE-RES-AUDIT-RECORD          11760000
117700                     PERFORM 8100-WRITE-RES-EMAIL-RECORD          11770000
117800                     SET SI-SS-NO-TABLE-NAME-REQD TO TRUE         11780000
117900                 END-IF                                           11790000
118000             WHEN SI-SS-JUST-TABLE-NAME-REQD                      11800000
118100                 SET SI-SS-NO-TABLE-NAME-REQD TO TRUE             11810000
118200                 INITIALIZE PV-TALLY                              11820000
118300                 INSPECT UA-WORD-1                                11830000
118400                     TALLYING PV-TALLY                            11840000
118500                     FOR ALL PC-PERIOD                            11850000
118600                 EVALUATE TRUE                                    11860000
118700                     WHEN PV-TALLY = ZERO                         11870000
118800                         MOVE UA-WORD-1 TO SI-TABLE-NAME          11880000
118900                         MOVE PC-UNKNOWN-ID TO SI-TABLE-OWNER     11890000
119000                     WHEN PV-TALLY = 1                            11900000
119100                         UNSTRING UA-WORD-1                       11910000
119200                             DELIMITED BY PC-PERIOD               11920000
119300                             INTO SI-TABLE-OWNER                  11930000
119400                                  SI-TABLE-NAME                   11940000
119500                         END-UNSTRING                             11950000
119600                     WHEN PV-TALLY = 2                            11960000
119700                         UNSTRING UA-WORD-1                       11970000
119800                             DELIMITED BY PC-PERIOD               11980000
119900                             INTO SI-TABLE-LOCATION               11990000
120000                                  SI-TABLE-OWNER                  12000000
120100                                  SI-TABLE-NAME                   12010000
120200                         END-UNSTRING                             12020000
120300                         SET RS-PARSING-ERRORS-DETECTED TO TRUE   12030000
120400                         IF ((PV-CHG-MGMT-DTL-ACTION-LINE + 1) <  12040000
120500                                    PV-MAX-CHG-MGMT-DTL-ACT-LINES)12050000
120600                             MOVE EN-LOCATION-SPECIFIED-MSG-1 TO  12060000
120800                                       CM-CHG-MGMT-DTL-ACTION-LINE12070000
120900                                                        (CM-INDEX)12080000
120910                             ADD +1 TO PV-CHG-MGMT-DTL-ACTION-LINE12090000
120920                             SET CM-INDEX UP BY 1                 12091000
121000                             MOVE PT-SQL-STATEMENT-COUNT TO       12092000
121100                                       EN-STATEMENT-NUMBER        12093000
121200                             INITIALIZE EN-QUALIFIED-TABLE        12094000
121300                             STRING                               12095000
121400                                    SI-TABLE-OWNER                12096000
121500                                                DELIMITED BY SPACE12097000
121600                                    PC-PERIOD   DELIMITED BY SIZE 12098000
121700                                    SI-TABLE-NAME                 12099000
121800                                                DELIMITED BY SPACE12100000
121900                                 INTO EN-QUALIFIED-TABLE          12110000
122000                             MOVE EN-LOCATION-SPECIFIED-MSG-2 TO  12120000
122200                                       CM-CHG-MGMT-DTL-ACTION-LINE12130000
122300                                                        (CM-INDEX)12140000
122400                             ADD +1 TO PV-CHG-MGMT-DTL-ACTION-LINE12150000
122500                             SET CM-INDEX UP BY 1                 12160000
122600                         ELSE                                     12170000
122700                             ADD +2 TO                            12180000
122800                                    PV-CHG-MGMT-DTL-OVERFLOW-LINES12190000
122900                         END-IF                                   12200000
123100                     WHEN PV-TALLY > 2                            12210000
123200                         SET RS-PARSING-ERRORS-DETECTED TO TRUE   12220000
123300                         MOVE PC-UNKNOWN-ID TO SI-TABLE-OWNER     12230000
123400                                               SI-TABLE-NAME      12240000
123500                         MOVE 'ERROR PARSING TABLE OWNER/NAME' TO 12250000
123600                                   AE-ERROR-MESSAGE               12260000
123700                         MOVE AE-AUDIT-ERROR-LINE TO              12270000
123800                                   RA-RESULTS-AUDIT-RECORD        12280000
123900                                   RE-RESULTS-EMAIL-RECORD        12290000
124000                         PERFORM 8000-WRITE-RES-AUDIT-RECORD      12300000
124100                         PERFORM 8100-WRITE-RES-EMAIL-RECORD      12310000
124200                         INITIALIZE AE-ERROR-MESSAGE              12320000
124300                         STRING ' QUAL NAME:'   DELIMITED BY SIZE 12330000
124400                                SI-TABLE-OWNER  DELIMITED BY SIZE 12340000
124500                                '.'             DELIMITED BY SIZE 12350000
124600                                SI-TABLE-NAME   DELIMITED BY SIZE 12360000
124700                             INTO AE-ERROR-MESSAGE                12370000
124800                         MOVE AE-AUDIT-ERROR-LINE TO              12380000
124900                                   RA-RESULTS-AUDIT-RECORD        12390000
125000                                   RE-RESULTS-EMAIL-RECORD        12400000
125100                         PERFORM 8000-WRITE-RES-AUDIT-RECORD      12410000
125200                         PERFORM 8100-WRITE-RES-EMAIL-RECORD      12420000
125300                 END-EVALUATE                                     12430000
125400                 UNSTRING SI-TABLE-NAME                           12440000
125500                     DELIMITED BY PC-SEMICOLON OR                 12450000
125600                                  PC-OPEN-PARENTHESIS             12460000
125700                     INTO SI-TABLE-NAME-B4-DELIM                  12470000
125800                          SI-TABLE-NAME-AFT-DELIM                 12480000
125900                 END-UNSTRING                                     12490000
126000                 MOVE SI-TABLE-NAME-B4-DELIM TO SI-TABLE-NAME     12500000
126100         END-EVALUATE                                             12510000
126200     END-PERFORM.                                                 12520000
126300*2100-EXIT.                                                       12530000
126400                                                                  12540000
126500******************************************************************12550000
126600*  EVALUATE THE RESULT OF THE EXECUTION OF THE SQL STATEMENT,    *12560000
126700*  AS IDENTIFIED IN THE SYSOUT.  UNSTRING THE RESULT LINE TO     *12570000
126800*  EVALUATE EACH WORD FOR REQUIRED CHARACTERISTICS.  IF A        *12580000
126900*  SQLCODE IS IDENTIFIED, EXTRACT IT, AND PREPARE A SIGNED,      *12590000
127000*  FORMATTED CODE FOR PRESENTATION IN THE AUDIT.  BASED ON THE   *12600000
127100*  SQLCODE AND THE STATEMENT ACTION (SELECT AND COMMIT ARE       *12610000
127200*  EXEMPTED, SINCE THEY ARE NOT DATA CHANGE STATEMENTS), SET AN  *12620000
127300*  INDICATION OF SUCCESS OR FAILURE.  EXTRACT THE SQL ERROR      *12630000
127400*  MESSAGE FROM ITS POSITIONAL LOCATION, IF ONE IS DETECTED.     *12640000
127500*  IF A SUCCESSFUL EXECUTION IS DETECTED, VERIFY THAT THE ACTION *12650000
127600*  EXECUTED MATCHES WHAT WAS PREVIOUSLY PARSED IN THE SQL, AND   *12660000
127700*  EXTRACT THE COUNT OF THE NUMBER OF ROWS AFFECTED.             *12670000
127800******************************************************************12680000
127900                                                                  12690000
128000 2200-EVALUATE-SQL-RESULT.                                        12700000
128100     PERFORM 5000-UNSTRING-SYSOUT-LINE.                           12710000
128200                                                                  12720000
128300     EVALUATE TRUE                                                12730000
128400         WHEN ((UA-WORD-2 = PC-SQLCODE)                           12740000
128500                 AND (UA-WORD-3 = PC-EQUAL-SYMBOL))               12750000
128600             INITIALIZE PV-TALLY                                  12760000
128700             INSPECT UA-WORD-4                                    12770000
128800                 TALLYING PV-TALLY                                12780000
128900                 FOR ALL SPACES LOW-VALUES                        12790000
129000             COMPUTE SI-SQLCODE-LENGTH =                          12800000
129100                       ((LENGTH OF UA-WORD-4) - PV-TALLY)         12810000
129200             IF UA-WORD-4 (SI-SQLCODE-LENGTH:1) = PC-COMMA        12820000
129300                 MOVE SPACES TO UA-WORD-4 (SI-SQLCODE-LENGTH:1)   12830000
129400                 SUBTRACT +1 FROM SI-SQLCODE-LENGTH               12840000
129500             END-IF                                               12850000
129600             EVALUATE TRUE                                        12860000
129700                 WHEN SI-SL-SIGNED                                12870000
129800                     MOVE UA-WORD-4 (1:SI-SQLCODE-LENGTH) TO      12880000
129900                               SI-SQLCODE                         12890000
130000                 WHEN SI-SL-UNSIGNED                              12900000
130100                     STRING PC-PLUS-SIGN        DELIMITED BY SIZE 12910000
130200                            UA-WORD-4 (1:SI-SQLCODE-LENGTH)       12920000
130300                                                DELIMITED BY SIZE 12930000
130400                         INTO SI-SQLCODE                          12940000
130500                 WHEN OTHER                                       12950000
130600                     MOVE UA-WORD-4 TO SI-SQLCODE                 12960000
130700             END-EVALUATE                                         12970000
130800             EVALUATE TRUE                                        12980000
130900                 WHEN (SI-SQLCODE = SPACES)                       12990000
131000                     IF ((NOT SI-SA-SELECT)                       13000000
131100                             AND (NOT SI-SA-COMMIT))              13010000
131200                         SET RS-SUCCESSFUL-STMT-FOUND TO TRUE     13020000
131300                     END-IF                                       13030000
131400                 WHEN (NOT SI-VALID-SQLCODE-SIGN)                 13040000
131500                 WHEN (SI-SQLCODE-VALUE NOT NUMERIC)              13050000
131600                     SET RS-PARSING-ERRORS-DETECTED TO TRUE       13060000
131700                     SET RS-UNSUCCESSFUL-STMT-FOUND TO TRUE       13070000
131800                     INITIALIZE AE-ERROR-MESSAGE                  13080000
131900                     STRING 'INVALID SQLCODE "' DELIMITED BY SIZE 13090000
132000                            SI-SQLCODE          DELIMITED BY SIZE 13100000
132100                            '" PARSED'          DELIMITED BY SIZE 13110000
132200                         INTO AE-ERROR-MESSAGE                    13120000
132300                     MOVE AE-AUDIT-ERROR-LINE TO                  13130000
132400                               RA-RESULTS-AUDIT-RECORD            13140000
132500                               RE-RESULTS-EMAIL-RECORD            13150000
132600                     PERFORM 8000-WRITE-RES-AUDIT-RECORD          13160000
132700                     PERFORM 8100-WRITE-RES-EMAIL-RECORD          13170000
132800                 WHEN SI-SUCCESSFUL-SQLCODE                       13180000
132900                     IF ((NOT SI-SA-SELECT)                       13190000
133000                             AND (NOT SI-SA-COMMIT))              13200000
133100                         SET RS-SUCCESSFUL-STMT-FOUND TO TRUE     13210000
133200                     END-IF                                       13220000
133300                 WHEN SI-NOT-FOUND-SQLCODE                        13230000
133400*                                                                 13240000
133500*  SELECT STATEMENTS SHOULD NEVER TAKE THIS PATH, SINCE NO "RESULT13250000
133600*  OF SQL STATEMENT TAG" SHOULD APPEAR, AND NO SQLCODE WOULD BE   13260000
133700*  PRESENTED IN THE SYSOUT.  ONLY IF THE SELECT GENERATES A       13270000
133800*  WARNING WILL IT TAKE THIS PATH, AND AN ENTRY WILL APPEAR PER   13280000
133900*  ROW RETRIEVED THAT HAD A WARNING CONDITION.                    13290000
134000*                                                                 13300000
134100                     IF (NOT SI-SA-SELECT)                        13310000
134200                         SET RS-NOT-FOUND-STMT-FOUND TO TRUE      13320000
134300                     END-IF                                       13330000
134400                 WHEN OTHER                                       13340000
134500                     SET SI-SE-SQLCODE-ERROR TO TRUE              13350000
134600                     IF ((NOT SI-SA-SELECT)                       13360000
134700                             AND (NOT SI-SA-COMMIT))              13370000
134800                         SET RS-UNSUCCESSFUL-STMT-FOUND TO TRUE   13380000
134900                     END-IF                                       13390000
135000             END-EVALUATE                                         13400000
135100             IF (UA-OVERFLOW NOT = SPACES)                        13410000
135200                 MOVE 0 TO UA-OVERFLOW-POINTER                    13420000
135300                 INSPECT UA-OVERFLOW                              13430000
135400                     TALLYING UA-OVERFLOW-POINTER                 13440000
135500                     FOR CHARACTERS BEFORE INITIAL PC-COLON       13450000
135600                 IF (UA-OVERFLOW-POINTER <                        13460000
135700                                         (LENGTH OF UA-OVERFLOW)) 13470000
135800                     ADD +2 TO UA-OVERFLOW-POINTER                13480000
135900                 ELSE                                             13490000
136000                     MOVE +1 TO UA-OVERFLOW-POINTER               13500000
136100                 END-IF                                           13510000
136200                 MOVE 0 TO PV-TALLY                               13520000
136300                 INSPECT UA-OVERFLOW (UA-OVERFLOW-POINTER:)       13530000
136400                     TALLYING PV-TALLY                            13540000
136500                     FOR LEADING SPACES                           13550000
136600                 ADD PV-TALLY TO UA-OVERFLOW-POINTER              13560000
136700                 MOVE UA-OVERFLOW (UA-OVERFLOW-POINTER:) TO       13570000
136800                           SI-SQLCODE-MESSAGE                     13580000
136900             END-IF                                               13590000
137000             IF (((SI-SA-SELECT)                                  13600000
137100                     OR (SI-SA-COMMIT))                           13610000
137200                     AND ((SI-NOT-FOUND-SQLCODE)                  13620000
137300                     OR (SI-SE-SQLCODE-ERROR)))                   13630000
137400                 INITIALIZE AE-AUDIT-ERROR-LINE                   13640000
137500                 SET AE-SQLCODE-ID TO TRUE                        13650000
137600                 MOVE SI-SQLCODE TO AE-SQLCODE                    13660000
137700                 SET AE-SQLCODE-MESSAGE-ID TO TRUE                13670000
137800                 MOVE SI-SQLCODE-MESSAGE TO AE-SQLCODE-MESSAGE    13680000
137900                 MOVE AE-AUDIT-ERROR-LINE TO                      13690000
138000                           RA-RESULTS-AUDIT-RECORD                13700000
138100                           RE-RESULTS-EMAIL-RECORD                13710000
138200                 PERFORM 8000-WRITE-RES-AUDIT-RECORD              13720000
138300                 PERFORM 8100-WRITE-RES-EMAIL-RECORD              13730000
138400             END-IF                                               13740000
138500         WHEN ((SS-SQL-SUCCESS-ID)                                13750000
138600                 AND (SI-SA-SELECT))                              13760000
138700*                                                                 13770000
138800*  SELECT STATEMENTS SHOULD NEVER TAKE THIS PATH, SINCE NO "RESULT13780000
138900*  OF SQL STATEMENT TAG" SHOULD APPEAR.  ONLY IF THE SELECT       13790000
139000*  GENERATES A WARNING WILL IT TAKE THIS PATH, AND AN ENTRY WILL  13800000
139100*  APPEAR PER ROW RETRIEVED THAT HAD A WARNING CONDITION.  SINCE  13810000
139200*  THERE IS NO INFORMATION TO ACQUIRE ON A SELECT, NO OTHER ACTION13820000
139300*  SHOULD BE TAKEN.  "RETRIEVAL" RATHER THAN "SELECT" WILL APPEAR 13830000
139400*  WHERE THE ACTION NORMALLY WOULD BE REPEATED ON THIS LINE OF    13840000
139500*  THE SYSOUT.                                                    13850000
139600*                                                                 13860000
139700             CONTINUE                                             13870000
139800         WHEN SS-SQL-SUCCESS-ID                                   13880000
139900             IF UA-WORD-2 NOT = SI-SQL-ACTION                     13890000
140000                 SET RS-PARSING-ERRORS-DETECTED TO TRUE           13900000
140100                 INITIALIZE AE-ERROR-MESSAGE                      13910000
140200                 STRING 'ACTION "'              DELIMITED BY SIZE 13920000
140300                        SI-SQL-ACTION           DELIMITED BY SIZE 13930000
140400                        '" IN SQL;"'            DELIMITED BY SIZE 13940000
140500                        UA-WORD-2 (1:LENGTH OF SI-SQL-ACTION)     13950000
140600                                                DELIMITED BY SIZE 13960000
140700                        '" PARSED'              DELIMITED BY SIZE 13970000
140800                     INTO AE-ERROR-MESSAGE                        13980000
140900                 MOVE AE-AUDIT-ERROR-LINE TO                      13990000
141000                           RA-RESULTS-AUDIT-RECORD                14000000
141100                           RE-RESULTS-EMAIL-RECORD                14010000
141200                 PERFORM 8000-WRITE-RES-AUDIT-RECORD              14020000
141300                 PERFORM 8100-WRITE-RES-EMAIL-RECORD              14030000
141400             ELSE                                                 14040000
141500                 INITIALIZE PV-TALLY                              14050000
141600                 INSPECT UA-WORD-4                                14060000
141700                     TALLYING PV-TALLY                            14070000
141800                     FOR ALL SPACES LOW-VALUES                    14080000
141900                 COMPUTE SI-ROWS-AFFECTED-LENGTH =                14090000
142000                           ((LENGTH OF UA-WORD-4) - PV-TALLY)     14100000
142100                 INITIALIZE SI-ROWS-AFFECTED-X                    14110000
142200                 SET SI-ALL-ROWS-AFFECTED-NOT-FOUND TO TRUE       14120000
142300                 IF (SI-ROWS-AFFECTED-LENGTH >                    14130000
142400                                      PC-MAX-ROWS-AFFECTED-LENGTH)14140000
142500                     SET RS-PARSING-ERRORS-DETECTED TO TRUE       14150000
142600                     INITIALIZE AE-ERROR-MESSAGE                  14160000
142700                     STRING 'ROW COUNT "'       DELIMITED BY SIZE 14170000
142800                            UA-WORD-4 (1:SI-ROWS-AFFECTED-LENGTH) 14180000
142900                                                DELIMITED BY SIZE 14190000
143000                            '" TOO LARGE'       DELIMITED BY SIZE 14200000
143100                         INTO AE-ERROR-MESSAGE                    14210000
143200                     MOVE AE-AUDIT-ERROR-LINE TO                  14220000
143300                               RA-RESULTS-AUDIT-RECORD            14230000
143400                               RE-RESULTS-EMAIL-RECORD            14240000
143500                     PERFORM 8000-WRITE-RES-AUDIT-RECORD          14250000
143600                     PERFORM 8100-WRITE-RES-EMAIL-RECORD          14260000
143700                     MOVE ZEROS TO SI-ROWS-AFFECTED               14270000
143800                 ELSE                                             14280000
143900                     MOVE UA-WORD-4 (1:SI-ROWS-AFFECTED-LENGTH) TO14290000
144000                               SI-ROWS-AFFECTED                   14300000
144100                               ((LENGTH OF SI-ROWS-AFFECTED) -    14310000
144200                               SI-ROWS-AFFECTED-LENGTH + 1:       14320000
144300                               SI-ROWS-AFFECTED-LENGTH)           14330000
144400                     IF SI-ALL-ROWS-AFFECTED                      14340000
144500                         SET SI-ALL-ROWS-AFFECTED-FOUND TO TRUE   14350000
144600                         MOVE 1 TO SI-ROWS-AFFECTED               14360000
144700                     END-IF                                       14370000
144800                     INSPECT SI-ROWS-AFFECTED-X                   14380000
144900                         REPLACING LEADING SPACES BY ZEROS        14390000
145000                     IF (SI-ROWS-AFFECTED-X NOT NUMERIC)          14400000
145100                         SET RS-PARSING-ERRORS-DETECTED TO TRUE   14410000
145200                         INITIALIZE AE-ERROR-MESSAGE              14420000
145300                         STRING 'INVALID ROW COUNT "'             14430000
145400                                                DELIMITED BY SIZE 14440000
145500                                SI-ROWS-AFFECTED-X                14450000
145600                                                DELIMITED BY SIZE 14460000
145700                                '" PARSED'      DELIMITED BY SIZE 14470000
145800                             INTO AE-ERROR-MESSAGE                14480000
145900                         MOVE AE-AUDIT-ERROR-LINE TO              14490000
146000                                   RA-RESULTS-AUDIT-RECORD        14500000
146100                                   RE-RESULTS-EMAIL-RECORD        14510000
146200                         PERFORM 8000-WRITE-RES-AUDIT-RECORD      14520000
146300                         PERFORM 8100-WRITE-RES-EMAIL-RECORD      14530000
146400                         MOVE ZEROS TO SI-ROWS-AFFECTED           14540000
146500                     ELSE                                         14550000
146600                         PERFORM 3000-WRITE-STATEMENT-DETAIL      14560000
146700                     END-IF                                       14570000
146800                 END-IF                                           14580000
146900             END-IF                                               14590000
147000     END-EVALUATE.                                                14600000
147100                                                                  14610000
147200     PERFORM 7200-READ-SQL-SYSOUT-FILE.                           14620000
147300*2200-EXIT.                                                       14630000
147400                                                                  14640000
147500******************************************************************14650000
147600*  WRITE OUT THE RESULTS OF THE EXECUTION OF A SINGLE SQL INPUT  *14660000
147700*  STATEMENT THAT COULD RESULT IN CHANGED DATA.  LOG THE         *14670000
147800*  AFFECTED TABLE AND ROWS IN THE PRODUCTION DATA CHANGE AUDIT   *14680000
147900*  AND E-MAIL FILES, AND POST THE SQLCODE AND MESSAGE FROM ANY   *14690000
148000*  FAILED STATEMENTS.  PREPARE AND INSERT A PRODUCTION DATA      *14700000
148100*  CHANGE RESULTS TABLE ROW TO LOG THE RESULTS OF EXECUTING THAT *14710000
148200*  STATEMENT.                                                    *14720000
148300******************************************************************14730000
148400                                                                  14740000
148500 3000-WRITE-STATEMENT-DETAIL.                                     14750000
148600     MOVE SI-TABLE-OWNER TO AT-TABLE-OWNER.                       14760000
148700     MOVE SI-TABLE-NAME TO AT-TABLE-NAME.                         14770000
148800     INITIALIZE AT-ROWS-AFFECTED-CONTINUATION.                    14780000
148900     EVALUATE TRUE                                                14790000
149000         WHEN SI-ALL-ROWS-AFFECTED-FOUND                          14800000
149100             SET AT-ALL-ROWS-AFFECTED TO TRUE                     14810000
149200         WHEN (SI-ROWS-AFFECTED > PC-MAX-DISPLAY-ROWS-AFFECTED)   14820000
149300             SET AT-MAX-DISPLAY-ROWS-AFFECTED                     14830000
149400                 AT-GT-DISPLAY-ROWS-AFFECTED TO TRUE              14840000
149500         WHEN OTHER                                               14850000
149600             MOVE SI-ROWS-AFFECTED TO AT-ROWS-AFFECTED            14860000
149700     END-EVALUATE.                                                14870000
149800     MOVE AT-AUDIT-TABLE-LINE TO RA-RESULTS-AUDIT-RECORD          14880000
149900                                 RE-RESULTS-EMAIL-RECORD.         14890000
150000     PERFORM 8000-WRITE-RES-AUDIT-RECORD.                         14900000
150100     PERFORM 8100-WRITE-RES-EMAIL-RECORD.                         14910000
150200                                                                  14920000
150300     IF (NOT SI-SUCCESSFUL-SQLCODE)                               14930000
150400         INITIALIZE AE-AUDIT-ERROR-LINE                           14940000
150500         SET AE-SQLCODE-ID TO TRUE                                14950000
150600         MOVE SI-SQLCODE TO AE-SQLCODE                            14960000
150700         SET AE-SQLCODE-MESSAGE-ID TO TRUE                        14970000
150800         MOVE SI-SQLCODE-MESSAGE TO AE-SQLCODE-MESSAGE            14980000
150900         MOVE AE-AUDIT-ERROR-LINE TO RA-RESULTS-AUDIT-RECORD      14990000
151000                                     RE-RESULTS-EMAIL-RECORD      15000000
151100         PERFORM 8000-WRITE-RES-AUDIT-RECORD                      15010000
151200         PERFORM 8100-WRITE-RES-EMAIL-RECORD                      15020000
151300     END-IF.                                                      15030000
151400                                                                  15040000
151500     MOVE AH-SQL-MEMBER-NAME TO CMCHNG-SQL-MEM-NM.                15050000
151600     MOVE PT-SQL-STATEMENT-COUNT TO CMCHNG-SQL-STMT-NBR.          15060000
151700     MOVE SI-TABLE-OWNER TO CMCHNG-TBL-OWNR-NM.                   15070000
151800     MOVE SI-TABLE-NAME TO CMCHNG-TBL-NM.                         15080000
151900     MOVE AH-REQUEST-REASON TO CMCHNG-CHG-RSN-DESC.               15090000
152000     MOVE SI-SQL-ACTION TO CMCHNG-SQL-ACTN-DESC.                  15100000
152100     MOVE SI-ROWS-AFFECTED TO CMCHNG-AFCTD-ROW-QTY.               15110000
152200     MOVE AH-REQUESTER-USERID TO CMCHNG-RQSTR-USR-ID.             15120000
152300     MOVE AR-REQUESTER-MANAGER-USERID TO CMCHNG-RQSTR-MGR-USR-ID. 15130000
152400     MOVE AR-RELEASED-BY-USERID TO CMCHNG-RLSED-BY-USR-ID.        15140000
152500     MOVE AH-SQL-MEMBER-NAME (1:2) TO CMCHNG-APPL-ID.             15150000
152600     MOVE PV-AUDIT-TMST TO CMCHNG-AUD-EXEC-TMST.                  15160000
152700                                                                  15170000
152800     PERFORM 8300-INSERT-REQUEST-ROW.                             15180000
152900                                                                  15190000
153000     SET SI-SD-STMT-DTL-WRITTEN TO TRUE.                          15200000
153100*3000-EXIT.                                                       15210000
153200                                                                  15220000
153300******************************************************************15230000
153400*  UNSTRING A SQL EXECUTION SYSOUT LINE INTO INDIVIDUAL WORD     *15240000
153500*  COMPONENTS FOR POSITIONAL EVALUATION.  IF A SQL COMMENT IS    *15250000
153600*  DETECTED, ERASE ALL WORDS FROM THAT POINT TO THE END OF THE   *15260000
153700*  LINE, SINCE THEY ARE NOT OPERATIONAL PARTS OF THE STATEMENT.  *15270000
153800******************************************************************15280000
153900                                                                  15290000
154000 5000-UNSTRING-SYSOUT-LINE.                                       15300000
154100     INITIALIZE UA-UNSTRING-AREA.                                 15310000
154200     MOVE +1 TO UA-OVERFLOW-POINTER.                              15320000
154300                                                                  15330000
154400     UNSTRING SS-RECORD                                           15340001
154500         DELIMITED BY ALL SPACES                                  15350000
154600         INTO UA-WORD-1                                           15360000
154700              UA-WORD-2                                           15370000
154800              UA-WORD-3                                           15380000
154900              UA-WORD-4                                           15390000
155000              UA-WORD-5                                           15400000
155100         WITH POINTER UA-OVERFLOW-POINTER                         15410000
155200         ON OVERFLOW                                              15420000
155300             MOVE SS-RECORD (UA-OVERFLOW-POINTER:) TO             15430001
155400                       UA-OVERFLOW                                15440000
155500     END-UNSTRING.                                                15450000
155600                                                                  15460000
155700     IF (UA-WORD-1 = SPACES)                                      15470000
155800         MOVE UA-WORD-2 TO UA-WORD-1                              15480000
155900         MOVE UA-WORD-3 TO UA-WORD-2                              15490000
156000         MOVE UA-WORD-4 TO UA-WORD-3                              15500000
156100         MOVE UA-WORD-5 TO UA-WORD-4                              15510000
156200         INITIALIZE UA-WORD-5                                     15520000
156300     END-IF.                                                      15530000
156400                                                                  15540000
156500*                                                                 15550000
156600*  IF A SQL COMMENT IS DETECTED, INITIALIZE THE PARSED WORDS,     15560000
156700*  SINCE THEY ARE NOT OPERATIONAL PARTS OF THE STATEMENT ON THAT  15570000
156800*  LINE.  THIS COVERS COMMENTS INTRODUCED ANYWHERE ON THE LINE.   15580000
156900*                                                                 15590000
157000                                                                  15600000
157100     IF (UA-WORD-1 (1:LENGTH OF PC-SQL-COMMENT) = PC-SQL-COMMENT) 15610000
157200         INITIALIZE UA-WORD-1                                     15620000
157300                    UA-WORD-2                                     15630000
157400                    UA-WORD-3                                     15640000
157500                    UA-WORD-4                                     15650000
157600                    UA-WORD-5                                     15660000
157700     END-IF.                                                      15670000
157800                                                                  15680000
157900     IF (UA-WORD-2 (1:LENGTH OF PC-SQL-COMMENT) = PC-SQL-COMMENT) 15690000
158000         INITIALIZE UA-WORD-2                                     15700000
158100                    UA-WORD-3                                     15710000
158200                    UA-WORD-4                                     15720000
158300                    UA-WORD-5                                     15730000
158400     END-IF.                                                      15740000
158500                                                                  15750000
158600     IF (UA-WORD-3 (1:LENGTH OF PC-SQL-COMMENT) = PC-SQL-COMMENT) 15760000
158700         INITIALIZE UA-WORD-3                                     15770000
158800                    UA-WORD-4                                     15780000
158900                    UA-WORD-5                                     15790000
159000     END-IF.                                                      15800000
159100                                                                  15810000
159200     IF (UA-WORD-4 (1:LENGTH OF PC-SQL-COMMENT) = PC-SQL-COMMENT) 15820000
159300         INITIALIZE UA-WORD-4                                     15830000
159400                    UA-WORD-5                                     15840000
159500     END-IF.                                                      15850000
159600                                                                  15860000
159700     IF (UA-WORD-5 (1:LENGTH OF PC-SQL-COMMENT) = PC-SQL-COMMENT) 15870000
159800         INITIALIZE UA-WORD-5                                     15880000
159900     END-IF.                                                      15890000
160000*5000-EXIT.                                                       15900000
160100                                                                  15910000
160200******************************************************************15920000
160300*  READ A PRODUCTION DATA CHANGE REQUEST CONTROL FILE RECORD.    *15930000
160400******************************************************************15940000
160500                                                                  15950000
160600 7000-READ-DATA-CHG-CNTL-FILE.                                    15960000
160700     READ PROD-DATA-CNTL-FILE                                     15970000
160800         INTO CM001-PROD-DATA-CONTROL-RECORD                      15980000
160900         AT END                                                   15990000
161000             SET PS-END-OF-CNTL-FILE TO TRUE                      16000000
161100     END-READ.                                                    16010000
161200*7000-EXIT.                                                       16020000
161300                                                                  16030000
161400******************************************************************16040000
161500*  COUNT ALL ROWS IN THE PRODUCTION DATA CHANGE RESULTS TABLE    *16050000
161600*  THAT LOG A PREVIOUS PRODUCTION DATA CHANGE ATTEMPT THROUGH    *16060000
161700*  THAT SQL MEMBER.  EACH ROW REPRESENTS ONE STATEMENT THAT      *16070000
161800*  COULD CHANGE DATA THAT WAS EXECUTED.                          *16080000
161900******************************************************************16090000
162000                                                                  16100000
162100 7100-COUNT-PREVIOUS-RESULTS.                                     16110000
162200     EXEC SQL                                                     16120000
162300         SELECT COUNT (*)                                         16130000
162400             INTO :PV-PREV-SQL-MBR-STMTS                          16140000
162500             FROM TCMCHNG                                         16150000
162600             WHERE SQL_MEM_NM = :CMCHNG-SQL-MEM-NM                16160000
162700     END-EXEC.                                                    16170000
162800                                                                  16180000
162900     IF ((SQLWARN0 NOT = SPACES)                                  16190000
163000             OR (SQLCODE < ZERO)                                  16200000
163100             OR (SQLCODE > ZERO))                                 16210000
163200         SET PV-SELECT-RESULT-COUNT TO TRUE                       16220000
163300         PERFORM 9100-DB2-ERROR                                   16230000
163400     END-IF.                                                      16240000
163500*7100-EXIT.                                                       16250000
163600                                                                  16260000
163700******************************************************************16270000
163800*  READ A SQL EXECUTION RESULTS SYSOUT RECORD, AND ACCUMULATE    *16280000
163900*  I/O TOTALS.                                                   *16290000
164000******************************************************************16300000
164100                                                                  16310000
164200 7200-READ-SQL-SYSOUT-FILE.                                       16320000
164300     READ SQL-EXEC-SYSOUT-FILE                                    16330000
164400         INTO SS-SQL-SYSOUT-RECORD                                16340000
164500         AT END                                                   16350000
164600             SET PS-END-OF-SYSOUT-FILE TO TRUE                    16360000
164700             SUBTRACT +1 FROM PT-SQL-SYSOUT-RCDS-READ             16370000
164800     END-READ.                                                    16380000
164900                                                                  16390000
165000     ADD +1 TO PT-SQL-SYSOUT-RCDS-READ.                           16400000
165100*7200-EXIT.                                                       16410000
165200                                                                  16420000
165300******************************************************************16430000
165400*  WRITE A PRODUCTION DATA CHANGE RESULTS AUDIT RECORD, AND      *16440000
165500*  ACCUMULATE I/O TOTALS.                                        *16450000
165600******************************************************************16460000
165700                                                                  16470000
165800 8000-WRITE-RES-AUDIT-RECORD.                                     16480000
165900     WRITE RA-RESULTS-AUDIT-RECORD.                               16490000
166000                                                                  16500000
166100     ADD +1 TO PT-RES-AUDIT-RCDS-WRITTEN.                         16510000
166200*8000-EXIT.                                                       16520000
166300                                                                  16530000
166400******************************************************************16540000
166500*  WRITE A PRODUCTION DATA CHANGE RESULTS E-MAIL RECORD, AND     *16550000
166600*  ACCUMULATE I/O TOTALS.                                        *16560000
166700******************************************************************16570000
166800                                                                  16580000
166900 8100-WRITE-RES-EMAIL-RECORD.                                     16590000
167000     WRITE RE-RESULTS-EMAIL-RECORD.                               16600000
167100                                                                  16610000
167200     ADD +1 TO PT-RES-EMAIL-RCDS-WRITTEN.                         16620000
167300*8100-EXIT.                                                       16630000
167400                                                                  16640000
167500******************************************************************16650000
167600*  DELETE ALL ROWS FROM THE PRODUCTION DATA CHANGE RESULTS TABLE *16660000
167700*  THAT LOG A PREVIOUS PRODUCTION DATA CHANGE ATTEMPT THROUGH    *16670000
167800*  THAT SQL MEMBER.                                              *16680000
167900******************************************************************16690000
168000                                                                  16700000
168100 8200-DELETE-PREVIOUS-RESULTS.                                    16710000
168200     EXEC SQL                                                     16720000
168300         DELETE                                                   16730000
168400             FROM TCMCHNG                                         16740000
168500             WHERE SQL_MEM_NM = :CMCHNG-SQL-MEM-NM                16750000
168600     END-EXEC.                                                    16760000
168700                                                                  16770000
168800     IF ((SQLWARN0 NOT = SPACES)                                  16780000
168900             OR (SQLCODE < ZERO)                                  16790000
169000             OR (SQLCODE > ZERO))                                 16800000
169100         SET PV-DELETE-RESULT-ROWS TO TRUE                        16810000
169200         PERFORM 9100-DB2-ERROR                                   16820000
169300     END-IF.                                                      16830000
169400*8200-EXIT.                                                       16840000
169500                                                                  16850000
169600******************************************************************16860000
169700*  INSERT A ROW INTO THE PRODUCTION DATA CHANGE RESULTS TABLE    *16870000
169800*  TO LOG THE RESULTS FOR AN INDIVIDUAL STATEMENT EXECUTED       *16880000
169900*  WITHIN THE STAGED SQL MEMBER.                                 *16890000
170000******************************************************************16900000
170100                                                                  16910000
170200 8300-INSERT-REQUEST-ROW.                                         16920000
170300     ADD +1 TO PT-SQL-STATEMENT-LOG-COUNT.                        16930000
170400     INITIALIZE PV-RETRY-COUNT.                                   16940000
170500                                                                  16950000
170600     PERFORM                                                      16960000
170700             WITH TEST AFTER                                      16970000
170800             UNTIL ((SQLCODE = PC-SUCCESSFUL-SQLCODE)             16980000
170900                    OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)) 16990000
171000         EXEC SQL                                                 17000000
171100             INSERT                                               17010000
171200                 INTO TCMCHNG (SQL_MEM_NM,                        17020000
171300                               SQL_STMT_NBR,                      17030000
171400                               TBL_OWNR_NM,                       17040000
171500                               TBL_NM,                            17050000
171600                               CHG_RSN_DESC,                      17060000
171700                               SQL_ACTN_DESC,                     17070000
171800                               AFCTD_ROW_QTY,                     17080000
171900                               RQSTR_USR_ID,                      17090000
172000                               RQSTR_MGR_USR_ID,                  17100000
172100                               RLSED_BY_USR_ID,                   17110000
172200                               APPL_ID,                           17120000
172300                               AUD_EXEC_TMST)                     17130000
172400                 VALUES (:CMCHNG-SQL-MEM-NM,                      17140000
172500                         :CMCHNG-SQL-STMT-NBR,                    17150000
172600                         :CMCHNG-TBL-OWNR-NM,                     17160000
172700                         :CMCHNG-TBL-NM,                          17170000
172800                         :CMCHNG-CHG-RSN-DESC,                    17180000
172900                         :CMCHNG-SQL-ACTN-DESC,                   17190000
173000                         :CMCHNG-AFCTD-ROW-QTY,                   17200000
173100                         :CMCHNG-RQSTR-USR-ID,                    17210000
173200                         :CMCHNG-RQSTR-MGR-USR-ID,                17220000
173300                         :CMCHNG-RLSED-BY-USR-ID,                 17230000
173400                         :CMCHNG-APPL-ID,                         17240000
173500                         :CMCHNG-AUD-EXEC-TMST)                   17250000
173600         END-EXEC                                                 17260000
173700         EVALUATE TRUE                                            17270000
173800             WHEN SQLCODE = PC-RESOURCE-NOT-AVAIL-SQLCODE         17280000
173900             WHEN SQLCODE = PC-DEADLOCK-W-ROLLBCK-SQLCODE         17290000
174000             WHEN SQLCODE = PC-DEADLOCK-WO-ROLLBCK-SQLCODE        17300000
174100                 ADD +1 TO PV-RETRY-COUNT                         17310000
174200             WHEN SQLWARN0 NOT = SPACES                           17320000
174300             WHEN SQLCODE < ZERO                                  17330000
174400             WHEN SQLCODE > ZERO                                  17340000
174500                 SET PV-INSERT-RESULT-ROW TO TRUE                 17350000
174600                 PERFORM 9100-DB2-ERROR                           17360000
174700         END-EVALUATE                                             17370000
174800     END-PERFORM.                                                 17380000
174900                                                                  17390000
175000     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   17400000
175100         SET PV-INSERT-RESULT-ROW TO TRUE                         17410000
175200         PERFORM 9100-DB2-ERROR                                   17420000
175300     END-IF.                                                      17430000
175400*8300-EXIT.                                                       17440000
175500                                                                  17450000
175600******************************************************************17460000
175700*  WRITE THE SQL EXECUTION RESULTS SUMMARY RECORD.               *17470000
175800******************************************************************17480000
175900                                                                  17490000
176000 8400-WRITE-RES-SUMMARY-RECORD.                                   17500000
176100     WRITE RS-RESULTS-SUMMARY-RECORD                              17510000
176200         FROM RS-RESULTS-SUMMARY-RCD.                             17520000
176300*8400-EXIT.                                                       17530000
176400                                                                  17540000
176500******************************************************************17550000
176600*  CLOSE ALL FILES.                                              *17560000
176700******************************************************************17570000
176800                                                                  17580000
176900 9000-EOJ-ROUTINE.                                                17590000
177000     CLOSE SQL-EXEC-SYSOUT-FILE                                   17600000
177100           PROD-DATA-CNTL-FILE                                    17610000
177200           RESULTS-AUDIT-FILE                                     17620000
177300           RESULTS-EMAIL-FILE                                     17630000
177400           RESULTS-SUMMARY-FILE.                                  17640000
177500*9000-EXIT.                                                       17650000
177600                                                                  17660000
177700******************************************************************17670000
177800*  FORMAT A DB2 ERROR MESSAGE, AND ABEND THE PROGRAM.            *17680000
177900******************************************************************17690000
178000                                                                  17700000
178100 9100-DB2-ERROR.                                                  17710000
178200     DISPLAY '** ABEND **'.                                       17720000
178300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - SQL ERROR'.             17730000
178400     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - ATTEMPTING TO '         17740000
178500               PV-LAST-DB2-ACTION.                                17750000
178600                                                                  17760000
178700*                                                                 17770000
178800*  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     17780000
178900*  THE CALLED MODULE DSNTIAR.                                     17790000
179000*                                                                 17800000
179100                                                                  17810000
179200     COPY DPPD004.                                                17820000
179300                                                                  17830000
179400     SET AC-DB2-ERROR TO TRUE.                                    17840000
179500     CALL 'ILBOABN0' USING ABEND-CODE.                            17850000
179600*9100-EXIT.                                                       17860000
