       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.              INKRP173.                                       
       AUTHOR.                  LEE YANG.                                       
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            02/07/2001.                                     
       DATE-COMPILED.                                                           
      ******************************************************************        
      *                                                                *        
      *  CREATES A REPORT LIST THE INVENTORY STATUS OF A STORE         *        
      *                                                                *        
      *  THIS PROGRAM IS THE BATCH VERSION OF INKCS046.  ANY CHANGES   *        
      *  TO THE REPORT SHOULD BE REFLECTED IN BOTH PROGRAMS.           *        
      *                                                                *        
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *        
      * -------  ----------  ----------------------------------------  *        
RB0501* RB0501   05/25/2001  INCLUDE THE STOCKROOM WITHDRAWAL INDICATOR*        
W05091* 99999    05/09/2001  AUTOMATED SHEET INVENTORY SELECTS         *        
W05091*                      MADE BY ROD JANSSEN                       *        
      * 22960    02/01/2002  CHANGE TO CORRECT STOCKROOM WITHDRAWAL    *        
      *                      STATUS ON REPORTS.                        *        
W26600*                                                                *        
W26600*  W26600  07/  /2004  PHYSICAL INVENTORY STORE EXPANSION        *        
W26600*                      M JOHNSON                                 *        
W26600*                                                                *        
W26006* W26006   02/24/2005  REMOVE REFERENCES TO OBSOLETE STORE TABLE.*        
W26006*                      MADE BY ERIN SEARL                        *        
28545 *  28545   08-10-2006  DEPARTMENT LEVEL INVENTORY                *        
28545 *                      JOIN TINVPAR/TINCNTL                      *        
28545 *                      B. GRAHAM - STRATAGEM                     *        
      * W33304   03-26-2008  HOLDING INVENTORY LEDGER OPEN ACROSS      *        
      *                      PERIODS                                   *        
      *                      CHUCK EBERT                               *        
28545 *                                                                *        
PK1165* PKE000000001165                                               *         
      *          10-20-2010  PER SUE THOMA, THE RTV STORES WILL NOT   *         
      *                      INVOLVE UNIT BOOKING HENCE THIS RTV TYPE *         
      *                      CODE (RV) NEEDS TO BE REMOVED FROM THIS  *         
      *                      PROGRAM                                  *         
      *---------------------------------------------------------------* INKCS046
W26006******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT RPT-REQUEST-CNTL-FILE                                         
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT STORE-INV-STAT-RPT                                            
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  RPT-REQUEST-CNTL-FILE                                                
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
       01  RPT-REQUEST-CNTL-REC            PIC X(80).                           
                                                                                
       FD  STORE-INV-STAT-RPT                                                   
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 132 CHARACTERS                                       
           DATA RECORD IS REPORT-LINE.                                          
       01  REPORT-LINE                     PIC X(132).                          
                                                                                
       EJECT                                                                    
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE AREA BEGIN ***'.                                
                                                                                
      ******************************************************************        
      *  HEADER LINE                                                            
      ******************************************************************        
      *01  DP132O-STANDRD-HEADER-132-COLS.                                      
      *01  01  DP132O-CNFDL-HDR-132-COLS.                                       
           COPY DPWS132O.                                                       
                                                                                
       01  RP-REPORT-TITLE-1.                                                   
W26600     05  FILLER                      PIC X(02)       VALUE SPACE.         
W26600     05  FILLER                      PIC X(14)       VALUE                
W26600         'REQUESTED BY: '.                                                
W26600     05  RP-REQ-USERID               PIC X(08)       VALUE SPACE.         
W26600     05  FILLER                      PIC X(26)       VALUE SPACES.        
           05  RP-REPORT-TITLE             PIC X(30)       VALUE                
               'INVENTORY STORE STATUS REPORT'.                                 
                                                                                
       01  RP-REPORT-TITLE-2.                                                   
           05  FILLER                      PIC X(46)       VALUE SPACES.        
           05  RP-REPORT-SUB-TITLE         PIC X(36)       VALUE SPACES.        
           05  FILLER REDEFINES RP-REPORT-SUB-TITLE.                            
               10  FILLER                  PIC X(12).                           
               10  RP-REPORT-SUB-TITLE-12  PIC X(12).                           
               10  FILLER                  PIC X(12).                           
           05  FILLER REDEFINES RP-REPORT-SUB-TITLE.                            
               10  FILLER                  PIC X(07).                           
               10  RP-REPORT-SUB-TITLE-22  PIC X(22).                           
               10  FILLER                  PIC X(07).                           
           05  FILLER REDEFINES RP-REPORT-SUB-TITLE.                            
               10  FILLER                  PIC X(05).                           
               10  RP-REPORT-SUB-TITLE-26  PIC X(26).                           
               10  FILLER                  PIC X(05).                           
           05  FILLER REDEFINES RP-REPORT-SUB-TITLE.                            
               10  FILLER                  PIC X(04).                           
               10  RP-REPORT-SUB-TITLE-28  PIC X(28).                           
               10  FILLER                  PIC X(04).                           
           05  FILLER REDEFINES RP-REPORT-SUB-TITLE.                            
               10  FILLER                  PIC X(03).                           
               10  RP-REPORT-SUB-TITLE-31  PIC X(31).                           
               10  FILLER                  PIC X(02).                           
           05  FILLER REDEFINES RP-REPORT-SUB-TITLE.                            
               10  FILLER                  PIC X(02).                           
               10  RP-REPORT-SUB-TITLE-33  PIC X(33).                           
               10  FILLER                  PIC X(01).                           
                                                                                
       01  RP-REPORT-HEADER-1.                                                  
           05  FILLER                      PIC X(05)       VALUE SPACES.        
           05  FILLER                      PIC X(24)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(07)       VALUE                
RB0501         '  LOC  '.                                                       
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(10)       VALUE                
RB0501         ' PLANNED  '.                                                    
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
RB0501         '  INV   '.                                                      
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
RB0501         'RECEIVED'.                                                      
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
RB0501         'ON-LINE '.                                                      
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
               '  SALES   '.                                                    
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(12)       VALUE                
RB0501         '    UNIT    '.                                                  
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(12)       VALUE                
               'STOCKROOM '.                                                    
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(10)       VALUE                
RB0501         ' ACTL DC '.                                                     
                                                                                
       01  RP-REPORT-HEADER-2.                                                  
           05  FILLER                      PIC X(05)       VALUE                
               'STORE'.                                                         
           05  FILLER                      PIC X(24)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(07)       VALUE                
RB0501         ' TYPE  '.                                                       
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(10)       VALUE                
RB0501         '   DATE   '.                                                    
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
RB0501         '  DATE  '.                                                      
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
RB0501         '  DATE  '.                                                      
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
RB0501         ' SHEET  '.                                                      
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
               'ADJUSTMENT'.                                                    
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(12)       VALUE                
RB0501         '  BOOKING   '.                                                  
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(12)       VALUE                
               'WITHDRAWAL'.                                                    
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(10)       VALUE                
RB0501         'CTOFF DATE'.                                                    
                                                                                
       01  RP-REPORT-HEADER-3.                                                  
           05  FILLER                      PIC X(29)       VALUE                
                                                           ALL '-'.             
           05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(07)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(10)       VALUE                
RB0501                                                     ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(08)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(12)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  FILLER                      PIC X(12)       VALUE                
                                                           ALL '-'.             
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(10)       VALUE                
                                                           ALL '-'.             
                                                                                
       01  RP-REPORT-DETAIL.                                                    
W26600     05  RP-STORE-NBR                PIC X(04)       VALUE SPACES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
W26600     05  RP-STORE-NAME               PIC X(24)       VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-LOCATION-TYPE            PIC X(07)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-PLAN-INV-DATE            PIC X(10)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-INVENTORY-DATE           PIC X(08)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-RECEIVED-STATUS          PIC X(08)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-ON-LINE-SHEET-STATUS     PIC X(08)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-SALES-ADJ-STATUS         PIC X(10)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-UNIT-BOOK-STATUS         PIC X(12)       VALUE SPACES.        
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RP-STKRM-STATUS             PIC X(12)       VALUE SPACES.        
           05  FILLER REDEFINES RP-STKRM-STATUS.                                
               10  RP-STKRM-STATUS-DAYS    PIC 9(02).                           
               10  FILLER                  PIC X(01).                           
               10  RP-STKRM-STATUS-TEXT    PIC X(09).                           
RB0501     05  FILLER                      PIC X(02)       VALUE SPACES.        
RB0501     05  RP-DC-CUTOFF-DATE           PIC X(10)       VALUE SPACES.        
                                                                                
       01  RP-SECTION-END.                                                      
           05  FILLER                      PIC X(45)       VALUE SPACES.        
           05  FILLER                      PIC X(41)       VALUE                
               '*****  E N D   O F   S E C T I O N  *****'.                     
                                                                                
       01  RP-REPORT-END.                                                       
           05  FILLER                      PIC X(46)       VALUE SPACES.        
           05  FILLER                      PIC X(39)       VALUE                
               '*****  E N D   O F   R E P O R T  *****'.                       
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING CONSTANT BEGIN ***'.                                
                                                                                
       01  PC-PROGRAM-CONSTANTS-AREA.                                           
           05  PC-PRINT-LINE-MAX           PIC S9(04)      VALUE +57            
                               COMP.                                            
           05  PC-COMPANY                  PIC X(02)       VALUE '03'.          
           05  PC-INCOMPLETE-DTE           PIC X(10)       VALUE                
                                                           '9999-09-09'.        
           05  PC-Y                        PIC X           VALUE 'Y'.           
           05  PC-N                        PIC X           VALUE 'N'.           
           05  PC-ALL-LOCATION-TITLE       PIC X(12)       VALUE                
               'ALL LOCATION'.                                                  
           05  PC-SCAN-NOT-PROC-TITLE      PIC X(31)       VALUE                
               'SCANNED INVENTORY NOT PROCESSED'.                               
           05  PC-SHT-NOT-PROC-TITLE       PIC X(28)       VALUE                
               'ON-LINE SHEETS NOT PROCESSED'.                                  
           05  PC-INVLD-NOT-CORRECTED      PIC X(22)       VALUE                
               'INVALIDS NOT CORRECTED'.                                        
           05  PC-STKRMW-NOT-ENTERED       PIC X(33)       VALUE                
               'STOCKROOM WITHDRAWALS NOT ENTERED'.                             
           05  PC-SLS-ADJ-NOT-COMPLETED    PIC X(31)       VALUE                
               'SALES ADJUSTMENTS NOT COMPLETED'.                               
           05  PC-BOOKING-NOT-COMPLETED    PIC X(26)       VALUE                
               'UNIT BOOKING NOT COMPLETED'.                                    
           05  PC-BOOKING-COMPLETED        PIC X(22)       VALUE                
               'UNIT BOOKING COMPLETED'.                                        
           05  PC-DAYS-LEFT                PIC X(09)       VALUE                
               'DAYS LEFT'.                                                     
           05  PC-DAY-LEFT                 PIC X(09)       VALUE                
               'DAY LEFT'.                                                      
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING SWITCHES BEGIN ***'.                                
                                                                                
       01  PS-SWITCHES-AREA.                                                    
           05  PS-END-OF-TINVPAR           PIC X           VALUE 'N'.           
               88  END-OF-TINVPAR                          VALUE 'Y'.           
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** REPORT REQUEST CONTROL REC ***'.                                
                                                                                
       01  RQ-RPT-CNTL-AREA.                                                    
           05  RQ-RPT-TYPE                 PIC X(20)       VALUE SPACES.        
               88  RQ-RPT-VALIDS                           VALUES ARE           
                   'RPT ALL REPT        '                                       
                   'RPT LOCATION        '                                       
                   'RPT SCANNED INV     '                                       
                   'RPT SHEETS          '                                       
                   'RPT INVALIDS        '                                       
                   'RPT STOCKROOM       '                                       
                   'RPT SALES ADJUSTMENT'                                       
                   'RPT BOOKING NOT CPLD'                                       
                   'RPT BOOKING COMPLETE'.                                      
               88  RQ-RPT-ALL-REPORTS                      VALUE                
                   'RPT ALL REPT        '.                                      
               88  RQ-RPT-ALL-LOC                          VALUE                
                   'RPT LOCATION        '.                                      
               88  RQ-RPT-SCAN-NOT-PROC                    VALUE                
                   'RPT SCANNED INV     '.                                      
               88  RQ-RPT-SHTS-NOT-PROC                    VALUE                
                   'RPT SHEETS          '.                                      
               88  RQ-RPT-INVL-NOT-CORR                    VALUE                
                   'RPT INVALIDS        '.                                      
               88  RQ-RPT-STKRM-NOT-ENT                    VALUE                
                   'RPT STOCKROOM       '.                                      
               88  RQ-RPT-SLS-ADJ-NOT-CPLD                 VALUE                
                   'RPT SALES ADJUSTMENT'.                                      
               88  RQ-RPT-BOOKING-NOT-CPLD                 VALUE                
                   'RPT BOOKING NOT CPLD'.                                      
               88  RQ-RPT-BOOKING-COMPLETED                VALUE                
                   'RPT BOOKING COMPLETE'.                                      
W26600     05  FILLER                      PIC X(01)       VALUE SPACE.         
W26600     05  RQ-REQ-USERID               PIC X(08)       VALUE SPACE.         
W26600     05  FILLER                      PIC X(51)       VALUE SPACES.        
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING VARIABLE BEGIN ***'.                                
                                                                                
       01  PV-PROGRAM-VARIABLES-AREA.                                           
           05  PV-PROCESSING-DATE-DAYS     PIC S9(9)       VALUE ZEROES         
                               COMP.                                            
           05  PV-STKRM-DAYS-LEFT          PIC S9(9)       VALUE ZEROES         
                               COMP.                                            
           05  PV-PAGE-COUNT               PIC S9(05)      VALUE ZEROES         
                               COMP.                                            
           05  PV-PRINT-LINE-COUNT         PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-ADVANCE-LINE             PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-SQL-TABLE-DATE-CHECK     PIC X(10)       VALUE SPACES.        
           05  PV-SQL-TABLE-CHECK          PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-OPER-ATTEMPTED           PIC X(25)       VALUE SPACES.        
           05  PV-PROCESSING-DATE          PIC X(10)       VALUE SPACES.        
           05  PV-PROCESSING-DATE-RDF REDEFINES PV-PROCESSING-DATE.             
               10  PV-PROCESSING-CC        PIC X(02).                           
               10  PV-PROCESSING-YY        PIC X(02).                           
               10  PV-PROC-DSH1            PIC X(01).                           
               10  PV-PROCESSING-MM        PIC X(02).                           
               10  PV-PROC-DSH2            PIC X(01).                           
               10  PV-PROCESSING-DD        PIC X(02).                           
           05  PV-DATE-HOLD-CCYY-MM-DD     PIC X(10)       VALUE SPACES.        
           05  FILLER REDEFINES PV-DATE-HOLD-CCYY-MM-DD.                        
               10  PV-DATE-HOLD-CCYY       PIC X(04).                           
               10  FILLER REDEFINES PV-DATE-HOLD-CCYY.                          
                   15  PV-DATE-HOLD-CC     PIC X(02).                           
                   15  PV-DATE-HOLD-YY     PIC X(02).                           
               10  PV-DATE-HOLD-DASH-1     PIC X(01).                           
               10  PV-DATE-HOLD-MM         PIC X(02).                           
               10  PV-DATE-HOLD-DASH-2     PIC X(01).                           
               10  PV-DATE-HOLD-DD         PIC X(02).                           
RB0501     05  PV-DATE-RFMT-MMDDCCYY       PIC X(10)       VALUE SPACES.        
RB0501     05  PV-DATE-RFMT-MMDDCCYY-REDEF                                      
RB0501         REDEFINES PV-DATE-RFMT-MMDDCCYY.                                 
               10  PV-DATE-RFMT-MM         PIC X(02).                           
               10  PV-DATE-RFMT-DASH-1     PIC X(01).                           
               10  PV-DATE-RFMT-DD         PIC X(02).                           
               10  PV-DATE-RFMT-DASH-2     PIC X(01).                           
               10  PV-DATE-RFMT-CCYY       PIC X(04).                           
               10  FILLER REDEFINES PV-DATE-RFMT-CCYY.                          
                   15  PV-DATE-RFMT-CC     PIC X(02).                           
                   15  PV-DATE-RFMT-YY     PIC X(02).                           
RB0501     05  PV-DATE-RFMT-MMDDYY         PIC X(08)       VALUE SPACES.        
RB0501     05  PV-DATE-RFMT-MMDDYY-REDEF REDEFINES PV-DATE-RFMT-MMDDYY.         
RB0501         10  PV-DATE-RFMT-MM         PIC X(02).                           
RB0501         10  PV-DATE-RFMT-DASH-1     PIC X(01).                           
RB0501         10  PV-DATE-RFMT-DD         PIC X(02).                           
RB0501         10  PV-DATE-RFMT-DASH-2     PIC X(01).                           
RB0501         10  PV-DATE-RFMT-YY         PIC X(02).                           
           05  PV-TODAYS-DATE.                                                  
               10  PV-TODAYS-DATE-YY       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-DATE-MM       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-DATE-DD       PIC 9(02)       VALUE ZEROES.        
           05  PV-TODAYS-TIME.                                                  
               10  PV-TODAYS-TIME-HR       PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-TIME-MIN      PIC 9(02)       VALUE ZEROES.        
               10  PV-TODAYS-TIME-SEC      PIC 9(02)       VALUE ZEROES.        
               10  FILLER                  PIC 9(02)       VALUE ZEROES.        
W26600     05  PV-STORE-NUM-9              PIC 9(04)       VALUE ZEROES.        
           05  PV-STORE-NUM-X REDEFINES PV-STORE-NUM-9                          
W26600                                     PIC X(04).                           
           05  PV-ACTL-INV-DTE-DAYS        PIC S9(9)       VALUE ZEROES         
                               COMP.                                            
           05  PV-PLND-INV-DTE-DAYS        PIC S9(9)       VALUE ZEROES         
                               COMP.                                            
           05  PV-PROCESS-DTE-DAYS         PIC S9(9)       VALUE ZEROES         
                               COMP.                                            
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAMMING TABLES BEGIN ***'.                                  
                                                                                
       01  PT-STORE-TBL-AREA.                                                   
W26600     05  PT-STORE-TBL-MAX            PIC S9(04)      VALUE +9999          
                               COMP.                                            
           05  PT-STORE-TBL-COUNT          PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PT-STORE-TBL-INDX           PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
W26600     05  PT-STORE-TBL OCCURS  9999 TIMES.                                 
W26600         10  PT-STORE-NBR            PIC 9(04)       VALUE ZEROES.        
               10  PT-ACTL-INV-DTE         PIC X(10)       VALUE SPACES.        
               10  PT-PLND-INV-DTE         PIC X(10)       VALUE SPACES.        
               10  PT-SCAN-INV-IND         PIC X(01)       VALUE SPACES.        
                   88  PT-SCAN-INV-STORE                   VALUE 'Y'.           
                   88  PT-NOT-SCAN-INV                     VALUE 'N'.           
               10  PT-ACTL-UNIT-BK-DTE     PIC X(10)       VALUE SPACES.        
               10  PT-ACTL-FIN-BK-DTE      PIC X(10)       VALUE SPACES.        
               10  PT-ACTL-INV-RECD-DTE    PIC X(10)       VALUE SPACES.        
               10  PT-STKRM-DAYS-LEFT      PIC S9(9)       VALUE ZEROES         
                               COMP.                                            
RB0501         10  PT-ACTL-DC-CTOFF-DTE    PIC X(10)       VALUE SPACES.        
               10  PT-SLS-ADJ-CPLD-IND     PIC X(01)       VALUE SPACES.        
                   88  PT-SLS-ADJ-CPLD                     VALUE 'Y'.           
                   88  PT-SLS-ADJ-NOT-CPLD                 VALUE 'N'.           
W33304         10  PT-SCHD-PHY-CNT-CDE     PIC X(02)       VALUE SPACES.        
W33304             88  PT-SCHD-PHY-CNT-STORE               VALUE 'PI'.          
W33304             88  PT-SCHD-PHY-NOT-CNT                 VALUE 'EI'.          
W33304             88  PT-SCHD-PHY-CLOSED                  VALUE 'CL'.          
W33304             88  PT-SCHD-PHY-NONE                    VALUE 'NO'.          
               10  PT-SHEET-INV-CPLD-IND   PIC X(01)       VALUE SPACES.        
                   88  PT-SHEET-INV-CPLD                   VALUE 'Y'.           
W05091             88  PT-SHEET-INV-CPLD-SLCT              VALUE 'S'.           
W33304         10  PT-UNT-BKG-STAT-CDE     PIC X(02)       VALUE SPACES.        
W33304             88  PT-UNT-BKG-STAT-SEL                 VALUE 'SL'.          
W33304             88  PT-UNT-BKG-STAT-APR                 VALUE 'AP'.          
W33304             88  PT-UNT-BKG-STAT-INP                 VALUE 'IP'.          
W33304             88  PT-UNT-BKG-STAT-CAND                VALUE 'IN'.          
W33304             88  PT-UNT-BKG-STAT-CRT                 VALUE 'TC'.          
W33304             88  PT-UNT-BKG-STAT-POST                VALUE 'TP'.          
W33304             88  PT-UNT-BKG-STAT-EXLD                VALUE 'EX'.          
               10  PT-FIL-TOT-BAL-CDE      PIC X(01)       VALUE SPACES.        
               10  PT-TYPE-CODE            PIC X(02)       VALUE SPACES.        
                   88  PT-TYPE-CODE-CS                     VALUE 'CS'.          
                   88  PT-TYPE-CODE-DA                     VALUE 'DA'.          
22960              88  PT-TYPE-CODE-DS                     VALUE 'DS'.          
                   88  PT-TYPE-CODE-DC                     VALUE 'DC'.          
                   88  PT-TYPE-CODE-RV                     VALUE 'RV'.          
22960              88  PT-TYPE-CODE-UNIT-LOCS              VALUES ARE           
PK1165* REMOVED RV     'CS' 'DS' 'RV'.                                          
PK1165                 'CS' 'DS'.                                               
               10  PT-STORE-NAME           PIC X(25)       VALUE SPACES.        
               10  PT-TINENTY-IND          PIC X(01)       VALUE SPACES.        
                   88  PT-TINENTY-FOUND                    VALUE 'Y'.           
                   88  PT-TINENTY-NOT-FOUND                VALUE 'N'.           
               10  PT-TINVDTL-IND          PIC X(01)       VALUE SPACES.        
                   88  PT-TINVDTL-FOUND                    VALUE 'Y'.           
                   88  PT-TINVDTL-NOT-FOUND                VALUE 'N'.           
               10  PT-TSTKRMW-IND          PIC X(01)       VALUE SPACES.        
                   88  PT-TSTKRMW-FOUND                    VALUE 'Y'.           
                   88  PT-TSTKRMW-NOT-FOUND                VALUE 'N'.           
               10  PT-TSUMINV-IND          PIC X(01)       VALUE SPACES.        
                   88  PT-TSUMINV-FOUND                    VALUE 'Y'.           
                   88  PT-TSUMINV-NOT-FOUND                VALUE 'N'.           
               10  PT-STKRMW-CPLD-DATE     PIC X(10)       VALUE SPACES.        
               10  PT-SLS-ADJ-CPLD-DATE    PIC X(10)       VALUE SPACES.        
               10  PT-SHEETS-CPLD-DATE     PIC X(10)       VALUE SPACES.        
               10  PT-STKRM-WDRWL-IND      PIC X(01)       VALUE SPACES.        
                   88  PT-STKRM-WDRWL-NONE                 VALUE 'N'.           
                   88  PT-STKRM-WDRWL-EXPECTED             VALUE 'Y'.           
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** SQL WORK AREA BEGIN ***'.                                       
                                                                                
      *****************************************************************         
      *  SQL ABEND ROUTINE WORKING STORAGE                                      
      *****************************************************************         
      *01  DP004-DB2-ERROR-FIELDS.                                              
           COPY DPWS004.                                                        
                                                                                
       01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES         
                               COMP SYNC.                                       
           88  ABEND-4003                                  VALUE +4003.         
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
28545                                                                           
28545 *****************************************************************         
28545 * TINCNTL DCLGEN                                                          
28545 *****************************************************************         
28545      EXEC SQL                                                             
28545          INCLUDE TINCNTL                                                  
28545      END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------* INKCS046
      *    TINVPAR - PHYSICAL INVENTORY TABLE                         * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TINVPAR                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TINENTY - PHYSICAL INVENTORY OF PRE-COUNTED ITEMS TABLE    * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TINENTY                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TINVDTL - INVALID INVENTORY DETAIL TABLE                   * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TINVDTL                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TSTKRMW - STOCKROOM WITHDRAWL LINE TABLE                   * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TSTKRMW                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
22960 *---------------------------------------------------------------* INKCS046
22960 *    TSUMINV - SUM INVENTORY TABLE                              * INKCS046
22960 *---------------------------------------------------------------* INKCS046
22960      EXEC SQL                                                     INKCS046
22960          INCLUDE TSUMINV                                          INKCS046
22960      END-EXEC.                                                    INKCS046
22960                                                                   INKCS046
      *---------------------------------------------------------------* INKCS046
      *    TADJDTL - SALES ADJUSTMENT DETAIL TABLE                    * INKCS046
      *---------------------------------------------------------------* INKCS046
           EXEC SQL                                                     INKCS046
               INCLUDE TADJDTL                                          INKCS046
           END-EXEC.                                                    INKCS046
                                                                        INKCS046
W26600*---------------------------------------------------------------* INKCS046
W26600*    XMT_LOC - LOCATION TABLE                                   * INKCS046
W26600*---------------------------------------------------------------* INKCS046
W26600     EXEC SQL                                                     INKCS046
W26600         INCLUDE XMT00001                                         INKCS046
W26600     END-EXEC.                                                    INKCS046
                                                                        INKCS046
      *---------------------------------------------------------------*         
      *    TINVPAR - INVENTORY PARAMETER CURSOR FOR ALL LOCATION      *         
      *---------------------------------------------------------------*         
           EXEC SQL   DECLARE TINVPAR-CURSOR CURSOR FOR                         
W26600*         SELECT   A.STORE_NBR                                    INKCS046
W26600          SELECT   A.LOC_NBR                                      INKCS046
                       , A.ACTL_INV_DTE                                         
                       , A.PLND_INV_DTE                                         
                       , A.SCAN_INV_IND                                         
                       , A.ACTL_UNIT_BK_DTE                             INKCS046
                       , A.ACTL_FIN_BK_DTE                              INKCS046
                       , A.ACTL_INV_RECD_DTE                            INKCS046
                       , DAYS(A.ACTL_INV_DTE)                           INKCS046
                       , DAYS(A.PLND_INV_DTE)                           INKCS046
                       , A.STKRM_DAY_QTY                                INKCS046
                       , DAYS(:PV-PROCESSING-DATE)                              
RB0501                 , A.ACTL_DC_CTOFF_DTE                            INKCS046
                       , A.SLS_ADJ_CPLD_IND                             INKCS046
W33304                 , A.SCHD_PHY_CNT_CDE                             INKCS046
                       , A.SHEET_INV_CPLD_IND                           INKCS046
                       , A.UNT_BKG_STAT_CDE                             INKCS046
                       , A.FIL_TOT_BAL_CDE                              INKCS046
                       , A.STKRM_WDRWL_IND                              INKCS046
W26600                 , B.LOC_TYP_CDE                                  INKCS046
W26600                 , B.LOC_NM                                       INKCS046
W26600*                , B.TYPE_CODE                                    INKCS046
W26600*                , B.STORE_NAME                                   INKCS046
W33304                 , A.INV_ID                                       WR33304 
W33304                 , C.PLND_FIN_BKG_DTE                             WR33304 
                FROM   TINVPAR A                                        INKCS046
                      ,XMT_LOC B                                                
28545                 ,TINCNTL C                                                
W26600          WHERE  A.LOC_NBR          =  B.LOC_NBR                          
28545             AND  A.INV_ID           =  C.INV_ID                           
28545             AND ((A.ACTL_FIN_BK_DTE = :PC-INCOMPLETE-DTE          INKCS046
28545                      AND C.ACTV_IND = 'Y')                        INKCS046
                       OR (A.ACTL_FIN_BK_DTE <> :PC-INCOMPLETE-DTE      INKCS046
                           AND A.ACTL_FIN_BK_DTE >=                             
                                         CURRENT DATE - 21 DAYS))               
W33304          ORDER BY C.PLND_FIN_BKG_DTE                             WR33304 
W33304                  ,A.INV_ID                                       WR33304 
                        ,A.LOC_NBR                                      INKCS046
           END-EXEC.                                                            
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE END ***'.                                       
                                                                                
       EJECT                                                                    
       PROCEDURE DIVISION.                                                      
                                                                                
       A100-MAIN-MODULE.                                                        
      ******************************************************************        
      *  MAIN RPOCESSING.                                                       
      ******************************************************************        
                                                                                
           PERFORM B100-HOUSEKEEPING.                                           
                                                                                
           IF RQ-RPT-VALIDS                                                     
               PERFORM Z100-FETCH-TINVPAR                                       
               PERFORM B200-PROCESS-TINVPAR                                     
                   UNTIL END-OF-TINVPAR                                         
               MOVE PT-STORE-TBL-INDX TO PT-STORE-TBL-COUNT                     
               IF PT-STORE-TBL-COUNT > 0                                        
                   PERFORM B300-PRODUCE-REPORTS                                 
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM B400-FINALIZE.                                               
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      * GET THE SYSTEM TIME AND MOVE IT TO THE REPORT HEADING. SET              
      * THE REPORT NAME AND NUMBER.                                             
      ******************************************************************        
       B100-HOUSEKEEPING.                                                       
                                                                                
           ACCEPT PV-TODAYS-DATE FROM DATE.                                     
           ACCEPT PV-TODAYS-TIME FROM TIME.                                     
                                                                                
           MOVE PV-TODAYS-DATE-YY TO PV-PROCESSING-YY.                          
           MOVE PV-TODAYS-DATE-MM TO PV-PROCESSING-MM.                          
           MOVE PV-TODAYS-DATE-DD TO PV-PROCESSING-DD.                          
                                                                                
           MOVE '-' TO PV-PROC-DSH1.                                            
           MOVE '-' TO PV-PROC-DSH2.                                            
                                                                                
           IF PV-TODAYS-DATE-YY > '80'                                          
               MOVE '19' TO PV-PROCESSING-CC                                    
           ELSE                                                                 
               MOVE '20' TO PV-PROCESSING-CC.                                   
                                                                                
           MOVE PV-TODAYS-DATE-MM  TO DP132O-RUN-MONTH.                         
           MOVE PV-TODAYS-DATE-DD  TO DP132O-RUN-DAY.                           
           MOVE PV-TODAYS-DATE-YY  TO DP132O-RUN-YEAR.                          
           MOVE PV-TODAYS-TIME-HR  TO DP132O-RUN-HOUR.                          
           MOVE PV-TODAYS-TIME-MIN TO DP132O-RUN-MINUTE.                        
           MOVE 'INKRP173'         TO DP132O-PROGRAM-NAME.                      
                                                                                
           OPEN INPUT  RPT-REQUEST-CNTL-FILE                                    
                OUTPUT STORE-INV-STAT-RPT.                                      
                                                                                
           EXEC SQL                                                             
               OPEN TINVPAR-CURSOR                                              
           END-EXEC.                                                            
                                                                                
           IF SQLCODE NOT = +0                                                  
               DISPLAY 'PROCESS DATE ' PV-PROCESSING-DATE                       
               MOVE 'OPEN TINVPAR-CURSOR' TO PV-OPER-ATTEMPTED                  
               PERFORM Z999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
           READ RPT-REQUEST-CNTL-FILE                                           
               INTO RQ-RPT-CNTL-AREA.                                           
           DISPLAY 'REPORT REQUESTED:'.                                         
           DISPLAY '  ' RQ-RPT-TYPE.                                            
           DISPLAY '  ----+----1----+----2----+----3----+----4'.                
W26600                                                                          
W26600     MOVE RQ-REQ-USERID          TO RP-REQ-USERID.                        
                                                                                
      ******************************************************************        
      *    PROCESS TINVPAR CURSOR AND OTHER TABLES                              
      ******************************************************************        
       B200-PROCESS-TINVPAR.                                                    
                                                                                
           ADD 1 TO PT-STORE-TBL-INDX.                                          
                                                                                
           IF PT-STORE-TBL-INDX > PT-STORE-TBL-MAX                              
               DISPLAY '** ABEND **'                                            
               DISPLAY '** PGM = INKRP173 **'                                   
               DISPLAY '** STORE TABLE IS TOO SMALL'                            
               DISPLAY '** INCREASE STORE TABLE SIZE'                           
               MOVE +4004 TO ABEND-CODE                                         
               CALL 'ILBOABN0' USING ABEND-CODE                                 
           ELSE                                                                 
               MOVE INVPAR-LOC-NBR                                              
                   TO PT-STORE-NBR          (PT-STORE-TBL-INDX)                 
W26600                PV-STORE-NUM-9                                            
               MOVE INVPAR-ACTL-INV-DTE                                         
                   TO PT-ACTL-INV-DTE       (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-PLND-INV-DTE                                         
                   TO PT-PLND-INV-DTE       (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-SCAN-INV-IND                                         
                   TO PT-SCAN-INV-IND       (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-ACTL-UNIT-BK-DTE                                     
                   TO PT-ACTL-UNIT-BK-DTE   (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-ACTL-FIN-BK-DTE                                      
                   TO PT-ACTL-FIN-BK-DTE    (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-ACTL-INV-RECD-DTE                                    
                   TO PT-ACTL-INV-RECD-DTE  (PT-STORE-TBL-INDX)                 
               MOVE PV-STKRM-DAYS-LEFT                                          
                   TO PT-STKRM-DAYS-LEFT    (PT-STORE-TBL-INDX)                 
RB0501         MOVE INVPAR-ACTL-DC-CTOFF-DTE                                    
RB0501             TO PT-ACTL-DC-CTOFF-DTE  (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-SLS-ADJ-CPLD-IND                                     
                   TO PT-SLS-ADJ-CPLD-IND   (PT-STORE-TBL-INDX)                 
W33304         MOVE INVPAR-SCHD-PHY-CNT-CDE                                     
                   TO PT-SCHD-PHY-CNT-CDE   (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-SHEET-INV-CPLD-IND                                   
                   TO PT-SHEET-INV-CPLD-IND (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-UNT-BKG-STAT-CDE                                     
                   TO PT-UNT-BKG-STAT-CDE   (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-FIL-TOT-BAL-CDE                                      
                   TO PT-FIL-TOT-BAL-CDE    (PT-STORE-TBL-INDX)                 
               MOVE INVPAR-STKRM-WDRWL-IND                                      
                   TO PT-STKRM-WDRWL-IND    (PT-STORE-TBL-INDX)                 
               MOVE XMT00001-LOC-TYP-CDE                                        
                   TO PT-TYPE-CODE          (PT-STORE-TBL-INDX)                 
               MOVE XMT00001-LOC-NM                                             
                   TO PT-STORE-NAME         (PT-STORE-TBL-INDX)                 
           END-IF.                                                              
                                                                                
           PERFORM Z200-CHECK-TINENTY.                                          
           PERFORM Z300-CHECK-TINVDTL.                                          
           PERFORM Z400-CHECK-TSTKRMW.                                          
           PERFORM Z500-CHECK-TADJDTL.                                          
22960      PERFORM Z600-CHECK-TSUMINV.                                          
                                                                                
           PERFORM Z100-FETCH-TINVPAR.                                          
                                                                                
      ******************************************************************        
      *    SELECT AND PRODUCE THE VARIOUS REPORTS                               
      ******************************************************************        
       B300-PRODUCE-REPORTS.                                                    
                                                                                
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-ALL-LOC                                                
               PERFORM C100-ALL-LOCATION                                        
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-SCAN-NOT-PROC                                          
               PERFORM C200-SCAN-NOT-PROCESSED                                  
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-SHTS-NOT-PROC                                          
               PERFORM C300-SHT-NOT-PROCESSED                                   
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-INVL-NOT-CORR                                          
               PERFORM C400-INVLD-NOT-CORRECTED                                 
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-STKRM-NOT-ENT                                          
               PERFORM C500-STKRMW-NOT-ENTERED                                  
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-SLS-ADJ-NOT-CPLD                                       
               PERFORM C600-SLS-ADJ-NOT-COMPLETED                               
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-BOOKING-NOT-CPLD                                       
               PERFORM C700-BOOKING-NOT-COMPLETED                               
           END-IF.                                                              
           IF RQ-RPT-ALL-REPORTS                                                
               OR RQ-RPT-BOOKING-COMPLETED                                      
               PERFORM C800-BOOKING-COMPLETED                                   
           END-IF.                                                              
                                                                                
           MOVE RP-REPORT-END TO RP-REPORT-DETAIL.                              
           MOVE 3 TO PV-ADVANCE-LINE.                                           
22960      PERFORM Z700-PRINT-DETAILS.                                          
                                                                                
      ******************************************************************        
      *    FINALIZE THE REPORT AND CLOSE OUT FILES                              
      ******************************************************************        
       B400-FINALIZE.                                                           
                                                                                
           EXEC SQL                                                             
                CLOSE TINVPAR-CURSOR                                            
           END-EXEC                                                             
           IF SQLCODE NOT = +0                                                  
               MOVE 'CLOSE TINVPAR-CURSOR' TO PV-OPER-ATTEMPTED                 
               PERFORM Z999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
           CLOSE   RPT-REQUEST-CNTL-FILE                                        
                   STORE-INV-STAT-RPT.                                          
                                                                                
      ******************************************************************        
      *    CREATE REPORT FOR ALL LOCATIONS                                      
      ******************************************************************        
       C100-ALL-LOCATION.                                                       
                                                                                
           MOVE SPACES                TO RP-REPORT-TITLE-2.                     
           MOVE PC-ALL-LOCATION-TITLE TO RP-REPORT-SUB-TITLE-12.                
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               PERFORM D100-PREPARE-DETAIL-LINE                                 
22960          PERFORM Z700-PRINT-DETAILS                                       
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON SCAN STORE THAT HAS NOT BEEN PROCESSED              
      ******************************************************************        
       C200-SCAN-NOT-PROCESSED.                                                 
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-SCAN-NOT-PROC-TITLE   TO RP-REPORT-SUB-TITLE-31.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PV-PROCESSING-DATE                                            
                      > PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                     
                   AND PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                 
                           = PC-INCOMPLETE-DTE                                  
                   AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                    
                   AND PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)                
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON STORE WITH SHEETS THAT HAVE NOT PROCESSED           
      ******************************************************************        
       C300-SHT-NOT-PROCESSED.                                                  
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-SHT-NOT-PROC-TITLE    TO RP-REPORT-SUB-TITLE-28.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PT-ACTL-FIN-BK-DTE (PT-STORE-TBL-INDX)                        
                       = PC-INCOMPLETE-DTE                                      
                   AND PV-PROCESSING-DATE                                       
                           >= PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)               
                   AND ((NOT PT-SHEET-INV-CPLD (PT-STORE-TBL-INDX)              
                           AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX))           
W05091                                                                          
W05091              OR (NOT PT-SHEET-INV-CPLD-SLCT (PT-STORE-TBL-INDX)          
W05091                  AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX))              
W05091                                                                          
                    OR (PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)               
                        AND PT-NOT-SCAN-INV(PT-STORE-TBL-INDX)                  
                        AND PT-ACTL-INV-RECD-DTE(PT-STORE-TBL-INDX)             
                               = PC-INCOMPLETE-DTE))                            
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON STORE WITH INVALIDS THAT NEED CORRECTIONS           
      ******************************************************************        
       C400-INVLD-NOT-CORRECTED.                                                
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-INVLD-NOT-CORRECTED   TO RP-REPORT-SUB-TITLE-22.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PT-ACTL-FIN-BK-DTE (PT-STORE-TBL-INDX)                        
                       = PC-INCOMPLETE-DTE                                      
                   AND PT-TINVDTL-FOUND (PT-STORE-TBL-INDX)                     
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON STORE WITH NO STOCKROOM WITHDRAWAL ENTERED          
      ******************************************************************        
       C500-STKRMW-NOT-ENTERED.                                                 
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-STKRMW-NOT-ENTERED    TO RP-REPORT-SUB-TITLE-33.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PV-PROCESSING-DATE                                            
                       > PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                    
                   AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                    
                   AND PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)                
                   AND PT-TSTKRMW-NOT-FOUND (PT-STORE-TBL-INDX)                 
22960              AND (PT-UNT-BKG-STAT-CAND (PT-STORE-TBL-INDX) OR             
22960                   PT-UNT-BKG-STAT-SEL  (PT-STORE-TBL-INDX))               
RB0501             AND PT-STKRM-WDRWL-EXPECTED (PT-STORE-TBL-INDX)              
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON STORE THAT HAS NOT COMPLETED SALES ADJ              
      ******************************************************************        
       C600-SLS-ADJ-NOT-COMPLETED.                                              
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-SLS-ADJ-NOT-COMPLETED TO RP-REPORT-SUB-TITLE-31.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PT-ACTL-FIN-BK-DTE (PT-STORE-TBL-INDX)                        
                       = PC-INCOMPLETE-DTE                                      
                   AND PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                 
                       NOT = PC-INCOMPLETE-DTE                                  
                   AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                    
                   AND NOT PT-SLS-ADJ-CPLD (PT-STORE-TBL-INDX)                  
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON STORE THAT HAS NOT COMPLETED BOOKING                
      ******************************************************************        
       C700-BOOKING-NOT-COMPLETED.                                              
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-BOOKING-NOT-COMPLETED TO RP-REPORT-SUB-TITLE-26.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PT-ACTL-UNIT-BK-DTE (PT-STORE-TBL-INDX)                       
                       = PC-INCOMPLETE-DTE                                      
                   AND ((PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)               
                           NOT = PC-INCOMPLETE-DTE AND                          
                           PT-SCHD-PHY-CNT-STORE(PT-STORE-TBL-INDX) AND         
                           (PT-SCAN-INV-STORE (PT-STORE-TBL-INDX) OR            
                           (PT-NOT-SCAN-INV (PT-STORE-TBL-INDX) AND             
22960                          PT-TYPE-CODE-UNIT-LOCS(PT-STORE-TBL-INDX)        
22960                          AND PT-TSUMINV-FOUND (PT-STORE-TBL-INDX)         
22960                      )                                                    
22960                      ))                                                   
                       OR (PT-SCHD-PHY-CLOSED (PT-STORE-TBL-INDX)               
                           AND PV-PROCESSING-DATE                               
                                 > PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)))        
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    CREATE REPORT ON STORE THAT HAS COMPLETED UNIT BOOKING               
      ******************************************************************        
       C800-BOOKING-COMPLETED.                                                  
                                                                                
           MOVE SPACES                   TO RP-REPORT-TITLE-2.                  
           MOVE PC-BOOKING-COMPLETED     TO RP-REPORT-SUB-TITLE-22.             
22960      PERFORM Z750-PRINT-HEADINGS.                                         
                                                                                
           PERFORM                                                              
               VARYING PT-STORE-TBL-INDX FROM 1 BY 1                            
               UNTIL PT-STORE-TBL-INDX > PT-STORE-TBL-COUNT                     
               IF PT-ACTL-UNIT-BK-DTE (PT-STORE-TBL-INDX)                       
                       NOT = PC-INCOMPLETE-DTE                                  
                   AND (PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                
                           NOT = PC-INCOMPLETE-DTE                              
                       OR (PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)             
                               = PC-INCOMPLETE-DTE AND                          
                           PT-SCHD-PHY-CLOSED (PT-STORE-TBL-INDX)))             
                   PERFORM D100-PREPARE-DETAIL-LINE                             
22960              PERFORM Z700-PRINT-DETAILS                                   
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM Z800-PRINT-SECTION-END.                                      
                                                                                
      ******************************************************************        
      *    PREPARE DETAIL REPORT LINE                                           
      *    NOTE:  THE REPORT DETAIL LINE IS ALWAYS SPACED OUT AFTER             
      *           AFTER THE DETAIL LINE PRINTS, AND THUS CONDITIONS             
      *           RESOLVING TO MOVING SPACE TO THE VARIOUS REPORT               
      *           DETAIL FIELDS ARE NOT CODED HERE.                             
      ******************************************************************        
       D100-PREPARE-DETAIL-LINE.                                                
                                                                                
      * STORE NUMBER AND NAME                                                   
           MOVE PT-STORE-NBR (PT-STORE-TBL-INDX)                                
               TO RP-STORE-NBR.                                                 
           MOVE PT-STORE-NAME (PT-STORE-TBL-INDX)                               
               TO RP-STORE-NAME.                                                
                                                                                
      * STORE LOCATION TYPE                                                     
           IF PT-SCHD-PHY-NOT-CNT (PT-STORE-TBL-INDX)                           
RB0501         MOVE 'EST STR' TO RP-LOCATION-TYPE                               
           ELSE                                                                 
               IF PT-SCHD-PHY-CLOSED (PT-STORE-TBL-INDX)                        
                   MOVE 'CLOSED' TO RP-LOCATION-TYPE                            
               ELSE                                                             
                   IF PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                     
                       MOVE 'SCAN' TO RP-LOCATION-TYPE                          
                   ELSE                                                         
                       IF (PT-TYPE-CODE-CS (PT-STORE-TBL-INDX) OR               
                           PT-TYPE-CODE-DC (PT-STORE-TBL-INDX) OR               
                           PT-TYPE-CODE-DA (PT-STORE-TBL-INDX) OR               
22960                      PT-TYPE-CODE-DS (PT-STORE-TBL-INDX) OR               
                           PT-TYPE-CODE-RV (PT-STORE-TBL-INDX))                 
                           MOVE PT-TYPE-CODE (PT-STORE-TBL-INDX)                
                               TO RP-LOCATION-TYPE                              
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
RB0501* STORE PLANNED INVENTORY DATE                                            
RB0501     MOVE PT-PLND-INV-DTE (PT-STORE-TBL-INDX)                             
RB0501         TO PV-DATE-HOLD-CCYY-MM-DD.                                      
RB0501     PERFORM E300-REFORMAT-DATE.                                          
RB0501     MOVE PV-DATE-RFMT-MMDDCCYY TO RP-PLAN-INV-DATE.                      
RB0501                                                                          
      * STORE INVENTORY DATE                                                    
           IF PT-ACTL-INV-DTE (PT-STORE-TBL-INDX) = PC-INCOMPLETE-DTE           
RB0501         NEXT SENTENCE                                                    
           ELSE                                                                 
               MOVE PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                         
                   TO PV-DATE-HOLD-CCYY-MM-DD                                   
RB0501         PERFORM E300-REFORMAT-DATE                                       
RB0501         MOVE PV-DATE-RFMT-MMDDYY TO RP-INVENTORY-DATE                    
           END-IF.                                                              
                                                                                
      * STORE RECEIVED STATUS                                                   
           EVALUATE TRUE                                                        
               WHEN PT-ACTL-INV-DTE(PT-STORE-TBL-INDX)                          
                       = PC-INCOMPLETE-DTE                                      
                   CONTINUE                                                     
               WHEN PT-ACTL-INV-DTE(PT-STORE-TBL-INDX)                          
                       = PV-PROCESSING-DATE                                     
                   IF PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)                 
                       AND PT-NOT-SCAN-INV (PT-STORE-TBL-INDX)                  
SJ0603                 IF  PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)             
SJ0603                                         = PC-INCOMPLETE-DTE              
                           MOVE 'NOT PROC'   TO RP-RECEIVED-STATUS              
SJ0603                 ELSE                                                     
SJ0603                     MOVE PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)        
SJ0603                         TO PV-DATE-HOLD-CCYY-MM-DD                       
SJ0603                     PERFORM E300-REFORMAT-DATE                           
SJ0603                     MOVE PV-DATE-RFMT-MMDDYY TO                          
SJ0603                                            RP-RECEIVED-STATUS            
SJ0603                 END-IF                                                   
                   END-IF                                                       
               WHEN PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                    
                        = PC-INCOMPLETE-DTE                                     
                   IF PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)                 
                       AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                
                       IF PT-FIL-TOT-BAL-CDE (PT-STORE-TBL-INDX) = PC-Y         
                           MOVE 'BALANCE'   TO RP-RECEIVED-STATUS               
                       ELSE                                                     
                           IF PT-FIL-TOT-BAL-CDE (PT-STORE-TBL-INDX)            
                               = PC-N                                           
                               MOVE 'PEND TTL' TO RP-RECEIVED-STATUS            
                           ELSE                                                 
                               MOVE 'NOT RECD' TO RP-RECEIVED-STATUS            
                           END-IF                                               
                       END-IF                                                   
                   ELSE                                                         
                       IF PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)             
                           AND PT-NOT-SCAN-INV (PT-STORE-TBL-INDX)              
                           MOVE 'NOT PROC'   TO RP-RECEIVED-STATUS              
                       ELSE                                                     
                           IF PT-SCHD-PHY-NOT-CNT (PT-STORE-TBL-INDX)           
                               OR PT-SCHD-PHY-CLOSED(PT-STORE-TBL-INDX)         
                               MOVE 'N/A'   TO RP-RECEIVED-STATUS               
                           ELSE                                                 
                               MOVE 'ERROR' TO RP-RECEIVED-STATUS               
                           END-IF                                               
                       END-IF                                                   
                   END-IF                                                       
               WHEN OTHER                                                       
                   MOVE PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                
                       TO PV-DATE-HOLD-CCYY-MM-DD                               
                   PERFORM E300-REFORMAT-DATE                                   
RB0501             MOVE PV-DATE-RFMT-MMDDYY TO RP-RECEIVED-STATUS               
           END-EVALUATE.                                                        
                                                                                
      * STORE ON-LINE SHEET STATUS                                              
           EVALUATE TRUE                                                        
               WHEN PT-ACTL-INV-DTE(PT-STORE-TBL-INDX)                          
                       = PC-INCOMPLETE-DTE                                      
                   IF PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)                 
                       AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                
                       AND PT-TINENTY-FOUND (PT-STORE-TBL-INDX)                 
                       MOVE 'STARTED'    TO RP-ON-LINE-SHEET-STATUS             
                   END-IF                                                       
               WHEN PT-SHEET-INV-CPLD (PT-STORE-TBL-INDX)                       
                   MOVE PT-SHEETS-CPLD-DATE (PT-STORE-TBL-INDX)                 
RB0501                 TO PV-DATE-HOLD-CCYY-MM-DD                               
RB0501             PERFORM E300-REFORMAT-DATE                                   
RB0501             MOVE PV-DATE-RFMT-MMDDYY                                     
                       TO RP-ON-LINE-SHEET-STATUS                               
M05091         WHEN PT-SHEET-INV-CPLD-SLCT (PT-STORE-TBL-INDX)                  
W05091                 MOVE 'SELECTED'   TO RP-ON-LINE-SHEET-STATUS             
               WHEN PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)                       
                   IF PT-TINENTY-FOUND (PT-STORE-TBL-INDX)                      
                       MOVE 'STARTED'    TO RP-ON-LINE-SHEET-STATUS             
                   END-IF                                                       
               WHEN PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                    
                       = PC-INCOMPLETE-DTE                                      
                   IF PT-TINENTY-FOUND (PT-STORE-TBL-INDX)                      
                       MOVE 'STARTED'    TO RP-ON-LINE-SHEET-STATUS             
                   ELSE                                                         
RB0501                 MOVE 'NOT ENTR'   TO RP-ON-LINE-SHEET-STATUS             
                   END-IF                                                       
               WHEN OTHER                                                       
                   IF PT-TINENTY-FOUND (PT-STORE-TBL-INDX)                      
                       MOVE PT-SHEETS-CPLD-DATE (PT-STORE-TBL-INDX)             
RB0501                     TO PV-DATE-HOLD-CCYY-MM-DD                           
RB0501                 PERFORM E300-REFORMAT-DATE                               
RB0501                 MOVE PV-DATE-RFMT-MMDDYY                                 
                           TO RP-ON-LINE-SHEET-STATUS                           
                   ELSE                                                         
                       MOVE 'NONE'       TO RP-ON-LINE-SHEET-STATUS             
                   END-IF                                                       
           END-EVALUATE.                                                        
                                                                                
      * STORE SALES ADJUSTMENT STATUS                                           
           IF PT-SCHD-PHY-NOT-CNT (PT-STORE-TBL-INDX)                           
               OR PT-SCHD-PHY-CLOSED (PT-STORE-TBL-INDX)                        
               OR PT-NOT-SCAN-INV (PT-STORE-TBL-INDX)                           
               MOVE 'N/A'  TO RP-SALES-ADJ-STATUS                               
           ELSE                                                                 
               IF PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                           
                   = PC-INCOMPLETE-DTE                                          
                   OR PT-ACTL-INV-DTE(PT-STORE-TBL-INDX)                        
                       = PV-PROCESSING-DATE                                     
                   OR PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                  
                        = PC-INCOMPLETE-DTE                                     
                   CONTINUE                                                     
               ELSE                                                             
                   IF PT-SLS-ADJ-CPLD (PT-STORE-TBL-INDX)                       
                       MOVE PT-SLS-ADJ-CPLD-DATE (PT-STORE-TBL-INDX)            
                           TO RP-SALES-ADJ-STATUS                               
                   ELSE                                                         
                       IF PT-SCHD-PHY-CNT-STORE (PT-STORE-TBL-INDX)             
                           AND PT-SCAN-INV-STORE (PT-STORE-TBL-INDX)            
                           AND PT-SLS-ADJ-NOT-CPLD (PT-STORE-TBL-INDX)          
                           PERFORM E100-CHECK-SALES-ADJUSTMENT                  
                       ELSE                                                     
                           MOVE 'ERROR'   TO RP-SALES-ADJ-STATUS                
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      * STORE UNIT BOOKING STATUS                                               
           IF (PT-NOT-SCAN-INV (PT-STORE-TBL-INDX)                              
               AND (PT-TYPE-CODE-DC (PT-STORE-TBL-INDX) OR                      
                    PT-TYPE-CODE-DA (PT-STORE-TBL-INDX)))                       
PK1165* REMOVED RV  PT-TYPE-CODE-RV (PT-STORE-TBL-INDX)                         
               OR PT-SCHD-PHY-NOT-CNT (PT-STORE-TBL-INDX)                       
               MOVE 'N/A'      TO RP-UNIT-BOOK-STATUS                           
           ELSE                                                                 
               IF PT-ACTL-INV-RECD-DTE (PT-STORE-TBL-INDX)                      
                   = PC-INCOMPLETE-DTE                                          
                   AND ((PT-SCHD-PHY-CLOSED (PT-STORE-TBL-INDX) AND             
                         PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                    
                             = PC-INCOMPLETE-DTE)                               
                       OR NOT PT-SCHD-PHY-CLOSED(PT-STORE-TBL-INDX))            
                   CONTINUE                                                     
               ELSE                                                             
                   IF PT-ACTL-UNIT-BK-DTE (PT-STORE-TBL-INDX)                   
                       = PC-INCOMPLETE-DTE                                      
                       IF NOT PT-SLS-ADJ-CPLD (PT-STORE-TBL-INDX)               
                           AND NOT PT-SCHD-PHY-CLOSED(PT-STORE-TBL-INDX)        
RB0501                     MOVE 'WAIT-SLS ADJ' TO RP-UNIT-BOOK-STATUS           
                       ELSE                                                     
                           PERFORM E200-CHECK-BOOKING-STATUS                    
                       END-IF                                                   
                   ELSE                                                         
                       MOVE PT-ACTL-UNIT-BK-DTE (PT-STORE-TBL-INDX)             
                           TO PV-DATE-HOLD-CCYY-MM-DD                           
                       PERFORM E300-REFORMAT-DATE                               
RB0501                 MOVE PV-DATE-RFMT-MMDDYY                                 
                           TO RP-UNIT-BOOK-STATUS                               
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      * STORE STOCKROOM WITHDRAWAL STATUS                                       
           IF PT-STKRM-DAYS-LEFT (PT-STORE-TBL-INDX) <= 0                       
               OR PT-ACTL-UNIT-BK-DTE (PT-STORE-TBL-INDX)                       
                      NOT = PC-INCOMPLETE-DTE                                   
               IF PT-TSTKRMW-FOUND (PT-STORE-TBL-INDX)                          
                   MOVE PT-STKRMW-CPLD-DATE (PT-STORE-TBL-INDX)                 
                       TO RP-STKRM-STATUS                                       
               ELSE                                                             
                   IF PT-STKRM-WDRWL-NONE (PT-STORE-TBL-INDX)                   
RB0501                 MOVE 'COMPLETED'    TO RP-STKRM-STATUS                   
                   ELSE                                                         
                       MOVE 'NONE ENTERED' TO RP-STKRM-STATUS                   
                   END-IF                                                       
               END-IF                                                           
           ELSE                                                                 
               IF PT-TSTKRMW-FOUND (PT-STORE-TBL-INDX)                          
RB0501             IF PT-STKRM-WDRWL-EXPECTED (PT-STORE-TBL-INDX)               
                       MOVE 'STARTED'      TO RP-STKRM-STATUS                   
RB0501             ELSE                                                         
RB0501                 MOVE PT-STKRMW-CPLD-DATE (PT-STORE-TBL-INDX)             
RB0501                     TO RP-STKRM-STATUS                                   
RB0501             END-IF                                                       
               ELSE                                                             
                   IF PT-STKRM-DAYS-LEFT (PT-STORE-TBL-INDX) > 0                
                       AND PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                  
                           <= PV-PROCESSING-DATE                                
                       AND NOT PT-SLS-ADJ-CPLD (PT-STORE-TBL-INDX)              
22960                  AND PT-STKRM-WDRWL-EXPECTED (PT-STORE-TBL-INDX)          
22960                  AND (PT-UNT-BKG-STAT-CAND (PT-STORE-TBL-INDX) OR         
22960                       PT-UNT-BKG-STAT-SEL  (PT-STORE-TBL-INDX))           
                       MOVE PT-STKRM-DAYS-LEFT (PT-STORE-TBL-INDX)              
                           TO RP-STKRM-STATUS-DAYS                              
                       IF PT-STKRM-DAYS-LEFT (PT-STORE-TBL-INDX) > 1            
                           MOVE PC-DAYS-LEFT TO RP-STKRM-STATUS-TEXT            
                       ELSE                                                     
                           MOVE PC-DAY-LEFT  TO RP-STKRM-STATUS-TEXT            
                       END-IF                                                   
                   ELSE                                                         
                       IF PT-ACTL-INV-DTE (PT-STORE-TBL-INDX)                   
                           <= PV-PROCESSING-DATE                                
                           IF PT-STKRM-WDRWL-NONE (PT-STORE-TBL-INDX)           
RB0501                         MOVE 'COMPLETED'    TO RP-STKRM-STATUS           
                           ELSE                                                 
                               MOVE 'NONE ENTERED' TO RP-STKRM-STATUS           
                           END-IF                                               
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
RB0501* ACTUAL DC CUT-OFF DATE                                                  
RB0501     IF PT-ACTL-DC-CTOFF-DTE (PT-STORE-TBL-INDX)                          
RB0501         EQUAL PC-INCOMPLETE-DTE                                          
RB0501         MOVE 'N/A' TO RP-DC-CUTOFF-DATE                                  
RB0501     ELSE                                                                 
RB0501         MOVE PT-ACTL-DC-CTOFF-DTE (PT-STORE-TBL-INDX)                    
RB0501             TO PV-DATE-HOLD-CCYY-MM-DD                                   
RB0501         PERFORM E300-REFORMAT-DATE                                       
RB0501         MOVE PV-DATE-RFMT-MMDDCCYY TO RP-DC-CUTOFF-DATE                  
RB0501     END-IF.                                                              
RB0501                                                                          
      ******************************************************************        
      *    CHECK SALES ADJUSTMENT WAIT STATUS                                   
      ******************************************************************        
       E100-CHECK-SALES-ADJUSTMENT.                                             
                                                                                
           IF PT-TINVDTL-FOUND (PT-STORE-TBL-INDX)                              
               MOVE 'WAIT-CORR'  TO RP-SALES-ADJ-STATUS                         
           ELSE                                                                 
               IF PT-TSTKRMW-NOT-FOUND (PT-STORE-TBL-INDX)                      
                   AND PT-STKRM-DAYS-LEFT (PT-STORE-TBL-INDX) > 0               
                   MOVE 'WAIT-STRM'  TO RP-SALES-ADJ-STATUS                     
               ELSE                                                             
                   MOVE 'WAIT-CAND'  TO RP-SALES-ADJ-STATUS                     
               END-IF                                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    CHECK THE UNIT BOOKING STATUS                                        
      ******************************************************************        
       E200-CHECK-BOOKING-STATUS.                                               
                                                                                
           EVALUATE TRUE                                                        
               WHEN PT-UNT-BKG-STAT-SEL (PT-STORE-TBL-INDX)                     
RB0501             MOVE 'WAIT-NOT SEL' TO RP-UNIT-BOOK-STATUS                   
               WHEN PT-UNT-BKG-STAT-APR (PT-STORE-TBL-INDX)                     
RB0501             MOVE 'SEL FOR BKNG' TO RP-UNIT-BOOK-STATUS                   
               WHEN PT-UNT-BKG-STAT-INP (PT-STORE-TBL-INDX)                     
RB0501             MOVE 'BKNG IN PROC' TO RP-UNIT-BOOK-STATUS                   
               WHEN PT-UNT-BKG-STAT-CAND (PT-STORE-TBL-INDX)                    
RB0501             MOVE 'WAIT-CAND'  TO RP-UNIT-BOOK-STATUS                     
W33304         WHEN PT-UNT-BKG-STAT-CRT (PT-STORE-TBL-INDX)                     
W33304             MOVE 'TRAN CREATED' TO RP-UNIT-BOOK-STATUS                   
W33304         WHEN PT-UNT-BKG-STAT-POST (PT-STORE-TBL-INDX)                    
W33304             MOVE 'TRAN POSTED' TO RP-UNIT-BOOK-STATUS                    
W33304         WHEN PT-UNT-BKG-STAT-EXLD (PT-STORE-TBL-INDX)                    
W33304             MOVE 'EXCLUDE  '  TO RP-UNIT-BOOK-STATUS                     
               WHEN OTHER                                                       
                   MOVE 'ERROR'           TO RP-UNIT-BOOK-STATUS                
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    REFORMAT DATE FOR OUTPUT FROM CCYY-MM-DD TO MM-DD-CCYY               
      ******************************************************************        
       E300-REFORMAT-DATE.                                                      
                                                                                
RB0501     MOVE PV-DATE-HOLD-CCYY                                               
RB0501         TO PV-DATE-RFMT-CCYY OF PV-DATE-RFMT-MMDDCCYY-REDEF.             
RB0501     MOVE PV-DATE-RFMT-YY OF PV-DATE-RFMT-MMDDCCYY-REDEF                  
RB0501         TO PV-DATE-RFMT-YY OF PV-DATE-RFMT-MMDDYY-REDEF.                 
RB0501     MOVE PV-DATE-HOLD-MM                                                 
RB0501         TO PV-DATE-RFMT-MM OF PV-DATE-RFMT-MMDDYY-REDEF                  
RB0501            PV-DATE-RFMT-MM OF PV-DATE-RFMT-MMDDCCYY-REDEF.               
RB0501     MOVE PV-DATE-HOLD-DD                                                 
RB0501         TO PV-DATE-RFMT-DD OF PV-DATE-RFMT-MMDDYY-REDEF                  
RB0501            PV-DATE-RFMT-DD OF PV-DATE-RFMT-MMDDCCYY-REDEF.               
RB0501     MOVE PV-DATE-HOLD-DASH-1                                             
RB0501         TO PV-DATE-RFMT-DASH-1 OF PV-DATE-RFMT-MMDDYY-REDEF              
RB0501            PV-DATE-RFMT-DASH-1 OF PV-DATE-RFMT-MMDDCCYY-REDEF.           
RB0501     MOVE PV-DATE-HOLD-DASH-2                                             
RB0501         TO PV-DATE-RFMT-DASH-2 OF PV-DATE-RFMT-MMDDYY-REDEF              
RB0501            PV-DATE-RFMT-DASH-2 OF PV-DATE-RFMT-MMDDCCYY-REDEF.           
                                                                                
      ******************************************************************        
      *    FETCH THE NEXT RECORD FROM TINVPAR CURSOR                            
      ******************************************************************        
       Z100-FETCH-TINVPAR.                                                      
                                                                                
           EXEC SQL FETCH TINVPAR-CURSOR                                        
              INTO :INVPAR-LOC-NBR                                              
                  ,:INVPAR-ACTL-INV-DTE                                         
                  ,:INVPAR-PLND-INV-DTE                                         
                  ,:INVPAR-SCAN-INV-IND                                         
                  ,:INVPAR-ACTL-UNIT-BK-DTE                                     
                  ,:INVPAR-ACTL-FIN-BK-DTE                                      
                  ,:INVPAR-ACTL-INV-RECD-DTE                                    
                  ,:PV-ACTL-INV-DTE-DAYS                                        
                  ,:PV-PLND-INV-DTE-DAYS                                        
                  ,:INVPAR-STKRM-DAY-QTY                                        
                  ,:PV-PROCESS-DTE-DAYS                                         
RB0501            ,:INVPAR-ACTL-DC-CTOFF-DTE                                    
                  ,:INVPAR-SLS-ADJ-CPLD-IND                                     
W33304            ,:INVPAR-SCHD-PHY-CNT-CDE                                     
                  ,:INVPAR-SHEET-INV-CPLD-IND                                   
                  ,:INVPAR-UNT-BKG-STAT-CDE                                     
                  ,:INVPAR-FIL-TOT-BAL-CDE                                      
                  ,:INVPAR-STKRM-WDRWL-IND                                      
                  ,:XMT00001-LOC-TYP-CDE                                        
                  ,:XMT00001-LOC-NM                                             
W33304            ,:INVPAR-INV-ID                                               
W33304            ,:INVPAR-PLND-FIN-BK-DTE                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   IF INVPAR-ACTL-INV-DTE = PC-INCOMPLETE-DTE                   
                       COMPUTE PV-STKRM-DAYS-LEFT =                             
                               PV-PLND-INV-DTE-DAYS +                           
                               INVPAR-STKRM-DAY-QTY -                           
                               PV-PROCESS-DTE-DAYS                              
                   ELSE                                                         
                       COMPUTE PV-STKRM-DAYS-LEFT =                             
                               PV-ACTL-INV-DTE-DAYS +                           
                               INVPAR-STKRM-DAY-QTY -                           
                               PV-PROCESS-DTE-DAYS                              
                   END-IF                                                       
               WHEN +100                                                        
                   SET END-OF-TINVPAR TO TRUE                                   
               WHEN OTHER                                                       
                   MOVE 'FETCH TINVPAR-CURSOR' TO  PV-OPER-ATTEMPTED            
                   PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CHECK INVENTORY PRE-COUNT ITEM (TINENTY) FOR A GIVEN STORE           
      ******************************************************************        
       Z200-CHECK-TINENTY.                                                      
                                                                                
           MOVE PV-STORE-NUM-9   TO INENTY-STR-NBR.                             
           EXEC SQL                                                             
               SELECT MAX(DATE(LAST_UPD_TMST))                                  
                   INTO  :PV-SQL-TABLE-DATE-CHECK                               
                   FROM  TINENTY                                                
                   WHERE STR_NBR = :INENTY-STR-NBR                              
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   SET PT-TINENTY-FOUND (PT-STORE-TBL-INDX) TO TRUE             
                   MOVE PV-SQL-TABLE-DATE-CHECK                                 
                       TO PT-SHEETS-CPLD-DATE (PT-STORE-TBL-INDX)               
               WHEN -305                                                        
                   SET PT-TINENTY-NOT-FOUND (PT-STORE-TBL-INDX) TO TRUE         
               WHEN +100                                                        
                   SET PT-TINENTY-NOT-FOUND (PT-STORE-TBL-INDX) TO TRUE         
               WHEN OTHER                                                       
                   MOVE 'CHECK/GET TINENTY DATE' TO  PV-OPER-ATTEMPTED          
                   PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CHECK INVALID DETAIL (TINVDTL) FOR A GIVEN STORE                     
      ******************************************************************        
       Z300-CHECK-TINVDTL.                                                      
                                                                                
W26600     MOVE PV-STORE-NUM-9   TO INVDTL-LOC-NBR.                             
           EXEC SQL                                                             
               SELECT 1                                                         
                   INTO  :PV-SQL-TABLE-CHECK                                    
                   FROM  TINVDTL                                                
W26600             WHERE LOC_NBR = :INVDTL-LOC-NBR                              
                       AND INVALID_REC_IND = :PC-Y                              
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   CONTINUE                                                     
               WHEN -811                                                        
                   SET PT-TINVDTL-FOUND (PT-STORE-TBL-INDX) TO TRUE             
               WHEN +100                                                        
                   SET PT-TINVDTL-NOT-FOUND (PT-STORE-TBL-INDX) TO TRUE         
               WHEN OTHER                                                       
                   MOVE 'CHECK TINVDTL COUNT' TO  PV-OPER-ATTEMPTED             
                   PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CHECK STOCKROOM WITHDRAWAL (TSTKRMW) FOR A GIVEN STORE               
      ******************************************************************        
       Z400-CHECK-TSTKRMW.                                                      
                                                                                
W26600     MOVE PV-STORE-NUM-9   TO STKRMW-LOC-NBR.                             
           EXEC SQL                                                             
               SELECT MAX(DATE(CHG_TMST))                                       
                   INTO  :PV-SQL-TABLE-DATE-CHECK                               
                   FROM  TSTKRMW                                                
W26600             WHERE LOC_NBR = :STKRMW-LOC-NBR                              
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   SET PT-TSTKRMW-FOUND (PT-STORE-TBL-INDX) TO TRUE             
                   MOVE PV-SQL-TABLE-DATE-CHECK                                 
                       TO PT-STKRMW-CPLD-DATE (PT-STORE-TBL-INDX)               
               WHEN -305                                                        
                   SET PT-TSTKRMW-NOT-FOUND (PT-STORE-TBL-INDX) TO TRUE         
               WHEN +100                                                        
                   SET PT-TSTKRMW-NOT-FOUND (PT-STORE-TBL-INDX) TO TRUE         
               WHEN OTHER                                                       
                   MOVE 'CHECK/GET TSTKRMW DATE' TO  PV-OPER-ATTEMPTED          
                   PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *    CHECK SALES ADJUSTMENT (TADJDTL) FOR A GIVEN STORE                   
      ******************************************************************        
       Z500-CHECK-TADJDTL.                                                      
                                                                                
W26600     MOVE PV-STORE-NUM-9   TO ADJDTL-LOC-NBR.                             
           EXEC SQL                                                             
               SELECT MAX(DATE(CRE_TMST))                                       
                   INTO  :PV-SQL-TABLE-DATE-CHECK                               
                   FROM  TADJDTL                                                
W26600             WHERE LOC_NBR = :ADJDTL-LOC-NBR                              
                       AND ADJ_TYPE_CDE = 'SA'                                  
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   MOVE PV-SQL-TABLE-DATE-CHECK                                 
                       TO PT-SLS-ADJ-CPLD-DATE (PT-STORE-TBL-INDX)              
               WHEN -305                                                        
                   CONTINUE                                                     
               WHEN +100                                                        
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'CHECK/GET TADJDTL DATE' TO  PV-OPER-ATTEMPTED          
                   PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
22960 ******************************************************************        
22960 *    CHECK SUM INVENTORY (TSUMINV) FOR A GIVEN STORE                      
22960 ******************************************************************        
22960  Z600-CHECK-TSUMINV.                                                      
22960                                                                           
W26600     MOVE PV-STORE-NUM-9   TO SUMINV-LOC-NBR                              
22960      EXEC SQL                                                             
22960          SELECT 1                                                         
22960              INTO  :PV-SQL-TABLE-CHECK                                    
22960              FROM  TSUMINV                                                
W26600             WHERE LOC_NBR = :SUMINV-LOC-NBR                              
22960      END-EXEC.                                                            
22960                                                                           
22960      EVALUATE SQLCODE                                                     
22960          WHEN +0                                                          
22960              CONTINUE                                                     
22960          WHEN -811                                                        
22960              SET PT-TSUMINV-FOUND (PT-STORE-TBL-INDX) TO TRUE             
22960          WHEN +100                                                        
22960              SET PT-TSUMINV-NOT-FOUND (PT-STORE-TBL-INDX) TO TRUE         
22960          WHEN OTHER                                                       
22960              MOVE 'CHECK/GET TSUMINV COUNT' TO PV-OPER-ATTEMPTED          
22960              PERFORM Z999-SQL-ABEND                                       
22960      END-EVALUATE.                                                        
22960                                                                           
      ******************************************************************        
      *    PRINT THE REPORT DETAILS                                             
      ******************************************************************        
22960  Z700-PRINT-DETAILS.                                                      
                                                                                
           IF PV-PRINT-LINE-COUNT > PC-PRINT-LINE-MAX                           
22960          PERFORM Z750-PRINT-HEADINGS                                      
           END-IF.                                                              
                                                                                
           WRITE REPORT-LINE FROM RP-REPORT-DETAIL                              
               AFTER ADVANCING PV-ADVANCE-LINE LINES.                           
                                                                                
           ADD  PV-ADVANCE-LINE TO PV-PRINT-LINE-COUNT.                         
           MOVE 1               TO PV-ADVANCE-LINE.                             
           MOVE SPACES TO RP-REPORT-DETAIL.                                     
                                                                                
      ******************************************************************        
      *    PRINT THE REPORT HEADINGS                                            
      ******************************************************************        
22960  Z750-PRINT-HEADINGS.                                                     
                                                                                
           ADD 1 TO PV-PAGE-COUNT.                                              
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                            
           MOVE 1             TO DP132O-REPORT-NUMBER.                          
           WRITE REPORT-LINE FROM DP132O-STANDRD-HEADER-132-COLS                
               AFTER ADVANCING PAGE.                                            
                                                                                
           WRITE REPORT-LINE FROM RP-REPORT-TITLE-1.                            
           WRITE REPORT-LINE FROM RP-REPORT-TITLE-2.                            
                                                                                
           WRITE REPORT-LINE FROM RP-REPORT-HEADER-1                            
               AFTER ADVANCING 2 LINES.                                         
           WRITE REPORT-LINE FROM RP-REPORT-HEADER-2.                           
           WRITE REPORT-LINE FROM RP-REPORT-HEADER-3.                           
                                                                                
           MOVE 8 TO PV-PRINT-LINE-COUNT.                                       
           MOVE 2 TO PV-ADVANCE-LINE.                                           
                                                                                
      ******************************************************************        
      *    PRINT END OF SECTION                                                 
      ******************************************************************        
       Z800-PRINT-SECTION-END.                                                  
                                                                                
           IF PV-PRINT-LINE-COUNT + 4 < PC-PRINT-LINE-MAX                       
               COMPUTE PV-ADVANCE-LINE =                                        
                   PC-PRINT-LINE-MAX - PV-PRINT-LINE-COUNT - 4                  
           ELSE                                                                 
               MOVE 2 TO PV-ADVANCE-LINE                                        
           END-IF.                                                              
                                                                                
           MOVE RP-SECTION-END TO RP-REPORT-DETAIL.                             
           PERFORM Z700-PRINT-DETAILS.                                          
                                                                                
      ******************************************************************        
      *    SQL ERROR - ABEND                                                    
      ******************************************************************        
       Z999-SQL-ABEND.                                                          
                                                                                
           MOVE +4013                 TO ABEND-CODE.                            
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  INKRP173'.                             
           DISPLAY '**  OPERATION **  = '  PV-OPER-ATTEMPTED                    
                                                                                
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
                                                                                
           COPY DPPD004.                                                        
                                                                                
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
