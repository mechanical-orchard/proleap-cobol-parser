      *************************                                                 
       IDENTIFICATION DIVISION.                                                 
      *************************                                                 
       PROGRAM-ID.    MBKCS135.                                                 
       AUTHOR.        MIKE FURLICK.                                             
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  11-19-91.                                                 
       DATE-COMPILED.                                                           
                                                                                
      *****************************************************************         
      *    R135 - BATCH PARAMETER UPDATE.                                       
      *                                                                         
      *    THIS PROGRAM CREATES OR UPDATE BATCH PARAMETER RECORDS               
      *    FOR MBS REALIGNMENT (TYPE MBKUT007) OR A BUYER CHANGE (TYPE          
      *    (MBKUT006).  THE DATA IS MAINTAINED IN A VSAM KSDS.  IF THE          
      *    RECORD IS FOUND, IT WILL BE UPDATED, IF NOT FOUND, IT WILL           
      *    BE ADDED.  (MBBCHCTL IS THE DDNAME).                                 
      *    THIS PROGRAM PROVIDES THE INPUT FOR THE BATCH PROGRAM TO             
      *    PERFORM THE ACTUAL DB2 DATABASE UPDATES.                             
      *                                                                         
      *    MBS DATE CHANGE (TYPE MBKUT008) RECORDS ADDED 3-92                   
      *    BY M. FURLICK.                                                       
      *                                                                         
      *****************************************************************         
      *    REALIGNMENT EFFECTIVE DATE EDIT CHANGED TO ONLY ALLOW AN             
      *    EFFECTIVE DATE WITHIN 10 DAYS OF THE CURRENT DATE.                   
      *    ALSO CHANGE PGM TO NO LONGER ALLOW REALIGNMENTS AT THE MAJOR         
      *    CLASS OR SUB CLASS LEVEL (ERROR 1355 IF MCL/SCL ENTERED).            
      *    (CODE LEFT IN PROGRAM BUT COMMENTED OUT; MAY NEED LATER.)            
      *    CHANGED:  08/15/96         BY:  PATI GREEN        WR#: 4026          
      *****************************************************************         
      *    UPGRADE CODE FOR Y2K COMPLIANCE.                                     
      *    CHANGED:  06/18/98         BY:  DOUG DOUGLAS      WR#: 6041          
      *****************************************************************         
      *                                                                         
      *                                                                         
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
      *                                                                         
      *                                                                         
      *                                                                         
       DATA DIVISION.                                                           
      *                                                                         
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.        
           05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072          
                                                           COMP SYNC.           
           05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE                
           'MB135A  '.                                                          
           05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE                
           'MBKM135 '.                                                          
           05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE                
           'MBKCS135'.                                                          
           05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128           
                                                           COMP SYNC.           
           05  FILLER REDEFINES PC-ERASE-EOF-COMP.                              
               10  FILLER                     PIC X(01).                        
               10  PC-ERASE-EOF               PIC X(01).                        
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3              
                                                           COMP-3.              
           05  PC-COMPANY                     PIC XX       VALUE '03'.          
           05  PC-NINES                       PIC 999      VALUE 999.           
           05  PC-NINES-DATE                  PIC X(10)    VALUE                
                                                           '9999-09-09'.        
                                                                                
           05  PC-CO                          PIC XXX      VALUE 'CO '.         
           05  PC-GMA                         PIC XXX      VALUE 'GMA'.         
           05  PC-DMA                         PIC XXX      VALUE 'DMA'.         
           05  PC-DPT                         PIC XXX      VALUE 'DPT'.         
           05  PC-MCL                         PIC XXX      VALUE 'MCL'.         
           05  PC-SCL                         PIC XXX      VALUE 'SCL'.         
           05  PC-10-DAY-LIMIT                PIC 9(2)     VALUE 10.            
      *****************************************************************         
      *    THIS FIELDS DETERMINES HOW MANY DAYS IN THE PAST WE ALLOW            
      *    THE USER TO CHANGE THE START DATE.                                   
      *                                                                         
           05  PC-START-DATE-CHANGE-DAYS      PIC 9(3)    VALUE 60.             
      *                                                                         
      *****************************************************************         
      *                                                                         
       01  PC-TSYMSG-NUMBERS.                                                   
           05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.          
           05  PC-TSYMSG-00007                PIC 9(5)    VALUE 00007.          
           05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.          
           05  PC-TSYMSG-00009                PIC 9(5)    VALUE 00009.          
           05  PC-TSYMSG-00025                PIC 9(5)    VALUE 00025.          
           05  PC-TSYMSG-00032                PIC 9(5)    VALUE 00032.          
           05  PC-TSYMSG-00034                PIC 9(5)    VALUE 00034.          
           05  PC-TSYMSG-00036                PIC 9(5)    VALUE 00036.          
           05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.          
           05  PC-TSYMSG-00046                PIC 9(5)    VALUE 00046.          
           05  PC-TSYMSG-00059                PIC 9(5)    VALUE 00059.          
           05  PC-TSYMSG-00067                PIC 9(5)    VALUE 00067.          
           05  PC-TSYMSG-00080                PIC 9(5)    VALUE 00080.          
           05  PC-TSYMSG-00143                PIC 9(5)    VALUE 00143.          
           05  PC-TSYMSG-00144                PIC 9(5)    VALUE 00144.          
           05  PC-TSYMSG-00145                PIC 9(5)    VALUE 00145.          
           05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.          
           05  PC-TSYMSG-00185                PIC 9(5)    VALUE 00185.          
           05  PC-TSYMSG-00191                PIC 9(5)    VALUE 00191.          
           05  PC-TSYMSG-00192                PIC 9(5)    VALUE 00192.          
           05  PC-TSYMSG-00193                PIC 9(5)    VALUE 00193.          
           05  PC-TSYMSG-00194                PIC 9(5)    VALUE 00194.          
           05  PC-TSYMSG-00195                PIC 9(5)    VALUE 00195.          
           05  PC-TSYMSG-00196                PIC 9(5)    VALUE 00196.          
           05  PC-TSYMSG-00197                PIC 9(5)    VALUE 00197.          
           05  PC-TSYMSG-00198                PIC 9(5)    VALUE 00198.          
           05  PC-TSYMSG-00199                PIC 9(5)    VALUE 00199.          
           05  PC-TSYMSG-00212                PIC 9(5)    VALUE 00212.          
           05  PC-TSYMSG-00213                PIC 9(5)    VALUE 00213.          
           05  PC-TSYMSG-00214                PIC 9(5)    VALUE 00214.          
           05  PC-TSYMSG-01346                PIC 9(5)    VALUE 01346.          
           05  PC-TSYMSG-01355                PIC 9(5)    VALUE 01355.          
      *                                                                         
       01  PM-PROGRAM-MESSAGES.                                                 
           05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE                
           'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                        
           05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE                
           'VSAM ACCESS ERROR ATTEMPTING TO READ    - RESP = '.                 
           05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                          
               10  FILLER                     PIC X(32).                        
               10  PM-ACTION-22               PIC X(7).                         
               10  FILLER                     PIC X(11).                        
               10  PM-RESP-22                 PIC 9999.                         
               10  FILLER                     PIC X(24).                        
      *                                                                         
       01  PS-PROGRAM-SUBSCRIPTS.                                               
           05  PS-SUB                         PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
           05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0             
                                                           COMP-3.              
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.           
               88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.           
               88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.           
               88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.           
               88  PS-SEND-DATA-ONLY                       VALUE '4'.           
               88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.           
               88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.           
           05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.           
               88  PS-ERROR                                VALUE 'Y'.           
               88  PS-NO-ERROR                             VALUE 'N'.           
           05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.           
               88  PS-INTER-APPL-VALID                     VALUE 'Y'.           
               88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.           
           05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.           
               88  PS-WARNING                              VALUE 'Y'.           
               88  PS-NO-WARNING                           VALUE 'N'.           
           05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.           
               88  PS-INFORMATIONAL                        VALUE 'Y'.           
               88  PS-NOT-INFORMATIONAL                    VALUE 'N'.           
           05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.           
               88  PS-CONTINUE                             VALUE 'Y'.           
               88  PS-DONT-PROCESS                         VALUE 'N'.           
           05  PS-REALIGNMENT-CHANGE-SW       PIC X(01)    VALUE 'N'.           
               88  PS-REALIGNMENT                          VALUE 'Y'.           
               88  PS-NO-REALIGNMENT                       VALUE 'N'.           
               88  PS-INVALID-REALIGNMENT                  VALUE 'I'.           
           05  PS-BUYER-CHANGE-SW             PIC X(01)    VALUE 'N'.           
               88  PS-BUYER-CHANGE                         VALUE 'Y'.           
               88  PS-NO-BUYER-CHANGE                      VALUE 'N'.           
               88  PS-INVALID-BUYER                        VALUE 'I'.           
           05  PS-MBS-DATE-CHANGE-SW          PIC X(01)    VALUE 'N'.           
               88  PS-DATE-CHANGE                          VALUE 'Y'.           
               88  PS-NO-DATE-CHANGE                       VALUE 'N'.           
               88  PS-INVALID-DATE-CHANGE                  VALUE 'I'.           
           05  PS-DATE-SW                     PIC X(01)    VALUE 'N'.           
               88  PS-VALID-DATE                           VALUE 'Y'.           
               88  PS-INVALID-DATE                         VALUE 'N'.           
           05  PS-OLD-DATA-SW                 PIC X(01)    VALUE 'N'.           
               88  PS-OLD-FIELD-SPACES                     VALUE 'Y'.           
               88  PS-OLD-FIELD-NOT-SPACES                 VALUE 'N'.           
           05  PS-DATE-PRESENT-SW             PIC X(01)    VALUE 'N'.           
               88  PS-DATE-PRESENT                         VALUE 'Y'.           
               88  PS-DATE-NOT-PRESENT                     VALUE 'N'.           
           05  PS-WRITE-008-SW                PIC X(01)    VALUE 'N'.           
               88  PS-WRITE-008                            VALUE 'Y'.           
               88  PS-DONT-WRITE-008                       VALUE 'N'.           
           EJECT                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
           05  PV-RESP                        PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
           05  PV-ITEM                        PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
           05  PV-AS-ITEM                     PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
           05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.        
           05  PV-SQL-SUB                     PIC S9(4)    COMP.                
           05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.              
           05  PV-BATCH-CNTL-RECORD           PIC X(100).                       
           05  PV-HOLD-LIST-SEQ-NBR           PIC S9(15)   COMP-3.              
           05  PV-HOLD-MAX-SEQ-NBR            PIC S9(15)   COMP-3.              
      *                                                                         
           05  PV-WORK-SEQ-NBR                PIC S9(15).                       
           05  FILLER  REDEFINES  PV-WORK-SEQ-NBR.                              
               10  PV-WS-OPERCO               PIC 99.                           
               10  PV-SCREEN-DATA.                                              
                   15  PV-WS-GMA              PIC 99.                           
                   15  PV-WS-DMA              PIC 99.                           
                   15  PV-WS-DEPT             PIC 999.                          
                   15  PV-WS-MAJ-CL           PIC 99.                           
                   15  PV-WS-SUB-CL           PIC 999.                          
               10  PV-WS-ZERO                 PIC 9.                            
      *                                                                         
           05  PV-EFFECTIVE-DATE.                                               
               10  PV-EFF-CC                  PIC 9(2).                         
               10  PV-EFF-YY                  PIC 9(2).                         
               10  PV-EFF-MM                  PIC 9(2).                         
               10  PV-EFF-DD                  PIC 9(2).                         
                                                                                
           05  PV-RETURN-DATE.                                                  
               10  PV-RET-CC                  PIC 9(2).                         
               10  PV-RET-YY                  PIC 9(2).                         
               10  PV-RET-MM                  PIC 9(2).                         
               10  PV-RET-DD                  PIC 9(2).                         
                                                                                
       01  PV-DB2-COUNT                       PIC S9(9)    VALUE +0             
                                                           COMP-3.              
       01  PV-DB2-DATE                        PIC X(10).                        
       01  FILLER  REDEFINES PV-DB2-DATE.                                       
           05  PV-DD-CC                       PIC XX.                           
           05  PV-DD-YY                       PIC XX.                           
           05  FILLER                         PIC X.                            
               88  PV-DD-DASH1                             VALUE '-'.           
           05  PV-DD-MM                       PIC XX.                           
           05  FILLER                         PIC X.                            
               88  PV-DD-DASH2                             VALUE '-'.           
           05  PV-DD-DD                       PIC XX.                           
       01  PV-DB2-WORK-DATE                   PIC X(10).                        
       01  PV-DB2-1900-DATE                   PIC X(10)    VALUE                
                                                          '1900-01-01'.         
      *                                                                         
       EJECT                                                                    
      *****************************************************************         
      *    STANDARD COMMAREA.                                                   
      *****************************************************************         
                                                                                
           COPY DPWS020.                                                        
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
                                                                                
      *****************************************************************         
      *    INTER-APPLICATION COMMAREA.                                          
      *****************************************************************         
                                                                                
               10  INTER-APPL-COMM-AREA       PIC X(200).                       
           COPY MBWS005.                                                        
      *****************************************************************         
      *    SPECIFIC COMMMAREA FOR MBKCS135.                                     
      *****************************************************************         
               10  MB135-SPECIFIC-COMMAREA.                                     
                   15  MB135-APPL-CURSOR-POSITION          PIC S9(04)           
                                                           COMP.                
                 12    MB135-SCREEN-DATA.                                       
                   15  MB135-OLD-DATA.                                          
                       20  MB135-OLD-GMA                   PIC XX.              
                       20  MB135-OLD-DMA                   PIC XX.              
                       20  MB135-OLD-DEPT                  PIC X(3).            
                       20  MB135-OLD-MAJ-CL                PIC XX.              
                       20  MB135-OLD-SUB-CL                PIC X(3).            
                   15  MB135-NEW-DATA.                                          
                       20  MB135-NEW-GMA                   PIC XX.              
                       20  MB135-NEW-DMA                   PIC XX.              
                       20  MB135-NEW-DEPT                  PIC X(3).            
                       20  MB135-NEW-MAJ-CL.                                    
                           25  MB135-NEW-MAJ-CL-BYTE1      PIC X.               
                           25  MB135-NEW-MAJ-CL-BYTE2      PIC X.               
                       20  MB135-NEW-SUB-CL.                                    
                           25  MB135-NEW-SUB-CL-BYTE1      PIC X.               
                           25  MB135-NEW-SUB-CL-BYTE2      PIC X.               
                           25  MB135-NEW-SUB-CL-BYTE3      PIC X.               
                                                                                
                   15  MB135-EFFECTIVE-DATE.                                    
                       20  MB135-ED-CC                     PIC XX.              
                       20  MB135-EFFECTIVE-DATE-YMD.                            
                           25  MB135-ED-YY                 PIC XX.              
                           25  MB135-ED-MM                 PIC XX.              
                           25  MB135-ED-DD                 PIC XX.              
                   15  MB135-NEW-BUYER1                    PIC X(3).            
      *                                                                         
                   15  MB135-DEPARTMENT                    PIC X(3).            
                   15  MB135-NEW-BUYER2                    PIC X(3).            
                   15  MB135-BUYER-DATE.                                        
                       20  MB135-BD-CC                     PIC X(2).            
                       20  MB135-BUYER-DATE-YMD.                                
                           25  MB135-BD-YY                 PIC X(2).            
                           25  MB135-BD-MM                 PIC X(2).            
                           25  MB135-BD-DD                 PIC X(2).            
      *                                                                         
                   15  MB135-DATE-CHANGE-DATA.                                  
                       20  MB135-DC-GMA                    PIC XX.              
                       20  MB135-DC-DMA                    PIC XX.              
                       20  MB135-DC-DEPT                   PIC X(3).            
                       20  MB135-DC-MAJ-CL                 PIC XX.              
                       20  MB135-DC-SUB-CL                 PIC X(3).            
                       20  MB135-DC-LEVEL                  PIC X(3).            
                           88  MB135-GMA-LEVEL             VALUE 'GMA'.         
                           88  MB135-DMA-LEVEL             VALUE 'DMA'.         
                           88  MB135-DPT-LEVEL             VALUE 'DPT'.         
                           88  MB135-MCL-LEVEL             VALUE 'MCL'.         
                           88  MB135-SCL-LEVEL             VALUE 'SCL'.         
                   15  MB135-NEW-START-DATE.                                    
                       20  MB135-NSD-CC                    PIC X(2).            
                       20  MB135-NEW-START-DATE-YMD.                            
                           25  MB135-NSD-YY                PIC X(2).            
                           25  MB135-NSD-MM                PIC X(2).            
                           25  MB135-NSD-DD                PIC X(2).            
                   15  MB135-NEW-END-DATE.                                      
                       20  MB135-NED-CC                    PIC XX.              
                       20  MB135-NEW-END-DATE-YMD.                              
                           25  MB135-NED-YY                PIC X(2).            
                           25  MB135-NED-MM                PIC X(2).            
                           25  MB135-NED-DD                PIC X(2).            
                 12    MB135-SCREEN-DATA-END.                                   
                                                                                
                   15  MB135-DATE-CHANGE-CONTINUE-SW       PIC X.               
                       88  MB135-CANT-CHANGE-DATE          VALUE 'N'.           
                       88  MB135-CAN-CHANGE-DATE           VALUE 'Y'.           
                   15  MB135-NSD-ATTR                      PIC X.               
                   15  MB135-NSD-COLOR                     PIC X.               
                   15  MB135-NSD-HILIGHT                   PIC X.               
                   15  MB135-NED-ATTR                      PIC X.               
                   15  MB135-NED-COLOR                     PIC X.               
                   15  MB135-NED-HILIGHT                   PIC X.               
                                                                                
                   15  MB135-START-DATE-CHANGE-LIMIT.                           
                       20  MB135-SDCL-CC                   PIC XX.              
                       20  MB135-SDCL-YY                   PIC XX.              
                       20  FILLER                          PIC X.               
                           88  MB135-SDCL-DASH1            VALUE '-'.           
                       20  MB135-SDCL-MM                   PIC XX.              
                       20  FILLER                          PIC X.               
                           88  MB135-SDCL-DASH2            VALUE '-'.           
                       20  MB135-SDCL-DD                   PIC XX.              
                                                                                
                   15  MB135-MDSEAR-STRT-DTE               PIC X(10).           
                   15  MB135-MDSEAR-END-DTE                PIC X(10).           
                   15  MB135-PARENT-STRT-DTE               PIC X(10).           
                   15  MB135-PARENT-END-DTE                PIC X(10).           
                   15  MB135-DB2-CURRENT-DATE.                                  
                       20  MB135-DB2-CD-CC                 PIC XX.              
                       20  MB135-DB2-CD-YY                 PIC XX.              
                       20  FILLER                          PIC X.               
                       20  MB135-DB2-CD-MM                 PIC XX.              
                       20  FILLER                          PIC X.               
                       20  MB135-DB2-CD-DD                 PIC XX.              
                                                                                
                   15  MB135-DB2-ONE-YEAR-DATE.                                 
                       20  MB135-DB2-OY-CCYY               PIC 9(4).            
                       20  FILLER  REDEFINES  MB135-DB2-OY-CCYY.                
                           25  MB135-DB2-OY-CC             PIC XX.              
                           25  MB135-DB2-OY-YY             PIC XX.              
                       20  FILLER                          PIC X.               
                       20  MB135-DB2-OY-MM                 PIC XX.              
                       20  FILLER                          PIC X.               
                       20  MB135-DB2-OY-DD                 PIC XX.              
                                                                                
                   15  MB135-CURRENT-DATE.                                      
                       20  MB135-CD-CC                     PIC XX.              
                       20  MB135-CD-YY                     PIC XX.              
                       20  MB135-CD-MM                     PIC XX.              
                       20  MB135-CD-DD                     PIC XX.              
                   15  MB135-ONE-YEAR-DATE.                                     
                       20  MB135-OY-CC                     PIC XX.              
                       20  MB135-OY-YY                     PIC XX.              
                       20  MB135-OY-MM                     PIC XX.              
                       20  MB135-OY-DD                     PIC XX.              
      *                                                                         
                   15  MB135-LIST-SEQ-NBR                  PIC S9(15)           
                                                               COMP-3.          
                   15  MB135-MAX-SEQ-NBR                   PIC S9(15)           
                                                               COMP-3.          
                   15  MB135-SAVE-INTER-APPL-COMMAREA      PIC X(200).          
      *                                                                         
           EJECT                                                                
      *****************************************************************         
      *    BATCH PARAMETER CONTROL RECORD LAYOUT.                               
      *****************************************************************         
      *                                                                         
           COPY MBWS018.                                                        
                                                                                
      *                                                                         
           EJECT                                                                
      *****************************************************************         
      *    DATE VALIDATION COPYBOOK.                                            
      *****************************************************************         
                                                                                
           COPY DPWS500.                                                        
      *                                                                         
           EJECT                                                                
      *****************************************************************         
      *    ABEND PROCESSING COPYBOOK.                                           
      *****************************************************************         
                                                                                
           COPY DPWS013.                                                        
                                                                                
           EJECT                                                                
      *****************************************************************         
      *    ATTRIBUTE SETTINGS COPYBOOK.                                         
      *****************************************************************         
                                                                                
           COPY DPWS015.                                                        
                                                                                
      *****************************************************************         
      *    CURRENT DATE AND TIME COPYBOOK.                                      
      *****************************************************************         
                                                                                
           COPY DPWS017.                                                        
                                                                                
      *****************************************************************         
      *    TOGGLE FUNCTION KEY LINES COPYBOOK.                                  
      *****************************************************************         
                                                                                
           COPY DPWS009.                                                        
                                                                                
      *****************************************************************         
      *    FUNCTION KEYS COPYBOOK.                                              
      *****************************************************************         
                                                                                
           COPY DPWS016.                                                        
                                                                                
      *****************************************************************         
      *    DPKUT045 COPYBOOK.                                                   
      *****************************************************************         
                                                                                
           COPY DPWS045.                                                        
                                                                                
      *****************************************************************         
      *    DPWS006 COPYBOOK.                                                    
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
      *****************************************************************         
      *    NUMERIC EDIT LAYOUT.                                                 
      *****************************************************************         
                                                                                
           COPY DPWS010I.                                                       
                                                                                
      *****************************************************************         
      *    MESSAGE RECORD LAYOUT                                                
      *****************************************************************         
                                                                                
           COPY DPRD507I.                                                       
                                                                                
      *****************************************************************         
      *    STANDARD ATTENTION IDENTIFIER LIST                                   
      *****************************************************************         
                                                                                
           COPY DFHAID.                                                         
                                                                                
      *****************************************************************         
      *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST                
      *****************************************************************         
                                                                                
           COPY DFHBMSCA.                                                       
                                                                                
      *****************************************************************         
      *    MAP LAYOUT                                                           
      *****************************************************************         
                                                                                
           COPY MBKM135.                                                        
       01  MD-MAP-DATA-AREA  REDEFINES MB135AO PIC X(1472).                     
      *                                                                         
       EJECT                                                                    
      *                                                                         
      *    DB2 AREA FOR TMDSEAR                                                 
      *                                                                         
           EXEC SQL                                                             
                INCLUDE TMDSEAR                                                 
           END-EXEC.                                                            
      *                                                                         
      *    DB2 AREA FOR COMMUNICATIONS                                          
      *                                                                         
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
      *                                                                         
       EJECT                                                                    
       LINKAGE SECTION.                                                         
                                                                                
       01  DFHCOMMAREA.                                                         
           05  FILLER                         OCCURS  1 TO 4072 TIMES           
                                              DEPENDING ON EIBCALEN.            
               10  FILLER                     PIC X.                            
                                                                                
      *                                                                         
      *                                                                         
      *                                                                         
       PROCEDURE DIVISION.                                                      
                                                                                
                                                                                
       0000-MAIN-MODULE.                                                        
                                                                                
      ******************************************************************        
      *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.                   
      ******************************************************************        
                                                                                
           PERFORM DP015-0000-CHECK-COMMAREA.                                   
                                                                                
           IF DP020-SRC-RETURN-W-TRAN-ID                                        
               PERFORM 1000-CONTROL-PROCESSING                                  
           END-IF.                                                              
                                                                                
           PERFORM DP003-0000-RETURN-TO-CICS.                                   
       EJECT                                                                    
      ******************************************************************        
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT            
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                            
      *                                                                         
      *    PERFORMED BY 0000-MAIN-MODULE.                                       
      ******************************************************************        
      *                                                                         
       1000-CONTROL-PROCESSING.                                                 
      *                                                                         
           SET PS-CONTINUE           TO  TRUE.                                  
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN DP020-NEXT-ACT-INITIAL                                      
                   INITIALIZE MB135-SPECIFIC-COMMAREA                           
                   MOVE LOW-VALUES   TO  MB135-SCREEN-DATA                      
                   SET PS-SEND-MAP-N-DATA-FRSET                                 
                                     TO  TRUE                                   
                   SET DP020-NEXT-ACT-READ-MAP                                  
                                     TO  TRUE                                   
                   PERFORM 2000-BUILD-INITIAL-PANEL                             
      *                                                                         
               WHEN DP020-NEXT-ACT-READ-MAP                                     
                   PERFORM 3000-PROCESS-PANEL                                   
      *                                                                         
               WHEN DP020-NEXT-ACT-RETURN                                       
                   SET PS-SEND-MAP-N-DATA-FRSET                                 
                                     TO  TRUE                                   
                   MOVE MB135-SAVE-INTER-APPL-COMMAREA                          
                                     TO  MB005-INTER-APPL-COMMAREA              
                   PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                         
                   PERFORM 3300-EDIT-DATA-IN-COMMAREA                           
                   PERFORM 2200-DISPLAY-PANEL                                   
      *                                                                         
               WHEN DP020-NEXT-ACT-ERROR                                        
                   MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                         
                   IF DP020-NAV-MNEMONIC = SPACES                               
                       MOVE SPACES   TO  ANAVCMDO                               
                       MOVE DP015-UNDERLINE                                     
                                     TO  ANAVCMDH                               
                       MOVE DP015-GREEN                                         
                                     TO  ANAVCMDC                               
                   ELSE                                                         
                       MOVE DP015-REVERSE                                       
                                     TO  ANAVCMDH                               
                       MOVE DP015-RED                                           
                                     TO  ANAVCMDC                               
                   END-IF                                                       
      *                                                                         
                   MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE                      
                                                                                
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
                   SET PS-SEND-DATA-ONLY-FRSET                                  
                                     TO  TRUE                                   
                   PERFORM 2200-DISPLAY-PANEL                                   
      *                                                                         
               WHEN OTHER                                                       
                   SET DP013-LOGIC-ABEND TO TRUE                                
                   SET DP013-NO-ROLLBACK TO TRUE                                
                   MOVE '1000-CONTROL-PROCESSING'                               
                                     TO  DP013-PARAGRAPH                        
                   MOVE PM-PROGRAM-MESSAGE-12                                   
                                     TO  DP013-MESSAGE-TEXT(1)                  
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE IF WE ENTERED FROM MBKCS105 (MDSE UPDT) AND LOAD           
      *    CERTAIN VALUES ON THE SCREEN IF SO.  IF NOT THIS BECOMES             
      *    A DATA ENTRY SCREEN, THEREFORE, THERE IS NO REAL PROCESSING          
      *    IS NEEDED HERE.                                                      
      *    PERFORMED BY 1000-CONTROL-PROCESSING.                                
      ******************************************************************        
      *                                                                         
       2000-BUILD-INITIAL-PANEL.                                                
      *                                                                         
           MOVE PC-COMPANY           TO  AOPERCOO.                              
           MOVE DP015-ASK-NOR-OFF    TO  MB135-NSD-ATTR.                        
           MOVE DP015-HL-OFF         TO  MB135-NSD-HILIGHT.                     
           MOVE DP015-BLUE           TO  MB135-NSD-COLOR.                       
           MOVE DP015-GREEN          TO  MB135-NED-COLOR.                       
                                                                                
           PERFORM DP017-0000-GET-CURR-DATE-TIME.                               
           SET DP017-EDITED-YMD-DATE-DASH-1                                     
               DP017-EDITED-YMD-DATE-DASH-2                                     
                                     TO  TRUE.                                  
           MOVE DP017-EDITED-DATE-YYYYMMDD                                      
                                     TO  MB135-DB2-CURRENT-DATE                 
                                         MB135-DB2-ONE-YEAR-DATE.               
           ADD 1                     TO  MB135-DB2-OY-CCYY.                     
                                                                                
           MOVE MB135-DB2-CD-MM      TO  MB135-CD-MM.                           
           MOVE MB135-DB2-CD-DD      TO  MB135-CD-DD.                           
           MOVE MB135-DB2-CD-YY      TO  MB135-CD-YY.                           
           MOVE MB135-DB2-CD-CC      TO  MB135-CD-CC.                           
                                                                                
           MOVE MB135-DB2-OY-MM      TO  MB135-OY-MM.                           
           MOVE MB135-DB2-OY-DD      TO  MB135-OY-DD.                           
           MOVE MB135-DB2-OY-YY      TO  MB135-OY-YY.                           
           MOVE MB135-DB2-OY-CC      TO  MB135-OY-CC.                           
                                                                                
           IF  MB005-DATE-UPDATE                                                
               MOVE DP015-UNP-NUM-NOR-OFF                                       
                                     TO  MB135-NED-ATTR                         
               MOVE DP015-UNDERLINE  TO  MB135-NED-HILIGHT                      
               SET PS-DATE-CHANGE    TO  TRUE                                   
                                                                                
               MOVE ZERO             TO  PV-DB2-COUNT                           
               MOVE MB005-GMA-NUMBER TO  MB135-DC-GMA                           
               MOVE MB005-MDSEAR-LEVEL                                          
                                     TO  MB135-DC-LEVEL                         
                                                                                
               IF  MB005-DMA-NUMBER NOT NUMERIC                                 
                   MOVE ZERO         TO  MB135-DC-DMA                           
               ELSE                                                             
                   MOVE MB005-DMA-NUMBER                                        
                                     TO  MB135-DC-DMA                           
               END-IF                                                           
                                                                                
               IF  MB005-DEPT-NUMBER NOT NUMERIC                                
                   MOVE ZERO         TO  MB135-DC-DEPT                          
               ELSE                                                             
                   MOVE MB005-DEPT-NUMBER                                       
                                     TO  MB135-DC-DEPT                          
               END-IF                                                           
                                                                                
               IF  MB005-MCLASS-NUMBER NOT NUMERIC                              
                   MOVE ZERO         TO  MB135-DC-MAJ-CL                        
               ELSE                                                             
                   MOVE MB005-MCLASS-NUMBER                                     
                                     TO  MB135-DC-MAJ-CL                        
               END-IF                                                           
                                                                                
               IF  MB005-SCLASS-NUMBER NOT NUMERIC                              
                   MOVE ZERO         TO  MB135-DC-SUB-CL                        
               ELSE                                                             
                   MOVE MB005-SCLASS-NUMBER                                     
                                     TO  MB135-DC-SUB-CL                        
               END-IF                                                           
                                                                                
                                                                                
               EVALUATE TRUE                                                    
                   WHEN MB135-GMA-LEVEL                                         
                        PERFORM 2101-GMA-COUNT                                  
                   WHEN MB135-DMA-LEVEL                                         
                        PERFORM 2102-DMA-COUNT                                  
                   WHEN MB135-DPT-LEVEL                                         
                   WHEN MB135-MCL-LEVEL                                         
                   WHEN MB135-SCL-LEVEL                                         
                        PERFORM 2103-DPT-COUNT                                  
               END-EVALUATE                                                     
                                                                                
               IF  PV-DB2-COUNT EQUAL 1                                         
                   SET MB135-CAN-CHANGE-DATE                                    
                                     TO  TRUE                                   
                   PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                         
               ELSE                                                             
                   MOVE PC-TSYMSG-00212                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
                   SET MB135-CANT-CHANGE-DATE                                   
                                     TO  TRUE                                   
                   MOVE -1           TO  ANAVCMDL                               
               END-IF                                                           
           ELSE                                                                 
               MOVE DP015-ASK-NOR-OFF                                           
                                     TO  MB135-NED-ATTR                         
               MOVE DP015-HL-OFF     TO  MB135-NED-HILIGHT                      
           END-IF.                                                              
                                                                                
           PERFORM 3400-MOVE-COMMAREA-TO-SCREEN.                                
           PERFORM 2200-DISPLAY-PANEL.                                          
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE IF THE GMA EXISTS IN MORE THAN ONE COMPANY                 
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
                                                                                
       2101-GMA-COUNT.                                                          
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(*)                                             
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           GMA_NBR        = :MB135-DC-GMA                       
                      AND  MDSELV_CDE     = :MB135-DC-LEVEL                     
                      AND  END_DTE        > (CURRENT DATE)                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2101-GMA-COUNT'                                   
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT GMA_NBR **'                     
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2101-GMA-COUNT'                                            
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR GMA COUNT'                        
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE IF THE DMA EXISTS IN MORE THAN PLACE                       
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
                                                                                
       2102-DMA-COUNT.                                                          
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(*)                                             
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND  DMA_NBR        = :MB135-DC-DMA                       
                      AND  MDSELV_CDE     = :MB135-DC-LEVEL                     
                      AND  END_DTE        > (CURRENT DATE)                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2102-DMA-COUNT'                                   
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT DMA_NBR **'                     
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2102-DMA-COUNT'                                            
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR DMA COUNT'                        
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE IF THE DPT EXISTS IN MORE THAN PLACE                       
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
                                                                                
       2103-DPT-COUNT.                                                          
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(*)                                             
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND  DEPT_NBR       = :MB135-DC-DEPT                      
                      AND  MAJ_CL_NBR     = :MB135-DC-MAJ-CL                    
                      AND  SUB_CL_NBR     = :MB135-DC-SUB-CL                    
                      AND  MDSELV_CDE     = :MB135-DC-LEVEL                     
                      AND  END_DTE        > (CURRENT DATE)                      
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2103-DPT-COUNT'                                   
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT DEPT_NBR **'                    
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2103-DPT-COUNT'                                            
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR DPT COUNT'                        
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    OBTAIN INFORMATION ONLY IF ENTERED FROM 105.  OTHERWISE              
      *    THIS PARAGRAPH IS NOT INVOKED.                                       
      *                                                                         
      * PERFORMED BY 2000                                                       
      ******************************************************************        
      *                                                                         
       2100-RETRIEVE-DATA-FOR-PANEL.                                            
      *                                                                         
           PERFORM 2180-READ-MDSEAR.                                            
           PERFORM 2185-READ-PARENT.                                            
                                                                                
           IF  SQLCODE EQUAL ZERO                                               
               PERFORM 2190-CALC-START-DATE-LIMIT                               
           ELSE                                                                 
               MOVE PC-TSYMSG-00148  TO  DP020-MSG-NUMBER                       
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE IF THE DEPARTMENT EXISTS                                   
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
      *                                                                         
       2110-DEPARTMENT-CHECK.                                                   
      *                                                                         
           MOVE ZERO                 TO  PV-DB2-COUNT.                          
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
      *                                                                         
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(DISTINCT DEPT_NBR)                             
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND  DEPT_NBR       = :MB135-DEPARTMENT                   
                      AND  MDSELV_CDE     = :PC-DPT                             
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2110-DEPARTMENT-CHECK'                            
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT DEPT_NBR **'                    
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2110-DEPARTMENT-CHECK'                                     
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR DEPT COUNT'                       
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE IF THE EFFECTIVE DATE IS PROPER.                           
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       2120-CHECK-EFFECTIVE-DATE.                                               
      *                                                                         
           MOVE ZERO                 TO  PV-DB2-COUNT.                          
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
      *                                                                         
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(DISTINCT GMA_NBR)                              
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND (LIST_SEQ_NBR                                         
                           BETWEEN          :PV-HOLD-LIST-SEQ-NBR               
                           AND              :PV-HOLD-MAX-SEQ-NBR)               
                      AND (END_DTE                                              
                           BETWEEN          (CURRENT DATE)                      
                           AND              :PV-DB2-DATE)                       
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2120-CHECK-EFFECTIVE-DATE'                        
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT GMA_NBR **'                     
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2120-CHECK-EFFECTIVE-DATE'                                 
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR GMA COUNT'                        
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    SEE IF THE NEW END DATE IS BEFORE A SUBORDINATE START DATE.          
      *                                                                         
      *    PERFORMED BY 3350                                                    
      ******************************************************************        
                                                                                
       2125-CHECK-START-DATE.                                                   
                                                                                
           MOVE ZERO                 TO  PV-DB2-COUNT.                          
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(*)                                             
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND (LIST_SEQ_NBR                                         
                           BETWEEN          :PV-HOLD-LIST-SEQ-NBR               
                           AND              :PV-HOLD-MAX-SEQ-NBR)               
                      AND (STRT_DTE       > :PV-DB2-DATE)                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2125-CHECK-START-DATE'                            
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT FOR START DATE **'                       
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2125-CHECK-START-DATE'                                     
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR START DATE COUNT'                 
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    SEE IF THE NEW START DATE IS AFTER A SUBORDINATE END DATE.           
      *                                                                         
      *    PERFORMED BY 3350                                                    
      ******************************************************************        
                                                                                
       2126-CHECK-END-DATE.                                                     
                                                                                
           MOVE ZERO                 TO  PV-DB2-COUNT.                          
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(*)                                             
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND (LIST_SEQ_NBR                                         
                           BETWEEN          :PV-HOLD-LIST-SEQ-NBR               
                           AND              :PV-HOLD-MAX-SEQ-NBR)               
                      AND (END_DTE        < :PV-DB2-DATE)                       
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2126-CHECK-END-DATE'                              
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT FOR END DATE   **'                       
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2126-CHECK-END-DATE'                                       
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR END DATE COUNT'                   
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    CHECK IF THE NEW STRUCTURE ALREADY EXISTS.                           
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
                                                                                
       2130-CHECK-EXISTANCE.                                                    
                                                                                
           MOVE ZERO                 TO  PV-DB2-COUNT.                          
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(DISTINCT LIST_SEQ_NBR)                         
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                          (OPERCO_NBR     = :PC-COMPANY                         
                      AND (LIST_SEQ_NBR                                         
                           BETWEEN          :MB135-LIST-SEQ-NBR                 
                           AND              :MB135-MAX-SEQ-NBR)                 
                      AND  END_DTE        > :PV-DB2-WORK-DATE)                  
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2130-CHECK-EXISTANCE'                             
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT GMA_NBR 2 **'                   
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2130-CHECK-EXISTANCE'                                      
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR GMA 2 COUNT'                      
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    ENSURE THE PARENT EXISTS.                                            
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       2140-CHECK-PARENT.                                                       
      *                                                                         
           MOVE ZERO                 TO  PV-DB2-COUNT.                          
           MOVE ZERO                 TO  MDSEAR-SUB-CL-NBR.                     
           MOVE MB135-NEW-MAJ-CL     TO  MDSEAR-MAJ-CL-NBR.                     
           MOVE MB135-NEW-DEPT       TO  MDSEAR-DEPT-NBR.                       
           MOVE MB135-NEW-DMA        TO  MDSEAR-DMA-NBR.                        
           MOVE MB135-NEW-GMA        TO  MDSEAR-GMA-NBR.                        
      *                                                                         
      *    IF  MB135-NEW-MAJ-CL LESS THAN ZERO                                  
      *        MOVE ZERO             TO  MDSEAR-MAJ-CL-NBR                      
      *        MOVE ZERO             TO  MDSEAR-DEPT-NBR                        
      *        IF  MB135-NEW-DEPT LESS THAN ZERO                                
      *            IF  MB135-NEW-DMA LESS THAN ZERO                             
      *                MOVE ZERO     TO  MDSEAR-DMA-NBR                         
      *                MOVE ZERO     TO  MDSEAR-GMA-NBR                         
      *            ELSE                                                         
      *                MOVE ZERO     TO  MDSEAR-DMA-NBR                         
      *            END-IF                                                       
      *        END-IF                                                           
      *    ELSE                                                                 
      *        MOVE ZERO             TO  MDSEAR-MAJ-CL-NBR                      
      *    END-IF.                                                              
                                                                                
           MOVE ZERO             TO  MDSEAR-MAJ-CL-NBR.                         
           MOVE ZERO             TO  MDSEAR-DEPT-NBR.                           
           IF  MB135-NEW-DEPT LESS THAN ZERO                                    
               IF  MB135-NEW-DMA LESS THAN ZERO                                 
                   MOVE ZERO     TO  MDSEAR-DMA-NBR                             
                   MOVE ZERO     TO  MDSEAR-GMA-NBR                             
               ELSE                                                             
                   MOVE ZERO     TO  MDSEAR-DMA-NBR                             
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
      *                                                                         
               EXEC SQL                                                         
                    SELECT                                                      
                           COUNT(DISTINCT OPERCO_NBR)                           
                    INTO                                                        
                           :PV-DB2-COUNT                                        
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND  GMA_NBR        = :MDSEAR-GMA-NBR                     
                      AND  DMA_NBR        = :MDSEAR-DMA-NBR                     
                      AND  DEPT_NBR       = :MDSEAR-DEPT-NBR                    
                      AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR                  
                      AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR                  
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2140-CHECK-PARENT'                                
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** COUNT DISTINCT OPERCO_NBR **'                  
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2140-CHECK-PARENT'                                         
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR COMPANY COUNT'                    
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    READ THE BATCH PARAMETER CONTROL FILE TO DETERMINE WHETHER           
      *    THE REQUESTED RECORD TO BE ADDED ALREADY EXISTS.                     
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       2150-READ-BATCH-CONTROL.                                                 
      *                                                                         
           EXEC CICS READ                                                       
                INTO(MB018-BATCH-CNTL-RECORD)                                   
                FILE('MBBCHCTL')                                                
                RIDFLD(MB018-BCR-KEY)                                           
                RESP(PV-RESP)                                                   
                UPDATE                                                          
           END-EXEC.                                                            
      *                                                                         
           IF (PV-RESP EQUAL DFHRESP(NORMAL)                                    
           OR  PV-RESP EQUAL DFHRESP(NOTFND))                                   
               CONTINUE                                                         
           ELSE                                                                 
               MOVE PV-RESP          TO  PM-RESP-22                             
               SET DP013-LOGIC-ABEND TO  TRUE                                   
               SET DP013-NO-ROLLBACK TO  TRUE                                   
               MOVE '1000-CONTROL-PROCESSING'                                   
                                     TO  DP013-PARAGRAPH                        
               MOVE PM-PROGRAM-MESSAGE-22                                       
                                     TO  DP013-MESSAGE-TEXT(1)                  
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    THE VSAM RECORD ALREADY EXISTS, THEREFORE, WE MUST UPDATE IT.        
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       2160-UPDATE-BATCH-CONTROL.                                               
      *                                                                         
           EXEC CICS REWRITE                                                    
                FROM(MB018-BATCH-CNTL-RECORD)                                   
                FILE('MBBCHCTL')                                                
                RESP(PV-RESP)                                                   
           END-EXEC.                                                            
      *                                                                         
           IF  PV-RESP EQUAL DFHRESP(NORMAL)                                    
               MOVE PC-TSYMSG-00059  TO  DP020-MSG-NUMBER                       
           ELSE                                                                 
               MOVE PV-RESP          TO  PM-RESP-22                             
               MOVE 'REWRITE'        TO  PM-ACTION-22                           
               SET DP013-LOGIC-ABEND TO  TRUE                                   
               SET DP013-NO-ROLLBACK TO  TRUE                                   
               MOVE '2160-UPDATE-BATCH-CONTROL'                                 
                                     TO  DP013-PARAGRAPH                        
               MOVE PM-PROGRAM-MESSAGE-22                                       
                                     TO  DP013-MESSAGE-TEXT(1)                  
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    THE VSAM RECORD DID NOT EXIST, SO WE SIMPLY WRITE IT HERE.           
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       2170-WRITE-BATCH-CONTROL.                                                
      *                                                                         
           EXEC CICS WRITE                                                      
                FROM(MB018-BATCH-CNTL-RECORD)                                   
                FILE('MBBCHCTL')                                                
                RIDFLD(MB018-BCR-KEY)                                           
                RESP(PV-RESP)                                                   
           END-EXEC.                                                            
                                                                                
           IF  PV-RESP EQUAL DFHRESP(NORMAL)                                    
               MOVE PC-TSYMSG-00034  TO  DP020-MSG-NUMBER                       
           ELSE                                                                 
               MOVE PV-RESP          TO  PM-RESP-22                             
               MOVE 'WRITE'          TO  PM-ACTION-22                           
               SET DP013-LOGIC-ABEND TO  TRUE                                   
               SET DP013-NO-ROLLBACK TO  TRUE                                   
               MOVE '2170-WRITE-BATCH-CONTROL'                                  
                                     TO  DP013-PARAGRAPH                        
               MOVE PM-PROGRAM-MESSAGE-22                                       
                                     TO  DP013-MESSAGE-TEXT(1)                  
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    READ THE MERCHANDISE AREA TABLE TO OBTAIN DATES FOR THE DATE         
      *    CHANGE ROUTINE.                                                      
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
      *                                                                         
       2180-READ-MDSEAR.                                                        
      *                                                                         
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
      *                                                                         
               EXEC SQL                                                         
                    SELECT                                                      
                           GMA_NBR,                                             
                           DMA_NBR,                                             
                           DEPT_NBR,                                            
                           MAJ_CL_NBR,                                          
                           SUB_CL_NBR,                                          
                           MDSELV_CDE,                                          
                           STRT_DTE,                                            
                           END_DTE                                              
                    INTO                                                        
                           :MDSEAR-GMA-NBR,                                     
                           :MDSEAR-DMA-NBR,                                     
                           :MDSEAR-DEPT-NBR,                                    
                           :MDSEAR-MAJ-CL-NBR,                                  
                           :MDSEAR-SUB-CL-NBR,                                  
                           :MDSEAR-MDSELV-CDE,                                  
                           :MDSEAR-STRT-DTE,                                    
                           :MDSEAR-END-DTE                                      
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND  GMA_NBR        = :MB135-DC-GMA                       
                      AND  DMA_NBR        = :MB135-DC-DMA                       
                      AND  DEPT_NBR       = :MB135-DC-DEPT                      
                      AND  MAJ_CL_NBR     = :MB135-DC-MAJ-CL                    
                      AND  SUB_CL_NBR     = :MB135-DC-SUB-CL                    
                      AND  MDSELV_CDE     = :MB135-DC-LEVEL                     
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2180-READ-MDSEAR'                                 
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** READ MDSEAR TO GET DATES **'                   
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2180-READ-MDSEAR'                                          
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR MDSEAR READ'                      
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
           IF  SQLCODE EQUAL ZERO                                               
               MOVE MDSEAR-STRT-DTE  TO  MB135-MDSEAR-STRT-DTE                  
               MOVE MDSEAR-END-DTE   TO  MB135-MDSEAR-END-DTE                   
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    READ THE MERCHANDISE AREA TABLE TO OBTAIN THE PARENT DATES           
      *    FOR THE DATE CHANGE VALIDATION.                                      
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
      *                                                                         
       2185-READ-PARENT.                                                        
                                                                                
           IF  MDSEAR-MDSELV-CDE EQUAL PC-SCL                                   
               MOVE PC-MCL           TO  MDSEAR-MDSELV-CDE                      
               MOVE ZERO             TO  MDSEAR-SUB-CL-NBR                      
           ELSE                                                                 
               IF  MDSEAR-MDSELV-CDE EQUAL PC-MCL                               
                   MOVE PC-DPT       TO  MDSEAR-MDSELV-CDE                      
                   MOVE ZERO         TO  MDSEAR-MAJ-CL-NBR                      
               ELSE                                                             
                   IF  MDSEAR-MDSELV-CDE EQUAL PC-DPT                           
                       MOVE PC-DMA   TO  MDSEAR-MDSELV-CDE                      
                       MOVE ZERO     TO  MDSEAR-DEPT-NBR                        
                   ELSE                                                         
                       IF  MDSEAR-MDSELV-CDE EQUAL PC-DMA                       
                           MOVE PC-GMA                                          
                                     TO  MDSEAR-MDSELV-CDE                      
                           MOVE ZERO TO  MDSEAR-DMA-NBR                         
                       ELSE                                                     
                           IF  MDSEAR-MDSELV-CDE EQUAL PC-GMA                   
                               MOVE PC-CO                                       
                                     TO  MDSEAR-MDSELV-CDE                      
                               MOVE ZERO                                        
                                     TO  MDSEAR-GMA-NBR                         
                           END-IF                                               
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
                  OR SQLCODE = 0                                                
                  OR SQLCODE = +100                                             
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                           STRT_DTE,                                            
                           END_DTE                                              
                    INTO                                                        
                           :MDSEAR-STRT-DTE,                                    
                           :MDSEAR-END-DTE                                      
                    FROM                                                        
                           TMDSEAR                                              
                    WHERE                                                       
                           OPERCO_NBR     = :PC-COMPANY                         
                      AND  GMA_NBR        = :MDSEAR-GMA-NBR                     
                      AND  DMA_NBR        = :MDSEAR-DMA-NBR                     
                      AND  DEPT_NBR       = :MDSEAR-DEPT-NBR                    
                      AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR                  
                      AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR                  
                      AND  MDSELV_CDE     = :MDSEAR-MDSELV-CDE                  
               END-EXEC                                                         
      *                                                                         
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                   WHEN SQLCODE = ZERO                                          
                   WHEN SQLCODE = +100                                          
                        CONTINUE                                                
                   WHEN SQLWARN0 NOT EQUAL SPACE                                
                   WHEN SQLCODE NOT EQUAL ZERO                                  
                        MOVE '2185-READ-PARENT'                                 
                                     TO  DP013-PARAGRAPH                        
                        MOVE '** READ MDSEAR TO GET PARENT DATES **'            
                                     TO  DP013-MESSAGE-TEXT (1)                 
                        MOVE SQLCA   TO  DP013-SQLCA                            
                        SET DP013-DB2-ABEND                                     
                                     TO  TRUE                                   
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
               MOVE '2185-READ-PARENT'                                          
                                     TO  DP013-PARAGRAPH                        
               MOVE 'MAX RETRIES EXCEEDED FOR MDSEAR PARENT READ'               
                                     TO  DP013-MESSAGE-TEXT (1)                 
               MOVE SQLCA            TO  DP013-SQLCA                            
               SET DP013-DB2-ABEND   TO  TRUE                                   
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
           IF  SQLCODE EQUAL ZERO                                               
               MOVE MDSEAR-STRT-DTE  TO  MB135-PARENT-STRT-DTE                  
               MOVE MDSEAR-END-DTE   TO  MB135-PARENT-END-DTE                   
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    BUILD THE START DATE FIELDS THAT INDICATES HOW FAR IN THE            
      *    PAST WE ALLOW CHANGES TO THE START DATE.                             
      *                                                                         
      *    PERFORMED BY 2100                                                    
      ******************************************************************        
      *                                                                         
       2190-CALC-START-DATE-LIMIT.                                              
                                                                                
           INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                 
                                                                                
           SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                              
           SET DPG51-DECREMENT-DATE       TO TRUE.                              
           MOVE PC-START-DATE-CHANGE-DAYS TO DPG51-INCR-DECR-DAYS-9.            
                                                                                
           SET DPG52-LK-DTE-GREG          TO TRUE.                              
           MOVE MB135-DB2-CD-YY           TO DPG52-GREG-DATE-YR-X.              
           MOVE MB135-DB2-CD-MM           TO DPG52-GREG-DATE-MO-X.              
           MOVE MB135-DB2-CD-DD           TO DPG52-GREG-DATE-DY-X.              
                                                                                
           CALL  DP500-KOHLS-CALENDAR-ROUTINE                                   
                 USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                
                                                                                
           IF DPG54-NO-ERROR                                                    
              MOVE DPG55-DB2-ISO-DATE-MO TO  MB135-SDCL-MM                      
              MOVE DPG55-DB2-ISO-DATE-DY TO  MB135-SDCL-DD                      
              MOVE DPG55-JULIAN-CC-DATE-CC-X                                    
                                         TO  MB135-SDCL-CC                      
              MOVE DPG55-JULIAN-CC-DATE-YY-X                                    
                                         TO  MB135-SDCL-YY                      
                                                                                
              SET MB135-SDCL-DASH1       TO  TRUE                               
              SET MB135-SDCL-DASH2       TO  TRUE                               
           END-IF.                                                              
                                                                                
                                                                                
           IF  MB135-MDSEAR-STRT-DTE LESS THAN                                  
                                     MB135-START-DATE-CHANGE-LIMIT              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-UNP-NUM-NOR-OFF TO  MB135-NSD-ATTR                    
               MOVE DP015-UNDERLINE       TO  MB135-NSD-HILIGHT                 
               MOVE DP015-GREEN           TO  MB135-NSD-COLOR                   
           END-IF.                                                              
                                                                                
           MOVE MB135-MDSEAR-STRT-DTE     TO  PV-DB2-DATE.                      
           MOVE PV-DD-CC                  TO  MB135-NSD-CC.                     
           MOVE PV-DD-YY                  TO  MB135-NSD-YY.                     
           MOVE PV-DD-MM                  TO  MB135-NSD-MM.                     
           MOVE PV-DD-DD                  TO  MB135-NSD-DD.                     
                                                                                
           IF  MB135-MDSEAR-END-DTE NOT EQUAL PC-NINES-DATE                     
               MOVE MB135-MDSEAR-END-DTE  TO  PV-DB2-DATE                       
               MOVE PV-DD-CC              TO  MB135-NED-CC                      
               MOVE PV-DD-YY              TO  MB135-NED-YY                      
               MOVE PV-DD-MM              TO  MB135-NED-MM                      
               MOVE PV-DD-DD              TO  MB135-NED-DD                      
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.               
      *                                                                         
      *    PERFORMED BY 1000-CONTROL-PROCESSING.                                
      *    PERFORMED BY 3000-PROCESS-PANEL.                                     
      ******************************************************************        
      *                                                                         
       2200-DISPLAY-PANEL.                                                      
      *                                                                         
           PERFORM DP017-0000-GET-CURR-DATE-TIME.                               
           MOVE DP017-EDITED-TIME-HMS                                           
                                     TO  ATIMEO.                                
      *                                                                         
           IF  NOT DP020-MSG-FATAL                                              
               IF  PS-DATE-CHANGE                                               
                   IF  MB135-NSD-COLOR EQUAL DP015-BLUE                         
                       MOVE -1       TO  ADCNEMML                               
                   ELSE                                                         
                       MOVE -1       TO  ADCNSMML                               
                   END-IF                                                       
               ELSE                                                             
                   IF  PS-BUYER-CHANGE                                          
                       MOVE -1       TO  ABYRDPTL                               
                   ELSE                                                         
                       MOVE -1       TO  AOGMAL                                 
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           IF  PS-SEND-MAP-N-DATA-FRSET                                         
               PERFORM DP002-0000-FORMAT-TITLE-LINES                            
               PERFORM DP009-0000-LOAD-FK-LINES                                 
           END-IF.                                                              
      *                                                                         
           PERFORM DP005-0000-FORMAT-MSG-LINES.                                 
                                                                                
           PERFORM DP008-0000-WRITE-PANEL.                                      
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED          
      *    ON WHAT FUNCTION KEY WAS SELECTED.                                   
      *                                                                         
      *    PERFORMED BY 1000-CONTROL-PROCESSING.                                
      ******************************************************************        
      *                                                                         
       3000-PROCESS-PANEL.                                                      
      *                                                                         
           PERFORM DP007-0000-GET-PANEL.                                        
           SET PS-SEND-DATA-ONLY-FRSET                                          
                                     TO TRUE.                                   
      *                                                                         
           IF  (DP020-SRC-AID NOT EQUAL DP016-PF5                               
           AND  DP020-SRC-AID NOT EQUAL DP016-CLEAR)                            
               PERFORM 3200-MOVE-SCREEN-TO-COMMAREA                             
           END-IF.                                                              
      *                                                                         
           PERFORM 3100-CHECK-LOCAL-FKEYS.                                      
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *   DETERMINE THE PROCESSING PATH HERE.                                   
      *                                                                         
      *   PERFORMED BY 3000.                                                    
      ******************************************************************        
      *                                                                         
       3100-CHECK-LOCAL-FKEYS.                                                  
      *                                                                         
           EVALUATE TRUE                                                        
      *                                                                         
               WHEN DP020-SRC-AID = DP016-CLEAR                                 
                   SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                         
                   PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                         
                   PERFORM 3300-EDIT-DATA-IN-COMMAREA                           
                   PERFORM 2200-DISPLAY-PANEL                                   
      *                                                                         
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
                   MOVE SPACES       TO  ANAVCMDO                               
                                         ANAVKEYO                               
                   SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                         
                   MOVE LOW-VALUES   TO  MB135-SCREEN-DATA                      
                   IF  MB005-DATE-UPDATE                                        
                       PERFORM 2000-BUILD-INITIAL-PANEL                         
                   ELSE                                                         
                       PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                     
                       PERFORM 2200-DISPLAY-PANEL                               
                   END-IF                                                       
      *                                                                         
               WHEN DP020-SRC-AID = DP016-PA2                                   
                   PERFORM DP009-0000-LOAD-FK-LINES                             
                   PERFORM DP017-0000-GET-CURR-DATE-TIME                        
                   SET PS-SEND-DATA-ONLY                                        
                                     TO  TRUE                                   
                   MOVE -1           TO  ANAVCMDL                               
                   PERFORM DP008-0000-WRITE-PANEL                               
      *                                                                         
               WHEN DP020-FK-RETURN(DP020-SRC-AID)                              
               WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                          
                    PERFORM 4000-NAVIGATE                                       
      *                                                                         
               WHEN DP020-SRC-AID = DP016-ENTER                                 
                   IF  DP020-NAV-MNEMONIC GREATER THAN SPACES                   
                       PERFORM 4000-NAVIGATE                                    
                   ELSE                                                         
                       PERFORM 3300-EDIT-DATA-IN-COMMAREA                       
                       PERFORM 2200-DISPLAY-PANEL                               
                   END-IF                                                       
      *                                                                         
      *    ADD FUNCTION                                                         
      *                                                                         
               WHEN DP020-SRC-AID = DP016-PF13                                  
                   PERFORM 3300-EDIT-DATA-IN-COMMAREA                           
                   IF  PS-CONTINUE                                              
                       PERFORM 3500-ADD-PROCESS                                 
                       IF (DP020-MSG-NUMBER-X EQUAL PC-TSYMSG-00059             
                       OR  DP020-MSG-NUMBER-X EQUAL PC-TSYMSG-00034)            
                           SET PS-SEND-MAP-N-DATA-FRSET                         
                                     TO  TRUE                                   
                       END-IF                                                   
                   END-IF                                                       
                   PERFORM 2200-DISPLAY-PANEL                                   
      *                                                                         
               WHEN OTHER                                                       
                   PERFORM 3300-EDIT-DATA-IN-COMMAREA                           
                   MOVE PC-TSYMSG-00045                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
                   MOVE -1           TO  ANAVCMDL                               
                   PERFORM 2200-DISPLAY-PANEL                                   
           END-EVALUATE.                                                        
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    HERE WE SIMPLY MOVE THE SCREEN DATA TO THE COMM AREA.                
      *                                                                         
      *    PERFORMED BY 3000                                                    
      ******************************************************************        
      *                                                                         
       3200-MOVE-SCREEN-TO-COMMAREA.                                            
      *                                                                         
           IF (AOGMAL GREATER THAN ZERO                                         
           OR  AOGMAA EQUAL PC-ERASE-EOF)                                       
               MOVE AOGMAI           TO  MB135-OLD-GMA                          
           END-IF.                                                              
      *                                                                         
           IF (AODMAL GREATER THAN ZERO                                         
           OR  AODMAA EQUAL PC-ERASE-EOF)                                       
               MOVE AODMAI           TO  MB135-OLD-DMA                          
           END-IF.                                                              
      *                                                                         
           IF (AODEPTL GREATER THAN ZERO                                        
           OR  AODEPTA EQUAL PC-ERASE-EOF)                                      
               MOVE AODEPTI          TO  MB135-OLD-DEPT                         
           END-IF.                                                              
      *                                                                         
           IF (AOMCLASL GREATER THAN ZERO                                       
           OR  AOMCLASA EQUAL PC-ERASE-EOF)                                     
               MOVE AOMCLASI         TO  MB135-OLD-MAJ-CL                       
           END-IF.                                                              
      *                                                                         
           IF (AOSCLASL GREATER THAN ZERO                                       
           OR  AOSCLASA EQUAL PC-ERASE-EOF)                                     
               MOVE AOSCLASI         TO  MB135-OLD-SUB-CL                       
           END-IF.                                                              
      *                                                                         
           IF (ANGMAL GREATER THAN ZERO                                         
           OR  ANGMAA EQUAL PC-ERASE-EOF)                                       
               MOVE ANGMAI           TO  MB135-NEW-GMA                          
           END-IF.                                                              
      *                                                                         
           IF (ANDMAL GREATER THAN ZERO                                         
           OR  ANDMAA EQUAL PC-ERASE-EOF)                                       
               MOVE ANDMAI           TO  MB135-NEW-DMA                          
           END-IF.                                                              
      *                                                                         
           IF (ANDEPTL GREATER THAN ZERO                                        
           OR  ANDEPTA EQUAL PC-ERASE-EOF)                                      
               MOVE ANDEPTI          TO  MB135-NEW-DEPT                         
           END-IF.                                                              
                                                                                
           IF (ANMCLASL GREATER THAN ZERO                                       
           OR  ANMCLASA EQUAL PC-ERASE-EOF)                                     
               MOVE ANMCLASI         TO  MB135-NEW-MAJ-CL                       
           END-IF.                                                              
                                                                                
           IF (ANSCLASL GREATER THAN ZERO                                       
           OR  ANSCLASA EQUAL PC-ERASE-EOF)                                     
               MOVE ANSCLASI         TO  MB135-NEW-SUB-CL                       
           END-IF.                                                              
                                                                                
           IF (AEDATMML  GREATER THAN ZERO                                      
           OR  AEDATMMA EQUAL PC-ERASE-EOF)                                     
               MOVE AEDATMMI         TO  MB135-ED-MM                            
           END-IF.                                                              
                                                                                
           IF (AEDATDDL  GREATER THAN ZERO                                      
           OR  AEDATDDA EQUAL PC-ERASE-EOF)                                     
               MOVE AEDATDDI         TO  MB135-ED-DD                            
           END-IF.                                                              
                                                                                
           IF (AEDATYYL  GREATER THAN ZERO                                      
           OR  AEDATYYA EQUAL PC-ERASE-EOF)                                     
               MOVE AEDATYYI         TO  MB135-ED-YY                            
               IF  AEDATYYA  EQUAL PC-ERASE-EOF                                 
                   MOVE SPACES       TO  MB135-ED-CC                            
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF (ANBUYERL  GREATER THAN ZERO                                      
           OR  ANBUYERA EQUAL PC-ERASE-EOF)                                     
               MOVE ANBUYERI         TO  MB135-NEW-BUYER1                       
           END-IF.                                                              
      *                                                                         
           IF (ABYRDPTL  GREATER THAN ZERO                                      
           OR  ABYRDPTA EQUAL PC-ERASE-EOF)                                     
               MOVE ABYRDPTI         TO  MB135-DEPARTMENT                       
           END-IF.                                                              
                                                                                
           IF (ABYRNBRL  GREATER THAN ZERO                                      
           OR  ABYRNBRA EQUAL PC-ERASE-EOF)                                     
               MOVE ABYRNBRI         TO  MB135-NEW-BUYER2                       
           END-IF.                                                              
                                                                                
           IF (ABYRMML  GREATER THAN ZERO                                       
           OR  ABYRMMA EQUAL PC-ERASE-EOF)                                      
               MOVE ABYRMMI          TO  MB135-BD-MM                            
           END-IF.                                                              
                                                                                
           IF (ABYRDDL  GREATER THAN ZERO                                       
           OR  ABYRDDA EQUAL PC-ERASE-EOF)                                      
               MOVE ABYRDDI          TO  MB135-BD-DD                            
           END-IF.                                                              
                                                                                
           IF (ABYRYYL  GREATER THAN ZERO                                       
           OR  ABYRYYA EQUAL PC-ERASE-EOF)                                      
               MOVE ABYRYYI          TO  MB135-BD-YY                            
               IF  ABYRYYA  EQUAL PC-ERASE-EOF                                  
                   MOVE SPACES       TO  MB135-BD-CC                            
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           IF (ADCNSMML  GREATER THAN ZERO                                      
           OR  ADCNSMMA EQUAL PC-ERASE-EOF)                                     
               MOVE ADCNSMMI         TO  MB135-NSD-MM                           
           END-IF.                                                              
                                                                                
           IF (ADCNSDDL  GREATER THAN ZERO                                      
           OR  ADCNSDDA EQUAL PC-ERASE-EOF)                                     
               MOVE ADCNSDDI         TO  MB135-NSD-DD                           
           END-IF.                                                              
                                                                                
           IF (ADCNSYYL  GREATER THAN ZERO                                      
           OR  ADCNSYYA EQUAL PC-ERASE-EOF)                                     
               MOVE ADCNSYYI         TO  MB135-NSD-YY                           
               IF  ADCNSYYA  EQUAL PC-ERASE-EOF                                 
                   MOVE SPACES       TO  MB135-NSD-CC                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF (ADCNEMML  GREATER THAN ZERO                                      
           OR  ADCNEMMA EQUAL PC-ERASE-EOF)                                     
               MOVE ADCNEMMI         TO  MB135-NED-MM                           
           END-IF.                                                              
                                                                                
           IF (ADCNEDDL  GREATER THAN ZERO                                      
           OR  ADCNEDDA EQUAL PC-ERASE-EOF)                                     
               MOVE ADCNEDDI         TO  MB135-NED-DD                           
           END-IF.                                                              
                                                                                
           IF  (ADCNEYYL  GREATER THAN ZERO                                     
           OR   ADCNEYYA EQUAL PC-ERASE-EOF)                                    
               MOVE ADCNEYYI         TO  MB135-NED-YY                           
               IF  ADCNEYYA  EQUAL PC-ERASE-EOF                                 
                   MOVE SPACES       TO  MB135-NED-CC                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    FIRST, CHECK THAT ONLY MBS REALIGNMENT OR BUYER NUMBER               
      *    CHANGE WAS REQUESTED.  NEXT, DEPENDING UPON WHICH CHANGE             
      *    IS DESIRED, VALIDATE THE REALIGNMENT REQUEST OR THE BUYER            
      *    CHANGE REQUEST.                                                      
      *                                                                         
      *    PERFORMED BY 1000, 3000.                                             
      ******************************************************************        
      *                                                                         
       3300-EDIT-DATA-IN-COMMAREA.                                              
      *                                                                         
           MOVE DP015-GREEN          TO  AOSCLASC                               
                                         AOMCLASC                               
                                         AODEPTC                                
                                         AODMAC                                 
                                         AOGMAC                                 
                                         AEDATMMC                               
                                         AEDATDDC                               
                                         AEDATYYC                               
                                         ANBUYERC                               
                                         ABYRDPTC                               
                                         ABYRNBRC                               
                                         ABYRMMC                                
                                         ABYRDDC                                
                                         ABYRYYC                                
                                         ANSCLASC                               
                                         ANMCLASC                               
                                         ANDEPTC                                
                                         ANDMAC                                 
                                         ANGMAC.                                
           MOVE DP015-UNDERLINE      TO  AOSCLASH                               
                                         AOMCLASH                               
                                         AODEPTH                                
                                         AODMAH                                 
                                         AOGMAH                                 
                                         AEDATMMH                               
                                         AEDATDDH                               
                                         AEDATYYH                               
                                         ANBUYERH                               
                                         ABYRDPTH                               
                                         ABYRNBRH                               
                                         ABYRMMH                                
                                         ABYRDDH                                
                                         ABYRYYH                                
                                         ANSCLASH                               
                                         ANMCLASH                               
                                         ANDEPTH                                
                                         ANDMAH                                 
                                         ANGMAH.                                
                                                                                
           MOVE MB135-NSD-ATTR       TO  ADCNSMMA                               
                                         ADCNSDDA                               
                                         ADCNSYYA.                              
           MOVE MB135-NSD-COLOR      TO  ADCNSMMC                               
                                         ADCNSDDC                               
                                         ADCNSYYC.                              
           MOVE MB135-NSD-HILIGHT    TO  ADCNSMMH                               
                                         ADCNSDDH                               
                                         ADCNSYYH.                              
           MOVE MB135-NED-ATTR       TO  ADCNEMMA                               
                                         ADCNEDDA                               
                                         ADCNEYYA.                              
           MOVE MB135-NED-COLOR      TO  ADCNEMMC                               
                                         ADCNEDDC                               
                                         ADCNEYYC.                              
           MOVE MB135-NED-HILIGHT    TO  ADCNEMMH                               
                                         ADCNEDDH                               
                                         ADCNEYYH.                              
                                                                                
           SET PS-CONTINUE           TO  TRUE.                                  
           IF (MB135-OLD-DATA GREATER THAN SPACES                               
           OR  MB135-NEW-DATA GREATER THAN SPACES                               
           OR  MB135-EFFECTIVE-DATE-YMD  GREATER THAN SPACES                    
           OR  MB135-NEW-BUYER1      GREATER THAN SPACES)                       
               SET PS-REALIGNMENT    TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-DEPARTMENT  GREATER THAN SPACES                            
           OR  MB135-NEW-BUYER2  GREATER THAN SPACES                            
           OR  MB135-BUYER-DATE-YMD  GREATER THAN SPACES)                       
               SET PS-BUYER-CHANGE   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-DC-GMA GREATER THAN SPACES                                 
           OR  MB135-NEW-END-DATE-YMD GREATER THAN SPACES)                      
               SET PS-DATE-CHANGE    TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (PS-REALIGNMENT  AND  PS-BUYER-CHANGE)                            
           OR (PS-REALIGNMENT  AND  PS-DATE-CHANGE)                             
           OR (PS-BUYER-CHANGE AND  PS-DATE-CHANGE)                             
                                                                                
               MOVE PC-TSYMSG-00192  TO  DP020-MSG-NUMBER                       
               MOVE -1               TO  AOGMAL                                 
               SET DP020-MSG-FATAL   TO  TRUE                                   
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (PS-REALIGNMENT                                                   
           OR  PS-BUYER-CHANGE                                                  
           OR  PS-DATE-CHANGE)                                                  
               CONTINUE                                                         
           ELSE                                                                 
               SET PS-DONT-PROCESS   TO  TRUE                                   
               IF  DP020-SRC-AID EQUAL DP016-PF13                               
                   MOVE -1           TO  AOGMAL                                 
                   MOVE PC-TSYMSG-00036                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  PS-CONTINUE                                                      
               EVALUATE TRUE                                                    
                                                                                
                   WHEN PS-BUYER-CHANGE                                         
                        PERFORM 3310-VALIDATE-BUYER-CHANGE                      
                                                                                
                   WHEN PS-REALIGNMENT                                          
                        PERFORM 3320-VALIDATE-REALIGNMENT                       
                                                                                
                   WHEN PS-DATE-CHANGE                                          
                        IF  MB135-CANT-CHANGE-DATE                              
                        MOVE PC-TSYMSG-00212                                    
                                     TO  DP020-MSG-NUMBER                       
                            SET DP020-MSG-FATAL                                 
                                     TO  TRUE                                   
                            SET MB135-CANT-CHANGE-DATE                          
                                     TO  TRUE                                   
                            MOVE -1  TO  ANAVCMDL                               
                        ELSE                                                    
                            PERFORM 3350-DATE-CHANGE                            
                        END-IF                                                  
               END-EVALUATE                                                     
           END-IF.                                                              
                                                                                
           IF  DP020-MSG-FATAL                                                  
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    IF BUYER CHANGE DATA ENTERED, ENSURE ITS GOOD DATA.                  
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       3310-VALIDATE-BUYER-CHANGE.                                              
      *                                                                         
           SET PS-VALID-DATE         TO  TRUE.                                  
           IF  MB135-BD-YY NUMERIC                                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-RED        TO  ABYRYYC                                
               MOVE DP015-REVERSE    TO  ABYRYYH                                
               MOVE -1               TO  ABYRYYL                                
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               SET PS-INVALID-DATE   TO  TRUE                                   
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-BD-DD NUMERIC                                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-RED        TO  ABYRDDC                                
               MOVE DP015-REVERSE    TO  ABYRDDH                                
               MOVE -1               TO  ABYRDDL                                
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               SET PS-INVALID-DATE   TO  TRUE                                   
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-BD-MM NUMERIC                                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-RED        TO  ABYRMMC                                
               MOVE DP015-REVERSE    TO  ABYRMMH                                
               MOVE -1               TO  ABYRMML                                
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               SET PS-INVALID-DATE   TO  TRUE                                   
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
      *    IF THE DATE IS NUMERICALLY VALID, PICK UP THE CENTURY                
      *       BEFORE CHECKING FOR REASONABILITY.                                
      *                                                                         
           IF  PS-VALID-DATE                                                    
                                                                                
               INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56              
                                                                                
               SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                           
               SET DPG52-LK-DTE-GREG  TO TRUE                                   
               MOVE MB135-BD-MM       TO DPG52-GREG-DATE-MO-X                   
               MOVE MB135-BD-DD       TO DPG52-GREG-DATE-DY-X                   
               MOVE MB135-BD-YY       TO DPG52-GREG-DATE-YR-X                   
                                                                                
               CALL DP500-KOHLS-CALENDAR-ROUTINE                                
                    USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56              
                                                                                
               IF DPG54-NO-ERROR                                                
                  MOVE DPG55-JULIAN-CC-DATE-CC-X TO MB135-BD-CC                 
               ELSE                                                             
                   MOVE DP015-RED       TO  ABYRMMC                             
                                            ABYRDDC                             
                                            ABYRYYC                             
                   MOVE DP015-REVERSE                                           
                                        TO  ABYRMMH                             
                                            ABYRDDH                             
                                            ABYRYYH                             
                   MOVE -1              TO  ABYRMML                             
                   MOVE PC-TSYMSG-00009 TO  DP020-MSG-NUMBER                    
                   SET DP020-MSG-FATAL  TO  TRUE                                
                   SET PS-INVALID-DATE  TO  TRUE                                
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *                                                                         
      *    IF THE DATE IS NUMERICALLY VALID, CHECK REASONABILITY                
      *                                                                         
           IF  PS-VALID-DATE                                                    
               PERFORM DP017-0000-GET-CURR-DATE-TIME                            
               SET DP017-EDITED-YMD-DATE-DASH-1                                 
                   DP017-EDITED-YMD-DATE-DASH-2                                 
                                     TO  TRUE                                   
               MOVE DP017-EDITED-DATE-YYYYMMDD                                  
                                     TO  PV-DB2-WORK-DATE                       
               IF (MB135-BUYER-DATE < DP017-CURRENT-DATE-YYYYMMDD               
               OR  MB135-BUYER-DATE = DP017-CURRENT-DATE-YYYYMMDD)              
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   MOVE PC-TSYMSG-00067                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               ELSE                                                             
                   ADD 1             TO  DP017-CURRENT-YMD-YYYY                 
                   IF  MB135-BUYER-DATE > DP017-CURRENT-DATE-YYYYMMDD           
                       SET PS-INVALID-DATE                                      
                                     TO  TRUE                                   
                       MOVE PC-TSYMSG-00025                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-FATAL                                      
                                     TO  TRUE                                   
                   END-IF                                                       
                   SUBTRACT 1      FROM  DP017-CURRENT-YMD-YYYY                 
               END-IF                                                           
                                                                                
               IF  PS-INVALID-DATE                                              
                   MOVE DP015-RED    TO  ABYRMMC                                
                                         ABYRDDC                                
                                         ABYRYYC                                
                   MOVE DP015-REVERSE                                           
                                     TO  ABYRMMH                                
                                         ABYRDDH                                
                                         ABYRYYH                                
                   MOVE -1           TO  ABYRMML                                
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-BUYER2 NOT NUMERIC                                     
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ABYRNBRC                               
               MOVE DP015-REVERSE    TO  ABYRNBRH                               
               MOVE -1               TO  ABYRNBRL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
               SET PS-INVALID-BUYER  TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-DEPARTMENT NOT NUMERIC                                     
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ABYRDPTC                               
               MOVE DP015-REVERSE    TO  ABYRDPTH                               
               MOVE -1               TO  ABYRDPTL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
               SET PS-INVALID-BUYER  TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  PS-INVALID-BUYER                                                 
               CONTINUE                                                         
           ELSE                                                                 
               PERFORM 2110-DEPARTMENT-CHECK                                    
               IF  PV-DB2-COUNT GREATER THAN ZERO                               
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-TSYMSG-00032                                         
                                     TO  DP020-MSG-NUMBER                       
                   MOVE DP015-RED    TO  ABYRDPTC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ABYRDPTH                               
                   MOVE -1           TO  ABYRDPTL                               
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
                   SET PS-INVALID-BUYER                                         
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    IF REALIGNMENT DATA ENTERED, ENSURE ITS GOOD DATA.                   
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
      *                                                                         
       3320-VALIDATE-REALIGNMENT.                                               
      *                                                                         
           IF  MB135-NEW-BUYER1 GREATER THAN SPACES                             
               IF  MB135-NEW-BUYER1 NUMERIC                                     
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   MOVE DP015-RED    TO  ANBUYERC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ANBUYERH                               
                   MOVE -1           TO  ANBUYERL                               
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *    BEGIN THE DATE CHECK                                                 
      *                                                                         
           SET PS-VALID-DATE         TO  TRUE.                                  
           IF  MB135-ED-YY NUMERIC                                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-RED        TO  AEDATYYC                               
               MOVE DP015-REVERSE    TO  AEDATYYH                               
               MOVE -1               TO  AEDATYYL                               
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               SET PS-INVALID-DATE   TO  TRUE                                   
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
           IF  MB135-ED-DD NUMERIC                                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-RED        TO  AEDATDDC                               
               MOVE DP015-REVERSE    TO  AEDATDDH                               
               MOVE -1               TO  AEDATDDL                               
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               SET PS-INVALID-DATE   TO  TRUE                                   
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
           IF  MB135-ED-MM NUMERIC                                              
               CONTINUE                                                         
           ELSE                                                                 
               MOVE DP015-RED        TO  AEDATMMC                               
               MOVE DP015-REVERSE    TO  AEDATMMH                               
               MOVE -1               TO  AEDATMML                               
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               SET PS-INVALID-DATE   TO  TRUE                                   
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
      *    IF THE DATE IS NUMERICALLY VALID, CALL DPKUT500 TO PICK              
      *    UP THE CENTURY BEFORE CHECKING REASONABILITY.                        
      *                                                                         
           IF  PS-VALID-DATE                                                    
                                                                                
               INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56              
                                                                                
               SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                           
               SET DPG52-LK-DTE-GREG          TO TRUE                           
               MOVE MB135-ED-MM               TO DPG52-GREG-DATE-MO-X           
               MOVE MB135-ED-DD               TO DPG52-GREG-DATE-DY-X           
               MOVE MB135-ED-YY               TO DPG52-GREG-DATE-YR-X           
                                                                                
               CALL DP500-KOHLS-CALENDAR-ROUTINE                                
                    USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56              
                                                                                
               IF DPG54-NO-ERROR                                                
                  MOVE DPG55-JULIAN-CC-DATE-CC-X   TO MB135-ED-CC               
               ELSE                                                             
                  MOVE PC-TSYMSG-00009        TO DP020-MSG-NUMBER               
                  SET DP020-MSG-FATAL         TO TRUE                           
                  SET PS-INVALID-DATE         TO TRUE                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *                                                                         
      *    IF THE DATE IS NUMERICALLY VALID, CHECK REASONABILITY                
      *                                                                         
           IF  PS-VALID-DATE                                                    
               PERFORM DP017-0000-GET-CURR-DATE-TIME                            
               SET DP017-EDITED-YMD-DATE-DASH-1                                 
                   DP017-EDITED-YMD-DATE-DASH-2 TO  TRUE                        
               MOVE DP017-EDITED-DATE-YYYYMMDD  TO  PV-DB2-WORK-DATE            
                                                                                
               IF (MB135-EFFECTIVE-DATE < DP017-CURRENT-DATE-YYYYMMDD           
               OR  MB135-EFFECTIVE-DATE = DP017-CURRENT-DATE-YYYYMMDD)          
                   SET PS-INVALID-DATE          TO  TRUE                        
                   MOVE PC-TSYMSG-00067         TO  DP020-MSG-NUMBER            
                   SET DP020-MSG-FATAL          TO  TRUE                        
               ELSE                                                             
                   PERFORM 3325-VALIDATE-10-DAY-LIMIT                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  PS-INVALID-DATE                                                  
               MOVE DP015-RED     TO  AEDATMMC                                  
                                      AEDATDDC                                  
                                      AEDATYYC                                  
                                                                                
               MOVE DP015-REVERSE TO  AEDATMMH                                  
                                      AEDATDDH                                  
                                      AEDATYYH                                  
                                                                                
               MOVE -1            TO  AEDATMML                                  
           END-IF.                                                              
                                                                                
      *                                                                         
      *    REASONABILITY CHECK FOR NEW DATA.                                    
      *                                                                         
      *    IF  MB135-NEW-SUB-CL LESS THAN ZERO AND GREATER THAN SPACES          
      *        MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
           IF  MB135-NEW-SUB-CL GREATER THAN SPACES                             
               MOVE PC-TSYMSG-01355  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANSCLASC                               
               MOVE DP015-REVERSE    TO  ANSCLASH                               
               MOVE -1               TO  ANSCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
      *    IF  MB135-NEW-MAJ-CL LESS THAN ZERO AND GREATER THAN SPACES          
      *        MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
           IF  MB135-NEW-MAJ-CL GREATER THAN SPACES                             
               MOVE PC-TSYMSG-01355  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANMCLASC                               
               MOVE DP015-REVERSE    TO  ANMCLASH                               
               MOVE -1               TO  ANMCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-DEPT LESS THAN ZERO AND GREATER THAN SPACES            
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANDEPTC                                
               MOVE DP015-REVERSE    TO  ANDEPTH                                
               MOVE -1               TO  ANDEPTL                                
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-DMA LESS THAN ZERO AND GREATER THAN SPACES             
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANDMAC                                 
               MOVE DP015-REVERSE    TO  ANDMAH                                 
               MOVE -1               TO  ANDMAL                                 
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-GMA LESS THAN ZERO                                     
               MOVE PC-TSYMSG-00007  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANGMAC                                 
               MOVE DP015-REVERSE    TO  ANGMAH                                 
               MOVE -1               TO  ANGMAL                                 
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
      *                                                                         
           IF (MB135-NEW-DEPT GREATER THAN SPACES                               
           AND MB135-NEW-DMA LESS THAN ZERO)                                    
               MOVE PC-TSYMSG-00080  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANDEPTC                                
               MOVE DP015-REVERSE    TO  ANDEPTH                                
               MOVE -1               TO  ANDEPTL                                
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-NEW-MAJ-CL GREATER THAN SPACES                             
           AND MB135-NEW-DEPT LESS THAN ZERO)                                   
               MOVE PC-TSYMSG-00080  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANMCLASC                               
               MOVE DP015-REVERSE    TO  ANMCLASH                               
               MOVE -1               TO  ANMCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-NEW-SUB-CL GREATER THAN SPACES                             
           AND MB135-NEW-MAJ-CL LESS THAN ZERO)                                 
               MOVE PC-TSYMSG-00080  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ANSCLASC                               
               MOVE DP015-REVERSE    TO  ANSCLASH                               
               MOVE -1               TO  ANSCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
      *    REASONABILITY CHECK FOR OLD DATA.                                    
      *                                                                         
      *    IF  MB135-OLD-SUB-CL LESS THAN ZERO AND GREATER THAN SPACES          
      *        MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
           IF  MB135-OLD-SUB-CL GREATER THAN SPACES                             
               MOVE PC-TSYMSG-01355  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AOSCLASC                               
               MOVE DP015-REVERSE    TO  AOSCLASH                               
               MOVE -1               TO  AOSCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
      *    IF  MB135-OLD-MAJ-CL LESS THAN ZERO AND GREATER THAN SPACES          
      *        MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
           IF  MB135-OLD-MAJ-CL GREATER THAN SPACES                             
               MOVE PC-TSYMSG-01355  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AOMCLASC                               
               MOVE DP015-REVERSE    TO  AOMCLASH                               
               MOVE -1               TO  AOMCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-OLD-DEPT LESS THAN ZERO AND GREATER THAN SPACES            
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AODEPTC                                
               MOVE DP015-REVERSE    TO  AODEPTH                                
               MOVE -1               TO  AODEPTL                                
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-OLD-DMA LESS THAN ZERO AND GREATER THAN SPACES             
               MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AODMAC                                 
               MOVE DP015-REVERSE    TO  AODMAH                                 
               MOVE -1               TO  AODMAL                                 
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  MB135-OLD-GMA LESS THAN ZERO                                     
               MOVE PC-TSYMSG-00007  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AOGMAC                                 
               MOVE DP015-REVERSE    TO  AOGMAH                                 
               MOVE -1               TO  AOGMAL                                 
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-OLD-DEPT GREATER THAN SPACES                               
           AND MB135-OLD-DMA LESS THAN ZERO)                                    
               MOVE PC-TSYMSG-00080  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AODEPTC                                
               MOVE DP015-REVERSE    TO  AODEPTH                                
               MOVE -1               TO  AODEPTL                                
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-OLD-MAJ-CL GREATER THAN SPACES                             
           AND MB135-OLD-DEPT LESS THAN ZERO)                                   
               MOVE PC-TSYMSG-00080  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AOMCLASC                               
               MOVE DP015-REVERSE    TO  AOMCLASH                               
               MOVE -1               TO  AOMCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF (MB135-OLD-SUB-CL GREATER THAN SPACES                             
           AND MB135-OLD-MAJ-CL LESS THAN ZERO)                                 
               MOVE PC-TSYMSG-00080  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AOSCLASC                               
               MOVE DP015-REVERSE    TO  AOSCLASH                               
               MOVE -1               TO  AOSCLASL                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
           END-IF.                                                              
                                                                                
           IF  DP020-MSG-FATAL                                                  
               SET PS-DONT-PROCESS   TO  TRUE                                   
               SET PS-INVALID-REALIGNMENT                                       
                                     TO  TRUE                                   
           ELSE                                                                 
               PERFORM 3330-VALIDATE-LEVEL                                      
               PERFORM 3340-EXISTANCE-CHECK                                     
               IF  DP020-MSG-FATAL                                              
                   SET PS-DONT-PROCESS                                          
                                     TO  TRUE                                   
                   SET PS-INVALID-REALIGNMENT                                   
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  PS-CONTINUE                                                      
               MOVE MB135-ED-CC      TO  PV-DD-CC                               
               MOVE MB135-ED-MM      TO  PV-DD-MM                               
               MOVE MB135-ED-DD      TO  PV-DD-DD                               
               MOVE MB135-ED-YY      TO  PV-DD-YY                               
               SET PV-DD-DASH1       TO  TRUE                                   
               SET PV-DD-DASH2       TO  TRUE                                   
                                                                                
               PERFORM 2120-CHECK-EFFECTIVE-DATE                                
               IF  PV-DB2-COUNT GREATER THAN ZERO                               
                   MOVE PC-TSYMSG-00193                                         
                                     TO  DP020-MSG-NUMBER                       
                   MOVE -1           TO  AOGMAL                                 
                   MOVE DP015-RED    TO  AOGMAC                                 
                   MOVE DP015-REVERSE                                           
                                     TO  AOGMAH                                 
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
                   SET PS-DONT-PROCESS                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
                                                                                
      ******************************************************************        
      *    CHECK THAT THE EFFECTIVE DATE IS WITHIN 10 DAYS FROM TODAY.          
      *      - FORMAT INPUT EFFECTIVE DATE TO CCYYMMDD.                         
      *      - CALL DATE ROUTINE WITH CURRENT DATE + 10.                        
      *      - FORMAT RETURNED DATE TO CCYYMMDD.                                
      *      - COMPARE INPUT EFFECTIVE DATE TO RETURNED DATE.                   
      *                                                                         
      *    PERFORMED BY 3320                                                    
      ******************************************************************        
                                                                                
       3325-VALIDATE-10-DAY-LIMIT.                                              
                                                                                
           INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                 
                                                                                
           SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                            
           SET DPG51-INCREMENT-DATE         TO TRUE.                            
           MOVE PC-10-DAY-LIMIT             TO DPG51-INCR-DECR-DAYS-9.          
                                                                                
           SET DPG52-LK-DTE-ISO             TO TRUE.                            
           MOVE DP017-CURRENT-DATE-YYYYMMDD TO DPG52-DB2-ISO-DATE.              
                                                                                
           CALL DP500-KOHLS-CALENDAR-ROUTINE                                    
                USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                 
                                                                                
           IF  DPG54-NO-ERROR                                                   
               IF  MB135-EFFECTIVE-DATE > DPG55-DB2-ISO-DATE                    
                   MOVE PC-TSYMSG-01346     TO DP020-MSG-NUMBER                 
                   SET DP020-MSG-FATAL      TO TRUE                             
                   SET PS-INVALID-DATE      TO TRUE                             
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *    CHECK THAT THE LEVELS FOR OLD AND NEW MATCH.                         
      *                                                                         
      *    PERFORMED BY 3320                                                    
      ******************************************************************        
      *                                                                         
       3330-VALIDATE-LEVEL.                                                     
      *                                                                         
      *    IF (MB135-NEW-SUB-CL GREATER THAN SPACES                             
      *    OR  MB135-OLD-SUB-CL GREATER THAN SPACES)                            
      *        IF (MB135-NEW-SUB-CL GREATER THAN SPACES                         
      *        AND MB135-OLD-SUB-CL GREATER THAN SPACES)                        
      *                                                                         
      *            IF (MB135-NEW-SUB-CL-BYTE2 EQUAL                             
      *                MB135-NEW-MAJ-CL-BYTE1                                   
      *            AND MB135-NEW-SUB-CL-BYTE1 EQUAL ZERO)                       
      *                CONTINUE                                                 
      *            ELSE                                                         
      *                MOVE PC-TSYMSG-00185                                     
      *                              TO  DP020-MSG-NUMBER                       
      *                MOVE DP015-RED                                           
      *                              TO  ANSCLASC                               
      *                MOVE DP015-REVERSE                                       
      *                              TO  ANSCLASH                               
      *                MOVE -1       TO  ANSCLASL                               
      *                SET DP020-MSG-FATAL                                      
      *                              TO  TRUE                                   
      *            END-IF                                                       
      *        ELSE                                                             
      *            MOVE PC-TSYMSG-00194                                         
      *                              TO  DP020-MSG-NUMBER                       
      *            MOVE DP015-RED    TO  AOSCLASC                               
      *            MOVE DP015-REVERSE                                           
      *                              TO  AOSCLASH                               
      *            MOVE -1           TO  AOSCLASL                               
      *            SET DP020-MSG-FATAL                                          
      *                              TO  TRUE                                   
      *        END-IF                                                           
      *    END-IF.                                                              
      ****************************************************************          
      *                                                                         
      *    IF (MB135-NEW-MAJ-CL GREATER THAN SPACES                             
      *    OR  MB135-OLD-MAJ-CL GREATER THAN SPACES)                            
      *        IF (MB135-NEW-MAJ-CL GREATER THAN SPACES                         
      *        AND MB135-OLD-MAJ-CL GREATER THAN SPACES)                        
      *            IF  MB135-OLD-SUB-CL LESS THAN ZERO                          
      *                MOVE PC-TSYMSG-00195                                     
      *                              TO  DP020-MSG-NUMBER                       
      *                MOVE DP015-RED                                           
      *                              TO  AOMCLASC                               
      *                MOVE DP015-REVERSE                                       
      *                              TO  AOMCLASH                               
      *                MOVE -1       TO  AOMCLASL                               
      *                SET DP020-MSG-FATAL                                      
      *                              TO  TRUE                                   
      *            ELSE                                                         
      *                CONTINUE                                                 
      *            END-IF                                                       
      *        ELSE                                                             
      *            MOVE PC-TSYMSG-00194                                         
      *                              TO  DP020-MSG-NUMBER                       
      *            MOVE DP015-RED    TO  AOMCLASC                               
      *            MOVE DP015-REVERSE                                           
      *                              TO  AOMCLASH                               
      *            MOVE -1           TO  AOMCLASL                               
      *            SET DP020-MSG-FATAL                                          
      *                              TO  TRUE                                   
      *        END-IF                                                           
      *    END-IF.                                                              
      *                                                                         
      *    IF (MB135-NEW-MAJ-CL GREATER THAN SPACES                             
      *    OR  MB135-OLD-MAJ-CL GREATER THAN SPACES)                            
      *        IF (MB135-NEW-MAJ-CL GREATER THAN SPACES                         
      *        AND MB135-OLD-MAJ-CL GREATER THAN SPACES)                        
      *            CONTINUE                                                     
      *        ELSE                                                             
      *            MOVE PC-TSYMSG-00194                                         
      *                              TO  DP020-MSG-NUMBER                       
      *            MOVE DP015-RED    TO  AOMCLASC                               
      *            MOVE DP015-REVERSE                                           
      *                              TO  AOMCLASH                               
      *            MOVE -1           TO  AOMCLASL                               
      *            SET DP020-MSG-FATAL                                          
      *                              TO  TRUE                                   
      *        END-IF                                                           
      *    END-IF.                                                              
      ****************************************************************          
           IF (MB135-NEW-DEPT GREATER THAN SPACES                               
           OR  MB135-OLD-DEPT GREATER THAN SPACES)                              
               IF (MB135-NEW-DEPT GREATER THAN SPACES                           
               AND MB135-OLD-DEPT GREATER THAN SPACES)                          
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-TSYMSG-00194                                         
                                     TO  DP020-MSG-NUMBER                       
                   MOVE DP015-RED    TO  AODEPTC                                
                   MOVE DP015-REVERSE                                           
                                     TO  AODEPTH                                
                   MOVE -1           TO  AODEPTL                                
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           IF (MB135-NEW-DMA GREATER THAN SPACES                                
           OR  MB135-OLD-DMA GREATER THAN SPACES)                               
               IF (MB135-NEW-DMA GREATER THAN SPACES                            
               AND MB135-OLD-DMA GREATER THAN SPACES)                           
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-TSYMSG-00194                                         
                                     TO  DP020-MSG-NUMBER                       
                   MOVE DP015-RED    TO  AODMAC                                 
                   MOVE DP015-REVERSE                                           
                                     TO  AODMAH                                 
                   MOVE -1           TO  AODMAL                                 
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           IF (MB135-NEW-GMA GREATER THAN SPACES                                
           OR  MB135-OLD-GMA GREATER THAN SPACES)                               
               IF (MB135-NEW-GMA GREATER THAN SPACES                            
               AND MB135-OLD-GMA GREATER THAN SPACES)                           
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE PC-TSYMSG-00194                                         
                                     TO  DP020-MSG-NUMBER                       
                   MOVE DP015-RED    TO  AOGMAC                                 
                   MOVE DP015-REVERSE                                           
                                     TO  AOGMAH                                 
                   MOVE -1           TO  AOGMAL                                 
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *    IF (MB135-OLD-SUB-CL GREATER THAN SPACES                             
      *    AND MB135-OLD-MAJ-CL GREATER THAN SPACES)                            
      *        IF (MB135-OLD-GMA  EQUAL MB135-NEW-GMA                           
      *        AND MB135-OLD-DMA  EQUAL MB135-NEW-DMA                           
      *        AND MB135-OLD-DEPT EQUAL MB135-NEW-DEPT)                         
      *            CONTINUE                                                     
      *        ELSE                                                             
      *            MOVE PC-TSYMSG-00196                                         
      *                              TO  DP020-MSG-NUMBER                       
      *            MOVE DP015-RED    TO  AODEPTC                                
      *            MOVE DP015-REVERSE                                           
      *                              TO  AODEPTH                                
      *            MOVE -1           TO  AODEPTL                                
      *            SET DP020-MSG-FATAL                                          
      *                              TO  TRUE                                   
      *        END-IF                                                           
      *    END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    ENSURE THE OLD DATA EXISTS AND THE NEW DATA DOES NOT.                
      *                                                                         
      *    PERFORMED BY 3320                                                    
      ******************************************************************        
      *                                                                         
       3340-EXISTANCE-CHECK.                                                    
      *                                                                         
      *    FIRST, BUILD THE LIST SEQUENCE NUMBER FOR THE "OLD" DATA.            
      *                                                                         
           MOVE MB135-OLD-DATA       TO  PV-SCREEN-DATA.                        
           MOVE PC-COMPANY           TO  PV-WS-OPERCO.                          
           MOVE ZERO                 TO  PV-WS-ZERO.                            
           MOVE ZERO                 TO  PV-WS-SUB-CL.                          
           MOVE ZERO                 TO  PV-WS-MAJ-CL.                          
      *                                                                         
      *    IF  MB135-OLD-SUB-CL LESS THAN ZERO                                  
      *        MOVE ZERO             TO  PV-WS-SUB-CL                           
      *    END-IF.                                                              
      *                                                                         
      *    IF  MB135-OLD-MAJ-CL LESS THAN ZERO                                  
      *        MOVE ZERO             TO  PV-WS-MAJ-CL                           
      *    END-IF.                                                              
      *                                                                         
           IF  MB135-OLD-DEPT   LESS THAN ZERO                                  
               MOVE ZERO             TO  PV-WS-DEPT                             
           END-IF.                                                              
      *                                                                         
           IF  MB135-OLD-DMA    LESS THAN ZERO                                  
               MOVE ZERO             TO  PV-WS-DMA                              
           END-IF.                                                              
      *                                                                         
           IF  MB135-OLD-GMA    LESS THAN ZERO                                  
               MOVE ZERO             TO  PV-WS-GMA                              
           END-IF.                                                              
      *                                                                         
           MOVE PV-WORK-SEQ-NBR      TO  MB135-LIST-SEQ-NBR                     
                                         PV-HOLD-LIST-SEQ-NBR.                  
      *                                                                         
      *    NOW THE MAX SEQUENCE NUMBER.                                         
      *                                                                         
           MOVE PC-NINES             TO  PV-WS-ZERO.                            
           MOVE PC-NINES             TO  PV-WS-SUB-CL.                          
           MOVE PC-NINES             TO  PV-WS-MAJ-CL.                          
      *                                                                         
      *    IF  MB135-OLD-SUB-CL LESS THAN ZERO                                  
      *        MOVE PC-NINES         TO  PV-WS-SUB-CL                           
      *    END-IF.                                                              
      *                                                                         
      *    IF  MB135-OLD-MAJ-CL LESS THAN ZERO                                  
      *        MOVE PC-NINES         TO  PV-WS-MAJ-CL                           
      *    END-IF.                                                              
      *                                                                         
           IF  MB135-OLD-DEPT   LESS THAN ZERO                                  
               MOVE PC-NINES         TO  PV-WS-DEPT                             
           END-IF.                                                              
      *                                                                         
           IF  MB135-OLD-DMA    LESS THAN ZERO                                  
               MOVE PC-NINES         TO  PV-WS-DMA                              
           END-IF.                                                              
      *                                                                         
           IF  MB135-OLD-GMA    LESS THAN ZERO                                  
               MOVE PC-NINES         TO  PV-WS-GMA                              
           END-IF.                                                              
      *                                                                         
           MOVE PV-WORK-SEQ-NBR      TO  MB135-MAX-SEQ-NBR                      
                                         PV-HOLD-MAX-SEQ-NBR.                   
      *                                                                         
           PERFORM 2130-CHECK-EXISTANCE.                                        
           IF  PV-DB2-COUNT EQUAL ZERO                                          
               MOVE PC-TSYMSG-00197  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  AOGMAC                                 
               MOVE DP015-REVERSE    TO  AOGMAH                                 
               MOVE -1               TO  AOGMAL                                 
               SET DP020-MSG-FATAL   TO  TRUE                                   
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
      *    NOW, BUILD THE LIST SEQUENCE NUMBER FOR THE "NEW" DATA.              
      *                                                                         
           MOVE MB135-NEW-DATA       TO  PV-SCREEN-DATA.                        
           MOVE ZERO                 TO  PV-WS-ZERO.                            
           MOVE ZERO                 TO  PV-WS-SUB-CL.                          
           MOVE ZERO                 TO  PV-WS-MAJ-CL.                          
      *                                                                         
      *    IF  MB135-NEW-SUB-CL LESS THAN ZERO                                  
      *        MOVE ZERO             TO  PV-WS-SUB-CL                           
      *    END-IF.                                                              
      *                                                                         
      *    IF  MB135-NEW-MAJ-CL LESS THAN ZERO                                  
      *        MOVE ZERO             TO  PV-WS-MAJ-CL                           
      *    END-IF.                                                              
      *                                                                         
           IF  MB135-NEW-DEPT   LESS THAN ZERO                                  
               MOVE ZERO             TO  PV-WS-DEPT                             
           END-IF.                                                              
      *                                                                         
           IF  MB135-NEW-DMA    LESS THAN ZERO                                  
               MOVE ZERO             TO  PV-WS-DMA                              
           END-IF.                                                              
      *                                                                         
           IF  MB135-NEW-GMA    LESS THAN ZERO                                  
               MOVE ZERO             TO  PV-WS-GMA                              
           END-IF.                                                              
      *                                                                         
           MOVE PV-WORK-SEQ-NBR      TO  MB135-LIST-SEQ-NBR.                    
      *                                                                         
      *    NOW THE MAX SEQUENCE NUMBER.                                         
      *                                                                         
           MOVE PC-NINES             TO  PV-WS-ZERO.                            
           MOVE PC-NINES             TO  PV-WS-SUB-CL.                          
           MOVE PC-NINES             TO  PV-WS-MAJ-CL.                          
      *                                                                         
      *    IF  MB135-NEW-SUB-CL LESS THAN ZERO                                  
      *        MOVE PC-NINES         TO  PV-WS-SUB-CL                           
      *    END-IF.                                                              
      *                                                                         
      *    IF  MB135-NEW-MAJ-CL LESS THAN ZERO                                  
      *        MOVE PC-NINES         TO  PV-WS-MAJ-CL                           
      *    END-IF.                                                              
      *                                                                         
           IF  MB135-NEW-DEPT   LESS THAN ZERO                                  
               MOVE PC-NINES         TO  PV-WS-DEPT                             
           END-IF.                                                              
      *                                                                         
           IF  MB135-NEW-DMA    LESS THAN ZERO                                  
               MOVE PC-NINES         TO  PV-WS-DMA                              
           END-IF.                                                              
      *                                                                         
           IF  MB135-NEW-GMA    LESS THAN ZERO                                  
               MOVE PC-NINES         TO  PV-WS-GMA                              
           END-IF.                                                              
      *                                                                         
           MOVE PV-WORK-SEQ-NBR      TO  MB135-MAX-SEQ-NBR.                     
      *                                                                         
           MOVE DP015-GREEN          TO  ANGMAC.                                
           MOVE DP015-UNDERLINE      TO  ANGMAH.                                
           MOVE PV-DB2-1900-DATE     TO  PV-DB2-WORK-DATE.                      
           PERFORM 2130-CHECK-EXISTANCE.                                        
      *                                                                         
           IF (PV-DB2-COUNT GREATER THAN ZERO                                   
           AND NOT DP020-MSG-FATAL)                                             
               MOVE PC-TSYMSG-00198  TO  DP020-MSG-NUMBER                       
               SET DP020-MSG-FATAL   TO  TRUE                                   
               MOVE DP015-RED        TO  ANGMAC                                 
               MOVE DP015-REVERSE    TO  ANGMAH                                 
               MOVE -1               TO  ANGMAL                                 
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
           PERFORM 2140-CHECK-PARENT.                                           
      *                                                                         
           IF (PV-DB2-COUNT EQUAL ZERO                                          
           AND NOT DP020-MSG-FATAL)                                             
               MOVE PC-TSYMSG-00199  TO  DP020-MSG-NUMBER                       
               SET DP020-MSG-FATAL   TO  TRUE                                   
               MOVE DP015-RED        TO  ANGMAC                                 
               MOVE DP015-REVERSE    TO  ANGMAH                                 
               MOVE -1               TO  ANGMAL                                 
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    VALIDATE DATES FOR THE MBS DATE CHANGE PROCESS.                      
      *                                                                         
      *    PERFORMED BY 3300                                                    
      ******************************************************************        
                                                                                
       3350-DATE-CHANGE.                                                        
                                                                                
      *    BEGIN THE DATE CHECK                                                 
                                                                                
           SET PS-VALID-DATE         TO  TRUE.                                  
           IF  MB135-NED-YY GREATER THAN SPACES                                 
               SET PS-DATE-PRESENT   TO  TRUE                                   
               IF  MB135-NED-YY NUMERIC                                         
                   IF  MB135-NED-YY > '80'                                      
                       MOVE '19'     TO  MB135-NED-CC                           
                   ELSE                                                         
                       MOVE '20'     TO  MB135-NED-CC                           
                   END-IF                                                       
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNEYYC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNEYYH                               
                   MOVE -1           TO  ADCNEYYL                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NED-DD GREATER THAN SPACES                                 
               SET PS-DATE-PRESENT   TO  TRUE                                   
               IF  MB135-NED-DD NUMERIC                                         
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNEDDC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNEDDH                               
                   MOVE -1           TO  ADCNEDDL                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NED-MM GREATER THAN SPACES                                 
               SET PS-DATE-PRESENT   TO  TRUE                                   
               IF  MB135-NED-MM NUMERIC                                         
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNEMMC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNEMMH                               
                   MOVE -1           TO  ADCNEMML                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-END-DATE-YMD GREATER THAN SPACES                       
               IF  MB135-NEW-END-DATE-YMD NUMERIC                               
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNEMMC                               
                                         ADCNEDDC                               
                                         ADCNEYYC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNEMMH                               
                                         ADCNEDDH                               
                                         ADCNEYYH                               
                   MOVE -1           TO  ADCNEMML                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           ELSE                                                                 
               IF  MB135-MDSEAR-END-DTE NOT EQUAL PC-NINES-DATE                 
                   IF  PC-NINES-DATE GREATER MB135-PARENT-END-DTE               
                       MOVE PC-TSYMSG-00145                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-FATAL                                      
                                     TO  TRUE                                   
                       SET PS-INVALID-DATE                                      
                                     TO  TRUE                                   
                       MOVE DP015-RED                                           
                                     TO  ADCNEMMC                               
                                         ADCNEDDC                               
                                         ADCNEYYC                               
                       MOVE DP015-REVERSE                                       
                                     TO  ADCNEMMH                               
                                         ADCNEDDH                               
                                         ADCNEYYH                               
                       MOVE -1       TO  ADCNEMML                               
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    IF THE DATE IS NUMERICALLY VALID, CHECK REASONABILITY                
                                                                                
           IF (PS-VALID-DATE                                                    
           AND PS-DATE-PRESENT)                                                 
               IF  MB135-CURRENT-DATE GREATER MB135-NEW-END-DATE                
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   MOVE PC-TSYMSG-00067                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               ELSE                                                             
                   IF  MB135-NEW-END-DATE GREATER MB135-ONE-YEAR-DATE           
                       SET PS-INVALID-DATE                                      
                                     TO  TRUE                                   
                       MOVE PC-TSYMSG-00025                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-FATAL                                      
                                     TO  TRUE                                   
                   END-IF                                                       
               END-IF                                                           
                                                                                
               IF  PS-VALID-DATE                                                
                   INITIALIZE DPG51, DPG52, DPG53,                              
                              DPG54, DPG55, DPG56                               
                                                                                
                   SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                       
                                                                                
                   SET DPG52-LK-DTE-ISO TO TRUE                                 
                   MOVE MB135-NEW-END-DATE TO DPG52-DB2-ISO-DATE                
                                                                                
                   CALL DP500-KOHLS-CALENDAR-ROUTINE                            
                        USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56          
                                                                                
                   IF  DPG54-NO-ERROR                                           
                       MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-DATE               
                       IF  PV-DB2-DATE GREATER MB135-PARENT-END-DTE             
                           MOVE PC-TSYMSG-00145                                 
                                     TO  DP020-MSG-NUMBER                       
                           SET DP020-MSG-FATAL                                  
                                     TO  TRUE                                   
                           SET PS-INVALID-DATE                                  
                                     TO  TRUE                                   
                       END-IF                                                   
                                                                                
                   ELSE                                                         
                       MOVE PC-TSYMSG-00009                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-FATAL                                      
                                     TO  TRUE                                   
                       SET PS-INVALID-DATE                                      
                                     TO  TRUE                                   
                   END-IF                                                       
               END-IF                                                           
               IF  PS-INVALID-DATE                                              
                   MOVE DP015-RED    TO  ADCNEMMC                               
                                         ADCNEDDC                               
                                         ADCNEYYC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNEMMH                               
                                         ADCNEDDH                               
                                         ADCNEYYH                               
                   MOVE -1           TO  ADCNEMML                               
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF (PS-VALID-DATE                                                    
           AND PS-DATE-PRESENT)                                                 
               PERFORM 3360-CHECK-FOR-DELETIONS                                 
           END-IF.                                                              
                                                                                
           IF  MB135-NSD-COLOR NOT EQUAL DP015-BLUE                             
               PERFORM 3370-START-DATE-EDIT                                     
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE WHETHER THE REQUESTED CHANGED TO END DATE WILL             
      *    CAUSE US TO DELETE A MERCHANDISE AREA (CURRENTLY NOT ALLOWED)        
      *                                                                         
      *    PERFORMED BY 3350                                                    
      ******************************************************************        
                                                                                
       3360-CHECK-FOR-DELETIONS.                                                
                                                                                
      *    BUILD THE LIST SEQUENCE NUMBER.                                      
                                                                                
           MOVE MB135-DATE-CHANGE-DATA                                          
                                     TO  PV-SCREEN-DATA.                        
           MOVE PC-COMPANY           TO  PV-WS-OPERCO.                          
           MOVE ZERO                 TO  PV-WS-ZERO.                            
                                                                                
           IF  MB135-DC-SUB-CL LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-SUB-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-MAJ-CL LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-MAJ-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DEPT   LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-DEPT                             
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DMA    LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-DMA                              
           END-IF.                                                              
                                                                                
           IF  MB135-DC-GMA    LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-GMA                              
           END-IF.                                                              
                                                                                
           MOVE PV-WORK-SEQ-NBR      TO  PV-HOLD-LIST-SEQ-NBR.                  
                                                                                
      *    NOW THE MAX SEQUENCE NUMBER.                                         
                                                                                
           MOVE PC-NINES             TO  PV-WS-ZERO.                            
           IF  MB135-DC-SUB-CL NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-SUB-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-MAJ-CL NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-MAJ-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DEPT   NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-DEPT                             
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DMA    NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-DMA                              
           END-IF.                                                              
                                                                                
           IF  MB135-DC-GMA    NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-GMA                              
           END-IF.                                                              
                                                                                
           MOVE PV-WORK-SEQ-NBR      TO  PV-HOLD-MAX-SEQ-NBR.                   
                                                                                
           PERFORM 2125-CHECK-START-DATE.                                       
           IF  PV-DB2-COUNT GREATER THAN ZERO                                   
               MOVE PC-TSYMSG-00213  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ADCNEMMC                               
                                         ADCNEDDC                               
                                         ADCNEYYC                               
               MOVE DP015-REVERSE    TO  ADCNEMMH                               
                                         ADCNEDDH                               
                                         ADCNEYYH                               
               MOVE -1               TO  ADCNEMML                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    VALIDATE START DATE FOR MBS DATE CHANGE PROCESS.                     
      *                                                                         
      *    PERFORMED BY 3350                                                    
      ******************************************************************        
      *                                                                         
       3370-START-DATE-EDIT.                                                    
      *                                                                         
      *    BEGIN THE DATE CHECK                                                 
      *                                                                         
           SET PS-VALID-DATE         TO  TRUE.                                  
           SET PS-DATE-NOT-PRESENT   TO  TRUE.                                  
                                                                                
           IF  MB135-NSD-YY GREATER THAN SPACES                                 
               SET PS-DATE-PRESENT   TO  TRUE                                   
               IF  MB135-NSD-YY NUMERIC                                         
                   IF  MB135-NSD-YY > '80'                                      
                       MOVE '19'     TO  MB135-NSD-CC                           
                   ELSE                                                         
                       MOVE '20'     TO  MB135-NSD-CC                           
                   END-IF                                                       
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNSYYC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNSYYH                               
                   MOVE -1           TO  ADCNSYYL                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NSD-DD GREATER THAN SPACES                                 
               SET PS-DATE-PRESENT   TO  TRUE                                   
               IF  MB135-NSD-DD NUMERIC                                         
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNSDDC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNSDDH                               
                   MOVE -1           TO  ADCNSDDL                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NSD-MM GREATER THAN SPACES                                 
               SET PS-DATE-PRESENT   TO  TRUE                                   
               IF  MB135-NSD-MM NUMERIC                                         
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNSMMC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNSMMH                               
                   MOVE -1           TO  ADCNSMML                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-START-DATE-YMD GREATER THAN SPACES                     
               IF  MB135-NEW-START-DATE-YMD NUMERIC                             
                   CONTINUE                                                     
               ELSE                                                             
                   MOVE DP015-RED    TO  ADCNSMMC                               
                                         ADCNSDDC                               
                                         ADCNSYYC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNSMMH                               
                                         ADCNSDDH                               
                                         ADCNSYYH                               
                   MOVE -1           TO  ADCNSMML                               
                   MOVE PC-TSYMSG-00008                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *    IF THE DATE IS NUMERICALLY VALID, CHECK REASONABILITY                
      *                                                                         
           IF (PS-VALID-DATE                                                    
           AND PS-DATE-PRESENT)                                                 
               IF  MB135-NEW-START-DATE GREATER MB135-ONE-YEAR-DATE             
                   SET PS-INVALID-DATE                                          
                                     TO  TRUE                                   
                   MOVE PC-TSYMSG-00025                                         
                                     TO  DP020-MSG-NUMBER                       
                   SET DP020-MSG-FATAL                                          
                                     TO  TRUE                                   
               END-IF                                                           
                                                                                
               IF  MB135-NEW-END-DATE-YMD NUMERIC                               
                   IF  MB135-NEW-END-DATE LESS MB135-NEW-START-DATE             
                       SET PS-INVALID-DATE                                      
                                     TO  TRUE                                   
                       MOVE PC-TSYMSG-00143                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-FATAL                                      
                                     TO  TRUE                                   
                   END-IF                                                       
               END-IF                                                           
                                                                                
               IF  PS-VALID-DATE                                                
                   INITIALIZE DPG51, DPG52, DPG53,                              
                              DPG54, DPG55, DPG56                               
                                                                                
                   SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                       
                                                                                
                   SET DPG52-LK-DTE-ISO TO TRUE                                 
                   MOVE MB135-NEW-START-DATE TO DPG52-DB2-ISO-DATE              
                                                                                
                   CALL DP500-KOHLS-CALENDAR-ROUTINE                            
                        USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56          
                                                                                
                   IF  DPG54-NO-ERROR                                           
                       MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-DATE               
                       IF  PV-DB2-DATE LESS MB135-PARENT-STRT-DTE               
                           MOVE PC-TSYMSG-00144                                 
                                     TO  DP020-MSG-NUMBER                       
                           SET DP020-MSG-FATAL                                  
                                     TO  TRUE                                   
                           SET PS-INVALID-DATE                                  
                                     TO  TRUE                                   
                       END-IF                                                   
                                                                                
                       IF  PV-DB2-DATE LESS THAN                                
                                     MB135-START-DATE-CHANGE-LIMIT              
                           SET PS-INVALID-DATE                                  
                                     TO  TRUE                                   
                           MOVE PC-TSYMSG-00191                                 
                                     TO  DP020-MSG-NUMBER                       
                           SET DP020-MSG-FATAL                                  
                                     TO  TRUE                                   
                       END-IF                                                   
                   ELSE                                                         
                       MOVE PC-TSYMSG-00009                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-FATAL                                      
                                     TO  TRUE                                   
                       SET PS-INVALID-DATE                                      
                                     TO  TRUE                                   
                   END-IF                                                       
               END-IF                                                           
                                                                                
               IF  PS-INVALID-DATE                                              
                   MOVE DP015-RED    TO  ADCNSMMC                               
                                         ADCNSDDC                               
                                         ADCNSYYC                               
                   MOVE DP015-REVERSE                                           
                                     TO  ADCNSMMH                               
                                         ADCNSDDH                               
                                         ADCNSYYH                               
                   MOVE -1           TO  ADCNSMML                               
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF (PS-VALID-DATE                                                    
           AND PS-DATE-PRESENT)                                                 
               PERFORM 3380-CHECK-FOR-DELETIONS                                 
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    DETERMINE WHETHER THE REQUESTED CHANGED TO START DATE WILL           
      *    CAUSE US TO DELETE A MERCHANDISE AREA (CURRENTLY NOT ALLOWED)        
      *                                                                         
      *    PERFORMED BY 3370                                                    
      ******************************************************************        
                                                                                
       3380-CHECK-FOR-DELETIONS.                                                
                                                                                
      *    BUILD THE LIST SEQUENCE NUMBER.                                      
                                                                                
           MOVE MB135-DATE-CHANGE-DATA                                          
                                     TO  PV-SCREEN-DATA.                        
           MOVE PC-COMPANY           TO  PV-WS-OPERCO.                          
           MOVE ZERO                 TO  PV-WS-ZERO.                            
                                                                                
           IF  MB135-DC-SUB-CL LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-SUB-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-MAJ-CL LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-MAJ-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DEPT   LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-DEPT                             
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DMA    LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-DMA                              
           END-IF.                                                              
                                                                                
           IF  MB135-DC-GMA    LESS THAN ZERO                                   
               MOVE ZERO             TO  PV-WS-GMA                              
           END-IF.                                                              
                                                                                
           MOVE PV-WORK-SEQ-NBR      TO  PV-HOLD-LIST-SEQ-NBR.                  
                                                                                
      *    NOW THE MAX SEQUENCE NUMBER.                                         
                                                                                
           MOVE PC-NINES             TO  PV-WS-ZERO.                            
           IF  MB135-DC-SUB-CL NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-SUB-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-MAJ-CL NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-MAJ-CL                           
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DEPT   NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-DEPT                             
           END-IF.                                                              
                                                                                
           IF  MB135-DC-DMA    NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-DMA                              
           END-IF.                                                              
                                                                                
           IF  MB135-DC-GMA    NOT GREATER THAN ZERO                            
               MOVE PC-NINES         TO  PV-WS-GMA                              
           END-IF.                                                              
                                                                                
           MOVE PV-WORK-SEQ-NBR      TO  PV-HOLD-MAX-SEQ-NBR.                   
                                                                                
           PERFORM 2126-CHECK-END-DATE.                                         
           IF  PV-DB2-COUNT GREATER THAN ZERO                                   
               MOVE PC-TSYMSG-00214  TO  DP020-MSG-NUMBER                       
               MOVE DP015-RED        TO  ADCNSMMC                               
                                         ADCNSDDC                               
                                         ADCNSYYC                               
               MOVE DP015-REVERSE    TO  ADCNSMMH                               
                                         ADCNSDDH                               
                                         ADCNSYYH                               
               MOVE -1               TO  ADCNSMML                               
               SET DP020-MSG-FATAL   TO  TRUE                                   
               SET PS-DONT-PROCESS   TO  TRUE                                   
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.                   
      *                                                                         
      *    PERFORMED BY 2000, 2150.                                             
      ******************************************************************        
                                                                                
       3400-MOVE-COMMAREA-TO-SCREEN.                                            
                                                                                
           MOVE MB135-OLD-GMA        TO  AOGMAO.                                
           MOVE MB135-OLD-DMA        TO  AODMAO.                                
           MOVE MB135-OLD-DEPT       TO  AODEPTO.                               
           MOVE MB135-OLD-MAJ-CL     TO  AOMCLASO.                              
           MOVE MB135-OLD-SUB-CL     TO  AOSCLASO.                              
                                                                                
           MOVE MB135-NEW-GMA        TO  ANGMAO.                                
           MOVE MB135-NEW-DMA        TO  ANDMAO.                                
           MOVE MB135-NEW-DEPT       TO  ANDEPTO.                               
           MOVE MB135-NEW-MAJ-CL     TO  ANMCLASO.                              
           MOVE MB135-NEW-SUB-CL     TO  ANSCLASO.                              
                                                                                
           MOVE MB135-ED-YY          TO  AEDATYYO.                              
           MOVE MB135-ED-MM          TO  AEDATMMO.                              
           MOVE MB135-ED-DD          TO  AEDATDDO.                              
           MOVE MB135-NEW-BUYER1     TO  ANBUYERO.                              
                                                                                
           MOVE MB135-DEPARTMENT     TO  ABYRDPTO.                              
           MOVE MB135-NEW-BUYER2     TO  ABYRNBRO.                              
           MOVE MB135-BD-YY          TO  ABYRYYO.                               
           MOVE MB135-BD-MM          TO  ABYRMMO.                               
           MOVE MB135-BD-DD          TO  ABYRDDO.                               
                                                                                
           MOVE MB135-DC-GMA         TO  ADCGMAO.                               
           MOVE MB135-DC-DMA         TO  ADCDMAO.                               
           MOVE MB135-DC-DEPT        TO  ADCDPTO.                               
           MOVE MB135-DC-MAJ-CL      TO  ADCMCLO.                               
           MOVE MB135-DC-SUB-CL      TO  ADCSCLO.                               
                                                                                
           IF  MB135-DC-DMA EQUAL ZERO                                          
               MOVE SPACES           TO  ADCDMAO                                
                                         ADCDPTO                                
                                         ADCMCLO                                
                                         ADCSCLO                                
           ELSE                                                                 
               IF  MB135-DC-DEPT EQUAL ZERO                                     
                   MOVE SPACES       TO  ADCDPTO                                
                                         ADCMCLO                                
                                         ADCSCLO                                
               ELSE                                                             
                   IF  MB135-DC-MAJ-CL EQUAL ZERO                               
                       MOVE SPACES   TO  ADCMCLO                                
                                         ADCSCLO                                
                   ELSE                                                         
                       IF  MB135-DC-SUB-CL EQUAL ZERO                           
                           MOVE SPACES                                          
                                     TO  ADCSCLO                                
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
           MOVE MB135-NSD-YY         TO  ADCNSYYO.                              
           MOVE MB135-NSD-MM         TO  ADCNSMMO.                              
           MOVE MB135-NSD-DD         TO  ADCNSDDO.                              
                                                                                
           MOVE MB135-NED-YY         TO  ADCNEYYO.                              
           MOVE MB135-NED-MM         TO  ADCNEMMO.                              
           MOVE MB135-NED-DD         TO  ADCNEDDO.                              
                                                                                
           MOVE MB135-NSD-ATTR       TO  ADCNSMMA                               
                                         ADCNSDDA                               
                                         ADCNSYYA.                              
           MOVE MB135-NSD-COLOR      TO  ADCNSMMC                               
                                         ADCNSDDC                               
                                         ADCNSYYC.                              
           MOVE MB135-NSD-HILIGHT    TO  ADCNSMMH                               
                                         ADCNSDDH                               
                                         ADCNSYYH.                              
           MOVE MB135-NED-ATTR       TO  ADCNEMMA                               
                                         ADCNEDDA                               
                                         ADCNEYYA.                              
           MOVE MB135-NED-COLOR      TO  ADCNEMMC                               
                                         ADCNEDDC                               
                                         ADCNEYYC.                              
           MOVE MB135-NED-HILIGHT    TO  ADCNEMMH                               
                                         ADCNEDDH                               
                                         ADCNEYYH.                              
           MOVE PC-COMPANY           TO  AOPERCOO.                              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    VALIDATION HAS BEEN PASSED.  NOW, EITHER WRITE OR UPDATE             
      *    THE APPROPRIATE VSAM BATCH PARAMETER RECORD.                         
      *                                                                         
      *    PERFORMED BY 3100                                                    
      ******************************************************************        
      *                                                                         
       3500-ADD-PROCESS.                                                        
      *                                                                         
           IF  PS-REALIGNMENT                                                   
               PERFORM 3510-BUILD-MBKUT007                                      
               PERFORM 3540-WRITE-RECORD                                        
           ELSE                                                                 
               IF  PS-BUYER-CHANGE                                              
                   PERFORM 3520-BUILD-MBKUT006                                  
                   PERFORM 3540-WRITE-RECORD                                    
               ELSE                                                             
                   PERFORM 3530-BUILD-MBKUT008                                  
                   IF  PS-WRITE-008                                             
                       PERFORM 3540-WRITE-RECORD                                
                   ELSE                                                         
                       MOVE PC-TSYMSG-00046                                     
                                     TO  DP020-MSG-NUMBER                       
                       SET DP020-MSG-WARNING                                    
                                     TO  TRUE                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    BUILD THE REALIGNMENT BATCH CONTROL RECORD HERE.                     
      *                                                                         
      *    PERFORMED BY 3500                                                    
      ******************************************************************        
      *                                                                         
       3510-BUILD-MBKUT007.                                                     
      *                                                                         
           MOVE LOW-VALUES           TO  MB018-BATCH-CNTL-RECORD.               
           SET MB018-MBS-REALIGNMENT TO  TRUE.                                  
           MOVE PC-COMPANY           TO  MB018-OPERATING-CO-007.                
           MOVE MB135-OLD-DATA       TO  MB018-OLD-MERCH-AREA-007.              
           MOVE MB135-NEW-DATA       TO  MB018-NEW-MERCH-AREA-007.              
           MOVE MB135-NEW-BUYER1     TO  MB018-NEW-BUYER-NUMBER-007.            
           MOVE PV-DB2-DATE          TO  MB018-NEW-START-DATE-007.              
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    BUILD THE BUYER CHANGE BATCH CONTROL RECORD HERE.                    
      *                                                                         
      *    PERFORMED BY 3500                                                    
      ******************************************************************        
      *                                                                         
       3520-BUILD-MBKUT006.                                                     
      *                                                                         
           MOVE LOW-VALUES           TO  MB018-BATCH-CNTL-RECORD.               
           SET MB018-ASSIGN-BUYER-NUMBER                                        
                                     TO  TRUE                                   
           MOVE PC-COMPANY           TO  MB018-OPERATING-CO-006.                
           MOVE MB135-DEPARTMENT     TO  MB018-DEPARTMENT-NUMBER-006.           
           MOVE MB135-NEW-BUYER2     TO  MB018-NEW-BUYER-NUMBER-006.            
           MOVE MB135-BD-CC          TO  PV-DD-CC.                              
           MOVE MB135-BD-YY          TO  PV-DD-YY.                              
           MOVE MB135-BD-MM          TO  PV-DD-MM.                              
           MOVE MB135-BD-DD          TO  PV-DD-DD.                              
           SET PV-DD-DASH1           TO  TRUE.                                  
           SET PV-DD-DASH2           TO  TRUE.                                  
           MOVE PV-DB2-DATE          TO  MB018-NEW-BUYER-DATE-006.              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    BUILD THE BUYER CHANGE BATCH CONTROL RECORD HERE.                    
      *                                                                         
      *    PERFORMED BY 3500                                                    
      ******************************************************************        
      *                                                                         
       3530-BUILD-MBKUT008.                                                     
                                                                                
           MOVE LOW-VALUES           TO  MB018-BATCH-CNTL-RECORD.               
           SET MB018-MBS-DATE-CHANGE TO  TRUE.                                  
           MOVE PC-COMPANY           TO  MB018-OPERATING-CO-008.                
           SET PV-DD-DASH1           TO  TRUE.                                  
           SET PV-DD-DASH2           TO  TRUE.                                  
                                                                                
           MOVE MB135-DC-GMA         TO  MB018-GMA-008.                         
           MOVE MB135-DC-DMA         TO  MB018-DMA-008.                         
           MOVE MB135-DC-DEPT        TO  MB018-DEPT-008.                        
           MOVE MB135-DC-MAJ-CL      TO  MB018-MAJ-CL-008.                      
           MOVE MB135-DC-SUB-CL      TO  MB018-SUB-CL-008.                      
                                                                                
           IF  MB135-NEW-START-DATE-YMD GREATER THAN SPACES                     
               MOVE MB135-NSD-CC     TO  PV-DD-CC                               
               MOVE MB135-NSD-YY     TO  PV-DD-YY                               
               MOVE MB135-NSD-MM     TO  PV-DD-MM                               
               MOVE MB135-NSD-DD     TO  PV-DD-DD                               
                                                                                
               IF  PV-DB2-DATE NOT EQUAL MB135-MDSEAR-STRT-DTE                  
                   SET PS-WRITE-008  TO  TRUE                                   
                   MOVE PV-DB2-DATE  TO  MB018-NEW-START-DATE-008               
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MB135-NEW-END-DATE-YMD GREATER THAN SPACES                       
               MOVE MB135-NED-CC     TO  PV-DD-CC                               
               MOVE MB135-NED-YY     TO  PV-DD-YY                               
               MOVE MB135-NED-MM     TO  PV-DD-MM                               
               MOVE MB135-NED-DD     TO  PV-DD-DD                               
                                                                                
               IF  PV-DB2-DATE NOT EQUAL MB135-MDSEAR-END-DTE                   
                   SET PS-WRITE-008  TO  TRUE                                   
                   MOVE PV-DB2-DATE  TO  MB018-NEW-END-DATE-008                 
               END-IF                                                           
           ELSE                                                                 
               IF  MB135-MDSEAR-END-DTE NOT EQUAL PC-NINES-DATE                 
                   SET PS-WRITE-008  TO  TRUE                                   
                   MOVE PC-NINES-DATE                                           
                                     TO  MB018-NEW-END-DATE-008                 
               END-IF                                                           
           END-IF.                                                              
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    WRITE OR REWRITE THE BATCH CONTROL RECORD HERE.                      
      *                                                                         
      *    PERFORMED BY 3500                                                    
      ******************************************************************        
      *                                                                         
       3540-WRITE-RECORD.                                                       
                                                                                
           MOVE MB018-BATCH-CNTL-RECORD                                         
                                     TO  PV-BATCH-CNTL-RECORD.                  
                                                                                
           PERFORM 2150-READ-BATCH-CONTROL.                                     
           IF  PV-RESP EQUAL DFHRESP(NORMAL)                                    
               MOVE PV-BATCH-CNTL-RECORD                                        
                                     TO  MB018-BATCH-CNTL-RECORD                
               PERFORM 2160-UPDATE-BATCH-CONTROL                                
           ELSE                                                                 
               PERFORM 2170-WRITE-BATCH-CONTROL                                 
           END-IF.                                                              
                                                                                
           SET DP020-MSG-INFORMATIONAL                                          
                                     TO  TRUE.                                  
           IF  NOT MB005-DATE-UPDATE                                            
               MOVE LOW-VALUE        TO  MB135-SCREEN-DATA                      
           END-IF.                                                              
                                                                                
           PERFORM 3400-MOVE-COMMAREA-TO-SCREEN.                                
                                                                                
       EJECT                                                                    
      ******************************************************************        
      *    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER             
      *    TRANSACTION, SAVE THE INTER APPLICATION COMMUNICATIONS AREA          
      *    AND START THE NAVIGATOR.                                             
      *                                                                         
      *    PERFORMED BY 3000                                                    
      ******************************************************************        
      *                                                                         
       4000-NAVIGATE.                                                           
      *                                                                         
           MOVE MB005-INTER-APPL-COMMAREA                                       
                                     TO  MB135-SAVE-INTER-APPL-COMMAREA.        
           PERFORM DP015-1000-START-NAVIGATOR.                                  
      *                                                                         
       EJECT                                                                    
      ******************************************************************        
      *    FILL IN SCREEN HEADER MODULE                                         
      ******************************************************************        
                                                                                
           COPY DPPD002.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    RETURN TO CICS MODULE                                                
      ******************************************************************        
                                                                                
           COPY DPPD003.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    FORMAT MESSAGE LINES MODULE                                          
      ******************************************************************        
                                                                                
           COPY DPPD005.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    GET PANEL MODULE                                                     
      ******************************************************************        
                                                                                
           COPY DPPD007.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    WRITE PANEL MODULE                                                   
      ******************************************************************        
                                                                                
           COPY DPPD008.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    TOGGLE THE FUNCTION KEY LINE MODULE                                  
      ******************************************************************        
                                                                                
           COPY DPPD009.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    ABEND PROCESSOR MODULE                                               
      ******************************************************************        
                                                                                
           COPY DPPD013.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    CHECK COMMUNICATION AREA MODULE                                      
      ******************************************************************        
                                                                                
           COPY DPPD015.                                                        
       EJECT                                                                    
      ******************************************************************        
      *    UPDATE TIME AND DATE MODULE                                          
      ******************************************************************        
                                                                                
           COPY DPPD017.                                                        
       EJECT                                                                    
