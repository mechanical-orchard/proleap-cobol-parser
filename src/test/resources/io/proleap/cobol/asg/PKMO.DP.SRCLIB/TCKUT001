      ***************************************************************** 00010005
       IDENTIFICATION DIVISION.                                         00020005
      ***************************************************************** 00030005
                                                                        00040005
       PROGRAM-ID.            TCKUT001.                                 00050005
       AUTHOR.                ROBERTA DEBARTOLO                         00060005
       INSTALLATION.          KOHLS DEPARTMENT STORES.                  00070005
       DATE-WRITTEN.          FEBRUARY 2002.                            00080005
       DATE-COMPILED.                                                   00090005
      ******************************************************************00100005
      *                                                                *00110005
      *  THIS PROGRAM READS IN THE MERCHANT ACTIVITY FILE FROM 5/3RD   *00120005
      *  BANK AND CREATES A NEW SEQUENTIAL FILE CONTAINING ONLY DEBIT  *00130005
      *  TRANSACTIONS.  IT ALSO CALCULATES TOTALS AND VERIFIES THEM    *00140005
      *  AGAINST THE TOTALS IN THE TRAILER RECORD ON THE MERCHANT      *00150005
      *  ACTIVITY FILE FROM 5/3RD BANK AND WRITES THESE TOTALS OUT TO  *00160005
      *  A DAILY TOTALS REPORT.                                        *00170005
      ******************************************************************00180005
      *----------------------------------------------------------------*00190005
      *  REVISIONS: ADDED THE MULTIPLE STORE TOTALS TOGETHER TO CREATE *00200005
      *  ONE LINE PER STORE.                                           *00210005
      *  DATE: 04/04/2002                                              *00220005
      *  BY BARB SCHULTZ                                               *00230005
      *----------------------------------------------------------------*00240005
W3540C* MODIFICATION LOG                                               *00250005
W3540C* ------------ ---                                               *00260005
W3540C*                                                                *00270005
W3540C*   REQUIREMENT  : PAYMENT RELATED CHANGES FOR FSH PROJECT       *00280005
W3540C*                  DEBIT SETTLEMENT PROCESS                      *00290005
W3540C*   PROJECT ID   : W3540C                                        *00300005
W3540C*   AUTHOR       : COGNIZANT                                     *00310005
W3540C*   DATE CHANGED : 18-OCT-2012                                   *00320014
W3540C*   CHANGES MADE :                                               *00330005
W3540C*                  NEW CONTROL CARD TCCC028 IS INTRODUCED IN THIS*00340005
W3540C*                  PROGRAM. THIS INPUT WILL BE THE NEXT POS DATE *00350005
W3540C*                  PER THE SYSTEM VARIABLES. THE CORRESPONDING   *00360005
W3540C*                  CHANGES ARE HANDLED IN THIS PROGRAM. THIS     *00370007
W3540C*                  DATE ARE USED TO DETERMINE THE SALES DATE.    *00380007
W3540C*----------------------------------------------------------------*00381007
      ******************************************************************00390005
       ENVIRONMENT DIVISION.                                            00400005
      *                                                                 00410005
      *                                                                 00420005
       CONFIGURATION SECTION.                                           00430005
       SOURCE-COMPUTER. IBM-3090.                                       00440005
       OBJECT-COMPUTER. IBM-3090.                                       00450005
      *                                                                 00460005
      *                                                                 00470005
       INPUT-OUTPUT SECTION.                                            00480005
       FILE-CONTROL.                                                    00490005
                                                                        00500005
           SELECT POS-DATE-CARD-FILE                                    00510005
               ASSIGN                       TO INP01.                   00520005
                                                                        00530005
           SELECT DEBIT-IN-FILE                                         00540005
               ASSIGN                       TO INP02.                   00550005
                                                                        00560005
W3540C     SELECT NXT-POS-DATE-CARD-FILE                                00570015
W3540C         ASSIGN                       TO INP03.                   00580005
W3540C                                                                  00590005
           SELECT DEBIT-OUT-FILE                                        00600005
               ASSIGN                       TO OUT01.                   00610005
                                                                        00620005
           SELECT DEBIT-DENIED-FILE                                     00630005
               ASSIGN                       TO OUT02.                   00640005
                                                                        00650005
           SELECT DEBIT-DAILY-TOTALS-FILE                               00660005
               ASSIGN                       TO RPT01.                   00670005
                                                                        00680005
       EJECT                                                            00690005
      *                                                                 00700005
      ***************                                                   00710005
       DATA DIVISION.                                                   00720005
      ***************                                                   00730005
      *                                                                 00740005
       FILE SECTION.                                                    00750005
      *                                                                 00760005
       FD  POS-DATE-CARD-FILE                                           00770005
           RECORDING MODE IS F                                          00780005
           BLOCK CONTAINS 0 RECORDS                                     00790005
           LABEL RECORDS ARE STANDARD.                                  00800005
                                                                        00810005
       01  POS-DATE-CARD-RECORD            PIC X(80).                   00820005
                                                                        00830005
       FD  DEBIT-IN-FILE                                                00840005
           RECORDING MODE IS F                                          00850005
           LABEL RECORDS ARE STANDARD                                   00860005
           BLOCK CONTAINS 0 RECORDS                                     00870005
           RECORD CONTAINS 80 CHARACTERS                                00880005
           DATA RECORD IS TC-DEBIT-IN-FILE.                             00890005
                                                                        00900005
       01  TC-DEBIT-IN-FILE           PIC X(80).                        00910005
                                                                        00920005
W3540C*                                                                 00930005
W3540C FD  NXT-POS-DATE-CARD-FILE                                       00940015
W3540C     RECORDING MODE IS F                                          00950005
W3540C     BLOCK CONTAINS 0 RECORDS                                     00960005
W3540C     LABEL RECORDS ARE STANDARD.                                  00970005
W3540C                                                                  00980005
W3540C 01  NXT-POS-DATE-CARD-RECORD   PIC X(80).                        00990015
      *                                                                 01000005
       FD  DEBIT-OUT-FILE                                               01010005
           RECORDING MODE IS F                                          01020005
           LABEL RECORDS ARE STANDARD                                   01030005
           BLOCK CONTAINS 0 RECORDS                                     01040005
           RECORD CONTAINS 80 CHARACTERS                                01050005
           DATA RECORD IS TC-DEBIT-OUT-FILE.                            01060005
                                                                        01070005
       01  TC-DEBIT-OUT-FILE           PIC X(80).                       01080005
                                                                        01090005
       FD  DEBIT-DENIED-FILE                                            01100005
           RECORDING MODE IS F                                          01110005
           LABEL RECORDS ARE STANDARD                                   01120005
           BLOCK CONTAINS 0 RECORDS                                     01130005
           RECORD CONTAINS 80 CHARACTERS                                01140005
           DATA RECORD IS TC-DEBIT-DENIED-FILE.                         01150005
                                                                        01160005
       01  TC-DEBIT-DENIED-FILE        PIC X(80).                       01170005
                                                                        01180005
       FD  DEBIT-DAILY-TOTALS-FILE                                      01190005
           RECORDING MODE IS F                                          01200005
           BLOCK CONTAINS 0  RECORDS.                                   01210005
                                                                        01220005
       01  DEBIT-DAILY-TOTALS-RECORD     PIC  X(200).                   01230005
                                                                        01240005
      *                                                                 01250005
           EJECT                                                        01260005
      ******************************************************************01270005
       WORKING-STORAGE SECTION.                                         01280005
      ******************************************************************01290005
      * RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                   *01300005
      ******************************************************************01310005
       01  CC-CONTROL-CARD.                                             01320005
           05  CC-CONTROL-CARD-DISPLAY.                                 01330005
               10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        01340005
                   88  CC-DATE-CONTROL-NAME         VALUE               01350005
                       'P.O.S. DATE = '.                                01360005
               10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         01370005
           05  FILLER                  PIC X(60)    VALUE SPACE.        01380005
                                                                        01390005
W3540C******************************************************************01400005
W3540C* RECORD LAYOUT FOR INPUT DATE CARD (POS NEXT DATE)              *01410005
W3540C******************************************************************01420005
W3540C 01  CC-CONTROL-CARD-INP03.                                       01430005
W3540C     05  CC-CONTROL-CARD-DISP-INP03.                              01440005
W3540C         10  CC-CONTROL-NAME-INP03  PIC X(19)    VALUE SPACE.     01450005
W3540C             88  CC-DATE-CONTROL-NAME-INP03      VALUE            01460005
W3540C                 'NEXT P.O.S. DATE = '.                           01470005
W3540C         10  CC-NXT-POS-DATE        PIC 9(08)    VALUE ZERO.      01480015
W3540C     05  FILLER                     PIC X(53)    VALUE SPACE.     01490005
                                                                        01500005
       01  AC-ABEND-CODE                      PIC S9(04) VALUE +4003.   01510005
                                                                        01520005
       01  PA-ACCUMULATORS.                                             01530005
           05  PA-PAGE-CNT                 PIC S9(05)    VALUE ZERO.    01540005
           05  PA-LINE-CNT                 PIC S9(03)    VALUE ZERO.    01550005
                                                                        01560005
       01  PC-PROGRAM-CONSTANTS.                                        01570005
           05  PC-CURRENT-PROGRAM-NAME      PIC X(08)     VALUE         01580005
                                                         'TCKUT001'.    01590005
           05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     01600005
           05  PC-DEFAULT-SPACES           PIC X(10)     VALUE SPACES.  01610005
009200     05  PC-ABEND-MSG                 PIC X(12)      VALUE        01620005
009300         '** ABEND ** '.                                          01630005
009400     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        01640005
009500         'DB2 ERROR'.                                             01650005
009600     05  PC-DB-ATTEMPTING-MSG         PIC X(14)      VALUE        01660005
009700         'ATTEMPTING TO '.                                        01670005
                                                                        01680005
       01 PS-PROGRAM-SWITCHES.                                          01690005
                                                                        01700005
           05  PS-END-OF-DEBIT-FILE-SW       PIC X(01) VALUE 'N'.       01710005
               88  PS-END-OF-DEBIT-FILE                VALUE 'Y'.       01720005
               88  PS-NOT-END-OF-DEBIT-FILE            VALUE 'N'.       01730005
           05  PS-END-OF-DATE-FILE-SW        PIC X(01) VALUE 'N'.       01740005
               88  PS-END-OF-DATE-FILE                 VALUE 'Y'.       01750005
               88  PS-NOT-END-OF-DATE-FILE             VALUE 'N'.       01760005
W3540C     05  PS-END-OF-NXT-DATE-FILE-SW    PIC X(01) VALUE 'N'.       01770005
W3540C         88  PS-END-OF-NXT-DATE-FILE             VALUE 'Y'.       01780005
W3540C         88  PS-NOT-END-OF-NXT-DATE-FILE         VALUE 'N'.       01790005
           05  PS-FIRST-TIME-THRU-SW         PIC X(01) VALUE 'Y'.       01800005
               88  PS-FIRST-TIME-THRU                  VALUE 'Y'.       01810005
               88  PS-NOT-FIRST-TIME-THRU              VALUE 'N'.       01820005
           05  PS-STORE-BREAK-SW             PIC X(01) VALUE 'N'.       01830005
               88  PS-STORE-BREAK                      VALUE 'Y'.       01840005
               88  PS-NO-STORE-BREAK                   VALUE 'N'.       01850005
                                                                        01860005
       01 PV-PROGRAM-VARIABLES.                                         01870005
                                                                        01880005
           05  PV-SALE-TRAN                PIC X(02) VALUE '05'.        01890005
           05  PV-RETURN-TRAN              PIC X(02) VALUE '06'.        01900005
           05  PV-TRAN-COMPLETE            PIC X(01) VALUE '3'.         01910005
           05  PV-TRAN-DENIED              PIC X(01) VALUE '2'.         01920005
           05  PV-TRAN-CANCEL              PIC X(01) VALUE '4'.         01930005
           05  PV-MERCHANT-NBR             PIC X(15).                   01940005
           05  FILLER                   REDEFINES  PV-MERCHANT-NBR.     01950005
               10 PV-MERCH-FILLER          PIC  X(03).                  01960005
               10 PV-MERCH-STORE-NBR       PIC  X(04).                  01970005
               10 PV-MERCH-FILLER-2        PIC  X(04).                  01980005
               10 PV-MERCH-REG-NBR         PIC  X(04).                  01990005
           05  PV-SAVE-STR                 PIC 9(04)    VALUE ZEROES.   02000005
           05  PV-SAVE-STORE               PIC S9(04)   VALUE ZEROES    02010005
                                                        COMP.           02020005
012900     05  PV-STORE-NBR.                                            02030005
012900         10 PV-STORE-ZERO               PIC X.                    02040005
012900         10 PV-STORE-3                  PIC X(03).                02050005
           05  PV-TOTAL-BATCH-CTR          PIC 9(11)    VALUE ZEROES.   02060005
           05  PV-TOTAL-DEBIT-TRANS        PIC 9(11)    VALUE ZEROES.   02070005
           05  PV-TOTAL-DEBIT-TRANS        PIC 9(11)    VALUE ZEROES.   02080005
           05  PV-TOT-FILE-DOL-DEBIT-TRANS PIC S9(11)V99 VALUE ZEROES.  02090005
           05  PV-TOT-DEBIT-DOL-DEBIT-TRANS PIC S9(11)V99 VALUE ZEROES. 02100005
           05  PV-BT-TOTAL-SALES           PIC 9(11)V99 VALUE ZEROES.   02110005
           05  PV-BT-DENIED-SALES          PIC 9(11)V99 VALUE ZEROES.   02120005
           05  PV-BT-RETURN-SALES          PIC 9(11)V99 VALUE ZEROES.   02130005
           05  PV-BT-RETURN-DENIED-SALES   PIC 9(11)V99 VALUE ZEROES.   02140005
           05  PV-BT-RETURN-CANCEL-SALES   PIC 9(11)V99 VALUE ZEROES.   02150005
           05  PV-BT-CANCEL-SALES          PIC 9(11)V99 VALUE ZEROES.   02160005
           05  PV-BT-TOTAL-TRANS           PIC 9(11)    VALUE ZEROES.   02170005
           05  PV-BT-DENIED-TRANS          PIC 9(11)    VALUE ZEROES.   02180005
           05  PV-BT-RETURN-TRANS          PIC 9(11)    VALUE ZEROES.   02190005
           05  PV-BT-RETURN-DENIED-TRANS   PIC 9(11)    VALUE ZEROES.   02200005
           05  PV-BT-RETURN-CANCEL-TRANS   PIC 9(11)    VALUE ZEROES.   02210005
           05  PV-BT-CANCEL-TRANS          PIC 9(11)    VALUE ZEROES.   02220005
           05  PV-D1-TOTAL-SALES           PIC 9(11)V99 VALUE ZEROES.   02230005
           05  PV-D1-DENIED-SALES          PIC 9(11)V99 VALUE ZEROES.   02240005
           05  PV-D1-RETURN-SALES          PIC 9(11)V99 VALUE ZEROES.   02250005
           05  PV-D1-RETURN-DENIED-SALES   PIC 9(11)V99 VALUE ZEROES.   02260005
           05  PV-D1-RETURN-CANCEL-SALES   PIC 9(11)V99 VALUE ZEROES.   02270005
           05  PV-D1-CANCEL-SALES          PIC 9(11)V99 VALUE ZEROES.   02280005
           05  PV-D1-TOTAL-TRANS           PIC 9(11)    VALUE ZEROES.   02290005
           05  PV-D1-DENIED-TRANS          PIC 9(11)    VALUE ZEROES.   02300005
           05  PV-D1-RETURN-TRANS          PIC 9(11)    VALUE ZEROES.   02310005
           05  PV-D1-RETURN-DENIED-TRANS   PIC 9(11)    VALUE ZEROES.   02320005
           05  PV-D1-RETURN-CANCEL-TRANS   PIC 9(11)    VALUE ZEROES.   02330005
           05  PV-D1-CANCEL-TRANS          PIC 9(11)    VALUE ZEROES.   02340005
           05  PV-D2-TOTAL-COMPLETE-SALES  PIC 9(11)V99 VALUE ZEROES.   02350005
           05  PV-D2-TOTAL-DENIED-SALES    PIC 9(11)V99 VALUE ZEROES.   02360005
           05  PV-D2-TOTAL-RETURNED-SALES  PIC 9(11)V99 VALUE ZEROES.   02370005
           05  PV-D2-TOTAL-RET-DENIED-SALE PIC 9(11)V99 VALUE ZEROES.   02380005
           05  PV-D2-TOTAL-RET-CANCEL-SALE PIC 9(11)V99 VALUE ZEROES.   02390005
           05  PV-D2-TOTAL-CANCEL-SALES    PIC 9(11)V99 VALUE ZEROES.   02400005
           05  PV-D2-TOTAL-COMPLETE-TRANS  PIC 9(11)    VALUE ZEROES.   02410005
           05  PV-D2-TOTAL-DENIED-TRANS    PIC 9(11)    VALUE ZEROES.   02420005
           05  PV-D2-TOTAL-RETURNED-TRANS  PIC 9(11)    VALUE ZEROES.   02430005
           05  PV-D2-TOTAL-RET-DENIED-TRAN PIC 9(11)    VALUE ZEROES.   02440005
           05  PV-D2-TOTAL-RET-CANCEL-TRAN PIC 9(11)    VALUE ZEROES.   02450005
           05  PV-D2-TOTAL-CANCEL-TRANS    PIC 9(11)    VALUE ZEROES.   02460005
           05  PV-D2-TOTAL-CORP-TRANS      PIC 9(11)    VALUE ZEROES.   02470005
           05  PV-READ-CNT                 PIC 9(11)    VALUE ZEROES.   02480005
           05  PV-WRITE-CNT                PIC 9(11)    VALUE ZEROES.   02490005
           05  PV-WRITE-DENY-CNT           PIC 9(11)    VALUE ZEROES.   02500005
           05  PV-RECORD-SKIPPED           PIC 9(11)    VALUE ZEROES.   02510005
           05  PV-DISPLAY-CNT              PIC ZZZ,ZZZ,ZZZ,ZZ9.         02520005
           05  PV-PARAGRAPH-NAME           PIC  X(30) VALUE SPACE.      02530005
           05  PV-OPERATION-MSG-1          PIC  X(40) VALUE SPACE.      02540005
           05  PV-OPERATION-MSG-2          PIC  X(40) VALUE SPACE.      02550005
           05  PV-PRINT-RECORD             PIC X(200) VALUE SPACE.      02560005
           05  PV-LINE-SPACING             PIC S9(04) VALUE ZERO.       02570005
011200     05  PV-DB2-ERROR-MSG            PIC X(40)      VALUE SPACE.  02580005
                                                                        02590005
011400 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 02600005
011500     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 02610005
                                                                        02620005
      ******************************************************************02630005
      *   DATE AND TIME FIELDS.                                        *02640005
      ******************************************************************02650005
       01  PV-DATE-AND-TIME-FIELDS.                                     02660005
           05  PV-POS-CCYY-MM-DD           PIC X(10)     VALUE SPACE.   02670005
           05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      02680005
               10  PV-POS-CCYY             PIC X(04).                   02690005
               10  FILLER                  PIC X(01).                   02700005
               10  PV-POS-MM               PIC X(02).                   02710005
               10  FILLER                  PIC X(01).                   02720005
               10  PV-POS-DD               PIC X(02).                   02730005
           05  PV-POS-DATE-CCYYMMDD.                                    02740005
               10  PV-POS-DATE-CCYY        PIC  9(04).                  02750005
               10  PV-POS-DATE-MM          PIC  9(02).                  02760005
               10  PV-POS-DATE-DD          PIC  9(02).                  02770005
           05  PV-TRN-DATE-CCYYMMDD.                                    02780005
               10  PV-TRN-DATE-CCYY        PIC  9(04).                  02790005
               10  PV-TRN-DATE-MMDD        PIC  9(04).                  02800005
           05  PV-CURR-DATE-CCYYMMDD.                                   02810005
               10  PV-CURR-DATE-CCYY       PIC  9(04).                  02820005
               10  PV-CURR-DATE-MM         PIC  9(02).                  02830005
               10  PV-CURR-DATE-DD         PIC  9(02).                  02840005
           05  PV-CURR-TIME.                                            02850005
               10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    02860005
               10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    02870005
               10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    02880005
W3540C     05  PV-NEXT-POS-CCYY-MM-DD      PIC X(10)     VALUE SPACE.   02881017
W3540C     05  FILLER REDEFINES PV-NEXT-POS-CCYY-MM-DD.                 02882017
W3540C         10  PV-NEXT-POS-CCYY        PIC X(04).                   02883017
W3540C         10  FILLER                  PIC X(01).                   02884017
W3540C         10  PV-NEXT-POS-MM          PIC X(02).                   02885017
W3540C         10  FILLER                  PIC X(01).                   02886017
W3540C         10  PV-NEXT-POS-DD          PIC X(02).                   02887017
W3540C     05  PV-NXT-POS-DTE.                                          02890015
W3540C         10  PV-NXT-POS-CCYY         PIC  9(04).                  02900015
W3540C         10  PV-NXT-POS-MM           PIC  9(02).                  02910015
W3540C         10  PV-NXT-POS-DD           PIC  9(02).                  02920015
                                                                        02930005
      ******************************************************************02940005
      *  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT. *02950005
      ******************************************************************02960005
           COPY DPWS200.                                                02970005
      ******************************************************************02980005
012900*    STANDARD DB2 ERROR HANDLING AREA                            *02990005
013000*----------------------------------------------------------------*03000005
013100     COPY DPWS004.                                                03010005
013200*----------------------------------------------------------------*03020005
013300*    LOCATION DOMAIN TABLE                                       *03030005
013400*----------------------------------------------------------------*03040005
013500     EXEC SQL                                                     03050005
013600         INCLUDE XST00001                                         03060005
013700     END-EXEC.                                                    03070005
015600*----------------------------------------------------------------*03080005
015700*    STANDARD DB2 COMMUNICATIONS AREA                            *03090005
015800*----------------------------------------------------------------*03100005
015900     EXEC SQL                                                     03110005
016000         INCLUDE SQLCA                                            03120005
016100     END-EXEC.                                                    03130005
      ******************************************************************03140005
      *  HEADING LINES DAILY DEBIT CARD AUDIT REPORT.                  *03150005
      ******************************************************************03160005
       01  H1-TITLE-HEADING.                                            03170005
           05  FILLER                      PIC  X(82)    VALUE SPACES.  03180005
           05  H1-TITLE                    PIC  X(27)    VALUE          03190005
               'DAILY DEBIT MAF TOTALS FOR '.                           03200005
           05  H1-PROCESS-DTE.                                          03210005
               10  H1-MM                   PIC  X(02)    VALUE SPACES.  03220005
               10  FILLER                  PIC  X(01)    VALUE '/'.     03230005
               10  H1-DD                   PIC  X(02)    VALUE SPACES.  03240005
               10  FILLER                  PIC  X(01)    VALUE '/'.     03250005
               10  H1-CCYY                 PIC  X(04)    VALUE SPACES.  03260005
           05  FILLER                      PIC  X(81)    VALUE SPACES.  03270005
                                                                        03280005
       01  H2-COLUMN-HEADING.                                           03290005
           05  FILLER                      PIC  X(24)    VALUE SPACES.  03300005
           05  FILLER                      PIC  X(15)    VALUE          03310005
               'COMPLETED SALES'.                                       03320005
           05  FILLER                      PIC  X(18)    VALUE SPACES.  03330005
           05  FILLER                      PIC  X(12)    VALUE          03340005
               'DENIED SALES'.                                          03350005
           05  FILLER                      PIC  X(17)    VALUE SPACES.  03360005
           05  FILLER                      PIC  X(15)    VALUE          03370005
               'CANCELLED SALES'.                                       03380005
           05  FILLER                      PIC  X(15)    VALUE SPACES.  03390005
           05  FILLER                      PIC  X(17)    VALUE          03400005
               'COMPLETED RETURNS'.                                     03410005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03420005
           05  FILLER                      PIC  X(14)    VALUE          03430005
               'DENIED RETURNS'.                                        03440005
           05  FILLER                      PIC  X(15)    VALUE SPACES.  03450005
           05  FILLER                      PIC  X(17)    VALUE          03460005
               'CANCELLED RETURNS'.                                     03470005
           05  FILLER                      PIC  X(05)    VALUE SPACES.  03480005
                                                                        03490005
       01  H3-COLUMN-HEADING.                                           03500005
           05  FILLER                      PIC  X(03)    VALUE SPACES.  03510005
           05  FILLER                      PIC  X(05)    VALUE          03520005
               'STORE'.                                                 03530005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03540005
           05  FILLER                      PIC  X(03)    VALUE          03550005
               'AMT'.                                                   03560005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  03570005
           05  FILLER                      PIC  X(10)    VALUE          03580005
               '# OF TRANS'.                                            03590005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03600005
           05  FILLER                      PIC  X(03)    VALUE          03610005
               'AMT'.                                                   03620005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  03630005
           05  FILLER                      PIC  X(10)    VALUE          03640005
               '# OF TRANS'.                                            03650005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03660005
           05  FILLER                      PIC  X(03)    VALUE          03670005
               'AMT'.                                                   03680005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  03690005
           05  FILLER                      PIC  X(10)    VALUE          03700005
               '# OF TRANS'.                                            03710005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03720005
           05  FILLER                      PIC  X(03)    VALUE          03730005
               'AMT'.                                                   03740005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  03750005
           05  FILLER                      PIC  X(10)    VALUE          03760005
               '# OF TRANS'.                                            03770005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03780005
           05  FILLER                      PIC  X(03)    VALUE          03790005
               'AMT'.                                                   03800005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  03810005
           05  FILLER                      PIC  X(10)    VALUE          03820005
               '# OF TRANS'.                                            03830005
           05  FILLER                      PIC  X(16)    VALUE SPACES.  03840005
           05  FILLER                      PIC  X(03)    VALUE          03850005
               'AMT'.                                                   03860005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  03870005
           05  FILLER                      PIC  X(10)    VALUE          03880005
               '# OF TRANS'.                                            03890005
           05  FILLER                      PIC  X(06)    VALUE SPACES.  03900005
                                                                        03910005
      ******************************************************************03920005
      *  DETAIL LINE.                                                   03930005
      ******************************************************************03940005
       01  D1-DETAIL-STORE.                                             03950005
           05  FILLER                      PIC  X(04)    VALUE SPACES.  03960005
           05  D1-STR-NBR                  PIC  X(04).                  03970005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  03980005
           05  D1-COMPLETE-AMT             PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     03990005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  04000005
           05  D1-COMPLETE-NBR-TRANS       PIC  ZZ,ZZZ,ZZ9 VALUE ZERO.  04010005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04020005
           05  D1-DENIED-AMT               PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04030005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  04040005
           05  D1-DENIED-TRANS             PIC  ZZ,ZZZ,ZZ9 VALUE ZERO.  04050005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04060005
           05  D1-CANCEL-AMT               PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04070005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  04080005
           05  D1-CANCEL-TRANS             PIC  ZZ,ZZZ,ZZ9 VALUE ZERO.  04090005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04100005
           05  D1-RETURN-AMT               PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04110005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  04120005
           05  D1-RETURN-TRANS             PIC  ZZ,ZZZ,ZZ9 VALUE ZERO.  04130005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04140005
           05  D1-RETURN-DENIED-AMT        PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04150005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  04160005
           05  D1-RETURN-DENIED-TRANS      PIC  ZZ,ZZZ,ZZ9 VALUE ZERO.  04170005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04180005
           05  D1-RETURN-CANCEL-AMT        PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04190005
           05  FILLER                      PIC  X(02)    VALUE SPACES.  04200005
           05  D1-RETURN-CANCEL-TRANS      PIC  ZZ,ZZZ,ZZ9 VALUE ZERO.  04210005
           05  FILLER                      PIC  X(06)    VALUE SPACES.  04220005
                                                                        04230005
       01  D2-TOTAL-CORP.                                               04240005
           05  FILLER                      PIC  X(04).                  04250005
           05  FILLER                      PIC  X(04)    VALUE          04260005
               'CORP'.                                                  04270005
           05  FILLER                      PIC  X(01).                  04280005
           05  D2-TOTAL-COMPLETE-SALES     PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04290005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04300005
           05  D2-TOTAL-COMPLETE-TRANS     PIC  ZZZ,ZZZ,ZZ9 VALUE ZERO. 04310005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04320005
           05  D2-TOTAL-DENIED-SALES       PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04330005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04340005
           05  D2-TOTAL-DENIED-TRANS       PIC  ZZZ,ZZZ,ZZ9 VALUE ZERO. 04350005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04360005
           05  D2-TOTAL-CANCEL-SALES       PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04370005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04380005
           05  D2-TOTAL-CANCEL-TRANS       PIC  ZZZ,ZZZ,ZZ9 VALUE ZERO. 04390005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04400005
           05  D2-TOTAL-RETURNED-SALES     PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04410005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04420005
           05  D2-TOTAL-RETURNED-TRANS     PIC  ZZZ,ZZZ,ZZ9 VALUE ZERO. 04430005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04440005
           05  D2-TOTAL-RET-DENIED-SALE    PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04450005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04460005
           05  D2-TOTAL-RET-DENIED-TRAN    PIC  ZZZ,ZZZ,ZZ9 VALUE ZERO. 04470005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04480005
           05  D2-TOTAL-RET-CANCEL-SALE    PIC  ZZZ,ZZZ,ZZZ,ZZ9.99.     04490005
           05  FILLER                      PIC  X(01)    VALUE SPACES.  04500005
           05  D2-TOTAL-RET-CANCEL-TRAN    PIC  ZZZ,ZZZ,ZZ9 VALUE ZERO. 04510005
           05  FILLER                      PIC  X(06)    VALUE SPACES.  04520005
                                                                        04530005
      ******************************************************************04540005
      *  END OF REPORT LINE                                             04550005
      ******************************************************************04560005
       01  E1-END-OF-RPT-LINE.                                          04570005
           05  FILLER                      PIC  X(88)    VALUE SPACES.  04580005
           05  FILLER                      PIC  X(24)    VALUE          04590005
               '**** END OF REPORT ****'.                               04600005
           05  FILLER                      PIC  X(88)    VALUE SPACES.  04610005
                                                                        04620005
      *                                                                 04630005
      ****************************************************************  04640005
      * RECORD LAYOUT FOR INCOMING DEBIT FILE                           04650005
      ****************************************************************  04660005
           COPY TCWS001.                                                04670005
      *                                                                 04680005
      ****************************************************************  04690005
      * RECORD LAYOUT FOR OUTGOING DEBIT FILE                           04700005
      ****************************************************************  04710005
           COPY TCWS003.                                                04720005
      ******************************************************************04730005
      *  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)            *04740005
      ******************************************************************04750005
           COPY DPWS500.                                                04760005
                                                                        04770005
      *                                                                 04780005
       EJECT                                                            04790005
      *                                                                 04800005
      ****************************************************************  04810005
       PROCEDURE DIVISION.                                              04820005
      ****************************************************************  04830005
      * 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  04840005
      * PROGRAM.                                                     *  04850005
      ****************************************************************  04860005
                                                                        04870005
       0000-PROGRAM-MAINLINE.                                           04880005
                                                                        04890005
           PERFORM 1000-INITIALIZATION.                                 04900005
                                                                        04910005
           PERFORM 2100-PROCESS-DEBIT-FILE                              04920005
              UNTIL PS-END-OF-DEBIT-FILE.                               04930005
                                                                        04940005
           PERFORM 3000-END-ROUTINE.                                    04950005
                                                                        04960005
           GOBACK.                                                      04970005
                                                                        04980005
           EJECT                                                        04990005
      *                                                                 05000005
      ****************************************************************  05010005
      * 1000-INITIALIZATION OPENS ALL FILES                          *  05020005
      *      READS THE FIRST DEBIT RECORD                            *  05030005
      ****************************************************************  05040005
       1000-INITIALIZATION.                                             05050005
                                                                        05060005
           OPEN   INPUT  DEBIT-IN-FILE.                                 05070005
           OPEN   INPUT  POS-DATE-CARD-FILE.                            05080005
W3540C     OPEN   INPUT  NXT-POS-DATE-CARD-FILE.                        05081015
           OPEN   OUTPUT DEBIT-OUT-FILE.                                05090005
           OPEN   OUTPUT DEBIT-DENIED-FILE.                             05100005
           OPEN   OUTPUT DEBIT-DAILY-TOTALS-FILE.                       05110005
                                                                        05120005
           INITIALIZE D1-DETAIL-STORE.                                  05130005
           INITIALIZE D2-TOTAL-CORP.                                    05140005
           PERFORM 1500-PROCESS-DATE-CARD.                              05150005
W3540C     PERFORM 1600-PROCESS-NEXT-DATE-CARD.                         05160005
W3540C     IF PV-POS-DATE-CCYY > PV-NXT-POS-CCYY                        05161016
W3540C        MOVE '1000-INITIALIZE'          TO PV-PARAGRAPH-NAME      05162112
W3540C        MOVE 'POS DATE > NEXT POS DATE' TO PV-OPERATION-MSG-1     05162212
W3540C        MOVE SPACES                     TO PV-OPERATION-MSG-2     05162312
W3540C        PERFORM 9999-ABEND                                        05162412
W3540C     END-IF.                                                      05163012
           PERFORM 1700-FORMAT-HEADERS.                                 05170005
           PERFORM 2800-WRITE-HEADERS.                                  05180005
           PERFORM 2000-READ-DEBIT-FILE.                                05190005
                                                                        05200005
      ******************************************************************05210005
      * 1500-PROCESS-DATE-CARD                                          05220005
      ******************************************************************05230005
                                                                        05240005
       1500-PROCESS-DATE-CARD.                                          05250005
                                                                        05260005
           READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 05270013
               AT END                                                   05280005
                   SET PS-END-OF-DATE-FILE TO TRUE.                     05290005
                                                                        05300005
           IF PS-END-OF-DATE-FILE                                       05310005
               MOVE '1500-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      05320005
               MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     05330005
               PERFORM 9999-ABEND                                       05340005
           END-IF.                                                      05350005
                                                                        05360005
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05370005
                                                                        05380005
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   05390005
           SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   05400005
           SET  DPG52-LK-DTE-GREG            TO TRUE.                   05410005
           MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    05420005
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05430005
                                                   DPG54 DPG55 DPG56.   05440005
           EVALUATE TRUE                                                05450005
               WHEN DPG54-SEVERE-ERROR                                  05460005
               WHEN DPG54-DATE-INVALID                                  05470005
                   MOVE '1500-PROCESS-DATE-CARD'                        05480005
                                                 TO PV-PARAGRAPH-NAME   05490005
                   MOVE 'ERROR CONVERTING INPUT CARD DATE'              05500005
                                                 TO PV-OPERATION-MSG-1  05510005
                   MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  05520005
                   PERFORM 9999-ABEND                                   05530005
           END-EVALUATE.                                                05540005
                                                                        05550005
           MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      05560005
           MOVE PV-POS-CCYY                  TO PV-POS-DATE-CCYY.       05570005
           MOVE PV-POS-MM                    TO PV-POS-DATE-MM.         05590005
           MOVE PV-POS-DD                    TO PV-POS-DATE-DD.         05600005
                                                                        05610005
W3540C******************************************************************05620005
W3540C* 1600-PROCESS-NEXT-DATE-CARD                                     05630005
W3540C******************************************************************05640005
W3540C                                                                  05650005
W3540C 1600-PROCESS-NEXT-DATE-CARD.                                     05660005
W3540C                                                                  05670005
W3540C     READ NXT-POS-DATE-CARD-FILE INTO CC-CONTROL-CARD-INP03       05680015
W3540C         AT END                                                   05690005
W3540C             SET PS-END-OF-NXT-DATE-FILE TO TRUE.                 05700005
W3540C                                                                  05710005
W3540C     IF PS-END-OF-NXT-DATE-FILE                                   05720005
W3540C         MOVE '1600-PROCESS-NEXT-DATE-CARD ' TO PV-PARAGRAPH-NAME 05730005
W3540C         MOVE 'DATE CARD MISSING           ' TO PV-OPERATION-MSG-105740005
W3540C         PERFORM 9999-ABEND                                       05750005
W3540C     END-IF.                                                      05760005
W3540C                                                                  05770005
W3540C     DISPLAY 'NEXT POS DATE: ' CC-NXT-POS-DATE.                   05771015
W3540C                                                                  05772011
W3540C     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05780005
W3540C                                                                  05790005
W3540C     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   05800005
W3540C     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   05810005
W3540C     SET  DPG52-LK-DTE-ISO             TO TRUE.                   05820005
W3540C     MOVE CC-NXT-POS-DATE(1:8)         TO DPG52-LK-DATE-INPUT.    05830015
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05840005
W3540C                                             DPG54 DPG55 DPG56.   05850005
W3540C     EVALUATE TRUE                                                05860005
W3540C         WHEN DPG54-SEVERE-ERROR                                  05870005
W3540C         WHEN DPG54-DATE-INVALID                                  05880005
W3540C             MOVE '1600-PROCESS-NEXT-DATE-CARD'                   05890005
W3540C                                           TO PV-PARAGRAPH-NAME   05900005
W3540C             MOVE 'ERROR VALIDATING INPUT CARD DATE'              05910016
W3540C                                           TO PV-OPERATION-MSG-1  05920005
W3540C             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  05930005
W3540C             PERFORM 9999-ABEND                                   05940005
W3540C     END-EVALUATE.                                                05950005
W3540C                                                                  05960005
W3540C     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-NEXT-POS-CCYY-MM-DD. 05970017
W3540C     MOVE PV-NEXT-POS-CCYY             TO PV-NXT-POS-CCYY.        05981017
W3540C     MOVE PV-NEXT-POS-MM               TO PV-NXT-POS-MM.          05990017
W3540C     MOVE PV-NEXT-POS-DD               TO PV-NXT-POS-DD.          06000017
W3540C*                                                                 06010005
      ******************************************************************06020005
      * 1700-FORMAT-HEADERS                                             06030005
      *     FORMAT REPORT HEADERS.                                      06040005
      ******************************************************************06050005
       1700-FORMAT-HEADERS.                                             06060005
                                                                        06070005
           MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   06080005
           ACCEPT PV-CURR-TIME FROM TIME.                               06090005
                                                                        06100005
           MOVE PV-CURR-DATE-MM             TO DP200-RUN-MONTH.         06110005
           MOVE PV-CURR-DATE-DD             TO DP200-RUN-DAY.           06120005
           MOVE PV-CURR-DATE-CCYY           TO DP200-RUN-YEAR.          06130005
                                                                        06140005
           MOVE PV-CURR-TIME-HH             TO DP200-RUN-HOUR.          06150005
           MOVE PV-CURR-TIME-MM             TO DP200-RUN-MINUTE.        06160005
           MOVE PC-CURRENT-PROGRAM-NAME     TO DP200-PROGRAM-NAME.      06170005
           MOVE 1                           TO DP200-REPORT-NUMBER.     06180005
                                                                        06190005
           MOVE PV-POS-CCYY                 TO H1-CCYY.                 06200005
           MOVE PV-POS-MM                   TO H1-MM.                   06210005
           MOVE PV-POS-DD                   TO H1-DD.                   06220005
                                                                        06230005
                                                                        06240005
      ******************************************************************06250005
      * 2000-READ-DEBIT-FILE                                            06260005
      ******************************************************************06270005
       2000-READ-DEBIT-FILE.                                            06280005
                                                                        06290005
           MOVE SPACES TO TC001-MERCHANT-ACTIVITY-FILE.                 06300005
                                                                        06310005
           READ DEBIT-IN-FILE                                           06320005
               INTO TC001-MERCHANT-ACTIVITY-FILE                        06330005
               AT END                                                   06340005
                   SET PS-END-OF-DEBIT-FILE TO TRUE                     06350005
           END-READ.                                                    06360005
                                                                        06370005
           IF PS-NOT-END-OF-DEBIT-FILE                                  06380005
               ADD  1    TO  PV-READ-CNT                                06390005
           END-IF.                                                      06400005
                                                                        06410005
      ****************************************************************  06420005
      * 2100-PROCESS-DEBIT-FILE                                      *  06430005
      ****************************************************************  06440005
       2100-PROCESS-DEBIT-FILE.                                         06450005
                                                                        06460005
                                                                        06470005
           EVALUATE TRUE                                                06480005
              WHEN  TC001-DTL-TYP                                       06490005
      *          INITIALIZE D1-DETAIL-STORE                             06500005
                 MOVE ZEROES    TO PV-BT-TOTAL-SALES                    06510005
                                   PV-BT-TOTAL-TRANS                    06520005
                                   PV-BT-DENIED-SALES                   06530005
                                   PV-BT-DENIED-TRANS                   06540005
                                   PV-BT-CANCEL-SALES                   06550005
                                   PV-BT-CANCEL-TRANS                   06560005
                                   PV-BT-RETURN-SALES                   06570005
                                   PV-BT-RETURN-TRANS                   06580005
                                   PV-BT-RETURN-DENIED-SALES            06590005
                                   PV-BT-RETURN-DENIED-TRANS            06600005
                                   PV-BT-RETURN-CANCEL-SALES            06610005
                                   PV-BT-RETURN-CANCEL-TRANS            06620005
                 PERFORM 2300-PROCESS-DETAIL-RECORD                     06630005
              WHEN  TC001-TRN1-TYP                                      06640005
                 PERFORM 2400-PROCESS-TRANS-RECORD                      06650005
              WHEN  TC001-BTCH-TRL-TYP                                  06660005
                 ADD 1 TO PV-TOTAL-BATCH-CTR                            06670005
                 PERFORM 2500-PROCESS-BATCH-TRAILER                     06680005
              WHEN  TC001-FILE-TRL-TYP                                  06690005
                 PERFORM 2600-PROCESS-FILE-TRAILER                      06700005
              WHEN OTHER                                                06710005
                 ADD 1 TO PV-RECORD-SKIPPED                             06720005
           END-EVALUATE.                                                06730005
                                                                        06740005
           PERFORM 2000-READ-DEBIT-FILE.                                06750005
                                                                        06760005
      ***************************************************************** 06770005
      * 2300-PROCESS-DETAIL-RECORD                                    * 06780005
      ***************************************************************** 06790005
       2300-PROCESS-DETAIL-RECORD.                                      06800005
      *                                                                 06810005
      *    MOVE TC001-MERCH-TERMINAL-NBR TO PV-MERCHANT-NBR.            06820005
      *    MOVE PV-MERCH-STORE-NBR       TO TC003-STORE-NBR.            06830005
      *    MOVE PV-MERCH-STORE-NBR       TO D1-STR-NBR.                 06840005
      *    MOVE PV-MERCH-REG-NBR         TO TC003-REG-NBR.              06850005
           MOVE TC001-STR-NBR            TO TC003-STORE-NBR.            06860005
                                                                        06870005
           IF PS-FIRST-TIME-THRU                                        06880005
              MOVE TC001-STR-NBR         TO PV-SAVE-STR                 06890005
                                            PV-STORE-NBR                06900005
                                            PV-SAVE-STORE               06910005
              MOVE 'N' TO PS-FIRST-TIME-THRU-SW                         06920005
              PERFORM  2700-GET-STATE-CODE                              06930005
              MOVE XST00001-ST-CDE TO TC003-STATE-CDE                   06940005
              MOVE XST00001-LOC-10-ABBR-NM TO TC003-STORE-NAME-ABBR     06950005
           ELSE                                                         06960005
              IF TC001-STR-NBR = PV-SAVE-STR                            06970005
                 CONTINUE                                               06980005
              ELSE                                                      06990005
                 MOVE PV-SAVE-STR  TO D1-STR-NBR                        07000005
                 PERFORM 2890-WRITE-REPORT-BREAK                        07010005
                 MOVE TC001-STR-NBR TO PV-SAVE-STR                      07020005
                                       PV-STORE-NBR                     07030005
                                       PV-SAVE-STORE                    07040005
                 PERFORM  2700-GET-STATE-CODE                           07050005
                 MOVE XST00001-ST-CDE TO TC003-STATE-CDE                07060005
                 MOVE XST00001-LOC-10-ABBR-NM TO TC003-STORE-NAME-ABBR  07070005
              END-IF                                                    07080005
           END-IF.                                                      07090005
           MOVE TC001-REG-NBR            TO TC003-REG-NBR.              07100005
                                                                        07110005
      ***************************************************************** 07120005
      * 2400-PROCESS-TRANSACTION-RECORD                               * 07130005
      ***************************************************************** 07140005
       2400-PROCESS-TRANS-RECORD.                                       07150005
                                                                        07160005
W3540C     IF PV-NXT-POS-CCYY = PV-POS-DATE-CCYY                        07170015
W3540C        MOVE PV-POS-DATE-CCYY            TO PV-TRN-DATE-CCYY      07180005
W3540C     ELSE                                                         07190005
W3540C        IF TC001-TRN1-DTE = 0101                                  07200018
W3540C           MOVE PV-NXT-POS-CCYY          TO PV-TRN-DATE-CCYY      07210015
W3540C        ELSE                                                      07211018
W3540C           IF TC001-TRN1-DTE > 0101                               07212018
W3540C              MOVE PV-POS-DATE-CCYY      TO PV-TRN-DATE-CCYY      07213018
W3540C           ELSE                                                   07220018
W3540C              MOVE '2400-PROCESS-TRANS-RECORD'                    07230018
W3540C                                         TO PV-PARAGRAPH-NAME     07240005
W3540C              MOVE 'TC001-TRN1-DTE <  0101'                       07250018
W3540C                                         TO PV-OPERATION-MSG-1    07260005
W3540C              MOVE 'AND YEAR IS THE SAME AS CURRENT'              07270018
W3540C                                         TO PV-OPERATION-MSG-2    07280006
W3540C              PERFORM 9999-ABEND                                  07290018
W3540C           END-IF                                                 07300018
W3540C        END-IF                                                    07301018
W3540C     END-IF.                                                      07310005
           MOVE TC001-TRN1-DTE       TO PV-TRN-DATE-MMDD.               07320005
           MOVE PV-TRN-DATE-CCYYMMDD TO TC003-SLS-DTE.                  07330005
           MOVE TC001-TRN1-TME       TO TC003-STRT-TM.                  07340005
           MOVE TC001-TRN1-SEQ-NBR   TO TC003-TRAN-NBR.                 07350005
           MOVE ZEROES               TO TC003-TRAN-SEQ-NBR.             07360005
           MOVE TC001-TRN1-TRAN-TYPE TO TC003-TRAN-TYPE.                07370005
           MOVE TC001-TRAN-DISP      TO TC003-TRAN-DISP.                07380005
           MOVE TC001-TRAN-AMT       TO TC003-TRAN-AMT.                 07390005
           MOVE TC001-CARD-NBR       TO TC003-CARD-NBR.                 07400005
           SET TC003-MAF-REC         TO TRUE.                           07410005
                                                                        07420005
           EVALUATE TC001-TRN1-TRAN-TYPE                                07430005
             WHEN PV-SALE-TRAN                                          07440005
              IF TC001-TRAN-DISP = PV-TRAN-COMPLETE                     07450005
                 ADD TC001-TRAN-AMT          TO PV-D1-TOTAL-SALES       07460005
                                                PV-BT-TOTAL-SALES       07470005
                 ADD 1                       TO PV-D1-TOTAL-TRANS       07480005
                                                PV-BT-TOTAL-TRANS       07490005
                 MOVE PV-D1-TOTAL-SALES      TO D1-COMPLETE-AMT         07500005
                 MOVE PV-D1-TOTAL-TRANS      TO D1-COMPLETE-NBR-TRANS   07510005
                 MOVE TC001-TRAN-RESP-CDE    TO TC003-RESPONSE-CDE      07520005
                 ADD TC001-TRAN-AMT        TO PV-D2-TOTAL-COMPLETE-SALES07530005
                 ADD 1                     TO PV-D2-TOTAL-COMPLETE-TRANS07540005
                 PERFORM  5000-WRITE-RECORD                             07550005
                 PERFORM  5100-WRITE-NONSALE-RECORD                     07560005
                 PERFORM 2000-READ-DEBIT-FILE                           07570005
              ELSE                                                      07580005
                 IF TC001-TRAN-DISP = PV-TRAN-DENIED                    07590005
                   ADD  TC001-TRAN-AMT         TO PV-D1-DENIED-SALES    07600005
                                                  PV-BT-DENIED-SALES    07610005
                   ADD  1                      TO PV-D1-DENIED-TRANS    07620005
                                                  PV-BT-DENIED-TRANS    07630005
                   MOVE PV-D1-DENIED-SALES     TO D1-DENIED-AMT         07640005
                   MOVE PV-D1-DENIED-TRANS     TO D1-DENIED-TRANS       07650005
                   ADD  TC001-TRAN-AMT       TO PV-D2-TOTAL-DENIED-SALES07660005
                   ADD  1                    TO PV-D2-TOTAL-DENIED-TRANS07670005
                   MOVE TC001-TRAN-RESP-CDE  TO TC003-RESPONSE-CDE      07680005
                   PERFORM  5100-WRITE-NONSALE-RECORD                   07690005
                   PERFORM 2000-READ-DEBIT-FILE                         07700005
                 ELSE                                                   07710005
                   IF TC001-TRAN-DISP = PV-TRAN-CANCEL                  07720005
                     ADD  TC001-TRAN-AMT         TO PV-D1-CANCEL-SALES  07730005
                                                    PV-BT-CANCEL-SALES  07740005
                     ADD  1                      TO PV-D1-CANCEL-TRANS  07750005
                                                    PV-BT-CANCEL-TRANS  07760005
                     MOVE PV-D1-CANCEL-SALES     TO D1-CANCEL-AMT       07770005
                     MOVE PV-D1-CANCEL-TRANS     TO D1-CANCEL-TRANS     07780005
                     ADD  TC001-TRAN-AMT     TO PV-D2-TOTAL-CANCEL-SALES07790005
                     ADD  1                  TO PV-D2-TOTAL-CANCEL-TRANS07800005
                     MOVE TC001-TRAN-RESP-CDE  TO TC003-RESPONSE-CDE    07810005
                     PERFORM  5100-WRITE-NONSALE-RECORD                 07820005
                     PERFORM 2000-READ-DEBIT-FILE                       07830005
                   END-IF                                               07840005
                 END-IF                                                 07850005
              END-IF                                                    07860005
           WHEN PV-RETURN-TRAN                                          07870005
              IF TC001-TRAN-DISP = PV-TRAN-COMPLETE                     07880005
                ADD  TC001-TRAN-AMT       TO PV-D1-RETURN-SALES         07890005
                                             PV-BT-RETURN-SALES         07900005
                ADD  1                    TO PV-D1-RETURN-TRANS         07910005
                                             PV-BT-RETURN-TRANS         07920005
                MOVE PV-D1-RETURN-SALES   TO D1-RETURN-AMT              07930005
                MOVE PV-D1-RETURN-TRANS   TO D1-RETURN-TRANS            07940005
                ADD  TC001-TRAN-AMT       TO PV-D2-TOTAL-RETURNED-SALES 07950005
                ADD  1                    TO PV-D2-TOTAL-RETURNED-TRANS 07960005
                PERFORM  5000-WRITE-RECORD                              07970005
              ELSE                                                      07980005
                IF TC001-TRAN-DISP = PV-TRAN-DENIED                     07990005
                  ADD  TC001-TRAN-AMT     TO PV-D1-RETURN-DENIED-SALES  08000005
                                             PV-BT-RETURN-DENIED-SALES  08010005
                  ADD 1                   TO PV-D1-RETURN-DENIED-TRANS  08020005
                                             PV-BT-RETURN-DENIED-TRANS  08030005
                  MOVE PV-D1-RETURN-DENIED-SALES                        08040005
                                          TO D1-RETURN-DENIED-AMT       08050005
                  MOVE PV-D1-RETURN-DENIED-TRANS                        08060005
                                          TO D1-RETURN-DENIED-TRANS     08070005
                  ADD  TC001-TRAN-AMT     TO PV-D2-TOTAL-RET-DENIED-SALE08080005
                  ADD  1                  TO PV-D2-TOTAL-RET-DENIED-TRAN08090005
                ELSE                                                    08100005
                  IF TC001-TRAN-DISP = PV-TRAN-CANCEL                   08110005
                    ADD  TC001-TRAN-AMT   TO PV-D1-RETURN-CANCEL-SALES  08120005
                                             PV-BT-RETURN-CANCEL-SALES  08130005
                    ADD 1                 TO PV-D1-RETURN-CANCEL-TRANS  08140005
                                             PV-BT-RETURN-CANCEL-TRANS  08150005
                    MOVE PV-D1-RETURN-CANCEL-SALES                      08160005
                                          TO D1-RETURN-CANCEL-AMT       08170005
                    MOVE PV-D1-RETURN-CANCEL-TRANS                      08180005
                                          TO D1-RETURN-CANCEL-TRANS     08190005
                    ADD  TC001-TRAN-AMT   TO PV-D2-TOTAL-RET-CANCEL-SALE08200005
                    ADD  1                TO PV-D2-TOTAL-RET-CANCEL-TRAN08210005
                  END-IF                                                08220005
                END-IF                                                  08230005
              END-IF                                                    08240005
           END-EVALUATE.                                                08250005
                                                                        08260005
      ***************************************************************** 08270005
      * 2500-PROCESS-BATCH-TRAILER-RECORD    80                       * 08280005
      ***************************************************************** 08290005
       2500-PROCESS-BATCH-TRAILER.                                      08300005
                                                                        08310005
           MOVE ZERO TO PV-TOT-DEBIT-DOL-DEBIT-TRANS.                   08320005
           MOVE TC001-DOL-DEBIT-SLS-TRAN                                08330005
                      TO PV-TOT-DEBIT-DOL-DEBIT-TRANS.                  08340005
           COMPUTE PV-TOT-DEBIT-DOL-DEBIT-TRANS =                       08350005
              PV-TOT-DEBIT-DOL-DEBIT-TRANS +                            08360005
              (TC001-DOL-DEBIT-HIGH-DGT * 10000000).                    08370005
                                                                        08380005
           IF PV-BT-TOTAL-SALES = PV-TOT-DEBIT-DOL-DEBIT-TRANS          08390005
            AND PV-BT-TOTAL-TRANS = TC001-NBR-DEBIT-SLS-TRAN            08400005
              MOVE PV-SAVE-STR TO D1-STR-NBR                            08410005
           ELSE                                                         08420005
              DISPLAY                                                   08430005
                 'STORE NUMBER: ' TC001-STR-NBR                         08440005
      *          'STORE NUMBER: ' PV-MERCH-STORE-NBR                    08450005
              DISPLAY                                                   08460005
                 'BATCH NUMBER: ' TC001-BATCH-NBR                       08470005
              DISPLAY                                                   08480005
                 'MAF RECORD TRAN $ AMOUNT: ' TC001-DOL-DEBIT-SLS-TRAN  08490005
                 '  MAF RECORD HIGH ORDER DIGIT '                       08500005
                                 TC001-DOL-DEBIT-HIGH-DGT               08510005
              DISPLAY                                                   08520005
                 'CALCULATED TRAN $ AMOUNT: ' PV-D1-TOTAL-SALES         08530005
              DISPLAY                                                   08540005
                 'MAF RECORD # OF TRAN: ' TC001-NBR-DEBIT-SLS-TRAN      08550005
              DISPLAY                                                   08560005
                 'CALCULATED # OF TRAN: ' PV-D1-TOTAL-TRANS             08570005
              MOVE '2500-PROCESS-BATCH-TRAILER'                         08580005
                                          TO PV-PARAGRAPH-NAME          08590005
              MOVE 'MAF AMOUNTS NOT = CALC AMOUNTS'                     08600005
                                          TO PV-OPERATION-MSG-1         08610005
              PERFORM 9999-ABEND                                        08620005
           END-IF.                                                      08630005
                                                                        08640005
           MOVE ZERO TO PV-TOT-DEBIT-DOL-DEBIT-TRANS.                   08650005
      ***************************************************************** 08660005
      * 2600-PROCESS-FILE-TRAILER-RECORD     90                       * 08670005
      ***************************************************************** 08680005
       2600-PROCESS-FILE-TRAILER.                                       08690005
                                                                        08700005
           MOVE ZERO TO PV-TOT-FILE-DOL-DEBIT-TRANS.                    08710005
           MOVE TC001-FILE-DOL-DEBIT-TRANS                              08720005
                      TO PV-TOT-FILE-DOL-DEBIT-TRANS.                   08730005
           COMPUTE PV-TOT-FILE-DOL-DEBIT-TRANS =                        08740005
              PV-TOT-FILE-DOL-DEBIT-TRANS +                             08750005
              (TC001-FILE-DOL-DB-HIGH-DGT * 10000000).                  08760005
                                                                        08770005
           IF PV-TOTAL-BATCH-CTR = TC001-FILE-BTCH-TOTAL                08780005
             AND PV-D2-TOTAL-COMPLETE-TRANS = TC001-FILE-DEBIT-TRANS    08790005
             AND PV-D2-TOTAL-COMPLETE-SALES =                           08800005
                                  PV-TOT-FILE-DOL-DEBIT-TRANS           08810005
               CONTINUE                                                 08820005
           ELSE                                                         08830005
              DISPLAY                                                   08840005
                 'MAF TOTAL BATCH COUNT: ' TC001-FILE-BTCH-TOTAL        08850005
              DISPLAY                                                   08860005
                 'CALCULATED BATCH COUNT: ' PV-TOTAL-BATCH-CTR          08870005
              DISPLAY                                                   08880005
                 'MAF TOTAL DEBIT TRANS: ' TC001-FILE-DEBIT-TRANS       08890005
                 '  MAF TOTAL HIGH ORDER DIGIT '                        08900005
                                 TC001-FILE-DOL-DB-HIGH-DGT             08910005
              DISPLAY                                                   08920005
                 'CALCULATED DEBIT TRANS: ' PV-D2-TOTAL-COMPLETE-TRANS  08930005
              DISPLAY                                                   08940005
                 'MAF TOTAL DEBIT SALES: ' TC001-FILE-DOL-DEBIT-TRANS   08950005
              DISPLAY                                                   08960005
                 'CALCULATED DEBIT SALES: ' PV-D2-TOTAL-COMPLETE-SALES  08970005
              MOVE '2600-PROCESS-FILE-TRAILER-RECORD'                   08980005
                                          TO PV-PARAGRAPH-NAME          08990005
              MOVE 'MAF AMOUNTS NOT = CALC AMOUNTS'                     09000005
                                          TO PV-OPERATION-MSG-1         09010005
              PERFORM 9999-ABEND                                        09020005
           END-IF.                                                      09030005
                                                                        09040005
           MOVE ZERO TO PV-TOT-FILE-DOL-DEBIT-TRANS.                    09050005
W3540C     MOVE ZERO TO PV-TOTAL-BATCH-CTR.                             09051019
W3540C     MOVE ZERO TO PV-D2-TOTAL-COMPLETE-TRANS.                     09051119
W3540C     MOVE ZERO TO PV-D2-TOTAL-COMPLETE-SALES.                     09051219
                                                                        09052019
      ***************************************************************** 09060005
      * 2700-GET-STATE-CODE                                           * 09070005
      ***************************************************************** 09080005
       2700-GET-STATE-CODE.                                             09090005
                                                                        09100005
022720     EXEC SQL                                                     09110005
022780          SELECT ST_CDE                                           09120005
022780               , COALESCE(LOC_10_ABBR_NM, :PC-DEFAULT-SPACES)     09130005
                INTO :XST00001-ST-CDE                                   09140005
                   , :XST00001-LOC-10-ABBR-NM                           09150005
022780          FROM XST_LOC                                            09160005
022780          WHERE  LOC_NBR = :PV-SAVE-STORE                         09170005
022780            AND (LOC_TYP_CDE = 'DS' OR LOC_TYP_CDE = 'HQ')        09180005
022780     END-EXEC.                                                    09190005
022780                                                                  09200005
022790     EVALUATE TRUE                                                09210005
022800         WHEN SQLWARN0 NOT EQUAL SPACE                            09220005
022900         WHEN SQLCODE NOT EQUAL ZERO                              09230005
023000             MOVE '2700-GET-STATE-CODE'                           09240005
023100                                            TO PV-PARAGRAPH-NAME  09250005
023200             MOVE 'TO SELECT FROM XST00001 '                      09260005
023300                                            TO PV-DB2-ERROR-MSG   09270005
                   DISPLAY 'STORE # :  ' TC001-STR-NBR                  09280005
                   DISPLAY ' SAVE STORE ' PV-SAVE-STR                   09290005
023400             PERFORM 9300-DB2-ERROR                               09300005
023500     END-EVALUATE.                                                09310005
023600                                                                  09320005
      ******************************************************************09330005
      * 2800-WRITE-HEADERS.                                             09340005
      ******************************************************************09350005
       2800-WRITE-HEADERS.                                              09360005
                                                                        09370005
           MOVE +1 TO PA-LINE-CNT.                                      09380005
           ADD  +1 TO PA-PAGE-CNT.                                      09390005
                                                                        09400005
           MOVE PA-PAGE-CNT TO DP200-PAGE-NUMBER.                       09410005
                                                                        09420005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              09430005
            FROM DP200-STANDRD-HEADER-200-COLS                          09440005
            AFTER ADVANCING PAGE                                        09450005
           END-WRITE.                                                   09460005
                                                                        09470005
           MOVE H1-TITLE-HEADING         TO PV-PRINT-RECORD.            09480005
           MOVE 2                        TO PV-LINE-SPACING.            09490005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              09500005
            FROM PV-PRINT-RECORD                                        09510005
            AFTER ADVANCING PV-LINE-SPACING                             09520005
           END-WRITE.                                                   09530005
                                                                        09540005
           MOVE SPACES           TO PV-PRINT-RECORD.                    09550005
                                                                        09560005
           MOVE H2-COLUMN-HEADING        TO PV-PRINT-RECORD.            09570005
           MOVE 1                        TO PV-LINE-SPACING.            09580005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              09590005
            FROM PV-PRINT-RECORD                                        09600005
            AFTER ADVANCING PV-LINE-SPACING                             09610005
           END-WRITE.                                                   09620005
                                                                        09630005
           MOVE SPACES           TO PV-PRINT-RECORD.                    09640005
                                                                        09650005
           MOVE H3-COLUMN-HEADING        TO PV-PRINT-RECORD.            09660005
           MOVE 1                        TO PV-LINE-SPACING.            09670005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              09680005
            FROM PV-PRINT-RECORD                                        09690005
            AFTER ADVANCING PV-LINE-SPACING                             09700005
           END-WRITE.                                                   09710005
                                                                        09720005
           MOVE SPACES TO PV-PRINT-RECORD.                              09730005
                                                                        09740005
      ******************************************************************09750005
      * 2890-WRITE-REPORT-BREAK                                         09760005
      ******************************************************************09770005
       2890-WRITE-REPORT-BREAK.                                         09780005
                                                                        09790005
            PERFORM 2900-WRITE-REPORT.                                  09800005
      *     MOVE 'N' TO PS-STORE-BREAK-SW.                              09810005
            MOVE ZEROES            TO PV-D1-TOTAL-SALES.                09820005
            MOVE ZEROES            TO PV-D1-TOTAL-TRANS.                09830005
            MOVE ZEROES            TO PV-D1-DENIED-SALES.               09840005
            MOVE ZEROES            TO PV-D1-DENIED-TRANS.               09850005
            MOVE ZEROES            TO PV-D1-CANCEL-SALES.               09860005
            MOVE ZEROES            TO PV-D1-CANCEL-TRANS.               09870005
            MOVE ZEROES            TO PV-D1-RETURN-SALES.               09880005
            MOVE ZEROES            TO PV-D1-RETURN-TRANS.               09890005
            MOVE ZEROES            TO PV-D1-RETURN-DENIED-SALES.        09900005
            MOVE ZEROES            TO PV-D1-RETURN-DENIED-TRANS.        09910005
            MOVE ZEROES            TO PV-D1-RETURN-CANCEL-SALES.        09920005
            MOVE ZEROES            TO PV-D1-RETURN-CANCEL-TRANS.        09930005
            INITIALIZE D1-DETAIL-STORE.                                 09940005
                                                                        09950005
      ******************************************************************09960005
      * 2900-WRITE-REPORT                                               09970005
      ******************************************************************09980005
       2900-WRITE-REPORT.                                               09990005
                                                                        10000005
           ADD PV-LINE-SPACING   TO PA-LINE-CNT.                        10010005
                                                                        10020005
           IF PA-LINE-CNT > PC-LINE-LIMIT                               10030005
               PERFORM 2800-WRITE-HEADERS                               10040005
           END-IF.                                                      10050005
                                                                        10060005
           MOVE D1-DETAIL-STORE  TO PV-PRINT-RECORD.                    10070005
                                                                        10080005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              10090005
            FROM PV-PRINT-RECORD                                        10100005
            AFTER ADVANCING PV-LINE-SPACING                             10110005
           END-WRITE.                                                   10120005
                                                                        10130005
           MOVE SPACES           TO PV-PRINT-RECORD.                    10140005
                                                                        10150005
      ******************************************************************10160005
      * 2950-WRITE-TOTALS                                               10170005
      ******************************************************************10180005
       2950-WRITE-TOTALS.                                               10190005
                                                                        10200005
           MOVE D1-DETAIL-STORE  TO PV-PRINT-RECORD.                    10210005
           PERFORM 2900-WRITE-REPORT.                                   10220005
                                                                        10230005
           MOVE PV-D2-TOTAL-COMPLETE-SALES  TO D2-TOTAL-COMPLETE-SALES. 10240005
           MOVE PV-D2-TOTAL-COMPLETE-TRANS  TO D2-TOTAL-COMPLETE-TRANS. 10250005
           MOVE PV-D2-TOTAL-DENIED-SALES    TO D2-TOTAL-DENIED-SALES.   10260005
           MOVE PV-D2-TOTAL-DENIED-TRANS    TO D2-TOTAL-DENIED-TRANS.   10270005
           MOVE PV-D2-TOTAL-CANCEL-SALES    TO D2-TOTAL-CANCEL-SALES.   10280005
           MOVE PV-D2-TOTAL-CANCEL-TRANS    TO D2-TOTAL-CANCEL-TRANS.   10290005
           MOVE PV-D2-TOTAL-RETURNED-SALES  TO D2-TOTAL-RETURNED-SALES. 10300005
           MOVE PV-D2-TOTAL-RETURNED-TRANS  TO D2-TOTAL-RETURNED-TRANS. 10310005
           MOVE PV-D2-TOTAL-RET-DENIED-SALE TO D2-TOTAL-RET-DENIED-SALE.10320005
           MOVE PV-D2-TOTAL-RET-DENIED-TRAN TO D2-TOTAL-RET-DENIED-TRAN.10330005
           MOVE PV-D2-TOTAL-RET-CANCEL-SALE TO D2-TOTAL-RET-CANCEL-SALE.10340005
           MOVE PV-D2-TOTAL-RET-CANCEL-TRAN TO D2-TOTAL-RET-CANCEL-TRAN.10350005
                                                                        10360005
           ADD 5 TO PA-LINE-CNT.                                        10370005
                                                                        10380005
           IF PA-LINE-CNT > PC-LINE-LIMIT                               10390005
               PERFORM 2800-WRITE-HEADERS                               10400005
           END-IF.                                                      10410005
                                                                        10420005
           MOVE D2-TOTAL-CORP            TO PV-PRINT-RECORD.            10430005
                                                                        10440005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              10450005
            FROM PV-PRINT-RECORD                                        10460005
            AFTER ADVANCING 5 LINES                                     10470005
           END-WRITE.                                                   10480005
                                                                        10490005
           WRITE DEBIT-DAILY-TOTALS-RECORD                              10500005
            FROM E1-END-OF-RPT-LINE                                     10510005
            AFTER ADVANCING 2 LINES                                     10520005
           END-WRITE.                                                   10530005
                                                                        10540005
      ***************************************************************** 10550005
      * 3000-END-ROUTINE                                              * 10560005
      * CLOSE FILES                                                   * 10570005
      ***************************************************************** 10580005
                                                                        10590005
       3000-END-ROUTINE.                                                10600005
                                                                        10610005
                                                                        10620005
           PERFORM 2950-WRITE-TOTALS.                                   10630005
           CLOSE DEBIT-IN-FILE.                                         10640005
           CLOSE POS-DATE-CARD-FILE.                                    10650005
W3540C     CLOSE NXT-POS-DATE-CARD-FILE.                                10651015
           CLOSE DEBIT-OUT-FILE.                                        10660005
           CLOSE DEBIT-DENIED-FILE.                                     10670005
           CLOSE DEBIT-DAILY-TOTALS-FILE.                               10680005
                                                                        10690005
           MOVE PV-READ-CNT TO PV-DISPLAY-CNT.                          10700005
           DISPLAY 'RECORDS READ:           ' PV-DISPLAY-CNT.           10710005
           MOVE PV-WRITE-CNT TO PV-DISPLAY-CNT.                         10720005
           DISPLAY 'RECORDS WRITTEN:        ' PV-DISPLAY-CNT.           10730005
           MOVE PV-WRITE-DENY-CNT TO PV-DISPLAY-CNT.                    10740005
           DISPLAY 'DENIED RECORDS WRITTEN: ' PV-DISPLAY-CNT.           10750005
           MOVE PV-RECORD-SKIPPED TO PV-DISPLAY-CNT.                    10760005
           DISPLAY 'RECORDS SKIPPED:        ' PV-DISPLAY-CNT.           10770005
                                                                        10780005
      ****************************************************************  10790005
      * 5000-WRITE-RECORD                                               10800005
      ****************************************************************  10810005
       5000-WRITE-RECORD.                                               10820005
                                                                        10830005
           WRITE TC-DEBIT-OUT-FILE FROM TC003-MAF-DATA.                 10840005
           ADD  1    TO  PV-WRITE-CNT.                                  10850005
                                                                        10860005
      ****************************************************************  10870005
      * 5100-WRITE-NONSALE-RECORD                                       10880005
      ****************************************************************  10890005
       5100-WRITE-NONSALE-RECORD.                                       10900005
                                                                        10910005
           WRITE TC-DEBIT-DENIED-FILE FROM TC003-MAF-DATA.              10920005
           ADD  1    TO  PV-WRITE-DENY-CNT.                             10930005
                                                                        10940005
037646***************************************************************** 10950005
037647*    DB2 ERROR ROUTINE                                          * 10960005
037648***************************************************************** 10970005
037649 9300-DB2-ERROR.                                                  10980005
037650     DISPLAY PC-ABEND-MSG  PC-CURRENT-PROGRAM-NAME.               10990005
037660     DISPLAY PC-DB-ERROR-PREFIX                                   11000005
037670     DISPLAY PC-DB-ATTEMPTING-MSG PV-DB2-ERROR-MSG.               11010005
037680                                                                  11020005
037690     COPY DPPD004.                                                11030005
037700                                                                  11040005
037800     SET ABEND-4013-DB2-ERROR         TO TRUE.                    11050005
037900     CALL 'ILBOABN0' USING ABEND-CODE.                            11060005
                                                                        11070005
      ******************************************************************11080005
      * 9999-ABEND                                                      11090005
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  11100005
      ******************************************************************11110005
       9999-ABEND.                                                      11120005
           DISPLAY '** ABEND           **'.                             11130005
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  11140005
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        11150005
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       11160005
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       11170005
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         11180005
      *                                                                 11190005
      ******************************************************************11200005
      ***                    END  OF  PROGRAM                        ***11210005
      ******************************************************************11220005
