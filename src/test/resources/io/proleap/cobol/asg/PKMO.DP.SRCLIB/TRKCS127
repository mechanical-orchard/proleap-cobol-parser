00001 *-----------------------*                                         08/22/95
00002  IDENTIFICATION DIVISION.                                         TRKCS127
00003 *-----------------------*                                            LV002
00004  PROGRAM-ID.    TRKCS127.                                         TRKCS127
00005  AUTHOR.        MICHAEL WALTERS.                                  TRKCS127
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          TRKCS127
00007  DATE-WRITTEN.  04-20-95.                                         TRKCS127
00008  DATE-COMPILED.                                                   TRKCS127
00009                                                                   TRKCS127
00010 *---------------------------------------------------------------* TRKCS127
00011 *    Y127 - SHIPMENT FORCAST POS LIST PROGRAM.                  * TRKCS127
00012 *                                                               * TRKCS127
00013 *    THIS PROGRAM GENERATES A LIST OF SYSTEM MESSAGES.  THE     * TRKCS127
00014 *    ASSOCIATED SYSTEM ID, MESSAGE NUMBER, REVIEW INDICATOR     * TRKCS127
00015 *    AND SHORT MESSAGE TEXT (55 OF 70 BYTES) IS DISPLAYED.  THE * TRKCS127
00016 *    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   * TRKCS127
00017 *    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.  NO SELECTION* TRKCS127
00018 *    IS NECESSARY TO ADD A NEW MESSAGE.                         * TRKCS127
00019 *                                                               * TRKCS127
00020 *---------------------------------------------------------------* TRKCS127
001400* CHANGED 10-30-2014 CHERI PARMLEY           CHG0094517                   
001500*         EXPANDED PO# TO 8 DIGITS, SHORTENED VENDOR BY 1 DIGIT           
001600*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
00021  EJECT                                                            TRKCS127
00022  ENVIRONMENT DIVISION.                                            TRKCS127
00023                                                                   TRKCS127
00024  DATA DIVISION.                                                   TRKCS127
00025                                                                   TRKCS127
00026  WORKING-STORAGE SECTION.                                         TRKCS127
00027                                                                   TRKCS127
00028  01  DK-DB2-KEYS.                                                 TRKCS127
00029      05  DK-PRO-NBR                     PIC  X(16).               TRKCS127
00030      05  DK-BOL-NBR                     PIC  X(33).               TRKCS127
00031      05  DK-SHIPT-ID                    PIC S9(09)  COMP.         TRKCS127
00032      05  DK-SCAC-ID                     PIC  X(04).               TRKCS127
00033                                                                   TRKCS127
00034  01  DN-DB2-NULL-INDICATORS.                                      TRKCS127
00035      05  DN-AD-EVNT-DTE                  PIC S9(04) VALUE +0      TRKCS127
00036                                                     COMP.         TRKCS127
00037                                                                   TRKCS127
00038  01  PC-PROGRAM-CONSTANTS.                                        TRKCS127
00039      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         TRKCS127
00040                                                     'TR127A  '.   TRKCS127
00041      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         TRKCS127
00042                                                     'TRKM127 '.   TRKCS127
00043      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         TRKCS127
00044                                                     'TRKCS127'.   TRKCS127
00045      05  PC-RCKUT023                    PIC  X(08)  VALUE         TRKCS127
00046                                                     'RCKUT023'.   TRKCS127
00047      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      TRKCS127
00048      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      TRKCS127
00049      05  PC-MAINT-DEL-FORMAT            PIC  X(01)  VALUE '1'.    TRKCS127
00050      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     TRKCS127
00051                                                     COMP SYNC.    TRKCS127
00052      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      TRKCS127
00053                                                     COMP SYNC.    TRKCS127
00054      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         TRKCS127
00055                                                     +1000000      TRKCS127
00056                                                     COMP-3.       TRKCS127
00057      05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      TRKCS127
00058                                                     COMP SYNC.    TRKCS127
00059      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       TRKCS127
00060                                                     COMP-3.       TRKCS127
00061      05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    TRKCS127
00062      05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  TRKCS127
00063      05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  TRKCS127
00064      05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  TRKCS127
00065      05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  TRKCS127
00066 *                                                                 TRKCS127
00067      05  PC-TSYMSG-NUMBERS.                                       TRKCS127
00068          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  TRKCS127
00069          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  TRKCS127
00070          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  TRKCS127
00071          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  TRKCS127
00072          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  TRKCS127
00073          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  TRKCS127
00074          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  TRKCS127
00075          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  TRKCS127
00076          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  TRKCS127
00077          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  TRKCS127
00078          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  TRKCS127
00079          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  TRKCS127
00080          10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  TRKCS127
00081          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  TRKCS127
00082          10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  TRKCS127
00083 *                                                                 TRKCS127
00084  01  PS-PROGRAM-SWITCHES.                                         TRKCS127
00085      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    TRKCS127
00086          88  PS-NO-ERROR                            VALUE 'Y'.    TRKCS127
00087          88  PS-ERROR                               VALUE 'N'.    TRKCS127
00088      05  PS-SHIP-WIN-SW                 PIC  X(01)  VALUE 'Y'.    TRKCS127
00089          88  PS-SHIP-WIN-EXIST                      VALUE 'Y'.    TRKCS127
00090          88  PS-SHIP-WIN-NOT-EXIST                  VALUE 'N'.    TRKCS127
00091      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    TRKCS127
00092          88  PS-COMMAREA-VALID                      VALUE 'Y'.    TRKCS127
00093          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    TRKCS127
00094 *                                                                 TRKCS127
00095  01  PV-PROGRAM-VARIABLES.                                        TRKCS127
00096      05  PV-SUB                         PIC S9(04)  VALUE +0      TRKCS127
00097                                                     COMP SYNC.    TRKCS127
00098      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      TRKCS127
00099                                                     COMP SYNC.    TRKCS127
00100      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      TRKCS127
00101                                                     COMP-3.       TRKCS127
00102      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      TRKCS127
00103                                                     COMP-3.       TRKCS127
00104      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      TRKCS127
00105                                                     COMP-3.       TRKCS127
00106      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      TRKCS127
00107                                                     COMP-3.       TRKCS127
00108      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      TRKCS127
00109                                                     COMP-3.       TRKCS127
00110      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      TRKCS127
00111                                                     COMP-3.       TRKCS127
00112      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      TRKCS127
00113                                                     COMP-3.       TRKCS127
00114      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      TRKCS127
00115                                                     COMP SYNC.    TRKCS127
00116      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      TRKCS127
00117                                                     COMP SYNC.    TRKCS127
00118      05  PV-ITEM                        PIC S9(04)  VALUE +0      TRKCS127
00119                                                     COMP SYNC.    TRKCS127
00120      05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      TRKCS127
00121                                                     COMP SYNC.    TRKCS127
00122      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      TRKCS127
00123                                                     COMP SYNC.    TRKCS127
00124      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      TRKCS127
00125                                                     COMP SYNC.    TRKCS127
00126      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      TRKCS127
00127                                                     COMP SYNC.    TRKCS127
00128      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      TRKCS127
00129                                                     COMP SYNC.    TRKCS127
00130      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      TRKCS127
00131                                                     COMP SYNC.    TRKCS127
00132      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      TRKCS127
00133                                                     COMP SYNC.    TRKCS127
00134      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      TRKCS127
00135                                                     COMP SYNC.    TRKCS127
00136      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      TRKCS127
00137                                                     COMP SYNC.    TRKCS127
00138      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      TRKCS127
00139                                                     COMP SYNC.    TRKCS127
00140      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      TRKCS127
00141                                                     COMP SYNC.    TRKCS127
00142      05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      TRKCS127
00143                                                     COMP SYNC.    TRKCS127
00144      05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      TRKCS127
00145                                                     COMP SYNC.    TRKCS127
00146      05  PV-WORK-DATE.                                            TRKCS127
00147          10  PV-WORK-CC                 PIC  X(02)  VALUE SPACES. TRKCS127
00148          10  PV-WORK-YY                 PIC  X(02)  VALUE SPACES. TRKCS127
00149          10  FILLER                     PIC  X      VALUE SPACE.  TRKCS127
00150          10  PV-WORK-MM                 PIC  X(02)  VALUE SPACES. TRKCS127
00151          10  FILLER                     PIC  X      VALUE SPACE.  TRKCS127
00152          10  PV-WORK-DD                 PIC  X(02)  VALUE SPACES. TRKCS127
00153                                                                   TRKCS127
00154      05  PV-DISP-DATE.                                            TRKCS127
00155          10  PV-DISP-MM                 PIC  X(02)  VALUE SPACES. TRKCS127
00156          10  FILLER                     PIC  X      VALUE '/'.    TRKCS127
00157          10  PV-DISP-DD                 PIC  X(02)  VALUE SPACES. TRKCS127
00158 ******************************************************************TRKCS127
00159 **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **TRKCS127
00160 **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **TRKCS127
00161 **  APPLICATION-SPECIFIC COMMAREA.                              **TRKCS127
00162 ******************************************************************TRKCS127
00163  01  LQW-LIST-QUEUE-WORK-AREA.                                    TRKCS127
00164      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  TRKCS127
00165      05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           TRKCS127
00166                                         INDEXED BY LQW-IDX.       TRKCS127
00167          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       TRKCS127
00168          10  LQW-TEMP-SELECTED-SW       PIC  X(01).               TRKCS127
00169          10  LQW-SELECTED-SW            PIC  X(01).               TRKCS127
00170              88  LQW-SELECT                         VALUE 'S'.    TRKCS127
00171              88  LQW-DESELECT                       VALUE ' '.    TRKCS127
00172          10  LQW-ACTION                 PIC  X(03).               TRKCS127
      *CLP 10/30/14                                                             
00173          10  LQW-PO-NBR                 PIC S9(08)  COMP-3.       TRKCS127
00174          10  LQW-REC-SEQ-NBR            PIC S9(09)  COMP-3.       TRKCS127
00175          10  LQW-PO-STATUS              PIC  X(02).               TRKCS127
00176          10  LQW-NEW-STR                PIC  X(01).               TRKCS127
00177          10  LQW-SHIP-STATUS            PIC  X(01).               TRKCS127
00178          10  LQW-EXPTED-CART-CNT        PIC S9(04)  COMP-3.       TRKCS127
00179          10  LQW-VEND-CART-CNT          PIC S9(04)  COMP-3.       TRKCS127
00180          10  LQW-CARR-CART-CNT          PIC S9(04)  COMP-3.       TRKCS127
00181          10  LQW-PIC-AD                 PIC  X(01).               TRKCS127
00182          10  LQW-AD-DAATE               PIC  X(05).               TRKCS127
      *CLP 10/30/14                                                             
00183          10  LQW-VEND-NAME              PIC  X(20).               TRKCS127
00184                                                                   TRKCS127
00185      EJECT                                                        TRKCS127
00186 *---------------------------------------------------------------* TRKCS127
00187 *  RECORD LAYOUT FOR THE PO SELECTION TEMP STORAGE QUEUE.       * TRKCS127
00188 *---------------------------------------------------------------* TRKCS127
00189                                                                   TRKCS127
00190      COPY TRWS018.                                                TRKCS127
00191                                                                   TRKCS127
00192      EJECT                                                        TRKCS127
00193 *---------------------------------------------------------------* TRKCS127
00194 *    MAP LAYOUT                                                 * TRKCS127
00195 *---------------------------------------------------------------* TRKCS127
00196                                                                   TRKCS127
00197      COPY TRKM127.                                                TRKCS127
00198 *                                                                 TRKCS127
00199  01  MR-OCCURS-LAYOUT                   REDEFINES  TR127AO.       TRKCS127
00200      05  FILLER                         PIC X(170).               TRKCS127
00201      05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          TRKCS127
00202          10  MR-SELECTL                 PIC S9(04) COMP.          TRKCS127
00203          10  MR-SELECTA                 PIC  X(01).               TRKCS127
00204          10  MR-SELECTC                 PIC  X(01).               TRKCS127
00205          10  MR-SELECTH                 PIC  X(01).               TRKCS127
00206          10  MR-SELECTI                 PIC  X(01).               TRKCS127
00207                                                                   TRKCS127
00208          10  MR-ACTIONL                 PIC S9(04) COMP.          TRKCS127
00209          10  MR-ACTIONA                 PIC  X(01).               TRKCS127
00210          10  MR-ACTIONC                 PIC  X(01).               TRKCS127
00211          10  MR-ACTIONH                 PIC  X(01).               TRKCS127
00212          10  MR-ACTION                  PIC  X(03).               TRKCS127
00213                                                                   TRKCS127
00214          10  MR-PO-NBRL                 PIC S9(04) COMP.          TRKCS127
00215          10  MR-PO-NBRA                 PIC  X(01).               TRKCS127
00216          10  MR-PO-NBRC                 PIC  X(01).               TRKCS127
00217          10  MR-PO-NBRH                 PIC  X(01).               TRKCS127
      *CLP 10/30/14                                                             
00218          10  MR-PO-NBR                  PIC  X(08).               TRKCS127
00219                                                                   TRKCS127
00220          10  MR-REC-SEQ-NBRL            PIC S9(04) COMP.          TRKCS127
00221          10  MR-REC-SEQ-NBRA            PIC  X(01).               TRKCS127
00222          10  MR-REC-SEQ-NBRC            PIC  X(01).               TRKCS127
00223          10  MR-REC-SEQ-NBRH            PIC  X(01).               TRKCS127
00224          10  MR-REC-SEQ-NBR             PIC  X(04).               TRKCS127
00225          10  MR-REC-SEQ-NBR-N           REDEFINES                 TRKCS127
00226              MR-REC-SEQ-NBR             PIC  9(04).               TRKCS127
00227                                                                   TRKCS127
00228          10  MR-PO-STATUSL              PIC S9(04) COMP.          TRKCS127
00229          10  MR-PO-STATUSA              PIC  X(01).               TRKCS127
00230          10  MR-PO-STATUSC              PIC  X(01).               TRKCS127
00231          10  MR-PO-STATUSH              PIC  X(01).               TRKCS127
00232          10  MR-PO-STATUS               PIC  X(02).               TRKCS127
00233                                                                   TRKCS127
00234          10  MR-NEW-STRL                PIC S9(04) COMP.          TRKCS127
00235          10  MR-NEW-STRA                PIC  X(01).               TRKCS127
00236          10  MR-NEW-STRC                PIC  X(01).               TRKCS127
00237          10  MR-NEW-STRH                PIC  X(01).               TRKCS127
00238          10  MR-NEW-STR                 PIC  X(01).               TRKCS127
00239                                                                   TRKCS127
00240          10  MR-SHIP-STATUSL            PIC S9(04) COMP.          TRKCS127
00241          10  MR-SHIP-STATUSA            PIC  X(01).               TRKCS127
00242          10  MR-SHIP-STATUSC            PIC  X(01).               TRKCS127
00243          10  MR-SHIP-STATUSH            PIC  X(01).               TRKCS127
00244          10  MR-SHIP-STATUS             PIC  X(01).               TRKCS127
00245                                                                   TRKCS127
00246          10  MR-EXPTED-CART-CNTL        PIC S9(04) COMP.          TRKCS127
00247          10  MR-EXPTED-CART-CNTA        PIC  X(01).               TRKCS127
00248          10  MR-EXPTED-CART-CNTC        PIC  X(01).               TRKCS127
00249          10  MR-EXPTED-CART-CNTH        PIC  X(01).               TRKCS127
00250          10  MR-EXPTED-CART-CNT         PIC  X(03).               TRKCS127
00251          10  MR-EXPTED-CART-CNT-N       REDEFINES                 TRKCS127
00252              MR-EXPTED-CART-CNT         PIC  9(03).               TRKCS127
00253                                                                   TRKCS127
00254          10  MR-VEND-CART-CNTL          PIC S9(04) COMP.          TRKCS127
00255          10  MR-VEND-CART-CNTA          PIC  X(01).               TRKCS127
00256          10  MR-VEND-CART-CNTC          PIC  X(01).               TRKCS127
00257          10  MR-VEND-CART-CNTH          PIC  X(01).               TRKCS127
00258          10  MR-VEND-CART-CNT           PIC  X(03).               TRKCS127
00259          10  MR-VEND-CART-CNT-N         REDEFINES                 TRKCS127
00260              MR-VEND-CART-CNT           PIC  9(03).               TRKCS127
00261                                                                   TRKCS127
00262          10  MR-CARR-CART-CNTL          PIC S9(04) COMP.          TRKCS127
00263          10  MR-CARR-CART-CNTA          PIC  X(01).               TRKCS127
00264          10  MR-CARR-CART-CNTC          PIC  X(01).               TRKCS127
00265          10  MR-CARR-CART-CNTH          PIC  X(01).               TRKCS127
00266          10  MR-CARR-CART-CNT           PIC  X(03).               TRKCS127
00267          10  MR-CARR-CART-CNT-N         REDEFINES                 TRKCS127
00268              MR-CARR-CART-CNT           PIC  9(03).               TRKCS127
00269                                                                   TRKCS127
00270          10  MR-AD-PICL                 PIC S9(04) COMP.          TRKCS127
00271          10  MR-AD-PICA                 PIC  X(01).               TRKCS127
00272          10  MR-AD-PICC                 PIC  X(01).               TRKCS127
00273          10  MR-AD-PICH                 PIC  X(01).               TRKCS127
00274          10  MR-AD-PIC                  PIC  X(01).               TRKCS127
00275                                                                   TRKCS127
00276          10  MR-AD-DATEL                PIC S9(04) COMP.          TRKCS127
00277          10  MR-AD-DATEA                PIC  X(01).               TRKCS127
00278          10  MR-AD-DATEC                PIC  X(01).               TRKCS127
00279          10  MR-AD-DATEH                PIC  X(01).               TRKCS127
00280          10  MR-AD-DATE                 PIC  X(05).               TRKCS127
00281                                                                   TRKCS127
00282          10  MR-VEND-NAMEL              PIC S9(04) COMP.          TRKCS127
00283          10  MR-VEND-NAMEA              PIC  X(01).               TRKCS127
00284          10  MR-VEND-NAMEC              PIC  X(01).               TRKCS127
00285          10  MR-VEND-NAMEH              PIC  X(01).               TRKCS127
      *CLP 10/30/14                                                             
00286          10  MR-VEND-NAME               PIC  X(20).               TRKCS127
00287                                                                   TRKCS127
00288      EJECT                                                        TRKCS127
00289 *---------------------------------------------------------------* TRKCS127
00290 *    ATTRIBUTE SETTINGS COPYBOOK.                               * TRKCS127
00291 *---------------------------------------------------------------* TRKCS127
00292                                                                   TRKCS127
00293      COPY DPWS015.                                                TRKCS127
00294                                                                   TRKCS127
00295 *---------------------------------------------------------------* TRKCS127
00296 *    FUNCTION KEYS COPYBOOK.                                    * TRKCS127
00297 *---------------------------------------------------------------* TRKCS127
00298                                                                   TRKCS127
00299      COPY DPWS016.                                                TRKCS127
00300                                                                   TRKCS127
00301 *---------------------------------------------------------------* TRKCS127
00302 *    NUMERIC EDIT LAYOUT.                                       * TRKCS127
00303 *---------------------------------------------------------------* TRKCS127
00304                                                                   TRKCS127
00305      COPY DPWS010I.                                               TRKCS127
00306  EJECT                                                            TRKCS127
00307                                                                   TRKCS127
00308 *---------------------------------------------------------------* TRKCS127
00309 *    COPY BOOKS FOR THE VALIDATION ROUTINE FOR THE FREIGHT BILL * TRKCS127
00310 *    BILL OF LADING, AND VEHICLE NUMBER                         * TRKCS127
00311 *---------------------------------------------------------------* TRKCS127
00312      COPY RCWS023.                                                TRKCS127
00313                                                                   TRKCS127
00314  EJECT                                                            TRKCS127
00315 *---------------------------------------------------------------* TRKCS127
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * TRKCS127
00317 *---------------------------------------------------------------* TRKCS127
00318                                                                   TRKCS127
00319      COPY DPWS030.                                                TRKCS127
CICS       COPY DPWS930.                                                TRKCS127
00320  EJECT                                                            TRKCS127
00321 *---------------------------------------------------------------* TRKCS127
00322 *    STANDARD COMMAREA.                                         * TRKCS127
00323 *---------------------------------------------------------------* TRKCS127
00324                                                                   TRKCS127
00325      COPY DPWS020.                                                TRKCS127
00326      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                TRKCS127
00327                                                                   TRKCS127
00328 *---------------------------------------------------------------* TRKCS127
00329 * INTER-APPLICATION COMMAREA.                                   * TRKCS127
00330 *   TRWS001 - IS THE INPUT LAYOUT                               * TRKCS127
00331 *---------------------------------------------------------------* TRKCS127
00332                                                                   TRKCS127
00333          10  INTER-APPL-COMM-AREA       PIC X(200).               TRKCS127
00334      COPY TRWS001.                                                TRKCS127
00335      COPY TRWS017.                                                TRKCS127
00336 *---------------------------------------------------------------* TRKCS127
00337 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * TRKCS127
00338 *---------------------------------------------------------------* TRKCS127
00339          10  ASC-SPECIFIC-COMMAREA.                               TRKCS127
00340              15  ASC-LIST-KEYS.                                   TRKCS127
00341                  20  ASC-KEY-PRO-NBR                 PIC  X(22).  TRKCS127
00342                  20  ASC-KEY-PO-NBR                  PIC  X(22).  TRKCS127
00343                  20  ASC-KEY-BOL-NBR                 PIC  X(30).  TRKCS127
00344                  20  ASC-KEY-SHIPT-ID                PIC S9(09)   TRKCS127
00345                                                      COMP-3.      TRKCS127
00346                  20  ASC-KEY-OPER-UNT-ID             PIC  9(04).  TRKCS127
00347                  20  ASC-KEY-FCLTY-ID                PIC  9(04).  TRKCS127
00348                  20  ASC-KEY-FCLTY-NME               PIC  X(25).  TRKCS127
00349                  20  ASC-KEY-TRLR-NBR                PIC  X(10).  TRKCS127
00350                  20  ASC-KEY-SCAC                    PIC  X(04).  TRKCS127
00351              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                TRKCS127
00352                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  TRKCS127
00353                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   TRKCS127
00354                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   TRKCS127
00355                                                                   TRKCS127
00356                  20  ASC-ITEM-ARRAY.                              TRKCS127
00357                      25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        TRKCS127
00358                          30  ASC-LIST-ITEM-NUMBER                 TRKCS127
00359                                                      PIC S9(09)   TRKCS127
00360                                                      COMP-3.      TRKCS127
00361                          30  ASC-TEMP-SELECTED-SW    PIC  X(01).  TRKCS127
00362                              88  ASC-VALID-SELECT    VALUE ' '    TRKCS127
00363                                                            'S'    TRKCS127
00364                                                            'B'    TRKCS127
00365                                                            'E'.   TRKCS127
00366                              88  ASC-TEMP-NO-SELECT  VALUE ' '.   TRKCS127
00367                              88  ASC-TEMP-SELECT     VALUE 'S'.   TRKCS127
00368                              88  ASC-TEMP-BEGIN      VALUE 'B'.   TRKCS127
00369                              88  ASC-TEMP-END        VALUE 'E'.   TRKCS127
00370                          30  ASC-SELECTED-SW         PIC  X(01).  TRKCS127
00371                              88  ASC-NO-SELECT       VALUE ' '.   TRKCS127
00372                              88  ASC-SELECT          VALUE 'S'.   TRKCS127
00373                              88  ASC-BEGIN           VALUE 'B'.   TRKCS127
00374                              88  ASC-END             VALUE 'E'.   TRKCS127
00375                          30  ASC-ACTION              PIC  X(03).  TRKCS127
      *CLP 10/30/14                                                             
00376                          30  ASC-PO-NBR              PIC S9(08)   TRKCS127
00377                                                           COMP-3. TRKCS127
00378                          30  ASC-REC-SEQ-NBR         PIC S9(09)   TRKCS127
00379                                                           COMP-3. TRKCS127
00380                          30  ASC-PO-STATUS           PIC  X(02).  TRKCS127
00381                          30  ASC-NEW-STR             PIC  X(01).  TRKCS127
00382                          30  ASC-SHIP-STATUS         PIC  X(01).  TRKCS127
00383                          30  ASC-EXPTED-CART-CNT     PIC S9(04)   TRKCS127
00384                                                           COMP-3. TRKCS127
00385                          30  ASC-VEND-CART-CNT       PIC S9(04)   TRKCS127
00386                                                           COMP-3. TRKCS127
00387                          30  ASC-CARR-CART-CNT       PIC S9(04)   TRKCS127
00388                                                           COMP-3. TRKCS127
00389                          30  ASC-PIC-AD              PIC  X(01).  TRKCS127
00390                          30  ASC-AD-DATE             PIC  X(05).  TRKCS127
      *CLP 10/30/14                                                             
00391                          30  ASC-VEND-NAME           PIC  X(20).  TRKCS127
00392                                                                   TRKCS127
00393              15  ASC-BLK-SUB                         PIC S9(04)   TRKCS127
00394                                                           COMP    TRKCS127
00395                                                           SYNC.   TRKCS127
00396              15  ASC-ITEM-SUB                        PIC S9(04)   TRKCS127
00397                                                           COMP    TRKCS127
00398                                                           SYNC.   TRKCS127
00399              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   TRKCS127
00400                                                           COMP-3. TRKCS127
00401              15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   TRKCS127
00402                                                           COMP-3. TRKCS127
00403              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   TRKCS127
00404                                                           COMP-3. TRKCS127
00405              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   TRKCS127
00406                                                           COMP-3. TRKCS127
00407              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   TRKCS127
00408                                                           COMP-3. TRKCS127
00409              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   TRKCS127
00410                                                           COMP    TRKCS127
00411                                                           SYNC.   TRKCS127
00412              15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   TRKCS127
00413                                                           COMP-3. TRKCS127
00414              15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   TRKCS127
00415                                                           COMP-3. TRKCS127
00416              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  TRKCS127
00417                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   TRKCS127
00418                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   TRKCS127
00419              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  TRKCS127
00420                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   TRKCS127
00421                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   TRKCS127
00422              15  ASC-LIST-QUEUE-NAME.                             TRKCS127
00423                  20  ASC-LIST-TERM-ID                PIC  X(04).  TRKCS127
00424                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   TRKCS127
00425                                                           COMP-3. TRKCS127
00426                  20  ASC-LIST-SEQ                    PIC  9(01).  TRKCS127
00427              15  ASC-SEL-QUEUE-NAME.                              TRKCS127
00428                  20  ASC-SEL-TERM-ID                 PIC  X(04).  TRKCS127
00429                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)   TRKCS127
00430                                                           COMP-3. TRKCS127
00431                  20  ASC-SEL-SEQ                     PIC  9(01).  TRKCS127
00432                                                                   TRKCS127
00433              15  ASC-START-ITEM-REQUEST.                          TRKCS127
00434                  20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  TRKCS127
00435      EJECT                                                        TRKCS127
00436 *---------------------------------------------------------------* TRKCS127
00437 *    ABEND PROCESSING COPYBOOK.                                 * TRKCS127
00438 *---------------------------------------------------------------* TRKCS127
00439                                                                   TRKCS127
00440      COPY DPWS013.                                                TRKCS127
00441                                                                   TRKCS127
00442  EJECT                                                            TRKCS127
00443 *---------------------------------------------------------------* TRKCS127
00444 *    DB2 AREA FOR COMMUNICATIONS                                * TRKCS127
00445 *---------------------------------------------------------------* TRKCS127
00446      EXEC SQL                                                     TRKCS127
00447           INCLUDE SQLCA                                           TRKCS127
00448      END-EXEC.                                                    TRKCS127
00449 *---------------------------------------------------------------* TRKCS127
00450 *    DB2 AREA FOR SHIPMENT TABLE                                * TRKCS127
00451 *---------------------------------------------------------------* TRKCS127
00452      EXEC SQL                                                     TRKCS127
00453           INCLUDE TSHIPMT                                         TRKCS127
00454      END-EXEC.                                                    TRKCS127
00455 *---------------------------------------------------------------* TRKCS127
00456 *    DB2 AREA FOR SHIPMENT PO ASSOCIATION TABLE                 * TRKCS127
00457 *---------------------------------------------------------------* TRKCS127
00458      EXEC SQL                                                     TRKCS127
00459           INCLUDE TSHPTPO                                         TRKCS127
00460      END-EXEC.                                                    TRKCS127
00461 *---------------------------------------------------------------* TRKCS127
00462 *    DB2 AREA FOR PLANNED SHIPMENT TABLE                        * TRKCS127
00463 *---------------------------------------------------------------* TRKCS127
00464      EXEC SQL                                                     TRKCS127
00465           INCLUDE TPLNSHP                                         TRKCS127
00466      END-EXEC.                                                    TRKCS127
00467 *---------------------------------------------------------------* TRKCS127
00468 *    DB2 AREA FOR PURCHASE ORDER HEADER TABLE                   * TRKCS127
00469 *---------------------------------------------------------------* TRKCS127
00470      EXEC SQL                                                     TRKCS127
00471           INCLUDE TPURCHS                                         TRKCS127
00472      END-EXEC.                                                    TRKCS127
00473 *---------------------------------------------------------------* TRKCS127
00474 *    DB2 AREA FOR PURCHASE ORDER LINE TABLE                     * TRKCS127
00475 *---------------------------------------------------------------* TRKCS127
00476      EXEC SQL                                                     TRKCS127
00477           INCLUDE TPURITM                                         TRKCS127
00478      END-EXEC.                                                    TRKCS127
00479 *---------------------------------------------------------------* TRKCS127
00480 *    DB2 AREA FOR SHIPMENT STATUS TABLE                         * TRKCS127
00481 *---------------------------------------------------------------* TRKCS127
00482      EXEC SQL                                                     TRKCS127
00483           INCLUDE TSHIPST                                         TRKCS127
00484      END-EXEC.                                                    TRKCS127
00485 *---------------------------------------------------------------* TRKCS127
00486 *    DB2 AREA FOR VENDOR TABLE                                  * TRKCS127
00487 *---------------------------------------------------------------* TRKCS127
00488      EXEC SQL                                                     TRKCS127
00489           INCLUDE TENTNME                                         TRKCS127
00490      END-EXEC.                                                    TRKCS127
00491                                                                   TRKCS127
00492 *---------------------------------------------------------------* TRKCS127
00493 *    PO-CSR CURSOR                                              * TRKCS127
00494 *---------------------------------------------------------------* TRKCS127
00495                                                                   TRKCS127
00496      EXEC SQL                                                     TRKCS127
00497           DECLARE PO-CSR CURSOR                                   TRKCS127
00498           FOR SELECT                                              TRKCS127
00499                 PO_NBR                                            TRKCS127
00500               , REC_SEQ_NBR                                       TRKCS127
00501               , EXPTED_CART_CNT                                   TRKCS127
00502               , CARR_CART_CT                                      TRKCS127
00503               , VEND_CART_CT                                      TRKCS127
00504           FROM                                                    TRKCS127
00505                 TSHPTPO                                           TRKCS127
00506           WHERE                                                   TRKCS127
00507                 SHIPT_ID       = :DK-SHIPT-ID                     TRKCS127
00508           ORDER BY                                                TRKCS127
00509                 PO_NBR                                            TRKCS127
00510              ,  REC_SEQ_NBR                                       TRKCS127
00511      END-EXEC.                                                    TRKCS127
00512                                                                   TRKCS127
00513                                                                   TRKCS127
00514  EJECT                                                            TRKCS127
00515  LINKAGE SECTION.                                                 TRKCS127
00516                                                                   TRKCS127
00517  01  DFHCOMMAREA.                                                 TRKCS127
00518      05  FILLER                         OCCURS  1 TO 4072 TIMES   TRKCS127
00519                                         DEPENDING ON EIBCALEN.    TRKCS127
00520          10  FILLER                     PIC X.                    TRKCS127
00521                                                                   TRKCS127
00522  EJECT                                                            TRKCS127
00523  PROCEDURE DIVISION.                                              TRKCS127
00524 ******************************************************************TRKCS127
00525 **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **TRKCS127
00526 **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **TRKCS127
00527 **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **TRKCS127
00528 ******************************************************************TRKCS127
00529  0000-MAIN-MODULE.                                                TRKCS127
00530      INITIALIZE DP030-CICS-API-FIELDS.                            TRKCS127
00531      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       TRKCS127
00532      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          TRKCS127
00533      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         TRKCS127
00534      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       TRKCS127
00535      MOVE LENGTH OF TR127AI        TO DP030-MAP-LENGTH (1).       TRKCS127
00536      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     TRKCS127
00537      PERFORM 0001-CALL-CICS-ARCH-API.                             TRKCS127
00538 *                                                                 TRKCS127
00539      PERFORM 1000-CONTROL-PROCESSING                              TRKCS127
00540 *                                                                 TRKCS127
00541      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     TRKCS127
00542      PERFORM 0001-CALL-CICS-ARCH-API.                             TRKCS127
00543                                                                   TRKCS127
00544 ******************************************************************TRKCS127
00545 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **TRKCS127
00546 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **TRKCS127
00547 ******************************************************************TRKCS127
00548  0001-CALL-CICS-ARCH-API.                                         TRKCS127
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
00550                                     DFHCOMMAREA                           
00551                                     DP030-CICS-API-FIELDS                 
00552                                     DP020-STANDARD-COMMAREA               
00553                                     TR127AI.                              
00554 *                                                                 TRKCS127
00555      IF  DP030-RC-CALL-SUCCESSFUL                                 TRKCS127
00556          CONTINUE                                                 TRKCS127
00557      ELSE                                                         TRKCS127
00558          SET DP013-NO-ROLLBACK                                    TRKCS127
00559              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
00560              DP013-CICS-ABEND      TO TRUE                        TRKCS127
00561          MOVE '0001-CALL-CICS-ARCH-API'                           TRKCS127
00562                                    TO DP013-PARAGRAPH             TRKCS127
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OTRKCS127
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      TRKCS127
00565          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      TRKCS127
00566          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
00567      END-IF.                                                      TRKCS127
00568 *----------------------------------------------------------------*TRKCS127
00569 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *TRKCS127
00570 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *TRKCS127
00571 *                                                                *TRKCS127
00572 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *TRKCS127
00573 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *TRKCS127
00574 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *TRKCS127
00575 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *TRKCS127
00576 *----------------------------------------------------------------*TRKCS127
00577                                                                   TRKCS127
00578  1000-CONTROL-PROCESSING.                                         TRKCS127
00579                                                                   TRKCS127
00580      EVALUATE TRUE                                                TRKCS127
00581          WHEN DP020-NEXT-ACT-INITIAL                              TRKCS127
00582              INITIALIZE ASC-SPECIFIC-COMMAREA                     TRKCS127
00583              MOVE EIBTRMID         TO ASC-LIST-TERM-ID            TRKCS127
00584                                       ASC-SEL-TERM-ID             TRKCS127
00585              MOVE DP020-SRC-TASK-NUMBER                           TRKCS127
00586                                    TO ASC-LIST-TASK-NUMBER        TRKCS127
00587                                       ASC-SEL-TASK-NUMBER         TRKCS127
00588              MOVE PC-LIST-QUEUE-SEQ                               TRKCS127
00589                                    TO ASC-LIST-SEQ                TRKCS127
00590              MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 TRKCS127
00591              PERFORM 1100-PROCESS-INTER-APPL-COMM                 TRKCS127
00592 ***-----$TEMPLATE NOTE$-------------------------------------------TRKCS127
00593 *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,TRKCS127
00594 *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  TRKCS127
00595 *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.TRKCS127
00596 ***---------------------------------------------------------------TRKCS127
00597              IF  PS-COMMAREA-NOT-VALID                            TRKCS127
00598                  MOVE PC-TSYMSG-00148                             TRKCS127
00599                                    TO DP020-MSG-NUMBER            TRKCS127
00600                  SET DP020-MSG-FATAL                              TRKCS127
00601                                    TO TRUE                        TRKCS127
00602                  SET DP020-NEXT-ACT-APPL-ERROR                    TRKCS127
00603                                    TO TRUE                        TRKCS127
00604              ELSE                                                 TRKCS127
00605                  PERFORM 4000-BUILD-INITIAL-PANEL                 TRKCS127
00606              END-IF                                               TRKCS127
00607                                                                   TRKCS127
00608          WHEN DP020-NEXT-ACT-READ-MAP                             TRKCS127
00609              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        TRKCS127
00610                                    TO PV-TOP-ITEM                 TRKCS127
00611              PERFORM 2000-PROCESS-PANEL                           TRKCS127
00612                                                                   TRKCS127
00613          WHEN DP020-NEXT-ACT-RETURN                               TRKCS127
00614              MOVE ASC-KEY-SHIPT-ID TO DK-SHIPT-ID                 TRKCS127
00615                                       TR001-SHIPT-ID              TRKCS127
00616              MOVE ASC-KEY-PRO-NBR  TO TR001-PRO-NBR               TRKCS127
00617              MOVE ASC-KEY-PO-NBR   TO TR001-PO-NBR                TRKCS127
00618              MOVE ASC-KEY-BOL-NBR  TO TR001-BOL-NBR               TRKCS127
00619              PERFORM 2050-DELETE-LIST-QUEUE                       TRKCS127
00620              PERFORM 4000-BUILD-INITIAL-PANEL                     TRKCS127
00621                                                                   TRKCS127
00622          WHEN OTHER                                               TRKCS127
00623              SET DP013-LOGIC-ABEND TO TRUE                        TRKCS127
00624              SET DP013-NO-ROLLBACK TO TRUE                        TRKCS127
00625              MOVE '1000-CONTROL-PROCESSING'                       TRKCS127
00626                                    TO DP013-PARAGRAPH             TRKCS127
00627              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    TRKCS127
00628                                    TO DP013-MESSAGE-TEXT(1)       TRKCS127
00629              PERFORM DP013-0000-PROCESS-ABEND                     TRKCS127
00630      END-EVALUATE.                                                TRKCS127
00631                                                                   TRKCS127
00632  EJECT                                                            TRKCS127
00633 *----------------------------------------------------------------*TRKCS127
00634 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *TRKCS127
00635 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *TRKCS127
00636 *----------------------------------------------------------------*TRKCS127
00637                                                                   TRKCS127
00638  1100-PROCESS-INTER-APPL-COMM.                                    TRKCS127
00639                                                                   TRKCS127
00640      SET PS-COMMAREA-VALID         TO TRUE.                       TRKCS127
00641      MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     TRKCS127
00642                                                                   TRKCS127
00643      IF  (TR001-PRO-NBR > SPACES OR TR001-BOL-NBR > SPACES)       TRKCS127
00644      AND (TR001-SCAC > SPACES)                                    TRKCS127
00645                                                                   TRKCS127
00646          MOVE TR001-PRO-NBR        TO ASC-KEY-PRO-NBR             TRKCS127
00647                                       RC023-FREIGHT-BILL          TRKCS127
00648                                                                   TRKCS127
00649          CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA            TRKCS127
00650          MOVE RC023-FREIGHT-BILL   TO DK-PRO-NBR                  TRKCS127
00651                                                                   TRKCS127
00652          MOVE TR001-BOL-NBR        TO ASC-KEY-BOL-NBR             TRKCS127
00653                                       RC023-BILL-OF-LADING        TRKCS127
00654                                                                   TRKCS127
00655          CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA            TRKCS127
00656          MOVE RC023-BILL-OF-LADING TO DK-BOL-NBR                  TRKCS127
00657                                                                   TRKCS127
00658          MOVE TR001-SHIPT-ID       TO ASC-KEY-SHIPT-ID            TRKCS127
00659                                       DK-SHIPT-ID                 TRKCS127
00660          MOVE TR001-PO-NBR         TO ASC-KEY-PO-NBR              TRKCS127
00661          MOVE TR001-OPER-UNT-ID-N  TO ASC-KEY-OPER-UNT-ID         TRKCS127
00662          MOVE TR001-FCLTY-ID-N     TO ASC-KEY-FCLTY-ID            TRKCS127
00663          MOVE TR001-FCLTY-NME      TO ASC-KEY-FCLTY-NME           TRKCS127
00664          MOVE TR001-TRLR-NBR       TO ASC-KEY-TRLR-NBR            TRKCS127
00665          MOVE TR001-SCAC           TO ASC-KEY-SCAC                TRKCS127
00666                                       DK-SCAC-ID                     CL**2
00667                                                                   TRKCS127
00668          PERFORM 1110-VERIFY-SHIPMENT                             TRKCS127
00669      ELSE                                                         TRKCS127
00670           SET PS-COMMAREA-NOT-VALID                               TRKCS127
00671                                    TO TRUE                        TRKCS127
00672      END-IF.                                                      TRKCS127
00673                                                                   TRKCS127
00674 *----------------------------------------------------------------*TRKCS127
00675 * VALIDATE THAT THE SHIPMENT EXISTS.                             *TRKCS127
00676 *   THIS PARAGRAPH WILL DO A SELECT FROM THE SHIPMENT TABLE IF   *TRKCS127
00677 *   BOTH THE BOL AND F/B NUMBER WERE ENTERED.                    *TRKCS127
00678 *----------------------------------------------------------------*TRKCS127
00679                                                                   TRKCS127
00680  1110-VERIFY-SHIPMENT.                                            TRKCS127
00681      PERFORM                                                      TRKCS127
00682          WITH TEST AFTER                                          TRKCS127
00683          VARYING PV-RETRY-COUNTER                                 TRKCS127
00684          FROM 1 BY 1                                              TRKCS127
00685          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
00686                    OR (SQLCODE = +100)                            TRKCS127
00687                    OR (SQLCODE = -811)                            TRKCS127
00688                    OR (SQLCODE = ZERO))                           TRKCS127
00689                                                                   TRKCS127
00690          EXEC SQL                                                 TRKCS127
00691               SELECT SHIPT_ID                                     TRKCS127
00692               INTO  :SHIPMT-SHIPT-ID                              TRKCS127
00693               FROM  TSHIPMT                                       TRKCS127
00694               WHERE PRO_SCAC_ID = :DK-SCAC-ID                     TRKCS127
00695                 AND PRO_NBR     = :DK-PRO-NBR                     TRKCS127
00696                 AND BOL_NBR     = :DK-BOL-NBR                     TRKCS127
00697          END-EXEC                                                 TRKCS127
00698                                                                   TRKCS127
00699          EVALUATE TRUE                                            TRKCS127
00700              WHEN SQLCODE = ZERO                                  TRKCS127
00701              WHEN SQLCODE = -811                                  TRKCS127
00702                  SET PS-COMMAREA-VALID    TO TRUE                 TRKCS127
00703                                                                   TRKCS127
00704              WHEN SQLCODE = +100                                  TRKCS127
00705                  SET PS-COMMAREA-NOT-VALID TO TRUE                TRKCS127
00706                                                                   TRKCS127
00707              WHEN SQLCODE = -904                                  TRKCS127
00708              WHEN SQLCODE = -913                                  TRKCS127
00709                  CONTINUE                                         TRKCS127
00710              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
00711              WHEN SQLCODE < ZERO                                  TRKCS127
00712              WHEN SQLCODE > ZERO                                  TRKCS127
00713                  MOVE '1110-VERIFY-SHIPMENT'                      TRKCS127
00714                                    TO DP013-PARAGRAPH             TRKCS127
00715                  MOVE 'SELECT FROM TSHIPMT TABLE    '             TRKCS127
00716                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
00717                  MOVE ASC-KEY-BOL-NBR                             TRKCS127
00718                                    TO DP013-MESSAGE-TEXT (2)      TRKCS127
00719                  MOVE ASC-KEY-PRO-NBR                             TRKCS127
00720                                    TO DP013-MESSAGE-TEXT (3)      TRKCS127
00721                  MOVE SQLCA        TO DP013-SQLCA                 TRKCS127
00722                  MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)    TRKCS127
00723                  SET DP013-DB2-ABEND                              TRKCS127
00724                      DP013-XCTL-DISPLAY-RESTART TO TRUE           TRKCS127
00725                  PERFORM DP013-0000-PROCESS-ABEND                 TRKCS127
00726          END-EVALUATE                                             TRKCS127
00727      END-PERFORM.                                                 TRKCS127
00728 *                                                                 TRKCS127
00729      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
00730          MOVE '1110-VERIFY-SHIPMENT'                              TRKCS127
00731                            TO DP013-PARAGRAPH                     TRKCS127
00732          MOVE 'SELECT FROM TSHIPMT TABLE    '                     TRKCS127
00733                            TO DP013-MESSAGE-TEXT (1)              TRKCS127
00734          MOVE ASC-KEY-BOL-NBR      TO DP013-MESSAGE-TEXT (2)      TRKCS127
00735          MOVE ASC-KEY-PRO-NBR      TO DP013-MESSAGE-TEXT (3)      TRKCS127
00736          MOVE SQLCA        TO DP013-SQLCA                         TRKCS127
00737          MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)            TRKCS127
00738          SET DP013-DB2-ABEND                                      TRKCS127
00739              DP013-XCTL-DISPLAY-RESTART TO TRUE                   TRKCS127
00740          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
00741      END-IF.                                                      TRKCS127
00742                                                                   TRKCS127
00743  EJECT                                                            TRKCS127
00744 *----------------------------------------------------------------*TRKCS127
00745 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *TRKCS127
00746 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *TRKCS127
00747 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *TRKCS127
00748 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *TRKCS127
00749 * FUNCTION KEYS CAN GET THIS FAR.                                *TRKCS127
00750 *----------------------------------------------------------------*TRKCS127
00751                                                                   TRKCS127
00752  2000-PROCESS-PANEL.                                              TRKCS127
00753      EVALUATE TRUE                                                TRKCS127
00754          WHEN DP020-SRC-AID = DP016-CLEAR                         TRKCS127
00755              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    TRKCS127
00756              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   TRKCS127
00757              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS127
00758                                                                   TRKCS127
00759          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    TRKCS127
00760              MOVE ASC-KEY-SHIPT-ID TO DK-SHIPT-ID                 TRKCS127
00761              PERFORM 2050-DELETE-LIST-QUEUE                       TRKCS127
00762              PERFORM 4000-BUILD-INITIAL-PANEL                     TRKCS127
00763                                                                   TRKCS127
00764          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    TRKCS127
00765              PERFORM 2140-DESELECT-ALL-ITEMS                      TRKCS127
00766              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS127
00767                                                                   TRKCS127
00768          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  TRKCS127
00769              PERFORM 2150-SELECT-ALL-ITEMS                        TRKCS127
00770              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS127
00771                                                                   TRKCS127
00772          WHEN OTHER                                               TRKCS127
00773              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 TRKCS127
00774              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   TRKCS127
00775              IF  PS-NO-ERROR                                      TRKCS127
00776                  SET DP030-CONTINUE-GO                            TRKCS127
00777                                  TO TRUE                          TRKCS127
00778                  PERFORM 2100-CHECK-FUNCTION-KEY                  TRKCS127
00779              ELSE                                                 TRKCS127
00780                  SET DP030-OVERRIDE-GO                            TRKCS127
00781                                  TO TRUE                          TRKCS127
00782              END-IF                                               TRKCS127
00783      END-EVALUATE.                                                TRKCS127
00784  EJECT                                                            TRKCS127
00785 *----------------------------------------------------------------*TRKCS127
00786 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *TRKCS127
00787 *----------------------------------------------------------------*TRKCS127
00788  2050-DELETE-LIST-QUEUE.                                          TRKCS127
00789                                                                   TRKCS127
00790      EXEC CICS                                                    TRKCS127
00791          DELETEQ TS                                               TRKCS127
00792              QUEUE (ASC-LIST-QUEUE-NAME)                          TRKCS127
00793              RESP  (PV-CICS-RESP)                                 TRKCS127
00794      END-EXEC.                                                    TRKCS127
00795                                                                   TRKCS127
00796      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       TRKCS127
00797         (PV-CICS-RESP = DFHRESP(QIDERR))                          TRKCS127
00798          CONTINUE                                                 TRKCS127
00799      ELSE                                                         TRKCS127
00800          SET DP013-CICS-ABEND      TO TRUE                        TRKCS127
00801          SET DP013-NO-ROLLBACK     TO TRUE                        TRKCS127
00802                                                                   TRKCS127
00803          MOVE '2050-DELETE-LIST-QUEUE'                            TRKCS127
00804                                    TO DP013-PARAGRAPH             TRKCS127
00805          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    TRKCS127
00806                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
00807          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
00808      END-IF.                                                      TRKCS127
00809                                                                   TRKCS127
00810      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  TRKCS127
00811  EJECT                                                            TRKCS127
00812 *----------------------------------------------------------------*TRKCS127
00813 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*TRKCS127
00814 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *TRKCS127
00815 * CICS ARCHITECTURE API.                                         *TRKCS127
00816 *----------------------------------------------------------------*TRKCS127
00817  2100-CHECK-FUNCTION-KEY.                                         TRKCS127
00818      EVALUATE TRUE                                                TRKCS127
00819          WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  TRKCS127
00820              INITIALIZE TR017-INTER-APPL-COMMAREA                 TRKCS127
00821              MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    TRKCS127
00822                             TO TR017-NUMBER-OF-SELECTED-ITEMS     TRKCS127
00823              MOVE ASC-KEY-OPER-UNT-ID                             TRKCS127
00824                                    TO TR017-OPER-UNIT             TRKCS127
00825              MOVE ASC-KEY-FCLTY-ID TO TR017-FCLTY-ID              TRKCS127
00826              MOVE ASC-KEY-SHIPT-ID TO TR017-SHIPT-ID              TRKCS127
00827              MOVE ASC-KEY-BOL-NBR  TO TR017-BOL-NBR               TRKCS127
00828              MOVE ASC-KEY-PRO-NBR  TO TR017-PRO-NBR               TRKCS127
00829              MOVE ASC-KEY-FCLTY-NME                               TRKCS127
00830                                    TO TR017-FCLTY-NME             TRKCS127
00831              IF  ASC-NUMBER-OF-SELECTED-ITEMS > +0                TRKCS127
00832                  PERFORM 5000-PREPARE-SEL-QUEUE                   TRKCS127
00833              END-IF                                               TRKCS127
00834                                                                   TRKCS127
00835          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  TRKCS127
00836              MOVE +1               TO PV-TOP-ITEM                 TRKCS127
00837              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS127
00838                                                                   TRKCS127
00839          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   TRKCS127
00840              PERFORM 2110-BROWSE-BACKWARD                         TRKCS127
00841              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS127
00842                                                                   TRKCS127
00843          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   TRKCS127
00844              PERFORM 2120-BROWSE-FORWARD                          TRKCS127
00845              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 TRKCS127
00846                                                                   TRKCS127
00847          WHEN DP020-SRC-AID = DP016-ENTER                         TRKCS127
00848              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   TRKCS127
00849              IF  PS-ERROR                                         TRKCS127
00850                  CONTINUE                                         TRKCS127
00851              ELSE                                                 TRKCS127
00852                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             TRKCS127
00853              END-IF                                               TRKCS127
00854                                                                   TRKCS127
00855          WHEN OTHER                                               TRKCS127
00856              SET DP013-NO-ROLLBACK                                TRKCS127
00857                  DP013-XCTL-DISPLAY-RESTART                       TRKCS127
00858                  DP013-CICS-ABEND  TO TRUE                        TRKCS127
00859              MOVE '2100-CHECK-FUNCTION-KEY'                       TRKCS127
00860                                    TO DP013-PARAGRAPH             TRKCS127
00861              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      TRKCS127
00862                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
00863              PERFORM DP013-0000-PROCESS-ABEND                     TRKCS127
00864      END-EVALUATE.                                                TRKCS127
00865 *                                                                 TRKCS127
00866 *----------------------------------------------------------------*TRKCS127
00867 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *TRKCS127
00868 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *TRKCS127
00869 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *TRKCS127
00870 *    MESSAGE.                                                    *TRKCS127
00871 *----------------------------------------------------------------*TRKCS127
00872                                                                   TRKCS127
00873  2110-BROWSE-BACKWARD.                                            TRKCS127
00874      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    TRKCS127
00875          GIVING PV-TOP-ITEM.                                      TRKCS127
00876 *                                                                 TRKCS127
00877      IF  ((PV-TOP-ITEM < +1)                                      TRKCS127
00878        OR (PV-TOP-ITEM = +1))                                     TRKCS127
00879          MOVE +1                   TO PV-TOP-ITEM                 TRKCS127
00880 *        -- TOP OF LIST --                                        TRKCS127
00881          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            TRKCS127
00882          SET DP020-MSG-INFORMATIONAL TO TRUE                      TRKCS127
00883      END-IF.                                                      TRKCS127
00884                                                                   TRKCS127
00885  EJECT                                                            TRKCS127
00886 *----------------------------------------------------------------*TRKCS127
00887 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *TRKCS127
00888 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *TRKCS127
00889 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *TRKCS127
00890 *----------------------------------------------------------------*TRKCS127
00891                                                                   TRKCS127
00892  2120-BROWSE-FORWARD.                                             TRKCS127
00893                                                                   TRKCS127
00894      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              TRKCS127
00895          GIVING PV-TOP-ITEM.                                      TRKCS127
00896      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   TRKCS127
00897          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            TRKCS127
00898                                    TO PV-TOP-ITEM                 TRKCS127
00899 *        -- BOTTOM OF LIST --                                     TRKCS127
00900          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            TRKCS127
00901          SET DP020-MSG-INFORMATIONAL                              TRKCS127
00902                                    TO TRUE                        TRKCS127
00903      ELSE                                                         TRKCS127
00904          COMPUTE PV-BOTTOM-ITEM =                                 TRKCS127
00905              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 TRKCS127
00906          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            TRKCS127
00907 *            -- BOTTOM OF LIST --                                 TRKCS127
00908              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            TRKCS127
00909              SET DP020-MSG-INFORMATIONAL                          TRKCS127
00910                                    TO TRUE                        TRKCS127
00911          END-IF                                                   TRKCS127
00912      END-IF.                                                      TRKCS127
00913  EJECT                                                            TRKCS127
00914 *----------------------------------------------------------------*TRKCS127
00915 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *TRKCS127
00916 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *TRKCS127
00917 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *TRKCS127
00918 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *TRKCS127
00919 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *TRKCS127
00920 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *TRKCS127
00921 *----------------------------------------------------------------*TRKCS127
00922                                                                   TRKCS127
00923  2130-CHECK-FOR-JUMP-BROWSE.                                      TRKCS127
00924      SET PS-NO-ERROR               TO TRUE.                       TRKCS127
00925      IF (ASC-START-ITEM-REQUEST = SPACE)                          TRKCS127
00926          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            TRKCS127
00927                                    TO PV-TOP-ITEM                 TRKCS127
00928      ELSE                                                         TRKCS127
00929          MOVE ASC-START-ITEM-REQUEST                              TRKCS127
00930                                    TO DP010I-UNEDITED-FIELD       TRKCS127
00931          MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       TRKCS127
00932          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     TRKCS127
00933          SET DP010I-NEGATIVE-NOT-ALLOWED                          TRKCS127
00934                                    TO TRUE                        TRKCS127
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
00936                                                                   TRKCS127
00937          IF  NOT DP010I-ERROR-DETECTED                            TRKCS127
00938              MOVE DP010I-NUMERIC-FIELD                            TRKCS127
00939                                    TO  ASC-START-ITEM-REQUEST-N   TRKCS127
00940              IF  ASC-START-ITEM-REQUEST-N > ZERO                  TRKCS127
00941                  IF  ASC-START-ITEM-REQUEST-N >                   TRKCS127
00942                                           ASC-NUMBER-OF-ITEMS-READTRKCS127
00943                      MOVE SPACE TO ASC-START-ITEM-REQUEST         TRKCS127
00944                      COMPUTE PV-TOP-ITEM =                        TRKCS127
00945                              ASC-NUMBER-OF-ITEMS-READ             TRKCS127
00946                              - PC-ITEMS-PER-PANEL + 1             TRKCS127
00947                      IF  PV-TOP-ITEM < +1                         TRKCS127
00948                          MOVE +1   TO PV-TOP-ITEM                 TRKCS127
00949                          MOVE PC-TSYMSG-00070                     TRKCS127
00950                                    TO DP020-MSG-NUMBER            TRKCS127
00951                          SET DP020-MSG-INFORMATIONAL              TRKCS127
00952                                    TO TRUE                        TRKCS127
00953                      END-IF                                       TRKCS127
00954                  ELSE                                             TRKCS127
00955                      MOVE ASC-START-ITEM-REQUEST-N                TRKCS127
00956                                    TO PV-TOP-ITEM                 TRKCS127
00957                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      TRKCS127
00958                      COMPUTE PV-BOTTOM-ITEM =                     TRKCS127
00959                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     TRKCS127
00960                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READTRKCS127
00961 *                        -- BOTTOM OF LIST --                     TRKCS127
00962                          MOVE PC-TSYMSG-00070                     TRKCS127
00963                                    TO DP020-MSG-NUMBER            TRKCS127
00964                          SET DP020-MSG-INFORMATIONAL              TRKCS127
00965                                    TO TRUE                        TRKCS127
00966                      END-IF                                       TRKCS127
00967                  END-IF                                           TRKCS127
00968              ELSE                                                 TRKCS127
00969 *                --- VALUE OUT OF RANGE ----                      TRKCS127
00970                  MOVE PC-TSYMSG-00101                             TRKCS127
00971                                    TO DP020-MSG-NUMBER            TRKCS127
00972                  MOVE -1           TO ASTRTPOL                    TRKCS127
00973                  SET DP030-SET-CURSOR-APPL-1                      TRKCS127
00974                                    TO TRUE                        TRKCS127
00975                  MOVE DP015-REVERSE                               TRKCS127
00976                                    TO ASTRTPOH                    TRKCS127
00977                  MOVE DP015-RED    TO ASTRTPOC                    TRKCS127
00978                  MOVE DP015-UNP-NUM-BRT-MDT                       TRKCS127
00979                                    TO ASTRTPOA                    TRKCS127
00980                  SET DP020-MSG-FATAL                              TRKCS127
00981                                    TO TRUE                        TRKCS127
00982                  SET PS-ERROR      TO TRUE                        TRKCS127
00983              END-IF                                               TRKCS127
00984                                                                   TRKCS127
00985          ELSE                                                     TRKCS127
00986              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            TRKCS127
00987              MOVE -1               TO ASTRTPOL                    TRKCS127
00988              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  TRKCS127
00989              MOVE DP015-REVERSE    TO ASTRTPOH                    TRKCS127
00990              MOVE DP015-RED        TO ASTRTPOC                    TRKCS127
00991              MOVE DP015-UNP-NUM-BRT-MDT                           TRKCS127
00992                                    TO ASTRTPOA                    TRKCS127
00993              SET DP020-MSG-FATAL   TO TRUE                        TRKCS127
00994              SET PS-ERROR          TO TRUE                        TRKCS127
00995          END-IF                                                   TRKCS127
00996      END-IF.                                                      TRKCS127
00997  EJECT                                                            TRKCS127
00998 *----------------------------------------------------------------*TRKCS127
00999 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *TRKCS127
01000 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *TRKCS127
01001 *----------------------------------------------------------------*TRKCS127
01002  2140-DESELECT-ALL-ITEMS.                                         TRKCS127
01003      MOVE +1                       TO ASC-BLK-SUB.                TRKCS127
01004                                                                   TRKCS127
01005      PERFORM 2141-CLEAR-SELECTED-INDS                             TRKCS127
01006          VARYING ASC-ITEM-SUB                                     TRKCS127
01007          FROM 1 BY 1                                              TRKCS127
01008          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 TRKCS127
01009                                                                   TRKCS127
01010      ADD +1                        TO ASC-BLK-SUB.                TRKCS127
01011                                                                   TRKCS127
01012      PERFORM 2141-CLEAR-SELECTED-INDS                             TRKCS127
01013          VARYING ASC-ITEM-SUB                                     TRKCS127
01014          FROM 1 BY 1                                              TRKCS127
01015          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 TRKCS127
01016                                                                   TRKCS127
01017      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               TRKCS127
01018                                    TO PV-LIST-ITEM-NUMBER.        TRKCS127
01019                                                                   TRKCS127
01020      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            TRKCS127
01021          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    TRKCS127
01022                                                                   TRKCS127
01023      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     TRKCS127
01024         (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      TRKCS127
01025          MOVE +1                   TO ASC-BLK-SUB                 TRKCS127
01026                                                                   TRKCS127
01027          PERFORM 5100-WRITE-TEMP-STORAGE                          TRKCS127
01028                                                                   TRKCS127
01029          MOVE +1                   TO PV-BLOCK-NUMBER             TRKCS127
01030                                                                   TRKCS127
01031          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         TRKCS127
01032              PV-FIRST-BLOCK-IN-ARRAY - 1                          TRKCS127
01033                                                                   TRKCS127
01034          PERFORM                                                  TRKCS127
01035              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       TRKCS127
01036                                                                   TRKCS127
01037              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01038                                                                   TRKCS127
01039              PERFORM 2141-CLEAR-SELECTED-INDS                     TRKCS127
01040                  VARYING ASC-ITEM-SUB FROM 1 BY 1                 TRKCS127
01041                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          TRKCS127
01042                                                                   TRKCS127
01043              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
01044                                                                   TRKCS127
01045              ADD +1                TO PV-BLOCK-NUMBER             TRKCS127
01046                                                                   TRKCS127
01047          END-PERFORM                                              TRKCS127
01048                                                                   TRKCS127
01049          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         TRKCS127
01050              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     TRKCS127
01051                                                                   TRKCS127
01052          PERFORM                                                  TRKCS127
01053              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       TRKCS127
01054                    ASC-HIGHEST-BLOCK-WRITTEN                      TRKCS127
01055                                                                   TRKCS127
01056              MOVE PV-NEXT-BLOCK-IN-ARRAY                          TRKCS127
01057                                    TO PV-BLOCK-NUMBER             TRKCS127
01058                                                                   TRKCS127
01059              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01060                                                                   TRKCS127
01061              PERFORM 2141-CLEAR-SELECTED-INDS                     TRKCS127
01062                  VARYING ASC-ITEM-SUB                             TRKCS127
01063                  FROM 1 BY 1                                      TRKCS127
01064                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          TRKCS127
01065                                                                   TRKCS127
01066              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
01067                                                                   TRKCS127
01068              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      TRKCS127
01069                                                                   TRKCS127
01070          END-PERFORM                                              TRKCS127
01071                                                                   TRKCS127
01072          MOVE PV-FIRST-BLOCK-IN-ARRAY                             TRKCS127
01073                                    TO PV-BLOCK-NUMBER             TRKCS127
01074                                                                   TRKCS127
01075          PERFORM 4410-READ-TEMP-STORAGE                           TRKCS127
01076      END-IF.                                                      TRKCS127
01077                                                                   TRKCS127
01078                                                                   TRKCS127
01079      MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. TRKCS127
01080      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.TRKCS127
01081      MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  TRKCS127
01082                                                                   TRKCS127
01083  EJECT                                                            TRKCS127
01084 *----------------------------------------------------------------*TRKCS127
01085 *    MARK EACH ITEM AS BEING NOT SELECTED.                       *TRKCS127
01086 *----------------------------------------------------------------*TRKCS127
01087                                                                   TRKCS127
01088  2141-CLEAR-SELECTED-INDS.                                        TRKCS127
01089                                                                   TRKCS127
01090      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           TRKCS127
01091              NOT EQUAL ZERO                                       TRKCS127
01092          IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          TRKCS127
01093              SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          TRKCS127
01094                  ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    TRKCS127
01095                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  TRKCS127
01096                                    TO TRUE                        TRKCS127
01097          END-IF                                                   TRKCS127
01098      END-IF.                                                      TRKCS127
01099                                                                   TRKCS127
01100  EJECT                                                            TRKCS127
01101 *----------------------------------------------------------------*TRKCS127
01102 *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *TRKCS127
01103 *  FOR ALL ITEMS.                                                *TRKCS127
01104 *----------------------------------------------------------------*TRKCS127
01105                                                                   TRKCS127
01106  2150-SELECT-ALL-ITEMS.                                           TRKCS127
01107                                                                   TRKCS127
01108      MOVE +1                       TO ASC-BLK-SUB.                TRKCS127
01109                                                                   TRKCS127
01110      PERFORM 2151-SET-SELECTED-INDS                               TRKCS127
01111          VARYING ASC-ITEM-SUB                                     TRKCS127
01112          FROM 1 BY 1                                              TRKCS127
01113          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 TRKCS127
01114                                                                   TRKCS127
01115      ADD +1                        TO ASC-BLK-SUB.                TRKCS127
01116                                                                   TRKCS127
01117      PERFORM 2151-SET-SELECTED-INDS                               TRKCS127
01118          VARYING ASC-ITEM-SUB                                     TRKCS127
01119          FROM 1 BY 1                                              TRKCS127
01120          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 TRKCS127
01121                                                                   TRKCS127
01122      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               TRKCS127
01123                                    TO PV-LIST-ITEM-NUMBER.        TRKCS127
01124                                                                   TRKCS127
01125      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            TRKCS127
01126          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    TRKCS127
01127                                                                   TRKCS127
01128      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     TRKCS127
01129         (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    TRKCS127
01130          MOVE +1                   TO ASC-BLK-SUB                 TRKCS127
01131                                                                   TRKCS127
01132          PERFORM 5100-WRITE-TEMP-STORAGE                          TRKCS127
01133                                                                   TRKCS127
01134          MOVE +1                   TO PV-BLOCK-NUMBER             TRKCS127
01135                                                                   TRKCS127
01136          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         TRKCS127
01137              PV-FIRST-BLOCK-IN-ARRAY - 1                          TRKCS127
01138                                                                   TRKCS127
01139          PERFORM                                                  TRKCS127
01140              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       TRKCS127
01141                                                                   TRKCS127
01142              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01143                                                                   TRKCS127
01144              PERFORM 2151-SET-SELECTED-INDS                       TRKCS127
01145                  VARYING ASC-ITEM-SUB                             TRKCS127
01146                  FROM 1 BY 1                                      TRKCS127
01147                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          TRKCS127
01148                                                                   TRKCS127
01149              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
01150                                                                   TRKCS127
01151              ADD +1                TO PV-BLOCK-NUMBER             TRKCS127
01152                                                                   TRKCS127
01153          END-PERFORM                                              TRKCS127
01154                                                                   TRKCS127
01155          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         TRKCS127
01156              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     TRKCS127
01157                                                                   TRKCS127
01158          PERFORM                                                  TRKCS127
01159              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       TRKCS127
01160                    ASC-HIGHEST-BLOCK-WRITTEN                      TRKCS127
01161                                                                   TRKCS127
01162              MOVE PV-NEXT-BLOCK-IN-ARRAY                          TRKCS127
01163                                    TO PV-BLOCK-NUMBER             TRKCS127
01164                                                                   TRKCS127
01165              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01166                                                                   TRKCS127
01167              PERFORM 2151-SET-SELECTED-INDS                       TRKCS127
01168                  VARYING ASC-ITEM-SUB                             TRKCS127
01169                  FROM 1 BY 1                                      TRKCS127
01170                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          TRKCS127
01171                                                                   TRKCS127
01172              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
01173                                                                   TRKCS127
01174              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      TRKCS127
01175                                                                   TRKCS127
01176          END-PERFORM                                              TRKCS127
01177                                                                   TRKCS127
01178          MOVE PV-FIRST-BLOCK-IN-ARRAY                             TRKCS127
01179                                    TO PV-BLOCK-NUMBER             TRKCS127
01180                                                                   TRKCS127
01181          PERFORM 4410-READ-TEMP-STORAGE                           TRKCS127
01182      END-IF.                                                      TRKCS127
01183                                                                   TRKCS127
01184                                                                   TRKCS127
01185      MOVE ASC-NUMBER-OF-ITEMS-READ TO                             TRKCS127
01186                        ASC-NUMBER-OF-SELECTED-ITEMS.              TRKCS127
01187                                                                   TRKCS127
01188  EJECT                                                            TRKCS127
01189 *----------------------------------------------------------------*TRKCS127
01190 *    MARK EACH ITEM AS BEING SELECTED.                           *TRKCS127
01191 *----------------------------------------------------------------*TRKCS127
01192                                                                   TRKCS127
01193  2151-SET-SELECTED-INDS.                                          TRKCS127
01194                                                                   TRKCS127
01195      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           TRKCS127
01196              NOT EQUAL ZERO                                       TRKCS127
01197          IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             TRKCS127
01198              SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             TRKCS127
01199                  ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        TRKCS127
01200                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  TRKCS127
01201                                TO  TRUE                           TRKCS127
01202          END-IF                                                   TRKCS127
01203      END-IF.                                                      TRKCS127
01204 ******************************************************************TRKCS127
01205 ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **TRKCS127
01206 ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **TRKCS127
01207 ******************************************************************TRKCS127
01208  2200-MOVE-SCREEN-TO-COMMAREA.                                    TRKCS127
01209                                                                   TRKCS127
01210      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             TRKCS127
01211      MOVE +1                       TO PV-SUB.                     TRKCS127
01212 *                                                                 TRKCS127
01213      PERFORM 3100-SET-SUBSCRIPTS.                                 TRKCS127
01214      IF  ASTRTPOL > ZERO                                          TRKCS127
01215          MOVE ASTRTPOI         TO ASC-START-ITEM-REQUEST          TRKCS127
01216      ELSE                                                         TRKCS127
01217          IF  ASTRTPOF = DP015-ERASE-EOF                           TRKCS127
01218              INITIALIZE ASC-START-ITEM-REQUEST                    TRKCS127
01219          END-IF                                                   TRKCS127
01220      END-IF.                                                      TRKCS127
01221      PERFORM 2210-MOVE-LINES-TO-COMMAREA                          TRKCS127
01222          VARYING PV-SUB                                           TRKCS127
01223          FROM 1 BY 1                                              TRKCS127
01224          UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      TRKCS127
01225 ******************************************************************TRKCS127
01226 ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**TRKCS127
01227 ******************************************************************TRKCS127
01228  2210-MOVE-LINES-TO-COMMAREA.                                     TRKCS127
01229      IF  MR-SELECTL (PV-SUB) > ZERO                               TRKCS127
01230          SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             TRKCS127
01231          MOVE MR-SELECTI (PV-SUB)                                 TRKCS127
01232                                    TO ASC-TEMP-SELECTED-SW        TRKCS127
01233                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      TRKCS127
01234      ELSE                                                         TRKCS127
01235          IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                TRKCS127
01236                  SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     TRKCS127
01237                  MOVE SPACE        TO ASC-TEMP-SELECTED-SW        TRKCS127
01238                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      TRKCS127
01239          END-IF                                                   TRKCS127
01240      END-IF.                                                      TRKCS127
01241      ADD +1                        TO ASC-ITEM-SUB.               TRKCS127
01242      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        TRKCS127
01243          ADD +1                    TO ASC-BLK-SUB                 TRKCS127
01244          MOVE +1                   TO ASC-ITEM-SUB                TRKCS127
01245      END-IF.                                                      TRKCS127
01246 ******************************************************************TRKCS127
01247 ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **TRKCS127
01248 ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **TRKCS127
01249 ******************************************************************TRKCS127
01250  3000-EDIT-DATA-IN-COMMAREA.                                      TRKCS127
01251      SET PS-NO-ERROR               TO TRUE.                       TRKCS127
01252      PERFORM 3200-RESET-ATTRIBUTES.                               TRKCS127
01253      MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     TRKCS127
01254 **                                                                TRKCS127
01255 * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              TRKCS127
01256 * EDITTING IS DONE FROM THE BOTTOM UP.                            TRKCS127
01257 **                                                                TRKCS127
01258      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       TRKCS127
01259          ASC-ITEMS-DISPLAYED - 1.                                 TRKCS127
01260      PERFORM 3100-SET-SUBSCRIPTS.                                 TRKCS127
01261      PERFORM 3300-EDIT-SELECTIONS                                 TRKCS127
01262          VARYING PV-SUB                                           TRKCS127
01263          FROM PV-SUB BY -1                                        TRKCS127
01264          UNTIL PV-SUB < +1                                        TRKCS127
01265 *                                                                 TRKCS127
01266      IF  PS-NO-ERROR                                              TRKCS127
01267          PERFORM 3400-CHECK-RANGE-SEQUENCE                        TRKCS127
01268      END-IF.                                                      TRKCS127
01269 *                                                                 TRKCS127
01270      IF  ((PS-NO-ERROR)                                           TRKCS127
01271        AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   TRKCS127
01272        AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    TRKCS127
01273              PERFORM 3500-MARK-RANGE-AS-SELECTED                  TRKCS127
01274      END-IF.                                                      TRKCS127
01275  EJECT                                                            TRKCS127
01276 *----------------------------------------------------------------*TRKCS127
01277 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *TRKCS127
01278 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*TRKCS127
01279 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *TRKCS127
01280 *                                                                *TRKCS127
01281 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *TRKCS127
01282 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *TRKCS127
01283 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *TRKCS127
01284 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *TRKCS127
01285 *----------------------------------------------------------------*TRKCS127
01286                                                                   TRKCS127
01287  3100-SET-SUBSCRIPTS.                                             TRKCS127
01288                                                                   TRKCS127
01289      COMPUTE ASC-ITEM-SUB =                                       TRKCS127
01290          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        TRKCS127
01291                                                                   TRKCS127
01292      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         TRKCS127
01293          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            TRKCS127
01294                                                                   TRKCS127
01295          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               TRKCS127
01296      ELSE                                                         TRKCS127
01297          MOVE +1                     TO ASC-BLK-SUB               TRKCS127
01298      END-IF.                                                      TRKCS127
01299 ******************************************************************TRKCS127
01300 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **TRKCS127
01301 ******************************************************************TRKCS127
01302                                                                   TRKCS127
01303  3200-RESET-ATTRIBUTES.                                           TRKCS127
01304      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTPOA.                   TRKCS127
01305      MOVE DP015-GREEN              TO ASTRTPOC.                   TRKCS127
01306      MOVE DP015-UNDERLINE          TO ASTRTPOH.                   TRKCS127
01307 *                                                                 TRKCS127
01308      PERFORM                                                      TRKCS127
01309          VARYING PV-SUB                                           TRKCS127
01310          FROM 1 BY 1                                              TRKCS127
01311          UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        TRKCS127
01312          MOVE DP015-UNP-ALP-NOR-OFF                               TRKCS127
01313                                    TO MR-SELECTA (PV-SUB)         TRKCS127
01314          MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         TRKCS127
01315          MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         TRKCS127
01316      END-PERFORM.                                                 TRKCS127
01317 ******************************************************************TRKCS127
01318 ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **TRKCS127
01319 ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **TRKCS127
01320 ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **TRKCS127
01321 ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **TRKCS127
01322 ******************************************************************TRKCS127
01323  3300-EDIT-SELECTIONS.                                            TRKCS127
01324      EVALUATE TRUE                                                TRKCS127
01325          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     TRKCS127
01326              = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         TRKCS127
01327                  CONTINUE                                         TRKCS127
01328          WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         TRKCS127
01329              IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        TRKCS127
01330                  ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   TRKCS127
01331                  MOVE ASC-TEMP-SELECTED-SW                        TRKCS127
01332                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01333                                 TO ASC-SELECTED-SW                TRKCS127
01334                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01335              END-IF                                               TRKCS127
01336          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     TRKCS127
01337                  = SPACE                                          TRKCS127
01338              EVALUATE TRUE                                        TRKCS127
01339                  WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       TRKCS127
01340                      SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSTRKCS127
01341                      MOVE SPACE TO ASC-SELECTED-SW                TRKCS127
01342                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01343                  WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        TRKCS127
01344                      MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    TRKCS127
01345                      MOVE SPACE TO ASC-SELECTED-SW                TRKCS127
01346                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01347                  WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          TRKCS127
01348                      MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      TRKCS127
01349                      MOVE SPACE TO ASC-SELECTED-SW                TRKCS127
01350                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01351              END-EVALUATE                                         TRKCS127
01352          WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           TRKCS127
01353              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            TRKCS127
01354                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    TRKCS127
01355              END-IF                                               TRKCS127
01356              PERFORM 3310-EDIT-RANGE                              TRKCS127
01357          WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             TRKCS127
01358              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            TRKCS127
01359                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    TRKCS127
01360              END-IF                                               TRKCS127
01361              PERFORM 3310-EDIT-RANGE                              TRKCS127
01362          WHEN OTHER                                               TRKCS127
01363              MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           TRKCS127
01364              SET DP020-MSG-FATAL    TO TRUE                       TRKCS127
01365              MOVE -1                TO MR-SELECTL (PV-SUB)        TRKCS127
01366              SET DP030-SET-CURSOR-APPL-1                          TRKCS127
01367                                     TO TRUE                       TRKCS127
01368              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        TRKCS127
01369              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        TRKCS127
01370              SET PS-ERROR TO TRUE                                 TRKCS127
01371              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            TRKCS127
01372                  SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     TRKCS127
01373                  MOVE SPACE         TO ASC-SELECTED-SW            TRKCS127
01374                                         (ASC-BLK-SUB ASC-ITEM-SUB)TRKCS127
01375              END-IF                                               TRKCS127
01376      END-EVALUATE.                                                TRKCS127
01377                                                                   TRKCS127
01378      SUBTRACT +1             FROM PV-ITEM-IN-USE.                 TRKCS127
01379      SUBTRACT +1 FROM ASC-ITEM-SUB.                               TRKCS127
01380      IF  ASC-ITEM-SUB < 1                                         TRKCS127
01381          SUBTRACT +1 FROM ASC-BLK-SUB                             TRKCS127
01382          MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                TRKCS127
01383      END-IF.                                                      TRKCS127
01384 ******************************************************************TRKCS127
01385 ** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **TRKCS127
01386 ** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **TRKCS127
01387 ** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**TRKCS127
01388 ** THE ENDING.                                                  **TRKCS127
01389 ******************************************************************TRKCS127
01390  3310-EDIT-RANGE.                                                 TRKCS127
01391      IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                TRKCS127
01392          IF  ASC-START-OF-SELECTED-RANGE = ZERO                   TRKCS127
01393              MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)TRKCS127
01394                                    TO ASC-SELECTED-SW             TRKCS127
01395                                         (ASC-BLK-SUB ASC-ITEM-SUB)TRKCS127
01396              MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE TRKCS127
01397          ELSE                                                     TRKCS127
01398              IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     TRKCS127
01399                  CONTINUE                                         TRKCS127
01400              ELSE                                                 TRKCS127
01401 *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        TRKCS127
01402                  MOVE PC-TSYMSG-00054                             TRKCS127
01403                                    TO DP020-MSG-NUMBER            TRKCS127
01404                  SET DP020-MSG-FATAL                              TRKCS127
01405                                    TO TRUE                        TRKCS127
01406                  MOVE -1           TO MR-SELECTL (PV-SUB)         TRKCS127
01407                  SET DP030-SET-CURSOR-APPL-1                      TRKCS127
01408                                    TO TRUE                        TRKCS127
01409                  MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         TRKCS127
01410                  MOVE DP015-UNDERLINE                             TRKCS127
01411                                    TO MR-SELECTH (PV-SUB)         TRKCS127
01412                  SET PS-ERROR      TO TRUE                        TRKCS127
01413              END-IF                                               TRKCS127
01414          END-IF                                                   TRKCS127
01415      ELSE                                                         TRKCS127
01416          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     TRKCS127
01417              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01418                                    TO ASC-SELECTED-SW             TRKCS127
01419                                      (ASC-BLK-SUB ASC-ITEM-SUB)   TRKCS127
01420              MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   TRKCS127
01421          ELSE                                                     TRKCS127
01422              IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       TRKCS127
01423                  CONTINUE                                         TRKCS127
01424              ELSE                                                 TRKCS127
01425 *                -- ONLY ONE END-OF-RANGE ALLOWED --              TRKCS127
01426                  MOVE PC-TSYMSG-00055                             TRKCS127
01427                                    TO DP020-MSG-NUMBER            TRKCS127
01428                  SET DP020-MSG-FATAL                              TRKCS127
01429                                    TO TRUE                        TRKCS127
01430                  MOVE -1           TO MR-SELECTL (PV-SUB)         TRKCS127
01431                  SET DP030-SET-CURSOR-APPL-1                      TRKCS127
01432                                    TO TRUE                        TRKCS127
01433                  SET PS-ERROR      TO TRUE                        TRKCS127
01434              END-IF                                               TRKCS127
01435          END-IF                                                   TRKCS127
01436      END-IF.                                                      TRKCS127
01437 *                                                                 TRKCS127
01438 ******************************************************************TRKCS127
01439 ** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **TRKCS127
01440 ** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **TRKCS127
01441 ******************************************************************TRKCS127
01442  3400-CHECK-RANGE-SEQUENCE.                                       TRKCS127
01443      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       TRKCS127
01444        AND  ASC-END-OF-SELECTED-RANGE > ZERO                      TRKCS127
01445        AND  ASC-START-OF-SELECTED-RANGE >                         TRKCS127
01446                                          ASC-END-OF-SELECTED-RANGETRKCS127
01447 *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                TRKCS127
01448          MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 TRKCS127
01449          SET DP020-MSG-FATAL TO TRUE                              TRKCS127
01450          SET PS-ERROR TO TRUE                                     TRKCS127
01451          PERFORM 3410-POSITION-AT-ERROR                           TRKCS127
01452      END-IF.                                                      TRKCS127
01453 ******************************************************************TRKCS127
01454 ** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **TRKCS127
01455 ** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **TRKCS127
01456 ** SHOULD BE POSITIONED ON A RANGE ERROR.                       **TRKCS127
01457 ******************************************************************TRKCS127
01458  3410-POSITION-AT-ERROR.                                          TRKCS127
01459      SET DP030-SET-CURSOR-APPL-1                                  TRKCS127
01460                                    TO TRUE.                       TRKCS127
01461      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 TRKCS127
01462                     - PV-TOP-ITEM + 1.                            TRKCS127
01463      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      TRKCS127
01464          CONTINUE                                                 TRKCS127
01465      ELSE                                                         TRKCS127
01466          MOVE -1                   TO MR-SELECTL (PV-SUB)         TRKCS127
01467          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         TRKCS127
01468          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         TRKCS127
01469      END-IF.                                                      TRKCS127
01470 *                                                                 TRKCS127
01471      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   TRKCS127
01472                     - PV-TOP-ITEM + 1.                            TRKCS127
01473      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      TRKCS127
01474          CONTINUE                                                 TRKCS127
01475      ELSE                                                         TRKCS127
01476          MOVE -1                   TO MR-SELECTL (PV-SUB)         TRKCS127
01477          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         TRKCS127
01478          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         TRKCS127
01479      END-IF.                                                      TRKCS127
01480  EJECT                                                            TRKCS127
01481 *----------------------------------------------------------------*TRKCS127
01482 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *TRKCS127
01483 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *TRKCS127
01484 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *TRKCS127
01485 *----------------------------------------------------------------*TRKCS127
01486                                                                   TRKCS127
01487  3500-MARK-RANGE-AS-SELECTED.                                     TRKCS127
01488      MOVE +1                       TO  ASC-BLK-SUB.               TRKCS127
01489      PERFORM 3510-MARK-SELECTED-INDS                              TRKCS127
01490          VARYING ASC-ITEM-SUB                                     TRKCS127
01491          FROM 1 BY 1                                              TRKCS127
01492          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 TRKCS127
01493                                                                   TRKCS127
01494      ADD +1                        TO ASC-BLK-SUB.                TRKCS127
01495      PERFORM 3510-MARK-SELECTED-INDS                              TRKCS127
01496          VARYING ASC-ITEM-SUB                                     TRKCS127
01497          FROM 1 BY 1                                              TRKCS127
01498          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 TRKCS127
01499                                                                   TRKCS127
01500      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               TRKCS127
01501                                    TO  PV-LIST-ITEM-NUMBER.       TRKCS127
01502      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            TRKCS127
01503          1 + ((PV-LIST-ITEM-NUMBER - 1) /                         TRKCS127
01504                PC-ITEMS-PER-PANEL).                               TRKCS127
01505                                                                   TRKCS127
01506      MOVE ASC-START-OF-SELECTED-RANGE                             TRKCS127
01507                                    TO PV-START-OF-SELECTED-RANGE. TRKCS127
01508      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            TRKCS127
01509          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  TRKCS127
01510                PC-ITEMS-PER-PANEL).                               TRKCS127
01511                                                                   TRKCS127
01512      MOVE ASC-END-OF-SELECTED-RANGE                               TRKCS127
01513                                    TO  PV-END-OF-SELECTED-RANGE.  TRKCS127
01514      COMPUTE PV-LAST-BLOCK-IN-RANGE =                             TRKCS127
01515          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    TRKCS127
01516                PC-ITEMS-PER-PANEL).                               TRKCS127
01517      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             TRKCS127
01518          PV-FIRST-BLOCK-IN-ARRAY + 1.                             TRKCS127
01519                                                                   TRKCS127
01520      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    TRKCS127
01521         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        TRKCS127
01522          MOVE +1                   TO ASC-BLK-SUB                 TRKCS127
01523          PERFORM 5100-WRITE-TEMP-STORAGE                          TRKCS127
01524          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         TRKCS127
01525              PV-FIRST-BLOCK-IN-ARRAY - 1                          TRKCS127
01526                                                                   TRKCS127
01527          PERFORM                                                  TRKCS127
01528              UNTIL PV-FIRST-BLOCK-IN-RANGE >                      TRKCS127
01529                    PV-PREV-BLOCK-IN-ARRAY                         TRKCS127
01530              MOVE PV-FIRST-BLOCK-IN-RANGE                         TRKCS127
01531                                    TO PV-BLOCK-NUMBER             TRKCS127
01532              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01533              PERFORM 3510-MARK-SELECTED-INDS                      TRKCS127
01534                  VARYING ASC-ITEM-SUB                             TRKCS127
01535                  FROM 1 BY 1                                      TRKCS127
01536                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          TRKCS127
01537              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
01538              ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     TRKCS127
01539          END-PERFORM                                              TRKCS127
01540                                                                   TRKCS127
01541          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         TRKCS127
01542              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     TRKCS127
01543          PERFORM                                                  TRKCS127
01544              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       TRKCS127
01545                    PV-LAST-BLOCK-IN-RANGE                         TRKCS127
01546              MOVE PV-NEXT-BLOCK-IN-ARRAY                          TRKCS127
01547                                    TO PV-BLOCK-NUMBER             TRKCS127
01548              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01549              PERFORM 3510-MARK-SELECTED-INDS                      TRKCS127
01550                  VARYING ASC-ITEM-SUB                             TRKCS127
01551                  FROM 1 BY 1                                      TRKCS127
01552                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          TRKCS127
01553              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
01554              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      TRKCS127
01555          END-PERFORM                                              TRKCS127
01556                                                                   TRKCS127
01557          MOVE PV-FIRST-BLOCK-IN-ARRAY                             TRKCS127
01558                                    TO PV-BLOCK-NUMBER             TRKCS127
01559          PERFORM 4410-READ-TEMP-STORAGE                           TRKCS127
01560      END-IF.                                                      TRKCS127
01561                                                                   TRKCS127
01562      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE TRKCS127
01563                                       ASC-END-OF-SELECTED-RANGE.  TRKCS127
01564                                                                   TRKCS127
01565  EJECT                                                            TRKCS127
01566 *----------------------------------------------------------------*TRKCS127
01567 * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *TRKCS127
01568 *----------------------------------------------------------------*TRKCS127
01569                                                                   TRKCS127
01570  3510-MARK-SELECTED-INDS.                                         TRKCS127
01571                                                                   TRKCS127
01572      IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         TRKCS127
01573                                 ASC-ITEM-SUB) >                   TRKCS127
01574          ASC-START-OF-SELECTED-RANGE)                             TRKCS127
01575      OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         TRKCS127
01576                                 ASC-ITEM-SUB) =                   TRKCS127
01577          ASC-START-OF-SELECTED-RANGE)                             TRKCS127
01578                                                                   TRKCS127
01579          IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     TRKCS127
01580                                     ASC-ITEM-SUB) <               TRKCS127
01581              ASC-END-OF-SELECTED-RANGE)                           TRKCS127
01582          OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     TRKCS127
01583                                     ASC-ITEM-SUB) =               TRKCS127
01584              ASC-END-OF-SELECTED-RANGE)                           TRKCS127
01585                                                                   TRKCS127
01586              IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          TRKCS127
01587                  SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   TRKCS127
01588                      ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   TRKCS127
01589                                TO TRUE                            TRKCS127
01590                  SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              TRKCS127
01591                                TO TRUE                            TRKCS127
01592                  ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    TRKCS127
01593              END-IF                                               TRKCS127
01594          END-IF                                                   TRKCS127
01595      END-IF.                                                      TRKCS127
01596                                                                   TRKCS127
01597  EJECT                                                            TRKCS127
01598 *----------------------------------------------------------------*TRKCS127
01599 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *TRKCS127
01600 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *TRKCS127
01601 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *TRKCS127
01602 *    DISPLAY THE PANEL TO USER.                                  *TRKCS127
01603 *----------------------------------------------------------------*TRKCS127
01604                                                                   TRKCS127
01605  4000-BUILD-INITIAL-PANEL.                                        TRKCS127
01606                                                                   TRKCS127
01607      INITIALIZE                  ASC-BLOCK-ENTRIES (1)            TRKCS127
01608                                  ASC-BLOCK-ENTRIES (2).           TRKCS127
01609      MOVE +1                 TO ASC-BLK-SUB.                      TRKCS127
01610      SET ASC-ITEMS-LEFT-ON-DB                                     TRKCS127
01611                              TO TRUE.                             TRKCS127
01612                                                                   TRKCS127
01613      MOVE +0                 TO ASC-ITEM-SUB                      TRKCS127
01614                                 ASC-NUMBER-OF-ITEMS-READ          TRKCS127
01615                                 ASC-NUMBER-OF-SELECTED-ITEMS      TRKCS127
01616                                 ASC-HIGHEST-BLOCK-WRITTEN         TRKCS127
01617                                 ASC-START-OF-SELECTED-RANGE       TRKCS127
01618                                 ASC-END-OF-SELECTED-RANGE         TRKCS127
01619                                 ASC-ITEM-AT-TOP-OF-PANEL.         TRKCS127
01620                                                                   TRKCS127
01621      PERFORM 4100-SELECT-VND-SHIP-DTE.                            TRKCS127
01622                                                                   TRKCS127
01623      PERFORM 4010-OPEN-CURSOR.                                    TRKCS127
01624                                                                   TRKCS127
01625      PERFORM 4300-READ-ITEMS-FROM-DB.                             TRKCS127
01626                                                                   TRKCS127
01627      PERFORM 4020-CLOSE-CURSOR.                                   TRKCS127
01628                                                                   TRKCS127
01629      MOVE +1                   TO  PV-TOP-ITEM.                   TRKCS127
01630      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          TRKCS127
01631          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    TRKCS127
01632          SET DP020-MSG-FATAL   TO  TRUE                           TRKCS127
01633          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               TRKCS127
01634      ELSE                                                         TRKCS127
01635          MOVE -1               TO MR-SELECTL (1)                  TRKCS127
01636          SET DP030-SET-CURSOR-APPL-1                              TRKCS127
01637                                TO TRUE                            TRKCS127
01638          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     TRKCS127
01639      END-IF.                                                      TRKCS127
01640  EJECT                                                            TRKCS127
01641 *----------------------------------------------------------------*TRKCS127
01642 * OPEN THE TMESSAGE CURSOR.                                      *TRKCS127
01643 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *TRKCS127
01644 *   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *TRKCS127
01645 *   USER.                                                        *TRKCS127
01646 *----------------------------------------------------------------*TRKCS127
01647                                                                   TRKCS127
01648  4010-OPEN-CURSOR.                                                TRKCS127
01649      PERFORM                                                      TRKCS127
01650          WITH TEST AFTER                                          TRKCS127
01651          VARYING PV-RETRY-COUNTER                                 TRKCS127
01652          FROM 1 BY 1                                              TRKCS127
01653          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
01654                    OR (SQLCODE = ZERO))                           TRKCS127
01655                                                                   TRKCS127
01656          MOVE 'CURSOR:  PO-CSR'    TO DP013-MESSAGE-TEXT (2)      TRKCS127
01657                                                                   TRKCS127
01658          EXEC SQL                                                 TRKCS127
01659               OPEN PO-CSR                                         TRKCS127
01660          END-EXEC                                                 TRKCS127
01661                                                                   TRKCS127
01662          EVALUATE TRUE                                            TRKCS127
01663              WHEN SQLCODE = ZERO                                  TRKCS127
01664              WHEN SQLCODE = -904                                  TRKCS127
01665              WHEN SQLCODE = -913                                  TRKCS127
01666                  CONTINUE                                         TRKCS127
01667              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
01668              WHEN SQLCODE < ZERO                                  TRKCS127
01669              WHEN SQLCODE > ZERO                                  TRKCS127
01670                  MOVE '4010-OPEN-CURSOR'                          TRKCS127
01671                                    TO DP013-PARAGRAPH             TRKCS127
01672                  MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             TRKCS127
01673                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
01674                  MOVE SQLCA        TO DP013-SQLCA                 TRKCS127
01675                  MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    TRKCS127
01676                  SET DP013-DB2-ABEND                              TRKCS127
01677                      DP013-XCTL-DISPLAY-RESTART TO TRUE           TRKCS127
01678                  PERFORM DP013-0000-PROCESS-ABEND                 TRKCS127
01679          END-EVALUATE                                             TRKCS127
01680      END-PERFORM.                                                 TRKCS127
01681 *                                                                 TRKCS127
01682      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
01683          MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             TRKCS127
01684          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   TRKCS127
01685                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
01686          MOVE SQLCA                TO DP013-SQLCA                 TRKCS127
01687          MOVE 'TSHPTPO '           TO DP013-DB2-TABLE-NAME (1)    TRKCS127
01688          SET DP013-DB2-ABEND                                      TRKCS127
01689              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
01690                                    TO TRUE                        TRKCS127
01691          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
01692      END-IF.                                                      TRKCS127
01693                                                                   TRKCS127
01694  EJECT                                                            TRKCS127
01695 *----------------------------------------------------------------*TRKCS127
01696 * CLOSE THE TMESSAGE CURSOR.                                     *TRKCS127
01697 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *TRKCS127
01698 *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *TRKCS127
01699 *   USER.                                                        *TRKCS127
01700 *----------------------------------------------------------------*TRKCS127
01701                                                                   TRKCS127
01702  4020-CLOSE-CURSOR.                                               TRKCS127
01703                                                                   TRKCS127
01704      EXEC SQL                                                     TRKCS127
01705          CLOSE PO-CSR                                             TRKCS127
01706      END-EXEC.                                                    TRKCS127
01707 *                                                                 TRKCS127
01708      EVALUATE TRUE                                                TRKCS127
01709          WHEN SQLCODE = ZERO                                      TRKCS127
01710              CONTINUE                                             TRKCS127
01711          WHEN SQLWARN0 NOT = SPACES                               TRKCS127
01712          WHEN SQLCODE < ZERO                                      TRKCS127
01713          WHEN SQLCODE > ZERO                                      TRKCS127
01714              MOVE '4020-CLOSE-CURSOR'                             TRKCS127
01715                                TO DP013-PARAGRAPH                 TRKCS127
01716              MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  TRKCS127
01717                                TO DP013-MESSAGE-TEXT (1)          TRKCS127
01718              MOVE SQLCA        TO DP013-SQLCA                     TRKCS127
01719              MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)        TRKCS127
01720              SET DP013-DB2-ABEND                                  TRKCS127
01721                  DP013-XCTL-DISPLAY-RESTART TO TRUE               TRKCS127
01722              PERFORM DP013-0000-PROCESS-ABEND                     TRKCS127
01723      END-EVALUATE.                                                TRKCS127
01724                                                                   TRKCS127
01725 *----------------------------------------------------------------*TRKCS127
01726 * SELECT THE VENDOR SHIP DATE.                                   *TRKCS127
01727 *----------------------------------------------------------------*TRKCS127
01728                                                                   TRKCS127
01729  4100-SELECT-VND-SHIP-DTE.                                        TRKCS127
01730      PERFORM                                                      TRKCS127
01731          WITH TEST AFTER                                          TRKCS127
01732          VARYING PV-RETRY-COUNTER                                 TRKCS127
01733          FROM 1 BY 1                                              TRKCS127
01734          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
01735                    OR (SQLCODE = +100)                            TRKCS127
01736                    OR (SQLCODE = ZERO))                           TRKCS127
01737                                                                   TRKCS127
01738                                                                   TRKCS127
01739          EXEC SQL                                                 TRKCS127
01740               SELECT                                              TRKCS127
01741                        VEND_SHIP_DTE                              TRKCS127
01742               INTO                                                TRKCS127
01743                       :SHIPMT-VEND-SHIP-DTE                       TRKCS127
01744               FROM                                                TRKCS127
01745                        TSHIPMT                                    TRKCS127
01746               WHERE                                               TRKCS127
01747                        SHIPT_ID = :DK-SHIPT-ID                    TRKCS127
01748          END-EXEC                                                 TRKCS127
01749                                                                   TRKCS127
01750          EVALUATE TRUE                                            TRKCS127
01751              WHEN SQLCODE = ZERO                                  TRKCS127
01752              WHEN SQLCODE = +100                                  TRKCS127
01753              WHEN SQLCODE = -904                                  TRKCS127
01754              WHEN SQLCODE = -913                                  TRKCS127
01755                  CONTINUE                                         TRKCS127
01756              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
01757              WHEN SQLCODE < ZERO                                  TRKCS127
01758              WHEN SQLCODE > ZERO                                  TRKCS127
01759                  MOVE '4100-SELECT-VND-SHIP-DTE'                  TRKCS127
01760                                    TO DP013-PARAGRAPH             TRKCS127
01761                  MOVE 'SELECT THE VENDOR SHIP DATE  '             TRKCS127
01762                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
01763                  MOVE DK-SHIPT-ID  TO DP013-MESSAGE-TEXT (3)      TRKCS127
01764                  MOVE SQLCA        TO DP013-SQLCA                 TRKCS127
01765                  MOVE 'TSHPTMT '   TO DP013-DB2-TABLE-NAME (1)    TRKCS127
01766                  SET DP013-DB2-ABEND                              TRKCS127
01767                      DP013-XCTL-DISPLAY-RESTART TO TRUE           TRKCS127
01768                  PERFORM DP013-0000-PROCESS-ABEND                 TRKCS127
01769          END-EVALUATE                                             TRKCS127
01770      END-PERFORM.                                                 TRKCS127
01771 *                                                                 TRKCS127
01772      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
01773          MOVE '4100-SELECT-VND-SHIP-DTE'                          TRKCS127
01774                                    TO DP013-PARAGRAPH             TRKCS127
01775          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING SELECT     '   TRKCS127
01776                                    TO DP013-MESSAGE-TEXT (1)      TRKCS127
01777          MOVE SQLCA                TO DP013-SQLCA                 TRKCS127
01778          MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    TRKCS127
01779          SET DP013-DB2-ABEND                                      TRKCS127
01780              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
01781                                    TO TRUE                        TRKCS127
01782          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
01783      END-IF.                                                      TRKCS127
01784                                                                   TRKCS127
01785  EJECT                                                            TRKCS127
01786 *----------------------------------------------------------------*TRKCS127
01787 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *TRKCS127
01788 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *TRKCS127
01789 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *TRKCS127
01790 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *TRKCS127
01791 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *TRKCS127
01792 *                                                                *TRKCS127
01793 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *TRKCS127
01794 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *TRKCS127
01795 *    UPON INITIALIZATION.                                        *TRKCS127
01796 *----------------------------------------------------------------*TRKCS127
01797                                                                   TRKCS127
01798  4300-READ-ITEMS-FROM-DB.                                         TRKCS127
01799                                                                   TRKCS127
01800      PERFORM                                                      TRKCS127
01801          VARYING PV-READ-COUNT                                    TRKCS127
01802          FROM 1 BY 1                                              TRKCS127
01803          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    TRKCS127
01804             OR (ASC-NO-ITEMS-LEFT-ON-DB))                         TRKCS127
01805                                                                   TRKCS127
01806          PERFORM 4310-FETCH                                       TRKCS127
01807                                                                   TRKCS127
01808                                                                   TRKCS127
01809          IF  ASC-ITEMS-LEFT-ON-DB                                 TRKCS127
01810              IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                TRKCS127
01811                  ADD +1            TO ASC-ITEM-SUB                TRKCS127
01812              ELSE                                                 TRKCS127
01813                  ADD +1            TO ASC-BLK-SUB                 TRKCS127
01814                  MOVE +1           TO ASC-ITEM-SUB                TRKCS127
01815                                                                   TRKCS127
01816                  IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         TRKCS127
01817                      MOVE +1       TO ASC-BLK-SUB                 TRKCS127
01818                      SET ASC-BLOCK-MODIFIED (1)                   TRKCS127
01819                                    TO TRUE                        TRKCS127
01820                      PERFORM 5100-WRITE-TEMP-STORAGE              TRKCS127
01821                      MOVE ASC-BLOCK-ENTRIES                       TRKCS127
01822                                (PC-MAX-BLOCKS-IN-ARRAY)           TRKCS127
01823                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) TRKCS127
01824                      ADD +1        TO ASC-BLK-SUB                 TRKCS127
01825                      INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   TRKCS127
01826                      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      TRKCS127
01827                                    TO TRUE                        TRKCS127
01828                  END-IF                                           TRKCS127
01829              END-IF                                               TRKCS127
01830              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    TRKCS127
01831                                                                   TRKCS127
01832              MOVE ASC-NUMBER-OF-ITEMS-READ                        TRKCS127
01833                                    TO ASC-LIST-ITEM-NUMBER        TRKCS127
01834                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01835 * SELECT THE REST OF THE PO INFORMATION                           TRKCS127
01836              PERFORM 4320-GET-ENT-NAME                            TRKCS127
01837                                                                   TRKCS127
01838              PERFORM 4330-GET-AD-DATE                             TRKCS127
01839              IF  SQLCODE = -305                                   TRKCS127
01840              OR  SQLCODE = +100                                   TRKCS127
01841              OR  DN-AD-EVNT-DTE = -1                              TRKCS127
01842                  MOVE SPACES TO PURITM-AD-EVNT-DTE                TRKCS127
01843              END-IF                                               TRKCS127
01844                                                                   TRKCS127
01845              PERFORM 4340-GET-SHIP-WINDOW                         TRKCS127
01846                                                                   TRKCS127
01847              PERFORM 4350-CHECK-AD-PIC                            TRKCS127
01848                                                                   TRKCS127
01849 * MOVE PO INFORMATION TO COMM AREA                                TRKCS127
01850                                                                   TRKCS127
01851              MOVE SHPTPO-PO-NBR    TO ASC-PO-NBR                  TRKCS127
01852                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01853                                                                   TRKCS127
01854              MOVE SHPTPO-REC-SEQ-NBR                              TRKCS127
01855                                    TO ASC-REC-SEQ-NBR             TRKCS127
01856                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01857                                                                   TRKCS127
01858              MOVE PURCHS-STATUS-CDE                               TRKCS127
01859                                    TO  ASC-PO-STATUS              TRKCS127
01860                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01861                                                                   TRKCS127
01862              MOVE PURCHS-NEW-STR-PO-IND                           TRKCS127
01863                                    TO  ASC-NEW-STR                TRKCS127
01864                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01865                                                                   TRKCS127
01866 *            SET THE SHIPMENT STATUS CODE ACCORDING TO THE "SHIPMETRKCS127
01867 *            WINDOW...IF BEFORE WINDOW - "E" IF AFTER "L"         TRKCS127
01868                                                                   TRKCS127
01869              IF PS-SHIP-WIN-NOT-EXIST                             TRKCS127
01870                  MOVE SPACES TO ASC-SHIP-STATUS                   TRKCS127
01871                                 (ASC-BLK-SUB ASC-ITEM-SUB)        TRKCS127
01872              ELSE                                                 TRKCS127
01873                  IF PLNSHP-EXT-CAN-DTE = '0001-01-01'             TRKCS127
01874                     EVALUATE TRUE                                 TRKCS127
01875                        WHEN ((SHIPMT-VEND-SHIP-DTE >=             TRKCS127
01876                                        PLNSHP-DONT-SHIP-BEF-DTE)  TRKCS127
01877                         AND  (SHIPMT-VEND-SHIP-DTE <=             TRKCS127
01878                                        PLNSHP-CAN-IFNOT-SHIP-DTE))TRKCS127
01879                             MOVE SPACE TO ASC-SHIP-STATUS         TRKCS127
01880                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01881                        WHEN (SHIPMT-VEND-SHIP-DTE <               TRKCS127
01882                                        PLNSHP-DONT-SHIP-BEF-DTE)  TRKCS127
01883                             MOVE 'E'   TO ASC-SHIP-STATUS         TRKCS127
01884                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01885                        WHEN (SHIPMT-VEND-SHIP-DTE >               TRKCS127
01886                                        PLNSHP-CAN-IFNOT-SHIP-DTE) TRKCS127
01887                             MOVE 'L'   TO ASC-SHIP-STATUS         TRKCS127
01888                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01889                     END-EVALUATE                                  TRKCS127
01890                                                                   TRKCS127
01891                  ELSE                                             TRKCS127
01892                     EVALUATE TRUE                                 TRKCS127
01893                        WHEN ((SHIPMT-VEND-SHIP-DTE >=             TRKCS127
01894                                        PLNSHP-DONT-SHIP-BEF-DTE)  TRKCS127
01895                         AND  (SHIPMT-VEND-SHIP-DTE <=             TRKCS127
01896                                        PLNSHP-EXT-CAN-DTE ))      TRKCS127
01897                             MOVE SPACE TO ASC-SHIP-STATUS         TRKCS127
01898                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01899                                                                   TRKCS127
01900                        WHEN (SHIPMT-VEND-SHIP-DTE <               TRKCS127
01901                                        PLNSHP-DONT-SHIP-BEF-DTE)  TRKCS127
01902                             MOVE 'E'   TO ASC-SHIP-STATUS         TRKCS127
01903                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01904                        WHEN (SHIPMT-VEND-SHIP-DTE >               TRKCS127
01905                                        PLNSHP-EXT-CAN-DTE )       TRKCS127
01906                             MOVE 'L'   TO ASC-SHIP-STATUS         TRKCS127
01907                                       (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
01908                     END-EVALUATE                                  TRKCS127
01909                  END-IF                                           TRKCS127
01910              END-IF                                               TRKCS127
01911                                                                   TRKCS127
01912 * ASC - ASSOCIATE CARTON COUNT                                    TRKCS127
01913              MOVE SHPTPO-EXPTED-CART-CNT                          TRKCS127
01914                                TO  ASC-EXPTED-CART-CNT            TRKCS127
01915                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01916 * ASN - VENDOR CARTON COUNT                                       TRKCS127
01917              MOVE SHPTPO-VEND-CART-CT                             TRKCS127
01918                                TO  ASC-VEND-CART-CNT              TRKCS127
01919                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01920 * FOR - CARRIER CARTON COUNT                                      TRKCS127
01921              MOVE SHPTPO-CARR-CART-CT                             TRKCS127
01922                                TO  ASC-CARR-CART-CNT              TRKCS127
01923                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01924                                                                   TRKCS127
01925              MOVE PURITM-PIC-ITM-IND                              TRKCS127
01926                                TO  ASC-PIC-AD                     TRKCS127
01927                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01928                                                                   TRKCS127
01929              MOVE PURITM-AD-EVNT-DTE TO PV-WORK-DATE              TRKCS127
01930              MOVE PV-WORK-MM         TO PV-DISP-MM                TRKCS127
01931              MOVE PV-WORK-DD         TO PV-DISP-DD                TRKCS127
01932              MOVE PV-DISP-DATE       TO ASC-AD-DATE               TRKCS127
01933                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01934                                                                   TRKCS127
01935              MOVE ENTNME-ENT-NAME-DESC                            TRKCS127
01936                                TO  ASC-VEND-NAME                  TRKCS127
01937                                        (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
01938          END-IF                                                   TRKCS127
01939      END-PERFORM.                                                 TRKCS127
01940                                                                   TRKCS127
01941      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          TRKCS127
01942          MOVE +1               TO ASC-BLK-SUB                     TRKCS127
01943          PERFORM 5100-WRITE-TEMP-STORAGE                          TRKCS127
01944          ADD +1                TO ASC-BLK-SUB                     TRKCS127
01945          PERFORM 5100-WRITE-TEMP-STORAGE                          TRKCS127
01946                                                                   TRKCS127
01947          MOVE 1                TO ASC-BLK-SUB                     TRKCS127
01948                                   PV-BLOCK-NUMBER                 TRKCS127
01949          PERFORM 4410-READ-TEMP-STORAGE                           TRKCS127
01950          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             TRKCS127
01951              MOVE 2            TO ASC-BLK-SUB                     TRKCS127
01952                                   PV-BLOCK-NUMBER                 TRKCS127
01953              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
01954          END-IF                                                   TRKCS127
01955      END-IF.                                                      TRKCS127
01956  EJECT                                                            TRKCS127
01957 *----------------------------------------------------------------*TRKCS127
01958 *    FETCH THE MESSAGE CURSOR.                                   *TRKCS127
01959 *----------------------------------------------------------------*TRKCS127
01960                                                                   TRKCS127
01961  4310-FETCH.                                                      TRKCS127
01962                                                                   TRKCS127
01963       EXEC SQL                                                    TRKCS127
01964            FETCH PO-CSR                                           TRKCS127
01965            INTO  :SHPTPO-PO-NBR                                   TRKCS127
01966                , :SHPTPO-REC-SEQ-NBR                              TRKCS127
01967                , :SHPTPO-EXPTED-CART-CNT                          TRKCS127
01968                , :SHPTPO-CARR-CART-CT                             TRKCS127
01969                , :SHPTPO-VEND-CART-CT                             TRKCS127
01970       END-EXEC                                                    TRKCS127
01971                                                                   TRKCS127
01972                                                                   TRKCS127
01973      EVALUATE TRUE                                                TRKCS127
01974          WHEN SQLCODE = ZERO                                      TRKCS127
01975          WHEN SQLCODE = +100                                      TRKCS127
01976               CONTINUE                                            TRKCS127
01977          WHEN SQLWARN0 NOT = SPACE                                TRKCS127
01978          WHEN SQLCODE NOT = ZERO                                  TRKCS127
01979               MOVE '4310-FETCH-CURSOR'                            TRKCS127
01980                                TO DP013-PARAGRAPH                 TRKCS127
01981               MOVE 'FETCH PO CURSOR'                              TRKCS127
01982                                TO DP013-MESSAGE-TEXT (1)          TRKCS127
01983               MOVE SQLCA       TO DP013-SQLCA                     TRKCS127
01984               SET DP013-DB2-ABEND                                 TRKCS127
01985                                TO TRUE                            TRKCS127
01986               PERFORM DP013-0000-PROCESS-ABEND                    TRKCS127
01987      END-EVALUATE.                                                TRKCS127
01988                                                                   TRKCS127
01989      IF  SQLCODE EQUAL +100                                       TRKCS127
01990          SET ASC-NO-ITEMS-LEFT-ON-DB                              TRKCS127
01991                                    TO TRUE                        TRKCS127
01992      END-IF.                                                      TRKCS127
01993                                                                   TRKCS127
01994  EJECT                                                            TRKCS127
01995 *----------------------------------------------------------------*TRKCS127
01996 *    GET THE VENDOR NAME                                         *TRKCS127
01997 *----------------------------------------------------------------*TRKCS127
01998  4320-GET-ENT-NAME.                                               TRKCS127
01999                                                                   TRKCS127
02000      PERFORM                                                      TRKCS127
02001          WITH TEST AFTER                                          TRKCS127
02002          VARYING PV-RETRY-COUNTER                                 TRKCS127
02003          FROM 1 BY 1                                              TRKCS127
02004          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
02005              OR (SQLCODE = +0)                                    TRKCS127
02006              OR (SQLCODE = +100))                                 TRKCS127
02007                                                                   TRKCS127
02008          EXEC SQL                                                 TRKCS127
02009               SELECT                                              TRKCS127
02010                      ENT_NAME_DESC                                TRKCS127
02011                    , STATUS_CDE                                   TRKCS127
02012                    , NEW_STR_PO_IND                               TRKCS127
02013                 INTO                                              TRKCS127
02014                      :ENTNME-ENT-NAME-DESC                        TRKCS127
02015                    , :PURCHS-STATUS-CDE                           TRKCS127
02016                    , :PURCHS-NEW-STR-PO-IND                       TRKCS127
02017                 FROM TPURCHS A                                    TRKCS127
02018                     ,TENTNME B                                    TRKCS127
02019                WHERE A.PO_NBR         = :SHPTPO-PO-NBR            TRKCS127
02020                  AND A.VER_STATUS_CDE = 'A'                       TRKCS127
02021                  AND B.TYPE_CDE       = '01'                      TRKCS127
02022                  AND A.ENT_ID = B.ENT_ID                          TRKCS127
02023          END-EXEC                                                 TRKCS127
02024                                                                   TRKCS127
02025          EVALUATE TRUE                                            TRKCS127
02026              WHEN SQLCODE = +0                                    TRKCS127
02027              WHEN SQLCODE = -904                                  TRKCS127
02028              WHEN SQLCODE = -913                                  TRKCS127
02029                   CONTINUE                                        TRKCS127
02030              WHEN SQLCODE = +100                                  TRKCS127
02031                   MOVE SPACES     TO ENTNME-ENT-NAME-DESC         TRKCS127
02032              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
02033              WHEN SQLCODE < +0                                    TRKCS127
02034              WHEN SQLCODE > +0                                    TRKCS127
02035                   MOVE '4320-GET-ENT-NAME'                        TRKCS127
02036                                   TO DP013-PARAGRAPH              TRKCS127
02037                   MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     TRKCS127
02038                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02039                   MOVE SQLCA      TO DP013-SQLCA                  TRKCS127
02040                   MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02041                   MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     TRKCS127
02042                   SET DP013-DB2-ABEND                             TRKCS127
02043                       DP013-XCTL-DISPLAY-RESTART                  TRKCS127
02044                                   TO TRUE                         TRKCS127
02045                   PERFORM DP013-0000-PROCESS-ABEND                TRKCS127
02046          END-EVALUATE                                             TRKCS127
02047      END-PERFORM.                                                 TRKCS127
02048                                                                   TRKCS127
02049      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
02050          MOVE '4320-GET-ENT-NAME  '                               TRKCS127
02051                                   TO DP013-PARAGRAPH              TRKCS127
02052          MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      TRKCS127
02053                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02054          MOVE SQLCA               TO DP013-SQLCA                  TRKCS127
02055          MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02056          MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     TRKCS127
02057          SET DP013-DB2-ABEND                                      TRKCS127
02058              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
02059                                   TO TRUE                         TRKCS127
02060          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02061      END-IF.                                                      TRKCS127
02062                                                                   TRKCS127
02063 *----------------------------------------------------------------*TRKCS127
02064 *    GET THE EARLIEST AD DATE                                    *TRKCS127
02065 *----------------------------------------------------------------*TRKCS127
02066  4330-GET-AD-DATE.                                                TRKCS127
02067                                                                   TRKCS127
02068      PERFORM                                                      TRKCS127
02069          WITH TEST AFTER                                          TRKCS127
02070          VARYING PV-RETRY-COUNTER                                 TRKCS127
02071          FROM 1 BY 1                                              TRKCS127
02072          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
02073              OR (SQLCODE = +0)                                    TRKCS127
02074              OR (SQLCODE = +100)                                  TRKCS127
02075              OR (SQLCODE = -305))                                 TRKCS127
02076                                                                   TRKCS127
02077          EXEC SQL                                                 TRKCS127
02078               SELECT MIN(AD_EVNT_DTE)                             TRKCS127
02079                 INTO :PURITM-AD-EVNT-DTE                          TRKCS127
02080                        :DN-AD-EVNT-DTE                            TRKCS127
02081                 FROM TPURITM                                      TRKCS127
02082                WHERE PO_NBR         = :SHPTPO-PO-NBR              TRKCS127
02083                  AND VER_STATUS_CDE = 'A'                         TRKCS127
02084                  AND AD_EVNT_DTE    > '0001-01-01'                TRKCS127
02085          END-EXEC                                                 TRKCS127
02086                                                                   TRKCS127
02087          EVALUATE TRUE                                            TRKCS127
02088              WHEN SQLCODE = +0                                    TRKCS127
02089              WHEN SQLCODE = +100                                  TRKCS127
02090              WHEN SQLCODE = -305                                  TRKCS127
02091              WHEN SQLCODE = -904                                  TRKCS127
02092              WHEN SQLCODE = -913                                  TRKCS127
02093                   CONTINUE                                        TRKCS127
02094                                                                   TRKCS127
02095              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
02096              WHEN SQLCODE < +0                                    TRKCS127
02097              WHEN SQLCODE > +0                                    TRKCS127
02098                   MOVE '4330-GET-AD-DATE'                         TRKCS127
02099                                   TO DP013-PARAGRAPH              TRKCS127
02100                   MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           TRKCS127
02101                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02102                   MOVE SQLCA      TO DP013-SQLCA                  TRKCS127
02103                   MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02104                   SET DP013-DB2-ABEND                             TRKCS127
02105                       DP013-XCTL-DISPLAY-RESTART                  TRKCS127
02106                                   TO TRUE                         TRKCS127
02107                   PERFORM DP013-0000-PROCESS-ABEND                TRKCS127
02108          END-EVALUATE                                             TRKCS127
02109      END-PERFORM.                                                 TRKCS127
02110                                                                   TRKCS127
02111      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
02112          MOVE '4330-GET-AD-DATE'                                  TRKCS127
02113                                   TO DP013-PARAGRAPH              TRKCS127
02114          MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            TRKCS127
02115                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02116          MOVE SQLCA               TO DP013-SQLCA                  TRKCS127
02117          MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02118          SET DP013-DB2-ABEND                                      TRKCS127
02119              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
02120                                   TO TRUE                         TRKCS127
02121          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02122      END-IF.                                                      TRKCS127
02123                                                                   TRKCS127
02124                                                                   TRKCS127
02125 *----------------------------------------------------------------*TRKCS127
02126 *    GET THE DATES THAT DEFINE THE SHIPPING WINDOW               *TRKCS127
02127 *----------------------------------------------------------------*TRKCS127
02128  4340-GET-SHIP-WINDOW.                                            TRKCS127
02129                                                                   TRKCS127
02130      PERFORM                                                      TRKCS127
02131          WITH TEST AFTER                                          TRKCS127
02132          VARYING PV-RETRY-COUNTER                                 TRKCS127
02133          FROM 1 BY 1                                              TRKCS127
02134          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
02135              OR (SQLCODE = +0)                                    TRKCS127
02136              OR (SQLCODE = +100))                                 TRKCS127
02137                                                                   TRKCS127
02138          EXEC SQL                                                 TRKCS127
02139               SELECT                                              TRKCS127
02140                       DONT_SHIP_BEF_DTE                           TRKCS127
02141                      ,CAN_IFNOT_SHIP_DTE                          TRKCS127
02142                      ,EXT_CAN_DTE                                 TRKCS127
02143               INTO                                                TRKCS127
02144                      :PLNSHP-DONT-SHIP-BEF-DTE                    TRKCS127
02145                     ,:PLNSHP-CAN-IFNOT-SHIP-DTE                   TRKCS127
02146                     ,:PLNSHP-EXT-CAN-DTE                          TRKCS127
02147                 FROM TPLNSHP                                      TRKCS127
02148                WHERE PO_NBR         = :SHPTPO-PO-NBR              TRKCS127
02149                  AND VER_STATUS_CDE = 'A'                         TRKCS127
02150          END-EXEC                                                 TRKCS127
02151                                                                   TRKCS127
02152          EVALUATE TRUE                                            TRKCS127
02153              WHEN SQLCODE = +0                                    TRKCS127
02154                  SET PS-SHIP-WIN-EXIST                            TRKCS127
02155                                   TO TRUE                         TRKCS127
02156                                                                   TRKCS127
02157              WHEN SQLCODE = +100                                  TRKCS127
02158                  SET PS-SHIP-WIN-NOT-EXIST                        TRKCS127
02159                                   TO TRUE                         TRKCS127
02160                                                                   TRKCS127
02161              WHEN SQLCODE = -904                                  TRKCS127
02162              WHEN SQLCODE = -913                                  TRKCS127
02163                   CONTINUE                                        TRKCS127
02164                                                                   TRKCS127
02165              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
02166              WHEN SQLCODE < +0                                    TRKCS127
02167              WHEN SQLCODE > +0                                    TRKCS127
02168                   MOVE '4340-GET-SHIP-WINDOW'                     TRKCS127
02169                                   TO DP013-PARAGRAPH              TRKCS127
02170                   MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP'           TRKCS127
02171                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02172                   MOVE SQLCA      TO DP013-SQLCA                  TRKCS127
02173                   MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02174                   SET DP013-DB2-ABEND                             TRKCS127
02175                       DP013-XCTL-DISPLAY-RESTART                  TRKCS127
02176                                   TO TRUE                         TRKCS127
02177                   PERFORM DP013-0000-PROCESS-ABEND                TRKCS127
02178          END-EVALUATE                                             TRKCS127
02179      END-PERFORM.                                                 TRKCS127
02180                                                                   TRKCS127
02181      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
02182          MOVE '4340-GET-SHIP-WINDOW'                              TRKCS127
02183                                   TO DP013-PARAGRAPH              TRKCS127
02184          MOVE 'MAX RETRIES EXCEEDED ON SELECT TPLNSHP'            TRKCS127
02185                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02186          MOVE SQLCA               TO DP013-SQLCA                  TRKCS127
02187          MOVE 'TPLNSHP '          TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02188          SET DP013-DB2-ABEND                                      TRKCS127
02189              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
02190                                   TO TRUE                         TRKCS127
02191          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02192      END-IF.                                                      TRKCS127
02193                                                                   TRKCS127
02194 *----------------------------------------------------------------*TRKCS127
02195 *    CHECK IF ANY LINES WERE PICTURED IN AN ADD                  *TRKCS127
02196 *----------------------------------------------------------------*TRKCS127
02197  4350-CHECK-AD-PIC.                                               TRKCS127
02198                                                                   TRKCS127
02199      PERFORM                                                      TRKCS127
02200          WITH TEST AFTER                                          TRKCS127
02201          VARYING PV-RETRY-COUNTER                                 TRKCS127
02202          FROM 1 BY 1                                              TRKCS127
02203          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               TRKCS127
02204              OR (SQLCODE = +0)                                    TRKCS127
02205              OR (SQLCODE = +100)                                  TRKCS127
02206              OR (SQLCODE = -811))                                 TRKCS127
02207                                                                   TRKCS127
02208          EXEC SQL                                                 TRKCS127
02209               SELECT PIC_ITM_IND                                  TRKCS127
02210                 INTO :PURITM-PIC-ITM-IND                          TRKCS127
02211                 FROM TPURITM                                      TRKCS127
02212                WHERE PO_NBR         = :SHPTPO-PO-NBR              TRKCS127
02213                  AND VER_STATUS_CDE = 'A'                         TRKCS127
02214                  AND AD_EVNT_DTE    > '0001-01-01'                TRKCS127
02215                  AND PIC_ITM_IND    = 'Y'                         TRKCS127
02216          END-EXEC                                                 TRKCS127
02217                                                                   TRKCS127
02218          EVALUATE TRUE                                            TRKCS127
02219              WHEN SQLCODE = +100                                  TRKCS127
02220                  MOVE 'N'          TO PURITM-PIC-ITM-IND          TRKCS127
02221              WHEN SQLCODE = +0                                    TRKCS127
02222              WHEN SQLCODE = -811                                  TRKCS127
02223                  MOVE 'Y'          TO PURITM-PIC-ITM-IND          TRKCS127
02224              WHEN SQLCODE = -904                                  TRKCS127
02225              WHEN SQLCODE = -913                                  TRKCS127
02226                   CONTINUE                                        TRKCS127
02227                                                                   TRKCS127
02228              WHEN SQLWARN0 NOT = SPACES                           TRKCS127
02229              WHEN SQLCODE < +0                                    TRKCS127
02230              WHEN SQLCODE > +0                                    TRKCS127
02231                   MOVE '4350-GET-AD-DATE'                         TRKCS127
02232                                   TO DP013-PARAGRAPH              TRKCS127
02233                   MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           TRKCS127
02234                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02235                   MOVE SQLCA      TO DP013-SQLCA                  TRKCS127
02236                   MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02237                   SET DP013-DB2-ABEND                             TRKCS127
02238                       DP013-XCTL-DISPLAY-RESTART                  TRKCS127
02239                                   TO TRUE                         TRKCS127
02240                   PERFORM DP013-0000-PROCESS-ABEND                TRKCS127
02241          END-EVALUATE                                             TRKCS127
02242      END-PERFORM.                                                 TRKCS127
02243                                                                   TRKCS127
02244      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        TRKCS127
02245          MOVE '4350-GET-AD-DATE'                                  TRKCS127
02246                                   TO DP013-PARAGRAPH              TRKCS127
02247          MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            TRKCS127
02248                                   TO DP013-MESSAGE-TEXT (1)       TRKCS127
02249          MOVE SQLCA               TO DP013-SQLCA                  TRKCS127
02250          MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     TRKCS127
02251          SET DP013-DB2-ABEND                                      TRKCS127
02252              DP013-XCTL-DISPLAY-RESTART                           TRKCS127
02253                                   TO TRUE                         TRKCS127
02254          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02255      END-IF.                                                      TRKCS127
02256                                                                   TRKCS127
02257 *----------------------------------------------------------------*TRKCS127
02258 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *TRKCS127
02259 *----------------------------------------------------------------*TRKCS127
02260                                                                   TRKCS127
02261  4400-MOVE-COMMAREA-TO-SCREEN.                                    TRKCS127
02262      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             TRKCS127
02263          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          TRKCS127
02264          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          TRKCS127
02265              MOVE +1    TO ASC-BLK-SUB                            TRKCS127
02266              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
02267              ADD +1     TO ASC-BLK-SUB                            TRKCS127
02268              PERFORM 5100-WRITE-TEMP-STORAGE                      TRKCS127
02269              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             TRKCS127
02270                  GIVING PV-BLOCK-NUMBER                           TRKCS127
02271                  REMAINDER PV-REMAINDER                           TRKCS127
02272              IF  PV-REMAINDER > ZERO                              TRKCS127
02273                  ADD +1 TO PV-BLOCK-NUMBER                        TRKCS127
02274              END-IF                                               TRKCS127
02275              MOVE +1    TO ASC-BLK-SUB                            TRKCS127
02276              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
02277              ADD +1     TO ASC-BLK-SUB                            TRKCS127
02278                            PV-BLOCK-NUMBER                        TRKCS127
02279              PERFORM 4410-READ-TEMP-STORAGE                       TRKCS127
02280      END-IF.                                                      TRKCS127
02281      MOVE +1            TO ASC-BLK-SUB.                           TRKCS127
02282      COMPUTE ASC-ITEM-SUB =                                       TRKCS127
02283          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              TRKCS127
02284          + PC-ITEMS-PER-PANEL).                                   TRKCS127
02285 *                                                                 TRKCS127
02286      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        TRKCS127
02287          ADD +1         TO ASC-BLK-SUB                            TRKCS127
02288          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            TRKCS127
02289      END-IF.                                                      TRKCS127
02290 *                                                                 TRKCS127
02291      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           TRKCS127
02292          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                TRKCS127
02293      PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        TRKCS127
02294      PERFORM 4420-FORMAT-LIST-LINES                               TRKCS127
02295          VARYING PV-SUB                                           TRKCS127
02296          FROM PC-ITEMS-PER-PANEL BY -1                            TRKCS127
02297          UNTIL PV-SUB < +1.                                       TRKCS127
02298 *                                                                 TRKCS127
02299      COMPUTE ASC-ITEMS-DISPLAYED =                                TRKCS127
02300          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          TRKCS127
02301      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    TRKCS127
02302                                       ASTRTPOO.                   TRKCS127
02303      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDPOO.                    TRKCS127
02304      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTPOO.                    TRKCS127
02305      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            TRKCS127
02306                                    TO ASELPOO.                    TRKCS127
02307 *                                                                 TRKCS127
02308      MOVE ASC-KEY-PRO-NBR          TO AFBNOO.                     TRKCS127
02309      MOVE ASC-KEY-BOL-NBR          TO ABOLNOO.                    TRKCS127
02310      MOVE ASC-KEY-OPER-UNT-ID      TO AOPIDO.                     TRKCS127
02311      MOVE ASC-KEY-FCLTY-ID         TO AFACLTYO.                   TRKCS127
02312      MOVE ASC-KEY-FCLTY-NME        TO AFCLNMEO.                   TRKCS127
02313      MOVE ASC-KEY-TRLR-NBR         TO ATRLRO.                     TRKCS127
02314      MOVE ASC-KEY-SCAC             TO ASCACO.                     TRKCS127
02315 *                                                                 TRKCS127
02316      IF  DP020-MSG-NUMBER-X = SPACE                               TRKCS127
02317          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  TRKCS127
02318 *            --- MORE ITEMS TO DISPLAY ----                       TRKCS127
02319              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            TRKCS127
02320              SET DP020-MSG-INFORMATIONAL TO TRUE                  TRKCS127
02321          END-IF                                                   TRKCS127
02322      END-IF.                                                      TRKCS127
02323 *----------------------------------------------------------------*TRKCS127
02324 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *TRKCS127
02325 *----------------------------------------------------------------*TRKCS127
02326                                                                   TRKCS127
02327  4410-READ-TEMP-STORAGE.                                          TRKCS127
02328                                                                   TRKCS127
02329      EXEC CICS                                                    TRKCS127
02330          READQ TS                                                 TRKCS127
02331              QUEUE (ASC-LIST-QUEUE-NAME)                          TRKCS127
02332              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               TRKCS127
02333              ITEM  (PV-BLOCK-NUMBER)                              TRKCS127
02334              RESP  (PV-CICS-RESP)                                 TRKCS127
02335      END-EXEC.                                                    TRKCS127
02336                                                                   TRKCS127
02337      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       TRKCS127
02338        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     TRKCS127
02339          CONTINUE                                                 TRKCS127
02340      ELSE                                                         TRKCS127
02341          SET DP013-CICS-ABEND     TO TRUE                         TRKCS127
02342          SET DP013-NO-ROLLBACK    TO TRUE                         TRKCS127
02343          MOVE '4410-READ-TEMP-STORAGE'                            TRKCS127
02344                                   TO DP013-PARAGRAPH              TRKCS127
02345          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      TRKCS127
02346                                   TO DP013-MESSAGE-TEXT(1)        TRKCS127
02347          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02348      END-IF.                                                      TRKCS127
02349                                                                   TRKCS127
02350      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             TRKCS127
02351 *                                                                 TRKCS127
02352      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         TRKCS127
02353          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               TRKCS127
02354      END-IF.                                                      TRKCS127
02355  EJECT                                                            TRKCS127
02356 *----------------------------------------------------------------*TRKCS127
02357 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *TRKCS127
02358 *----------------------------------------------------------------*TRKCS127
02359                                                                   TRKCS127
02360  4420-FORMAT-LIST-LINES.                                          TRKCS127
02361      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      TRKCS127
02362          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                TRKCS127
02363          MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           TRKCS127
02364          MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           TRKCS127
02365          MOVE SPACE              TO MR-SELECTI (PV-SUB)           TRKCS127
02366                                     MR-ACTION (PV-SUB)            TRKCS127
02367                                     MR-PO-STATUS (PV-SUB)         TRKCS127
02368                                     MR-NEW-STR (PV-SUB)           TRKCS127
02369                                     MR-SHIP-STATUS (PV-SUB)       TRKCS127
02370                                     MR-AD-PIC (PV-SUB)            TRKCS127
02371                                     MR-AD-DATE (PV-SUB)           TRKCS127
02372                                     MR-VEND-NAME (PV-SUB)         TRKCS127
02373                                     MR-PO-NBR (PV-SUB)            TRKCS127
02374                                     MR-REC-SEQ-NBR (PV-SUB)       TRKCS127
02375                                     MR-EXPTED-CART-CNT (PV-SUB)   TRKCS127
02376                                     MR-VEND-CART-CNT (PV-SUB)     TRKCS127
02377                                     MR-CARR-CART-CNT (PV-SUB)     TRKCS127
02378      ELSE                                                         TRKCS127
02379          IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      TRKCS127
02380                                                    > SPACE        TRKCS127
02381              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) TRKCS127
02382                                  TO MR-SELECTI (PV-SUB)           TRKCS127
02383          ELSE                                                     TRKCS127
02384              MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      TRKCS127
02385                                  TO MR-SELECTI (PV-SUB)           TRKCS127
02386          END-IF                                                   TRKCS127
02387 *                                                                 TRKCS127
02388          IF  DP030-SET-CURSOR-TRAILER                             TRKCS127
02389              IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)TRKCS127
02390                  > SPACE)                                         TRKCS127
02391                OR (PV-SUB = 1))                                   TRKCS127
02392                 SET DP030-SET-CURSOR-APPL-1 TO TRUE               TRKCS127
02393                 MOVE -1          TO MR-SELECTL (PV-SUB)           TRKCS127
02394              END-IF                                               TRKCS127
02395          END-IF                                                   TRKCS127
02396 *                                                                 TRKCS127
02397          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           TRKCS127
02398              MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           TRKCS127
02399                                 TO  MR-PO-NBR (PV-SUB)            TRKCS127
02400              MOVE ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      TRKCS127
02401                                 TO  MR-REC-SEQ-NBR-N (PV-SUB)     TRKCS127
02402              MOVE ASC-PO-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)        TRKCS127
02403                                 TO  MR-PO-STATUS (PV-SUB)         TRKCS127
02404              MOVE ASC-NEW-STR (ASC-BLK-SUB ASC-ITEM-SUB)          TRKCS127
02405                                 TO  MR-NEW-STR (PV-SUB)           TRKCS127
02406              MOVE ASC-SHIP-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)      TRKCS127
02407                                 TO  MR-SHIP-STATUS (PV-SUB)       TRKCS127
02408              MOVE ASC-EXPTED-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)  TRKCS127
02409                                 TO  MR-EXPTED-CART-CNT-N (PV-SUB) TRKCS127
02410              MOVE ASC-VEND-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)    TRKCS127
02411                                 TO  MR-VEND-CART-CNT-N (PV-SUB)   TRKCS127
02412              MOVE ASC-CARR-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)    TRKCS127
02413                                 TO  MR-CARR-CART-CNT-N (PV-SUB)   TRKCS127
02414              MOVE ASC-PIC-AD (ASC-BLK-SUB ASC-ITEM-SUB)           TRKCS127
02415                                 TO  MR-AD-PIC (PV-SUB)            TRKCS127
02416              MOVE ASC-AD-DATE (ASC-BLK-SUB ASC-ITEM-SUB)          TRKCS127
02417                                 TO  MR-AD-DATE (PV-SUB)           TRKCS127
02418              MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        TRKCS127
02419                                 TO  MR-VEND-NAME (PV-SUB)         TRKCS127
02420              MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           TRKCS127
02421                                  TO MR-ACTION (PV-SUB)            TRKCS127
02422          END-IF                                                   TRKCS127
02423      END-IF.                                                      TRKCS127
02424      SUBTRACT +1 FROM ASC-ITEM-SUB                                TRKCS127
02425      IF  ASC-ITEM-SUB < + 1                                       TRKCS127
02426          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  TRKCS127
02427          MOVE +1                 TO ASC-BLK-SUB                   TRKCS127
02428      END-IF.                                                      TRKCS127
02429 ******************************************************************TRKCS127
02430 ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **TRKCS127
02431 ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **TRKCS127
02432 ** ISSUE A WARNING.                                             **TRKCS127
02433 ******************************************************************TRKCS127
02434  4430-CHECK-FOR-BEGIN-AND-END.                                    TRKCS127
02435      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       TRKCS127
02436          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     TRKCS127
02437 *            -- NO END-OF-RANGE SPECFIED ---                      TRKCS127
02438              MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            TRKCS127
02439              SET DP020-MSG-WARNING TO TRUE                        TRKCS127
02440              PERFORM 4431-POSITION-AT-WARNING                     TRKCS127
02441          END-IF                                                   TRKCS127
02442      ELSE                                                         TRKCS127
02443          IF  ASC-END-OF-SELECTED-RANGE > ZERO                     TRKCS127
02444 *            -- NO BEGINNING-OF-RANGE SPECFIED ---                TRKCS127
02445              MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            TRKCS127
02446              SET DP020-MSG-WARNING TO TRUE                        TRKCS127
02447              PERFORM 4431-POSITION-AT-WARNING                     TRKCS127
02448          END-IF                                                   TRKCS127
02449      END-IF.                                                      TRKCS127
02450 ******************************************************************TRKCS127
02451 ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **TRKCS127
02452 ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **TRKCS127
02453 ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **TRKCS127
02454 ** POSITION THE CURSOR THERE.                                   **TRKCS127
02455 ******************************************************************TRKCS127
02456  4431-POSITION-AT-WARNING.                                        TRKCS127
02457      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 TRKCS127
02458                     - PV-TOP-ITEM + 1.                            TRKCS127
02459      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      TRKCS127
02460          CONTINUE                                                 TRKCS127
02461      ELSE                                                         TRKCS127
02462          SET DP030-SET-CURSOR-APPL-1                              TRKCS127
02463                                    TO TRUE                        TRKCS127
02464          MOVE -1                   TO MR-SELECTL (PV-SUB)         TRKCS127
02465          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         TRKCS127
02466          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         TRKCS127
02467      END-IF.                                                      TRKCS127
02468 *                                                                 TRKCS127
02469      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   TRKCS127
02470                     - PV-TOP-ITEM + 1.                            TRKCS127
02471      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      TRKCS127
02472          CONTINUE                                                 TRKCS127
02473      ELSE                                                         TRKCS127
02474          SET DP030-SET-CURSOR-APPL-1                              TRKCS127
02475                                    TO TRUE                        TRKCS127
02476          MOVE -1                   TO MR-SELECTL (PV-SUB)         TRKCS127
02477          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         TRKCS127
02478          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         TRKCS127
02479      END-IF.                                                      TRKCS127
02480  EJECT                                                            TRKCS127
02481 *----------------------------------------------------------------*TRKCS127
02482 * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *TRKCS127
02483 * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *TRKCS127
02484 * FOR THE SELECTED ITEMS QUEUE.                                  *TRKCS127
02485 *                                                                *TRKCS127
02486 * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *TRKCS127
02487 * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *TRKCS127
02488 * THE ARRAY IS FULL.                                             *TRKCS127
02489 *----------------------------------------------------------------*TRKCS127
02490                                                                   TRKCS127
02491  5000-PREPARE-SEL-QUEUE.                                          TRKCS127
02492                                                                   TRKCS127
02493      MOVE +1                   TO  ASC-BLK-SUB.                   TRKCS127
02494      PERFORM 5100-WRITE-TEMP-STORAGE.                             TRKCS127
02495      ADD +1                    TO  ASC-BLK-SUB.                   TRKCS127
02496      PERFORM 5100-WRITE-TEMP-STORAGE.                             TRKCS127
02497                                                                   TRKCS127
02498      MOVE ASC-SEL-QUEUE-NAME   TO  TR017-SEL-QUEUE-NAME.          TRKCS127
02499      PERFORM 6010-DELETE-SEL-QUEUE.                               TRKCS127
02500                                                                   TRKCS127
02501      SET ASC-UPDATE-TSQ        TO  TRUE.                          TRKCS127
02502                                                                   TRKCS127
02503      SET TR018-IDX             TO  1.                             TRKCS127
02504      MOVE ZERO                 TO TR017-NUMBER-OF-TS-ITEMS.       TRKCS127
02505      INITIALIZE TR018-SELECTED-ITEM-ARRAY.                        TRKCS127
02506                                                                   TRKCS127
02507      PERFORM 5200-FILL-SEL-QUEUE-RECORD                           TRKCS127
02508              VARYING PV-ITEM                                      TRKCS127
02509              FROM 1 BY 1                                          TRKCS127
02510              UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     TRKCS127
02511                                                                   TRKCS127
02512      IF  TR018-IDX > 1                                            TRKCS127
02513          PERFORM 5205-WRITE-SEL-QUEUE                             TRKCS127
02514          ADD +1                TO TR017-NUMBER-OF-TS-ITEMS        TRKCS127
02515      END-IF.                                                      TRKCS127
02516  EJECT                                                            TRKCS127
02517 *----------------------------------------------------------------*TRKCS127
02518 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *TRKCS127
02519 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *TRKCS127
02520 *----------------------------------------------------------------*TRKCS127
02521                                                                   TRKCS127
02522  5100-WRITE-TEMP-STORAGE.                                         TRKCS127
02523      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     TRKCS127
02524                                    TO PV-LIST-ITEM-NUMBER.        TRKCS127
02525      COMPUTE PV-BLOCK-NUMBER =                                    TRKCS127
02526          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    TRKCS127
02527                                                                   TRKCS127
02528      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             TRKCS127
02529      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             TRKCS127
02530          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      TRKCS127
02531              PERFORM 5105-REWRITE-ASC-LISTQ                       TRKCS127
02532          END-IF                                                   TRKCS127
02533      ELSE                                                         TRKCS127
02534          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       TRKCS127
02535          ASC-HIGHEST-BLOCK-WRITTEN + 1                            TRKCS127
02536          PERFORM 5110-WRITE-ASC-LISTQ                             TRKCS127
02537          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   TRKCS127
02538      END-IF.                                                      TRKCS127
02539                                                                   TRKCS127
02540      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             TRKCS127
02541 ******************************************************************TRKCS127
02542 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **TRKCS127
02543 ** SPECIFIC COMMAREA.                                           **TRKCS127
02544 ******************************************************************TRKCS127
02545  5105-REWRITE-ASC-LISTQ.                                          TRKCS127
02546      EXEC CICS                                                    TRKCS127
02547          WRITEQ TS                                                TRKCS127
02548              QUEUE (ASC-LIST-QUEUE-NAME)                          TRKCS127
02549              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               TRKCS127
02550              ITEM  (PV-BLOCK-NUMBER)                              TRKCS127
02551              REWRITE                                              TRKCS127
02552              RESP  (PV-CICS-RESP)                                 TRKCS127
02553      END-EXEC.                                                    TRKCS127
02554                                                                   TRKCS127
02555      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           TRKCS127
02556          CONTINUE                                                 TRKCS127
02557      ELSE                                                         TRKCS127
02558          SET DP013-CICS-ABEND            TO TRUE                  TRKCS127
02559          SET DP013-NO-ROLLBACK           TO TRUE                  TRKCS127
02560          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       TRKCS127
02561          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     TRKCS127
02562                                          TO DP013-MESSAGE-TEXT(1) TRKCS127
02563          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02564      END-IF.                                                      TRKCS127
02565                                                                   TRKCS127
02566 ******************************************************************TRKCS127
02567 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **TRKCS127
02568 ** SPECIFIC COMMAREA.                                           **TRKCS127
02569 ******************************************************************TRKCS127
02570  5110-WRITE-ASC-LISTQ.                                            TRKCS127
02571      EXEC CICS                                                    TRKCS127
02572          WRITEQ TS                                                TRKCS127
02573              QUEUE (ASC-LIST-QUEUE-NAME)                          TRKCS127
02574              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               TRKCS127
02575              ITEM  (PV-BLOCK-NUMBER)                              TRKCS127
02576              RESP  (PV-CICS-RESP)                                 TRKCS127
02577      END-EXEC.                                                    TRKCS127
02578      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      TRKCS127
02579          SET DP013-CICS-ABEND      TO TRUE                        TRKCS127
02580          SET DP013-NO-ROLLBACK     TO TRUE                        TRKCS127
02581          MOVE '5110-WRITE-ASC-LISTQ'                              TRKCS127
02582                                    TO DP013-PARAGRAPH             TRKCS127
02583          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           TRKCS127
02584                                    TO DP013-MESSAGE-TEXT(1)       TRKCS127
02585          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02586      END-IF.                                                      TRKCS127
02587  EJECT                                                            TRKCS127
02588 *----------------------------------------------------------------*TRKCS127
02589 * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *TRKCS127
02590 * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *TRKCS127
02591 *----------------------------------------------------------------*TRKCS127
02592                                                                   TRKCS127
02593  5200-FILL-SEL-QUEUE-RECORD.                                      TRKCS127
02594                                                                   TRKCS127
02595      PERFORM 6112-READ-LIST-QUEUE.                                TRKCS127
02596                                                                   TRKCS127
02597      IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       TRKCS127
02598          PERFORM                                                  TRKCS127
02599          VARYING LQW-IDX                                          TRKCS127
02600          FROM 1 BY 1                                              TRKCS127
02601          UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            TRKCS127
02602            OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          TRKCS127
02603                                                                   TRKCS127
02604              IF  LQW-SELECT (LQW-IDX)                             TRKCS127
02605                  MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              TRKCS127
02606                                    TO TR018-ITEM (TR018-IDX)      TRKCS127
02607                  MOVE LQW-PO-NBR (LQW-IDX)                        TRKCS127
02608                                    TO TR018-PO-NBR (TR018-IDX)    TRKCS127
02609                  MOVE LQW-EXPTED-CART-CNT (LQW-IDX)               TRKCS127
02610                                    TO TR018-EXPTED-CART-CNT       TRKCS127
02611                                       (TR018-IDX)                 TRKCS127
02612                  MOVE LQW-REC-SEQ-NBR (LQW-IDX)                   TRKCS127
02613                                    TO TR018-REC-SEQ-NBR           TRKCS127
02614                                       (TR018-IDX)                 TRKCS127
02615                  MOVE SPACE        TO TR018-ACTION-SW (TR018-IDX) TRKCS127
02616                  SET TR018-IDX UP BY 1                            TRKCS127
02617                  IF  TR018-IDX > TR018-MAX-ITEMS                  TRKCS127
02618                      PERFORM 5205-WRITE-SEL-QUEUE                 TRKCS127
02619                      ADD +1        TO TR017-NUMBER-OF-TS-ITEMS    TRKCS127
02620                      INITIALIZE TR018-SELECTED-ITEM-ARRAY         TRKCS127
02621                      SET TR018-IDX TO  1                          TRKCS127
02622                  END-IF                                           TRKCS127
02623              END-IF                                               TRKCS127
02624          END-PERFORM                                              TRKCS127
02625      END-IF.                                                      TRKCS127
02626                                                                   TRKCS127
02627 *----------------------------------------------------------------*TRKCS127
02628 *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *TRKCS127
02629 *----------------------------------------------------------------*TRKCS127
02630                                                                   TRKCS127
02631  5205-WRITE-SEL-QUEUE.                                            TRKCS127
02632                                                                   TRKCS127
02633      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            TRKCS127
02634                                    TO TR018-SELECTED-ITEMS.       TRKCS127
02635                                                                   TRKCS127
02636      EXEC CICS                                                    TRKCS127
02637           WRITEQ TS                                               TRKCS127
02638               QUEUE (ASC-SEL-QUEUE-NAME)                          TRKCS127
02639               FROM  (TR018-SHIPMENT-SELECT-RECORD)                TRKCS127
02640               ITEM  (PV-SEL-QUEUE-ITEM)                           TRKCS127
02641               RESP  (PV-CICS-RESP)                                TRKCS127
02642      END-EXEC.                                                    TRKCS127
02643                                                                   TRKCS127
02644      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          TRKCS127
02645          CONTINUE                                                 TRKCS127
02646      ELSE                                                         TRKCS127
02647          SET DP013-CICS-ABEND      TO TRUE                        TRKCS127
02648          SET DP013-NO-ROLLBACK     TO TRUE                        TRKCS127
02649          MOVE '5205-WRITE-SEL-QUEUE'                              TRKCS127
02650                                    TO DP013-PARAGRAPH             TRKCS127
02651          MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          TRKCS127
02652                                    TO DP013-MESSAGE-TEXT(1)       TRKCS127
02653          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02654      END-IF.                                                      TRKCS127
02655  EJECT                                                            TRKCS127
02656 ******************************************************************TRKCS127
02657 ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **TRKCS127
02658 ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **TRKCS127
02659 ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **TRKCS127
02660 ** THE USER.                                                    **TRKCS127
02661 ******************************************************************TRKCS127
02662  6000-REFRESH-PANEL-FROM-TEMP.                                    TRKCS127
02663      IF  ASC-UPDATE-TSQ                                           TRKCS127
02664          SET ASC-NO-TSQ-UPDATE TO TRUE                            TRKCS127
02665          MOVE ZERO                 TO PV-SAVE-ITEM                TRKCS127
02666                                       PV-SEL-QUEUE-ITEM           TRKCS127
02667          MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        TRKCS127
02668                                    TO PV-HOLD-SELECTED-ITEMS      TRKCS127
02669          MOVE +1                   TO PV-ITEMS-PROCESSED          TRKCS127
02670          PERFORM 6100-UPDATE-TSQ                                  TRKCS127
02671              UNTIL PV-ITEMS-PROCESSED >                           TRKCS127
02672                                      PV-HOLD-SELECTED-ITEMS       TRKCS127
02673          PERFORM 6010-DELETE-SEL-QUEUE                            TRKCS127
02674          INITIALIZE ASC-BLOCK-ENTRIES (1)                         TRKCS127
02675                     ASC-BLOCK-ENTRIES (2)                         TRKCS127
02676      END-IF.                                                      TRKCS127
02677                                                                   TRKCS127
02678 *----------------------------------------------------------------*TRKCS127
02679 *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *TRKCS127
02680 *----------------------------------------------------------------*TRKCS127
02681  6010-DELETE-SEL-QUEUE.                                           TRKCS127
02682                                                                   TRKCS127
02683      EXEC CICS                                                    TRKCS127
02684          DELETEQ TS                                               TRKCS127
02685              QUEUE (ASC-SEL-QUEUE-NAME)                           TRKCS127
02686              RESP  (PV-CICS-RESP)                                 TRKCS127
02687      END-EXEC.                                                    TRKCS127
02688 *                                                                 TRKCS127
02689      IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      TRKCS127
02690         (PV-CICS-RESP = DFHRESP(QIDERR)))                         TRKCS127
02691          CONTINUE                                                 TRKCS127
02692      ELSE                                                         TRKCS127
02693          SET DP013-CICS-ABEND TO TRUE                             TRKCS127
02694          SET DP013-NO-ROLLBACK TO TRUE                            TRKCS127
02695          MOVE '6010-DELETE-SEL-QUEUE'                             TRKCS127
02696                         TO DP013-PARAGRAPH                        TRKCS127
02697          MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         TRKCS127
02698                         TO DP013-MESSAGE-TEXT (1)                 TRKCS127
02699          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02700      END-IF.                                                      TRKCS127
02701                                                                   TRKCS127
02702 *----------------------------------------------------------------*TRKCS127
02703 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *TRKCS127
02704 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *TRKCS127
02705 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *TRKCS127
02706 *    THE TEMP QUEUE.                                             *TRKCS127
02707 *----------------------------------------------------------------*TRKCS127
02708                                                                   TRKCS127
02709  6100-UPDATE-TSQ.                                                 TRKCS127
02710                                                                   TRKCS127
02711      ADD 1                     TO  PV-SEL-QUEUE-ITEM.             TRKCS127
02712      PERFORM 6105-READ-SEL-QUEUE.                                 TRKCS127
02713      PERFORM                                                      TRKCS127
02714          VARYING TR018-IDX                                        TRKCS127
02715          FROM 1 BY 1                                              TRKCS127
02716          UNTIL ((PV-ITEMS-PROCESSED >                             TRKCS127
02717                               PV-HOLD-SELECTED-ITEMS)             TRKCS127
02718          OR (TR018-IDX GREATER THAN TR018-MAX-ITEMS))             TRKCS127
02719          IF  TR018-ACTION-SW (TR018-IDX) > SPACE                  TRKCS127
02720              PERFORM 6110-PROCESS-ITEMS                           TRKCS127
02721          END-IF                                                   TRKCS127
02722          ADD +1                TO PV-ITEMS-PROCESSED              TRKCS127
02723      END-PERFORM.                                                 TRKCS127
02724      PERFORM 6111-WRITE-LIST-QUEUE.                               TRKCS127
02725 *----------------------------------------------------------------*TRKCS127
02726 *    READ THE LIST QUEUE RECORD.                                 *TRKCS127
02727 *----------------------------------------------------------------*TRKCS127
02728                                                                   TRKCS127
02729  6105-READ-SEL-QUEUE.                                             TRKCS127
02730                                                                   TRKCS127
02731      EXEC CICS                                                    TRKCS127
02732           READQ TS                                                TRKCS127
02733               QUEUE (ASC-SEL-QUEUE-NAME)                          TRKCS127
02734               INTO  (TR018-SHIPMENT-SELECT-RECORD)                TRKCS127
02735               ITEM  (PV-SEL-QUEUE-ITEM)                           TRKCS127
02736               RESP  (PV-CICS-RESP)                                TRKCS127
02737      END-EXEC.                                                    TRKCS127
02738 *                                                                 TRKCS127
02739      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          TRKCS127
02740          CONTINUE                                                 TRKCS127
02741      ELSE                                                         TRKCS127
02742          SET DP013-CICS-ABEND      TO  TRUE                       TRKCS127
02743          SET DP013-NO-ROLLBACK     TO  TRUE                       TRKCS127
02744          MOVE '6105-READ-SEL-QUEUE'                               TRKCS127
02745                                    TO  DP013-PARAGRAPH            TRKCS127
02746          MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           TRKCS127
02747                                    TO  DP013-MESSAGE-TEXT(1)      TRKCS127
02748          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02749      END-IF.                                                      TRKCS127
02750  EJECT                                                            TRKCS127
02751 *----------------------------------------------------------------*TRKCS127
02752 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*TRKCS127
02753 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*TRKCS127
02754 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *TRKCS127
02755 *----------------------------------------------------------------*TRKCS127
02756                                                                   TRKCS127
02757  6110-PROCESS-ITEMS.                                              TRKCS127
02758                                                                   TRKCS127
02759      COMPUTE PV-ITEM = 1 + ((TR018-ITEM (TR018-IDX) - 1)          TRKCS127
02760                      / PC-ITEMS-PER-PANEL).                       TRKCS127
02761                                                                   TRKCS127
02762      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           TRKCS127
02763          IF  PV-SAVE-ITEM NOT EQUAL ZERO                          TRKCS127
02764              PERFORM 6111-WRITE-LIST-QUEUE                        TRKCS127
02765          END-IF                                                   TRKCS127
02766          MOVE PV-ITEM          TO PV-SAVE-ITEM                    TRKCS127
02767                                                                   TRKCS127
02768          PERFORM 6112-READ-LIST-QUEUE                             TRKCS127
02769          IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               TRKCS127
02770              CONTINUE                                             TRKCS127
02771          END-IF                                                   TRKCS127
02772      END-IF.                                                      TRKCS127
02773                                                                   TRKCS127
02774      COMPUTE PV-SUB = (TR018-ITEM (TR018-IDX)                     TRKCS127
02775                     - LQW-LIST-ITEM-NUMBER (1)) + 1.              TRKCS127
02776      SET LQW-DESELECT (PV-SUB) TO    TRUE                         TRKCS127
02777      MOVE LQW-SELECTED-SW (PV-SUB)                                TRKCS127
02778                                TO LQW-TEMP-SELECTED-SW (PV-SUB).  TRKCS127
02779      EVALUATE TRUE                                                TRKCS127
02780          WHEN TR018-INQ (TR018-IDX)                               TRKCS127
02781               MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             TRKCS127
02782                                                                   TRKCS127
02783          WHEN TR018-UPD (TR018-IDX)                               TRKCS127
02784               MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             TRKCS127
02785                                                                   TRKCS127
02786          WHEN TR018-DEL (TR018-IDX)                               TRKCS127
02787               MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             TRKCS127
02788                                                                   TRKCS127
02789          WHEN TR018-ERR (TR018-IDX)                               TRKCS127
02790               MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             TRKCS127
02791      END-EVALUATE.                                                TRKCS127
02792                                                                   TRKCS127
02793      SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                TRKCS127
02794                                                                   TRKCS127
02795 *----------------------------------------------------------------*TRKCS127
02796 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *TRKCS127
02797 *----------------------------------------------------------------*TRKCS127
02798                                                                   TRKCS127
02799  6111-WRITE-LIST-QUEUE.                                           TRKCS127
02800                                                                   TRKCS127
02801      EXEC CICS                                                    TRKCS127
02802          WRITEQ TS                                                TRKCS127
02803              QUEUE (ASC-LIST-QUEUE-NAME)                          TRKCS127
02804              FROM  (LQW-LIST-QUEUE-WORK-AREA)                     TRKCS127
02805              ITEM  (PV-SAVE-ITEM)                                 TRKCS127
02806              REWRITE                                              TRKCS127
02807              RESP  (PV-CICS-RESP)                                 TRKCS127
02808      END-EXEC.                                                    TRKCS127
02809 *                                                                 TRKCS127
02810      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          TRKCS127
02811          CONTINUE                                                 TRKCS127
02812      ELSE                                                         TRKCS127
02813          SET DP013-CICS-ABEND  TO  TRUE                           TRKCS127
02814          SET DP013-NO-ROLLBACK TO  TRUE                           TRKCS127
02815          MOVE '6111-WRITE-LIST-QUEUE'                             TRKCS127
02816                                TO  DP013-PARAGRAPH                TRKCS127
02817          MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  TRKCS127
02818                                TO  DP013-MESSAGE-TEXT(1)          TRKCS127
02819          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02820      END-IF.                                                      TRKCS127
02821                                                                   TRKCS127
02822  EJECT                                                            TRKCS127
02823 *----------------------------------------------------------------*TRKCS127
02824 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*TRKCS127
02825 *----------------------------------------------------------------*TRKCS127
02826                                                                   TRKCS127
02827  6112-READ-LIST-QUEUE.                                            TRKCS127
02828                                                                   TRKCS127
02829      EXEC CICS                                                    TRKCS127
02830          READQ TS                                                 TRKCS127
02831              QUEUE (ASC-LIST-QUEUE-NAME)                          TRKCS127
02832              INTO  (LQW-LIST-QUEUE-WORK-AREA)                     TRKCS127
02833              ITEM  (PV-ITEM)                                      TRKCS127
02834              RESP  (PV-CICS-RESP)                                 TRKCS127
02835      END-EXEC.                                                    TRKCS127
02836 *                                                                 TRKCS127
02837      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          TRKCS127
02838          CONTINUE                                                 TRKCS127
02839      ELSE                                                         TRKCS127
02840          SET DP013-CICS-ABEND        TO TRUE                      TRKCS127
02841          SET DP013-NO-ROLLBACK       TO TRUE                      TRKCS127
02842          MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           TRKCS127
02843          MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    TRKCS127
02844                                      TO DP013-MESSAGE-TEXT(1)     TRKCS127
02845          PERFORM DP013-0000-PROCESS-ABEND                         TRKCS127
02846      END-IF.                                                      TRKCS127
02847                                                                   TRKCS127
02848  EJECT                                                            TRKCS127
02849 *----------------------------------------------------------------*TRKCS127
02850 *    ABEND PROCESSOR MODULE                                      *TRKCS127
02851 *----------------------------------------------------------------*TRKCS127
02852                                                                   TRKCS127
02853      COPY DPPD013.                                                TRKCS127
