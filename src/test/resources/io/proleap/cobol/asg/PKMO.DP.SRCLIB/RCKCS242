000100******************************************************************00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300******************************************************************00030011
000400                                                                  00040011
000500 PROGRAM-ID.                RCKCS242.                             00050011
000600 AUTHOR.                    LARRY SCHLEICHER - STRATAGEM.         00060011
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070011
000800 DATE-WRITTEN.              04-14-94.                             00080011
000900 DATE-COMPILED.                                                   00090011
001000                                                                  00100011
001100******************************************************************00110011
001200*  CICS PROGRAM - RCKCS242 - E242                                *00120011
001300*                                                                *00130011
001400*       TICKET FORMAT SELECTION                                  *00140011
001500*                                                                *00150011
001600*       THIS PROGRAM ALLOWS THE ENTRY OF TICKET FORMAT           *00160011
001700*  INFORMATION.                                                  *00170011
001800*                                                                *00180011
001900*                                                                *00190011
002000*       DIRECT ENTRY INTO THIS TRANSACTION IS PROHIBITED.        *00200011
002100*  ATTEMPTING TO DO THIS RESULTS IN AN XCTL TO THE COMMON LOGON  *00210011
002200*  TRANSACTION FOR THIS SYSTEM, TO ACQUIRE THE SECURITY          *00220011
002300*  INFORMATION, AND POSITION THE USER INTO THE CORRECT MENU      *00230011
002400*  STRUCTURE FOR HIS/HER SECURITY LEVEL.                         *00240011
002500******************************************************************00250011
002600*  CHANGED 10/13/2014    BY COGNIZANT       WR: CHG0094517        00260011
002700*                                                                 00270011
002800* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00280011
002900*-----------------------------------------------------------------00290011
003000* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00300011
003100* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00310011
003200* MAKING THE CALL DYNAMIC VS STATIC.                              00320011
003300*---------------------------------------------------------------* 00330011
003400                                                                  00340011
003500******************************************************************00350011
003600 ENVIRONMENT DIVISION.                                            00360011
003700******************************************************************00370011
003800                                                                  00380011
003900******************************************************************00390011
004000 DATA DIVISION.                                                   00400011
004100******************************************************************00410011
004200                                                                  00420011
004300 WORKING-STORAGE SECTION.                                         00430011
004400*                                                                 00440011
004500*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00450011
004600*                                                                 00460011
004700     COPY DPWS010I.                                               00470011
004800                                                                  00480011
004900******************************************************************00490011
005000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00500011
005100     COPY DPWS013.                                                00510011
005200*                                                                 00520011
005300******************************************************************00530011
005400*  CICS ATTRIBUTES COPYBOOK                                       00540011
005500     COPY DPWS015.                                                00550011
005600*                                                                 00560011
005700******************************************************************00570011
005800*  FUNCTION KEYS COPYBOOK                                         00580011
005900     COPY DPWS016.                                                00590011
006000*                                                                 00600011
006100*---------------------------------------------------------------* 00610011
006200*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 00620011
006300*---------------------------------------------------------------* 00630011
006400     COPY PCWS016.                                                00640011
006500                                                                  00650011
006600*----------------------------------------------------------------*00660011
006700*    COPYBOOK FOR LOCATION CALL MODULE                            00670011
006800*-----------------------------------------------------------------00680011
006900     COPY XLWS071.                                                00690011
007000                                                                  00700011
007100******************************************************************00710011
007200*  STANDARD ATTENTION IDENTIFIER LIST                             00720011
007300*                                                                 00730011
007400     COPY DFHAID.                                                 00740011
007500*                                                                 00750011
007600*  STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST          00760011
007700*                                                                 00770011
007800     COPY DFHBMSCA.                                               00780011
007900*                                                                 00790011
008000*  DSECT FOR THE RCKM242 MAPSET                                   00800011
008100*                                                                 00810011
008200     COPY RCKM242.                                                00820011
008300                                                                  00830011
008400 01  MR-OCCURS-LAYOUT                 REDEFINES RC242AO.          00840011
008500     05  FILLER                       PIC X(100).                 00850011
008600     05  MR-SCROLL-AREA               OCCURS 36 TIMES.            00860011
008700         10  MR-FORMATL               PIC S9(4) COMP.             00870011
008800         10  MR-FORMATA               PIC X.                      00880011
008900         10  MR-FORMATC               PIC X.                      00890011
009000         10  MR-FORMATH               PIC X.                      00900011
009100         10  MR-FORMAT                PIC X(06).                  00910011
009200                                                                  00920011
009300 01  DK-DB2-KEYS.                                                 00930011
009400     05  DK-OPER-UNT-ID                 PIC S9(04)  COMP VALUE +0.00940011
009500     05  DK-FCLTY-ID                    PIC S9(04)  COMP VALUE +0.00950011
009600     05  DK-PO-NBR                      PIC S9(09)  COMP VALUE +0.00960011
009700     05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP VALUE +0.00970011
009800                                                                  00980011
009900 01  PS-PROGRAM-SWITCHES.                                         00990011
010000     05  PS-EDIT-ERROR-IND       PIC X(1)     VALUE 'N'.          01000011
010100         88  PS-NO-EDIT-ERROR                 VALUE 'N'.          01010011
010200         88  PS-EDIT-ERROR                    VALUE 'Y'.          01020011
010300     05  PS-INVALID-OPER-ID-IND  PIC X(1)     VALUE 'N'.          01030011
010400         88  PS-INVALID-OPER-ID               VALUE 'Y'.          01040011
010500     05  PS-INVALID-FACILITY-IND PIC X(1)     VALUE 'N'.          01050011
010600         88  PS-INVALID-FACILITY              VALUE 'Y'.          01060011
010700     05  PS-END-OF-FORMAT-CSR-SW PIC X(1)     VALUE 'N'.          01070011
010800         88  PS-END-OF-FORMAT-CSR             VALUE 'Y'.          01080011
010900     05  PS-COMMAREA-SW          PIC  X(01)   VALUE 'N'.          01090011
011000         88  PS-COMMAREA-VALID                VALUE 'Y'.          01100011
011100         88  PS-COMMAREA-NOT-VALID            VALUE 'N'.          01110011
011200                                                                  01120011
011300 01  PC-PROGRAM-CONSTANTS.                                        01130011
011400     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'RCKCS242'.   01140011
011500     05  PC-CURRENT-MAPSET-NAME  PIC X(08)    VALUE 'RCKM242'.    01150011
011600     05  PC-CURRENT-MAP-NAME     PIC X(08)    VALUE 'RC242A'.     01160011
011800     05  PC-KOHLS-OPERATING-COMPANY                               01180011
011900                                 PIC X(2)     VALUE '03'.         01190011
012000     05  PC-EOF-KEYED-COMP       PIC S9(4)    VALUE +128          01200011
012100                                 COMP SYNC.                       01210011
012200     05  FILLER                  REDEFINES PC-EOF-KEYED-COMP.     01220011
012300         10  FILLER              PIC X(1).                        01230011
012400         10  PC-EOF-KEYED        PIC X(1).                        01240011
012500     05  PC-MAX-RETRIES          PIC S9(4)    VALUE +3            01250011
012600                                                COMP SYNC.        01260011
012700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01270011
012800     05  PC-INTER-APPL-CODES.                                     01280011
012900         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(04)  VALUE '1'.    01290011
013000         10  PC-INTER-APPL-WO-REC-LIST  PIC  X(04)  VALUE '2'.    01300011
013100         10  PC-INTER-APPL-TKT-MENU     PIC  X(04)  VALUE '3'.    01310011
013200         10  PC-INTER-APPL-RCV-ITM-LST  PIC  X(01)  VALUE '4'.    01320011
013300                                                                  01330011
013400 01  PC-TSYMSG-AREA.                                              01340011
013500*  INVALID ENTRY 00005                                            01350011
013600     05  PC-TSYMSG-00005      PIC 9(5) VALUE 00005.               01360011
013700*  REQUIRED ENTRY                                                 01370011
013800     05  PC-TSYMSG-00007      PIC 9(5) VALUE 00007.               01380011
013900*  MUST BE NUMERIC                                                01390011
014000     05  PC-TSYMSG-00008      PIC 9(5) VALUE 00008.               01400011
014100     05  PC-TSYMSG-00069      PIC 9(5) VALUE 00069.               01410011
014200     05  PC-TSYMSG-00070      PIC 9(5) VALUE 00070.               01420011
014300*  INVALID TICKET FORMAT -- 00948                                 01430011
014400     05  PC-TSYMSG-00948      PIC 9(5) VALUE 00948.               01440011
014500*  INVALID DISTRIBUTION CENTER -- 02319                           01450011
014600     05  PC-TSYMSG-02319      PIC 9(5) VALUE 02319.               01460011
014700                                                                  01470011
014800 01  PV-PROGRAM-VARIABLES.                                        01480011
014900     05  PV-SQL-SUB              PIC S9(04)   COMP VALUE +0.      01490011
015000     05  PV-INDX                 PIC S9(04)   COMP VALUE +0.      01500011
015100     05  PV-CICS-RESP            PIC S9(9)    VALUE ZERO          01510011
015200                                 COMP SYNC.                       01520011
015300     05  PV-DISP-OPER-UNT-ID-X.                                   01530011
015400         10 PV-DISP-OPER-UNT-ID    PIC  9(04)  VALUE ZERO.        01540011
015500                                                                  01550011
015600 01  IC-ISO-CURRENT-DATE-AREA.                                    01560011
015700     05  IC-ISO-CURRENT-DATE-X.                                   01570011
015800         10  IC-CURRENT-YEAR     PIC 9(4)     VALUE ZERO.         01580011
015900         10  FILLER              PIC X(6)     VALUE SPACES.       01590011
016000     05  FILLER                  REDEFINES IC-ISO-CURRENT-DATE-X. 01600011
016100         10  FILLER              PIC X(2).                        01610011
016200         10  IC-CURRENT-YY-MM-DD PIC X(8).                        01620011
016300     05  IC-ISO-CURRENT-DATE     REDEFINES IC-ISO-CURRENT-DATE-X  01630011
016400                                 PIC X(10).                       01640011
016500                                                                  01650011
016600******************************************************************01660011
016700*    STANDARD COMMAREA DEFINITION                                 01670011
016800******************************************************************01680011
016810                                                                  01681012
016820******************************************************************01682012
016830** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **01683012
016840** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01684012
016850******************************************************************01685012
016900     COPY DPWS030.                                                01690011
016910     COPY DPWS930.                                                01691012
016920                                                                  01692012
017000     COPY DPWS020.                                                01700011
017100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01710011
017200                                                                  01720011
017300*----------------------------------------------------------------*01730011
017400* INTER-APPLICATION COMMAREA.                                    *01740011
017500*----------------------------------------------------------------*01750011
017600         10  INTER-APPL-COMM-AREA       PIC X(200).               01760011
017700     COPY PCWS000.                                                01770011
017800*-------------------------------------------------------------*   01780011
017900*    INTER-APPLICATION COMMAREA                               *   01790011
018000*-------------------------------------------------------------*   01800011
018100         10  ASC-SPECIFIC-COMMAREA.                               01810011
018200             15  ASC-LIST-KEYS.                                   01820011
018300                 20  ASC-OPER-UNT-ID       PIC X(04).             01830011
018400                 20  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID  01840011
018500                                           PIC 9(04).             01850011
018600                 20  ASC-FCLTY-ID          PIC X(04).             01860011
018700                 20  ASC-FCLTY-ID-N    REDEFINES ASC-FCLTY-ID     01870011
018800                                           PIC 9(04).             01880011
018900                 20  ASC-PO-NBR.                                  01890011
019000                     25  ASC-PO-NBR-N      PIC 9(08).             01900011
019100                 20  ASC-SEQ-NBR.                                 01910011
019200                     25  ASC-SEQ-NBR-N     PIC 9(03).             01920011
019300                 20  ASC-LINE-NBR-X.                              01930011
019400                     25  ASC-LINE-NBR-N    PIC 9(04).             01940011
019500             15  ASC-FCLTY-NME             PIC X(24).             01950011
019600             15  ASC-TKT-FORMAT            PIC X(06).             01960011
019700             15  ASC-SAVE-TKT-FORMAT       PIC X(06).             01970011
019800             15  ASC-INTER-APPL-FORMAT-IND PIC X(01).             01980011
019900             15  ASC-FORMAT-TABLE.                                01990011
020000                 20  ASC-FORMAT-ITEMS OCCURS 36 TIMES.            02000011
020100                     25  ASC-FORMAT        PIC X(06).             02010011
020200             15  ASC-HOLD-INTER-APPL       PIC X(200).            02020011
020300             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     02030011
020400             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     02040011
020500             15  ASC-SEL-SUB            PIC S9(04) COMP.          02050011
020600             15  ASC-SEL-ITEM           PIC S9(04) COMP.          02060011
020700             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02070011
020800                                        PIC S9(09) COMP-3.        02080011
020900             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        02090011
021000             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        02100011
021100             15  ASC-TEMP-QUEUE-UPDATE-SW                         02110011
021200                                        PIC X(01).                02120011
021300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     02130011
021400                 88  ASC-UPDATE-TSQ2               VALUE '2'.     02140011
021500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     02150011
021600             15  ASC-LIST-QUEUE-NAME.                             02160011
021700                 20  ASC-LIST-TERM-ID   PIC X(04).                02170011
021800                 20  ASC-LIST-TASK-NUMBER                         02180011
021900                                        PIC S9(05) COMP-3.        02190011
022000                 20  ASC-LIST-SEQ       PIC 9(01).                02200011
022100             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               02210011
022200             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         02220011
022300                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         02230011
022400                                                                  02240011
022500                                                                  02250011
022600******************************************************************02260011
022700*    DB2 DCLGEN FOR TICKET FORMAT TABLE                           02270011
022800******************************************************************02280011
022900     EXEC SQL                                                     02290011
023000          INCLUDE TTKTFMT                                         02300011
023100     END-EXEC.                                                    02310011
023200                                                                  02320011
023300******************************************************************02330011
023400*    DB2 DCLGEN FOR PRINT STOCK TABLE                             02340011
023500******************************************************************02350011
023600     EXEC SQL                                                     02360011
023700          INCLUDE TPRTSTK                                         02370011
023800     END-EXEC.                                                    02380011
023900                                                                  02390011
024000*                                                                 02400011
024100*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                02410011
024200*                                                                 02420011
024300     EXEC SQL                                                     02430011
024400         INCLUDE SQLCA                                            02440011
024500     END-EXEC.                                                    02450011
024600                                                                  02460011
024700     EXEC SQL                                                     02470011
024800          DECLARE FORMATS-CURSOR CURSOR FOR                       02480011
024900          SELECT DISTINCT                                         02490011
025000                 TKT_FMT_ID                                       02500011
025100            FROM TTKTFMT                                          02510011
025200           WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID                 02520011
025300             AND FCLTY_ID       = :DK-FCLTY-ID                    02530011
025400             AND TYP_CDE        = 'I'                             02540011
025500     END-EXEC.                                                    02550011
025600******************************************************************02560011
025700 LINKAGE SECTION.                                                 02570011
025800******************************************************************02580011
025900 01  DFHCOMMAREA.                                                 02590011
026000     05  FILLER                       OCCURS 1 TO 4072 TIMES      02600011
026100                                      DEPENDING ON EIBCALEN.      02610011
026200         10  FILLER                   PIC X.                      02620011
026300******************************************************************02630011
026400 PROCEDURE DIVISION.                                              02640011
026500******************************************************************02650011
026600 0000-MAIN-MODULE.                                                02660011
026700     INITIALIZE DP030-CICS-API-FIELDS.                            02670011
026800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02680011
026900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02690011
027000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02700011
027100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02710011
027200     MOVE LENGTH OF RC242AI        TO DP030-MAP-LENGTH (1).       02720011
027300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02730011
027400     PERFORM 0001-CALL-CICS-ARCH-API.                             02740011
027500*                                                                 02750011
027600     PERFORM 1000-CONTROL-PROCESSING                              02760011
027700*                                                                 02770011
027800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02780011
027900     PERFORM 0001-CALL-CICS-ARCH-API.                             02790011
028000                                                                  02800011
028100 0001-CALL-CICS-ARCH-API.                                         02810011
028210     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02821012
028300                                    DFHCOMMAREA                   02830012
028400                                    DP030-CICS-API-FIELDS         02840012
028500                                    DP020-STANDARD-COMMAREA       02850012
028600                                    RC242AI.                      02860012
028700*                                                                 02870011
028800     IF  DP030-RC-CALL-SUCCESSFUL                                 02880011
028900         CONTINUE                                                 02890011
029000     ELSE                                                         02900011
029100         SET DP013-NO-ROLLBACK                                    02910011
029200             DP013-XCTL-DISPLAY-RESTART                           02920011
029300             DP013-CICS-ABEND      TO TRUE                        02930011
029400         MOVE 'BEFORE 0000-MAIN-MODULE'                           02940011
029500                                   TO DP013-PARAGRAPH             02950011
029520         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O02952012
029530-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02953012
029800         MOVE DP030-RETURN-CODE                                   02980011
029900                                   TO DP013-MESSAGE-TEXT (3)      02990011
030000         PERFORM DP013-0000-PROCESS-ABEND                         03000011
030100     END-IF.                                                      03010011
030200 EJECT                                                            03020011
030300*----------------------------------------------------------------*03030011
030400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03040011
030500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03050011
030600*----------------------------------------------------------------*03060011
030700 1000-CONTROL-PROCESSING.                                         03070011
030800     EVALUATE TRUE                                                03080011
030900         WHEN DP020-NEXT-ACT-INITIAL                              03090011
031000             MOVE INTER-APPL-COMM-AREA  TO ASC-HOLD-INTER-APPL    03100011
031100         WHEN OTHER                                               03110011
031200             MOVE ASC-HOLD-INTER-APPL   TO INTER-APPL-COMM-AREA   03120011
031300     END-EVALUATE.                                                03130011
031400                                                                  03140011
031500     EVALUATE TRUE                                                03150011
031600         WHEN DP020-NEXT-ACT-INITIAL                              03160011
031700             INITIALIZE ASC-SPECIFIC-COMMAREA                     03170011
031800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            03180011
031900             MOVE DP020-SRC-TASK-NUMBER                           03190011
032000                                   TO ASC-LIST-TASK-NUMBER        03200011
032100             MOVE PC-LIST-QUEUE-SEQ                               03210011
032200                                   TO ASC-LIST-SEQ                03220011
032300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03230011
032400             IF  PS-COMMAREA-NOT-VALID                            03240011
032500                 SET DP020-MSG-FATAL                              03250011
032600                     DP020-NEXT-ACT-APPL-ERROR TO TRUE            03260011
032700             ELSE                                                 03270011
032800                 MOVE INTER-APPL-COMM-AREA                        03280011
032900                                   TO ASC-HOLD-INTER-APPL         03290011
033000                 PERFORM 3200-RESET-ATTRIBUTES                    03300011
033100                 PERFORM 4000-BUILD-INITIAL-PANEL                 03310011
033200             END-IF                                               03320011
033300                                                                  03330011
033400         WHEN DP020-NEXT-ACT-READ-MAP                             03340011
033500             PERFORM 2000-FKEY-PROCESSING                         03350011
033600                                                                  03360011
033700         WHEN DP020-NEXT-ACT-RETURN                               03370011
033800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03380011
033900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03390011
034000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  03400011
034100             MOVE -1      TO AFORMATL                             03410011
034200                                                                  03420011
034300         WHEN OTHER                                               03430011
034400             SET DP013-LOGIC-ABEND                                03440011
034500                 DP013-NO-ROLLBACK TO TRUE                        03450011
034600             MOVE '1000-CONTROL-PROCESSING'                       03460011
034700                                   TO  DP013-PARAGRAPH            03470011
034800             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03480011
034900                                   TO  DP013-MESSAGE-TEXT(1)      03490011
035000             MOVE DP020-NEXT-APPL-ACTIVITY                        03500011
035100                                   TO DP013-MESSAGE-TEXT(2)       03510011
035200             PERFORM DP013-0000-PROCESS-ABEND                     03520011
035300     END-EVALUATE.                                                03530011
035400                                                                  03540011
035500*----------------------------------------------------------------*03550011
035600* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *03560011
035700*----------------------------------------------------------------*03570011
035800 1100-PROCESS-INTER-APPL-COMM.                                    03580011
035900     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INTER-APPL-FORMAT-IND. 03590011
036000     MOVE ZEROS                     TO ASC-PO-NBR-N               03600011
036100                                    ASC-SEQ-NBR-N                 03610011
036200                                    ASC-LINE-NBR-N.               03620011
036300                                                                  03630011
036400     SET PS-COMMAREA-VALID          TO TRUE.                      03640011
036500                                                                  03650011
036600     EVALUATE DP020-INT-APPL-FORMAT-IND                           03660011
036700                                                                  03670011
036800         WHEN PC-INTER-APPL-TKT-MENU                              03680011
036900             MOVE DP020-LOCATION-NBR                              03690011
037000                                 TO ASC-OPER-UNT-ID-N             03700011
037100             MOVE '0001'         TO ASC-FCLTY-ID                  03710011
037200             INITIALIZE PC000-INTER-APPL-COMMAREA                 03720011
037300             MOVE ZERO           TO ASC-LINE-NBR-N                03730011
037400                                                                  03740011
037500         WHEN PC-INTER-APPL-CRIT-SPEC                             03750011
037600             MOVE PC000-OPERATING-UNIT-ID                         03760011
037700                                 TO ASC-OPER-UNT-ID-N             03770011
037800             MOVE PC000-FACILITY-ID                               03780011
037900                                 TO ASC-FCLTY-ID-N                03790011
038000             MOVE PC000-PO-NBR-N                                  03800011
038100                                 TO ASC-PO-NBR-N                  03810011
038200             MOVE PC000-REC-SEQ-NBR-N                             03820011
038300                                 TO ASC-SEQ-NBR-N                 03830011
038400             MOVE PC000-LINE-NBR-N                                03840011
038500                             TO ASC-LINE-NBR-N                    03850011
038600                                                                  03860011
038700         WHEN PC-INTER-APPL-WO-REC-LIST                           03870011
038800         WHEN PC-INTER-APPL-RCV-ITM-LST                           03880011
038900              SET ASC-USE-SELECTION-QUEUE                         03890011
039000                                   TO TRUE                        03900011
039100              MOVE PC000-NUMBER-OF-SELECTED-ITEMS                 03910011
039200                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03920011
039300              MOVE PC000-NUMBER-OF-TS-ITEMS                       03930011
039400                                   TO ASC-NUMBER-OF-TS-ITEMS      03940011
039500              MOVE PC000-SEL-QUEUE-NAME                           03950011
039600                                   TO ASC-SEL-QUEUE-NAME-IN       03960011
039700              PERFORM 1120-PREPARE-LIST-ENTRY                     03970011
039800     END-EVALUATE.                                                03980011
039900                                                                  03990011
040000*----------------------------------------------------------------*04000011
040100*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *04010011
040200*  QUEUE PASSED FROM THE LIST.                                   *04020011
040300*----------------------------------------------------------------*04030011
040400 1120-PREPARE-LIST-ENTRY.                                         04040011
040500      MOVE PC016-MAX-ITEMS         TO ASC-SEL-SUB.                04050011
040600      MOVE ZERO                    TO ASC-SEL-ITEM.               04060011
040700      PERFORM 2300-GET-NEXT-RECORD.                               04070011
040800                                                                  04080011
040900*----------------------------------------------------------------*04090011
041000* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04100011
041100* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04110011
041200* EDITS.                                                         *04120011
041300*----------------------------------------------------------------*04130011
041400 2000-FKEY-PROCESSING.                                            04140011
041500     EVALUATE TRUE                                                04150011
041600                                                                  04160011
041700         WHEN DP020-SRC-AID = DP016-CLEAR                         04170011
041800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04180011
041900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04190011
042000                                                                  04200011
042100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04210011
042200             PERFORM 4000-BUILD-INITIAL-PANEL                     04220011
042300             PERFORM 3200-RESET-ATTRIBUTES                        04230011
042400                                                                  04240011
042500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04250011
042600             IF ASC-USE-SELECTION-QUEUE                           04260011
042700                 PERFORM 6200-DEL-LIST-QUEUE                      04270011
042800                 PERFORM 2300-GET-NEXT-RECORD                     04280011
042900                 PERFORM 3200-RESET-ATTRIBUTES                    04290011
043000                 PERFORM 4000-BUILD-INITIAL-PANEL                 04300011
043100             ELSE                                                 04310011
043200*                --- BOTTOM OF LIST ---                           04320011
043300                 MOVE PC-TSYMSG-00070                             04330011
043400                                   TO DP020-MSG-NUMBER            04340011
043500                 SET DP020-MSG-INFORMATIONAL                      04350011
043600                                   TO TRUE                        04360011
043700             END-IF                                               04370011
043800                                                                  04380011
043900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04390011
044000             IF ASC-USE-SELECTION-QUEUE                           04400011
044100                 PERFORM 6200-DEL-LIST-QUEUE                      04410011
044200                 PERFORM 2310-GET-PREV-RECORD                     04420011
044300                 PERFORM 3200-RESET-ATTRIBUTES                    04430011
044400                 PERFORM 4000-BUILD-INITIAL-PANEL                 04440011
044500             ELSE                                                 04450011
044600*                --- TOP OF LIST ---                              04460011
044700                 MOVE PC-TSYMSG-00069                             04470011
044800                                   TO DP020-MSG-NUMBER            04480011
044900                 SET DP020-MSG-INFORMATIONAL                      04490011
045000                                   TO TRUE                        04500011
045100             END-IF                                               04510011
045200                                                                  04520011
045300         WHEN OTHER                                               04530011
045400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04540011
045500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04550011
045600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04560011
045700             IF  PS-NO-EDIT-ERROR                                 04570011
045800                 SET DP030-CONTINUE-GO TO TRUE                    04580011
045900                 MOVE -1      TO AFORMATL                         04590011
046000*                PERFORM 2100-CHECK-FUNCTION-KEY                  04600011
046100             ELSE                                                 04610011
046200                 SET DP030-OVERRIDE-GO TO TRUE                    04620011
046300             END-IF                                               04630011
046400     END-EVALUATE.                                                04640011
046500******************************************************************04650011
046600* BAB - PERFORM THIS PARAGRAPH AFTER ALL THE EDITS HAVE           04660011
046700*       BEEN MADE AND THEN CHECK THE INT-APPL-FORMAT-IND          04670011
046800*       TO SEE WHAT PF KEY HAS BEEN SELECTED.                     04680011
046900*                                                                 04690011
047000*                                                                 04700011
047100** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04710011
047200** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04720011
047300** FROM THE CICS ARCHITECTURE API.                              **04730011
047400******************************************************************04740011
047500 2100-CHECK-FUNCTION-KEY.                                         04750011
047600     EVALUATE TRUE                                                04760011
047700         WHEN DP020-SRC-AID = DP016-ENTER                         04770011
047800         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 04780011
047900         MOVE -1      TO AFORMATL                                 04790011
048000                                                                  04800011
048100         WHEN OTHER                                               04810011
048200             SET DP013-NO-ROLLBACK                                04820011
048300                 DP013-XCTL-DISPLAY-RESTART                       04830011
048400                 DP013-CICS-ABEND  TO TRUE                        04840011
048500             MOVE '2100-CHECK-FUNCTION-KEY'                       04850011
048600                                   TO DP013-PARAGRAPH             04860011
048700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04870011
048800                                   TO DP013-MESSAGE-TEXT (1)      04880011
048900             PERFORM DP013-0000-PROCESS-ABEND                     04890011
049000     END-EVALUATE.                                                04900011
049100                                                                  04910011
049200*----------------------------------------------------------------*04920011
049300* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04930011
049400* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04940011
049500* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04950011
049600*----------------------------------------------------------------*04960011
049700 2200-MOVE-SCREEN-TO-COMMAREA.                                    04970011
049800     IF  AOPRIDL > ZERO                                           04980011
049900         MOVE AOPRIDI              TO ASC-OPER-UNT-ID             04990011
050000     ELSE                                                         05000011
050100         IF  ASC-OPER-UNT-ID-N > 0                                05010011
050200             IF  AOPRIDF = DP015-ERASE-EOF                        05020011
050300                 MOVE ZEROES       TO ASC-OPER-UNT-ID-N           05030011
050400             END-IF                                               05040011
050500         END-IF                                                   05050011
050600     END-IF.                                                      05060011
050700                                                                  05070011
050800     IF  AFACIDL > ZERO                                           05080011
050900         MOVE AFACIDI              TO ASC-FCLTY-ID                05090011
051000     ELSE                                                         05100011
051100         IF  ASC-FCLTY-ID-N > 0                                   05110011
051200             IF  AFACIDF = DP015-ERASE-EOF                        05120011
051300                 MOVE ZEROES       TO ASC-FCLTY-ID-N              05130011
051400                 MOVE SPACES       TO ASC-FCLTY-NME               05140011
051500             END-IF                                               05150011
051600         END-IF                                                   05160011
051700     END-IF.                                                      05170011
051800                                                                  05180011
051900     IF  APONBRL > ZERO                                           05190011
052000         MOVE APONBRI              TO ASC-PO-NBR                  05200011
052100     ELSE                                                         05210011
052200         IF  APONBRF = DP015-ERASE-EOF                            05220011
052300             MOVE SPACE            TO ASC-PO-NBR                  05230011
052400         END-IF                                                   05240011
052500     END-IF.                                                      05250011
052600                                                                  05260011
052700     IF  ARCSEQL > ZERO                                           05270011
052800         MOVE ARCSEQI              TO ASC-SEQ-NBR                 05280011
052900     ELSE                                                         05290011
053000         IF  ARCSEQF = DP015-ERASE-EOF                            05300011
053100             MOVE SPACE            TO ASC-SEQ-NBR                 05310011
053200         END-IF                                                   05320011
053300     END-IF.                                                      05330011
053400                                                                  05340011
053500     IF  ALNNBRL > ZERO                                           05350011
053600         MOVE ALNNBRI              TO ASC-LINE-NBR-N              05360011
053700                                      ASC-LINE-NBR-X              05370011
053800     ELSE                                                         05380011
053900         IF  ASC-LINE-NBR-N > 0                                   05390011
054000             IF  ALNNBRF = DP015-ERASE-EOF                        05400011
054100                 MOVE SPACE        TO ASC-LINE-NBR-X              05410011
054200                 MOVE ZEROES       TO ASC-LINE-NBR-N              05420011
054300             END-IF                                               05430011
054400         END-IF                                                   05440011
054500     END-IF.                                                      05450011
054600                                                                  05460011
054700     IF  AFORMATL > ZERO                                          05470011
054800         MOVE AFORMATI             TO ASC-TKT-FORMAT              05480011
054900     ELSE                                                         05490011
055000         IF  AFORMATF = DP015-ERASE-EOF                           05500011
055100             MOVE SPACE        TO ASC-TKT-FORMAT                  05510011
055200         END-IF                                                   05520011
055300     END-IF.                                                      05530011
055400                                                                  05540011
055500******************************************************************05550011
055600* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *05560011
055700* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *05570011
055800******************************************************************05580011
055900 2300-GET-NEXT-RECORD.                                            05590011
056000     ADD +1                        TO ASC-SEL-SUB.                05600011
056100     IF ASC-SEL-SUB > PC016-MAX-ITEMS                             05610011
056200         ADD +1                    TO ASC-SEL-ITEM                05620011
056300         MOVE +1                   TO ASC-SEL-SUB                 05630011
056400     END-IF.                                                      05640011
056500     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 05650011
056600         PERFORM 9100-READ-SEL-QUEUE                              05660011
056700         IF PC016-ITEM (ASC-SEL-SUB) > ZERO                       05670011
056800             INITIALIZE ASC-LIST-KEYS                             05680011
056900             MOVE PC016-PO-NBR-N(ASC-SEL-SUB)                     05690011
057000                                 TO ASC-PO-NBR-N                  05700011
057100             MOVE PC016-REC-SEQ-NBR-N(ASC-SEL-SUB)                05710011
057200                                 TO ASC-SEQ-NBR-N                 05720011
057300             MOVE PC016-LINE-NBR-N   (ASC-SEL-SUB)                05730011
057400                                 TO ASC-LINE-NBR-N                05740011
057500             MOVE PC016-OPER-UNT-ID  (ASC-SEL-SUB)                05750011
057600                                 TO ASC-OPER-UNT-ID-N             05760011
057700             MOVE PC016-FCLTY-ID     (ASC-SEL-SUB)                05770011
057800                                 TO ASC-FCLTY-ID-N                05780011
057900             SET PC016-INQ (ASC-SEL-SUB)           TO TRUE        05790011
058000             PERFORM 9200-REWRITE-LIST-QUEUE                      05800011
058100         ELSE                                                     05810011
058200             SUBTRACT +1 FROM ASC-SEL-SUB                         05820011
058300*            --- BOTTOM OF LIST ---                               05830011
058400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05840011
058500             SET DP020-MSG-INFORMATIONAL                          05850011
058600                                   TO TRUE                        05860011
058700         END-IF                                                   05870011
058800     ELSE                                                         05880011
058900         SUBTRACT +1 FROM ASC-SEL-ITEM                            05890011
059000         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 05900011
059100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05910011
059200         SET DP020-MSG-INFORMATIONAL                              05920011
059300                                   TO TRUE                        05930011
059400     END-IF.                                                      05940011
059500                                                                  05950011
059600******************************************************************05960011
059700* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *05970011
059800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *05980011
059900******************************************************************05990011
060000 2310-GET-PREV-RECORD.                                            06000011
060100     SUBTRACT +1 FROM ASC-SEL-SUB.                                06010011
060200     IF ASC-SEL-SUB < +1                                          06020011
060300         SUBTRACT +1 FROM ASC-SEL-ITEM                            06030011
060400         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 06040011
060500     END-IF.                                                      06050011
060600                                                                  06060011
060700     IF ASC-SEL-ITEM > ZERO                                       06070011
060800         PERFORM 9100-READ-SEL-QUEUE                              06080011
060900         INITIALIZE ASC-LIST-KEYS                                 06090011
061000         MOVE PC016-PO-NBR-N(ASC-SEL-SUB)                         06100011
061100                             TO ASC-PO-NBR-N                      06110011
061200         MOVE PC016-REC-SEQ-NBR-N(ASC-SEL-SUB)                    06120011
061300                             TO ASC-SEQ-NBR-N                     06130011
061400         MOVE PC016-LINE-NBR-N   (ASC-SEL-SUB)                    06140011
061500                             TO ASC-LINE-NBR-N                    06150011
061600         MOVE PC016-OPER-UNT-ID  (ASC-SEL-SUB)                    06160011
061700                             TO ASC-OPER-UNT-ID-N                 06170011
061800         MOVE PC016-FCLTY-ID     (ASC-SEL-SUB)                    06180011
061900                             TO ASC-FCLTY-ID-N                    06190011
062000     ELSE                                                         06200011
062100         MOVE +1                   TO ASC-SEL-ITEM                06210011
062200                                      ASC-SEL-SUB                 06220011
062300*        --- TOP OF LIST ---                                      06230011
062400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06240011
062500         SET DP020-MSG-INFORMATIONAL                              06250011
062600                                   TO TRUE                        06260011
062700     END-IF.                                                      06270011
062800                                                                  06280011
062900*----------------------------------------------------------------*06290011
063000* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *06300011
063100* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *06310011
063200* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*06320011
063300* IN THE DESTINATION PROGRAM, NOT HERE.                          *06330011
063400*----------------------------------------------------------------*06340011
063500 3000-EDIT-DATA-IN-COMMAREA.                                      06350011
063600     PERFORM 3200-RESET-ATTRIBUTES.                               06360011
063700                                                                  06370011
063800     IF  ASC-LINE-NBR-X   > SPACE                                 06380011
063900         MOVE ASC-LINE-NBR-X       TO DP010I-UNEDITED-FIELD       06390011
064000         MOVE LENGTH OF ASC-LINE-NBR-X   TO DP010I-MAXIMUM-DIGITS 06400011
064100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06410011
064200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06420011
064300         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06430011
064400              USING DP010I-NUMERIC-EDIT-AREA                      06440011
064500         IF  DP010I-ERROR-DETECTED                                06450011
064600             SET PS-EDIT-ERROR                                    06460011
064700                 DP020-MSG-FATAL   TO TRUE                        06470011
064800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06480011
064900             MOVE DP015-UNP-ALP-BRT-OFF                           06490011
065000                                   TO ALNNBRA                     06500011
065100             MOVE DP015-RED        TO ALNNBRC                     06510011
065200             MOVE DP015-REVERSE    TO ALNNBRH                     06520011
065300             MOVE -1               TO ALNNBRL                     06530011
065400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06540011
065500         ELSE                                                     06550011
065600             MOVE DP010I-NUMERIC-FIELD                            06560011
065700                                   TO ASC-LINE-NBR-N              06570011
065800                                      ALNNBRO                     06580011
065900         END-IF                                                   06590011
066000     END-IF.                                                      06600011
066100                                                                  06610011
066200     IF  ASC-SEQ-NBR         > SPACE                              06620011
066300         MOVE ASC-SEQ-NBR          TO DP010I-UNEDITED-FIELD       06630011
066400         MOVE LENGTH OF ASC-SEQ-NBR         TO                    06640011
066500              DP010I-MAXIMUM-DIGITS                               06650011
066600         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06660011
066700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06670011
066800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06680011
066900              USING DP010I-NUMERIC-EDIT-AREA                      06690011
067000         IF  DP010I-ERROR-DETECTED                                06700011
067100             IF  PS-NO-EDIT-ERROR                                 06710011
067200                 SET PS-EDIT-ERROR                                06720011
067300                     DP020-MSG-FATAL                              06730011
067400                                   TO TRUE                        06740011
067500                 MOVE PC-TSYMSG-00008                             06750011
067600                                   TO DP020-MSG-NUMBER            06760011
067700                 MOVE DP015-UNP-ALP-BRT-OFF                       06770011
067800                                   TO ARCSEQA                     06780011
067900                 MOVE DP015-RED    TO ARCSEQC                     06790011
068000                 MOVE DP015-REVERSE                               06800011
068100                                   TO ARCSEQH                     06810011
068200                 MOVE -1           TO ARCSEQL                     06820011
068300                 SET DP030-SET-CURSOR-APPL-1                      06830011
068400                                   TO TRUE                        06840011
068500             END-IF                                               06850011
068600         ELSE                                                     06860011
068700             MOVE DP010I-NUMERIC-FIELD                            06870011
068800                                   TO ASC-SEQ-NBR-N               06880011
068900                                      ARCSEQO                     06890011
069000         END-IF                                                   06900011
069100     END-IF.                                                      06910011
069200                                                                  06920011
069300     IF  ASC-PO-NBR = SPACES                                      06930011
069400         SET PS-EDIT-ERROR                                        06940011
069500             DP020-MSG-FATAL   TO TRUE                            06950011
069600         MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                06960011
069700         MOVE DP015-UNP-ALP-BRT-OFF                               06970011
069800                               TO APONBRA                         06980011
069900         MOVE DP015-RED        TO APONBRC                         06990011
070000         MOVE DP015-REVERSE    TO APONBRH                         07000011
070100         MOVE -1               TO APONBRL                         07010011
070200         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      07020011
070300     ELSE                                                         07030011
070400         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       07040011
070500         MOVE LENGTH OF ASC-PO-NBR       TO DP010I-MAXIMUM-DIGITS 07050011
070600         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07060011
070700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07070011
070800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07080011
070900              USING DP010I-NUMERIC-EDIT-AREA                      07090011
071000         IF  DP010I-ERROR-DETECTED                                07100011
071100             SET PS-EDIT-ERROR                                    07110011
071200                 DP020-MSG-FATAL   TO TRUE                        07120011
071300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07130011
071400             MOVE DP015-UNP-ALP-BRT-OFF                           07140011
071500                                   TO APONBRA                     07150011
071600             MOVE DP015-RED        TO APONBRC                     07160011
071700             MOVE DP015-REVERSE    TO APONBRH                     07170011
071800             MOVE -1               TO APONBRL                     07180011
071900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07190011
072000         ELSE                                                     07200011
072100             IF DP010I-NUMERIC-FIELD = ZERO                       07210011
072200                 SET PS-EDIT-ERROR                                07220011
072300                     DP020-MSG-FATAL   TO TRUE                    07230011
072400                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        07240011
072500                 MOVE DP015-UNP-ALP-BRT-OFF                       07250011
072600                                       TO APONBRA                 07260011
072700                 MOVE DP015-RED        TO APONBRC                 07270011
072800                 MOVE DP015-REVERSE    TO APONBRH                 07280011
072900                 MOVE -1               TO APONBRL                 07290011
073000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07300011
073100             ELSE                                                 07310011
073200                 MOVE DP010I-NUMERIC-FIELD                        07320011
073300                                   TO ASC-PO-NBR-N                07330011
073400                                      APONBRO                     07340011
073500             END-IF                                               07350011
073600         END-IF                                                   07360011
073700     END-IF.                                                      07370011
073800                                                                  07380011
073900     IF  ASC-INTER-APPL-FORMAT-IND  =  PC-INTER-APPL-TKT-MENU     07390011
074000         IF  ASC-OPER-UNT-ID  > SPACE                             07400011
074100             MOVE ASC-OPER-UNT-ID  TO  DP010I-UNEDITED-FIELD      07410011
074200             MOVE LENGTH OF ASC-OPER-UNT-ID                       07420011
074300                 TO DP010I-MAXIMUM-DIGITS                         07430011
074400             MOVE ZERO  TO  DP010I-MAXIMUM-DECIMALS               07440011
074500             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              07450011
074600             CALL DP010I-NUMERIC-EDIT-ROUTINE                     07460011
074700                  USING DP010I-NUMERIC-EDIT-AREA                  07470011
074800             IF  DP010I-ERROR-DETECTED                            07480011
074900                 SET PS-EDIT-ERROR                                07490011
075000                     DP020-MSG-FATAL   TO TRUE                    07500011
075100                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        07510011
075200                 MOVE DP015-UNP-ALP-BRT-OFF                       07520011
075300                                       TO AOPRIDA                 07530011
075400                 MOVE DP015-RED        TO AOPRIDC                 07540011
075500                 MOVE DP015-REVERSE    TO AOPRIDH                 07550011
075600                 MOVE -1               TO AOPRIDL                 07560011
075700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07570011
075800             ELSE                                                 07580011
075900                 MOVE DP010I-NUMERIC-FIELD                        07590011
076000                                       TO ASC-OPER-UNT-ID-N       07600011
076100                                          DK-OPER-UNT-ID          07610011
076200                                          AOPRIDO                 07620011
076300                 MOVE ASC-OPER-UNT-ID  TO DK-OPER-UNT-ID          07630011
076400                 PERFORM 3400-VALIDATE-OPER-UNT-ID                07640011
076500                 IF  PS-INVALID-OPER-ID                           07650011
076600                     SET DP020-MSG-FATAL                          07660011
076700                         PS-EDIT-ERROR     TO TRUE                07670011
076800                     MOVE PC-TSYMSG-02319  TO DP020-MSG-NUMBER    07680011
076900                     MOVE DP015-UNP-ALP-BRT-OFF                   07690011
077000                                           TO AOPRIDA             07700011
077100                     MOVE DP015-RED        TO AOPRIDC             07710011
077200                     MOVE DP015-REVERSE    TO AOPRIDH             07720011
077300                     MOVE -1               TO AOPRIDL             07730011
077400                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          07740011
077500                 END-IF                                           07750011
077600             END-IF                                               07760011
077700         ELSE                                                     07770011
077800             SET PS-EDIT-ERROR                                    07780011
077900                 DP020-MSG-FATAL   TO TRUE                        07790011
078000             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            07800011
078100             MOVE DP015-UNP-ALP-BRT-OFF                           07810011
078200                                   TO AOPRIDA                     07820011
078300             MOVE DP015-RED        TO AOPRIDC                     07830011
078400             MOVE DP015-REVERSE    TO AOPRIDH                     07840011
078500             MOVE -1               TO AOPRIDL                     07850011
078600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07860011
078700         END-IF                                                   07870011
078800                                                                  07880011
078900         IF  ASC-FCLTY-ID     > SPACE                             07890011
079000             MOVE ASC-FCLTY-ID     TO  DP010I-UNEDITED-FIELD      07900011
079100             MOVE LENGTH OF ASC-FCLTY-ID                          07910011
079200                 TO DP010I-MAXIMUM-DIGITS                         07920011
079300             MOVE ZERO  TO  DP010I-MAXIMUM-DECIMALS               07930011
079400             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              07940011
079500             CALL DP010I-NUMERIC-EDIT-ROUTINE                     07950011
079600                  USING DP010I-NUMERIC-EDIT-AREA                  07960011
079700             IF  DP010I-ERROR-DETECTED                            07970011
079800                 IF  PS-NO-EDIT-ERROR                             07980011
079900                     SET PS-EDIT-ERROR                            07990011
080000                         DP020-MSG-FATAL                          08000011
080100                                       TO TRUE                    08010011
080200                     MOVE PC-TSYMSG-00008                         08020011
080300                                       TO DP020-MSG-NUMBER        08030011
080400                     MOVE DP015-UNP-ALP-BRT-OFF                   08040011
080500                                       TO AFACIDA                 08050011
080600                     MOVE DP015-RED    TO AFACIDC                 08060011
080700                     MOVE DP015-REVERSE                           08070011
080800                                       TO AFACIDH                 08080011
080900                     MOVE -1           TO AFACIDL                 08090011
081000                     SET DP030-SET-CURSOR-APPL-1                  08100011
081100                                       TO TRUE                    08110011
081200                 END-IF                                           08120011
081300             ELSE                                                 08130011
081400                 MOVE DP010I-NUMERIC-FIELD                        08140011
081500                                       TO ASC-FCLTY-ID-N          08150011
081600                                          DK-FCLTY-ID             08160011
081700                                          AFACIDO                 08170011
081800             END-IF                                               08180011
081900         ELSE                                                     08190011
082000             SET PS-EDIT-ERROR                                    08200011
082100                 DP020-MSG-FATAL   TO TRUE                        08210011
082200             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            08220011
082300             MOVE DP015-UNP-ALP-BRT-OFF                           08230011
082400                                   TO AFACIDA                     08240011
082500             MOVE DP015-RED        TO AFACIDC                     08250011
082600             MOVE DP015-REVERSE    TO AFACIDH                     08260011
082700             MOVE -1               TO AFACIDL                     08270011
082800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08280011
082900         END-IF                                                   08290011
083000     ELSE                                                         08300011
083100         MOVE ASC-OPER-UNT-ID-N        TO DK-OPER-UNT-ID          08310011
083200         MOVE ASC-FCLTY-ID-N           TO DK-FCLTY-ID             08320011
083300     END-IF.                                                      08330011
083400                                                                  08340011
083500     IF ASC-TKT-FORMAT NOT = SPACES AND                           08350011
083600        ASC-TKT-FORMAT NOT = ASC-SAVE-TKT-FORMAT                  08360011
083700         PERFORM 3010-VALIDATE-FORMAT                             08370011
083800         IF SQLCODE = +0 OR                                       08380011
083900            SQLCODE = -811                                        08390011
084000             CONTINUE                                             08400011
084100         ELSE                                                     08410011
084200             IF  PS-NO-EDIT-ERROR                                 08420011
084300                 SET PS-EDIT-ERROR                                08430011
084400                     DP020-MSG-FATAL                              08440011
084500                                 TO TRUE                          08450011
084600                 MOVE PC-TSYMSG-00948                             08460011
084700                                 TO DP020-MSG-NUMBER              08470011
084800                 MOVE DP015-UNP-ALP-BRT-OFF                       08480011
084900                                 TO AFORMATA                      08490011
085000                 MOVE DP015-RED  TO AFORMATC                      08500011
085100                 MOVE DP015-REVERSE                               08510011
085200                                 TO AFORMATH                      08520011
085300                 MOVE -1         TO AFORMATL                      08530011
085400                 SET DP030-SET-CURSOR-APPL-1                      08540011
085500                                 TO TRUE                          08550011
085600             END-IF                                               08560011
085700         END-IF                                                   08570011
085800     ELSE                                                         08580011
085900         IF ASC-TKT-FORMAT = SPACES                               08590011
086000             IF  PS-NO-EDIT-ERROR                                 08600011
086100                 SET PS-EDIT-ERROR                                08610011
086200                     DP020-MSG-FATAL                              08620011
086300                                 TO TRUE                          08630011
086400                 MOVE PC-TSYMSG-00007                             08640011
086500                                 TO DP020-MSG-NUMBER              08650011
086600                 MOVE DP015-UNP-ALP-BRT-OFF                       08660011
086700                                 TO AFORMATA                      08670011
086800                 MOVE DP015-RED  TO AFORMATC                      08680011
086900                 MOVE DP015-REVERSE                               08690011
087000                                 TO AFORMATH                      08700011
087100                 MOVE -1         TO AFORMATL                      08710011
087200                 SET DP030-SET-CURSOR-APPL-1                      08720011
087300                                 TO TRUE                          08730011
087400             END-IF                                               08740011
087500         END-IF                                                   08750011
087600     END-IF.                                                      08760011
087700                                                                  08770011
087800     IF  PS-NO-EDIT-ERROR                                         08780011
087900         MOVE -1                     TO AFORMATL                  08790011
088000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08800011
088100     END-IF.                                                      08810011
088200                                                                  08820011
088300 3010-VALIDATE-FORMAT.                                            08830011
088400     EXEC SQL                                                     08840011
088500          SELECT TYP_CDE,                                         08850011
088600                 A.OPT_BLK_TAGS_IND,                              08860011
088700                 A.PRT_SIZE_IND,                                  08870011
088800                 A.PRT_COLOR_IND,                                 08880011
088900                 A.PRT_GP_PR_IND,                                 08890011
089000                 A.PAPER_TYP_ID,                                  08900011
089100                 A.OPT_BLK_LBLS_IND,                              08910011
089200                 A.STKR_NBR_REQ_IND,                              08920011
089300                 B.EXTRA_TKTS_PCT,                                08930011
089400                 B.EXTRA_TKTS_NBR                                 08940011
089500            INTO :TKTFMT-TYP-CDE,                                 08950011
089600                 :TKTFMT-OPT-BLK-TAGS-IND,                        08960011
089700                 :TKTFMT-PRT-SIZE-IND,                            08970011
089800                 :TKTFMT-PRT-COLOR-IND,                           08980011
089900                 :TKTFMT-PRT-GP-PR-IND,                           08990011
090000                 :TKTFMT-PAPER-TYP-ID,                            09000011
090100                 :TKTFMT-OPT-BLK-LBLS-IND,                        09010011
090200                 :TKTFMT-STKR-NBR-REQ-IND,                        09020011
090300                 :PRTSTK-EXTRA-TKTS-PCT,                          09030011
090400                 :PRTSTK-EXTRA-TKTS-NBR                           09040011
090500            FROM TTKTFMT A,                                       09050011
090600                 TPRTSTK B                                        09060011
090700           WHERE A.OPER_UNT_ID    = :DK-OPER-UNT-ID               09070011
090800             AND A.FCLTY_ID       = :DK-FCLTY-ID                  09080011
090900             AND A.TYP_CDE        = 'I'                           09090011
091000             AND A.TKT_FMT_ID     = :ASC-TKT-FORMAT               09100011
091100             AND A.PAPER_TYP_ID   = B.PAPER_TYPE_ID               09110011
091200     END-EXEC.                                                    09120011
091300                                                                  09130011
091400     EVALUATE TRUE                                                09140011
091500         WHEN SQLCODE = ZERO                                      09150011
091600         WHEN SQLCODE = +100                                      09160011
091700         WHEN SQLCODE = -811                                      09170011
091800              CONTINUE                                            09180011
091900                                                                  09190011
092000         WHEN SQLWARN0 NOT = SPACES                               09200011
092100         WHEN SQLCODE  NOT = ZERO                                 09210011
092200              MOVE '3010-VALIDATE-FORMAT'                         09220011
092300                             TO DP013-PARAGRAPH                   09230011
092400              MOVE 'UNSUCCESSFUL SELECT OF VENDOR NAME'           09240011
092500                             TO DP013-MESSAGE-TEXT (1)            09250011
092600              MOVE SQLCA     TO DP013-SQLCA                       09260011
092700              MOVE 'TTKTFMT' TO DP013-DB2-TABLE-NAME (1)          09270011
092800              MOVE 'TPRTSTK' TO DP013-DB2-TABLE-NAME (1)          09280011
092900              SET DP013-DB2-ABEND                                 09290011
093000                  DP013-XCTL-DISPLAY-RESTART                      09300011
093100                             TO TRUE                              09310011
093200                                                                  09320011
093300              PERFORM DP013-0000-PROCESS-ABEND                    09330011
093400     END-EVALUATE.                                                09340011
093500                                                                  09350011
093600******************************************************************09360011
093700** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **09370011
093800** MAP.                                                         **09380011
093900******************************************************************09390011
094000 3200-RESET-ATTRIBUTES.                                           09400011
094100     MOVE DP015-UNP-ALP-NOR-OFF    TO AFORMATA                    09410011
094200     MOVE DP015-GREEN              TO AFORMATC                    09420011
094300     MOVE DP015-UNDERLINE          TO AFORMATH.                   09430011
094400     EVALUATE ASC-INTER-APPL-FORMAT-IND                           09440011
094500         WHEN PC-INTER-APPL-CRIT-SPEC                             09450011
094600         WHEN PC-INTER-APPL-TKT-MENU                              09460011
094700         WHEN PC-INTER-APPL-RCV-ITM-LST                           09470011
094800             MOVE DP015-UNP-ALP-NOR-OFF                           09480011
094900                                       TO APONBRA                 09490011
095000                                          ARCSEQA                 09500011
095100                                          ALNNBRA                 09510011
095200             MOVE DP015-GREEN          TO APONBRC                 09520011
095300                                          ARCSEQC                 09530011
095400                                          ALNNBRC                 09540011
095500             MOVE DP015-UNDERLINE      TO APONBRH                 09550011
095600                                          ARCSEQH                 09560011
095700                                          ALNNBRH                 09570011
095800     END-EVALUATE.                                                09580011
095900                                                                  09590011
096000     IF  ASC-INTER-APPL-FORMAT-IND  =  PC-INTER-APPL-TKT-MENU     09600011
096100         MOVE DP015-UNP-ALP-NOR-OFF                               09610011
096200                                   TO AOPRIDA                     09620011
096300                                      AFACIDA                     09630011
096400         MOVE DP015-GREEN          TO AOPRIDC                     09640011
096500                                      AFACIDC                     09650011
096600         MOVE DP015-UNDERLINE      TO AOPRIDH                     09660011
096700                                      AFACIDH                     09670011
096800     END-IF.                                                      09680011
096900                                                                  09690011
097000*----------------------------------------------------------------*09700011
097100*  VALIDATE THE OPERATING UNIT ID TO MAKE SURE THAT IT IS A      *09710011
097200*  VALID DISTRIBUTION CENTER USING THE LOCATION DOMAIN MODULE    *09720011
097300*  XLKUT071.                                                     *09730011
097400*----------------------------------------------------------------*09740011
097500 3400-VALIDATE-OPER-UNT-ID.                                       09750011
097600     INITIALIZE XL071-COMMAREA-REC.                               09760011
097700     MOVE DK-OPER-UNT-ID      TO XL071-LOCATION-NUMBER.           09770011
097800                                                                  09780011
097900     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    09790011
098000                                      XL071-COMMAREA              09800011
098100                                      XL071-COMMAREA-REC.         09810011
098200                                                                  09820011
098300     EVALUATE TRUE                                                09830011
098400         WHEN XL071-NO-ERRORS                                     09840011
098500             MOVE XL071-LOC-NM                                    09850011
098600                              TO ASC-FCLTY-NME                    09860011
098700             IF  XL071-LOC-TYP-CDE NOT = 'DC'                     09870011
098800                 SET PS-INVALID-OPER-ID                           09880011
098900                              TO TRUE                             09890011
099000             END-IF                                               09900011
099100                                                                  09910011
099200         WHEN XL071-LOC-NOT-FOUND                                 09920011
099300             MOVE SPACES      TO ASC-FCLTY-NME                    09930011
099400             SET PS-INVALID-OPER-ID                               09940011
099500                              TO TRUE                             09950011
099600                                                                  09960011
099700         WHEN XL071-DC-ASGMT-NOT-FND                              09970011
099800             MOVE XL071-LOC-NM                                    09980011
099900                              TO ASC-FCLTY-NME                    09990011
100000             SET PS-INVALID-OPER-ID                               10000011
100100                              TO TRUE                             10010011
100200                                                                  10020011
100300         WHEN XL071-BAD-DB2-RETURN                                10030011
100400             MOVE '3400-VALIDATE-OPER-UNT-ID'                     10040011
100500                              TO DP013-PARAGRAPH                  10050011
100600             MOVE 'CALL MODULE XLKUT071 - FETCH FACILITY NAME'    10060011
100700                              TO DP013-MESSAGE-TEXT (1)           10070011
100800             MOVE DK-OPER-UNT-ID                                  10080011
100900                              TO PV-DISP-OPER-UNT-ID              10090011
101000             STRING 'OPER UNIT ID: '    DELIMITED BY SIZE         10100011
101100                    PV-DISP-OPER-UNT-ID DELIMITED BY SIZE         10110011
101200                            INTO DP013-MESSAGE-TEXT (2)           10120011
101300             MOVE XL071-SQLCA TO DP013-SQLCA                      10130011
101400             MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)         10140011
101500             SET DP013-DB2-ABEND                                  10150011
101600                 DP013-XCTL-DISPLAY-RESTART                       10160011
101700                              TO TRUE                             10170011
101800             PERFORM DP013-0000-PROCESS-ABEND                     10180011
101900     END-EVALUATE.                                                10190011
102000                                                                  10200011
102100*----------------------------------------------------------------*10210011
102200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *10220011
102300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *10230011
102400*  IT HERE.                                                      *10240011
102500*----------------------------------------------------------------*10250011
102600 4000-BUILD-INITIAL-PANEL.                                        10260011
102700     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        10270011
102800     IF  ASC-INTER-APPL-FORMAT-IND  =  PC-INTER-APPL-TKT-MENU     10280011
102900         MOVE -1                       TO APONBRL                 10290011
103000     ELSE                                                         10300011
103100         MOVE -1                       TO AFORMATL                10310011
103200     END-IF.                                                      10320011
103300                                                                  10330011
103400     MOVE ASC-OPER-UNT-ID-N        TO AOPRIDO                     10340011
103500                                      DK-OPER-UNT-ID.             10350011
103600     MOVE ASC-FCLTY-ID-N           TO AFACIDO                     10360011
103700                                      DK-FCLTY-ID.                10370011
103800     MOVE ASC-PO-NBR-N             TO APONBRO                     10380011
103900                                      DK-PO-NBR.                  10390011
104000     MOVE ASC-SEQ-NBR-N            TO ARCSEQO                     10400011
104100                                      DK-REC-SEQ-NBR.             10410011
104200     MOVE ASC-LINE-NBR-N           TO ALNNBRO.                    10420011
104300     MOVE SPACES                   TO ASC-TKT-FORMAT.             10430011
104400     MOVE ASC-TKT-FORMAT           TO AFORMATO                    10440011
104500                                      ASC-SAVE-TKT-FORMAT.        10450011
104600                                                                  10460011
104700     PERFORM 4010-GET-FCLTY-NAME.                                 10470011
104800                                                                  10480011
104900     MOVE ASC-FCLTY-NME            TO AFDESCO.                    10490011
105000                                                                  10500011
105100     PERFORM 4020-GET-TICKET-FORMATS.                             10510011
105200                                                                  10520011
105300*----------------------------------------------------------------*10530011
105400*    GET THE FACILITY NAME USING THE XLKUT071 MODULE TO FETCH    *10540011
105500*    THE INFORMATION FROM THE LOCATION DOMAIN TABLES.            *10550011
105600*----------------------------------------------------------------*10560011
105700 4010-GET-FCLTY-NAME.                                             10570011
105800     INITIALIZE XL071-COMMAREA-REC.                               10580011
105900     MOVE DK-OPER-UNT-ID      TO XL071-LOCATION-NUMBER.           10590011
106000                                                                  10600011
106100     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    10610011
106200                                      XL071-COMMAREA              10620011
106300                                      XL071-COMMAREA-REC.         10630011
106400                                                                  10640011
106500     EVALUATE TRUE                                                10650011
106600         WHEN XL071-NO-ERRORS                                     10660011
106700         WHEN XL071-DC-ASGMT-NOT-FND                              10670011
106800             MOVE XL071-LOC-NM                                    10680011
106900                              TO ASC-FCLTY-NME                    10690011
107000                                                                  10700011
107100         WHEN XL071-LOC-NOT-FOUND                                 10710011
107200             MOVE SPACES      TO ASC-FCLTY-NME                    10720011
107300                                                                  10730011
107400         WHEN XL071-BAD-DB2-RETURN                                10740011
107500             MOVE '4010-GET-FCLTY-NAME'                           10750011
107600                              TO DP013-PARAGRAPH                  10760011
107700             MOVE 'CALL MODULE XLKUT071 - FETCH FACILITY NAME'    10770011
107800                              TO DP013-MESSAGE-TEXT (1)           10780011
107900             MOVE DK-OPER-UNT-ID                                  10790011
108000                              TO PV-DISP-OPER-UNT-ID              10800011
108100             STRING 'OPER UNIT ID: '    DELIMITED BY SIZE         10810011
108200                    PV-DISP-OPER-UNT-ID DELIMITED BY SIZE         10820011
108300                            INTO DP013-MESSAGE-TEXT (2)           10830011
108400             MOVE XL071-SQLCA TO DP013-SQLCA                      10840011
108500             MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)         10850011
108600             SET DP013-DB2-ABEND                                  10860011
108700                 DP013-XCTL-DISPLAY-RESTART                       10870011
108800                              TO TRUE                             10880011
108900             PERFORM DP013-0000-PROCESS-ABEND                     10890011
109000     END-EVALUATE.                                                10900011
109100                                                                  10910011
109200 4020-GET-TICKET-FORMATS.                                         10920011
109300     PERFORM VARYING PV-INDX FROM 1 BY 1                          10930011
109400       UNTIL PV-INDX > 36                                         10940011
109500         MOVE SPACES TO MR-FORMAT (PV-INDX)                       10950011
109600                        ASC-FORMAT (PV-INDX)                      10960011
109700     END-PERFORM.                                                 10970011
109800     PERFORM 4030-OPEN-FORMATS-CSR.                               10980011
109900     PERFORM 4040-FETCH-FORMATS                                   10990011
110000       VARYING PV-INDX FROM 1 BY 1                                11000011
110100       UNTIL PV-INDX > 36                                         11010011
110200       OR PS-END-OF-FORMAT-CSR.                                   11020011
110300     PERFORM 4050-CLOSE-FORMATS-CSR.                              11030011
110400                                                                  11040011
110500 4030-OPEN-FORMATS-CSR.                                           11050011
110600     EXEC SQL                                                     11060011
110700         OPEN FORMATS-CURSOR                                      11070011
110800     END-EXEC.                                                    11080011
110900                                                                  11090011
111000     EVALUATE TRUE                                                11100011
111100         WHEN SQLCODE = +0                                        11110011
111200              CONTINUE                                            11120011
111300         WHEN SQLWARN0 NOT = SPACE                                11130011
111400         WHEN SQLCODE  NOT = +0                                   11140011
111500              MOVE '4030-OPEN-FORMATS-CSR'                        11150011
111600                               TO DP013-PARAGRAPH                 11160011
111700              MOVE 'OPEN CURSOR'                                  11170011
111800                               TO DP013-MESSAGE-TEXT (1)          11180011
111900              MOVE SQLCA       TO DP013-SQLCA                     11190011
112000              MOVE 'TTKTFMT'   TO DP013-DB2-TABLE-NAME (1)        11200011
112100              SET DP013-DB2-ABEND                                 11210011
112200                               TO TRUE                            11220011
112300              PERFORM DP013-0000-PROCESS-ABEND                    11230011
112400     END-EVALUATE.                                                11240011
112500                                                                  11250011
112600 4040-FETCH-FORMATS.                                              11260011
112700     EXEC SQL                                                     11270011
112800         FETCH FORMATS-CURSOR                                     11280011
112900          INTO :TKTFMT-TKT-FMT-ID                                 11290011
113000     END-EXEC.                                                    11300011
113100                                                                  11310011
113200     EVALUATE TRUE                                                11320011
113300         WHEN SQLCODE = +0                                        11330011
113400              CONTINUE                                            11340011
113500         WHEN SQLCODE = +100                                      11350011
113600              SET PS-END-OF-FORMAT-CSR                            11360011
113700                                   TO TRUE                        11370011
113800         WHEN SQLWARN0 NOT = SPACE                                11380011
113900         WHEN SQLCODE < +0                                        11390011
114000         WHEN SQLCODE > +0                                        11400011
114100              MOVE '4040-FETCH-FORMATS'                           11410011
114200                                   TO DP013-PARAGRAPH             11420011
114300              MOVE 'FETCH FORMATS CURSOR'                         11430011
114400                                   TO DP013-MESSAGE-TEXT (1)      11440011
114500              MOVE SQLCA           TO DP013-SQLCA                 11450011
114600              MOVE 'TTKTFMT'       TO DP013-DB2-TABLE-NAME (1)    11460011
114700              SET DP013-DB2-ABEND  TO TRUE                        11470011
114800              PERFORM DP013-0000-PROCESS-ABEND                    11480011
114900     END-EVALUATE.                                                11490011
115000                                                                  11500011
115100     IF SQLCODE = +0                                              11510011
115200         MOVE TKTFMT-TKT-FMT-ID TO MR-FORMAT (PV-INDX)            11520011
115300                                   ASC-FORMAT (PV-INDX)           11530011
115400     END-IF.                                                      11540011
115500                                                                  11550011
115600 4050-CLOSE-FORMATS-CSR.                                          11560011
115700     EXEC SQL                                                     11570011
115800         CLOSE FORMATS-CURSOR                                     11580011
115900     END-EXEC.                                                    11590011
116000                                                                  11600011
116100     EVALUATE TRUE                                                11610011
116200         WHEN SQLCODE = +0                                        11620011
116300              CONTINUE                                            11630011
116400         WHEN SQLWARN0 NOT = SPACE                                11640011
116500         WHEN SQLCODE  NOT = +0                                   11650011
116600              MOVE '4050-CLOSE-FORMATS-CSR'                       11660011
116700                               TO DP013-PARAGRAPH                 11670011
116800              MOVE 'CLOSE CURSOR'                                 11680011
116900                               TO DP013-MESSAGE-TEXT (1)          11690011
117000              MOVE SQLCA       TO DP013-SQLCA                     11700011
117100              MOVE 'TTKTFMT'   TO DP013-DB2-TABLE-NAME (1)        11710011
117200              SET DP013-DB2-ABEND                                 11720011
117300                               TO TRUE                            11730011
117400              PERFORM DP013-0000-PROCESS-ABEND                    11740011
117500     END-EVALUATE.                                                11750011
117600                                                                  11760011
117700*----------------------------------------------------------------*11770011
117800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *11780011
117900*----------------------------------------------------------------*11790011
118000 4400-MOVE-COMMAREA-TO-SCREEN.                                    11800011
118100     MOVE ASC-OPER-UNT-ID          TO PC000-OPERATING-UNIT-ID.    11810011
118200     MOVE ASC-FCLTY-ID-N           TO PC000-FACILITY-ID.          11820011
118300     IF  ASC-INTER-APPL-FORMAT-IND NOT = PC-INTER-APPL-TKT-MENU   11830011
118400         MOVE ASC-OPER-UNT-ID      TO AOPRIDO                     11840011
118500         MOVE ASC-FCLTY-ID-N       TO AFACIDO                     11850011
118600     END-IF.                                                      11860011
118700     MOVE ASC-FCLTY-NME            TO AFDESCO.                    11870011
118800     MOVE ASC-PO-NBR-N             TO PC000-PO-NBR-N.             11880011
118900     MOVE ASC-SEQ-NBR-N            TO PC000-REC-SEQ-NBR-N.        11890011
119000     MOVE ASC-LINE-NBR-N           TO PC000-LINE-NBR-N.           11900011
119100     MOVE ASC-TKT-FORMAT           TO AFORMATO                    11910011
119200                                      PC000-TKT-FORMAT.           11920011
119300     MOVE ASC-INTER-APPL-FORMAT-IND                               11930011
119400                                 TO PC000-INTER-APPL-FORMAT-CODE. 11940011
119500     PERFORM VARYING PV-INDX FROM 1 BY 1                          11950011
119600       UNTIL PV-INDX > 36                                         11960011
119700         MOVE ASC-FORMAT (PV-INDX) TO MR-FORMAT (PV-INDX)         11970011
119800     END-PERFORM.                                                 11980011
119900                                                                  11990011
120000******************************************************************12000011
120100* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *12010011
120200******************************************************************12020011
120300 6200-DEL-LIST-QUEUE.                                             12030011
120400     EXEC CICS                                                    12040011
120500         DELETEQ TS                                               12050011
120600             QUEUE (ASC-LIST-QUEUE-NAME)                          12060011
120700             RESP  (PV-CICS-RESP)                                 12070011
120800     END-EXEC.                                                    12080011
120900                                                                  12090011
121000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      12100011
121100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         12110011
121200         CONTINUE                                                 12120011
121300     ELSE                                                         12130011
121400        SET DP013-CICS-ABEND       TO TRUE                        12140011
121500        SET DP013-NO-ROLLBACK      TO TRUE                        12150011
121600        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             12160011
121700        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               12170011
121800                                   TO DP013-MESSAGE-TEXT (1)      12180011
121900        PERFORM DP013-0000-PROCESS-ABEND                          12190011
122000     END-IF.                                                      12200011
122100                                                                  12210011
122200******************************************************************12220011
122300* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *12230011
122400******************************************************************12240011
122500 9100-READ-SEL-QUEUE.                                             12250011
122600     EXEC CICS                                                    12260011
122700         READQ TS                                                 12270011
122800             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        12280011
122900             INTO  (PC016-TS-SEL-REC)                             12290011
123000             ITEM  (ASC-SEL-ITEM)                                 12300011
123100             RESP  (PV-CICS-RESP)                                 12310011
123200     END-EXEC.                                                    12320011
123300                                                                  12330011
123400     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        12340011
123500         CONTINUE                                                 12350011
123600     ELSE                                                         12360011
123700         SET DP013-LOGIC-ABEND                                    12370011
123800             DP013-NO-ROLLBACK     TO TRUE                        12380011
123900         MOVE '9100-READ-SEL-QUEUE'                               12390011
124000                                   TO DP013-PARAGRAPH             12400011
124100         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    12410011
124200                                   TO DP013-MESSAGE-TEXT (1)      12420011
124300         PERFORM DP013-0000-PROCESS-ABEND                         12430011
124400     END-IF.                                                      12440011
124500                                                                  12450011
124600******************************************************************12460011
124700* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *12470011
124800******************************************************************12480011
124900 9200-REWRITE-LIST-QUEUE.                                         12490011
125000     EXEC CICS                                                    12500011
125100          WRITEQ TS                                               12510011
125200              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     12520011
125300              FROM    (PC016-TS-SEL-REC)                          12530011
125400              ITEM    (ASC-SEL-ITEM)                              12540011
125500              RESP    (PV-CICS-RESP)                              12550011
125600              REWRITE                                             12560011
125700     END-EXEC.                                                    12570011
125800                                                                  12580011
125900     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    12590011
126000         SET DP013-CICS-ABEND                                     12600011
126100             DP013-NO-ROLLBACK     TO TRUE                        12610011
126200         MOVE '9200-REWRITE-LIST-QUEUE'                           12620011
126300                                   TO DP013-PARAGRAPH             12630011
126400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   12640011
126500                                   TO DP013-MESSAGE-TEXT (1)      12650011
126600         PERFORM DP013-0000-PROCESS-ABEND                         12660011
126700     END-IF.                                                      12670011
126800                                                                  12680011
126900 9999-WRITE-CICS-LOG-MSG.                                         12690011
127000     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              12700011
127100     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             12710011
127200     INITIALIZE DP013-SRC-TASK-NUMBER                             12720011
127300                DP013-STACK.                                      12730011
127400     SET DP013-LINK-RETURN         TO TRUE.                       12740011
127500                                                                  12750011
127600     EXEC CICS                                                    12760011
127700         XCTL                                                     12770011
127800             PROGRAM   (DP013-NAME)                               12780011
127900             COMMAREA  (DP013-PARAMETERS)                         12790011
128000             LENGTH    (DP013-LENGTH)                             12800011
128100     END-EXEC.                                                    12810011
128200                                                                  12820011
128300*----------------------------------------------------------------*12830011
128400*    ABEND PROCESSOR MODULE                                      *12840011
128500*----------------------------------------------------------------*12850011
128600     COPY DPPD013.                                                12860011
