000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    PCKCS136.                                         00040000
000500 AUTHOR.        BECKY WENDT.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  01-24-94.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    E136 - FACILITY/OPERATION LIST SCREEN                      * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF FACILITY/OPERATION        * 00130000
001400*    INSTRUCTION DESCRIPTIONS FOR THE FACTILITY AREA ID OR THE  * 00140000
001500*    OPERATION INSTRUCTION PASSED BY THE CRITERIA SPEC PROGRAM, * 00150000
001600*    PCKCS135. ONLY ONE FACILITY/OPERATION INSTRUCTION DESCRIP- * 00160000
001700*    TION MAY BE SELECTED AT ONE TIME.  THE W.O. INSTRUCTION    * 00170000
001800*    MAIN'T. PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS A     * 00180000
001900*    DESCRIPTION AND PRESSES THE PF17 KEY.                      * 00190000
002000*                                                               * 00200000
002100*---------------------------------------------------------------* 00210000
002110* DATE  11/04/2021                                                00211002
002120*            - CHANGE CALL OF 'DPKUT100' TO                     * 00212002
002130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00213002
002140*              MAKING THE CALL DYNAMIC VS STATIC                * 00214002
002150*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00215003
1122RM*---------------------------------------------------------------- 00215104
1122RM* DATE  11/07/2022                                              * 00215204
1122RM*            - ADD COPYBOOK DPWS930                             * 00215304
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00215404
1122RM*              DYNAMIC.                                         * 00215504
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00215604
002160*-----------------------------------------------------------------00216002
002200 EJECT                                                            00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400                                                                  00240000
002500 DATA DIVISION.                                                   00250000
002600                                                                  00260000
002700 WORKING-STORAGE SECTION.                                         00270000
002800                                                                  00280000
002900 01  DK-DB2-KEYS.                                                 00290000
003000     15  DK-OPER-DESC                   PIC  X(25)  VALUE SPACE.  00300000
003100     15  DK-OPER-UNIT-ID                PIC S9(04)  COMP VALUE 0. 00310000
003200     15  DK-FCLTY-ID                    PIC S9(04)  COMP VALUE 0. 00320000
003300     15  DK-FCLTY-AREA-ID               PIC  X(06)  VALUE SPACE.  00330000
003400                                                                  00340000
003500 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00360000
003700                                                    'PC136A  '.   00370000
003800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00380000
003900                                                    'PCKM136 '.   00390000
004000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00400000
004100                                                    'PCKCS136'.   00410000
004200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00420000
004300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00430000
004400     05  PC-DESC-LIST-FORMAT            PIC  X(01)  VALUE '1'.    00440000
004500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00450000
004600                                                    COMP SYNC.    00460000
004700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00470000
004800                                                    COMP SYNC.    00480000
004900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00490000
005000                                                    +1000000      00500000
005100                                                    COMP-3.       00510000
005200     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00520000
005300                                                    COMP SYNC.    00530000
005400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00540000
005500                                                    COMP-3.       00550000
005600     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00560000
005700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00570000
005800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00580000
005900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00590000
006000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00600000
006100*                                                                 00610000
006200     05  PC-TSYMSG-NUMBERS.                                       00620000
006300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00630000
006400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00640000
006500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00650000
006600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00660000
006700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00670000
006800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00680000
006900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00690000
007000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00700000
007100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00710000
007200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00720000
007300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00730000
007400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00740000
007500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00750000
007600         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00760000
007700*                                                                 00770000
007800 01  PS-PROGRAM-SWITCHES.                                         00780000
007900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00790000
008000         88  PS-NO-ERROR                            VALUE 'Y'.    00800000
008100         88  PS-ERROR                               VALUE 'N'.    00810000
008200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00820000
008300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00830000
008400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00840000
008500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00850000
008600         88  PS-DONE                                VALUE 'Y'.    00860000
008700         88  PS-NOT-DONE                            VALUE 'N'.    00870000
008800*                                                                 00880000
008900 01  PV-PROGRAM-VARIABLES.                                        00890000
009000     05  PV-SUB                         PIC S9(04)  VALUE +0      00900000
009100                                                    COMP SYNC.    00910000
009200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00920000
009300                                                    COMP SYNC.    00930000
009400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00940000
009500                                                    COMP-3.       00950000
009600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00960000
009700                                                    COMP-3.       00970000
009800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00980000
009900                                                    COMP-3.       00990000
010000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01000000
010100                                                    COMP-3.       01010000
010200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01020000
010300                                                    COMP-3.       01030000
010400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01040000
010500                                                    COMP-3.       01050000
010600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01060000
010700                                                    COMP-3.       01070000
010800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01080000
010900                                                    COMP SYNC.    01090000
011000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01100000
011100                                                    COMP SYNC.    01110000
011200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01120000
011300                                                    COMP SYNC.    01130000
011400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01160000
011700                                                    COMP SYNC.    01170000
011800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01180000
011900                                                    COMP SYNC.    01190000
012000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01200000
012100                                                    COMP SYNC.    01210000
012200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01220000
012300                                                    COMP SYNC.    01230000
012400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01240000
012500                                                    COMP SYNC.    01250000
012600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01260000
012700                                                    COMP SYNC.    01270000
012800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01280000
012900                                                    COMP SYNC.    01290000
013000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01300000
013100                                                    COMP SYNC.    01310000
013200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01340000
013500                                                    COMP SYNC.    01350000
013600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01360000
013700                                                    COMP SYNC.    01370000
013800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-SPACE                       PIC  X(01)  VALUE SPACE.  01400000
014100     05  PV-OPER-DESC                   PIC  X(25)  VALUE SPACE.  01410000
014200     05  PV-DESC-BYTE                   REDEFINES PV-OPER-DESC    01420000
014300                                        OCCURS 25 TIMES           01430000
014400                                        PIC  X(01).               01440000
014500     05  PV-POINTER                     PIC S9(03)  COMP-3        01450000
014600                                                    VALUE 0.      01460000
014700******************************************************************01470000
014800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01480000
014900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01490000
015000**  APPLICATION-SPECIFIC COMMAREA.                              **01500000
015100******************************************************************01510000
015200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01520000
015300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01530000
015400     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01540000
015500                                        INDEXED BY LQW-IDX.       01550000
015600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01560000
015700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01570000
015800         10  LQW-SELECTED-SW            PIC  X(01).               01580000
015900             88  LQW-SELECT                         VALUE 'S'.    01590000
016000             88  LQW-DESELECT                       VALUE ' '.    01600000
016100         10  LQW-ACTION                 PIC  X(03).               01610000
016200         10  LQW-INSTR-DESC             PIC  X(35).               01620000
016300         10  LQW-OPER-ID                PIC  S9(4)  COMP.         01630000
016400         10  LQW-FCLTY-AREA-ID          PIC  X(6).                01640000
016500         10  LQW-PRC-FCLTY-AREA-ID      PIC  X(6).                01650000
016600         10  LQW-OPER-DESC              PIC  X(25).               01660000
016700                                                                  01670000
016800     EJECT                                                        01680000
016900*---------------------------------------------------------------* 01690000
017000*  RECORD LAYOUT FOR THE DESC SELECTION TEMP STORAGE QUEUE.     * 01700000
017100*---------------------------------------------------------------* 01710000
017200                                                                  01720000
017300     COPY PCWS019.                                                01730000
017400                                                                  01740000
017500     EJECT                                                        01750000
017600*---------------------------------------------------------------* 01760000
017700*    MAP LAYOUT                                                 * 01770000
017800*---------------------------------------------------------------* 01780000
017900                                                                  01790000
018000     COPY PCKM136.                                                01800000
018100*                                                                 01810000
018200 01  MR-OCCURS-LAYOUT                   REDEFINES  PC136AO.       01820000
018300     05  FILLER                         PIC X(60).                01830000
018400     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01840000
018500         10  MR-SELECTL                 PIC S9(04) COMP.          01850000
018600         10  MR-SELECTA                 PIC  X(01).               01860000
018700         10  MR-SELECTC                 PIC  X(01).               01870000
018800         10  MR-SELECTH                 PIC  X(01).               01880000
018900         10  MR-SELECTI                 PIC  X(01).               01890000
019000                                                                  01900000
019100         10  MR-ACTIONL                 PIC S9(04) COMP.          01910000
019200         10  MR-ACTIONA                 PIC  X(01).               01920000
019300         10  MR-ACTIONC                 PIC  X(01).               01930000
019400         10  MR-ACTIONH                 PIC  X(01).               01940000
019500         10  MR-ACTION                  PIC  X(03).               01950000
019600                                                                  01960000
019700         10  MR-INSTR-DESCL             PIC S9(04) COMP.          01970000
019800         10  MR-INSTR-DESCA             PIC  X(01).               01980000
019900         10  MR-INSTR-DESCC             PIC  X(01).               01990000
020000         10  MR-INSTR-DESCH             PIC  X(01).               02000000
020100         10  MR-INSTR-DESC              PIC  X(35).               02010000
020200                                                                  02020000
020300         10  MR-PRC-FCLTY-AREA-IDL      PIC S9(04) COMP.          02030000
020400         10  MR-PRC-FCLTY-AREA-IDA      PIC  X(01).               02040000
020500         10  MR-PRC-FCLTY-AREA-IDC      PIC  X(01).               02050000
020600         10  MR-PRC-FCLTY-AREA-IDH      PIC  X(01).               02060000
020700         10  MR-PRC-FCLTY-AREA-ID       PIC  X(06).               02070000
020800                                                                  02080000
020900     EJECT                                                        02090000
021000*---------------------------------------------------------------* 02100000
021100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02110000
021200*---------------------------------------------------------------* 02120000
021300                                                                  02130000
021400     COPY DPWS015.                                                02140000
021500                                                                  02150000
021600*---------------------------------------------------------------* 02160000
021700*    FUNCTION KEYS COPYBOOK.                                    * 02170000
021800*---------------------------------------------------------------* 02180000
021900                                                                  02190000
022000     COPY DPWS016.                                                02200000
022100                                                                  02210000
022200*---------------------------------------------------------------* 02220000
022300*    NUMERIC EDIT COPYBOOK.                                     * 02230000
022400*---------------------------------------------------------------* 02240000
022500                                                                  02250000
022600     COPY DPWS010I.                                               02260000
022700                                                                  02270000
022800 EJECT                                                            02280000
022900*---------------------------------------------------------------* 02290000
023000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02300000
023100*---------------------------------------------------------------* 02310000
023200                                                                  02320000
023300     COPY DPWS030.                                                02330000
1122RM     COPY DPWS930.                                                02331004
023400 EJECT                                                            02340000
023500*---------------------------------------------------------------* 02350000
023600*    STANDARD COMMAREA.                                         * 02360000
023700*---------------------------------------------------------------* 02370000
023800                                                                  02380000
023900     COPY DPWS020.                                                02390000
024000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02400000
024100                                                                  02410000
024200*---------------------------------------------------------------* 02420000
024300* INTER-APPLICATION COMMAREA.                                   * 02430000
024400*   PCWS000 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02440000
024500*             SPEC SCREEN, AND ALSO THE OUTPUT LATOUT THAT      * 02450000
024600*             WILL BE PASSED FROM THIS LIST PROGRAM FOR A       * 02460000
024700*             LOCAL-GO FUNCTION.                                * 02470000
024800*---------------------------------------------------------------* 02480000
024900                                                                  02490000
025000         10  INTER-APPL-COMM-AREA       PIC X(200).               02500000
025100     COPY PCWS000.                                                02510000
025200*---------------------------------------------------------------* 02520000
025300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02530000
025400*---------------------------------------------------------------* 02540000
025500         10  ASC-SPECIFIC-COMMAREA.                               02550000
025600             15  ASC-LIST-KEYS.                                   02560000
025700                 20  ASC-KEY-OPER-UNIT-ID            PIC S9(4)    02570000
025800                                                     COMP.        02580000
025900                 20  ASC-KEY-FCLTY-ID                PIC S9(4)    02590000
026000                                                     COMP.        02600000
026100                 20  ASC-KEY-FCLTY-AREA-ID           PIC  X(06).  02610000
026200                 20  ASC-KEY-OPER-DESC               PIC  X(25).  02620000
026300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02630000
026400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02640000
026500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02650000
026600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02660000
026700                                                                  02670000
026800                 20  ASC-ITEM-ARRAY.                              02680000
026900                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02690000
027000                         30  ASC-LIST-ITEM-NUMBER                 02700000
027100                                                     PIC S9(09)   02710000
027200                                                     COMP-3.      02720000
027300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02730000
027400                             88  ASC-VALID-SELECT    VALUE ' '    02740000
027500                                                           'S'    02750000
027600                                                           'B'    02760000
027700                                                           'E'.   02770000
027800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02780000
027900                             88  ASC-TEMP-SELECT     VALUE 'S'.   02790000
028000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02800000
028100                             88  ASC-TEMP-END        VALUE 'E'.   02810000
028200                         30  ASC-SELECTED-SW         PIC  X(01).  02820000
028300                             88  ASC-NO-SELECT       VALUE ' '.   02830000
028400                             88  ASC-SELECT          VALUE 'S'.   02840000
028500                             88  ASC-BEGIN           VALUE 'B'.   02850000
028600                             88  ASC-END             VALUE 'E'.   02860000
028700                         30  ASC-ACTION              PIC  X(03).  02870000
028800                         30  ASC-INSTR-DESC          PIC  X(35).  02880000
028900                         30  ASC-OPER-ID             PIC  S9(4)   02890000
029000                                                          COMP.   02900000
029100                         30  ASC-FCLTY-AREA-ID       PIC  X(6).   02910000
029200                         30  ASC-PRC-FCLTY-AREA-ID   PIC  X(6).   02920000
029300                         30  ASC-OPER-DESC           PIC  X(25).  02930000
029400                                                                  02940000
029500             15  ASC-BLK-SUB                         PIC S9(04)   02950000
029600                                                          COMP    02960000
029700                                                          SYNC.   02970000
029800             15  ASC-ITEM-SUB                        PIC S9(04)   02980000
029900                                                          COMP    02990000
030000                                                          SYNC.   03000000
030100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03010000
030200                                                          COMP-3. 03020000
030300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03030000
030400                                                          COMP-3. 03040000
030500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03050000
030600                                                          COMP-3. 03060000
030700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03070000
030800                                                          COMP-3. 03080000
030900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03090000
031000                                                          COMP-3. 03100000
031100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03110000
031200                                                          COMP    03120000
031300                                                          SYNC.   03130000
031400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03140000
031500                                                          COMP-3. 03150000
031600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03160000
031700                                                          COMP-3. 03170000
031800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03180000
031900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03190000
032000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03200000
032100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03210000
032200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03220000
032300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03230000
032400             15  ASC-LIST-QUEUE-NAME.                             03240000
032500                 20  ASC-LIST-TERM-ID                PIC  X(04).  03250000
032600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03260000
032700                                                          COMP-3. 03270000
032800                 20  ASC-LIST-SEQ                    PIC  9(01).  03280000
032900             15  ASC-SEL-QUEUE-NAME.                              03290000
033000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03300000
033100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03310000
033200                                                          COMP-3. 03320000
033300                 20  ASC-SEL-SEQ                     PIC  9(01).  03330000
033400                                                                  03340000
033500             15  ASC-CURSOR-SW                       PIC  X(01).  03350000
033600                 88  ASC-NO-CURSOR                   VALUE 'N'.   03360000
033700                 88  ASC-FCLTY-AREA-ID-CURSOR        VALUE 'F'.   03370000
033800                 88  ASC-OPER-DESC-CURSOR            VALUE 'D'.   03380000
033900             15  ASC-START-ITEM-REQUEST.                          03390000
034000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03400000
034100                                                                  03410000
034200     EJECT                                                        03420000
034300*---------------------------------------------------------------* 03430000
034400*    ABEND PROCESSING COPYBOOK.                                 * 03440000
034500*---------------------------------------------------------------* 03450000
034600                                                                  03460000
034700     COPY DPWS013.                                                03470000
034800                                                                  03480000
034900 EJECT                                                            03490000
035000*---------------------------------------------------------------* 03500000
035100*    DB2 AREA FOR TOPERFA                                       * 03510000
035200*---------------------------------------------------------------* 03520000
035300     EXEC SQL                                                     03530000
035400          INCLUDE TOPERFA                                         03540000
035500     END-EXEC.                                                    03550000
035600*---------------------------------------------------------------* 03560000
035700*    DB2 AREA FOR TOPERAT                                       * 03570000
035800*---------------------------------------------------------------* 03580000
035900     EXEC SQL                                                     03590000
036000          INCLUDE TOPERAT                                         03600000
036100     END-EXEC.                                                    03610000
036200*---------------------------------------------------------------* 03620000
036300*    DB2 AREA FOR COMMUNICATIONS                                * 03630000
036400*---------------------------------------------------------------* 03640000
036500     EXEC SQL                                                     03650000
036600          INCLUDE SQLCA                                           03660000
036700     END-EXEC.                                                    03670000
036800                                                                  03680000
036900*---------------------------------------------------------------* 03690000
037000*    TOPERAT CURSOR WHEN FACILITY AREA ID IS PROVIDED.          * 03700000
037100*---------------------------------------------------------------* 03710000
037200                                                                  03720000
037300     EXEC SQL                                                     03730000
037400          DECLARE FCLTY-AREA-ID-CSR CURSOR                        03740000
037500          FOR SELECT                                              03750000
037600                B.OPER_ID                                         03760000
037700               ,B.OPER_DESC                                       03770000
037800               ,A.FCLTY_AREA_ID                                   03780000
037900               ,A.PRC_FCLTY_AREA_ID                               03790000
038000          FROM                                                    03800000
038100                TOPERFA A                                         03810000
038200               ,TOPERAT B                                         03820000
038300          WHERE                                                   03830000
038400                A.OPER_UNT_ID    = :DK-OPER-UNIT-ID               03840000
038500          AND   A.OPER_ID        = B.OPER_ID                      03850000
038600          AND   A.FCLTY_ID       = :DK-FCLTY-ID                   03860000
038700          AND   A.FCLTY_AREA_ID  = :DK-FCLTY-AREA-ID              03870000
038800          AND   A.VER_STATUS_CDE = 'A'                            03880000
038900          AND   B.VER_STATUS_CDE = 'A'                            03890000
039000          ORDER BY B.OPER_DESC                                    03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300*---------------------------------------------------------------* 03930000
039400*    TOPERAT CURSOR WHEN OPERATION DESCRIPTION IS PROVIDED      * 03940000
039500*---------------------------------------------------------------* 03950000
039600                                                                  03960000
039700     EXEC SQL                                                     03970000
039800          DECLARE OPER-DESC-CSR CURSOR                            03980000
039900          FOR SELECT                                              03990000
040000                B.OPER_ID                                         04000000
040100               ,B.OPER_DESC                                       04010000
040200               ,A.FCLTY_AREA_ID                                   04020000
040300               ,A.PRC_FCLTY_AREA_ID                               04030000
040400          FROM                                                    04040000
040500                TOPERFA A                                         04050000
040600               ,TOPERAT B                                         04060000
040700          WHERE                                                   04070000
040800                B.OPER_DESC   LIKE :DK-OPER-DESC                  04080000
040900          AND   A.OPER_ID        = B.OPER_ID                      04090000
041000          AND   A.OPER_UNT_ID    = :DK-OPER-UNIT-ID               04100000
041100          AND   A.FCLTY_ID       = :DK-FCLTY-ID                   04110000
041200          AND   A.VER_STATUS_CDE = 'A'                            04120000
041300          AND   B.VER_STATUS_CDE = 'A'                            04130000
041400          ORDER BY B.OPER_DESC                                    04140000
041500     END-EXEC.                                                    04150000
041600                                                                  04160000
041700 EJECT                                                            04170000
041800 LINKAGE SECTION.                                                 04180000
041900                                                                  04190000
042000 01  DFHCOMMAREA.                                                 04200000
042100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04210000
042200                                        DEPENDING ON EIBCALEN.    04220000
042300         10  FILLER                     PIC X.                    04230000
042400                                                                  04240000
042500 EJECT                                                            04250000
042600 PROCEDURE DIVISION.                                              04260000
042700******************************************************************04270000
042800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04280000
042900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04290000
043000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04300000
043100******************************************************************04310000
043200 0000-MAIN-MODULE.                                                04320000
043300     INITIALIZE DP030-CICS-API-FIELDS.                            04330000
043400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04340000
043500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04350000
043600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04360000
043700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04370000
043800     MOVE LENGTH OF PC136AI        TO DP030-MAP-LENGTH (1).       04380000
043900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04390000
044000     PERFORM 0001-CALL-CICS-ARCH-API.                             04400000
044100*                                                                 04410000
044200     PERFORM 1000-CONTROL-PROCESSING                              04420000
044300*                                                                 04430000
044400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04440000
044500     PERFORM 0001-CALL-CICS-ARCH-API.                             04450000
044600                                                                  04460000
044700******************************************************************04470000
044800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04480000
044900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04490000
045000******************************************************************04500000
045100 0001-CALL-CICS-ARCH-API.                                         04510000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               04520004
1122RM     CALL DP930-CICS-ARCH-API                                     04521004
1122RM                     USING DFHEIBLK                               04522004
045300                           DFHCOMMAREA                            04530000
045400                           DP030-CICS-API-FIELDS                  04540000
045500                           DP020-STANDARD-COMMAREA                04550000
045600                           PC136AI.                               04560000
045700*                                                                 04570000
045800     IF  DP030-RC-CALL-SUCCESSFUL                                 04580000
045900         CONTINUE                                                 04590000
046000     ELSE                                                         04600000
046100         SET DP013-NO-ROLLBACK                                    04610000
046200             DP013-XCTL-DISPLAY-RESTART                           04620000
046300             DP013-CICS-ABEND      TO TRUE                        04630000
046400         MOVE '0001-CALL-CICS-ARCH-API'                           04640000
046500                                   TO DP013-PARAGRAPH             04650000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04660004
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04670004
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04671004
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04672004
046800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04680000
046900         PERFORM DP013-0000-PROCESS-ABEND                         04690000
047000     END-IF.                                                      04700000
047100*----------------------------------------------------------------*04710000
047200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04720000
047300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04730000
047400*                                                                *04740000
047500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04750000
047600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04760000
047700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04770000
047800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04780000
047900*----------------------------------------------------------------*04790000
048000                                                                  04800000
048100 1000-CONTROL-PROCESSING.                                         04810000
048200                                                                  04820000
048300     EVALUATE TRUE                                                04830000
048400         WHEN DP020-NEXT-ACT-INITIAL                              04840000
048500             INITIALIZE ASC-SPECIFIC-COMMAREA                     04850000
048600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04860000
048700                                      ASC-SEL-TERM-ID             04870000
048800             MOVE DP020-SRC-TASK-NUMBER                           04880000
048900                                   TO ASC-LIST-TASK-NUMBER        04890000
049000                                      ASC-SEL-TASK-NUMBER         04900000
049100             MOVE PC-LIST-QUEUE-SEQ                               04910000
049200                                   TO ASC-LIST-SEQ                04920000
049300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04930000
049400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04940000
049500***-----$TEMPLATE NOTE$-------------------------------------------04950000
049600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04960000
049700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04970000
049800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04980000
049900***---------------------------------------------------------------04990000
050000             IF  PS-COMMAREA-NOT-VALID                            05000000
050100***              MOVE PC-TSYMSG-99901                             05010000
050200***                                TO DP020-MSG-NUMBER            05020000
050300***              SET DP020-MSG-FATAL                              05030000
050400***                                TO TRUE                        05040000
050500                 SET DP020-NEXT-ACT-APPL-ERROR                    05050000
050600                                   TO TRUE                        05060000
050700             ELSE                                                 05070000
050800                 PERFORM 4000-BUILD-INITIAL-PANEL                 05080000
050900             END-IF                                               05090000
051000                                                                  05100000
051100         WHEN DP020-NEXT-ACT-READ-MAP                             05110000
051200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05120000
051300                                   TO PV-TOP-ITEM                 05130000
051400             PERFORM 2000-PROCESS-PANEL                           05140000
051500                                                                  05150000
051600         WHEN DP020-NEXT-ACT-RETURN                               05160000
051700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05170000
051800                                   TO PV-TOP-ITEM                 05180000
051900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05190000
052000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05200000
052100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05210000
052200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05220000
052300                                                                  05230000
052400         WHEN OTHER                                               05240000
052500             SET DP013-LOGIC-ABEND TO TRUE                        05250000
052600             SET DP013-NO-ROLLBACK TO TRUE                        05260000
052700             MOVE '1000-CONTROL-PROCESSING'                       05270000
052800                                   TO DP013-PARAGRAPH             05280000
052900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05290000
053000                                   TO DP013-MESSAGE-TEXT(1)       05300000
053100             PERFORM DP013-0000-PROCESS-ABEND                     05310000
053200     END-EVALUATE.                                                05320000
053300                                                                  05330000
053400 EJECT                                                            05340000
053500*----------------------------------------------------------------*05350000
053600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05360000
053700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05370000
053800*----------------------------------------------------------------*05380000
053900                                                                  05390000
054000 1100-PROCESS-INTER-APPL-COMM.                                    05400000
054100                                                                  05410000
054200     SET PS-COMMAREA-VALID         TO TRUE.                       05420000
054300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05430000
054400     IF  DP020-INT-APPL-FORMAT-IND = PC-DESC-LIST-FORMAT          05440000
054500         MOVE PC000-OPERATING-UNIT-ID                             05450000
054600                                   TO ASC-KEY-OPER-UNIT-ID        05460000
054700                                      DK-OPER-UNIT-ID             05470000
054800         MOVE PC000-FACILITY-ID                                   05480000
054900                                   TO ASC-KEY-FCLTY-ID            05490000
055000                                      DK-FCLTY-ID                 05500000
055100         MOVE PC000-FACILITY-AREA-ID TO ASC-KEY-FCLTY-AREA-ID     05510000
055200                                      DK-FCLTY-AREA-ID            05520000
055300         MOVE PC000-OPERATION-DESC TO ASC-KEY-OPER-DESC           05530000
055400                                      DK-OPER-DESC                05540000
055500         MOVE PC000-FACILITY-QUEUE-NAME TO ASC-SEL-QUEUE-NAME     05550000
055600     ELSE                                                         05560000
055700         IF  DP020-NAV-KEY-DATA > SPACE                           05570000
055800             MOVE DP020-NAV-KEY-DATA                              05580000
055900                                   TO DK-OPER-DESC                05590000
056000                                      ASC-KEY-OPER-DESC           05600000
056100         END-IF                                                   05610000
056200     END-IF.                                                      05620000
056300                                                                  05630000
056400 EJECT                                                            05640000
056500*----------------------------------------------------------------*05650000
056600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05660000
056700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05670000
056800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05680000
056900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05690000
057000* FUNCTION KEYS CAN GET THIS FAR.                                *05700000
057100*----------------------------------------------------------------*05710000
057200                                                                  05720000
057300 2000-PROCESS-PANEL.                                              05730000
057400     EVALUATE TRUE                                                05740000
057500         WHEN DP020-SRC-AID = DP016-CLEAR                         05750000
057600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05760000
057700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05770000
057800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05780000
057900                                                                  05790000
058000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05800000
058100             MOVE ASC-KEY-OPER-UNIT-ID                            05810000
058200                                   TO DK-OPER-UNIT-ID             05820000
058300             MOVE ASC-KEY-FCLTY-ID                                05830000
058400                                   TO DK-FCLTY-ID                 05840000
058500             MOVE ASC-KEY-FCLTY-AREA-ID                           05850000
058600                                   TO DK-FCLTY-AREA-ID            05860000
058700             MOVE ASC-KEY-OPER-DESC                               05870000
058800                                   TO DK-OPER-DESC                05880000
058900             PERFORM 2050-DELETE-LIST-QUEUE                       05890000
059000             PERFORM 4000-BUILD-INITIAL-PANEL                     05900000
059100                                                                  05910000
059200         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05920000
059300             PERFORM 2140-DESELECT-ALL-ITEMS                      05930000
059400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05940000
059500                                                                  05950000
059600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05960000
059700             PERFORM 2150-SELECT-ALL-ITEMS                        05970000
059800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05980000
059900                                                                  05990000
060000         WHEN OTHER                                               06000000
060100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06010000
060200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06020000
060300             IF  PS-NO-ERROR                                      06030000
060400                 SET DP030-CONTINUE-GO                            06040000
060500                                 TO TRUE                          06050000
060600                 PERFORM 2100-CHECK-FUNCTION-KEY                  06060000
060700             ELSE                                                 06070000
060800                 SET DP030-OVERRIDE-GO                            06080000
060900                                 TO TRUE                          06090000
061000             END-IF                                               06100000
061100     END-EVALUATE.                                                06110000
061200 EJECT                                                            06120000
061300*----------------------------------------------------------------*06130000
061400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06140000
061500*----------------------------------------------------------------*06150000
061600 2050-DELETE-LIST-QUEUE.                                          06160000
061700                                                                  06170000
061800     EXEC CICS                                                    06180000
061900         DELETEQ TS                                               06190000
062000             QUEUE (ASC-LIST-QUEUE-NAME)                          06200000
062100             RESP  (PV-CICS-RESP)                                 06210000
062200     END-EXEC.                                                    06220000
062300                                                                  06230000
062400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06240000
062500        (PV-CICS-RESP = DFHRESP(QIDERR))                          06250000
062600         CONTINUE                                                 06260000
062700     ELSE                                                         06270000
062800         SET DP013-CICS-ABEND      TO TRUE                        06280000
062900         SET DP013-NO-ROLLBACK     TO TRUE                        06290000
063000                                                                  06300000
063100         MOVE '2050-DELETE-LIST-QUEUE'                            06310000
063200                                   TO DP013-PARAGRAPH             06320000
063300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06330000
063400                                   TO DP013-MESSAGE-TEXT (1)      06340000
063500         PERFORM DP013-0000-PROCESS-ABEND                         06350000
063600     END-IF.                                                      06360000
063700                                                                  06370000
063800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06380000
063900 EJECT                                                            06390000
064000*----------------------------------------------------------------*06400000
064100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06410000
064200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06420000
064300* CICS ARCHITECTURE API.                                         *06430000
064400*----------------------------------------------------------------*06440000
064500 2100-CHECK-FUNCTION-KEY.                                         06450000
064600     EVALUATE TRUE                                                06460000
064700         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  06470000
064800             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06480000
064900                 INITIALIZE PC000-INTER-APPL-COMMAREA             06490000
065000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06500000
065100                                TO PC000-NUMBER-OF-SELECTED-ITEMS 06510000
065200                 PERFORM 5000-PREPARE-SEL-QUEUE                   06520000
065300             ELSE                                                 06530000
065400                 SET DP030-OVERRIDE-GO                            06540000
065500                                   TO TRUE                        06550000
065600                 MOVE PC-TSYMSG-00057                             06560000
065700                                   TO DP020-MSG-NUMBER            06570000
065800                 SET DP020-MSG-WARNING                            06580000
065900                                   TO TRUE                        06590000
066000             END-IF                                               06600000
066100                                                                  06610000
066200         WHEN DP020-FK-LOCAL-RETURN(DP020-SRC-AID)                06620000
066300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06630000
066400                 INITIALIZE PC000-INTER-APPL-COMMAREA             06640000
066500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06650000
066600                                TO PC000-NUMBER-OF-SELECTED-ITEMS 06660000
066700                 PERFORM 5000-PREPARE-SEL-QUEUE                   06670000
066800             ELSE                                                 06680000
066900                 SET DP030-OVERRIDE-GO                            06690000
067000                                   TO TRUE                        06700000
067100                 MOVE PC-TSYMSG-00057                             06710000
067200                                   TO DP020-MSG-NUMBER            06720000
067300                 SET DP020-MSG-WARNING                            06730000
067400                                   TO TRUE                        06740000
067500             END-IF                                               06750000
067600                                                                  06760000
067700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06770000
067800             MOVE +1               TO PV-TOP-ITEM                 06780000
067900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06790000
068000                                                                  06800000
068100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06810000
068200             PERFORM 2110-BROWSE-BACKWARD                         06820000
068300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06830000
068400                                                                  06840000
068500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06850000
068600             PERFORM 2120-BROWSE-FORWARD                          06860000
068700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06870000
068800                                                                  06880000
068900         WHEN DP020-SRC-AID = DP016-ENTER                         06890000
069000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06900000
069100             IF  PS-ERROR                                         06910000
069200                 CONTINUE                                         06920000
069300             ELSE                                                 06930000
069400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06940000
069500             END-IF                                               06950000
069600                                                                  06960000
069700         WHEN OTHER                                               06970000
069800             SET DP013-NO-ROLLBACK                                06980000
069900                 DP013-XCTL-DISPLAY-RESTART                       06990000
070000                 DP013-CICS-ABEND  TO TRUE                        07000000
070100             MOVE '2100-CHECK-FUNCTION-KEY'                       07010000
070200                                   TO DP013-PARAGRAPH             07020000
070300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07030000
070400                                   TO DP013-MESSAGE-TEXT (1)      07040000
070500             PERFORM DP013-0000-PROCESS-ABEND                     07050000
070600     END-EVALUATE.                                                07060000
070700*                                                                 07070000
070800*----------------------------------------------------------------*07080000
070900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07090000
071000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07100000
071100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07110000
071200*    MESSAGE.                                                    *07120000
071300*----------------------------------------------------------------*07130000
071400                                                                  07140000
071500 2110-BROWSE-BACKWARD.                                            07150000
071600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07160000
071700         GIVING PV-TOP-ITEM.                                      07170000
071800*                                                                 07180000
071900     IF  ((PV-TOP-ITEM < +1)                                      07190000
072000       OR (PV-TOP-ITEM = +1))                                     07200000
072100         MOVE +1                   TO PV-TOP-ITEM                 07210000
072200*        -- TOP OF LIST --                                        07220000
072300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07230000
072400         SET DP020-MSG-INFORMATIONAL TO TRUE                      07240000
072500     END-IF.                                                      07250000
072600                                                                  07260000
072700 EJECT                                                            07270000
072800*----------------------------------------------------------------*07280000
072900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07290000
073000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07300000
073100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07310000
073200*----------------------------------------------------------------*07320000
073300                                                                  07330000
073400 2120-BROWSE-FORWARD.                                             07340000
073500                                                                  07350000
073600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07360000
073700         GIVING PV-TOP-ITEM.                                      07370000
073800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07380000
073900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07390000
074000                                   TO PV-TOP-ITEM                 07400000
074100*        -- BOTTOM OF LIST --                                     07410000
074200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07420000
074300         SET DP020-MSG-INFORMATIONAL                              07430000
074400                                   TO TRUE                        07440000
074500     ELSE                                                         07450000
074600         COMPUTE PV-BOTTOM-ITEM =                                 07460000
074700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07470000
074800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07480000
074900*            -- BOTTOM OF LIST --                                 07490000
075000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07500000
075100             SET DP020-MSG-INFORMATIONAL                          07510000
075200                                   TO TRUE                        07520000
075300         END-IF                                                   07530000
075400     END-IF.                                                      07540000
075500 EJECT                                                            07550000
075600*----------------------------------------------------------------*07560000
075700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07570000
075800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07580000
075900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07590000
076000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07600000
076100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07610000
076200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07620000
076300*----------------------------------------------------------------*07630000
076400                                                                  07640000
076500 2130-CHECK-FOR-JUMP-BROWSE.                                      07650000
076600     SET PS-NO-ERROR               TO TRUE.                       07660000
076700     IF (ASC-START-ITEM-REQUEST = SPACE)                          07670000
076800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07680000
076900                                   TO PV-TOP-ITEM                 07690000
077000     ELSE                                                         07700000
077100         MOVE ASC-START-ITEM-REQUEST                              07710000
077200                                   TO DP010I-UNEDITED-FIELD       07720000
077300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07730000
077400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07740000
077500         SET DP010I-NEGATIVE-NOT-ALLOWED                          07750000
077600                                   TO TRUE                        07760000
077710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07771001
077720                         USING DP010I-NUMERIC-EDIT-AREA           07772001
077800                                                                  07780000
077900         IF  NOT DP010I-ERROR-DETECTED                            07790000
078000             MOVE DP010I-NUMERIC-FIELD                            07800000
078100                                   TO  ASC-START-ITEM-REQUEST-N   07810000
078200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07820000
078300                 IF  ASC-START-ITEM-REQUEST-N >                   07830000
078400                                          ASC-NUMBER-OF-ITEMS-READ07840000
078500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07850000
078600                     COMPUTE PV-TOP-ITEM =                        07860000
078700                             ASC-NUMBER-OF-ITEMS-READ             07870000
078800                             - PC-ITEMS-PER-PANEL + 1             07880000
078900                     IF  PV-TOP-ITEM < +1                         07890000
079000                         MOVE +1   TO PV-TOP-ITEM                 07900000
079100                         MOVE PC-TSYMSG-00070                     07910000
079200                                   TO DP020-MSG-NUMBER            07920000
079300                         SET DP020-MSG-INFORMATIONAL              07930000
079400                                   TO TRUE                        07940000
079500                     END-IF                                       07950000
079600                 ELSE                                             07960000
079700                     MOVE ASC-START-ITEM-REQUEST-N                07970000
079800                                   TO PV-TOP-ITEM                 07980000
079900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07990000
080000                     COMPUTE PV-BOTTOM-ITEM =                     08000000
080100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08010000
080200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08020000
080300*                        -- BOTTOM OF LIST --                     08030000
080400                         MOVE PC-TSYMSG-00070                     08040000
080500                                   TO DP020-MSG-NUMBER            08050000
080600                         SET DP020-MSG-INFORMATIONAL              08060000
080700                                   TO TRUE                        08070000
080800                     END-IF                                       08080000
080900                 END-IF                                           08090000
081000             ELSE                                                 08100000
081100*                --- VALUE OUT OF RANGE ----                      08110000
081200                 MOVE PC-TSYMSG-00101                             08120000
081300                                   TO DP020-MSG-NUMBER            08130000
081400                 MOVE -1           TO ASTRTITL                    08140000
081500                 SET DP030-SET-CURSOR-APPL-1                      08150000
081600                                   TO TRUE                        08160000
081700                 MOVE DP015-REVERSE                               08170000
081800                                   TO ASTRTITH                    08180000
081900                 MOVE DP015-RED    TO ASTRTITC                    08190000
082000                 MOVE DP015-UNP-NUM-BRT-MDT                       08200000
082100                                   TO ASTRTITA                    08210000
082200                 SET DP020-MSG-FATAL                              08220000
082300                                   TO TRUE                        08230000
082400                 SET PS-ERROR      TO TRUE                        08240000
082500             END-IF                                               08250000
082600                                                                  08260000
082700         ELSE                                                     08270000
082800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08280000
082900             MOVE -1               TO ASTRTITL                    08290000
083000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08300000
083100             MOVE DP015-REVERSE    TO ASTRTITH                    08310000
083200             MOVE DP015-RED        TO ASTRTITC                    08320000
083300             MOVE DP015-UNP-NUM-BRT-MDT                           08330000
083400                                   TO ASTRTITA                    08340000
083500             SET DP020-MSG-FATAL   TO TRUE                        08350000
083600             SET PS-ERROR          TO TRUE                        08360000
083700         END-IF                                                   08370000
083800     END-IF.                                                      08380000
083900 EJECT                                                            08390000
084000*----------------------------------------------------------------*08400000
084100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08410000
084200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08420000
084300*----------------------------------------------------------------*08430000
084400 2140-DESELECT-ALL-ITEMS.                                         08440000
084500     MOVE +1                       TO ASC-BLK-SUB.                08450000
084600                                                                  08460000
084700     PERFORM 2141-CLEAR-SELECTED-INDS                             08470000
084800         VARYING ASC-ITEM-SUB                                     08480000
084900         FROM 1 BY 1                                              08490000
085000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08500000
085100                                                                  08510000
085200     ADD +1                        TO ASC-BLK-SUB.                08520000
085300                                                                  08530000
085400     PERFORM 2141-CLEAR-SELECTED-INDS                             08540000
085500         VARYING ASC-ITEM-SUB                                     08550000
085600         FROM 1 BY 1                                              08560000
085700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08570000
085800                                                                  08580000
085900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08590000
086000                                   TO PV-LIST-ITEM-NUMBER.        08600000
086100                                                                  08610000
086200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08620000
086300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08630000
086400                                                                  08640000
086500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08650000
086600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08660000
086700         MOVE +1                   TO ASC-BLK-SUB                 08670000
086800                                                                  08680000
086900         PERFORM 5100-WRITE-TEMP-STORAGE                          08690000
087000                                                                  08700000
087100         MOVE +1                   TO PV-BLOCK-NUMBER             08710000
087200                                                                  08720000
087300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08730000
087400             PV-FIRST-BLOCK-IN-ARRAY - 1                          08740000
087500                                                                  08750000
087600         PERFORM                                                  08760000
087700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08770000
087800                                                                  08780000
087900             PERFORM 4410-READ-TEMP-STORAGE                       08790000
088000                                                                  08800000
088100             PERFORM 2141-CLEAR-SELECTED-INDS                     08810000
088200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08820000
088300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08830000
088400                                                                  08840000
088500             PERFORM 5100-WRITE-TEMP-STORAGE                      08850000
088600                                                                  08860000
088700             ADD +1                TO PV-BLOCK-NUMBER             08870000
088800                                                                  08880000
088900         END-PERFORM                                              08890000
089000                                                                  08900000
089100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08910000
089200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08920000
089300                                                                  08930000
089400         PERFORM                                                  08940000
089500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08950000
089600                   ASC-HIGHEST-BLOCK-WRITTEN                      08960000
089700                                                                  08970000
089800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08980000
089900                                   TO PV-BLOCK-NUMBER             08990000
090000                                                                  09000000
090100             PERFORM 4410-READ-TEMP-STORAGE                       09010000
090200                                                                  09020000
090300             PERFORM 2141-CLEAR-SELECTED-INDS                     09030000
090400                 VARYING ASC-ITEM-SUB                             09040000
090500                 FROM 1 BY 1                                      09050000
090600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09060000
090700                                                                  09070000
090800             PERFORM 5100-WRITE-TEMP-STORAGE                      09080000
090900                                                                  09090000
091000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09100000
091100                                                                  09110000
091200         END-PERFORM                                              09120000
091300                                                                  09130000
091400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09140000
091500                                   TO PV-BLOCK-NUMBER             09150000
091600                                                                  09160000
091700         PERFORM 4410-READ-TEMP-STORAGE                           09170000
091800     END-IF.                                                      09180000
091900                                                                  09190000
092000                                                                  09200000
092100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09210000
092200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09220000
092300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09230000
092400                                                                  09240000
092500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09250000
092600                                                                  09260000
092700 EJECT                                                            09270000
092800*----------------------------------------------------------------*09280000
092900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09290000
093000*----------------------------------------------------------------*09300000
093100                                                                  09310000
093200 2141-CLEAR-SELECTED-INDS.                                        09320000
093300                                                                  09330000
093400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09340000
093500             NOT EQUAL ZERO                                       09350000
093600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09360000
093700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09370000
093800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09380000
093900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09390000
094000                                   TO TRUE                        09400000
094100         END-IF                                                   09410000
094200     END-IF.                                                      09420000
094300                                                                  09430000
094400 EJECT                                                            09440000
094500*----------------------------------------------------------------*09450000
094600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09460000
094700*  FOR ALL ITEMS.                                                *09470000
094800*----------------------------------------------------------------*09480000
094900                                                                  09490000
095000 2150-SELECT-ALL-ITEMS.                                           09500000
095100                                                                  09510000
095200     MOVE +1                       TO ASC-BLK-SUB.                09520000
095300                                                                  09530000
095400     PERFORM 2151-SET-SELECTED-INDS                               09540000
095500         VARYING ASC-ITEM-SUB                                     09550000
095600         FROM 1 BY 1                                              09560000
095700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09570000
095800                                                                  09580000
095900     ADD +1                        TO ASC-BLK-SUB.                09590000
096000                                                                  09600000
096100     PERFORM 2151-SET-SELECTED-INDS                               09610000
096200         VARYING ASC-ITEM-SUB                                     09620000
096300         FROM 1 BY 1                                              09630000
096400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09640000
096500                                                                  09650000
096600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09660000
096700                                   TO PV-LIST-ITEM-NUMBER.        09670000
096800                                                                  09680000
096900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09690000
097000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09700000
097100                                                                  09710000
097200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09720000
097300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09730000
097400         MOVE +1                   TO ASC-BLK-SUB                 09740000
097500                                                                  09750000
097600         PERFORM 5100-WRITE-TEMP-STORAGE                          09760000
097700                                                                  09770000
097800         MOVE +1                   TO PV-BLOCK-NUMBER             09780000
097900                                                                  09790000
098000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09800000
098100             PV-FIRST-BLOCK-IN-ARRAY - 1                          09810000
098200                                                                  09820000
098300         PERFORM                                                  09830000
098400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09840000
098500                                                                  09850000
098600             PERFORM 4410-READ-TEMP-STORAGE                       09860000
098700                                                                  09870000
098800             PERFORM 2151-SET-SELECTED-INDS                       09880000
098900                 VARYING ASC-ITEM-SUB                             09890000
099000                 FROM 1 BY 1                                      09900000
099100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09910000
099200                                                                  09920000
099300             PERFORM 5100-WRITE-TEMP-STORAGE                      09930000
099400                                                                  09940000
099500             ADD +1                TO PV-BLOCK-NUMBER             09950000
099600                                                                  09960000
099700         END-PERFORM                                              09970000
099800                                                                  09980000
099900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09990000
100000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10000000
100100                                                                  10010000
100200         PERFORM                                                  10020000
100300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10030000
100400                   ASC-HIGHEST-BLOCK-WRITTEN                      10040000
100500                                                                  10050000
100600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10060000
100700                                   TO PV-BLOCK-NUMBER             10070000
100800                                                                  10080000
100900             PERFORM 4410-READ-TEMP-STORAGE                       10090000
101000                                                                  10100000
101100             PERFORM 2151-SET-SELECTED-INDS                       10110000
101200                 VARYING ASC-ITEM-SUB                             10120000
101300                 FROM 1 BY 1                                      10130000
101400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10140000
101500                                                                  10150000
101600             PERFORM 5100-WRITE-TEMP-STORAGE                      10160000
101700                                                                  10170000
101800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10180000
101900                                                                  10190000
102000         END-PERFORM                                              10200000
102100                                                                  10210000
102200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10220000
102300                                   TO PV-BLOCK-NUMBER             10230000
102400                                                                  10240000
102500         PERFORM 4410-READ-TEMP-STORAGE                           10250000
102600     END-IF.                                                      10260000
102700                                                                  10270000
102800                                                                  10280000
102900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10290000
103000                       ASC-NUMBER-OF-SELECTED-ITEMS.              10300000
103100                                                                  10310000
103200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10320000
103300                                                                  10330000
103400 EJECT                                                            10340000
103500*----------------------------------------------------------------*10350000
103600*    MARK EACH ITEM AS BEING SELECTED.                           *10360000
103700*----------------------------------------------------------------*10370000
103800                                                                  10380000
103900 2151-SET-SELECTED-INDS.                                          10390000
104000                                                                  10400000
104100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10410000
104200             NOT EQUAL ZERO                                       10420000
104300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10430000
104400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10440000
104500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10450000
104600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10460000
104700                               TO  TRUE                           10470000
104800         END-IF                                                   10480000
104900     END-IF.                                                      10490000
105000******************************************************************10500000
105100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10510000
105200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10520000
105300******************************************************************10530000
105400 2200-MOVE-SCREEN-TO-COMMAREA.                                    10540000
105500                                                                  10550000
105600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10560000
105700     MOVE +1                       TO PV-SUB.                     10570000
105800*                                                                 10580000
105900     PERFORM 3100-SET-SUBSCRIPTS.                                 10590000
106000     IF  ASTRTITL > ZERO                                          10600000
106100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10610000
106200     ELSE                                                         10620000
106300         IF  ASTRTITF = DP015-ERASE-EOF                           10630000
106400             INITIALIZE ASC-START-ITEM-REQUEST                    10640000
106500         END-IF                                                   10650000
106600     END-IF.                                                      10660000
106700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10670000
106800         VARYING PV-SUB                                           10680000
106900         FROM 1 BY 1                                              10690000
107000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10700000
107100******************************************************************10710000
107200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10720000
107300******************************************************************10730000
107400 2210-MOVE-LINES-TO-COMMAREA.                                     10740000
107500     IF  MR-SELECTL (PV-SUB) > ZERO                               10750000
107600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10760000
107700         MOVE MR-SELECTI (PV-SUB)                                 10770000
107800                                   TO ASC-TEMP-SELECTED-SW        10780000
107900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10790000
108000     ELSE                                                         10800000
108100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10810000
108200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10820000
108300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10830000
108400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10840000
108500         END-IF                                                   10850000
108600     END-IF.                                                      10860000
108700     ADD +1                        TO ASC-ITEM-SUB.               10870000
108800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10880000
108900         ADD +1                    TO ASC-BLK-SUB                 10890000
109000         MOVE +1                   TO ASC-ITEM-SUB                10900000
109100     END-IF.                                                      10910000
109200******************************************************************10920000
109300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10930000
109400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10940000
109500******************************************************************10950000
109600 3000-EDIT-DATA-IN-COMMAREA.                                      10960000
109700     SET PS-NO-ERROR               TO TRUE.                       10970000
109800     PERFORM 3200-RESET-ATTRIBUTES.                               10980000
109900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10990000
110000**                                                                11000000
110100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11010000
110200* EDITTING IS DONE FROM THE BOTTOM UP.                            11020000
110300**                                                                11030000
110400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11040000
110500         ASC-ITEMS-DISPLAYED - 1.                                 11050000
110600     PERFORM 3100-SET-SUBSCRIPTS.                                 11060000
110700     PERFORM 3300-EDIT-SELECTIONS                                 11070000
110800         VARYING PV-SUB                                           11080000
110900         FROM PV-SUB BY -1                                        11090000
111000         UNTIL PV-SUB < +1                                        11100000
111100*                                                                 11110000
111200     IF  PS-NO-ERROR                                              11120000
111300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11130000
111400     END-IF.                                                      11140000
111500*                                                                 11150000
111600     IF  ((PS-NO-ERROR)                                           11160000
111700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11170000
111800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11180000
111900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11190000
112000     END-IF.                                                      11200000
112100 EJECT                                                            11210000
112200*----------------------------------------------------------------*11220000
112300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11230000
112400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11240000
112500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11250000
112600*                                                                *11260000
112700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11270000
112800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11280000
112900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11290000
113000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11300000
113100*----------------------------------------------------------------*11310000
113200                                                                  11320000
113300 3100-SET-SUBSCRIPTS.                                             11330000
113400                                                                  11340000
113500     COMPUTE ASC-ITEM-SUB =                                       11350000
113600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11360000
113700                                                                  11370000
113800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11380000
113900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11390000
114000                                                                  11400000
114100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11410000
114200     ELSE                                                         11420000
114300         MOVE +1                     TO ASC-BLK-SUB               11430000
114400     END-IF.                                                      11440000
114500******************************************************************11450000
114600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11460000
114700******************************************************************11470000
114800                                                                  11480000
114900 3200-RESET-ATTRIBUTES.                                           11490000
115000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11500000
115100     MOVE DP015-GREEN              TO ASTRTITC.                   11510000
115200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11520000
115300*                                                                 11530000
115400     PERFORM                                                      11540000
115500         VARYING PV-SUB                                           11550000
115600         FROM 1 BY 1                                              11560000
115700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11570000
115800         MOVE DP015-UNP-ALP-NOR-OFF                               11580000
115900                                   TO MR-SELECTA (PV-SUB)         11590000
116000         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11600000
116100         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11610000
116200     END-PERFORM.                                                 11620000
116300******************************************************************11630000
116400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11640000
116500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11650000
116600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11660000
116700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11670000
116800******************************************************************11680000
116900 3300-EDIT-SELECTIONS.                                            11690000
117000     EVALUATE TRUE                                                11700000
117100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11710000
117200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11720000
117300                 CONTINUE                                         11730000
117400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11740000
117500             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         11750000
117600                ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS    11760000
117700                MOVE ASC-TEMP-SELECTED-SW                         11770000
117800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11780000
117900                               TO ASC-SELECTED-SW                 11790000
118000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11800000
118100             END-IF                                               11810000
118200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11820000
118300                 = SPACE                                          11830000
118400             EVALUATE TRUE                                        11840000
118500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11850000
118600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11860000
118700                     MOVE SPACE TO ASC-SELECTED-SW                11870000
118800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11880000
118900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11890000
119000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11900000
119100                     MOVE SPACE TO ASC-SELECTED-SW                11910000
119200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11920000
119300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11930000
119400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11940000
119500                     MOVE SPACE TO ASC-SELECTED-SW                11950000
119600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11960000
119700             END-EVALUATE                                         11970000
119800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11980000
119900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11990000
120000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12000000
120100             END-IF                                               12010000
120200             PERFORM 3310-EDIT-RANGE                              12020000
120300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12030000
120400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12040000
120500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12050000
120600             END-IF                                               12060000
120700             PERFORM 3310-EDIT-RANGE                              12070000
120800         WHEN OTHER                                               12080000
120900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12090000
121000             SET DP020-MSG-FATAL    TO TRUE                       12100000
121100             MOVE -1                TO MR-SELECTL (PV-SUB)        12110000
121200             SET DP030-SET-CURSOR-APPL-1                          12120000
121300                                    TO TRUE                       12130000
121400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12140000
121500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12150000
121600             SET PS-ERROR TO TRUE                                 12160000
121700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12170000
121800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12180000
121900                 MOVE SPACE         TO ASC-SELECTED-SW            12190000
122000                                        (ASC-BLK-SUB ASC-ITEM-SUB)12200000
122100             END-IF                                               12210000
122200     END-EVALUATE.                                                12220000
122300                                                                  12230000
122400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12240000
122500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12250000
122600     IF  ASC-ITEM-SUB < 1                                         12260000
122700         SUBTRACT +1 FROM ASC-BLK-SUB                             12270000
122800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12280000
122900     END-IF.                                                      12290000
123000******************************************************************12300000
123100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12310000
123200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12320000
123300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12330000
123400** THE ENDING.                                                  **12340000
123500******************************************************************12350000
123600 3310-EDIT-RANGE.                                                 12360000
123700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12370000
123800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12380000
123900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12390000
124000                                   TO ASC-SELECTED-SW             12400000
124100                                        (ASC-BLK-SUB ASC-ITEM-SUB)12410000
124200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12420000
124300         ELSE                                                     12430000
124400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12440000
124500                 CONTINUE                                         12450000
124600             ELSE                                                 12460000
124700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12470000
124800                 MOVE PC-TSYMSG-00054                             12480000
124900                                   TO DP020-MSG-NUMBER            12490000
125000                 SET DP020-MSG-FATAL                              12500000
125100                                   TO TRUE                        12510000
125200                 MOVE -1           TO MR-SELECTL (PV-SUB)         12520000
125300                 SET DP030-SET-CURSOR-APPL-1                      12530000
125400                                   TO TRUE                        12540000
125500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12550000
125600                 MOVE DP015-UNDERLINE                             12560000
125700                                   TO MR-SELECTH (PV-SUB)         12570000
125800                 SET PS-ERROR      TO TRUE                        12580000
125900             END-IF                                               12590000
126000         END-IF                                                   12600000
126100     ELSE                                                         12610000
126200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12620000
126300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12630000
126400                                   TO ASC-SELECTED-SW             12640000
126500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12650000
126600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12660000
126700         ELSE                                                     12670000
126800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12680000
126900                 CONTINUE                                         12690000
127000             ELSE                                                 12700000
127100*                -- ONLY ONE END-OF-RANGE ALLOWED --              12710000
127200                 MOVE PC-TSYMSG-00055                             12720000
127300                                   TO DP020-MSG-NUMBER            12730000
127400                 SET DP020-MSG-FATAL                              12740000
127500                                   TO TRUE                        12750000
127600                 MOVE -1           TO MR-SELECTL (PV-SUB)         12760000
127700                 SET DP030-SET-CURSOR-APPL-1                      12770000
127800                                   TO TRUE                        12780000
127900                 SET PS-ERROR      TO TRUE                        12790000
128000             END-IF                                               12800000
128100         END-IF                                                   12810000
128200     END-IF.                                                      12820000
128300*                                                                 12830000
128400******************************************************************12840000
128500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12850000
128600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12860000
128700******************************************************************12870000
128800 3400-CHECK-RANGE-SEQUENCE.                                       12880000
128900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12890000
129000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12900000
129100       AND  ASC-START-OF-SELECTED-RANGE >                         12910000
129200                                         ASC-END-OF-SELECTED-RANGE12920000
129300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12930000
129400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12940000
129500         SET DP020-MSG-FATAL TO TRUE                              12950000
129600         SET PS-ERROR TO TRUE                                     12960000
129700         PERFORM 3410-POSITION-AT-ERROR                           12970000
129800     END-IF.                                                      12980000
129900******************************************************************12990000
130000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13000000
130100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13010000
130200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13020000
130300******************************************************************13030000
130400 3410-POSITION-AT-ERROR.                                          13040000
130500     SET DP030-SET-CURSOR-APPL-1                                  13050000
130600                                   TO TRUE.                       13060000
130700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13070000
130800                    - PV-TOP-ITEM + 1.                            13080000
130900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13090000
131000         CONTINUE                                                 13100000
131100     ELSE                                                         13110000
131200         MOVE -1                   TO MR-SELECTL (PV-SUB)         13120000
131300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13130000
131400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13140000
131500     END-IF.                                                      13150000
131600*                                                                 13160000
131700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13170000
131800                    - PV-TOP-ITEM + 1.                            13180000
131900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13190000
132000         CONTINUE                                                 13200000
132100     ELSE                                                         13210000
132200         MOVE -1                   TO MR-SELECTL (PV-SUB)         13220000
132300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13230000
132400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13240000
132500     END-IF.                                                      13250000
132600 EJECT                                                            13260000
132700*----------------------------------------------------------------*13270000
132800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13280000
132900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13290000
133000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13300000
133100*----------------------------------------------------------------*13310000
133200                                                                  13320000
133300 3500-MARK-RANGE-AS-SELECTED.                                     13330000
133400     MOVE +1                       TO  ASC-BLK-SUB.               13340000
133500     PERFORM 3510-MARK-SELECTED-INDS                              13350000
133600         VARYING ASC-ITEM-SUB                                     13360000
133700         FROM 1 BY 1                                              13370000
133800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13380000
133900                                                                  13390000
134000     ADD +1                        TO ASC-BLK-SUB.                13400000
134100     PERFORM 3510-MARK-SELECTED-INDS                              13410000
134200         VARYING ASC-ITEM-SUB                                     13420000
134300         FROM 1 BY 1                                              13430000
134400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13440000
134500                                                                  13450000
134600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13460000
134700                                   TO  PV-LIST-ITEM-NUMBER.       13470000
134800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13480000
134900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13490000
135000               PC-ITEMS-PER-PANEL).                               13500000
135100                                                                  13510000
135200     MOVE ASC-START-OF-SELECTED-RANGE                             13520000
135300                                   TO PV-START-OF-SELECTED-RANGE. 13530000
135400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13540000
135500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13550000
135600               PC-ITEMS-PER-PANEL).                               13560000
135700                                                                  13570000
135800     MOVE ASC-END-OF-SELECTED-RANGE                               13580000
135900                                   TO  PV-END-OF-SELECTED-RANGE.  13590000
136000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13600000
136100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13610000
136200               PC-ITEMS-PER-PANEL).                               13620000
136300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13630000
136400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13640000
136500                                                                  13650000
136600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13660000
136700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13670000
136800         MOVE +1                   TO ASC-BLK-SUB                 13680000
136900         PERFORM 5100-WRITE-TEMP-STORAGE                          13690000
137000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13700000
137100             PV-FIRST-BLOCK-IN-ARRAY - 1                          13710000
137200                                                                  13720000
137300         PERFORM                                                  13730000
137400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13740000
137500                   PV-PREV-BLOCK-IN-ARRAY                         13750000
137600             MOVE PV-FIRST-BLOCK-IN-RANGE                         13760000
137700                                   TO PV-BLOCK-NUMBER             13770000
137800             PERFORM 4410-READ-TEMP-STORAGE                       13780000
137900             PERFORM 3510-MARK-SELECTED-INDS                      13790000
138000                 VARYING ASC-ITEM-SUB                             13800000
138100                 FROM 1 BY 1                                      13810000
138200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13820000
138300             PERFORM 5100-WRITE-TEMP-STORAGE                      13830000
138400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13840000
138500         END-PERFORM                                              13850000
138600                                                                  13860000
138700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13870000
138800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13880000
138900         PERFORM                                                  13890000
139000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13900000
139100                   PV-LAST-BLOCK-IN-RANGE                         13910000
139200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13920000
139300                                   TO PV-BLOCK-NUMBER             13930000
139400             PERFORM 4410-READ-TEMP-STORAGE                       13940000
139500             PERFORM 3510-MARK-SELECTED-INDS                      13950000
139600                 VARYING ASC-ITEM-SUB                             13960000
139700                 FROM 1 BY 1                                      13970000
139800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13980000
139900             PERFORM 5100-WRITE-TEMP-STORAGE                      13990000
140000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14000000
140100         END-PERFORM                                              14010000
140200                                                                  14020000
140300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14030000
140400                                   TO PV-BLOCK-NUMBER             14040000
140500         PERFORM 4410-READ-TEMP-STORAGE                           14050000
140600     END-IF.                                                      14060000
140700                                                                  14070000
140800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14080000
140900                                      ASC-END-OF-SELECTED-RANGE.  14090000
141000                                                                  14100000
141100 EJECT                                                            14110000
141200*----------------------------------------------------------------*14120000
141300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14130000
141400*----------------------------------------------------------------*14140000
141500                                                                  14150000
141600 3510-MARK-SELECTED-INDS.                                         14160000
141700                                                                  14170000
141800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14180000
141900                                ASC-ITEM-SUB) >                   14190000
142000         ASC-START-OF-SELECTED-RANGE)                             14200000
142100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14210000
142200                                ASC-ITEM-SUB) =                   14220000
142300         ASC-START-OF-SELECTED-RANGE)                             14230000
142400                                                                  14240000
142500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14250000
142600                                    ASC-ITEM-SUB) <               14260000
142700             ASC-END-OF-SELECTED-RANGE)                           14270000
142800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14280000
142900                                    ASC-ITEM-SUB) =               14290000
143000             ASC-END-OF-SELECTED-RANGE)                           14300000
143100                                                                  14310000
143200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14320000
143300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14330000
143400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14340000
143500                               TO TRUE                            14350000
143600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14360000
143700                               TO TRUE                            14370000
143800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14380000
143900             END-IF                                               14390000
144000         END-IF                                                   14400000
144100     END-IF.                                                      14410000
144200                                                                  14420000
144300 EJECT                                                            14430000
144400*----------------------------------------------------------------*14440000
144500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14450000
144600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14460000
144700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14470000
144800*    DISPLAY THE PANEL TO USER.                                  *14480000
144900*----------------------------------------------------------------*14490000
145000                                                                  14500000
145100 4000-BUILD-INITIAL-PANEL.                                        14510000
145200                                                                  14520000
145300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14530000
145400                                 ASC-BLOCK-ENTRIES (2).           14540000
145500     MOVE +1                 TO ASC-BLK-SUB.                      14550000
145600     SET ASC-ITEMS-LEFT-ON-DB                                     14560000
145700                             TO TRUE.                             14570000
145800                                                                  14580000
145900     MOVE +0                 TO ASC-ITEM-SUB                      14590000
146000                                ASC-NUMBER-OF-ITEMS-READ          14600000
146100                                ASC-NUMBER-OF-SELECTED-ITEMS      14610000
146200                                ASC-HIGHEST-BLOCK-WRITTEN         14620000
146300                                ASC-START-OF-SELECTED-RANGE       14630000
146400                                ASC-END-OF-SELECTED-RANGE         14640000
146500                                ASC-ITEM-AT-TOP-OF-PANEL.         14650000
146600     PERFORM 4100-PREPARE-CURSOR                                  14660000
146700                                                                  14670000
146800     PERFORM 4010-OPEN-CURSOR.                                    14680000
146900                                                                  14690000
147000     PERFORM 4300-READ-ITEMS-FROM-DB.                             14700000
147100                                                                  14710000
147200     PERFORM 4020-CLOSE-CURSOR.                                   14720000
147300                                                                  14730000
147400     MOVE +1                   TO  PV-TOP-ITEM.                   14740000
147500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14750000
147600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14760000
147700         SET DP020-MSG-FATAL   TO  TRUE                           14770000
147800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14780000
147900     ELSE                                                         14790000
148000         MOVE -1               TO MR-SELECTL (1)                  14800000
148100         SET DP030-SET-CURSOR-APPL-1                              14810000
148200                               TO TRUE                            14820000
148300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14830000
148400     END-IF.                                                      14840000
148500 EJECT                                                            14850000
148600*----------------------------------------------------------------*14860000
148700* OPEN THE TMESSAGE CURSOR.                                      *14870000
148800*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *14880000
148900*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *14890000
149000*   USER.                                                        *14900000
149100*----------------------------------------------------------------*14910000
149200                                                                  14920000
149300 4010-OPEN-CURSOR.                                                14930000
149400     PERFORM                                                      14940000
149500         WITH TEST AFTER                                          14950000
149600         VARYING PV-RETRY-COUNTER                                 14960000
149700         FROM 1 BY 1                                              14970000
149800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14980000
149900                   OR (SQLCODE = ZERO))                           14990000
150000         EVALUATE TRUE                                            15000000
150100             WHEN ASC-OPER-DESC-CURSOR                            15010000
150200                 MOVE 'CURSOR:  OPER-DESC-CSR'                    15020000
150300                                   TO DP013-MESSAGE-TEXT (2)      15030000
150400                 EXEC SQL                                         15040000
150500                      OPEN OPER-DESC-CSR                          15050000
150600                 END-EXEC                                         15060000
150700                                                                  15070000
150800             WHEN ASC-FCLTY-AREA-ID-CURSOR                        15080000
150900                 MOVE 'CURSOR:  FCLTY-AREA-ID-CSR'                15090000
151000                                   TO DP013-MESSAGE-TEXT (2)      15100000
151100                 EXEC SQL                                         15110000
151200                      OPEN FCLTY-AREA-ID-CSR                      15120000
151300                 END-EXEC                                         15130000
151400                                                                  15140000
151500         END-EVALUATE                                             15150000
151600                                                                  15160000
151700         EVALUATE TRUE                                            15170000
151800             WHEN SQLCODE = ZERO                                  15180000
151900             WHEN SQLCODE = -904                                  15190000
152000             WHEN SQLCODE = -913                                  15200000
152100                 CONTINUE                                         15210000
152200             WHEN SQLWARN0 NOT = SPACES                           15220000
152300             WHEN SQLCODE < ZERO                                  15230000
152400             WHEN SQLCODE > ZERO                                  15240000
152500                 MOVE '4010-OPEN-CURSOR'                          15250000
152600                                   TO DP013-PARAGRAPH             15260000
152700                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             15270000
152800                                   TO DP013-MESSAGE-TEXT (1)      15280000
152900                 MOVE SQLCA        TO DP013-SQLCA                 15290000
153000                 MOVE 'TOPERFA '   TO DP013-DB2-TABLE-NAME (1)    15300000
153100                 MOVE 'TOPERFT '   TO DP013-DB2-TABLE-NAME (2)    15310000
153200                 SET DP013-DB2-ABEND                              15320000
153300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15330000
153400                 PERFORM DP013-0000-PROCESS-ABEND                 15340000
153500         END-EVALUATE                                             15350000
153600     END-PERFORM.                                                 15360000
153700*                                                                 15370000
153800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15380000
153900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15390000
154000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15400000
154100                                   TO DP013-MESSAGE-TEXT (1)      15410000
154200         MOVE SQLCA                TO DP013-SQLCA                 15420000
154300         MOVE 'TOPERFA '           TO DP013-DB2-TABLE-NAME (1)    15430000
154400         MOVE 'TOPERFT '           TO DP013-DB2-TABLE-NAME (2)    15440000
154500         SET DP013-DB2-ABEND                                      15450000
154600             DP013-XCTL-DISPLAY-RESTART                           15460000
154700                                   TO TRUE                        15470000
154800         PERFORM DP013-0000-PROCESS-ABEND                         15480000
154900     END-IF.                                                      15490000
155000                                                                  15500000
155100 EJECT                                                            15510000
155200*----------------------------------------------------------------*15520000
155300* CLOSE THE TMESSAGE CURSOR.                                     *15530000
155400*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *15540000
155500*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15550000
155600*   USER.                                                        *15560000
155700*----------------------------------------------------------------*15570000
155800                                                                  15580000
155900 4020-CLOSE-CURSOR.                                               15590000
156000     EVALUATE TRUE                                                15600000
156100         WHEN ASC-OPER-DESC-CURSOR                                15610000
156200             EXEC SQL                                             15620000
156300                 CLOSE OPER-DESC-CSR                              15630000
156400             END-EXEC                                             15640000
156500                                                                  15650000
156600         WHEN ASC-FCLTY-AREA-ID-CURSOR                            15660000
156700             EXEC SQL                                             15670000
156800                 CLOSE FCLTY-AREA-ID-CSR                          15680000
156900             END-EXEC                                             15690000
157000     END-EVALUATE.                                                15700000
157100*                                                                 15710000
157200     EVALUATE TRUE                                                15720000
157300         WHEN SQLCODE = ZERO                                      15730000
157400             CONTINUE                                             15740000
157500         WHEN SQLWARN0 NOT = SPACES                               15750000
157600         WHEN SQLCODE < ZERO                                      15760000
157700         WHEN SQLCODE > ZERO                                      15770000
157800             MOVE '4020-CLOSE-CURSOR'                             15780000
157900                               TO DP013-PARAGRAPH                 15790000
158000             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  15800000
158100                               TO DP013-MESSAGE-TEXT (1)          15810000
158200             MOVE SQLCA        TO DP013-SQLCA                     15820000
158300             MOVE 'TOPERFA '   TO DP013-DB2-TABLE-NAME (1)        15830000
158400             MOVE 'TOPERFT '   TO DP013-DB2-TABLE-NAME (2)        15840000
158500             SET DP013-DB2-ABEND                                  15850000
158600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15860000
158700             PERFORM DP013-0000-PROCESS-ABEND                     15870000
158800     END-EVALUATE.                                                15880000
158900                                                                  15890000
159000 EJECT                                                            15900000
159100*----------------------------------------------------------------*15910000
159200*    SET UP THE HOST VARIABLES.                                  *15920000
159300*----------------------------------------------------------------*15930000
159400                                                                  15940000
159500 4100-PREPARE-CURSOR.                                             15950000
159600                                                                  15960000
159700     SET ASC-NO-CURSOR         TO TRUE.                           15970000
159800                                                                  15980000
159900     IF  DK-FCLTY-AREA-ID  GREATER THAN SPACES                    15990000
160000         SET ASC-FCLTY-AREA-ID-CURSOR                             16000000
160100                               TO TRUE                            16010000
160200     ELSE                                                         16020000
160300         IF  DK-OPER-DESC GREATER THAN SPACES                     16030000
160400             MOVE DK-OPER-DESC TO PV-OPER-DESC                    16040000
160500             SET ASC-OPER-DESC-CURSOR                             16050000
160600                               TO TRUE                            16060000
160700             IF  PV-DESC-BYTE (1) EQUAL '*'                       16070000
160800                 MOVE PC-PERCENT                                  16080000
160900                               TO PV-DESC-BYTE (1)                16090000
161000                 INSPECT DK-OPER-DESC                             16100000
161100                     REPLACING FIRST '*' BY PC-PERCENT            16110000
161200             END-IF                                               16120000
161300                                                                  16130000
161400             SET PS-NOT-DONE   TO TRUE                            16140000
161500                                                                  16150000
161600             PERFORM VARYING PV-SUB                               16160000
161700                 FROM LENGTH OF PV-OPER-DESC BY -1                16170000
161800                 UNTIL PV-SUB EQUAL 1                             16180000
161900                   OR  PS-DONE                                    16190000
162000                                                                  16200000
162100                     IF  PV-DESC-BYTE (PV-SUB) = '*'              16210000
162200                         MOVE PC-PERCENT                          16220000
162300                               TO PV-DESC-BYTE (PV-SUB)           16230000
162400                         SET PS-DONE                              16240000
162500                               TO TRUE                            16250000
162600                     END-IF                                       16260000
162700                                                                  16270000
162800                     IF  PV-DESC-BYTE (PV-SUB) > SPACES           16280000
162900                         SET PS-DONE                              16290000
163000                               TO TRUE                            16300000
163100                     ELSE                                         16310000
163200                         MOVE PC-PERCENT                          16320000
163300                               TO PV-DESC-BYTE (PV-SUB)           16330000
163400                     END-IF                                       16340000
163500                                                                  16350000
163600             END-PERFORM                                          16360000
163700             MOVE PV-OPER-DESC TO DK-OPER-DESC                    16370000
163800                                                                  16380000
163900         ELSE                                                     16390000
164000             MOVE ALL '%'      TO DK-OPER-DESC                    16400000
164100         END-IF                                                   16410000
164200                                                                  16420000
164300     END-IF.                                                      16430000
164400                                                                  16440000
164500                                                                  16450000
164600     IF  ASC-NO-CURSOR                                            16460000
164700         SET ASC-OPER-DESC-CURSOR                                 16470000
164800                               TO TRUE                            16480000
164900         MOVE ALL '%'          TO DK-OPER-DESC                    16490000
165000     END-IF.                                                      16500000
165100                                                                  16510000
165200 EJECT                                                            16520000
165300*----------------------------------------------------------------*16530000
165400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16540000
165500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16550000
165600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16560000
165700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16570000
165800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16580000
165900*                                                                *16590000
166000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16600000
166100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16610000
166200*    UPON INITIALIZATION.                                        *16620000
166300*----------------------------------------------------------------*16630000
166400                                                                  16640000
166500 4300-READ-ITEMS-FROM-DB.                                         16650000
166600                                                                  16660000
166700     PERFORM                                                      16670000
166800         VARYING PV-READ-COUNT                                    16680000
166900         FROM 1 BY 1                                              16690000
167000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16700000
167100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16710000
167200                                                                  16720000
167300         PERFORM 4310-FETCH                                       16730000
167400                                                                  16740000
167500         IF  ASC-ITEMS-LEFT-ON-DB                                 16750000
167600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16760000
167700                 ADD +1            TO ASC-ITEM-SUB                16770000
167800             ELSE                                                 16780000
167900                 ADD +1            TO ASC-BLK-SUB                 16790000
168000                 MOVE +1           TO ASC-ITEM-SUB                16800000
168100                                                                  16810000
168200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16820000
168300                     MOVE +1       TO ASC-BLK-SUB                 16830000
168400                     SET ASC-BLOCK-MODIFIED (1)                   16840000
168500                                   TO TRUE                        16850000
168600                     PERFORM 5100-WRITE-TEMP-STORAGE              16860000
168700                     MOVE ASC-BLOCK-ENTRIES                       16870000
168800                               (PC-MAX-BLOCKS-IN-ARRAY)           16880000
168900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16890000
169000                     ADD +1        TO ASC-BLK-SUB                 16900000
169100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16910000
169200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16920000
169300                                   TO TRUE                        16930000
169400                 END-IF                                           16940000
169500             END-IF                                               16950000
169600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16960000
169700             MOVE ASC-NUMBER-OF-ITEMS-READ                        16970000
169800                                   TO ASC-LIST-ITEM-NUMBER        16980000
169900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16990000
170000             MOVE OPERAT-OPER-ID   TO ASC-OPER-ID                 17000000
170100                                        (ASC-BLK-SUB ASC-ITEM-SUB)17010000
170200             MOVE OPERFA-FCLTY-AREA-ID TO                         17020000
170300                                      ASC-FCLTY-AREA-ID           17030000
170400                                        (ASC-BLK-SUB ASC-ITEM-SUB)17040000
170500             MOVE OPERFA-PRC-FCLTY-AREA-ID TO                     17050000
170600                                      ASC-PRC-FCLTY-AREA-ID       17060000
170700                                        (ASC-BLK-SUB ASC-ITEM-SUB)17070000
170800             MOVE OPERAT-OPER-DESC TO PV-OPER-DESC                17080000
170900                                      ASC-OPER-DESC               17090000
171000                                        (ASC-BLK-SUB ASC-ITEM-SUB)17100000
171100                                      ASC-INSTR-DESC              17110000
171200                                        (ASC-BLK-SUB ASC-ITEM-SUB)17120000
171300             SET PS-NOT-DONE TO TRUE                              17130000
171400             PERFORM VARYING PV-SUB                               17140000
171500                 FROM LENGTH OF PV-OPER-DESC BY -1                17150000
171600                 UNTIL PV-SUB < 1                                 17160000
171700                   OR  PS-DONE                                    17170000
171800                                                                  17180000
171900                     IF  PV-DESC-BYTE (PV-SUB) > SPACE            17190000
172000                         SET PS-DONE                              17200000
172100                               TO TRUE                            17210000
172200                     END-IF                                       17220000
172300             END-PERFORM                                          17230000
172400                                                                  17240000
172500             IF PS-DONE                                           17250000
172600                MOVE PV-SUB        TO PV-POINTER                  17260000
172700                COMPUTE PV-POINTER  = PV-POINTER + 2              17270000
172800             ELSE                                                 17280000
172900                MOVE +1            TO PV-POINTER                  17290000
173000             END-IF                                               17300000
173100                                                                  17310000
173200             STRING PV-SPACE  OPERFA-FCLTY-AREA-ID                17320000
173300                    DELIMITED BY SIZE                             17330000
173400                    INTO ASC-INSTR-DESC (ASC-BLK-SUB ASC-ITEM-SUB)17340000
173500                    WITH POINTER PV-POINTER                       17350000
173600         END-IF                                                   17360000
173700     END-PERFORM.                                                 17370000
173800                                                                  17380000
173900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17390000
174000         MOVE +1               TO ASC-BLK-SUB                     17400000
174100         PERFORM 5100-WRITE-TEMP-STORAGE                          17410000
174200         ADD +1                TO ASC-BLK-SUB                     17420000
174300         PERFORM 5100-WRITE-TEMP-STORAGE                          17430000
174400                                                                  17440000
174500         MOVE 1                TO ASC-BLK-SUB                     17450000
174600                                  PV-BLOCK-NUMBER                 17460000
174700         PERFORM 4410-READ-TEMP-STORAGE                           17470000
174800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17480000
174900             MOVE 2            TO ASC-BLK-SUB                     17490000
175000                                  PV-BLOCK-NUMBER                 17500000
175100             PERFORM 4410-READ-TEMP-STORAGE                       17510000
175200         END-IF                                                   17520000
175300     END-IF.                                                      17530000
175400 EJECT                                                            17540000
175500*----------------------------------------------------------------*17550000
175600*    FETCH THE DESCRIPTION CURSOR.                               *17560000
175700*----------------------------------------------------------------*17570000
175800                                                                  17580000
175900 4310-FETCH.                                                      17590000
176000                                                                  17600000
176100     EVALUATE TRUE                                                17610000
176200                                                                  17620000
176300         WHEN ASC-OPER-DESC-CURSOR                                17630000
176400              EXEC SQL                                            17640000
176500                   FETCH OPER-DESC-CSR                            17650000
176600                   INTO                                           17660000
176700                         :OPERAT-OPER-ID                          17670000
176800                       , :OPERAT-OPER-DESC                        17680000
176900                       , :OPERFA-FCLTY-AREA-ID                    17690000
177000                       , :OPERFA-PRC-FCLTY-AREA-ID                17700000
177100              END-EXEC                                            17710000
177200                                                                  17720000
177300         WHEN ASC-FCLTY-AREA-ID-CURSOR                            17730000
177400              EXEC SQL                                            17740000
177500                   FETCH FCLTY-AREA-ID-CSR                        17750000
177600                   INTO                                           17760000
177700                         :OPERAT-OPER-ID                          17770000
177800                       , :OPERAT-OPER-DESC                        17780000
177900                       , :OPERFA-FCLTY-AREA-ID                    17790000
178000                       , :OPERFA-PRC-FCLTY-AREA-ID                17800000
178100              END-EXEC                                            17810000
178200     END-EVALUATE.                                                17820000
178300                                                                  17830000
178400     EVALUATE TRUE                                                17840000
178500         WHEN SQLCODE = ZERO                                      17850000
178600         WHEN SQLCODE = +100                                      17860000
178700              CONTINUE                                            17870000
178800         WHEN SQLWARN0 NOT = SPACE                                17880000
178900         WHEN SQLCODE NOT = ZERO                                  17890000
179000              MOVE '4310-FETCH-CURSOR'                            17900000
179100                               TO DP013-PARAGRAPH                 17910000
179200              MOVE 'FETCH MESSAGE CURSOR'                         17920000
179300                               TO DP013-MESSAGE-TEXT (1)          17930000
179400              MOVE SQLCA       TO DP013-SQLCA                     17940000
179500              SET DP013-DB2-ABEND                                 17950000
179600                               TO TRUE                            17960000
179700              PERFORM DP013-0000-PROCESS-ABEND                    17970000
179800     END-EVALUATE.                                                17980000
179900                                                                  17990000
180000     IF  SQLCODE EQUAL +100                                       18000000
180100         SET ASC-NO-ITEMS-LEFT-ON-DB                              18010000
180200                                   TO TRUE                        18020000
180300     END-IF.                                                      18030000
180400                                                                  18040000
180500 EJECT                                                            18050000
180600*----------------------------------------------------------------*18060000
180700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18070000
180800*----------------------------------------------------------------*18080000
180900                                                                  18090000
181000 4400-MOVE-COMMAREA-TO-SCREEN.                                    18100000
181100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18110000
181200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18120000
181300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18130000
181400             MOVE +1    TO ASC-BLK-SUB                            18140000
181500             PERFORM 5100-WRITE-TEMP-STORAGE                      18150000
181600             ADD +1     TO ASC-BLK-SUB                            18160000
181700             PERFORM 5100-WRITE-TEMP-STORAGE                      18170000
181800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18180000
181900                 GIVING PV-BLOCK-NUMBER                           18190000
182000                 REMAINDER PV-REMAINDER                           18200000
182100             IF  PV-REMAINDER > ZERO                              18210000
182200                 ADD +1 TO PV-BLOCK-NUMBER                        18220000
182300             END-IF                                               18230000
182400             MOVE +1    TO ASC-BLK-SUB                            18240000
182500             PERFORM 4410-READ-TEMP-STORAGE                       18250000
182600             ADD +1     TO ASC-BLK-SUB                            18260000
182700                           PV-BLOCK-NUMBER                        18270000
182800             PERFORM 4410-READ-TEMP-STORAGE                       18280000
182900     END-IF.                                                      18290000
183000     MOVE +1            TO ASC-BLK-SUB.                           18300000
183100     COMPUTE ASC-ITEM-SUB =                                       18310000
183200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18320000
183300         + PC-ITEMS-PER-PANEL).                                   18330000
183400*                                                                 18340000
183500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18350000
183600         ADD +1         TO ASC-BLK-SUB                            18360000
183700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18370000
183800     END-IF.                                                      18380000
183900*                                                                 18390000
184000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18400000
184100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18410000
184200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18420000
184300     PERFORM 4420-FORMAT-LIST-LINES                               18430000
184400         VARYING PV-SUB                                           18440000
184500         FROM PC-ITEMS-PER-PANEL BY -1                            18450000
184600         UNTIL PV-SUB < +1.                                       18460000
184700*                                                                 18470000
184800     MOVE ASC-KEY-OPER-UNIT-ID     TO AOPERIDO.                   18480000
184900     MOVE ASC-KEY-FCLTY-ID         TO AFCLTYIO.                   18490000
185000     COMPUTE ASC-ITEMS-DISPLAYED =                                18500000
185100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18510000
185200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18520000
185300                                      ASTRTITO.                   18530000
185400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18540000
185500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18550000
185600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18560000
185700                                   TO ASELITO.                    18570000
185800*                                                                 18580000
185900     IF  DP020-MSG-NUMBER-X = SPACE                               18590000
186000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18600000
186100*            --- MORE ITEMS TO DISPLAY ----                       18610000
186200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18620000
186300             SET DP020-MSG-INFORMATIONAL TO TRUE                  18630000
186400         END-IF                                                   18640000
186500     END-IF.                                                      18650000
186600*----------------------------------------------------------------*18660000
186700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18670000
186800*----------------------------------------------------------------*18680000
186900                                                                  18690000
187000 4410-READ-TEMP-STORAGE.                                          18700000
187100                                                                  18710000
187200     EXEC CICS                                                    18720000
187300         READQ TS                                                 18730000
187400             QUEUE (ASC-LIST-QUEUE-NAME)                          18740000
187500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18750000
187600             ITEM  (PV-BLOCK-NUMBER)                              18760000
187700             RESP  (PV-CICS-RESP)                                 18770000
187800     END-EXEC.                                                    18780000
187900                                                                  18790000
188000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18800000
188100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18810000
188200         CONTINUE                                                 18820000
188300     ELSE                                                         18830000
188400         SET DP013-CICS-ABEND     TO TRUE                         18840000
188500         SET DP013-NO-ROLLBACK    TO TRUE                         18850000
188600         MOVE '4410-READ-TEMP-STORAGE'                            18860000
188700                                  TO DP013-PARAGRAPH              18870000
188800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18880000
188900                                  TO DP013-MESSAGE-TEXT(1)        18890000
189000         PERFORM DP013-0000-PROCESS-ABEND                         18900000
189100     END-IF.                                                      18910000
189200                                                                  18920000
189300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18930000
189400*                                                                 18940000
189500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18950000
189600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18960000
189700     END-IF.                                                      18970000
189800 EJECT                                                            18980000
189900*----------------------------------------------------------------*18990000
190000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19000000
190100*----------------------------------------------------------------*19010000
190200                                                                  19020000
190300 4420-FORMAT-LIST-LINES.                                          19030000
190400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19040000
190500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19050000
190600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19060000
190700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           19070000
190800                                    MR-ACTION (PV-SUB)            19080000
190900                                    MR-INSTR-DESC (PV-SUB)        19090000
191000                                    MR-PRC-FCLTY-AREA-ID          19100000
191100                                    (PV-SUB)                      19110000
191200     ELSE                                                         19120000
191300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19130000
191400                                                   > SPACE        19140000
191500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19150000
191600                                 TO MR-SELECTI (PV-SUB)           19160000
191700         ELSE                                                     19170000
191800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19180000
191900                                 TO MR-SELECTI (PV-SUB)           19190000
192000         END-IF                                                   19200000
192100*                                                                 19210000
192200         IF  DP030-SET-CURSOR-TRAILER                             19220000
192300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19230000
192400                 > SPACE)                                         19240000
192500               OR (PV-SUB = 1))                                   19250000
192600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19260000
192700                MOVE -1          TO MR-SELECTL (PV-SUB)           19270000
192800             END-IF                                               19280000
192900         END-IF                                                   19290000
193000*                                                                 19300000
193100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19310000
193200             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           19320000
193300                                 TO MR-ACTION (PV-SUB)            19330000
193400             MOVE ASC-INSTR-DESC (ASC-BLK-SUB ASC-ITEM-SUB)       19340000
193500                                 TO MR-INSTR-DESC (PV-SUB)        19350000
193600             MOVE ASC-PRC-FCLTY-AREA-ID (ASC-BLK-SUB ASC-ITEM-SUB)19360000
193700                                 TO MR-PRC-FCLTY-AREA-ID (PV-SUB) 19370000
193800         END-IF                                                   19380000
193900     END-IF.                                                      19390000
194000     SUBTRACT +1 FROM ASC-ITEM-SUB                                19400000
194100     IF  ASC-ITEM-SUB < + 1                                       19410000
194200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19420000
194300         MOVE +1                 TO ASC-BLK-SUB                   19430000
194400     END-IF.                                                      19440000
194500******************************************************************19450000
194600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19460000
194700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **19470000
194800** ISSUE A WARNING.                                             **19480000
194900******************************************************************19490000
195000 4430-CHECK-FOR-BEGIN-AND-END.                                    19500000
195100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19510000
195200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19520000
195300*            -- NO END-OF-RANGE SPECFIED ---                      19530000
195400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19540000
195500             SET DP020-MSG-WARNING TO TRUE                        19550000
195600             PERFORM 4431-POSITION-AT-WARNING                     19560000
195700         END-IF                                                   19570000
195800     ELSE                                                         19580000
195900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19590000
196000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19600000
196100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19610000
196200             SET DP020-MSG-WARNING TO TRUE                        19620000
196300             PERFORM 4431-POSITION-AT-WARNING                     19630000
196400         END-IF                                                   19640000
196500     END-IF.                                                      19650000
196600******************************************************************19660000
196700** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **19670000
196800** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **19680000
196900** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **19690000
197000** POSITION THE CURSOR THERE.                                   **19700000
197100******************************************************************19710000
197200 4431-POSITION-AT-WARNING.                                        19720000
197300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19730000
197400                    - PV-TOP-ITEM + 1.                            19740000
197500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19750000
197600         CONTINUE                                                 19760000
197700     ELSE                                                         19770000
197800         SET DP030-SET-CURSOR-APPL-1                              19780000
197900                                   TO TRUE                        19790000
198000         MOVE -1                   TO MR-SELECTL (PV-SUB)         19800000
198100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19810000
198200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19820000
198300     END-IF.                                                      19830000
198400*                                                                 19840000
198500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19850000
198600                    - PV-TOP-ITEM + 1.                            19860000
198700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19870000
198800         CONTINUE                                                 19880000
198900     ELSE                                                         19890000
199000         SET DP030-SET-CURSOR-APPL-1                              19900000
199100                                   TO TRUE                        19910000
199200         MOVE -1                   TO MR-SELECTL (PV-SUB)         19920000
199300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19930000
199400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19940000
199500     END-IF.                                                      19950000
199600 EJECT                                                            19960000
199700*----------------------------------------------------------------*19970000
199800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19980000
199900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19990000
200000* FOR THE SELECTED ITEMS QUEUE.                                  *20000000
200100*                                                                *20010000
200200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20020000
200300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20030000
200400* THE ARRAY IS FULL.                                             *20040000
200500*----------------------------------------------------------------*20050000
200600                                                                  20060000
200700 5000-PREPARE-SEL-QUEUE.                                          20070000
200800                                                                  20080000
200900     MOVE +1                   TO  ASC-BLK-SUB.                   20090000
201000     PERFORM 5100-WRITE-TEMP-STORAGE.                             20100000
201100     ADD +1                    TO  ASC-BLK-SUB.                   20110000
201200     PERFORM 5100-WRITE-TEMP-STORAGE.                             20120000
201300                                                                  20130000
201400     MOVE ASC-SEL-QUEUE-NAME   TO  PC000-FACILITY-QUEUE-NAME.     20140000
201500     PERFORM 6010-DELETE-SEL-QUEUE.                               20150000
201600                                                                  20160000
201700     SET ASC-UPDATE-TSQ        TO  TRUE.                          20170000
201800                                                                  20180000
201900     SET PC019-IDX             TO  1.                             20190000
202000     MOVE ZERO                 TO PC000-NUMBER-OF-TS-ITEMS.       20200000
202100     INITIALIZE PC019-SELECTED-ITEM-ARRAY.                        20210000
202200                                                                  20220000
202300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20230000
202400             VARYING PV-ITEM                                      20240000
202500             FROM 1 BY 1                                          20250000
202600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20260000
202700                                                                  20270000
202800     IF  PC019-IDX > 1                                            20280000
202900         PERFORM 5205-WRITE-SEL-QUEUE                             20290000
203000         ADD +1                TO PC000-NUMBER-OF-TS-ITEMS        20300000
203100     END-IF.                                                      20310000
203200 EJECT                                                            20320000
203300*----------------------------------------------------------------*20330000
203400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20340000
203500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20350000
203600*----------------------------------------------------------------*20360000
203700                                                                  20370000
203800 5100-WRITE-TEMP-STORAGE.                                         20380000
203900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20390000
204000                                   TO PV-LIST-ITEM-NUMBER.        20400000
204100     COMPUTE PV-BLOCK-NUMBER =                                    20410000
204200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20420000
204300                                                                  20430000
204400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20440000
204500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20450000
204600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20460000
204700             PERFORM 5105-REWRITE-ASC-LISTQ                       20470000
204800         END-IF                                                   20480000
204900     ELSE                                                         20490000
205000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20500000
205100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20510000
205200         PERFORM 5110-WRITE-ASC-LISTQ                             20520000
205300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20530000
205400     END-IF.                                                      20540000
205500                                                                  20550000
205600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20560000
205700******************************************************************20570000
205800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20580000
205900** SPECIFIC COMMAREA.                                           **20590000
206000******************************************************************20600000
206100 5105-REWRITE-ASC-LISTQ.                                          20610000
206200     EXEC CICS                                                    20620000
206300         WRITEQ TS                                                20630000
206400             QUEUE (ASC-LIST-QUEUE-NAME)                          20640000
206500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20650000
206600             ITEM  (PV-BLOCK-NUMBER)                              20660000
206700             REWRITE                                              20670000
206800             RESP  (PV-CICS-RESP)                                 20680000
206900     END-EXEC.                                                    20690000
207000                                                                  20700000
207100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20710000
207200         CONTINUE                                                 20720000
207300     ELSE                                                         20730000
207400         SET DP013-CICS-ABEND            TO TRUE                  20740000
207500         SET DP013-NO-ROLLBACK           TO TRUE                  20750000
207600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20760000
207700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20770000
207800                                         TO DP013-MESSAGE-TEXT(1) 20780000
207900         PERFORM DP013-0000-PROCESS-ABEND                         20790000
208000     END-IF.                                                      20800000
208100                                                                  20810000
208200******************************************************************20820000
208300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20830000
208400** SPECIFIC COMMAREA.                                           **20840000
208500******************************************************************20850000
208600 5110-WRITE-ASC-LISTQ.                                            20860000
208700     EXEC CICS                                                    20870000
208800         WRITEQ TS                                                20880000
208900             QUEUE (ASC-LIST-QUEUE-NAME)                          20890000
209000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20900000
209100             ITEM  (PV-BLOCK-NUMBER)                              20910000
209200             RESP  (PV-CICS-RESP)                                 20920000
209300     END-EXEC.                                                    20930000
209400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20940000
209500         SET DP013-CICS-ABEND      TO TRUE                        20950000
209600         SET DP013-NO-ROLLBACK     TO TRUE                        20960000
209700         MOVE '5110-WRITE-ASC-LISTQ'                              20970000
209800                                   TO DP013-PARAGRAPH             20980000
209900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20990000
210000                                   TO DP013-MESSAGE-TEXT(1)       21000000
210100         PERFORM DP013-0000-PROCESS-ABEND                         21010000
210200     END-IF.                                                      21020000
210300 EJECT                                                            21030000
210400*----------------------------------------------------------------*21040000
210500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21050000
210600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21060000
210700*----------------------------------------------------------------*21070000
210800                                                                  21080000
210900 5200-FILL-SEL-QUEUE-RECORD.                                      21090000
211000                                                                  21100000
211100     PERFORM 6112-READ-LIST-QUEUE.                                21110000
211200                                                                  21120000
211300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21130000
211400         PERFORM                                                  21140000
211500         VARYING LQW-IDX                                          21150000
211600         FROM 1 BY 1                                              21160000
211700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21170000
211800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21180000
211900                                                                  21190000
212000             IF  LQW-SELECT (LQW-IDX)                             21200000
212100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21210000
212200                                   TO PC019-ITEM (PC019-IDX)      21220000
212300                                                                  21230000
212400                 MOVE LQW-OPER-ID (LQW-IDX)           TO          21240000
212500                                   PC019-OPERATION-ID (PC019-IDX) 21250000
212600                 MOVE LQW-FCLTY-AREA-ID (LQW-IDX)     TO          21260000
212700                                  PC019-FCLTY-AREA-ID (PC019-IDX) 21270000
212800                 MOVE LQW-PRC-FCLTY-AREA-ID (LQW-IDX) TO          21280000
212900                              PC019-PRC-FCLTY-AREA-ID (PC019-IDX) 21290000
213000                 MOVE LQW-OPER-DESC (LQW-IDX)         TO          21300000
213100                                      PC019-OPER-DESC (PC019-IDX) 21310000
213200                                                                  21320000
213300                 MOVE SPACE        TO PC019-ACTION-SW (PC019-IDX) 21330000
213400                 SET PC019-IDX UP BY 1                            21340000
213500                 IF  PC019-IDX > PC019-MAX-ITEMS                  21350000
213600                     PERFORM 5205-WRITE-SEL-QUEUE                 21360000
213700                     ADD +1        TO PC000-NUMBER-OF-TS-ITEMS    21370000
213800                     INITIALIZE PC019-SELECTED-ITEM-ARRAY         21380000
213900                     SET PC019-IDX TO  1                          21390000
214000                 END-IF                                           21400000
214100             END-IF                                               21410000
214200         END-PERFORM                                              21420000
214300     END-IF.                                                      21430000
214400                                                                  21440000
214500*----------------------------------------------------------------*21450000
214600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21460000
214700*----------------------------------------------------------------*21470000
214800                                                                  21480000
214900 5205-WRITE-SEL-QUEUE.                                            21490000
215000                                                                  21500000
215100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21510000
215200                                   TO PC019-SELECTED-ITEMS.       21520000
215300     MOVE ASC-KEY-OPER-UNIT-ID     TO PC019-OPERATING-UNIT-ID.    21530000
215400     MOVE ASC-KEY-FCLTY-ID         TO PC019-FACILITY-ID.          21540000
215500                                                                  21550000
215600     EXEC CICS                                                    21560000
215700          WRITEQ TS                                               21570000
215800              QUEUE (ASC-SEL-QUEUE-NAME)                          21580000
215900              FROM  (PC019-MESSAGE-SEL-REC)                       21590000
216000              ITEM  (PV-SEL-QUEUE-ITEM)                           21600000
216100              RESP  (PV-CICS-RESP)                                21610000
216200     END-EXEC.                                                    21620000
216300                                                                  21630000
216400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21640000
216500         CONTINUE                                                 21650000
216600     ELSE                                                         21660000
216700         SET DP013-CICS-ABEND      TO TRUE                        21670000
216800         SET DP013-NO-ROLLBACK     TO TRUE                        21680000
216900         MOVE '5205-WRITE-SEL-QUEUE'                              21690000
217000                                   TO DP013-PARAGRAPH             21700000
217100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21710000
217200                                   TO DP013-MESSAGE-TEXT(1)       21720000
217300         PERFORM DP013-0000-PROCESS-ABEND                         21730000
217400     END-IF.                                                      21740000
217500 EJECT                                                            21750000
217600******************************************************************21760000
217700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21770000
217800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21780000
217900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21790000
218000** THE USER.                                                    **21800000
218100******************************************************************21810000
218200 6000-REFRESH-PANEL-FROM-TEMP.                                    21820000
218300     IF  ASC-UPDATE-TSQ                                           21830000
218400         SET ASC-NO-TSQ-UPDATE TO TRUE                            21840000
218500         MOVE ZERO                 TO PV-SAVE-ITEM                21850000
218600                                      PV-SEL-QUEUE-ITEM           21860000
218700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21870000
218800                                   TO PV-HOLD-SELECTED-ITEMS      21880000
218900         PERFORM 6100-UPDATE-TSQ                                  21890000
219000             UNTIL PV-ITEMS-PROCESSED >                           21900000
219100                                     ASC-NUMBER-OF-SELECTED-ITEMS 21910000
219200         PERFORM 6010-DELETE-SEL-QUEUE                            21920000
219300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21930000
219400                    ASC-BLOCK-ENTRIES (2)                         21940000
219500     END-IF.                                                      21950000
219600                                                                  21960000
219700*----------------------------------------------------------------*21970000
219800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21980000
219900*----------------------------------------------------------------*21990000
220000 6010-DELETE-SEL-QUEUE.                                           22000000
220100                                                                  22010000
220200     EXEC CICS                                                    22020000
220300         DELETEQ TS                                               22030000
220400             QUEUE (ASC-SEL-QUEUE-NAME)                           22040000
220500             RESP  (PV-CICS-RESP)                                 22050000
220600     END-EXEC.                                                    22060000
220700*                                                                 22070000
220800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22080000
220900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22090000
221000         CONTINUE                                                 22100000
221100     ELSE                                                         22110000
221200         SET DP013-CICS-ABEND TO TRUE                             22120000
221300         SET DP013-NO-ROLLBACK TO TRUE                            22130000
221400         MOVE '6010-DELETE-SEL-QUEUE'                             22140000
221500                        TO DP013-PARAGRAPH                        22150000
221600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22160000
221700                        TO DP013-MESSAGE-TEXT (1)                 22170000
221800         PERFORM DP013-0000-PROCESS-ABEND                         22180000
221900     END-IF.                                                      22190000
222000                                                                  22200000
222100*----------------------------------------------------------------*22210000
222200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22220000
222300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22230000
222400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22240000
222500*    THE TEMP QUEUE.                                             *22250000
222600*----------------------------------------------------------------*22260000
222700                                                                  22270000
222800 6100-UPDATE-TSQ.                                                 22280000
222900                                                                  22290000
223000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             22300000
223100     PERFORM 6105-READ-SEL-QUEUE.                                 22310000
223200     PERFORM                                                      22320000
223300         VARYING PC019-IDX                                        22330000
223400         FROM 1 BY 1                                              22340000
223500         UNTIL ((PV-ITEMS-PROCESSED >                             22350000
223600                              PV-HOLD-SELECTED-ITEMS)             22360000
223700         OR (PC019-IDX GREATER THAN PC019-MAX-ITEMS))             22370000
223800         IF  PC019-ACTION-SW (PC019-IDX) > SPACE                  22380000
223900             PERFORM 6110-PROCESS-ITEMS                           22390000
224000         END-IF                                                   22400000
224100         ADD +1                TO PV-ITEMS-PROCESSED              22410000
224200     END-PERFORM.                                                 22420000
224300     PERFORM 6111-WRITE-LIST-QUEUE.                               22430000
224400*----------------------------------------------------------------*22440000
224500*    READ THE LIST QUEUE RECORD.                                 *22450000
224600*----------------------------------------------------------------*22460000
224700                                                                  22470000
224800 6105-READ-SEL-QUEUE.                                             22480000
224900                                                                  22490000
225000     EXEC CICS                                                    22500000
225100          READQ TS                                                22510000
225200              QUEUE (ASC-SEL-QUEUE-NAME)                          22520000
225300              INTO  (PC019-MESSAGE-SEL-REC)                       22530000
225400              ITEM  (PV-SEL-QUEUE-ITEM)                           22540000
225500              RESP  (PV-CICS-RESP)                                22550000
225600     END-EXEC.                                                    22560000
225700*                                                                 22570000
225800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22580000
225900         CONTINUE                                                 22590000
226000     ELSE                                                         22600000
226100         SET DP013-CICS-ABEND      TO  TRUE                       22610000
226200         SET DP013-NO-ROLLBACK     TO  TRUE                       22620000
226300         MOVE '6105-READ-SEL-QUEUE'                               22630000
226400                                   TO  DP013-PARAGRAPH            22640000
226500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22650000
226600                                   TO  DP013-MESSAGE-TEXT(1)      22660000
226700         PERFORM DP013-0000-PROCESS-ABEND                         22670000
226800     END-IF.                                                      22680000
226900 EJECT                                                            22690000
227000*----------------------------------------------------------------*22700000
227100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22710000
227200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22720000
227300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22730000
227400*----------------------------------------------------------------*22740000
227500                                                                  22750000
227600 6110-PROCESS-ITEMS.                                              22760000
227700                                                                  22770000
227800     COMPUTE PV-ITEM = 1 + ((PC019-ITEM (PC019-IDX) - 1)          22780000
227900                     / PC-ITEMS-PER-PANEL).                       22790000
228000                                                                  22800000
228100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22810000
228200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22820000
228300             PERFORM 6111-WRITE-LIST-QUEUE                        22830000
228400         END-IF                                                   22840000
228500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22850000
228600                                                                  22860000
228700         PERFORM 6112-READ-LIST-QUEUE                             22870000
228800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22880000
228900             CONTINUE                                             22890000
229000         END-IF                                                   22900000
229100     END-IF.                                                      22910000
229200                                                                  22920000
229300     COMPUTE PV-SUB = (PC019-ITEM (PC019-IDX)                     22930000
229400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22940000
229500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         22950000
229600     MOVE LQW-SELECTED-SW (PV-SUB)                                22960000
229700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22970000
229800     EVALUATE TRUE                                                22980000
229900         WHEN PC019-INQ (PC019-IDX)                               22990000
230000              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23000000
230100                                                                  23010000
230200         WHEN PC019-UPD (PC019-IDX)                               23020000
230300              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             23030000
230400                                                                  23040000
230500         WHEN PC019-DEL (PC019-IDX)                               23050000
230600              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23060000
230700                                                                  23070000
230800         WHEN PC019-ERR (PC019-IDX)                               23080000
230900              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23090000
231000     END-EVALUATE.                                                23100000
231100                                                                  23110000
231200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23120000
231300                                                                  23130000
231400*----------------------------------------------------------------*23140000
231500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23150000
231600*----------------------------------------------------------------*23160000
231700                                                                  23170000
231800 6111-WRITE-LIST-QUEUE.                                           23180000
231900                                                                  23190000
232000     EXEC CICS                                                    23200000
232100         WRITEQ TS                                                23210000
232200             QUEUE (ASC-LIST-QUEUE-NAME)                          23220000
232300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23230000
232400             ITEM  (PV-SAVE-ITEM)                                 23240000
232500             REWRITE                                              23250000
232600             RESP  (PV-CICS-RESP)                                 23260000
232700     END-EXEC.                                                    23270000
232800*                                                                 23280000
232900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23290000
233000         CONTINUE                                                 23300000
233100     ELSE                                                         23310000
233200         SET DP013-CICS-ABEND  TO  TRUE                           23320000
233300         SET DP013-NO-ROLLBACK TO  TRUE                           23330000
233400         MOVE '6111-WRITE-LIST-QUEUE'                             23340000
233500                               TO  DP013-PARAGRAPH                23350000
233600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23360000
233700                               TO  DP013-MESSAGE-TEXT(1)          23370000
233800         PERFORM DP013-0000-PROCESS-ABEND                         23380000
233900     END-IF.                                                      23390000
234000                                                                  23400000
234100 EJECT                                                            23410000
234200*----------------------------------------------------------------*23420000
234300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23430000
234400*----------------------------------------------------------------*23440000
234500                                                                  23450000
234600 6112-READ-LIST-QUEUE.                                            23460000
234700                                                                  23470000
234800     EXEC CICS                                                    23480000
234900         READQ TS                                                 23490000
235000             QUEUE (ASC-LIST-QUEUE-NAME)                          23500000
235100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23510000
235200             ITEM  (PV-ITEM)                                      23520000
235300             RESP  (PV-CICS-RESP)                                 23530000
235400     END-EXEC.                                                    23540000
235500*                                                                 23550000
235600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23560000
235700         CONTINUE                                                 23570000
235800     ELSE                                                         23580000
235900         SET DP013-CICS-ABEND        TO TRUE                      23590000
236000         SET DP013-NO-ROLLBACK       TO TRUE                      23600000
236100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23610000
236200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23620000
236300                                     TO DP013-MESSAGE-TEXT(1)     23630000
236400         PERFORM DP013-0000-PROCESS-ABEND                         23640000
236500     END-IF.                                                      23650000
236600                                                                  23660000
236700 EJECT                                                            23670000
236800*----------------------------------------------------------------*23680000
236900*    ABEND PROCESSOR MODULE                                      *23690000
237000*----------------------------------------------------------------*23700000
237100                                                                  23710000
237200     COPY DPPD013.                                                23720000
