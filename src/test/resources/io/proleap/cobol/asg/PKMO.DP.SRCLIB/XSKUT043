000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.               XSKUT043.                              00020032
000300 AUTHOR.                   BRAD GROCHOWSKI.                       00030032
000400 INSTALLATION.             KOHLS DEPARTMENT STORES.               00040000
000500 DATE-WRITTEN.             DEC 14, 2002.                          00050032
000600 DATE-COMPILED.                                                   00060000
000700*----------------------------------------------------------------*00070000
000800*     EXTRACT OF XST_LOC AND XST_LOC_DIST DATA TO A FILE         *00080032
000900*----------------------------------------------------------------*00090000
001000*----------------------------------------------------------------*00100000
001100*  PROGRAM NARRATIVE:                                            *00110000
001200*                                                                *00120000
001300*   PROGRAM WRITES XST_LOC AND XST_LOC_DIST DATA TO A FILE       *00130032
001400*   TO BE USED IN XSKRP001 THAT COMPARES WHAT WAS LOADED         *00140032
001500*   IN THE TABLES TO THE END-OF-DAY RMS EXTRACT.                 *00150032
001600*----------------------------------------------------------------*00160000
001700*                                                                *00170000
001800*  CHANGES: NAME              -  DATE                            *00180032
001900*       DESCRIPTION                                              *00190032
002000*----------------------------------------------------------------*00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300                                                                  00230000
002400 CONFIGURATION SECTION.                                           00240000
002500                                                                  00250000
002600 SOURCE-COMPUTER.    IBM-3090.                                    00260000
002700 OBJECT-COMPUTER.    IBM-3090.                                    00270000
002800                                                                  00280000
002900                                                                  00290000
003000 INPUT-OUTPUT SECTION.                                            00300000
003100                                                                  00310000
003200 FILE-CONTROL.                                                    00320000
003300                                                                  00330000
003400     SELECT XST-OUTPUT-FILE            ASSIGN TO OUT01.           00340032
003500     EJECT                                                        00350000
003600                                                                  00360000
003700 DATA DIVISION.                                                   00370000
003800                                                                  00380000
003900 FILE SECTION.                                                    00390000
004000                                                                  00400000
004100 FD  XST-OUTPUT-FILE                                              00410032
004200     RECORDING MODE IS F                                          00420000
004300     BLOCK CONTAINS 0                                             00430000
004400     LABEL RECORDS ARE STANDARD.                                  00440000
004500 01  XST-OUTPUT-RECORD                PIC X(668).                 00450032
004600                                                                  00460000
004700                                                                  00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900                                                                  00490000
005000 01  FILLER                           PIC X(32)  VALUE            00500000
005100     'XSKUT043 WORKING STORAGE BEGINS:'.                          00510032
005200                                                                  00520000
005300 01  PC-PROGRAM-CONSTANTS.                                        00530000
005400                                                                  00540000
005500*        -- MISCELLANEOUS CONSTANTS/LITERALS --                   00550000
005600                                                                  00560000
005700     05  PC-PROGRAM-NUMBER            PIC X(08)      VALUE        00570000
005800         'XSKUT043'.                                              00580032
005900     05  PC-ABEND-MSSG                PIC X(12)      VALUE        00590006
006000         '** ABEND ** '.                                          00600006
006100     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        00610006
006200         'DB2 ERROR'.                                             00620006
006300     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)      VALUE        00630006
006400         'ATTEMPTING TO '.                                        00640006
006500     05  PC-DEFAULT-DTE               PIC X(10)      VALUE        00650043
006600         '9999-09-09'.                                            00660043
006700     05  PC-DEFAULT-ZERO              PIC  S9(4)V COMP-3 VALUE    00670043
006800         ZEROS.                                                   00680043
006801     05  PC-DEFAULT-SPACE             PIC X(01)      VALUE SPACES.00680143
006802                                                                  00680206
006803 01  PS-PROCESS-SWITCHES.                                         00680300
006804     05  PS-TRANSACTION-DETAIL-SW     PIC X(01)      VALUE 'N'.   00680400
006805         88  PS-NOT-END-OF-TRANS-DETAIL              VALUE 'N'.   00680500
006900         88  PS-END-OF-TRANSACTION-DETAIL            VALUE 'Y'.   00690000
007000                                                                  00700000
007100     EJECT                                                        00710000
007200                                                                  00720000
007300 01  PV-PROGRAM-VARIABLES.                                        00730000
007400     05  PV-SUB                       PIC S9(04)     COMP.        00740000
007500     05  PV-PARAGRAPH-NAME            PIC X(50)      VALUE SPACES.00750004
007600     05  PV-DB2-ERROR-MSSG            PIC X(50)      VALUE SPACES.00760004
007700                                                                  00770000
007800 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 00780000
007900     88  ABEND-4003-INVALID-CC-DATE                  VALUE +4003. 00790000
008000     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00800000
008100     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00810000
008200     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00820000
008300*----------------------------------------------------------------*00830000
008400*    STANDARD FILE LAYOUT FOR THE LOCATION TABLE FILE            *00840032
008500*----------------------------------------------------------------*00850000
008600     COPY HORD007.                                                00860032
008700*----------------------------------------------------------------*00870000
008800*    STANDARD DB2 ERROR HANDLING AREA                            *00880000
008900*----------------------------------------------------------------*00890000
009000     COPY DPWS004.                                                00900000
009100*----------------------------------------------------------------*00910000
009200*    STANDARD DB2 DCLGEN FOR THE LOCATION TABLE (XST_LOC)        *00920032
009300*----------------------------------------------------------------*00930000
009400     EXEC SQL                                                     00940000
009500         INCLUDE XST00001                                         00950032
009600     END-EXEC.                                                    00960000
009700*----------------------------------------------------------------*00970017
009800*    STANDARD DB2 DCLGEN FOR THE DISTRICT TABLE (XST_LOC_DIST)   *00980032
009900*----------------------------------------------------------------*00990017
010000     EXEC SQL                                                     01000017
010100         INCLUDE XST00002                                         01010032
010200     END-EXEC.                                                    01020017
010300*----------------------------------------------------------------*01030000
010400*    STANDARD DB2 COMMUNICATIONS AREA                            *01040000
010500*----------------------------------------------------------------*01050000
010600     EXEC SQL                                                     01060000
010700         INCLUDE SQLCA                                            01070000
010800     END-EXEC.                                                    01080000
010900*----------------------------------------------------------------*01090000
011000*    CURSOR DECLARE - LOCATION EXTRACT CSR                       *01100032
011100*----------------------------------------------------------------*01110000
011200**************************************************************    01120043
011300* IF A DATE FIELDS ARE NULL, FILL IN WITH DEFAULT DATE OF         01130043
011400* 9999-09-09. IF ANY OTHER FIELDS ARE NULL, FILL IN WITH          01140043
011500* EITHER ZEROS OR SPACES.                                         01150043
011501**************************************************************    01150143
011502     EXEC SQL                                                     01150200
011503         DECLARE LOC-EXTR-CSR CURSOR FOR                          01150332
011504                                                                  01150400
011505         SELECT  LOC.LOC_NBR                                      01150532
011506              ,  COALESCE(LOC.REPLT_STR_NBR, :PC-DEFAULT-ZERO)    01150643
011700              ,  DIST.DIST_NBR                                    01170032
011800              ,  LOC.LOC_TYP_CDE                                  01180032
011900              ,  LOC.LOC_NM                                       01190032
012000              ,  LOC.LOC_5_ABBR_NM                                01200032
012100              ,  LOC.LNE_1_ADDR                                   01210032
012200              ,  LOC.LNE_2_ADDR                                   01220032
012300              ,  LOC.CTY_NM                                       01230032
012400              ,  LOC.ST_CDE                                       01240032
012500              ,  LOC.ZIP_10_CDE                                   01250032
012600              ,  LOC.OPN_DTE                                      01260032
012700              ,  LOC.CLO_DTE                                      01270032
012800              ,  COALESCE(LOC.LOC_10_ABBR_NM, :PC-DEFAULT-SPACE)  01280043
012900              ,  COALESCE(LOC.PHN_NBR, :PC-DEFAULT-SPACE)         01290043
013000              ,  COALESCE(LOC.MGR_NM, :PC-DEFAULT-SPACE)          01300043
013100              ,  COALESCE(LOC.FINCL_CLO_DTE, :PC-DEFAULT-DTE)     01310043
013200              ,  COALESCE(LOC.MN_SLS_INCL_DTE, :PC-DEFAULT-DTE)   01320043
013300              ,  COALESCE(LOC.YR_SLS_INCL_DTE, :PC-DEFAULT-DTE)   01330043
013400              ,  COALESCE(LOC.OCPNC_DTE, :PC-DEFAULT-DTE)         01340043
013500              ,  COALESCE(LOC.DST_IND, :PC-DEFAULT-SPACE)         01350043
013600              ,  COALESCE(LOC.E_BUS_IND, :PC-DEFAULT-SPACE)       01360043
013700              ,  COALESCE(LOC.FMT_CDE, :PC-DEFAULT-ZERO)          01370043
013800              ,  COALESCE(LOC.STD_TM_ZN_CDE, :PC-DEFAULT-SPACE)   01380043
013900              ,  COALESCE(LOC.SLS_INCL_DTE_CDE, :PC-DEFAULT-SPACE)01390043
014000              ,  COALESCE(LOC.QTR_SLS_INCL_DTE, :PC-DEFAULT-DTE)  01400043
014001              ,  COALESCE(LOC.SEA_SLS_INCL_DTE, :PC-DEFAULT-DTE)  01400143
014002         FROM XST_LOC LOC                                         01400232
014100         JOIN XST_LOC_DIST DIST                                   01410032
014200           ON LOC.LOC_NBR = DIST.LOC_NBR                          01420032
014300         WHERE LOC.LOC_TYP_CDE = 'DS'                             01430032
014310           AND DIST.END_DTE IS NULL                               01431043
014400                                                                  01440032
014500         UNION ALL                                                01450032
014600                                                                  01460032
014700         SELECT  LOC.LOC_NBR                                      01470032
014800              ,  COALESCE(LOC.REPLT_STR_NBR, :PC-DEFAULT-ZERO)    01480032
014900              ,  0                                                01490032
015000              ,  LOC.LOC_TYP_CDE                                  01500032
015100              ,  LOC.LOC_NM                                       01510032
015200              ,  LOC.LOC_5_ABBR_NM                                01520032
015300              ,  LOC.LNE_1_ADDR                                   01530032
015400              ,  LOC.LNE_2_ADDR                                   01540032
015500              ,  LOC.CTY_NM                                       01550032
015600              ,  LOC.ST_CDE                                       01560032
015700              ,  LOC.ZIP_10_CDE                                   01570032
015800              ,  LOC.OPN_DTE                                      01580032
015900              ,  LOC.CLO_DTE                                      01590032
016000              ,  COALESCE(LOC.LOC_10_ABBR_NM, :PC-DEFAULT-SPACE)  01600032
016100              ,  COALESCE(LOC.PHN_NBR, :PC-DEFAULT-SPACE)         01610032
016200              ,  COALESCE(LOC.MGR_NM, :PC-DEFAULT-SPACE)          01620032
016300              ,  COALESCE(LOC.FINCL_CLO_DTE, :PC-DEFAULT-DTE)     01630043
016400              ,  COALESCE(LOC.MN_SLS_INCL_DTE, :PC-DEFAULT-DTE)   01640043
016500              ,  COALESCE(LOC.YR_SLS_INCL_DTE, :PC-DEFAULT-DTE)   01650043
016600              ,  COALESCE(LOC.OCPNC_DTE, :PC-DEFAULT-DTE)         01660043
016700              ,  COALESCE(LOC.DST_IND, :PC-DEFAULT-SPACE)         01670032
016800              ,  COALESCE(LOC.E_BUS_IND, :PC-DEFAULT-SPACE)       01680032
016900              ,  COALESCE(LOC.FMT_CDE, :PC-DEFAULT-ZERO)          01690032
017000              ,  COALESCE(LOC.STD_TM_ZN_CDE, :PC-DEFAULT-SPACE)   01700032
017100              ,  COALESCE(LOC.SLS_INCL_DTE_CDE, :PC-DEFAULT-SPACE)01710032
017200              ,  COALESCE(LOC.QTR_SLS_INCL_DTE, :PC-DEFAULT-DTE)  01720043
017201              ,  COALESCE(LOC.SEA_SLS_INCL_DTE, :PC-DEFAULT-DTE)  01720143
017202         FROM XST_LOC LOC                                         01720232
017300         WHERE LOC.LOC_TYP_CDE <> 'DS'                            01730032
017400                                                                  01740032
017500         ORDER BY 1                                               01750032
017600         WITH UR                                                  01760000
017700     END-EXEC.                                                    01770000
017800*----------------------------------------------------------------*01780000
017900 PROCEDURE DIVISION.                                              01790000
018000*----------------------------------------------------------------*01800000
018100                                                                  01810000
018200     OPEN OUTPUT XST-OUTPUT-FILE.                                 01820032
018300                                                                  01830000
018400     PERFORM 1000-OPEN-LOC-EXTR-CSR.                              01840032
018500                                                                  01850000
018600     INITIALIZE HO007-LOCATION-DATA.                              01860032
018700                                                                  01870032
018800     PERFORM 1050-FETCH-LOC-EXTR-CSR.                             01880032
018900                                                                  01890000
019000     PERFORM 2000-PROCESS                                         01900000
019100         UNTIL PS-END-OF-TRANSACTION-DETAIL.                      01910000
019200                                                                  01920000
019300     PERFORM 1070-CLOSE-LOC-EXTR-CSR.                             01930032
019400                                                                  01940000
019500     CLOSE XST-OUTPUT-FILE.                                       01950032
019600                                                                  01960000
019700     GOBACK.                                                      01970000
019800*----------------------------------------------------------------*01980000
019900*   OPEN THE LOCATION EXTRACT CURSOR                             *01990032
020000*----------------------------------------------------------------*02000000
020100 1000-OPEN-LOC-EXTR-CSR.                                          02010032
020200                                                                  02020000
020300     EXEC SQL                                                     02030000
020400         OPEN LOC-EXTR-CSR                                        02040032
020500     END-EXEC.                                                    02050000
020600                                                                  02060000
020700     EVALUATE TRUE                                                02070000
020800       WHEN SQLCODE NOT = 0                                       02080000
020900       WHEN SQLWARN0    = 'W'                                     02090000
021000         MOVE '1000-OPEN-LOC-EXTR-CSR '                           02100032
021100                           TO PV-PARAGRAPH-NAME                   02110000
021200         MOVE 'OPEN LOCATION EXTRACT CURSOR ERROR.'               02120032
021300                           TO PV-DB2-ERROR-MSSG                   02130000
021400         PERFORM 9400-DB2-ERROR                                   02140000
021500     END-EVALUATE.                                                02150000
021600                                                                  02160000
021700*----------------------------------------------------------------*02170000
021800*   FETCH DATA FROM THE LOCATION EXTRACT CURSOR                  *02180032
021900*----------------------------------------------------------------*02190000
022000 1050-FETCH-LOC-EXTR-CSR.                                         02200032
022100                                                                  02210000
022200     EXEC SQL                                                     02220000
022300         FETCH LOC-EXTR-CSR                                       02230032
022400           INTO :XST00001-LOC-NBR                                 02240033
022500              , :XST00001-REPLT-STR-NBR                           02250033
022600              , :XST00002-DIST-NBR                                02260033
022700              , :HO007-LOC-TYP-CDE                                02270032
022800              , :HO007-LOC-NM                                     02280032
022900              , :HO007-LOC-5-ABBR-NM                              02290032
023000              , :HO007-LOC-LNE-1-ADDR                             02300032
023100              , :HO007-LOC-LNE-2-ADDR                             02310032
023200              , :HO007-LOC-CITY                                   02320032
023300              , :HO007-LOC-ST-CDE                                 02330032
023400              , :HO007-LOC-ZIP-10-CDE                             02340032
023500              , :HO007-LOC-OPEN-DATE                              02350032
023600              , :HO007-LOC-CLOSE-DATE                             02360032
023700              , :HO007-LOC-LOC-10-ABBR-NM                         02370032
023800              , :HO007-LOC-PHONE-NUMBER                           02380032
023900              , :HO007-LOC-MGR-NM                                 02390032
024000              , :HO007-LOC-FINCL-CLO-DTE                          02400032
024100              , :HO007-LOC-MN-SLS-INCL-DTE                        02410032
024200              , :HO007-LOC-YR-SLS-INCL-DTE                        02420032
024300              , :HO007-LOC-OCPNC-DTE                              02430032
024400              , :HO007-LOC-DST-IND                                02440032
024500              , :HO007-LOC-E-BUS-IND                              02450032
024600              , :XST00001-FMT-CDE                                 02460033
024700              , :HO007-LOC-STD-TM-ZN-CDE                          02470032
024800              , :HO007-LOC-SLS-INCL-DTE-CDE                       02480032
024810              , :HO007-LOC-QTR-SLS-INCL-DTE                       02481045
024820              , :HO007-LOC-SEA-SLS-INCL-DTE                       02482045
024900     END-EXEC.                                                    02490032
025000                                                                  02500000
025100     EVALUATE TRUE                                                02510000
025200         WHEN SQLCODE = +0                                        02520000
025300           CONTINUE                                               02530000
025400         WHEN SQLCODE = +100                                      02540000
025500           SET PS-END-OF-TRANSACTION-DETAIL TO TRUE               02550000
025600         WHEN OTHER                                               02560000
025700             MOVE '1050-FETCH-LOC-EXTR-CURSOR'                    02570032
025800                               TO PV-PARAGRAPH-NAME               02580000
025900             MOVE 'FETCH FROM LOCATION EXTRACT CURSOR ERROR.'     02590032
026000                               TO PV-DB2-ERROR-MSSG               02600000
026100             PERFORM 9400-DB2-ERROR                               02610000
026200     END-EVALUATE.                                                02620000
026300                                                                  02630043
026310     MOVE XST00001-LOC-NBR       TO HO007-LOC-NBR.                02631043
026400     MOVE XST00001-REPLT-STR-NBR TO HO007-LOC-REPLT-STR-NBR.      02640033
026500     IF XST00002-DIST-NBR > 0                                     02650033
026600        MOVE XST00002-DIST-NBR   TO HO007-LOC-DIST-NBR            02660043
026700     END-IF.                                                      02670033
026800     MOVE XST00001-FMT-CDE       TO HO007-LOC-FMT-CDE.            02680043
026900                                                                  02690000
027000*----------------------------------------------------------------*02700000
027100*   CLOSE THE LOCATION EXTRACT CSR                               *02710032
027200*----------------------------------------------------------------*02720000
027300 1070-CLOSE-LOC-EXTR-CSR.                                         02730032
027400     EXEC SQL                                                     02740000
027500       CLOSE LOC-EXTR-CSR                                         02750032
027600     END-EXEC.                                                    02760000
027700                                                                  02770000
027800     EVALUATE TRUE                                                02780000
027900       WHEN SQLCODE NOT = 0                                       02790000
028000       WHEN SQLWARN0    = 'W'                                     02800000
028100           MOVE '1070-CLOSE-LOC-EXTR-CSR'                         02810032
028200                             TO PV-PARAGRAPH-NAME                 02820000
028300           MOVE 'CLOSE FAILED FOR LOCATION EXTRACT CURSOR'        02830032
028400                             TO PV-DB2-ERROR-MSSG                 02840000
028500           PERFORM 9400-DB2-ERROR                                 02850000
028600     END-EVALUATE.                                                02860000
028700                                                                  02870000
028800*----------------------------------------------------------------*02880000
028900* PROCESS  :  FETCH RECORDS AND WRITE TO EXTRACT FILE            *02890032
029000*----------------------------------------------------------------*02900000
029100 2000-PROCESS.                                                    02910000
029200                                                                  02920000
029300     PERFORM 3000-WRITE-LOCATION-FILE.                            02930032
029400                                                                  02940000
029500     INITIALIZE HO007-LOCATION-DATA.                              02950032
029600                                                                  02960032
029700     PERFORM 1050-FETCH-LOC-EXTR-CSR.                             02970032
029800                                                                  02980000
029900*----------------------------------------------------------------*02990000
030000* WRITE-LOCATION-FILE                                            *03000032
030100*----------------------------------------------------------------*03010000
030200 3000-WRITE-LOCATION-FILE.                                        03020032
030300                                                                  03030000
030400     WRITE XST-OUTPUT-RECORD     FROM HORD007-RECORD.             03040032
030500                                                                  03050000
030600                                                                  03060000
030700*----------------------------------------------------------------*03070000
030800*    DB2 ERROR                                                   *03080000
030900*      PERFORMED ONLY VIA (1000-OPEN-LOC-EXTR-CSR )              *03090032
031000*                     VIA (1050-FETCH-LOC-EXTR-CSR)              *03100032
031100*                     VIA (1070-CLOSE-LOC-EXTR-CSR)              *03110032
031200*    FUNCTION: HANDLE DB2 ERRORS                                 *03120000
031300*----------------------------------------------------------------*03130000
031400 9400-DB2-ERROR.                                                  03140000
031500                                                                  03150000
031600     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER.                    03160000
031700     DISPLAY PC-DB-ERROR-PREFIX                                   03170000
031800     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             03180000
031900     COPY DPPD004.                                                03190000
032000     SET ABEND-4013-DB2-ERROR TO TRUE.                            03200000
032100     CALL 'ILBOABN0' USING ABEND-CODE.                            03210000
032200     EJECT                                                        03220000
