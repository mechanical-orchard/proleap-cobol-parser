000100 IDENTIFICATION DIVISION.                                         00010007
000200 TITLE 'CREATE RCRD009 ADJUSTMENT FILE'.                          00020055
000300 PROGRAM-ID.    RCKUT039.                                         00060004
000400 AUTHOR.        DENNIS STEFFEN - OMNI RESOURCES.                  00070001
000500 DATE-WRITTEN.  MARCH 1996.                                       00080004
000600                                                                  00090055
000700****************************************************************  00100055
000800*    PROGRAM TAKES THE VERIFIED RECEIPT ADJUSTMENT FILE AND    *  00110055
000900*    USES IT TO DRIVE THE COLLECTION OF DATA FROM VARIOUS      *  00120055
001000*    TABLES TO BUILD THE STORE AND KEYREC ADJUSTMENT FILES.    *  00130055
001100*                                                              *  00140055
001200*    CREATES RCRD009 ADJUSTMENT FILE.                          *  00150055
001300*                                                              *  00160055
001400****************************************************************  00170055
001500                                                                  00170155
001600 ENVIRONMENT DIVISION.                                            00170204
001700 INPUT-OUTPUT SECTION.                                            00170304
001800                                                                  00170404
001900 FILE-CONTROL.                                                    00170504
002000     SELECT RECEIPT-AUDIT-SUM-FILE ASSIGN TO IN01.                00170607
002100     SELECT UPDATED-AUDIT-SUM-FILE ASSIGN TO OUT01.               00170707
002200     SELECT RC009-FILE             ASSIGN TO OUT02.               00170807
002300                                                                  00170907
002400 DATA DIVISION.                                                   00171004
002500                                                                  00180004
002600 FILE SECTION.                                                    00190004
002700                                                                  00200007
002800 FD  RECEIPT-AUDIT-SUM-FILE                                       00210007
002900     RECORDING MODE IS F                                          00220007
003000     LABEL RECORDS ARE STANDARD                                   00230007
003100     BLOCK CONTAINS 0 RECORDS.                                    00240007
003200                                                                  00250007
003300 01  RECEIPT-AUDIT-SUM-RECORD  PIC  X(135).                       00260007
003400*                                                                 00270007
003500 FD  UPDATED-AUDIT-SUM-FILE                                       00280007
003600     RECORDING MODE IS F                                          00290007
003700     LABEL RECORDS ARE STANDARD                                   00300007
003800     BLOCK CONTAINS 0 RECORDS.                                    00310007
003900                                                                  00320007
004000 01  UPDATED-AUDIT-SUM-RECORD  PIC  X(135).                       00330007
004100*                                                                 00340007
004200 FD  RC009-FILE                                                   00350007
004300     RECORDING MODE IS F                                          00360007
004400     LABEL RECORDS ARE STANDARD                                   00370007
004500     BLOCK CONTAINS 0 RECORDS.                                    00380007
004600 01  RC009-RECORD  PIC  X(189).                                   00390007
004700/                                                                 00400004
004800 WORKING-STORAGE SECTION.                                         00410004
004900                                                                  00420004
005000 01  PV-ABEND-CODE                    PIC S9(04)   VALUE +0       00430004
005100                                                   COMP SYNC.     00440004
005200*                                                                 00450004
005300 01  PS-PROGRAM-SWITCHES.                                         00460004
005400     05  PS-SUMMARY-EOF-SW            PIC X(01)  VALUE 'N'.       00470004
005500         88  PS-EOF-SUMMARY-FILE                 VALUE 'Y'.       00480004
005600     05  PS-CONTROL-BREAK-SW          PIC X(01)  VALUE 'Y'.       00490004
005700         88  PS-CONTROL-BREAK                    VALUE 'Y'.       00500007
005800         88  PS-NO-CONTROL-BREAK                 VALUE 'N'.       00510007
005900     05  PS-TWKORIN-CURSOR-SW         PIC X(01)  VALUE 'N'.       00520004
006000         88  PS-EOF-TWKORIN-CSR                  VALUE 'Y'.       00530004
006100     05  PS-TWKORIN-ZERO-SW           PIC X(01)  VALUE 'N'.       00540004
006200         88  PS-EOF-TWKORIN-ZERO                 VALUE 'Y'.       00550004
006300     05  PS-XLT-LOC-CURSOR-SW         PIC X(01)  VALUE 'N'.       00560055
006400         88  PS-EOF-XLT-LOC-CSR                  VALUE 'Y'.       00560155
006500     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00560204
006600         88  PS-NO-ERROR                         VALUE 'N'.       00570004
006700         88  PS-ERROR                            VALUE 'Y'.       00580004
006800                                                                  00590004
006900 01  PV-COUNTERS COMP-3.                                          00600007
007000     05  PV-RECS-READ-COUNTER         PIC S9(7) VALUE ZERO.       00610007
007100     05  PV-SUMM-RECS-WRITTEN         PIC S9(7) VALUE ZERO.       00620007
007200     05  PV-RC09-RECS-WRITTEN         PIC S9(7) VALUE ZERO.       00630007
007300 01  PV-DB2-KEYS.                                                 00640007
007400     05  DK-ORD-NBR                   PIC S9(09)  COMP.           00650004
007500     05  DK-REC-SEQ-NBR               PIC S9(09)  COMP.           00660004
007600     05  DK-ORD-LNE-NBR               PIC S9(09)  COMP.           00670004
007700     05  DK-SHORT-LNE-NBR             PIC S9(04)  COMP.           00680055
007800     05  DK-OPER-UNT-ID               PIC S9(04)  COMP.           00890004
007900     05  DK-DEPT                      PIC  X(03).                 00890155
008000                                                                  00890207
008100 01  PV-PROGRAM-VARIABLES.                                        00890304
008200     05  PV-DISPLAY-NUMBER            PIC Z(8)9.                  00890407
008300     05  PV-RCVR-NBR                  PIC  9(09).                 00890504
008400     05  PV-RCVR-NBR-R REDEFINES PV-RCVR-NBR.                     00890604
008500         10  FILLER                   PIC  X(01).                 00890704
008600         10  PV-RCVR-KEYREC           PIC  X(08).                 00890804
008700     05  PV-UNT-ID-N                  PIC 9(3) VALUE ZERO.        00890955
008800     05  PV-UNT-ID-X REDEFINES PV-UNT-ID-N                        00891055
008900                                      PIC X(3).                   00892055
009000     05  PV-UNT-ID-N-4                PIC 9(4) VALUE ZERO.        00893055
009100     05  PV-UNT-ID-X-4 REDEFINES PV-UNT-ID-N-4                    00894055
009200                                      PIC X(4).                   00894155
009300     05  PV-COMPARE-KEY.                                          00894207
009400         10  PV-COMPARE-ORD-NBR       PIC 9(09) VALUE ZERO.       00894307
009500         10  PV-COMPARE-REQ-SEQ-NBR   PIC 9(09) VALUE ZERO.       00894407
009600         10  PV-COMPARE-ORD-LNE-NBR   PIC 9(04) VALUE ZERO.       00894507
009700     05  PV-PREV-KEY.                                             00894607
009800         10  PV-PREV-ORD-NBR          PIC 9(09) VALUE ZERO.       00894707
009900         10  PV-PREV-REQ-SEQ-NBR      PIC 9(09) VALUE ZERO.       00894807
010000         10  PV-PREV-ORD-LNE-NBR      PIC 9(04) VALUE ZERO.       00894907
010100                                                                  00895055
010200     05  PV-VERFYD-DATE.                                          00896055
010300         10  PV-VERFYD-YYYY           PIC X(04)   VALUE SPACES.   00897055
010400         10  PV-VERFYD-MM             PIC X(02)   VALUE SPACES.   00898055
010500         10  PV-VERFYD-DD             PIC X(02)   VALUE SPACES.   00898155
010600                                                                  00898207
010700     05  PV-PRC-FCLTY-AREA-ID         PIC  X(06)  VALUE SPACES.   00920004
010800     05  PV-PURCHS-ENT-ID             PIC S9(09)  COMP.           00930004
010900     05  PV-CLASS-NMBR.                                           00970004
011000         10  PV-CLASS1                PIC  X(02).                 00980004
011100         10  PV-CLASS3                PIC  9(01).                 00990004
011200                                                                  01070012
011300     05  PV-YYYY-MM-DD                PIC X(10).                  07180004
011400     05  PV-VER-TMST                  PIC  X(26).                 07190055
011500     05  PV-VERIFIED-DATER REDEFINES PV-VER-TMST.                 07200055
011600         10  FILLER                   PIC  X(02).                 07210055
011700         10  PV-VER-YY                PIC  X(02).                 07220055
011800         10  FILLER                   PIC  X(01).                 07230055
011900         10  PV-VER-MM                PIC  X(02).                 07240055
012000         10  FILLER                   PIC  X(01).                 07250055
012100         10  PV-VER-DD                PIC  X(02).                 07260055
012200         10  FILLER                   PIC  X(16).                 07260155
012300     05  PV-VER-DATE.                                             07260204
012400         10  PV-DV-MM                 PIC  9(02).                 07260304
012500         10  PV-DV-DD                 PIC  9(02).                 07260404
012600         10  PV-DV-YY                 PIC  9(02).                 07260504
012700                                                                  07260612
012800     05  PV-REC-TMST                  PIC  X(26).                 07260704
012900     05  PV-REC-TMSTR REDEFINES PV-REC-TMST.                      07260804
013000         10  FILLER                   PIC  X(02).                 07260904
013100         10  PV-REC-YY                PIC  X(02).                 07261004
013200         10  FILLER                   PIC  X(01).                 07261104
013300         10  PV-REC-MM                PIC  X(02).                 07261204
013400         10  FILLER                   PIC  X(01).                 07261304
013500         10  PV-REC-DD                PIC  X(02).                 07261404
013600         10  FILLER                   PIC  X(16).                 07261504
013700     05  PV-REC-DATE.                                             07261604
013800         10  PV-DR-MM                 PIC  9(02).                 07261704
013900         10  PV-DR-DD                 PIC  9(02).                 07261804
014000         10  PV-DR-YY                 PIC  9(02).                 07261904
014100     05  PV-DIVISION-SEQNO.                                       07262004
014200         10  PV-DIV-ZERO              PIC  X(01).                 07262104
014300         10  PV-DIV-SEQNO             PIC  X(02).                 07262204
014400     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.   07262304
014500     05  PV-ERROR-MESSAGE-1           PIC  X(60)  VALUE SPACES.   07262404
014600     05  PV-ERROR-MESSAGE-2           PIC  X(60)  VALUE SPACES.   07262504
014700     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       07262604
014800 01  PV-ERROR-RECORD.                                             07262704
014900     05  PV-ERROR-PO                  PIC 9(08)  VALUE ZEROES.    07262804
015000     05  FILLER                       PIC X(01)  VALUE SPACES.    07262904
015100     05  PV-ERROR-REC-SEQ             PIC 9(09)  VALUE ZEROES.    07263004
015200     05  FILLER                       PIC X(01)  VALUE SPACES.    07263104
015300     05  PV-ERROR-PARA                PIC X(50)  VALUE SPACES.    07263204
015400     05  FILLER                       PIC X(11)  VALUE SPACES.    07263304
015500                                                                  07263404
015600 01  PC-PROGRAM-CONSTANTS.                                        07263504
015700     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUT039'.07263604
015800     05  PC-DEFAULT-DATE              PIC X(26)   VALUE           07263704
015900                                   '9999-09-09-09.09.09.999999'.  07263804
016000     05  PC-MPS-PROGRAM-NAME         PIC  X(08)    VALUE          07263904
016100         'DPKUT039'.                                              07264004
016200     05  PC-CURRENT-OPERATING-COMPANY                             07264104
016300                                     PIC  X(02)    VALUE '03'.    07264204
016400     05  PC-SYSTEM-CODE              PIC  X(02)    VALUE 'MP'.    07264304
016500     05  PC-DC                       PIC  X(02)    VALUE 'DC'.    07264404
016600     05  PC-A                        PIC  X(01)    VALUE 'A'.     07264504
016700     05  PC-2                        PIC  X(01)    VALUE '2'.     07264604
016800     05  PC-ONE                      PIC  S9(4) COMP VALUE ZERO.  07264704
016900     05  PC-SYSTEM-DATE              PIC  9(06)    VALUE ZERO.    07264804
017000                                                                  07264955
017100 01  PC-STORE-TABLE.                                              07265055
017200     05  PC-STORE-TBL     OCCURS 50  TIMES                        07266055
017300                          INDEXED BY PC-STR-IDX.                  07267055
017400         10  PC-STORE-NMBR           PIC  S9(4)  COMP.            07268055
017500                                                                  07268155
017600                                                                  07268204
017700 01  PV-ABEND-FIELDS.                                             07268304
017800     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT039'.07268404
017900     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    07268504
018000     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    07268604
018100     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    07268704
018200     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    07268804
018300     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    07268904
018400     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    07269004
018500     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    07269104
018600     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    07269204
018700/                                                                 07269304
018800     COPY RCRD015.                                                07269407
018900/                                                                 07269504
019000     COPY RCRD009.                                                07269607
019100/                                                                 07269704
019200*                                                                 07269804
019300******************************************************************07269904
019400*  USED FOR DB2 ERROR MESSAGE BUILDING                            07270004
019500******************************************************************07270104
019600     COPY DPWS004.                                                07270204
019700*                                                                 07270304
019800/                                                                 07270404
019900******************************************************************07270504
020000*   DB2 SQL COMMUNICATION AREA                                    07270604
020100******************************************************************07270704
020200     EXEC SQL                                                     07270804
020300          INCLUDE SQLCA                                           07270904
020400     END-EXEC.                                                    07271004
020500/                                                                 07271104
020600******************************************************************07271204
020700*   DB2 DCLGEN FOR TWKORIN TABLE                                  07271304
020800******************************************************************07271404
020900     EXEC SQL                                                     07271504
021000          INCLUDE TWKORIN                                         07271604
021100     END-EXEC.                                                    07271704
021200                                                                  07271804
021300/                                                                 07271904
021400******************************************************************07272004
021500*   DB2 DCLGEN FOR TPAYTRM TABLE                                  07272104
021600******************************************************************07272204
021700     EXEC SQL                                                     07272304
021800          INCLUDE TPAYTRM                                         07272404
021900     END-EXEC.                                                    07272504
022000/                                                                 07272604
022100******************************************************************07272704
022200*   DB2 DCLGEN FOR TPOAGMT TABLE                                  07272804
022300******************************************************************07272904
022400     EXEC SQL                                                     07273004
022500          INCLUDE TPOAGMT                                         07273104
022600     END-EXEC.                                                    07273204
022700/                                                                 07273304
022800******************************************************************07273404
022900*   DB2 DCLGEN FOR TPLNSHP TABLE                                  07273504
023000******************************************************************07273604
023100     EXEC SQL                                                     07273704
023200          INCLUDE TPLNSHP                                         07273804
023300     END-EXEC.                                                    07273904
023400/                                                                 07274004
023500******************************************************************07274104
023600*   DB2 DCLGEN FOR TVNDDPT TABLE                                  07274204
023700******************************************************************07274304
023800     EXEC SQL                                                     07274404
023900          INCLUDE TVNDDPT                                         07274504
024000     END-EXEC.                                                    07274604
024100/                                                                 07274704
024200******************************************************************07274804
024300*   DB2 DCLGEN FOR TEXTENT TABLE                                  07274904
024400******************************************************************07275004
024500     EXEC SQL                                                     07275104
024600          INCLUDE TEXTENT                                         07275204
024700     END-EXEC.                                                    07275304
024800/                                                                 07275404
024900******************************************************************07275504
025000*   DB2 DCLGEN FOR TENTNME TABLE                                  07275604
025100******************************************************************07275704
025200     EXEC SQL                                                     07275804
025300          INCLUDE TENTNME                                         07275904
025400     END-EXEC.                                                    07276004
025500                                                                  07276104
025600/                                                                 07276204
025700******************************************************************07276304
025800*   DB2 DCLGEN FOR RECEIVER TABLE                                 07276404
025900******************************************************************07276504
026000     EXEC SQL                                                     07276604
026100          INCLUDE TRECEIV                                         07276704
026200     END-EXEC.                                                    07276804
026300/                                                                 07276904
026400******************************************************************07277004
026500*   DB2 DCLGEN FOR RECEIVER ITEM TABLE                            07277104
026600******************************************************************07277204
026700     EXEC SQL                                                     07277304
026800          INCLUDE TRECITM                                         07277404
026900     END-EXEC.                                                    07277504
027000/                                                                 07277604
027100******************************************************************07277704
027200*  DCLGEN FOR THE DB2 PURCHASE ORDER TABLE                        07277804
027300******************************************************************07277904
027400     EXEC SQL                                                     07278004
027500         INCLUDE TPURCHS                                          07278104
027600     END-EXEC.                                                    07278204
027700/                                                                 07278304
027800******************************************************************07278404
027900*  DCLGEN FOR THE DB2 PURCHASE ORDER LINE ITEM TABLE              07278504
028000******************************************************************07278604
028100     EXEC SQL                                                     07278704
028200         INCLUDE TPURITM                                          07278804
028300     END-EXEC.                                                    07278904
028400/                                                                 07279004
028500******************************************************************07279104
028600*  DCLGEN FOR THE DB2 STORES TABLE                                07279204
028700******************************************************************07279304
028800     EXEC SQL                                                     07279404
028900         INCLUDE XLT00010                                         07279504
029000     END-EXEC.                                                    07279604
029100/                                                                 07279704
029200******    WR # 27201 - START                                      07279855
029300******************************************************************07279955
029400*  DCLGEN FOR THE DB2 RCT_PRC_RCPT                                07280055
029500******************************************************************07290055
029600     EXEC SQL                                                     07300055
029700         INCLUDE RCT00019                                         07310055
029800     END-EXEC.                                                    07320055
029900/                                                                 07330055
030000******    WR # 27201 - END                                        07330155
030100******************************************************************07330204
030200*  TWKORIN CURSOR                                                *07330304
030300******************************************************************07330404
030400     EXEC SQL                                                     07330504
030500          DECLARE TWKORIN-CSR CURSOR FOR                          07330604
030600             SELECT WORK_ORD_SEQ_NBR                              07330704
030700                  , STRT_TMST                                     07330804
030800                  , STOP_TMST                                     07330904
030900                  , PRC_FCLTY_AREA_ID                             07331004
031000                  , SCREEN_SEQ_NBR                                07331104
031100             FROM TWKORIN                                         07331204
031200             WHERE ORD_NBR            = :DK-ORD-NBR               07331304
031300               AND RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR           07331404
031400               AND ORD_LNE_NBR        = :DK-SHORT-LNE-NBR         07331504
031500               AND WORK_ORD_SEQ_NBR   = :PC-ONE                   07331604
031600               AND OPER_UNT_ID        = :DK-OPER-UNT-ID           07331704
031700               AND VER_STATUS_CDE     = :PC-A                     07331804
031800             ORDER BY SCREEN_SEQ_NBR                              07331904
031900     END-EXEC.                                                    07332004
032000                                                                  07332104
032100*                                                                 07332204
032200******************************************************************07332304
032300*  TWKORIN CURSOR - FOR LINE NUMBER = ZERO                       *07332404
032400******************************************************************07332504
032500     EXEC SQL                                                     07332604
032600          DECLARE WKORIN0-CSR CURSOR FOR                          07332704
032700             SELECT WORK_ORD_SEQ_NBR                              07332804
032800                  , STRT_TMST                                     07332904
032900                  , STOP_TMST                                     07333004
033000                  , PRC_FCLTY_AREA_ID                             07333104
033100                  , SCREEN_SEQ_NBR                                07333204
033200             FROM   TWKORIN                                       07333304
033300             WHERE ORD_NBR            = :DK-ORD-NBR               07333404
033400               AND RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR           07333504
033500               AND ORD_LNE_NBR        = 0                         07333604
033600               AND WORK_ORD_SEQ_NBR   = 1                         07333704
033700               AND OPER_UNT_ID        = :DK-OPER-UNT-ID           07333804
033800               AND VER_STATUS_CDE     = :PC-A                     07333904
033900             ORDER BY SCREEN_SEQ_NBR                              07334004
034000     END-EXEC.                                                    07334104
034100                                                                  07334204
034200*                                                                 07334304
034300******************************************************************07334404
034400*  XLT-LOC CURSOR - FOR LINE NUMBER = ZERO                       *07334504
034500******************************************************************07334604
034600     EXEC SQL                                                     07334704
034700          DECLARE XLT-LOC-CSR CURSOR FOR                          07334804
034800             SELECT LOC_NBR                                       07334904
034900             FROM   XLT_LOC                                       07335004
035000             WHERE LOC_TYP_CDE       = :PC-DC                     07335104
035100     END-EXEC.                                                    07335204
035200                                                                  07335304
035300*                                                                 07335404
035400***********************************************************       07335504
035500*  COPYBOOK USED BY MBS SYSTEM                            *       07335604
035600***********************************************************       07335704
035700     COPY DPWS003.                                                07335804
035800/                                                                 07335904
035900 PROCEDURE DIVISION.                                              07336004
036000                                                                  07336104
036100     PERFORM 1000-INITIALIZE.                                     07336207
036200                                                                  07336307
036300     PERFORM 2000-PROCESS-SUMMARIES                               07336407
036400             UNTIL PS-EOF-SUMMARY-FILE.                           07336504
036500                                                                  07336607
036600     PERFORM 9000-END-OF-JOB.                                     07336707
036700                                                                  07336807
036800     GOBACK.                                                      07336904
036900                                                                  07337004
037000/                                                                 07337104
037100 1000-INITIALIZE.                                                 07337207
037200                                                                  07337307
037300     ACCEPT PC-SYSTEM-DATE FROM DATE.                             07337455
037400                                                                  07337555
037500     OPEN INPUT RECEIPT-AUDIT-SUM-FILE                            07337607
037600     PERFORM 1100-READ-SUMMARY-FILE.                              07337707
037700     IF PS-EOF-SUMMARY-FILE                                       07337804
037800         DISPLAY SPACES                                           07337907
037900         DISPLAY                                                  07338007
038000        '*****************************************'               07338107
038100         DISPLAY                                                  07338207
038200        '** FILE INP01 IS EMPTY                 **'               07338307
038300         DISPLAY                                                  07338407
038400        '** OUT01 AND OUT02 WILL NOT BE CREATED **'               07338507
038500         DISPLAY                                                  07338607
038600        '** PROGRAM RCKUT039 IS ENDING          **'               07338707
038700         DISPLAY                                                  07338807
038800        '*****************************************'               07338907
038900     ELSE                                                         07339007
039000         OPEN OUTPUT UPDATED-AUDIT-SUM-FILE                       07339107
039100                     RC009-FILE                                   07339207
039200         INITIALIZE PC-STORE-TABLE                                07339355
039300         PERFORM 8000-OPEN-XLT-LOC-CSR                            07339455
039400         PERFORM 8200-FETCH-XLT-LOC-CSR                           07339555
039500         PERFORM 8400-LOAD-STORE-TABLE                            07339655
039600             VARYING PC-STR-IDX                                   07339755
039700              FROM 1 BY 1                                         07339855
039800              UNTIL PC-STR-IDX  > 50                              07339955
039900                OR PS-EOF-XLT-LOC-CSR                             07340055
040000         PERFORM 8600-CLOSE-XLT-LOC-CSR                           07340155
040100     END-IF.                                                      07340207
040200                                                                  07340307
040300                                                                  07340407
040400 1100-READ-SUMMARY-FILE.                                          07340507
040500     READ RECEIPT-AUDIT-SUM-FILE INTO                             07340607
040600         RC015-TRECDIS-ADJ-RECORD                                 07340707
040700     AT END                                                       07340807
040800         SET PS-EOF-SUMMARY-FILE TO TRUE                          07340904
040900     NOT AT END                                                   07341007
041000         ADD 1                   TO PV-RECS-READ-COUNTER          07341107
041100         MOVE RC015-ORD-NBR      TO PV-COMPARE-ORD-NBR            07341207
041200         MOVE RC015-ORD-LNE-NBR  TO PV-COMPARE-REQ-SEQ-NBR        07341307
041300         MOVE RC015-REC-SEQ-NBR  TO PV-COMPARE-ORD-LNE-NBR        07341407
041400     END-READ.                                                    07341507
041500 1200-WRITE-SUMMARY-RECORD.                                       07341607
041600     WRITE UPDATED-AUDIT-SUM-RECORD  FROM                         07341707
041700         RC015-TRECDIS-ADJ-RECORD                                 07341807
041800     END-WRITE.                                                   07341907
041900     ADD 1                       TO PV-SUMM-RECS-WRITTEN.         07342007
042000 1300-WRITE-RC009-RECORD.                                         07342107
042100     WRITE RC009-RECORD FROM RC009-REC                            07342207
042200     END-WRITE.                                                   07342307
042300     ADD 1                       TO PV-RC09-RECS-WRITTEN.         07342407
042400/                                                                 07342507
042500 2000-PROCESS-SUMMARIES.                                          07342607
042600                                                                  07342704
042700     IF PV-COMPARE-KEY NOT = PV-PREV-KEY                          07342807
042800         SET PS-CONTROL-BREAK    TO TRUE                          07342907
042900         MOVE PV-COMPARE-KEY     TO PV-PREV-KEY                   07343007
043000     ELSE                                                         07343107
043100         SET PS-NO-CONTROL-BREAK TO TRUE                          07343207
043200     END-IF.                                                      07343307
043300                                                                  07343407
043400                                                                  07343507
043500     IF PS-CONTROL-BREAK                                          07343607
043600         INITIALIZE DCLTRECEIV                                    07343707
043700                    DCLTRECITM                                    07343807
043800                    DCLTPURCHS                                    07343907
043900                    DCLTPURITM                                    07344007
044000                    DCLTWKORIN                                    07344107
044100                    DCLTPAYTRM                                    07344207
044200                    DCLTPOAGMT                                    07344307
044300                    DCLTPLNSHP                                    07344407
044400                    DCLTVNDDPT                                    07344507
044500                    DCLTENTNME                                    07344607
044600                    RC009-REC                                     07344704
044700         MOVE 'N'                TO PS-ERROR-SW                   07344804
044800         MOVE RC015-ORD-NBR      TO DK-ORD-NBR                    07344904
044900         MOVE RC015-REC-SEQ-NBR  TO DK-REC-SEQ-NBR                07345004
045000         MOVE RC015-ORD-LNE-NBR  TO DK-ORD-LNE-NBR                07345104
045100                                    DK-SHORT-LNE-NBR              07345204
045200        MOVE RC015-OPER-UNT-ID   TO DK-OPER-UNT-ID                07345304
045300         IF PS-NO-ERROR                                           07345412
045400             PERFORM 7000-SELECT-TRECEIV                          07345504
045500         END-IF                                                   07345612
045600         IF PS-NO-ERROR                                           07345712
045700             PERFORM 7010-SELECT-RECITM                           07345804
045800         END-IF                                                   07345912
045900         IF PS-NO-ERROR                                           07346012
046000             PERFORM 7020-SELECT-TPURCHS                          07346104
046100         END-IF                                                   07346212
046200         IF PS-NO-ERROR                                           07346312
046300             PERFORM 3000-GET-DIVISION-NMBR                       07346404
046400         END-IF                                                   07346512
046500         IF PS-NO-ERROR                                           07346612
046600             PERFORM 7030-GET-VENDOR-INFO                         07346704
046700         END-IF                                                   07346812
046800         IF PS-NO-ERROR                                           07346912
046900             PERFORM 3200-PROCESS-PAYT-TERMS                      07347004
047000         END-IF                                                   07347112
047100         IF PS-NO-ERROR                                           07347212
047200             PERFORM 7060-SELECT-TPURITM                          07347304
047300         END-IF                                                   07347412
047400******    WR # 27201 - START                                      07347555
047500         IF PS-NO-ERROR                                           07347655
047600             PERFORM 7090-GET-RETAIL-DATA                         07347755
047700         END-IF                                                   07347855
047800******    WR # 27201 - END                                        07347955
047900         IF PS-NO-ERROR                                           07348012
048000             PERFORM 3300-GET-PROCESSING-AREA                     07348104
048100         END-IF                                                   07348212
048200     END-IF.                                                      07348307
048300                                                                  07348407
048400     IF PS-ERROR                                                  07348507
048500         SET PS-EOF-SUMMARY-FILE TO TRUE                          07348604
048600     ELSE                                                         07348707
048700         PERFORM 2900-FORMAT-OUTPUT-RECORDS                       07348807
048800         PERFORM 1200-WRITE-SUMMARY-RECORD                        07348907
048900         PERFORM 1300-WRITE-RC009-RECORD                          07349007
049000         PERFORM 1100-READ-SUMMARY-FILE                           07349107
049100     END-IF.                                                      07349207
049200                                                                  07349304
049300/                                                                 07349404
049400 2900-FORMAT-OUTPUT-RECORDS.                                      07349507
049500                                                                  07349607
049600     MOVE PV-VERFYD-YYYY       TO RC015-VERFYD-YYYY.              07349755
049700     MOVE PV-VERFYD-MM         TO RC015-VERFYD-MM.                07349855
049800     MOVE PV-VERFYD-DD         TO RC015-VERFYD-DD.                07349955
049900     MOVE RC009-PRC-FCLTY-AREA-ID                                 07350055
050000                               TO RC015-PRC-FCLTY-AREA-ID.        07350155
050100                                                                  07350207
050200     MOVE RC015-ORD-NBR          TO RC009-PO-NBR                  07350304
050300     MOVE RC015-REC-SEQ-NBR      TO RC009-REC-SEQ-NBR             07350404
050400     MOVE RC015-ORD-LNE-NBR      TO RC009-PO-LNE-NBR              07350504
050500     MOVE '03'                   TO RC009-OP-CO-NBR               07350604
050600     MOVE RC015-STR-NBR          TO RC009-STR-NBR                 07350707
050700     MOVE SPACES                 TO PV-PRC-FCLTY-AREA-ID.         07350804
050800     MOVE PC-A                   TO RC009-REC-SRC-CDE             07350912
050900     MOVE RC015-NOTIF-NBR        TO RC009-NOTIF-NBR               07351012
051000     MOVE RC015-ADJ-CYC-NBR      TO RC009-ADJ-CYC-NBR.            07352012
051100     MOVE ZEROES                 TO RC009-RTL-UNIT-RCVD-QTY       07353055
051200                                    RC009-INVC-RTL-QTY            07354055
051300                                    RC009-RTL-UNIT-ORD-QTY.       07354155
051400                                                                  07354204
051500     MOVE RECEIV-RCVR-NBR        TO PV-RCVR-NBR.                  07354304
051600     MOVE PV-RCVR-KEYREC         TO RC009-RCVR-NBR.               07354404
051700     MOVE RECEIV-OPER-UNT-ID     TO RC009-OPER-UNT-ID.            07354555
051800     MOVE RECEIV-FCLTY-ID        TO RC009-FCLTY-ID.               07354655
051900     MOVE RECEIV-CURR-OPER-UNT-ID TO RC009-CURR-OPER-UNT-ID.      07354755
052000     MOVE RECEIV-CURR-FCLTY-ID    TO RC009-CURR-FCLTY-ID.         07354855
052100                                                                  07354904
052200     IF DP003-SUCCESSFUL                                          07355004
052300         MOVE DP003-DMM-NMBR     TO PV-DIV-SEQNO                  07355104
052400         MOVE ZERO               TO PV-DIV-ZERO                   07355204
052500         MOVE PV-DIVISION-SEQNO  TO RC009-DIV-SEQ-NBR             07355304
052600     END-IF                                                       07355412
052700                                                                  07355507
052800     MOVE ENTNME-ENT-NAME-DESC  TO RC009-VEND-INHSE-NAME          07355604
052900                                   RC009-VEND-DUNS-DESC           07355704
053000     MOVE EXTENT-DUN-NBR        TO RC009-VEND-DUNS-NBR.           07355804
053100                                                                  07355904
053200     SET PC-STR-IDX             TO  1.                            07356055
053300     SEARCH PC-STORE-TBL                                          07357055
053400       VARYING PC-STR-IDX                                         07358055
053500           WHEN PC-STORE-NMBR (PC-STR-IDX ) = ZERO                07358155
053600               MOVE 'DS '             TO RC009-STR-TYP-CDE        07358204
053700                                         RC015-REC-LOC-CDE        07358355
053800                                         RC015-REC-LOC-CDE-4CH    07358455
053900           WHEN PC-STORE-NMBR (PC-STR-IDX ) = RC015-OPER-UNT-ID   07358555
054000               MOVE 'DC'              TO RC009-STR-TYP-CDE        07358655
054100               MOVE RC015-OPER-UNT-ID TO PV-UNT-ID-N              07358704
054200                                         PV-UNT-ID-N-4            07358804
054300               MOVE PV-UNT-ID-X       TO RC015-REC-LOC-CDE        07358955
054400               MOVE PV-UNT-ID-X-4     TO RC015-REC-LOC-CDE-4CH    07359055
054500     END-SEARCH.                                                  07360055
054600                                                                  07370055
054700     MOVE RC015-ADJ-ITM-QTY      TO RC009-RTL-UNIT-MK-QTY         07380055
054800******    WR # 27201 - START                                      07390055
054900*    MULTIPLY PURITM-UNT-RTL-PR-AMT BY RC015-ADJ-ITM-QTY          07400055
055000     MULTIPLY RC009-UNIT-RTL-AMT BY RC015-ADJ-ITM-QTY             07410055
055100******    WR # 27201 - END                                        07410155
055200           GIVING RC015-ADJ-RTL-EXTN-AMT                          07410204
055300     MULTIPLY PURITM-UNT-COST-AMT BY RC015-ADJ-ITM-QTY            10150004
055400           GIVING RC015-ADJ-COST-EXTN-AMT                         10160055
055500                                                                  10170055
055600     MULTIPLY RC009-RTL-UNIT-MK-QTY BY PURITM-UNT-COST-AMT        10180055
055700           GIVING RC009-COST-EXTN-AMT                             10190055
055800                                                                  10200055
055900     MULTIPLY RC009-RTL-UNIT-MK-QTY BY RC009-LOWST-UNIT-RTL-AMT   10210055
056000           GIVING RC009-RTL-EXTN-AMT.                             10220055
056100                                                                  10220155
056200     MOVE RECITM-PKSL-NBR        TO RC009-INVC-NBR.               10220204
056300/                                                                 10220304
056400 3000-GET-DIVISION-NMBR.                                          10220404
056500******************************************************************10220504
056600*  GET THE BUYER NAME AND NUMBER INFORMATION FROM THE MBS TABLES  10220604
056700*  USING SUBROUTINE 'DPKUT038'.                                   10220704
056800******************************************************************10220804
056900     SET DP003-DMM-LOOKUP-NMBR         TO TRUE.                   10220904
057000     MOVE PURCHS-DEPT-NBR              TO DP003-DPT-INPUT.        10221004
057100     MOVE PC-SYSTEM-CODE               TO DP003-SYSTEM-CODE.      10221104
057200     MOVE PC-CURRENT-OPERATING-COMPANY TO DP003-OP-CO-NMBR.       10221204
057300     MOVE PC-SYSTEM-DATE               TO DP003-CURRENT-DATE      10221304
057400                                          DP003-EFF-DATE.         10221404
057500*                                                                 10221504
057600     CALL PC-MPS-PROGRAM-NAME   USING DP003-MBS-SUBROUTINE-FIELDS.10221604
057700*                                                                 10221704
057800     EVALUATE TRUE                                                10221804
057900        WHEN DP003-SUCCESSFUL                                     10221904
058000        WHEN DP003-DMM-NMBR-NOT-FOUND                             10222004
058100           CONTINUE                                               10222104
058200        WHEN DP003-DMM-NMBR-DB2-ERROR                             10222204
058300           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          10222304
058400           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10222404
058500                                 TO PV-ABEND-STRUCTURE-2          10222504
058600           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          10222604
058700           MOVE DP003-SQLCA      TO SQLCA                         10222704
058800           PERFORM 9900-DB2-ABEND                                 10222804
058900        WHEN DP003-DMM-NMBR-MAX-RETRIES                           10222904
059000           MOVE DP003-RETURN-MSG TO PV-ABEND-STRUCTURE-1          10223004
059100           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10223104
059200                                 TO PV-ABEND-STRUCTURE-2          10223204
059300           MOVE DP003-DPT-INPUT  TO PV-ABEND-STRUCTURE-3          10223304
059400           MOVE DP003-SQLCA      TO SQLCA                         10223404
059500           PERFORM 9900-DB2-ABEND                                 10223504
059600        WHEN DP003-NO-INPUT-SELECTION                             10223604
059700           MOVE 'CURRENT INPUT FIELDS ARE: '                      10223704
059800                                 TO PV-ERROR-MESSAGE-1            10223804
059900           MOVE DP003-INPUT-FIELDS                                10223904
060000                                 TO PV-ERROR-MESSAGE-2            10224004
060100           PERFORM 9200-ABEND                                     10224104
060200        WHEN DP003-SYSTEM-CODE-ERROR                              10224204
060300           MOVE 'THE SYSTEM CODE IS: '                            10224304
060400                                 TO PV-ERROR-MESSAGE-1            10224404
060500           MOVE DP003-SYSTEM-CODE                                 10224504
060600                                 TO PV-ERROR-MESSAGE-2            10224604
060700           PERFORM 9200-ABEND                                     10224704
060800        WHEN DP003-CURRENT-DATE-ERROR                             10224804
060900           MOVE 'THE CURRENT DATE USED IS:'                       10224904
061000                                 TO PV-ERROR-MESSAGE-1            10225004
061100           MOVE DP003-CURRENT-DATE                                10225104
061200                                 TO PV-ERROR-MESSAGE-2            10225204
061300           PERFORM 9200-ABEND                                     10225304
061400        WHEN DP003-EFF-DATE-ERROR                                 10225404
061500           MOVE 'THE EFFECTIVE DATE USED IS:'                     10225504
061600                                 TO PV-ERROR-MESSAGE-1            10225604
061700           MOVE DP003-EFF-DATE   TO PV-ERROR-MESSAGE-2            10225704
061800           PERFORM 9200-ABEND                                     10225804
061900        WHEN DP003-DPT-MUST-BE-NUMERIC                            10225904
062000           MOVE 'CURRENT DEPARTMENT BEING PROCESSED IS: '         10226004
062100                                 TO PV-ERROR-MESSAGE-1            10226104
062200           MOVE DP003-DPT-INPUT  TO PV-ERROR-MESSAGE-2            10226204
062300           PERFORM 9200-ABEND                                     10226304
062400        WHEN OTHER                                                10226404
062500           MOVE 'ERROR UNIDENTIFIED -  CURRENT INPUT FIELDS ARE: '10226504
062600                                 TO PV-ERROR-MESSAGE-1            10226604
062700           MOVE DP003-INPUT-FIELDS                                10226704
062800                                 TO PV-ERROR-MESSAGE-2            10226804
062900           PERFORM 9200-ABEND                                     10226904
063000     END-EVALUATE.                                                10227004
063100/                                                                 10227104
063200 3200-PROCESS-PAYT-TERMS.                                         10227204
063300                                                                  10227307
063400     PERFORM 7040-SELECT-PAYT-TERMS.                              10227404
063500                                                                  10227504
063600     IF PS-ERROR                                                  10227604
063700        CONTINUE                                                  10227704
063800     ELSE                                                         10227804
063900         MOVE 'S'                    TO RC009-DISC-TERMS-CDE      10227904
064000         MOVE 'N'                    TO RC009-EOM-IND             10228004
064100         MOVE ZERO                   TO RC009-DATING-EXTN-CD      10228104
064200                                                                  10228204
064300         IF PAYTRM-PAY-TERM-ID = 1 OR 2 OR 3 OR 4 OR 5 OR 63      10228304
064400             MOVE 'NET '             TO RC009-CASH-DISC-CDE       10228404
064500             MOVE PAYTRM-DUE-DAY-QTY TO RC009-DISC-DAYS-CNT       10228504
064600         END-IF                                                   10228604
064700         PERFORM 7050-SELECT-TPLNSHP                              10228704
064800         IF  SQLCODE = ZERO                                       10228804
064900             MOVE PLNSHP-FRGT-PAYT-CDE TO RC009-FRGT-PAYT-CDE     10228904
065000         END-IF                                                   10229004
065100     END-IF.                                                      10229104
065200                                                                  10229204
065300*                                                                 10229304
065400 3300-GET-PROCESSING-AREA.                                        10229404
065500                                                                  10229504
065600     PERFORM 7070-OPEN-TWKORIN.                                   10229604
065700     PERFORM 3310-FETCH-TWKORIN-LOOP.                             10229704
065800                                                                  10229804
065900 3310-FETCH-TWKORIN-LOOP.                                         10229904
066000                                                                  10230004
066100     MOVE 'N'                    TO PS-TWKORIN-CURSOR-SW          10230104
066200                                    PS-TWKORIN-ZERO-SW.           10230204
066300                                                                  10230355
066400     PERFORM 7071-FETCH-TWKORIN.                                  10230404
066500                                                                  10230555
066600     IF PS-EOF-TWKORIN-CSR OR WKORIN-STRT-TMST = PC-DEFAULT-DATE  10230604
066700                                                                  10230704
066800         PERFORM 7072-CLOSE-TWKORIN                               10230804
066900         PERFORM 7073-OPEN-WKORIN0-CURSOR                         10230904
067000         PERFORM 7074-FETCH-TWKORIN-ZERO                          10231004
067100         IF WKORIN-STRT-TMST = PC-DEFAULT-DATE                    10231104
067200             MOVE WKORIN-PRC-FCLTY-AREA-ID                        10231204
067300                                 TO PV-PRC-FCLTY-AREA-ID          10231304
067400             PERFORM 7075-CLOSE-WKORIN0                           10231404
067500         ELSE                                                     10231504
067600             MOVE WKORIN-PRC-FCLTY-AREA-ID                        10231604
067700                                 TO PV-PRC-FCLTY-AREA-ID          10231704
067800             PERFORM 7074-FETCH-TWKORIN-ZERO                      10231804
067900                                 UNTIL PS-EOF-TWKORIN-ZERO        10231904
068000             PERFORM 7075-CLOSE-WKORIN0                           10232004
068100             MOVE PV-PRC-FCLTY-AREA-ID                            10233004
068200                                 TO RC009-PRC-FCLTY-AREA-ID       10234055
068300                                    RC015-PRC-FCLTY-AREA-ID       10234155
068400     ELSE                                                         10234204
068500         MOVE WKORIN-PRC-FCLTY-AREA-ID                            10234304
068600                                 TO PV-PRC-FCLTY-AREA-ID          10234455
068700         PERFORM 7071-FETCH-TWKORIN UNTIL PS-EOF-TWKORIN-CSR      10234504
068800         MOVE PV-PRC-FCLTY-AREA-ID                                10234604
068900                                 TO RC009-PRC-FCLTY-AREA-ID       10234712
069000                                    RC015-PRC-FCLTY-AREA-ID       10234812
069100         PERFORM 7072-CLOSE-TWKORIN                               10234904
069200     END-IF.                                                      10235004
069300                                                                  10235155
069400 4675-CHECK-DATES.                                                10235204
069500     IF  WKORIN-STRT-TMST NOT EQUAL PC-DEFAULT-DATE               10235304
069600         IF  WKORIN-STOP-TMST NOT EQUAL PC-DEFAULT-DATE           10235404
069700             MOVE WKORIN-PRC-FCLTY-AREA-ID                        10235504
069800                                 TO PV-PRC-FCLTY-AREA-ID          10235604
069900         ELSE                                                     10235704
070000             MOVE WKORIN-PRC-FCLTY-AREA-ID                        10235804
070100                                 TO PV-PRC-FCLTY-AREA-ID          10235904
070200             SET PS-EOF-TWKORIN-CSR TO TRUE                       10236004
070300         END-IF                                                   10236104
070400     ELSE                                                         10236204
070500         SET PS-EOF-TWKORIN-CSR TO TRUE                           10236304
070600     END-IF.                                                      10236404
070700/                                                                 10236504
070800 4860-CHECK-DATES.                                                10236604
070900     IF  WKORIN-STRT-TMST NOT EQUAL PC-DEFAULT-DATE               10236704
071000         IF  WKORIN-STOP-TMST NOT EQUAL PC-DEFAULT-DATE           10236804
071100             MOVE WKORIN-PRC-FCLTY-AREA-ID                        10236904
071200                                 TO PV-PRC-FCLTY-AREA-ID          10237004
071300         ELSE                                                     10237104
071400             MOVE WKORIN-PRC-FCLTY-AREA-ID                        10237204
071500                                 TO PV-PRC-FCLTY-AREA-ID          10237304
071600             SET PS-EOF-TWKORIN-CSR                               10237404
071700                                 TO TRUE                          10237555
071800         END-IF                                                   10237604
071900     ELSE                                                         10237704
072000         MOVE WKORIN-PRC-FCLTY-AREA-ID                            10237804
072100                                 TO PV-PRC-FCLTY-AREA-ID          10237904
072200         SET PS-EOF-TWKORIN-CSR  TO TRUE                          10238004
072300     END-IF.                                                      10238104
072400*                                                                 10238204
072500/                                                                 10238304
072600 7000-SELECT-TRECEIV.                                             10238404
072700                                                                  10238504
072800     EXEC SQL                                                     10238604
072900         SELECT                                                   10238712
073000               A.RCVR_NBR                                         10238804
073100             , A.REC_TMST                                         10238904
073200             , A.VERFYD_TMST                                      10239004
073300             , A.OPER_UNT_ID                                      10240055
073400             , A.FCLTY_ID                                         10250055
073500             , A.CURR_OPER_UNT_ID                                 10260055
073600             , A.CURR_FCLTY_ID                                    10260155
073700         INTO                                                     10260204
073800               :RECEIV-RCVR-NBR                                   10260304
073900             , :PV-REC-TMST                                       10260404
074000             , :PV-VER-TMST                                       10260504
074100             , :RECEIV-OPER-UNT-ID                                10260655
074200             , :RECEIV-FCLTY-ID                                   10260755
074300             , :RECEIV-CURR-OPER-UNT-ID                           10260855
074400             , :RECEIV-CURR-FCLTY-ID                              10260955
074500         FROM TRECEIV A                                           10261004
074600         WHERE A.ORD_NBR        = :DK-ORD-NBR                     10261104
074700           AND A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 10261204
074800           AND A.VER_STATUS_CDE = :PC-A                           10261304
074900         END-EXEC                                                 10261404
075000                                                                  10261504
075100         EVALUATE TRUE                                            10261604
075200             WHEN SQLCODE = ZERO                                  10261704
075300                 MOVE PV-VER-YY   TO PV-DV-YY                     10261855
075400                 MOVE PV-VER-MM   TO PV-DV-MM                     10261955
075500                 MOVE PV-VER-DD   TO PV-DV-DD                     10262055
075600                 MOVE PV-VER-DATE TO RC009-VERIFYD-CT-DTE         10262104
075700                 MOVE PV-REC-YY   TO PV-DR-YY                     10262204
075800                 MOVE PV-REC-MM   TO PV-DR-MM                     10262304
075900                 MOVE PV-REC-DD   TO PV-DR-DD                     10262404
076000                 MOVE PV-REC-DATE TO RC009-REC-DTE                10262504
076100             WHEN SQLCODE = +100                                  10262604
076200                  SET PS-ERROR TO TRUE                            10262704
076300             WHEN SQLWARN0 NOT = SPACE                            10262804
076400             WHEN SQLCODE NOT = +0                                10262904
076500                  MOVE '7000-SELECT-TRECEIV'                      10263004
076600                                       TO PV-ABEND-PARAGRAPH      10263104
076700                  MOVE 'SELECT TRECEIV'                           10263204
076800                                       TO PV-ABEND-OPERATION      10263304
076900                  MOVE 'TRECEIV'   TO PV-ABEND-STRUCTURE-1        10263404
077000                  MOVE SPACES      TO PV-ABEND-STRUCTURE-2        10263504
077100                  PERFORM 9900-DB2-ABEND                          10263604
077200         END-EVALUATE.                                            10263704
077300/                                                                 10263812
077400 7010-SELECT-RECITM.                                              10263904
077500                                                                  10264004
077600******    WR # 27201 - ADDED RETAIL FIELDS TO SELECT              10265055
077700                                                                  10265155
077800     EXEC SQL                                                     10265207
077900         SELECT                                                   10265304
078000              PO_VER_NBR                                          10265404
078100            , PKSL_NBR                                            10265504
078200            , DATE(VERFYD_TMST)                                   10265655
078300            , UNT_RTL_AMT                                         10265755
078400            , GP_RTL_AMT                                          10265855
078500            , GP_QTY                                              10265955
078600         INTO                                                     10266007
078700             :RECITM-PO-VER-NBR                                   10266104
078800           , :RECITM-PKSL-NBR                                     10266204
078900           , :PV-YYYY-MM-DD                                       10266304
079000           , :RECITM-UNT-RTL-AMT                                  10266455
079100           , :RECITM-GP-RTL-AMT                                   10266555
079200           , :RECITM-GP-QTY                                       10266655
079300         FROM TRECITM                                             10266704
079400         WHERE ORD_NBR = :DK-ORD-NBR                              10266804
079500           AND VER_STATUS_CDE = :PC-A                             10266904
079600           AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                   10267004
079700           AND ORD_LNE_NBR    = :DK-ORD-LNE-NBR                   10267104
079800     END-EXEC                                                     10267204
079900                                                                  10267355
080000     EVALUATE TRUE                                                10267404
080100         WHEN SQLCODE = ZERO                                      10267504
080200             MOVE PV-YYYY-MM-DD(1:4)   TO PV-VERFYD-YYYY          10267655
080300             MOVE PV-YYYY-MM-DD(6:2)   TO PV-VERFYD-MM            10267755
080400             MOVE PV-YYYY-MM-DD(9:2)   TO PV-VERFYD-DD            10267855
080500         WHEN SQLCODE = +100                                      10267904
080600             SET PS-ERROR TO TRUE                                 10268004
080700              MOVE '7010-SELECT-RECITM'                           10268104
080800                           TO PV-ERROR-PARA                       10268204
080900         WHEN OTHER                                               10268304
081000              MOVE '7010-SELECT-RECITM'                           10268404
081100                           TO PV-ABEND-PARAGRAPH                  10268504
081200              MOVE 'SELECT TRECITM'                               10268604
081300                           TO PV-ABEND-OPERATION                  10268704
081400              MOVE 'TRECITM'   TO PV-ABEND-STRUCTURE-1            10268804
081500              MOVE 'CURRENT PO BEING PROCESSED ID:         '      10268904
081600                               TO PV-DB2-OPERATION-MESSAGE-1      10269004
081700              MOVE DK-ORD-NBR                                     10269104
081800                               TO PV-DB2-OPERATION-MESSAGE-2      10269204
081900              PERFORM 9900-DB2-ABEND                              10269304
082000     END-EVALUATE.                                                10269404
082100/                                                                 10269504
082200 7020-SELECT-TPURCHS.                                             10269604
082300                                                                  10269704
082400     EXEC SQL                                                     10269804
082500         SELECT DEPT_NBR                                          10269904
082600               ,ENT_ID                                            10270004
082700         INTO   :PURCHS-DEPT-NBR                                  10270104
082800              , :PV-PURCHS-ENT-ID                                 10270204
082900         FROM   TPURCHS                                           10270304
083000         WHERE PO_NBR         = :DK-ORD-NBR                       10270404
083100           AND VER_STATUS_CDE = :PC-A                             10270504
083200     END-EXEC                                                     10270604
083300                                                                  10270704
083400     EVALUATE TRUE                                                10270804
083500         WHEN SQLCODE = ZERO                                      10270904
083600             MOVE PURCHS-DEPT-NBR TO RC009-DEPT-NBR               10271004
083700                                         DK-DEPT                  10271104
083800         WHEN SQLCODE = +100                                      10271204
083900              SET PS-ERROR TO TRUE                                10271304
084000              MOVE '7020-SELECT-TPURCHS'                          10271404
084100                           TO PV-ERROR-PARA                       10271504
084200         WHEN OTHER                                               10271604
084300              MOVE '7020-SELECT-TPURCHS'                          10271704
084400                           TO PV-ABEND-PARAGRAPH                  10271804
084500              MOVE 'SELECT TPURCHS CURSOR'                        10271904
084600                           TO PV-ABEND-OPERATION                  10272004
084700              MOVE 'TPURCHS'       TO PV-ABEND-STRUCTURE-1        10272104
084800              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        10272204
084900              MOVE 'CURRENT PO BEING PROCESSED ID:         '      10272304
085000                             TO PV-DB2-OPERATION-MESSAGE-1        10272404
085100              MOVE DK-ORD-NBR                                     10272504
085200                               TO PV-DB2-OPERATION-MESSAGE-2      10272604
085300              PERFORM 9900-DB2-ABEND                              10272704
085400         END-EVALUATE.                                            10272804
085500/                                                                 10272904
085600 7030-GET-VENDOR-INFO.                                            10273004
085700                                                                  10273104
085800     EXEC SQL                                                     10273204
085900          SELECT ENT_ID,                                          10273304
086000                 INHOUSE_NBR                                      10273404
086100          INTO :VNDDPT-ENT-ID                                     10273504
086200              ,:VNDDPT-INHOUSE-NBR                                10273604
086300          FROM TVNDDPT                                            10273704
086400          WHERE DEPT_NBR       = :DK-DEPT                         10273804
086500            AND  ENT_ID        = :PV-PURCHS-ENT-ID                10273904
086600     END-EXEC.                                                    10274004
086700                                                                  10274104
086800     EVALUATE TRUE                                                10274204
086900         WHEN SQLCODE = ZERO                                      10274304
087000             MOVE VNDDPT-INHOUSE-NBR TO RC009-VEND-INHSE-NBR      10274404
087100             PERFORM 7080-TENTNME-INFO                            10274504
087200         WHEN SQLCODE = +100                                      10274604
087300             SET PS-ERROR TO TRUE                                 10274704
087400              MOVE '7030-GET-VENDOR-INFO'                         10274804
087500                           TO PV-ERROR-PARA                       10274904
087600         WHEN OTHER                                               10275004
087700              MOVE '7030-GET-VENDOR-INFO'                         10275104
087800                           TO PV-ABEND-PARAGRAPH                  10275204
087900              MOVE 'SELECT TPURCHS CURSOR'                        10275304
088000                           TO PV-ABEND-OPERATION                  10275404
088100              MOVE 'TVNDDPT'   TO PV-ABEND-STRUCTURE-1            10275504
088200              MOVE DK-DEPT     TO PV-ABEND-STRUCTURE-2            10275604
088300              PERFORM 9900-DB2-ABEND                              10275704
088400     END-EVALUATE.                                                10275804
088500/                                                                 10275904
088600 7040-SELECT-PAYT-TERMS.                                          10276004
088700                                                                  10276155
088800     EXEC SQL                                                     10276204
088900           SELECT A.PAY_TERM_ID                                   10276304
089000                , A.DUE_DAY_QTY                                   10276404
089100            INTO :PAYTRM-PAY-TERM-ID                              10276504
089200               , :PAYTRM-DUE-DAY-QTY                              10276604
089300            FROM TPAYTRM A                                        10276704
089400               , TPOAGMT B                                        10276804
089500           WHERE B.PO_NBR         = :DK-ORD-NBR                   10276904
089600             AND A.PAY_TERM_ID    = B.PAYT_TERM_ID                10277004
089700             AND B.AGRMT_TYP_ID   = :PC-2                         10277104
089800             AND B.VER_STATUS_CDE = :PC-A                         10277204
089900     END-EXEC                                                     10277304
090000                                                                  10277404
090100     EVALUATE TRUE                                                10277504
090200         WHEN SQLCODE = ZERO                                      10277604
090300             CONTINUE                                             10277704
090400         WHEN SQLCODE = +100                                      10277804
090500             SET PS-ERROR TO TRUE                                 10277904
090600              MOVE '7040-SELECT-PAYT-TERMS'                       10278004
090700                           TO PV-ERROR-PARA                       10278104
090800         WHEN OTHER                                               10278204
090900              MOVE '7040-SELECT-PAYT-TERMS'                       10278304
091000                           TO PV-ABEND-PARAGRAPH                  10278404
091100              MOVE 'SELECT TPOAGMT'                               10278504
091200                           TO PV-ABEND-OPERATION                  10278604
091300              MOVE 'TPOAGMT'   TO PV-ABEND-STRUCTURE-1            10278704
091400              MOVE 'CURRENT PO BEING PROCESSED ID:         '      10278804
091500                               TO PV-DB2-OPERATION-MESSAGE-1      10278904
091600              MOVE DK-ORD-NBR                                     10279004
091700                               TO PV-DB2-OPERATION-MESSAGE-2      10279104
091800              PERFORM 9900-DB2-ABEND                              10279204
091900     END-EVALUATE.                                                10279304
092000/                                                                 10279404
092100 7050-SELECT-TPLNSHP.                                             10279504
092200                                                                  10279655
092300     EXEC SQL                                                     10279704
092400         SELECT FRGT_PAYT_CDE                                     10279804
092500              INTO :PLNSHP-FRGT-PAYT-CDE                          10279904
092600             FROM TPLNSHP                                         10280004
092700             WHERE PO_NBR         = :DK-ORD-NBR                   10280104
092800               AND VER_STATUS_CDE = :PC-A                         10280204
092900     END-EXEC                                                     10280304
093000                                                                  10280455
093100     EVALUATE TRUE                                                10280504
093200         WHEN SQLCODE = ZERO                                      10280604
093300              CONTINUE                                            10280704
093400         WHEN SQLCODE = +100                                      10280804
093500             SET PS-ERROR TO TRUE                                 10280904
093600              MOVE '7050-SELECT-TPLNSHP'                          10281004
093700                           TO PV-ERROR-PARA                       10281104
093800         WHEN OTHER                                               10281204
093900              MOVE '7050-SELECT-TPLNSHP'                          10281304
094000                           TO PV-ABEND-PARAGRAPH                  10281404
094100              MOVE 'SELECT TPLNSHP'                               10281504
094200                           TO PV-ABEND-OPERATION                  10281604
094300              MOVE 'TPLNSHP'   TO PV-ABEND-STRUCTURE-1            10281704
094400              MOVE 'CURRENT PO BEING PROCESSED ID:         '      10281804
094500                               TO PV-DB2-OPERATION-MESSAGE-1      10281904
094600              MOVE DK-ORD-NBR                                     10282004
094700                               TO PV-DB2-OPERATION-MESSAGE-2      10282104
094800              PERFORM 9900-DB2-ABEND                              10282204
094900     END-EVALUATE.                                                10282304
095000/                                                                 10282404
095100 7060-SELECT-TPURITM.                                             10282504
095200                                                                  10282604
095300******    WR # 27201 - REMOVED RETAIL FIELDS FROM SELECT          10282755
095400                                                                  10282855
095500     EXEC SQL                                                     10282904
095600         SELECT CL_NBR                                            10283004
095700               , SKU_SEQ_NBR                                      10283104
095800               , UNT_COST_AMT                                     10283204
095900         INTO   :PURITM-CL-NBR                                    10283304
096000               , :PURITM-SKU-SEQ-NBR                              10283404
096100               , :PURITM-UNT-COST-AMT                             10283504
096200         FROM  TPURITM                                            10283604
096300         WHERE PO_NBR         = :DK-ORD-NBR                       10283704
096400           AND APP_PO_LNE_NBR = :DK-SHORT-LNE-NBR                 10283804
096500           AND VER_NBR        = :RECITM-PO-VER-NBR                10283904
096600         END-EXEC                                                 10284004
096700                                                                  10284104
096800     EVALUATE TRUE                                                10284204
096900         WHEN SQLCODE = ZERO                                      10284304
097000             MOVE PURITM-CL-NBR         TO  PV-CLASS1             10290004
097100             MOVE ZERO                  TO  PV-CLASS3             10300004
097200             MOVE PV-CLASS-NMBR         TO  RC009-CLASS-NBR       10310004
097300             MOVE PURITM-SKU-SEQ-NBR    TO RC009-SKU-SEQ-NBR      10340004
097400             IF  (PURITM-SKU-SEQ-NBR = '000' OR '999')            10350004
097500                 MOVE ZEROES    TO RC009-LOWST-UNIT-RTL-AMT       10360004
097600             END-IF                                               10370004
097700******    WR # 27201 - START                                      10371055
097800*            IF  PURITM-GP-QTY > 1                                10380055
097900*                DIVIDE PURITM-GP-RTL-AMT BY PURITM-GP-QTY        10390055
098000*                    GIVING RC009-LOWST-UNIT-RTL-AMT              10410055
098100*            ELSE                                                 10420055
098200*                MOVE PURITM-UNT-RTL-PR-AMT TO                    10430055
098300*                                     RC009-LOWST-UNIT-RTL-AMT    10440055
098400*            END-IF                                               10450055
098500*                MOVE PURITM-UNT-RTL-PR-AMT TO RC009-UNIT-RTL-AMT 10460055
098600******    WR # 27201 - END                                        10470055
098700         WHEN SQLCODE = +100                                      10490004
098800              SET PS-ERROR TO TRUE                                10500004
098900              MOVE '7060-SELECT-TPURITM'                          10510004
099000                           TO PV-ERROR-PARA                       10520004
099100         WHEN OTHER                                               10530004
099200             MOVE '7060-SELECT-TPURITM'                           10540004
099300                               TO PV-ABEND-PARAGRAPH              10550004
099400             MOVE 'SELECT TPURITM'                                10560004
099500                               TO PV-ABEND-OPERATION              10570004
099600             MOVE 'CURRENT PO BEING PROCESSED ID:         '       10580004
099700                                 TO PV-DB2-OPERATION-MESSAGE-1    10590004
099800             MOVE DK-ORD-NBR                                      10600004
099900                                   TO PV-DB2-OPERATION-MESSAGE-2  10610004
100000             MOVE RECITM-ORD-LNE-NBR                              10620004
100100                                   TO PV-DB2-OPERATION-MESSAGE-3  10630004
100200             MOVE 'TPURITM'   TO PV-ABEND-STRUCTURE-1             10640004
100300             MOVE SPACES      TO PV-ABEND-STRUCTURE-2             10650004
100400             PERFORM 9900-DB2-ABEND                               10660004
100500     END-EVALUATE.                                                10670004
100600/                                                                 10770004
100700 7070-OPEN-TWKORIN.                                               10780004
100800     EXEC SQL                                                     10860004
100900         OPEN TWKORIN-CSR                                         10870004
101000     END-EXEC                                                     10880004
101100                                                                  10890004
101200     EVALUATE TRUE                                                10900004
101300         WHEN SQLCODE = ZERO                                      10910004
101400                  CONTINUE                                        10940004
101500         WHEN SQLWARN0 NOT = SPACE                                10950004
101600         WHEN SQLCODE  NOT = ZERO                                 10960004
101700             MOVE '7070-OPEN-TWKORIN'                             10970004
101800                                 TO PV-ABEND-PARAGRAPH            10980004
101900             MOVE 'OPEN TWKORIN CURSOR'                           10990004
102000                                 TO PV-ABEND-OPERATION            11000004
102100             MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1             11010004
102200             MOVE SPACES      TO PV-ABEND-STRUCTURE-2             11020004
102300             PERFORM 9900-DB2-ABEND                               11030004
102400     END-EVALUATE.                                                11040004
102500                                                                  11060004
102600 7071-FETCH-TWKORIN.                                              11150004
102700                                                                  11160004
102800     EXEC SQL                                                     11170004
102900          FETCH TWKORIN-CSR                                       11180004
103000             INTO :WKORIN-WORK-ORD-SEQ-NBR                        12320004
103100                , :WKORIN-STRT-TMST                               12380004
103200                , :WKORIN-STOP-TMST                               12390004
103300                , :WKORIN-PRC-FCLTY-AREA-ID                       12400004
103400                , :WKORIN-SCREEN-SEQ-NBR                          12410004
103500     END-EXEC.                                                    12410155
103600                                                                  12410204
103700     EVALUATE TRUE                                                12410304
103800         WHEN SQLCODE = ZERO                                      12410404
103900              PERFORM 4675-CHECK-DATES                            12410504
104000         WHEN SQLCODE = +100                                      12410604
104100              SET PS-EOF-TWKORIN-CSR TO TRUE                      12410704
104200         WHEN SQLWARN0 NOT = SPACE                                12410804
104300         WHEN SQLCODE  NOT = ZERO                                 12410904
104400              MOVE '7071-FETCH-TWKORIN'                           12411004
104500                                   TO PV-ABEND-PARAGRAPH          12411104
104600              MOVE 'FETCH TWKORIN CURSOR'                         12411204
104700                                   TO PV-ABEND-OPERATION          12411304
104800              MOVE 'TWKORIN'       TO PV-ABEND-STRUCTURE-1        12411404
104900              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        12411504
105000              MOVE 'CURRENT PO BEING PROCESSED ID:         '      12411604
105100                                   TO PV-DB2-OPERATION-MESSAGE-1  12411704
105200              MOVE DK-ORD-NBR                                     12411804
105300                                   TO PV-DB2-OPERATION-MESSAGE-2  12411904
105400              MOVE DK-SHORT-LNE-NBR                               12412004
105500                                   TO PV-DB2-OPERATION-MESSAGE-3  12412104
105600              PERFORM 9900-DB2-ABEND                              12412204
105700     END-EVALUATE.                                                12412304
105800                                                                  12412404
105900 7072-CLOSE-TWKORIN.                                              12412504
106000     EXEC SQL                                                     12412604
106100         CLOSE TWKORIN-CSR                                        12412704
106200     END-EXEC                                                     12412804
106300                                                                  12412955
106400     EVALUATE TRUE                                                12413004
106500         WHEN SQLCODE = ZERO                                      12413104
106600             CONTINUE                                             12413204
106700         WHEN SQLCODE NOT = ZERO                                  12413304
106800         WHEN SQLWARN0 NOT = SPACE                                12413404
106900             MOVE '7072-CLOSE-TWKORIN'                            12413504
107000                          TO PV-ABEND-PARAGRAPH                   12413604
107100             MOVE 'CLOSE TWKORIN CURSOR'                          12413704
107200                          TO PV-ABEND-OPERATION                   12413804
107300             MOVE 'TWKORIN'           TO PV-ABEND-STRUCTURE-1     12413904
107400             MOVE SPACES              TO PV-ABEND-STRUCTURE-2     12414004
107500             PERFORM 9900-DB2-ABEND                               12414104
107600     END-EVALUATE.                                                12414204
107700/                                                                 12414304
107800 7073-OPEN-WKORIN0-CURSOR.                                        12414404
107900     EXEC SQL                                                     12414504
108000         OPEN WKORIN0-CSR                                         12414604
108100     END-EXEC                                                     12414704
108200                                                                  12414804
108300     EVALUATE TRUE                                                12414904
108400         WHEN SQLCODE = ZERO                                      12415004
108500              CONTINUE                                            12415104
108600         WHEN SQLWARN0 NOT = SPACE                                12415204
108700         WHEN SQLCODE  NOT = ZERO                                 12415304
108800             MOVE '7073-OPEN-WKORIN0'                             12415404
108900                                 TO PV-ABEND-PARAGRAPH            12415504
109000             MOVE 'OPEN WKORIN0 CURSOR'                           12415604
109100                               TO PV-ABEND-OPERATION              12415704
109200             MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1             12415804
109300             MOVE SPACES      TO PV-ABEND-STRUCTURE-2             12415904
109400             PERFORM 9900-DB2-ABEND                               12416004
109500     END-EVALUATE.                                                12416104
109600/                                                                 12416204
109700 7074-FETCH-TWKORIN-ZERO.                                         12416304
109800     EXEC SQL                                                     12416404
109900          FETCH WKORIN0-CSR                                       12416504
110000             INTO :WKORIN-WORK-ORD-SEQ-NBR                        12416604
110100                , :WKORIN-STRT-TMST                               12416704
110200                , :WKORIN-STOP-TMST                               12416804
110300                , :WKORIN-PRC-FCLTY-AREA-ID                       12416904
110400                , :WKORIN-SCREEN-SEQ-NBR                          12417004
110500     END-EXEC.                                                    12420004
110600                                                                  12430004
110700     EVALUATE TRUE                                                12440004
110800         WHEN SQLCODE = ZERO                                      12450004
110900              PERFORM 4860-CHECK-DATES                            12460004
111000         WHEN SQLCODE = +100                                      12470004
111100              SET PS-EOF-TWKORIN-ZERO TO TRUE                     12480004
111200         WHEN SQLWARN0 NOT = SPACE                                12490004
111300         WHEN SQLCODE  NOT = +0                                   12500004
111400              MOVE '7074-FETCH-TWKORIN-ZERO'                      12510004
111500                                   TO PV-ABEND-PARAGRAPH          12520004
111600              MOVE 'FETCH TWKORIN CURSOR'                         12530004
111700                                   TO PV-ABEND-OPERATION          12540004
111800              MOVE 'TWKORIN'       TO PV-ABEND-STRUCTURE-1        12550004
111900              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        12560004
112000              MOVE 'CURRENT PO BEING PROCESSED ID:         '      12570004
112100                                   TO PV-DB2-OPERATION-MESSAGE-1  12580004
112200              MOVE DK-ORD-NBR                                     12590004
112300                                   TO PV-DB2-OPERATION-MESSAGE-2  12600004
112400              MOVE DK-SHORT-LNE-NBR                               12610004
112500                                   TO PV-DB2-OPERATION-MESSAGE-3  12620004
112600              PERFORM 9900-DB2-ABEND                              12630004
112700     END-EVALUATE.                                                12640004
112800/                                                                 12650004
112900 7075-CLOSE-WKORIN0.                                              12660004
113000     EXEC SQL                                                     12740004
113100         CLOSE WKORIN0-CSR                                        12750004
113200     END-EXEC                                                     12760004
113300                                                                  12770004
113400     EVALUATE TRUE                                                12780004
113500         WHEN SQLCODE = ZERO                                      12790004
113600             CONTINUE                                             12800004
113700         WHEN SQLCODE NOT = ZERO                                  12840004
113800             MOVE '7075-CLOSE-WKORIN0'                            12850004
113900                                  TO PV-ABEND-PARAGRAPH           12860004
114000             MOVE 'CLOSE WKORIN0 CURSOR'                          12870004
114100                                  TO PV-ABEND-OPERATION           12880004
114200             MOVE 'TWKORIN'   TO PV-ABEND-STRUCTURE-1             12890004
114300             MOVE SPACES      TO PV-ABEND-STRUCTURE-2             12900004
114400             PERFORM 9900-DB2-ABEND                               12910004
114500     END-EVALUATE.                                                12920004
114600/                                                                 13040004
114700 7080-TENTNME-INFO.                                               13040155
114800                                                                  13040204
114900     EXEC SQL                                                     13040304
115000          SELECT A.ENT_ID                                         13040404
115100               , A.ENT_NAME_DESC                                  13040504
115200               , B.DUN_NBR                                        13040604
115300          INTO :ENTNME-ENT-ID                                     13040704
115400             , :ENTNME-ENT-NAME-DESC                              13040804
115500             , :EXTENT-DUN-NBR                                    13040904
115600          FROM TENTNME A                                          13041004
115700             , TEXTENT B                                          13041104
115800          WHERE A.ENT_ID         = :VNDDPT-ENT-ID                 13041204
115900            AND A.ENT_ID         = B.ENT_ID                       13041304
116000            AND A.TYPE_CDE       = '01'                           13041404
116100     END-EXEC.                                                    13041504
116200                                                                  13041604
116300     EVALUATE TRUE                                                13041704
116400         WHEN SQLCODE = ZERO                                      13041804
116500             CONTINUE                                             13041904
116600         WHEN SQLCODE = +100                                      13042004
116700             SET PS-ERROR TO TRUE                                 13042104
116800              MOVE '7080-TENTNME-INFO'                            13042204
116900                           TO PV-ERROR-PARA                       13042304
117000         WHEN OTHER                                               13042404
117100              MOVE '7080-TENTNME-INFO'                            13042504
117200                           TO PV-ABEND-PARAGRAPH                  13042604
117300              MOVE 'SELECT TPURCHS CURSOR'                        13042704
117400                           TO PV-ABEND-OPERATION                  13042804
117500              MOVE 'TENTNME'   TO PV-ABEND-STRUCTURE-1            13042904
117600              MOVE DK-DEPT     TO PV-ABEND-STRUCTURE-2            13043004
117700              PERFORM 9900-DB2-ABEND                              13043104
117800     END-EVALUATE.                                                13043204
117900/                                                                 13043304
118000******    WR # 27201 - START                                      13043455
118100 7090-GET-RETAIL-DATA.                                            13043555
118200                                                                  13043655
118300     EXEC SQL                                                     13043755
118400         SELECT                                                   13043855
118500              UNT_AMT                                             13043955
118600            , GP_AMT                                              13044055
118700            , GP_QTY                                              13045055
118800         INTO                                                     13046055
118900             :RCT00019-UNT-AMT                                    13047055
119000           , :RCT00019-GP-AMT                                     13048055
119100           , :RCT00019-GP-QTY                                     13049055
119200         FROM RCT_PRC_RCPT                                        13050055
119300         WHERE ORD_NBR          = :DK-ORD-NBR                     13060055
119400           AND ORD_LNE_NBR      = :DK-ORD-LNE-NBR                 13070055
119500           AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR                 13080055
119600           AND OPER_UNT_ID      = :RECEIV-OPER-UNT-ID             13090055
119700           AND FCLTY_ID         = :RECEIV-FCLTY-ID                13100055
119800           AND PRC_RCPT_TYP_CDE = 'VE'                            13110055
119900           AND AMT_TYP_CDE      = 'R'                             13120055
120000     END-EXEC                                                     13130055
120100                                                                  13140055
120200     EVALUATE TRUE                                                13150055
120300         WHEN SQLCODE = ZERO                                      13160055
120400             IF RCT00019-GP-QTY > 1                               13170055
120500                 DIVIDE RCT00019-GP-AMT BY RCT00019-GP-QTY        13180055
120600                      GIVING RC009-LOWST-UNIT-RTL-AMT             13190055
120700             ELSE                                                 13200055
120800                 MOVE RCT00019-UNT-AMT TO RC009-LOWST-UNIT-RTL-AMT13210055
120900             END-IF                                               13220055
121000             MOVE RCT00019-UNT-AMT     TO RC009-UNIT-RTL-AMT      13230055
121100         WHEN SQLCODE = +100                                      13240055
121200             IF RECITM-GP-QTY > 1                                 13250055
121300                 DIVIDE RECITM-GP-RTL-AMT BY RECITM-GP-QTY        13260055
121400                     GIVING RC009-LOWST-UNIT-RTL-AMT              13270055
121500             ELSE                                                 13280055
121600                 MOVE RECITM-UNT-RTL-AMT TO                       13290055
121700                                          RC009-LOWST-UNIT-RTL-AMT13300055
121800             END-IF                                               13310055
121900             MOVE RECITM-UNT-RTL-AMT     TO RC009-UNIT-RTL-AMT    13320055
122000         WHEN OTHER                                               13330055
122100              MOVE '7090-GET-RETAIL-DATA'                         13340055
122200                                  TO PV-ABEND-PARAGRAPH           13350055
122300              MOVE 'SELECT RCT_PRC_RCPT'                          13360055
122400                                  TO PV-ABEND-OPERATION           13370055
122500              MOVE 'RCT_PRC_RCPT' TO PV-ABEND-STRUCTURE-1         13380055
122600              MOVE 'CURRENT PO BEING PROCESSED ID:         '      13390055
122700                                  TO PV-DB2-OPERATION-MESSAGE-1   13400055
122800              MOVE DK-ORD-NBR                                     13410055
122900                                  TO PV-DB2-OPERATION-MESSAGE-2   13420055
123000              PERFORM 9900-DB2-ABEND                              13430055
123100     END-EVALUATE.                                                13440055
123200/                                                                 13450055
123300******    WR # 27201 - END                                        13450155
123400 8000-OPEN-XLT-LOC-CSR.                                           13450204
123500     EXEC SQL                                                     13450304
123600         OPEN XLT-LOC-CSR                                         13450404
123700     END-EXEC                                                     13450504
123800                                                                  13450604
123900     EVALUATE TRUE                                                13450704
124000         WHEN SQLCODE = ZERO                                      13450804
124100              CONTINUE                                            13450904
124200         WHEN SQLWARN0 NOT = SPACE                                13451004
124300         WHEN SQLCODE  NOT = ZERO                                 13451104
124400             MOVE '8000-OPEN-XLT-LOC-CSR'                         13451204
124500                                 TO PV-ABEND-PARAGRAPH            13451304
124600             MOVE 'OPEN XLT-LOC CURSOR'                           13451404
124700                               TO PV-ABEND-OPERATION              13451504
124800             MOVE 'XLT-LOC'   TO PV-ABEND-STRUCTURE-1             13451604
124900             MOVE SPACES      TO PV-ABEND-STRUCTURE-2             13451704
125000             PERFORM 9900-DB2-ABEND                               13451804
125100     END-EVALUATE.                                                13451904
125200/                                                                 13452004
125300 8200-FETCH-XLT-LOC-CSR.                                          13452104
125400     EXEC SQL                                                     13452204
125500          FETCH XLT-LOC-CSR                                       13452304
125600             INTO :XLT00010-LOC-NBR                               13452404
125700     END-EXEC.                                                    13452504
125800                                                                  13452604
125900     EVALUATE TRUE                                                13452704
126000         WHEN SQLCODE = ZERO                                      13452804
126100              CONTINUE                                            13452904
126200         WHEN SQLCODE = +100                                      13453004
126300              SET PS-EOF-XLT-LOC-CSR TO TRUE                      13453104
126400         WHEN SQLWARN0 NOT = SPACE                                13453204
126500         WHEN SQLCODE  NOT = +0                                   13453304
126600              MOVE '8200-FETCH-XLT-LOC-CSR'                       13453404
126700                                   TO PV-ABEND-PARAGRAPH          13453504
126800              MOVE 'FETCH XLT-LOC CURSOR'                         13453604
126900                                   TO PV-ABEND-OPERATION          13453704
127000              MOVE 'XLT-LOC'       TO PV-ABEND-STRUCTURE-1        13453804
127100              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        13453904
127200              PERFORM 9900-DB2-ABEND                              13454004
127300     END-EVALUATE.                                                13454104
127400/                                                                 13454204
127500 8400-LOAD-STORE-TABLE.                                           13454355
127600     MOVE XLT00010-LOC-NBR TO PC-STORE-NMBR (PC-STR-IDX).         13454455
127700     PERFORM 8200-FETCH-XLT-LOC-CSR.                              13454555
127800/                                                                 13454604
127900 8600-CLOSE-XLT-LOC-CSR.                                          13454704
128000     EXEC SQL                                                     13454804
128100         CLOSE XLT-LOC-CSR                                        13454904
128200     END-EXEC                                                     13455004
128300                                                                  13455104
128400     EVALUATE TRUE                                                13455204
128500         WHEN SQLCODE = ZERO                                      13455304
128600             CONTINUE                                             13455404
128700         WHEN SQLCODE NOT = ZERO                                  13455504
128800             MOVE '8600-CLOSE-XLT-LOC-CSR'                        13455604
128900                                  TO PV-ABEND-PARAGRAPH           13455704
129000             MOVE 'CLOSE XLT-LOC CURSOR'                          13455804
129100                                  TO PV-ABEND-OPERATION           13455904
129200             MOVE 'XLT-LOC'   TO PV-ABEND-STRUCTURE-1             13456004
129300             MOVE SPACES      TO PV-ABEND-STRUCTURE-2             13456104
129400             PERFORM 9900-DB2-ABEND                               13456204
129500     END-EVALUATE.                                                13456304
129600/                                                                 13456404
129700 9000-END-OF-JOB.                                                 13456507
129800     IF PV-RECS-READ-COUNTER = ZERO                               13456607
129900         CLOSE RECEIPT-AUDIT-SUM-FILE                             13456707
130000     ELSE                                                         13456807
130100         CLOSE RECEIPT-AUDIT-SUM-FILE                             13456907
130200               UPDATED-AUDIT-SUM-FILE                             13457007
130300               RC009-FILE                                         13457107
130400     END-IF.                                                      13457207
130500                                                                  13457307
130600     MOVE PV-RECS-READ-COUNTER TO PV-DISPLAY-NUMBER               13457407
130700     DISPLAY 'SUMMARY RECORDS READ            = '                 13457507
130800                                      PV-DISPLAY-NUMBER.          13457655
130900                                                                  13457704
131000     MOVE PV-SUMM-RECS-WRITTEN TO PV-DISPLAY-NUMBER               13457807
131100     DISPLAY 'UPDATED SUMMARY RECORDS WRITTEN = '                 13457907
131200                                      PV-DISPLAY-NUMBER.          13458055
131300                                                                  13458104
131400     MOVE PV-RC09-RECS-WRITTEN TO PV-DISPLAY-NUMBER               13458207
131500     DISPLAY 'RCRD009 RECORDS WRITTEN         = '                 13458307
131600                                      PV-DISPLAY-NUMBER.          13458455
131700                                                                  13458504
131800 9900-DB2-ABEND.                                                  13458604
131900                                                                  13458704
132000     MOVE SQLCODE TO PV-SQLCODE.                                  13458804
132100     DISPLAY '*** DB2 ERROR '.                                    13458904
132200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       13459004
132300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 13459104
132400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               13459204
132500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               13459304
132600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       13459404
132700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       13459504
132800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       13459604
132900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             13459704
133000                                                                  13459804
133100     IF PV-ABEND-STRUCTURE-2 > SPACES                             13459904
133200         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          13460004
133300     END-IF.                                                      13460104
133400                                                                  13460204
133500                                                                  13460304
133600     COPY DPPD004.                                                13460404
133700                                                                  13460504
133800     IF SQLCODE NOT = -911                                        13460604
133900         EXEC SQL                                                 13460704
134000              ROLLBACK                                            13460804
134100         END-EXEC                                                 13460904
134200     END-IF.                                                      13461004
134300                                                                  13461104
134400     MOVE +4013                  TO PV-ABEND-CODE.                13461204
134500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13461304
134600*                                                                 13461404
134700 9200-ABEND.                                                      13461504
134800******************************************************************13470004
134900*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       13480004
135000******************************************************************13490004
135100     DISPLAY '***************************'.                       13500004
135200     DISPLAY '**       ABEND           **'.                       13510004
135300     DISPLAY '**  IN PROGRAM RVKCS001  **'.                       13520004
135400     DISPLAY '***************************'.                       13530004
135500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        13540004
135600     DISPLAY '**   ERROR         ** = ' DP003-RETURN-MSG.         13550004
135700     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       13560004
135800     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       13570004
135900                                                                  13580004
136000     MOVE +4014                  TO PV-ABEND-CODE.                13590004
136100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13600004
136200*                                                                 13610004
