00001  ID  DIVISION.                                                    05/31/95
00002  PROGRAM-ID.         ETKUP036.                                    ETKUP036
00003  AUTHOR.             STEVE FLUNKER.                                  LV027
00004  INSTALLATION.       KOHLS DEPARTMENT STORES.                     ETKUP036
00005  DATE-WRITTEN.       APR 1995.                                    ETKUP036
00006  DATE-COMPILED.                                                   ETKUP036
00007                                                                   ETKUP036
00008 ******************************************************************ETKUP036
00009 *  ETKUP036 - INVOICE/UPC RECYCLE UTILITY                         ETKUP036
00010 *  WORK REQUEST #  - 3044                                         ETKUP036
00011 ******************************************************************ETKUP036
00012 *  THIS PROGRAM WILL VALIDATE INCOMING INVOICES                   ETKUP036
00013 ******************************************************************ETKUP036
JF0602*  DATE  06/19/02                                                         
JF0602*  CHANGE MADE:                                                           
JF0602*   ADDED A DISPLAY OF THE INVOICE NUMBER TO BETTER FACILITATE            
JF0602*   ABEND RESOLUTION.                                                     
JF0602*  MADE BY: JON FIEDLER JF0602      WR# : 22855                           
************************************************************************        
JF0403*  DATE  05/01/2003                                                       
JF0403*  CHANGE MADE:                                                           
JF0403*   UPDATED PROGRAM SO IT IS COMPLIANT WITH NI-SKU OBJECTIVES.            
JF0403*  MADE BY: JON FIEDLER             WR# : 22777                           
************************************************************************        
JF0703*  DATE  07/16/2003                                                       
JF0703*  CHANGE MADE:                                                           
JF0703*   MADE CHANGES TO SUPPORT THE PROCESSING OF COMPOUND PACK               
JF0703*   INVOICES. THE PROGRAM IS UPDATED TO PROCESS THE NEW RECORD            
JF0703*   TYPES 08 AND 09. ALSO AP NO LONGER REQUIRES THE ET ONHOLD             
JF0703*   PROCESS TO PERFORM VERIFICATION ON THE UPC NUMBER. THIS               
JF0703*   LOGIC WAS COMMENTED OUT AS A RESULT.                                  
JF0703*  MADE BY: JON FIEDLER             WR# : 24764                           
************************************************************************        
C94517*  CHANGED 11/05/2014    BY COGNIZANT       WR: CHG0094517                
C94517*                                                                         
C94517* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                           
************************************************************************        
022015*  CHANGED 02/06/2015    BY JIM ARENDT      WR: CHG0104132                
022015*                                                                         
022015* COMMENTED OUT LEADING ZEROS IN WS-CNVRTD-PO-NBR. ALSO, ADDED            
022015* DISPLAY OF PROGRAM TOTAL COUNTS.                                        
************************************************************************        
00014 *                                                                 ETKUP036
00015  ENVIRONMENT DIVISION.                                            ETKUP036
00016 *                                                                 ETKUP036
00017  CONFIGURATION SECTION.                                           ETKUP036
00018 *                                                                 ETKUP036
00019  SOURCE-COMPUTER.        IBM-3090.                                ETKUP036
00020  OBJECT-COMPUTER.        IBM-3090.                                ETKUP036
00021 *                                                                 ETKUP036
00022  INPUT-OUTPUT SECTION.                                            ETKUP036
00023  FILE-CONTROL.                                                    ETKUP036
00024      SELECT INV-INPUT-FILE                                        ETKUP036
00025          ASSIGN TO INP01.                                         ETKUP036
00026                                                                   ETKUP036
00027      SELECT INV-STATUS-FILE                                       ETKUP036
00028          ASSIGN TO OUT01.                                         ETKUP036
00029                                                                   ETKUP036
00030  DATA DIVISION.                                                   ETKUP036
00031  FILE SECTION.                                                    ETKUP036
00032                                                                   ETKUP036
00033  FD  INV-INPUT-FILE                                               ETKUP036
00034      LABEL RECORDS ARE STANDARD                                   ETKUP036
00035      RECORDING MODE IS F                                          ETKUP036
00036      BLOCK CONTAINS 0 RECORDS                                     ETKUP036
00037      RECORD CONTAINS 350 CHARACTERS                               ETKUP036
00038      DATA RECORD IS INV-INPUT-RECORD.                             ETKUP036
00039                                                                   ETKUP036
00040  01  INV-INPUT-RECORD.                                               CL**3
00041      COPY APRD050.                                                   CL*27
00042                                                                   ETKUP036
00043  FD  INV-STATUS-FILE                                              ETKUP036
00044      LABEL RECORDS ARE STANDARD                                   ETKUP036
00045      RECORDING MODE IS F                                          ETKUP036
00046      BLOCK CONTAINS 0 RECORDS                                     ETKUP036
00047      RECORD CONTAINS 350 CHARACTERS                                  CL**3
00048      DATA RECORD IS INV-INPUT-RECORD.                             ETKUP036
00049                                                                   ETKUP036
00050  01  INV-STATUS-RECORD.                                              CL**3
00051      05 INV-STATUS-KEY              PIC X(50).                       CL**3
00052      05 INV-STATUS-DATA             PIC X(300).                      CL**3
00053                                                                   ETKUP036
00054                                                                   ETKUP036
00055  WORKING-STORAGE SECTION.                                         ETKUP036
00056 *                                                                 ETKUP036
00057  01  WS-WORKING-STORAGE.                                          ETKUP036
00058      05  WS-NOSKU.                                                ETKUP036
00059          10  FILLER                 PIC X(05) VALUE 'NOSKU'.      ETKUP036
00060          10  WS-NOSKU-CNT           PIC 9(03) VALUE ZERO.         ETKUP036
00061                                                                   ETKUP036
00062      05  WS-KEY-SAVE-AREA           PIC X(50)  VALUE SPACES.         CL**3
00063      05  WS-DATA-SAVE-AREA          PIC X(300) VALUE SPACES.         CL**3
00064      05  WS-KEY-RECORD.                                              CL**3
C94517         10  WS-PO-NBR              PIC 9(09) VALUE ZERO.            CL**2
00066          10  WS-INVOICE-NBR         PIC X(22) VALUE ZERO.            CL**3
00067          10  WS-RECORD-TYPE         PIC X(02) VALUE SPACES.          CL**2
00068          10  WS-FILLER              PIC X(01) VALUE SPACE.           CL**2
00069          10  WS-SEQ-NBR             PIC X(05) VALUE SPACES.          CL**2
C94517         10  WS-FILLER              PIC X(11) VALUE SPACE.           CL**3
00071      05  WS-DATA-AREA               PIC X(300) VALUE SPACES.         CL**3
00072      05  WS-PURCHS-PO-NBR           PIC S9(9) COMP.                  CL**6
00073      05  WS-HELD-PO-NBR             PIC X(30) VALUE SPACES.          CL*15
00074      05  WS-CNVRTD-PO-NBR.                                           CL*15
022015*        10  FILLER                 PIC X(2)  VALUE '00'.            CL*14
C94517         10  WS-PO-NBR-CONVERT      PIC X(9)  VALUE SPACES.          CL*14
C94517         10  FILLER                 PIC X(21) VALUE SPACES.          CL*14
00078      05  WS-UNUPCS-UPC              PIC S9(15)V COMP-3.              CL**6
00079      05  WS-TP-ID-QUAL              PIC X(02) VALUE SPACES.          CL*11
JF0403     05  WS-SKU                     PIC X(08) VALUE SPACES.               
00080      05  WS-TP-ID                   PIC X(15) VALUE SPACES.          CL*11
00081 *                                                                 ETKUP036
00082  01  PV-PROGRAM-VARIABLES.                                        ETKUP036
00083      05  PV-PARAGRAPH-NAME       PIC  X(30)   VALUE SPACES.       ETKUP036
00084      05  PV-DB2-OPER-ATTEMPTED   PIC  X(30)   VALUE SPACES.       ETKUP036
00085      05  PV-SQL-SUB              PIC  9(03)   VALUE ZERO.         ETKUP036
00086 *                                                                 ETKUP036
00087  01  PC-PROGRAM-CONSTANTS.                                        ETKUP036
00088      05  PC-MAX-RETRIES          PIC S9(03)   VALUE +03           ETKUP036
00089                                               COMP-3.             ETKUP036
00090 *                                                                 ETKUP036
00091  01  PS-PROGRAM-SWITCHES.                                            CL**4
00092      05  PS-END-OF-FILE             PIC X     VALUE 'N'.          ETKUP036
00093          88  PS-EOF                           VALUE 'Y'.          ETKUP036
00094      05  PS-FIRST-HEADER            PIC X     VALUE 'Y'.          ETKUP036
00095          88  FIRST-HEADER                     VALUE 'Y'.          ETKUP036
00096          88  PAST-FIRST-HEADER                VALUE 'N'.          ETKUP036
00097      05  PS-UPC-CATALOG-NOT-NEEDED  PIC X     VALUE 'Y'.          ETKUP036
00098          88  UPC-CATALOG-NOT-NEEDED           VALUE 'Y'.          ETKUP036
00099          88  UPC-CATALOG-NEEDED               VALUE 'N'.          ETKUP036
00100      05  PS-ALL-UPCS-ON-PO          PIC X     VALUE 'Y'.             CL**3
00101          88  ALL-UPCS-ON-PO                   VALUE 'Y'.             CL**3
00102          88  ALL-UPCS-NOT-ON-PO               VALUE 'N'.             CL**7
00103      05  PS-ALL-GOOD-UPCS           PIC X     VALUE 'Y'.          ETKUP036
00104          88  ALL-GOOD-UPCS                    VALUE 'Y'.          ETKUP036
00105          88  NOT-ALL-GOOD-UPCS                VALUE 'N'.          ETKUP036
00106      05  PS-PO-FOUND                PIC X     VALUE 'Y'.             CL**3
00107          88  PO-FOUND                         VALUE 'Y'.             CL**3
00108          88  PO-NOT-FOUND                     VALUE 'N'.             CL**3
00109      05  PS-UPC-EXISTS              PIC X     VALUE 'Y'.             CL**6
00110          88  UPC-EXISTS                       VALUE 'Y'.             CL**6
00111          88  NO-UPC-EXISTS                    VALUE 'N'.             CL**6
00112 *                                                                 ETKUP036
022015 01  PA-PROGRAM-ACCUMULATORS.                                             
022015     05  PA-ROWS-READ               PIC 9(07)   VALUE ZEROES.             
022015     05  PA-ROWS-WROTE              PIC 9(07)   VALUE ZEROES.             
022015     05  PA-TFGTRHL-NOT-FOUND       PIC 9(07)   VALUE ZEROES.     ETKUP038
022015     05  PA-TPURCHS-NOT-FOUND       PIC 9(07)   VALUE ZEROES.     ETKUP038
022015     05  PA-EDIT-FIELD              PIC ZZZZZZ9.                  ETKUP038
                                                                                
00113 ******************************************************************ETKUP036
00114 *  SQL ABEND WORKING STORAGE                                      ETKUP036
00115 ******************************************************************ETKUP036
00116      COPY DPWS004.                                                ETKUP036
00117      EJECT                                                        ETKUP036
00118 *                                                                 ETKUP036
00119 ***************************************************************** ETKUP036
00120 *****  DB2 FUNCTIONAL GROUP ON HOLD TABLE DCLGEN                     CL**5
00121 ***************************************************************** ETKUP036
00122 *                                                                 ETKUP036
00123      EXEC SQL                                                     ETKUP036
00124          INCLUDE TFGTRHL                                             CL**5
00125      END-EXEC.                                                    ETKUP036
00126 *                                                                    CL**5
JF0403*****************************************************************    CL**5
JF0403*****  DB2 SKU CROSS REFERENCE TABLE DCLGEN                          CL**5
JF0403*****************************************************************    CL**5
JF0403                                                                     CL**5
JF0403     EXEC SQL                                                        CL**5
JF0403         INCLUDE TSKXREF                                             CL**5
JF0403     END-EXEC.                                                       CL**5
JF0403*                                                                 ETKUP036
00135 ***************************************************************** ETKUP036
00136 *****  DB2 PO TABLE DCLGEN                                        ETKUP036
00137 ***************************************************************** ETKUP036
00138 *                                                                 ETKUP036
00139      EXEC SQL                                                     ETKUP036
00140          INCLUDE TPURCHS                                          ETKUP036
00141      END-EXEC.                                                    ETKUP036
00142 *                                                                    CL*10
00143 *****************************************************************    CL*10
00144 *****  DB2 PURITM TABLE DCLGEN                                       CL*10
00145 *****************************************************************    CL*10
00146 *                                                                    CL*10
00147      EXEC SQL                                                        CL*10
00148          INCLUDE TPURITM                                             CL*10
00149      END-EXEC.                                                       CL*10
00150 *                                                                 ETKUP036
00151 ***************************************************************** ETKUP036
00152 *****  DB2 UPC / SKU TABLE DCLGEN                                 ETKUP036
00153 ***************************************************************** ETKUP036
00154 *                                                                 ETKUP036
00155      EXEC SQL                                                     ETKUP036
00156          INCLUDE TUPCSKU                                          ETKUP036
00157      END-EXEC.                                                    ETKUP036
00158 *                                                                 ETKUP036
00159 ***************************************************************** ETKUP036
00160 *****  DB2 EDI UPC LOOKUP TABLE DCLGEN                            ETKUP036
00161 ***************************************************************** ETKUP036
00162 *                                                                 ETKUP036
00163      EXEC SQL                                                     ETKUP036
00164          INCLUDE TUNUPCS                                          ETKUP036
00165      END-EXEC.                                                    ETKUP036
00166 *                                                                 ETKUP036
00167 ***************************************************************** ETKUP036
00168 *****  DB2 EDI NETWORK / VENDOR TABLE DCLGEN                      ETKUP036
00169 ***************************************************************** ETKUP036
00170 *                                                                 ETKUP036
00171      EXEC SQL                                                     ETKUP036
00172          INCLUDE TNETVND                                          ETKUP036
00173      END-EXEC.                                                    ETKUP036
00174 *                                                                 ETKUP036
00175 ***************************************************************** ETKUP036
00176 *****  DB2 EDI TRADING PARTNER TABLE DCLGEN                       ETKUP036
00177 ***************************************************************** ETKUP036
00178 *                                                                 ETKUP036
00179      EXEC SQL                                                     ETKUP036
00180          INCLUDE TTRDPRT                                          ETKUP036
00181      END-EXEC.                                                    ETKUP036
00182 *                                                                 ETKUP036
00183 ***************************************************************** ETKUP036
00184 * DB2 COMMUNICATIONS AREA                                         ETKUP036
00185 ***************************************************************** ETKUP036
00186                                                                   ETKUP036
00187      EXEC SQL                                                     ETKUP036
00188          INCLUDE SQLCA                                            ETKUP036
00189      END-EXEC.                                                    ETKUP036
00190 *                                                                 ETKUP036
00191      COPY SQLCA2.                                                 ETKUP036
00192                                                                   ETKUP036
00193  01  ABEND-CODE               PIC S9(04)  VALUE ZERO              ETKUP036
00194                                           COMP SYNC.              ETKUP036
00195      EJECT                                                        ETKUP036
00196  LINKAGE SECTION.                                                 ETKUP036
00197 *                                                                 ETKUP036
00198  PROCEDURE DIVISION.                                              ETKUP036
00199 *                                                                 ETKUP036
00200 ******************************************************************ETKUP036
00201 * MAIN-LINE LOGIC.                                                ETKUP036
00202 ******************************************************************ETKUP036
00203  A100-MAIN-MODULE.                                                ETKUP036
00204 *                                                                 ETKUP036
00205      OPEN INPUT  INV-INPUT-FILE.                                  ETKUP036
00206      OPEN OUTPUT INV-STATUS-FILE.                                 ETKUP036
00207 *                                                                 ETKUP036
00208      PERFORM Z100-READ-INPUT-FILE.                                ETKUP036
00209 *                                                                 ETKUP036
00210      SET UPC-CATALOG-NOT-NEEDED TO TRUE.                          ETKUP036
00211      SET FIRST-HEADER TO TRUE.                                    ETKUP036
00212 *                                                                 ETKUP036
00213      PERFORM B100-PROCESS-INV-FILE                                ETKUP036
00214              UNTIL PS-EOF.                                        ETKUP036
00215 *                                                                 ETKUP036
JF0703*    PERFORM B200-WRAPUP-INV-FILE.                                ETKUP036
00217 *                                                                 ETKUP036
00218      IF UPC-CATALOG-NEEDED                                        ETKUP036
00219         MOVE 4060 TO RETURN-CODE                                  ETKUP036
00220      END-IF.                                                      ETKUP036
00221 *                                                                 ETKUP036
022015     DISPLAY ' '.                                                         
022015     DISPLAY '    PROGRAM ETKUP036 TOTALS'.                               
022015     MOVE PA-ROWS-READ                TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS READ.................: '                     
022015                                         PA-EDIT-FIELD.                   
022015                                                                          
022015     MOVE PA-ROWS-WROTE               TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS WRITTEN..............: '                     
022015                                         PA-EDIT-FIELD.                   
022015                                                                          
022015     MOVE PA-TPURCHS-NOT-FOUND        TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS NOT FOUND ON TPURCHS.: '                     
022015                                         PA-EDIT-FIELD.           ETKUP038
022015                                                                          
022015     MOVE PA-TFGTRHL-NOT-FOUND        TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS NOT FOUND ON TFGTRHL.: '                     
022015                                         PA-EDIT-FIELD.           ETKUP038
                                                                                
00222      CLOSE INV-INPUT-FILE                                         ETKUP036
00223            INV-STATUS-FILE.                                       ETKUP036
00224      STOP RUN.                                                    ETKUP036
00225 *                                                                 ETKUP036
00226 ******************************************************************ETKUP036
00227 *  PROCESS ALL PO RECORDS FROM INPUT FILE.                        ETKUP036
00228 ******************************************************************ETKUP036
00229  B100-PROCESS-INV-FILE.                                           ETKUP036
00230 *                                                                 ETKUP036
00231       IF AP050-INV-INTRCHG                                           CL**3
00232                                                                   ETKUP036
00233 * MOVE NEW HEADER TO SAVE AREA                                    ETKUP036
00234          MOVE AP050-KEY       TO WS-KEY-SAVE-AREA                    CL*16
00235          MOVE AP050-DATA-AREA TO WS-DATA-SAVE-AREA                   CL*16
00236 *                                                                    CL**3
JF0703*        IF FIRST-HEADER                                          ETKUP036
JF0703*           SET PAST-FIRST-HEADER TO TRUE                         ETKUP036
JF0703*        ELSE                                                     ETKUP036
JF0703*                                                                    CL**8
JF0703* MOVE OLD HEADER TO APRD HEADER TO WRAP UP THAT INVOICE             CL**3
JF0703*                                                                 ETKUP036
JF0703*           MOVE WS-KEY-RECORD TO AP050-KEY                          CL**8
JF0703*           MOVE WS-DATA-AREA  TO AP050-DATA-AREA                    CL**8
JF0703*                                                                    CL**8
JF0703*           IF ALL-GOOD-UPCS                                      ETKUP036
JF0703*              SET AP050-GOOD-UPCS TO TRUE                           CL**3
JF0703*           ELSE                                                  ETKUP036
JF0703*              SET AP050-BAD-UPCS TO TRUE                            CL**3
JF0703*           END-IF                                                ETKUP036
JF0703*                                                                    CL**3
JF0703*           IF ALL-UPCS-ON-PO                                        CL**3
JF0703*              SET AP050-UPCS-MATCH TO TRUE                          CL**3
JF0703*           ELSE                                                     CL**3
JF0703*              SET AP050-UPCS-NO-MATCH TO TRUE                       CL**3
JF0703*           END-IF                                                   CL**3
JF0703*                                                                    CL**3
JF0703*           IF PO-FOUND       AND                                    CL**3
JF0703*              ALL-GOOD-UPCS  AND                                    CL**3
JF0703*              ALL-UPCS-ON-PO                                        CL**3
JF0703*              SET AP050-NEW-INV-GOOD TO TRUE                        CL**3
JF0703*           ELSE                                                     CL**3
JF0703*              SET AP050-NEW-INV-BAD  TO TRUE                        CL**3
JF0703*           END-IF                                                   CL**3
JF0703*                                                                    CL**3
JF0703*           MOVE AP050-KEY       TO INV-STATUS-KEY                   CL**3
JF0703*           MOVE AP050-DATA-AREA TO INV-STATUS-DATA                  CL**3
JF0703*           PERFORM Z200-WRITE-OUTPUT-FILE                        ETKUP036
JF0703*                                                                    CL**3
JF0703*        END-IF                                                   ETKUP036
999999                                                                  ETKUP036
999999* MOVE NEW SAVED HEADER BACK INTO AP050                              CL**3
999999         MOVE WS-KEY-SAVE-AREA  TO AP050-KEY                         CL**4
999999         MOVE WS-DATA-SAVE-AREA TO AP050-DATA-AREA                   CL**4
999999                                                                  ETKUP036
999999         SET ALL-GOOD-UPCS     TO TRUE                            ETKUP036
999999         SET ALL-UPCS-ON-PO    TO TRUE                               CL**3
999999         SET PO-FOUND          TO TRUE                               CL**3
999999         MOVE AP050-EDI-SENDER-ID-QUAL TO WS-TP-ID-QUAL              CL**3
999999         MOVE AP050-EDI-SENDER-ID      TO WS-TP-ID                   CL**3
999999                                                                     CL**4
999999         MOVE AP050-KOHLS-PO-NBR TO WS-PURCHS-PO-NBR                 CL**6
999999         PERFORM C100-VERIFY-PO-NBR                                  CL**4
999999         IF SQLCODE = +000                                           CL**4
999999            MOVE PURCHS-STATUS-CDE TO AP050-PO-STATUS                CL**4
999999            MOVE PURCHS-DEPT-NBR   TO AP050-DEPT-NBR-ON-PO           CL*18
999999         ELSE                                                        CL**4
999999            IF SQLCODE = +100                                        CL**4
022015               ADD 1  TO PA-TPURCHS-NOT-FOUND                     ETKUP038
999999               SET PO-NOT-FOUND TO TRUE                              CL**5
999999               MOVE AP050-KOHLS-PO-NBR TO WS-PO-NBR-CONVERT          CL*16
999999               MOVE WS-CNVRTD-PO-NBR TO WS-HELD-PO-NBR               CL*15
999999               PERFORM C150-VERIFY-PO-NBR-NOT-HELD                   CL**8
999999               IF SQLCODE = +000 OR -811                             CL**5
999999                  SET AP050-PO-ON-HOLD TO TRUE                       CL**5
999999               ELSE                                                  CL**5
999999                  IF SQLCODE = +100                                  CL**5
022015                     ADD 1  TO PA-TFGTRHL-NOT-FOUND               ETKUP038
999999                     SET AP050-PO-NOT-FOUND TO TRUE                  CL*16
022015                     DISPLAY ' PO ' WS-PO-NBR-CONVERT                CL**5
022015                             ' NOT FOUND AND NOT ON HOLD'            CL**5
999999                  END-IF                                             CL**5
999999               END-IF                                                CL**5
999999            END-IF                                                   CL**5
999999         END-IF                                                      CL**5
999999                                                                     CL**4
999999         MOVE AP050-KOHLS-PO-NBR    TO WS-PO-NBR                     CL**6
999999         MOVE AP050-VENDOR-INVOICE-NBR                               CL**6
999999              TO WS-INVOICE-NBR                                      CL**6
999999         MOVE AP050-RECORD-TYPE-IND TO WS-RECORD-TYPE                CL**6
999999         MOVE AP050-EDI-SEQ-NBR     TO WS-SEQ-NBR                    CL**6
999999         MOVE AP050-DATA-AREA       TO WS-DATA-AREA                  CL**6
999999                                                                     CL**5
JF0703         PERFORM B200-WRAPUP-INV-FILE                                     
999999      END-IF.                                                     ETKUP036
JF0703*                                                                 ETKUP036
JF0703*     IF AP050-INV-DETAILS                                           CL**6
JF0703*        SET NO-UPC-EXISTS TO TRUE                                   CL**6
JF0703*        IF AP050-UPC                                                CL**6
JF0703*           SET UPC-EXISTS TO TRUE                                   CL**6
JF0703*                                                                    CL*12
JF0703*           MOVE AP050-UPC-CODE TO WS-UNUPCS-UPC                     CL*22
JF0703*           PERFORM C300-VERIFY-UPC-SKU                              CL*12
JF0703*        ELSE                                                        CL**6
JF0703*           IF AP050-EAN                                             CL**8
JF0703*              SET UPC-EXISTS TO TRUE                                CL**8
JF0703*              MOVE AP050-EAN-UPC TO WS-UNUPCS-UPC                   CL*13
JF0703*              PERFORM C400-VERIFY-EAN-SKU                           CL**8
JF0703*           END-IF                                                   CL**8
JF0703*        END-IF                                                      CL**8
JF0703*                                                                 ETKUP036
JF0703*        IF UPC-EXISTS                                               CL*23
JF0703*           IF SQLCODE = +000                                        CL*23
JF0703*              MOVE SKXREF-SKU TO WS-SKU                             CL*23
JF0703*              MOVE WS-SKU TO AP050-KOHLS-SKU                        CL*23
JF0703*              MOVE TUPCSKU-ITEM-NBR TO AP050-ITEM-NBR               CL*23
JF0703*              IF PO-FOUND                                           CL*23
JF0703*                 MOVE AP050-KOHLS-PO-NBR TO WS-PURCHS-PO-NBR        CL*23
JF0703*                 PERFORM C200-VERIFY-UPC-MATCHES                    CL*23
JF0703*                 IF SQLCODE = +000 OR -811                          CL*25
JF0703*                    SET AP050-LINE-MATCH TO TRUE                    CL*23
JF0703*                 ELSE                                               CL*23
JF0703*                    IF SQLCODE = +100                               CL*23
JF0703*                       SET AP050-NO-LINE-MATCH TO TRUE              CL*23
JF0703*                       SET ALL-UPCS-NOT-ON-PO  TO TRUE              CL*23
JF0703*                    END-IF                                          CL*23
JF0703*                 END-IF                                             CL*23
JF0703*              ELSE                                                  CL*23
JF0703*                 SET AP050-NO-LINE-MATCH TO TRUE                    CL*23
JF0703*                 SET ALL-UPCS-NOT-ON-PO  TO TRUE                    CL*23
JF0703*              END-IF                                                CL*23
JF0703*           ELSE                                                     CL*23
JF0703*              IF SQLCODE = +100                                     CL*23
JF0703*                 SET NOT-ALL-GOOD-UPCS TO TRUE                      CL*23
JF0703*                 SET AP050-NO-LINE-MATCH TO TRUE                    CL*23
JF0703*                 SET ALL-UPCS-NOT-ON-PO  TO TRUE                    CL*23
JF0703*                 MOVE '        ' TO AP050-KOHLS-SKU                 CL*23
JF0703*                                                                    CL*12
JF0703*                 IF AP050-UPC                                       CL*23
JF0703*                    MOVE AP050-UPC-CODE TO WS-UNUPCS-UPC            CL*23
JF0703*                 ELSE                                               CL*23
JF0703*                    MOVE AP050-EAN-CODE TO WS-UNUPCS-UPC            CL*23
JF0703*                 END-IF                                             CL*23
JF0703*                 PERFORM C500-VERIFY-UPC-ONLY                       CL*23
JF0703*                                                                    CL*12
JF0703*                 IF SQLCODE = +000                                  CL*23
JF0703*                    CONTINUE                                        CL*23
JF0703*                 ELSE                                               CL*23
JF0703*                    SET UPC-CATALOG-NEEDED TO TRUE                  CL*23
JF0703*                    PERFORM C600-FIND-WHICH-NETWORK                 CL*23
JF0703*                    IF SQLCODE = +000                               CL*23
JF0703*                       CONTINUE                                     CL*23
JF0703*                    ELSE                                            CL*23
JF0703*                       IF SQLCODE = +100 OR -811                    CL*23
JF0703*                          MOVE SPACES TO NETVND-NETWK-ID            CL*23
JF0703*                       ELSE                                         CL*23
JF0703*                          DISPLAY 'SQLCODE: ' SQLCODE               CL*23
JF0703*                          MOVE 'B100-PROCESS-INV-FILE'              CL*23
JF0703*                             TO PV-PARAGRAPH-NAME                   CL*23
JF0703*                          MOVE 'FIND WHICH NETOWRK FOR UPC'         CL*23
JF0703*                             TO PV-DB2-OPER-ATTEMPTED               CL*23
JF0703*                          PERFORM Z900-SQL-ABEND                    CL*23
JF0703*                       END-IF                                       CL*23
JF0703*                    END-IF                                          CL*23
JF0703*                    PERFORM C700-INSERT-UPC                         CL*23
JF0703*                    IF SQLCODE = +000                               CL*23
JF0703*                       EXEC SQL                                     CL*23
JF0703*                          COMMIT                                    CL*23
JF0703*                       END-EXEC                                     CL*23
JF0703*                    ELSE                                            CL*23
JF0703*                       DISPLAY 'SQLCODE: ' SQLCODE                  CL*23
JF0703*                       MOVE 'B100-PROCESS-INV-FILE'                 CL*23
JF0703*                          TO PV-PARAGRAPH-NAME                      CL*23
JF0703*                       MOVE 'INSERT UPC THEN COMMIT'                CL*23
JF0703*                          TO PV-DB2-OPER-ATTEMPTED                  CL*23
JF0703*                       PERFORM Z900-SQL-ABEND                       CL*23
JF0703*                    END-IF                                          CL*23
JF0703*                 END-IF                                          ETKUP036
JF0703*              ELSE                                               ETKUP036
JF0703*                 DISPLAY 'SQLCODE: ' SQLCODE                     ETKUP036
JF0703*                 MOVE 'B100-PROCESS-INV-FILE'                    ETKUP036
JF0703*                    TO PV-PARAGRAPH-NAME                         ETKUP036
JF0703*                 MOVE 'FIND UPC AND SKU'                         ETKUP036
JF0703*                    TO PV-DB2-OPER-ATTEMPTED                     ETKUP036
JF0703*                 PERFORM Z900-SQL-ABEND                          ETKUP036
JF0703*              END-IF                                             ETKUP036
JF0703*           END-IF                                                ETKUP036
JF0703*        END-IF                                                   ETKUP036
JF0703*        MOVE AP050-KEY       TO INV-STATUS-KEY                      CL**8
JF0703*        MOVE AP050-DATA-AREA TO INV-STATUS-DATA                     CL**8
JF0703*        PERFORM Z200-WRITE-OUTPUT-FILE                           ETKUP036
JF0703*     END-IF.                                                     ETKUP036
00407 *                                                                 ETKUP036
00408       IF AP050-INV-INVOICE-DATA  OR                                  CL**8
JF0703         AP050-INV-DETAILS       OR                                       
JF0703         AP050-INV-PACK-ITEMS    OR                                       
JF0703         AP050-INV-PKITEM-DESC   OR                                       
00409          AP050-INV-REMIT-TO      OR                                  CL**8
00410          AP050-INV-TERMS         OR                                  CL**8
00411          AP050-INV-ALLW-CHGS     OR                                  CL**8
00412          AP050-INV-SUMMARY                                           CL**8
00413          MOVE AP050-KEY       TO INV-STATUS-KEY                      CL**8
00414          MOVE AP050-DATA-AREA TO INV-STATUS-DATA                     CL**8
00415          PERFORM Z200-WRITE-OUTPUT-FILE                           ETKUP036
00416       END-IF.                                                     ETKUP036
00417 *                                                                 ETKUP036
00418       PERFORM Z100-READ-INPUT-FILE.                               ETKUP036
00419 *                                                                 ETKUP036
00420 ******************************************************************ETKUP036
00421 *  PROCESS ALL INV RECORDS FROM INPUT FILE.                          CL**8
00422 ******************************************************************ETKUP036
00423  B200-WRAPUP-INV-FILE.                                            ETKUP036
00424 *                                                                 ETKUP036
00425 * MOVE OLD HEADER TO PO002 HEADER TO WRAP UP THAT PO              ETKUP036
00426      MOVE WS-KEY-RECORD TO AP050-KEY.                                CL**8
00427      MOVE WS-DATA-AREA  TO AP050-DATA-AREA.                          CL**8
00428 *                                                                    CL**8
00429      IF ALL-GOOD-UPCS                                                CL**8
00430         SET AP050-GOOD-UPCS TO TRUE                                  CL**8
00431      ELSE                                                            CL**8
00432         SET AP050-BAD-UPCS TO TRUE                                   CL**8
00433      END-IF.                                                         CL**8
00434 *                                                                    CL**8
00435      IF ALL-UPCS-ON-PO                                               CL**8
00436         SET AP050-UPCS-MATCH TO TRUE                                 CL**8
00437      ELSE                                                            CL**8
00438         SET AP050-UPCS-NO-MATCH TO TRUE                              CL**8
00439      END-IF.                                                         CL**8
00440 *                                                                    CL**8
00441      IF PO-FOUND       AND                                           CL**8
00442         ALL-GOOD-UPCS  AND                                           CL**8
00443         ALL-UPCS-ON-PO                                               CL**8
00444         SET AP050-NEW-INV-GOOD TO TRUE                               CL**8
00445      ELSE                                                            CL**8
00446         SET AP050-NEW-INV-BAD  TO TRUE                               CL**8
00447      END-IF.                                                         CL**8
00448 *                                                                    CL**8
00449      MOVE AP050-KEY       TO INV-STATUS-KEY.                         CL**8
00450      MOVE AP050-DATA-AREA TO INV-STATUS-DATA.                        CL**8
00451      PERFORM Z200-WRITE-OUTPUT-FILE.                                 CL**8
00452 *                                                                 ETKUP036
00453 ******************************************************************ETKUP036
00454 *  VERIFY THAT THE PO IS VALID                                       CL**4
00455 ******************************************************************ETKUP036
00456  C100-VERIFY-PO-NBR.                                                 CL**5
00457 *                                                                 ETKUP036
00458      PERFORM                                                      ETKUP036
00459          WITH TEST AFTER                                          ETKUP036
00460          VARYING PV-SQL-SUB                                       ETKUP036
00461          FROM 1 BY 1                                              ETKUP036
00462          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP036
00463                    OR SQLCODE = 0                                 ETKUP036
00464                    OR SQLCODE = +100                              ETKUP036
00465                    OR SQLCODE = -811)                             ETKUP036
00466 *                                                                 ETKUP036
00467          EXEC SQL                                                 ETKUP036
00468              SELECT A.PO_NBR,                                        CL**4
00469                     A.STATUS_CDE,                                    CL**4
00470                     A.DEPT_NBR                                       CL**4
00471              INTO :PURCHS-PO-NBR,                                    CL**9
00472                   :PURCHS-STATUS-CDE,                                CL**5
00473                   :PURCHS-DEPT-NBR                                   CL**5
00474              FROM TPURCHS A                                       ETKUP036
00475              WHERE A.PO_NBR = :WS-PURCHS-PO-NBR AND                  CL**6
00476                    A.VER_STATUS_CDE = 'A'                            CL**4
00477          END-EXEC                                                 ETKUP036
00478 *                                                                 ETKUP036
00479          EVALUATE TRUE                                            ETKUP036
00480              WHEN SQLCODE = -904                                  ETKUP036
00481              WHEN SQLCODE = -911                                  ETKUP036
00482              WHEN SQLCODE = -811                                  ETKUP036
00483              WHEN SQLCODE = 100                                   ETKUP036
00484              WHEN SQLCODE = 0                                     ETKUP036
00485                  CONTINUE                                         ETKUP036
00486              WHEN SQLWARN NOT = SPACES                            ETKUP036
00487              WHEN SQLCODE NOT = ZERO                              ETKUP036
00488                  MOVE 'C100-VERIFY-PO-NBR'                           CL**4
00489                                TO  PV-PARAGRAPH-NAME              ETKUP036
00490                  MOVE 'VERIFY PO NUMBER'                          ETKUP036
00491                                TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
00492                  PERFORM Z900-SQL-ABEND                           ETKUP036
00493          END-EVALUATE                                             ETKUP036
00494      END-PERFORM.                                                 ETKUP036
00495 *                                                                 ETKUP036
00496      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP036
00497          MOVE 'C100-VERIFY-PO-NBR'                                   CL**4
00498                                TO  PV-PARAGRAPH-NAME              ETKUP036
00499          MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP036
00500                                TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
00501          PERFORM Z900-SQL-ABEND                                   ETKUP036
00502      END-IF.                                                      ETKUP036
00503 *                                                                    CL**5
00504 ******************************************************************   CL**5
00505 *  VERIFY THAT THE PO IS NOT ON HOLD                                 CL**5
00506 ******************************************************************   CL**5
00507  C150-VERIFY-PO-NBR-NOT-HELD.                                        CL**8
00508 *                                                                    CL**5
00509      PERFORM                                                         CL**5
00510          WITH TEST AFTER                                             CL**5
00511          VARYING PV-SQL-SUB                                          CL**5
00512          FROM 1 BY 1                                                 CL**5
00513          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                          CL**5
00514                    OR SQLCODE = 0                                    CL**5
00515                    OR SQLCODE = +100                                 CL**5
00516                    OR SQLCODE = -811)                                CL**5
00517 *                                                                    CL**5
00518          EXEC SQL                                                    CL**5
00519              SELECT A.TRN_DTL_TXT                                    CL**5
00520              INTO :FGTRHL-TRN-DTL-TXT                                CL**5
00521              FROM TFGTRHL A                                          CL**5
00522              WHERE A.TRN_DTL_TXT = :WS-HELD-PO-NBR AND               CL*15
00523                    A.TRN_SET_CDE = '855'                             CL**5
00524          END-EXEC                                                    CL**5
00525 *                                                                    CL**5
00526          EVALUATE TRUE                                               CL**5
00527              WHEN SQLCODE = -904                                     CL**5
00528              WHEN SQLCODE = -911                                     CL**5
00529              WHEN SQLCODE = -811                                     CL**5
00530              WHEN SQLCODE = 100                                      CL**5
00531              WHEN SQLCODE = 0                                        CL**5
00532                  CONTINUE                                            CL**5
00533              WHEN SQLWARN NOT = SPACES                               CL**5
00534              WHEN SQLCODE NOT = ZERO                                 CL**5
00535                  MOVE 'C150-VERIFY-PO-NBR-NOT-HELD'                  CL**8
00536                                TO  PV-PARAGRAPH-NAME                 CL**5
00537                  MOVE 'VERIFY PO NUMBER'                             CL**5
00538                                TO  PV-DB2-OPER-ATTEMPTED             CL**5
00539                  PERFORM Z900-SQL-ABEND                              CL**5
00540          END-EVALUATE                                                CL**5
00541      END-PERFORM.                                                    CL**5
00542 *                                                                    CL**5
00543      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                           CL**5
00544          MOVE 'C150-VERIFY-PO-NBR-NOT-HELD'                          CL*14
00545                                TO  PV-PARAGRAPH-NAME                 CL**5
00546          MOVE 'VERIFY RETRIES EXCEEDED'                              CL**5
00547                                TO  PV-DB2-OPER-ATTEMPTED             CL**5
00548          PERFORM Z900-SQL-ABEND                                      CL**5
00549      END-IF.                                                         CL**5
00550 *                                                                    CL**7
JF0703******************************************************************   CL**7
JF0703*  VERIFY THAT THE UPC HAS A MATCH ON THE PO                         CL**7
JF0703******************************************************************   CL**7
JF0703*C200-VERIFY-UPC-MATCHES.                                            CL**8
JF0703*                                                                    CL**7
JF0703*    PERFORM                                                         CL**7
JF0703*        WITH TEST AFTER                                             CL**7
JF0703*        VARYING PV-SQL-SUB                                          CL**7
JF0703*        FROM 1 BY 1                                                 CL**7
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                          CL**7
JF0703*                  OR SQLCODE = 0                                    CL**7
JF0703*                  OR SQLCODE = +100                                 CL*26
JF0703*                  OR SQLCODE = -811)                                CL*26
JF0703*                                                                    CL**7
JF0703*        EXEC SQL                                                    CL**7
JF0703*            SELECT A.PO_NBR                                         CL**7
JF0703*            INTO :PURITM-PO-NBR                                     CL**7
JF0703*            FROM TPURITM A                                          CL**7
JF0703*            WHERE A.PO_NBR      = :WS-PURCHS-PO-NBR AND             CL**7
JF0703*                  A.VER_STATUS_CDE = 'A' AND                        CL**7
JF0703*                  A.ITM_NBR = :TUPCSKU-ITEM-NBR                     CL**7
JF0703*        END-EXEC                                                    CL**7
JF0703*                                                                    CL**7
JF0703*        EVALUATE TRUE                                               CL**7
JF0703*            WHEN SQLCODE = -904                                     CL**7
JF0703*            WHEN SQLCODE = -911                                     CL**7
JF0703*            WHEN SQLCODE = -811                                     CL*25
JF0703*            WHEN SQLCODE = 100                                      CL**7
JF0703*            WHEN SQLCODE = 0                                        CL**7
JF0703*                CONTINUE                                            CL**7
JF0703*            WHEN SQLWARN NOT = SPACES                               CL**7
JF0703*            WHEN SQLCODE NOT = ZERO                                 CL**7
JF0703*                MOVE 'C200-VERIFY-UPC-MATCHES'                      CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME                 CL**7
JF0703*                MOVE 'VERIFY UPC MATCHES'                           CL**7
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED             CL**7
JF0703*                PERFORM Z900-SQL-ABEND                              CL**7
JF0703*        END-EVALUATE                                                CL**7
JF0703*    END-PERFORM.                                                    CL**7
JF0703*                                                                    CL**7
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                           CL**7
JF0703*        MOVE 'C200-VERIFY-UPC-MATCHES'                              CL*14
JF0703*                              TO  PV-PARAGRAPH-NAME                 CL**7
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                              CL**7
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED             CL**7
JF0703*        PERFORM Z900-SQL-ABEND                                      CL**7
JF0703*    END-IF.                                                         CL**7
JF0703*                                                                 ETKUP036
JF0703******************************************************************ETKUP036
JF0703*  VERIFY THAT THE UPC AND SKU ARE ON THE APPROPRIATE TABLES      ETKUP036
JF0703******************************************************************ETKUP036
JF0703*C300-VERIFY-UPC-SKU.                                                CL**8
JF0703*                                                                 ETKUP036
JF0703*    PERFORM                                                      ETKUP036
JF0703*        WITH TEST AFTER                                          ETKUP036
JF0703*        VARYING PV-SQL-SUB                                       ETKUP036
JF0703*        FROM 1 BY 1                                              ETKUP036
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP036
JF0703*                  OR SQLCODE = 0                                 ETKUP036
JF0703*                  OR SQLCODE = +100)                             ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            SELECT SKU                                           ETKUP036
JF0703*                 , B.ITEM_NBR                                    ETKUP036
JF0703*            INTO :SKXREF-SKU                                     ETKUP036
JF0703*               , :TUPCSKU-ITEM-NBR                               ETKUP036
JF0703*            FROM TSKXREF A                                       ETKUP036
JF0703*               , TUPCSKU B                                               
JF0703*            WHERE B.UPC_NBR  = :WS-UNUPCS-UPC                       CL*12
JF0703*              AND A.ITM_NBR = B.ITEM_NBR                         ETKUP036
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EVALUATE TRUE                                            ETKUP036
JF0703*            WHEN SQLCODE = -904                                  ETKUP036
JF0703*            WHEN SQLCODE = -911                                  ETKUP036
JF0703*            WHEN SQLCODE = 100                                   ETKUP036
JF0703*            WHEN SQLCODE = 0                                     ETKUP036
JF0703*                CONTINUE                                         ETKUP036
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP036
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP036
JF0703*                MOVE 'C300-VERIFY-UPC-SKU'                          CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*                MOVE 'VERIFY UPCS AND SKUS'                      ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*                DISPLAY 'INV NUMBER = ' AP050-VENDOR-INVOICE-NBR         
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP036
JF0703*        END-EVALUATE                                             ETKUP036
JF0703*    END-PERFORM.                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP036
JF0703*        MOVE 'C300-VERIFY-UPC-SKU'                                  CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP036
JF0703*    END-IF.                                                      ETKUP036
JF0703*                                                                    CL**6
JF0703******************************************************************   CL**6
JF0703*  VERIFY THAT THE EAN AND SKU ARE ON THE APPROPRIATE TABLES         CL**6
JF0703******************************************************************   CL**6
JF0703*C400-VERIFY-EAN-SKU.                                                CL**8
JF0703*                                                                    CL**6
JF0703*    PERFORM                                                         CL**6
JF0703*        WITH TEST AFTER                                             CL**6
JF0703*        VARYING PV-SQL-SUB                                          CL**6
JF0703*        FROM 1 BY 1                                                 CL**6
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                          CL**6
JF0703*                  OR SQLCODE = 0                                    CL**6
JF0703*                  OR SQLCODE = +100)                                CL**6
JF0703*                                                                    CL**6
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            SELECT SKU                                           ETKUP036
JF0703*                 , B.ITEM_NBR                                    ETKUP036
JF0703*            INTO :SKXREF-SKU                                     ETKUP036
JF0703*               , :TUPCSKU-ITEM-NBR                               ETKUP036
JF0703*            FROM TSKXREF A                                       ETKUP036
JF0703*               , TUPCSKU B                                               
JF0703*            WHERE B.UPC_NBR  = :WS-UNUPCS-UPC                       CL*12
JF0703*              AND A.ITM_NBR = B.ITEM_NBR                         ETKUP036
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                    CL**6
JF0703*        EVALUATE TRUE                                               CL**6
JF0703*            WHEN SQLCODE = -904                                     CL**6
JF0703*            WHEN SQLCODE = -911                                     CL**6
JF0703*            WHEN SQLCODE = 100                                      CL**6
JF0703*            WHEN SQLCODE = 0                                        CL**6
JF0703*                CONTINUE                                            CL**6
JF0703*            WHEN SQLWARN NOT = SPACES                               CL**6
JF0703*            WHEN SQLCODE NOT = ZERO                                 CL**6
JF0703*                MOVE 'C400-VERIFY-EAN-SKU'                          CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME                 CL**6
JF0703*                MOVE 'VERIFY EAN AND SKUS'                          CL**7
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED             CL**6
JF0703*                PERFORM Z900-SQL-ABEND                              CL**6
JF0703*        END-EVALUATE                                                CL**6
JF0703*    END-PERFORM.                                                    CL**6
JF0703*                                                                    CL**6
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                           CL**6
JF0703*        MOVE 'C400-VERIFY-EAN-SKU'                                  CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME                 CL**6
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                              CL**6
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED             CL**6
JF0703*        PERFORM Z900-SQL-ABEND                                      CL**6
JF0703*    END-IF.                                                         CL**6
JF0703*                                                                 ETKUP036
JF0703******************************************************************ETKUP036
JF0703*  VERIFY THAT THE UPC IS ON THE UPC TABLE                        ETKUP036
JF0703******************************************************************ETKUP036
JF0703*C500-VERIFY-UPC-ONLY.                                               CL**8
JF0703*                                                                 ETKUP036
JF0703*    PERFORM                                                      ETKUP036
JF0703*        WITH TEST AFTER                                          ETKUP036
JF0703*        VARYING PV-SQL-SUB                                       ETKUP036
JF0703*        FROM 1 BY 1                                              ETKUP036
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP036
JF0703*                  OR SQLCODE = 0                                 ETKUP036
JF0703*                  OR SQLCODE = +100)                             ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            SELECT A.UPC_CDE                                     ETKUP036
JF0703*            INTO :UNUPCS-UPC-CDE                                 ETKUP036
JF0703*            FROM TUNUPCS A                                       ETKUP036
JF0703*            WHERE A.UPC_CDE  = :WS-UNUPCS-UPC                       CL*11
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EVALUATE TRUE                                            ETKUP036
JF0703*            WHEN SQLCODE = -904                                  ETKUP036
JF0703*            WHEN SQLCODE = -911                                  ETKUP036
JF0703*            WHEN SQLCODE = 100                                   ETKUP036
JF0703*            WHEN SQLCODE = 0                                     ETKUP036
JF0703*                CONTINUE                                         ETKUP036
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP036
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP036
JF0703*                MOVE 'C500-VERIFY-UPC-ONLY'                         CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*                MOVE 'VERIFY UPC ON TUNUPCS'                     ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP036
JF0703*        END-EVALUATE                                             ETKUP036
JF0703*    END-PERFORM.                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP036
JF0703*        MOVE 'C500-VERIFY-UPC-ONLY'                                 CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP036
JF0703*    END-IF.                                                      ETKUP036
JF0703*                                                                 ETKUP036
JF0703******************************************************************ETKUP036
JF0703*  FIND WHICH NETWORK THE UPC SHOULD BE LOOKED UP ON              ETKUP036
JF0703******************************************************************ETKUP036
JF0703*C600-FIND-WHICH-NETWORK.                                            CL**8
JF0703*                                                                 ETKUP036
JF0703*    PERFORM                                                      ETKUP036
JF0703*        WITH TEST AFTER                                          ETKUP036
JF0703*        VARYING PV-SQL-SUB                                       ETKUP036
JF0703*        FROM 1 BY 1                                              ETKUP036
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP036
JF0703*                  OR SQLCODE = 0                                 ETKUP036
JF0703*                  OR SQLCODE = +100                              ETKUP036
JF0703*                  OR SQLCODE = -811)                             ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            SELECT A.NETWK_ID                                    ETKUP036
JF0703*            INTO :NETVND-NETWK-ID                                ETKUP036
JF0703*            FROM TNETVND A,                                      ETKUP036
JF0703*                 TTRDPRT B                                       ETKUP036
JF0703*            WHERE B.VEND_INCHG_ID_DESC = :WS-TP-ID-QUAL AND      ETKUP036
JF0703*                  B.VEND_INCHG_ID      = :WS-TP-ID      AND      ETKUP036
JF0703*                  A.ENT_ID             = B.ENT_ID       AND      ETKUP036
JF0703*                  A.PREF_NETWK_SW_IND   = 'Y'                    ETKUP036
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EVALUATE TRUE                                            ETKUP036
JF0703*            WHEN SQLCODE = -904                                  ETKUP036
JF0703*            WHEN SQLCODE = -911                                  ETKUP036
JF0703*            WHEN SQLCODE = -811                                  ETKUP036
JF0703*            WHEN SQLCODE = 100                                   ETKUP036
JF0703*            WHEN SQLCODE = 0                                     ETKUP036
JF0703*                CONTINUE                                         ETKUP036
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP036
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP036
JF0703*                MOVE 'C600-FIND-WHICH-NETWORK'                      CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*                MOVE 'FIND WHICH NETWORK FOR UPC'                ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP036
JF0703*        END-EVALUATE                                             ETKUP036
JF0703*    END-PERFORM.                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP036
JF0703*        MOVE 'C600-FIND-WHICH-NETWORK'                              CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP036
JF0703*    END-IF.                                                      ETKUP036
JF0703*                                                                 ETKUP036
JF0703******************************************************************ETKUP036
JF0703*  INSERT UPC INTO THE TUNUPCS TABLE                              ETKUP036
JF0703******************************************************************ETKUP036
JF0703*C700-INSERT-UPC.                                                    CL**8
JF0703*                                                                 ETKUP036
JF0703*    PERFORM                                                      ETKUP036
JF0703*        WITH TEST AFTER                                          ETKUP036
JF0703*        VARYING PV-SQL-SUB                                       ETKUP036
JF0703*        FROM 1 BY 1                                              ETKUP036
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP036
JF0703*                  OR SQLCODE = 0)                                ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            INSERT INTO TUNUPCS                                  ETKUP036
JF0703*                   (UPC_CDE,                                     ETKUP036
JF0703*                    CRE_DTE,                                     ETKUP036
JF0703*                    PROD_ID,                                     ETKUP036
JF0703*                    PROD_DESC,                                   ETKUP036
JF0703*                    SIZE_CDE,                                    ETKUP036
JF0703*                    SIZE_DESC,                                   ETKUP036
JF0703*                    COLOR_CDE,                                   ETKUP036
JF0703*                    COLOR_DESC,                                  ETKUP036
JF0703*                    TRANS_IND,                                   ETKUP036
JF0703*                    UPC_CAT_VEND_ID,                             ETKUP036
JF0703*                    UPC_CAT_VEND_NME,                            ETKUP036
JF0703*                    CAT_UNMATCH_DTE,                             ETKUP036
JF0703*                    NETWK_ID,                                    ETKUP036
JF0703*                    SYST_ID,                                     ETKUP036
JF0703*                    PO_NBR,                                      ETKUP036
JF0703*                    TP_REQ_IND)                                  ETKUP036
JF0703*            VALUES (:WS-UNUPCS-UPC,                                 CL**8
JF0703*                    CURRENT DATE,                                ETKUP036
JF0703*                    '                    ',                      ETKUP036
JF0703*                    '                              ',            ETKUP036
JF0703*                    '     ',                                     ETKUP036
JF0703*                    '                    ',                      ETKUP036
JF0703*                    '   ',                                       ETKUP036
JF0703*                    '                    ',                      ETKUP036
JF0703*                    'Y',                                         ETKUP036
JF0703*                    '               ',                           ETKUP036
JF0703*                    '                                   ',       ETKUP036
JF0703*                    '9999-09-09',                                ETKUP036
JF0703*                    :NETVND-NETWK-ID,                            ETKUP036
JF0703*                    'RE',                                        ETKUP036
JF0703*                    +0,                                          ETKUP036
JF0703*                    'N')                                         ETKUP036
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*        EVALUATE TRUE                                            ETKUP036
JF0703*            WHEN SQLCODE = -904                                  ETKUP036
JF0703*            WHEN SQLCODE = -911                                  ETKUP036
JF0703*            WHEN SQLCODE = -811                                  ETKUP036
JF0703*            WHEN SQLCODE = 0                                     ETKUP036
JF0703*                CONTINUE                                         ETKUP036
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP036
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP036
JF0703*                DISPLAY 'UPC: ' WS-UNUPCS-UPC                            
JF0703*                MOVE 'C700-INSERT-UPC'                              CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*                MOVE 'INSERT UPC INTO TUNUPCS'                   ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP036
JF0703*        END-EVALUATE                                             ETKUP036
JF0703*    END-PERFORM.                                                 ETKUP036
JF0703*                                                                 ETKUP036
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP036
JF0703*        MOVE 'C700-INSERT-UPC'                                      CL**8
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP036
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP036
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP036
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP036
JF0703*    END-IF.                                                      ETKUP036
JF0703*                                                                 ETKUP036
00867 ******************************************************************ETKUP036
00868 * Z100-READ-INPUT-FILE                                            ETKUP036
00869 ******************************************************************ETKUP036
00870  Z100-READ-INPUT-FILE.                                            ETKUP036
00871 *                                                                 ETKUP036
00872      READ INV-INPUT-FILE                                             CL*16
00873             AT END SET PS-EOF TO TRUE.                            ETKUP036
                                                                                
022015     IF PS-EOF                                                            
022015        CONTINUE                                                          
022015     ELSE                                                                 
022015        ADD 1  TO PA-ROWS-READ                                            
022015     END-IF.                                                              
00874 *                                                                 ETKUP036
00875 ******************************************************************ETKUP036
00876 * Z200-WRITE-OUTPUT-FILE                                          ETKUP036
00877 ******************************************************************ETKUP036
00878  Z200-WRITE-OUTPUT-FILE.                                          ETKUP036
00879 *                                                                 ETKUP036
00880      WRITE INV-STATUS-RECORD.                                        CL**3
                                                                                
022015     ADD 1  TO PA-ROWS-WROTE.                                             
00881 *                                                                 ETKUP036
00882 ******************************************************************ETKUP036
00883 *  STANDARD DB2 ERROR ABEND ROUTINE                               ETKUP036
00884 *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             ETKUP036
00885 ******************************************************************ETKUP036
00886  Z900-SQL-ABEND.                                                  ETKUP036
00887                                                                   ETKUP036
00888      MOVE +4013                 TO ABEND-CODE.                    ETKUP036
00889      DISPLAY '**  ABEND     **'.                                  ETKUP036
00890      DISPLAY '**  PROGRAM   **  =  ETKUP036'.                     ETKUP036
00891      DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            ETKUP036
00892      DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        ETKUP036
00893                                                                   ETKUP036
00894 *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         ETKUP036
00895 *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        ETKUP036
00896                                                                   ETKUP036
00897      COPY DPPD004.                                                ETKUP036
00898                                                                   ETKUP036
00899      CALL 'ILBOABN0'  USING ABEND-CODE.                           ETKUP036
