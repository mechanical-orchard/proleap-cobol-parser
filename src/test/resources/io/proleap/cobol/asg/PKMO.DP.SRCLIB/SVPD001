000100******************************************************************00010028
000200* SVPD001                                                         00020029
000300*   THIS COPYBOOK IS TO BE USED FOR STORED VALUE SENDS TO THE     00030029
000400*   STORE SERVERS.                                                00040029
000500*   INCLUDE SVWS001 (WORKING STORAGE)                             00050029
000600*   IN ANY PROGRAM THAT INCLUDES THIS MODULE                      00060029
000700*                                                                 00070029
000800*   ALSO USE 9100-SQL-ABEND                                       00080029
000900*   AND      9999-ABEND IN ANY PROGRAM THAT INCLUDES THIS MODULE  00090029
001000******************************************************************00100029
001100* SV001-1000-INITIALIZE.                                          00110029
001200*  INITIALIZE DATES FOR RUN                                       00120029
001300******************************************************************00130029
001400 SV001-1000-INITIALIZE.                                           00140029
001500     OPEN INPUT  YEAR-PARAMETER-FILE.                             00150029
001600                                                                  00160029
001700     PERFORM SV001-1100-PROCESS-PARM-FILE.                        00170029
001800                                                                  00180029
001900     CLOSE YEAR-PARAMETER-FILE.                                   00190029
002000******************************************************************00200029
002100* SV001-1100-PROCESS-PARM-FILE                                    00210029
002200* READ PARAMETER CARD.                                            00220029
002300******************************************************************00230029
002400 SV001-1100-PROCESS-PARM-FILE.                                    00240029
002500                                                                  00250029
002600     PERFORM SV001-1200-READ-PARM-FILE.                           00260029
002700                                                                  00270029
002800     IF SV001-PS-END-OF-PARM-FILE                                 00280029
002900         MOVE 'SV001-1100-PROCESS-PARM-FILE '  TO                 00290029
003000                                              PV-PARAGRAPH-NAME   00300029
003100         MOVE 'NO PARM CARD TO PROCESS   ' TO PV-OPERATION-MSG-1  00310029
003200         SET AC-CONTROL-CARD-ERROR TO TRUE                        00320029
003300         PERFORM 9999-ABEND                                       00330029
003400     END-IF.                                                      00340029
003500                                                                  00350029
003600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              00360029
003700                                                                  00370029
003800     IF CC-YEAR-PARAMETER NUMERIC                                 00380029
003900         MOVE CC-YEAR-PARM TO SV001-PV-YEARS-BACK                 00390030
004000         COMPUTE SV001-PV-DAYS-BACK = SV001-PV-YEARS-BACK         00400030
004100                              * SV001-PC-365                      00410030
004200         SET DPG51-DECREMENT-DATE TO TRUE                         00420029
004300         PERFORM SV001-1300-GET-COMPARE-DATE                      00430029
004400         MOVE DPG55-DB2-ISO-DATE-FMT TO SV001-PV-COMPARE-DATE     00440030
004500         DISPLAY 'CARDS WITH NO ACTIVITY, DISTRIBUTED BEFORE '    00450029
004600             SV001-PV-COMPARE-DATE ', NOT SENT TO STORES.'        00460030
004700     ELSE                                                         00470029
004800         MOVE 'SV001-1100-PROCESS-PARM-FILE' TO PV-PARAGRAPH-NAME 00480029
004900         MOVE 'NON-NUMERIC YEAR PARM '   TO PV-OPERATION-MSG-1    00490029
005000         SET AC-CONTROL-CARD-ERROR TO TRUE                        00500029
005100         PERFORM 9999-ABEND                                       00510029
005200     END-IF.                                                      00520029
005300                                                                  00530029
005400     IF CC-DAYS-BEFORE NUMERIC                                    00540029
005500         MOVE CC-DAYS-BEFORE-OPEN TO SV001-PV-DAYS-BACK           00550030
005600         SET DPG51-INCREMENT-DATE TO TRUE                         00560029
005700         PERFORM SV001-1300-GET-COMPARE-DATE                      00570029
005800         MOVE DPG55-DB2-ISO-DATE-FMT TO SV001-PV-COMPARE-OPEN     00580030
005900         DISPLAY 'DAYS BEFORE OPEN SET AT ' CC-DAYS-BEFORE        00590029
006000         DISPLAY 'DATE IS ' SV001-PV-COMPARE-OPEN                 00600030
006100     ELSE                                                         00610029
006200         MOVE 'SV001-1100-PROCESS-PARM-FILE' TO PV-PARAGRAPH-NAME 00620029
006300         MOVE 'NON-NUMERIC DAYS PARM '   TO PV-OPERATION-MSG-1    00630029
006400         SET AC-CONTROL-CARD-ERROR TO TRUE                        00640029
006500         PERFORM 9999-ABEND                                       00650029
006600     END-IF.                                                      00660029
006700                                                                  00670029
006800******************************************************************00680029
006900* SV001-1200-READ-PARM-FILE                                       00690029
007000* READ YEAR PARAMETER CARD                                        00700029
007100******************************************************************00710029
007200 SV001-1200-READ-PARM-FILE.                                       00720029
007300     READ YEAR-PARAMETER-FILE INTO CC-YEAR-PARAMETER-CARD         00730029
007400        AT END                                                    00740029
007500           SET SV001-PS-END-OF-PARM-FILE TO TRUE.                 00750029
007600                                                                  00760029
007700******************************************************************00770029
007800* SV001-1300-GET-COMPARE-DATE                                     00780029
007900* CALL KOHLS CALENDAR ROUTINE TO TAKE A DATE IN DB2 ISO FORMAT    00790029
008000* (CCYY-MM-DD) AND RETURN A DATE 'X' YEARS AGO.                   00800029
008100******************************************************************00810029
008200 SV001-1300-GET-COMPARE-DATE.                                     00820029
008300                                                                  00830029
008400     EXEC SQL                                                     00840029
008500         SELECT CURRENT DATE                                      00850029
008600           INTO :SV001-PV-WORK-CCYY-MM-DD                         00860030
008700           FROM SYSIBM.SYSDUMMY1                                  00870029
008800     END-EXEC.                                                    00880029
008900                                                                  00890029
009000     SET DPG51-ACTUAL-CALENDAR-ONLY    TO TRUE.                   00900029
009100     MOVE SV001-PV-DAYS-BACK           TO DPG51-INCR-DECR-DAYS-9. 00910030
009200     MOVE SV001-PV-WORK-CCYY-MM-DD     TO DPG52-LK-DATE-INPUT.    00920030
009300     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   00930029
009400     DISPLAY 'WORK DAY: ' SV001-PV-WORK-CCYY-MM-DD                00940039
009500                                                                  00950029
009600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    00960029
009700                                             DPG54 DPG55 DPG56.   00970029
009800     EVALUATE TRUE                                                00980029
009900         WHEN DPG54-SEVERE-ERROR                                  00990029
010000         WHEN DPG54-DATE-INVALID                                  01000029
010100             DISPLAY 'DAYS BACK: ' SV001-PV-DAYS-BACK             01010039
010200             MOVE 'SV001-1300-GET-COMPARE-DATE'                   01020029
010300                                           TO PV-PARAGRAPH-NAME   01030029
010400             MOVE 'CANNOT GET DECREMENTED DATE '                  01040029
010500                                           TO PV-OPERATION-MSG-1  01050029
010600             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                01060029
010700             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  01070029
010800             PERFORM 9999-ABEND                                   01080029
010900     END-EVALUATE.                                                01090029
011000                                                                  01100029
011100                                                                  01110029
011200******************************************************************01120029
011300* SV001-2000-LOAD-STORE-TABLE.                                    01130029
011400*  LOAD XST_LOC TO INTERNAL TABLE                                 01140035
011500*  ONLY BRICK AND MORTAR STORES WITH TYPE CODE 'DS' ARE ADDED     01150035
011600******************************************************************01160029
011700 SV001-2000-LOAD-STORE-TABLE.                                     01170029
011800                                                                  01180029
011900     INITIALIZE SVWS001-STORE-TABLE                               01190029
012000                SVWS001-CARD-METRO-TABLE.                         01200029
012100                                                                  01210029
012200     PERFORM SV001-4000-OPEN-STORE-CURSOR.                        01220029
012300     PERFORM SV001-4100-FETCH-STORE-CURSOR                        01230029
012400         UNTIL SV001-PS-END-OF-STORE-CURSOR.                      01240029
012500     PERFORM SV001-4200-CLOSE-STORE-CURSOR.                       01250029
012600                                                                  01260029
012700     MOVE SV001-PV-STORE-SUB TO SV001-PC-STORE-LIMIT.             01270029
012800                                                                  01280029
012900******************************************************************01290029
013000* SV001-3000-CHECK-STORE                                          01300029
013100* CHECK IF STORE MEETS CRITERIA ON STORE TABLE.                   01310029
013200******************************************************************01320029
013300 SV001-3000-CHECK-STORE.                                          01330029
013400                                                                  01340029
013500     ADD +1 TO SV001-PV-STORE-SUB.                                01350029
013600                                                                  01360029
013700     IF SV001-PV-ADD-STORE = ST-STORE(SV001-PV-STORE-SUB)         01370029
013800         IF ((SV001-PV-WORK-CCYY-MM-DD NOT LESS THAN              01380030
013900              ST-OPEN-DATE(SV001-PV-STORE-SUB)                    01390029
014000          AND  SV001-PV-WORK-CCYY-MM-DD NOT GREATER THAN          01400030
014100               ST-CLOSE-DATE(SV001-PV-STORE-SUB)))                01410029
014200           OR ((SV001-PV-COMPARE-OPEN NOT LESS THAN               01420030
014300                ST-OPEN-DATE(SV001-PV-STORE-SUB)                  01430029
014400          AND   SV001-PV-COMPARE-OPEN NOT GREATER THAN            01440030
014500                ST-CLOSE-DATE(SV001-PV-STORE-SUB)))               01450029
014600                                                                  01460029
014700             SET SV001-PS-STORE-FOUND TO TRUE                     01470029
014800             SET SV001-PS-METRO-NOT-FOUND TO TRUE                 01480035
014900             SET SV001-PS-METRO-NOT-ADDED TO TRUE                 01490035
015000                                                                  01500042
015100             MOVE ST-METRO(SV001-PV-STORE-SUB)                    01510042
015200                                    TO SV001-PV-ADD-METRO         01520042
015300             MOVE ST-POS-CAP-LVL-ID(SV001-PV-STORE-SUB)           01530043
015400                                    TO SV001-PV-POS-CAP-LVL-ID    01540043
015500                                                                  01550042
015600             PERFORM SV001-3500-CHECK-METRO                       01560035
015700             VARYING SV001-PV-CARD-METRO-SUB FROM 1 BY 1          01570035
015800               UNTIL SV001-PS-METRO-FOUND                         01580035
015900                  OR SV001-PS-METRO-ADDED                         01590035
016000                   OR SV001-PV-CARD-METRO-SUB >                   01600035
016100                               SV001-PC-METRO-TABLE-LIMIT         01610029
016200             IF SV001-PS-METRO-NOT-FOUND AND                      01620035
016300                SV001-PS-METRO-NOT-ADDED                          01630035
016400                 SET AC-TABLE-OVERFLOW-ERROR TO TRUE              01640035
016500                 MOVE 'SV001-3000-CHECK-STORE' TO                 01650035
016600                                              PV-PARAGRAPH-NAME   01660035
016700                 MOVE 'METRO TABLE LIMIT EXCEEDED' TO             01670035
016800                                  PV-OPERATION-MSG-1              01680029
016900                 PERFORM 9999-ABEND                               01690035
017000             END-IF                                               01700029
017100         END-IF                                                   01710029
017200     END-IF.                                                      01720029
017300                                                                  01730029
017400******************************************************************01740029
017500* SV001-3100-FIND-METRO-BY-STATE                                  01750029
017600* FOR E-COMMERCE ACTIVITY, FIND ALL METRO AREAS IN THE STATE WHERE01760029
017700* THE CARD WAS USED.                                              01770029
017800******************************************************************01780029
017900 SV001-3100-FIND-METRO-BY-STATE.                                  01790029
018000                                                                  01800029
018100     IF SV001-PV-STATE-CDE = ST-STATE(SV001-PV-STATE-SUB)         01810040
018200         IF ((SV001-PV-WORK-CCYY-MM-DD NOT LESS THAN              01820041
018300              ST-OPEN-DATE(SV001-PV-STATE-SUB)                    01830043
018400          AND  SV001-PV-WORK-CCYY-MM-DD NOT GREATER THAN          01840041
018500               ST-CLOSE-DATE(SV001-PV-STATE-SUB)))                01850043
018600           OR ((SV001-PV-COMPARE-OPEN NOT LESS THAN               01860041
018700                ST-OPEN-DATE(SV001-PV-STATE-SUB)                  01870043
018800          AND   SV001-PV-COMPARE-OPEN NOT GREATER THAN            01880041
018900                ST-CLOSE-DATE(SV001-PV-STATE-SUB)))               01890043
019000                                                                  01900041
019100             SET SV001-PS-METRO-NOT-FOUND                         01910041
019200                 SV001-PS-METRO-NOT-ADDED TO TRUE                 01920041
019300             MOVE ST-METRO(SV001-PV-STATE-SUB)                    01930041
019400                                          TO SV001-PV-ADD-METRO   01940041
019500             PERFORM SV001-3500-CHECK-METRO                       01950041
019600                 VARYING SV001-PV-CARD-METRO-SUB FROM 1 BY 1      01960041
019700                   UNTIL SV001-PS-METRO-FOUND                     01970041
019800                      OR SV001-PS-METRO-ADDED                     01980041
019900                      OR SV001-PV-CARD-METRO-SUB GREATER THAN     01990041
020000                                  SV001-PC-METRO-TABLE-LIMIT      02000034
020100             IF SV001-PS-METRO-NOT-FOUND AND                      02010041
020200                 SV001-PS-METRO-NOT-ADDED                         02020041
020300                  SET AC-TABLE-OVERFLOW-ERROR TO TRUE             02030041
020400                  MOVE 'SV001-3100-FIND-METRO-BY-STATE' TO        02040041
020500                                           PV-PARAGRAPH-NAME      02050039
020600                  MOVE 'METRO TABLE LIMIT EXCEEDED' TO            02060041
020700                                  PV-OPERATION-MSG-1              02070029
020800                  PERFORM 9999-ABEND                              02080041
020900             END-IF                                               02090041
021000         END-IF                                                   02100041
021100     END-IF.                                                      02110029
021200                                                                  02120029
021300******************************************************************02130029
021400* SV001-3500-CHECK-METRO                                          02140029
021500* CHECK IF METRO AREA FOR STORE IS ALREADY IN METRO TABLE.        02150029
021600* IF NOT, ADD IT.  THIS TABLE WILL BE USED TO SEND INFO ON THIS   02160029
021700* CARD TO ALL METRO AREAS WHERE THE CARD HAS BEEN USED.           02170029
021800******************************************************************02180029
021900 SV001-3500-CHECK-METRO.                                          02190029
022000                                                                  02200029
022100     IF SV001-PV-ADD-METRO = CM-METRO(SV001-PV-CARD-METRO-SUB)    02210030
022200         SET SV001-PS-METRO-FOUND TO TRUE                         02220029
022300     ELSE                                                         02230029
022400         IF CM-METRO(SV001-PV-CARD-METRO-SUB) = 0                 02240030
022500             SET SV001-PS-METRO-ADDED TO TRUE                     02250029
022600             MOVE SV001-PV-ADD-METRO TO                           02260029
022700                                CM-METRO(SV001-PV-CARD-METRO-SUB) 02270030
022800         END-IF                                                   02280029
022900     END-IF.                                                      02290029
023000                                                                  02300029
023100******************************************************************02310029
023200* SV001-4000-OPEN-STORE-CURSOR                                    02320029
023300******************************************************************02330029
023400 SV001-4000-OPEN-STORE-CURSOR.                                    02340029
023500     EXEC SQL                                                     02350029
023600          OPEN STORE-CSR                                          02360029
023700     END-EXEC.                                                    02370029
023800                                                                  02380029
023900     EVALUATE TRUE                                                02390029
024000         WHEN SQLCODE = ZERO                                      02400029
024100              CONTINUE                                            02410029
024200         WHEN SQLWARN0 NOT EQUAL SPACE                            02420029
024300         WHEN SQLCODE NOT EQUAL ZERO                              02430029
024400             MOVE 'SV001-4000-OPEN-STORE-CURSOR   '               02440029
024500                                            TO PV-PARAGRAPH-NAME  02450029
024600             MOVE 'ERROR ON OPEN OF STORE-CSR   '                 02460029
024700                                            TO PV-DB2-OPERATION   02470029
024800             PERFORM 9100-SQL-ABEND                               02480029
024900     END-EVALUATE.                                                02490029
025000                                                                  02500029
025100******************************************************************02510029
025200* SV001-4100-FETCH-STORE-CURSOR                                   02520029
025300******************************************************************02530029
025400 SV001-4100-FETCH-STORE-CURSOR.                                   02540029
025500     EXEC SQL                                                     02550029
025600          FETCH STORE-CSR                                         02560029
025700           INTO :XST00001-LOC-NBR                                 02570029
025800               ,:XST00023-STR-GP-ID                               02580029
025900               ,:XST00001-OPN-DTE                                 02590029
026000               ,:XST00001-CLO-DTE                                 02600029
026100               ,:XST00022-ST-CDE                                  02610029
026200               ,:XST00025-POS-CAP-LVL-ID                          02620042
026300     END-EXEC.                                                    02630029
026400                                                                  02640029
026500     EVALUATE TRUE                                                02650029
026600         WHEN SQLCODE = ZERO                                      02660029
026700              ADD +1 TO SV001-PV-STORE-SUB                        02670029
026800              IF SV001-PV-STORE-SUB > SV001-PC-STORE-LIMIT        02680029
026900                  SET AC-TABLE-OVERFLOW-ERROR TO TRUE             02690029
027000                  MOVE 'SV001-4100-FETCH-STORE-CURSOR' TO         02700029
027100                              PV-PARAGRAPH-NAME                   02710029
027200                  MOVE 'STORE TABLE LIMIT EXCEEDED' TO            02720029
027300                              PV-OPERATION-MSG-1                  02730029
027400                  PERFORM 9999-ABEND                              02740029
027500              END-IF                                              02750029
027600              ADD +1 TO SV001-PV-STORE-FETCH-CNT                  02760047
027700              MOVE XST00001-LOC-NBR   TO                          02770029
027800                                  ST-STORE(SV001-PV-STORE-SUB)    02780029
027900              MOVE XST00023-STR-GP-ID TO                          02790029
028000                                  ST-METRO(SV001-PV-STORE-SUB)    02800029
028100              MOVE XST00001-OPN-DTE   TO                          02810029
028200                              ST-OPEN-DATE(SV001-PV-STORE-SUB)    02820029
028300              MOVE XST00001-CLO-DTE   TO                          02830029
028400                              ST-CLOSE-DATE(SV001-PV-STORE-SUB)   02840029
028500              MOVE XST00022-ST-CDE    TO                          02850029
028600                              ST-STATE(SV001-PV-STORE-SUB)        02860029
028700              MOVE XST00025-POS-CAP-LVL-ID TO                     02870042
028800                          ST-POS-CAP-LVL-ID(SV001-PV-STORE-SUB)   02880042
028900                                                                  02890042
029000         WHEN SQLCODE = +100                                      02900029
029100             SET SV001-PS-END-OF-STORE-CURSOR TO TRUE             02910029
029200             MOVE SV001-PV-STORE-SUB TO SV001-PV-STORE-MAX        02920033
029300         WHEN SQLWARN0 NOT EQUAL SPACE                            02930029
029400         WHEN SQLCODE NOT EQUAL ZERO                              02940029
029500             MOVE 'SV001-4100-FETCH-STORE-CURSOR'                 02950029
029600                                            TO PV-PARAGRAPH-NAME  02960029
029700             MOVE 'ERROR ON FETCH OF STORE-CSR'                   02970029
029800                                            TO PV-DB2-OPERATION   02980029
029900             PERFORM 9100-SQL-ABEND                               02990029
030000     END-EVALUATE.                                                03000029
030100                                                                  03010029
030200******************************************************************03020029
030300* SV001-4200-CLOSE-STORE-CUSROR                                   03030029
030400*                                                                 03040029
030500******************************************************************03050029
030600 SV001-4200-CLOSE-STORE-CURSOR.                                   03060029
030700                                                                  03070029
030800     EXEC SQL                                                     03080029
030900          CLOSE STORE-CSR                                         03090029
031000     END-EXEC.                                                    03100029
031100                                                                  03110029
031200     EVALUATE TRUE                                                03120029
031300         WHEN SQLCODE = ZERO                                      03130029
031400              CONTINUE                                            03140029
031500         WHEN SQLWARN0 NOT EQUAL SPACE                            03150029
031600         WHEN SQLCODE NOT EQUAL ZERO                              03160029
031700             MOVE 'SV001-4200-CLOSE-STORE-CURSOR'                 03170029
031800                                            TO PV-PARAGRAPH-NAME  03180029
031900             MOVE 'ERROR ON CLOSE OF STORE-CSR'                   03190029
032000                                            TO PV-DB2-OPERATION   03200029
032100             PERFORM 9100-SQL-ABEND                               03210029
032200     END-EVALUATE.                                                03220029
032300******************************************************************03230029
032400* SV001-5000-GET-METRO-AREA                                       03240029
032500* PUT METRO AREA ON RECORD AND WRITE RECORD FOR EACH METRO AREA.  03250029
032600* PERFORM THE WRITE SEQUENCE FOR THE  OUTPUT FILE                 03260063
032700* - THE PIPE-DELIMITED LAYOUT FOR THE                             03270063
032800*  SQL SERVER VERSION OF THE OFF-LINE FILE.                       03280044
032900******************************************************************03290029
033000 SV001-5000-GET-METRO-AREA.                                       03300029
033100                                                                  03310029
033200     ADD +1 TO SV001-PV-CARD-METRO-SUB.                           03320030
033300                                                                  03330029
033400     IF CM-METRO(SV001-PV-CARD-METRO-SUB) = 0                     03340030
033500         SET SV001-PS-END-OF-METRO TO TRUE                        03350029
033600     ELSE                                                         03360029
033700         MOVE CM-METRO(SV001-PV-CARD-METRO-SUB) TO                03370030
033800                                        SV001-PV-METRO-STORE-CMP3 03380029
033900         MOVE SV001-PV-METRO-STORE-CMP3   TO SV001-PV-METRO-STORE 03390029
034500                                                                  03450044
034600         MOVE SV001-PV-METRO-STORE        TO SV060-METRO-AREA     03460044
034700         PERFORM SV001-5200-PROCESS-SQLS-RCD                      03470044
034800     END-IF.                                                      03480044
038400******************************************************************03840044
038500* SV001-5200-PROCESS-SQLS-RCD.                                    03850044
038600* PROCESS SV060 RECORD                                            03860044
038700******************************************************************03870044
038800 SV001-5200-PROCESS-SQLS-RCD.                                     03880044
038900     MOVE 'SV001-5200-PROCESS-SQLS-RCD'  TO PV-PARAGRAPH-NAME.    03890044
039000                                                                  03900044
039100     SET SV060-CONVERT-LENGTH      TO 1.                          03910046
039200     MOVE '|'                      TO SV060-FIRST-PIPE.           03920046
039300                                                                  03930044
039400*---- MOVE SVC ACTION CODE                                        03940044
039500     INITIALIZE SV001-PV-VARIABLE-OUTPUT-FIELD.                   03950044
039600     MOVE SV060-ACTION-CODE        TO                             03960046
039700          SV001-PV-VARIABLE-OUTPUT-FIELD.                         03970046
039800     PERFORM SV001-6100-FIELD-MOVER                               03980044
039900        VARYING SV001-PV-BIT-IDX FROM 1 BY 1                      03990044
040000          UNTIL SV001-PV-BIT-IDX > 1.                             04000044
040100     PERFORM SV001-6200-MOVE-DELIMITER.                           04010060
040200                                                                  04020044
040300*---- MOVE STORED VALUE CARD NUMBER                               04030044
040400*--   - THIS PROCESS TRUNCATES LEADING ZEROES - SQL SERVER PREFERS04040061
040500     INITIALIZE SV001-PV-VARIABLE-OUTPUT-FIELD                    04050044
040600                SV001-PV-TALLY-CNT.                               04060044
040700     MOVE SV060-SVC-NBR            TO SV001-PV-DDG-9FOR12ND.      04070046
040800     INSPECT SV001-PV-DDG-9FOR12ND                                04080044
040900       TALLYING SV001-PV-TALLY-CNT                                04090044
041000       FOR LEADING ZEROES.                                        04100044
041100     SET SV001-PV-STR-IDX          TO SV001-PV-TALLY-CNT.         04110046
041200     SET SV001-PV-STR-IDX UP BY 1.                                04120044
041300     MOVE SV001-PV-DDG-9FOR12ND    TO                             04130046
041400          SV001-PV-VARIABLE-OUTPUT-FIELD.                         04140046
041500                                                                  04150060
041600     PERFORM VARYING SV001-PV-EOF-IDX FROM 60 BY -1               04160060
041700          UNTIL SV001-PV-BIT-VARIABLE (SV001-PV-EOF-IDX)          04170061
041800                                   NOT = SPACE                    04180061
041900     END-PERFORM.                                                 04190061
042000     PERFORM SV001-6100-FIELD-MOVER                               04200044
042100        VARYING SV001-PV-BIT-IDX FROM                             04210044
042200                SV001-PV-STR-IDX BY 1                             04220044
042300          UNTIL SV001-PV-BIT-IDX > SV001-PV-EOF-IDX.              04230044
042400     PERFORM SV001-6200-MOVE-DELIMITER.                           04240060
042500                                                                  04250044
042600*---- MOVE SVC PIN NUMBER                                         04260050
042700*--  -- SEP 08 -- THIS HAS BEEN HELD OUT, DUE TO PCI CONCERNS --  04270050
042800*    INITIALIZE SV001-PV-VARIABLE-OUTPUT-FIELD.                   04280046
042900*    MOVE SV060-SVC-PIN-NBR    TO SV001-PV-VARIABLE-OUTPUT-FIELD. 04290046
043000*    PERFORM SV001-6100-FIELD-MOVER                               04300046
043100*       VARYING SV001-PV-BIT-IDX FROM 1 BY 1                      04310046
043200*         UNTIL SV001-PV-BIT-IDX > 4.                             04320046
043300*    PERFORM SV001-6200-MOVE-DELIMITER.                           04330060
043400                                                                  04340044
043500*---- MOVE SVC TYPE CODE                                          04350044
043600     INITIALIZE SV001-PV-VARIABLE-OUTPUT-FIELD.                   04360044
043700     MOVE SV060-SVC-TYP-CDE        TO                             04370046
043800          SV001-PV-VARIABLE-OUTPUT-FIELD.                         04380046
043900     PERFORM SV001-6100-FIELD-MOVER                               04390044
044000        VARYING SV001-PV-BIT-IDX FROM 1 BY 1                      04400044
044100          UNTIL SV001-PV-BIT-IDX > 1.                             04410044
044200     PERFORM SV001-6200-MOVE-DELIMITER.                           04420060
044300                                                                  04430044
044400*---- MOVE SVC SPECIALTY TYPE CODE                                04440044
044500     INITIALIZE SV001-PV-VARIABLE-OUTPUT-FIELD.                   04450044
044600     MOVE SV060-SVC-SPCTY-TYP-CDE  TO                             04460046
044700          SV001-PV-VARIABLE-OUTPUT-FIELD.                         04470044
044800     PERFORM SV001-6100-FIELD-MOVER                               04480044
044900        VARYING SV001-PV-BIT-IDX FROM 1 BY 1                      04490044
045000                 UNTIL SV001-PV-BIT-IDX > 1.                      04500044
045100     PERFORM SV001-6200-MOVE-DELIMITER.                           04510060
045200                                                                  04520044
045300*---- MOVE SVC BALANCE AMOUNT                                     04530044
045400     INITIALIZE SV001-PV-VARIABLE-OUTPUT-FIELD                    04540044
045500                SV001-PV-TALLY-CNT.                               04550044
045600     MOVE SV060-SVC-BAL-AMT        TO SV001-PV-DDG-9FOR6D.        04560044
045700     INSPECT SV001-PV-DDG-9FOR6D                                  04570044
045800       TALLYING SV001-PV-TALLY-CNT                                04580044
045900            FOR LEADING ZEROES.                                   04590044
046000     SET SV001-PV-STR-IDX          TO SV001-PV-TALLY-CNT.         04600044
046100     SET SV001-PV-STR-IDX          UP BY 1.                       04610044
046200     MOVE SV001-PV-DDG-9FOR6D      TO                             04620044
046300          SV001-PV-VARIABLE-OUTPUT-FIELD.                         04630044
046400     PERFORM VARYING SV001-PV-EOF-IDX FROM 60 BY -1               04640057
046500          UNTIL SV001-PV-BIT-VARIABLE (SV001-PV-EOF-IDX)          04650044
046600                            NOT = SPACE                           04660059
046700     END-PERFORM.                                                 04670059
046800     PERFORM SV001-6100-FIELD-MOVER                               04680044
046900        VARYING SV001-PV-BIT-IDX FROM SV001-PV-STR-IDX BY 1       04690044
047000          UNTIL SV001-PV-BIT-IDX > SV001-PV-EOF-IDX.              04700044
047100     PERFORM SV001-6200-MOVE-DELIMITER.                           04710060
047200                                                                  04720047
047300*---- MOVE SVC LAST UPDATE TIMESTAMP                              04730044
047400*--  -- MOVE ONLY THE ENDING DELIMITER - THE SQL SERVER LOAD      04740060
047500*--     PROCESS WILL POPULATE TIMESTAMP IN THE DATABASE.          04750060
047600     PERFORM SV001-6200-MOVE-DELIMITER.                           04760060
047700                                                                  04770050
047800     WRITE SV-CARD-SQLS-RECORD     FROM SV060-CARD-RCD.           04780046
047900     ADD 1                         TO SV001-PV-SV060-WRITE-CNT.   04790044
048000                                                                  04800044
049300******************************************************************04930044
049400* SV001-6100-FIELD-MOVER.                                         04940044
049500*  MOVES, CHARACTER BY CHARACTER, SV060 HOLD FIELDS TO SV060      04950044
049600*  VARIABLE LENGTH FIELD                                          04960044
049700******************************************************************04970044
049800 SV001-6100-FIELD-MOVER.                                          04980044
049900                                                                  04990044
050000     MOVE SV001-PV-BIT-VARIABLE(SV001-PV-BIT-IDX) TO              05000044
050100          SV060-CONVERT-FILE-VAR(SV060-CONVERT-LENGTH).           05010044
050200     SET SV060-CONVERT-LENGTH      UP BY 1.                       05020044
050300                                                                  05030044
050400******************************************************************05040044
050500* SV001-6200-MOVE-DELIMITER.                                      05050060
050600*      MOVE DELIMITER CHARACTER                                   05060044
050700******************************************************************05070044
050800 SV001-6200-MOVE-DELIMITER.                                       05080060
050900                                                                  05090044
051000     MOVE SV001-PC-CSV-DELIMITER   TO                             05100044
051100          SV060-CONVERT-FILE-VAR(SV060-CONVERT-LENGTH).           05110044
051200     SET SV060-CONVERT-LENGTH      UP BY 1.                       05120044
051300                                                                  05130044
051400**************************  END OF COPYBOOK  *********************05140044
