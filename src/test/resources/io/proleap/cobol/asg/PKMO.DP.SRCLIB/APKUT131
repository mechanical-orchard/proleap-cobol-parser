000100*-----------------------*                                         00010034
000200 IDENTIFICATION DIVISION.                                         00020034
000300*-----------------------*                                         00030034
000400 PROGRAM-ID.    APKUT131.                                         00040034
000500 AUTHOR.        CHRIS KUNSTMANN  IBS.                             00050034
000600 DATE-WRITTEN.  11/11/98.                                         00060034
000700                                                                  00070034
000800*---------------------------------------------------------------* 00080034
000900*                                                               * 00090034
001000*        ADJUSTMENT JOURNAL TRANSACTION SUMMARIZATION           * 00100034
001100*                                                               * 00110034
001200*    THIS PROGRAM READS IN BATCH ADJUSTMENT TRANSACTIONS,       * 00120034
001300*    AND SUMMARIZES THE DATA TO AN APPROPRIATE LEVEL OF DETAIL. * 00130034
001400*    AS THE THE TRANSACTIONS ARE PROCESSED, TOTALS ARE          * 00140034
001500*    CALCULATED FOR HEADER RECORDS WHEN THE VENDOR, DOCUMENT,   * 00150034
001600*    DOC DATE, OR TRANCODE CHANGES.                             * 00160034
001700*                                                               * 00170034
001800*---------------------------------------------------------------* 00180034
001900*                                                               * 00190034
002000* INPUT:                                                        * 00200034
002100*  1. BATCH ADJUSTMENT TRANSACTIONS    (APRD045)                * 00210034
002200*                                                               * 00220034
002300* OUTPUT:                                                       * 00230034
002400*  1. SUMMARIZED TRANSACTIONS          (APRD045)                * 00240034
002500*     (PREFIX IS CHANGED FROM AP045- TO SUMRY-)                 * 00250034
002600*                                                               * 00260034
002700*---------------------------------------------------------------* 00270034
002800*   CHANGES:                                                    * 00280034
002900*      WR 5998      INITIAL PROGRAM                             * 00290034
003000*                                                               * 00300095
003100*      12/28/99     MARK BURNSIDE                               * 00310095
003200*      CHANGE MADE: ADDED LOGIC TO CAPTURE THE TEXT FIELDS      * 00320095
003300*      FROM THE INPUT COPYBOOK AND STRING THEM INTO TEXT FIELDS * 00330095
003400*      ON OUTPUT RECORD FOR AN ADJUSTMENT.                      * 00340095
003500*                                                               * 00350034
003600*      02/02/00     ROBIN BERNOSKI          WR/IR #: 20419      * 00360095
003700*      CHANGE MADE: ADDED LOGIC TO PARAGRAPHS C100 AND C200 TO  * 00370095
003800*      CHECK THE SEE WHETHER THE DUE DATE FIELD IS POPULATED.   * 00380095
003900*      IF THE FIELD IS NOT POPULATED IT WILL BE FILLED THE      * 00390095
004000*      CORRESPONDING ENTER DATE.                                * 00400034
004100*                                                               * 00410034
004200*      08/25/2000    JILL JUEL              WR# 20224           * 00420095
004300*      ADDED LOGIC TO PROCESS THE NEW MOS FIELDS. THE NEW       * 00430095
004400*      FIELD IS HANDLED THE SAME WAY THE NEW STORE DISCOUNT     * 00440095
004500*      IS HANDLED.                                              * 00450095
004600*                                                               * 00460034
004700*      01/26/01     ROLLIN KRING            WR/IR #: 20407      * 00470095
004800*      CHANGE MADE: ADDED TRAN CODE OF 45 AS ACCEPTABLE TRANS   * 00480095
004900*      TO PROCESS A PRO BILL.  TRAN CODE 45 IS FOR REVERSALS.   * 00490095
005000*                                                               * 00500095
005100*      07/24/01     ALEXIS KEIKER           WR/IR #: 22467      * 00510095
005200*      CHANGE MADE: INCREASED RECORD SIZE OF INPUT AND OUTPUT   * 00520095
005300*      RECORD FROM 400 TO 500.  THIS CHANGE WAS MADE BECAUSE    * 00530095
005400*      COPYBOOK APRD045 WAS INCREASED TO 500.                   * 00540095
005500*                                                               * 00550095
005600*      05/16/2002   KEVIN CATLIN            WR/IR #: 21278      * 00560099
005700*      CHANGE MADE: REPLACED REFERENCES TO AP045-SKU-SEQ-NBR    * 00570097
005800*      WITH AP045-SKU-NBR IN PARAGRAPHS C100 AND C300 (FOR      * 00580097
005900*      NI-SKU PROJECT).                                         * 00590097
006000*                                                               * 00600096
006100*   DATE  09/29/2003                                            * 00610099
006200*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP       * 00620099
006300*       CHANGE TO COPYBOOK APRD045.                             * 00630099
006400*       MADE BY: MIKE BESKE              WR/IR #: WR21316       * 00640099
006500*                                                               * 00650099
006510*   DATE  08/13/2004                                            * 00651099
006520*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP       * 00652099
006530*       CHANGE TO COPYBOOK APRD045.                             * 00653099
006540*       MADE BY: NANCY EILBES            WR/IR #: WR26679       * 00654099
006550*                                                               * 00655099
006560*   DATE  11/  /2005                                            * 00656099
006570*       CHANGE MADE: ADDED LOGIC TO MAINTAIN ADJUSTMENTS AT     * 00657099
006580*       SKU LEVEL.                                              * 00658099
006590*       MADE BY: ROLF NOHE               WR/IR #: WR28582       * 00659099
006591*                                                               * 00659199
006600*---------------------------------------------------------------* 00660096
006700                                                                  00670096
006800 ENVIRONMENT DIVISION.                                            00680096
006900 CONFIGURATION SECTION.                                           00690096
007000 SOURCE-COMPUTER. IBM-3090.                                       00700096
007100 OBJECT-COMPUTER. IBM-3090.                                       00710096
007200                                                                  00720096
007300                                                                  00730096
007400 INPUT-OUTPUT SECTION.                                            00740096
007500 FILE-CONTROL.                                                    00750095
007600                                                                  00760095
007700     SELECT ADJ-TRANS-FILE                 ASSIGN TO UT-S-INP01.  00770095
007800     SELECT SUMRY-TRANS-FILE               ASSIGN TO UT-S-OUT01.  00780095
007900                                                                  00790095
008000 DATA DIVISION.                                                   00800095
008100 FILE SECTION.                                                    00810095
008200                                                                  00820095
008300 FD  ADJ-TRANS-FILE                                               00830095
008400     RECORDING MODE IS F                                          00840095
008500     BLOCK CONTAINS 0 CHARACTERS                                  00850095
008600     LABEL RECORDS ARE STANDARD                                   00860095
008700     DATA RECORD IS ADJ-TRANS-RECORD.                             00870095
008800                                                                  00880095
008900 01  ADJ-TRANS-RECORD             PIC X(500).                     00890095
009000                                                                  00900095
009100                                                                  00910095
009200 FD  SUMRY-TRANS-FILE                                             00920095
009300     RECORDING MODE IS F                                          00930095
009400     BLOCK CONTAINS 0 CHARACTERS                                  00940095
009500     LABEL RECORDS ARE STANDARD                                   00950095
009600     DATA RECORD IS SUMRY-TRANS-RECORD.                           00960095
009700                                                                  00970095
009800 01  SUMRY-TRANS-RECORD           PIC X(500).                     00980095
009900                                                                  00990095
010000                                                                  01000095
010100 WORKING-STORAGE SECTION.                                         01010095
010200                                                                  01020095
010300 01  PC-PROGRAM-CONSTANTS.                                        01030095
010400     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                01040095
010500         '**** WORKING STORAGE ** APKUT131 ****'.                 01050095
010600                                                                  01060095
010700 01  PS-PROGRAM-SWITCHES.                                         01070095
010800     05  PS-ADJ-TRANS-SW         PIC  X(01)  VALUE 'Y'.           01080095
010900         88  PS-ADJ-TRANS-FOUND              VALUE 'Y'.           01090095
011000         88  PS-ADJ-TRANS-END                VALUE 'N'.           01100095
011100                                                                  01110095
011200 01  PV-PROGRAM-VARIABLES.                                        01120095
011300     05  PV-COUNTERS             COMP.                            01130095
011400         10  PV-AP045-READ       PIC S9(9)     VALUE ZEROES.      01140095
011500         10  PV-AP045-WRITTEN    PIC S9(9)     VALUE ZEROES.      01150095
011600         10  PV-HEADR-WRITTEN    PIC S9(9)     VALUE ZEROES.      01160095
011700         10  PV-SUMRY-WRITTEN    PIC S9(9)     VALUE ZEROES.      01170095
011800         10  PV-PRO-CNT          PIC S9(9)     VALUE ZEROES.      01180095
011900         10  PV-CHAR-CNT         PIC S9(9)     VALUE ZEROES.      01190095
012000         10  PV-INSPECT-CNT      PIC S9(9)     VALUE ZEROES.      01200095
012100     05  PV-HOLD-VARIABLES.                                       01210095
012200         10  PV-HOLD-TEXT-LINE.                                   01220095
012300             15  PV-CONST-TEXT   PIC  X(06)    VALUE 'PROB- '.    01230095
012400             15  PV-PRO-BILL-TXT PIC  X(94)    VALUE SPACES.      01240095
012500                                                                  01250095
012600* THIS IS A COPY OF THE APRD045 COPYBOOK USED TO HOLD THE DATA    01260095
012700* FROM THE FIRST RECORD. THIS IS MORE OR LESS A WS GROUP TO HOLD  01270095
012800* DATA THAT WILL CREATE THE HEADER RECORD.                        01280095
012900*                                                                 01290095
013000     COPY APRD045 REPLACING 'AP045-' BY 'HEADR-'.                 01300095
013100                                                                  01310095
013200                                                                  01320095
013300***************************************                           01330095
013400*    ADJUSTMENT TRANSACTION FILE - INPUT                          01340095
013500***************************************                           01350095
013600     COPY APRD045.                                                01360095
013700                                                                  01370095
013800***************************************                           01380095
013900*    ADJUSTMENT TRANSACTION FILE - OUTPUT (SUMMARIZED)            01390095
014000***************************************                           01400095
014100     COPY APRD045 REPLACING 'AP045-' BY 'SUMRY-'.                 01410095
014200                                                                  01420095
014300*---------------------------------------------------------------- 01430095
014400*  ABEND DATA AREAS                                               01440095
014500*---------------------------------------------------------------- 01450095
014600 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01460095
014700                                             COMP SYNC.           01470095
014800     88  AC-INVALID-KEY-READ                VALUE +4002.          01480095
014900                                                                  01490095
015000 01  ABEND-AREAS.                                                 01500095
015100     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01510095
015200             '*****       ABEND'.                                 01520095
015300     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01530095
015400             '*****   PROGRAM: APKUP132'.                         01540095
015500     05  AA-PARAGRAPH-LIT.                                        01550095
015600         10  FILLER              PIC  X(17)  VALUE                01560095
015700             '***** PARAGRAPH: '.                                 01570095
015800         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01580095
015900     05  MA-MESSAGE-LINE.                                         01590095
016000         10  FILLER              PIC  X(06)  VALUE '*****'.       01600095
016100         10  AA-MESSAGE.                                          01610095
016200             15 AA-MESS-1        PIC  X(30)  VALUE SPACES.        01620095
016300             15 AA-MESS-2        PIC  X(97)  VALUE SPACES.        01630095
016400                                                                  01640095
016500 01  FILLER                      PIC  X(35)  VALUE                01650095
016600     '**** END OF W/S ** APKUT131 ****'.                          01660095
016700                                                                  01670095
016800                                                                  01680095
016900 PROCEDURE DIVISION.                                              01690095
017000                                                                  01700095
017100     PERFORM A100-MAINLINE.                                       01710095
017200     GOBACK.                                                      01720095
017300                                                                  01730095
017400 A100-MAINLINE.                                                   01740095
017500                                                                  01750095
017600     PERFORM B100-INITIALIZE.                                     01760099
017700                                                                  01770095
017800     PERFORM B200-PROCESS-ADJ-TRANS-FILE                          01780095
017900         UNTIL PS-ADJ-TRANS-END.                                  01790095
018000                                                                  01800095
018100     PERFORM B300-END-OF-PROGRAM.                                 01810095
018200                                                                  01820095
018300 B100-INITIALIZE.                                                 01830095
018400*---------------------------------------------------------------- 01840095
018500*  ONE TIME INITIALIZATION PROCESS.                               01850095
018600*    OPEN FILES AND INITIALIZE WORKING STORAGE.                   01860095
018700*    READ INPUT FILE AND SET UP HEADER RECORD.                    01870095
018800*---------------------------------------------------------------- 01880095
018900                                                                  01890095
018910     DISPLAY 'B100-INITIALIZE'.                                   01891099
019000     DISPLAY '*************************************'.             01900095
019100     DISPLAY '**  APKUT131 PROCESSING BEGINS NOW **'.             01910095
019200     DISPLAY ' '.                                                 01920095
019300                                                                  01930095
019400     OPEN INPUT  ADJ-TRANS-FILE.                                  01940095
019500     OPEN OUTPUT SUMRY-TRANS-FILE.                                01950095
019600                                                                  01960095
019700     PERFORM R100-READ-ADJ-TRANS-FILE.                            01970095
019800                                                                  01980095
019900     IF PS-ADJ-TRANS-END                                          01990095
020000        DISPLAY '*********APKUT131 IS ENDING*********'            02000095
020100        DISPLAY 'INPUT FILE IS EMPTY. NO RECORDS TO PROCESS'      02010095
020200     ELSE                                                         02020095
020300        IF NOT AP045-DETAIL-RECORD                                02030095
020400           SET AC-INVALID-KEY-READ TO TRUE                        02040095
020500           MOVE 'B100-INITIALIZE'  TO AA-PARAGRAPH-NAME           02050095
020600           DISPLAY 'RECORD TYPE <> 2, ONLY PROCESS DETAIL RECORDS'02060095
020700           MOVE 'RECORD TYPE NOT = 2'                             02070095
020800                               TO AA-MESSAGE                      02080095
020900           PERFORM Z998-ABEND                                     02090095
021000        END-IF                                                    02100095
021100        IF PS-ADJ-TRANS-FOUND                                     02110095
021200           PERFORM C300-SETUP-HEADER-SUMMARY                      02120095
021300        END-IF                                                    02130095
021400     END-IF.                                                      02140095
021500                                                                  02150095
021600                                                                  02160095
021700                                                                  02170095
021800 B200-PROCESS-ADJ-TRANS-FILE.                                     02180095
021900*---------------------------------------------------------------- 02190095
022000*    CONTROLS THE PROCESSING OF ADJUSTMENT TRANSACTIONS.          02200095
022100*  WHEN THE KEYS CHANGE, CREATE A SUMMARY AND HEADER RECORD FOR   02210095
022200*   THE DATA JUST PROCESSED AND SET UP THE NEXT HEADER RECORD.    02220095
022300*  FOR EXPENSE TRANSACTIONS, IF THE GL ACCT NBR OR STR NBR HAS    02230095
022400*   CHANGED, CREATE A SUMMARY RECORD.                             02240095
022500*  FOR MERCHANDIST TRANSACTIONS;                                  02250095
022600*   IF THE DEPT NBR, CLASS NBR, OR STORE NBR HAS CHANGED, CREATE  02260095
022700*   A SUMMARY RECORD.                                             02270095
022800*  ACCUMULATE DATA FOR SUMMARY AND HEADER RECORDS.                02280095
022900*---------------------------------------------------------------- 02290095
023000                                                                  02300095
023100*  WHEN THE KEYS CHANGE, CREATE A SUMMARY AND HEADER RECORD FOR   02310095
023200*   THE DATA JUST PROCESSED AND SET UP THE NEXT HEADER RECORD.    02320095
023300     IF AP045-KEY-FIELDS NOT = HEADR-KEY-FIELDS                   02330095
023400         PERFORM C100-PROCESS-SUMMARY-BREAK                       02340095
023500         PERFORM C200-PROCESS-HEADER-BREAK                        02350095
023600         PERFORM C300-SETUP-HEADER-SUMMARY                        02360095
023700     END-IF.                                                      02370095
023800                                                                  02380095
023900     IF AP045-STR-NBR NOT = HEADR-HDR-STR-NBR                     02390095
024000         MOVE ZEROES             TO HEADR-HDR-STR-NBR             02400095
024100     END-IF.                                                      02410095
024200                                                                  02420095
024300*  FOR EXPENSE TRANSACTIONS, IF THE GL ACCT NBR OR STR NBR HAS    02430095
024400*   CHANGED, CREATE A SUMMARY RECORD.                             02440095
024500     IF AP045-EXPENSE                                             02450095
024600         IF AP045-GL-ACCT-NBR NOT = SUMRY-GL-ACCT-NBR             02460095
024700           OR AP045-STR-NBR NOT = SUMRY-STR-NBR                   02470095
024800                                                                  02480095
024900             PERFORM C100-PROCESS-SUMMARY-BREAK                   02490095
025000         END-IF                                                   02500095
025100     ELSE                                                         02510095
025200*  FOR MERCHANDIST TRANSACTIONS;                                  02520095
025300*   IF THE DEPT NBR, CLASS NBR, STORE NBR, OR SKU NBR HAS         02530099
025310*   CHANGED, CREATE A SUMMARY RECORD.                             02531099
025320*       DISPLAY 'DEPT = ' AP045-DEPT-NBR ' ' SUMRY-DEPT-NBR       02532099
025330*       DISPLAY 'STR = ' AP045-STR-NBR ' '  SUMRY-STR-NBR         02533099
025340*       DISPLAY 'CL = ' AP045-CL-NBR ' ' SUMRY-CL-NBR             02534099
025350*       DISPLAY 'SKU =  ' AP045-SKU-NBR ' ' SUMRY-SKU-NBR         02535099
025500         IF AP045-DEPT-NBR NOT = SUMRY-DEPT-NBR                   02550095
025600           OR AP045-STR-NBR NOT = SUMRY-STR-NBR                   02560095
025700           OR AP045-CL-NBR NOT = SUMRY-CL-NBR                     02570095
025710           OR AP045-SKU-NBR NOT = SUMRY-SKU-NBR                   02571099
025800                                                                  02580095
025900             PERFORM C100-PROCESS-SUMMARY-BREAK                   02590095
026000         END-IF                                                   02600095
026100     END-IF.                                                      02610095
026200                                                                  02620095
026300*  ACCUMULATE DATA FOR SUMMARY AND HEADER RECORDS.                02630095
026400     ADD AP045-GRO-COST-AMT      TO SUMRY-GRO-COST-AMT            02640095
026500                                    HEADR-TOT-GRO-COST-AMT.       02650095
026600     ADD AP045-RETL-AMT          TO SUMRY-RETL-AMT                02660095
026700                                    HEADR-TOT-RETL-AMT.           02670095
026800     ADD AP045-FRGT-AMT          TO SUMRY-FRGT-AMT                02680095
026900                                    HEADR-TOT-FRGT-AMT.           02690095
027000     ADD AP045-MISC-CHRG-AMT     TO SUMRY-MISC-CHRG-AMT           02700095
027100                                    HEADR-TOT-MISC-CHRG-AMT.      02710095
027200     ADD AP045-NET-COST-AMT      TO SUMRY-NET-COST-AMT            02720095
027300                                    HEADR-TOT-NET-COST-AMT.       02730095
027400     ADD AP045-DTL-TERM-DISC-AMT TO SUMRY-DTL-TERM-DISC-AMT       02740095
027500                                    HEADR-TOT-TERM-DISC-AMT.      02750095
027600     ADD AP045-DTL-NW-STR-DISC-AMT                                02760095
027700                                 TO SUMRY-DTL-NW-STR-DISC-AMT     02770095
027800                                    HEADR-TOT-NW-STR-DISC-AMT.    02780095
027900     ADD AP045-DTL-TRD-DISC-AMT  TO SUMRY-DTL-TRD-DISC-AMT        02790095
028000                                    HEADR-TOT-TRD-DISC-AMT.       02800095
028100     ADD AP045-DTL-MOS-DISC-AMT  TO SUMRY-DTL-MOS-DISC-AMT        02810095
028200                                    HEADR-TOT-MOS-DISC-AMT.       02820095
028300                                                                  02830095
028400     IF AP045-RSN-1ST-LNE-TXT > SPACES AND                        02840095
028500        (AP045-AP-TRN-CDE = '45' OR                               02850095
028600        AP045-AP-TRN-CDE = '46') AND                              02860095
028700        PV-INSPECT-CNT < 6                                        02870095
028800        PERFORM B250-PROCESS-PRO-BILL                             02880095
028900     END-IF.                                                      02890095
029000                                                                  02900095
029100     PERFORM R100-READ-ADJ-TRANS-FILE.                            02910095
029200     IF PS-ADJ-TRANS-FOUND                                        02920095
029300       AND NOT AP045-DETAIL-RECORD                                02930095
029400         SET AC-INVALID-KEY-READ TO TRUE                          02940095
029500         MOVE 'B200-PROCESS-ADJ-TRANS-FILE'                       02950095
029600                                 TO AA-PARAGRAPH-NAME             02960095
029700         DISPLAY 'RECORD TYPE <> 2, ONLY PROCESS DETAIL RECORDS'  02970095
029800         MOVE 'RECORD TYPE NOT = 2'                               02980095
029900                                 TO AA-MESSAGE                    02990095
030000         PERFORM Z998-ABEND                                       03000095
030100     END-IF.                                                      03010095
030200                                                                  03020095
030300                                                                  03030095
030400 B250-PROCESS-PRO-BILL.                                           03040095
030500*---------------------------------------------------------------- 03050095
030600*  EVALUATE WHETHER THE CURRENT PRO BILL NUMBER IS ALREADY IN     03060095
030700*  THE TEXT FIELD.  IF IT IS NOT STRING IT AT THE END.            03070095
030800*---------------------------------------------------------------- 03080095
030900                                                                  03090095
031000     INITIALIZE PV-CHAR-CNT.                                      03100095
031100     INSPECT AP045-RSN-1ST-LNE-TXT TALLYING PV-CHAR-CNT           03110095
031200        FOR ALL SPACES.                                           03120095
031300                                                                  03130095
031400     INITIALIZE PV-PRO-CNT.                                       03140095
031500     INSPECT PV-PRO-BILL-TXT TALLYING PV-PRO-CNT                  03150095
031600        FOR ALL AP045-RSN-1ST-LNE-TXT(1:50 - PV-CHAR-CNT).        03160095
031700                                                                  03170095
031800     IF PV-PRO-CNT = 0                                            03180095
031900        ADD +1 TO PV-INSPECT-CNT                                  03190095
032000        STRING PV-PRO-BILL-TXT   DELIMITED BY '  ',               03200095
032100           ' '                   DELIMITED BY SIZE,               03210095
032200           AP045-RSN-1ST-LNE-TXT DELIMITED BY SPACE               03220095
032300         INTO PV-PRO-BILL-TXT                                     03230095
032400        END-STRING                                                03240095
032500     END-IF.                                                      03250095
032600                                                                  03260095
032700 B300-END-OF-PROGRAM.                                             03270041
032800*---------------------------------------------------------------- 03280034
032900*    END OF PROGRAM PROCESSING.                                   03290034
033000*  CREATE A SUMMARY AND HEADER RECORD FOR THE LAST DATA PROCESSED.03300041
033100*---------------------------------------------------------------- 03310034
033200                                                                  03320034
033300*  CREATE A SUMMARY AND HEADER RECORD FOR THE LAST DATA PROCESSED.03330035
033400     IF PV-AP045-READ > ZEROES                                    03340035
033500         PERFORM C100-PROCESS-SUMMARY-BREAK                       03350035
033600         PERFORM C200-PROCESS-HEADER-BREAK                        03360035
033700     END-IF.                                                      03370035
033800                                                                  03380035
033900     CLOSE ADJ-TRANS-FILE                                         03390035
034000           SUMRY-TRANS-FILE.                                      03400040
034100                                                                  03410095
034200     DISPLAY ' '.                                                 03420095
034300     DISPLAY '**  APKUT131 PROCESSING ENDS NOW **'.               03430095
034400     DISPLAY ' '.                                                 03440095
034500     DISPLAY 'NBR OF AP045 RECORDS READ     = ' PV-AP045-READ.    03450095
034600     DISPLAY ' '.                                                 03460095
034700     DISPLAY 'NBR OF HEADER RECORDS WRITTEN = ' PV-HEADR-WRITTEN. 03470095
034800     DISPLAY 'NBR OF DETAIL RECORDS WRITTEN = ' PV-SUMRY-WRITTEN. 03480095
034900     DISPLAY 'NBR OF AP045 RECORDS WRITTEN  = ' PV-AP045-WRITTEN. 03490095
035000     DISPLAY '*************************************'.             03500095
035100                                                                  03510095
035200                                                                  03520095
035300 C100-PROCESS-SUMMARY-BREAK.                                      03530095
035400*---------------------------------------------------------------- 03540095
035500*  WRITE A SUMMARY RECORD FOR THE DATA JUST ACCUMULATED. THEN     03550095
035600*   SET UP FOR THE NEXT SUMMARY RECORD.                           03560095
035700*---------------------------------------------------------------- 03570095
035800                                                                  03580095
035900     SET SUMRY-DETAIL-RECORD     TO TRUE.                         03590095
036000                                                                  03600095
036100     IF SUMRY-PYMT-DUE-DTE = SPACES OR                            03610095
036200        SUMRY-PYMT-DUE-DTE = HIGH-VALUES OR                       03620095
036300        SUMRY-PYMT-DUE-DTE = LOW-VALUES                           03630095
036400        MOVE AP045-ENTR-DTE TO SUMRY-PYMT-DUE-DTE                 03640095
036500     END-IF.                                                      03650095
036600                                                                  03660095
036700     PERFORM W100-WRITE-AP045-SUMRY-RECORD.                       03670095
036800     ADD +1                      TO PV-SUMRY-WRITTEN.             03680095
036900                                                                  03690095
037000     MOVE AP045-TRANSACTION-FILE TO SUMRY-TRANSACTION-FILE.       03700095
037100                                                                  03710095
037200     INITIALIZE SUMRY-DETAIL-FIELDS.                              03720095
037300     MOVE AP045-STR-NBR          TO SUMRY-STR-NBR.                03730095
037400     MOVE AP045-CL-NBR           TO SUMRY-CL-NBR.                 03740095
037500     MOVE AP045-SKU-NBR          TO SUMRY-SKU-NBR.                03750098
037600                                                                  03760095
037700                                                                  03770095
037800 C200-PROCESS-HEADER-BREAK.                                       03780095
037900*---------------------------------------------------------------- 03790095
038000*  WRITE A HEADER RECORD FOR THE DATA JUST ACCUMULATED.           03800095
038100*---------------------------------------------------------------- 03810095
038200                                                                  03820095
038300* 01-05-00 START                                                  03830095
038400     IF HEADR-AP-TRN-CDE = '46'                                   03840095
038500        MOVE PV-HOLD-TEXT-LINE (1:50) TO HEADR-RSN-1ST-LNE-TXT    03850095
038600        MOVE PV-HOLD-TEXT-LINE (51:50) TO HEADR-RSN-2ND-LNE-TXT   03860095
038700     END-IF.                                                      03870095
038800     INITIALIZE PV-PRO-BILL-TXT                                   03880095
038900                PV-INSPECT-CNT.                                   03890095
039000* 01-05-00 END                                                    03900095
039100                                                                  03910095
039200     IF HEADR-PYMT-DUE-DTE = SPACES OR                            03920095
039300        HEADR-PYMT-DUE-DTE = HIGH-VALUES OR                       03930095
039400        HEADR-PYMT-DUE-DTE = LOW-VALUES                           03940095
039500        MOVE AP045-ENTR-DTE TO HEADR-PYMT-DUE-DTE                 03950095
039600     END-IF.                                                      03960095
039700                                                                  03970095
039800     MOVE HEADR-TRANSACTION-FILE TO SUMRY-TRANSACTION-FILE.       03980034
039900     SET SUMRY-HEADER-RECORD     TO TRUE.                         03990034
040000                                                                  04000034
040100     PERFORM W100-WRITE-AP045-SUMRY-RECORD.                       04010034
040200     ADD +1                      TO PV-HEADR-WRITTEN.             04020034
040300                                                                  04030034
040400                                                                  04040034
040500 C300-SETUP-HEADER-SUMMARY.                                       04050034
040600*---------------------------------------------------------------- 04060034
040700*   SET UP FOR THE NEXT HEADER RECORD.                            04070095
040800*---------------------------------------------------------------- 04080095
040900                                                                  04090095
041000     MOVE AP045-TRANSACTION-FILE TO HEADR-TRANSACTION-FILE        04100095
041100                                    SUMRY-TRANSACTION-FILE.       04110095
041200     MOVE SPACES                 TO HEADR-HEADER-FIELDS           04120095
041300                                    SUMRY-DETAIL-FIELDS.          04130095
041400     INITIALIZE HEADR-HEADER-FIELDS                               04140095
041500                SUMRY-DETAIL-FIELDS.                              04150095
041600                                                                  04160095
041700     MOVE AP045-STR-NBR          TO SUMRY-STR-NBR                 04170095
041800                                    HEADR-HDR-STR-NBR.            04180095
041900     MOVE AP045-CL-NBR           TO SUMRY-CL-NBR.                 04190095
042000     MOVE AP045-SKU-NBR          TO SUMRY-SKU-NBR.                04200097
042100                                                                  04210095
042200                                                                  04220095
042300 R100-READ-ADJ-TRANS-FILE.                                        04230095
042400*---------------------------------------------------------------- 04240095
042500*    READ THE ADJ-TRANS-FILE INTO COPYBOOK APRD045                04250095
042600*---------------------------------------------------------------- 04260095
042700                                                                  04270095
042800     READ ADJ-TRANS-FILE INTO AP045-TRANSACTION-FILE              04280095
042900         AT END                                                   04290095
043000             SET PS-ADJ-TRANS-END TO TRUE.                        04300095
043100                                                                  04310095
043200     IF PS-ADJ-TRANS-FOUND                                        04320095
043300         ADD 1 TO PV-AP045-READ                                   04330095
043400     END-IF.                                                      04340095
043500                                                                  04350095
043600                                                                  04360095
043700 W100-WRITE-AP045-SUMRY-RECORD.                                   04370095
043800*---------------------------------------------------------------- 04380095
043900*    WRITES THE AP045 RECORD                                      04390095
044000*---------------------------------------------------------------- 04400095
044100                                                                  04410095
044200     WRITE SUMRY-TRANS-RECORD    FROM SUMRY-TRANSACTION-FILE.     04420095
044300     ADD +1                      TO PV-AP045-WRITTEN.             04430095
044400                                                                  04440095
044500                                                                  04450095
044600 Z998-ABEND.                                                      04460095
044700*---------------------------------------------------------------- 04470095
044800*    ABEND ROUTINE FOR NON DB2 ERRORS                             04480095
044900*---------------------------------------------------------------- 04490095
045000                                                                  04500095
045100     CLOSE ADJ-TRANS-FILE                                         04510095
045200           SUMRY-TRANS-FILE.                                      04520095
045300                                                                  04530095
045400     DISPLAY ' '.                                                 04540095
045500     DISPLAY '**  APKUT131 PROCESSING ABENDED  **'.               04550095
045600     DISPLAY ' '.                                                 04560095
045700     DISPLAY 'NBR OF AP045 RECORDS READ     = ' PV-AP045-READ.    04570095
045800     DISPLAY ' '.                                                 04580095
045900     DISPLAY 'NBR OF HEADER RECORDS WRITTEN = ' PV-HEADR-WRITTEN. 04590095
046000     DISPLAY 'NBR OF DETAIL RECORDS WRITTEN = ' PV-SUMRY-WRITTEN. 04600095
046100     DISPLAY 'NBR OF AP045 RECORDS WRITTEN  = ' PV-AP045-WRITTEN. 04610095
046200     DISPLAY '*************************************'.             04620095
046300     DISPLAY 'INVALID INPUT RECORD = ' AP045-KEY-FIELDS.          04630095
046400     DISPLAY '  PO NUMBER         = ' AP045-PO-NBR.               04640095
046500                                                                  04650095
046600     CALL 'ILBOABN0' USING ABEND-CODE.                            04660095
046700                                                                  04670095
046800                                                                  04680095
