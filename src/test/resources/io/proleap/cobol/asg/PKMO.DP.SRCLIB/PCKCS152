000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    PCKCS152.                                         00020001
000300 AUTHOR.        MARC BLAZICH.                                     00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  01-17-93.                                         00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800*---------------------------------------------------------------* 00080001
000900*    E152 - WORK ORDER LIST.                                    * 00090001
001000*                                                               * 00100001
001100*    THIS PROGRAM WILL GENERATE A LIST OF WORK ORDERS.  IT CAN  * 00110001
001200*    BE INVOKED FROM EITHER A CRITERIA SPEC, OR ANOTHER LIST    * 00120001
001300*    SCREEN.                                                    * 00130001
001400*                                                               * 00140001
001500*  08/09/95 - IF SQLCODE = -913, -911, -904, PUT THE MESSAGES   * 00150001
001600*    TO THE SCREENS INSTEAD OF ABENDING THE TRANSACTION.        * 00160001
001700*    BY H. KIM                                                  * 00170001
001800*---------------------------------------------------------------* 00180001
001810* DATE  11/04/2021                                                00181019
001820*            - CHANGE CALL OF 'DPKUT100' TO                     * 00182019
001830*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00183019
001840*              MAKING THE CALL DYNAMIC VS STATIC                * 00184019
001850*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00185020
1122RM*---------------------------------------------------------------- 00185121
1122RM* DATE  11/07/2022                                              * 00185221
1122RM*            - ADD COPYBOOK DPWS930                             * 00185321
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00185421
1122RM*              DYNAMIC.                                         * 00185521
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00185621
001860*-----------------------------------------------------------------00186019
001900/                                                                 00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100                                                                  00210001
002200 DATA DIVISION.                                                   00220001
002300                                                                  00230001
002400 WORKING-STORAGE SECTION.                                         00240001
002500                                                                  00250001
002600 01  DK-DB2-KEYS.                                                 00260001
002700*    REQUIRED FIELDS                                              00270001
002800     05  DK-OPERATING-UNIT-ID           PIC S9(04)  COMP.         00280001
002900     05  DK-FACILITY-ID                 PIC S9(04)  COMP.         00290001
003000     05  DK-ORD-NBR                     PIC S9(09)  COMP.         00300001
003100     05  DK-RCVR-SEQ-NBR                PIC S9(09)  COMP.         00310001
003200     05  DK-LINE-NBR                    PIC S9(04)  COMP.         00320001
003300*    OPTIONAL FIELDS                                              00330001
003400     05  DK-STAT-CDE-LOW                PIC  X(02).               00340001
003500     05  DK-STAT-CDE-HIGH               PIC  X(02).               00350001
003600     05  DK-WORK-ORD-SEQ-NBR-LOW        PIC S9(04)  COMP.         00360001
003700     05  DK-WORK-ORD-SEQ-NBR-HIGH       PIC S9(04)  COMP.         00370001
003800                                                                  00380001
003900 01  PC-PROGRAM-CONSTANTS.                                        00390001
004000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00400001
004100                                                    'PC152A  '.   00410001
004200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00420001
004300                                                    'PCKM152 '.   00430001
004400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00440001
004500                                                    'PCKCS152'.   00450001
004600     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00460001
004700                                                    COMP.         00470001
004800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00480001
004900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00490001
005000     05  PC-WORK-ORDER-DIST-SHEET       PIC  9(03)  VALUE 001.    00500001
005100     05  PC-INTER-APPL-CODES.                                     00510001
005200         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.    00520001
005300         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '5'.    00530001
005400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +6      00540001
005500                                                    COMP SYNC.    00550001
005600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00560001
005700                                                    COMP SYNC.    00570001
005800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00580001
005900                                                    +1000000      00590001
006000                                                    COMP-3.       00600001
006100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00610001
006200                                                    COMP SYNC.    00620001
006300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00630001
006400                                                    COMP-3.       00640001
006500     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00650001
006600     05  PC-N                           PIC  X(01)  VALUE 'N'.    00660001
006700     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00670001
006800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00680001
006900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00690001
007000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00700001
007100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00710001
007200                                                                  00720001
007300     05  PC-TSYMSG-NUMBERS.                                       00730001
007400         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00740001
007500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00750001
007600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00760001
007700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770001
007800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00780001
007900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00790001
008000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00800001
008100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00810001
008200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00820001
008300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00830001
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00840001
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00850001
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00860001
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870001
008800         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00880001
008900         10  PC-TSYMSG-00736            PIC  9(05)  VALUE 00736.  00890001
009000         10  PC-TSYMSG-00737            PIC  9(05)  VALUE 00737.  00900001
009100         10  PC-TSYMSG-00738            PIC  9(05)  VALUE 00738.  00910001
009200         10  PC-TSYMSG-00739            PIC  9(05)  VALUE 00739.  00920001
009300         10  PC-TSYMSG-00740            PIC  9(05)  VALUE 00740.  00930001
009400                                                                  00940001
009500 01  PS-PROGRAM-SWITCHES.                                         00950001
009600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00960001
009700         88  PS-NO-ERROR                            VALUE 'Y'.    00970001
009800         88  PS-ERROR                               VALUE 'N'.    00980001
009900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00990001
010000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01000001
010100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01010001
010200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01020001
010300         88  PS-DONE                                VALUE 'Y'.    01030001
010400         88  PS-NOT-DONE                            VALUE 'N'.    01040001
010500                                                                  01050001
010600 01  PV-PROGRAM-VARIABLES.                                        01060001
010700     05  PV-SUB                         PIC S9(04)  VALUE +0      01070001
010800                                                    COMP SYNC.    01080001
010900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01090001
011000                                                    COMP SYNC.    01100001
011100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01110001
011200                                                    COMP-3.       01120001
011300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01130001
011400                                                    COMP-3.       01140001
011500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01150001
011600                                                    COMP-3.       01160001
011700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01170001
011800                                                    COMP-3.       01180001
011900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01190001
012000                                                    COMP-3.       01200001
012100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01210001
012200                                                    COMP-3.       01220001
012300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01230001
012400                                                    COMP-3.       01240001
012500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01250001
012600                                                    COMP SYNC.    01260001
012700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01270001
012800                                                    COMP SYNC.    01280001
012900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01290001
013000                                                    COMP SYNC.    01300001
013100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01310001
013200                                                    COMP SYNC.    01320001
013300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01330001
013400                                                    COMP SYNC.    01340001
013500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01350001
013600                                                    COMP SYNC.    01360001
013700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01370001
013800                                                    COMP SYNC.    01380001
013900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01390001
014000                                                    COMP SYNC.    01400001
014100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01410001
014200                                                    COMP SYNC.    01420001
014300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01430001
014400                                                    COMP SYNC.    01440001
014500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01450001
014600                                                    COMP SYNC.    01460001
014700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01470001
014800                                                    COMP SYNC.    01480001
014900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01490001
015000                                                    COMP SYNC.    01500001
015100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01510001
015200                                                    COMP SYNC.    01520001
015300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01530001
015400                                                    COMP SYNC.    01540001
015500     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01550001
015600                                                    COMP-3.       01560001
015700     05  PV-WO-NBR                      PIC S9(04)  VALUE +0      01570001
015800                                                    COMP SYNC.    01580001
015900     05  PV-RECVR-STATUS-CDE            PIC  X(02)  VALUE SPACES. 01590001
016000     05  PV-ITMS-PER-CTN-WHOLE          PIC  9(5).                01600001
016100     05  PV-ITMS-PER-CTN-REM            PIC  9(2).                01610001
016110     05  PV-DISPLAY-SKU-NBR             PIC  X(08).               01611015
016200                                                                  01620001
016300*---------------------------------------------------------------* 01630001
016400*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01640001
016500*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01650001
016600*   APPLICATION-SPECIFIC COMMAREA.                              * 01660001
016700*---------------------------------------------------------------* 01670001
016800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01680001
016900     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  01690001
017000     05  LQW-ITEM-ENTRIES               OCCURS 6 TIMES            01700001
017100                                        INDEXED BY LQW-IDX.       01710001
017200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01720001
017300         10  LQW-TEMP-SELECTED-SW       PIC X(01).                01730001
017400         10  LQW-SELECTED-SW            PIC X(01).                01740001
017500             88  LQW-SELECT                         VALUE 'S'.    01750001
017600             88  LQW-DESELECT                       VALUE ' '.    01760001
017700         10  LQW-WORK-ORD-SEQ-NBR       PIC 9(3).                 01770001
017800         10  LQW-STAT-CDE               PIC X(2).                 01780001
017900         10  LQW-EXPTED-CART-CNT        PIC 9(5).                 01790001
018000         10  LQW-ACTL-CART-CNT          PIC 9(5).                 01800001
018100         10  LQW-EXPTED-ITM-CNT         PIC 9(5).                 01810001
018200         10  LQW-ACTL-ITM-CNT           PIC 9(5).                 01820001
018300         10  LQW-TWKORIN-CNT            PIC 9(3).                 01830001
018400                                                                  01840001
018500/                                                                 01850001
018600*---------------------------------------------------------------* 01860001
018700*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01870001
018800*---------------------------------------------------------------* 01880001
018900                                                                  01890001
019000     COPY PCWS016.                                                01900001
019100                                                                  01910001
019200/                                                                 01920001
019300*---------------------------------------------------------------* 01930001
019400*    MAP LAYOUT                                                 * 01940001
019500*---------------------------------------------------------------* 01950001
019600                                                                  01960001
019700     COPY PCKM152.                                                01970001
019800                                                                  01980001
019900 01  MR-OCCURS-LAYOUT                   REDEFINES  PC152AO.       01990001
020000     05  FILLER                         PIC X(213).               02000012
020100                                                                  02010001
020200     05  MR-SCROLL-AREA                 OCCURS 6 TIMES.           02020001
020300         10  MR-SELECTL                 PIC S9(04) COMP.          02030001
020400         10  MR-SELECTA                 PIC X(01).                02040001
020500         10  MR-SELECTC                 PIC X(01).                02050001
020600         10  MR-SELECTH                 PIC X(01).                02060001
020700         10  MR-SELECT                  PIC X(01).                02070001
020800                                                                  02080001
020900**DANH   10  FILLER                     PIC X(05).                02090001
021000**DANH   10  MR-ACTION                  PIC X(03).                02100001
021100**DANH                                                            02110001
021200         10  FILLER                     PIC X(05).                02120001
021300         10  MR-WORK-ORD-SEQ-NBR-X.                               02130001
021400             15  MR-WORK-ORD-SEQ-NBR    PIC Z(3).                 02140001
021500                                                                  02150001
021600         10  FILLER                     PIC X(05).                02160001
021700         10  MR-WORK-ORD-STAT-CDE       PIC X(02).                02170001
021800                                                                  02180001
021900         10  FILLER                     PIC X(05).                02190001
022000         10  MR-EXPTED-CART-CNT-X.                                02200001
022100             15  MR-EXPTED-CART-CNT     PIC Z(5).                 02210001
022200                                                                  02220001
022300         10  FILLER                     PIC X(05).                02230001
022400         10  MR-ACTL-CART-CNT-X.                                  02240001
022500             15  MR-ACTL-CART-CNT       PIC Z(5).                 02250001
022600                                                                  02260001
022700                                                                  02270001
022800         10  FILLER                     PIC X(05).                02280001
022900         10  MR-EXPTED-ITM-CNT-X.                                 02290001
023000             15  MR-EXPTED-ITM-CNT      PIC Z(5).                 02300001
023100                                                                  02310001
023200         10  FILLER                     PIC X(05).                02320001
023300         10  MR-ACTL-ITM-CNT-X.                                   02330001
023400             15  MR-ACTL-ITM-CNT        PIC Z(5).                 02340001
023500                                                                  02350001
023600         10  FILLER                     PIC X(05).                02360001
023700         10  MR-WO-INSTRUCTIONS-X.                                02370001
023800             15  MR-WO-INSTRUCTIONS     PIC ZZZ.                  02380001
023900                                                                  02390001
024000/                                                                 02400001
024100*---------------------------------------------------------------* 02410001
024200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02420001
024300*---------------------------------------------------------------* 02430001
024400                                                                  02440001
024500     COPY DPWS015.                                                02450001
024600                                                                  02460001
024610*---------------------------------------------------------------* 02461003
024620*    COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE            02462003
024630*---------------------------------------------------------------* 02463003
024640                                                                  02464003
024650     COPY XLWS001.                                                02465004
024660                                                                  02466003
024700*---------------------------------------------------------------* 02470001
024800*    FUNCTION KEYS COPYBOOK.                                    * 02480001
024900*---------------------------------------------------------------* 02490001
025000                                                                  02500001
025100     COPY DPWS016.                                                02510001
025200                                                                  02520001
025300*---------------------------------------------------------------* 02530001
025400*    NUMERIC EDIT LAYOUT.                                       * 02540001
025500*---------------------------------------------------------------* 02550001
025600                                                                  02560001
025700     COPY DPWS010I.                                               02570001
025800                                                                  02580001
025900/                                                                 02590001
026000*---------------------------------------------------------------* 02600001
026100*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02610001
026200*---------------------------------------------------------------* 02620001
026300                                                                  02630001
026400     COPY DPWS030.                                                02640001
1122RM     COPY DPWS930.                                                02641021
026500                                                                  02650001
026600/                                                                 02660001
026700*---------------------------------------------------------------* 02670001
026800*    STANDARD COMMAREA.                                         * 02680001
026900*---------------------------------------------------------------* 02690001
027000                                                                  02700001
027100     COPY DPWS020.                                                02710001
027200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02720001
027300                                                                  02730001
027400*---------------------------------------------------------------* 02740001
027500* INTER-APPLICATION COMMAREA.                                   * 02750001
027600*---------------------------------------------------------------* 02760001
027700                                                                  02770001
027800         10  INTER-APPL-COMM-AREA       PIC X(200).               02780001
027900     COPY PCWS000.                                                02790001
028000*---------------------------------------------------------------* 02800001
028100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02810001
028200*---------------------------------------------------------------* 02820001
028300         10  ASC-SPECIFIC-COMMAREA.                               02830001
028400             15  ASC-OPERATING-UNIT-ID      PIC 9(04).            02840001
028500             15  ASC-FACILITY-ID            PIC 9(04).            02850001
028600             15  ASC-WORK-ORD-SEQ-NBR-SAVE  PIC 9(03).            02860001
028700             15  ASC-LIST-KEYS.                                   02870001
028800                 20  ASC-PO-NBR             PIC 9(08).            02880001
028900                 20  ASC-REC-SEQ-NBR        PIC 9(03).            02890001
029000                 20  ASC-LINE-NBR           PIC 9(04).            02900001
029100             15  ASC-OTHER-TOP-OF-SCREEN-DATA.                    02910001
029200                 20  ASC-TRECITM-DATA.                            02920001
029300                     25  ASC-TRECITM-PKSL-ITM-QTY     PIC 9(5).   02930001
029400                     25  ASC-TRECITM-DTL-CK-ITM-QTY   PIC 9(5).   02940001
029500                     25  ASC-TRECITM-EXPTED-CART-CNT  PIC 9(5).   02950001
029600                     25  ASC-TRECITM-ACTL-CART-CNT    PIC 9(5).   02960001
029700*                20  ASC-TPURITM-DATA.                            02970010
029800                                                                  02980003
029900                 20  ASC-TPURCHS-DEPT-NBR     PIC X(3).           02990003
030000                 20  ASC-TPURITM-CL-NBR       PIC X(2).           03000003
030100                 20  ASC-NIS-SKU-SEQ-NBR      PIC X(8).           03010003
030110*                                                                 03011011
030200                 20  ASC-TPURITM-SKU-DESC         PIC X(25).      03020009
030300                 20  ASC-TPURITM-VEND-STYL-NAME   PIC X(20).      03030009
030400             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03040001
030500                 20  ASC-BLOCK-MODIFIED-SW                        03050001
030600                                        PIC X(01).                03060001
030700                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03070001
030800                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03080001
030900                                                                  03090001
031000                 20  ASC-ITEM-ARRAY.                              03100001
031100                     25  ASC-ITEM-ENTRIES OCCURS 6 TIMES.         03110001
031200                         30  ASC-LIST-ITEM-NUMBER                 03120001
031300                                        PIC S9(09) COMP-3.        03130001
031400                         30  ASC-TEMP-SELECTED-SW                 03140001
031500                                        PIC X(01).                03150001
031600                             88  ASC-VALID-SELECT  VALUE ' '      03160001
031700                                                         'S'      03170001
031800                                                         'B'      03180001
031900                                                         'E'.     03190001
032000                             88  ASC-TEMP-NO-SELECT               03200001
032100                                                   VALUE ' '.     03210001
032200                             88  ASC-TEMP-SELECT   VALUE 'S'.     03220001
032300                             88  ASC-TEMP-BEGIN    VALUE 'B'.     03230001
032400                             88  ASC-TEMP-END      VALUE 'E'.     03240001
032500                         30  ASC-SELECTED-SW                      03250001
032600                                        PIC X(01).                03260001
032700                             88  ASC-NO-SELECT     VALUE ' '.     03270001
032800                             88  ASC-SELECT        VALUE 'S'.     03280001
032900                             88  ASC-BEGIN         VALUE 'B'.     03290001
033000                             88  ASC-END           VALUE 'E'.     03300001
033100                         30  ASC-WORK-ORD-SEQ-NBR  PIC 9(3).      03310001
033200                         30  ASC-STAT-CDE          PIC X(2).      03320001
033300                         30  ASC-EXPTED-CART-CNT   PIC 9(5).      03330001
033400                         30  ASC-ACTL-CART-CNT     PIC 9(5).      03340001
033500                         30  ASC-EXPTED-ITM-CNT    PIC 9(5).      03350001
033600                         30  ASC-ACTL-ITM-CNT      PIC 9(5).      03360001
033700                         30  ASC-TWKORIN-CNT       PIC 9(3).      03370001
033800                                                                  03380001
033900             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03390001
034000             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03400001
034100             15  ASC-SEL-SUB            PIC S9(04) COMP.          03410001
034200             15  ASC-SEL-ITEM           PIC S9(04) COMP.          03420001
034300             15  ASC-NUMBER-OF-ITEMS-READ                         03430001
034400                                        PIC S9(09) COMP-3.        03440001
034500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03450001
034600                                        PIC S9(09) COMP-3.        03460001
034700             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        03470001
034800             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03480001
034900             15  ASC-ITEM-AT-TOP-OF-PANEL                         03490001
035000                                        PIC S9(09) COMP-3.        03500001
035100             15  ASC-ITEM-AT-BOT-OF-PANEL                         03510001
035200                                        PIC S9(09) COMP-3.        03520001
035300             15  ASC-HIGHEST-BLOCK-WRITTEN                        03530001
035400                                        PIC S9(04) COMP SYNC.     03540001
035500             15  ASC-START-OF-SELECTED-RANGE                      03550001
035600                                        PIC S9(09) COMP-3.        03560001
035700             15  ASC-END-OF-SELECTED-RANGE                        03570001
035800                                        PIC S9(09) COMP-3.        03580001
035900             15  ASC-ITEMS-LEFT-INDICATOR                         03590001
036000                                        PIC X(01).                03600001
036100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03610001
036200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03620001
036300             15  ASC-TEMP-QUEUE-UPDATE-SW                         03630001
036400                                        PIC X(01).                03640001
036500                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03650001
036600                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03660001
036700             15  ASC-LIST-QUEUE-NAME.                             03670001
036800                 20  ASC-LIST-TERM-ID   PIC X(04).                03680001
036900                 20  ASC-LIST-TASK-NUMBER                         03690001
037000                                        PIC S9(05) COMP-3.        03700001
037100                 20  ASC-LIST-SEQ       PIC 9(01).                03710001
037200             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               03720001
037300             15  ASC-SEL-QUEUE-NAME-OUT.                          03730001
037400                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               03740001
037500                 20  ASC-SEL-TASK-NUMBER-OUT                      03750001
037600                                         PIC S9(05) COMP-3.       03760001
037700                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               03770001
037800                                                                  03780001
037900             15  ASC-START-ITEM-REQUEST.                          03790001
038000                 20  ASC-START-ITEM-REQUEST-N  PIC 9(07).         03800001
038100             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         03810001
038200                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         03820001
038300/                                                                 03830001
038400*---------------------------------------------------------------* 03840001
038500*    ABEND PROCESSING COPYBOOK.                                 * 03850001
038600*---------------------------------------------------------------* 03860001
038700                                                                  03870001
038800     COPY DPWS013.                                                03880001
038900                                                                  03890001
039000/                                                                 03900001
039100*---------------------------------------------------------------* 03910001
039200*    DB2 AREA FOR THE WORK ORDER TABLE                          * 03920001
039300*---------------------------------------------------------------* 03930001
039400     EXEC SQL                                                     03940001
039500          INCLUDE TWRKORD                                         03950001
039600     END-EXEC.                                                    03960001
039700                                                                  03970001
039800/                                                                 03980001
039900*---------------------------------------------------------------* 03990001
040000*    DB2 AREA FOR THE WORK ORDER INSTRUCTIONS TABLE             * 04000001
040100*---------------------------------------------------------------* 04010001
040200     EXEC SQL                                                     04020001
040300          INCLUDE TWKORIN                                         04030001
040400     END-EXEC.                                                    04040001
040500                                                                  04050001
040600/                                                                 04060001
040700*---------------------------------------------------------------* 04070001
040800*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 04080001
040900*---------------------------------------------------------------* 04090001
041000     EXEC SQL                                                     04100001
041100          INCLUDE TPURCHS                                         04110001
041200     END-EXEC.                                                    04120001
041300                                                                  04130001
041400/                                                                 04140001
041500*---------------------------------------------------------------* 04150001
041600*    DB2 AREA FOR THE PURCHASE ORDER ITEM TABLE                 * 04160001
041700*---------------------------------------------------------------* 04170001
041800     EXEC SQL                                                     04180001
041900          INCLUDE TPURITM                                         04190001
042000     END-EXEC.                                                    04200001
042100                                                                  04210001
042200/                                                                 04220001
042300*---------------------------------------------------------------* 04230001
042400*    DB2 AREA FOR THE RECEIPT ITEM TABLE                        * 04240001
042500*---------------------------------------------------------------* 04250001
042600     EXEC SQL                                                     04260001
042700          INCLUDE TRECITM                                         04270001
042800     END-EXEC.                                                    04280001
042900                                                                  04290001
043000*---------------------------------------------------------------* 04300001
043100*    DB2 AREA FOR COMMUNICATIONS                                * 04310001
043200*---------------------------------------------------------------* 04320001
043300     EXEC SQL                                                     04330001
043400          INCLUDE SQLCA                                           04340001
043500     END-EXEC.                                                    04350001
043600                                                                  04360001
043700/                                                                 04370001
043800*---------------------------------------------------------------* 04380001
043900*  CURSOR TO LIST SHIPMENTS                                     * 04390001
044000*---------------------------------------------------------------* 04400001
044100                                                                  04410001
044200     EXEC SQL                                                     04420001
044300          DECLARE TWRKORD_CSR CURSOR FOR                          04430001
044400           SELECT WORK_ORD_SEQ_NBR                                04440001
044500                 ,STAT_CDE                                        04450001
044600                 ,EXPTED_CART_CNT                                 04460001
044700                 ,ACTL_CART_CNT                                   04470001
044800                 ,EXPTED_ITM_CNT                                  04480001
044900                 ,ACTL_ITM_CNT                                    04490001
045000           FROM   TWRKORD                                         04500001
045100           WHERE  ORD_NBR        = :DK-ORD-NBR                    04510001
045200             AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR               04520001
045300             AND  ORD_LNE_NBR    = :DK-LINE-NBR                   04530001
045400             AND  WORK_ORD_SEQ_NBR    BETWEEN                     04540001
045500                                   :DK-WORK-ORD-SEQ-NBR-LOW AND   04550001
045600                                   :DK-WORK-ORD-SEQ-NBR-HIGH      04560001
045700             AND  OPER_UNT_ID    = :DK-OPERATING-UNIT-ID          04570001
045800             AND  FCLTY_ID       = :DK-FACILITY-ID                04580001
045900             AND  VER_STATUS_CDE = 'A'                            04590001
046000             AND  STAT_CDE            BETWEEN                     04600001
046100                                   :DK-STAT-CDE-LOW       AND     04610001
046200                                   :DK-STAT-CDE-HIGH              04620001
046300         ORDER BY WORK_ORD_SEQ_NBR                                04630001
046400     END-EXEC.                                                    04640001
046500                                                                  04650001
046600/                                                                 04660001
046700 LINKAGE SECTION.                                                 04670001
046800                                                                  04680001
046900 01  DFHCOMMAREA.                                                 04690001
047000     05  FILLER                         OCCURS  1 TO 4072 TIMES   04700001
047100                                        DEPENDING ON EIBCALEN.    04710001
047200         10  FILLER                     PIC X.                    04720001
047300                                                                  04730001
047400/                                                                 04740001
047500 PROCEDURE DIVISION.                                              04750001
047600*---------------------------------------------------------------* 04760001
047700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04770001
047800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04780001
047900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04790001
048000*---------------------------------------------------------------* 04800001
048100 0000-MAIN-MODULE.                                                04810001
048200                                                                  04820001
048300     INITIALIZE DP030-CICS-API-FIELDS.                            04830001
048400                                                                  04840001
048500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04850001
048600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04860001
048700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04870001
048800                                                                  04880001
048900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04890001
049000                                                                  04900001
049100     MOVE LENGTH OF PC152AI        TO DP030-MAP-LENGTH (1).       04910001
049200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04920001
049300                                                                  04930001
049400     PERFORM 0001-CALL-CICS-ARCH-API.                             04940001
049500     PERFORM 1000-CONTROL-PROCESSING                              04950001
049600                                                                  04960001
049700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04970001
049800     PERFORM 0001-CALL-CICS-ARCH-API.                             04980001
049900                                                                  04990001
050000*---------------------------------------------------------------* 05000001
050100*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05010001
050200*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05020001
050300*---------------------------------------------------------------* 05030001
050400 0001-CALL-CICS-ARCH-API.                                         05040001
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               05050021
1122RM     CALL DP930-CICS-ARCH-API                                     05051021
1122RM                     USING DFHEIBLK                               05052021
050600                           DFHCOMMAREA                            05060001
050700                           DP030-CICS-API-FIELDS                  05070001
050800                           DP020-STANDARD-COMMAREA                05080001
050900                           PC152AI.                               05090001
051000                                                                  05100001
051100     IF  DP030-RC-CALL-SUCCESSFUL                                 05110001
051200         CONTINUE                                                 05120001
051300     ELSE                                                         05130001
051400         SET DP013-NO-ROLLBACK                                    05140001
051500             DP013-XCTL-DISPLAY-RESTART                           05150001
051600             DP013-CICS-ABEND      TO TRUE                        05160001
051700         MOVE '0001-CALL-CICS-ARCH-API'                           05170001
051800                                   TO DP013-PARAGRAPH             05180001
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05190021
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05200021
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05201021
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05202021
052100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05210001
052200         PERFORM DP013-0000-PROCESS-ABEND                         05220001
052300     END-IF.                                                      05230001
052400                                                                  05240001
052500*----------------------------------------------------------------*05250001
052600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05260001
052700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05270001
052800*                                                                *05280001
052900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05290001
053000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05300001
053100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05310001
053200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05320001
053300*----------------------------------------------------------------*05330001
053400                                                                  05340001
053500 1000-CONTROL-PROCESSING.                                         05350001
053600                                                                  05360001
053700     EVALUATE TRUE                                                05370001
053800         WHEN DP020-NEXT-ACT-INITIAL                              05380001
053900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05390001
054000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05400001
054100                                      ASC-SEL-TERM-ID-OUT         05410001
054200             MOVE DP020-SRC-TASK-NUMBER                           05420001
054300                                   TO ASC-LIST-TASK-NUMBER        05430001
054400                                      ASC-SEL-TASK-NUMBER-OUT     05440001
054500             MOVE PC-LIST-QUEUE-SEQ                               05450001
054600                                   TO ASC-LIST-SEQ                05460001
054700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             05470001
054800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05480001
054900             IF  PS-COMMAREA-NOT-VALID                            05490001
055000                 SET DP020-MSG-FATAL                              05500001
055100                     DP020-NEXT-ACT-APPL-ERROR                    05510001
055200                                   TO TRUE                        05520001
055300             ELSE                                                 05530001
055400                 PERFORM 4000-BUILD-INITIAL-PANEL                 05540001
055500             END-IF                                               05550001
055600                                                                  05560001
055700         WHEN DP020-NEXT-ACT-READ-MAP                             05570001
055800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05580001
055900                                   TO PV-TOP-ITEM                 05590001
056000             PERFORM 2000-PROCESS-PANEL                           05600001
056100                                                                  05610001
056200         WHEN DP020-NEXT-ACT-RETURN                               05620001
056300              PERFORM 2050-DELETE-LIST-QUEUE                      05630001
056400              PERFORM 4000-BUILD-INITIAL-PANEL                    05640001
056500                                                                  05650001
056600         WHEN OTHER                                               05660001
056700             SET DP013-LOGIC-ABEND TO TRUE                        05670001
056800             SET DP013-NO-ROLLBACK TO TRUE                        05680001
056900             MOVE '1000-CONTROL-PROCESSING'                       05690001
057000                                   TO DP013-PARAGRAPH             05700001
057100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05710001
057200                                   TO DP013-MESSAGE-TEXT(1)       05720001
057300             PERFORM DP013-0000-PROCESS-ABEND                     05730001
057400     END-EVALUATE.                                                05740001
057500                                                                  05750001
057600/                                                                 05760001
057700*----------------------------------------------------------------*05770001
057800* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05780001
057900*----------------------------------------------------------------*05790001
058000                                                                  05800001
058100 1100-PROCESS-INTER-APPL-COMM.                                    05810001
058200                                                                  05820001
058300*----------------------------------------------------------------*05830001
058400* NOTE - IT'S "PC" STANDARD TO DENOTE LIST-TO-LIST ENTRY BY A    *05840001
058500*        '5' IN DP020-INT-APPL-FORMAT-IND.                       *05850001
058600*----------------------------------------------------------------*05860001
058700     SET PS-COMMAREA-VALID         TO TRUE.                       05870001
058800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05880001
058900                                                                  05890001
059000     EVALUATE DP020-INT-APPL-FORMAT-IND                           05900001
059100                                                                  05910001
059200         WHEN PC-INTER-APPL-CRIT-SPEC                             05920001
059300                                                                  05930001
059400**           THIS PROGRAM ASSUMES THAT INTER-APPL FIELDS ARE      05940001
059500**           PROPERLY INITIALIZED...                              05950001
059600             IF  PC000-PO-NBR-N      = ZEROES                     05960001
059700                 MOVE PC-TSYMSG-00736  TO DP020-MSG-NUMBER        05970001
059800                 SET PS-ERROR                                     05980001
059900                     PS-COMMAREA-NOT-VALID                        05990001
060000                     DP020-MSG-FATAL   TO TRUE                    06000001
060100             END-IF                                               06010001
060200             IF  PC000-REC-SEQ-NBR-N = ZEROES                     06020001
060300                 MOVE PC-TSYMSG-00737  TO DP020-MSG-NUMBER        06030001
060400                 SET PS-ERROR                                     06040001
060500                     PS-COMMAREA-NOT-VALID                        06050001
060600                     DP020-MSG-FATAL   TO TRUE                    06060001
060700             END-IF                                               06070001
060800             IF  PC000-LINE-NBR-X    = SPACES                     06080001
060900                 MOVE PC-TSYMSG-00738  TO DP020-MSG-NUMBER        06090001
061000                 SET PS-ERROR                                     06100001
061100                     PS-COMMAREA-NOT-VALID                        06110001
061200                     DP020-MSG-FATAL   TO TRUE                    06120001
061300             END-IF                                               06130001
061400             IF  PS-NO-ERROR                                      06140001
061500                 MOVE PC000-OPERATING-UNIT-ID TO                  06150001
061600                      ASC-OPERATING-UNIT-ID                       06160001
061700                 MOVE PC000-FACILITY-ID       TO                  06170001
061800                      ASC-FACILITY-ID                             06180001
061900                 MOVE PC000-PO-NBR-N          TO                  06190001
062000                      ASC-PO-NBR                                  06200001
062100                 MOVE PC000-REC-SEQ-NBR-N     TO                  06210001
062200                      ASC-REC-SEQ-NBR                             06220001
062300                 MOVE PC000-LINE-NBR-N        TO                  06230001
062400                      ASC-LINE-NBR                                06240001
062500                 MOVE PC000-WO-NBR-N          TO                  06250001
062600                      ASC-WORK-ORD-SEQ-NBR-SAVE                   06260001
062700             END-IF                                               06270001
062800                                                                  06280001
062900         WHEN PC-INTER-APPL-LIST                                  06290001
063000              SET ASC-USE-SELECTION-QUEUE                         06300001
063100                                   TO TRUE                        06310001
063200              MOVE PC000-OPERATING-UNIT-ID                        06320001
063300                                   TO ASC-OPERATING-UNIT-ID       06330001
063400              MOVE PC000-FACILITY-ID                              06340001
063500                                   TO ASC-FACILITY-ID             06350001
063600              MOVE PC000-NUMBER-OF-SELECTED-ITEMS                 06360001
063700                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06370001
063800              MOVE PC000-NUMBER-OF-TS-ITEMS                       06380001
063900                                   TO ASC-NUMBER-OF-TS-ITEMS      06390001
064000              MOVE PC000-SEL-QUEUE-NAME                           06400001
064100                                   TO ASC-SEL-QUEUE-NAME-IN       06410001
064200              MOVE PC000-WO-NBR-N  TO ASC-WORK-ORD-SEQ-NBR-SAVE   06420001
064300              PERFORM 1120-PREPARE-LIST-ENTRY                     06430001
064400                                                                  06440001
064500     END-EVALUATE.                                                06450001
064600                                                                  06460001
064700*----------------------------------------------------------------*06470001
064800*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *06480001
064900*  QUEUE PASSED FROM THE LIST.                                   *06490001
065000*----------------------------------------------------------------*06500001
065100                                                                  06510001
065200 1120-PREPARE-LIST-ENTRY.                                         06520001
065300      MOVE PC016-MAX-ITEMS         TO ASC-SEL-SUB.                06530001
065400      MOVE ZERO                    TO ASC-SEL-ITEM.               06540001
065500      PERFORM 2300-GET-NEXT-RECORD.                               06550001
065600                                                                  06560001
065700/                                                                 06570001
065800*----------------------------------------------------------------*06580001
065900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06590001
066000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06600001
066100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06610001
066200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06620001
066300* FUNCTION KEYS CAN GET THIS FAR.                                *06630001
066400*----------------------------------------------------------------*06640001
066500                                                                  06650001
066600 2000-PROCESS-PANEL.                                              06660001
066700     EVALUATE TRUE                                                06670001
066800         WHEN DP020-SRC-AID = DP016-CLEAR                         06680001
066900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06690001
067000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06700001
067100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06710001
067200                                                                  06720001
067300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06730001
067400             PERFORM 2050-DELETE-LIST-QUEUE                       06740001
067500             PERFORM 4000-BUILD-INITIAL-PANEL                     06750001
067600                                                                  06760001
067700         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   06770001
067800             PERFORM 2140-DESELECT-ALL-ITEMS                      06780001
067900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06790001
068000                                                                  06800001
068100         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 06810001
068200              PERFORM 2150-SELECT-ALL-ITEMS                       06820001
068300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06830001
068400                                                                  06840001
068500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06850001
068600             IF ASC-USE-SELECTION-QUEUE                           06860001
068700                 PERFORM 6200-DEL-LIST-QUEUE                      06870001
068800                 PERFORM 2300-GET-NEXT-RECORD                     06880001
068900                 PERFORM 4000-BUILD-INITIAL-PANEL                 06890001
069000                 PERFORM 3200-RESET-ATTRIBUTES                    06900001
069100             ELSE                                                 06910001
069200*                --- BOTTOM OF LIST ---                           06920001
069300                 MOVE PC-TSYMSG-00070                             06930001
069400                                   TO DP020-MSG-NUMBER            06940001
069500                 SET DP020-MSG-INFORMATIONAL                      06950001
069600                                   TO TRUE                        06960001
069700             END-IF                                               06970001
069800                                                                  06980001
069900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06990001
070000             IF ASC-USE-SELECTION-QUEUE                           07000001
070100                 PERFORM 6200-DEL-LIST-QUEUE                      07010001
070200                 PERFORM 2310-GET-PREV-RECORD                     07020001
070300                 PERFORM 4000-BUILD-INITIAL-PANEL                 07030001
070400                 PERFORM 3200-RESET-ATTRIBUTES                    07040001
070500             ELSE                                                 07050001
070600*                --- TOP OF LIST ---                              07060001
070700                 MOVE PC-TSYMSG-00069                             07070001
070800                                   TO DP020-MSG-NUMBER            07080001
070900                 SET DP020-MSG-INFORMATIONAL                      07090001
071000                                   TO TRUE                        07100001
071100             END-IF                                               07110001
071200         WHEN OTHER                                               07120001
071300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07130001
071400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07140001
071500             IF  PS-NO-ERROR                                      07150001
071600                 SET DP030-CONTINUE-GO TO TRUE                    07160001
071700                 PERFORM 2100-CHECK-FUNCTION-KEY                  07170001
071800             ELSE                                                 07180001
071900                 SET DP030-OVERRIDE-GO TO TRUE                    07190001
072000             END-IF                                               07200001
072100     END-EVALUATE.                                                07210001
072200                                                                  07220001
072300/                                                                 07230001
072400*----------------------------------------------------------------*07240001
072500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07250001
072600*----------------------------------------------------------------*07260001
072700 2050-DELETE-LIST-QUEUE.                                          07270001
072800                                                                  07280001
072900     EXEC CICS                                                    07290001
073000         DELETEQ TS                                               07300001
073100           QUEUE (ASC-LIST-QUEUE-NAME)                            07310001
073200            RESP (PV-CICS-RESP)                                   07320001
073300     END-EXEC.                                                    07330001
073400                                                                  07340001
073500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07350001
073600        (PV-CICS-RESP = DFHRESP(QIDERR))                          07360001
073700         CONTINUE                                                 07370001
073800     ELSE                                                         07380001
073900         SET DP013-CICS-ABEND      TO TRUE                        07390001
074000         SET DP013-NO-ROLLBACK     TO TRUE                        07400001
074100                                                                  07410001
074200         MOVE '2050-DELETE-LIST-QUEUE'                            07420001
074300                                   TO DP013-PARAGRAPH             07430001
074400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07440001
074500                                   TO DP013-MESSAGE-TEXT (1)      07450001
074600         PERFORM DP013-0000-PROCESS-ABEND                         07460001
074700     END-IF.                                                      07470001
074800                                                                  07480001
074900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07490001
075000                                                                  07500001
075100/                                                                 07510001
075200*----------------------------------------------------------------*07520001
075300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07530001
075400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07540001
075500* CICS ARCHITECTURE API.                                         *07550001
075600*----------------------------------------------------------------*07560001
075700 2100-CHECK-FUNCTION-KEY.                                         07570001
075800                                                                  07580001
075900     EVALUATE TRUE                                                07590001
076000         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07600001
076100             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0                 07610001
076200                 SET DP030-OVERRIDE-GO                            07620001
076300                                   TO TRUE                        07630001
076400                 MOVE PC-TSYMSG-00057                             07640001
076500                                   TO DP020-MSG-NUMBER            07650001
076600                 SET DP020-MSG-WARNING                            07660001
076700                                   TO TRUE                        07670001
076800             ELSE                                                 07680001
076900                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO             07690001
077000                      PC000-NUMBER-OF-SELECTED-ITEMS              07700001
077100                 PERFORM 5000-PREPARE-SEL-QUEUE                   07710001
077200                 IF PS-ERROR                                      07720001
077300                     SET DP030-OVERRIDE-GO TO TRUE                07730001
077400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07740001
077500                 ELSE                                             07750001
077600                     PERFORM 7000-FORMAT-COMMAREA                 07760001
077700                 END-IF                                           07770001
077800             END-IF                                               07780001
077900                                                                  07790001
078000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07800001
078100             MOVE +1               TO PV-TOP-ITEM                 07810001
078200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07820001
078300             PERFORM 3200-RESET-ATTRIBUTES                        07830001
078400                                                                  07840001
078500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07850001
078600             PERFORM 2110-BROWSE-BACKWARD                         07860001
078700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07870001
078800             PERFORM 3200-RESET-ATTRIBUTES                        07880001
078900                                                                  07890001
079000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07900001
079100             PERFORM 2120-BROWSE-FORWARD                          07910001
079200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07920001
079300             PERFORM 3200-RESET-ATTRIBUTES                        07930001
079400                                                                  07940001
079500         WHEN DP020-SRC-AID = DP016-ENTER                         07950001
079600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07960001
079700             IF  PS-ERROR                                         07970001
079800                 CONTINUE                                         07980001
079900             ELSE                                                 07990001
080000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08000001
080100             END-IF                                               08010001
080200                                                                  08020001
080300         WHEN OTHER                                               08030001
080400             SET DP013-NO-ROLLBACK                                08040001
080500                 DP013-XCTL-DISPLAY-RESTART                       08050001
080600                 DP013-CICS-ABEND  TO TRUE                        08060001
080700             MOVE '2100-CHECK-FUNCTION-KEY'                       08070001
080800                                   TO DP013-PARAGRAPH             08080001
080900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08090001
081000                                   TO DP013-MESSAGE-TEXT (1)      08100001
081100             PERFORM DP013-0000-PROCESS-ABEND                     08110001
081200     END-EVALUATE.                                                08120001
081300                                                                  08130001
081400*----------------------------------------------------------------*08140001
081500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08150001
081600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08160001
081700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08170001
081800*    MESSAGE.                                                    *08180001
081900*----------------------------------------------------------------*08190001
082000                                                                  08200001
082100 2110-BROWSE-BACKWARD.                                            08210001
082200                                                                  08220001
082300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08230001
082400         GIVING PV-TOP-ITEM.                                      08240001
082500                                                                  08250001
082600     IF  ((PV-TOP-ITEM < +1)                                      08260001
082700       OR (PV-TOP-ITEM = +1))                                     08270001
082800         MOVE +1                   TO PV-TOP-ITEM                 08280001
082900*        -- TOP OF LIST --                                        08290001
083000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08300001
083100         SET DP020-MSG-INFORMATIONAL                              08310001
083200                                   TO TRUE                        08320001
083300     END-IF.                                                      08330001
083400                                                                  08340001
083500/                                                                 08350001
083600*----------------------------------------------------------------*08360001
083700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08370001
083800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08380001
083900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08390001
084000*----------------------------------------------------------------*08400001
084100                                                                  08410001
084200 2120-BROWSE-FORWARD.                                             08420001
084300                                                                  08430001
084400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08440001
084500         GIVING PV-TOP-ITEM.                                      08450001
084600                                                                  08460001
084700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08470001
084800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08480001
084900                                   TO PV-TOP-ITEM                 08490001
085000*        -- BOTTOM OF LIST --                                     08500001
085100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08510001
085200         SET DP020-MSG-INFORMATIONAL                              08520001
085300                                   TO TRUE                        08530001
085400     ELSE                                                         08540001
085500         COMPUTE PV-BOTTOM-ITEM =                                 08550001
085600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08560001
085700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08570001
085800*            -- BOTTOM OF LIST --                                 08580001
085900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08590001
086000             SET DP020-MSG-INFORMATIONAL                          08600001
086100                                   TO TRUE                        08610001
086200         END-IF                                                   08620001
086300     END-IF.                                                      08630001
086400                                                                  08640001
086500/                                                                 08650001
086600*----------------------------------------------------------------*08660001
086700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08670001
086800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08680001
086900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08690001
087000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08700001
087100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08710001
087200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08720001
087300*----------------------------------------------------------------*08730001
087400                                                                  08740001
087500 2130-CHECK-FOR-JUMP-BROWSE.                                      08750001
087600                                                                  08760001
087700     SET PS-NO-ERROR               TO TRUE.                       08770001
087800     IF (ASC-START-ITEM-REQUEST = SPACE)                          08780001
087900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08790001
088000                                   TO PV-TOP-ITEM                 08800001
088100     ELSE                                                         08810001
088200         MOVE ASC-START-ITEM-REQUEST                              08820001
088300                                   TO DP010I-UNEDITED-FIELD       08830001
088400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08840001
088500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08850001
088600         SET DP010I-NEGATIVE-NOT-ALLOWED                          08860001
088700                                   TO TRUE                        08870001
088810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08881018
088820                         USING DP010I-NUMERIC-EDIT-AREA           08882018
088900                                                                  08890001
089000         IF  NOT DP010I-ERROR-DETECTED                            08900001
089100             MOVE DP010I-NUMERIC-FIELD                            08910001
089200                                   TO ASC-START-ITEM-REQUEST-N    08920001
089300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08930001
089400                 IF  ASC-START-ITEM-REQUEST-N >                   08940001
089500                                          ASC-NUMBER-OF-ITEMS-READ08950001
089600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08960001
089700                     COMPUTE PV-TOP-ITEM =                        08970001
089800                             ASC-NUMBER-OF-ITEMS-READ             08980001
089900                             - PC-ITEMS-PER-PANEL + 1             08990001
090000                     IF  PV-TOP-ITEM < +1                         09000001
090100                         MOVE +1   TO PV-TOP-ITEM                 09010001
090200                         MOVE PC-TSYMSG-00070                     09020001
090300                                   TO DP020-MSG-NUMBER            09030001
090400                         SET DP020-MSG-INFORMATIONAL              09040001
090500                                   TO TRUE                        09050001
090600                     END-IF                                       09060001
090700                 ELSE                                             09070001
090800                     MOVE ASC-START-ITEM-REQUEST-N                09080001
090900                                   TO PV-TOP-ITEM                 09090001
091000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09100001
091100                     COMPUTE PV-BOTTOM-ITEM =                     09110001
091200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09120001
091300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09130001
091400*                        -- BOTTOM OF LIST --                     09140001
091500                         MOVE PC-TSYMSG-00070                     09150001
091600                                   TO DP020-MSG-NUMBER            09160001
091700                         SET DP020-MSG-INFORMATIONAL              09170001
091800                                   TO TRUE                        09180001
091900                     END-IF                                       09190001
092000                 END-IF                                           09200001
092100             ELSE                                                 09210001
092200*                --- VALUE OUT OF RANGE ----                      09220001
092300                 MOVE PC-TSYMSG-00101                             09230001
092400                                   TO DP020-MSG-NUMBER            09240001
092500                 MOVE -1           TO ASTRTITL                    09250001
092600                 SET DP030-SET-CURSOR-APPL-1                      09260001
092700                                   TO TRUE                        09270001
092800                 MOVE DP015-REVERSE                               09280001
092900                                   TO ASTRTITH                    09290001
093000                 MOVE DP015-RED    TO ASTRTITC                    09300001
093100                 MOVE DP015-UNP-NUM-BRT-MDT                       09310001
093200                                   TO ASTRTITA                    09320001
093300                 SET DP020-MSG-FATAL                              09330001
093400                                   TO TRUE                        09340001
093500                 SET PS-ERROR      TO TRUE                        09350001
093600             END-IF                                               09360001
093700                                                                  09370001
093800         ELSE                                                     09380001
093900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09390001
094000             MOVE -1               TO ASTRTITL                    09400001
094100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09410001
094200             MOVE DP015-REVERSE    TO ASTRTITH                    09420001
094300             MOVE DP015-RED        TO ASTRTITC                    09430001
094400             MOVE DP015-UNP-NUM-BRT-MDT                           09440001
094500                                   TO ASTRTITA                    09450001
094600             SET DP020-MSG-FATAL   TO TRUE                        09460001
094700             SET PS-ERROR          TO TRUE                        09470001
094800         END-IF                                                   09480001
094900     END-IF.                                                      09490001
095000                                                                  09500001
095100/                                                                 09510001
095200*----------------------------------------------------------------*09520001
095300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09530001
095400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09540001
095500*----------------------------------------------------------------*09550001
095600 2140-DESELECT-ALL-ITEMS.                                         09560001
095700                                                                  09570001
095800     MOVE +1                       TO ASC-BLK-SUB.                09580001
095900                                                                  09590001
096000     PERFORM 2141-CLEAR-SELECTED-INDS                             09600001
096100         VARYING ASC-ITEM-SUB                                     09610001
096200         FROM 1 BY 1                                              09620001
096300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09630001
096400                                                                  09640001
096500     ADD +1                        TO ASC-BLK-SUB.                09650001
096600                                                                  09660001
096700     PERFORM 2141-CLEAR-SELECTED-INDS                             09670001
096800         VARYING ASC-ITEM-SUB                                     09680001
096900         FROM 1 BY 1                                              09690001
097000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09700001
097100                                                                  09710001
097200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09720001
097300                                   TO PV-LIST-ITEM-NUMBER.        09730001
097400                                                                  09740001
097500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09750001
097600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09760001
097700                                                                  09770001
097800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09780001
097900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09790001
098000         MOVE +1                   TO ASC-BLK-SUB                 09800001
098100                                                                  09810001
098200         PERFORM 5100-WRITE-TEMP-STORAGE                          09820001
098300                                                                  09830001
098400         MOVE +1                   TO PV-BLOCK-NUMBER             09840001
098500                                                                  09850001
098600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09860001
098700             PV-FIRST-BLOCK-IN-ARRAY - 1                          09870001
098800                                                                  09880001
098900         PERFORM                                                  09890001
099000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09900001
099100                                                                  09910001
099200             PERFORM 4410-READ-TEMP-STORAGE                       09920001
099300                                                                  09930001
099400             PERFORM 2141-CLEAR-SELECTED-INDS                     09940001
099500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09950001
099600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09960001
099700                                                                  09970001
099800             PERFORM 5100-WRITE-TEMP-STORAGE                      09980001
099900                                                                  09990001
100000             ADD +1                TO PV-BLOCK-NUMBER             10000001
100100                                                                  10010001
100200         END-PERFORM                                              10020001
100300                                                                  10030001
100400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10040001
100500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10050001
100600                                                                  10060001
100700         PERFORM                                                  10070001
100800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10080001
100900                   ASC-HIGHEST-BLOCK-WRITTEN                      10090001
101000                                                                  10100001
101100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10110001
101200                                   TO PV-BLOCK-NUMBER             10120001
101300                                                                  10130001
101400             PERFORM 4410-READ-TEMP-STORAGE                       10140001
101500                                                                  10150001
101600             PERFORM 2141-CLEAR-SELECTED-INDS                     10160001
101700                 VARYING ASC-ITEM-SUB                             10170001
101800                 FROM 1 BY 1                                      10180001
101900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10190001
102000                                                                  10200001
102100             PERFORM 5100-WRITE-TEMP-STORAGE                      10210001
102200                                                                  10220001
102300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10230001
102400                                                                  10240001
102500         END-PERFORM                                              10250001
102600                                                                  10260001
102700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10270001
102800                                   TO PV-BLOCK-NUMBER             10280001
102900                                                                  10290001
103000         PERFORM 4410-READ-TEMP-STORAGE                           10300001
103100     END-IF.                                                      10310001
103200                                                                  10320001
103300                                                                  10330001
103400     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10340001
103500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10350001
103600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10360001
103700                                                                  10370001
103800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10380001
103900                                                                  10390001
104000/                                                                 10400001
104100*----------------------------------------------------------------*10410001
104200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10420001
104300*----------------------------------------------------------------*10430001
104400                                                                  10440001
104500 2141-CLEAR-SELECTED-INDS.                                        10450001
104600                                                                  10460001
104700     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          10470001
104800             NOT EQUAL ZERO                                       10480001
104900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10490001
105000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10500001
105100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10510001
105200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10520001
105300                                   TO TRUE                        10530001
105400         END-IF                                                   10540001
105500     END-IF.                                                      10550001
105600                                                                  10560001
105700/                                                                 10570001
105800*----------------------------------------------------------------*10580001
105900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10590001
106000*  FOR ALL ITEMS.                                                *10600001
106100*----------------------------------------------------------------*10610001
106200                                                                  10620001
106300 2150-SELECT-ALL-ITEMS.                                           10630001
106400                                                                  10640001
106500     MOVE +1                       TO ASC-BLK-SUB.                10650001
106600                                                                  10660001
106700     PERFORM 2151-SET-SELECTED-INDS                               10670001
106800         VARYING ASC-ITEM-SUB                                     10680001
106900         FROM 1 BY 1                                              10690001
107000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10700001
107100                                                                  10710001
107200     ADD +1                        TO ASC-BLK-SUB.                10720001
107300                                                                  10730001
107400     PERFORM 2151-SET-SELECTED-INDS                               10740001
107500         VARYING ASC-ITEM-SUB                                     10750001
107600         FROM 1 BY 1                                              10760001
107700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10770001
107800                                                                  10780001
107900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10790001
108000                                   TO PV-LIST-ITEM-NUMBER.        10800001
108100                                                                  10810001
108200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10820001
108300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10830001
108400                                                                  10840001
108500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10850001
108600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10860001
108700         MOVE +1                   TO ASC-BLK-SUB                 10870001
108800                                                                  10880001
108900         PERFORM 5100-WRITE-TEMP-STORAGE                          10890001
109000                                                                  10900001
109100         MOVE +1                   TO PV-BLOCK-NUMBER             10910001
109200                                                                  10920001
109300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10930001
109400             PV-FIRST-BLOCK-IN-ARRAY - 1                          10940001
109500                                                                  10950001
109600         PERFORM                                                  10960001
109700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10970001
109800                                                                  10980001
109900             PERFORM 4410-READ-TEMP-STORAGE                       10990001
110000                                                                  11000001
110100             PERFORM 2151-SET-SELECTED-INDS                       11010001
110200                 VARYING ASC-ITEM-SUB                             11020001
110300                 FROM 1 BY 1                                      11030001
110400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11040001
110500                                                                  11050001
110600             PERFORM 5100-WRITE-TEMP-STORAGE                      11060001
110700                                                                  11070001
110800             ADD +1                TO PV-BLOCK-NUMBER             11080001
110900         END-PERFORM                                              11090001
111000                                                                  11100001
111100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11110001
111200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11120001
111300                                                                  11130001
111400         PERFORM                                                  11140001
111500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11150001
111600                   ASC-HIGHEST-BLOCK-WRITTEN                      11160001
111700                                                                  11170001
111800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11180001
111900                                   TO PV-BLOCK-NUMBER             11190001
112000                                                                  11200001
112100             PERFORM 4410-READ-TEMP-STORAGE                       11210001
112200                                                                  11220001
112300             PERFORM 2151-SET-SELECTED-INDS                       11230001
112400                 VARYING ASC-ITEM-SUB                             11240001
112500                 FROM 1 BY 1                                      11250001
112600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11260001
112700                                                                  11270001
112800             PERFORM 5100-WRITE-TEMP-STORAGE                      11280001
112900                                                                  11290001
113000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11300001
113100         END-PERFORM                                              11310001
113200                                                                  11320001
113300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11330001
113400                                   TO PV-BLOCK-NUMBER             11340001
113500                                                                  11350001
113600         PERFORM 4410-READ-TEMP-STORAGE                           11360001
113700     END-IF.                                                      11370001
113800                                                                  11380001
113900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11390001
114000          ASC-NUMBER-OF-SELECTED-ITEMS.                           11400001
114100                                                                  11410001
114200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11420001
114300                                                                  11430001
114400/                                                                 11440001
114500*----------------------------------------------------------------*11450001
114600*    MARK EACH ITEM AS BEING SELECTED.                           *11460001
114700*----------------------------------------------------------------*11470001
114800                                                                  11480001
114900 2151-SET-SELECTED-INDS.                                          11490001
115000                                                                  11500001
115100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11510001
115200             NOT EQUAL ZERO                                       11520001
115300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11530001
115400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11540001
115500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11550001
115600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11560001
115700                                   TO TRUE                        11570001
115800         END-IF                                                   11580001
115900     END-IF.                                                      11590001
116000                                                                  11600001
116100/                                                                 11610001
116200*----------------------------------------------------------------*11620001
116300*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *11630001
116400*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *11640001
116500*----------------------------------------------------------------*11650001
116600 2200-MOVE-SCREEN-TO-COMMAREA.                                    11660001
116700                                                                  11670001
116800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11680001
116900     MOVE +1                       TO PV-SUB.                     11690001
117000                                                                  11700001
117100     PERFORM 3100-SET-SUBSCRIPTS.                                 11710001
117200                                                                  11720001
117300     IF  ASTRTITL > ZERO                                          11730001
117400         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      11740001
117500     ELSE                                                         11750001
117600         IF  ASTRTITF = DP015-ERASE-EOF                           11760001
117700             INITIALIZE ASC-START-ITEM-REQUEST                    11770001
117800         END-IF                                                   11780001
117900     END-IF.                                                      11790001
118000                                                                  11800001
118100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11810001
118200         VARYING PV-SUB                                           11820001
118300         FROM 1 BY 1                                              11830001
118400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11840001
118500                                                                  11850001
118600/                                                                 11860001
118700*----------------------------------------------------------------*11870001
118800*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11880001
118900*----------------------------------------------------------------*11890001
119000 2210-MOVE-LINES-TO-COMMAREA.                                     11900001
119100                                                                  11910001
119200     IF  MR-SELECTL (PV-SUB) > ZERO                               11920001
119300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     11930001
119400                                   TO TRUE                        11940001
119500         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        11950001
119600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11960001
119700     ELSE                                                         11970001
119800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11980001
119900             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11990001
120000             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        12000001
120100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12010001
120200         END-IF                                                   12020001
120300     END-IF.                                                      12030001
120400                                                                  12040001
120500     ADD +1                        TO ASC-ITEM-SUB.               12050001
120600                                                                  12060001
120700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12070001
120800         ADD +1                    TO ASC-BLK-SUB                 12080001
120900         MOVE +1                   TO ASC-ITEM-SUB                12090001
121000     END-IF.                                                      12100001
121100                                                                  12110001
121200/                                                                 12120001
121300******************************************************************12130001
121400* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *12140001
121500* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *12150001
121600******************************************************************12160001
121700 2300-GET-NEXT-RECORD.                                            12170001
121800                                                                  12180001
121900     ADD +1                        TO ASC-SEL-SUB.                12190001
122000     IF ASC-SEL-SUB > PC016-MAX-ITEMS                             12200001
122100         ADD +1                    TO ASC-SEL-ITEM                12210001
122200         MOVE +1                   TO ASC-SEL-SUB                 12220001
122300     END-IF.                                                      12230001
122400     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 12240001
122500         PERFORM 9100-READ-SEL-QUEUE                              12250001
122600         IF PC016-ITEM (ASC-SEL-SUB) > ZERO                       12260001
122700             INITIALIZE ASC-LIST-KEYS                             12270001
122800             MOVE PC016-PO-NBR-N(ASC-SEL-SUB)      TO ASC-PO-NBR  12280001
122900             MOVE PC016-REC-SEQ-NBR-N(ASC-SEL-SUB) TO             12290001
123000                  ASC-REC-SEQ-NBR                                 12300001
123100             MOVE PC016-LINE-NBR-N(ASC-SEL-SUB)    TO             12310001
123200                  ASC-LINE-NBR                                    12320001
123300             SET PC016-INQ (ASC-SEL-SUB)           TO TRUE        12330001
123400             PERFORM 9200-REWRITE-LIST-QUEUE                      12340001
123500         ELSE                                                     12350001
123600             SUBTRACT +1 FROM ASC-SEL-SUB                         12360001
123700*            --- BOTTOM OF LIST ---                               12370001
123800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12380001
123900             SET DP020-MSG-INFORMATIONAL                          12390001
124000                                   TO TRUE                        12400001
124100         END-IF                                                   12410001
124200     ELSE                                                         12420001
124300         SUBTRACT +1 FROM ASC-SEL-ITEM                            12430001
124400         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 12440001
124500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12450001
124600         SET DP020-MSG-INFORMATIONAL                              12460001
124700                                   TO TRUE                        12470001
124800     END-IF.                                                      12480001
124900                                                                  12490001
125000/                                                                 12500001
125100******************************************************************12510001
125200* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *12520001
125300* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *12530001
125400******************************************************************12540001
125500 2310-GET-PREV-RECORD.                                            12550001
125600                                                                  12560001
125700     SUBTRACT +1 FROM ASC-SEL-SUB.                                12570001
125800     IF ASC-SEL-SUB < +1                                          12580001
125900         SUBTRACT +1 FROM ASC-SEL-ITEM                            12590001
126000         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 12600001
126100     END-IF.                                                      12610001
126200                                                                  12620001
126300     IF ASC-SEL-ITEM > ZERO                                       12630001
126400         PERFORM 9100-READ-SEL-QUEUE                              12640001
126500         INITIALIZE ASC-LIST-KEYS                                 12650001
126600         MOVE PC016-PO-NBR-N(ASC-SEL-SUB)      TO ASC-PO-NBR      12660001
126700         MOVE PC016-REC-SEQ-NBR-N(ASC-SEL-SUB) TO                 12670001
126800              ASC-REC-SEQ-NBR                                     12680001
126900         MOVE PC016-LINE-NBR-N(ASC-SEL-SUB)    TO                 12690001
127000              ASC-LINE-NBR                                        12700001
127100     ELSE                                                         12710001
127200         MOVE +1                   TO ASC-SEL-ITEM                12720001
127300                                      ASC-SEL-SUB                 12730001
127400*        --- TOP OF LIST ---                                      12740001
127500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            12750001
127600         SET DP020-MSG-INFORMATIONAL                              12760001
127700                                   TO TRUE                        12770001
127800     END-IF.                                                      12780001
127900                                                                  12790001
128000/                                                                 12800001
128100*----------------------------------------------------------------*12810001
128200*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12820001
128300*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12830001
128400*----------------------------------------------------------------*12840001
128500 3000-EDIT-DATA-IN-COMMAREA.                                      12850001
128600                                                                  12860001
128700     SET PS-NO-ERROR               TO TRUE.                       12870001
128800                                                                  12880001
128900     PERFORM 3200-RESET-ATTRIBUTES.                               12890001
129000                                                                  12900001
129100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12910001
129200**                                                                12920001
129300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12930001
129400* EDITTING IS DONE FROM THE BOTTOM UP.                            12940001
129500**                                                                12950001
129600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12960001
129700         ASC-ITEMS-DISPLAYED - 1.                                 12970001
129800                                                                  12980001
129900     PERFORM 3100-SET-SUBSCRIPTS.                                 12990001
130000     PERFORM 3300-EDIT-SELECTIONS                                 13000001
130100         VARYING PV-SUB                                           13010001
130200         FROM PV-SUB BY -1                                        13020001
130300         UNTIL PV-SUB < +1                                        13030001
130400                                                                  13040001
130500     IF  PS-NO-ERROR                                              13050001
130600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13060001
130700     END-IF.                                                      13070001
130800                                                                  13080001
130900     IF  ((PS-NO-ERROR)                                           13090001
131000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13100001
131100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13110001
131200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13120001
131300     END-IF.                                                      13130001
131400                                                                  13140001
131500/                                                                 13150001
131600*----------------------------------------------------------------*13160001
131700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13170001
131800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13180001
131900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13190001
132000*                                                                *13200001
132100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13210001
132200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13220001
132300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13230001
132400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13240001
132500*----------------------------------------------------------------*13250001
132600                                                                  13260001
132700 3100-SET-SUBSCRIPTS.                                             13270001
132800                                                                  13280001
132900     COMPUTE ASC-ITEM-SUB =                                       13290001
133000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13300001
133100                                                                  13310001
133200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13320001
133300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13330001
133400                                                                  13340001
133500         MOVE PC-MAX-BLOCKS-IN-ARRAY                              13350001
133600                                   TO ASC-BLK-SUB                 13360001
133700     ELSE                                                         13370001
133800         MOVE +1                   TO ASC-BLK-SUB                 13380001
133900     END-IF.                                                      13390001
134000                                                                  13400001
134100*----------------------------------------------------------------*13410001
134200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13420001
134300*----------------------------------------------------------------*13430001
134400                                                                  13440001
134500 3200-RESET-ATTRIBUTES.                                           13450001
134600                                                                  13460001
134700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13470001
134800     MOVE DP015-GREEN              TO ASTRTITC.                   13480001
134900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13490001
135000                                                                  13500001
135100     IF DP020-NEXT-ACT-RETURN                                     13510001
135200     OR DP020-NEXT-ACT-READ-MAP                                   13520001
135300        PERFORM                                                   13530001
135400            VARYING PV-SUB                                        13540001
135500            FROM 1 BY 1                                           13550001
135600            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    13560001
135700            MOVE DP015-UNP-ALP-NOR-OFF                            13570001
135800                                      TO MR-SELECTA (PV-SUB)      13580001
135900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13590001
136000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13600001
136100        END-PERFORM                                               13610001
136200     ELSE                                                         13620001
136300        PERFORM                                                   13630001
136400            VARYING PV-SUB                                        13640001
136500            FROM 1 BY 1                                           13650001
136600            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     13660001
136700            MOVE DP015-UNP-ALP-NOR-OFF                            13670001
136800                                      TO MR-SELECTA (PV-SUB)      13680001
136900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13690001
137000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13700001
137100        END-PERFORM                                               13710001
137200     END-IF.                                                      13720001
137300                                                                  13730001
137400/                                                                 13740001
137500*----------------------------------------------------------------*13750001
137600*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13760001
137700*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13770001
137800*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13780001
137900*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13790001
138000*----------------------------------------------------------------*13800001
138100 3300-EDIT-SELECTIONS.                                            13810001
138200                                                                  13820001
138300     EVALUATE TRUE                                                13830001
138400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13840001
138500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13850001
138600                 CONTINUE                                         13860001
138700                                                                  13870001
138800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13880001
138900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13890001
139000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS13900001
139100                 MOVE ASC-TEMP-SELECTED-SW                        13910001
139200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13920001
139300                                   TO ASC-SELECTED-SW             13930001
139400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13940001
139500             END-IF                                               13950001
139600                                                                  13960001
139700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13970001
139800                 = SPACE                                          13980001
139900             EVALUATE TRUE                                        13990001
140000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14000001
140100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14010001
140200                     MOVE SPACE    TO ASC-SELECTED-SW             14020001
140300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14030001
140400                                                                  14040001
140500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14050001
140600                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 14060001
140700                     MOVE SPACE    TO ASC-SELECTED-SW             14070001
140800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14080001
140900                                                                  14090001
141000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14100001
141100                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   14110001
141200                     MOVE SPACE    TO ASC-SELECTED-SW             14120001
141300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14130001
141400             END-EVALUATE                                         14140001
141500                                                                  14150001
141600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14160001
141700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14170001
141800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14180001
141900             END-IF                                               14190001
142000             PERFORM 3310-EDIT-RANGE                              14200001
142100                                                                  14210001
142200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14220001
142300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14230001
142400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14240001
142500             END-IF                                               14250001
142600             PERFORM 3310-EDIT-RANGE                              14260001
142700                                                                  14270001
142800         WHEN OTHER                                               14280001
142900             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            14290001
143000             SET DP020-MSG-FATAL   TO TRUE                        14300001
143100             MOVE -1               TO MR-SELECTL (PV-SUB)         14310001
143200             SET DP030-SET-CURSOR-APPL-1                          14320001
143300                                   TO TRUE                        14330001
143400             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         14340001
143500             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         14350001
143600             SET PS-ERROR          TO TRUE                        14360001
143700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14370001
143800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14380001
143900                 MOVE SPACE        TO ASC-SELECTED-SW             14390001
144000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14400001
144100             END-IF                                               14410001
144200     END-EVALUATE.                                                14420001
144300                                                                  14430001
144400     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             14440001
144500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14450001
144600                                                                  14460001
144700     IF  ASC-ITEM-SUB < 1                                         14470001
144800         SUBTRACT +1 FROM ASC-BLK-SUB                             14480001
144900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14490001
145000     END-IF.                                                      14500001
145100                                                                  14510001
145200*----------------------------------------------------------------*14520001
145300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *14530001
145400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *14540001
145500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *14550001
145600*  THE ENDING.                                                   *14560001
145700*----------------------------------------------------------------*14570001
145800 3310-EDIT-RANGE.                                                 14580001
145900                                                                  14590001
146000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14600001
146100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14610001
146200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14620001
146300                                   TO ASC-SELECTED-SW             14630001
146400                                        (ASC-BLK-SUB ASC-ITEM-SUB)14640001
146500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14650001
146600         ELSE                                                     14660001
146700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14670001
146800                 CONTINUE                                         14680001
146900             ELSE                                                 14690001
147000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14700001
147100                 MOVE PC-TSYMSG-00054                             14710001
147200                                   TO DP020-MSG-NUMBER            14720001
147300                 SET DP020-MSG-FATAL                              14730001
147400                                   TO TRUE                        14740001
147500                 MOVE -1           TO MR-SELECTL (PV-SUB)         14750001
147600                 SET DP030-SET-CURSOR-APPL-1                      14760001
147700                                   TO TRUE                        14770001
147800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14780001
147900                 MOVE DP015-UNDERLINE                             14790001
148000                                   TO MR-SELECTH (PV-SUB)         14800001
148100                 SET PS-ERROR      TO TRUE                        14810001
148200             END-IF                                               14820001
148300         END-IF                                                   14830001
148400     ELSE                                                         14840001
148500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14850001
148600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14860001
148700                                   TO ASC-SELECTED-SW             14870001
148800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14880001
148900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14890001
149000         ELSE                                                     14900001
149100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14910001
149200                 CONTINUE                                         14920001
149300             ELSE                                                 14930001
149400*                -- ONLY ONE END-OF-RANGE ALLOWED --              14940001
149500                 MOVE PC-TSYMSG-00055                             14950001
149600                                   TO DP020-MSG-NUMBER            14960001
149700                 SET DP020-MSG-FATAL                              14970001
149800                                   TO TRUE                        14980001
149900                 MOVE -1           TO MR-SELECTL (PV-SUB)         14990001
150000                 SET DP030-SET-CURSOR-APPL-1                      15000001
150100                                   TO TRUE                        15010001
150200                 SET PS-ERROR      TO TRUE                        15020001
150300             END-IF                                               15030001
150400         END-IF                                                   15040001
150500     END-IF.                                                      15050001
150600                                                                  15060001
150700*----------------------------------------------------------------*15070001
150800*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *15080001
150900*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *15090001
151000*----------------------------------------------------------------*15100001
151100 3400-CHECK-RANGE-SEQUENCE.                                       15110001
151200                                                                  15120001
151300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15130001
151400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15140001
151500       AND  ASC-START-OF-SELECTED-RANGE >                         15150001
151600                                         ASC-END-OF-SELECTED-RANGE15160001
151700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15170001
151800         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            15180001
151900         SET DP020-MSG-FATAL       TO TRUE                        15190001
152000         SET PS-ERROR              TO TRUE                        15200001
152100         PERFORM 3410-POSITION-AT-ERROR                           15210001
152200     END-IF.                                                      15220001
152300                                                                  15230001
152400*----------------------------------------------------------------*15240001
152500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *15250001
152600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *15260001
152700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *15270001
152800*----------------------------------------------------------------*15280001
152900 3410-POSITION-AT-ERROR.                                          15290001
153000                                                                  15300001
153100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15310001
153200                                                                  15320001
153300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15330001
153400                    - PV-TOP-ITEM + 1.                            15340001
153500                                                                  15350001
153600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15360001
153700         CONTINUE                                                 15370001
153800     ELSE                                                         15380001
153900         MOVE -1                   TO MR-SELECTL (PV-SUB)         15390001
154000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15400001
154100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15410001
154200     END-IF.                                                      15420001
154300                                                                  15430001
154400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15440001
154500                    - PV-TOP-ITEM + 1.                            15450001
154600                                                                  15460001
154700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15470001
154800         CONTINUE                                                 15480001
154900     ELSE                                                         15490001
155000         MOVE -1                   TO MR-SELECTL (PV-SUB)         15500001
155100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15510001
155200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15520001
155300     END-IF.                                                      15530001
155400                                                                  15540001
155500/                                                                 15550001
155600*----------------------------------------------------------------*15560001
155700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15570001
155800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15580001
155900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15590001
156000*----------------------------------------------------------------*15600001
156100                                                                  15610001
156200 3500-MARK-RANGE-AS-SELECTED.                                     15620001
156300                                                                  15630001
156400     MOVE +1                       TO ASC-BLK-SUB.                15640001
156500                                                                  15650001
156600     PERFORM 3510-MARK-SELECTED-INDS                              15660001
156700         VARYING ASC-ITEM-SUB                                     15670001
156800         FROM 1 BY 1                                              15680001
156900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15690001
157000                                                                  15700001
157100     ADD +1                        TO ASC-BLK-SUB.                15710001
157200                                                                  15720001
157300     PERFORM 3510-MARK-SELECTED-INDS                              15730001
157400         VARYING ASC-ITEM-SUB                                     15740001
157500         FROM 1 BY 1                                              15750001
157600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15760001
157700                                                                  15770001
157800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15780001
157900                                   TO PV-LIST-ITEM-NUMBER.        15790001
158000                                                                  15800001
158100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15810001
158200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15820001
158300               PC-ITEMS-PER-PANEL).                               15830001
158400                                                                  15840001
158500     MOVE ASC-START-OF-SELECTED-RANGE                             15850001
158600                                   TO PV-START-OF-SELECTED-RANGE. 15860001
158700                                                                  15870001
158800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15880001
158900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15890001
159000               PC-ITEMS-PER-PANEL).                               15900001
159100                                                                  15910001
159200     MOVE ASC-END-OF-SELECTED-RANGE                               15920001
159300                                   TO PV-END-OF-SELECTED-RANGE.   15930001
159400                                                                  15940001
159500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15950001
159600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15960001
159700               PC-ITEMS-PER-PANEL).                               15970001
159800                                                                  15980001
159900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15990001
160000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16000001
160100                                                                  16010001
160200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16020001
160300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16030001
160400         MOVE +1                   TO ASC-BLK-SUB                 16040001
160500         PERFORM 5100-WRITE-TEMP-STORAGE                          16050001
160600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16060001
160700             PV-FIRST-BLOCK-IN-ARRAY - 1                          16070001
160800                                                                  16080001
160900         PERFORM                                                  16090001
161000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16100001
161100                   PV-PREV-BLOCK-IN-ARRAY                         16110001
161200             MOVE PV-FIRST-BLOCK-IN-RANGE                         16120001
161300                                   TO PV-BLOCK-NUMBER             16130001
161400             PERFORM 4410-READ-TEMP-STORAGE                       16140001
161500             PERFORM 3510-MARK-SELECTED-INDS                      16150001
161600                 VARYING ASC-ITEM-SUB                             16160001
161700                 FROM 1 BY 1                                      16170001
161800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16180001
161900             PERFORM 5100-WRITE-TEMP-STORAGE                      16190001
162000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16200001
162100         END-PERFORM                                              16210001
162200                                                                  16220001
162300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16230001
162400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16240001
162500         PERFORM                                                  16250001
162600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16260001
162700                   PV-LAST-BLOCK-IN-RANGE                         16270001
162800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16280001
162900                                   TO PV-BLOCK-NUMBER             16290001
163000             PERFORM 4410-READ-TEMP-STORAGE                       16300001
163100             PERFORM 3510-MARK-SELECTED-INDS                      16310001
163200                 VARYING ASC-ITEM-SUB                             16320001
163300                 FROM 1 BY 1                                      16330001
163400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16340001
163500             PERFORM 5100-WRITE-TEMP-STORAGE                      16350001
163600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16360001
163700         END-PERFORM                                              16370001
163800                                                                  16380001
163900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16390001
164000                                   TO PV-BLOCK-NUMBER             16400001
164100         PERFORM 4410-READ-TEMP-STORAGE                           16410001
164200     END-IF.                                                      16420001
164300                                                                  16430001
164400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16440001
164500                                      ASC-END-OF-SELECTED-RANGE.  16450001
164600                                                                  16460001
164700/                                                                 16470001
164800*----------------------------------------------------------------*16480001
164900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16490001
165000*----------------------------------------------------------------*16500001
165100                                                                  16510001
165200 3510-MARK-SELECTED-INDS.                                         16520001
165300                                                                  16530001
165400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         16540001
165500         ASC-START-OF-SELECTED-RANGE)                             16550001
165600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         16560001
165700         ASC-START-OF-SELECTED-RANGE)                             16570001
165800                                                                  16580001
165900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     16590001
166000             ASC-END-OF-SELECTED-RANGE)                           16600001
166100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     16610001
166200             ASC-END-OF-SELECTED-RANGE)                           16620001
166300                                                                  16630001
166400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16640001
166500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16650001
166600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16660001
166700                                   TO TRUE                        16670001
166800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16680001
166900                                   TO TRUE                        16690001
167000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS16700001
167100             END-IF                                               16710001
167200         END-IF                                                   16720001
167300     END-IF.                                                      16730001
167400                                                                  16740001
167500/                                                                 16750001
167600*----------------------------------------------------------------*16760001
167700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16770001
167800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16780001
167900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16790001
168000*    DISPLAY THE PANEL TO USER.                                  *16800001
168100*----------------------------------------------------------------*16810001
168200                                                                  16820001
168300 4000-BUILD-INITIAL-PANEL.                                        16830001
168400                                                                  16840001
168500     INITIALIZE ASC-BLOCK-ENTRIES (1)                             16850001
168600                ASC-BLOCK-ENTRIES (2).                            16860001
168700                                                                  16870001
168800     MOVE +1                       TO ASC-BLK-SUB.                16880001
168900                                                                  16890001
169000     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       16900001
169100                                                                  16910001
169200     MOVE +0                       TO ASC-ITEM-SUB                16920001
169300                                      ASC-NUMBER-OF-ITEMS-READ    16930001
169400                                      ASC-NUMBER-OF-SELECTED-ITEMS16940001
169500                                      ASC-HIGHEST-BLOCK-WRITTEN   16950001
169600                                      ASC-START-OF-SELECTED-RANGE 16960001
169700                                      ASC-END-OF-SELECTED-RANGE   16970001
169800                                      ASC-ITEM-AT-TOP-OF-PANEL.   16980001
169900                                                                  16990001
170000     PERFORM 4100-PREPARE-CURSOR.                                 17000001
170100                                                                  17010001
170200     PERFORM 4010-OPEN-CURSOR.                                    17020001
170300                                                                  17030001
170400     PERFORM 4300-READ-ITEMS-FROM-DB.                             17040001
170500                                                                  17050001
170600     PERFORM 4020-CLOSE-CURSOR.                                   17060001
170700                                                                  17070001
170800     MOVE +1                       TO PV-TOP-ITEM.                17080001
170900                                                                  17090001
171000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17100001
171100         SET DP020-NEXT-ACT-APPL-ERROR                            17110001
171200                                   TO TRUE                        17120001
171300         SET DP020-MSG-FATAL       TO TRUE                        17130001
171400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            17140001
171500     ELSE                                                         17150001
171600         MOVE -1                   TO MR-SELECTL (1)              17160001
171700         SET DP030-SET-CURSOR-APPL-1                              17170001
171800                                   TO TRUE                        17180001
171900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17190001
172000     END-IF.                                                      17200001
172100                                                                  17210001
172200/                                                                 17220001
172300*----------------------------------------------------------------*17230001
172400* OPEN THE SHIPMENT CURSOR                                       *17240001
172500*----------------------------------------------------------------*17250001
172600                                                                  17260001
172700 4010-OPEN-CURSOR.                                                17270001
172800                                                                  17280001
172900**   PERFORM                                                      17290001
173000**       WITH TEST AFTER                                          17300001
173100**       VARYING PV-RETRY-COUNTER                                 17310001
173200**       FROM 1 BY 1                                              17320001
173300**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17330001
173400**          OR (SQLCODE = +0))                                    17340001
173500                                                                  17350001
173600         EXEC SQL                                                 17360001
173700             OPEN TWRKORD_CSR                                     17370001
173800         END-EXEC                                                 17380001
173900                                                                  17390001
174000         EVALUATE TRUE                                            17400001
174100             WHEN SQLCODE = +0                                    17410001
174200                  CONTINUE                                        17420001
174300             WHEN SQLCODE = -904                                  17430001
174400             WHEN SQLCODE = -911                                  17440001
174500             WHEN SQLCODE = -913                                  17450001
174600                  PERFORM 9900-SOFT-ABORT                         17460001
174700             WHEN SQLWARN0 NOT = SPACE                            17470001
174800             WHEN SQLCODE  NOT = +0                               17480001
174900                  MOVE '4010-OPEN-CURSOR'                         17490001
175000                                   TO DP013-PARAGRAPH             17500001
175100                  MOVE 'OPEN CURSOR'                              17510001
175200                                   TO DP013-MESSAGE-TEXT (1)      17520001
175300                  MOVE SQLCA       TO DP013-SQLCA                 17530001
175400                  MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)    17540001
175500                  SET DP013-DB2-ABEND                             17550001
175600                                   TO TRUE                        17560001
175700                  PERFORM DP013-0000-PROCESS-ABEND                17570001
175800         END-EVALUATE.                                            17580001
175900**   END-PERFORM.                                                 17590001
176000                                                                  17600001
176100**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17610001
176200**       MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17620001
176300**       MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              17630001
176400**                                 TO DP013-MESSAGE-TEXT (1)      17640001
176500**       MOVE SQLCA                TO DP013-SQLCA                 17650001
176600**       SET DP013-DB2-ABEND       TO TRUE                        17660001
176700**       PERFORM DP013-0000-PROCESS-ABEND                         17670001
176800**   END-IF.                                                      17680001
176900                                                                  17690001
177000/                                                                 17700001
177100*----------------------------------------------------------------*17710001
177200* CLOSE THE SHIPMENT CURSOR                                      *17720001
177300*----------------------------------------------------------------*17730001
177400                                                                  17740001
177500 4020-CLOSE-CURSOR.                                               17750001
177600                                                                  17760001
177700     EXEC SQL                                                     17770001
177800         CLOSE TWRKORD_CSR                                        17780001
177900     END-EXEC.                                                    17790001
178000                                                                  17800001
178100     EVALUATE TRUE                                                17810001
178200         WHEN SQLCODE = +0                                        17820001
178300              CONTINUE                                            17830001
178400         WHEN SQLCODE = -904                                      17840001
178500         WHEN SQLCODE = -911                                      17850001
178600         WHEN SQLCODE = -913                                      17860001
178700              PERFORM 9900-SOFT-ABORT                             17870001
178800         WHEN SQLWARN0 NOT = SPACE                                17880001
178900         WHEN SQLCODE  NOT = +0                                   17890001
179000              MOVE '4020-CLOSE-CURSOR'                            17900001
179100                                   TO DP013-PARAGRAPH             17910001
179200              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      17920001
179300              MOVE SQLCA           TO DP013-SQLCA                 17930001
179400              MOVE 'TWRKORD'       TO DP013-DB2-TABLE-NAME (1)    17940001
179500              SET DP013-DB2-ABEND  TO TRUE                        17950001
179600              PERFORM DP013-0000-PROCESS-ABEND                    17960001
179700     END-EVALUATE.                                                17970001
179800                                                                  17980001
179900/                                                                 17990001
180000*----------------------------------------------------------------*18000001
180100*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *18010001
180200*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *18020001
180300*----------------------------------------------------------------*18030001
180400                                                                  18040001
180500 4100-PREPARE-CURSOR.                                             18050001
180600                                                                  18060001
180700     MOVE ASC-OPERATING-UNIT-ID                                   18070001
180800                           TO DK-OPERATING-UNIT-ID                18080001
180900     MOVE ASC-FACILITY-ID  TO DK-FACILITY-ID                      18090001
181000     MOVE ASC-PO-NBR       TO DK-ORD-NBR                          18100001
181100     MOVE ASC-REC-SEQ-NBR  TO DK-RCVR-SEQ-NBR                     18110001
181200     MOVE ASC-LINE-NBR     TO DK-LINE-NBR.                        18120001
181300                                                                  18130001
181400     MOVE +0               TO DK-WORK-ORD-SEQ-NBR-LOW             18140001
181500     MOVE +9999            TO DK-WORK-ORD-SEQ-NBR-HIGH            18150001
181600     MOVE LOW-VALUES       TO DK-STAT-CDE-LOW                     18160001
181700     MOVE HIGH-VALUES      TO DK-STAT-CDE-HIGH.                   18170001
181800                                                                  18180001
181900     IF DP020-NEXT-ACT-RETURN                                     18190001
182000        MOVE ASC-WORK-ORD-SEQ-NBR-SAVE                            18200001
182100                           TO PC000-WO-NBR-N                      18210001
182200     END-IF.                                                      18220001
182300                                                                  18230001
182400     IF PC000-WO-NBR-N > ZEROES                                   18240001
182500        MOVE PC000-WO-NBR-N TO DK-WORK-ORD-SEQ-NBR-LOW            18250001
182600                               DK-WORK-ORD-SEQ-NBR-HIGH           18260001
182700     END-IF.                                                      18270001
182800                                                                  18280001
182900     IF DP020-NEXT-ACT-RETURN                                     18290001
183000        CONTINUE                                                  18300001
183100     ELSE                                                         18310001
183200         IF PC000-RECVR-STATUS-CDE > SPACES                       18320001
183300            MOVE PC000-RECVR-STATUS-CDE TO DK-STAT-CDE-LOW        18330001
183400                                           DK-STAT-CDE-HIGH       18340001
183500     END-IF.                                                      18350001
183600/                                                                 18360001
183700*----------------------------------------------------------------*18370001
183800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18380001
183900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18390001
184000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18400001
184100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18410001
184200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18420001
184300*                                                                *18430001
184400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18440001
184500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18450001
184600*    UPON INITIALIZATION.                                        *18460001
184700*----------------------------------------------------------------*18470001
184800                                                                  18480001
184900 4300-READ-ITEMS-FROM-DB.                                         18490001
185000                                                                  18500001
185100     PERFORM                                                      18510001
185200         VARYING PV-READ-COUNT                                    18520001
185300         FROM 1 BY 1                                              18530001
185400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18540001
185500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18550001
185600                                                                  18560001
185700         PERFORM 4310-FETCH                                       18570001
185800                                                                  18580001
185900         IF  ASC-ITEMS-LEFT-ON-DB                                 18590001
186000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18600001
186100                 ADD +1            TO ASC-ITEM-SUB                18610001
186200             ELSE                                                 18620001
186300                 ADD +1            TO ASC-BLK-SUB                 18630001
186400                 MOVE +1           TO ASC-ITEM-SUB                18640001
186500                                                                  18650001
186600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18660001
186700                     MOVE +1       TO ASC-BLK-SUB                 18670001
186800                     SET ASC-BLOCK-MODIFIED (1)                   18680001
186900                                   TO TRUE                        18690001
187000                     PERFORM 5100-WRITE-TEMP-STORAGE              18700001
187100                     MOVE ASC-BLOCK-ENTRIES                       18710001
187200                               (PC-MAX-BLOCKS-IN-ARRAY)           18720001
187300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18730001
187400                     ADD +1        TO ASC-BLK-SUB                 18740001
187500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18750001
187600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18760001
187700                                   TO TRUE                        18770001
187800                 END-IF                                           18780001
187900             END-IF                                               18790001
188000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18800001
188100             MOVE ASC-NUMBER-OF-ITEMS-READ                        18810001
188200                                   TO ASC-LIST-ITEM-NUMBER        18820001
188300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18830001
188400             MOVE WRKORD-WORK-ORD-SEQ-NBR  TO                     18840001
188500                  ASC-WORK-ORD-SEQ-NBR(ASC-BLK-SUB ASC-ITEM-SUB)  18850001
188600             MOVE WRKORD-STAT-CDE          TO                     18860001
188700                  ASC-STAT-CDE        (ASC-BLK-SUB ASC-ITEM-SUB)  18870001
188800             MOVE WRKORD-EXPTED-CART-CNT   TO                     18880001
188900                  ASC-EXPTED-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)  18890001
189000             MOVE WRKORD-ACTL-CART-CNT     TO                     18900001
189100                  ASC-ACTL-CART-CNT   (ASC-BLK-SUB ASC-ITEM-SUB)  18910001
189200             MOVE WRKORD-EXPTED-ITM-CNT   TO                      18920001
189300                  ASC-EXPTED-ITM-CNT (ASC-BLK-SUB ASC-ITEM-SUB)   18930001
189400             MOVE WRKORD-ACTL-ITM-CNT      TO                     18940001
189500                  ASC-ACTL-ITM-CNT    (ASC-BLK-SUB ASC-ITEM-SUB)  18950001
189600             MOVE +0 TO PV-DB2-COUNT                              18960001
189700             PERFORM 4320-COUNT-INSTRUCTIONS                      18970001
189800             MOVE PV-DB2-COUNT TO                                 18980001
189900                  ASC-TWKORIN-CNT     (ASC-BLK-SUB ASC-ITEM-SUB)  18990001
190000         END-IF                                                   19000001
190100     END-PERFORM.                                                 19010001
190200                                                                  19020001
190300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19030001
190400*-->     ** NO LIST ITEMS TO DISPLAY                              19040001
190500         CONTINUE                                                 19050001
190600     ELSE                                                         19060001
190700         PERFORM 4330-GET-SKU-INFO                                19070001
190800         PERFORM 4331-CALL-CICS-API-ARCH                          19080003
190810                                                                  19081003
190900         MOVE PURCHS-DEPT-NBR       TO ASC-TPURCHS-DEPT-NBR       19090001
191000         MOVE PURITM-CL-NBR         TO ASC-TPURITM-CL-NBR         19100001
191010                                                                  19101003
191100*        MOVE PURITM-SKU-SEQ-NBR    TO ASC-NIS-SKU-SEQ-NBR        19110003
191200         MOVE PURITM-SKU-DESC       TO ASC-TPURITM-SKU-DESC       19120001
191300         MOVE PURITM-VEND-STYL-NAME TO ASC-TPURITM-VEND-STYL-NAME 19130001
191400                                                                  19140001
191500         PERFORM 4340-GET-TRECITM-INFO                            19150001
191600                                                                  19160001
191700         MOVE RECITM-PKSL-ITM-QTY   TO ASC-TRECITM-PKSL-ITM-QTY   19170001
191800         MOVE RECITM-DTL-CK-ITM-QTY TO ASC-TRECITM-DTL-CK-ITM-QTY 19180001
191900         MOVE RECITM-EXPTED-CART-CNT                              19190001
192000                                    TO ASC-TRECITM-EXPTED-CART-CNT19200001
192100         MOVE RECITM-ACTL-CART-CNT  TO ASC-TRECITM-ACTL-CART-CNT  19210001
192200     END-IF                                                       19220001
192300                                                                  19230001
192400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19240001
192500         MOVE +1                   TO ASC-BLK-SUB                 19250001
192600         PERFORM 5100-WRITE-TEMP-STORAGE                          19260001
192700         ADD +1                    TO ASC-BLK-SUB                 19270001
192800         PERFORM 5100-WRITE-TEMP-STORAGE                          19280001
192900                                                                  19290001
193000         MOVE 1                    TO ASC-BLK-SUB                 19300001
193100                                      PV-BLOCK-NUMBER             19310001
193200         PERFORM 4410-READ-TEMP-STORAGE                           19320001
193300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19330001
193400             MOVE 2                TO ASC-BLK-SUB                 19340001
193500                                      PV-BLOCK-NUMBER             19350001
193600             PERFORM 4410-READ-TEMP-STORAGE                       19360001
193700         END-IF                                                   19370001
193800     END-IF.                                                      19380001
193900                                                                  19390001
194000/                                                                 19400001
194100*----------------------------------------------------------------*19410001
194200*    FETCH A TWRKORD ROW                                         *19420001
194300*----------------------------------------------------------------*19430001
194400                                                                  19440001
194500 4310-FETCH.                                                      19450001
194600                                                                  19460001
194700     EXEC SQL                                                     19470001
194800         FETCH TWRKORD_CSR                                        19480001
194900            INTO :WRKORD-WORK-ORD-SEQ-NBR                         19490001
195000                ,:WRKORD-STAT-CDE                                 19500001
195100                ,:WRKORD-EXPTED-CART-CNT                          19510001
195200                ,:WRKORD-ACTL-CART-CNT                            19520001
195300                ,:WRKORD-EXPTED-ITM-CNT                           19530001
195400                ,:WRKORD-ACTL-ITM-CNT                             19540001
195500     END-EXEC.                                                    19550001
195600                                                                  19560001
195700     EVALUATE TRUE                                                19570001
195800         WHEN SQLCODE = +0                                        19580001
195900              CONTINUE                                            19590001
196000         WHEN SQLCODE = -904                                      19600001
196100         WHEN SQLCODE = -911                                      19610001
196200         WHEN SQLCODE = -913                                      19620001
196300              PERFORM 9900-SOFT-ABORT                             19630001
196400         WHEN SQLCODE = +100                                      19640001
196500              SET ASC-NO-ITEMS-LEFT-ON-DB                         19650001
196600                                   TO TRUE                        19660001
196700                                                                  19670001
196800         WHEN SQLWARN0 NOT = SPACE                                19680001
196900         WHEN SQLCODE < +0                                        19690001
197000         WHEN SQLCODE > +0                                        19700001
197100              MOVE '4310-FETCH-CURSOR'                            19710001
197200                                   TO DP013-PARAGRAPH             19720001
197300              MOVE 'FETCH TWRKORD CURSOR'                         19730001
197400                                   TO DP013-MESSAGE-TEXT (1)      19740001
197500              MOVE SQLCA           TO DP013-SQLCA                 19750001
197600              MOVE 'TWRKORD'       TO DP013-DB2-TABLE-NAME (1)    19760001
197700              SET DP013-DB2-ABEND  TO TRUE                        19770001
197800              PERFORM DP013-0000-PROCESS-ABEND                    19780001
197900     END-EVALUATE.                                                19790001
198000                                                                  19800001
198100/                                                                 19810001
198200*----------------------------------------------------------------*19820001
198300*    COUNT THE NUMBER OF INSTRUCTIONS FOR THIS WORK ORDER/SEQ    *19830001
198400*----------------------------------------------------------------*19840001
198500 4320-COUNT-INSTRUCTIONS.                                         19850001
198600                                                                  19860001
198700**   PERFORM                                                      19870001
198800**       WITH TEST AFTER                                          19880001
198900**       VARYING PV-RETRY-COUNTER                                 19890001
199000**       FROM 1 BY 1                                              19900001
199100**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19910001
199200**           OR (SQLCODE = +0)                                    19920001
199300**           OR (SQLCODE = +100))                                 19930001
199400                                                                  19940001
199500         EXEC SQL                                                 19950001
199600              SELECT COUNT(*)                                     19960001
199700                INTO :PV-DB2-COUNT                                19970001
199800                FROM TWKORIN                                      19980001
199900               WHERE ORD_NBR          = :DK-ORD-NBR               19990001
200000                 AND RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR          20000001
200100                 AND ORD_LNE_NBR      = :DK-LINE-NBR              20010001
200200                 AND WORK_ORD_SEQ_NBR = :WRKORD-WORK-ORD-SEQ-NBR  20020001
200300                 AND OPER_UNT_ID      = :DK-OPERATING-UNIT-ID     20030001
200400                 AND FCLTY_ID         = :DK-FACILITY-ID           20040001
200500                 AND VER_STATUS_CDE   = 'A'                       20050001
200600         END-EXEC                                                 20060001
200700                                                                  20070001
200800         EVALUATE TRUE                                            20080001
200900             WHEN SQLCODE = +0                                    20090001
201000             WHEN SQLCODE = +100                                  20100001
201100                  CONTINUE                                        20110001
201200             WHEN SQLCODE = -904                                  20120001
201300             WHEN SQLCODE = -911                                  20130001
201400             WHEN SQLCODE = -913                                  20140001
201500                  PERFORM 9900-SOFT-ABORT                         20150001
201600                                                                  20160001
201700             WHEN SQLWARN0 NOT = SPACES                           20170001
201800             WHEN SQLCODE < +0                                    20180001
201900             WHEN SQLCODE > +0                                    20190001
202000                  MOVE '4320-COUNT-INSTRUCTIONS'                  20200001
202100                                  TO DP013-PARAGRAPH              20210001
202200                  MOVE 'UNSUCCESSFUL SELECT ON TWKORIN TABLE'     20220001
202300                                  TO DP013-MESSAGE-TEXT (1)       20230001
202400                  MOVE SQLCA      TO DP013-SQLCA                  20240001
202500                  MOVE 'TWKORIN ' TO DP013-DB2-TABLE-NAME (1)     20250001
202600                  SET DP013-DB2-ABEND                             20260001
202700                      DP013-XCTL-DISPLAY-RESTART                  20270001
202800                                  TO TRUE                         20280001
202900                  PERFORM DP013-0000-PROCESS-ABEND                20290001
203000         END-EVALUATE.                                            20300001
203100**   END-PERFORM.                                                 20310001
203200                                                                  20320001
203300**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20330001
203400**       MOVE '4320-COUNT-INSTRUCTIONS' TO DP013-PARAGRAPH        20340001
203500**       MOVE 'MAX RETRIES EXCEEDED ON SELECT TWKORIN TABLE'      20350001
203600**                                TO DP013-MESSAGE-TEXT (1)       20360001
203700**       MOVE SQLCA               TO DP013-SQLCA                  20370001
203800**       MOVE 'TWKORIN'           TO DP013-DB2-TABLE-NAME (1)     20380001
203900**       SET DP013-DB2-ABEND                                      20390001
204000**           DP013-XCTL-DISPLAY-RESTART                           20400001
204100**                                TO TRUE                         20410001
204200**       PERFORM DP013-0000-PROCESS-ABEND                         20420001
204300**   END-IF.                                                      20430001
204400                                                                  20440001
204500/                                                                 20450001
204600*----------------------------------------------------------------*20460001
204700*    GET SKU, SKU DESC, AND VENDOR STYLE FROM TPURCHS/TPURITM    *20470001
204800*----------------------------------------------------------------*20480001
204900 4330-GET-SKU-INFO.                                               20490001
205000                                                                  20500001
205100     INITIALIZE DCLTPURCHS                                        20510001
205200                DCLTPURITM.                                       20520001
205300                                                                  20530001
205400**   PERFORM                                                      20540001
205500**       WITH TEST AFTER                                          20550001
205600**       VARYING PV-RETRY-COUNTER                                 20560001
205700**       FROM 1 BY 1                                              20570001
205800**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20580001
205900**           OR (SQLCODE = +0)                                    20590001
206000**           OR (SQLCODE = +100))                                 20600001
206100                                                                  20610001
206200         EXEC SQL                                                 20620001
206300              SELECT A.DEPT_NBR                                   20630001
206400                    ,B.CL_NBR                                     20640001
206500                    ,B.ITM_NBR                                    20650008
206600                    ,B.SKU_DESC                                   20660001
206700                    ,B.VEND_STYL_NAME                             20670001
206800                INTO :PURCHS-DEPT-NBR                             20680001
206900                    ,:PURITM-CL-NBR                               20690001
207000                    ,:PURITM-ITM-NBR                              20700002
207100                    ,:PURITM-SKU-DESC                             20710001
207200                    ,:PURITM-VEND-STYL-NAME                       20720001
207300                FROM TPURCHS A                                    20730001
207400                    ,TPURITM B                                    20740001
207500               WHERE A.PO_NBR          = :DK-ORD-NBR              20750001
207600                 AND A.VER_STATUS_CDE  = 'A'                      20760001
207700                 AND A.PO_NBR          =  B.PO_NBR                20770001
207800                 AND B.STATUS_CDE     IN ('AC', 'AP', 'RV')       20780001
207900                 AND B.VER_STATUS_CDE  = 'A'                      20790001
208000                 AND B.APP_PO_LNE_NBR  = :DK-LINE-NBR             20800001
208100         END-EXEC                                                 20810001
208200                                                                  20820001
208300         EVALUATE TRUE                                            20830001
208400             WHEN SQLCODE = +0                                    20840001
208410                                                                  20841002
208500             WHEN SQLCODE = +100                                  20850001
208600                  CONTINUE                                        20860001
208700             WHEN SQLCODE = -904                                  20870001
208800             WHEN SQLCODE = -911                                  20880001
208900             WHEN SQLCODE = -913                                  20890001
209000                  PERFORM 9900-SOFT-ABORT                         20900001
209100                                                                  20910001
209200             WHEN SQLWARN0 NOT = SPACES                           20920001
209300             WHEN SQLCODE < +0                                    20930001
209400             WHEN SQLCODE > +0                                    20940001
209500                  MOVE '4330-GET-SKU-INFO'                        20950001
209600                                  TO DP013-PARAGRAPH              20960001
209700                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS/TPURITM'   20970001
209800                                  TO DP013-MESSAGE-TEXT (1)       20980001
209900                  MOVE SQLCA      TO DP013-SQLCA                  20990001
210000                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     21000001
210100                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (2)     21010001
210200                  SET DP013-DB2-ABEND                             21020001
210300                      DP013-XCTL-DISPLAY-RESTART                  21030001
210400                                  TO TRUE                         21040001
210500                  PERFORM DP013-0000-PROCESS-ABEND                21050001
210600         END-EVALUATE.                                            21060001
210610                                                                  21061002
210620                                                                  21062002
210700**   END-PERFORM.                                                 21070001
210800                                                                  21080001
210900**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21090001
211000**       MOVE '4330-GET-SKU-INFO' TO DP013-PARAGRAPH              21100001
211100**       MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURCHS/TPURITM'    21110001
211200**                                TO DP013-MESSAGE-TEXT (1)       21120001
211300**       MOVE SQLCA               TO DP013-SQLCA                  21130001
211400**       MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     21140001
211500**       MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (2)     21150001
211600**       SET DP013-DB2-ABEND                                      21160001
211700**           DP013-XCTL-DISPLAY-RESTART                           21170001
211800**                                TO TRUE                         21180001
211900**       PERFORM DP013-0000-PROCESS-ABEND                         21190001
212000**   END-IF.                                                      21200001
212100                                                                  21210001
212200/                                                                 21220001
212210*----------------------------------------------------------------*21221003
212220*  CALLS ITEM ACCESS MODULE XLKUT001                              21222011
212230*----------------------------------------------------------------*21223003
212240 4331-CALL-CICS-API-ARCH.                                         21224006
212250                                                                  21225003
212251                                                                  21225103
212254        INITIALIZE XL001-ITEM-COMMAREA                            21225403
212255                                                                  21225503
212256        MOVE PURITM-ITM-NBR   TO XL001-KEY-ITM-NBR.               21225603
212257                                                                  21225703
212258        SET  XL001-BY-ITEM                                        21225803
212259             XL001-SELECT-SKU TO TRUE.                            21225903
212260                                                                  21226003
212261        CALL XL001-VSM-PGM USING  DFHEIBLK                        21226103
212262                                  XL001-COMMAREA                  21226203
212263                                  XL001-ITEM-COMMAREA.            21226303
212264                                                                  21226403
212265        EVALUATE TRUE                                             21226503
212266                                                                  21226603
212267            WHEN XL001-SUCCESSFUL                                 21226703
212268                 MOVE XL001-SKU-NBR   TO ASC-NIS-SKU-SEQ-NBR      21226803
212269                                                                  21226915
212270            WHEN XL001-SQL-ERROR                                  21227017
212271                 IF XL001-SKU-SQLCODE = +100                      21227117
212272                    MOVE '00000000'      TO ASC-NIS-SKU-SEQ-NBR   21227215
212273                 ELSE                                             21227315
212274                    MOVE XL001-SKU-NBR TO PV-DISPLAY-SKU-NBR      21227415
212275                    MOVE '4331-CALL-CICS-API-ARCH'                21227515
212276                                    TO DP013-PARAGRAPH            21227615
212277                    MOVE 'UNSUCCESSFUL SELECT ON XLV SKU'         21227715
212278                                    TO DP013-MESSAGE-TEXT (1)     21227816
212279                    STRING 'XL VIEW ERROR PARA- '                 21227915
212280                                    DELIMITED BY SIZE             21228015
212281                    XL001-ERROR-PARAGRAPH-NBR DELIMITED BY SIZE   21228115
212282                                    INTO DP013-MESSAGE-TEXT (2)   21228215
212283                    STRING 'SKU NUMBER : ' DELIMITED BY SIZE      21228315
212284                        PV-DISPLAY-SKU-NBR DELIMITED BY SIZE      21228415
212285                                    INTO DP013-MESSAGE-TEXT (3)   21228515
212286                    MOVE XL001-SKU-SQLCODE TO DP013-SQLCA         21228615
212287                    MOVE 'XLV_SKU'  TO DP013-DB2-TABLE-NAME (1)   21228715
212288                    SET DP013-DB2-ABEND                           21228815
212289                        DP013-XCTL-DISPLAY-RESTART                21228915
212290                                    TO TRUE                       21229015
212291                    PERFORM DP013-0000-PROCESS-ABEND              21229115
212292                 END-IF                                           21229215
212293                                                                  21229315
212294            WHEN XL001-INVALID-ACCESS                             21229403
212295                 MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'        21229503
212296                                    TO DP013-PARAGRAPH            21229603
212297                 MOVE 'UNSUCCESSFUL SELECT ON XLV_SKU'            21229703
212298                                    TO DP013-MESSAGE-TEXT (1)     21229803
212299                 MOVE SQLCA         TO DP013-SQLCA                21229903
212300                 MOVE 'XLV_SKU'     TO DP013-DB2-TABLE-NAME (1)   21230003
212301                 SET DP013-DB2-ABEND                              21230103
212302                     DP013-XCTL-DISPLAY-RESTART                   21230203
212303                                    TO TRUE                       21230303
212304                                                                  21230403
212305                 PERFORM DP013-0000-PROCESS-ABEND                 21230503
212306            WHEN OTHER                                            21230603
212307                 MOVE '4331-CALL-CICS-API-ARCH'                   21230713
212308                                    TO DP013-PARAGRAPH            21230803
212309                 MOVE 'UNSUCCESSFUL SELECT ON XLV_SKU'            21230903
212310                                    TO DP013-MESSAGE-TEXT (1)     21231003
212311                 MOVE SQLCA         TO DP013-SQLCA                21231103
212312                 MOVE 'XLV_SKU'     TO DP013-DB2-TABLE-NAME (1)   21231203
212313                 SET DP013-DB2-ABEND                              21231303
212314                     DP013-XCTL-DISPLAY-RESTART                   21231403
212315                                    TO TRUE                       21231503
212316                                                                  21231603
212317                 PERFORM DP013-0000-PROCESS-ABEND                 21231703
212318            END-EVALUATE.                                         21231803
212319                                                                  21231903
212320******************************************************************21232003
212330*----------------------------------------------------------------*21233001
212400*    GET RECEIPT ITEM INFO FOR THE TOP OF THE SCREEN             *21240001
212500*----------------------------------------------------------------*21250001
212600 4340-GET-TRECITM-INFO.                                           21260001
212700                                                                  21270001
212800     INITIALIZE DCLTRECITM.                                       21280001
212900                                                                  21290001
213000**   PERFORM                                                      21300001
213100**       WITH TEST AFTER                                          21310001
213200**       VARYING PV-RETRY-COUNTER                                 21320001
213300**       FROM 1 BY 1                                              21330001
213400**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21340001
213500**           OR (SQLCODE = +0)                                    21350001
213600**           OR (SQLCODE = +100))                                 21360001
213700                                                                  21370001
213800         EXEC SQL                                                 21380001
213900              SELECT  PKSL_ITM_QTY                                21390001
214000                     ,DTL_CK_ITM_QTY                              21400001
214100                     ,EXPTED_CART_CNT                             21410001
214200                     ,ACTL_CART_CNT                               21420001
214300                INTO :RECITM-PKSL-ITM-QTY                         21430001
214400                    ,:RECITM-DTL-CK-ITM-QTY                       21440001
214500                    ,:RECITM-EXPTED-CART-CNT                      21450001
214600                    ,:RECITM-ACTL-CART-CNT                        21460001
214700                FROM TRECITM                                      21470001
214800               WHERE  ORD_NBR        = :DK-ORD-NBR                21480001
214900                 AND  ORD_LNE_NBR    = :DK-LINE-NBR               21490001
215000                 AND  REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR           21500001
215100                 AND  OPER_UNT_ID    = :DK-OPERATING-UNIT-ID      21510001
215200                 AND  FCLTY_ID       = :DK-FACILITY-ID            21520001
215300                 AND  VER_STATUS_CDE = 'A'                        21530001
215400         END-EXEC                                                 21540001
215500                                                                  21550001
215600         EVALUATE TRUE                                            21560001
215700             WHEN SQLCODE = +0                                    21570001
215800             WHEN SQLCODE = +100                                  21580001
215900                  CONTINUE                                        21590001
216000             WHEN SQLCODE = -904                                  21600001
216100             WHEN SQLCODE = -911                                  21610001
216200             WHEN SQLCODE = -913                                  21620001
216300                  PERFORM 9900-SOFT-ABORT                         21630001
216400                                                                  21640001
216500             WHEN SQLWARN0 NOT = SPACES                           21650001
216600             WHEN SQLCODE < +0                                    21660001
216700             WHEN SQLCODE > +0                                    21670001
216800                  MOVE '4340-GET-TRECITM-INFO'                    21680001
216900                                  TO DP013-PARAGRAPH              21690001
217000                  MOVE 'UNSUCCESSFUL SELECT ON TRECITM'           21700001
217100                                  TO DP013-MESSAGE-TEXT (1)       21710001
217200                  MOVE SQLCA      TO DP013-SQLCA                  21720001
217300                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)     21730001
217400                  SET DP013-DB2-ABEND                             21740001
217500                      DP013-XCTL-DISPLAY-RESTART                  21750001
217600                                  TO TRUE                         21760001
217700                  PERFORM DP013-0000-PROCESS-ABEND                21770001
217800         END-EVALUATE.                                            21780001
217900**   END-PERFORM.                                                 21790001
218000                                                                  21800001
218100**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21810001
218200**       MOVE '4340-GET-TRECITM-INFO' TO DP013-PARAGRAPH          21820001
218300**       MOVE 'MAX RETRIES EXCEEDED ON SELECT TRECITM'            21830001
218400**                                TO DP013-MESSAGE-TEXT (1)       21840001
218500**       MOVE SQLCA               TO DP013-SQLCA                  21850001
218600**       MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)     21860001
218700**       SET DP013-DB2-ABEND                                      21870001
218800**           DP013-XCTL-DISPLAY-RESTART                           21880001
218900**                                TO TRUE                         21890001
219000**       PERFORM DP013-0000-PROCESS-ABEND                         21900001
219100**   END-IF.                                                      21910001
219200                                                                  21920001
219300/                                                                 21930001
219400*----------------------------------------------------------------*21940001
219500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21950001
219600*----------------------------------------------------------------*21960001
219700                                                                  21970001
219800 4400-MOVE-COMMAREA-TO-SCREEN.                                    21980001
219900                                                                  21990001
220000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22000001
220100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22010001
220200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22020001
220300             MOVE +1               TO ASC-BLK-SUB                 22030001
220400             PERFORM 5100-WRITE-TEMP-STORAGE                      22040001
220500             ADD +1                TO ASC-BLK-SUB                 22050001
220600             PERFORM 5100-WRITE-TEMP-STORAGE                      22060001
220700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22070001
220800                 GIVING PV-BLOCK-NUMBER                           22080001
220900                 REMAINDER PV-REMAINDER                           22090001
221000             IF  PV-REMAINDER > ZERO                              22100001
221100                 ADD +1            TO PV-BLOCK-NUMBER             22110001
221200             END-IF                                               22120001
221300             MOVE +1               TO ASC-BLK-SUB                 22130001
221400             PERFORM 4410-READ-TEMP-STORAGE                       22140001
221500             ADD +1                TO ASC-BLK-SUB                 22150001
221600                                      PV-BLOCK-NUMBER             22160001
221700             PERFORM 4410-READ-TEMP-STORAGE                       22170001
221800     END-IF.                                                      22180001
221900                                                                  22190001
222000     MOVE +1                       TO ASC-BLK-SUB.                22200001
222100                                                                  22210001
222200     COMPUTE ASC-ITEM-SUB =                                       22220001
222300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22230001
222400         + PC-ITEMS-PER-PANEL).                                   22240001
222500                                                                  22250001
222600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22260001
222700         ADD +1                    TO ASC-BLK-SUB                 22270001
222800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22280001
222900     END-IF.                                                      22290001
223000                                                                  22300001
223100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22310001
223200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22320001
223300                                                                  22330001
223400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22340001
223500     PERFORM 4420-FORMAT-LIST-LINES                               22350001
223600         VARYING PV-SUB                                           22360001
223700         FROM PC-ITEMS-PER-PANEL BY -1                            22370001
223800         UNTIL PV-SUB < +1.                                       22380001
223900                                                                  22390001
224000     COMPUTE ASC-ITEMS-DISPLAYED =                                22400001
224100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22410001
224200                                                                  22420001
224300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22430001
224400                                      ASTRTITO.                   22440001
224500                                                                  22450001
224600     MOVE ASC-OPERATING-UNIT-ID        TO AOPERIDO                22460001
224700     MOVE ASC-FACILITY-ID              TO AFACLIDO                22470001
224800     MOVE ASC-PO-NBR                   TO PONBRO                  22480001
224900     MOVE ASC-REC-SEQ-NBR              TO RCVRSEQO                22490001
225000     MOVE ASC-LINE-NBR                 TO LINENBRO                22500001
225100                                                                  22510001
225200     MOVE ASC-TRECITM-PKSL-ITM-QTY     TO PACKCNTO                22520001
225300     MOVE ASC-TRECITM-DTL-CK-ITM-QTY   TO DTCKQTYO                22530001
225400     MOVE ASC-TRECITM-EXPTED-CART-CNT  TO EXCRTCTO                22540001
225500     MOVE ASC-TRECITM-ACTL-CART-CNT    TO ACCRTCTO                22550001
225600*********                                                         22560005
225700     MOVE ASC-NIS-SKU-SEQ-NBR          TO SKUO                    22570003
226900     MOVE ASC-TPURCHS-DEPT-NBR         TO ADEPTO                  22690005
226910     MOVE ASC-TPURITM-CL-NBR           TO ACLSO                   22691005
226920*********                                                         22692005
227000     MOVE ASC-TPURITM-SKU-DESC         TO SKUDESCO                22700001
227100     MOVE ASC-TPURITM-VEND-STYL-NAME   TO VDRSTYLO                22710001
227200                                                                  22720001
227300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22730001
227400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22740001
227500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22750001
227600                                   TO ASELITO.                    22760001
227700                                                                  22770001
227800     IF  DP020-MSG-NUMBER-X = SPACE                               22780001
227900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22790001
228000*            --- MORE ITEMS TO DISPLAY ----                       22800001
228100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22810001
228200             SET DP020-MSG-INFORMATIONAL                          22820001
228300                                   TO TRUE                        22830001
228400         END-IF                                                   22840001
228500     END-IF.                                                      22850001
228600                                                                  22860001
228700*----------------------------------------------------------------*22870001
228800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22880001
228900*----------------------------------------------------------------*22890001
229000                                                                  22900001
229100 4410-READ-TEMP-STORAGE.                                          22910001
229200                                                                  22920001
229300     EXEC CICS                                                    22930001
229400         READQ TS                                                 22940001
229500             QUEUE (ASC-LIST-QUEUE-NAME)                          22950001
229600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22960001
229700             ITEM  (PV-BLOCK-NUMBER)                              22970001
229800             RESP  (PV-CICS-RESP)                                 22980001
229900     END-EXEC.                                                    22990001
230000                                                                  23000001
230100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23010001
230200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23020001
230300         CONTINUE                                                 23030001
230400     ELSE                                                         23040001
230500         SET DP013-CICS-ABEND      TO TRUE                        23050001
230600         SET DP013-NO-ROLLBACK     TO TRUE                        23060001
230700         MOVE '4410-READ-TEMP-STORAGE'                            23070001
230800                                   TO DP013-PARAGRAPH             23080001
230900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23090001
231000                                   TO DP013-MESSAGE-TEXT(1)       23100001
231100         PERFORM DP013-0000-PROCESS-ABEND                         23110001
231200     END-IF.                                                      23120001
231300                                                                  23130001
231400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      23140001
231500                                   TO TRUE.                       23150001
231600                                                                  23160001
231700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23170001
231800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23180001
231900     END-IF.                                                      23190001
232000                                                                  23200001
232100/                                                                 23210001
232200*----------------------------------------------------------------*23220001
232300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23230001
232400*----------------------------------------------------------------*23240001
232500                                                                  23250001
232600 4420-FORMAT-LIST-LINES.                                          23260001
232700                                                                  23270001
232800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23280001
232900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23290001
233000         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         23300001
233100         MOVE SPACES               TO MR-SELECT  (PV-SUB)         23310001
233200         MOVE ZEROS                TO MR-WORK-ORD-SEQ-NBR (PV-SUB)23320001
233300                                      MR-EXPTED-CART-CNT  (PV-SUB)23330001
233400                                      MR-ACTL-CART-CNT    (PV-SUB)23340001
233500                                      MR-ACTL-ITM-CNT     (PV-SUB)23350001
233600                                      MR-EXPTED-ITM-CNT  (PV-SUB) 23360001
233700                                      MR-WO-INSTRUCTIONS  (PV-SUB)23370001
233800         MOVE SPACES               TO MR-WORK-ORD-STAT-CDE(PV-SUB)23380001
233900     ELSE                                                         23390001
234000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23400001
234100                                                   > SPACE        23410001
234200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23420001
234300                                   TO MR-SELECT (PV-SUB)          23430001
234400         ELSE                                                     23440001
234500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23450001
234600                                   TO MR-SELECT (PV-SUB)          23460001
234700         END-IF                                                   23470001
234800                                                                  23480001
234900         IF  DP030-SET-CURSOR-TRAILER                             23490001
235000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23500001
235100                 > SPACE)                                         23510001
235200               OR (PV-SUB = 1))                                   23520001
235300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23530001
235400                MOVE -1            TO MR-SELECTL (PV-SUB)         23540001
235500             END-IF                                               23550001
235600         END-IF                                                   23560001
235700                                                                  23570001
235800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23580001
235900             MOVE ASC-WORK-ORD-SEQ-NBR(ASC-BLK-SUB ASC-ITEM-SUB)  23590001
236000               TO                     MR-WORK-ORD-SEQ-NBR (PV-SUB)23600001
236100             MOVE ASC-STAT-CDE        (ASC-BLK-SUB ASC-ITEM-SUB)  23610001
236200               TO                     MR-WORK-ORD-STAT-CDE(PV-SUB)23620001
236300             MOVE ASC-EXPTED-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)  23630001
236400               TO                     MR-EXPTED-CART-CNT  (PV-SUB)23640001
236500             MOVE ASC-ACTL-CART-CNT   (ASC-BLK-SUB ASC-ITEM-SUB)  23650001
236600               TO                     MR-ACTL-CART-CNT    (PV-SUB)23660001
236700             MOVE ASC-EXPTED-ITM-CNT  (ASC-BLK-SUB ASC-ITEM-SUB)  23670001
236800               TO                     MR-EXPTED-ITM-CNT   (PV-SUB)23680001
236900             MOVE ASC-ACTL-ITM-CNT    (ASC-BLK-SUB ASC-ITEM-SUB)  23690001
237000               TO                     MR-ACTL-ITM-CNT     (PV-SUB)23700001
237100             MOVE ASC-TWKORIN-CNT     (ASC-BLK-SUB ASC-ITEM-SUB)  23710001
237200               TO                     MR-WO-INSTRUCTIONS  (PV-SUB)23720001
237300         END-IF                                                   23730001
237400     END-IF.                                                      23740001
237500                                                                  23750001
237600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23760001
237700                                                                  23770001
237800     IF  ASC-ITEM-SUB < + 1                                       23780001
237900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                23790001
238000         MOVE +1                   TO ASC-BLK-SUB                 23800001
238100     END-IF.                                                      23810001
238200                                                                  23820001
238300*----------------------------------------------------------------*23830001
238400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *23840001
238500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *23850001
238600*  ISSUE A WARNING.                                              *23860001
238700*----------------------------------------------------------------*23870001
238800 4430-CHECK-FOR-BEGIN-AND-END.                                    23880001
238900                                                                  23890001
239000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23900001
239100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23910001
239200*            -- NO END-OF-RANGE SPECFIED ---                      23920001
239300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23930001
239400             SET DP020-MSG-WARNING TO TRUE                        23940001
239500             PERFORM 4431-POSITION-AT-WARNING                     23950001
239600         END-IF                                                   23960001
239700     ELSE                                                         23970001
239800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23980001
239900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23990001
240000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24000001
240100             SET DP020-MSG-WARNING TO TRUE                        24010001
240200             PERFORM 4431-POSITION-AT-WARNING                     24020001
240300         END-IF                                                   24030001
240400     END-IF.                                                      24040001
240500                                                                  24050001
240600*----------------------------------------------------------------*24060001
240700*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *24070001
240800*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *24080001
240900*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *24090001
241000*  POSITION THE CURSOR THERE.                                    *24100001
241100*----------------------------------------------------------------*24110001
241200 4431-POSITION-AT-WARNING.                                        24120001
241300                                                                  24130001
241400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24140001
241500                    - PV-TOP-ITEM + 1.                            24150001
241600                                                                  24160001
241700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24170001
241800         CONTINUE                                                 24180001
241900     ELSE                                                         24190001
242000         SET DP030-SET-CURSOR-APPL-1                              24200001
242100                                   TO TRUE                        24210001
242200         MOVE -1                   TO MR-SELECTL (PV-SUB)         24220001
242300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24230001
242400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24240001
242500     END-IF.                                                      24250001
242600                                                                  24260001
242700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24270001
242800                    - PV-TOP-ITEM + 1.                            24280001
242900                                                                  24290001
243000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24300001
243100         CONTINUE                                                 24310001
243200     ELSE                                                         24320001
243300         SET DP030-SET-CURSOR-APPL-1                              24330001
243400                                   TO TRUE                        24340001
243500         MOVE -1                   TO MR-SELECTL (PV-SUB)         24350001
243600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24360001
243700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24370001
243800     END-IF.                                                      24380001
243900                                                                  24390001
244000/                                                                 24400001
244100*----------------------------------------------------------------*24410001
244200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24420001
244300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24430001
244400* FOR THE SELECTED ITEMS QUEUE.                                  *24440001
244500*                                                                *24450001
244600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24460001
244700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24470001
244800* THE ARRAY IS FULL.                                             *24480001
244900*----------------------------------------------------------------*24490001
245000                                                                  24500001
245100 5000-PREPARE-SEL-QUEUE.                                          24510001
245200                                                                  24520001
245300     MOVE +1                       TO ASC-BLK-SUB.                24530001
245400     PERFORM 5100-WRITE-TEMP-STORAGE.                             24540001
245500     ADD +1                        TO ASC-BLK-SUB.                24550001
245600     PERFORM 5100-WRITE-TEMP-STORAGE.                             24560001
245700                                                                  24570001
245800     MOVE ASC-SEL-QUEUE-NAME-OUT   TO PC000-SEL-QUEUE-NAME.       24580001
245900     PERFORM 6010-DELETE-SEL-QUEUE.                               24590001
246000                                                                  24600001
246100     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      24610001
246200         SET ASC-UPDATE-TSQ        TO TRUE                        24620001
246300     END-IF.                                                      24630001
246400                                                                  24640001
246500     SET PC016-IDX                 TO 1.                          24650001
246600     MOVE ZERO                     TO PC000-NUMBER-OF-TS-ITEMS.   24660001
246700     INITIALIZE PC016-SELECTED-ITEM-ARRAY.                        24670001
246800                                                                  24680001
246900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24690001
247000             VARYING PV-ITEM                                      24700001
247100             FROM 1 BY 1                                          24710001
247200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN OR   24720001
247300                   PS-ERROR.                                      24730001
247400                                                                  24740001
247500     IF PS-ERROR                                                  24750001
247600         CONTINUE                                                 24760001
247700     ELSE                                                         24770001
247800         IF PC016-IDX > 1                                         24780001
247900             PERFORM 5205-WRITE-SEL-QUEUE                         24790001
248000             ADD +1                    TO PC000-NUMBER-OF-TS-ITEMS24800001
248100         END-IF                                                   24810001
248200     END-IF.                                                      24820001
248300                                                                  24830001
248400/                                                                 24840001
248500*----------------------------------------------------------------*24850001
248600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24860001
248700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24870001
248800*----------------------------------------------------------------*24880001
248900                                                                  24890001
249000 5100-WRITE-TEMP-STORAGE.                                         24900001
249100                                                                  24910001
249200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24920001
249300                                   TO PV-LIST-ITEM-NUMBER.        24930001
249400     COMPUTE PV-BLOCK-NUMBER =                                    24940001
249500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24950001
249600                                                                  24960001
249700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24970001
249800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24980001
249900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24990001
250000             PERFORM 5105-REWRITE-ASC-LISTQ                       25000001
250100         END-IF                                                   25010001
250200     ELSE                                                         25020001
250300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25030001
250400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25040001
250500         PERFORM 5110-WRITE-ASC-LISTQ                             25050001
250600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25060001
250700     END-IF.                                                      25070001
250800                                                                  25080001
250900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      25090001
251000                                   TO TRUE.                       25100001
251100                                                                  25110001
251200/                                                                 25120001
251300*----------------------------------------------------------------*25130001
251400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *25140001
251500*  SPECIFIC COMMAREA.                                            *25150001
251600*----------------------------------------------------------------*25160001
251700 5105-REWRITE-ASC-LISTQ.                                          25170001
251800                                                                  25180001
251900     EXEC CICS                                                    25190001
252000         WRITEQ TS                                                25200001
252100             QUEUE (ASC-LIST-QUEUE-NAME)                          25210001
252200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25220001
252300             ITEM  (PV-BLOCK-NUMBER)                              25230001
252400             REWRITE                                              25240001
252500             RESP  (PV-CICS-RESP)                                 25250001
252600     END-EXEC.                                                    25260001
252700                                                                  25270001
252800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25280001
252900         CONTINUE                                                 25290001
253000     ELSE                                                         25300001
253100         SET DP013-CICS-ABEND      TO TRUE                        25310001
253200         SET DP013-NO-ROLLBACK     TO TRUE                        25320001
253300         MOVE '5105-REWRITE-ASC-LISTQ'                            25330001
253400                                   TO DP013-PARAGRAPH             25340001
253500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25350001
253600                                   TO DP013-MESSAGE-TEXT(1)       25360001
253700         PERFORM DP013-0000-PROCESS-ABEND                         25370001
253800     END-IF.                                                      25380001
253900                                                                  25390001
254000/                                                                 25400001
254100*----------------------------------------------------------------*25410001
254200*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *25420001
254300*  SPECIFIC COMMAREA.                                            *25430001
254400*----------------------------------------------------------------*25440001
254500 5110-WRITE-ASC-LISTQ.                                            25450001
254600                                                                  25460001
254700     EXEC CICS                                                    25470001
254800         WRITEQ TS                                                25480001
254900             QUEUE (ASC-LIST-QUEUE-NAME)                          25490001
255000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25500001
255100             ITEM  (PV-BLOCK-NUMBER)                              25510001
255200             RESP  (PV-CICS-RESP)                                 25520001
255300     END-EXEC.                                                    25530001
255400                                                                  25540001
255500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25550001
255600         SET DP013-CICS-ABEND      TO TRUE                        25560001
255700         SET DP013-NO-ROLLBACK     TO TRUE                        25570001
255800         MOVE '5110-WRITE-ASC-LISTQ'                              25580001
255900                                   TO DP013-PARAGRAPH             25590001
256000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25600001
256100                                   TO DP013-MESSAGE-TEXT(1)       25610001
256200         PERFORM DP013-0000-PROCESS-ABEND                         25620001
256300     END-IF.                                                      25630001
256400                                                                  25640001
256500/                                                                 25650001
256600*----------------------------------------------------------------*25660001
256700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25670001
256800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25680001
256900*----------------------------------------------------------------*25690001
257000                                                                  25700001
257100 5200-FILL-SEL-QUEUE-RECORD.                                      25710001
257200                                                                  25720001
257300     PERFORM 6112-READ-LIST-QUEUE.                                25730001
257400                                                                  25740001
257500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25750001
257600         PERFORM                                                  25760001
257700         VARYING LQW-IDX                                          25770001
257800         FROM 1 BY 1                                              25780001
257900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25790001
258000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25800001
258100                                                                  25810001
258200             IF  LQW-SELECT (LQW-IDX)                             25820001
258300                 IF DP020-SRC-AID = DP016-PF22 OR                 25830001
258400                    DP020-SRC-AID = DP016-PF23                    25840001
258500                      IF LQW-STAT-CDE (LQW-IDX) = 'CM'            25850001
258600                          SET PS-ERROR TO TRUE                    25860001
258700                          MOVE                                    25870001
258800                          'CANNOT CONTINUE - WORK ORDER COMPLETE' 25880001
258900                               TO DP020-MSG-MESSAGE               25890001
259000                      ELSE                                        25900001
259100                          IF DP020-SRC-AID = DP016-PF22           25910001
259200                              PERFORM 5201-CHECK-MATH             25920001
259300                          END-IF                                  25930001
259400                      END-IF                                      25940001
259500                 END-IF                                           25950001
259600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25960001
259700                                    TO PC016-ITEM (PC016-IDX)     25970001
259800                 MOVE SPACE         TO PC016-ACTION-SW (PC016-IDX)25980001
259900                 MOVE ASC-PO-NBR    TO PC016-PO-NBR-N  (PC016-IDX)25990001
260000                 MOVE ASC-REC-SEQ-NBR                             26000001
260100                                    TO PC016-REC-SEQ-NBR-N        26010001
260200                                                       (PC016-IDX)26020001
260300                 MOVE ASC-LINE-NBR  TO PC016-LINE-NBR-N(PC016-IDX)26030001
260400                 MOVE LQW-WORK-ORD-SEQ-NBR (LQW-IDX)              26040001
260500                                    TO PC016-WO-NBR-N  (PC016-IDX)26050001
260600                                       PV-WO-NBR                  26060001
260700                 MOVE LQW-STAT-CDE (LQW-IDX)                      26070001
260800                                    TO PC016-RECVR-STATUS-CDE     26080001
260900                                                       (PC016-IDX)26090001
261000                                       PV-RECVR-STATUS-CDE        26100001
261100                 MOVE PC-N          TO PC016-MRKG-APRON-REQ-IND   26110001
261200                                                       (PC016-IDX)26120001
261300                 SET PC016-IDX UP BY 1                            26130001
261400                 IF  PC016-IDX > PC016-MAX-ITEMS                  26140001
261500                     PERFORM 5205-WRITE-SEL-QUEUE                 26150001
261600                     ADD +1        TO PC000-NUMBER-OF-TS-ITEMS    26160001
261700                     INITIALIZE PC016-SELECTED-ITEM-ARRAY         26170001
261800                     SET PC016-IDX TO 1                           26180001
261900                 END-IF                                           26190001
262000             END-IF                                               26200001
262100         END-PERFORM                                              26210001
262200     END-IF.                                                      26220001
262300                                                                  26230001
262400/                                                                 26240001
262500 5201-CHECK-MATH.                                                 26250001
262600                                                                  26260001
262700     IF  LQW-ACTL-CART-CNT (LQW-IDX) GREATER THAN ZERO            26270001
262800         DIVIDE LQW-ACTL-ITM-CNT  (LQW-IDX) BY                    26280001
262900                LQW-ACTL-CART-CNT (LQW-IDX)                       26290001
263000                GIVING    PV-ITMS-PER-CTN-WHOLE                   26300001
263100                REMAINDER PV-ITMS-PER-CTN-REM                     26310001
263200                                                                  26320001
263300         IF PV-ITMS-PER-CTN-REM = 0                               26330001
263400             CONTINUE                                             26340001
263500         ELSE                                                     26350001
263600             SET PS-ERROR TO TRUE                                 26360001
263700             MOVE 'ITEMS PER CARTON DOES NOT DIVIDE EVENLY'       26370001
263800                   TO DP020-MSG-MESSAGE                           26380001
263900         END-IF                                                   26390001
264000     ELSE                                                         26400001
264100         SET PS-ERROR     TO TRUE                                 26410001
264200         MOVE 'NNNNN-E-CAN"T DIVIDE BY ZERO; FIX ACTUAL CART CNT' 26420001
264300               TO DP020-MSG-MESSAGE                               26430001
264400     END-IF.                                                      26440001
264500/                                                                 26450001
264600*----------------------------------------------------------------*26460001
264700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26470001
264800*----------------------------------------------------------------*26480001
264900                                                                  26490001
265000 5205-WRITE-SEL-QUEUE.                                            26500001
265100                                                                  26510001
265200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26520001
265300                                   TO PC016-SELECTED-ITEMS.       26530001
265400                                                                  26540001
265500     EXEC CICS                                                    26550001
265600          WRITEQ TS                                               26560001
265700              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      26570001
265800              FROM  (PC016-TS-SEL-REC)                            26580001
265900              ITEM  (PV-SEL-QUEUE-ITEM)                           26590001
266000              RESP  (PV-CICS-RESP)                                26600001
266100     END-EXEC.                                                    26610001
266200                                                                  26620001
266300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26630001
266400         CONTINUE                                                 26640001
266500     ELSE                                                         26650001
266600         SET DP013-CICS-ABEND      TO TRUE                        26660001
266700         SET DP013-NO-ROLLBACK     TO TRUE                        26670001
266800         MOVE '5205-WRITE-SEL-QUEUE'                              26680001
266900                                   TO DP013-PARAGRAPH             26690001
267000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26700001
267100                                   TO DP013-MESSAGE-TEXT(1)       26710001
267200         PERFORM DP013-0000-PROCESS-ABEND                         26720001
267300     END-IF.                                                      26730001
267400                                                                  26740001
267500/                                                                 26750001
267600*----------------------------------------------------------------*26760001
267700*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *26770001
267800*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *26780001
267900*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *26790001
268000*  THE USER.                                                     *26800001
268100*----------------------------------------------------------------*26810001
268200 6000-REFRESH-PANEL-FROM-TEMP.                                    26820001
268300                                                                  26830001
268400     IF  ASC-UPDATE-TSQ                                           26840001
268500         SET ASC-NO-TSQ-UPDATE     TO TRUE                        26850001
268600         MOVE ZERO                 TO PV-SAVE-ITEM                26860001
268700                                      PV-SEL-QUEUE-ITEM           26870001
268800         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26880001
268900                                   TO PV-HOLD-SELECTED-ITEMS      26890001
269000         PERFORM 6100-UPDATE-TSQ                                  26900001
269100             UNTIL PV-ITEMS-PROCESSED >                           26910001
269200                                     ASC-NUMBER-OF-SELECTED-ITEMS 26920001
269300         PERFORM 6010-DELETE-SEL-QUEUE                            26930001
269400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26940001
269500                    ASC-BLOCK-ENTRIES (2)                         26950001
269600     END-IF.                                                      26960001
269700                                                                  26970001
269800/                                                                 26980001
269900*----------------------------------------------------------------*26990001
270000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27000001
270100*----------------------------------------------------------------*27010001
270200 6010-DELETE-SEL-QUEUE.                                           27020001
270300                                                                  27030001
270400     EXEC CICS                                                    27040001
270500         DELETEQ TS                                               27050001
270600             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       27060001
270700             RESP  (PV-CICS-RESP)                                 27070001
270800     END-EXEC.                                                    27080001
270900                                                                  27090001
271000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27100001
271100         (PV-CICS-RESP = DFHRESP(QIDERR)))                        27110001
271200         CONTINUE                                                 27120001
271300     ELSE                                                         27130001
271400         SET DP013-CICS-ABEND      TO TRUE                        27140001
271500         SET DP013-NO-ROLLBACK     TO TRUE                        27150001
271600         MOVE '6010-DELETE-SEL-QUEUE'                             27160001
271700                                   TO DP013-PARAGRAPH             27170001
271800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27180001
271900                                   TO DP013-MESSAGE-TEXT (1)      27190001
272000         PERFORM DP013-0000-PROCESS-ABEND                         27200001
272100     END-IF.                                                      27210001
272200                                                                  27220001
272300/                                                                 27230001
272400*----------------------------------------------------------------*27240001
272500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27250001
272600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27260001
272700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27270001
272800*    THE TEMP QUEUE.                                             *27280001
272900*----------------------------------------------------------------*27290001
273000                                                                  27300001
273100 6100-UPDATE-TSQ.                                                 27310001
273200                                                                  27320001
273300     ADD 1                         TO PV-SEL-QUEUE-ITEM.          27330001
273400     PERFORM 6105-READ-SEL-QUEUE.                                 27340001
273500                                                                  27350001
273600     PERFORM                                                      27360001
273700         VARYING PC016-IDX                                        27370001
273800         FROM 1 BY 1                                              27380001
273900         UNTIL ((PV-ITEMS-PROCESSED >                             27390001
274000                              PV-HOLD-SELECTED-ITEMS)             27400001
274100         OR (PC016-IDX GREATER THAN PC016-MAX-ITEMS))             27410001
274200         IF  PC016-ACTION-SW (PC016-IDX) > SPACE                  27420001
274300             PERFORM 6110-PROCESS-ITEMS                           27430001
274400         END-IF                                                   27440001
274500         ADD +1                    TO PV-ITEMS-PROCESSED          27450001
274600     END-PERFORM.                                                 27460001
274700                                                                  27470001
274800     PERFORM 6111-WRITE-LIST-QUEUE.                               27480001
274900                                                                  27490001
275000/                                                                 27500001
275100*----------------------------------------------------------------*27510001
275200*    READ THE LIST QUEUE RECORD.                                 *27520001
275300*----------------------------------------------------------------*27530001
275400                                                                  27540001
275500 6105-READ-SEL-QUEUE.                                             27550001
275600                                                                  27560001
275700     EXEC CICS                                                    27570001
275800          READQ TS                                                27580001
275900              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      27590001
276000              INTO  (PC016-TS-SEL-REC)                            27600001
276100              ITEM  (PV-SEL-QUEUE-ITEM)                           27610001
276200              RESP  (PV-CICS-RESP)                                27620001
276300     END-EXEC.                                                    27630001
276400                                                                  27640001
276500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27650001
276600         CONTINUE                                                 27660001
276700     ELSE                                                         27670001
276800         SET DP013-CICS-ABEND      TO TRUE                        27680001
276900         SET DP013-NO-ROLLBACK     TO TRUE                        27690001
277000         MOVE '6105-READ-SEL-QUEUE'                               27700001
277100                                   TO DP013-PARAGRAPH             27710001
277200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27720001
277300                                   TO DP013-MESSAGE-TEXT(1)       27730001
277400         PERFORM DP013-0000-PROCESS-ABEND                         27740001
277500     END-IF.                                                      27750001
277600                                                                  27760001
277700/                                                                 27770001
277800*----------------------------------------------------------------*27780001
277900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27790001
278000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27800001
278100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27810001
278200*----------------------------------------------------------------*27820001
278300                                                                  27830001
278400 6110-PROCESS-ITEMS.                                              27840001
278500                                                                  27850001
278600     COMPUTE PV-ITEM = 1 + ((PC016-ITEM (PC016-IDX) - 1)          27860001
278700                     / PC-ITEMS-PER-PANEL).                       27870001
278800                                                                  27880001
278900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27890001
279000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27900001
279100             PERFORM 6111-WRITE-LIST-QUEUE                        27910001
279200         END-IF                                                   27920001
279300         MOVE PV-ITEM              TO PV-SAVE-ITEM                27930001
279400                                                                  27940001
279500         PERFORM 6112-READ-LIST-QUEUE                             27950001
279600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27960001
279700             CONTINUE                                             27970001
279800         END-IF                                                   27980001
279900     END-IF.                                                      27990001
280000                                                                  28000001
280100     COMPUTE PV-SUB = (PC016-ITEM (PC016-IDX)                     28010001
280200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28020001
280300                                                                  28030001
280400     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       28040001
280500     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        28050001
280600                                     (PV-SUB).                    28060001
280700                                                                  28070001
280800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28080001
280900                                                                  28090001
281000/                                                                 28100001
281100*----------------------------------------------------------------*28110001
281200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28120001
281300*----------------------------------------------------------------*28130001
281400                                                                  28140001
281500 6111-WRITE-LIST-QUEUE.                                           28150001
281600                                                                  28160001
281700     EXEC CICS                                                    28170001
281800         WRITEQ TS                                                28180001
281900             QUEUE (ASC-LIST-QUEUE-NAME)                          28190001
282000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28200001
282100             ITEM  (PV-SAVE-ITEM)                                 28210001
282200             REWRITE                                              28220001
282300             RESP  (PV-CICS-RESP)                                 28230001
282400     END-EXEC.                                                    28240001
282500                                                                  28250001
282600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28260001
282700         CONTINUE                                                 28270001
282800     ELSE                                                         28280001
282900         SET DP013-CICS-ABEND      TO TRUE                        28290001
283000         SET DP013-NO-ROLLBACK     TO TRUE                        28300001
283100         MOVE '6111-WRITE-LIST-QUEUE'                             28310001
283200                                   TO DP013-PARAGRAPH             28320001
283300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28330001
283400                                   TO DP013-MESSAGE-TEXT(1)       28340001
283500         PERFORM DP013-0000-PROCESS-ABEND                         28350001
283600     END-IF.                                                      28360001
283700                                                                  28370001
283800/                                                                 28380001
283900*----------------------------------------------------------------*28390001
284000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28400001
284100*----------------------------------------------------------------*28410001
284200                                                                  28420001
284300 6112-READ-LIST-QUEUE.                                            28430001
284400                                                                  28440001
284500     EXEC CICS                                                    28450001
284600         READQ TS                                                 28460001
284700             QUEUE (ASC-LIST-QUEUE-NAME)                          28470001
284800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28480001
284900             ITEM  (PV-ITEM)                                      28490001
285000             RESP  (PV-CICS-RESP)                                 28500001
285100     END-EXEC.                                                    28510001
285200                                                                  28520001
285300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28530001
285400         CONTINUE                                                 28540001
285500     ELSE                                                         28550001
285600         SET DP013-CICS-ABEND      TO TRUE                        28560001
285700         SET DP013-NO-ROLLBACK     TO TRUE                        28570001
285800         MOVE '6112-READ-LIST-QUEUE'                              28580001
285900                                   TO DP013-PARAGRAPH             28590001
286000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28600001
286100                                   TO DP013-MESSAGE-TEXT(1)       28610001
286200         PERFORM DP013-0000-PROCESS-ABEND                         28620001
286300     END-IF.                                                      28630001
286400                                                                  28640001
286500/                                                                 28650001
286600******************************************************************28660001
286700* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *28670001
286800******************************************************************28680001
286900 6200-DEL-LIST-QUEUE.                                             28690001
287000                                                                  28700001
287100     EXEC CICS                                                    28710001
287200         DELETEQ TS                                               28720001
287300             QUEUE (ASC-LIST-QUEUE-NAME)                          28730001
287400             RESP  (PV-CICS-RESP)                                 28740001
287500     END-EXEC.                                                    28750001
287600                                                                  28760001
287700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      28770001
287800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         28780001
287900         CONTINUE                                                 28790001
288000     ELSE                                                         28800001
288100        SET DP013-CICS-ABEND       TO TRUE                        28810001
288200        SET DP013-NO-ROLLBACK      TO TRUE                        28820001
288300        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             28830001
288400        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               28840001
288500                                   TO DP013-MESSAGE-TEXT (1)      28850001
288600        PERFORM DP013-0000-PROCESS-ABEND                          28860001
288700     END-IF.                                                      28870001
288800                                                                  28880001
288900/                                                                 28890001
289000 7000-FORMAT-COMMAREA.                                            28900001
289100                                                                  28910001
289200     IF ASC-BLOCK-MODIFIED-SW(1) = 'Y'                            28920001
289300        MOVE 1                   TO PV-BLOCK-NUMBER               28930001
289400     ELSE                                                         28940001
289500        MOVE 2                   TO PV-BLOCK-NUMBER               28950001
289600     END-IF.                                                      28960001
289700                                                                  28970001
289800     MOVE ASC-OPERATING-UNIT-ID  TO PC000-OPERATING-UNIT-ID       28980001
289900     MOVE ASC-FACILITY-ID        TO PC000-FACILITY-ID             28990001
290000     MOVE ASC-PO-NBR             TO PC000-PO-NBR-N                29000001
290100     MOVE ASC-REC-SEQ-NBR        TO PC000-REC-SEQ-NBR-N           29010001
290200     MOVE ASC-LINE-NBR           TO PC000-LINE-NBR-N              29020001
290300     MOVE PV-WO-NBR              TO PC000-WO-NBR-N                29030001
290400     MOVE PV-RECVR-STATUS-CDE    TO PC000-RECVR-STATUS-CDE        29040001
290500     MOVE PC-WORK-ORDER-DIST-SHEET                                29050001
290600                                 TO PC000-REPORT-ID.              29060001
290700                                                                  29070001
290800**   PERFORM VARYING PV-SUB FROM 1 BY 1                           29080001
290900**           UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    29090001
291000**       IF ASC-SELECTED-SW  (PV-BLOCK-NUMBER PV-SUB) = 'S'       29100001
291100**          MOVE ASC-WORK-ORD-SEQ-NBR  (PV-BLOCK-NUMBER PV-SUB)   29110001
291200**                               TO PC000-WO-NBR-N                29120001
291300**          MOVE ASC-STAT-CDE         (PV-BLOCK-NUMBER PV-SUB)    29130001
291400**                               TO PC000-RECVR-STATUS-CDE        29140001
291500**-->       ** UPON THE 1ST HIT, END THE LOOP BY BUMPING UP PV-SUB29150001
291600**          COMPUTE PV-SUB = PC-ITEMS-PER-PANEL + 1               29160001
291700**       END-IF                                                   29170001
291800**   END-PERFORM.                                                 29180001
291900/                                                                 29190001
292000******************************************************************29200001
292100* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *29210001
292200******************************************************************29220001
292300 9100-READ-SEL-QUEUE.                                             29230001
292400     EXEC CICS                                                    29240001
292500         READQ TS                                                 29250001
292600             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        29260001
292700             INTO  (PC016-TS-SEL-REC)                             29270001
292800             ITEM  (ASC-SEL-ITEM)                                 29280001
292900             RESP  (PV-CICS-RESP)                                 29290001
293000     END-EXEC.                                                    29300001
293100                                                                  29310001
293200     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        29320001
293300         CONTINUE                                                 29330001
293400     ELSE                                                         29340001
293500         SET DP013-LOGIC-ABEND                                    29350001
293600             DP013-NO-ROLLBACK     TO TRUE                        29360001
293700         MOVE '9100-READ-SEL-QUEUE'                               29370001
293800                                   TO DP013-PARAGRAPH             29380001
293900         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    29390001
294000                                   TO DP013-MESSAGE-TEXT (1)      29400001
294100         PERFORM DP013-0000-PROCESS-ABEND                         29410001
294200     END-IF.                                                      29420001
294300                                                                  29430001
294400/                                                                 29440001
294500******************************************************************29450001
294600* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *29460001
294700******************************************************************29470001
294800 9200-REWRITE-LIST-QUEUE.                                         29480001
294900     EXEC CICS                                                    29490001
295000          WRITEQ TS                                               29500001
295100              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     29510001
295200              FROM    (PC016-TS-SEL-REC)                          29520001
295300              ITEM    (ASC-SEL-ITEM)                              29530001
295400              RESP    (PV-CICS-RESP)                              29540001
295500              REWRITE                                             29550001
295600     END-EXEC.                                                    29560001
295700                                                                  29570001
295800     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    29580001
295900         SET DP013-CICS-ABEND                                     29590001
296000             DP013-NO-ROLLBACK     TO TRUE                        29600001
296100         MOVE '9200-REWRITE-LIST-QUEUE'                           29610001
296200                                   TO DP013-PARAGRAPH             29620001
296300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29630001
296400                                   TO DP013-MESSAGE-TEXT (1)      29640001
296500         PERFORM DP013-0000-PROCESS-ABEND                         29650001
296600     END-IF.                                                      29660001
296700                                                                  29670001
296800*----------------------------------------------------------------*29680001
296900*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *29690001
297000*    AND THE ERROR SWITHCES.                                     *29700001
297100*----------------------------------------------------------------*29710001
297200 9900-SOFT-ABORT.                                                 29720001
297300     SET PS-ERROR         TO TRUE.                                29730001
297400     SET DP020-MSG-FATAL  TO TRUE.                                29740001
297500     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    29750001
297600     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       29760001
297700     MOVE 'PROGRAM EXIT CALL'   TO DP013-MESSAGE-TEXT (1).        29770001
297800     PERFORM 0001-CALL-CICS-ARCH-API.                             29780001
297900                                                                  29790001
298000*----------------------------------------------------------------*29800001
298100*    ABEND PROCESSOR MODULE                                      *29810001
298200*----------------------------------------------------------------*29820001
298300                                                                  29830001
298400     COPY DPPD013.                                                29840001
