00001                                                                   11/21/95
00002      EXEC CICS LINK                                               DPPD276 
00003          PROGRAM  (DP276-PGM-NAME)                                   LV001
00004          COMMAREA (DP276-COMMAREA)                                DPPD276 
00005          RESP     (PV-CICS-RESP)                                  DPPD276 
00006      END-EXEC.                                                    DPPD276 
00007                                                                   DPPD276 
00008 *  CHECK CICS RETURN CODE                                         DPPD276 
00009      IF PV-CICS-RESP = DFHRESP(NORMAL)                            DPPD276 
00010          CONTINUE                                                 DPPD276 
00011      ELSE                                                         DPPD276 
00012          SET DP013-CICS-ABEND                                     DPPD276 
00013              DP013-NO-ROLLBACK   TO TRUE                          DPPD276 
00014          MOVE '4200-CALC-OPEN-TO-REC'                             DPPD276 
00015                                  TO DP013-PARAGRAPH               DPPD276 
00016          MOVE 'ATTEMPTING TO LINK TO PROGRAM DPKCS276'            DPPD276 
00017                                  TO DP013-MESSAGE-TEXT (1)        DPPD276 
00018          PERFORM DP013-0000-PROCESS-ABEND                         DPPD276 
00019      END-IF.                                                      DPPD276 
00020                                                                   DPPD276 
00021 *  CHECK DP276-RETURN-CODE                                        DPPD276 
00022      EVALUATE TRUE                                                DPPD276 
00023      WHEN DP276-RETURN-CODE = ZERO                                DPPD276 
00024          CONTINUE                                                 DPPD276 
00025      WHEN OTHER                                                   DPPD276 
00026          EVALUATE TRUE                                            DPPD276 
00027          WHEN DP276-SOFT-ABORT                                    DPPD276 
00028              PERFORM 4220-ROLLBACK                                DPPD276 
00029          WHEN DP276-NO-DISTRO                                     DPPD276 
00030              CONTINUE                                             DPPD276 
00031          WHEN OTHER                                               DPPD276 
00032              MOVE DP276-SEVERITY-IND                              DPPD276 
00033                                  TO DP020-MSG-SEVERITY-IND        DPPD276 
00034              MOVE +1096          TO DP020-MSG-NUMBER              DPPD276 
00035          END-EVALUATE                                             DPPD276 
00036      END-EVALUATE.                                                DPPD276 
00037                                                                   DPPD276 
00038  4210-SEARCH-OTR.                                                 DPPD276 
00039      SET DP276-IDX TO 1                                           DPPD276 
00040      SEARCH DP276-WORK-AREA                                       DPPD276 
00041      AT END                                                       DPPD276 
00042          CONTINUE                                                 DPPD276 
00043      WHEN DP276-LINE-NBR (DP276-IDX) = ZERO                       DPPD276 
00044 * THIS WILL HAPPEN WHEN DPKCS276 IS UNABLE TO RETRIEVE QTYS       DPPD276 
00045 * FROM TMESTDS.                                                   DPPD276 
00046          MOVE ALL '*'            TO DP276-OTR-OUT-X               DPPD276 
00047                                     DP276-ORDER-QTY-X             DPPD276 
00048      WHEN DP276-LINE-NBR (DP276-IDX) = DP276-SEARCH-NBR           DPPD276 
00049          MOVE DP276-OTR-QTY (DP276-IDX)                           DPPD276 
00050                                  TO DP276-OTR-OUT                 DPPD276 
00051          ADD DP276-OTR-QTY (DP276-IDX)                            DPPD276 
00052                                  TO DP276-TOTAL-OTR               DPPD276 
00053          MOVE DP276-OTR-QTY-X (DP276-IDX)                         DPPD276 
00054                                  TO DP276-OTR-OUT-X               DPPD276 
00055          MOVE DP276-STR-DISTRO-QTY (DP276-IDX)                    DPPD276 
00056                                  TO DP276-ORDER-QTY               DPPD276 
00057          MOVE DP276-STR-DISTRO-QTY-X (DP276-IDX)                  DPPD276 
00058                                  TO DP276-ORDER-QTY-X             DPPD276 
00059      END-SEARCH.                                                  DPPD276 
00060                                                                   DPPD276 
00061  4220-ROLLBACK.                                                   DPPD276 
00062                                                                   DPPD276 
00063      MOVE DP276-SEVERITY-IND     TO DP020-MSG-SEVERITY-IND        DPPD276 
00064      MOVE +551                   TO DP020-MSG-NUMBER              DPPD276 
00065                                                                   DPPD276 
00066      EXEC CICS                                                    DPPD276 
00067          SYNCPOINT ROLLBACK                                       DPPD276 
00068      END-EXEC.                                                    DPPD276 
00069                                                                   DPPD276 
