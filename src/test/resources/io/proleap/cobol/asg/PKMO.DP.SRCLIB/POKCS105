000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKCS105.                                         00020000
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  08-26-93.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    W105 - PO SELECTION LIST                                   * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF PO'S BASED ON CRITERIA    * 00110000
001200*    PASSED FROM THE CRITERIA SPEC SCREEN.                      * 00120000
001300*                                                               * 00130000
001400*---------------------------------------------------------------* 00140000
001500*  CHANGES MADE:                                                  00150000
001600*  CHANGED PARA 4395-GET-ITEM-DATA.  ADDED PV-WTY-NULL AND        00160000
001700*  PV-QTY-NULL1.  THIS WILL PREVENT USER FROM ABENDING WITH       00170000
001800*  -305 SQL CODE.                                                 00180000
001900*  MOVED PARA 4370 TO 4399 AND 4390 TO 4399.  CHANGED THIS BECAUSE00190000
002000*  4370 AND 4390 WERE ONLY BEING DONE AFTER ALL PO INFO WAS       00200000
002100*  GATHERED AND WERE GETTING TOTALS FOR WHOLE PO.  NOW THESE PARAS00210000
002200*  ARE BEING DONE AFTER EACH LINE ON THE PO IS DETERMINED TO MATCH00220000
002300*  WHAT THE USER ENTERED ON CRITERIA SPEC SCREEN.  NOW THESE PARAS00230000
002400*  WILL TOTAL AND DISPLAY INFO ONLY THE LINES FROM PO THAT MATCH. 00240000
002500*  S.BARTELT  TKMA537   12/20/99                                  00250000
W24803*---------------------------------------------------------------* 00260000
W24803* 05/12/03 - S PRABHAKAR RAO, IGSI - WR NO. 24803                 00270000
W24803*    - IN MAP POKM106 REPLACED DEPARTMENT, CLASS AND              00280000
W24803*      SEQUENCE NUMBER BY DEPARTMENT, MAJOR CLASS, SUB CLASS      00290000
W24803*      AND SKU NUMBER AND ADJUSTED THE POSITIONS OF OTHER FIELDS. 00300000
W24803*                                                                 00310000
W24803*    - COPY BOOK POWS017 IS CHANGED.                              00320000
W24803*    - REPLACED TSK, TSKURNMB, TMESTDS AND TSTR000 TABLES         00330000
W24803*      WITH XLT_SKU AND XLT_VND_STYL TABLES.                      00340000
W24803*    - REPLACED DEPARTMENT, CLASS AND 3 DIGIT SEQUENCE NUMBER     00350000
W24803*      WITH DEPARTMENT, SUB CLASS, MAJOR CLASS AND SKU NUMBER     00360000
W24803*      RESPECTIVELY FOR NI SKU CONVERSION.                        00370000
W24803*    - PARAGRAPHS 4109-CL-NBR, 4110-CL-NBR, 4316-RENUMBER-LOOP,   00380000
W24803*      4315-TSK-SELECT AND 4317-TSKURNMBR-SELECT ARE REMOVED.     00390000
W24803*    - PARAGRAPHS 4109-SUB-CL-NBR, 4110-MAJ-CL-NBR ARE ADDED.     00400000
W24803*---------------------------------------------------------------* 00410000
C98147* 11/10/14 - LINDA FRIESS          - CHG0098147                   00420056
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA.        00430056
C98147*---------------------------------------------------------------* 00440056
076319* DATE  10/27/2021                                                00441062
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00442062
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00443062
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00444062
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00445063
076312*                                                               * 00446062
076318*---------------------------------------------------------------* 00447062
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00448065
CICS  *                                                               * 00449064
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00449164
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00449264
CICS  *---------------------------------------------------------------* 00449564
002600/                                                                 00450000
002700 ENVIRONMENT DIVISION.                                            00460000
002800                                                                  00470000
002900 DATA DIVISION.                                                   00480000
003000                                                                  00490000
003100 WORKING-STORAGE SECTION.                                         00500000
003200                                                                  00510000
003300 01  DK-DB2-KEYS.                                                 00520000
003400     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       00530000
003700     05  DK-STR-NBR                PIC S9(04) COMP VALUE +0.      00540000
003800     05  DK-AGRMT-TYP-ID           PIC X(01)  VALUE SPACES.       00550000
003900     05  DK-TYP-CDE                PIC S9(04) VALUE +0            00560000
004000                                              COMP.               00570000
004100                                                                  00580000
004200 01  PC-PROGRAM-CONSTANTS.                                        00590000
004300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00600000
004400                                                    'PO105A  '.   00610000
004500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00620000
004600                                                    'POKM105 '.   00630000
004700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00640000
004800                                                    'POKCS105'.   00650000
004900     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00660000
005000                                                    COMP.         00670000
005100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00680000
005200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00690000
005300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00700000
005400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00710000
005500                                                    COMP SYNC.    00720000
005600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00730000
005700                                                    COMP SYNC.    00740000
005800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00750000
005900                                                    +1000000      00760000
006000                                                    COMP-3.       00770000
006100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00780000
006200                                                    COMP SYNC.    00790000
006300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00800000
006400                                                    COMP-3.       00810000
006500     05  PC-CNT-MINUS-2                 PIC S9(04)  VALUE -2      00820000
006600                                                    COMP SYNC.    00830000
006700     05  PC-CNT-6                       PIC S9(04)  VALUE +6      00840000
006800                                                    COMP SYNC.    00850000
006900     05  PC-CNT-7                       PIC S9(04)  VALUE +7      00860000
007000                                                    COMP SYNC.    00870000
007100     05  PC-ACT                         PIC  X(03)  VALUE 'ACT'.  00880000
007200     05  PC-CMP                         PIC  X(03)  VALUE 'CMP'.  00890000
007300     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00900000
007400     05  PC-QUOTE                       PIC  X(01)  VALUE X'7D'.  00910000
007500     05  PC-DOLLAR-HEAD                 PIC  X(27)  VALUE         00920000
007600         ' DOLLARS       DOLLARS PCT '.                           00930000
007700     05  PC-DOLLAR-HEAD2                PIC  X(35)  VALUE         00940000
C98147         '      ORDERED      RECEIVED RCVD   '.                   00950056
007900     05  PC-UNITS-HEAD                  PIC  X(28)  VALUE         00960000
008000         '  UNITS    UNITS  PCT   AD  '.                          00970000
008100     05  PC-UNITS-HEAD2                 PIC  X(35)  VALUE         00980000
C98147         '     ORDERED RECEIVED RCVD  DATE   '.                   00990056
008300                                                                  01000000
008400                                                                  01010000
008500     05  PC-TSYMSG-NUMBERS.                                       01020000
008600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01030000
008700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01040000
008800         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  01050000
008900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01060000
009000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01070000
009100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01080000
009200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01090000
009300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01100000
009400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01110000
009500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01120000
009600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01130000
009700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01140000
009800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01150000
009900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01160000
010000         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01170000
010100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01180000
010200         10  PC-TSYMSG-00317            PIC  9(05)  VALUE 00317.  01190000
010300         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01200000
010400         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01210000
010500         10  PC-TSYMSG-00620            PIC  9(05)  VALUE 00620.  01220000
010600         10  PC-TSYMSG-00621            PIC  9(05)  VALUE 00621.  01230000
010700         10  PC-TSYMSG-01853            PIC  9(05)  VALUE 01853.  01240000
W24803         10  PC-TSYMSG-03069            PIC  9(05)  VALUE 03069.  01250000
W24803         10  PC-TSYMSG-03070            PIC  9(05)  VALUE 03070.  01260000
W24803         10  PC-TSYMSG-03073            PIC  9(05)  VALUE 03073.  01270000
010800                                                                  01280000
010900                                                                  01290000
011000 01  PS-PROGRAM-SWITCHES.                                         01300000
011100     05  PS-PURITM-SW                   PIC  X(01)  VALUE 'Y'.    01310000
011200         88  PS-206-PURITM                          VALUE 'Y'.    01320000
011300         88  PS-000-PURITM                          VALUE 'N'.    01330000
011400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01340000
011500         88  PS-NO-ERROR                            VALUE 'Y'.    01350000
011600         88  PS-ERROR                               VALUE 'N'.    01360000
011700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01370000
011800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01380000
011900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01390000
012000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01400000
012100         88  PS-DONE                                VALUE 'Y'.    01410000
012200         88  PS-NOT-DONE                            VALUE 'N'.    01420000
012300     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01430000
012400         88  PS-DONT-SKIP                           VALUE 'N'.    01440000
012500         88  PS-SKIP                                VALUE 'Y'.    01450000
012600     05  PS-TPURITM-SW                  PIC  X(01)  VALUE 'N'.    01460000
012700         88  PS-DONT-USE-TPURITM                    VALUE 'N'.    01470000
012800         88  PS-USE-TPURITM                         VALUE 'Y'.    01480000
012900     05  PS-TENTNME-SW                  PIC  X(01)  VALUE 'N'.    01490000
013000         88  PS-DONT-USE-TENTNME                    VALUE 'N'.    01500000
013100         88  PS-USE-TENTNME                         VALUE 'Y'.    01510000
013800     05  PS-GC-SW                       PIC  X(01)  VALUE 'N'.    01520000
013900         88  PS-GC-MATCH                            VALUE 'Y'.    01530000
014000         88  PS-GC-NO-MATCH                         VALUE 'N'.    01540000
014100                                                                  01550000
014200 01  PV-PROGRAM-VARIABLES.                                        01560000
014300     05  PV-ABSTIME                   PIC S9(15) COMP.            01570000
014400     05  PV-CURRENT-TIME              PIC  9(06).                 01580000
014500     05  PV-CURRENT-DATE              PIC  9(06).                 01590000
014600     05  FILLER REDEFINES PV-CURRENT-DATE.                        01600000
014700         10  PV-CURRENT-DATE-YY       PIC  X(02).                 01610000
014800         10  PV-CURRENT-DATE-MM       PIC  X(02).                 01620000
014900         10  PV-CURRENT-DATE-DD       PIC  X(02).                 01630000
015000                                                                  01640000
015100     05  PV-CURRENT-DATE-ISO          PIC  X(10).                 01650000
015200     05  FILLER REDEFINES PV-CURRENT-DATE-ISO.                    01660000
015300         10  PV-CD-ISO-YEAR           PIC  9(04).                 01670000
015400         10  FILLER                   PIC  X(01).                 01680000
015500         10  PV-CD-ISO-MM             PIC  9(02).                 01690000
015600         10  FILLER                   PIC  X(01).                 01700000
015700         10  PV-CD-ISO-DD             PIC  9(02).                 01710000
015800     05  PV-HOLD-CC                     PIC X(02).                01720000
015900     05  PV-SUB                         PIC S9(04)  VALUE +0      01730000
016000                                                    COMP SYNC.    01740000
016100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01750000
016200                                                    COMP SYNC.    01760000
016300     05  PV-SELECT-BYTES                PIC S9(04)  VALUE +101    01770000
016400                                                    COMP SYNC.    01780000
016500     05  PV-STRING-POINTER-FROM         PIC S9(04)  VALUE +0      01790000
016600                                                    COMP   SYNC.  01800000
016700     05  PV-STRING-POINTER-WHERE        PIC S9(04)  VALUE +0      01810000
016800                                                    COMP   SYNC.  01820000
016900     05  PV-TALLY-1                     PIC S9(04)  VALUE +0      01830000
017000                                                    COMP   SYNC.  01840000
017100     05  PV-TALLY-2                     PIC S9(04)  VALUE +0      01850000
017200                                                    COMP   SYNC.  01860000
017300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01870000
017400                                                    COMP-3.       01880000
017500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01890000
017600                                                    COMP-3.       01900000
017700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01910000
017800                                                    COMP-3.       01920000
017900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01930000
018000                                                    COMP-3.       01940000
018100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01950000
018200                                                    COMP-3.       01960000
018300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01970000
018400                                                    COMP-3.       01980000
018500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01990000
018600                                                    COMP-3.       02000000
018700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02010000
018800                                                    COMP SYNC.    02020000
018900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02030000
019000                                                    COMP SYNC.    02040000
019100     05  PV-ITEM                        PIC S9(04)  VALUE +0      02050000
019200                                                    COMP SYNC.    02060000
019300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02070000
019400                                                    COMP SYNC.    02080000
019500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02090000
019600                                                    COMP SYNC.    02100000
019700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02110000
019800                                                    COMP SYNC.    02120000
019900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02130000
020000                                                    COMP SYNC.    02140000
020100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02150000
020200                                                    COMP SYNC.    02160000
020300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02170000
020400                                                    COMP SYNC.    02180000
020500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02190000
020600                                                    COMP SYNC.    02200000
020700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02210000
020800                                                    COMP SYNC.    02220000
020900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02230000
021000                                                    COMP SYNC.    02240000
021100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02250000
021200                                                    COMP SYNC.    02260000
021300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02270000
021400                                                    COMP SYNC.    02280000
021500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02290000
021600                                                    COMP SYNC.    02300000
021700                                                                  02310000
021800     05  PV-NULL-IND                    PIC S9(04)  VALUE +0 COMP.02320000
021900                                                                  02330000
022000     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02340000
022100                                                    COMP-3.       02350000
022200     05  PV-DB2-COUNT2                  PIC S9(09)  VALUE +0      02360000
022300                                                    COMP-3.       02370000
022400     05  PV-DB2-DATE                    PIC  X(10).               02380000
022500     05  FILLER  REDEFINES PV-DB2-DATE.                           02390000
022600         10  PV-DB2-DATE-CC             PIC  X(02).               02400000
022700         10  PV-DB2-DATE-YY             PIC  X(02).               02410000
022800         10  FILLER                     PIC  X(01).               02420000
022900         10  PV-DB2-DATE-MM             PIC  X(02).               02430000
023000         10  FILLER                     PIC  X(01).               02440000
023100         10  PV-DB2-DATE-DD             PIC  X(02).               02450000
023200     05  PV-DISPLAY-DATE.                                         02460000
023300         10  PV-DISPLAY-DATE-MM         PIC  X(02).               02470000
023400         10  PV-DISPLAY-DATE-DD         PIC  X(02).               02480000
023500         10  PV-DISPLAY-DATE-YY         PIC  X(02).               02490000
023600     05  PV-DONT-SHIP-BEF-DTE           PIC  X(06).               02500000
023700     05  PV-CAN-IFNOT-SHIP-DTE          PIC  X(06).               02510000
023800     05  PV-AD-EVNT-DTE                 PIC  X(06).               02520000
023900                                                                  02530000
024000     05  PV-GP-DOLLARS-RECEIVED         PIC S9(10)V99 COMP-3.     02540000
024100     05  PV-DOLLARS-RECEIVED            PIC S9(10)V99 COMP-3.     02550000
024200     05  PV-TOT-DOLLARS-RECEIVED        PIC S9(10)V99 VALUE +0    02560000
024300                                                  COMP-3.         02570000
024400     05  PV-UNITS-RECEIVED              PIC S9(07)    COMP-3.     02580000
024500     05  PV-TOT-UNITS-RECEIVED          PIC S9(07) VALUE +0       02590000
024600                                                   COMP-3.        02600000
024700     05  PV-PCT-AREA                    PIC S9(04)V999            02610000
024800                                                      COMP-3.     02620000
024900                                                                  02630000
025000     05  PV-TABLE-QUALIFIER.                                      02640000
025100         10 FILLER                      PIC X(03) VALUE 'DB2'.    02650000
W24803         10 PV-QUALIFIER                PIC X(01) VALUE ' '.      02660053
025300         10 FILLER                      PIC X(03) VALUE 'DBA'.    02670000
025400         10 FILLER                      PIC X(01) VALUE '.'.      02680000
025500                                                                  02690000
025600     05  PV-TABLE-QUALIFIER-COMMA.                                02700000
025700         10 FILLER                      PIC X(04) VALUE ',DB2'.   02710000
W24803         10 PV-QUALIFIER-COMMA          PIC X(01) VALUE ' '.      02720053
025900         10 FILLER                      PIC X(03) VALUE 'DBA'.    02730000
024803         10 FILLER                      PIC X(01) VALUE '.'.      02740051
W24803                                                                  02750051
W24803     05  PV-IND-VAR1                    PIC S9(04) VALUE +0 COMP. 02760051
W24803     05  PV-IND-VAR2                    PIC S9(04) VALUE +0 COMP. 02770051
026100                                                                  02780000
026200     05  PV-QTY-NULL                    PIC S9(04) VALUE +0 COMP. 02790000
026300     05  PV-QTY-NULL1                   PIC S9(04) VALUE +0 COMP. 02800000
026400     05  PV-IMPRT-AGNT-PO-NBR           PIC 9(09) VALUE ZEROS.    02810000
W24803     05  PV-DEPT-NBR                    PIC 9(03) VALUE ZEROS.    02820000
027100     05  PV-HOLD-ORIG-ITEM-NBR          PIC S9(15)V VALUE +0      02830000
027200                                                  COMP-3.         02840000
027300     05  PV-HOLD-GROUP-CODE             PIC X(03) VALUE SPACES.   02850000
027400     05  PV-ENT-NAME-DESC               PIC X(32) VALUE SPACES.   02860000
027500     05  PV-VEND-STYL-NME               PIC X(22) VALUE SPACES.   02870000
027600     05  PV-GROUP-CDE                   PIC X(03) VALUE SPACES.   02880000
W24803     05 PV-SUB-CL.                                                02890000
W24803         10 FILLER                      PIC 9(02) VALUE ZERO.     02900000
W24803         10 PV-SUB-CL-3-4               PIC 9(02).                02910000
W24803     05 PV-SUB-CLASS REDEFINES PV-SUB-CL                          02920000
W24803                                        PIC 9(04).                02930000
W24803     05 PV-MAJ-CL.                                                02940000
W24803         10 FILLER                      PIC 9(02) VALUE ZERO.     02950000
W24803         10 PV-MAJ-CL-3                 PIC 9.                    02960000
W24803         10 FILLER                      PIC 9     VALUE ZERO.     02970000
W24803     05 PV-MAJ-CLASS REDEFINES PV-MAJ-CL                          02980000
W24803                                        PIC 9(04).                02990000
W24803     05  PV-MAJ-CLASS-BEG               PIC S9(04) COMP-3         03000000
W24803                                                  VALUE +0.       03010000
W24803     05  PV-MAJ-CLASS-END               PIC S9(04) COMP-3         03020000
W24803                                                  VALUE 9999.     03030000
W24803     05  PV-SUB-CLASS-BEG               PIC S9(04) COMP-3         03040000
W24803                                                  VALUE +0.       03050000
W24803     05  PV-SUB-CLASS-END               PIC S9(04) COMP-3         03060000
W24803                                                  VALUE 9999.     03070000
028100     05  PV-TSK-COUNT                   PIC 9(03) VALUE ZEROS.    03080000
028200     05  PV-PURITM-UNT-QTY              PIC S9(09) COMP.          03090000
028300     05  PV-TOT-PURITM-UNT-QTY          PIC S9(09) COMP.          03100000
028400     05  PV-PURITM-TOT-VAL-RTL-AMT      PIC S9(08)V9(02) VALUE +0 03110000
028500                                                  COMP-3.         03120000
028600     05  PV-TOT-PUR-TOT-VAL-RTL-AMT     PIC S9(10)V9(02) VALUE +0 03130000
028700                                                  COMP-3.         03140000
028800     05  PV-HOLD-PO-NBR                 PIC S9(9) COMP VALUE +0.  03150000
028900     05  PV-SELECTED-COUNTER            PIC  9(03) VALUE 0.       03160000
029000                                                                  03170000
029100     05  PV-SYSTEM-ID.                                            03180000
029200         10  FILLER                     PIC  X(04)  VALUE SPACE.  03190000
029300         10  PV-REGION-IND              PIC  X(01).               03200000
029400             88  PV-TEST-CICS                 VALUE 'T'.          03210000
029500             88  PV-QA-CICS                   VALUE 'Q'.          03220000
029600             88  PV-PROD-CICS                 VALUE 'P'.          03230000
029700             88  PV-LEARN-CICS                VALUE 'L'.          03240000
029800         10  FILLER                     PIC X(01)    VALUE SPACES.03250000
029900     05  FILLER                         PIC X(02)    VALUE SPACES.03260000
030000                                                                  03270000
030100*---------------------------------------------------------------* 03280000
030200*  WORKING STORAGE AREA USED TO BUILD SQL STATEMENTS            * 03290000
030300*---------------------------------------------------------------* 03300000
030400                                                                  03310000
030500 01  PV-SQL-STMT.                                                 03320000
030600     49  PV-SQL-STMT-LEN                PIC S9(04)  COMP  VALUE 0.03330000
W24803     49  PV-SQL-STMT-TEXT               PIC X(1601)  VALUE SPACES.03340000
030800                                                                  03350000
030900 01  PV-BUILD-SELECT-REC.                                         03360000
031000     05  PV-BUILD-SELECT-LEN            PIC S9(04)  COMP  VALUE 0 03370000
031100                                                          SYNC.   03380000
031200     05  PV-BUILD-SELECT-STMT.                                    03390000
031300         10  FILLER                     PIC  X(07)                03400000
031400                         VALUE 'SELECT '.                         03410000
031500         10  FILLER                     PIC  X(09)                03420000
031600                         VALUE 'DISTINCT '.                       03430000
031700         10  FILLER                     PIC  X(08)                03440000
031800                         VALUE 'A.PO_NBR'.                        03450000
031900         10  FILLER                     PIC  X(14)                03460000
032000                         VALUE ',A.OTB_PER_NBR'.                  03470000
032100         10  FILLER                     PIC  X(11)                03480000
032200                         VALUE ',A.DEPT_NBR'.                     03490000
032300         10  FILLER                     PIC  X(09)                03500000
032400                         VALUE ',A.ENT_ID'.                       03510000
032500         10  FILLER                     PIC  X(20)                03520000
032600                         VALUE ',C.DONT_SHIP_BEF_DTE'.            03530000
W24803         10  FILLER                     PIC  X(10)                03540000
W24803                         VALUE ',S.ITM_NBR'.                      03550000
W24803         10  FILLER                     PIC  X(9)                 03560000
W24803                         VALUE ',S.GP_CDE'.                       03570000
033100     05  PV-FROM-CLAUSE.                                          03580000
W24803         10  FILLER                     PIC  X(250).              03590051
033300                                                                  03600000
033400     05  PV-WHERE-CLAUSE.                                         03610000
W24803         10  FILLER                     PIC  X(1200).             03620051
033600                                                                  03630000
033700*---------------------------------------------------------------* 03640000
033800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 03650000
033900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 03660000
034000*   APPLICATION-SPECIFIC COMMAREA.                              * 03670000
034100*---------------------------------------------------------------* 03680000
034200 01  LQW-LIST-QUEUE-WORK-AREA.                                    03690000
034300     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  03700000
034400     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           03710000
034500                                        INDEXED BY LQW-IDX.       03720000
034600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03730000
034700         10  LQW-TEMP-SELECTED-SW       PIC X(01).                03740000
034800         10  LQW-SELECTED-SW            PIC X(01).                03750000
034900             88  LQW-SELECT                         VALUE 'S'.    03760000
035000             88  LQW-DESELECT                       VALUE ' '.    03770000
C98147         10  LQW-PO-NBR                 PIC 9(08).                03780056
035200         10  LQW-GROUP-CDE              PIC X(03).                03790000
035300         10  LQW-VENDOR-NAME            PIC X(08).                03800000
035400         10  LQW-SHIP-DATE              PIC X(06).                03810000
035500         10  LQW-CANCEL-DATE            PIC X(06).                03820000
035600         10  LQW-DOLLARS-ORDERED        PIC 9(10)V99.             03830000
035700         10  LQW-DOLLARS-RECEIVED       PIC 9(10)V99.             03840000
035800         10  LQW-DOLLARS-RCVD-PCT       PIC 9(04).                03850000
035900         10  LQW-TOT-UNIT-ORDERED       PIC 9(07).                03860000
036000         10  LQW-TOT-UNIT-RCVD          PIC 9(07).                03870000
036100         10  LQW-TOT-UNIT-RCVD-PCT      PIC 9(04).                03880000
036200         10  LQW-AD-EVNT-DATE           PIC X(06).                03890000
036300         10  LQW-IP-IND                 PIC X(01).                03900000
036400                                                                  03910000
036500/                                                                 03920000
036600*---------------------------------------------------------------* 03930000
036700*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 03940000
036800*---------------------------------------------------------------* 03950000
036900                                                                  03960000
037000     COPY POWS012.                                                03970000
037100                                                                  03980000
037200/                                                                 03990000
037300*---------------------------------------------------------------* 04000000
037400*    MAP LAYOUT                                                 * 04010000
037500*---------------------------------------------------------------* 04020000
037600                                                                  04030000
037700     COPY POKM105.                                                04040000
037800                                                                  04050000
037900 01  MR-OCCURS-LAYOUT                   REDEFINES  PO105AO.       04060000
C98147     05  FILLER                         PIC X(130).               04070060
038100                                                                  04080000
038200     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          04090000
038300         10  MR-SELECTL                 PIC S9(04) COMP.          04100000
038400         10  MR-SELECTA                 PIC X(01).                04110000
038500         10  MR-SELECTC                 PIC X(01).                04120000
038600         10  MR-SELECTH                 PIC X(01).                04130000
038700         10  MR-SELECT                  PIC X(01).                04140000
038800                                                                  04150000
038900         10  MR-PO-NBRL                 PIC S9(04) COMP.          04160000
039000         10  MR-PO-NBRA                 PIC X(01).                04170000
039100         10  MR-PO-NBRC                 PIC X(01).                04180000
039200         10  MR-PO-NBRH                 PIC X(01).                04190000
039300         10  MR-PO-NBR-X.                                         04200000
C98147             15  MR-PO-NBR              PIC ZZZZZZZZ.             04210056
039500                                                                  04220000
039600         10  FILLER                     PIC X(05).                04230000
039700         10  MR-GROUP-CDE               PIC X(03).                04240000
039800                                                                  04250000
039900         10  FILLER                     PIC X(05).                04260000
040000         10  MR-VENDOR-NAME             PIC X(08).                04270000
040100                                                                  04280000
040200         10  FILLER                     PIC X(05).                04290000
040300         10  MR-SHIP-DATE               PIC X(06).                04300000
040400                                                                  04310000
040500         10  FILLER                     PIC X(05).                04320000
040600         10  MR-CANCEL-DATE             PIC X(06).                04330000
040700                                                                  04340000
040800         10  FILLER                     PIC X(05).                04350000
040900         10  MR-LINE-AREA               PIC X(34).                04360000
041000                                                                  04370000
041100 01  MR-TOTAL-LINE.                                               04380000
041200     05  FILLER                         PIC X(18).                04390000
041300                                                                  04400000
041400 01  MR-DOLLAR-LINE.                                              04410000
041500     05  MR-DOLLARS-ORDERED-X.                                    04420000
041600         10  MR-DOLLARS-ORDERED         PIC ZZZZZZZZZZ.99.        04430000
041700     05  FILLER                         PIC X(01).                04440000
041800     05  MR-DOLLARS-RECEIVED-X.                                   04450000
041900         10  MR-DOLLARS-RECEIVED        PIC ZZZZZZZZZZ.99.        04460000
042000     05  FILLER                         PIC X(01).                04470000
042100     05  MR-DOLLARS-RCVD-PCT-X.                                   04480000
042200         10  MR-DOLLARS-RCVD-PCT        PIC ZZZZ.                 04490000
042300     05  MR-DOLLARS-PCT-SPACE           PIC X(02).                04500000
042400                                                                  04510000
042500 01  MR-UNITS-LINE.                                               04520000
042600     05  FILLER                         PIC X(05) VALUE SPACES.   04530000
042700     05  MR-UNITS-ORDERED-X.                                      04540000
042800         10  MR-UNITS-ORDERED           PIC ZZZZZZ9.              04550000
042900     05  FILLER                         PIC X(02).                04560000
043000     05  MR-UNITS-RECEIVED-X.                                     04570000
043100         10  MR-UNITS-RECEIVED          PIC ZZZZZZ9.              04580000
043200     05  FILLER                         PIC X(01).                04590000
043300     05  MR-UNITS-RCVD-PCT-X.                                     04600000
043400         10  MR-UNITS-RCVD-PCT          PIC ZZZZ.                 04610000
043500     05  MR-UNITS-PCT-SPACE             PIC X(02).                04620000
043600     05  MR-AD-EVNT-DTE                 PIC X(06).                04630000
043700                                                                  04640000
043800 01  MR-DOLLARS-TOTAL.                                            04650000
043900     05  MR-DOLLARS-ORDERED-TOT         PIC ZZZZZZZZZZ9.          04660000
044000     05  FILLER                         PIC X(04).                04670000
044100     05  MR-DOLLARS-RECEIVED-TOT        PIC ZZZZZZZZZ9.           04680000
044200     05  FILLER                         PIC X(01).                04690000
044300     05  MR-DOLLARS-RCVD-PCT-TOT-X.                               04700000
044400         10  MR-DOLLARS-RCVD-PCT-TOT    PIC ZZZ9.                 04710000
044500     05  FILLER                         PIC X(01) VALUE '%'.      04720000
044600                                                                  04730000
044700 01  MR-UNITS-TOTAL.                                              04740000
044800     05  FILLER                         PIC X(03) VALUE SPACES.   04750000
044900     05  MR-UNITS-ORDERED-TOT           PIC ZZZZZZ9.              04760000
045000     05  FILLER                         PIC X(02).                04770000
045100     05  MR-UNITS-RECEIVED-TOT          PIC ZZZZZZ9.              04780000
045200     05  FILLER                         PIC X(01).                04790000
045300     05  MR-UNITS-RCVD-PCT-TOT-X.                                 04800000
045400         10  MR-UNITS-RCVD-PCT-TOT      PIC ZZZ9.                 04810000
045500     05  FILLER                         PIC X(01) VALUE '%'.      04820000
045600     05  FILLER                         PIC X(05) VALUE SPACES.   04830000
045700                                                                  04840000
045800/                                                                 04850000
045900*---------------------------------------------------------------* 04860000
046000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04870000
046100*---------------------------------------------------------------* 04880000
046200                                                                  04890000
046300     COPY DPWS015.                                                04900000
046400                                                                  04910000
046500*---------------------------------------------------------------* 04920000
046600*    FUNCTION KEYS COPYBOOK.                                    * 04930000
046700*---------------------------------------------------------------* 04940000
046800                                                                  04950000
046900     COPY DPWS016.                                                04960000
047000                                                                  04970000
047100*---------------------------------------------------------------* 04980000
047200*    NUMERIC EDIT LAYOUT.                                       * 04990000
047300*---------------------------------------------------------------* 05000000
047400                                                                  05010000
047500     COPY DPWS010I.                                               05020000
047600                                                                  05030000
047700*----------------------------------------------------------------*05040000
047800*  WORK AREA PASSED IN CALL TO DPKUT500                          *05050000
047900*----------------------------------------------------------------*05060000
048000     COPY DPWS500.                                                05070000
048100/                                                                 05080000
048200*---------------------------------------------------------------* 05090000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 05100064
048400*---------------------------------------------------------------* 05110000
048500                                                                  05120000
048600     COPY DPWS030.                                                05130000
CICS       COPY DPWS930.                                                05131064
048700                                                                  05140000
048800/                                                                 05150000
048900*---------------------------------------------------------------* 05160000
049000*    STANDARD COMMAREA.                                         * 05170000
049100*---------------------------------------------------------------* 05180000
049200                                                                  05190000
049300     COPY DPWS020.                                                05200000
049400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05210000
049500                                                                  05220000
049600*---------------------------------------------------------------* 05230000
049700* INTER-APPLICATION COMMAREA.                                   * 05240000
049800*---------------------------------------------------------------* 05250000
049900                                                                  05260000
050000         10  INTER-APPL-COMM-AREA       PIC X(200).               05270000
050100     COPY POWS013.                                                05280000
050200     COPY POWS017.                                                05290000
050300*---------------------------------------------------------------* 05300000
050400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05310000
050500*---------------------------------------------------------------* 05320000
050600         10  ASC-SPECIFIC-COMMAREA.                               05330000
050900             15  ASC-LIST-KEYS.                                   05340000
051000                 20  ASC-KEY-PO-NBR       PIC S9(9) COMP.         05350000
051100                 20  ASC-KEY-DEPT-NBR     PIC X(3).               05360000
W24803                 20  ASC-KEY-MAJ-CL-NBR   PIC 9(4).               05370000
W24803                 20  ASC-KEY-SUB-CL-NBR   PIC 9(4).               05380000
051400                 20  ASC-KEY-STATUS-CDE   PIC X(2).               05390000
051500                 20  ASC-KEY-STATUS-CLS   PIC X(3).               05400000
051600                 20  ASC-KEY-PO-TYP-CDE   PIC X(2).               05410000
051700                 20  ASC-KEY-STR-NBR      PIC S9(04) COMP.        05420000
051800                 20  ASC-KEY-PIC-AD-IND        PIC X(1).          05430000
051900                 20  ASC-KEY-PACK-BY-STORE-IND PIC X(1).          05440000
052000                 20  ASC-KEY-AD-EVNT-DTE  PIC X(10).              05450000
052100                 20  ASC-KEY-OTB-PER-NBR-BEG PIC X(06).           05460000
052200                 20  ASC-KEY-OTB-PER-NBR-END PIC X(06).           05470000
052300                 20  ASC-KEY-DONT-SHIP-BEF-DTE-B                  05480000
052400                                             PIC X(10).           05490000
052500                 20  ASC-KEY-DONT-SHIP-BEF-DTE-E                  05500000
052600                                             PIC X(10).           05510000
052700                 20  ASC-KEY-ENT-NAME-DESC   PIC X(30).           05520000
052800                 20  ASC-KEY-VEND-STYL-NME   PIC X(20).           05530000
052900                 20  ASC-KEY-GROUP-CDE       PIC X(03).           05540000
053000             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           05550000
053100                 20  ASC-BLOCK-MODIFIED-SW                        05560000
053200                                        PIC X(01).                05570000
053300                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     05580000
053400                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     05590000
053500                                                                  05600000
053600                 20  ASC-ITEM-ARRAY.                              05610000
053700                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        05620000
053800                         30  ASC-LIST-ITEM-NUMBER                 05630000
053900                                        PIC S9(09) COMP-3.        05640000
054000                         30  ASC-TEMP-SELECTED-SW                 05650000
054100                                        PIC X(01).                05660000
054200                             88  ASC-VALID-SELECT  VALUE ' '      05670000
054300                                                         'S'      05680000
054400                                                         'B'      05690000
054500                                                         'E'.     05700000
054600                             88  ASC-TEMP-NO-SELECT               05710000
054700                                                   VALUE ' '.     05720000
054800                             88  ASC-TEMP-SELECT   VALUE 'S'.     05730000
054900                             88  ASC-TEMP-BEGIN    VALUE 'B'.     05740000
055000                             88  ASC-TEMP-END      VALUE 'E'.     05750000
055100                         30  ASC-SELECTED-SW                      05760000
055200                                        PIC X(01).                05770000
055300                             88  ASC-NO-SELECT     VALUE ' '.     05780000
055400                             88  ASC-SELECT        VALUE 'S'.     05790000
055500                             88  ASC-BEGIN         VALUE 'B'.     05800000
055600                             88  ASC-END           VALUE 'E'.     05810000
C98147                         30  ASC-PO-NBR            PIC 9(08).     05820056
055800                         30  ASC-GROUP-CDE         PIC X(03).     05830000
055900                         30  ASC-VENDOR-NAME       PIC X(08).     05840000
056000                         30  ASC-SHIP-DATE         PIC X(06).     05850000
056100                         30  ASC-CANCEL-DATE       PIC X(06).     05860000
056200                         30  ASC-DOLLARS-ORDERED   PIC 9(10)V99.  05870000
056300                         30  ASC-DOLLARS-RECEIVED  PIC 9(10)V99.  05880000
056400                         30  ASC-DOLLARS-RCVD-PCT  PIC 9(04).     05890000
056500                         30  ASC-TOT-UNIT-ORDERED  PIC 9(07).     05900000
056600                         30  ASC-TOT-UNIT-RCVD     PIC 9(07).     05910000
056700                         30  ASC-TOT-UNIT-RCVD-PCT PIC 9(04).     05920000
056800                         30  ASC-AD-EVNT-DTE       PIC X(06).     05930000
056900                         30  ASC-IP-IND            PIC X(01).     05940000
057000                                                                  05950000
057100             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     05960000
057200             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     05970000
057300             15  ASC-NUMBER-OF-ITEMS-READ                         05980000
057400                                        PIC S9(09) COMP-3.        05990000
057500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     06000000
057600                                        PIC S9(09) COMP-3.        06010000
057700             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        06020000
057800             15  ASC-ITEM-AT-TOP-OF-PANEL                         06030000
057900                                        PIC S9(09) COMP-3.        06040000
058000             15  ASC-ITEM-AT-BOT-OF-PANEL                         06050000
058100                                        PIC S9(09) COMP-3.        06060000
058200             15  ASC-HIGHEST-BLOCK-WRITTEN                        06070000
058300                                        PIC S9(04) COMP SYNC.     06080000
058400             15  ASC-START-OF-SELECTED-RANGE                      06090000
058500                                        PIC S9(09) COMP-3.        06100000
058600             15  ASC-END-OF-SELECTED-RANGE                        06110000
058700                                        PIC S9(09) COMP-3.        06120000
058800             15  ASC-ITEMS-LEFT-INDICATOR                         06130000
058900                                        PIC X(01).                06140000
059000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     06150000
059100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     06160000
059200             15  ASC-TEMP-QUEUE-UPDATE-SW                         06170000
059300                                        PIC X(01).                06180000
059400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     06190000
059500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     06200000
059600             15  ASC-LIST-QUEUE-NAME.                             06210000
059700                 20  ASC-LIST-TERM-ID   PIC X(04).                06220000
059800                 20  ASC-LIST-TASK-NUMBER                         06230000
059900                                        PIC S9(05) COMP-3.        06240000
060000                 20  ASC-LIST-SEQ       PIC 9(01).                06250000
060100             15  ASC-SEL-QUEUE-NAME.                              06260000
060200                 20  ASC-SEL-TERM-ID    PIC X(04).                06270000
060300                 20  ASC-SEL-TASK-NUMBER                          06280000
060400                                        PIC S9(05) COMP-3.        06290000
060500                 20  ASC-SEL-SEQ        PIC 9(01).                06300000
060600                                                                  06310000
060700             15  ASC-CURSOR-SW          PIC X(01).                06320000
060800                 88  ASC-NO-CURSOR                 VALUE 'Z'.     06330000
060900                 88  ASC-TYPE-CURSOR               VALUE 'S'.     06340000
061000                 88  ASC-LOC-CURSOR                VALUE 'N'.     06350000
061100                 88  ASC-DESC-CURSOR               VALUE 'T'.     06360000
061200             15  ASC-START-ITEM-REQUEST.                          06370000
061300                 20  ASC-START-ITEM-REQUEST-N                     06380000
061400                                        PIC 9(07).                06390000
061500             15  ASC-DISPLAY-SW         PIC X(01).                06400000
061600                 88  ASC-DISPLAY-DOLLAR            VALUE 'D'.     06410000
061700                 88  ASC-DISPLAY-UNITS             VALUE 'U'.     06420000
061800             15  ASC-DOLLAR-ORD-TOT     PIC S9(10)V99.            06430000
061900             15  ASC-DOLLAR-REC-TOT     PIC S9(10)V99.            06440000
062000             15  ASC-UNIT-ORD-TOT       PIC S9(08).               06450000
062100             15  ASC-UNIT-REC-TOT       PIC S9(08).               06460000
C98147         10  FILLER                     PIC X(271).               06470057
062200/                                                                 06480000
062300*---------------------------------------------------------------* 06490000
062400*    ABEND PROCESSING COPYBOOK.                                 * 06500000
062500*---------------------------------------------------------------* 06510000
062600                                                                  06520000
062700     COPY DPWS013.                                                06530000
062800                                                                  06540000
062900/                                                                 06550000
063000*---------------------------------------------------------------* 06560000
063100*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 06570000
063200*---------------------------------------------------------------* 06580000
063300     EXEC SQL                                                     06590000
063400          INCLUDE TPURCHS                                         06600000
063500     END-EXEC.                                                    06610000
063600                                                                  06620000
063700/                                                                 06630000
063800*---------------------------------------------------------------* 06640000
063900*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 06650000
064000*---------------------------------------------------------------* 06660000
064100     EXEC SQL                                                     06670000
064200          INCLUDE TPURITM                                         06680000
064300     END-EXEC.                                                    06690000
064400                                                                  06700000
064500/                                                                 06710000
064600*---------------------------------------------------------------* 06720000
064700*    DB2 AREA FOR THE PLANNED SHIPMENTS TABLE                   * 06730000
064800*---------------------------------------------------------------* 06740000
064900     EXEC SQL                                                     06750000
065000          INCLUDE TPLNSHP                                         06760000
065100     END-EXEC.                                                    06770000
065200                                                                  06780000
065300/                                                                 06790000
065400*---------------------------------------------------------------* 06800000
065500*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 06810000
065600*---------------------------------------------------------------* 06820000
065700     EXEC SQL                                                     06830000
065800          INCLUDE TENTNME                                         06840000
065900     END-EXEC.                                                    06850000
066000                                                                  06860000
066100/                                                                 06870000
067000*---------------------------------------------------------------* 06880000
067100*    DB2 AREA FOR THE STATUS CODE TABLE                         * 06890000
067200*---------------------------------------------------------------* 06900000
067300     EXEC SQL                                                     06910000
067400          INCLUDE TSTATCD                                         06920000
067500     END-EXEC.                                                    06930000
067600                                                                  06940000
067700/                                                                 06950000
067800*---------------------------------------------------------------* 06960000
067900*    DB2 AREA FOR THE TYPE CODE TABLE                           * 06970000
068000*---------------------------------------------------------------* 06980000
068100     EXEC SQL                                                     06990000
068200          INCLUDE TPOTYCD                                         07000000
068300     END-EXEC.                                                    07010000
068400                                                                  07020000
068500/                                                                 07030000
069400*---------------------------------------------------------------* 07040000
069500*    DB2 AREA FOR THE MERCHANDISE AREA TABLE                     *07050000
069600*---------------------------------------------------------------* 07060000
069700                                                                  07070000
069800     EXEC SQL                                                     07080000
069900         INCLUDE TMDSEAR                                          07090000
070000     END-EXEC.                                                    07100000
070100                                                                  07110000
070200/                                                                 07120000
070300*---------------------------------------------------------------* 07130000
070400*    DB2 AREA FOR THE RECEIVING ITEM TABLE                     *  07140000
070500*---------------------------------------------------------------* 07150000
070600                                                                  07160000
070700     EXEC SQL                                                     07170000
070800         INCLUDE TRECITM                                          07180000
070900     END-EXEC.                                                    07190000
071000                                                                  07200000
071100                                                                  07210000
071200/                                                                 07220000
071300*---------------------------------------------------------------* 07230000
071400*    DB2 AREA FOR THE RECEIVING DISTRIBUTION TABLE             *  07240000
071500*---------------------------------------------------------------* 07250000
071600                                                                  07260000
071700     EXEC SQL                                                     07270000
071800         INCLUDE TRECDIS                                          07280000
071900     END-EXEC.                                                    07290000
072000                                                                  07300000
072100/                                                                 07310000
072200*---------------------------------------------------------------* 07320000
072300*    DB2 AREA FOR THE RECEIVING TABLE                          *  07330000
072400*---------------------------------------------------------------* 07340000
072500                                                                  07350000
072600     EXEC SQL                                                     07360000
072700         INCLUDE TRECEIV                                          07370000
072800     END-EXEC.                                                    07380000
072900                                                                  07390000
073000/                                                                 07400000
W24803*---------------------------------------------------------------* 07410000
W24803*    DB2 AREA FOR THE XLT00003 TABLE                            * 07420000
W24803*---------------------------------------------------------------* 07430000
W24803                                                                  07440000
W24803     EXEC SQL                                                     07450000
W24803         INCLUDE XLT00003                                         07460000
W24803     END-EXEC.                                                    07470000
W24803                                                                  07480000
W24803/                                                                 07490000
W24803*---------------------------------------------------------------* 07500000
W24803*    DB2 AREA FOR THE XLT00004 TABLE                            * 07510000
W24803*---------------------------------------------------------------* 07520000
W24803                                                                  07530000
W24803     EXEC SQL                                                     07540000
W24803         INCLUDE XLT00004                                         07550000
W24803     END-EXEC.                                                    07560000
W24803                                                                  07570000
074800*---------------------------------------------------------------* 07580000
074900*    DB2 AREA FOR COMMUNICATIONS                                * 07590000
075000*---------------------------------------------------------------* 07600000
075100     EXEC SQL                                                     07610000
075200          INCLUDE SQLCA                                           07620000
075300     END-EXEC.                                                    07630000
075400                                                                  07640000
075500/                                                                 07650000
075600 LINKAGE SECTION.                                                 07660000
075700                                                                  07670000
075800 01  DFHCOMMAREA.                                                 07680000
075900     05  FILLER                         OCCURS  1 TO 4072 TIMES   07690000
076000                                        DEPENDING ON EIBCALEN.    07700000
076100         10  FILLER                     PIC X.                    07710000
076200                                                                  07720000
076300/                                                                 07730000
076400 PROCEDURE DIVISION.                                              07740000
076500*---------------------------------------------------------------* 07750000
076600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07760000
076700*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07770000
076800*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07780000
076900*---------------------------------------------------------------* 07790000
077000 0000-MAIN-MODULE.                                                07800000
077100                                                                  07810000
077200     INITIALIZE DP030-CICS-API-FIELDS.                            07820000
077300                                                                  07830000
077400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07840000
077500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07850000
077600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07860000
077700                                                                  07870000
077800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07880000
077900                                                                  07890000
078000     MOVE LENGTH OF PO105AI        TO DP030-MAP-LENGTH (1).       07900000
078100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07910000
078200                                                                  07920000
078300     PERFORM 0001-CALL-CICS-ARCH-API.                             07930000
078400     PERFORM 1000-CONTROL-PROCESSING                              07940000
078500                                                                  07950000
078600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07960000
078700     PERFORM 0001-CALL-CICS-ARCH-API.                             07970000
078800                                                                  07980000
078900*---------------------------------------------------------------* 07990000
079000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 08000000
079100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 08010000
079200*---------------------------------------------------------------* 08020000
079300 0001-CALL-CICS-ARCH-API.                                         08030000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08040064
079500                                    DFHCOMMAREA                   08050064
079600                                    DP030-CICS-API-FIELDS         08060064
079700                                    DP020-STANDARD-COMMAREA       08070064
079800                                    PO105AI.                      08080064
079900                                                                  08090000
080000     IF  DP030-RC-CALL-SUCCESSFUL                                 08100000
080100         CONTINUE                                                 08110000
080200     ELSE                                                         08120000
080300         SET DP013-NO-ROLLBACK                                    08130000
080400             DP013-XCTL-DISPLAY-RESTART                           08140000
080500             DP013-CICS-ABEND      TO TRUE                        08150000
080600         MOVE '0001-CALL-CICS-ARCH-API'                           08160000
080700                                   TO DP013-PARAGRAPH             08170000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O08180064
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      08190064
081000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      08200000
081100         PERFORM DP013-0000-PROCESS-ABEND                         08210000
081200     END-IF.                                                      08220000
081300                                                                  08230000
081400*----------------------------------------------------------------*08240000
081500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *08250000
081600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *08260000
081700*                                                                *08270000
081800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *08280000
081900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *08290000
082000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *08300000
082100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *08310000
082200*----------------------------------------------------------------*08320000
082300                                                                  08330000
082400 1000-CONTROL-PROCESSING.                                         08340000
082500                                                                  08350000
082600     EVALUATE TRUE                                                08360000
082700         WHEN DP020-NEXT-ACT-INITIAL                              08370000
082800             INITIALIZE ASC-SPECIFIC-COMMAREA                     08380000
082900                                                                  08390000
083000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            08400000
083100                                      ASC-SEL-TERM-ID             08410000
083200             MOVE DP020-SRC-TASK-NUMBER                           08420000
083300                                   TO ASC-LIST-TASK-NUMBER        08430000
083400                                      ASC-SEL-TASK-NUMBER         08440000
083500             MOVE PC-LIST-QUEUE-SEQ                               08450000
083600                                   TO ASC-LIST-SEQ                08460000
083700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 08470000
083800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08480000
083900             IF  PS-COMMAREA-NOT-VALID                            08490000
084000                 SET DP020-NEXT-ACT-APPL-ERROR                    08500000
084100                                   TO TRUE                        08510000
084200             ELSE                                                 08520000
084300                 PERFORM 4000-BUILD-INITIAL-PANEL                 08530000
084400             END-IF                                               08540000
084500                                                                  08550000
084600         WHEN DP020-NEXT-ACT-READ-MAP                             08560000
084700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08570000
084800                                   TO PV-TOP-ITEM                 08580000
084900             PERFORM 2000-PROCESS-PANEL                           08590000
085000                                                                  08600000
085100         WHEN DP020-NEXT-ACT-RETURN                               08610000
085200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08620000
085300                                   TO PV-TOP-ITEM                 08630000
085400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08640000
085500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 08650000
085600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08660000
085700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08670000
085800                                                                  08680000
085900         WHEN OTHER                                               08690000
086000             SET DP013-LOGIC-ABEND TO TRUE                        08700000
086100             SET DP013-NO-ROLLBACK TO TRUE                        08710000
086200             MOVE '1000-CONTROL-PROCESSING'                       08720000
086300                                   TO DP013-PARAGRAPH             08730000
086400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08740000
086500                                   TO DP013-MESSAGE-TEXT(1)       08750000
086600             PERFORM DP013-0000-PROCESS-ABEND                     08760000
086700     END-EVALUATE.                                                08770000
086800                                                                  08780000
086900/                                                                 08790000
087000*----------------------------------------------------------------*08800000
087100* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *08810000
087200*----------------------------------------------------------------*08820000
087300                                                                  08830000
087400 1100-PROCESS-INTER-APPL-COMM.                                    08840000
087500                                                                  08850000
087600     SET PS-COMMAREA-VALID         TO TRUE.                       08860000
087700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08870000
087800                                                                  08880000
087900     IF  PO017-PO-NBR > ZEROES                                    08890000
088000         MOVE PC-TSYMSG-00621                                     08900000
088100                                   TO DP020-MSG-NUMBER            08910000
088200         SET PS-ERROR                                             08920000
088300             PS-COMMAREA-NOT-VALID                                08930000
088400             DP020-MSG-FATAL                                      08940000
088500                                   TO TRUE                        08950000
088600     ELSE                                                         08960000
088700         IF  PO017-DEPT-NBR > SPACES                              08970000
088800             INITIALIZE PV-DB2-COUNT                              08980000
088900             PERFORM 1110-VALIDATE-DEPT                           08990000
089000             IF  PV-DB2-COUNT = +0                                09000000
089100                 MOVE PC-TSYMSG-00588                             09010000
089200                                   TO DP020-MSG-NUMBER            09020000
089300                  SET PS-ERROR                                    09030000
089400                      PS-COMMAREA-NOT-VALID                       09040000
089500                      DP020-MSG-FATAL                             09050000
089600                                   TO TRUE                        09060000
089700             END-IF                                               09070000
089800         ELSE                                                     09080000
089900             MOVE PC-TSYMSG-00620                                 09090000
090000                                   TO DP020-MSG-NUMBER            09100000
090100             SET PS-ERROR                                         09110000
090200                 PS-COMMAREA-NOT-VALID                            09120000
090300                 DP020-MSG-FATAL                                  09130000
090400                                   TO TRUE                        09140000
090500         END-IF                                                   09150000
090600                                                                  09160000
W24803         IF  PS-NO-ERROR                                          09170000
W24803           IF PO017-GROUP-CODE > SPACES                           09180050
090800             PERFORM 1150-VALIDATE-GROUP-CODE                     09190050
W24803             IF  PV-DB2-COUNT = +0                                09200050
W24803               MOVE PC-TSYMSG-01853 TO DP020-MSG-NUMBER           09210050
W24803               SET PS-ERROR                                       09220050
W24803                   PS-COMMAREA-NOT-VALID                          09230050
W24803                   DP020-MSG-FATAL  TO TRUE                       09240050
W24803             END-IF                                               09250050
091300           ELSE                                                   09260050
091400             MOVE PC-TSYMSG-01853                                 09270050
091500                                   TO DP020-MSG-NUMBER            09280000
091600             SET PS-ERROR                                         09290000
091700                 PS-COMMAREA-NOT-VALID                            09300000
091800                 DP020-MSG-FATAL                                  09310000
091900                                   TO TRUE                        09320000
092000                 SET PS-ERROR                                     09330000
092100                 PS-COMMAREA-NOT-VALID                            09340000
092200                 DP020-MSG-FATAL                                  09350000
092300                                   TO TRUE                        09360000
W24803           END-IF                                                 09370050
092400         END-IF                                                   09380000
092500                                                                  09390000
092600                                                                  09400000
092700         IF  PS-NO-ERROR                                          09410000
092800         AND PO017-STATUS-CDE   > SPACES                          09420000
092900             INITIALIZE PV-DB2-COUNT                              09430000
093000             MOVE PO017-STATUS-CDE                                09440000
093100                                 TO STATCD-STATUS-CDE             09450000
093200             PERFORM 1130-VALIDATE-STATUS-CODE                    09460000
093300             IF  PV-DB2-COUNT = +0                                09470000
093400                 MOVE PC-TSYMSG-00168                             09480000
093500                                 TO DP020-MSG-NUMBER              09490000
093600                  SET PS-ERROR                                    09500000
093700                      PS-COMMAREA-NOT-VALID                       09510000
093800                      DP020-MSG-FATAL                             09520000
093900                                 TO TRUE                          09530000
094000             END-IF                                               09540000
094100         END-IF                                                   09550000
094200                                                                  09560000
094300         IF  PS-NO-ERROR                                          09570000
094400         AND PO017-PO-TYP-CDE > SPACES                            09580000
094500             INITIALIZE PV-DB2-COUNT                              09590000
094600             PERFORM 1140-VALIDATE-PO-TYPE-CODE                   09600000
094700             IF  PV-DB2-COUNT = +0                                09610000
094800                 MOVE PC-TSYMSG-00587                             09620000
094900                                 TO DP020-MSG-NUMBER              09630000
095000                  SET PS-ERROR                                    09640000
095100                      PS-COMMAREA-NOT-VALID                       09650000
095200                      DP020-MSG-FATAL                             09660000
095300                                 TO TRUE                          09670000
095400             END-IF                                               09680000
095500         END-IF                                                   09690000
W24803         IF PS-NO-ERROR                                           09700000
W24803            AND PO017-MAJ-CL-NBR > ZERO                           09710000
W24803           IF PO017-MAJ-CL-NBR (3:1) > ZERO                       09720000
W24803              MOVE PO017-MAJ-CL-NBR                               09730000
W24803                                 TO PV-MAJ-CLASS                  09740000
W24803           ELSE                                                   09750000
W24803             IF PO017-MAJ-CL-NBR (4:1) > ZERO                     09760000
W24803               MOVE PO017-MAJ-CL-NBR(4:1)                         09770000
W24803                                 TO PV-MAJ-CL-3                   09780000
W24803             END-IF                                               09790000
W24803           END-IF                                                 09800000
W24803           PERFORM 1170-VALIDATE-MAJCL                            09810000
W24803           IF PV-DB2-COUNT = 0                                    09820000
W24803             MOVE PC-TSYMSG-03070 TO DP020-MSG-NUMBER             09830000
W24803                                                                  09840000
W24803             SET PS-ERROR                                         09850000
W24803                 PS-COMMAREA-NOT-VALID                            09860000
W24803                 DP020-MSG-FATAL TO TRUE                          09870000
W24803           END-IF                                                 09880000
W24803         END-IF                                                   09890000
W24803*                                                                 09900000
W24803         IF  PS-NO-ERROR                                          09910000
W24803           AND PO017-CL-NBR > SPACES                              09920000
W24803           IF PO017-CL-NBR (1:1) IS NUMERIC AND                   09930000
W24803                 PO017-CL-NBR (2:1) IS NUMERIC                    09940000
W24803             IF PO017-MAJ-CL-NBR > ZERO                           09950000
W24803               IF PO017-MAJ-CL-NBR (3:1) > ZERO                   09960000
W24803                  MOVE PO017-MAJ-CL-NBR                           09970000
W24803                                 TO PV-MAJ-CLASS                  09980000
W24803               ELSE                                               09990000
W24803                 IF PO017-MAJ-CL-NBR (4:1) > ZERO                 10000000
W24803                     MOVE PO017-MAJ-CL-NBR(4:1)                   10010000
W24803                                 TO PV-MAJ-CL-3                   10020000
W24803                 END-IF                                           10030000
W24803               END-IF                                             10040000
W24803               PERFORM 1160-VALIDATE-MAJCL-SUBCL                  10050000
W24803               IF PV-DB2-COUNT = 0                                10060000
W24803                 MOVE PC-TSYMSG-03073 TO DP020-MSG-NUMBER         10070000
W24803                                                                  10080000
W24803                  SET PS-ERROR                                    10090000
W24803                      PS-COMMAREA-NOT-VALID                       10100000
W24803                      DP020-MSG-FATAL TO TRUE                     10110000
W24803               END-IF                                             10120000
W24803             ELSE                                                 10130000
W24803               MOVE PC-TSYMSG-03070   TO DP020-MSG-NUMBER         10140000
W24803                                                                  10150000
W24803               SET PS-ERROR                                       10160000
W24803                   PS-COMMAREA-NOT-VALID                          10170000
W24803                   DP020-MSG-FATAL TO TRUE                        10180000
W24803             END-IF                                               10190000
W24803           ELSE                                                   10200000
W24803             MOVE PC-TSYMSG-03069  TO DP020-MSG-NUMBER            10210000
W24803             SET PS-ERROR                                         10220000
W24803                 PS-COMMAREA-NOT-VALID                            10230000
W24803                 DP020-MSG-FATAL TO TRUE                          10240000
W24803           END-IF                                                 10250000
W24803         END-IF                                                   10260000
095600     END-IF.                                                      10270000
095700                                                                  10280000
095800     IF  PS-NO-ERROR                                              10290000
095900         MOVE PO017-PO-NBR         TO ASC-KEY-PO-NBR              10300000
096000         MOVE PO017-DEPT-NBR       TO ASC-KEY-DEPT-NBR            10310000
096100         MOVE PO017-PO-TYP-CDE     TO ASC-KEY-PO-TYP-CDE          10320000
096200         MOVE PO017-STATUS-CDE     TO ASC-KEY-STATUS-CDE          10330000
096300         MOVE PO017-STATUS-GRP     TO ASC-KEY-STATUS-CLS          10340000
096400         MOVE PO017-PIC-AD-IND     TO ASC-KEY-PIC-AD-IND          10350000
W24803         IF PO017-MAJ-CL-NBR > 0                                  10360000
W24803             IF PO017-MAJ-CL-NBR (3:1) > ZERO                     10370000
W24803                MOVE PO017-MAJ-CL-NBR                             10380000
W24803                                   TO PV-MAJ-CLASS                10390000
W24803             ELSE                                                 10400000
W24803                IF PO017-MAJ-CL-NBR (4:1) > ZERO                  10410000
W24803                    MOVE PO017-MAJ-CL-NBR(4:1)                    10420000
W24803                                   TO PV-MAJ-CL-3                 10430000
W24803                END-IF                                            10440000
W24803             END-IF                                               10450000
W24803                MOVE PV-MAJ-CL     TO ASC-KEY-MAJ-CL-NBR          10460000
W24803         ELSE                                                     10470000
W24803             MOVE ZEROS            TO ASC-KEY-MAJ-CL-NBR          10480000
W24803         END-IF                                                   10490000
W24803         IF PO017-CL-NBR > SPACES                                 10500000
W24803             MOVE PO017-CL-NBR     TO ASC-KEY-SUB-CL-NBR          10510000
W24803             MOVE PV-SUB-CLASS     TO ASC-KEY-SUB-CL-NBR          10520000
W24803         ELSE                                                     10530000
W24803             MOVE ZEROS            TO ASC-KEY-SUB-CL-NBR          10540000
W24803         END-IF                                                   10550000
096700         MOVE PO017-STR-NBR        TO ASC-KEY-STR-NBR             10560000
096800         MOVE PO017-AD-EVNT-DTE-ISO                               10570000
096900                                   TO ASC-KEY-AD-EVNT-DTE         10580000
097000         MOVE PO017-VEND-STYL-NME  TO ASC-KEY-VEND-STYL-NME       10590000
097100         MOVE PO017-ENT-NAME-DESC  TO ASC-KEY-ENT-NAME-DESC       10600000
097200         MOVE PO017-PACK-BY-STORE-IND                             10610000
097300                                   TO ASC-KEY-PACK-BY-STORE-IND   10620000
097400         MOVE PO017-GROUP-CODE     TO ASC-KEY-GROUP-CDE           10630000
097500         IF  PO017-OTB-PER-NBR-BEG > SPACES                       10640000
097600         AND PO017-OTB-PER-NBR-END = SPACES                       10650000
097700             MOVE PO017-OTB-PER-NBR-BEG                           10660000
097800                                   TO PO017-OTB-PER-NBR-END       10670000
097900         END-IF                                                   10680000
098000         IF  PO017-OTB-PER-NBR-END > SPACES                       10690000
098100         AND PO017-OTB-PER-NBR-BEG = SPACES                       10700000
098200             MOVE PO017-OTB-PER-NBR-END                           10710000
098300                                   TO PO017-OTB-PER-NBR-BEG       10720000
098400         END-IF                                                   10730000
098500         IF PO017-OTB-PER-NBR-BEG(1:2) > SPACES                   10740000
098600            IF PO017-OTB-PER-NBR-BEG(1:2) > 80                    10750000
098700               MOVE '19' TO PV-HOLD-CC                            10760000
098800            ELSE                                                  10770000
098900               MOVE '20' TO PV-HOLD-CC                            10780000
099000            END-IF                                                10790000
099100         END-IF                                                   10800000
099200              STRING PV-HOLD-CC DELIMITED BY SIZE                 10810000
099300                     PO017-OTB-PER-NBR-BEG DELIMITED BY SIZE      10820000
099400                     INTO ASC-KEY-OTB-PER-NBR-BEG                 10830000
099500         IF PO017-OTB-PER-NBR-END(1:2) > SPACES                   10840000
099600            IF PO017-OTB-PER-NBR-END(1:2) > 80                    10850000
099700               MOVE '19' TO PV-HOLD-CC                            10860000
099800            ELSE                                                  10870000
099900               MOVE '20' TO PV-HOLD-CC                            10880000
100000            END-IF                                                10890000
100100         END-IF                                                   10900000
100200              STRING PV-HOLD-CC DELIMITED BY SIZE                 10910000
100300                     PO017-OTB-PER-NBR-END DELIMITED BY SIZE      10920000
100400                     INTO ASC-KEY-OTB-PER-NBR-END                 10930000
100500         IF  PO017-DONT-SHIP-BEF-DTE-B-ISO > SPACES               10940000
100600         AND PO017-DONT-SHIP-BEF-DTE-E-ISO = SPACES               10950000
100700             MOVE PO017-DONT-SHIP-BEF-DTE-B-ISO                   10960000
100800                                 TO PO017-DONT-SHIP-BEF-DTE-E-ISO 10970000
100900         END-IF                                                   10980000
101000         IF  PO017-DONT-SHIP-BEF-DTE-E-ISO > SPACES               10990000
101100         AND PO017-DONT-SHIP-BEF-DTE-B-ISO = SPACES               11000000
101200             MOVE PO017-DONT-SHIP-BEF-DTE-E-ISO                   11010000
101300                                 TO PO017-DONT-SHIP-BEF-DTE-B-ISO 11020000
101400         END-IF                                                   11030000
101500         MOVE PO017-DONT-SHIP-BEF-DTE-B-ISO                       11040000
101600                                 TO ASC-KEY-DONT-SHIP-BEF-DTE-B   11050000
101700         MOVE PO017-DONT-SHIP-BEF-DTE-E-ISO                       11060000
101800                                 TO ASC-KEY-DONT-SHIP-BEF-DTE-E   11070000
101900     END-IF.                                                      11080000
102000                                                                  11090000
102100/                                                                 11100000
102200 1110-VALIDATE-DEPT.                                              11110000
102300                                                                  11120000
102400     PERFORM                                                      11130000
102500         WITH TEST AFTER                                          11140000
102600         VARYING PV-RETRY-COUNTER                                 11150000
102700         FROM 1 BY 1                                              11160000
102800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11170000
102900             OR (SQLCODE = +0)                                    11180000
103000             OR (SQLCODE = +100))                                 11190000
103100                                                                  11200000
103200         EXEC SQL                                                 11210000
103300              SELECT COUNT(*)                                     11220000
103400                INTO :PV-DB2-COUNT                                11230000
103500                FROM TMDSEAR                                      11240000
103600               WHERE DEPT_NBR   = :PO017-DEPT-NBR                 11250000
103700                 AND OPERCO_NBR = '03'                            11260000
103800                 AND MDSELV_CDE = 'DPT'                           11270000
103900                 AND STRT_DTE  <= CURRENT DATE                    11280000
104000                 AND END_DTE   >= CURRENT DATE                    11290000
104100         END-EXEC                                                 11300000
104200                                                                  11310000
104300         EVALUATE TRUE                                            11320000
104400             WHEN SQLCODE = +0                                    11330000
104500             WHEN SQLCODE = +100                                  11340000
104600             WHEN SQLCODE = -904                                  11350000
104700             WHEN SQLCODE = -913                                  11360000
104800                  CONTINUE                                        11370000
104900                                                                  11380000
105000             WHEN SQLWARN0 NOT = SPACES                           11390000
105100             WHEN SQLCODE < +0                                    11400000
105200             WHEN SQLCODE > +0                                    11410000
105300                  MOVE '1110-VALIDATE-DEPT'                       11420000
105400                                  TO DP013-PARAGRAPH              11430000
105500                  MOVE 'UNSUCCESSFUL COUNT ON DEPARTMENT'         11440000
105600                                  TO DP013-MESSAGE-TEXT (1)       11450000
105700                  MOVE SQLCA      TO DP013-SQLCA                  11460000
105800                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     11470000
105900                  SET DP013-DB2-ABEND                             11480000
106000                      DP013-XCTL-DISPLAY-RESTART                  11490000
106100                                  TO TRUE                         11500000
106200                  PERFORM DP013-0000-PROCESS-ABEND                11510000
106300         END-EVALUATE                                             11520000
106400     END-PERFORM.                                                 11530000
106500                                                                  11540000
106600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11550000
106700         MOVE '1110-VALIDATE-DEPT'                                11560000
106800                                  TO DP013-PARAGRAPH              11570000
106900         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TMDSEAR'          11580000
107000                                  TO DP013-MESSAGE-TEXT (1)       11590000
107100         MOVE SQLCA               TO DP013-SQLCA                  11600000
107200         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     11610000
107300         SET DP013-DB2-ABEND                                      11620000
107400             DP013-XCTL-DISPLAY-RESTART                           11630000
107500                                  TO TRUE                         11640000
107600         PERFORM DP013-0000-PROCESS-ABEND                         11650000
107700     END-IF.                                                      11660000
107800                                                                  11670000
107900/                                                                 11680000
108000                                                                  11690000
108100/                                                                 11700000
108200 1130-VALIDATE-STATUS-CODE.                                       11710000
108300                                                                  11720000
108400     PERFORM                                                      11730000
108500         WITH TEST AFTER                                          11740000
108600         VARYING PV-RETRY-COUNTER                                 11750000
108700         FROM 1 BY 1                                              11760000
108800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11770000
108900             OR (SQLCODE = +0)                                    11780000
109000             OR (SQLCODE = +100))                                 11790000
109100                                                                  11800000
109200         EXEC SQL                                                 11810000
109300              SELECT COUNT(*)                                     11820000
109400                INTO :PV-DB2-COUNT                                11830000
109500                FROM TSTATCD                                      11840000
109600               WHERE STATUS_TYP_CDE = 'P'                         11850000
109700                 AND STATUS_CDE     = :STATCD-STATUS-CDE          11860000
109800         END-EXEC                                                 11870000
109900                                                                  11880000
110000         EVALUATE TRUE                                            11890000
110100             WHEN SQLCODE = +0                                    11900000
110200             WHEN SQLCODE = +100                                  11910000
110300             WHEN SQLCODE = -904                                  11920000
110400             WHEN SQLCODE = -913                                  11930000
110500                  CONTINUE                                        11940000
110600                                                                  11950000
110700             WHEN SQLWARN0 NOT = SPACES                           11960000
110800             WHEN SQLCODE < +0                                    11970000
110900             WHEN SQLCODE > +0                                    11980000
111000                  MOVE '1130-VALIDATE-STATUS-CODE'                11990000
111100                                  TO DP013-PARAGRAPH              12000000
111200                  MOVE 'UNSUCCESSFUL COUNT ON STATUS CODE'        12010000
111300                                  TO DP013-MESSAGE-TEXT (1)       12020000
111400                  MOVE SQLCA      TO DP013-SQLCA                  12030000
111500                  MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)     12040000
111600                  SET DP013-DB2-ABEND                             12050000
111700                      DP013-XCTL-DISPLAY-RESTART                  12060000
111800                                  TO TRUE                         12070000
111900                  PERFORM DP013-0000-PROCESS-ABEND                12080000
112000         END-EVALUATE                                             12090000
112100     END-PERFORM.                                                 12100000
112200                                                                  12110000
112300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12120000
112400         MOVE '1130-VALIDATE-STATUS-CODE'                         12130000
112500                                  TO DP013-PARAGRAPH              12140000
112600         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TSTATCD'          12150000
112700                                  TO DP013-MESSAGE-TEXT (1)       12160000
112800         MOVE SQLCA               TO DP013-SQLCA                  12170000
112900         MOVE 'TSTATCD '          TO DP013-DB2-TABLE-NAME (1)     12180000
113000         SET DP013-DB2-ABEND                                      12190000
113100             DP013-XCTL-DISPLAY-RESTART                           12200000
113200                                  TO TRUE                         12210000
113300         PERFORM DP013-0000-PROCESS-ABEND                         12220000
113400     END-IF.                                                      12230000
113500                                                                  12240000
113600/                                                                 12250000
113700 1140-VALIDATE-PO-TYPE-CODE.                                      12260000
113800                                                                  12270000
113900     PERFORM                                                      12280000
114000         WITH TEST AFTER                                          12290000
114100         VARYING PV-RETRY-COUNTER                                 12300000
114200         FROM 1 BY 1                                              12310000
114300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12320000
114400             OR (SQLCODE = +0)                                    12330000
114500             OR (SQLCODE = +100))                                 12340000
114600                                                                  12350000
114700         EXEC SQL                                                 12360000
114800              SELECT COUNT(*)                                     12370000
114900                INTO :PV-DB2-COUNT                                12380000
115000                FROM TPOTYCD                                      12390000
115100               WHERE PO_VARIETY_CDE = 'T'                         12400000
115200                 AND PO_TYP_CDE     = :PO017-PO-TYP-CDE           12410000
115300         END-EXEC                                                 12420000
115400                                                                  12430000
115500         EVALUATE TRUE                                            12440000
115600             WHEN SQLCODE = +0                                    12450000
115700             WHEN SQLCODE = +100                                  12460000
115800             WHEN SQLCODE = -904                                  12470000
115900             WHEN SQLCODE = -913                                  12480000
116000                  CONTINUE                                        12490000
116100                                                                  12500000
116200             WHEN SQLWARN0 NOT = SPACES                           12510000
116300             WHEN SQLCODE < +0                                    12520000
116400             WHEN SQLCODE > +0                                    12530000
116500                  MOVE '1140-VALIDATE-PO-TYPE-CODE'               12540000
116600                                  TO DP013-PARAGRAPH              12550000
116700                  MOVE 'UNSUCCESSFUL COUNT ON TYPE CODE'          12560000
116800                                  TO DP013-MESSAGE-TEXT (1)       12570000
116900                  MOVE SQLCA      TO DP013-SQLCA                  12580000
117000                  MOVE 'TPOTYCD ' TO DP013-DB2-TABLE-NAME (1)     12590000
117100                  SET DP013-DB2-ABEND                             12600000
117200                      DP013-XCTL-DISPLAY-RESTART                  12610000
117300                                  TO TRUE                         12620000
117400                  PERFORM DP013-0000-PROCESS-ABEND                12630000
117500         END-EVALUATE                                             12640000
117600     END-PERFORM.                                                 12650000
117700                                                                  12660000
117800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12670000
117900         MOVE '1140-VALIDATE-PO-TYPE-CODE'                        12680000
118000                                  TO DP013-PARAGRAPH              12690000
118100         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TPOTYCD'          12700000
118200                                  TO DP013-MESSAGE-TEXT (1)       12710000
118300         MOVE SQLCA               TO DP013-SQLCA                  12720000
118400         MOVE 'TPOTYCD '          TO DP013-DB2-TABLE-NAME (1)     12730000
118500         SET DP013-DB2-ABEND                                      12740000
118600             DP013-XCTL-DISPLAY-RESTART                           12750000
118700                                  TO TRUE                         12760000
118800         PERFORM DP013-0000-PROCESS-ABEND                         12770000
118900     END-IF.                                                      12780000
119000                                                                  12790000
119100/                                                                 12800000
119200 1150-VALIDATE-GROUP-CODE.                                        12810000
119300                                                                  12820000
W24803     MOVE PO017-GROUP-CODE TO XLT00003-GP-CDE                     12830000
W24803     MOVE PO017-DEPT-NBR   TO PV-DEPT-NBR                         12840000
W24803     MOVE PV-DEPT-NBR      TO XLT00004-DEPT-NBR                   12850000
W24803     IF PO017-MAJ-CL-NBR > '0000'                                 12860000
W24803       IF PO017-MAJ-CL-NBR (3:1) > 0                              12870000
W24803         MOVE PO017-MAJ-CL-NBR (3:1) TO PV-MAJ-CL-3               12880000
W24803         MOVE PV-MAJ-CLASS           TO XLT00004-MAJ-CL-NBR       12890000
W24803       ELSE                                                       12900000
W24803         IF PO017-MAJ-CL-NBR (4:1) > 0                            12910000
W24803           MOVE PO017-MAJ-CL-NBR (4:1)                            12920000
W24803                                     TO PV-MAJ-CL-3               12930000
W24803           MOVE PV-MAJ-CLASS         TO PV-MAJ-CLASS-BEG          12940000
W24803                                        PV-MAJ-CLASS-END          12950000
W24803         END-IF                                                   12960000
W24803       END-IF                                                     12970000
W24803     ELSE                                                         12980000
W24803       MOVE +0                       TO PV-MAJ-CLASS-BEG          12990000
W24803       MOVE 9999                     TO PV-MAJ-CLASS-END          13000000
W24803     END-IF.                                                      13010000
W24803                                                                  13020000
W24803     MOVE +0                         TO PV-SUB-CLASS-BEG          13030000
W24803     MOVE 9999                       TO PV-SUB-CLASS-END          13040000
W24803     IF PO017-CL-NBR > '00'                                       13050000
W24803       IF PO017-CL-NBR (1:1) IS NUMERIC                           13060000
W24803          AND PO017-CL-NBR (2:1) IS NUMERIC                       13070000
W24803         MOVE PO017-CL-NBR           TO PV-SUB-CL-3-4             13080000
W24803         MOVE PV-SUB-CLASS           TO PV-SUB-CLASS-BEG          13090000
W24803                                        PV-SUB-CLASS-END          13100000
W24803       END-IF                                                     13110000
W24803     END-IF.                                                      13120000
W24803                                                                  13130000
119400     PERFORM                                                      13140000
119500         WITH TEST AFTER                                          13150000
119600         VARYING PV-RETRY-COUNTER                                 13160000
119700         FROM 1 BY 1                                              13170000
119800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13180000
119900             OR (SQLCODE = +0)                                    13190000
120000             OR (SQLCODE = + 100))                                13200000
120100         EXEC SQL                                                 13210000
120200              SELECT COUNT(*)                                     13220000
120300              INTO  :PV-DB2-COUNT                                 13230000
W24803                FROM XLT_SKU S,                                   13240000
W24803                     XLT_VND_STYL V                               13250000
W24803              WHERE GP_CDE       = :XLT00003-GP-CDE               13260000
W24803                AND  S.STYL_ID  = V.STYL_ID                       13270000
W24803                AND  DEPT_NBR   = :XLT00004-DEPT-NBR              13280000
W24803                AND  MAJ_CL_NBR BETWEEN :PV-MAJ-CLASS-BEG         13290000
W24803                                    AND :PV-MAJ-CLASS-END         13300000
W24803                AND  SUB_CL_NBR BETWEEN :PV-SUB-CLASS-BEG         13310000
W24803                                    AND :PV-SUB-CLASS-END         13320000
120700         END-EXEC                                                 13330000
120800                                                                  13340000
120900         EVALUATE TRUE                                            13350000
121000             WHEN SQLCODE = +0                                    13360000
121100             WHEN SQLCODE = -811                                  13370000
121200                        CONTINUE                                  13380000
121300             WHEN SQLWARN0 NOT = SPACES                           13390000
121400             WHEN SQLCODE < +0                                    13400000
121500             WHEN SQLCODE > +0                                    13410000
121600             WHEN SQLCODE = +100                                  13420000
121700                  MOVE '1150-VALIDATE-GROUP-CODE'                 13430000
121800                                  TO DP013-PARAGRAPH              13440000
121900                  MOVE 'NO MATCH FOUND'                           13450000
122000                                  TO DP013-MESSAGE-TEXT(1)        13460000
122100                  MOVE SQLCA      TO DP013-SQLCA                  13470000
W24803                  MOVE 'XLT_SKU ' TO DP013-DB2-TABLE-NAME(1)      13480000
W24803                  MOVE 'XLT_VND_STYL '                            13490000
W24803                                  TO DP013-DB2-TABLE-NAME(2)      13500000
122300                  SET DP013-DB2-ABEND                             13510000
122400                      DP013-XCTL-DISPLAY-RESTART                  13520000
122500                                  TO TRUE                         13530000
122600                  PERFORM DP013-0000-PROCESS-ABEND                13540000
122700         END-EVALUATE                                             13550000
122800     END-PERFORM.                                                 13560000
122900                                                                  13570000
123000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13580000
123100         MOVE '1150-VALIDATE-GROUP-CODE'                          13590000
123200                                  TO DP013-PARAGRAPH              13600000
123300         MOVE 'MAX RETRIES EXCEEDED ON TSK'                       13610000
123400                                  TO DP013-MESSAGE-TEXT (1)       13620000
123500         MOVE SQLCA               TO DP013-SQLCA                  13630000
W24803         MOVE 'XLT_SKU '          TO DP013-DB2-TABLE-NAME (1)     13640000
W24803         MOVE 'XLT_VND_STYL '                                     13650000
W24803                                  TO DP013-DB2-TABLE-NAME (2)     13660000
123700         SET  DP013-DB2-ABEND                                     13670000
123800              DP013-XCTL-DISPLAY-RESTART                          13680000
123900                                  TO TRUE                         13690000
124000         PERFORM DP013-0000-PROCESS-ABEND                         13700000
124100     END-IF.                                                      13710000
W24803                                                                  13720000
W24803 1160-VALIDATE-MAJCL-SUBCL.                                       13730000
W24803     MOVE 0             TO PV-DB2-COUNT                           13740000
W24803     MOVE PV-MAJ-CLASS  TO XLT00004-MAJ-CL-NBR                    13750000
W24803     MOVE PO017-CL-NBR  TO PV-SUB-CL-3-4                          13760000
W24803     MOVE PV-SUB-CLASS  TO XLT00004-SUB-CL-NBR                    13770000
W24803                                                                  13780000
W24803     PERFORM                                                      13790000
W24803        WITH TEST AFTER                                           13800000
W24803        VARYING PV-RETRY-COUNTER                                  13810000
W24803        FROM 1 BY 1                                               13820000
W24803        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                13830000
W24803              OR (SQLCODE = +0)                                   13840000
W24803              OR (SQLCODE = +100))                                13850000
W24803                                                                  13860000
W24803        EXEC SQL                                                  13870000
W24803            SELECT COUNT(*)                                       13880000
W24803              INTO :PV-DB2-COUNT                                  13890000
W24803            FROM  XLT_VND_STYL V                                  13900000
W24803              WHERE MAJ_CL_NBR     = :XLT00004-MAJ-CL-NBR         13910000
W24803                    AND SUB_CL_NBR = :XLT00004-SUB-CL-NBR         13920000
W24803        END-EXEC                                                  13930000
W24803                                                                  13940000
W24803        EVALUATE TRUE                                             13950000
W24803            WHEN SQLCODE = +0                                     13960000
W24803            WHEN SQLCODE = +100                                   13970000
W24803            WHEN SQLCODE = -904                                   13980000
W24803            WHEN SQLCODE = -913                                   13990000
W24803                 CONTINUE                                         14000000
W24803            WHEN SQLWARN0 NOT = SPACES                            14010000
W24803            WHEN SQLCODE < +0                                     14020000
W24803            WHEN SQLCODE > +0                                     14030000
W24803               MOVE '1160-VALIDATE-MAJCL-SUBCL'                   14040000
W24803                                TO DP013-PARAGRAPH                14050000
W24803             MOVE 'UNSUCCESSFUL COUNT ON MAJ CLASS  AND SUB CLASS'14060000
W24803                                TO DP013-MESSAGE-TEXT (1)         14070000
W24803               MOVE SQLCA       TO DP013-SQLCA                    14080000
W24803               MOVE 'XLV_VND_STYL ' TO DP013-DB2-TABLE-NAME (1)   14090000
W24803               SET DP013-DB2-ABEND                                14100000
W24803                   DP013-XCTL-DISPLAY-RESTART                     14110000
W24803                                TO TRUE                           14120000
W24803               PERFORM DP013-0000-PROCESS-ABEND                   14130000
W24803         END-EVALUATE                                             14140000
W24803      END-PERFORM.                                                14150000
W24803                                                                  14160000
W24803      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       14170000
W24803           MOVE '1160-VALIDATE-MAJCL-SUBCL'                       14180000
W24803                      TO DP013-PARAGRAPH                          14190000
W24803           MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XLT_VND_STYL'   14200000
W24803                      TO DP013-MESSAGE-TEXT (1)                   14210000
W24803           MOVE SQLCA TO DP013-SQLCA                              14220000
W24803           MOVE 'XLV_VND_STYL '     TO DP013-DB2-TABLE-NAME (1)   14230000
W24803           SET DP013-DB2-ABEND                                    14240000
W24803               DP013-XCTL-DISPLAY-RESTART                         14250000
W24803                                    TO TRUE                       14260000
W24803           PERFORM DP013-0000-PROCESS-ABEND                       14270000
W24803      END-IF.                                                     14280000
W24803*----------------------------------------------------------------*14290000
W24803 1170-VALIDATE-MAJCL.                                             14300000
W24803     MOVE 0             TO PV-DB2-COUNT                           14310000
W24803     MOVE PV-MAJ-CLASS  TO XLT00004-MAJ-CL-NBR                    14320000
W24803                                                                  14330000
W24803     PERFORM                                                      14340000
W24803        WITH TEST AFTER                                           14350000
W24803        VARYING PV-RETRY-COUNTER                                  14360000
W24803        FROM 1 BY 1                                               14370000
W24803        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                14380000
W24803              OR (SQLCODE = +0)                                   14390000
W24803              OR (SQLCODE = +100))                                14400000
W24803                                                                  14410000
W24803        EXEC SQL                                                  14420000
W24803            SELECT COUNT(*)                                       14430000
W24803              INTO :PV-DB2-COUNT                                  14440000
W24803            FROM  XLT_VND_STYL V                                  14450000
W24803              WHERE MAJ_CL_NBR     = :XLT00004-MAJ-CL-NBR         14460000
W24803        END-EXEC                                                  14470000
W24803                                                                  14480000
W24803        EVALUATE TRUE                                             14490000
W24803            WHEN SQLCODE = +0                                     14500000
W24803            WHEN SQLCODE = +100                                   14510000
W24803            WHEN SQLCODE = -904                                   14520000
W24803            WHEN SQLCODE = -913                                   14530000
W24803                 CONTINUE                                         14540000
W24803            WHEN SQLWARN0 NOT = SPACES                            14550000
W24803            WHEN SQLCODE < +0                                     14560000
W24803            WHEN SQLCODE > +0                                     14570000
W24803               MOVE '1170-VALIDATE-MAJCL'                         14580000
W24803                                TO DP013-PARAGRAPH                14590000
W24803             MOVE 'UNSUCCESSFUL COUNT ON MAJ CLASS'               14600000
W24803                                TO DP013-MESSAGE-TEXT (1)         14610000
W24803               MOVE SQLCA       TO DP013-SQLCA                    14620000
W24803               MOVE 'XLV_VND_STYL ' TO DP013-DB2-TABLE-NAME (1)   14630000
W24803               SET DP013-DB2-ABEND                                14640000
W24803                   DP013-XCTL-DISPLAY-RESTART                     14650000
W24803                                TO TRUE                           14660000
W24803               PERFORM DP013-0000-PROCESS-ABEND                   14670000
W24803         END-EVALUATE                                             14680000
W24803      END-PERFORM.                                                14690000
W24803                                                                  14700000
W24803      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       14710000
W24803           MOVE '1170-VALIDATE-MAJCL'                             14720000
W24803                      TO DP013-PARAGRAPH                          14730000
W24803           MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XLT_VND_STYL'   14740000
W24803                      TO DP013-MESSAGE-TEXT (1)                   14750000
W24803           MOVE SQLCA TO DP013-SQLCA                              14760000
W24803           MOVE 'XLV_VND_STYL '     TO DP013-DB2-TABLE-NAME (1)   14770000
W24803           SET DP013-DB2-ABEND                                    14780000
W24803               DP013-XCTL-DISPLAY-RESTART                         14790000
W24803                                    TO TRUE                       14800000
W24803           PERFORM DP013-0000-PROCESS-ABEND                       14810000
W24803      END-IF.                                                     14820000
124200*----------------------------------------------------------------*14830000
124300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *14840000
124400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *14850000
124500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *14860000
124600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *14870000
124700* FUNCTION KEYS CAN GET THIS FAR.                                *14880000
124800*----------------------------------------------------------------*14890000
124900                                                                  14900000
125000 2000-PROCESS-PANEL.                                              14910000
125100     EVALUATE TRUE                                                14920000
125200         WHEN DP020-SRC-AID = DP016-CLEAR                         14930000
125300             SET ASC-DISPLAY-DOLLAR TO TRUE                       14940000
125400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    14950000
125500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   14960000
125600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14970000
125700                                                                  14980000
125800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    14990000
125900             SET ASC-DISPLAY-DOLLAR TO TRUE                       15000000
126000             PERFORM 2050-DELETE-LIST-QUEUE                       15010000
126100             PERFORM 4000-BUILD-INITIAL-PANEL                     15020000
126200                                                                  15030000
126300*   THIS PROGRAM IS NOT USING THE DESELECT KEY.  THE LOGIC        15040000
126400*   WAS KEPT IN PROGRAM IN CASE IT WOULD BE USED IN FUTURE.       15050000
126500                                                                  15060000
126600         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   15070000
126700             PERFORM 2140-DESELECT-ALL-ITEMS                      15080000
126800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15090000
126900                                                                  15100000
127000*   THIS PROGRAM IS NOT USING THE SELECT-ALL KEY.  THE LOGIC      15110000
127100*   WAS KEPT IN PROGRAM IN CASE IT WOULD BE USED IN FUTURE.       15120000
127200                                                                  15130000
127300         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 15140000
127400              PERFORM 2150-SELECT-ALL-ITEMS                       15150000
127500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                15160000
127600                                                                  15170000
127700         WHEN OTHER                                               15180000
127800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 15190000
127900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15200000
128000             IF  PS-NO-ERROR                                      15210000
128100                 SET DP030-CONTINUE-GO TO TRUE                    15220000
128200                 PERFORM 2100-CHECK-FUNCTION-KEY                  15230000
128300             ELSE                                                 15240000
128400                 SET DP030-OVERRIDE-GO TO TRUE                    15250000
128500             END-IF                                               15260000
128600     END-EVALUATE.                                                15270000
128700                                                                  15280000
128800/                                                                 15290000
128900*----------------------------------------------------------------*15300000
129000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *15310000
129100*----------------------------------------------------------------*15320000
129200 2050-DELETE-LIST-QUEUE.                                          15330000
129300                                                                  15340000
129400     EXEC CICS                                                    15350000
129500         DELETEQ TS                                               15360000
129600           QUEUE (ASC-LIST-QUEUE-NAME)                            15370000
129700            RESP (PV-CICS-RESP)                                   15380000
129800     END-EXEC.                                                    15390000
129900                                                                  15400000
130000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       15410000
130100        (PV-CICS-RESP = DFHRESP(QIDERR))                          15420000
130200         CONTINUE                                                 15430000
130300     ELSE                                                         15440000
130400         SET DP013-CICS-ABEND      TO TRUE                        15450000
130500         SET DP013-NO-ROLLBACK     TO TRUE                        15460000
130600                                                                  15470000
130700         MOVE '2050-DELETE-LIST-QUEUE'                            15480000
130800                                   TO DP013-PARAGRAPH             15490000
130900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    15500000
131000                                   TO DP013-MESSAGE-TEXT (1)      15510000
131100         PERFORM DP013-0000-PROCESS-ABEND                         15520000
131200     END-IF.                                                      15530000
131300                                                                  15540000
131400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  15550000
131500                                                                  15560000
131600/                                                                 15570000
131700*----------------------------------------------------------------*15580000
131800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*15590000
131900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *15600000
132000* CICS ARCHITECTURE API.                                         *15610000
132100*----------------------------------------------------------------*15620000
132200 2100-CHECK-FUNCTION-KEY.                                         15630000
132300                                                                  15640000
132400     EVALUATE TRUE                                                15650000
132500         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 15660000
132600*             SET ASC-DISPLAY-DOLLAR TO TRUE                      15670000
132700              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             15680000
132800                  INITIALIZE PO013-INTER-APPL-COMMAREA            15690000
132900                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               15700000
133000                                TO PO013-NUMBER-OF-SELECTED-ITEMS 15710000
133100                                                                  15720000
133200                  PERFORM 5000-PREPARE-SEL-QUEUE                  15730000
133300              ELSE                                                15740000
133400                  SET DP030-OVERRIDE-GO                           15750000
133500                      DP020-MSG-WARNING                           15760000
133600                                TO TRUE                           15770000
133700                  MOVE PC-TSYMSG-00057                            15780000
133800                                TO DP020-MSG-NUMBER               15790000
133900              END-IF                                              15800000
134000                                                                  15810000
134100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  15820000
134200             MOVE +1               TO PV-TOP-ITEM                 15830000
134300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15840000
134400             PERFORM 3200-RESET-ATTRIBUTES                        15850000
134500                                                                  15860000
134600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   15870000
134700             PERFORM 2110-BROWSE-BACKWARD                         15880000
134800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15890000
134900             PERFORM 3200-RESET-ATTRIBUTES                        15900000
135000                                                                  15910000
135100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   15920000
135200             PERFORM 2120-BROWSE-FORWARD                          15930000
135300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15940000
135400             PERFORM 3200-RESET-ATTRIBUTES                        15950000
135500                                                                  15960000
135600         WHEN DP020-SRC-AID = DP016-ENTER                         15970000
135700*            SET ASC-DISPLAY-DOLLAR TO TRUE                       15980000
135800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   15990000
135900             IF  PS-ERROR                                         16000000
136000                 CONTINUE                                         16010000
136100             ELSE                                                 16020000
136200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16030000
136300             END-IF                                               16040000
136400                                                                  16050000
136500*----------------------------------------------------------------*16060000
136600*    F14-INFO FUNCTION KEY (TO POZADDNL)                         *16070000
136700*----------------------------------------------------------------*16080000
136800         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               16090000
136900              IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                 16100000
137000                                                                  16110000
137100                 INITIALIZE PO013-INTER-APPL-COMMAREA             16120000
137200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                16130000
137300                              TO PO013-NUMBER-OF-SELECTED-ITEMS   16140000
137400                 PERFORM 5000-PREPARE-SEL-QUEUE                   16150000
137500              END-IF                                              16160000
137600                                                                  16170000
137700              IF ASC-NUMBER-OF-SELECTED-ITEMS < 1                 16180000
137800                 SET DP030-OVERRIDE-GO                            16190000
137900                     DP020-MSG-WARNING                            16200000
138000                               TO TRUE                            16210000
138100                 MOVE PC-TSYMSG-00057                             16220000
138200                               TO DP020-MSG-NUMBER                16230000
138300              END-IF                                              16240000
138400                                                                  16250000
138500              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 16260000
138600                 SET DP030-OVERRIDE-GO                            16270000
138700                     DP020-MSG-WARNING                            16280000
138800                               TO TRUE                            16290000
138900                 MOVE PC-TSYMSG-00047                             16300000
139000                               TO DP020-MSG-NUMBER                16310000
139100              END-IF                                              16320000
139200                                                                  16330000
139300*----------------------------------------------------------------*16340000
139400*    F17-PO INQ FUNCTION KEY  (TO POIINHDR)                      *16350000
139500*----------------------------------------------------------------*16360000
139600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               16370000
139700              IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                 16380000
139800                                                                  16390000
139900                INITIALIZE PO013-INTER-APPL-COMMAREA              16400000
140000                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 16410000
140100                              TO PO013-NUMBER-OF-SELECTED-ITEMS   16420000
140200                PERFORM 5000-PREPARE-SEL-QUEUE                    16430000
140300              END-IF                                              16440000
140400                                                                  16450000
140500              IF ASC-NUMBER-OF-SELECTED-ITEMS < 1                 16460000
140600                 SET DP030-OVERRIDE-GO                            16470000
140700                     DP020-MSG-WARNING                            16480000
140800                               TO TRUE                            16490000
140900                 MOVE PC-TSYMSG-00057                             16500000
141000                               TO DP020-MSG-NUMBER                16510000
141100              END-IF                                              16520000
141200                                                                  16530000
141300              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 16540000
141400                 SET DP030-OVERRIDE-GO                            16550000
141500                     DP020-MSG-WARNING                            16560000
141600                               TO TRUE                            16570000
141700                 MOVE PC-TSYMSG-00047                             16580000
141800                               TO DP020-MSG-NUMBER                16590000
141900              END-IF                                              16600000
142000                                                                  16610000
142100*----------------------------------------------------------------*16620000
142200*    F22-GRP SKUS FUNCTION KEY  (TO POGRLNLN)                    *16630000
142300*----------------------------------------------------------------*16640000
142400         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               16650000
142500              IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                 16660000
142600                                                                  16670000
142700                INITIALIZE PO013-INTER-APPL-COMMAREA              16680000
142800                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 16690000
142900                              TO PO013-NUMBER-OF-SELECTED-ITEMS   16700000
143000                PERFORM 5000-PREPARE-SEL-QUEUE                    16710000
143100              END-IF                                              16720000
143200                                                                  16730000
143300              IF ASC-NUMBER-OF-SELECTED-ITEMS < 1                 16740000
143400                 SET DP030-OVERRIDE-GO                            16750000
143500                     DP020-MSG-WARNING                            16760000
143600                               TO TRUE                            16770000
143700                 MOVE PC-TSYMSG-00057                             16780000
143800                               TO DP020-MSG-NUMBER                16790000
143900              END-IF                                              16800000
144000                                                                  16810000
144100              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 16820000
144200                 SET DP030-OVERRIDE-GO                            16830000
144300                     DP020-MSG-WARNING                            16840000
144400                               TO TRUE                            16850000
144500                 MOVE PC-TSYMSG-00047                             16860000
144600                               TO DP020-MSG-NUMBER                16870000
144700              END-IF                                              16880000
144800                                                                  16890000
144900         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               16900000
145000             SET ASC-DISPLAY-DOLLAR TO TRUE                       16910000
145100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         16920000
145200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16930000
145300                                                                  16940000
145400         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               16950000
145500             SET ASC-DISPLAY-UNITS  TO TRUE                       16960000
145600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         16970000
145700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16980000
145800                                                                  16990000
145900         WHEN OTHER                                               17000000
146000*            SET ASC-DISPLAY-DOLLAR TO TRUE                       17010000
146100             SET DP013-NO-ROLLBACK                                17020000
146200                 DP013-XCTL-DISPLAY-RESTART                       17030000
146300                 DP013-CICS-ABEND  TO TRUE                        17040000
146400             MOVE '2100-CHECK-FUNCTION-KEY'                       17050000
146500                                   TO DP013-PARAGRAPH             17060000
146600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      17070000
146700                                   TO DP013-MESSAGE-TEXT (1)      17080000
146800             PERFORM DP013-0000-PROCESS-ABEND                     17090000
146900     END-EVALUATE.                                                17100000
147000                                                                  17110000
147100/                                                                 17120000
147200*----------------------------------------------------------------*17130000
147300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *17140000
147400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *17150000
147500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *17160000
147600*    MESSAGE.                                                    *17170000
147700*----------------------------------------------------------------*17180000
147800                                                                  17190000
147900 2110-BROWSE-BACKWARD.                                            17200000
148000                                                                  17210000
148100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    17220000
148200         GIVING PV-TOP-ITEM.                                      17230000
148300                                                                  17240000
148400     IF  ((PV-TOP-ITEM < +1)                                      17250000
148500       OR (PV-TOP-ITEM = +1))                                     17260000
148600         MOVE +1                   TO PV-TOP-ITEM                 17270000
148700*        -- TOP OF LIST --                                        17280000
148800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            17290000
148900         SET DP020-MSG-INFORMATIONAL                              17300000
149000                                   TO TRUE                        17310000
149100     END-IF.                                                      17320000
149200                                                                  17330000
149300/                                                                 17340000
149400*----------------------------------------------------------------*17350000
149500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *17360000
149600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *17370000
149700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *17380000
149800*----------------------------------------------------------------*17390000
149900                                                                  17400000
150000 2120-BROWSE-FORWARD.                                             17410000
150100                                                                  17420000
150200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              17430000
150300         GIVING PV-TOP-ITEM.                                      17440000
150400                                                                  17450000
150500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   17460000
150600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17470000
150700                                   TO PV-TOP-ITEM                 17480000
150800*        -- BOTTOM OF LIST --                                     17490000
150900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            17500000
151000         SET DP020-MSG-INFORMATIONAL                              17510000
151100                                   TO TRUE                        17520000
151200     ELSE                                                         17530000
151300         COMPUTE PV-BOTTOM-ITEM =                                 17540000
151400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 17550000
151500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            17560000
151600*            -- BOTTOM OF LIST --                                 17570000
151700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            17580000
151800             SET DP020-MSG-INFORMATIONAL                          17590000
151900                                   TO TRUE                        17600000
152000         END-IF                                                   17610000
152100     END-IF.                                                      17620000
152200                                                                  17630000
152300/                                                                 17640000
152400*----------------------------------------------------------------*17650000
152500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *17660000
152600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *17670000
152700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *17680000
152800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *17690000
152900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *17700000
153000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *17710000
153100*----------------------------------------------------------------*17720000
153200                                                                  17730000
153300 2130-CHECK-FOR-JUMP-BROWSE.                                      17740000
153400                                                                  17750000
153500     SET PS-NO-ERROR               TO TRUE.                       17760000
153600     IF (ASC-START-ITEM-REQUEST = SPACE)                          17770000
153700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17780000
153800                                   TO PV-TOP-ITEM                 17790000
153900     ELSE                                                         17800000
154000         MOVE ASC-START-ITEM-REQUEST                              17810000
154100                                   TO DP010I-UNEDITED-FIELD       17820000
154200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       17830000
154300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     17840000
154400         SET DP010I-NEGATIVE-NOT-ALLOWED                          17850000
154500                                   TO TRUE                        17860000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17871061
264230                         USING DP010I-NUMERIC-EDIT-AREA           17872061
154700                                                                  17880000
154800         IF  NOT DP010I-ERROR-DETECTED                            17890000
154900             MOVE DP010I-NUMERIC-FIELD                            17900000
155000                                   TO ASC-START-ITEM-REQUEST-N    17910000
155100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  17920000
155200                 IF  ASC-START-ITEM-REQUEST-N >                   17930000
155300                                          ASC-NUMBER-OF-ITEMS-READ17940000
155400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         17950000
155500                     COMPUTE PV-TOP-ITEM =                        17960000
155600                             ASC-NUMBER-OF-ITEMS-READ             17970000
155700                             - PC-ITEMS-PER-PANEL + 1             17980000
155800                     IF  PV-TOP-ITEM < +1                         17990000
155900                         MOVE +1   TO PV-TOP-ITEM                 18000000
156000                         MOVE PC-TSYMSG-00070                     18010000
156100                                   TO DP020-MSG-NUMBER            18020000
156200                         SET DP020-MSG-INFORMATIONAL              18030000
156300                                   TO TRUE                        18040000
156400                     END-IF                                       18050000
156500                 ELSE                                             18060000
156600                     MOVE ASC-START-ITEM-REQUEST-N                18070000
156700                                   TO PV-TOP-ITEM                 18080000
156800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      18090000
156900                     COMPUTE PV-BOTTOM-ITEM =                     18100000
157000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     18110000
157100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ18120000
157200*                        -- BOTTOM OF LIST --                     18130000
157300                         MOVE PC-TSYMSG-00070                     18140000
157400                                   TO DP020-MSG-NUMBER            18150000
157500                         SET DP020-MSG-INFORMATIONAL              18160000
157600                                   TO TRUE                        18170000
157700                     END-IF                                       18180000
157800                 END-IF                                           18190000
157900             ELSE                                                 18200000
158000*                --- VALUE OUT OF RANGE ----                      18210000
158100                 MOVE PC-TSYMSG-00101                             18220000
158200                                   TO DP020-MSG-NUMBER            18230000
158300                 MOVE -1           TO ASTRTITL                    18240000
158400                 SET DP030-SET-CURSOR-APPL-1                      18250000
158500                                   TO TRUE                        18260000
158600                 MOVE DP015-REVERSE                               18270000
158700                                   TO ASTRTITH                    18280000
158800                 MOVE DP015-RED    TO ASTRTITC                    18290000
158900                 MOVE DP015-UNP-NUM-BRT-MDT                       18300000
159000                                   TO ASTRTITA                    18310000
159100                 SET DP020-MSG-FATAL                              18320000
159200                                   TO TRUE                        18330000
159300                 SET PS-ERROR      TO TRUE                        18340000
159400             END-IF                                               18350000
159500                                                                  18360000
159600         ELSE                                                     18370000
159700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            18380000
159800             MOVE -1               TO ASTRTITL                    18390000
159900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  18400000
160000             MOVE DP015-REVERSE    TO ASTRTITH                    18410000
160100             MOVE DP015-RED        TO ASTRTITC                    18420000
160200             MOVE DP015-UNP-NUM-BRT-MDT                           18430000
160300                                   TO ASTRTITA                    18440000
160400             SET DP020-MSG-FATAL   TO TRUE                        18450000
160500             SET PS-ERROR          TO TRUE                        18460000
160600         END-IF                                                   18470000
160700     END-IF.                                                      18480000
160800                                                                  18490000
160900/                                                                 18500000
161000*----------------------------------------------------------------*18510000
161100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *18520000
161200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *18530000
161300*----------------------------------------------------------------*18540000
161400 2140-DESELECT-ALL-ITEMS.                                         18550000
161500                                                                  18560000
161600     MOVE +1                       TO ASC-BLK-SUB.                18570000
161700                                                                  18580000
161800     PERFORM 2141-CLEAR-SELECTED-INDS                             18590000
161900         VARYING ASC-ITEM-SUB                                     18600000
162000         FROM 1 BY 1                                              18610000
162100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18620000
162200                                                                  18630000
162300     ADD +1                        TO ASC-BLK-SUB.                18640000
162400                                                                  18650000
162500     PERFORM 2141-CLEAR-SELECTED-INDS                             18660000
162600         VARYING ASC-ITEM-SUB                                     18670000
162700         FROM 1 BY 1                                              18680000
162800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18690000
162900                                                                  18700000
163000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18710000
163100                                   TO PV-LIST-ITEM-NUMBER.        18720000
163200                                                                  18730000
163300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18740000
163400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18750000
163500                                                                  18760000
163600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18770000
163700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      18780000
163800         MOVE +1                   TO ASC-BLK-SUB                 18790000
163900                                                                  18800000
164000         PERFORM 5100-WRITE-TEMP-STORAGE                          18810000
164100                                                                  18820000
164200         MOVE +1                   TO PV-BLOCK-NUMBER             18830000
164300                                                                  18840000
164400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18850000
164500             PV-FIRST-BLOCK-IN-ARRAY - 1                          18860000
164600                                                                  18870000
164700         PERFORM                                                  18880000
164800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       18890000
164900                                                                  18900000
165000             PERFORM 4410-READ-TEMP-STORAGE                       18910000
165100                                                                  18920000
165200             PERFORM 2141-CLEAR-SELECTED-INDS                     18930000
165300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 18940000
165400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18950000
165500                                                                  18960000
165600             PERFORM 5100-WRITE-TEMP-STORAGE                      18970000
165700                                                                  18980000
165800             ADD +1                TO PV-BLOCK-NUMBER             18990000
165900                                                                  19000000
166000         END-PERFORM                                              19010000
166100                                                                  19020000
166200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19030000
166300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19040000
166400                                                                  19050000
166500         PERFORM                                                  19060000
166600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19070000
166700                   ASC-HIGHEST-BLOCK-WRITTEN                      19080000
166800                                                                  19090000
166900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19100000
167000                                   TO PV-BLOCK-NUMBER             19110000
167100                                                                  19120000
167200             PERFORM 4410-READ-TEMP-STORAGE                       19130000
167300                                                                  19140000
167400             PERFORM 2141-CLEAR-SELECTED-INDS                     19150000
167500                 VARYING ASC-ITEM-SUB                             19160000
167600                 FROM 1 BY 1                                      19170000
167700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19180000
167800                                                                  19190000
167900             PERFORM 5100-WRITE-TEMP-STORAGE                      19200000
168000                                                                  19210000
168100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19220000
168200                                                                  19230000
168300         END-PERFORM                                              19240000
168400                                                                  19250000
168500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19260000
168600                                   TO PV-BLOCK-NUMBER             19270000
168700                                                                  19280000
168800         PERFORM 4410-READ-TEMP-STORAGE                           19290000
168900     END-IF.                                                      19300000
169000                                                                  19310000
169100                                                                  19320000
169200     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS19330000
169300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.19340000
169400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  19350000
169500                                                                  19360000
169600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        19370000
169700                                                                  19380000
169800/                                                                 19390000
169900*----------------------------------------------------------------*19400000
170000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *19410000
170100*----------------------------------------------------------------*19420000
170200                                                                  19430000
170300 2141-CLEAR-SELECTED-INDS.                                        19440000
170400                                                                  19450000
170500     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          19460000
170600             NOT EQUAL ZERO                                       19470000
170700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19480000
170800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19490000
170900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    19500000
171000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  19510000
171100                                   TO TRUE                        19520000
171200         END-IF                                                   19530000
171300     END-IF.                                                      19540000
171400                                                                  19550000
171500/                                                                 19560000
171600*----------------------------------------------------------------*19570000
171700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *19580000
171800*  FOR ALL ITEMS.                                                *19590000
171900*----------------------------------------------------------------*19600000
172000                                                                  19610000
172100 2150-SELECT-ALL-ITEMS.                                           19620000
172200                                                                  19630000
172300     MOVE +1                       TO ASC-BLK-SUB.                19640000
172400                                                                  19650000
172500     PERFORM 2151-SET-SELECTED-INDS                               19660000
172600         VARYING ASC-ITEM-SUB                                     19670000
172700         FROM 1 BY 1                                              19680000
172800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19690000
172900                                                                  19700000
173000     ADD +1                        TO ASC-BLK-SUB.                19710000
173100                                                                  19720000
173200     PERFORM 2151-SET-SELECTED-INDS                               19730000
173300         VARYING ASC-ITEM-SUB                                     19740000
173400         FROM 1 BY 1                                              19750000
173500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19760000
173600                                                                  19770000
173700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19780000
173800                                   TO PV-LIST-ITEM-NUMBER.        19790000
173900                                                                  19800000
174000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19810000
174100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19820000
174200                                                                  19830000
174300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19840000
174400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    19850000
174500         MOVE +1                   TO ASC-BLK-SUB                 19860000
174600                                                                  19870000
174700         PERFORM 5100-WRITE-TEMP-STORAGE                          19880000
174800                                                                  19890000
174900         MOVE +1                   TO PV-BLOCK-NUMBER             19900000
175000                                                                  19910000
175100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19920000
175200             PV-FIRST-BLOCK-IN-ARRAY - 1                          19930000
175300                                                                  19940000
175400         PERFORM                                                  19950000
175500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19960000
175600                                                                  19970000
175700             PERFORM 4410-READ-TEMP-STORAGE                       19980000
175800                                                                  19990000
175900             PERFORM 2151-SET-SELECTED-INDS                       20000000
176000                 VARYING ASC-ITEM-SUB                             20010000
176100                 FROM 1 BY 1                                      20020000
176200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20030000
176300                                                                  20040000
176400             PERFORM 5100-WRITE-TEMP-STORAGE                      20050000
176500                                                                  20060000
176600             ADD +1                TO PV-BLOCK-NUMBER             20070000
176700         END-PERFORM                                              20080000
176800                                                                  20090000
176900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20100000
177000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20110000
177100                                                                  20120000
177200         PERFORM                                                  20130000
177300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20140000
177400                   ASC-HIGHEST-BLOCK-WRITTEN                      20150000
177500                                                                  20160000
177600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20170000
177700                                   TO PV-BLOCK-NUMBER             20180000
177800                                                                  20190000
177900             PERFORM 4410-READ-TEMP-STORAGE                       20200000
178000                                                                  20210000
178100             PERFORM 2151-SET-SELECTED-INDS                       20220000
178200                 VARYING ASC-ITEM-SUB                             20230000
178300                 FROM 1 BY 1                                      20240000
178400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20250000
178500                                                                  20260000
178600             PERFORM 5100-WRITE-TEMP-STORAGE                      20270000
178700                                                                  20280000
178800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20290000
178900         END-PERFORM                                              20300000
179000                                                                  20310000
179100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20320000
179200                                   TO PV-BLOCK-NUMBER             20330000
179300                                                                  20340000
179400         PERFORM 4410-READ-TEMP-STORAGE                           20350000
179500     END-IF.                                                      20360000
179600                                                                  20370000
179700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             20380000
179800          ASC-NUMBER-OF-SELECTED-ITEMS.                           20390000
179900                                                                  20400000
180000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        20410000
180100                                                                  20420000
180200/                                                                 20430000
180300*----------------------------------------------------------------*20440000
180400*    MARK EACH ITEM AS BEING SELECTED.                           *20450000
180500*----------------------------------------------------------------*20460000
180600                                                                  20470000
180700 2151-SET-SELECTED-INDS.                                          20480000
180800                                                                  20490000
180900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           20500000
181000             NOT EQUAL ZERO                                       20510000
181100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             20520000
181200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             20530000
181300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        20540000
181400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  20550000
181500                                   TO TRUE                        20560000
181600         END-IF                                                   20570000
181700     END-IF.                                                      20580000
181800                                                                  20590000
181900/                                                                 20600000
182000*----------------------------------------------------------------*20610000
182100*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *20620000
182200*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *20630000
182300*----------------------------------------------------------------*20640000
182400 2200-MOVE-SCREEN-TO-COMMAREA.                                    20650000
182500                                                                  20660000
182600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             20670000
182700     MOVE +1                       TO PV-SUB.                     20680000
182800                                                                  20690000
182900     PERFORM 3100-SET-SUBSCRIPTS.                                 20700000
183000                                                                  20710000
183100     IF  ASTRTITL > ZERO                                          20720000
183200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      20730000
183300     ELSE                                                         20740000
183400         IF  ASTRTITF = DP015-ERASE-EOF                           20750000
183500             INITIALIZE ASC-START-ITEM-REQUEST                    20760000
183600         END-IF                                                   20770000
183700     END-IF.                                                      20780000
183800                                                                  20790000
183900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          20800000
184000         VARYING PV-SUB                                           20810000
184100         FROM 1 BY 1                                              20820000
184200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      20830000
184300                                                                  20840000
184400/                                                                 20850000
184500*----------------------------------------------------------------*20860000
184600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *20870000
184700*----------------------------------------------------------------*20880000
184800 2210-MOVE-LINES-TO-COMMAREA.                                     20890000
184900                                                                  20900000
185000     IF  MR-SELECTL (PV-SUB) > ZERO                               20910000
185100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     20920000
185200                                   TO TRUE                        20930000
185300         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        20940000
185400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      20950000
185500     ELSE                                                         20960000
185600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                20970000
185700             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         20980000
185800             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        20990000
185900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21000000
186000         END-IF                                                   21010000
186100     END-IF.                                                      21020000
186200                                                                  21030000
186300     ADD +1                        TO ASC-ITEM-SUB.               21040000
186400                                                                  21050000
186500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21060000
186600         ADD +1                    TO ASC-BLK-SUB                 21070000
186700         MOVE +1                   TO ASC-ITEM-SUB                21080000
186800     END-IF.                                                      21090000
186900                                                                  21100000
187000/                                                                 21110000
187100*----------------------------------------------------------------*21120000
187200*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *21130000
187300*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *21140000
187400*----------------------------------------------------------------*21150000
187500 3000-EDIT-DATA-IN-COMMAREA.                                      21160000
187600                                                                  21170000
187700     SET PS-NO-ERROR               TO TRUE.                       21180000
187800                                                                  21190000
187900     PERFORM 3200-RESET-ATTRIBUTES.                               21200000
188000                                                                  21210000
188100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     21220000
188200**                                                                21230000
188300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              21240000
188400* EDITTING IS DONE FROM THE BOTTOM UP.                            21250000
188500**                                                                21260000
188600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       21270000
188700         ASC-ITEMS-DISPLAYED - 1.                                 21280000
188800                                                                  21290000
188900     PERFORM 3100-SET-SUBSCRIPTS.                                 21300000
189000     PERFORM 3300-EDIT-SELECTIONS                                 21310000
189100         VARYING PV-SUB                                           21320000
189200         FROM PV-SUB BY -1                                        21330000
189300         UNTIL PV-SUB < +1                                        21340000
189400                                                                  21350000
189500     IF  PS-NO-ERROR                                              21360000
189600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        21370000
189700     END-IF.                                                      21380000
189800                                                                  21390000
189900     IF  ((PS-NO-ERROR)                                           21400000
190000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   21410000
190100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    21420000
190200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  21430000
190300     END-IF.                                                      21440000
190400                                                                  21450000
190500/                                                                 21460000
190600*----------------------------------------------------------------*21470000
190700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *21480000
190800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*21490000
190900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *21500000
191000*                                                                *21510000
191100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *21520000
191200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *21530000
191300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *21540000
191400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *21550000
191500*----------------------------------------------------------------*21560000
191600                                                                  21570000
191700 3100-SET-SUBSCRIPTS.                                             21580000
191800                                                                  21590000
191900     COMPUTE ASC-ITEM-SUB =                                       21600000
192000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        21610000
192100                                                                  21620000
192200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         21630000
192300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21640000
192400                                                                  21650000
192500         MOVE PC-MAX-BLOCKS-IN-ARRAY                              21660000
192600                                   TO ASC-BLK-SUB                 21670000
192700     ELSE                                                         21680000
192800         MOVE +1                   TO ASC-BLK-SUB                 21690000
192900     END-IF.                                                      21700000
193000                                                                  21710000
193100*----------------------------------------------------------------*21720000
193200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *21730000
193300*----------------------------------------------------------------*21740000
193400                                                                  21750000
193500 3200-RESET-ATTRIBUTES.                                           21760000
193600                                                                  21770000
193700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   21780000
193800     MOVE DP015-GREEN              TO ASTRTITC.                   21790000
193900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   21800000
194000                                                                  21810000
194100     IF DP020-NEXT-ACT-RETURN                                     21820000
194200     OR DP020-NEXT-ACT-READ-MAP                                   21830000
194300        PERFORM                                                   21840000
194400            VARYING PV-SUB                                        21850000
194500            FROM 1 BY 1                                           21860000
194600            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    21870000
194700            MOVE DP015-UNP-ALP-NOR-OFF                            21880000
194800                                      TO MR-SELECTA (PV-SUB)      21890000
194900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      21900000
195000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      21910000
195100        END-PERFORM                                               21920000
195200     ELSE                                                         21930000
195300        PERFORM                                                   21940000
195400            VARYING PV-SUB                                        21950000
195500            FROM 1 BY 1                                           21960000
195600            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     21970000
195700            MOVE DP015-UNP-ALP-NOR-OFF                            21980000
195800                                      TO MR-SELECTA (PV-SUB)      21990000
195900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      22000000
196000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      22010000
196100        END-PERFORM                                               22020000
196200     END-IF.                                                      22030000
196300                                                                  22040000
196400/                                                                 22050000
196500*----------------------------------------------------------------*22060000
196600*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *22070000
196700*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *22080000
196800*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *22090000
196900*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *22100000
197000*----------------------------------------------------------------*22110000
197100 3300-EDIT-SELECTIONS.                                            22120000
197200                                                                  22130000
197300     EVALUATE TRUE                                                22140000
197400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22150000
197500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         22160000
197600                 CONTINUE                                         22170000
197700                                                                  22180000
197800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         22190000
197900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        22200000
198000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS22210000
198100                 MOVE ASC-TEMP-SELECTED-SW                        22220000
198200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22230000
198300                                   TO ASC-SELECTED-SW             22240000
198400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22250000
198500             END-IF                                               22260000
198600                                                                  22270000
198700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22280000
198800                 = SPACE                                          22290000
198900             EVALUATE TRUE                                        22300000
199000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       22310000
199100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS22320000
199200                     MOVE SPACE    TO ASC-SELECTED-SW             22330000
199300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22340000
199400                                                                  22350000
199500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        22360000
199600                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 22370000
199700                     MOVE SPACE    TO ASC-SELECTED-SW             22380000
199800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22390000
199900                                                                  22400000
200000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          22410000
200100                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   22420000
200200                     MOVE SPACE    TO ASC-SELECTED-SW             22430000
200300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22440000
200400             END-EVALUATE                                         22450000
200500                                                                  22460000
200600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           22470000
200700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22480000
200800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22490000
200900             END-IF                                               22500000
201000             PERFORM 3310-EDIT-RANGE                              22510000
201100                                                                  22520000
201200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             22530000
201300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22540000
201400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22550000
201500             END-IF                                               22560000
201600             PERFORM 3310-EDIT-RANGE                              22570000
201700                                                                  22580000
201800         WHEN OTHER                                               22590000
201900             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            22600000
202000             SET DP020-MSG-FATAL   TO TRUE                        22610000
202100             MOVE -1               TO MR-SELECTL (PV-SUB)         22620000
202200             SET DP030-SET-CURSOR-APPL-1                          22630000
202300                                   TO TRUE                        22640000
202400             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         22650000
202500             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         22660000
202600             SET PS-ERROR          TO TRUE                        22670000
202700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22680000
202800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     22690000
202900                 MOVE SPACE        TO ASC-SELECTED-SW             22700000
203000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22710000
203100             END-IF                                               22720000
203200     END-EVALUATE.                                                22730000
203300                                                                  22740000
203400     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             22750000
203500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22760000
203600                                                                  22770000
203700     IF  ASC-ITEM-SUB < 1                                         22780000
203800         SUBTRACT +1 FROM ASC-BLK-SUB                             22790000
203900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                22800000
204000     END-IF.                                                      22810000
204100                                                                  22820000
204200*----------------------------------------------------------------*22830000
204300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *22840000
204400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *22850000
204500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *22860000
204600*  THE ENDING.                                                   *22870000
204700*----------------------------------------------------------------*22880000
204800 3310-EDIT-RANGE.                                                 22890000
204900                                                                  22900000
205000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                22910000
205100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   22920000
205200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)22930000
205300                                   TO ASC-SELECTED-SW             22940000
205400                                        (ASC-BLK-SUB ASC-ITEM-SUB)22950000
205500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 22960000
205600         ELSE                                                     22970000
205700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     22980000
205800                 CONTINUE                                         22990000
205900             ELSE                                                 23000000
206000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        23010000
206100                 MOVE PC-TSYMSG-00054                             23020000
206200                                   TO DP020-MSG-NUMBER            23030000
206300                 SET DP020-MSG-FATAL                              23040000
206400                                   TO TRUE                        23050000
206500                 MOVE -1           TO MR-SELECTL (PV-SUB)         23060000
206600                 SET DP030-SET-CURSOR-APPL-1                      23070000
206700                                   TO TRUE                        23080000
206800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         23090000
206900                 MOVE DP015-UNDERLINE                             23100000
207000                                   TO MR-SELECTH (PV-SUB)         23110000
207100                 SET PS-ERROR      TO TRUE                        23120000
207200             END-IF                                               23130000
207300         END-IF                                                   23140000
207400     ELSE                                                         23150000
207500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23160000
207600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23170000
207700                                   TO ASC-SELECTED-SW             23180000
207800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23190000
207900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   23200000
208000         ELSE                                                     23210000
208100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       23220000
208200                 CONTINUE                                         23230000
208300             ELSE                                                 23240000
208400*                -- ONLY ONE END-OF-RANGE ALLOWED --              23250000
208500                 MOVE PC-TSYMSG-00055                             23260000
208600                                   TO DP020-MSG-NUMBER            23270000
208700                 SET DP020-MSG-FATAL                              23280000
208800                                   TO TRUE                        23290000
208900                 MOVE -1           TO MR-SELECTL (PV-SUB)         23300000
209000                 SET DP030-SET-CURSOR-APPL-1                      23310000
209100                                   TO TRUE                        23320000
209200                 SET PS-ERROR      TO TRUE                        23330000
209300             END-IF                                               23340000
209400         END-IF                                                   23350000
209500     END-IF.                                                      23360000
209600                                                                  23370000
209700*----------------------------------------------------------------*23380000
209800*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *23390000
209900*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *23400000
210000*----------------------------------------------------------------*23410000
210100 3400-CHECK-RANGE-SEQUENCE.                                       23420000
210200                                                                  23430000
210300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23440000
210400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      23450000
210500       AND  ASC-START-OF-SELECTED-RANGE >                         23460000
210600                                         ASC-END-OF-SELECTED-RANGE23470000
210700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                23480000
210800         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            23490000
210900         SET DP020-MSG-FATAL       TO TRUE                        23500000
211000         SET PS-ERROR              TO TRUE                        23510000
211100         PERFORM 3410-POSITION-AT-ERROR                           23520000
211200     END-IF.                                                      23530000
211300                                                                  23540000
211400*----------------------------------------------------------------*23550000
211500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *23560000
211600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *23570000
211700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *23580000
211800*----------------------------------------------------------------*23590000
211900 3410-POSITION-AT-ERROR.                                          23600000
212000                                                                  23610000
212100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       23620000
212200                                                                  23630000
212300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23640000
212400                    - PV-TOP-ITEM + 1.                            23650000
212500                                                                  23660000
212600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23670000
212700         CONTINUE                                                 23680000
212800     ELSE                                                         23690000
212900         MOVE -1                   TO MR-SELECTL (PV-SUB)         23700000
213000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23710000
213100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         23720000
213200     END-IF.                                                      23730000
213300                                                                  23740000
213400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23750000
213500                    - PV-TOP-ITEM + 1.                            23760000
213600                                                                  23770000
213700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23780000
213800         CONTINUE                                                 23790000
213900     ELSE                                                         23800000
214000         MOVE -1                   TO MR-SELECTL (PV-SUB)         23810000
214100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23820000
214200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         23830000
214300     END-IF.                                                      23840000
214400                                                                  23850000
214500/                                                                 23860000
214600*----------------------------------------------------------------*23870000
214700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *23880000
214800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *23890000
214900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *23900000
215000*----------------------------------------------------------------*23910000
215100                                                                  23920000
215200 3500-MARK-RANGE-AS-SELECTED.                                     23930000
215300                                                                  23940000
215400     MOVE +1                       TO ASC-BLK-SUB.                23950000
215500                                                                  23960000
215600     PERFORM 3510-MARK-SELECTED-INDS                              23970000
215700         VARYING ASC-ITEM-SUB                                     23980000
215800         FROM 1 BY 1                                              23990000
215900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24000000
216000                                                                  24010000
216100     ADD +1                        TO ASC-BLK-SUB.                24020000
216200                                                                  24030000
216300     PERFORM 3510-MARK-SELECTED-INDS                              24040000
216400         VARYING ASC-ITEM-SUB                                     24050000
216500         FROM 1 BY 1                                              24060000
216600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24070000
216700                                                                  24080000
216800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               24090000
216900                                   TO PV-LIST-ITEM-NUMBER.        24100000
217000                                                                  24110000
217100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            24120000
217200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         24130000
217300               PC-ITEMS-PER-PANEL).                               24140000
217400                                                                  24150000
217500     MOVE ASC-START-OF-SELECTED-RANGE                             24160000
217600                                   TO PV-START-OF-SELECTED-RANGE. 24170000
217700                                                                  24180000
217800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            24190000
217900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  24200000
218000               PC-ITEMS-PER-PANEL).                               24210000
218100                                                                  24220000
218200     MOVE ASC-END-OF-SELECTED-RANGE                               24230000
218300                                   TO PV-END-OF-SELECTED-RANGE.   24240000
218400                                                                  24250000
218500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             24260000
218600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    24270000
218700               PC-ITEMS-PER-PANEL).                               24280000
218800                                                                  24290000
218900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             24300000
219000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             24310000
219100                                                                  24320000
219200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    24330000
219300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        24340000
219400         MOVE +1                   TO ASC-BLK-SUB                 24350000
219500         PERFORM 5100-WRITE-TEMP-STORAGE                          24360000
219600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         24370000
219700             PV-FIRST-BLOCK-IN-ARRAY - 1                          24380000
219800                                                                  24390000
219900         PERFORM                                                  24400000
220000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      24410000
220100                   PV-PREV-BLOCK-IN-ARRAY                         24420000
220200             MOVE PV-FIRST-BLOCK-IN-RANGE                         24430000
220300                                   TO PV-BLOCK-NUMBER             24440000
220400             PERFORM 4410-READ-TEMP-STORAGE                       24450000
220500             PERFORM 3510-MARK-SELECTED-INDS                      24460000
220600                 VARYING ASC-ITEM-SUB                             24470000
220700                 FROM 1 BY 1                                      24480000
220800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24490000
220900             PERFORM 5100-WRITE-TEMP-STORAGE                      24500000
221000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     24510000
221100         END-PERFORM                                              24520000
221200                                                                  24530000
221300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         24540000
221400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     24550000
221500         PERFORM                                                  24560000
221600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       24570000
221700                   PV-LAST-BLOCK-IN-RANGE                         24580000
221800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          24590000
221900                                   TO PV-BLOCK-NUMBER             24600000
222000             PERFORM 4410-READ-TEMP-STORAGE                       24610000
222100             PERFORM 3510-MARK-SELECTED-INDS                      24620000
222200                 VARYING ASC-ITEM-SUB                             24630000
222300                 FROM 1 BY 1                                      24640000
222400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24650000
222500             PERFORM 5100-WRITE-TEMP-STORAGE                      24660000
222600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      24670000
222700         END-PERFORM                                              24680000
222800                                                                  24690000
222900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             24700000
223000                                   TO PV-BLOCK-NUMBER             24710000
223100         PERFORM 4410-READ-TEMP-STORAGE                           24720000
223200     END-IF.                                                      24730000
223300                                                                  24740000
223400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 24750000
223500                                      ASC-END-OF-SELECTED-RANGE.  24760000
223600                                                                  24770000
223700/                                                                 24780000
223800*----------------------------------------------------------------*24790000
223900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *24800000
224000*----------------------------------------------------------------*24810000
224100                                                                  24820000
224200 3510-MARK-SELECTED-INDS.                                         24830000
224300                                                                  24840000
224400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         24850000
224500         ASC-START-OF-SELECTED-RANGE)                             24860000
224600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         24870000
224700         ASC-START-OF-SELECTED-RANGE)                             24880000
224800                                                                  24890000
224900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     24900000
225000             ASC-END-OF-SELECTED-RANGE)                           24910000
225100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     24920000
225200             ASC-END-OF-SELECTED-RANGE)                           24930000
225300                                                                  24940000
225400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          24950000
225500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   24960000
225600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   24970000
225700                                   TO TRUE                        24980000
225800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              24990000
225900                                   TO TRUE                        25000000
226000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS25010000
226100             END-IF                                               25020000
226200         END-IF                                                   25030000
226300     END-IF.                                                      25040000
226400                                                                  25050000
226500/                                                                 25060000
226600*----------------------------------------------------------------*25070000
226700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *25080000
226800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *25090000
226900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *25100000
227000*    DISPLAY THE PANEL TO USER.                                  *25110000
227100*----------------------------------------------------------------*25120000
227200                                                                  25130000
227300 4000-BUILD-INITIAL-PANEL.                                        25140000
227400                                                                  25150000
227500     INITIALIZE ASC-BLOCK-ENTRIES (1)                             25160000
227600                ASC-BLOCK-ENTRIES (2).                            25170000
227700*    SET ASC-DISPLAY-DOLLAR TO TRUE.                              25180000
227800                                                                  25190000
227900     MOVE +1                       TO ASC-BLK-SUB                 25200000
228000                                      PV-STRING-POINTER-FROM      25210000
228100                                      PV-STRING-POINTER-WHERE.    25220000
228200                                                                  25230000
228300     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       25240000
228400                                                                  25250000
228500     MOVE +0                       TO ASC-ITEM-SUB                25260000
228600                                      ASC-NUMBER-OF-ITEMS-READ    25270000
228700                                      ASC-NUMBER-OF-SELECTED-ITEMS25280000
228800                                      ASC-HIGHEST-BLOCK-WRITTEN   25290000
228900                                      ASC-START-OF-SELECTED-RANGE 25300000
229000                                      ASC-END-OF-SELECTED-RANGE   25310000
W24803                                      ASC-DOLLAR-ORD-TOT          25320000
W24803                                      ASC-DOLLAR-REC-TOT          25330000
W24803                                      ASC-UNIT-ORD-TOT            25340000
W24803                                      ASC-UNIT-REC-TOT            25350000
229100                                      ASC-ITEM-AT-TOP-OF-PANEL.   25360000
229200                                                                  25370000
229300     EXEC CICS ASSIGN                                             25380000
229400               APPLID(PV-SYSTEM-ID)                               25390000
229500     END-EXEC.                                                    25400000
229600                                                                  25410000
W24803*    IF PV-REGION-IND = 'T'                                       25420053
W24803*       MOVE '04'          TO PV-QUALIFIER                        25430053
W24803*                             PV-QUALIFIER-COMMA                  25440053
W24803*    ELSE                                                         25450053
W24803        MOVE PV-REGION-IND TO PV-QUALIFIER                        25460000
W24803                              PV-QUALIFIER-COMMA                  25470000
W24803*    END-IF.                                                      25480053
229900     MOVE SPACES        TO PV-FROM-CLAUSE                         25490000
230000                           PV-WHERE-CLAUSE.                       25500000
230100                                                                  25510000
230200     PERFORM 4100-BUILD-CURSOR.                                   25520000
230300     PERFORM 4150-COMBINE-SQL.                                    25530000
230400                                                                  25540000
230500     PERFORM 4010-DECLARE-CURSOR.                                 25550000
230600     PERFORM 4020-PREPARE-CURSOR.                                 25560000
230700     PERFORM 4030-OPEN-CURSOR.                                    25570000
230800                                                                  25580000
230900     PERFORM 4300-READ-ITEMS-FROM-DB.                             25590000
231000                                                                  25600000
231100     PERFORM 4040-CLOSE-CURSOR.                                   25610000
231200                                                                  25620000
231300     MOVE +1                       TO PV-TOP-ITEM.                25630000
231400                                                                  25640000
231500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          25650000
231600         SET DP020-NEXT-ACT-APPL-ERROR                            25660000
231700                                   TO TRUE                        25670000
231800         SET DP020-MSG-FATAL       TO TRUE                        25680000
231900         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            25690000
232000     ELSE                                                         25700000
232100         MOVE -1                   TO MR-SELECTL (1)              25710000
232200         SET DP030-SET-CURSOR-APPL-1                              25720000
232300                                   TO TRUE                        25730000
232400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     25740000
232500     END-IF.                                                      25750000
232600                                                                  25760000
232700/                                                                 25770000
232800*----------------------------------------------------------------*25780000
232900* DECLARE THE CURSOR FOR DYNAMIC SQL CALL                        *25790000
233000*----------------------------------------------------------------*25800000
233100 4010-DECLARE-CURSOR.                                             25810000
233200                                                                  25820000
233300     EXEC SQL                                                     25830000
233400         DECLARE PO-CSR CURSOR FOR                                25840000
233500                 PO-SELECT                                        25850000
233600     END-EXEC.                                                    25860000
233700                                                                  25870000
233800/                                                                 25880000
233900*----------------------------------------------------------------*25890000
234000* OPEN THE PO CURSOR                                             *25900000
234100*----------------------------------------------------------------*25910000
234200 4020-PREPARE-CURSOR.                                             25920000
234300                                                                  25930000
234400     EXEC SQL                                                     25940000
234500         PREPARE PO-SELECT FROM :PV-SQL-STMT                      25950000
234600     END-EXEC.                                                    25960000
234700                                                                  25970000
234800     EVALUATE TRUE                                                25980000
234900         WHEN SQLCODE = +0                                        25990000
235000              CONTINUE                                            26000000
235100         WHEN SQLCODE = -206                                      26010000
235200           SET PS-206-PURITM         TO TRUE                      26020000
235300*          SET PS-ERROR              TO TRUE                      26030000
235400*          MOVE PC-TSYMSG-00317      TO DP020-MSG-NUMBER          26040000
235500*          SET DP020-MSG-FATAL       TO TRUE                      26050000
235600         WHEN SQLWARN0 NOT = SPACE                                26060000
235700         WHEN SQLCODE  NOT = 0                                    26070000
235800              MOVE '4020-PREPARE-CURSOR'                          26080000
235900                               TO DP013-PARAGRAPH                 26090000
236000              MOVE 'PREPARE PO-CSR    '                           26100000
236100                               TO DP013-MESSAGE-TEXT (1)          26110000
236200              MOVE SQLCA       TO DP013-SQLCA                     26120000
236300              MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)        26130000
236400              MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)        26140000
236500              MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (3)        26150000
236600              MOVE 'TSTATCD'   TO DP013-DB2-TABLE-NAME (4)        26160000
236700              SET DP013-DB2-ABEND                                 26170000
236800                               TO TRUE                            26180000
236900              PERFORM DP013-0000-PROCESS-ABEND                    26190000
237000     END-EVALUATE.                                                26200000
237100/                                                                 26210000
237200*----------------------------------------------------------------*26220000
237300* OPEN THE PO CURSOR                                             *26230000
237400*----------------------------------------------------------------*26240000
237500                                                                  26250000
237600 4030-OPEN-CURSOR.                                                26260000
237700                                                                  26270000
237800     PERFORM                                                      26280000
237900         WITH TEST AFTER                                          26290000
238000         VARYING PV-RETRY-COUNTER                                 26300000
238100         FROM 1 BY 1                                              26310000
238200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26320000
238300            OR (SQLCODE = +0))                                    26330000
238400                                                                  26340000
238500         EXEC SQL                                                 26350000
238600             OPEN PO-CSR                                          26360000
238700         END-EXEC                                                 26370000
238800                                                                  26380000
238900         EVALUATE TRUE                                            26390000
239000             WHEN SQLCODE = +0                                    26400000
239100                  CONTINUE                                        26410000
239200             WHEN SQLCODE = -904                                  26420000
239300             WHEN SQLCODE = -913                                  26430000
239400                  CONTINUE                                        26440000
239500             WHEN SQLWARN0 NOT = SPACE                            26450000
239600             WHEN SQLCODE  NOT = +0                               26460000
239700                  MOVE '4010-OPEN-CURSOR'                         26470000
239800                                   TO DP013-PARAGRAPH             26480000
239900                  MOVE 'OPEN PO-CSR CURSOR'                       26490000
240000                                   TO DP013-MESSAGE-TEXT (1)      26500000
240100                  MOVE SQLCA       TO DP013-SQLCA                 26510000
240200                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    26520000
240300                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)    26530000
240400                  MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (3)    26540000
240500                  MOVE 'TENTNME'   TO DP013-DB2-TABLE-NAME (4)    26550000
240600                  SET DP013-DB2-ABEND                             26560000
240700                                   TO TRUE                        26570000
240800                  PERFORM DP013-0000-PROCESS-ABEND                26580000
240900         END-EVALUATE                                             26590000
241000     END-PERFORM.                                                 26600000
241100                                                                  26610000
241200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26620000
241300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             26630000
241400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              26640000
241500                                   TO DP013-MESSAGE-TEXT (1)      26650000
241600         MOVE SQLCA                TO DP013-SQLCA                 26660000
241700         SET DP013-DB2-ABEND       TO TRUE                        26670000
241800         PERFORM DP013-0000-PROCESS-ABEND                         26680000
241900     END-IF.                                                      26690000
242000                                                                  26700000
242100/                                                                 26710000
242200*----------------------------------------------------------------*26720000
242300* CLOSE THE PO CURSOR                                            *26730000
242400*----------------------------------------------------------------*26740000
242500                                                                  26750000
242600 4040-CLOSE-CURSOR.                                               26760000
242700                                                                  26770000
242800     EXEC SQL                                                     26780000
242900         CLOSE PO-CSR                                             26790000
243000     END-EXEC.                                                    26800000
243100                                                                  26810000
243200     EVALUATE TRUE                                                26820000
243300         WHEN SQLCODE = +0                                        26830000
243400              CONTINUE                                            26840000
243500         WHEN SQLWARN0 NOT = SPACE                                26850000
243600         WHEN SQLCODE  NOT = +0                                   26860000
243700              MOVE '4040-CLOSE-CURSOR'                            26870000
243800                                   TO DP013-PARAGRAPH             26880000
243900              MOVE 'CLOSE PO-CSR CURSOR'                          26890000
244000                                   TO DP013-MESSAGE-TEXT (1)      26900000
244100              MOVE SQLCA           TO DP013-SQLCA                 26910000
244200              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    26920000
244300              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    26930000
244400              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    26940000
244500              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    26950000
244600              SET DP013-DB2-ABEND  TO TRUE                        26960000
244700              PERFORM DP013-0000-PROCESS-ABEND                    26970000
244800     END-EVALUATE.                                                26980000
244900                                                                  26990000
245000/                                                                 27000000
245100*----------------------------------------------------------------*27010000
245200*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *27020000
245300*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *27030000
245400*----------------------------------------------------------------*27040000
245500                                                                  27050000
245600 4100-BUILD-CURSOR.                                               27060000
245700                                                                  27070000
245800                                                                  27080000
245900     PERFORM 4102-DEPT-NBR.                                       27090000
246000                                                                  27100000
246100     IF  ASC-KEY-PO-TYP-CDE > SPACES                              27110000
246200         PERFORM 4103-PO-TYP-CDE.                                 27120000
246300                                                                  27130000
246400     IF  ASC-KEY-STATUS-CDE > SPACES                              27140000
246500         PERFORM 4104-STATUS-CDE.                                 27150000
246600                                                                  27160000
246700     IF  ASC-KEY-STATUS-CLS > SPACES                              27170000
246800         PERFORM 4105-STATUS-CLS.                                 27180000
246900                                                                  27190000
247000                                                                  27200000
247100                                                                  27210000
247200     IF  ASC-KEY-PIC-AD-IND > SPACES                              27220000
247300         PERFORM 4107-PIC-AD-IND.                                 27230000
247400                                                                  27240000
247500                                                                  27250000
W24803     IF  ASC-KEY-SUB-CL-NBR IS NOT ZERO                           27260000
W24803         MOVE PO017-CL-NBR  TO PO017-CL-NBR-BEG                   27270000
W24803         SET PS-USE-TPURITM TO TRUE                               27280000
W24803         PERFORM 4109-SUB-CL-NBR                                  27290000
W24803     ELSE                                                         27300000
W24803         IF  ASC-KEY-MAJ-CL-NBR IS NOT ZERO                       27310000
W24803             SET PS-USE-TPURITM TO TRUE                           27320000
W24803             PERFORM 4110-MAJ-CL-NBR                              27330000
W24803         END-IF                                                   27340000
W24803     END-IF.                                                      27350000
258100                                                                  27360000
258200     IF  ASC-KEY-AD-EVNT-DTE > SPACES                             27370000
258300         SET PS-USE-TPURITM TO TRUE                               27380000
258400         PERFORM 4112-AD-EVNT-DTE.                                27390000
258500                                                                  27400000
258600     IF  ASC-KEY-OTB-PER-NBR-BEG > SPACES AND                     27410000
258700         ASC-KEY-OTB-PER-NBR-END > SPACES                         27420000
258800         IF ASC-KEY-OTB-PER-NBR-BEG = ASC-KEY-OTB-PER-NBR-END     27430000
258900            PERFORM 4113-OTB-PER-ONE                              27440000
259000         ELSE                                                     27450000
259100            PERFORM 4114-OTB-PER-NBR-BEG-END                      27460000
259200         END-IF                                                   27470000
259300     ELSE                                                         27480000
259400        IF  ASC-KEY-OTB-PER-NBR-BEG > SPACES                      27490000
259500            MOVE HIGH-VALUES TO ASC-KEY-OTB-PER-NBR-END           27500000
259600            PERFORM 4115-OTB-PER-BEG                              27510000
259700        ELSE                                                      27520000
259800           IF  ASC-KEY-OTB-PER-NBR-END > SPACES                   27530000
259900               MOVE LOW-VALUES  TO ASC-KEY-OTB-PER-NBR-BEG        27540000
260000               PERFORM 4116-OTB-PER-END                           27550000
260100           END-IF                                                 27560000
260200        END-IF                                                    27570000
260300     END-IF.                                                      27580000
260400                                                                  27590000
260500     IF  ASC-KEY-DONT-SHIP-BEF-DTE-B > SPACES AND                 27600000
260600         ASC-KEY-DONT-SHIP-BEF-DTE-E > SPACES                     27610000
260700         IF ASC-KEY-DONT-SHIP-BEF-DTE-B =                         27620000
260800            ASC-KEY-DONT-SHIP-BEF-DTE-E                           27630000
260900            PERFORM 4117-DONT-SHIP-BEF-DTE-ONE                    27640000
261000         ELSE                                                     27650000
261100            PERFORM 4118-DONT-SHIP-BEF-DTE-B-E                    27660000
261200         END-IF                                                   27670000
261300     ELSE                                                         27680000
261400        IF  ASC-KEY-DONT-SHIP-BEF-DTE-B > SPACES                  27690000
261500            MOVE HIGH-VALUES TO ASC-KEY-DONT-SHIP-BEF-DTE-E       27700000
261600            PERFORM 4119-DONT-SHIP-BEF-DTE-B                      27710000
261700        ELSE                                                      27720000
261800           IF  ASC-KEY-DONT-SHIP-BEF-DTE-E > SPACES               27730000
261900               MOVE LOW-VALUES TO ASC-KEY-DONT-SHIP-BEF-DTE-E     27740000
262000               PERFORM 4120-DONT-SHIP-BEF-DTE-E                   27750000
262100           END-IF                                                 27760000
262200        END-IF                                                    27770000
262300     END-IF.                                                      27780000
262400                                                                  27790000
262500     IF  ASC-KEY-ENT-NAME-DESC > SPACES                           27800000
262600         SET PS-USE-TENTNME TO TRUE                               27810000
262700         PERFORM 4121-ENT-NAME-DESC.                              27820000
262800                                                                  27830000
262900     IF  ASC-KEY-VEND-STYL-NME > SPACES                           27840000
263000         SET PS-USE-TPURITM TO TRUE                               27850000
263100         PERFORM 4122-VEND-STYL-NME.                              27860000
263200                                                                  27870000
263300     STRING                                                       27880000
263400         ' AND A.VER_STATUS_CDE = '           DELIMITED BY SIZE,  27890000
263500         PC-QUOTE                             DELIMITED BY SIZE,  27900000
263600         'A'                                  DELIMITED BY SIZE,  27910000
263700         PC-QUOTE                             DELIMITED BY SIZE,  27920000
263800                                                                  27930000
263900         ' AND C.VER_STATUS_CDE = '           DELIMITED BY SIZE,  27940000
264000         PC-QUOTE                             DELIMITED BY SIZE,  27950000
264100         'A'                                  DELIMITED BY SIZE,  27960000
264200         PC-QUOTE                             DELIMITED BY SIZE,  27970000
264300                                                                  27980000
264400         ' AND A.PO_CATEG_CDE = '             DELIMITED BY SIZE,  27990000
264500         PC-QUOTE                             DELIMITED BY SIZE,  28000000
264600         'MR'                                 DELIMITED BY SIZE,  28010000
264700         PC-QUOTE                             DELIMITED BY SIZE,  28020000
264800                                                                  28030000
264900         ' AND A.PO_NBR = C.PO_NBR'           DELIMITED BY SIZE,  28040000
265000                                                                  28050000
265100         ' AND E.STATUS_TYP_CDE = '           DELIMITED BY SIZE,  28060000
265200         PC-QUOTE                             DELIMITED BY SIZE,  28070000
265300         'P'                                  DELIMITED BY SIZE,  28080000
265400         PC-QUOTE                             DELIMITED BY SIZE,  28090000
265500                                                                  28100000
265600         ' AND A.STATUS_CDE = E.STATUS_CDE'   DELIMITED BY SIZE   28110000
265700     INTO                                                         28120000
265800         PV-WHERE-CLAUSE                                          28130000
265900     WITH                                                         28140000
266000         POINTER PV-STRING-POINTER-WHERE.                         28150000
266100                                                                  28160000
266200     IF PS-USE-TPURITM OR PS-206-PURITM                           28170000
266300        STRING                                                    28180000
266400            ' AND B.VER_STATUS_CDE = '        DELIMITED BY SIZE,  28190000
266500            PC-QUOTE                          DELIMITED BY SIZE,  28200000
266600            'A'                               DELIMITED BY SIZE,  28210000
266700            PC-QUOTE                          DELIMITED BY SIZE,  28220000
266800                                                                  28230000
266900            ' AND A.PO_NBR = B.PO_NBR'        DELIMITED BY SIZE,  28240000
W24803*           ' AND '                           DELIMITED BY SIZE,  28250051
W24803*           'S.ITM_NBR = B.ITM_NBR'           DELIMITED BY SIZE,  28260051
W24803*           ' AND '                           DELIMITED BY SIZE,  28270051
W24803*           'V.STYL_ID = S.STYL_ID'           DELIMITED BY SIZE   28280051
267000        INTO                                                      28290000
267100            PV-WHERE-CLAUSE                                       28300000
267200        WITH                                                      28310000
267300            POINTER PV-STRING-POINTER-WHERE.                      28320000
267400                                                                  28330000
267500     IF PS-USE-TENTNME                                            28340000
267600        STRING                                                    28350000
267700            ' AND A.ENT_ID = D.ENT_ID'        DELIMITED BY SIZE   28360000
267800        INTO                                                      28370000
267900            PV-WHERE-CLAUSE                                       28380000
268000        WITH                                                      28390000
268100            POINTER PV-STRING-POINTER-WHERE.                      28400000
268200                                                                  28410000
268300     STRING                                                       28420000
268400         ' ORDER BY'                          DELIMITED BY SIZE,  28430000
268500         ' A.PO_NBR'                          DELIMITED BY SIZE   28440000
268600     INTO                                                         28450000
268700         PV-WHERE-CLAUSE                                          28460000
268800     WITH                                                         28470000
268900         POINTER PV-STRING-POINTER-WHERE.                         28480000
269000                                                                  28490000
269100* THE FOLLOWING CODE WILL SETUP THE FROM CLAUSE                   28500000
269200                                                                  28510000
269300     STRING                                                       28520000
269400         PV-TABLE-QUALIFIER                   DELIMITED BY SIZE,  28530000
269500         'TPURCHS A'                          DELIMITED BY SIZE,  28540000
269600         PV-TABLE-QUALIFIER-COMMA             DELIMITED BY SIZE,  28550000
269700         'TPLNSHP C'                          DELIMITED BY SIZE,  28560000
269800         PV-TABLE-QUALIFIER-COMMA             DELIMITED BY SIZE,  28570000
269900         'TSTATCD E'                          DELIMITED BY SIZE   28580000
270000        INTO                                                      28590000
270100            PV-FROM-CLAUSE                                        28600000
270200        WITH                                                      28610000
270300            POINTER PV-STRING-POINTER-FROM.                       28620000
270400                                                                  28630000
270500     IF PS-USE-TPURITM OR PS-206-PURITM                           28640000
270600        STRING                                                    28650000
270700            PV-TABLE-QUALIFIER-COMMA          DELIMITED BY SIZE,  28660000
270800            'TPURITM B'                       DELIMITED BY SIZE,  28670052
W24803            ' LEFT OUTER JOIN '               DELIMITED BY SIZE,  28680052
W24803            PV-TABLE-QUALIFIER                DELIMITED BY SIZE,  28690052
W24803            'XLT_SKU S'                       DELIMITED BY SIZE,  28700052
W24803            ' ON B.ITM_NBR = S.ITM_NBR'       DELIMITED BY SIZE,  28710052
W24803            ' LEFT OUTER JOIN '               DELIMITED BY SIZE,  28720052
W24803            PV-TABLE-QUALIFIER                DELIMITED BY SIZE,  28730052
W24803            'XLT_VND_STYL V'                  DELIMITED BY SIZE,  28740052
W24803            ' ON S.STYL_ID = V.STYL_ID '      DELIMITED BY SIZE   28750051
270900        INTO                                                      28760000
271000            PV-FROM-CLAUSE                                        28770000
271100        WITH                                                      28780000
271200            POINTER PV-STRING-POINTER-FROM.                       28790000
271300                                                                  28800000
271400     IF PS-USE-TENTNME                                            28810000
271500        STRING                                                    28820000
271600            PV-TABLE-QUALIFIER-COMMA          DELIMITED BY SIZE,  28830000
271700            'TENTNME D'                       DELIMITED BY SIZE   28840000
271800        INTO                                                      28850000
271900            PV-FROM-CLAUSE                                        28860000
272000        WITH                                                      28870000
272100            POINTER PV-STRING-POINTER-FROM.                       28880000
272200                                                                  28890000
272300 4102-DEPT-NBR.                                                   28900000
272400                                                                  28910000
272500     IF PV-STRING-POINTER-WHERE > 1                               28920000
272600        STRING                                                    28930000
272700            ' AND '                           DELIMITED BY SIZE   28940000
272800        INTO                                                      28950000
272900            PV-WHERE-CLAUSE                                       28960000
273000        WITH                                                      28970000
273100            POINTER PV-STRING-POINTER-WHERE.                      28980000
273200                                                                  28990000
273300     STRING                                                       29000000
273400         'A.DEPT_NBR = '                      DELIMITED BY SIZE,  29010000
273500         PC-QUOTE                             DELIMITED BY SIZE,  29020000
273600         ASC-KEY-DEPT-NBR                     DELIMITED BY SIZE,  29030000
273700         PC-QUOTE                             DELIMITED BY SIZE   29040000
273800     INTO                                                         29050000
273900         PV-WHERE-CLAUSE                                          29060000
274000     WITH                                                         29070000
274100         POINTER PV-STRING-POINTER-WHERE.                         29080000
274200                                                                  29090000
274300 4103-PO-TYP-CDE.                                                 29100000
274400                                                                  29110000
274500     IF PV-STRING-POINTER-WHERE > 1                               29120000
274600        STRING                                                    29130000
274700            ' AND '                           DELIMITED BY SIZE   29140000
274800        INTO                                                      29150000
274900            PV-WHERE-CLAUSE                                       29160000
275000        WITH                                                      29170000
275100            POINTER PV-STRING-POINTER-WHERE.                      29180000
275200                                                                  29190000
275300     STRING                                                       29200000
275400         'A.PO_TYP_CDE = '                    DELIMITED BY SIZE,  29210000
275500         PC-QUOTE                             DELIMITED BY SIZE,  29220000
275600         ASC-KEY-PO-TYP-CDE                   DELIMITED BY SIZE,  29230000
275700         PC-QUOTE                             DELIMITED BY SIZE   29240000
275800     INTO                                                         29250000
275900         PV-WHERE-CLAUSE                                          29260000
276000     WITH                                                         29270000
276100         POINTER PV-STRING-POINTER-WHERE.                         29280000
276200                                                                  29290000
276300 4104-STATUS-CDE.                                                 29300000
276400                                                                  29310000
276500     IF PV-STRING-POINTER-WHERE > 1                               29320000
276600        STRING                                                    29330000
276700            ' AND '                           DELIMITED BY SIZE   29340000
276800        INTO                                                      29350000
276900            PV-WHERE-CLAUSE                                       29360000
277000        WITH                                                      29370000
277100            POINTER PV-STRING-POINTER-WHERE.                      29380000
277200                                                                  29390000
277300     STRING                                                       29400000
277400         'A.STATUS_CDE = '                    DELIMITED BY SIZE,  29410000
277500         PC-QUOTE                             DELIMITED BY SIZE,  29420000
277600         ASC-KEY-STATUS-CDE                   DELIMITED BY SIZE,  29430000
277700         PC-QUOTE                             DELIMITED BY SIZE   29440000
277800     INTO                                                         29450000
277900         PV-WHERE-CLAUSE                                          29460000
278000     WITH                                                         29470000
278100         POINTER PV-STRING-POINTER-WHERE.                         29480000
278200                                                                  29490000
278300 4105-STATUS-CLS.                                                 29500000
278400                                                                  29510000
278500     IF PV-STRING-POINTER-WHERE > 1                               29520000
278600        STRING                                                    29530000
278700            ' AND '                           DELIMITED BY SIZE   29540000
278800        INTO                                                      29550000
278900            PV-WHERE-CLAUSE                                       29560000
279000        WITH                                                      29570000
279100            POINTER PV-STRING-POINTER-WHERE.                      29580000
279200                                                                  29590000
279300     IF ASC-KEY-STATUS-CLS = 'BTH'                                29600000
279400         STRING                                                   29610000
279500             'E.STATUS_CLS IN ('              DELIMITED BY SIZE,  29620000
279600             PC-QUOTE                         DELIMITED BY SIZE,  29630000
279700             PC-ACT                           DELIMITED BY SIZE,  29640000
279800             PC-QUOTE                         DELIMITED BY SIZE,  29650000
279900             ','                              DELIMITED BY SIZE,  29660000
280000             PC-QUOTE                         DELIMITED BY SIZE,  29670000
280100             PC-CMP                           DELIMITED BY SIZE,  29680000
280200             PC-QUOTE                         DELIMITED BY SIZE,  29690000
280300             ')'                              DELIMITED BY SIZE   29700000
280400         INTO                                                     29710000
280500             PV-WHERE-CLAUSE                                      29720000
280600         WITH                                                     29730000
280700             POINTER PV-STRING-POINTER-WHERE                      29740000
280800     ELSE                                                         29750000
280900         STRING                                                   29760000
281000             'E.STATUS_CLS = '                DELIMITED BY SIZE,  29770000
281100             PC-QUOTE                         DELIMITED BY SIZE,  29780000
281200             ASC-KEY-STATUS-CLS               DELIMITED BY SIZE,  29790000
281300             PC-QUOTE                         DELIMITED BY SIZE   29800000
281400         INTO                                                     29810000
281500             PV-WHERE-CLAUSE                                      29820000
281600         WITH                                                     29830000
281700             POINTER PV-STRING-POINTER-WHERE                      29840000
281800     END-IF.                                                      29850000
281900                                                                  29860000
282000 4107-PIC-AD-IND.                                                 29870000
282100                                                                  29880000
282200     IF PV-STRING-POINTER-WHERE > 1                               29890000
282300        STRING                                                    29900000
282400            ' AND '                           DELIMITED BY SIZE   29910000
282500        INTO                                                      29920000
282600            PV-WHERE-CLAUSE                                       29930000
282700        WITH                                                      29940000
282800            POINTER PV-STRING-POINTER-WHERE.                      29950000
282900                                                                  29960000
283000     STRING                                                       29970000
283100         'B.PIC_ITM_IND = '                   DELIMITED BY SIZE,  29980000
283200         PC-QUOTE                             DELIMITED BY SIZE,  29990000
283300         ASC-KEY-PIC-AD-IND                   DELIMITED BY SIZE,  30000000
283400         PC-QUOTE                             DELIMITED BY SIZE   30010000
283500     INTO                                                         30020000
283600         PV-WHERE-CLAUSE                                          30030000
283700     WITH                                                         30040000
283800         POINTER PV-STRING-POINTER-WHERE.                         30050000
283900                                                                  30060000
W24803 4109-SUB-CL-NBR.                                                 30070000
W24803     IF PV-STRING-POINTER-WHERE > 1                               30080000
W24803       STRING                                                     30090000
W24803           ' AND '                            DELIMITED BY SIZE   30100000
W24803       INTO                                                       30110000
W24803         PV-WHERE-CLAUSE                                          30120000
W24803       WITH                                                       30130000
W24803         POINTER PV-STRING-POINTER-WHERE                          30140000
W24803     END-IF.                                                      30150000
W24803                                                                  30160000
W24803     IF ASC-KEY-MAJ-CL-NBR > ZERO                                 30170000
W24803         STRING                                                   30180000
W24803             'V.MAJ_CL_NBR = '                DELIMITED BY SIZE,  30190000
W24803              ASC-KEY-MAJ-CL-NBR              DELIMITED BY SIZE,  30200000
W24803             ' AND '                          DELIMITED BY SIZE,  30210000
W24803             'V.SUB_CL_NBR = '                DELIMITED BY SIZE,  30220000
W24803              ASC-KEY-SUB-CL-NBR              DELIMITED BY SIZE   30230000
W24803         INTO                                                     30240000
W24803              PV-WHERE-CLAUSE                                     30250000
W24803         WITH                                                     30260000
W24803              POINTER PV-STRING-POINTER-WHERE                     30270000
W24803     ELSE                                                         30280000
W24803         STRING                                                   30290000
W24803             'V.SUB_CL_NBR = '                DELIMITED BY SIZE,  30300000
W24803              ASC-KEY-SUB-CL-NBR              DELIMITED BY SIZE   30310000
W24803         INTO                                                     30320000
W24803              PV-WHERE-CLAUSE                                     30330000
W24803         WITH                                                     30340000
W24803              POINTER PV-STRING-POINTER-WHERE                     30350000
W24803     END-IF.                                                      30360000
W24803*                                                                 30370000
W24803 4110-MAJ-CL-NBR.                                                 30380000
W24803*                                                                 30390000
W24803     IF PV-STRING-POINTER-WHERE > 1                               30400000
W24803         STRING                                                   30410000
W24803             ' AND '                          DELIMITED BY SIZE   30420000
W24803         INTO                                                     30430000
W24803              PV-WHERE-CLAUSE                                     30440000
W24803         WITH                                                     30450000
W24803              POINTER PV-STRING-POINTER-WHERE                     30460000
W24803     END-IF.                                                      30470000
W24803                                                                  30480000
W24803     STRING                                                       30490000
W24803             'V.MAJ_CL_NBR = '                DELIMITED BY SIZE,  30500000
W24803              ASC-KEY-MAJ-CL-NBR              DELIMITED BY SIZE   30510000
W24803     INTO                                                         30520000
W24803              PV-WHERE-CLAUSE                                     30530000
W24803     WITH                                                         30540000
W24803              POINTER PV-STRING-POINTER-WHERE.                    30550000
W24803                                                                  30560000
288500 4112-AD-EVNT-DTE.                                                30570000
288600                                                                  30580000
288700     IF PV-STRING-POINTER-WHERE > 1                               30590000
288800        STRING                                                    30600000
288900            ' AND '                           DELIMITED BY SIZE   30610000
289000        INTO                                                      30620000
289100            PV-WHERE-CLAUSE                                       30630000
289200        WITH                                                      30640000
289300            POINTER PV-STRING-POINTER-WHERE.                      30650000
289400                                                                  30660000
289500     STRING                                                       30670000
289600         'B.AD_EVNT_DTE = '                   DELIMITED BY SIZE,  30680000
289700         PC-QUOTE                             DELIMITED BY SIZE,  30690000
289800         ASC-KEY-AD-EVNT-DTE                  DELIMITED BY SIZE,  30700000
289900         PC-QUOTE                             DELIMITED BY SIZE   30710000
290000     INTO                                                         30720000
290100         PV-WHERE-CLAUSE                                          30730000
290200     WITH                                                         30740000
290300         POINTER PV-STRING-POINTER-WHERE.                         30750000
290400                                                                  30760000
290500 4113-OTB-PER-ONE.                                                30770000
290600                                                                  30780000
290700     IF PV-STRING-POINTER-WHERE > 1                               30790000
290800        STRING                                                    30800000
290900            ' AND '                           DELIMITED BY SIZE   30810000
291000        INTO                                                      30820000
291100            PV-WHERE-CLAUSE                                       30830000
291200        WITH                                                      30840000
291300            POINTER PV-STRING-POINTER-WHERE.                      30850000
291400                                                                  30860000
291500     STRING                                                       30870000
291600         'A.OTB_PER_NBR = '                   DELIMITED BY SIZE,  30880000
291700         PC-QUOTE                             DELIMITED BY SIZE,  30890000
291800         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  30900000
291900         PC-QUOTE                             DELIMITED BY SIZE   30910000
292000     INTO                                                         30920000
292100         PV-WHERE-CLAUSE                                          30930000
292200     WITH                                                         30940000
292300         POINTER PV-STRING-POINTER-WHERE.                         30950000
292400                                                                  30960000
292500 4114-OTB-PER-NBR-BEG-END.                                        30970000
292600                                                                  30980000
292700     IF PV-STRING-POINTER-WHERE > 1                               30990000
292800        STRING                                                    31000000
292900            ' AND '                           DELIMITED BY SIZE   31010000
293000        INTO                                                      31020000
293100            PV-WHERE-CLAUSE                                       31030000
293200        WITH                                                      31040000
293300            POINTER PV-STRING-POINTER-WHERE.                      31050000
293400                                                                  31060000
293500     STRING                                                       31070000
293600         '(A.OTB_PER_NBR BETWEEN '            DELIMITED BY SIZE,  31080000
293700         PC-QUOTE                             DELIMITED BY SIZE,  31090000
293800         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  31100000
293900         PC-QUOTE                             DELIMITED BY SIZE,  31110000
294000         ' AND '                              DELIMITED BY SIZE,  31120000
294100         PC-QUOTE                             DELIMITED BY SIZE,  31130000
294200         ASC-KEY-OTB-PER-NBR-END              DELIMITED BY SIZE,  31140000
294300         PC-QUOTE                             DELIMITED BY SIZE,  31150000
294400         ')'                                  DELIMITED BY SIZE   31160000
294500     INTO                                                         31170000
294600         PV-WHERE-CLAUSE                                          31180000
294700     WITH                                                         31190000
294800         POINTER PV-STRING-POINTER-WHERE.                         31200000
294900                                                                  31210000
295000 4115-OTB-PER-BEG.                                                31220000
295100                                                                  31230000
295200     IF PV-STRING-POINTER-WHERE > 1                               31240000
295300        STRING                                                    31250000
295400            ' AND '                           DELIMITED BY SIZE   31260000
295500        INTO                                                      31270000
295600            PV-WHERE-CLAUSE                                       31280000
295700        WITH                                                      31290000
295800            POINTER PV-STRING-POINTER-WHERE.                      31300000
295900                                                                  31310000
296000     STRING                                                       31320000
296100         '(A.OTB_PER_NBR BETWEEN '            DELIMITED BY SIZE,  31330000
296200         PC-QUOTE                             DELIMITED BY SIZE,  31340000
296300         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  31350000
296400         PC-QUOTE                             DELIMITED BY SIZE,  31360000
296500         ' AND '                              DELIMITED BY SIZE,  31370000
296600         PC-QUOTE                             DELIMITED BY SIZE,  31380000
296700         ASC-KEY-OTB-PER-NBR-END              DELIMITED BY SIZE,  31390000
296800         PC-QUOTE                             DELIMITED BY SIZE,  31400000
296900         ')'                                  DELIMITED BY SIZE   31410000
297000     INTO                                                         31420000
297100         PV-WHERE-CLAUSE                                          31430000
297200     WITH                                                         31440000
297300         POINTER PV-STRING-POINTER-WHERE.                         31450000
297400                                                                  31460000
297500 4116-OTB-PER-END.                                                31470000
297600                                                                  31480000
297700     IF PV-STRING-POINTER-WHERE > 1                               31490000
297800        STRING                                                    31500000
297900            ' AND '                           DELIMITED BY SIZE   31510000
298000        INTO                                                      31520000
298100            PV-WHERE-CLAUSE                                       31530000
298200        WITH                                                      31540000
298300            POINTER PV-STRING-POINTER-WHERE.                      31550000
298400                                                                  31560000
298500     STRING                                                       31570000
298600         '(A.OTB_PER_NBR BETWEEN '            DELIMITED BY SIZE,  31580000
298700         PC-QUOTE                             DELIMITED BY SIZE,  31590000
298800         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  31600000
298900         PC-QUOTE                             DELIMITED BY SIZE,  31610000
299000         ' AND '                              DELIMITED BY SIZE,  31620000
299100         PC-QUOTE                             DELIMITED BY SIZE,  31630000
299200         ASC-KEY-OTB-PER-NBR-END              DELIMITED BY SIZE,  31640000
299300         PC-QUOTE                             DELIMITED BY SIZE,  31650000
299400         ')'                                  DELIMITED BY SIZE   31660000
299500     INTO                                                         31670000
299600         PV-WHERE-CLAUSE                                          31680000
299700     WITH                                                         31690000
299800         POINTER PV-STRING-POINTER-WHERE.                         31700000
299900                                                                  31710000
300000 4117-DONT-SHIP-BEF-DTE-ONE.                                      31720000
300100                                                                  31730000
300200     IF PV-STRING-POINTER-WHERE > 1                               31740000
300300        STRING                                                    31750000
300400            ' AND '                           DELIMITED BY SIZE   31760000
300500        INTO                                                      31770000
300600            PV-WHERE-CLAUSE                                       31780000
300700        WITH                                                      31790000
300800            POINTER PV-STRING-POINTER-WHERE.                      31800000
300900                                                                  31810000
301000     STRING                                                       31820000
301100         'C.DONT_SHIP_BEF_DTE = '             DELIMITED BY SIZE,  31830000
301200         PC-QUOTE                             DELIMITED BY SIZE,  31840000
301300         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  31850000
301400         PC-QUOTE                             DELIMITED BY SIZE   31860000
301500     INTO                                                         31870000
301600         PV-WHERE-CLAUSE                                          31880000
301700     WITH                                                         31890000
301800         POINTER PV-STRING-POINTER-WHERE.                         31900000
301900                                                                  31910000
302000 4118-DONT-SHIP-BEF-DTE-B-E.                                      31920000
302100                                                                  31930000
302200     IF PV-STRING-POINTER-WHERE > 1                               31940000
302300        STRING                                                    31950000
302400            ' AND '                           DELIMITED BY SIZE   31960000
302500        INTO                                                      31970000
302600            PV-WHERE-CLAUSE                                       31980000
302700        WITH                                                      31990000
302800            POINTER PV-STRING-POINTER-WHERE.                      32000000
302900                                                                  32010000
303000     STRING                                                       32020000
303100         '(C.DONT_SHIP_BEF_DTE BETWEEN '      DELIMITED BY SIZE,  32030000
303200         PC-QUOTE                             DELIMITED BY SIZE,  32040000
303300         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  32050000
303400         PC-QUOTE                             DELIMITED BY SIZE,  32060000
303500         ' AND '                              DELIMITED BY SIZE,  32070000
303600         PC-QUOTE                             DELIMITED BY SIZE,  32080000
303700         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  32090000
303800         PC-QUOTE                             DELIMITED BY SIZE,  32100000
303900         ')'                                  DELIMITED BY SIZE   32110000
304000     INTO                                                         32120000
304100         PV-WHERE-CLAUSE                                          32130000
304200     WITH                                                         32140000
304300         POINTER PV-STRING-POINTER-WHERE.                         32150000
304400                                                                  32160000
304500 4119-DONT-SHIP-BEF-DTE-B.                                        32170000
304600                                                                  32180000
304700     IF PV-STRING-POINTER-WHERE > 1                               32190000
304800        STRING                                                    32200000
304900            ' AND '                           DELIMITED BY SIZE   32210000
305000        INTO                                                      32220000
305100            PV-WHERE-CLAUSE                                       32230000
305200        WITH                                                      32240000
305300            POINTER PV-STRING-POINTER-WHERE.                      32250000
305400                                                                  32260000
305500     STRING                                                       32270000
305600         '(C.DONT_SHIP_BEF_DTE BETWEEN '      DELIMITED BY SIZE,  32280000
305700         PC-QUOTE                             DELIMITED BY SIZE,  32290000
305800         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  32300000
305900         PC-QUOTE                             DELIMITED BY SIZE,  32310000
306000         ' AND '                              DELIMITED BY SIZE,  32320000
306100         PC-QUOTE                             DELIMITED BY SIZE,  32330000
306200         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  32340000
306300         PC-QUOTE                             DELIMITED BY SIZE,  32350000
306400         ')'                                  DELIMITED BY SIZE   32360000
306500     INTO                                                         32370000
306600         PV-WHERE-CLAUSE                                          32380000
306700     WITH                                                         32390000
306800         POINTER PV-STRING-POINTER-WHERE.                         32400000
306900                                                                  32410000
307000 4120-DONT-SHIP-BEF-DTE-E.                                        32420000
307100                                                                  32430000
307200     IF PV-STRING-POINTER-WHERE > 1                               32440000
307300        STRING                                                    32450000
307400            ' AND '                           DELIMITED BY SIZE   32460000
307500        INTO                                                      32470000
307600            PV-WHERE-CLAUSE                                       32480000
307700        WITH                                                      32490000
307800            POINTER PV-STRING-POINTER-WHERE.                      32500000
307900                                                                  32510000
308000     STRING                                                       32520000
308100         '(C.DONT_SHIP_BEF_DTE BETWEEN '      DELIMITED BY SIZE,  32530000
308200         PC-QUOTE                             DELIMITED BY SIZE,  32540000
308300         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  32550000
308400         PC-QUOTE                             DELIMITED BY SIZE,  32560000
308500         ' AND '                              DELIMITED BY SIZE,  32570000
308600         PC-QUOTE                             DELIMITED BY SIZE,  32580000
308700         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  32590000
308800         PC-QUOTE                             DELIMITED BY SIZE,  32600000
308900         ')'                                  DELIMITED BY SIZE   32610000
309000     INTO                                                         32620000
309100         PV-WHERE-CLAUSE                                          32630000
309200     WITH                                                         32640000
309300         POINTER PV-STRING-POINTER-WHERE.                         32650000
309400                                                                  32660000
309500 4121-ENT-NAME-DESC.                                              32670000
309600                                                                  32680000
309700*TALLYING CODE                                                    32690000
309800     IF PV-STRING-POINTER-WHERE > 1                               32700000
309900        STRING                                                    32710000
310000            ' AND '                           DELIMITED BY SIZE   32720000
310100        INTO                                                      32730000
310200            PV-WHERE-CLAUSE                                       32740000
310300        WITH                                                      32750000
310400            POINTER PV-STRING-POINTER-WHERE.                      32760000
310500                                                                  32770000
310600     MOVE ZERO TO PV-TALLY-1                                      32780000
310700                  PV-TALLY-2.                                     32790000
310800                                                                  32800000
310900     MOVE ASC-KEY-ENT-NAME-DESC TO PV-ENT-NAME-DESC.              32810000
311000     INSPECT PV-ENT-NAME-DESC                                     32820000
311100        TALLYING PV-TALLY-1 FOR ALL '*'                           32830000
311200                 PV-TALLY-2 FOR ALL '?'                           32840000
311300        REPLACING ALL '*' BY '%'                                  32850000
311400                  ALL '?' BY '_'                                  32860000
311500                  ALL '''' BY '_'.                                32870000
311600                                                                  32880000
311700     IF PV-TALLY-1 + PV-TALLY-2 = ZERO                            32890000
311800        STRING                                                    32900000
311900            'D.ENT_NAME_DESC LIKE '            DELIMITED BY SIZE, 32910000
312000            PC-QUOTE                           DELIMITED BY SIZE, 32920000
312100            PV-ENT-NAME-DESC                   DELIMITED BY '  ', 32930000
312200            PC-PERCENT                         DELIMITED BY SIZE, 32940000
312300            PC-QUOTE                           DELIMITED BY SIZE  32950000
312400        INTO                                                      32960000
312500            PV-WHERE-CLAUSE                                       32970000
312600        WITH                                                      32980000
312700            POINTER PV-STRING-POINTER-WHERE                       32990000
312800     ELSE                                                         33000000
312900        STRING                                                    33010000
313000            'D.ENT_NAME_DESC LIKE '            DELIMITED BY SIZE, 33020000
313100            PC-QUOTE                           DELIMITED BY SIZE, 33030000
313200            PV-ENT-NAME-DESC                   DELIMITED BY '  ', 33040000
313300            PC-QUOTE                           DELIMITED BY SIZE  33050000
313400        INTO                                                      33060000
313500            PV-WHERE-CLAUSE                                       33070000
313600        WITH                                                      33080000
313700            POINTER PV-STRING-POINTER-WHERE                       33090000
313800     END-IF.                                                      33100000
313900                                                                  33110000
314000 4122-VEND-STYL-NME.                                              33120000
314100                                                                  33130000
314200     IF PV-STRING-POINTER-WHERE > 1                               33140000
314300        STRING                                                    33150000
314400            ' AND '                           DELIMITED BY SIZE   33160000
314500        INTO                                                      33170000
314600            PV-WHERE-CLAUSE                                       33180000
314700        WITH                                                      33190000
314800            POINTER PV-STRING-POINTER-WHERE.                      33200000
314900                                                                  33210000
315000     MOVE ZERO TO PV-TALLY-1                                      33220000
315100                  PV-TALLY-2.                                     33230000
315200                                                                  33240000
315300     MOVE ASC-KEY-VEND-STYL-NME TO PV-VEND-STYL-NME.              33250000
315400     INSPECT PV-VEND-STYL-NME                                     33260000
315500        TALLYING PV-TALLY-1 FOR ALL '*'                           33270000
315600                 PV-TALLY-2 FOR ALL '?'                           33280000
315700        REPLACING ALL '*' BY '%'                                  33290000
315800                  ALL '?' BY '_'                                  33300000
315900                  ALL '''' BY '_'.                                33310000
316000                                                                  33320000
W24803     MOVE PV-VEND-STYL-NME TO XLT00004-VS-NBR                     33330000
W24803                                                                  33340000
316100     IF PV-TALLY-1 + PV-TALLY-2 = ZERO                            33350000
316200        STRING                                                    33360000
W24803            'V.VS_NBR LIKE '                   DELIMITED BY SIZE, 33370000
316400            PC-QUOTE                           DELIMITED BY SIZE, 33380000
W24803            XLT00004-VS-NBR                    DELIMITED BY '  ', 33390000
316600            PC-PERCENT                         DELIMITED BY SIZE, 33400000
316700            PC-QUOTE                           DELIMITED BY SIZE  33410000
316800        INTO                                                      33420000
316900            PV-WHERE-CLAUSE                                       33430000
317000        WITH                                                      33440000
317100            POINTER PV-STRING-POINTER-WHERE                       33450000
317200     ELSE                                                         33460000
317300        STRING                                                    33470000
W24803            'V.VS_NBR LIKE '                   DELIMITED BY SIZE, 33480000
317500            PC-QUOTE                           DELIMITED BY SIZE, 33490000
W24803            XLT00004-VS-NBR                    DELIMITED BY '  ', 33500000
317700            PC-QUOTE                           DELIMITED BY SIZE  33510000
317800        INTO                                                      33520000
317900            PV-WHERE-CLAUSE                                       33530000
318000        WITH                                                      33540000
318100            POINTER PV-STRING-POINTER-WHERE                       33550000
318200     END-IF.                                                      33560000
318300                                                                  33570000
318400/                                                                 33580000
318500*----------------------------------------------------------------*33590000
318600*    STRING TOGETHER THE CODE TO BUILD DYNAMIC SQL CURSOR        *33600000
318700*----------------------------------------------------------------*33610000
318800                                                                  33620000
318900 4150-COMBINE-SQL.                                                33630000
319000                                                                  33640000
319100     MOVE SPACES TO PV-SQL-STMT-TEXT.                             33650000
319200                                                                  33660000
319300     STRING PV-BUILD-SELECT-STMT              DELIMITED BY SIZE,  33670000
319400            ' FROM '                          DELIMITED BY SIZE,  33680000
319500            PV-FROM-CLAUSE                    DELIMITED BY '  ',  33690000
319600            ' WHERE '                         DELIMITED BY SIZE,  33700000
319700            PV-WHERE-CLAUSE                   DELIMITED BY '  '   33710000
319800     INTO                                                         33720000
319900         PV-SQL-STMT-TEXT.                                        33730000
320000                                                                  33740000
320100     ADD PV-SELECT-BYTES                                          33750000
320200         PC-CNT-6                                                 33760000
320300         PV-STRING-POINTER-FROM                                   33770000
320400         PC-CNT-7                                                 33780000
320500         PV-STRING-POINTER-WHERE                                  33790000
320600         PC-CNT-MINUS-2                                           33800000
320700     GIVING                                                       33810000
320800         PV-SQL-STMT-LEN.                                         33820000
320900/                                                                 33830000
321000*----------------------------------------------------------------*33840000
321100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *33850000
321200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *33860000
321300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *33870000
321400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *33880000
321500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *33890000
321600*                                                                *33900000
321700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *33910000
321800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *33920000
321900*    UPON INITIALIZATION.                                        *33930000
322000*----------------------------------------------------------------*33940000
322100                                                                  33950000
322200 4300-READ-ITEMS-FROM-DB.                                         33960000
322300                                                                  33970000
322400                                                                  33980000
322500     PERFORM                                                      33990000
322600         VARYING PV-READ-COUNT                                    34000000
322700         FROM 1 BY 1                                              34010000
322800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    34020000
322900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         34030000
323000                                                                  34040000
323100         PERFORM 4310-FETCH                                       34050000
323200     END-PERFORM.                                                 34060000
323300                                                                  34070000
323400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          34080000
323500         MOVE +1                   TO ASC-BLK-SUB                 34090000
323600         PERFORM 5100-WRITE-TEMP-STORAGE                          34100000
323700         ADD +1                    TO ASC-BLK-SUB                 34110000
323800         PERFORM 5100-WRITE-TEMP-STORAGE                          34120000
323900                                                                  34130000
324000         MOVE 1                    TO ASC-BLK-SUB                 34140000
324100                                      PV-BLOCK-NUMBER             34150000
324200         PERFORM 4410-READ-TEMP-STORAGE                           34160000
324300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             34170000
324400             MOVE 2                TO ASC-BLK-SUB                 34180000
324500                                      PV-BLOCK-NUMBER             34190000
324600             PERFORM 4410-READ-TEMP-STORAGE                       34200000
324700         END-IF                                                   34210000
324800     END-IF.                                                      34220000
324900                                                                  34230000
325000*----------------------------------------------------------------*34240000
325100*    FETCH A VENDOR ROW                                          *34250000
325200*----------------------------------------------------------------*34260000
325300                                                                  34270000
325400 4310-FETCH.                                                      34280000
325500                                                                  34290000
325600                                                                  34300000
325700     MOVE PURCHS-PO-NBR TO PV-HOLD-PO-NBR                         34310000
325800     EXEC SQL                                                     34320000
325900         FETCH PO-CSR                                             34330000
326000          INTO :PURCHS-PO-NBR,                                    34340000
326100               :PURCHS-OTB-PER-NBR,                               34350000
326200               :PURCHS-DEPT-NBR,                                  34360000
326300               :PURCHS-ENT-ID,                                    34370000
326400               :PLNSHP-DONT-SHIP-BEF-DTE,                         34380000
W24803               :XLT00003-ITM-NBR:PV-IND-VAR1,                     34390051
W24803               :XLT00003-GP-CDE:PV-IND-VAR2                       34400051
326700     END-EXEC.                                                    34410000
326800                                                                  34420000
326900*---------------------------------------------------------------* 34430000
327000* WHEN SQLCODE =0, WILL CHECK TO SEE IF PO NBR = 0, IF SO       * 34440000
327100* IT IS THE FIRST TIME THROUGH, IF PO NBR = HOLD PO NBR         * 34450000
327200* IT IS STILL ON THE SAME PO CHECKING THE LINES, IF PO NBR NOT  * 34460000
327300* = TO HOLD PO NBR IT IS DONE PROCESSING THE CURRENT PO AND     * 34470000
327400* PROGRAM WILL PROCESS THE DATA AND THEN START WITH THE NEXT PO * 34480000
327500*---------------------------------------------------------------* 34490000
327600                                                                  34500000
327700     EVALUATE TRUE                                                34510000
327800         WHEN SQLCODE = +0                                        34520000
327900              IF PV-HOLD-PO-NBR = 0                               34530000
328000                 MOVE PURCHS-PO-NBR TO PV-HOLD-PO-NBR             34540000
328100               END-IF                                             34550000
328200               IF PV-HOLD-PO-NBR = PURCHS-PO-NBR                  34560000
328300                 CONTINUE                                         34570000
328400               ELSE                                               34580000
328600                   IF PS-GC-MATCH                                 34590000
328700                      PERFORM 4311-PROCESS-DATA                   34600000
328800                   ELSE                                           34610000
328900                      CONTINUE                                    34620000
329000                   END-IF                                         34630000
W24803                 MOVE PURCHS-PO-NBR TO PV-HOLD-PO-NBR             34640000
329300                 SET PS-GC-NO-MATCH TO TRUE                       34650000
329400              END-IF                                              34660000
W24803              MOVE XLT00003-ITM-NBR TO PV-HOLD-ORIG-ITEM-NBR      34670000
W24803              IF  PO017-GROUP-CODE = XLT00003-GP-CDE              34680051
W24803              AND XLT00003-ITM-NBR > 0                            34690051
W24803                  PERFORM 4395-GET-ITEM-DATA                      34700000
W24803              END-IF                                              34710000
331500         WHEN SQLCODE = +100                                      34720000
331700                IF PS-GC-MATCH                                    34730000
331800                    PERFORM 4311-PROCESS-DATA                     34740000
331900                 ELSE                                             34750000
332000                    CONTINUE                                      34760000
332100                 END-IF                                           34770000
332300              SET ASC-NO-ITEMS-LEFT-ON-DB                         34780000
332400                                   TO TRUE                        34790000
332500         WHEN SQLWARN0 NOT = SPACE                                34800000
332600         WHEN SQLCODE < +0                                        34810000
332700         WHEN SQLCODE > +0                                        34820000
332800              MOVE '4310-FETCH-CURSOR'                            34830000
332900                                   TO DP013-PARAGRAPH             34840000
333000              MOVE 'FETCH PO CURSOR'                              34850000
333100                                   TO DP013-MESSAGE-TEXT (1)      34860000
333200              MOVE SQLCA           TO DP013-SQLCA                 34870000
333300              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    34880000
333400              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    34890000
333500              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    34900000
333600              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    34910000
W24803              MOVE 'XLT_SKU'       TO DP013-DB2-TABLE-NAME (5)    34920000
333700              SET DP013-DB2-ABEND  TO TRUE                        34930000
333800              PERFORM DP013-0000-PROCESS-ABEND                    34940000
333900     END-EVALUATE.                                                34950000
334000                                                                  34960000
334100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34970000
334200         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             34980000
334300         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             34990000
334400                                   TO DP013-MESSAGE-TEXT (1)      35000000
334500         MOVE SQLCA                TO DP013-SQLCA                 35010000
334600         SET DP013-DB2-ABEND                                      35020000
334700             DP013-XCTL-DISPLAY-RESTART                           35030000
334800                                   TO TRUE                        35040000
334900         PERFORM DP013-0000-PROCESS-ABEND                         35050000
335000     END-IF.                                                      35060000
335100                                                                  35070000
335200/                                                                 35080000
335300*----------------------------------------------------------------*35090000
335400*    PROCESS DATA                                                *35100000
335500*    CALCULATES ALL TOTALS AND MOVES DATA TO ASC FIELDS          *35110000
335600*----------------------------------------------------------------*35120000
335700 4311-PROCESS-DATA.                                               35130000
335800                                                                  35140000
335900         MOVE 'N'                  TO PS-SKIP-SW                  35150000
336000         SET PS-GC-NO-MATCH        TO TRUE                        35160000
336100                                                                  35170000
336200         IF  ASC-ITEMS-LEFT-ON-DB                                 35180000
336300         AND PS-DONT-SKIP                                         35190000
336400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                35200000
336500                 ADD +1            TO ASC-ITEM-SUB                35210000
336600             ELSE                                                 35220000
336700                 ADD +1            TO ASC-BLK-SUB                 35230000
336800                 MOVE +1           TO ASC-ITEM-SUB                35240000
336900                                                                  35250000
337000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         35260000
337100                     MOVE +1       TO ASC-BLK-SUB                 35270000
337200                     SET ASC-BLOCK-MODIFIED (1)                   35280000
337300                                   TO TRUE                        35290000
337400                     PERFORM 5100-WRITE-TEMP-STORAGE              35300000
337500                     MOVE ASC-BLOCK-ENTRIES                       35310000
337600                               (PC-MAX-BLOCKS-IN-ARRAY)           35320000
337700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 35330000
337800                     ADD +1        TO ASC-BLK-SUB                 35340000
337900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   35350000
338000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      35360000
338100                                   TO TRUE                        35370000
338200                 END-IF                                           35380000
338300             END-IF                                               35390000
338400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    35400000
338500             MOVE ASC-NUMBER-OF-ITEMS-READ                        35410000
338600                                   TO ASC-LIST-ITEM-NUMBER        35420000
338700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35430000
338800             MOVE PV-HOLD-PO-NBR TO ASC-PO-NBR                    35440000
338900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35450000
339000             PERFORM 4320-GET-PO-INFO                             35460000
339100             IF ENTNME-ENT-ID NOT = PURCHS-ENT-ID                 35470000
339200                PERFORM 4330-GET-VENDOR-SHORT-NAME                35480000
339300                IF  SQLCODE = +100                                35490000
339400                    PERFORM 4335-GET-VENDOR-PRIMARY-NAME          35500000
339500                END-IF                                            35510000
339600             END-IF                                               35520000
339700             PERFORM 4340-GET-SHIPMENT-INFO                       35530000
339800             PERFORM 4396-GET-MIN-AD-DATE                         35540000
339900                                                                  35550000
340000             MOVE +0               TO PV-DB2-COUNT2               35560000
340100             PERFORM 4380-CHECK-IN-PROCESS                        35570000
340200                                                                  35580000
340300             IF PV-DB2-COUNT2 > 0                                 35590000
340400               MOVE 'Y'            TO ASC-IP-IND                  35600000
340500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35610000
340600             ELSE                                                 35620000
340700               MOVE 'N'            TO ASC-IP-IND                  35630000
340800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35640000
340900             END-IF                                               35650000
341000                                                                  35660000
341100             MOVE PV-HOLD-GROUP-CODE TO ASC-GROUP-CDE             35670000
341200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35680000
341300                                                                  35690000
341400             MOVE ENTNME-ENT-NAME-DESC                            35700000
341500                                   TO ASC-VENDOR-NAME             35710000
341600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35720000
341700             MOVE PV-DONT-SHIP-BEF-DTE                            35730000
341800                                   TO ASC-SHIP-DATE               35740000
341900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35750000
342000             MOVE PV-CAN-IFNOT-SHIP-DTE                           35760000
342100                                   TO ASC-CANCEL-DATE             35770000
342200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35780000
342300             MOVE PV-TOT-PUR-TOT-VAL-RTL-AMT                      35790000
342400                                   TO ASC-DOLLARS-ORDERED         35800000
342500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35810000
342600             MOVE PV-TOT-DOLLARS-RECEIVED                         35820000
342700                                   TO ASC-DOLLARS-RECEIVED        35830000
342800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35840000
342900             IF PV-TOT-PUR-TOT-VAL-RTL-AMT = 0                    35850000
343000                MOVE 0             TO ASC-DOLLARS-RCVD-PCT        35860000
343100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35870000
343200             ELSE                                                 35880000
343300                COMPUTE PV-PCT-AREA                               35890000
343400                  =    (PV-TOT-DOLLARS-RECEIVED                   35900000
343500                  /     PV-TOT-PUR-TOT-VAL-RTL-AMT)               35910000
343600                  *     100                                       35920000
343700                MOVE PV-PCT-AREA   TO ASC-DOLLARS-RCVD-PCT        35930000
343800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  35940000
343900             END-IF                                               35950000
344000             INITIALIZE PV-TOT-PUR-TOT-VAL-RTL-AMT                35960000
344100             INITIALIZE PV-TOT-DOLLARS-RECEIVED                   35970000
344200             MOVE PV-TOT-PURITM-UNT-QTY                           35980000
344300                                   TO ASC-TOT-UNIT-ORDERED        35990000
344400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36000000
344500             MOVE PV-TOT-UNITS-RECEIVED                           36010000
344600                                   TO ASC-TOT-UNIT-RCVD           36020000
344700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36030000
344800             IF PV-TOT-PURITM-UNT-QTY = 0                         36040000
344900                MOVE 0             TO ASC-TOT-UNIT-RCVD-PCT       36050000
345000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36060000
345100             ELSE                                                 36070000
345200                COMPUTE PV-PCT-AREA                               36080000
345300                  =                                               36090000
345400                  (PV-TOT-UNITS-RECEIVED / PV-TOT-PURITM-UNT-QTY) 36100000
345500                  *   100                                         36110000
345600                MOVE PV-PCT-AREA   TO ASC-TOT-UNIT-RCVD-PCT       36120000
345700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36130000
345800             END-IF                                               36140000
345900             INITIALIZE PV-TOT-PURITM-UNT-QTY                     36150000
346000             INITIALIZE PV-TOT-UNITS-RECEIVED                     36160000
346100                                                                  36170000
346200             COMPUTE ASC-DOLLAR-ORD-TOT = ASC-DOLLAR-ORD-TOT +    36180000
346300                   ASC-DOLLARS-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB) 36190000
346400                                                                  36200000
346500             COMPUTE ASC-DOLLAR-REC-TOT = ASC-DOLLAR-REC-TOT +    36210000
346600                   ASC-DOLLARS-RECEIVED (ASC-BLK-SUB ASC-ITEM-SUB)36220000
346700                                                                  36230000
346800             COMPUTE ASC-UNIT-ORD-TOT = ASC-UNIT-ORD-TOT +        36240000
346900                   ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)36250000
347000                                                                  36260000
347100             COMPUTE ASC-UNIT-REC-TOT   = ASC-UNIT-REC-TOT +      36270000
347200                   ASC-TOT-UNIT-RCVD    (ASC-BLK-SUB ASC-ITEM-SUB)36280000
347300                                                                  36290000
347400             MOVE PV-AD-EVNT-DTE   TO ASC-AD-EVNT-DTE             36300000
347500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36310000
347600                                                                  36320000
347700         END-IF.                                                  36330000
347800/                                                                 36340000
363000*----------------------------------------------------------------*36350000
363100* GET PO INFORMATION                                             *36360000
363200*----------------------------------------------------------------*36370000
363300                                                                  36380000
363400 4320-GET-PO-INFO.                                                36390000
363500                                                                  36400000
363600     EXEC SQL                                                     36410000
363700         SELECT ENT_ID                                            36420000
363800          INTO  :PURCHS-ENT-ID                                    36430000
363900          FROM  TPURCHS                                           36440000
364000          WHERE PO_NBR         = :PV-HOLD-PO-NBR                  36450000
364100            AND VER_STATUS_CDE = 'A'                              36460000
364200            AND PO_CATEG_CDE   = 'MR'                             36470000
364300     END-EXEC.                                                    36480000
364400                                                                  36490000
364500     EVALUATE TRUE                                                36500000
364600         WHEN SQLCODE = +0                                        36510000
364700         WHEN SQLCODE = -904                                      36520000
364800         WHEN SQLCODE = -913                                      36530000
364900             CONTINUE                                             36540000
365000         WHEN SQLWARN0 NOT = SPACE                                36550000
365100         WHEN SQLCODE < +0                                        36560000
365200         WHEN SQLCODE > +0                                        36570000
365300             MOVE '4320-GET-PO-INFO'                              36580000
365400                                 TO DP013-PARAGRAPH               36590000
365500             MOVE 'SELECT ON PURCHASE HEADER TABLE'               36600000
365600                                 TO DP013-MESSAGE-TEXT (1)        36610000
365700             MOVE SQLCA          TO DP013-SQLCA                   36620000
365800             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      36630000
365900                 SET DP013-DB2-ABEND                              36640000
366000                     DP013-XCTL-DISPLAY-RESTART                   36650000
366100                                 TO TRUE                          36660000
366200             PERFORM DP013-0000-PROCESS-ABEND                     36670000
366300     END-EVALUATE.                                                36680000
366400                                                                  36690000
366500/                                                                 36700000
366600*----------------------------------------------------------------*36710000
366700* GET THE VENDOR SHORT NAME                                      *36720000
366800*----------------------------------------------------------------*36730000
366900                                                                  36740000
367000 4330-GET-VENDOR-SHORT-NAME.                                      36750000
367100                                                                  36760000
367200     EXEC SQL                                                     36770000
367300         SELECT ENT_NAME_DESC                                     36780000
367400              , ENT_ID                                            36790000
367500          INTO  :ENTNME-ENT-NAME-DESC                             36800000
367600              , :ENTNME-ENT-ID                                    36810000
367700          FROM  TENTNME                                           36820000
367800          WHERE ENT_ID   = :PURCHS-ENT-ID                         36830000
367900            AND TYPE_CDE = '04'                                   36840000
368000     END-EXEC.                                                    36850000
368100                                                                  36860000
368200     EVALUATE TRUE                                                36870000
368300         WHEN SQLCODE = +0                                        36880000
368400         WHEN SQLCODE = +100                                      36890000
368500         WHEN SQLCODE = -904                                      36900000
368600         WHEN SQLCODE = -913                                      36910000
368700             CONTINUE                                             36920000
368800         WHEN SQLWARN0 NOT = SPACE                                36930000
368900         WHEN SQLCODE < +0                                        36940000
369000         WHEN SQLCODE > +0                                        36950000
369100             MOVE '4330-GET-VENDOR-SHORT-NAME'                    36960000
369200                                 TO DP013-PARAGRAPH               36970000
369300             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               36980000
369400                                 TO DP013-MESSAGE-TEXT (1)        36990000
369500             MOVE SQLCA          TO DP013-SQLCA                   37000000
369600             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      37010000
369700                 SET DP013-DB2-ABEND                              37020000
369800                     DP013-XCTL-DISPLAY-RESTART                   37030000
369900                                 TO TRUE                          37040000
370000             PERFORM DP013-0000-PROCESS-ABEND                     37050000
370100     END-EVALUATE.                                                37060000
370200                                                                  37070000
370300/                                                                 37080000
370400*----------------------------------------------------------------*37090000
370500* GET THE VENDOR PRIMARY NAME                                    *37100000
370600*----------------------------------------------------------------*37110000
370700                                                                  37120000
370800 4335-GET-VENDOR-PRIMARY-NAME.                                    37130000
370900                                                                  37140000
371000     EXEC SQL                                                     37150000
371100         SELECT ENT_NAME_DESC                                     37160000
371200              , ENT_ID                                            37170000
371300          INTO  :ENTNME-ENT-NAME-DESC                             37180000
371400              , :ENTNME-ENT-ID                                    37190000
371500          FROM  TENTNME                                           37200000
371600          WHERE ENT_ID   = :PURCHS-ENT-ID                         37210000
371700            AND TYPE_CDE = '01'                                   37220000
371800     END-EXEC.                                                    37230000
371900                                                                  37240000
372000     EVALUATE TRUE                                                37250000
372100         WHEN SQLCODE = +0                                        37260000
372200         WHEN SQLCODE = -904                                      37270000
372300         WHEN SQLCODE = -913                                      37280000
372400             CONTINUE                                             37290000
372500         WHEN SQLWARN0 NOT = SPACE                                37300000
372600         WHEN SQLCODE < +0                                        37310000
372700         WHEN SQLCODE > +0                                        37320000
372800             MOVE '4335-GET-VENDOR-PRIMARY-NAME'                  37330000
372900                                 TO DP013-PARAGRAPH               37340000
373000             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               37350000
373100                                 TO DP013-MESSAGE-TEXT (1)        37360000
373200             MOVE SQLCA          TO DP013-SQLCA                   37370000
373300             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      37380000
373400                 SET DP013-DB2-ABEND                              37390000
373500                     DP013-XCTL-DISPLAY-RESTART                   37400000
373600                                 TO TRUE                          37410000
373700             PERFORM DP013-0000-PROCESS-ABEND                     37420000
373800     END-EVALUATE.                                                37430000
373900                                                                  37440000
374000/                                                                 37450000
374100*----------------------------------------------------------------*37460000
374200* GET PLANNED SHIPMENT INFO                                      *37470000
374300*----------------------------------------------------------------*37480000
374400                                                                  37490000
374500 4340-GET-SHIPMENT-INFO.                                          37500000
374600                                                                  37510000
374700     EXEC SQL                                                     37520000
374800         SELECT DONT_SHIP_BEF_DTE                                 37530000
374900               ,CAN_IFNOT_SHIP_DTE                                37540000
375000          INTO  :PLNSHP-DONT-SHIP-BEF-DTE                         37550000
375100               ,:PLNSHP-CAN-IFNOT-SHIP-DTE                        37560000
375200          FROM  TPLNSHP                                           37570000
375300          WHERE PO_NBR          = :PV-HOLD-PO-NBR                 37580000
375400            AND VER_STATUS_CDE  = 'A'                             37590000
375500     END-EXEC.                                                    37600000
375600                                                                  37610000
375700     EVALUATE TRUE                                                37620000
375800         WHEN SQLCODE = +0                                        37630000
375900              IF  PLNSHP-DONT-SHIP-BEF-DTE > SPACES               37640000
376000              AND PLNSHP-DONT-SHIP-BEF-DTE NOT = '0001-01-01'     37650000
376100                  MOVE PLNSHP-DONT-SHIP-BEF-DTE                   37660000
376200                                       TO PV-DB2-DATE             37670000
376300                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      37680000
376400                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      37690000
376500                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      37700000
376600                  MOVE PV-DISPLAY-DATE TO PV-DONT-SHIP-BEF-DTE    37710000
376700              ELSE                                                37720000
376800                  MOVE SPACES          TO PV-DONT-SHIP-BEF-DTE    37730000
376900              END-IF                                              37740000
377000              IF  PLNSHP-CAN-IFNOT-SHIP-DTE > SPACES              37750000
377100              AND PLNSHP-CAN-IFNOT-SHIP-DTE NOT = '0001-01-01'    37760000
377200                  MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                  37770000
377300                                       TO PV-DB2-DATE             37780000
377400                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      37790000
377500                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      37800000
377600                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      37810000
377700                  MOVE PV-DISPLAY-DATE TO PV-CAN-IFNOT-SHIP-DTE   37820000
377800              ELSE                                                37830000
377900                  MOVE SPACES          TO PV-CAN-IFNOT-SHIP-DTE   37840000
378000              END-IF                                              37850000
378100                                                                  37860000
378200         WHEN SQLCODE = -904                                      37870000
378300         WHEN SQLCODE = -913                                      37880000
378400             CONTINUE                                             37890000
378500         WHEN SQLWARN0 NOT = SPACE                                37900000
378600         WHEN SQLCODE < +0                                        37910000
378700         WHEN SQLCODE > +0                                        37920000
378800             MOVE '4340-GET-SHIPMENT-INFO'                        37930000
378900                                 TO DP013-PARAGRAPH               37940000
379000             MOVE 'SELECT ON PLANNED SHIPMENTS'                   37950000
379100                                 TO DP013-MESSAGE-TEXT (1)        37960000
379200             MOVE SQLCA          TO DP013-SQLCA                   37970000
379300             MOVE 'TPLNSHP'      TO DP013-DB2-TABLE-NAME (1)      37980000
379400                 SET DP013-DB2-ABEND                              37990000
379500                     DP013-XCTL-DISPLAY-RESTART                   38000000
379600                                 TO TRUE                          38010000
379700             PERFORM DP013-0000-PROCESS-ABEND                     38020000
379800     END-EVALUATE.                                                38030000
379900                                                                  38040000
380000/                                                                 38050000
380100*----------------------------------------------------------------*38060000
380200*  DETERMINE IF ANY OF THE ORDERS ARE HAVE IN-PROCESS RECEIVERS, *38070000
380300*  IF THE ORDER DOES, HIGHLIGHT THE PO IN YELLOW ON THE SCREEN.  *38080000
380400*----------------------------------------------------------------*38090000
380500 4380-CHECK-IN-PROCESS.                                           38100000
380600                                                                  38110000
380700     PERFORM                                                      38120000
380800         WITH TEST AFTER                                          38130000
380900         VARYING PV-RETRY-COUNTER                                 38140000
381000         FROM 1 BY 1                                              38150000
381100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38160000
381200             OR (SQLCODE = +0)                                    38170000
381300             OR (SQLCODE = +100))                                 38180000
381400                                                                  38190000
381500      EXEC SQL                                                    38200000
381600           SELECT COUNT(*)                                        38210000
381700             INTO :PV-DB2-COUNT2                                  38220000
381800             FROM TRECEIV A                                       38230000
381900                 ,TRECITM B                                       38240000
382000                 ,TPURITM C                                       38250000
382100            WHERE A.ORD_NBR        = :PV-HOLD-PO-NBR              38260000
382200              AND A.VER_STATUS_CDE = 'A'                          38270000
382300              AND A.STATUS_CDE     = 'IP'                         38280000
382400              AND A.ORD_NBR        = B.ORD_NBR                    38290000
382500              AND B.VER_STATUS_CDE = 'A'                          38300000
382600              AND B.ORD_NBR        = C.PO_NBR                     38310000
382700              AND B.ORD_LNE_NBR    = C.APP_PO_LNE_NBR             38320000
382800              AND B.PO_VER_NBR     = C.VER_NBR                    38330000
382900              AND C.VER_STATUS_CDE = 'A'                          38340000
383000      END-EXEC                                                    38350000
383100                                                                  38360000
383200      EVALUATE TRUE                                               38370000
383300          WHEN SQLCODE = +0                                       38380000
383400          WHEN SQLCODE = +100                                     38390000
383500          WHEN SQLCODE = -904                                     38400000
383600          WHEN SQLCODE = -913                                     38410000
383700               CONTINUE                                           38420000
383800                                                                  38430000
383900          WHEN SQLWARN0 NOT = SPACES                              38440000
384000          WHEN SQLCODE < +0                                       38450000
384100          WHEN SQLCODE > +0                                       38460000
384200               MOVE '4380-CHECK-IN-PROCESS'                       38470000
384300                               TO DP013-PARAGRAPH                 38480000
384400               MOVE 'UNSUCCESSFUL SELECT IN-PROCESS'              38490000
384500                               TO DP013-MESSAGE-TEXT (1)          38500000
384600               MOVE SQLCA      TO DP013-SQLCA                     38510000
384700               MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)        38520000
384800               SET DP013-DB2-ABEND                                38530000
384900                   DP013-XCTL-DISPLAY-RESTART                     38540000
385000                               TO TRUE                            38550000
385100               PERFORM DP013-0000-PROCESS-ABEND                   38560000
385200      END-EVALUATE                                                38570000
385300     END-PERFORM.                                                 38580000
385400                                                                  38590000
385500      IF PV-RETRY-COUNTER > PC-MAX-RETRIES                        38600000
385600        MOVE '4380-CHECK-IN-PROCESS ' TO DP013-PARAGRAPH          38610000
385700        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    38620000
385800                                      TO DP013-MESSAGE-TEXT (1)   38630000
385900        MOVE SQLCA                    TO DP013-SQLCA              38640000
386000        SET DP013-DB2-ABEND                                       38650000
386100            DP013-XCTL-DISPLAY-RESTART                            38660000
386200                                      TO TRUE                     38670000
386300        PERFORM DP013-0000-PROCESS-ABEND                          38680000
386400      END-IF.                                                     38690000
386500                                                                  38700000
386600                                                                  38710000
386700 4395-GET-ITEM-DATA.                                              38720000
386800                                                                  38730000
386900     SET PS-GC-MATCH TO TRUE                                      38740000
W24803     MOVE XLT00003-GP-CDE TO PV-HOLD-GROUP-CODE                   38750000
387100     INITIALIZE PV-PURITM-UNT-QTY                                 38760000
387200     INITIALIZE PV-PURITM-TOT-VAL-RTL-AMT                         38770000
387300                                                                  38780000
387400     PERFORM                                                      38790000
387500         WITH TEST AFTER                                          38800000
387600         VARYING PV-RETRY-COUNTER                                 38810000
387700         FROM 1 BY 1                                              38820000
387800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38830000
387900            OR (SQLCODE = +0))                                    38840000
388000                                                                  38850000
388100         EXEC SQL                                                 38860000
388200             SELECT SUM (A.UNT_QTY)                               38870000
388300                   ,SUM (A.TOT_VAL_RTL_AMT)                       38880000
388400             INTO   :PV-PURITM-UNT-QTY:PV-QTY-NULL                38890000
388500                   ,:PV-PURITM-TOT-VAL-RTL-AMT:PV-QTY-NULL1       38900000
388600              FROM  TPURITM A                                     38910000
388700              WHERE PO_NBR          = :PURCHS-PO-NBR              38920000
388800                AND VER_STATUS_CDE  = 'A'                         38930000
388900                AND ITM_NBR         = :PV-HOLD-ORIG-ITEM-NBR      38940000
389000                AND STATUS_CDE     ^= 'CA'                        38950000
389100         END-EXEC                                                 38960000
389200                                                                  38970000
389300         EVALUATE TRUE                                            38980000
389400             WHEN SQLCODE = +0                                    38990000
389500               IF PV-QTY-NULL NOT = -1                            39000000
389600                  CONTINUE                                        39010000
389700               ELSE                                               39020000
389800                  MOVE ZEROES TO PV-PURITM-UNT-QTY                39030000
389900               END-IF                                             39040000
390000               IF PV-QTY-NULL1 NOT = -1                           39050000
390100                  CONTINUE                                        39060000
390200               ELSE                                               39070000
390300                  MOVE ZEROES TO PV-PURITM-TOT-VAL-RTL-AMT        39080000
390400               END-IF                                             39090000
390500               ADD PV-PURITM-UNT-QTY TO PV-TOT-PURITM-UNT-QTY     39100000
390600               ADD PV-PURITM-TOT-VAL-RTL-AMT                      39110000
390700                              TO PV-TOT-PUR-TOT-VAL-RTL-AMT       39120000
390800               PERFORM 4397-GET-DOLLARS-RECEIVED                  39130000
390900               PERFORM 4399-GET-UNITS-RECEIVED                    39140000
391000             WHEN SQLCODE = +100                                  39150000
391100                  MOVE '4395-GET-ITEM-DATA'                       39160000
391200                                  TO DP013-PARAGRAPH              39170000
391300                  MOVE 'UNSUCCESSFUL SELECT GET ITEM DATA '       39180000
391400                                  TO DP013-MESSAGE-TEXT (1)       39190000
391500                  MOVE SQLCA      TO DP013-SQLCA                  39200000
391600                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     39210000
391700                  SET DP013-DB2-ABEND                             39220000
391800                      DP013-XCTL-DISPLAY-RESTART                  39230000
391900                                  TO TRUE                         39240000
392000                  PERFORM DP013-0000-PROCESS-ABEND                39250000
392100                  MOVE SPACES              TO PV-AD-EVNT-DTE      39260000
392200             WHEN SQLCODE = -904                                  39270000
392300             WHEN SQLCODE = -913                                  39280000
392400                  CONTINUE                                        39290000
392500                                                                  39300000
392600             WHEN SQLWARN0 NOT = SPACES                           39310000
392700             WHEN SQLCODE < +0                                    39320000
392800             WHEN SQLCODE > +0                                    39330000
392900                  MOVE '4395-GET-ITEM-DATA'                       39340000
393000                                  TO DP013-PARAGRAPH              39350000
393100                  MOVE 'UNSUCCESSFUL SELECT GET ITEM DATA '       39360000
393200                                  TO DP013-MESSAGE-TEXT (1)       39370000
393300                  MOVE SQLCA      TO DP013-SQLCA                  39380000
393400                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     39390000
393500                  SET DP013-DB2-ABEND                             39400000
393600                      DP013-XCTL-DISPLAY-RESTART                  39410000
393700                                  TO TRUE                         39420000
393800                  PERFORM DP013-0000-PROCESS-ABEND                39430000
393900         END-EVALUATE                                             39440000
394000     END-PERFORM.                                                 39450000
394100                                                                  39460000
394200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        39470000
394300         MOVE '4395-GET-ITEM-DATA'                                39480000
394400                                  TO DP013-PARAGRAPH              39490000
394500         MOVE 'MAX RETRIES EXCEEDED ON SELECT   TPURITM'          39500000
394600                                  TO DP013-MESSAGE-TEXT (1)       39510000
394700         MOVE SQLCA               TO DP013-SQLCA                  39520000
394800         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     39530000
394900         SET DP013-DB2-ABEND                                      39540000
395000             DP013-XCTL-DISPLAY-RESTART                           39550000
395100                                  TO TRUE                         39560000
395200         PERFORM DP013-0000-PROCESS-ABEND                         39570000
395300     END-IF.                                                      39580000
395400                                                                  39590000
395500 4396-GET-MIN-AD-DATE.                                            39600000
395600                                                                  39610000
395700      MOVE SPACES TO PV-AD-EVNT-DTE.                              39620000
395800      MOVE +0     TO PV-NULL-IND.                                 39630000
395900                                                                  39640000
396000      PERFORM                                                     39650000
396100          WITH TEST AFTER                                         39660000
396200          VARYING PV-RETRY-COUNTER                                39670000
396300          FROM 1 BY 1                                             39680000
396400          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)              39690000
396500              OR (SQLCODE = +0)                                   39700000
396600              OR (SQLCODE = +100))                                39710000
396700                                                                  39720000
396800          EXEC SQL                                                39730000
396900              SELECT MIN(AD_EVNT_DTE)                             39740000
397000               INTO  :PURITM-AD-EVNT-DTE:PV-NULL-IND              39750000
397100               FROM  TPURITM                                      39760000
397200               WHERE PO_NBR           = :PV-HOLD-PO-NBR           39770000
397300                 AND VER_STATUS_CDE   = 'A'                       39780000
397400                 AND AD_EVNT_DTE      > '0001-01-01'              39790000
397500                 AND STATUS_CDE NOT IN ('CA')                     39800000
397600          END-EXEC                                                39810000
397700                                                                  39820000
397800          EVALUATE TRUE                                           39830000
397900              WHEN SQLCODE = +0                                   39840000
398000                   IF PV-NULL-IND < +0                            39850000
398100                      MOVE SPACES       TO PV-AD-EVNT-DTE         39860000
398200                   ELSE                                           39870000
398300                      MOVE PURITM-AD-EVNT-DTE                     39880000
398400                                        TO PV-DB2-DATE            39890000
398500                      MOVE PV-DB2-DATE-MM TO PV-DISPLAY-DATE-MM   39900000
398600                      MOVE PV-DB2-DATE-DD TO PV-DISPLAY-DATE-DD   39910000
398700                      MOVE PV-DB2-DATE-YY TO PV-DISPLAY-DATE-YY   39920000
398800                      MOVE PV-DISPLAY-DATE TO PV-AD-EVNT-DTE      39930000
398900                   END-IF                                         39940000
399000               WHEN SQLCODE = +100                                39950000
399100                    MOVE SPACES            TO PV-AD-EVNT-DTE      39960000
399200               WHEN SQLCODE = -904                                39970000
399300               WHEN SQLCODE = -913                                39980000
399400                    CONTINUE                                      39990000
399500               WHEN SQLWARN0 NOT = SPACES                         40000000
399600               WHEN SQLCODE < +0                                  40010000
399700               WHEN SQLCODE > +0                                  40020000
399800                    MOVE '4396-GET-MIN-AD-DTE'                    40030000
399900                                    TO DP013-PARAGRAPH            40040000
400000                    MOVE 'UNSUCCESSFUL SELECT MIN AD DATE '       40050000
400100                                    TO DP013-MESSAGE-TEXT (1)     40060000
400200                    MOVE SQLCA      TO DP013-SQLCA                40070000
400300                    MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)   40080000
400400                    SET DP013-DB2-ABEND                           40090000
400500                        DP013-XCTL-DISPLAY-RESTART                40100000
400600                                    TO TRUE                       40110000
400700                    PERFORM DP013-0000-PROCESS-ABEND              40120000
400800          END-EVALUATE                                            40130000
400900      END-PERFORM.                                                40140000
401000*----------------------------------------------------------------*40150000
401100* GET DOLLARS RECEIVED                                           *40160000
401200* GET RECEIPT DOLLARS AT THE ITEM LEVEL.                         *40170000
401300*----------------------------------------------------------------*40180000
401400                                                                  40190000
401500 4397-GET-DOLLARS-RECEIVED.                                       40200000
401600                                                                  40210000
401700     INITIALIZE PV-GP-DOLLARS-RECEIVED                            40220000
401800                PV-NULL-IND.                                      40230000
401900     EXEC SQL                                                     40240000
402000      SELECT SUM(DECIMAL                                          40250000
402100           (C.AP_VERIFY_ITM_QTY *                                 40260054
402100           (A.GP_RTL_AMT / A.GP_QTY),9,2))                        40270054
402200         INTO :PV-GP-DOLLARS-RECEIVED:PV-NULL-IND                 40280000
402300         FROM TPURITM A,                                          40290000
402400              TRECITM B,                                          40300000
402500              TRECDIS C                                           40310000
402600         WHERE A.PO_NBR         = :PV-HOLD-PO-NBR                 40320000
402700           AND A.STATUS_CDE    ^= 'CA'                            40330000
402800           AND A.APP_PO_LNE_NBR = B.ORD_LNE_NBR                   40340000
402900           AND A.VER_STATUS_CDE = 'A'                             40350000
403000           AND B.ORD_NBR        = A.PO_NBR                        40360000
403100           AND B.STATUS_CDE     = 'VE'                            40370000
403200           AND B.VER_STATUS_CDE = 'A'                             40380000
403300           AND C.ORD_NBR        = A.PO_NBR                        40390000
403400           AND C.ORD_LNE_NBR    = B.ORD_LNE_NBR                   40400000
403500           AND C.REC_SEQ_NBR    = B.REC_SEQ_NBR                   40410000
403600           AND C.VER_STATUS_CDE = 'A'                             40420000
403700           AND A.GP_QTY         > 1                               40430000
403800           AND A.ITM_NBR =  :PV-HOLD-ORIG-ITEM-NBR                40440000
403900     END-EXEC.                                                    40450000
404000                                                                  40460000
404100     EVALUATE TRUE                                                40470000
404200         WHEN SQLCODE = +0                                        40480000
404300           IF PV-NULL-IND NOT = -1                                40490000
404400             CONTINUE                                             40500000
404500              ELSE                                                40510000
404600             MOVE ZEROES TO PV-GP-DOLLARS-RECEIVED                40520000
404700           END-IF                                                 40530000
404800           CONTINUE                                               40540000
404900         WHEN SQLCODE = -904                                      40550000
405000         WHEN SQLCODE = -913                                      40560000
405100              CONTINUE                                            40570000
405200                                                                  40580000
405300         WHEN SQLWARN0 NOT = SPACES                               40590000
405400         WHEN SQLCODE < +0                                        40600000
405500         WHEN SQLCODE > +0                                        40610000
405600              MOVE '4397-GET-DOLLARS-RECEIVED'                    40620000
405700                              TO DP013-PARAGRAPH                  40630000
405800              MOVE 'UNSUCCESSFUL SELECT GP DOLLARS RECEIVED'      40640000
405900                              TO DP013-MESSAGE-TEXT (1)           40650000
406000              MOVE SQLCA      TO DP013-SQLCA                      40660000
406100              MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (1)         40670000
406200              SET DP013-DB2-ABEND                                 40680000
406300                  DP013-XCTL-DISPLAY-RESTART                      40690000
406400                              TO TRUE                             40700000
406500              PERFORM DP013-0000-PROCESS-ABEND                    40710000
406600     END-EVALUATE.                                                40720000
406700                                                                  40730000
406800     INITIALIZE PV-DOLLARS-RECEIVED                               40740000
406900                PV-NULL-IND.                                      40750000
407000     EXEC SQL                                                     40760000
407100      SELECT SUM(C.AP_VERIFY_ITM_QTY * A.UNT_RTL_PR_AMT)          40770000
407200         INTO :PV-DOLLARS-RECEIVED:PV-NULL-IND                    40780000
407300         FROM TPURITM A,                                          40790000
407400              TRECITM B,                                          40800000
407500              TRECDIS C                                           40810000
407600         WHERE A.PO_NBR         = :PV-HOLD-PO-NBR                 40820000
407700           AND A.STATUS_CDE    ^= 'CA'                            40830000
407800           AND A.APP_PO_LNE_NBR = B.ORD_LNE_NBR                   40840000
407900           AND A.VER_STATUS_CDE = 'A'                             40850000
408000           AND B.ORD_NBR        = A.PO_NBR                        40860000
408100           AND B.STATUS_CDE     = 'VE'                            40870000
408200           AND B.VER_STATUS_CDE = 'A'                             40880000
408300           AND C.ORD_NBR        = A.PO_NBR                        40890000
408400           AND C.ORD_LNE_NBR    = B.ORD_LNE_NBR                   40900000
408500           AND C.REC_SEQ_NBR    = B.REC_SEQ_NBR                   40910000
408600           AND C.VER_STATUS_CDE = 'A'                             40920000
408700           AND A.GP_QTY        <= 1                               40930000
408800           AND A.ITM_NBR = :PV-HOLD-ORIG-ITEM-NBR                 40940000
408900     END-EXEC.                                                    40950000
409000                                                                  40960000
409100     EVALUATE TRUE                                                40970000
409200         WHEN SQLCODE = +0                                        40980000
409300           IF PV-NULL-IND NOT = -1                                40990000
409400             CONTINUE                                             41000000
409500              ELSE                                                41010000
409600             MOVE ZEROES TO PV-DOLLARS-RECEIVED                   41020000
409700           END-IF                                                 41030000
409800           CONTINUE                                               41040000
409900         WHEN SQLCODE = -904                                      41050000
410000         WHEN SQLCODE = -913                                      41060000
410100              CONTINUE                                            41070000
410200                                                                  41080000
410300         WHEN SQLWARN0 NOT = SPACES                               41090000
410400         WHEN SQLCODE < +0                                        41100000
410500         WHEN SQLCODE > +0                                        41110000
410600              MOVE '4397-GET-DOLLARS-RECEIVED'                    41120000
410700                              TO DP013-PARAGRAPH                  41130000
410800              MOVE 'UNSUCCESSFUL SELECT DOLLARS RECEIVED'         41140000
410900                              TO DP013-MESSAGE-TEXT (1)           41150000
411000              MOVE SQLCA      TO DP013-SQLCA                      41160000
411100              MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (1)         41170000
411200              SET DP013-DB2-ABEND                                 41180000
411300                  DP013-XCTL-DISPLAY-RESTART                      41190000
411400                              TO TRUE                             41200000
411500              PERFORM DP013-0000-PROCESS-ABEND                    41210000
411600     END-EVALUATE.                                                41220000
411700       ADD PV-DOLLARS-RECEIVED                                    41230000
411800           PV-GP-DOLLARS-RECEIVED TO PV-TOT-DOLLARS-RECEIVED.     41240000
411900                                                                  41250000
412000 4399-GET-UNITS-RECEIVED.                                         41260000
412100                                                                  41270000
412200     INITIALIZE PV-UNITS-RECEIVED                                 41280000
412300                PV-NULL-IND.                                      41290000
412400     PERFORM                                                      41300000
412500         WITH TEST AFTER                                          41310000
412600         VARYING PV-RETRY-COUNTER                                 41320000
412700         FROM 1 BY 1                                              41330000
412800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               41340000
412900             OR (SQLCODE = +0)                                    41350000
413000             OR (SQLCODE = +100))                                 41360000
413100                                                                  41370000
413200         EXEC SQL                                                 41380000
413300             SELECT SUM(C.AP_VERIFY_ITM_QTY)                      41390000
413400             INTO :PV-UNITS-RECEIVED:PV-NULL-IND                  41400000
413500             FROM TPURITM A,                                      41410000
413600                  TRECITM B,                                      41420000
413700                  TRECDIS C                                       41430000
413800             WHERE A.PO_NBR = :PV-HOLD-PO-NBR                     41440000
413900               AND A.PO_NBR = B.ORD_NBR                           41450000
414000               AND B.ORD_NBR = C.ORD_NBR                          41460000
414100               AND A.VER_STATUS_CDE = 'A'                         41470000
414200               AND A.VER_STATUS_CDE = 'A'                         41480000
414300               AND B.VER_STATUS_CDE = 'A'                         41490000
414400               AND C.VER_STATUS_CDE = 'A'                         41500000
414500               AND A.APP_PO_LNE_NBR = B.ORD_LNE_NBR               41510000
414600               AND B.ORD_LNE_NBR = C.ORD_LNE_NBR                  41520000
414700               AND B.REC_SEQ_NBR = C.REC_SEQ_NBR                  41530000
414800               AND A.ITM_NBR = :PV-HOLD-ORIG-ITEM-NBR             41540000
414900         END-EXEC                                                 41550000
415000                                                                  41560000
415100         EVALUATE TRUE                                            41570000
415200             WHEN SQLCODE = +0                                    41580000
415300             WHEN SQLCODE = +100                                  41590000
415400             WHEN SQLCODE = -904                                  41600000
415500             WHEN SQLCODE = -913                                  41610000
415600                  CONTINUE                                        41620000
415700                                                                  41630000
415800             WHEN SQLWARN0 NOT = SPACES                           41640000
415900             WHEN SQLCODE < +0                                    41650000
416000             WHEN SQLCODE > +0                                    41660000
416100                  MOVE '4399-GET-UNITS-RCVD'                      41670000
416200                                  TO DP013-PARAGRAPH              41680000
416300                  MOVE 'UNSUCCESSFUL SELECT UNITS RCVD  '         41690000
416400                                  TO DP013-MESSAGE-TEXT (1)       41700000
416500                  MOVE SQLCA      TO DP013-SQLCA                  41710000
416600                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)     41720000
416700                  MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (2)     41730000
416800                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (3)     41740000
416900                  SET DP013-DB2-ABEND                             41750000
417000                      DP013-XCTL-DISPLAY-RESTART                  41760000
417100                                  TO TRUE                         41770000
417200                  PERFORM DP013-0000-PROCESS-ABEND                41780000
417300         END-EVALUATE                                             41790000
417400         ADD PV-UNITS-RECEIVED TO PV-TOT-UNITS-RECEIVED           41800000
417500     END-PERFORM.                                                 41810000
417600                                                                  41820000
417700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        41830000
417800         MOVE '4399-GET-UNITS-RCVD '                              41840000
417900                                  TO DP013-PARAGRAPH              41850000
418000         MOVE 'MAX RETRIES EXCEEDED ON SELECT   TRECITM'          41860000
418100                                  TO DP013-MESSAGE-TEXT (1)       41870000
418200         MOVE SQLCA               TO DP013-SQLCA                  41880000
418300         MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1)     41890000
418400         MOVE 'TRECDIS '          TO DP013-DB2-TABLE-NAME (2)     41900000
418500         SET DP013-DB2-ABEND                                      41910000
418600             DP013-XCTL-DISPLAY-RESTART                           41920000
418700                                  TO TRUE                         41930000
418800         PERFORM DP013-0000-PROCESS-ABEND                         41940000
418900     END-IF.                                                      41950000
419000/                                                                 41960000
419100*----------------------------------------------------------------*41970000
419200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *41980000
419300*----------------------------------------------------------------*41990000
419400                                                                  42000000
419500 4400-MOVE-COMMAREA-TO-SCREEN.                                    42010000
419600                                                                  42020000
419700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             42030000
419800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          42040000
419900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          42050000
420000             MOVE +1               TO ASC-BLK-SUB                 42060000
420100             PERFORM 5100-WRITE-TEMP-STORAGE                      42070000
420200             ADD +1                TO ASC-BLK-SUB                 42080000
420300             PERFORM 5100-WRITE-TEMP-STORAGE                      42090000
420400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             42100000
420500                 GIVING PV-BLOCK-NUMBER                           42110000
420600                 REMAINDER PV-REMAINDER                           42120000
420700             IF  PV-REMAINDER > ZERO                              42130000
420800                 ADD +1            TO PV-BLOCK-NUMBER             42140000
420900             END-IF                                               42150000
421000             MOVE +1               TO ASC-BLK-SUB                 42160000
421100             PERFORM 4410-READ-TEMP-STORAGE                       42170000
421200             ADD +1                TO ASC-BLK-SUB                 42180000
421300                                      PV-BLOCK-NUMBER             42190000
421400             PERFORM 4410-READ-TEMP-STORAGE                       42200000
421500     END-IF.                                                      42210000
421600                                                                  42220000
421700     MOVE +1                       TO ASC-BLK-SUB.                42230000
421800                                                                  42240000
421900     COMPUTE ASC-ITEM-SUB =                                       42250000
422000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              42260000
422100         + PC-ITEMS-PER-PANEL).                                   42270000
422200                                                                  42280000
422300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        42290000
422400         ADD +1                    TO ASC-BLK-SUB                 42300000
422500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            42310000
422600     END-IF.                                                      42320000
422700                                                                  42330000
422800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           42340000
422900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                42350000
423000                                                                  42360000
423100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        42370000
423200     PERFORM 4420-FORMAT-LIST-LINES                               42380000
423300         VARYING PV-SUB                                           42390000
423400         FROM PC-ITEMS-PER-PANEL BY -1                            42400000
423500         UNTIL PV-SUB < +1.                                       42410000
423600                                                                  42420000
423700     COMPUTE ASC-ITEMS-DISPLAYED =                                42430000
423800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          42440000
423900                                                                  42450000
424000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    42460000
424100                                      ASTRTITO.                   42470000
424200                                                                  42480000
424300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    42490000
424400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    42500000
424500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            42510000
424600                                   TO ASELITO.                    42520000
424700                                                                  42530000
424800     IF ASC-DISPLAY-UNITS                                         42540000
424900        MOVE PC-UNITS-HEAD     TO AHEADO                          42550000
425000        MOVE PC-UNITS-HEAD2    TO AHEAD2O                         42560000
425100        MOVE ASC-UNIT-ORD-TOT  TO MR-UNITS-ORDERED-TOT            42570000
425200        MOVE ASC-UNIT-REC-TOT  TO MR-UNITS-RECEIVED-TOT           42580000
425300        IF ASC-UNIT-ORD-TOT = 0                                   42590000
425400           MOVE 0 TO MR-UNITS-RCVD-PCT-TOT                        42600000
425500        ELSE                                                      42610000
425600           COMPUTE PV-PCT-AREA                                    42620000
425700              =   (ASC-UNIT-REC-TOT / ASC-UNIT-ORD-TOT)           42630000
425800              *    100                                            42640000
425900           MOVE PV-PCT-AREA    TO MR-UNITS-RCVD-PCT-TOT           42650000
426000        END-IF                                                    42660000
426100        MOVE MR-UNITS-TOTAL    TO ATLINEO                         42670000
426200     ELSE                                                         42680000
426300        MOVE PC-DOLLAR-HEAD    TO AHEADO                          42690000
426400        MOVE PC-DOLLAR-HEAD2   TO AHEAD2O                         42700000
426500        MOVE ASC-DOLLAR-ORD-TOT TO MR-DOLLARS-ORDERED-TOT         42710000
426600        MOVE ASC-DOLLAR-REC-TOT TO MR-DOLLARS-RECEIVED-TOT        42720000
426700        IF ASC-DOLLAR-ORD-TOT = 0                                 42730000
426800           MOVE 0 TO MR-DOLLARS-RCVD-PCT-TOT                      42740000
426900        ELSE                                                      42750000
427000           COMPUTE PV-PCT-AREA                                    42760000
427100              =   (ASC-DOLLAR-REC-TOT / ASC-DOLLAR-ORD-TOT)       42770000
427200              *    100                                            42780000
427300           MOVE PV-PCT-AREA    TO MR-DOLLARS-RCVD-PCT-TOT         42790000
427400        END-IF                                                    42800000
427500        MOVE MR-DOLLARS-TOTAL  TO ATLINEO.                        42810000
427600                                                                  42820000
427700     IF  DP020-MSG-NUMBER-X = SPACE                               42830000
427800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  42840000
427900*            --- MORE ITEMS TO DISPLAY ----                       42850000
428000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            42860000
428100             SET DP020-MSG-INFORMATIONAL                          42870000
428200                                   TO TRUE                        42880000
428300         END-IF                                                   42890000
428400     END-IF.                                                      42900000
428500                                                                  42910000
428600*----------------------------------------------------------------*42920000
428700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *42930000
428800*----------------------------------------------------------------*42940000
428900                                                                  42950000
429000 4410-READ-TEMP-STORAGE.                                          42960000
429100                                                                  42970000
429200     EXEC CICS                                                    42980000
429300         READQ TS                                                 42990000
429400             QUEUE (ASC-LIST-QUEUE-NAME)                          43000000
429500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               43010000
429600             ITEM  (PV-BLOCK-NUMBER)                              43020000
429700             RESP  (PV-CICS-RESP)                                 43030000
429800     END-EXEC.                                                    43040000
429900                                                                  43050000
430000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       43060000
430100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     43070000
430200         CONTINUE                                                 43080000
430300     ELSE                                                         43090000
430400         SET DP013-CICS-ABEND      TO TRUE                        43100000
430500         SET DP013-NO-ROLLBACK     TO TRUE                        43110000
430600         MOVE '4410-READ-TEMP-STORAGE'                            43120000
430700                                   TO DP013-PARAGRAPH             43130000
430800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      43140000
430900                                   TO DP013-MESSAGE-TEXT(1)       43150000
431000         PERFORM DP013-0000-PROCESS-ABEND                         43160000
431100     END-IF.                                                      43170000
431200                                                                  43180000
431300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      43190000
431400                                   TO TRUE.                       43200000
431500                                                                  43210000
431600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         43220000
431700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               43230000
431800     END-IF.                                                      43240000
431900/                                                                 43250000
432000*----------------------------------------------------------------*43260000
432100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *43270000
432200*----------------------------------------------------------------*43280000
432300                                                                  43290000
432400 4420-FORMAT-LIST-LINES.                                          43300000
432500                                                                  43310000
432600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      43320000
432700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                43330000
432800         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         43340000
432900         MOVE SPACES               TO MR-SELECT  (PV-SUB)         43350000
433000                                      MR-PO-NBR-X (PV-SUB)        43360000
433100                                      MR-GROUP-CDE (PV-SUB)       43370000
433200                                      MR-VENDOR-NAME (PV-SUB)     43380000
433300                                      MR-SHIP-DATE (PV-SUB)       43390000
433400                                      MR-CANCEL-DATE (PV-SUB)     43400000
433500                                      MR-LINE-AREA (PV-SUB)       43410000
433600     ELSE                                                         43420000
433700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      43430000
433800                                                   > SPACE        43440000
433900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 43450000
434000                                   TO MR-SELECT (PV-SUB)          43460000
434100         ELSE                                                     43470000
434200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      43480000
434300                                   TO MR-SELECT (PV-SUB)          43490000
434400         END-IF                                                   43500000
434500                                                                  43510000
434600         IF  DP030-SET-CURSOR-TRAILER                             43520000
434700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)43530000
434800                 > SPACE)                                         43540000
434900               OR (PV-SUB = 1))                                   43550000
435000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               43560000
435100                MOVE -1            TO MR-SELECTL (PV-SUB)         43570000
435200             END-IF                                               43580000
435300         END-IF                                                   43590000
435400                                                                  43600000
435500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           43610000
435600             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           43620000
435700                                   TO MR-PO-NBR (PV-SUB)          43630000
435800             MOVE ASC-GROUP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)        43640000
435900                                   TO MR-GROUP-CDE (PV-SUB)       43650000
436000             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      43660000
436100                                   TO MR-VENDOR-NAME (PV-SUB)     43670000
436200             MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        43680000
436300                                   TO MR-SHIP-DATE (PV-SUB)       43690000
436400             MOVE ASC-CANCEL-DATE (ASC-BLK-SUB ASC-ITEM-SUB)      43700000
436500                                   TO MR-CANCEL-DATE (PV-SUB)     43710000
436600                                                                  43720000
436700             IF ASC-IP-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y'       43730000
436800                 MOVE DP015-YELLOW          TO MR-PO-NBRC(PV-SUB) 43740000
436900             ELSE                                                 43750000
437000                 MOVE DP015-BLUE            TO MR-PO-NBRC(PV-SUB) 43760000
437100             END-IF                                               43770000
437200                                                                  43780000
437300         END-IF                                                   43790000
437400         IF ASC-DISPLAY-UNITS                                     43800000
437500            PERFORM 4425-MOVE-UNITS                               43810000
437600         ELSE                                                     43820000
437700            PERFORM 4428-MOVE-DOLLARS                             43830000
437800         END-IF                                                   43840000
437900     END-IF.                                                      43850000
438000                                                                  43860000
438100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               43870000
438200                                                                  43880000
438300     IF  ASC-ITEM-SUB < + 1                                       43890000
438400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                43900000
438500         MOVE +1                   TO ASC-BLK-SUB                 43910000
438600     END-IF.                                                      43920000
438700                                                                  43930000
438800 4425-MOVE-UNITS.                                                 43940000
438900                                                                  43950000
439000     MOVE ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)         43960000
439100                                   TO MR-UNITS-ORDERED.           43970000
439200     MOVE ASC-TOT-UNIT-RCVD (ASC-BLK-SUB ASC-ITEM-SUB)            43980000
439300                                   TO MR-UNITS-RECEIVED.          43990000
439400                                                                  44000000
439500     IF ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB) = 0       44010000
439600        MOVE 0             TO MR-UNITS-RCVD-PCT                   44020000
439700        MOVE SPACES        TO MR-UNITS-PCT-SPACE                  44030000
439800     ELSE                                                         44040000
439900        COMPUTE PV-PCT-AREA                                       44050000
440000           =   (ASC-TOT-UNIT-RCVD (ASC-BLK-SUB ASC-ITEM-SUB)      44060000
440100           /    ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB))  44070000
440200           *    100                                               44080000
440300        MOVE PV-PCT-AREA TO MR-UNITS-RCVD-PCT                     44090000
440400        IF PV-PCT-AREA = 0                                        44100000
440500           MOVE SPACES TO MR-UNITS-PCT-SPACE                      44110000
440600        ELSE                                                      44120000
440700           MOVE '% '   TO MR-UNITS-PCT-SPACE                      44130000
440800        END-IF                                                    44140000
440900     END-IF.                                                      44150000
441000                                                                  44160000
441100     MOVE ASC-AD-EVNT-DTE (ASC-BLK-SUB ASC-ITEM-SUB)              44170000
441200                            TO MR-AD-EVNT-DTE.                    44180000
441300     MOVE MR-UNITS-LINE     TO MR-LINE-AREA(PV-SUB).              44190000
441400                                                                  44200000
441500 4428-MOVE-DOLLARS.                                               44210000
441600                                                                  44220000
441700     MOVE ASC-DOLLARS-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)          44230000
441800                           TO MR-DOLLARS-ORDERED                  44240000
441900     MOVE ASC-DOLLARS-RECEIVED (ASC-BLK-SUB ASC-ITEM-SUB)         44250000
442000                           TO MR-DOLLARS-RECEIVED                 44260000
442100                                                                  44270000
442200     IF ASC-DOLLARS-ORDERED  (ASC-BLK-SUB ASC-ITEM-SUB) = 0       44280000
442300        MOVE 0             TO MR-DOLLARS-RCVD-PCT                 44290000
442400        MOVE SPACES        TO MR-DOLLARS-PCT-SPACE                44300000
442500     ELSE                                                         44310000
442600        COMPUTE PV-PCT-AREA                                       44320000
442700           =   (ASC-DOLLARS-RECEIVED (ASC-BLK-SUB ASC-ITEM-SUB)   44330000
442800           /    ASC-DOLLARS-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB))   44340000
442900           *    100                                               44350000
443000        MOVE PV-PCT-AREA TO MR-DOLLARS-RCVD-PCT                   44360000
443100        IF PV-PCT-AREA = 0                                        44370000
443200           MOVE SPACES   TO MR-DOLLARS-PCT-SPACE                  44380000
443300        ELSE                                                      44390000
443400           MOVE '% '     TO MR-DOLLARS-PCT-SPACE                  44400000
443500        END-IF                                                    44410000
443600     END-IF.                                                      44420000
443700                                                                  44430000
443800     MOVE MR-DOLLAR-LINE TO MR-LINE-AREA(PV-SUB).                 44440000
443900                                                                  44450000
444000*----------------------------------------------------------------*44460000
444100*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *44470000
444200*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *44480000
444300*  ISSUE A WARNING.                                              *44490000
444400*----------------------------------------------------------------*44500000
444500 4430-CHECK-FOR-BEGIN-AND-END.                                    44510000
444600                                                                  44520000
444700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       44530000
444800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     44540000
444900*            -- NO END-OF-RANGE SPECFIED ---                      44550000
445000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            44560000
445100             SET DP020-MSG-WARNING TO TRUE                        44570000
445200             PERFORM 4431-POSITION-AT-WARNING                     44580000
445300         END-IF                                                   44590000
445400     ELSE                                                         44600000
445500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     44610000
445600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                44620000
445700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            44630000
445800             SET DP020-MSG-WARNING TO TRUE                        44640000
445900             PERFORM 4431-POSITION-AT-WARNING                     44650000
446000         END-IF                                                   44660000
446100     END-IF.                                                      44670000
446200                                                                  44680000
446300*----------------------------------------------------------------*44690000
446400*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *44700000
446500*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *44710000
446600*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *44720000
446700*  POSITION THE CURSOR THERE.                                    *44730000
446800*----------------------------------------------------------------*44740000
446900 4431-POSITION-AT-WARNING.                                        44750000
447000                                                                  44760000
447100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 44770000
447200                    - PV-TOP-ITEM + 1.                            44780000
447300                                                                  44790000
447400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      44800000
447500         CONTINUE                                                 44810000
447600     ELSE                                                         44820000
447700         SET DP030-SET-CURSOR-APPL-1                              44830000
447800                                   TO TRUE                        44840000
447900         MOVE -1                   TO MR-SELECTL (PV-SUB)         44850000
448000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         44860000
448100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         44870000
448200     END-IF.                                                      44880000
448300                                                                  44890000
448400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   44900000
448500                    - PV-TOP-ITEM + 1.                            44910000
448600                                                                  44920000
448700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      44930000
448800         CONTINUE                                                 44940000
448900     ELSE                                                         44950000
449000         SET DP030-SET-CURSOR-APPL-1                              44960000
449100                                   TO TRUE                        44970000
449200         MOVE -1                   TO MR-SELECTL (PV-SUB)         44980000
449300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         44990000
449400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         45000000
449500     END-IF.                                                      45010000
449600                                                                  45020000
449700/                                                                 45030000
449800*----------------------------------------------------------------*45040000
449900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *45050000
450000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *45060000
450100* FOR THE SELECTED ITEMS QUEUE.                                  *45070000
450200*                                                                *45080000
450300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *45090000
450400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *45100000
450500* THE ARRAY IS FULL.                                             *45110000
450600*----------------------------------------------------------------*45120000
450700                                                                  45130000
450800 5000-PREPARE-SEL-QUEUE.                                          45140000
450900                                                                  45150000
451000     MOVE +1                       TO ASC-BLK-SUB.                45160000
451100     PERFORM 5100-WRITE-TEMP-STORAGE.                             45170000
451200     ADD +1                        TO ASC-BLK-SUB.                45180000
451300     PERFORM 5100-WRITE-TEMP-STORAGE.                             45190000
451400                                                                  45200000
451500     MOVE ASC-SEL-QUEUE-NAME       TO PO013-SEL-QUEUE-NAME.       45210000
451600     PERFORM 6010-DELETE-SEL-QUEUE.                               45220000
451700                                                                  45230000
451800     SET PO012-IDX                 TO 1.                          45240000
451900     MOVE ZERO                     TO PO013-NUMBER-OF-TS-ITEMS.   45250000
452000     MOVE ZERO                     TO PV-SELECTED-COUNTER.        45260000
452100     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        45270000
452200                                                                  45280000
452300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           45290000
452400             VARYING PV-ITEM                                      45300000
452500             FROM 1 BY 1                                          45310000
452600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      45320000
452700             OR PV-SELECTED-COUNTER = +1.                         45330000
452800                                                                  45340000
452900     IF  PO012-IDX > 1                                            45350000
453000         PERFORM 5205-WRITE-SEL-QUEUE                             45360000
453100         ADD +1                    TO PO013-NUMBER-OF-TS-ITEMS    45370000
453200     END-IF.                                                      45380000
453300                                                                  45390000
453400/                                                                 45400000
453500*----------------------------------------------------------------*45410000
453600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *45420000
453700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *45430000
453800*----------------------------------------------------------------*45440000
453900                                                                  45450000
454000 5100-WRITE-TEMP-STORAGE.                                         45460000
454100                                                                  45470000
454200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     45480000
454300                                   TO PV-LIST-ITEM-NUMBER.        45490000
454400     COMPUTE PV-BLOCK-NUMBER =                                    45500000
454500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    45510000
454600                                                                  45520000
454700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             45530000
454800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             45540000
454900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      45550000
455000             PERFORM 5105-REWRITE-ASC-LISTQ                       45560000
455100         END-IF                                                   45570000
455200     ELSE                                                         45580000
455300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       45590000
455400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            45600000
455500         PERFORM 5110-WRITE-ASC-LISTQ                             45610000
455600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   45620000
455700     END-IF.                                                      45630000
455800                                                                  45640000
455900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      45650000
456000                                   TO TRUE.                       45660000
456100                                                                  45670000
456200/                                                                 45680000
456300*----------------------------------------------------------------*45690000
456400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *45700000
456500*  SPECIFIC COMMAREA.                                            *45710000
456600*----------------------------------------------------------------*45720000
456700 5105-REWRITE-ASC-LISTQ.                                          45730000
456800                                                                  45740000
456900     EXEC CICS                                                    45750000
457000         WRITEQ TS                                                45760000
457100             QUEUE (ASC-LIST-QUEUE-NAME)                          45770000
457200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               45780000
457300             ITEM  (PV-BLOCK-NUMBER)                              45790000
457400             REWRITE                                              45800000
457500             RESP  (PV-CICS-RESP)                                 45810000
457600     END-EXEC.                                                    45820000
457700                                                                  45830000
457800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           45840000
457900         CONTINUE                                                 45850000
458000     ELSE                                                         45860000
458100         SET DP013-CICS-ABEND      TO TRUE                        45870000
458200         SET DP013-NO-ROLLBACK     TO TRUE                        45880000
458300         MOVE '5105-REWRITE-ASC-LISTQ'                            45890000
458400                                   TO DP013-PARAGRAPH             45900000
458500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     45910000
458600                                   TO DP013-MESSAGE-TEXT(1)       45920000
458700         PERFORM DP013-0000-PROCESS-ABEND                         45930000
458800     END-IF.                                                      45940000
458900                                                                  45950000
459000/                                                                 45960000
459100*----------------------------------------------------------------*45970000
459200*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *45980000
459300*  SPECIFIC COMMAREA.                                            *45990000
459400*----------------------------------------------------------------*46000000
459500 5110-WRITE-ASC-LISTQ.                                            46010000
459600                                                                  46020000
459700     EXEC CICS                                                    46030000
459800         WRITEQ TS                                                46040000
459900             QUEUE (ASC-LIST-QUEUE-NAME)                          46050000
460000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               46060000
460100             ITEM  (PV-BLOCK-NUMBER)                              46070000
460200             RESP  (PV-CICS-RESP)                                 46080000
460300     END-EXEC.                                                    46090000
460400                                                                  46100000
460500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      46110000
460600         SET DP013-CICS-ABEND      TO TRUE                        46120000
460700         SET DP013-NO-ROLLBACK     TO TRUE                        46130000
460800         MOVE '5110-WRITE-ASC-LISTQ'                              46140000
460900                                   TO DP013-PARAGRAPH             46150000
461000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           46160000
461100                                   TO DP013-MESSAGE-TEXT(1)       46170000
461200         PERFORM DP013-0000-PROCESS-ABEND                         46180000
461300     END-IF.                                                      46190000
461400                                                                  46200000
461500/                                                                 46210000
461600*----------------------------------------------------------------*46220000
461700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *46230000
461800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *46240000
461900*----------------------------------------------------------------*46250000
462000                                                                  46260000
462100 5200-FILL-SEL-QUEUE-RECORD.                                      46270000
462200                                                                  46280000
462300     PERFORM 6112-READ-LIST-QUEUE.                                46290000
462400                                                                  46300000
462500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       46310000
462600         PERFORM                                                  46320000
462700         VARYING LQW-IDX                                          46330000
462800         FROM 1 BY 1                                              46340000
462900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            46350000
463000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          46360000
463100           OR  PV-SELECTED-COUNTER = +1                           46370000
463200                                                                  46380000
463300             IF  LQW-SELECT (LQW-IDX)                             46390000
463400                 ADD +1 TO PV-SELECTED-COUNTER                    46400000
463500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              46410000
463600                                   TO PO012-ITEM (PO012-IDX)      46420000
463700                 MOVE LQW-PO-NBR (LQW-IDX)                        46430000
463800                           TO PO012-PO-NBR (PO012-IDX)            46440000
463900                              PO017-PO-NBR                        46450000
464000                 MOVE LQW-GROUP-CDE (LQW-IDX)                     46460000
464100                           TO PO017-GROUP-CODE                    46470000
464200                 MOVE SPACE        TO PO012-ACTION-SW (PO012-IDX) 46480000
464300                 SET PO012-IDX UP BY 1                            46490000
464400                 IF  PO012-IDX > PO012-MAX-ITEMS                  46500000
464500                     PERFORM 5205-WRITE-SEL-QUEUE                 46510000
464600                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    46520000
464700                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         46530000
464800                     SET PO012-IDX TO 1                           46540000
464900                 END-IF                                           46550000
465000             END-IF                                               46560000
465100         END-PERFORM                                              46570000
465200     END-IF.                                                      46580000
465300                                                                  46590000
465400/                                                                 46600000
465500*----------------------------------------------------------------*46610000
465600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *46620000
465700*----------------------------------------------------------------*46630000
465800                                                                  46640000
465900 5205-WRITE-SEL-QUEUE.                                            46650000
466000                                                                  46660000
466100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            46670000
466200                                   TO PO012-SELECTED-ITEMS.       46680000
466300                                                                  46690000
466400     EXEC CICS                                                    46700000
466500          WRITEQ TS                                               46710000
466600              QUEUE (ASC-SEL-QUEUE-NAME)                          46720000
466700              FROM  (PO012-PO-SELECT-RECORD)                      46730000
466800              ITEM  (PV-SEL-QUEUE-ITEM)                           46740000
466900              RESP  (PV-CICS-RESP)                                46750000
467000     END-EXEC.                                                    46760000
467100                                                                  46770000
467200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          46780000
467300         CONTINUE                                                 46790000
467400     ELSE                                                         46800000
467500         SET DP013-CICS-ABEND      TO TRUE                        46810000
467600         SET DP013-NO-ROLLBACK     TO TRUE                        46820000
467700         MOVE '5205-WRITE-SEL-QUEUE'                              46830000
467800                                   TO DP013-PARAGRAPH             46840000
467900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          46850000
468000                                   TO DP013-MESSAGE-TEXT(1)       46860000
468100         PERFORM DP013-0000-PROCESS-ABEND                         46870000
468200     END-IF.                                                      46880000
468300                                                                  46890000
468400/                                                                 46900000
468500*----------------------------------------------------------------*46910000
468600*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *46920000
468700*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *46930000
468800*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *46940000
468900*  THE USER.                                                     *46950000
469000*----------------------------------------------------------------*46960000
469100 6000-REFRESH-PANEL-FROM-TEMP.                                    46970000
469200                                                                  46980000
469300     IF  ASC-UPDATE-TSQ                                           46990000
469400         SET ASC-NO-TSQ-UPDATE     TO TRUE                        47000000
469500         MOVE ZERO                 TO PV-SAVE-ITEM                47010000
469600                                      PV-SEL-QUEUE-ITEM           47020000
469700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        47030000
469800                                   TO PV-HOLD-SELECTED-ITEMS      47040000
469900                                                                  47050000
470000         PERFORM 6100-UPDATE-TSQ                                  47060000
470100             UNTIL PV-ITEMS-PROCESSED >                           47070000
470200                                     ASC-NUMBER-OF-SELECTED-ITEMS 47080000
470300         PERFORM 6010-DELETE-SEL-QUEUE                            47090000
470400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         47100000
470500                    ASC-BLOCK-ENTRIES (2)                         47110000
470600     END-IF.                                                      47120000
470700                                                                  47130000
470800/                                                                 47140000
470900*----------------------------------------------------------------*47150000
471000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *47160000
471100*----------------------------------------------------------------*47170000
471200 6010-DELETE-SEL-QUEUE.                                           47180000
471300                                                                  47190000
471400     EXEC CICS                                                    47200000
471500         DELETEQ TS                                               47210000
471600             QUEUE (ASC-SEL-QUEUE-NAME)                           47220000
471700             RESP  (PV-CICS-RESP)                                 47230000
471800     END-EXEC.                                                    47240000
471900                                                                  47250000
472000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      47260000
472100         (PV-CICS-RESP = DFHRESP(QIDERR)))                        47270000
472200         CONTINUE                                                 47280000
472300     ELSE                                                         47290000
472400         SET DP013-CICS-ABEND      TO TRUE                        47300000
472500         SET DP013-NO-ROLLBACK     TO TRUE                        47310000
472600         MOVE '6010-DELETE-SEL-QUEUE'                             47320000
472700                                   TO DP013-PARAGRAPH             47330000
472800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         47340000
472900                                   TO DP013-MESSAGE-TEXT (1)      47350000
473000         PERFORM DP013-0000-PROCESS-ABEND                         47360000
473100     END-IF.                                                      47370000
473200                                                                  47380000
473300/                                                                 47390000
473400*----------------------------------------------------------------*47400000
473500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *47410000
473600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *47420000
473700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *47430000
473800*    THE TEMP QUEUE.                                             *47440000
473900*----------------------------------------------------------------*47450000
474000                                                                  47460000
474100 6100-UPDATE-TSQ.                                                 47470000
474200                                                                  47480000
474300     ADD 1                         TO PV-SEL-QUEUE-ITEM.          47490000
474400     PERFORM 6105-READ-SEL-QUEUE.                                 47500000
474500                                                                  47510000
474600     PERFORM                                                      47520000
474700         VARYING PO012-IDX                                        47530000
474800         FROM 1 BY 1                                              47540000
474900         UNTIL ((PV-ITEMS-PROCESSED >                             47550000
475000                              PV-HOLD-SELECTED-ITEMS)             47560000
475100         OR (PO012-IDX GREATER THAN PO012-MAX-ITEMS))             47570000
475200         IF  PO012-ACTION-SW (PO012-IDX) > SPACE                  47580000
475300             PERFORM 6110-PROCESS-ITEMS                           47590000
475400         END-IF                                                   47600000
475500         ADD +1                    TO PV-ITEMS-PROCESSED          47610000
475600     END-PERFORM.                                                 47620000
475700                                                                  47630000
475800     PERFORM 6111-WRITE-LIST-QUEUE.                               47640000
475900                                                                  47650000
476000/                                                                 47660000
476100*----------------------------------------------------------------*47670000
476200*    READ THE LIST QUEUE RECORD.                                 *47680000
476300*----------------------------------------------------------------*47690000
476400                                                                  47700000
476500 6105-READ-SEL-QUEUE.                                             47710000
476600                                                                  47720000
476700     EXEC CICS                                                    47730000
476800          READQ TS                                                47740000
476900              QUEUE (ASC-SEL-QUEUE-NAME)                          47750000
477000              INTO  (PO012-PO-SELECT-RECORD)                      47760000
477100              ITEM  (PV-SEL-QUEUE-ITEM)                           47770000
477200              RESP  (PV-CICS-RESP)                                47780000
477300     END-EXEC.                                                    47790000
477400                                                                  47800000
477500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          47810000
477600         CONTINUE                                                 47820000
477700     ELSE                                                         47830000
477800         SET DP013-CICS-ABEND      TO TRUE                        47840000
477900         SET DP013-NO-ROLLBACK     TO TRUE                        47850000
478000         MOVE '6105-READ-SEL-QUEUE'                               47860000
478100                                   TO DP013-PARAGRAPH             47870000
478200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           47880000
478300                                   TO DP013-MESSAGE-TEXT(1)       47890000
478400         PERFORM DP013-0000-PROCESS-ABEND                         47900000
478500     END-IF.                                                      47910000
478600                                                                  47920000
478700/                                                                 47930000
478800*----------------------------------------------------------------*47940000
478900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*47950000
479000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*47960000
479100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *47970000
479200*----------------------------------------------------------------*47980000
479300                                                                  47990000
479400 6110-PROCESS-ITEMS.                                              48000000
479500                                                                  48010000
479600     COMPUTE PV-ITEM = 1 + ((PO012-ITEM (PO012-IDX) - 1)          48020000
479700                     / PC-ITEMS-PER-PANEL).                       48030000
479800                                                                  48040000
479900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           48050000
480000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          48060000
480100             PERFORM 6111-WRITE-LIST-QUEUE                        48070000
480200         END-IF                                                   48080000
480300         MOVE PV-ITEM              TO PV-SAVE-ITEM                48090000
480400                                                                  48100000
480500         PERFORM 6112-READ-LIST-QUEUE                             48110000
480600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               48120000
480700             CONTINUE                                             48130000
480800         END-IF                                                   48140000
480900     END-IF.                                                      48150000
481000                                                                  48160000
481100     COMPUTE PV-SUB = (PO012-ITEM (PO012-IDX)                     48170000
481200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              48180000
481300                                                                  48190000
481400     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       48200000
481500     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        48210000
481600                                     (PV-SUB).                    48220000
481700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                48230000
481800                                                                  48240000
481900/                                                                 48250000
482000*----------------------------------------------------------------*48260000
482100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *48270000
482200*----------------------------------------------------------------*48280000
482300                                                                  48290000
482400 6111-WRITE-LIST-QUEUE.                                           48300000
482500                                                                  48310000
482600     EXEC CICS                                                    48320000
482700         WRITEQ TS                                                48330000
482800             QUEUE (ASC-LIST-QUEUE-NAME)                          48340000
482900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     48350000
483000             ITEM  (PV-SAVE-ITEM)                                 48360000
483100             REWRITE                                              48370000
483200             RESP  (PV-CICS-RESP)                                 48380000
483300     END-EXEC.                                                    48390000
483400                                                                  48400000
483500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          48410000
483600         CONTINUE                                                 48420000
483700     ELSE                                                         48430000
483800         SET DP013-CICS-ABEND      TO TRUE                        48440000
483900         SET DP013-NO-ROLLBACK     TO TRUE                        48450000
484000         MOVE '6111-WRITE-LIST-QUEUE'                             48460000
484100                                   TO DP013-PARAGRAPH             48470000
484200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  48480000
484300                                   TO DP013-MESSAGE-TEXT(1)       48490000
484400         PERFORM DP013-0000-PROCESS-ABEND                         48500000
484500     END-IF.                                                      48510000
484600                                                                  48520000
484700/                                                                 48530000
484800*----------------------------------------------------------------*48540000
484900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*48550000
485000*----------------------------------------------------------------*48560000
485100                                                                  48570000
485200 6112-READ-LIST-QUEUE.                                            48580000
485300                                                                  48590000
485400     EXEC CICS                                                    48600000
485500         READQ TS                                                 48610000
485600             QUEUE (ASC-LIST-QUEUE-NAME)                          48620000
485700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     48630000
485800             ITEM  (PV-ITEM)                                      48640000
485900             RESP  (PV-CICS-RESP)                                 48650000
486000     END-EXEC.                                                    48660000
486100                                                                  48670000
486200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          48680000
486300         CONTINUE                                                 48690000
486400     ELSE                                                         48700000
486500         SET DP013-CICS-ABEND      TO TRUE                        48710000
486600         SET DP013-NO-ROLLBACK     TO TRUE                        48720000
486700         MOVE '6112-READ-LIST-QUEUE'                              48730000
486800                                   TO DP013-PARAGRAPH             48740000
486900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    48750000
487000                                   TO DP013-MESSAGE-TEXT(1)       48760000
487100         PERFORM DP013-0000-PROCESS-ABEND                         48770000
487200     END-IF.                                                      48780000
487300/                                                                 48790000
487400*----------------------------------------------------------------*48800000
487500*    ABEND PROCESSOR MODULE                                      *48810000
487600*----------------------------------------------------------------*48820000
487700                                                                  48830000
487800     COPY DPPD013.                                                48840000
