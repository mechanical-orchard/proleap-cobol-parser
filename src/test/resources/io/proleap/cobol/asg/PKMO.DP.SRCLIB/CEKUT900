000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020000
000300                                                                  00030000
000400 PROGRAM-ID.    CEKUT900.                                         00040000
000500 AUTHOR.        RON KRIER.                                        00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   OCTOBER 2022.                                     00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000******************************************************************00100000
001100* THE PURPOSE OF THIS PROGRAM IS TO ASSIGN SML NUMBERS TO DATA    00110000
001200* IN THE CERD048 INPUT FILE THAT HAS INVALID SML NUMBERS IN THE   00120000
001300* DATA.                                                           00130000
001400******************************************************************00140000
001500******************************************************************00150000
001600* PROGRAM WILL TAKE IN 2 INPUT FILES.  THE FIRST BEING A FILE OF  00160000
001700* CERD048 DATA THAT HAS INVALID SML NUMBERS IN THE DATA.  DATA    00170000
001800* NEEDS TO BE SORTED BY STORE NUMBER AND THEN CARTON NUMBER.      00180000
001900*                                                                 00190000
002000* THE SECOND FILE WILL BE CONTROL TYPE FILE WHICH WILL HAVE A     00200000
002100* RECORD FOR EACH STORE THAT WOULD BE FOUND ON THE FIRST INPUT    00210000
002200* FILE.  THIS SECOND INPUT FILE WILL THEN HAVE A FIELD WHICH      00220000
002300* WILL CONTAIN A STARTING SML NUMBER FOR THE STORE TO BE USED     00230000
002400* FOR ASSIGNING TO THE CARTON NUMBER FIELD FROM THE FIRST         00240000
002500* INPUT FILE.                                                     00250000
002600******************************************************************00260000
002700******************************************************************00270000
002800 ENVIRONMENT DIVISION.                                            00280000
002900******************************************************************00290000
003000 CONFIGURATION SECTION.                                           00300000
003100 SOURCE-COMPUTER.        IBM-3090.                                00310000
003200 OBJECT-COMPUTER.        IBM-3090.                                00320000
003300                                                                  00330000
003400 INPUT-OUTPUT SECTION.                                            00340000
003500 FILE-CONTROL.                                                    00350000
003600                                                                  00360000
003700     SELECT PROD-CARTON-FILE                                      00370000
003800         ASSIGN TO INP01.                                         00380000
003900                                                                  00390000
004000     SELECT CONTROL-FILE                                          00400000
004100         ASSIGN TO INP02.                                         00410000
004200                                                                  00420000
004300     SELECT PROD-FIXED-CARTON-FILE                                00430000
004400         ASSIGN TO OUT01.                                         00440000
004500                                                                  00450000
004600******************************************************************00460000
004700 DATA DIVISION.                                                   00470000
004800******************************************************************00480000
004900                                                                  00490000
005000 FILE SECTION.                                                    00500000
005100                                                                  00510000
005200 FD  PROD-CARTON-FILE                                             00520000
005300     RECORDING MODE IS F                                          00530000
005400     LABEL RECORDS ARE STANDARD                                   00540000
005500     RECORD CONTAINS 100                                          00550000
005600     BLOCK CONTAINS 0 RECORDS                                     00560000
005700     DATA RECORD IS PROD-CARTON-RECORD.                           00570000
005800                                                                  00580000
005900 01  PROD-CARTON-RECORD        PIC  X(100).                       00590000
006000                                                                  00600000
006100 FD  CONTROL-FILE                                                 00610000
006200     RECORDING MODE IS F                                          00620000
006300     LABEL RECORDS ARE STANDARD                                   00630000
006400     RECORD CONTAINS 80                                           00640000
006500     BLOCK CONTAINS 0 RECORDS                                     00650000
006600     DATA RECORD IS CONTROL-RECORD.                               00660000
006700                                                                  00670000
006800 01  CONTROL-RECORD            PIC  X(80).                        00680000
006900                                                                  00690000
007000 FD  PROD-FIXED-CARTON-FILE                                       00700000
007100     RECORDING MODE IS F                                          00710000
007200     LABEL RECORDS ARE STANDARD                                   00720000
007300     RECORD CONTAINS 100                                          00730000
007400     BLOCK CONTAINS 0 RECORDS                                     00740000
007500     DATA RECORD IS PROD-FIXED-CARTON-RECORD.                     00750000
007600                                                                  00760000
007700 01  PROD-FIXED-CARTON-RECORD  PIC  X(100).                       00770000
007800                                                                  00780000
007900******************************************************************00790000
008000 WORKING-STORAGE SECTION.                                         00800000
008100******************************************************************00810000
008200 01  PS-PROGRAM-SWITCHES.                                         00820000
008300     05  PS-EOF-CARTON-SW             PIC X(01)  VALUE 'N'.       00830000
008400         88  PS-EOF-CARTON                       VALUE 'Y'.       00840000
008500         88  PS-NOT-EOF-CARTON                   VALUE 'N'.       00850000
008600     05  PS-EOF-CONTROL-SW            PIC X(01)  VALUE 'N'.       00860000
008700         88  PS-EOF-CONTROL                      VALUE 'Y'.       00870000
008800         88  PS-NOT-EOF-CONTROL                  VALUE 'N'.       00880000
008900     05  PS-STORE-MATCH-SW            PIC X(01)  VALUE 'N'.       00890000
009000         88  PS-STORE-MATCHED                    VALUE 'Y'.       00900000
009100         88  PS-STORE-NOT-MATCHED                VALUE 'N'.       00910000
009200         88  PS-STORE-MATCH-END                  VALUE 'E'.       00920000
009300     05  PS-CARTON-MATCH-SW           PIC X(01)  VALUE 'N'.       00930000
009400         88  PS-CARTON-MATCHED                   VALUE 'Y'.       00940000
009500         88  PS-CARTON-NOT-MATCHED               VALUE 'N'.       00950000
009600         88  PS-CARTON-MATCH-END                 VALUE 'E'.       00960000
009700                                                                  00970000
009800 01  IR-CONTROL-RECORD.                                           00980000
009900     05  IR-STORE-NBR                   PIC 9(04).                00990000
009910     05  FILLER                         PIC X(01).                00991002
010000     05  IR-START-SML-NBR.                                        01000000
010100         10  IR-START-SML-1-5           PIC 9(05).                01010007
010110         10  IR-START-SML-STORE         PIC 9(04).                01011007
010120         10  IR-START-SML-DC            PIC 9(03).                01012007
010200         10  IR-START-SML-13-20         PIC 9(08).                01020000
010300     05  FILLER                         PIC X(75) VALUE SPACE.    01030002
010400                                                                  01040000
010500 01  PC-PROGRAM-CONSTANTS.                                        01050000
010600     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'CEKUT900'. 01060000
010700     05  PC-DEFAULT-TMST              PIC X(26) VALUE             01070000
010800                                     '9999-99-99-99.99.99.999999'.01080000
010900     05  PC-A                         PIC X(01) VALUE 'A'.        01090000
011000     05  PC-B                         PIC X(01) VALUE 'B'.        01100000
011100     05  PC-C                         PIC X(01) VALUE 'C'.        01110000
011200     05  PC-I                         PIC X(01) VALUE 'I'.        01120000
011300     05  PC-M                         PIC X(01) VALUE 'M'.        01130000
011400     05  PC-N                         PIC X(01) VALUE 'N'.        01140000
011500     05  PC-S                         PIC X(01) VALUE 'S'.        01150000
011600     05  PC-Y                         PIC X(01) VALUE 'Y'.        01160000
011700                                                                  01170000
011800 01  PV-PROGRAM-VARIABLES.                                        01180000
011900     05  PV-CART-RECORDS-READ         PIC 9(09)  VALUE ZERO.      01190000
012000     05  PV-CONTROL-RECORDS-READ      PIC 9(09)  VALUE ZERO.      01200000
012100     05  PV-CART-RECORDS-WRITTEN      PIC 9(09)  VALUE ZERO.      01210000
012200     05  PV-STORE-RECORDS-WRITTEN     PIC 9(09)  VALUE ZERO.      01220000
012300     05  PV-HOLD-STORE-NBR            PIC 9(04)  VALUE ZERO.      01230000
012310     05  PV-HOLD-SML-NBR              PIC X(20)  VALUE SPACE.     01231006
012400     05  PV-PREV-IR-STORE-NBR         PIC 9(04)  VALUE ZERO.      01240000
012500     05  PV-PREV-CARTON-NBR           PIC X(20)  VALUE SPACE.     01250005
012600     05  PV-ONE-UP-CARTON-NBR         PIC 9(08)  VALUE ZERO.      01260000
012700     05  PV-DISPLAY-NBR-9             PIC ZZZ,ZZZ,ZZ9.            01270000
012800                                                                  01280000
012900******************************************************************01290000
013000*  COPYBOOK CERD048 (CARTON - INPUT AND OUTPUT FILE LAYOUT)       01300000
013100******************************************************************01310000
013200     COPY CERD048.                                                01320000
013300                                                                  01330000
013400******************************************************************01340000
013500 PROCEDURE DIVISION.                                              01350000
013600******************************************************************01360000
013700 0000-PROGRAM-MAINLINE.                                           01370000
013800                                                                  01380000
013810     DISPLAY 'START OF CEKUT900 PROGRAM'.                         01381000
013811     DISPLAY ' '.                                                 01381100
013820                                                                  01382000
013900     OPEN INPUT  PROD-CARTON-FILE                                 01390000
014000          INPUT  CONTROL-FILE                                     01400000
014100          OUTPUT PROD-FIXED-CARTON-FILE.                          01410000
014200                                                                  01420000
014300     PERFORM 1000-READ-CONTROL-FILE.                              01430000
014400                                                                  01440000
014500     IF  PS-EOF-CONTROL                                           01450000
014600         DISPLAY '*****************************************'      01460000
014700         DISPLAY '**       PROGRAM DID NOT EXECUTE       **'      01470000
014800         DISPLAY '**       CONTROL FILE WAS EMPTY        **'      01480000
014900         DISPLAY '*****************************************'      01490000
015000         PERFORM 9000-EOJ                                         01500000
015100     END-IF.                                                      01510008
015800                                                                  01580000
015900     PERFORM 8000-READ-PROD-CARTON-FILE.                          01590000
016000                                                                  01600000
016100     IF  PS-EOF-CARTON                                            01610000
016200         DISPLAY '*****************************************'      01620000
016300         DISPLAY '**       PROGRAM DID NOT EXECUTE       **'      01630000
016400         DISPLAY '**        CARTON FILE WAS EMTPY        **'      01640000
016500         DISPLAY '*****************************************'      01650000
016600         PERFORM 9000-EOJ                                         01660000
016700     ELSE                                                         01670000
016800         MOVE CE048-STORE-NUMBER TO PV-HOLD-STORE-NBR             01680000
016900         MOVE CE048-SHIPT-UNT-ID TO PV-PREV-CARTON-NBR            01690005
017000     END-IF.                                                      01700000
017100                                                                  01710000
017200     PERFORM 2000-PROCESS-CARTON-FILE                             01720000
017300         UNTIL PS-EOF-CARTON                                      01730000
017400            OR PS-EOF-CONTROL.                                    01740000
017500                                                                  01750000
017600     PERFORM 9000-EOJ.                                            01760000
017700                                                                  01770000
017800******************************************************************01780000
017900* READ RECORD FROM THE INPUT CONTROL FILE TO GET THE STORE        01790000
018000* RELATED DATA TO CHANGE                                          01800000
018100******************************************************************01810000
018200 1000-READ-CONTROL-FILE.                                          01820000
018300                                                                  01830000
018400     READ CONTROL-FILE                                            01840000
018500          INTO IR-CONTROL-RECORD                                  01850000
018600            AT END                                                01860000
018700               SET PS-EOF-CONTROL   TO TRUE                       01870000
018800            NOT AT END                                            01880000
018900               SET PS-NOT-EOF-CONTROL TO TRUE                     01890000
019000               ADD +1 TO PV-CONTROL-RECORDS-READ                  01900001
019100     END-READ.                                                    01910000
019110                                                                  01911007
019120     IF  PS-EOF-CONTROL                                           01912007
019121         NEXT SENTENCE                                            01912107
019180     ELSE                                                         01918007
019190         IF  IR-STORE-NBR = IR-START-SML-STORE                    01919007
019191             MOVE IR-STORE-NBR TO PV-PREV-IR-STORE-NBR            01919107
019192             MOVE IR-START-SML-13-20 TO PV-ONE-UP-CARTON-NBR      01919207
019193             DISPLAY 'PROCESSING STORE NUMBER: '                  01919307
019194                     IR-STORE-NBR ' WITH STARTING SML NUMBER: '   01919407
019195                     IR-START-SML-NBR                             01919507
019196         ELSE                                                     01919607
019197             DISPLAY '*****************************************'  01919707
019198             DISPLAY '**      PROGRAM ENDED IN ERROR         **'  01919807
019199             DISPLAY '**   MISMATCH IN STORE NUMBER AND      **'  01919907
019200             DISPLAY '**    STORE NUMBER IN SML NUMBER       **'  01920007
019201             DISPLAY '*****************************************'  01920107
019202             DISPLAY ' '                                          01920207
019203             DISPLAY '* INVALID STORE CONTROL RECORD *'           01920307
019204                     ' - STORE NUMBER IN POSITION 1: '            01920407
019205                     IR-STORE-NBR                                 01920507
019206                     ' - STORE NUMBER IN SML NUMBER: '            01920607
019207                     IR-START-SML-STORE                           01920707
019208             MOVE 4008 TO RETURN-CODE                             01920807
019209             PERFORM 9000-EOJ                                     01920907
019210         END-IF                                                   01921007
019211     END-IF.                                                      01921107
019220                                                                  01922000
019300******************************************************************01930000
019400* PROCESS INPUT RECORDS                                          *01940000
019500******************************************************************01950000
019600 2000-PROCESS-CARTON-FILE.                                        01960000
019700                                                                  01970004
019710*    DISPLAY '2000-PROCESS-CARTON-FILE'.                          01971004
019711*    DISPLAY 'CE048-STORE-NUMBER IS: '                            01971104
019712*            CE048-STORE-NUMBER.                                  01971204
019713*    DISPLAY 'IR-STORE-NBR IS:       '                            01971304
019714*            IR-STORE-NBR.                                        01971404
019715*    DISPLAY 'CE048-SHIPT-UNT-ID IS: '                            01971504
019716*            CE048-SHIPT-UNT-ID.                                  01971604
019717*    DISPLAY 'PV-PREV-CARTON-NBR IS: '                            01971705
019718*            PV-PREV-CARTON-NBR.                                  01971805
019720                                                                  01972003
019800     IF  CE048-STORE-NUMBER = IR-STORE-NBR                        01980000
019900         IF  CE048-SHIPT-UNT-ID = PV-PREV-CARTON-NBR              01990005
020000             MOVE IR-START-SML-NBR TO CE048-SHIPT-UNT-ID          02000000
020100             ADD +1 TO PV-STORE-RECORDS-WRITTEN                   02010000
020200             PERFORM 7000-WRITE-OUTPUT                            02020000
020300             PERFORM 8000-READ-PROD-CARTON-FILE                   02030000
020400         ELSE                                                     02040000
020410             MOVE CE048-SHIPT-UNT-ID TO PV-PREV-CARTON-NBR        02041005
020500             ADD +1 TO IR-START-SML-13-20                         02050000
020501                                                                  02050112
020510             IF  CE048-DC-NUMBER = 809                            02051012
020520                 MOVE 806 TO IR-START-SML-DC                      02052012
020530             END-IF                                               02053012
020540             IF  CE048-DC-NUMBER = 819                            02054012
020550                 MOVE 816 TO IR-START-SML-DC                      02055012
020560             END-IF                                               02056012
020570             IF  CE048-DC-NUMBER = 829                            02057012
020580                 MOVE 826 TO IR-START-SML-DC                      02058012
020590             END-IF                                               02059012
020591             IF  CE048-DC-NUMBER = 839                            02059112
020592                 MOVE 836 TO IR-START-SML-DC                      02059212
020593             END-IF                                               02059312
020594             IF  CE048-DC-NUMBER = 849                            02059412
020595                 MOVE 813 TO IR-START-SML-DC                      02059512
020596             END-IF                                               02059612
020597             IF  CE048-DC-NUMBER = 873                            02059712
020598                 MOVE 870 TO IR-START-SML-DC                      02059812
020599             END-IF                                               02059912
020600             MOVE IR-START-SML-NBR TO CE048-SHIPT-UNT-ID          02060000
020700             ADD +1 TO PV-STORE-RECORDS-WRITTEN                   02070000
020800             PERFORM 7000-WRITE-OUTPUT                            02080000
021000             PERFORM 8000-READ-PROD-CARTON-FILE                   02100000
021100         END-IF                                                   02110000
021200     ELSE                                                         02120000
021300         IF  CE048-STORE-NUMBER > IR-STORE-NBR                    02130001
021301             MOVE CE048-SHIPT-UNT-ID TO PV-PREV-CARTON-NBR        02130109
021400             DISPLAY 'END OF PROCESSING FOR STORE: '              02140000
021500                     PV-PREV-IR-STORE-NBR                         02150000
021600             MOVE PV-STORE-RECORDS-WRITTEN TO                     02160000
021700                  PV-DISPLAY-NBR-9                                02170001
021800             DISPLAY 'NUMBER OF CARTON RECORDS WRITTEN: '         02180000
021900                     PV-DISPLAY-NBR-9                             02190000
022000             DISPLAY ' '                                          02200000
022100             MOVE ZERO TO PV-STORE-RECORDS-WRITTEN                02210000
022200             PERFORM 1000-READ-CONTROL-FILE                       02220000
022300         ELSE                                                     02230000
022400             DISPLAY 'CERD048 RECORD FOR STORE '                  02240000
022500                     CE048-STORE-NUMBER                           02250001
022600                     ' FOR CARTON '                               02260000
022700                     CE048-SHIPT-UNT-ID                           02270000
022800                     ' DID NOT GET PROCESSED - NO STORE CONTROL'  02280000
022900             PERFORM 8000-READ-PROD-CARTON-FILE                   02290000
023000     END-IF.                                                      02300000
023100                                                                  02310000
023110     IF  PS-EOF-CARTON                                            02311004
023120         DISPLAY 'END OF PROCESSING FOR STORE: '                  02312004
023130                 PV-PREV-IR-STORE-NBR                             02313004
023140         MOVE PV-STORE-RECORDS-WRITTEN TO                         02314004
023150              PV-DISPLAY-NBR-9                                    02315004
023160         DISPLAY 'NUMBER OF CARTON RECORDS WRITTEN: '             02316004
023170                 PV-DISPLAY-NBR-9                                 02317004
023180         DISPLAY ' '                                              02318004
023190         MOVE ZERO TO PV-STORE-RECORDS-WRITTEN                    02319004
023191     END-IF.                                                      02319104
023192                                                                  02319204
023200     IF  PS-EOF-CONTROL                                           02320000
023300         MOVE 1 TO PV-STORE-RECORDS-WRITTEN                       02330000
023400         PERFORM 8000-READ-PROD-CARTON-FILE                       02340000
023500           UNTIL PS-EOF-CARTON                                    02350000
023600         MOVE PV-STORE-RECORDS-WRITTEN TO                         02360000
023700              PV-DISPLAY-NBR-9                                    02370000
023800         DISPLAY 'NUMBER OF CARTON RECORDS WITHOUT A '            02380000
023900                 'STORE NUMBER CONTROL RECORD DUE TO EOF: '       02390000
024000                 PV-DISPLAY-NBR-9                                 02400000
024100     END-IF.                                                      02410000
024200                                                                  02420000
024300****************************************************************  02430000
024400*                                                              *  02440000
024500*                                                              *  02450000
024600****************************************************************  02460000
024700 7000-WRITE-OUTPUT.                                               02470000
024800                                                                  02480000
024900     MOVE SPACE TO CE048-ERROR-CODE                               02490000
025000                   CE048-ERROR-DATE.                              02500000
025100                                                                  02510000
025200     WRITE PROD-FIXED-CARTON-RECORD                               02520000
025300      FROM CE048-PULL-BRCD-EXTRACT-REC.                           02530000
025310                                                                  02531006
025320     IF  PV-HOLD-SML-NBR = CE048-SHIPT-UNT-ID                     02532006
025330         CONTINUE                                                 02533006
025340     ELSE                                                         02534006
025350         DISPLAY 'NEW SML NUMBER USED: '                          02535006
025360                 CE048-SHIPT-UNT-ID                               02536006
025361         MOVE CE048-SHIPT-UNT-ID TO PV-HOLD-SML-NBR               02536106
025370     END-IF.                                                      02537006
025400                                                                  02540000
025500     ADD +1 TO PV-CART-RECORDS-WRITTEN.                           02550000
025600                                                                  02560000
025700****************************************************************  02570000
025800*                                                              *  02580000
025900*                                                              *  02590000
026000****************************************************************  02600000
026100 8000-READ-PROD-CARTON-FILE.                                      02610000
026200                                                                  02620000
026300     READ PROD-CARTON-FILE                                        02630000
026400          INTO CE048-PULL-BRCD-EXTRACT-REC                        02640000
026500            AT END                                                02650000
026600               SET PS-EOF-CARTON TO TRUE                          02660000
026700            NOT AT END                                            02670000
026800               SET PS-NOT-EOF-CARTON TO TRUE                      02680000
026900               ADD +1 TO PV-CART-RECORDS-READ                     02690000
027000     END-READ.                                                    02700000
027100                                                                  02710000
027200****************************************************************  02720000
027300*                                                              *  02730000
027400*                                                              *  02740000
027500****************************************************************  02750000
027600 9000-EOJ.                                                        02760000
027700                                                                  02770000
027800     CLOSE PROD-CARTON-FILE                                       02780000
027900           CONTROL-FILE                                           02790000
028000           PROD-FIXED-CARTON-FILE.                                02800000
028200                                                                  02820000
028210     MOVE PV-CONTROL-RECORDS-READ TO PV-DISPLAY-NBR-9.            02821000
028400     DISPLAY ' RECORDS READ FROM STORE CONTROL FILE:  '           02840000
028500             PV-DISPLAY-NBR-9.                                    02850000
028600                                                                  02860000
028610     MOVE PV-CART-RECORDS-READ TO PV-DISPLAY-NBR-9.               02861000
028620     DISPLAY ' RECORDS READ FROM CARTON FILE:  '                  02862000
028630             PV-DISPLAY-NBR-9.                                    02863000
028640                                                                  02864000
029500     MOVE PV-CART-RECORDS-WRITTEN TO PV-DISPLAY-NBR-9.            02950000
029600     DISPLAY ' RECORDS WRITTEN TO THE FIXED CARTON FILE:  '       02960000
029700             PV-DISPLAY-NBR-9.                                    02970000
031600                                                                  03160000
031610     DISPLAY ' '.                                                 03161000
031620     DISPLAY 'END OF CEKUT900 PROGRAM'.                           03162000
031630                                                                  03163000
031700     STOP RUN.                                                    03170000
