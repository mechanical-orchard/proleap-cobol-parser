000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.    SVKUP005.                                         00040000
000500 AUTHOR.        JEFF BOLWERK.                                     00050000
000600 DATE-WRITTEN.  AUGUST 1996.                                      00060000
000700***************************************************************   00070000
000900*    THIS PROGRAM CREATES THE KMRC AND GIFT CARD EMBOSSING        00080000
001000*    EXTRACT FILES FOR THE EMBOSSERS.                             00090000
001100*                                                                 00100000
001200*    DB2 TABLES ARE READ (SVT_KOHLS_CRD_ACCT, SVT_CRD_PROD)       00110000
001300*    TO EXTRACT THE CONTROL AND CARD NUMBERS, AND OTHER           00120000
001400*    INFORMATION.                                                 00130000
001500*                                                                 00140000
001600*    EACH REQUEST IS EXTRACTED AND A SPECIFIC NUMBER OF RECORDS   00150000
001700*    ARE WRITTEN TO AN EXTRACT FILE.  THE REQUEST NUMBER WILL     00160000
001800*    BE INCLUDED IN THE MEMBER NAME, AND IF THERE ARE MULTIPLE    00170000
001900*    MEMBERS RELATED TO A REQUEST, A SEQUENCE NUMBER WILL BE      00180000
002000*    INCREMENTED WITHIN THE MEMBER NAME TO INDICATE THIS.         00190000
002100*    FOR EXAMPLE, IF 20,000 KMRC CARDS ARE REQUESTED BY REQUEST   00200000
002200*    4, AND THE PARAM CARD INDICATES THERE SHOULD BE 5000         00210000
002300*    RECORDS PER MEMBER THE MEMBER NAMES WILL LOOK AS FOLLOWS:    00220000
002400*           RK000401                                              00230000
002500*           RK000402                                              00240000
002600*           RK000403                                              00250000
002700*           RK000404                                              00260000
002800*           RK000405                                              00270000
P5211 ******************************************************************00280000
P5211 *  06/05/13 COGNIZANT 5211 - VIRTUAL GIFT CARDS PROJECT          *00290000
P5211 *                     MODIFIED THE KMC-REQUEST CURSOR TO EXCLUDE *00300000
P5211 *                     ANY NEW B2B VIRTUAL GIFT CARDS ('V' IN     *00310000
P5211 *                     CRD_PRDR_CDE OF SVT_CRD_PROD TABLE         *00320000
P5211 ******************************************************************00330000
P5266 *  07/29/13 COGNIZANT NEW VENDOR ADDED BY REPLACING THE EXISTING *00340000
P5266 *                     I.E, REPLACED 'AB TEUTEBERG' TO 'HARVARD'  *00350000
P5266 ******************************************************************00360000
JPGFX1* 07/14/2014 JOE GARDETTO                                         00370000
JPGFX1*    -Added logic to add ZZHALLMARK extension to the end of the   00380000
JPGFX1*     request files for Hallmark.  Bizlink needs this to          00390000
JPGFX1*     identify the destination for the file. CHG0087016           00400000
JPGFX1******************************************************************00410000
JPGFX2* 12/09/2014 JOE GARDETTO                                         00420000
JPGFX2*    -Added logic to cause the program to abend if the number of  00430000
JPGFX2*     file segments exceeds 99.              CHG0100360           00440000
JPGFX2******************************************************************00450000
JPGFX2* 04/15/2015 Monica Mahadik                                       00460000
JPGFX2*    -Added logic to send GC file in MFT format                   00470000
JPGFX2*                                            CHG0109922           00480000
jPGFX2******************************************************************00490000
BJSFX3******************************************************************00500000
BJSFX3* 12/01/2015 Barb Schultz                                         00510000
BJSFX3*    -Deleted MFT logic for Kohls cards                           00520000
BJSFX3*    -Deleted FTP logic for VENDOR CARDS                          00530000
BJSFX3*    -Added new control card with dataset name for dynamically    00531000
BJSFX3*     allocating the file names                                   00531100
BJSFX3*    -Dynamically allocate the files changing it from a PDS       00531200
BJSFX3*     to flat file where the flat file uses the control           00531300
BJSFX3*     card + the member naming convention that was already        00531400
BJSFX3*     established in this program                                 00531500
BJSFX3*    -added output files for reports SVK05505 and SVK05515        00531600
BJSFX3*    -added output files for temporary output files               00531700
BJSFX3*                                            CHG0132098           00531800
BJSFX3******************************************************************00531900
005319******************************************************************00532000
005320* 05/17/2016 NEHA BAGRODIA                                        00532100
005321*    -RECOMPILE FOR SVWS004 AND SVRD022                           00532200
005322*                                            CHG0141575           00532300
005323******************************************************************00532400
WR7057* 10/04/2017 BARB SCHULTZ                                         00532500
WR7057*    -MODIFIED THE PROGRAM TO ADD VALID AND REPLACED CPI WITH     00532600
WR7057*     ABCORP.                                                     00532700
WR7057*     WR1834727057                           CHG0183506           00532800
005323******************************************************************00532900
092122* 09/14/2022 DAN PAYNTER                                          00533000
092122*    -MODIFIED THE PROGRAM ALLOW OPTMUM (OPTIMUM).                00533100
092122*                                            CHG0274717           00533200
092122******************************************************************00533300
092122* 02/14/2023 jean kurk                       chg0281369           00533400
092122*    -removed copybook for upc check digit routine                00533500
092122******************************************************************00533700
041923* 04/19/2023 DAN PAYNTER                     CHG0287388           00533801
041923*    -BLOCK ABILITY TO GENERATE NEW KCK GIFT CARDS                00533900
041923*    -PROVIDE GIFT CARDS IN CONTROL NUMBER ORDER                  00534000
041923******************************************************************00534100
112023* 11/10/2023 DAN PAYNTER                     CHG0297091           00534204
112023*    -CONVERT HARVARD CARDS TO PLI CARD PRINT VENDOR              00534304
112023******************************************************************00534504
003000 ENVIRONMENT DIVISION.                                            00534601
003100 CONFIGURATION SECTION.                                           00534701
003200 SOURCE-COMPUTER. IBM-3090.                                       00534801
003300 OBJECT-COMPUTER. IBM-3090.                                       00535000
003400                                                                  00536000
003500***************************************************************   00537000
003600 INPUT-OUTPUT SECTION.                                            00538000
003700***************************************************************   00539000
003800                                                                  00540000
003900 FILE-CONTROL.                                                    00550000
004000     SELECT CONTROL-NUM-OF-RECS-FILE                              00560000
004100         ASSIGN TO INP01.                                         00570000
004200                                                                  00580000
BJSFX3*  REQUEST FILE FOR GIFT AND KMRC                                 00590000
BJSFX3     SELECT REQUEST-CARDMAX-EXTRACT-FILE                          00600000
BJSFX3         ASSIGN TO OUT01.                                         00610000
BJSFX3                                                                  00620000
BJSFX3*  REQUEST FILE FOR VENDOR FILES                                  00630000
BJSFX3     SELECT REQUEST-VENDOR-EXTRACT-FILE                           00640000
BJSFX3         ASSIGN TO OUT02.                                         00650000
007800                                                                  00660000
BJSFX3*  TEMP REQUEST FILE FOR GIFT AND KMRC                            00670000
BJSFX3     SELECT BATCH-RENAME-COMMAND-FILE                             00680000
BJSFX3         ASSIGN TO OUT03.                                         00690000
BJSFX3                                                                  00700000
BJSFX3*  RPT REQUEST FILE FOR KMRC                                      00710000
BJSFX3     SELECT RP-REQUEST-KMRC-EXTRACT-FILE                          00720000
BJSFX3         ASSIGN TO OUT04.                                         00730000
BJSFX3                                                                  00731000
BJSFX3*  RPT REQUEST FILE FOR GIFT                                      00732000
BJSFX3     SELECT RP-REQUEST-GIFT-EXTRACT-FILE                          00733000
BJSFX3         ASSIGN TO OUT05.                                         00734000
007800                                                                  00735000
007900     SELECT EMBOSSING-REPORT-FILE                                 00736000
008000         ASSIGN TO RPT01.                                         00737000
008100                                                                  00738000
008200                                                                  00739000
008300***************************************************************   00740000
008400 DATA DIVISION.                                                   00750000
008500***************************************************************   00760000
008600                                                                  00770000
008700 FILE SECTION.                                                    00780000
008800                                                                  00790000
008900 FD  CONTROL-NUM-OF-RECS-FILE                                     00800000
009000     RECORDING MODE IS F                                          00810000
009100     LABEL RECORDS ARE STANDARD                                   00820000
009200     RECORD CONTAINS 80 CHARACTERS                                00830000
009300     DATA RECORD IS CONTROL-NUM-OF-RECORDS.                       00840000
009400                                                                  00850000
009500 01  CONTROL-NUM-OF-RECORDS      PIC X(80).                       00860000
009600                                                                  00870000
009700                                                                  00880000
BJSFX3 FD  REQUEST-CARDMAX-EXTRACT-FILE                                 00890000
BJSFX3     RECORDING MODE IS F                                          00900000
BJSFX3     LABEL RECORDS ARE STANDARD                                   00910000
BJSFX3     RECORD CONTAINS 182 CHARACTERS                               00920000
BJSFX3     DATA RECORD IS REQUEST-CARDMAX-EXTRACT-RECORD.               00930000
BJSFX3                                                                  00940000
BJSFX3 01  REQUEST-CARDMAX-EXTRACT-RECORD      PIC X(182).              00950000
BJSFX3                                                                  00960000
BJSFX3                                                                  00970000
BJSFX3 FD  REQUEST-VENDOR-EXTRACT-FILE                                  00980000
BJSFX3     RECORDING MODE IS F                                          00990000
BJSFX3     LABEL RECORDS ARE STANDARD                                   01000000
BJSFX3     RECORD CONTAINS 182 CHARACTERS                               01010000
BJSFX3     DATA RECORD IS REQUEST-VENDOR-EXTRACT-RECORD.                01020000
BJSFX3                                                                  01030000
BJSFX3 01  REQUEST-VENDOR-EXTRACT-RECORD      PIC X(182).               01040000
BJSFX3                                                                  01050000
BJSFX3                                                                  01060000
BJSFX3 FD  BATCH-RENAME-COMMAND-FILE                                    01070000
BJSFX3     RECORDING MODE IS F                                          01080000
BJSFX3     LABEL RECORDS ARE STANDARD                                   01090000
BJSFX3     RECORD CONTAINS  80 CHARACTERS                               01091000
BJSFX3     DATA RECORD IS BATCH-RENAME-COMMAND-RECORD.                  01092000
BJSFX3                                                                  01093000
BJSFX3 01  BATCH-RENAME-COMMAND-RECORD        PIC X(80).                01094000
BJSFX3                                                                  01095000
BJSFX3                                                                  01096000
BJSFX3 FD  RP-REQUEST-KMRC-EXTRACT-FILE                                 01097000
BJSFX3     RECORDING MODE IS F                                          01098000
BJSFX3     LABEL RECORDS ARE STANDARD                                   01099000
BJSFX3     RECORD CONTAINS 182 CHARACTERS                               01100000
BJSFX3     DATA RECORD IS RP-REQUEST-KMRC-EXTRACT-RECORD.               01100100
BJSFX3                                                                  01100200
BJSFX3 01  RP-REQUEST-KMRC-EXTRACT-RECORD         PIC X(182).           01100300
BJSFX3                                                                  01100400
BJSFX3                                                                  01100500
BJSFX3 FD  RP-REQUEST-GIFT-EXTRACT-FILE                                 01100600
BJSFX3     RECORDING MODE IS F                                          01100700
BJSFX3     LABEL RECORDS ARE STANDARD                                   01100800
BJSFX3     RECORD CONTAINS 182 CHARACTERS                               01100900
BJSFX3     DATA RECORD IS RP-REQUEST-GIFT-EXTRACT-RECORD.               01101000
BJSFX3                                                                  01101100
BJSFX3 01  RP-REQUEST-GIFT-EXTRACT-RECORD        PIC X(182).            01101200
BJSFX3                                                                  01101300
012400                                                                  01101400
012500 FD  EMBOSSING-REPORT-FILE                                        01101500
012600     RECORDING MODE IS F                                          01101600
012700     LABEL RECORDS ARE STANDARD                                   01101700
012800     RECORD CONTAINS 132 CHARACTERS                               01101800
012900     DATA RECORD IS EMBOSSING-REPORT-RECORD.                      01101900
013000                                                                  01102000
013100 01  EMBOSSING-REPORT-RECORD          PIC X(132).                 01103000
013200                                                                  01104000
013300                                                                  01105000
018200***************************************************************   01106000
018300 WORKING-STORAGE SECTION.                                         01107000
018400***************************************************************   01108000
018500 01  ABEND-CODE                        PIC S9(4)  VALUE ZERO      01109000
018600                                                  COMP.           01110000
018700     88  ABEND-4002                               VALUE +4002.    01120000
018800     88  ABEND-4008                               VALUE +4008.    01130000
018800     88  ABEND-4009                               VALUE +4009.    01140000
018900     88  ABEND-4013                               VALUE +4013.    01150000
019000     88  ABEND-4018                               VALUE +4018.    01160000
019100                                                                  01170000
019200 01  PV-PROGRAM-VARIABLES.                                        01180000
019300     05  PV-GIFTCARD                 PIC X(08)  VALUE 'GIFT    '. 01190000
019300     05  PV-KMRCCARD                 PIC X(08)  VALUE 'KMRC    '. 01200000
019300     05  PV-FETCH-COUNT                PIC S9(8)  VALUE ZERO      01211000
019400                                                  COMP-3.         01220000
019500     05  PV-WRITE-COUNT                PIC S9(8)  VALUE ZERO      01230000
019600                                                  COMP-3.         01240000
019700     05  PV-PARAGRAPH-NAME             PIC X(30)  VALUE SPACE.    01250000
019800     05  PV-DB2-OPER-ATTEMPTED         PIC X(30)  VALUE SPACE.    01260000
019900     05  PV-SQL-SUB                    PIC S9(4)  VALUE ZERO      01270000
020000                                                  COMP.           01280000
020100     05  PV-REQUEST-DATE.                                         01290000
020200         10  FILLER                    PIC  9(2)  VALUE ZEROS.    01300000
020300         10  PV-RD-YEAR                PIC  9(2)  VALUE ZEROS.    01310000
020400         10  FILLER                    PIC  X(1)  VALUE SPACES.   01320000
020500         10  PV-RD-MONTH               PIC  9(2)  VALUE ZEROS.    01330000
020600         10  FILLER                    PIC  X(1)  VALUE SPACES.   01340000
020700         10  PV-RD-DAY                 PIC  9(2)  VALUE ZEROS.    01350000
020800                                                                  01360000
020900     05  PV-RQST-NBR-CONVERT           PIC S9(4)   VALUE ZEROS.   01370000
021000     05  PV-RQST-NBR-DISPLAY           PIC 9999-  VALUE ZEROS.    01380000
021100     05  PV-RQST-QTY-DISPLAY           PIC 9999999-               01390000
021200                                                  VALUE ZEROS.    01400000
021100     05  PV-RQST-QTY                   PIC 9(7)   VALUE ZEROS.    01410000
021300                                                                  01420000
021400     05  PV-CONTROL-NUMBER             PIC S9(14)V                01430000
021500                                                  VALUE ZEROS.    01440000
021600     05  PV-CONTROL-NUMBER-BUILD                                  01450000
021700                           REDEFINES PV-CONTROL-NUMBER.           01460000
021800         10  PV-CN-YEAR                PIC  9(4).                 01470000
021900         10  PV-CN-RQST-NBR            PIC  9(4).                 01480000
022000         10  PV-CN-SEQ-NBR             PIC  9(6).                 01490000
022100                                                                  01500000
022200     05  PV-FILE-NAME-SUFFIX-COUNT     PIC  9(02) VALUE ZEROS.    01510000
022300                                                                  01520000
022900                                                                  01530000
023000     05  PV-DISPLAY-ERROR              PIC  X(45) VALUE SPACES.   01540000
022900                                                                  01550000
023100* THIS IS WHAT THE CONTROL CARD LOOKS LIKE                        01560000
022900*GIFT    100000 PKMT.SV.CARD.GIFTCC. PKMO.SV.CARD.GIFTCC. K       01570000
022900*KMRC    100000 PKMT.SV.CARD.KMRCCC. PKMO.SV.CARD.KMRCCC. K       01580000
092122*OPTMUM       0 PKMT.SV.CARD.OPTMUM. PKMO.SV.CARD.OPTMUM. O       01591100
WR7057*VALID        0 PKMT.SV.CARD.VALIDC. PKMO.SV.CARD.VALIDC. L       01592000
022900*INCOMM       0 PKMT.SV.CARD.INCOMM. PKMO.SV.CARD.INCOMM. I       01600000
022900*BLKHWK       0 PKMT.SV.CARD.BLKHWK. PKMO.SV.CARD.BLKHWK. B       01610000
022900*HARVRD       0 PKMT.SV.CARD.HARVRD. PKMO.SV.CARD.HARVRD. T       01620000
022900*HALMRK       0 PKMT.SV.CARD.HALMRK. PKMO.SV.CARD.HALMRK. G       01630000
022900*JETLTH       0 PKMT.SV.CARD.JETLTH. PKMO.SV.CARD.JETLTH. J       01640000
022900*MTL          0 PKMT.SV.CARD.MTLCCC. PKMO.SV.CARD.MTLCCC. M       01650000
022900                                                                  01660000
023200     05  PV-CONTROL-NUM-OF-RECS.                                  01670000
BJSFX3         10  PV-CARD-TY                PIC  X(08) VALUE ZEROS.    01671000
023300         10  PV-MAX-CONTROL-RECORDS    PIC  9(06) VALUE ZEROS.    01672000
BJSFx3         10  FILLER-1                  PIC  X(01) VALUE SPACES.   01673000
BJSFx3         10  PV-TEMP-HLQ               PIC  X(20).                01674000
BJSFx3         10  FILLER-2                  PIC  X(01) VALUE SPACES.   01675000
BJSFx3         10  PV-HLQ                    PIC  X(20).                01676000
BJSFx3         10  FILLER-3                  PIC  X(01) VALUE SPACES.   01677000
BJSFx3         10  PV-CARD-PROD              PIC  X(01) VALUE SPACES.   01678000
BJSFx3         10  FILLER-4                  PIC  X(22) VALUE SPACES.   01679000
BJSFX3     05  PV-HLQ-NAME.                                             01680000
BJSFX3         10  PV-HLQ-NAMES-TBL OCCURS 10 TIMES INDEXED BY PV-IND.  01690000
BJSFX3             15  PV-CARD                   PIC  X(08).            01700000
BJSFX3             15  PV-MAX-REC                PIC  9(06).            01710000
BJSFx3             15  FILLER1                   PIC  X(01).            01720000
BJSFx3             15  PV-TEMP-HLQ-NAMES         PIC  X(20).            01730000
BJSFx3             15  FILLER2                   PIC  X(01).            01740000
BJSFX3             15  PV-HLQ-NAMES              PIC  X(20).            01750000
BJSFx3             15  FILLER3                   PIC  X(01).            01760000
BJSFX3             15  PV-CARD-PRODUCER          PIC  X(01).            01770000
BJSFx3             15  FILLER4                   PIC  X(22).            01780000
BJSFX3     05  PV-BATCH-NUMBER.                                         01790000
BJSFX3         10  PV-CNTL-FILE-CRD-TYP    PIC  X(01) VALUE SPACES.     01800000
BJSFX3         10  PV-CNTL-FILE-SPECIAL-REQ PIC X(01) VALUE SPACES.     01810000
BJSFX3         10  PV-CNTL-FILE-RQST-NBR   PIC  X(04) VALUE SPACES.     01820000
BJSFX3         10  PV-CNTL-FILE-SEQ        PIC  X(02) VALUE SPACES.     01830000
BJSFX3     05  PV-DSNAME.                                               01840000
BJSFX3         10  PV-HIGH-LEVEL-QUAL        PIC  X(20)  VALUE SPACES.  01850000
BJSFX3         10  PV-BTCHNBR                PIC  X(08)  VALUE SPACES.  01860000
023900                                                                  01870000
029400     05  PV-NUMBER-REQUESTED-ACCUM     PIC  9(06) VALUE ZEROS.    01880000
029500     05  PV-PAGE-COUNTER               PIC S9(11) VALUE ZEROS.    01890000
029600                                                                  01900000
029700     05  PV-LINE-COUNTER               PIC S9(11) VALUE ZEROS.    01910000
029800                                                                  01920000
029900     05  PV-CURRENT-DATE.                                         01930000
030000         10  PV-CURRENT-YEAR           PIC  9(02) VALUE ZERO.     01940000
030100         10  PV-CURRENT-MONTH          PIC  9(02) VALUE ZERO.     01950000
030200         10  PV-CURRENT-DAY            PIC  9(02) VALUE ZERO.     01960000
030300     05  PV-CURRENT-TIME.                                         01970000
030400         10  PV-CURRENT-HOUR           PIC  9(02) VALUE ZERO.     01980000
030500         10  PV-CURRENT-MINUTE         PIC  9(02) VALUE ZERO.     01990000
030600         10  FILLER                    PIC  9(04) VALUE ZERO.     02000000
030700     05  PV-HOLD-KMRC-CONTROL-RECORD   PIC  X(182) VALUE SPACES.  02010000
030800     05  PV-HOLD-GIFT-CONTROL-RECORD   PIC  X(182) VALUE SPACES.  02020000
032600                                                                  02030000
032700     05  PV-DENOM-IFILE                   PIC  X(20).             02040000
032800     05  PV-SAFEWAY-UPC                   PIC  9(11).             02050000
032900     05  PV-PRE-DNNTD-CRD-AMT             PIC  9(7)V99.           02060000
033000     05  PV-PRE-DNNTD-CRD-AMT-BUILD                               02070000
033100                              REDEFINES PV-PRE-DNNTD-CRD-AMT.     02080000
033200         10  FILLER                        PIC  9(03).            02090000
033300         10  PV-PRE-DNNTD-DOLLARS          PIC  9(04).            02100000
033400         10  PV-PRE-DNNTD-CENTS            PIC  V99.              02110000
033500     05  PV-PRE-DNNTD-AMT-SAFEWAY-R                               02120000
033600                              REDEFINES PV-PRE-DNNTD-CRD-AMT.     02130000
033700         10  FILLER                        PIC  9(04).            02140000
033800         10  PV-PRE-DNNTD-AMT-SAFEWAY      PIC  9(05).            02150000
033900     05  PV-BIN-NBR.                                              02160000
034000         10  PV-BIN-1-4                    PIC  9(04).            02170000
034100         10  PV-BIN-5-6                    PIC  9(02).            02180000
034200     05  PV-CRD-STK-TYP                    PIC  9(01).            02190000
034300     05  PV-CARD-NBR-DECIMAL               PIC  X(13).            02200000
034400     05  PV-CARD-NBR REDEFINES PV-CARD-NBR-DECIMAL.               02210000
034500         10  PV-CARD-NBR-1-2               PIC  9(02).            02220000
034600         10  PV-CARD-NBR-3-7               PIC  9(05).            02230000
034700         10  PV-CARD-NBR-8-12              PIC  9(05).            02240000
034800         10  FILLER                        PIC  9(01).            02250000
034900     05  PV-CARD-NBR-VENDOR REDEFINES PV-CARD-NBR-DECIMAL.        02260000
035000         10  PV-CARD-NBR-VENDOR-1-12       PIC  9(12).            02270000
035100         10  FILLER                        PIC  9(01).            02280000
035200     05  PV-GIFT-CARD-NBR-SPACED.                                 02290000
035300         10  PV-GIFT-CARD-NBR-1-4          PIC  9(04).            02300000
035400         10  FILLER                        PIC  X(01) VALUE SPACE.02310000
035500         10  PV-GIFT-CARD-NBR-5-9.                                02320000
035600             15  PV-GIFT-CARD-NBR-5-6      PIC  9(02).            02330000
035700             15  PV-GIFT-CARD-NBR-7        PIC  9(01).            02340000
035800             15  PV-GIFT-CARD-NBR-8-9      PIC  9(02).            02350000
035900         10  FILLER                        PIC  X(01) VALUE SPACE.02360000
036000         10  PV-GIFT-CARD-NBR-10-14        PIC  9(05).            02370000
036100         10  FILLER                        PIC  X(01) VALUE SPACE.02380000
036200         10  PV-GIFT-CARD-NBR-15-19        PIC  9(05).            02390000
036300     05  PV-UPC-NBR-DECIMAL                PIC  X(16).            02400000
036400     05  PV-UPC-NBR REDEFINES PV-UPC-NBR-DECIMAL.                 02410000
036500         10  FILLER                        PIC  9(04).            02420000
036600         10  PV-UPC-NBR-11                 PIC  9(11).            02430000
036700         10  FILLER                        PIC  9(01).            02440000
036800     05  PV-KMRC-CARD-NBR-SPACED.                                 02450000
036900         10  PV-KMRC-CARD-NBR-1-4          PIC  9(04).            02460000
037000         10  FILLER                        PIC  X(01) VALUE SPACE.02470000
037100         10  PV-KMRC-CARD-NBR-5-6          PIC  9(02).            02480000
037200         10  PV-KMRC-CARD-NBR-7            PIC  9(01).            02490000
037300         10  PV-KMRC-CARD-NBR-8-9          PIC  9(02).            02500000
037400         10  FILLER                        PIC  X(01) VALUE SPACE.02510000
037500         10  PV-KMRC-CARD-NBR-10-14        PIC  9(05).            02520000
037600         10  FILLER                        PIC  X(01) VALUE SPACE.02530000
037700         10  PV-KMRC-CARD-NBR-15-19.                              02540000
037800             15  PV-KMRC-CARD-NBR-15-18    PIC  9(04).            02550000
037900             15  PV-KMRC-CARD-NBR-19       PIC  9(01).            02560000
038000     05  PV-CARD-TYPE                      PIC  X(04).            02570000
038100     05  PV-CARD-TYPE-CDE REDEFINES PV-CARD-TYPE.                 02580000
038200         10  PV-CRD-TYP-CDE                PIC  9(01).            02590000
038300         10  FILLER                        PIC  9(03).            02600000
038400                                                                  02610000
038410     05  PV-CRD-STK-TYP-ID                 PIC  X(08).            02620000
038420     05  PV-CRD-STK-TYP-SPLIT REDEFINES PV-CRD-STK-TYP-ID.        02630000
038430         10  PV-CRD-STK-ID-3CHAR           PIC  X(03).            02640000
038431             88 PV-CARD-STOCK-SAFEWAY      VALUE 'SAF', 'SWH'.    02650000
038440         10  FILLER                        PIC  X(05).            02660000
BJSFX3     05  PV-VENDOR                 PIC X(08) VALUE SPACES.        02670000
                                                                        02680000
038500 01  PROGRAM-CONSTANTS-AREA.                                      02690000
038600     05  PC-PROGRAM-NAME           PIC X(08) VALUE 'SVKUP005'.    02700000
BJSFX3     05  PC-CARDMAX-DDNAME         PIC X(08) VALUE 'OUT01'.       02710000
BJSFX3     05  PC-VENDOR-DDNAME          PIC X(08) VALUE 'OUT02'.       02720000
040800     05  PC-NINES                  PIC  9(6)  VALUE 999999.       02730000
040900     05  PC-MAX-RETRIES            PIC S9     VALUE +3            02740000
041000                                              COMP-3.             02750000
041100     05  PC-ONE                    PIC  9(01) VALUE 1.            02760000
151200     05  PC-QUOTE                  PIC X(01)  VALUE QUOTE.        02770000
041200     05  PC-THREE                  PIC  9(01) VALUE 3.            02780000
041300     05  PC-HEADER-LINE-COUNT      PIC S9(03) VALUE +5            02790000
041400                                              COMP.               02800000
041500     05  PC-MAX-LINES-PER-PAGE     PIC S9(03) VALUE +60           02810000
041600                                              COMP.               02820000
092122     05  PC-OPTMUM                 PIC X(08)  VALUE 'OPTMUM  '.   02830000
WR7057     05  PC-VALID                  PIC X(08)  VALUE 'VALID   '.   02832000
BJSFX3     05  PC-INCOMM                 PIC X(08)  VALUE 'INCOMM  '.   02840000
BJSFX3     05  PC-BLKHWK                 PIC X(08)  VALUE 'BLKHWK  '.   02841000
112023     05  PC-PLICRD                 PIC X(08)  VALUE 'PLICRD  '.   02842104
BJSFX3     05  PC-HALMRK                 PIC X(08)  VALUE 'HALMRK  '.   02843000
BJSFX3     05  PC-JETLTH                 PIC X(08)  VALUE 'JETLTH  '.   02844000
BJSFX3     05  PC-MTL                    PIC X(08)  VALUE 'MTL     '.   02845000
092122     05  PC-OPTMUM-CRD-DESC        PIC X(09)  VALUE 'OPTMUM   '.  02846000
WR7057     05  PC-VALID-CRD-DESC         PIC X(09)  VALUE 'VALID    '.  02846200
BJSFX3     05  PC-INCOMM-CRD-DESC        PIC X(09)  VALUE 'INCOMM   '.  02847000
BJSFX3     05  PC-BLKHWK-CRD-DESC        PIC X(09)  VALUE 'BLACKHAWK'.  02848000
112023     05  PC-PLICRD-CRD-DESC        PIC X(09)  VALUE 'PLI      '.  02849104
BJSFX3     05  PC-HALMRK-CRD-DESC        PIC X(09)  VALUE 'HALLMARK '.  02849201
BJSFX3     05  PC-JETLTH-CRD-DESC        PIC X(09)  VALUE 'JET LITHO'.  02849301
BJSFX3     05  PC-MTL-CRD-DESC           PIC X(09)  VALUE 'MTL      '.  02849401
041700                                                                  02849501
041800 01  PROGRAM-SWITCHES.                                            02849601
041900     05  PS-REQUESTS-SW            PIC X      VALUE 'Y'.          02849701
042000         88  PS-MORE-REQUESTS                 VALUE 'Y'.          02849801
042100         88  PS-NO-MORE-REQUESTS              VALUE 'N'.          02849901
042300     05  PS-CONTROL-SW             PIC X      VALUE ' '.          02850001
042400         88  PS-MORE-CONTROL-ROWS             VALUE 'Y'.          02851001
042500         88  PS-NO-MORE-CONTROL-ROWS          VALUE 'N'.          02860000
042600                                                                  02870000
042700     05  PS-FIRST-TIME-THRU-SW     PIC X      VALUE 'Y'.          02880000
042800         88  PS-FIRST-TIME-THRU               VALUE 'Y'.          02890000
042900         88  PS-NOT-FIRST-TIME-THRU           VALUE 'N'.          02900000
044200     05  PS-END-OF-FILE-SW         PIC X(01)  VALUE 'N'.          02910000
044300         88  PS-END-OF-FILE                   VALUE 'Y'.          02920000
               88  PS-NOT-END-OF-FILE               VALUE 'N'.          02930000
                                                                        02940000
       01  PS-CONTROL-MFT-HOLD               PIC X(80).                 02950000
044400*  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              02960000
044500*                                                                 02970000
044600     COPY DPWS023.                                                02980000
044700                                                                  02990000
044800*-----------------------------------------------------------------03000000
044900*  THE FOLLOWING HEADER, DETAIL AND STOP RECORDS CONTAIN EMBOSSING03010000
045000*  CODES THAT MUST BE PRESENT IN THE KMRC EXTRACT FILE.           03020000
045100*  THIS FORMAT MUST BE CONSISTANT WITH SVRD006.                   03030000
045200*                                   -- RECORD LENGTH IS 100 BYTES.03040000
045300*-----------------------------------------------------------------03050000
045400 01  EXTRACT-FILE-HR-KMRC.                                        03060000
045500     05  FILLER               PIC  X(08)  VALUE 'FIRFIL\\'.       03070000
045600     05  FILLER               PIC  X(08)  VALUE SPACES.           03080000
045700     05  FILLER               PIC  X(03)  VALUE ' - '.            03090000
045800     05  FILLER               PIC  X(08)  VALUE SPACES.           03100000
045900     05  FILLER               PIC  X(03)  VALUE ' - '.            03110000
046000     05  FILLER               PIC  X(15)  VALUE 'NON-DENOMINATED'.03120000
046100     05  FILLER               PIC  X(02)  VALUE '\\'.             03130000
046200     05  FILLER               PIC  X(73)  VALUE SPACES.           03140000
046300 01  EXTRACT-FILE-DR-KMRC.                                        03150000
046400     05  FILLER               PIC  X(06)  VALUE SPACES.           03160000
046500     05  FILLER               PIC  X(01)  VALUE '@'.              03170000
046600     05  FILLER               PIC  X(14)  VALUE SPACES.           03180000
046700     05  FILLER               PIC  X(08)  VALUE '(G\\D01='.       03190000
046800     05  FILLER               PIC  X(14)  VALUE SPACES.           03200000
046900     05  FILLER               PIC  X(06)  VALUE '~\D02='.         03210000
047000     05  FILLER               PIC  X(22)  VALUE SPACES.           03220000
047100     05  FILLER               PIC  X(06)  VALUE '~\BD1='.         03230000
047200     05  FILLER               PIC  X(30)  VALUE SPACES.           03240000
047300     05  FILLER               PIC  X(06)  VALUE '~\D04='.         03250000
047400     05  FILLER               PIC  X(04)  VALUE SPACES.           03260000
047500     05  FILLER               PIC  X(09)  VALUE '~\D05=PIN'.      03270000
047600     05  FILLER               PIC  X(06)  VALUE '~\D06='.         03280000
047700     05  FILLER               PIC  X(11)  VALUE SPACES.           03290000
047800     05  FILLER               PIC  X(06)  VALUE '~\LN1='.         03300000
047900     05  FILLER               PIC  X(20)  VALUE SPACES.           03310000
048000     05  FILLER               PIC  X(03)  VALUE '\\'.             03320000
048100     05  FILLER               PIC  X(10)  VALUE SPACES.           03330000
048200 01  EXTRACT-FILE-SR-KMRC.                                        03340000
048300     05  FILLER               PIC  X(14)  VALUE 'FIRFIL\\STOP\\'. 03350000
048400     05  FILLER               PIC  X(106) VALUE SPACES.           03360000
048500                                                                  03370000
048600*-----------------------------------------------------------------03380000
048700*  THE FOLLOWING HEADER, DETAIL AND STOP RECORDS CONTAIN EMBOSSING03390000
048800*  CODES THAT MUST BE PRESENT IN THE GIFT CARD EXTRACT FILE.      03400000
048900*  THIS FORMAT MUST BE CONSISTANT WITH SVRD008.                   03410000
049000*                                   -- RECORD LENGTH IS 100 BYTES.03420000
049100*-----------------------------------------------------------------03430000
049200 01  EXTRACT-FILE-HR-GIFT-PRE-DENOM.                              03440000
049300     05  FILLER               PIC  X(08)  VALUE 'FIRFIL\\'.       03450000
049400     05  FILLER               PIC  X(08)  VALUE SPACES.           03460000
049500     05  FILLER               PIC  X(03)  VALUE ' - '.            03470000
049600     05  FILLER               PIC  X(08)  VALUE SPACES.           03480000
049700     05  FILLER               PIC  X(03)  VALUE ' - '.            03490000
049800     05  FILLER               PIC  X(11)  VALUE 'DENOMINATED'.    03500000
049900     05  FILLER               PIC  X(03)  VALUE ' - '.            03510000
050000     05  FILLER               PIC  X(05)  VALUE SPACES.           03520000
050100     05  FILLER               PIC  X(02)  VALUE '\\'.             03530000
050200     05  FILLER               PIC  X(69)  VALUE SPACES.           03540000
050300 01  EXTRACT-FILE-HR-GIFT-NON-DENOM.                              03550000
050400     05  FILLER               PIC  X(08)  VALUE 'FIRFIL\\'.       03560000
050500     05  FILLER               PIC  X(08)  VALUE SPACES.           03570000
050600     05  FILLER               PIC  X(03)  VALUE ' - '.            03580000
050700     05  FILLER               PIC  X(08)  VALUE SPACES.           03590000
050800     05  FILLER               PIC  X(03)  VALUE ' - '.            03600000
050900     05  FILLER               PIC  X(15)  VALUE 'NON-DENOMINATED'.03610000
051000     05  FILLER               PIC  X(02)  VALUE '\\'.             03620000
051100     05  FILLER               PIC  X(73)  VALUE SPACES.           03630000
051200 01  EXTRACT-FILE-DR-GIFT.                                        03640000
051300     05  FILLER               PIC  X(06)  VALUE SPACES.           03650000
051400     05  FILLER               PIC  X(01)  VALUE '@'.              03660000
051500     05  FILLER               PIC  X(14)  VALUE SPACES.           03670000
051600     05  FILLER               PIC  X(08)  VALUE '(G\\D01='.       03680000
051700     05  FILLER               PIC  X(14)  VALUE SPACES.           03690000
051800     05  FILLER               PIC  X(06)  VALUE '~\D02='.         03700000
051900     05  FILLER               PIC  X(22)  VALUE SPACES.           03710000
052000     05  FILLER               PIC  X(06)  VALUE '~\D03='.         03720000
052100     05  FILLER               PIC  X(04)  VALUE SPACES.           03730000
052200     05  FILLER               PIC  X(06)  VALUE '~\BD1='.         03740000
052300     05  FILLER               PIC  X(30)  VALUE SPACES.           03750000
052400     05  FILLER               PIC  X(06)  VALUE '~\D04='.         03760000
052500     05  FILLER               PIC  X(04)  VALUE SPACES.           03770000
052600     05  FILLER               PIC  X(09)  VALUE '~\D05=PIN'.      03780000
052700     05  FILLER               PIC  X(06)  VALUE '~\D06='.         03790000
052800     05  FILLER               PIC  X(11)  VALUE SPACES.           03800000
052900     05  FILLER               PIC  X(06)  VALUE '~\LN1='.         03810000
053000     05  FILLER               PIC  X(20)  VALUE SPACES.           03820000
053100     05  FILLER               PIC  X(03)  VALUE '\\'.             03830000
053200 01  EXTRACT-FILE-SR-GIFT.                                        03840000
053300     05  FILLER               PIC  X(14)  VALUE 'FIRFIL\\STOP\\'. 03850000
053400     05  FILLER               PIC  X(106) VALUE SPACES.           03860000
053500                                                                  03870000
053600*-----------------------------------------------------------      03880000
053700*   STORED VALUE WORKING STORAGE CONSTANTS.                       03890000
053800*-----------------------------------------------------------      03900000
053900     COPY SVWS004.                                                03910000
054000                                                                  03920000
054100*-----------------------------------------------------------      03930000
054200*   KMRC CONTROL NUMBER EXTRACT RECORD LAYOUT                     03940000
054300*-----------------------------------------------------------      03950000
054400     COPY SVRD006.                                                03960000
054500                                                                  03970000
054600*-----------------------------------------------------------      03980000
054700*   GIFT CARD CONTROL NUMBER EXTRACT RECORD LAYOUT                03990000
054800*-----------------------------------------------------------      04000000
054900     COPY SVRD008.                                                04010000
055000                                                                  04020000
055100*-----------------------------------------------------------      04030000
055200*   GIFT CARD EXTRACT RECORD LAYOUT FOR VENDORS                   04040000
055300*-----------------------------------------------------------      04050000
055400     COPY SVRD050.                                                04060000
055500                                                                  04070000
056100*-----------------------------------------------------------      04130000
056200*   STANDARD-HEADER FOR 132 COLUMN REPORT                         04140000
056300*-----------------------------------------------------------      04150000
056400     COPY DPWS132O.                                               04160000
056500                                                                  04170000
056600 01  REPORT-EMBOSSING-TITLE-LINE.                                 04180000
056700     05  FILLER                      PIC  X(50)   VALUE SPACES.   04190000
056800     05  TL-HEADING                  PIC  X(24)   VALUE           04200000
056900         'EMBOSSING REQUESTS FROM '.                              04210000
057000     05  TL-MM                       PIC  X(02)   VALUE SPACES.   04220000
057100     05  TL-DASH                     PIC  X(01)   VALUE '/'.      04230000
057200     05  TL-DD                       PIC  X(02)   VALUE SPACES.   04240000
057300     05  TL-DASH                     PIC  X(01)   VALUE '/'.      04250000
057400     05  TL-YY                       PIC  X(02)   VALUE SPACES.   04260000
057500     05  FILLER                      PIC  X(50)   VALUE SPACES.   04270000
057600 01  REPORT-EMBOSSING-HEADING-1.                                  04280000
057700     05  FILLER                      PIC  X(06)   VALUE SPACES.   04290000
057800     05  FILLER                      PIC  X(06)   VALUE 'BATCH '. 04300000
057900     05  FILLER                      PIC  X(08)   VALUE SPACES.   04310000
058000     05  FILLER                      PIC  X(04)   VALUE 'CARD'.   04320000
058100     05  FILLER                      PIC  X(15)   VALUE SPACES.   04330000
058200     05  FILLER                      PIC  X(15)   VALUE           04340000
058300                                     'CONTROL NUMBERS'.           04350000
058400     05  FILLER                      PIC  X(12)   VALUE SPACES.   04360000
058500     05  FILLER                      PIC  X(06)   VALUE 'NUMBER'. 04370000
058600     05  FILLER                      PIC  X(20)   VALUE SPACES.   04380000
058700     05  FILLER                      PIC  X(40)   VALUE SPACES.   04390000
058800 01  REPORT-EMBOSSING-HEADING-2.                                  04400000
058900     05  FILLER                      PIC  X(07)   VALUE SPACES.   04410000
059000     05  FILLER                      PIC  X(04)   VALUE 'NAME'.   04420000
059100     05  FILLER                      PIC  X(09)   VALUE SPACES.   04430000
059200     05  FILLER                      PIC  X(04)   VALUE 'TYPE'.   04440000
059300     05  FILLER                      PIC  X(10)   VALUE SPACES.   04450000
059400     05  FILLER                      PIC  X(08)   VALUE           04460000
059500                                     'STARTING'.                  04470000
059600     05  FILLER                      PIC  X(11)   VALUE SPACES.   04480000
059700     05  FILLER                      PIC  X(06)   VALUE 'ENDING'. 04490000
059800     05  FILLER                      PIC  X(06)   VALUE SPACES.   04500000
059900     05  FILLER                      PIC  X(09)   VALUE           04510000
060000                                                  'REQUESTED'.    04520000
060100     05  FILLER                      PIC  X(01)   VALUE SPACES.   04530000
060200     05  FILLER                      PIC  X(12)   VALUE           04540000
060300                                                  'DENOMINATION'. 04550000
060400     05  FILLER                      PIC  X(02)   VALUE SPACES.   04560000
060500     05  FILLER                      PIC  X(15)   VALUE           04570000
060600                                     'CARD STOCK TYPE'.           04580000
060700     05  FILLER                      PIC  X(17)   VALUE SPACES.   04590000
060800     05  FILLER                      PIC  X(08)   VALUE           04600000
060900                                                  'PRODUCER'.     04610000
061000 01  REPORT-EMBOSSING-DETAIL-LINE.                                04620000
061100     05  FILLER                      PIC  X(03)   VALUE SPACES.   04630000
061200     05  DL-BATCH-NUMBER             PIC  X(08)   VALUE SPACES.   04640000
061300     05  FILLER                      PIC  X(04)   VALUE '.TXT'.   04650000
061400     05  FILLER                      PIC  X(03)   VALUE SPACES.   04660000
061500     05  DL-CARD-TYPE                PIC  X(09)   VALUE SPACES.   04670000
061600     05  FILLER                      PIC  X(03)   VALUE SPACES.   04680000
061700     05  DL-STARTING-CONTROL-NBR     PIC  X(14)   VALUE SPACES.   04690000
061800     05  FILLER                      PIC  X(06)   VALUE ' THRU '. 04700000
061900     05  DL-ENDING-CONTROL-NBR       PIC  X(14)   VALUE SPACES.   04710000
062000     05  FILLER                      PIC  X(02)   VALUE SPACES.   04720000
062100     05  DL-NUMBER-REQUESTED         PIC  ZZZ,ZZZ VALUE ZEROS.    04730000
062200     05  FILLER                      PIC  X(04)   VALUE SPACES.   04740000
062300     05  DL-DENOMINATION             PIC  Z,ZZZ.99                04750000
062400                                                  VALUE ZEROS.    04760000
062500     05  FILLER                      PIC  X(02)   VALUE SPACES.   04770000
062600     05  DL-CARD-STOCK-TYPE          PIC  X(08)   VALUE SPACES.   04780000
062700     05  FILLER                      PIC  X(02)   VALUE SPACES.   04790000
062800     05  DL-CARD-STOCK-TYPE-DESC     PIC  X(25)   VALUE SPACES.   04800000
062900     05  FILLER                      PIC  X(02)   VALUE SPACES.   04810000
063000     05  DL-PRODUCER                 PIC  X(06)   VALUE SPACES.   04820000
063100     05  FILLER                      PIC  X(01)   VALUE SPACES.   04830000
063200 01  REPORT-EMBOSSING-SUBTOTAL-LINE.                              04840000
063300     05  FILLER                      PIC  X(66)   VALUE SPACES.   04850000
063400     05  FILLER                      PIC  X(7)    VALUE '-------'.04860000
063500     05  FILLER                      PIC  X(59)   VALUE SPACES.   04870000
063600 01  REPORT-EMBOSSING-TOTAL-LINE.                                 04880000
063700     05  FILLER                      PIC  X(66)   VALUE SPACES.   04890000
063800     05  TL-TOTAL-REQUESTED          PIC  ZZZ,ZZZ VALUE ZEROS.    04900000
063900     05  FILLER                      PIC  X(59)   VALUE SPACES.   04910000
064000 01  REPORT-EMBOSSING-EMPTY-LINE     PIC  X(132)  VALUE SPACES.   04920000
064100                                                                  04930000
064200*-----------------------------------------------------------      04940000
064300*    STORED VALUE CARD TABLE                                      04950000
064400*-----------------------------------------------------------      04960000
064500     EXEC SQL                                                     04970000
064600         INCLUDE SVT00001                                         04980000
064700     END-EXEC.                                                    04990000
064800*-----------------------------------------------------------      05000000
064900*    STORED VALUE CONTROL TABLE                                   05010000
065000*-----------------------------------------------------------      05020000
065100     EXEC SQL                                                     05030000
065200         INCLUDE SVT00000                                         05040000
065300     END-EXEC.                                                    05050000
065400*-----------------------------------------------------------      05060000
065500*    STORED VALUE DENOMINATED TABLE                               05070000
065600*-----------------------------------------------------------      05080000
065700     EXEC SQL                                                     05090000
065800         INCLUDE SVT00008                                         05100000
065900     END-EXEC.                                                    05110000
066000*-----------------------------------------------------------      05120000
066100*    SQL COMMUNICATIONS AREA DCLGEN                               05130000
066200*-----------------------------------------------------------      05140000
066300     EXEC SQL                                                     05150000
066400         INCLUDE SQLCA                                            05160000
066500     END-EXEC.                                                    05170000
066600*-----------------------------------------------------------      05180000
066700*    ERROR MESSAGE AREA FOR DB2                                   05190000
066800*-----------------------------------------------------------      05200000
066900     COPY DPWS004.                                                05210000
067000*-----------------------------------------------------------      05220000
067100*    CURSOR DECLARATION FOR STORED VALUE CONTROL TABLE.           05230000
067200*-----------------------------------------------------------      05240000
067300     EXEC SQL                                                     05250000
067400         DECLARE KMC-CONTROL CURSOR                               05260000
067500             FOR SELECT                                           05270000
067600                       CRD_PROD_YR                                05280000
067700                      ,SHIPT_REQ_NBR                              05290000
067800                      ,CNTL_NBR                                   05300000
067900                      ,CRD_NBR                                    05310000
068000                      ,CRD_PIN_NBR                                05320000
068100                      ,CRD_SPCTY_TYP_CDE                          05330000
068200         FROM SVT_KOHLS_CRD_ACCT                                  05340000
068300         WHERE   CRD_PROD_YR = :SVT00000-CRD-PROD-YR              05350000
068400           AND   SHIPT_REQ_NBR = :SVT00000-SHIPT-REQ-NBR          05360000
041923         ORDER BY                                                 05361000
041923            CRD_PROD_YR                                           05362000
041923           ,SHIPT_REQ_NBR                                         05363000
041923           ,CNTL_NBR                                              05364000
068500          WITH UR                                                 05370000
068600     END-EXEC.                                                    05380000
068700*-----------------------------------------------------------      05390000
068800*    CURSOR DECLARATION FOR STORED VALUE CONTROL TABLE            05400000
068900*-----------------------------------------------------------      05410000
069000     EXEC SQL                                                     05420000
069100         DECLARE KMC-REQUEST CURSOR                               05430000
069200             FOR SELECT                                           05440000
069300                       CRD_PROD_YR                                05450000
069400                     , SHIPT_REQ_NBR                              05460000
069500                     , CRD_REQ_QTY                                05470000
069600                     , CRD_REQD_DTE                               05480000
069700                     , A.CRD_TYP_CDE                              05490000
069800                     , A.PRE_DNNTD_CRD_AMT                        05500000
069900                     , A.CRD_STK_TYP_ID                           05510000
070000                     , CRD_STK_TYP_DESC                           05520000
070100                     , CRD_PRDR_CDE                               05530000
070200                     , B.UPC_NBR                                  05540000
070300         FROM SVT_CRD_PROD      A                                 05550000
070400            , SVT_CRD_STK_DNMNTN B                                05560000
070500         WHERE A.CRD_TYP_CDE = B.CRD_TYP_CDE                      05570000
070600           AND A.CRD_STK_TYP_ID = B.CRD_STK_TYP_ID                05580000
070700           AND A.PRE_DNNTD_CRD_AMT = B.PRE_DNNTD_CRD_AMT          05590000
070800           AND CRD_PROD_STAT_CDE = 'PN'                           05600000
070900           AND A.CRD_STK_TYP_ID <> 'VIRTUAL '                     05610000
041923           AND A.CRD_STK_TYP_ID <> 'KCK     '                     05611000
041923           AND A.CRD_STK_TYP_ID <> 'VGCKCK  '                     05612000
P5211            AND A.CRD_PRDR_CDE <> 'V'                              05620000
071000         ORDER BY CRD_PROD_YR                                     05630000
071100                 ,SHIPT_REQ_NBR                                   05640000
P5211          WITH UR                                                  05650000
071200     END-EXEC.                                                    05660000
071300 EJECT                                                            05670000
071400***************************************************************   05680000
071500 PROCEDURE DIVISION.                                              05690000
071600***************************************************************   05700000
071700 0000-MAINLINE.                                                   05710000
071800                                                                  05720000
071900     PERFORM 1000-INITIALIZE.                                     05730000
072000                                                                  05740000
072100     PERFORM 2000-FETCH-AND-WRITE                                 05750000
072200         UNTIL PS-NO-MORE-REQUESTS.                               05760000
072300                                                                  05770000
072400     PERFORM 9000-CLOSE-FILE-AND-CURSOR.                          05780000
072500                                                                  05790000
072600     STOP RUN.                                                    05800000
072700                                                                  05810000
072800****************************************************************  05820000
072900*                                                              *  05830000
073000*  OPEN FILE FOR OUTPUT PROCESSING.                            *  05840000
073100*  OPEN REQUEST CURSOR AND READ THE FIRST REQUEST ROW.         *  05850000
073100*  OPEN REPORT FILES.                                          *  05851000
073200*                                                              *  05860000
073300****************************************************************  05870000
073400 1000-INITIALIZE.                                                 05880000
073500                                                                  05890000
073600     OPEN INPUT  CONTROL-NUM-OF-RECS-FILE                         05900000
073800          OUTPUT EMBOSSING-REPORT-FILE                            05910000
074500                 BATCH-RENAME-COMMAND-FILE                        05920000
BJSFX3                 RP-REQUEST-KMRC-EXTRACT-FILE                     05921000
BJSFX3                 RP-REQUEST-GIFT-EXTRACT-FILE.                    05922000
BJSFX3     INITIALIZE PV-HLQ-NAME.                                      05930000
BJSFX3     SET PV-IND TO 1.                                             05940000
074600     PERFORM 1100-READ-CONTROL-REC-FILE                           05950000
BJSFX3             UNTIL PS-NO-MORE-CONTROL-ROWS.                       05960000
074700     CLOSE  CONTROL-NUM-OF-RECS-FILE.                             05970000
                                                                        05980000
074900****************************************************************  05990000
075000*             INITIALIZE REQUEST FILE NAME SUFFIX COUNT           06000000
075100****************************************************************  06010000
075200     MOVE ZERO             TO  PV-FILE-NAME-SUFFIX-COUNT.         06020000
075300     MOVE ZERO             TO  PV-WRITE-COUNT.                    06030000
075400                                                                  06040000
075500     PERFORM                                                      06050000
075600         WITH TEST AFTER                                          06060000
075700         VARYING PV-SQL-SUB                                       06070000
075800         FROM 1 BY 1                                              06080000
075900         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       06090000
076000                   OR SQLCODE = 0                                 06100000
076100                   OR SQLCODE = +100)                             06110000
076200         EXEC SQL                                                 06120000
076300             OPEN KMC-REQUEST                                     06130000
076400         END-EXEC                                                 06140000
076500         EVALUATE TRUE                                            06150000
076600             WHEN SQLCODE = -904                                  06160000
076700             WHEN SQLCODE = -911                                  06170000
076800             WHEN SQLCODE = +100                                  06180000
076900             WHEN SQLCODE = 0                                     06190000
077000                 CONTINUE                                         06200000
077100             WHEN SQLWARN NOT = SPACES                            06210000
077200             WHEN SQLCODE NOT = ZERO                              06220000
077300                 MOVE '1000-INITIALIZE'                           06230000
077400                               TO  PV-PARAGRAPH-NAME              06240000
077500                 MOVE 'OPEN THE KMC REQUEST CURSOR'               06250000
077600                               TO  PV-DB2-OPER-ATTEMPTED          06260000
077700                 PERFORM 9900-SQL-ABEND                           06270000
077800         END-EVALUATE                                             06280000
077900     END-PERFORM.                                                 06290000
078000                                                                  06300000
078100     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        06310000
078200         MOVE '1000-INITIALIZE'                                   06320000
078300                               TO  PV-PARAGRAPH-NAME              06330000
078400         MOVE 'OPEN RETRIES EXCEEDED'                             06340000
078500                               TO  PV-DB2-OPER-ATTEMPTED          06350000
078600         PERFORM 9900-SQL-ABEND                                   06360000
078700     END-IF.                                                      06370000
078900     PERFORM 2100-FETCH-REQUEST-ROW.                              06380000
079000                                                                  06390000
079100     IF PS-NO-MORE-REQUESTS                                       06400000
079200        CONTINUE                                                  06410000
079300     ELSE                                                         06420000
079400        MOVE SVT00000-CRD-REQD-DTE TO PV-REQUEST-DATE             06430000
079500        MOVE SVT00000-SHIPT-REQ-NBR TO PV-RQST-NBR-CONVERT        06440000
079600                                                                  06450000
079700        MOVE PV-RD-MONTH          TO  TL-MM                       06460000
079800        MOVE PV-RD-DAY            TO  TL-DD                       06470000
079900        MOVE PV-RD-YEAR           TO  TL-YY                       06480000
080000        ACCEPT PV-CURRENT-DATE   FROM DATE                        06490000
080100        MOVE PV-CURRENT-YEAR      TO DP132O-RUN-YEAR              06500000
080200        MOVE PV-CURRENT-MONTH     TO DP132O-RUN-MONTH             06510000
080300        MOVE PV-CURRENT-DAY       TO DP132O-RUN-DAY               06520000
080400        ACCEPT PV-CURRENT-TIME   FROM TIME                        06530000
080500        MOVE PV-CURRENT-HOUR      TO DP132O-RUN-HOUR              06540000
080600        MOVE PV-CURRENT-MINUTE    TO DP132O-RUN-MINUTE            06550000
080700        MOVE PC-PROGRAM-NAME      TO DP132O-PROGRAM-NAME          06560000
080800        MOVE PC-ONE               TO DP132O-REPORT-NUMBER         06570000
080900                                                                  06580000
081000        PERFORM 5200-PROCESS-PAGE-BREAK                           06590000
                                                                        06594000
081200        PERFORM 3000-ALLOCATE-AND-OPEN-RQST                       06600000
081300     END-IF.                                                      06610000
081400******************************************************************06620000
081500*                                                                *06630000
081600*    THIS CONTROL CARD FILE CONTAINS THE MAXIMUM NUMBER OF       *06640000
081700*    RECORDS THAT ARE TO BE WRITTEN TO EACH REQUEST              *06650000
081900*                                                                *06660000
082000******************************************************************06670000
082100 1100-READ-CONTROL-REC-FILE.                                      06680000
082200     READ CONTROL-NUM-OF-RECS-FILE                                06690000
082300             INTO PV-CONTROL-NUM-OF-RECS                          06700000
BJSFX3         AT END                                                   06710000
BJSFX3             SET PS-NO-MORE-CONTROL-ROWS TO TRUE                  06720000
           END-READ.                                                    06730000
BJSFX3     IF NOT PS-NO-MORE-CONTROL-ROWS                               06740000
BJSFX3        MOVE PV-CARD-TY             TO PV-CARD(PV-IND)            06750000
BJSFX3        MOVE PV-MAX-CONTROL-RECORDS TO PV-MAX-REC(PV-IND)         06760000
BJSFx3        MOVE PV-TEMP-HLQ            TO PV-TEMP-HLQ-NAMES(PV-IND)  06770000
BJSFX3        MOVE PV-HLQ                 TO PV-HLQ-NAMES(PV-IND)       06780000
BJSFX3        MOVE PV-CARD-PROD           TO PV-CARD-PRODUCER(PV-IND)   06790000
BJSFX3        SET  PV-IND UP BY 1                                       06800000
BJSFX3     END-IF.                                                      06810000
                                                                        06820000
82600****************************************************************   06830000
082700*                                                              *  06840000
082800*    THIS PARAGRAPH TAKES THE REQUEST NUMBER, DATE, AND        *  06850000
082900*    QUANTITY FROM THE REQUEST FETCH AND USES THAT INFORMATION *  06860000
083000*    AS SELECTION CRITERIA WHEN OPENING THE CONTROL CURSOR.    *  06870000
083100*    IF THE CONTROL CURSOR IS SUCCESSFULLY OPENED, EACH ROW    *  06880000
083200*    IS READ AND THE CONTROL AND CARD NUMBERS ARE WRITTEN TO   *  06890000
083300*    A FILE.  THE MAXIMUM RECORD COUNT READ FROM THE           *  06900000
083400*    CONTROL-NUM-OF-RECS-FILE SETS HOW MANY CARD RECORDS ARE   *  06910000
083500*    WRITTEN TO EACH FILE. WHEN THE MAXIMUM IS REACHED THEN    *  06920000
083600*    THAT FILE IS CLOSED, AND A NEW FILE IS ALLOCATED          *  06930000
083700*    AND OPENED.                                               *  06940000
083800*                                                              *  06950000
083900****************************************************************  06960000
084000 2000-FETCH-AND-WRITE.                                            06970000
084100                                                                  06980000
084500     PERFORM 2200-OPEN-CONTROL-CURSOR.                            07020000
084600     SET PS-FIRST-TIME-THRU     TO TRUE.                          07030000
084700                                                                  07040000
084800     PERFORM                                                      07050000
084900     UNTIL PS-NO-MORE-CONTROL-ROWS                                07060000
085000                                                                  07070000
085100         PERFORM 2300-FETCH-CONTROL-ROW                           07080000
085200         IF  PS-MORE-CONTROL-ROWS                                 07090000
085300             ADD 1                 TO  PV-FETCH-COUNT             07100000
085400             MOVE SVT00001-CRD-PROD-YR   TO PV-CN-YEAR            07110000
085500             MOVE SVT00001-SHIPT-REQ-NBR TO PV-CN-RQST-NBR        07120000
085600             MOVE SVT00001-CNTL-NBR      TO PV-CN-SEQ-NBR         07130000
085700             IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP         07150000
085800               IF SVT00000-CRD-PRDR-CDE =                         07160000
085900                  SV004-CARD-PRODUCER-KOHLS                       07170000
091900                    PERFORM 2005-FORMAT-KMRC-FOR-KOHLS            07181000
091800               ELSE                                               07770000
091900                    PERFORM 2030-FORMAT-KMRC-FOR-VENDOR           07790000
092600               END-IF                                             07791000
092000             ELSE                                                 07800000
085700               IF SVT00000-CRD-TYP-CDE = SV004-GIFT-CRD-TYP       07810000
092100                 IF SVT00000-CRD-PRDR-CDE =                       07820000
092200                    SV004-CARD-PRODUCER-KOHLS                     07830000
092300                     PERFORM 2010-FORMAT-KOHLS-GIFT-CARD          07840000
092400                 ELSE                                             07850000
092500                     PERFORM 2020-FORMAT-VENDOR-GIFT-CARD         07870000
092600                 END-IF                                           07880000
092600               END-IF                                             07881000
092700             END-IF                                               07890000
092800         END-IF                                                   07900000
092900     END-PERFORM.                                                 07910000
093000                                                                  07920000
093100     PERFORM 2400-CLOSE-CONTROL-CURSOR.                           07930000
093200     PERFORM 5000-WRITE-DETAIL-LINE.                              07940000
093300     PERFORM 5100-WRITE-TOTAL.                                    07950000
093400                                                                  07960000
093500     IF  PV-FETCH-COUNT NOT EQUAL SVT00000-CRD-REQ-QTY            07970000
093600                                                                  07980000
093700         DISPLAY ' * * * * * * * * * * * * * * * * * * * * *'     07990000
093800         DISPLAY ' *                                       *'     08000000
093900         DISPLAY ' * THE NUMBER OF CONTROL ROWS RETRIEVED  *'     08010000
094000         DISPLAY ' * DID NOT MATCH THE NUMBER REQUESTED.   *'     08020000
094100         DISPLAY ' *                                       *'     08030000
094200         DISPLAY ' *   REQUEST NBR: ' PV-RQST-NBR-DISPLAY         08040000
094300                                        '                  *'     08050000
094400         DISPLAY ' *   REQUEST QTY: ' PV-RQST-QTY-DISPLAY         08060000
094500                                          '                *'     08070000
094600         DISPLAY ' *  SELECT COUNT: ' PV-FETCH-COUNT              08080000
094700                                           '               *'     08090000
094800         DISPLAY ' *                                       *'     08100000
094900         DISPLAY ' * * * * * * * * * * * * * * * * * * * * *'     08110000
095000     END-IF.                                                      08120000
095100                                                                  08130000
095200     MOVE  ZEROS                TO  PV-FETCH-COUNT.               08140000
095300     MOVE  ZEROS                TO  PV-FILE-NAME-SUFFIX-COUNT.    08150000
095400                                                                  08160000
BJSFX3     IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS         08170000
BJSFX3         PERFORM 3250-WRITE-STOP-RECORD                           08180000
BJSFX3     END-IF.                                                      08190000
095800                                                                  08200000
BJSFX3     PERFORM 3100-CLOSE-REQUEST-FILE.                             08210000
090900     PERFORM 3150-RENAME-TEMP-FILE.                               08220000
096100                                                                  08230000
096200     PERFORM 2100-FETCH-REQUEST-ROW.                              08240000
096300                                                                  08250000
096400     IF PS-MORE-REQUESTS                                          08260000
096500         MOVE SVT00000-CRD-REQD-DTE                               08270000
096600                                TO  PV-REQUEST-DATE               08280000
096700         MOVE SVT00000-SHIPT-REQ-NBR                              08290000
096800                                TO  PV-RQST-NBR-CONVERT           08300000
096900         MOVE ZEROS             TO  PV-WRITE-COUNT                08310000
                                                                        08315000
097000         PERFORM 3000-ALLOCATE-AND-OPEN-RQST                      08320000
097100     END-IF.                                                      08330000
097100                                                                  08330100
097300****************************************************************  08330200
097400*                                                              *  08330300
097500*    FORMAT THE EXTRACT FILE FOR KMRC CARDS PRODUCED AT KOHLS  *  08330400
097600*                                                              *  08330500
097700****************************************************************  08330600
091900 2005-FORMAT-KMRC-FOR-KOHLS.                                      08331000
086000     MOVE EXTRACT-FILE-DR-KMRC TO SV006-DETAIL-RECORD-KMRC.       08332000
086100                                                                  08333000
086200     MOVE PV-FETCH-COUNT    TO SV006-DR-KMRC-EMB-SEARCH-CODE.     08334000
086300                                                                  08335000
086400     MOVE PV-CONTROL-NUMBER TO SV006-DR-KMRC-CNTL-NBR             08336000
086600                               SV006-DR-KMRC-EMB-CNTL-NBR.        08338000
086700     MOVE SVT00001-CRD-NBR  TO SV006-DR-KMRC-CARD-NBR             08339000
086900                               PV-CARD-NBR-DECIMAL.               08339200
087000     MOVE SVT00001-CRD-PIN-NBR                                    08339300
087100                          TO  SV006-DR-KMRC-CARD-NBR-PIN.         08339400
087200     MOVE SV004-KOHLS-IIN TO  PV-BIN-NBR                          08339500
087400                              SV006-DR-KMRC-KOHLS-BIN.            08339700
087500     MOVE SVT00001-CRD-SPCTY-TYP-CDE                              08339800
087600                          TO  PV-CRD-STK-TYP.                     08339900
087700     MOVE PV-BIN-1-4      TO  PV-KMRC-CARD-NBR-1-4.               08340000
087900     MOVE PV-BIN-5-6      TO  PV-KMRC-CARD-NBR-5-6.               08340200
088100     MOVE PV-CRD-STK-TYP  TO  PV-KMRC-CARD-NBR-7                  08340400
088300                              SV006-DR-KMRC-CRD-TYP.              08340600
088400     MOVE PV-CARD-NBR-1-2 TO  PV-KMRC-CARD-NBR-8-9.               08340700
088500                                                                  08340800
088600     MOVE PV-CARD-NBR-3-7 TO  PV-KMRC-CARD-NBR-10-14.             08340900
088700                                                                  08341000
088800     MOVE PV-CARD-NBR-8-12 TO  PV-KMRC-CARD-NBR-15-19.            08341100
088900                                                                  08341200
089000     MOVE PV-KMRC-CARD-NBR-SPACED                                 08341300
089100                          TO  SV006-DR-KMRC-CRD-NBR-SPACED.       08341400
089200     MOVE SVT00008-UPC-NBR                                        08341500
089300                          TO  PV-UPC-NBR-DECIMAL.                 08341600
089400     MOVE PV-UPC-NBR-11   TO  SV006-DR-KMRC-UPC-NBR               08341700
089600                              SV006-DR-KMRC-PRINT-UPC.            08341900
089900                                                                  08342000
089700     PERFORM 3050-GET-DENOM-INFO.                                 08342100
089900                                                                  08342200
089800     MOVE PV-DENOM-IFILE TO  SV006-DR-KMRC-DENOM-IFILE.           08342300
089900                                                                  08342400
090000     IF PS-FIRST-TIME-THRU                                        08342500
090100         MOVE PV-CONTROL-NUMBER TO DL-STARTING-CONTROL-NBR        08342600
090300         SET PS-NOT-FIRST-TIME-THRU TO TRUE                       08342700
090500     END-IF.                                                      08342800
090600     IF PV-WRITE-COUNT = PV-MAX-CONTROL-RECORDS                   08342900
090700         PERFORM 5000-WRITE-DETAIL-LINE                           08343000
090800         PERFORM 3250-WRITE-STOP-RECORD                           08343100
090900         PERFORM 3100-CLOSE-REQUEST-FILE                          08343200
090900         PERFORM 3150-RENAME-TEMP-FILE                            08343300
091100         MOVE ZEROS       TO  PV-WRITE-COUNT                      08343400
                                                                        08343900
091200         PERFORM 3000-ALLOCATE-AND-OPEN-RQST                      08344000
091300         MOVE PV-CONTROL-NUMBER  TO DL-STARTING-CONTROL-NBR       08344100
091500     END-IF.                                                      08344200
091600     MOVE PV-CONTROL-NUMBER TO DL-ENDING-CONTROL-NBR.             08344300
091700     PERFORM 2500-WRITE-CONTROL-RECORD.                           08344400
097200                                                                  08345000
097300****************************************************************  08350000
097400*                                                              *  08360000
097500*    FORMAT THE EXTRACT FILE FOR GIFT CARDS PRODUCED AT KOHLS  *  08370000
097600*                                                              *  08380000
097700****************************************************************  08390000
097800 2010-FORMAT-KOHLS-GIFT-CARD.                                     08400000
097900                                                                  08410000
098000     MOVE EXTRACT-FILE-DR-GIFT TO SV008-DETAIL-RECORD-GIFT.       08420000
098100     MOVE PV-FETCH-COUNT       TO SV008-DR-GIFT-EMB-SEARCH-CODE.  08430000
098200     MOVE PV-CONTROL-NUMBER    TO SV008-DR-GIFT-CNTL-NBR          08440000
098300                                  SV008-DR-GIFT-EMB-CNTL-NBR.     08450000
098400                                                                  08460000
098500     MOVE SVT00000-PRE-DNNTD-CRD-AMT                              08470000
098600                               TO   PV-PRE-DNNTD-CRD-AMT          08480000
098700     IF SVT00000-PRE-DNNTD-CRD-AMT = 0                            08490000
098800         MOVE ZERO                   TO SV008-DR-GIFT-DNNTD-AMT   08500000
098900     ELSE                                                         08510000
099000         MOVE PV-PRE-DNNTD-DOLLARS   TO SV008-DR-GIFT-DNNTD-AMT   08520000
099100     END-IF.                                                      08530000
099200                                                                  08540000
099300     MOVE SVT00001-CRD-NBR     TO PV-CARD-NBR-DECIMAL.            08550000
099400     MOVE PV-CARD-NBR-VENDOR-1-12                                 08560000
099500                               TO SV008-DR-CARD-NBR.              08570000
099600     MOVE SVT00001-CRD-PIN-NBR TO SV008-DR-GIFT-CRD-NBR-PIN.      08580000
099700                                                                  08590000
099800     PERFORM 3050-GET-DENOM-INFO.                                 08600000
099900                                                                  08610000
100000     MOVE PV-DENOM-IFILE       TO SV008-DR-GIFT-CRD-DENOM-IFILE.  08620000
100100                                                                  08630000
100200     MOVE SV004-KOHLS-IIN      TO  PV-BIN-NBR                     08640000
100300                                   SV008-DR-KOHLS-BIN.            08650000
100400     MOVE SVT00001-CRD-SPCTY-TYP-CDE                              08660000
100500                               TO  PV-CRD-STK-TYP.                08670000
100600     MOVE PV-BIN-1-4           TO  PV-GIFT-CARD-NBR-1-4.          08680000
100700     MOVE PV-BIN-5-6           TO  PV-GIFT-CARD-NBR-5-6.          08690000
100800     MOVE PV-CRD-STK-TYP       TO  PV-GIFT-CARD-NBR-7             08700000
100900                                   SV008-DR-CARD-TYPE.            08710000
101000     MOVE PV-CARD-NBR-1-2      TO  PV-GIFT-CARD-NBR-8-9.          08720000
101100     MOVE PV-CARD-NBR-3-7      TO  PV-GIFT-CARD-NBR-10-14.        08730000
101200     MOVE PV-CARD-NBR-8-12     TO  PV-GIFT-CARD-NBR-15-19.        08740000
101300     MOVE PV-GIFT-CARD-NBR-SPACED                                 08750000
101400                               TO  SV008-DR-GIFT-CRD-NBR-SPACED.  08760000
101500     MOVE SVT00008-UPC-NBR     TO  PV-UPC-NBR-DECIMAL.            08770000
101600     MOVE PV-UPC-NBR-11        TO  SV008-DR-GIFT-UPC-NBR          08780000
101700                                   SV008-DR-GIFT-CRD-PRINT-UPC.   08790000
101800     IF PS-FIRST-TIME-THRU                                        08800000
101900         MOVE PV-CONTROL-NUMBER     TO DL-STARTING-CONTROL-NBR    08810000
102000         SET PS-NOT-FIRST-TIME-THRU TO TRUE                       08820000
102100     END-IF.                                                      08830000
102200                                                                  08840000
102300     IF PV-WRITE-COUNT = PV-MAX-CONTROL-RECORDS                   08850000
102400         PERFORM 5000-WRITE-DETAIL-LINE                           08860000
BJSFX3         PERFORM 3250-WRITE-STOP-RECORD                           08870000
BJSFX3         PERFORM 3100-CLOSE-REQUEST-FILE                          08880000
090900         PERFORM 3150-RENAME-TEMP-FILE                            08890000
102800         MOVE ZEROS             TO PV-WRITE-COUNT                 08900000
                                                                        08905000
102900         PERFORM 3000-ALLOCATE-AND-OPEN-RQST                      08910000
103000         MOVE PV-CONTROL-NUMBER TO DL-STARTING-CONTROL-NBR        08920000
103100     END-IF                                                       08930000
103200                                                                  08940000
103300     MOVE PV-CONTROL-NUMBER TO DL-ENDING-CONTROL-NBR.             08950000
103400     PERFORM 2500-WRITE-CONTROL-RECORD.                           08960000
103500                                                                  08970000
103600****************************************************************  08980000
103700*                                                              *  08990000
103800*    FORMAT THE EXTRACT FILE FOR GIFT CARDS PRODUCED AT VENDOR *  09000000
103900*                                                              *  09010000
104000****************************************************************  09020000
104100 2020-FORMAT-VENDOR-GIFT-CARD.                                    09030000
104200                                                                  09040000
104300     MOVE SPACES               TO SV050-CONTROL-RECORD.           09050000
104400                                                                  09060000
104500     MOVE PV-CONTROL-NUMBER    TO SV050-DR-CNTL-NBR.              09070000
104600                                                                  09080000
104610     MOVE SVT00000-PRE-DNNTD-CRD-AMT                              09090000
104620                               TO PV-PRE-DNNTD-CRD-AMT.           09100000
104630                                                                  09110000
104700     IF SVT00000-PRE-DNNTD-CRD-AMT = 0                            09120000
104800         MOVE ZERO                 TO SV050-DR-GIFT-DNNTD-AMT     09130000
104900     ELSE                                                         09140000
105000         MOVE PV-PRE-DNNTD-DOLLARS TO SV050-DR-GIFT-DNNTD-AMT     09150000
105100     END-IF.                                                      09160000
105101                                                                  09170000
105300     MOVE SVT00001-CRD-PIN-NBR TO SV050-DR-CRD-PIN-NBR.           09180000
105400     MOVE SVT00008-UPC-NBR     TO PV-UPC-NBR-DECIMAL.             09190000
105500     MOVE PV-UPC-NBR-11        TO SV050-DR-CRD-UPC-NBR            09200000
105600                                  SV050-DR-SAFEWAY-UPC-WO-CD.     09210000
105700     MOVE SVT00001-CRD-NBR     TO PV-CARD-NBR-DECIMAL.            09220000
105800     MOVE PV-CRD-TYP-CDE       TO SV050-DR-CRD-TYPE               09230000
105900                                  SV050-DR-SAFEWAY-CRD-TYPE.      09240000
106000     MOVE SV004-KOHLS-IIN      TO PV-BIN-NBR                      09250000
106100                                  SV050-DR-CRD-BIN-NBR            09260000
106200                                  SV050-DR-SAFEWAY-BIN-NBR.       09270000
106300     MOVE PV-CARD-NBR-VENDOR-1-12                                 09280000
106400                               TO SV050-DR-CARD-NBR               09290000
106500                                  SV050-DR-SAFEWAY-CARD-NBR.      09300000
106510                                                                  09310000
106520***  The next MOVE allows check the 1st 3 chars of stk-typ-id to  09320000
106530***  see if the requested card is for Safeway                     09330000
106540***  88 level 'PV-CARD-STOCK-SAFEWAY' for values                  09340000
106550***  'SAF' and 'SWH' indicate Safeway stock in the next 'IF'.     09350000
106600     MOVE SVT00000-CRD-STK-TYP-ID TO PV-CRD-STK-TYP-ID.           09360000
106610                                                                  09370000
106714     IF  PV-CARD-STOCK-SAFEWAY                                    09380000
106720         PERFORM 3050-GET-DENOM-INFO                              09390000
106737         MOVE PV-PRE-DNNTD-AMT-SAFEWAY TO SV050-DR-SAFEWAY-AMT    09400000
106740         MOVE '$'                  TO SV050-DR-SAFEWAY-DIG-12     09410000
106750                                      SV050-DR-SAFEWAY-DIG-18     09420000
106760         MOVE SV004-SAFEWAY-BIN    TO PV-BIN-NBR                  09430000
106770                                      SV050-DR-CRD-BIN-NBR        09440000
106780                                      SV050-DR-SAFEWAY-BIN-NBR    09450000
106790         SET SV050-EXPIRATION-DTE  TO TRUE                        09460000
106800     END-IF.                                                      09470000
106900                                                                  09480000
107000     MOVE SVT00001-CRD-SPCTY-TYP-CDE                              09490000
107100                                    TO PV-CRD-STK-TYP.            09500000
107200     MOVE PV-BIN-1-4                TO PV-GIFT-CARD-NBR-1-4.      09510000
107300     MOVE PV-BIN-5-6                TO PV-GIFT-CARD-NBR-5-6.      09520000
107400     MOVE PV-CRD-STK-TYP            TO SV050-DR-CRD-TYPE          09530000
107500                                       SV050-DR-SAFEWAY-CRD-TYPE  09540000
107600                                       PV-GIFT-CARD-NBR-7.        09550000
107700     MOVE PV-CARD-NBR-1-2           TO PV-GIFT-CARD-NBR-8-9.      09560000
107800     MOVE PV-CARD-NBR-3-7           TO PV-GIFT-CARD-NBR-10-14.    09570000
107900     MOVE PV-CARD-NBR-8-12          TO PV-GIFT-CARD-NBR-15-19.    09580000
108000     MOVE PV-GIFT-CARD-NBR-SPACED   TO SV050-DR-CARD-NBR-PRINT.   09590000
108100                                                                  09600000
108200     IF PS-FIRST-TIME-THRU                                        09610000
108300         MOVE PV-CONTROL-NUMBER     TO DL-STARTING-CONTROL-NBR    09620000
108400         SET PS-NOT-FIRST-TIME-THRU TO TRUE                       09630000
108500     END-IF.                                                      09640000
108600                                                                  09650000
108700     MOVE PV-CONTROL-NUMBER TO DL-ENDING-CONTROL-NBR.             09660000
108800     PERFORM 2500-WRITE-CONTROL-RECORD.                           09670000
108900                                                                  09680000
109000****************************************************************  09690000
109100*                                                              *  09700000
109200*    FORMAT THE EXTRACT FILE FOR KMRC CARDS PRODUCED AT        *  09710000
109300*    THE VENDOR.                                               *  09720000
109400*                                                              *  09730000
109500****************************************************************  09740000
109600 2030-FORMAT-KMRC-FOR-VENDOR.                                     09750000
104200                                                                  09751000
109700     MOVE SPACES               TO SV050-CONTROL-RECORD.           09760000
109800     MOVE PV-CONTROL-NUMBER    TO SV050-DR-CNTL-NBR.              09770000
109900     MOVE SVT00001-CRD-NBR     TO PV-CARD-NBR-DECIMAL.            09780000
110000     MOVE SVT00008-UPC-NBR     TO PV-UPC-NBR-DECIMAL.             09790000
110100     MOVE PV-UPC-NBR-11        TO SV050-DR-CRD-UPC-NBR            09800000
110200                                  SV050-DR-SAFEWAY-UPC-WO-CD.     09810000
110300     MOVE PV-CARD-NBR-VENDOR-1-12                                 09820000
110400                               TO SV050-DR-CARD-NBR               09830000
110500                                  SV050-DR-SAFEWAY-CARD-NBR.      09840000
110600     MOVE SVT00001-CRD-PIN-NBR TO SV050-DR-CRD-PIN-NBR.           09850000
110700     MOVE SV004-KOHLS-IIN      TO PV-BIN-NBR                      09860000
110800                                  SV050-DR-CRD-BIN-NBR            09870000
110900                                  SV050-DR-SAFEWAY-BIN-NBR.       09880000
111000     MOVE SVT00001-CRD-SPCTY-TYP-CDE                              09890000
111100                               TO PV-CRD-STK-TYP.                 09900000
111200     MOVE PV-BIN-1-4           TO PV-GIFT-CARD-NBR-1-4.           09910000
111300     MOVE PV-BIN-5-6           TO PV-GIFT-CARD-NBR-5-6.           09920000
111400     MOVE PV-CRD-STK-TYP       TO SV050-DR-CRD-TYPE               09930000
111500                                  SV050-DR-SAFEWAY-CRD-TYPE       09940000
111600                                  PV-GIFT-CARD-NBR-7.             09950000
111700     MOVE PV-CARD-NBR-1-2      TO PV-GIFT-CARD-NBR-8-9.           09960000
111800     MOVE PV-CARD-NBR-3-7      TO PV-GIFT-CARD-NBR-10-14.         09970000
111900     MOVE PV-CARD-NBR-8-12     TO PV-GIFT-CARD-NBR-15-19.         09980000
112000     MOVE PV-GIFT-CARD-NBR-SPACED                                 09990000
112100                               TO SV050-DR-GIFT-CRD-NBR-SPACED.   10000000
112200                                                                  10010000
112300     IF PS-FIRST-TIME-THRU                                        10020000
112400         MOVE PV-CONTROL-NUMBER                                   10030000
112500                                 TO DL-STARTING-CONTROL-NBR       10040000
112600         SET PS-NOT-FIRST-TIME-THRU                               10050000
112700                                 TO TRUE                          10060000
112800     END-IF.                                                      10070000
112900     MOVE PV-CONTROL-NUMBER TO DL-ENDING-CONTROL-NBR.             10080000
113000     PERFORM 2500-WRITE-CONTROL-RECORD.                           10090000
113100                                                                  10100000
113200****************************************************************  10110000
113300*                                                              *  10120000
113400*    RETRIEVE A ROW FROM THE REQUEST TABLE.                    *  10130000
113500*    THIS DATA IS USED AS THE SELECTION CRITERIA FOR           *  10140000
113600*    RETRIEVING KMC CONTROL DATA.                              *  10150000
113700*                                                              *  10160000
113800****************************************************************  10170000
113900 2100-FETCH-REQUEST-ROW.                                          10180000
114000                                                                  10190000
114200     PERFORM                                                      10200000
114300         WITH TEST AFTER                                          10210000
114400         VARYING PV-SQL-SUB                                       10220000
114500         FROM 1 BY 1                                              10230000
114600         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       10240000
114700                   OR SQLCODE = 0                                 10250000
114800                   OR SQLCODE = +100)                             10260000
114900         EXEC SQL                                                 10270000
115000             FETCH KMC-REQUEST                                    10280000
115100                 INTO :SVT00000-CRD-PROD-YR                       10290000
115200                    , :SVT00000-SHIPT-REQ-NBR                     10300000
115300                    , :SVT00000-CRD-REQ-QTY                       10310000
115400                    , :SVT00000-CRD-REQD-DTE                      10320000
115500                    , :SVT00000-CRD-TYP-CDE                       10330000
115600                    , :SVT00000-PRE-DNNTD-CRD-AMT                 10340000
115700                    , :SVT00000-CRD-STK-TYP-ID                    10350000
115800                    , :SVT00008-CRD-STK-TYP-DESC                  10360000
115900                    , :SVT00000-CRD-PRDR-CDE                      10370000
116000                    , :SVT00008-UPC-NBR                           10380000
116100         END-EXEC                                                 10390000
116200                                                                  10400000
116300         EVALUATE TRUE                                            10410000
116400             WHEN SQLCODE = -904                                  10420000
116500             WHEN SQLCODE = -911                                  10430000
116600             WHEN SQLCODE = 0                                     10440000
116700                 CONTINUE                                         10450000
116800             WHEN SQLCODE = +100                                  10460000
116900                 SET PS-NO-MORE-REQUESTS  TO  TRUE                10470000
117000                 CONTINUE                                         10480000
117100             WHEN SQLWARN NOT = SPACES                            10490000
117200             WHEN SQLCODE NOT = ZERO                              10500000
117300                 MOVE '2100-FETCH-REQUEST-ROW'                    10510000
117400                               TO  PV-PARAGRAPH-NAME              10520000
117500                 MOVE 'FETCH REQUEST DATA'                        10530000
117600                               TO  PV-DB2-OPER-ATTEMPTED          10540000
117700                 PERFORM 9900-SQL-ABEND                           10550000
117800         END-EVALUATE                                             10560000
117900     END-PERFORM.                                                 10570000
118000                                                                  10580000
118100     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        10590000
118200         MOVE '2100-FETCH-REQUEST-ROW'                            10600000
118300                               TO  PV-PARAGRAPH-NAME              10610000
118400         MOVE 'REQUEST FETCH RETRIES EXCEEDED'                    10620000
118500                               TO  PV-DB2-OPER-ATTEMPTED          10630000
118600         PERFORM 9900-SQL-ABEND                                   10640000
118700     END-IF.                                                      10650000
118800                                                                  10660000
118900****************************************************************  10670000
119000*                                                              *  10680000
119100*    USES THE DATA FROM THE REQUEST TABLE TO RETRIEVE          *  10690000
119200*    KMC CONTROL DATA.                                         *  10700000
119300*                                                              *  10710000
119400****************************************************************  10720000
119500 2200-OPEN-CONTROL-CURSOR.                                        10730000
119600                                                                  10740000
119700     PERFORM                                                      10750000
119800         WITH TEST AFTER                                          10760000
119900         VARYING PV-SQL-SUB                                       10770000
120000         FROM 1 BY 1                                              10780000
120100         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       10790000
120200                   OR SQLCODE = 0                                 10800000
120300                   OR SQLCODE = +100)                             10810000
120400         EXEC SQL                                                 10820000
120500             OPEN KMC-CONTROL                                     10830000
120600         END-EXEC                                                 10840000
120700                                                                  10850000
120800         EVALUATE TRUE                                            10860000
120900             WHEN SQLCODE = -904                                  10870000
121000             WHEN SQLCODE = -911                                  10880000
121100             WHEN SQLCODE = 0                                     10890000
121200                 CONTINUE                                         10900000
121300             WHEN SQLCODE = +100                                  10910000
121400                 SET  PS-NO-MORE-CONTROL-ROWS  TO  TRUE           10920000
121500                 CONTINUE                                         10930000
121600             WHEN SQLWARN NOT = SPACES                            10940000
121700             WHEN SQLCODE NOT = ZERO                              10950000
121800                 MOVE '2200-OPEN-CONTROL-CURSOR'                  10960000
121900                               TO  PV-PARAGRAPH-NAME              10970000
122000                 MOVE 'OPEN CONTROL CURSOR'                       10980000
122100                               TO  PV-DB2-OPER-ATTEMPTED          10990000
122200                 PERFORM 9900-SQL-ABEND                           11000000
122300         END-EVALUATE                                             11010000
122400     END-PERFORM.                                                 11020000
122500                                                                  11030000
122600     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        11040000
122700         MOVE '2200-OPEN-CONTROL-CURSOR'                          11050000
122800                               TO  PV-PARAGRAPH-NAME              11060000
122900         MOVE 'CONTROL OPEN RETRIES EXCEEDED'                     11070000
123000                               TO  PV-DB2-OPER-ATTEMPTED          11080000
123100         PERFORM 9900-SQL-ABEND                                   11090000
123200     END-IF.                                                      11100000
123300     SET  PS-MORE-CONTROL-ROWS  TO  TRUE.                         11110000
123400                                                                  11120000
123500****************************************************************  11130000
123600*                                                              *  11140000
123700*    USES THE DATA FROM THE REQUEST TABLE TO RETRIEVE          *  11150000
123800*    KMC CONTROL DATA.                                         *  11160000
123900*                                                              *  11170000
124000****************************************************************  11180000
124100 2300-FETCH-CONTROL-ROW.                                          11190000
124200                                                                  11200000
124300     PERFORM                                                      11210000
124400         WITH TEST AFTER                                          11220000
124500         VARYING PV-SQL-SUB                                       11230000
124600         FROM 1 BY 1                                              11240000
124700         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       11250000
124800                   OR SQLCODE = 0                                 11260000
124900                   OR SQLCODE = +100)                             11270000
125000         EXEC SQL                                                 11280000
125100             FETCH KMC-CONTROL                                    11290000
125200                 INTO :SVT00001-CRD-PROD-YR                       11300000
125300                     ,:SVT00001-SHIPT-REQ-NBR                     11310000
125400                     ,:SVT00001-CNTL-NBR                          11320000
125500                     ,:SVT00001-CRD-NBR                           11330000
125600                     ,:SVT00001-CRD-PIN-NBR                       11340000
125700                     ,:SVT00001-CRD-SPCTY-TYP-CDE                 11350000
125800         END-EXEC                                                 11360000
125900                                                                  11370000
126000         EVALUATE TRUE                                            11380000
126100             WHEN SQLCODE = -904                                  11390000
126200             WHEN SQLCODE = -911                                  11400000
126300             WHEN SQLCODE = 0                                     11410000
126400                 CONTINUE                                         11420000
126500             WHEN SQLCODE = +100                                  11430000
126600                 SET  PS-NO-MORE-CONTROL-ROWS  TO  TRUE           11440000
126700                 CONTINUE                                         11450000
126800             WHEN SQLWARN NOT = SPACES                            11460000
126900             WHEN SQLCODE NOT = ZERO                              11470000
127000                 MOVE '2300-FETCH-CONTROL-ROW'                    11480000
127100                               TO  PV-PARAGRAPH-NAME              11490000
127200                 MOVE 'FETCH CONTROL CURSOR'                      11500000
127300                               TO  PV-DB2-OPER-ATTEMPTED          11510000
127400                 PERFORM 9900-SQL-ABEND                           11520000
127500         END-EVALUATE                                             11530000
127600     END-PERFORM.                                                 11540000
127700                                                                  11550000
127800     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        11560000
127900         MOVE '2300-FETCH-CONTROL-ROW'                            11570000
128000                               TO  PV-PARAGRAPH-NAME              11580000
128100         MOVE 'CONTROL FETCH RETRIES EXCEEDED'                    11590000
128200                               TO  PV-DB2-OPER-ATTEMPTED          11600000
128300         PERFORM 9900-SQL-ABEND                                   11610000
128400     END-IF.                                                      11620000
128500                                                                  11630000
128600****************************************************************  11640000
128700*                                                              *  11650000
128800*    CLOSE THE KMC CONTROL CURSOR.                             *  11660000
128900*                                                              *  11670000
129000****************************************************************  11680000
129100 2400-CLOSE-CONTROL-CURSOR.                                       11690000
129200                                                                  11700000
129300     EXEC SQL                                                     11710000
129400         CLOSE KMC-CONTROL                                        11720000
129500     END-EXEC.                                                    11730000
129600                                                                  11740000
129700****************************************************************  11750000
129800*                                                              *  11760000
129900*    THIS ROUTINE MOVES AND WRITES THE DETAIL CONTROL EXTRACT  *  11770000
130000*    FILE RECORDS.                                                11780000
130100*                                                              *  11790000
130200****************************************************************  11800000
BJSFX3 2500-WRITE-CONTROL-RECORD.                                       11810000
BJSFX3                                                                  11820000
BJSFX3     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 11830000
BJSFX3         IF SVT00000-CRD-PRDR-CDE =                               11840000
BJSFX3                  SV004-CARD-PRODUCER-KOHLS                       11850000
BJSFX3*  KMRC CARD AND BEING PRINTED AT CARDMAX (KOHLS)                 11860000
BJSFX3             MOVE SV006-DETAIL-RECORD-KMRC                        11870000
BJSFX3                            TO REQUEST-CARDMAX-EXTRACT-RECORD     11880000
                   WRITE REQUEST-CARDMAX-EXTRACT-RECORD                 11900000
BJSFX3             MOVE SV006-DETAIL-RECORD-KMRC                        11901000
BJSFX3                            TO RP-REQUEST-KMRC-EXTRACT-RECORD     11903000
                   WRITE RP-REQUEST-KMRC-EXTRACT-RECORD                 11910000
BJSFX3         ELSE                                                     11920000
BJSFX3*  KMRC CARD AND BEING PRINTED AT VENDOR                          11930000
BJSFX3             MOVE SV050-DETAIL-RECORD                             11940000
BJSFX3                            TO REQUEST-VENDOR-EXTRACT-RECORD      11950000
                   WRITE REQUEST-VENDOR-EXTRACT-RECORD                  11960000
BJSFX3         END-IF                                                   11970000
BJSFX3     ELSE                                                         11980000
BJSFX3         IF SVT00000-CRD-TYP-CDE = SV004-GIFT-CRD-TYP             11981000
BJSFX3             IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS 11990000
BJSFX3*  GIFT CARD AND BEING PRINTED AT CARDMAX (KOHLS)                 12000000
BJSFX3                MOVE SV008-DETAIL-RECORD-GIFT                     12010000
BJSFX3                            TO REQUEST-CARDMAX-EXTRACT-RECORD     12020000
                      WRITE REQUEST-CARDMAX-EXTRACT-RECORD              12040000
                                                                        12040100
BJSFX3                MOVE SV008-DETAIL-RECORD-GIFT                     12041000
BJSFX3                            TO RP-REQUEST-GIFT-EXTRACT-RECORD     12043000
                      WRITE RP-REQUEST-GIFT-EXTRACT-RECORD              12050000
BJSFX3             ELSE                                                 12060000
BJSFX3*  GIFT CARD AND BEING PRINTED AT VENDOR                          12070000
BJSFX3                MOVE SV050-DETAIL-RECORD                          12080000
BJSFX3                            TO REQUEST-VENDOR-EXTRACT-RECORD      12090000
                      WRITE REQUEST-VENDOR-EXTRACT-RECORD               12100000
BJSFX3             END-IF                                               12110000
BJSFX3         END-IF                                                   12111000
BJSFX3     END-IF.                                                      12120000
BJSFX3                                                                  12130000
BJSFX3     ADD +1  TO  PV-WRITE-COUNT.                                  12140000
BJSFX3                                                                  12150000
132800****************************************************************  12160000
132900*                                                              *  12170000
133000*    ALLOCATE THE REQUEST FILE NAME, AND OPEN THE FILE FOR     *  12180000
133100*    WRITING.                                                  *  12190000
133200*    THE FIRST RECORD OF THE FILE IS A HEADER RECORD, SO       *  12200000
133300*    THE DATA WAITING TO BE WRITTEN MUST BE HELD UNTIL THE     *  12210000
133400*    HEADER IS WRITTEN.  THEN IT IS MOVED BACK TO THE OUTPUT   *  12220000
133500*    RECORD.                                                   *  12230000
133600*                                                              *  12240000
133700****************************************************************  12250000
133800 3000-ALLOCATE-AND-OPEN-RQST.                                     12260000
134000     ADD  +1                   TO   PV-FILE-NAME-SUFFIX-COUNT.    12270000
134100                                                                  12280000
JPGFX2* ** Only 99 files can be generated for a given batch of          12290000
JPGFX2* ** gift cards. Since PV-FILE-NAME-SUFFIX-COUNT is a 2 digit     12300000
JPGFX2* ** field, 100 is represented as 0. For cards produced at Kohls  12310000
JPGFX2* ** the segmentation limit is set to 5000 cards per segment in   12320000
JPGFX2* ** PV-MAX-CONTROL-RECORDS set in the input control card. So the 12330000
JPGFX2* ** maximum number of cards must not exceed 495000. If this job  12340000
JPGFX2* ** abends, verify that the request should be for Kohls and that 12350000
JPGFX2* ** number of cards requested is correct. If both are correct,   12360000
JPGFX2* ** then the request will need to be done in multiple batches.   12370000
JPGFX2*                                                                 12380000
JPGFX2* ** THIS RESTRICTION IS FOR GIFT CARDS PRODUCED AT KOHLS.        12390000
JPGFX2* ** CURRENTLY JOB SVK055 SEGMENTS THE CARDS PRODUCED AT          12400000
JPGFX2* ** KOHLS BY 5000 WITH A MAXIMUM LIMIT OF FILES BEING            12410000
JPGFX2* ** 99. 99 X 5000 = 495000.                                      12420000
JPGFX2     IF PV-FILE-NAME-SUFFIX-COUNT = 0                             12430000
JPGFX2         DISPLAY '**      SVKUP005 ABEND                   **'    12440000
JPGFX2         DISPLAY '** 3000-ALLOCATE-AND-OPEN-RQST           **'    12450000
JPGFX2         DISPLAY '** CARDS REQESTED EXCEEDS LIMIT - MAX 99 **'    12460000
JPGFX2         DISPLAY '** FILES ALLOWED IN REQUEST FILE         **'    12470000
JPGFX2         DISPLAY '** MUST REDUCE THE NUMBER OF CARDS       **'    12480000
JPGFX2         DISPLAY '** REQUESTED.                            **'    12490000
JPGFX2         MOVE '3000-ALLOCATE-AND-OPEN-RQST' TO PV-PARAGRAPH-NAME  12500000
JPGFX2         SET ABEND-4008        TO  TRUE                           12510000
JPGFX2         PERFORM 9999-ABEND                                       12520000
JPGFX2     END-IF.                                                      12530000
                                                                        12545000
134200     INITIALIZE DP023-DYNALC-PARMS.                               12550000
084200     MOVE SVT00000-CRD-REQ-QTY   TO  PV-RQST-QTY-DISPLAY          12551000
084200                                     PV-RQST-QTY                  12552000
084300     MOVE SVT00000-SHIPT-REQ-NBR TO  PV-RQST-NBR-DISPLAY          12554000
                                                                        12560000
BJSFX3     SET DP023-DSNAME-SYSOUT TO TRUE.                             12570000
134400     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 12580000
BJSFX3       IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS       12590000
134500         MOVE SV006-KMRC-CONTROL-RECORD                           12600000
134600                               TO  PV-HOLD-KMRC-CONTROL-RECORD    12610000
BJSFX3         MOVE 'R'              TO  PV-CNTL-FILE-CRD-TYP           12620000
BJSFX3         MOVE 'K'              TO  PV-CNTL-FILE-SPECIAL-REQ       12630000
BJSFX3         MOVE PV-RQST-NBR-CONVERT                                 12640000
BJSFX3                               TO  PV-CNTL-FILE-RQST-NBR          12650000
BJSFX3         MOVE PV-FILE-NAME-SUFFIX-COUNT                           12660000
BJSFX3                               TO  PV-CNTL-FILE-SEQ               12670000
BJSFX3         SET PV-IND TO 1                                          12680000
BJSFX3         SEARCH PV-HLQ-NAMES-TBL                                  12690000
BJSFX3         AT END                                                   12700000
BJSFX3           DISPLAY '**      SVKUP005 ABEND      **'               12710000
BJSFX3           DISPLAY '** INVALID VENDOR NAME      **'               12720000
BJSFX3           DISPLAY '** 3000-ALLOCATE-AND-OPEN-RQST'               12721000
BJSFX3           DISPLAY '** NO IMAGE FILE FOR        **'               12722000
BJSFX3           DISPLAY '** ' SVT00000-PRE-DNNTD-CRD-AMT ' DENOM **'   12723000
BJSFX3           MOVE '3000-ALLOCATE-AND-OPEN-RQST' TO PV-PARAGRAPH-NAME12724000
BJSFX3           SET ABEND-4009        TO  TRUE                         12725000
BJSFX3           PERFORM 9999-ABEND                                     12726000
BJSFX3         WHEN PV-CARD (PV-IND) = PV-KMRCCARD                      12727000
BJSFX3           MOVE PV-TEMP-HLQ-NAMES(PV-IND)  TO PV-HIGH-LEVEL-QUAL  12728000
BJSFX3           MOVE PV-BATCH-NUMBER       TO PV-BTCHNBR               12729000
BJSFX3           MOVE PV-DSNAME             TO DP023-DSNAME             12730000
BJSFX3           MOVE PV-MAX-REC(PV-IND)    TO PV-MAX-CONTROL-RECORDS   12730100
BJSFX3         END-SEARCH                                               12730200
136000         MOVE SV004-KMRC-CRD-DESC                                 12730300
136100                                TO DL-CARD-TYPE                   12730400
BJSFX3         MOVE PC-CARDMAX-DDNAME TO DP023-DDNAME                   12730500
BJSFX3         MOVE 182 TO DP023-RECSZ                                  12730600
BJSFX3       ELSE                                                       12730800
BJSFX3         PERFORM 3010-VALIDATE-VENDOR-CODE                        12730900
BJSFX3         MOVE 'R'               TO   PV-CNTL-FILE-CRD-TYP         12731000
BJSFX3         MOVE 'K'               TO   PV-CNTL-FILE-SPECIAL-REQ     12731100
BJSFX3         PERFORM 3020-MOVE-VENDOR-DATA                            12732000
BJSFX3       END-IF                                                     12733000
136200     ELSE                                                         12734000
BJSFX3       IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS       12735000
136300         MOVE SV008-GIFT-CONTROL-RECORD                           12736000
136400                                TO PV-HOLD-GIFT-CONTROL-RECORD    12737000
BJSFX3         MOVE PV-RQST-NBR-CONVERT                                 12738000
BJSFX3                                TO PV-CNTL-FILE-RQST-NBR          12739000
BJSFX3         SET PV-IND TO 1                                          12740000
BJSFX3         SEARCH PV-HLQ-NAMES-TBL                                  12750000
BJSFX3         AT END                                                   12760000
BJSFX3           DISPLAY '**      SVKUP005 ABEND      **'               12770000
BJSFX3           DISPLAY '** INVALID VENDOR NAME      **'               12780000
BJSFX3           DISPLAY '** 3000-ALLOCATE-AND-OPEN-RQST'               12790000
BJSFX3           DISPLAY '** NO IMAGE FILE FOR        **'               12800000
BJSFX3           DISPLAY '** ' SVT00000-PRE-DNNTD-CRD-AMT ' DENOM **'   12810000
BJSFX3          MOVE '3000-ALLOCATE-AND-OPEN-RQST' TO PV-PARAGRAPH-NAME 12820000
BJSFX3           SET ABEND-4009        TO  TRUE                         12830000
BJSFX3           PERFORM 9999-ABEND                                     12840000
BJSFX3         WHEN PV-CARD (PV-IND) = PV-GIFTCARD                      12850000
BJSFX3           MOVE PV-TEMP-HLQ-NAMES(PV-IND) TO  PV-HIGH-LEVEL-QUAL  12860000
BJSFX3           MOVE PV-MAX-REC(PV-IND)   TO  PV-MAX-CONTROL-RECORDS   12870000
BJSFX3         END-SEARCH                                               12880000
136500         MOVE 'G'              TO   PV-CNTL-FILE-CRD-TYP          12890000
136600         IF SVT00000-PRE-DNNTD-CRD-AMT = 0                        12891000
136700             MOVE 'N'          TO   PV-CNTL-FILE-SPECIAL-REQ      12892000
136800             MOVE EXTRACT-FILE-HR-GIFT-NON-DENOM                  12893000
136900                               TO SV008-HEADER-RECORD-GIFT        12894000
137000         ELSE                                                     12895000
137100             MOVE 'P'          TO   PV-CNTL-FILE-SPECIAL-REQ      12896000
137200             MOVE EXTRACT-FILE-HR-GIFT-PRE-DENOM                  12897000
137300                               TO SV008-HEADER-RECORD-GIFT        12898000
137400             MOVE SVT00000-PRE-DNNTD-CRD-AMT                      12899000
137500                               TO   PV-PRE-DNNTD-CRD-AMT          12900000
137600             MOVE PV-PRE-DNNTD-DOLLARS                            12910000
137700                               TO   SV008-HR-GIFT-DNNTD-AMT       12920000
137800         END-IF                                                   12930000
BJSFX3         MOVE PV-FILE-NAME-SUFFIX-COUNT                           12940000
BJSFX3                               TO   PV-CNTL-FILE-SEQ              12950000
137900         IF SVT00000-CRD-STK-TYP-ID = SV004-STK-DESC-SHRT-GIFT-CRD12960000
138000             CONTINUE                                             12970000
138100         ELSE                                                     12980000
138200             MOVE 'S'          TO   PV-CNTL-FILE-SPECIAL-REQ      12990000
138300         END-IF                                                   13000000
BJSFX3         MOVE PV-BATCH-NUMBER  TO   PV-BTCHNBR                    13010000
BJSFX3         MOVE PC-CARDMAX-DDNAME TO DP023-DDNAME                   13020000
BJSFX3         MOVE PV-DSNAME         TO DP023-DSNAME                   13030000
BJSFX3         MOVE 182               TO DP023-RECSZ                    13040000
139500         MOVE SV004-GIFT-CRD-DESC                                 13050000
139600                                TO DL-CARD-TYPE                   13060000
BJSFX3       ELSE                                                       13070000
BJSFX3         PERFORM 3010-VALIDATE-VENDOR-CODE                        13080000
BJSFX3         MOVE 'G'              TO   PV-CNTL-FILE-CRD-TYP          13090000
BJSFX3         MOVE 'S'              TO   PV-CNTL-FILE-SPECIAL-REQ      13100000
BJSFX3         PERFORM 3020-MOVE-VENDOR-DATA                            13110000
BJSFX3       END-IF                                                     13120000
139700     END-IF.                                                      13130000
BJSFX3*    SET DP023-RECOUNT-ALLOCATE-TAPE TO TRUE.                     13131000
139900     SET DP023-FREE-CLOSE-YES    TO TRUE.                         13140000
140000     SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         13150000
BJSFX3     MOVE PV-FILE-NAME-SUFFIX-COUNT                               13160000
BJSFX3                                 TO PV-CNTL-FILE-SEQ.             13170000
BJSFX3     SET DP023-DISP-NEW          TO TRUE.                         13180000
BJSFX3*    REQUEST COUNT + THE HEADER RECORD                            13190000
BJSFX3     COMPUTE PV-RQST-QTY = PV-RQST-QTY + 1.                       13200000
BJSFX3     MOVE PV-RQST-QTY          TO DP023-RECOUNT.                  13210000
140710                                                                  13220000
140710     PERFORM DP023-0000-DYNALC.                                   13230000
140710                                                                  13240000
BJSFX3     MOVE PV-BATCH-NUMBER                                         13250000
BJSFX3       TO DL-BATCH-NUMBER.                                        13260000
                                                                        13270000
BJSFX3*      CARDMAX FILES - KMRC AND GIFTCARD TOGETHER                 13280000
140900     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 13290000
BJSFX3      IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS        13300000
BJSFX3         OPEN OUTPUT REQUEST-CARDMAX-EXTRACT-FILE                 13310000
BJSFX3      ELSE                                                        13330000
BJSFX3         OPEN OUTPUT REQUEST-VENDOR-EXTRACT-FILE                  13340000
BJSFX3      END-IF                                                      13341100
141100     ELSE                                                         13341200
140900      IF SVT00000-CRD-TYP-CDE = SV004-GIFT-CRD-TYP                13341300
BJSFX3       IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS       13341400
BJSFX3         OPEN OUTPUT REQUEST-CARDMAX-EXTRACT-FILE                 13341500
BJSFX3       ELSE                                                       13341700
BJSFX3         OPEN OUTPUT REQUEST-VENDOR-EXTRACT-FILE                  13341800
BJSFX3      END-IF                                                      13342000
141300     END-IF.                                                      13342100
142300                                                                  13343000
BJSFX3     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 13344000
BJSFX3         MOVE EXTRACT-FILE-HR-KMRC                                13345000
BJSFX3                          TO SV006-HEADER-RECORD-KMRC             13346000
140800         MOVE PV-BATCH-NUMBER                                     13347000
BJSFX3                          TO SV006-HR-KMRC-MEMBER-NAME            13348000
BJSFX3     ELSE                                                         13349000
140800         MOVE PV-BATCH-NUMBER                                     13350000
BJSFX3                          TO SV008-HR-GIFT-MEMBER-NAME            13360000
BJSFX3         MOVE EXTRACT-FILE-HR-KMRC                                13370000
BJSFX3                          TO SV006-HEADER-RECORD-KMRC             13380000
BJSFX3     END-IF.                                                      13390000
143300                                                                  13400000
143400     MOVE SVT00000-PRE-DNNTD-CRD-AMT                              13410000
143500                          TO  DL-DENOMINATION.                    13420000
143600     MOVE SVT00000-CRD-STK-TYP-ID                                 13430000
143700                          TO  DL-CARD-STOCK-TYPE.                 13440000
143800     MOVE SVT00008-CRD-STK-TYP-DESC                               13450000
143900                          TO  DL-CARD-STOCK-TYPE-DESC.            13460000
144000                                                                  13470000
144100     SET SV004-CARD-PRDR-IDX TO 1.                                13480000
144200     SEARCH SV004-CARD-PRDR                                       13490000
144300         AT END                                                   13500000
144400           DISPLAY '**      SVKUP005 ABEND      **'               13510000
144500           DISPLAY '** INVALID PRODUCER CODE    **'               13520000
144600           DISPLAY '** 3000-ALLOCATE-AND-OPEN-RQST'               13530000
144700           DISPLAY '** NO IMAGE FILE FOR        **'               13540000
144800           DISPLAY '** ' SVT00000-PRE-DNNTD-CRD-AMT ' DENOM **'   13550000
144900           MOVE '3000-ALLOCATE-AND-OPEN-RQST' TO PV-PARAGRAPH-NAME13560000
145000           SET ABEND-4008        TO  TRUE                         13570000
145100           PERFORM 9999-ABEND                                     13580000
145200         WHEN SVT00000-CRD-PRDR-CDE =                             13590000
145300              SV004-CARD-PRDR-CDE (SV004-CARD-PRDR-IDX)           13600000
145400             MOVE SV004-CARD-PRDR-LIT (SV004-CARD-PRDR-IDX)       13610000
145500                          TO  DL-PRODUCER                         13620000
145600     END-SEARCH.                                                  13630000
145700                                                                  13640000
145800     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 13650000
145900         MOVE SVT00000-CRD-STK-TYP-ID                             13660000
146000                          TO SV006-HR-KMRC-CRD-STK-TYP            13670000
146100     ELSE                                                         13680000
146200         MOVE SVT00000-CRD-STK-TYP-ID                             13690000
146300                          TO SV008-HR-GIFT-CRD-STK-TYP            13700000
146400     END-IF.                                                      13710000
146500                                                                  13720000
146600      IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS        13730000
146700          PERFORM 3200-WRITE-HEADER-RECORD                        13740000
146800      END-IF.                                                     13750000
146900                                                                  13760000
147000     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 13770000
147100         MOVE PV-HOLD-KMRC-CONTROL-RECORD                         13780000
147200                          TO SV006-KMRC-CONTROL-RECORD            13790000
147300     ELSE                                                         13800000
147400         MOVE PV-HOLD-GIFT-CONTROL-RECORD                         13810000
147500                          TO SV008-GIFT-CONTROL-RECORD            13820000
147600     END-IF.                                                      13830000
                                                                        13840000
BJSFX3 3010-VALIDATE-VENDOR-CODE.                                       13850000
BJSFX3     EVALUATE TRUE                                                13860000
BJSFX3       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-INCOMM    13870000
BJSFX3            MOVE PC-INCOMM TO PV-VENDOR                           13880000
BJSFX3            MOVE PC-INCOMM-CRD-DESC                               13890000
BJSFX3                           TO DL-CARD-TYPE                        13900000
092122       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-OPTMUM        13910000
092122            MOVE PC-OPTMUM TO PV-VENDOR                           13920000
092122            MOVE PC-OPTMUM-CRD-DESC                               13930000
092122                           TO DL-CARD-TYPE                        13940000
WR7057       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-VALID         13945000
WR7057            MOVE PC-VALID  TO PV-VENDOR                           13946000
WR7057            MOVE PC-VALID-CRD-DESC                                13947000
WR7057                           TO DL-CARD-TYPE                        13948000
BJSFX3       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-BLACKHAWK     13950000
BJSFX3            MOVE PC-BLKHWK TO PV-VENDOR                           13960000
BJSFX3            MOVE PC-BLKHWK-CRD-DESC                               13970000
BJSFX3                           TO DL-CARD-TYPE                        13980000
112023       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-PLICRD        13990004
112023            MOVE PC-PLICRD TO PV-VENDOR                           13991004
112023            MOVE PC-PLICRD-CRD-DESC                               13992004
BJSFX3                           TO DL-CARD-TYPE                        13993000
BJSFX3       WHEN SVT00000-CRD-PRDR-CDE =                               13994000
BJSFX3            SV004-CARD-PRODUCER-GIFT-CERT                         13995000
BJSFX3            MOVE PC-HALMRK TO PV-VENDOR                           13996000
BJSFX3            MOVE PC-HALMRK-CRD-DESC                               13997000
BJSFX3                           TO DL-CARD-TYPE                        13998000
BJSFX3       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-JET-LITHO     13999000
BJSFX3            MOVE PC-JETLTH TO PV-VENDOR                           14000000
BJSFX3            MOVE PC-JETLTH-CRD-DESC                               14001000
BJSFX3                           TO DL-CARD-TYPE                        14001100
BJSFX3       WHEN SVT00000-CRD-PRDR-CDE = SV004-CARD-PRDR-MTL           14001200
BJSFX3            MOVE PC-MTL    TO PV-VENDOR                           14001300
BJSFX3            MOVE PC-MTL-CRD-DESC                                  14001400
BJSFX3                           TO DL-CARD-TYPE                        14001500
BJSFX3     END-EVALUATE.                                                14001600
                                                                        14001700
BJSFX3 3020-MOVE-VENDOR-DATA.                                           14001800
BJSFX3     SET PV-IND TO 1                                              14001900
BJSFX3     SEARCH PV-HLQ-NAMES-TBL                                      14002000
BJSFX3         AT END                                                   14002100
BJSFX3           DISPLAY '**      SVKUP005 ABEND      **'               14002200
BJSFX3           DISPLAY '** INVALID VENDOR NAME      **'               14002300
BJSFX3           DISPLAY '** 3000-ALLOCATE-AND-OPEN-RQST'               14002400
BJSFX3           DISPLAY '** NO IMAGE FILE FOR        **'               14002500
BJSFX3           DISPLAY '** ' SVT00000-PRE-DNNTD-CRD-AMT ' DENOM **'   14002600
BJSFX3           MOVE '3000-ALLOCATE-AND-OPEN-RQST' TO PV-PARAGRAPH-NAME14002700
BJSFX3           SET ABEND-4009        TO  TRUE                         14002800
BJSFX3           PERFORM 9999-ABEND                                     14002900
BJSFX3         WHEN PV-CARD (PV-IND) = PV-VENDOR                        14003000
BJSFX3             MOVE PV-TEMP-HLQ-NAMES(PV-IND) TO PV-HIGH-LEVEL-QUAL 14003100
BJSFX3             MOVE PV-RQST-NBR-CONVERT  TO PV-CNTL-FILE-RQST-NBR   14003200
BJSFX3             MOVE PV-FILE-NAME-SUFFIX-COUNT                       14003300
BJSFX3                                       TO PV-CNTL-FILE-SEQ        14003400
BJSFX3             MOVE PV-MAX-REC(PV-IND)   TO PV-MAX-CONTROL-RECORDS  14003500
BJSFX3             MOVE PV-BATCH-NUMBER      TO PV-BTCHNBR              14003600
BJSFX3             MOVE PV-DSNAME            TO DP023-DSNAME            14003700
BJSFX3             MOVE PC-VENDOR-DDNAME     TO DP023-DDNAME            14003800
BJSFX3             MOVE 182                  TO DP023-RECSZ             14003900
BJSFX3             MOVE SPACES               TO PV-VENDOR               14004000
BJSFX3     END-SEARCH.                                                  14005000
                                                                        14005100
147700****************************************************************  14005200
147800*                                                              *  14005300
147900*    FIND THE IMAGE FILE NAME FOR DENOMINATION REQUESTED       *  14005400
148000*                                                              *  14005500
148100****************************************************************  14005600
148200 3050-GET-DENOM-INFO.                                             14005700
148300                                                                  14005800
148400     SET SV004-DENOM-IDX       TO 1                               14005900
148500     SEARCH SV004-DENOM-AMT                                       14006000
148600         AT END                                                   14007000
148700           DISPLAY '**      SVKUP005 ABEND      **'               14008000
148800           DISPLAY '** INVALID DATA ON DATASET  **'               14009000
148900           DISPLAY '** 3050-GET-DENOM-INFO**'                     14010000
149000           DISPLAY '** NO IMAGE FILE FOR        **'               14020000
149100           DISPLAY '** ' SVT00000-PRE-DNNTD-CRD-AMT ' DENOM **'   14030000
149200           MOVE '3050-GET-DENOM-INFO' TO PV-PARAGRAPH-NAME        14040000
149300           SET ABEND-4008        TO  TRUE                         14050000
149400           PERFORM 9999-ABEND                                     14060000
149500         WHEN SV004-DENOM (SV004-DENOM-IDX)                       14070000
149600                               = SVT00000-PRE-DNNTD-CRD-AMT       14080000
149700             MOVE SV004-DENOM-IFILE (SV004-DENOM-IDX)             14090000
149800                               TO PV-DENOM-IFILE                  14100000
149900     END-SEARCH.                                                  14110000
150000****************************************************************  14120000
150100*                                                              *  14130000
150200*    CLOSE THE REQUEST FILE                                    *  14140000
150300*                                                              *  14150000
150400****************************************************************  14160000
BJSFX3 3100-CLOSE-REQUEST-FILE.                                         14170000
BJSFX3                                                                  14180000
150700     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 14190000
BJSFX3      IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS        14200000
BJSFX3         CLOSE REQUEST-CARDMAX-EXTRACT-FILE                       14210000
BJSFX3      ELSE                                                        14230000
BJSFX3         CLOSE REQUEST-VENDOR-EXTRACT-FILE                        14240000
BJSFX3      END-IF                                                      14260000
150900     ELSE                                                         14261000
BJSFX3      IF SVT00000-CRD-PRDR-CDE = SV004-CARD-PRODUCER-KOHLS        14262000
BJSFX3         CLOSE REQUEST-CARDMAX-EXTRACT-FILE                       14263000
BJSFX3      ELSE                                                        14265000
BJSFX3         CLOSE REQUEST-VENDOR-EXTRACT-FILE                        14266000
BJSFX3      END-IF                                                      14268000
151100     END-IF.                                                      14269000
151200                                                                  14270000
090900                                                                  14280000
151300****************************************************************  14290000
151400*                                                              *  14300000
151500*    THIS WILL RENAME THE FILE TO A TEMP FILE.                 *  14301000
151700*                                                              *  14301100
151800****************************************************************  14301200
151900 3150-RENAME-TEMP-FILE.                                           14301300
151200      INITIALIZE BATCH-RENAME-COMMAND-RECORD.                     14301400
151200                                                                  14301500
151200      STRING ' ALTER '   DELIMITED BY SIZE                        14301600
151200             PC-QUOTE   DELIMITED BY SIZE                         14301700
BJSFx3             PV-TEMP-HLQ-NAMES(PV-IND) DELIMITED BY SPACE         14301800
                   PV-BATCH-NUMBER   DELIMITED BY SIZE                  14301900
                   PC-QUOTE   DELIMITED BY SIZE                         14302000
                   ' - '      DELIMITED BY SIZE                         14303000
151200      INTO BATCH-RENAME-COMMAND-RECORD.                           14304000
                                                                        14305000
151200      WRITE BATCH-RENAME-COMMAND-RECORD.                          14305100
                                                                        14305200
151200      INITIALIZE BATCH-RENAME-COMMAND-RECORD.                     14305300
151200                                                                  14305400
            STRING ' NEWNAME(' DELIMITED BY SIZE                        14305500
                   PC-QUOTE    DELIMITED BY SIZE                        14305600
BJSFX3             PV-HLQ-NAMES(PV-IND) DELIMITED BY SPACE              14305700
                   PV-BATCH-NUMBER   DELIMITED BY SIZE                  14305800
                   PC-QUOTE   DELIMITED BY SIZE                         14305900
BJSFX3             ')'        DELIMITED BY SIZE                         14306000
151200      INTO BATCH-RENAME-COMMAND-RECORD.                           14306100
151200                                                                  14306200
151200      WRITE BATCH-RENAME-COMMAND-RECORD.                          14306300
151200                                                                  14306400
151300****************************************************************  14306500
151400*                                                              *  14306600
151500*    THIS ROUTINE MOVES AND WRITES THE HEADER CONTROL EXTRACT  *  14306700
151600*    FILE RECORDS.                                                14306800
151700*                                                              *  14306900
151800****************************************************************  14307000
151900 3200-WRITE-HEADER-RECORD.                                        14308000
152000     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 14309000
152100         MOVE SV006-HEADER-RECORD-KMRC                            14310000
AJSFX3                               TO REQUEST-CARDMAX-EXTRACT-RECORD  14320000
BJSFX3         WRITE REQUEST-CARDMAX-EXTRACT-RECORD                     14330000
152100         MOVE SV006-HEADER-RECORD-KMRC                            14330100
AJSFX3                               TO RP-REQUEST-KMRC-EXTRACT-RECORD  14330200
BJSFX3         WRITE RP-REQUEST-KMRC-EXTRACT-RECORD                     14331000
152400     ELSE                                                         14340000
152500         MOVE SV008-HEADER-RECORD-GIFT                            14350000
BJSFX3                               TO REQUEST-CARDMAX-EXTRACT-RECORD  14360000
BJSFX3         WRITE REQUEST-CARDMAX-EXTRACT-RECORD                     14370000
152100         MOVE SV008-HEADER-RECORD-GIFT                            14371000
AJSFX3                               TO RP-REQUEST-GIFT-EXTRACT-RECORD  14372000
BJSFX3         WRITE RP-REQUEST-GIFT-EXTRACT-RECORD                     14373000
152800     END-IF.                                                      14380000
152900                                                                  14390000
153000****************************************************************  14400000
153100*                                                              *  14410000
153200*    THIS ROUTINE MOVES AND WRITES THE STOP RECORD.            *  14420000
153300*                                                              *  14430000
153400****************************************************************  14440000
BJSFX3 3250-WRITE-STOP-RECORD.                                          14450000
BJSFX3     IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                 14460000
BJSFX3         MOVE EXTRACT-FILE-SR-KMRC                                14470000
BJSFX3                            TO REQUEST-CARDMAX-EXTRACT-RECORD     14480000
BJSFX3         WRITE REQUEST-CARDMAX-EXTRACT-RECORD                     14490000
BJSFX3     ELSE                                                         14500000
BJSFX3         MOVE EXTRACT-FILE-SR-GIFT                                14510000
BJSFX3                               TO REQUEST-CARDMAX-EXTRACT-RECORD  14520000
BJSFX3         WRITE REQUEST-CARDMAX-EXTRACT-RECORD                     14530000
BJSFX3     END-IF.                                                      14540000
                                                                        14550000
170400****************************************************************  14560000
170500*                                                              *  14570000
170600*    THIS ROUTINE WRITES THE DETAIL LINE AND ACCUMULATES A     *  14580000
170700*    RUNNING TOTAL NUMBER OF CARDS PER REQUEST.                   14590000
170800*                                                              *  14600000
170900****************************************************************  14610000
171000 5000-WRITE-DETAIL-LINE.                                          14620000
171100     IF PV-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                   14630000
171200         PERFORM 5200-PROCESS-PAGE-BREAK                          14640000
171300     END-IF.                                                      14650000
171400     MOVE PV-WRITE-COUNT           TO DL-NUMBER-REQUESTED.        14660000
171500     COMPUTE PV-NUMBER-REQUESTED-ACCUM =                          14670000
171600             PV-NUMBER-REQUESTED-ACCUM + PV-WRITE-COUNT.          14680000
171700     WRITE EMBOSSING-REPORT-RECORD                                14690000
171800         FROM REPORT-EMBOSSING-DETAIL-LINE                        14700000
171900         AFTER ADVANCING 1 LINE.                                  14710000
172000     ADD PC-ONE                    TO PV-LINE-COUNTER.            14720000
172100****************************************************************  14730000
172200*                                                              *  14740000
172300*    THIS ROUTINE WRITES THE TOTAL NUMBER OF CARDS PER REQUEST.*  14750000
172400*    IT ALSO CLEARS OUT THE ACCUMULATOR TO PREPARE FOR THE     *  14760000
172500*    NEXT REQUEST.                                             *  14770000
172600*                                                              *  14780000
172700****************************************************************  14790000
172800 5100-WRITE-TOTAL.                                                14800000
172900     WRITE EMBOSSING-REPORT-RECORD                                14810000
173000         FROM REPORT-EMBOSSING-SUBTOTAL-LINE                      14820000
173100         AFTER ADVANCING 1 LINE.                                  14830000
173200     MOVE PV-NUMBER-REQUESTED-ACCUM                               14840000
173300                                   TO TL-TOTAL-REQUESTED.         14850000
173400     WRITE EMBOSSING-REPORT-RECORD                                14860000
173500         FROM REPORT-EMBOSSING-TOTAL-LINE                         14870000
173600         AFTER ADVANCING 1 LINE.                                  14880000
173700     WRITE EMBOSSING-REPORT-RECORD                                14890000
173800         FROM REPORT-EMBOSSING-EMPTY-LINE                         14900000
173900         AFTER ADVANCING 1 LINE.                                  14910000
174000     MOVE ZEROS                    TO PV-NUMBER-REQUESTED-ACCUM.  14920000
174100     ADD PC-THREE                  TO PV-LINE-COUNTER.            14930000
174200****************************************************************  14940000
174300*                                                              *  14950000
174400*    THIS ROUTINE PROCESSES A PAGE BREAK BY INCREMENTING THE   *  14960000
174500*    PAGE COUNTER AND WRITING THE TITLE AND HEADING LINES.     *  14970000
174600*                                                              *  14980000
174700****************************************************************  14990000
174800 5200-PROCESS-PAGE-BREAK.                                         15000000
                                                                        15001000
174900     ADD PC-ONE                    TO PV-PAGE-COUNTER.            15010000
175000     MOVE PV-PAGE-COUNTER          TO DP132O-PAGE-NUMBER.         15020000
175100     WRITE EMBOSSING-REPORT-RECORD                                15030000
175200         FROM DP132O-STANDRD-HEADER-132-COLS                      15040000
175300         AFTER ADVANCING PAGE.                                    15050000
175400     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR                    15060000
175500     WRITE EMBOSSING-REPORT-RECORD                                15070000
175600         FROM REPORT-EMBOSSING-TITLE-LINE                         15080000
175700         AFTER ADVANCING 1 LINE.                                  15090000
175800     WRITE EMBOSSING-REPORT-RECORD                                15100000
175900         FROM REPORT-EMBOSSING-HEADING-1                          15110000
176000         AFTER ADVANCING 2 LINE.                                  15120000
176100     WRITE EMBOSSING-REPORT-RECORD                                15130000
176200         FROM REPORT-EMBOSSING-HEADING-2                          15140000
176300         AFTER ADVANCING 1 LINE.                                  15150000
176400     WRITE EMBOSSING-REPORT-RECORD                                15160000
176500         FROM REPORT-EMBOSSING-EMPTY-LINE                         15170000
176600         AFTER ADVANCING 1 LINE.                                  15180000
176700     MOVE PC-HEADER-LINE-COUNT     TO PV-LINE-COUNTER.            15190000
176800****************************************************************  15200000
176900*                                                              *  15210000
177000*   CLOSE THE REPORT FILE AND THE REQUEST CURSOR.              *  15220000
177100*                                                              *  15230000
177200****************************************************************  15240000
177300 9000-CLOSE-FILE-AND-CURSOR.                                      15250000
177400                                                                  15260000
177500                                                                  15270000
BJSFX3     CLOSE EMBOSSING-REPORT-FILE                                  15280000
074500           BATCH-RENAME-COMMAND-FILE                              15290000
BJSFX3           RP-REQUEST-KMRC-EXTRACT-FILE                           15291000
BJSFX3           RP-REQUEST-GIFT-EXTRACT-FILE.                          15292000
                                                                        15300000
181600     EXEC SQL                                                     15310000
181700         CLOSE KMC-REQUEST                                        15320000
181800     END-EXEC.                                                    15330000
181900                                                                  15340000
                                                                        15350000
182000****************************************************************  15360000
182100*                                                              *  15370000
182200*    THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.        *  15380000
182300*                                                              *  15390000
182400****************************************************************  15400000
182500 9900-SQL-ABEND.                                                  15410000
182600                                                                  15420000
182700     SET ABEND-4013             TO TRUE.                          15430000
182800     DISPLAY '**  ABEND     **'.                                  15440000
182900     DISPLAY '**  PROGRAM   **  =  SVKUP005'.                     15450000
183000     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            15460000
183100     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        15470000
183200****************************************************************  15480000
183300*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         15490000
183400*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        15500000
183500****************************************************************  15510000
183600     COPY DPPD004.                                                15520000
183700                                                                  15530000
183800     CALL 'ILBOABN0'  USING ABEND-CODE.                           15540000
183900                                                                  15550000
184000*                                                                 15560000
184100*  DYNAMIC ALLOCATION ROUTINE                                     15570000
184200*                                                                 15580000
184300     COPY DPPD023.                                                15590000
184400******************************************************************15600000
184500* 9999-ABEND                                                      15610000
184600*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  15620000
184700******************************************************************15630000
184800 9999-ABEND.                                                      15640000
184900     DISPLAY '** ABEND           **'.                             15650000
185000     DISPLAY '** PROGRAM         ** =  SVKUP005'.                 15660000
185100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        15670000
185200     CALL 'ILBOABN0' USING ABEND-CODE.                            15680000
