000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.              ETKUP050.                               00020099
000300 DATE-WRITTEN.            04/13/2000.                             00030099
000400 DATE-COMPILED.                                                   00040099
000500                                                                  00050099
000600******************************************************************00060099
000700*PURPOSE:                                                         00070099
000800*    THIS PROGRAM WILL CREATE AN AUTOMATED FOLLOWUP FILE FOR      00080099
000900* MISSING FUNCTIONAL ACKNOWLEDGEMENTS ON PURCHASE ORDERS.         00090099
001000* INFORMATION FOR THE EXTRACT FILE COMES FROM THE TRADING PARTNER 00100099
001100* TABLE TTRDPRT, THE ENT ID TABLE TENTNME, THE TRANSACTION STATUS 00110099
001200* TABLE TFGTRST, THE TRADING PARTNER FUNCTIONAL GROUP TBL TTRDFNC,00120099
001300* AND THE PURCHASE ORDER SHIPMENT STATUS TABLE TPLNSHP.           00130099
001400*                                                                 00140099
001500*    THE MODULE GENERATES A SECOND REQUEST EMAIL FOR AGED 997S.   00150099
001600*                                                                 00160099
001700*    AUTOMATED FOLLOWUP MODE - EMAIL.                             00170099
001800*    (CHANGES TO THIS MODULES MAY NEED TO BE MADE TO......        00180099
001900*                     ETKUP048, ETKUP049)                         00190099
002000******************************************************************00200099
002010* 03-05-2001 JON FIEDLER 0305JF                                   00201099
002020* ADDED VENDOR NAME TO SYSOUT ERROR MESSAGE.                      00202099
002030******************************************************************00203099
002031* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00203199
002032*            - CHANGE CALL OF DPKUT100 TO                       * 00203299
002033*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00203399
002034*              MAKING THE CALL DYNAMIC VS STATIC                * 00203499
002035*                                                               * 00203599
002036*---------------------------------------------------------------* 00203699
002040                                                                  00204099
002050 ENVIRONMENT DIVISION.                                            00205099
002060 CONFIGURATION SECTION.                                           00206099
002070 SOURCE-COMPUTER. IBM-S390.                                       00207099
002080 OBJECT-COMPUTER. IBM-S390.                                       00208099
002090 INPUT-OUTPUT SECTION.                                            00209099
002100 FILE-CONTROL.                                                    00210099
002200                                                                  00220099
002300     SELECT PO-OUTPUT-FILE                                        00230099
002400        ASSIGN      TO OUT01                                      00240099
002500        FILE STATUS IS WS-FILE-STATUS.                            00250099
002600                                                                  00260099
002700 DATA DIVISION.                                                   00270099
002800 FILE SECTION.                                                    00280099
002900                                                                  00290099
003000 FD  PO-OUTPUT-FILE                                               00300099
003100     RECORDING MODE IS F                                          00310099
003200     LABEL RECORDS ARE STANDARD                                   00320099
003300     RECORD CONTAINS 80 CHARACTERS                                00330099
003400     DATA RECORD IS PO-EMAIL-RECORD.                              00340099
003500                                                                  00350099
003600 01  PO-EMAIL-RECORD          PIC X(80).                          00360099
003700                                                                  00370099
003800******************************************************************00380099
003900 WORKING-STORAGE SECTION.                                         00390099
004000******************************************************************00400099
004100                                                                  00410099
004200 01  EMAIL-LINE-1.                                                00420099
004300     05  EL1-VERBIAGE          PIC X(80)  VALUE SPACES.           00430099
004400                                                                  00440099
004500 01  WS-MESSAGE-TABLE.                                            00450099
004600     05  FILLER                PIC X(75)  VALUE                   00460099
004700     'KOHLs has transmitted the following EDI 850s to your company00470099
004800-    '.             '.                                            00480099
004900     05  FILLER                PIC X(75)  VALUE                   00490099
005000     '   PO Numbers:   Date Transmitted:    GS Control #:   Ship D00500099
005100-    'ate           '.                                            00510099
005200     05  FILLER                PIC X(75)  VALUE                   00520099
005300     ' xxxxxxxxxxxxxxx     mm/dd/yyyy         yyyyyyyyy     mm/dd/00530099
005400-    'yyyy          '.                                            00540099
005500     05  FILLER                PIC X(75)  VALUE                   00550099
005600     'This is KOHLs Second Request for Acknowledgement of these pu00560099
005700-    'rchase orders'.                                             00570099
005800     05  FILLER                PIC X(75)  VALUE                   00580099
005900     'via 997. Please respond within the same business day with a 00590099
006000-    '997, email, or'.                                            00600099
006100     05  FILLER                PIC X(75)  VALUE                   00610099
006200     'fax. Failure to respond may result in chargebacks.          00620099
006300-    '              '.                                            00630099
006400     05  FILLER                PIC X(75)  VALUE SPACES.           00640099
006500     05  FILLER                PIC X(75)  VALUE                   00650099
006600     'KOHLs Department Stores                                     00660099
006700-    '              '.                                            00670099
006800     05  FILLER                PIC X(75)  VALUE                   00680099
006900     'Merchandise Information Office - MIO                        00690099
007000-    '              '.                                            00700099
007100     05  FILLER                PIC X(75)  VALUE                   00710099
007200     'Email: EDIMIO@kohls.com                                     00720099
007300-    '              '.                                            00730099
007400 01  WS-MESSAGE-ELEMENTS REDEFINES WS-MESSAGE-TABLE.              00740099
007500     05  WS-MSG-ELEMENTS       OCCURS 10 TIMES.                   00750099
007600         10  WS-MSG-DETAIL     PIC X(75).                         00760099
007700                                                                  00770099
007800 01  WS-MONTH-TABLE.                                              00780099
007900     05  FILLER                PIC X(05) VALUE '01JAN'.           00790099
008000     05  FILLER                PIC X(05) VALUE '02FEB'.           00800099
008100     05  FILLER                PIC X(05) VALUE '03MAR'.           00810099
008200     05  FILLER                PIC X(05) VALUE '04APR'.           00820099
008300     05  FILLER                PIC X(05) VALUE '05MAY'.           00830099
008400     05  FILLER                PIC X(05) VALUE '06JUN'.           00840099
008500     05  FILLER                PIC X(05) VALUE '07JUL'.           00850099
008600     05  FILLER                PIC X(05) VALUE '08AUG'.           00860099
008700     05  FILLER                PIC X(05) VALUE '09SEP'.           00870099
008800     05  FILLER                PIC X(05) VALUE '10OCT'.           00880099
008900     05  FILLER                PIC X(05) VALUE '11NOV'.           00890099
009000     05  FILLER                PIC X(05) VALUE '12DEC'.           00900099
009100 01  WS-MONTH-ELEMENTS REDEFINES WS-MONTH-TABLE.                  00910099
009200     05  WS-MTH-ELEMENTS       OCCURS 12 TIMES.                   00920099
009300         10  WS-MTH            PIC X(02).                         00930099
009400         10  WS-MTH-VARIABLE   PIC X(03).                         00940099
009500                                                                  00950099
009600 01  WS-MSG-INVOICE.                                              00960099
009700     05  WS-MSG-VERB1  PIC X(01).                                 00970099
009800     05  WS-MSG-PO     PIC X(15).                                 00980099
009900     05  WS-MSG-VERB2  PIC X(05).                                 00990099
010000     05  WS-MSG-DATE.                                             01000099
010100         10  WS-DTE-MM PIC X(02).                                 01010099
010200         10  WS-DTE-P1 PIC X(01).                                 01020099
010300         10  WS-DTE-DD PIC X(02).                                 01030099
010400         10  WS-DTE-P2 PIC X(01).                                 01040099
010500         10  WS-DTE-YY PIC X(04).                                 01050099
010600     05  WS-MSG-VERB3  PIC X(09).                                 01060099
010700     05  WS-MSG-ISA    PIC X(09).                                 01070099
010800     05  WS-MSG-VERB4  PIC X(05).                                 01080099
010900     05  WS-MSG-SHPDTE.                                           01090099
011000         10  WS-SHPDTE-MM PIC X(02).                              01100099
011100         10  WS-SHPDTE-P1 PIC X(01).                              01110099
011200         10  WS-SHPDTE-DD PIC X(02).                              01120099
011300         10  WS-SHPDTE-P2 PIC X(01).                              01130099
011400         10  WS-SHPDTE-YY PIC X(04).                              01140099
011500     05  WS-MSG-VERB5  PIC X(11).                                 01150099
011510                                                                  01151099
011520 01  WS-MSG-HEADER.                                               01152099
011530     05  WS-MSGHDR-VERB1  PIC X(40).                              01153099
011540     05  WS-MSGHDR-DOC    PIC X(03).                              01154099
011550     05  WS-MSGHDR-VERB2  PIC X(32).                              01155099
011560                                                                  01156099
011570 01  WS-TIMESTAMP              PIC X(26)  VALUE SPACES.           01157099
011580                                                                  01158099
011590 01  WS-DB2-TIMESTAMP.                                            01159099
011600     05  WS-DB2-DATE.                                             01160099
011700         10  WS-DB2-CEN        PIC X(02).                         01170099
011800         10  WS-DB2-YEAR       PIC X(02).                         01180099
011900         10  FILLER            PIC X(01).                         01190099
012000         10  WS-DB2-MTH        PIC X(02).                         01200099
012100         10  FILLER            PIC X(01).                         01210099
012200         10  WS-DB2-DAY        PIC X(02).                         01220099
012300     05  WS-DB2-TIME.                                             01230099
012400         10  FILLER            PIC X(01).                         01240099
012500         10  WS-DB2-HR         PIC X(02).                         01250099
012600         10  FILLER            PIC X(01).                         01260099
012700         10  WS-DB2-MIN        PIC X(02).                         01270099
012800         10  FILLER            PIC X(01).                         01280099
012900         10  WS-DB2-SEC        PIC X(02).                         01290099
013000         10  FILLER            PIC X(01).                         01300099
013100         10  WS-DB2-MICRO      PIC X(06).                         01310099
013200                                                                  01320099
013300 01  WS-TIMESTAMP-REFORMAT.                                       01330099
013400     05  WS-DAY                PIC X(02) VALUE ZEROS.             01340099
013500     05  FILLER                PIC X(01) VALUE SPACE.             01350099
013600     05  WS-MONTH              PIC X(03) VALUE SPACES.            01360099
013700     05  FILLER                PIC X(01) VALUE SPACE.             01370099
013800     05  WS-YEAR               PIC X(02) VALUE ZEROS.             01380099
013900     05  FILLER                PIC X(01) VALUE SPACE.             01390099
014000     05  WS-HOUR               PIC X(02) VALUE SPACES.            01400099
014100     05  WS-VERB-P1            PIC X(01) VALUE ':'.               01410099
014200     05  WS-MINUTE             PIC X(02) VALUE SpACES.            01420099
014300     05  WS-VERB-P2            PIC X(01) VALUE ':'.               01430099
014400     05  WS-SECOND             PIC X(02) VALUE SPACES.            01440099
014500     05  FILLER                PIC X(01) VALUE SPACE.             01450099
014600     05  WS-ZONE               PIC X(03) VALUE 'CDT'.             01460099
014700                                                                  01470099
014800 01  WS-EDIT-ENTID     PIC 9(10)  VALUE ZEROS.                    01480099
014900 01  WS-ENTID-REFORMAT REDEFINES                                  01490099
015000     WS-EDIT-ENTID     PIC X(10).                                 01500099
015100                                                                  01510099
015200 01  PV-PARAGRAPH-NAME         PIC X(30)  VALUE SPACES.           01520099
015300 01  PV-DB2-OPER-ATTEMPTED     PIC X(30)  VALUE SPACES.           01530099
015400                                                                  01540099
015500 01  WS-FILE-STATUS            PIC X(02)  VALUE SPACE.            01550099
015600     88  SUCCESSFUL-COMPLETION            VALUE '00'.             01560099
015700     88  FILE-NOT-FOUND                   VALUE '23'.             01570099
015800                                                                  01580099
015900 01  WS-REFORMAT-DATE.                                            01590099
016000     05  WS-REFDTE-CCYY          PIC X(04) VALUE SPACES.          01600099
016100     05  WS-REFDTE-p1            PIC X(01) VALUE SPACES.          01610099
016200     05  WS-REFDTE-MM            PIC X(02) VALUE SPACES.          01620099
016300     05  WS-REFDTE-p2            PIC X(01) VALUE SPACES.          01630099
016400     05  WS-REFDTE-DD            PIC X(02) VALUE SPACES.          01640099
016500                                                                  01650099
016600 01  NUMERIC-FIELD-AREA.                                          01660099
016700     05  WS-SUB                PIC S9(09) COMP VALUE ZEROS.       01670099
016800     05  MTH-NDX               PIC S9(09) COMP VALUE ZEROS.       01680099
016900     05  WS-EDIT-PO-NUMBER     PIC S9(09) COMP VALUE ZEROS.       01690099
017000                                                                  01700099
017100 01  SAVE-AREA.                                                   01710099
017200     05  WS-ENTID-SAVE        PIC S9(09) COMP VALUE ZEROS.        01720099
017300     05  WS-GS-CNTL-NBR-SAVE  PIC S9(9)V COMP-3 VALUE ZEROS.      01730099
017400     05  WS-TRN-DTL-TXT-SAVE  PIC X(30)  VALUE SPACES.            01740099
017500     05  WS-TRANS-DATE-SAVE   PIC X(10)  VALUE SPACES.            01750099
017600     05  WS-TP-DKEY-SAVE      PIC S9(09) COMP VALUE ZEROS.        01760099
017700     05  WS-TP-DKEY-TMST-SAVE PIC X(26)  VALUE SPACES.            01770099
017800     05  WS-FUNC-CDE-SEQ-SAVE PIC S9(09) COMP VALUE ZEROS.        01780099
017900     05  WS-TRN-SET-SEQ-SAVE  PIC S9(09) COMP VALUE ZEROS.        01790099
018000     05  WS-TRN-SET-CDE-SAVE  PIC X(3)   VALUE SPACES.            01800099
018100                                                                  01810099
018200 01  PROGRAM-SWITCHES.                                            01820099
018300     05  WS-ERROR-FOUND-SW     PIC X(01)  VALUE 'N'.              01830099
018400         88  ERRORS-FOUND                 VALUE 'Y'.              01840099
018500     05  END-OF-FILE-SW        PIC X(01)  VALUE 'N'.              01850099
018600         88  END-OF-FILE                  VALUE 'Y'.              01860099
018700     05  WS-FIRST-TIME-SW      PIC X(01)  VALUE 'N'.              01870099
018800         88  FIRST-TIME-THRU              VALUE 'N'.              01880099
018900         88  CONTINUED-PROCESSING         VALUE 'Y'.              01890099
019000     05  WS-PROCESSED-RECS-SW  PIC X(01)  VALUE 'N'.              01900099
019100         88  TEXT-PROCESSED               VALUE 'Y'.              01910099
019200                                                                  01920099
019300 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    01930099
019400     88 ABEND-4013                         VALUE +4013.           01940099
019500     88 ABEND-4095                         VALUE +4095.           01950099
019600                                                                  01960099
019700******************************************************************01970099
019800* SQLCA MESSAGE MODULE DSNTIAR ARGUMENTS......                    01980099
019900******************************************************************01990099
020000     COPY DPWS004.                                                02000099
020100                                                                  02010099
020200******************************************************************02020099
020300* NUMERIC EDIT LAYOUT ARGUMENTS.....                              02030099
020400******************************************************************02040099
020500     COPY DPWS010I.                                               02050099
020600                                                                  02060099
020700******************************************************************02070099
020800* TRADING PARTNER TABLE ARGUMENTS.....                            02080099
020900******************************************************************02090099
021000     EXEC SQL                                                     02100099
021100        INCLUDE TTRDPRT                                           02110099
021200     END-EXEC.                                                    02120099
021300                                                                  02130099
021400******************************************************************02140099
021500* TRADING PARTNER ENTERPRISE NAME ARGUMENTS....                   02150099
021600******************************************************************02160099
021700     EXEC SQL                                                     02170099
021800        INCLUDE TENTNME                                           02180099
021900     END-EXEC.                                                    02190099
022000                                                                  02200099
022100******************************************************************02210099
022200* FUNCTIONAL GROUP TRANSACTION TABLE ARGUMENTS...                 02220099
022300******************************************************************02230099
022400     EXEC SQL                                                     02240099
022500        INCLUDE TFGTRST                                           02250099
022600     END-EXEC.                                                    02260099
022700                                                                  02270099
022800******************************************************************02280099
022900* TRADING PARTNER FUNCTION GROUP CONTROL TABLE ARGUMENTS......    02290099
023000******************************************************************02300099
023100     EXEC SQL                                                     02310099
023200        INCLUDE TTRDFNC                                           02320099
023300     END-EXEC.                                                    02330099
023400                                                                  02340099
023500******************************************************************02350099
023600* PURCHASE ORDER SHIPMENT INFORMATION ARGUMENTS......             02360099
023700******************************************************************02370099
023800     EXEC SQL                                                     02380099
023900        INCLUDE TPLNSHP                                           02390099
024000     END-EXEC.                                                    02400099
024100                                                                  02410099
024200******************************************************************02420099
024300* TRADING PARTNER DUPLICATE MASTER LISTING TABLE ARGUMENTS.       02430099
024400******************************************************************02440099
024500     EXEC SQL                                                     02450099
024600        INCLUDE TTRDMLT                                           02460099
024700     END-EXEC.                                                    02470099
024800                                                                  02480099
024900******************************************************************02490099
025000* TRADING PARTNER TRANSACTION SET TABLE ARGUMENTS.                02500099
025100******************************************************************02510099
025200     EXEC SQL                                                     02520099
025300        INCLUDE TTRDTRN                                           02530099
025400     END-EXEC.                                                    02540099
025500                                                                  02550099
025600******************************************************************02560099
025700* DB2 ERROR HANDLING ARGUMENTS....                                02570099
025800******************************************************************02580099
025900     EXEC SQL                                                     02590099
026000        INCLUDE SQLCA                                             02600099
026100     END-EXEC.                                                    02610099
026200                                                                  02620099
026300******************************************************************02630099
026400* TABLE CURSOR FOR THE TRADING PARTNER FUNCTIONAL CONTROL GROUP.  02640099
026500******************************************************************02650099
026600     EXEC SQL                                                     02660099
026700         DECLARE TRDFNC_CURSOR CURSOR FOR                         02670099
026800            SELECT DISTINCT                                       02680099
026900                 A.TP_DKEY,                                       02690099
027000                 A.FUNC_CDE,                                      02700099
027100                 TRAN_SET_CDE,                                    02710099
027200                 PROD_TEST_IND,                                   02720099
027300                 B.INACTV_DTE,                                    02730099
027400                 C.ENT_ID,                                        02740099
027500                 C.VEND_INCHG_ID,                                 02750099
027600                 C.VEND_INCHG_ID_DESC                             02760099
027700            FROM TTRDFNC A,                                       02770099
027800                 TTRDTRN B,                                       02780099
027900                 TTRDPRT C                                        02790099
028000            WHERE C.ENT_ID = :TRDPRT-ENT-ID                       02800099
028100              AND C.TP_DKEY = B.TP_DKEY                           02810099
028200              AND C.TP_DKEY = A.TP_DKEY                           02820099
028300              AND A.FUNC_CDE = 'TX'                               02830099
028400              AND TRAN_SET_CDE = '864'                            02840099
028500              AND PROD_TEST_IND = 'P'                             02850099
028600              AND B.INACTV_DTE = '9999-09-09'                     02860099
028700              AND C.INACTV_DTE = '9999-09-09'                     02870099
028800     END-EXEC.                                                    02880099
028900                                                                  02890099
029000******************************************************************02900099
029100* TABLE CURSOR FOR DOCUMENT 864 MESSAGE TEXT INFORMATION......    02910099
029200******************************************************************02920099
029300     EXEC SQL                                                     02930099
029400         DECLARE TRDPRT_CURSOR CURSOR FOR                         02940099
029500           SELECT DISTINCT                                        02950099
029600               A.ENT_NAME_DESC,                                   02960099
029700               B.ENT_ID,                                          02970099
029800               C.FUNC_CDE_CNTL_NBR,                               02980099
029900               C.TRN_SET_CDE,                                     02990099
030000               C.VEND_ACK_IND,                                    03000099
030100               C.TP_DKEY,                                         03010099
030200               C.TP_DKEY_TMST,                                    03020099
030300               C.TRN_DTL_TXT,                                     03030099
030400               C.FUNC_CDE_SEQ_NBR,                                03040099
030500               C.TRN_SET_SEQ_NBR,                                 03050099
030600               C.PO_ACKNL_STAT_CDE                                03060099
030700           FROM TENTNME A,                                        03070099
030800                TTRDPRT B,                                        03080099
030900                TFGTRST C                                         03090099
031000           WHERE B.INACTV_DTE = '9999-09-09'                      03100099
031100             AND A.ENT_ID = B.ENT_ID                              03110099
031200             AND A.TYPE_CDE = '01'                                03120099
031300             AND B.TP_DKEY = C.TP_DKEY                            03130099
031400               AND C.VEND_ACK_IND = 'N'                           03140099
031500               AND (C.TRN_SET_CDE = '850' OR                      03150099
031600                    C.TRN_SET_CDE = '860')                        03160099
031700               AND C.TP_DKEY_TMST BETWEEN                         03170099
031800                   TIMESTAMP(CHAR(CURRENT DATE - 6 DAYS) ||       03180099
031801                   '-00.00.00.000000')  AND                       03180199
031802                   TIMESTAMP(CHAR(CURRENT DATE - 5 DAYS) ||       03180299
031803                   '-23.59.59.999999')                            03180399
031804               AND C.PO_ACKNL_STAT_CDE IN ('E', 'T')              03180499
031805             ORDER BY B.ENT_ID,                                   03180599
031806                      C.TRN_SET_CDE,                              03180699
031807                      C.FUNC_CDE_CNTL_NBR,                        03180799
031808                      C.TRN_DTL_TXT                               03180899
031809     END-EXEC.                                                    03180999
031810                                                                  03181099
031811******************************************************************03181199
031812* SQL ERROR HANDLING ARGUMENTS.......                             03181299
031813******************************************************************03181399
031814     COPY SQLCA2.                                                 03181499
031815                                                                  03181599
031816******************************************************************03181699
031817*FLOW:    THE MODULE SEQUENTIALLY READS THE TRADING PARTNER CURSOR03181799
031818*      LOOKING FOR DISTINCT PURCHASE ORDERS WHERE A FUNCTIONAL    03181899
031819*      ACKNOWLEDGEMENT HAS NOT BEEN RECEIVED IN THE LAST 6 DAYS.  03181999
031820*      THE CURSOR INCLUDES THE FOLLOWING TABLES.                  03182099
031830*               TTRDPRT - TTRADING PARTNER TABLE.                 03183099
031840*               TENTNME - ENT ID NAME TABLE.                      03184099
031850*               TFGTRST - TRANSACTION STATUS TABLE.               03185099
031860*      INFORMATION IS SORTED BY ENT ID, GS CONTROL NUMBER, AND PO 03186099
031870*      NUMBER.                                                    03187099
031880*                                                                 03188099
031890*         GENERATE THE FUNCTIONAL ACKNOWLEDGEMENT EXTRACT RECORDS 03189099
031900*      FOR THE TRADING PARTNER.                                   03190099
032000*               TTRDFNC - TRADING PARTNER FINCTIONAL GROUP TABLE. 03200099
032100*               TFGTRST - TRANSACTION STATUS TABLE.               03210099
032200*                                                                 03220099
032300*         THIS EMAIL IS A FOLLOWUP SENT TO MIO 2 DAYS AFTER THE   03230099
032400*      864 OR MISSING FUNCTIONAL ACKNOWLEDGEMTN EMAIL ARE SENT TO 03240099
032500*      THE TRADING PARTNER.                                       03250099
032600*                                                                 03260099
032700*         CHECK FOR A PARENT/CHILD RELATIONSHIP BY COMPARING THE  03270099
032800*      INTERCHANGE ID ON THE TRADING PARTNER TABLE WITH THE ID    03280099
032900*      ON THE TRADING PARTNER DUPLICATE MASTER TABLE. THE CHECK   03290099
033000*      AIDS IN ELIMINATING MULTIPLE 864 DOCUMENTS GOING TO A      03300099
033100*      TRADING PARTNER WHICH SHARES THEIR ID WITH MULTIPLE VENDORS03310099
033200*               TTRDMLT - TRADING PARTNER DUPLICATE MASTER LIST.  03320099
033300*                                                                 03330099
033400*         HARD ERRORS OCCUR ON THE OPENS AND CLOSES OF THE TABLE  03340099
033500*      CURSORS. ABEND THE MODULE. (ERROR STATUS 4013)             03350099
033600*                                                                 03360099
033700******************************************************************03370099
033800 PROCEDURE DIVISION.                                              03380099
033900******************************************************************03390099
034000 0000-MAINLINE-DRIVER-SECTION.                                    03400099
034100                                                                  03410099
034200     PERFORM 0100-INITIALIZATION                                  03420099
034300        THRU 0100-INITIALIZATION-EXIT.                            03430099
034400                                                                  03440099
034500     PERFORM 1000-PROCESS-FILE                                    03450099
034600        THRU 1000-PROCESS-FILE-EXIT                               03460099
034700           UNTIL END-OF-FILE.                                     03470099
034800                                                                  03480099
034900     PERFORM 9000-END-OF-JOB-TASKS                                03490099
035000        THRU 9000-END-OF-JOB-TASKS-EXIT.                          03500099
035100                                                                  03510099
035200 9999-EXIT-PROGRAM.                                               03520099
035300     STOP RUN.                                                    03530099
035400                                                                  03540099
035500******************************************************************03550099
035600* 0100-INITIALIZATION....                                         03560099
035700******************************************************************03570099
035800 0100-INITIALIZATION.                                             03580099
035900                                                                  03590099
036000     OPEN OUTPUT PO-OUTPUT-FILE.                                  03600099
036100                                                                  03610099
036200     EXEC SQL                                                     03620099
036300         OPEN TRDPRT_CURSOR                                       03630099
036400     END-EXEC.                                                    03640099
036500                                                                  03650099
036600     EVALUATE TRUE                                                03660099
036700       WHEN SQLCODE IS EQUAL TO ZERO                              03670099
036800         CONTINUE                                                 03680099
036900       WHEN SQLWARN IS NOT EQUAL TO SPACES                        03690099
037000       WHEN SQLCODE IS NOT EQUAL TO ZERO                          03700099
037100        MOVE '0100-INITIALZATION' TO PV-PARAGRAPH-NAME            03710099
037200        MOVE 'OPEN CURSOR' TO PV-DB2-OPER-ATTEMPTED               03720099
037300        PERFORM 9900-SQL-ERROR                                    03730099
037400     END-EVALUATE.                                                03740099
037500                                                                  03750099
037600     MOVE ZEROS            TO WS-SUB.                             03760099
037700     MOVE 'N'              TO END-OF-FILE-SW.                     03770099
037800     MOVE 'N'              TO WS-FIRST-TIME-SW.                   03780099
037900     MOVE 'N'              TO WS-PROCESSED-RECS-SW.               03790099
038000                                                                  03800099
038100 0100-INITIALIZATION-EXIT.                                        03810099
038200     EXIT.                                                        03820099
038300                                                                  03830099
038400******************************************************************03840099
038500* 1000-PROCESS FILE...                                            03850099
038600*   THE ROUTINE OPENS THE CURSOR FOR TABLES TTRDPRT, TFGTRST, AND 03860099
038700*   TENTNME. THE CRITERIA FOR CONTINUED PROCESSING ICLUDE THE     03870099
038800*   FOLLOWING.                                                    03880099
038900*                                                                 03890099
039000*   1. ACTIVE TRADING PARTNER                                     03900099
039100*   2. TYPE CODE IS EQUAL TO '01'                                 03910099
039200*   3. NO FUNCTIONAL ACKNOWLEDGEMENT HAS BEEN SENT FOR THE PO     03920099
039300*   4. THE PO IS 6 DAYS OLD AND WE HAVE NOT RECEIVED THE FA YET.  03930099
039400******************************************************************03940099
039500 1000-PROCESS-FILE.                                               03950099
039600                                                                  03960099
039700     EXEC SQL                                                     03970099
039800         FETCH TRDPRT_CURSOR                                      03980099
039900         INTO :ENTNME-ENT-NAME-DESC,                              03990099
040000              :TRDPRT-ENT-ID,                                     04000099
040100              :FGTRST-FUNC-CDE-CNTL-NBR,                          04010099
040200              :FGTRST-TRN-SET-CDE,                                04020099
040300              :FGTRST-VEND-ACK-IND,                               04030099
040400              :FGTRST-TP-DKEY,                                    04040099
040500              :FGTRST-TP-DKEY-TMST,                               04050099
040600              :FGTRST-TRN-DTL-TXT,                                04060099
040700              :FGTRST-FUNC-CDE-SEQ-NBR,                           04070099
040800              :FGTRST-TRN-SET-SEQ-NBR                             04080099
040900     END-EXEC.                                                    04090099
041000                                                                  04100099
041100     EVALUATE TRUE                                                04110099
041200       WHEN SQLCODE IS EQUAL TO ZERO                              04120099
041300         PERFORM 2000-GENERATE-864                                04130099
041400            THRU 2000-GENERATE-864-EXIT                           04140099
041500       WHEN SQLCODE IS EQUAL TO +100                              04150099
041600         MOVE 'Y' TO END-OF-FILE-SW                               04160099
041700       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04170099
041800       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04180099
041900         MOVE '1000-PROCESS-FILE' TO PV-PARAGRAPH-NAME            04190099
042000         MOVE 'FETCH TRDPRT' TO PV-DB2-OPER-ATTEMPTED             04200099
042100         MOVE 'Y' TO END-OF-FILE-SW                               04210099
042200         PERFORM 9900-SQL-ERROR                                   04220099
042300     END-EVALUATE.                                                04230099
042400                                                                  04240099
042500 1000-PROCESS-FILE-EXIT.                                          04250099
042600     EXIT.                                                        04260099
042700                                                                  04270099
042800******************************************************************04280099
042900* 2000-GENERATE THE 864.....                                      04290099
043000*   THE ROUTINE OPENS THE CURSOR FOR TABLE TTRDFNC AND CALL THE   04300099
043100*   CURSOR PROCESS MODULE 3000-PROCESS-CURSOR. THE ROUTINE CHECKS 04310099
043200*   TO SEE IF THE VENDOR IS ABLE TO ACCEPT AUTOMATED TEXT         04320099
043300*   MESSAGES. (DOCUMENT 864)                                      04330099
043400******************************************************************04340099
043500 2000-GENERATE-864.                                               04350099
043600                                                                  04360099
043700     EXEC SQL                                                     04370099
043800         OPEN TRDFNC_CURSOR                                       04380099
043900     END-EXEC.                                                    04390099
044000                                                                  04400099
044100     EVALUATE TRUE                                                04410099
044200       WHEN SQLCODE IS EQUAL TO ZERO                              04420099
044300         CONTINUE                                                 04430099
044400       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04440099
044500       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04450099
044600        MOVE '2000-GENERATE-864' TO PV-PARAGRAPH-NAME             04460099
044700        MOVE 'OPEN CURSOR' TO PV-DB2-OPER-ATTEMPTED               04470099
044800        MOVE 'Y' TO END-OF-FILE-SW                                04480099
044900        PERFORM 9900-SQL-ERROR                                    04490099
045000     END-EVALUATE.                                                04500099
045100                                                                  04510099
045200     PERFORM 3000-PROCESS-CURSOR                                  04520099
045300        THRU 3000-PROCESS-CURSOR-EXIT.                            04530099
045400                                                                  04540099
045500     EXEC SQL                                                     04550099
045600         CLOSE TRDFNC_CURSOR                                      04560099
045700     END-EXEC.                                                    04570099
045800                                                                  04580099
045900     EVALUATE TRUE                                                04590099
046000       WHEN SQLCODE IS EQUAL TO ZERO                              04600099
046100         CONTINUE                                                 04610099
046200       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04620099
046300       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04630099
046400        MOVE '2000-GENERATE-864' TO PV-PARAGRAPH-NAME             04640099
046500        MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED              04650099
046600        MOVE 'Y' TO END-OF-FILE-SW                                04660099
046700        PERFORM 9900-SQL-ERROR                                    04670099
046800     END-EVALUATE.                                                04680099
046900                                                                  04690099
047000 2000-GENERATE-864-EXIT.                                          04700099
047100     EXIT.                                                        04710099
047200                                                                  04720099
047300******************************************************************04730099
047400* 3000-PROCESS THE CURSOR FOR TABLE TTRDFNC FOR THE ENT-ID.....   04740099
047500*   THE ROUTINE CHECKS THE TTRDFNC TABLE TO SEE IF THE VENDOR     04750099
047600*   SETUP TO ACCEPT DOCUMENT 864 - TEXT MESSAGES. THE FUNCTION    04760099
047700*   CODE MUST BE A "TX" AND A SUCCESS FETCH HAS TO BE PERFORMED   04770099
047800*   BEFORE THE EXTRACT IS PERFORMED.                              04780099
047900*                                                                 04790099
048000*   IF A ROW IS NOT FOUND, WRITE TO THE THE "DOCUMENT 864 NOT     04800099
048100*   GENERATED REPORT".                                            04810099
048200*                                                                 04820099
048300*   IF A PROBLEM OCCURS, ERROR THE SELECT AND END THE PROGRAM.    04830099
048400******************************************************************04840099
048500 3000-PROCESS-CURSOR.                                             04850099
048600                                                                  04860099
048700     EXEC SQL                                                     04870099
048800         FETCH TRDFNC_CURSOR                                      04880099
048900         INTO :TRDFNC-TP-DKEY,                                    04890099
049000              :TRDFNC-FUNC-CDE,                                   04900099
049100              :TRDTRN-TRAN-SET-CDE,                               04910099
049200              :TRDTRN-PROD-TEST-IND,                              04920099
049300              :TRDTRN-INACTV-DTE,                                 04930099
049400              :TRDPRT-ENT-ID,                                     04940099
049500              :TRDPRT-VEND-INCHG-ID,                              04950099
049600              :TRDPRT-VEND-INCHG-ID-DESC                          04960099
049700     END-EXEC.                                                    04970099
049800                                                                  04980099
049900     EVALUATE TRUE                                                04990099
050000       WHEN SQLCODE IS EQUAL TO ZERO                              05000099
050100         PERFORM 3100-GENERATE-FUNC-ACK                           05010099
050200            THRU 3100-GENERATE-FUNC-ACK-EXIT                      05020099
050300       WHEN SQLCODE IS EQUAL TO +100                              05030099
050400         PERFORM 3100-GENERATE-FUNC-ACK                           05040099
050500            THRU 3100-GENERATE-FUNC-ACK-EXIT                      05050099
050600       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05060099
050700       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05070099
050800        MOVE 'Y' TO END-OF-FILE-SW                                05080099
050900        MOVE '3000-PROCESS-CURSOR' TO PV-PARAGRAPH-NAME           05090099
051000        MOVE 'FETCH CURSOR' TO PV-DB2-OPER-ATTEMPTED              05100099
051100        PERFORM 9900-SQL-ERROR                                    05110099
051200     END-EVALUATE.                                                05120099
051300                                                                  05130099
051400 3000-PROCESS-CURSOR-EXIT.                                        05140099
051500     EXIT.                                                        05150099
051600                                                                  05160099
051700******************************************************************05170099
051800* 3100-GENERATE A FUNCTIONAL ACKNOWLEDGEMENT....                  05180099
051900******************************************************************05190099
052000 3100-GENERATE-FUNC-ACK.                                          05200099
052100***   TEST FOR A PARENT/CHILD RELATIONSHIP. WE ONLY WANT TO SEND  05210099
052200*** ONE EMAIL PER ENT ID. NO DUPLICATES OF THE SAME TO THE SAME   05220099
052300*** VENDOR. THE FOLLOWING SCENARIOS HOLD TO FOR 864 GENERATION.   05230099
052400***                                                               05240099
052500***   SCENARIOS.                                                  05250099
052600***   1.  IF THE INTERCHANGE ID IS NOT ON TTRDMLT, SEND THE 864 AS05260099
052700***       IS TO THE TRADING PARTNER.                              05270099
052800***   2.  IF THE INTERCHANGE ID IS ON TTRDMLT AND THE ENTIDS MATCH05280099
052900***       BETWEEN TTRDPRT AND TTRDMLT, SEND THE 864 AS IS TO THE  05290099
053000***       TRADING PARTNER.                                        05300099
053100***   3.  IF THE INTERCHANGE ID IS ON TTRDMLT AND THE ENTIDS DO   05310099
053200***       NOT MATCH BETWEEN TTRDPRT AND TTRDMLT, DO NOT SEND THE  05320099
053300***       864 TO THE TRADING PARTNER.                             05330099
053400***                                                               05340099
053500                                                                  05350099
053600     EXEC SQL                                                     05360099
053700       SELECT PRNT_ENT_ID                                         05370099
053800         INTO :TRDMLT-PRNT-ENT-ID                                 05380099
053900       FROM TTRDMLT                                               05390099
054000       WHERE VND_INCHG_ID = :TRDPRT-VEND-INCHG-ID                 05400099
054100         AND VND_INCHG_ID_DESC = :TRDPRT-VEND-INCHG-ID-DESC       05410099
054200     END-EXEC.                                                    05420099
054300                                                                  05430099
054400     EVALUATE TRUE                                                05440099
054500       WHEN SQLCODE IS EQUAL TO ZERO                              05450099
054600         CONTINUE                                                 05460099
054700       WHEN SQLCODE IS EQUAL TO +100                              05470099
054800         GO TO 3100-GEN-FUNC-ACK-CONTINUE                         05480099
054900       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05490099
055000       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05500099
055100         DISPLAY SPACES                                           05510099
055200         DISPLAY 'UNABLE TO LOCATE TTRDMLT TABLE ENTRY - ETKUP049'05520099
055300         DISPLAY 'VEND_INCHG_ID_DESC = ' TRDPRT-VEND-INCHG-ID-DESC05530099
055400         DISPLAY 'VEND_INCHG_ID = ' TRDPRT-VEND-INCHG-ID          05540099
055500         DISPLAY 'ENT_ID = ' TRDPRT-ENT-ID                        05550099
055600         DISPLAY 'SQLCODE = ' SQLCODE                             05560099
055700         MOVE '3100-GEN-FUNC-ACK' TO PV-PARAGRAPH-NAME            05570099
055800         MOVE 'SLECT TRDMLT' TO PV-DB2-OPER-ATTEMPTED             05580099
055900         MOVE 'Y' TO END-OF-FILE-SW                               05590099
056000         PERFORM 9900-SQL-ERROR                                   05600099
056100         GO TO 3100-GENERATE-FUNC-ACK-EXIT                        05610099
056200     END-EVALUATE.                                                05620099
056300                                                                  05630099
056400     IF TRDMLT-PRNT-ENT-ID IS NOT EQUAL TO TRDPRT-ENT-ID          05640099
056500         PERFORM 5300-UPD-TFGTRST-STATUS                          05650099
056600            THRU 5300-UPD-TFGTRST-STATUS-EXIT                     05660099
056700         GO TO 3100-GENERATE-FUNC-ACK-EXIT.                       05670099
056800                                                                  05680099
056900 3100-GEN-FUNC-ACK-CONTINUE.                                      05690099
057000***   PRIME THE CONTROL BREAKS FOR TEXT MESSAGE PROCESSING AND    05700099
057100*** BEGIN TO GENERATE THE FIRST DOCUMENT....                      05710099
057200                                                                  05720099
057300     IF FIRST-TIME-THRU                                           05730099
057400       MOVE TRDPRT-ENT-ID            TO WS-ENTID-SAVE             05740099
057500       MOVE FGTRST-FUNC-CDE-CNTL-NBR TO WS-GS-CNTL-NBR-SAVE       05750099
057600       MOVE FGTRST-FUNC-CDE-SEQ-NBR  TO WS-FUNC-CDE-SEQ-SAVE      05760099
057700       MOVE FGTRST-TRN-SET-SEQ-NBR   TO WS-TRN-SET-SEQ-SAVE       05770099
057800       MOVE FGTRST-TRN-DTL-TXT       TO WS-TRN-DTL-TXT-SAVE       05780099
057900       MOVE FGTRST-TRN-SET-CDE       TO WS-TRN-SET-CDE-SAVE       05790099
058000       MOVE FGTRST-TP-DKEY-TMST      TO WS-TRANS-DATE-SAVE        05800099
058100       MOVE FGTRST-TP-DKEY           TO WS-TP-DKEY-SAVE           05810099
058200       MOVE FGTRST-TP-DKEY-TMST      TO WS-TP-DKEY-TMST-SAVE      05820099
058300       PERFORM 4000-EMAIL-HEADER                                  05830099
058400          THRU 4000-EMAIL-HEADER-EXIT                             05840099
058500       MOVE ZEROS         TO WS-SUB                               05850099
058600       PERFORM 4200-EMAIL-VERB                                    05860099
058700          THRU 4200-EMAIL-VERB-EXIT                               05870099
058800            VARYING WS-SUB FROM 1 BY 1                            05880099
058900            UNTIL WS-SUB IS GREATER THAN 2                        05890099
059000       PERFORM 4400-EMAIL-PO                                      05900099
059100          THRU 4400-EMAIL-PO-EXIT                                 05910099
059200       MOVE 'Y'                      TO WS-FIRST-TIME-SW.         05920099
059300                                                                  05930099
059400***   CONTROL BREAK PROCESSING...                                 05940099
059500*** 1.  TRDPRT-ENT-ID (TRADING PARTNER ENTITY ID)                 05950099
059600*** 2.  FGTRST-FUNC-CDE-CNTL-NBR (FUNCTIONAL GROUP)               05960099
059700*** 3.  FGTRST-TRN-DTL-TXT (PURCHASE ORDER NUMBER)                05970099
059800*** 4.  FGTRST-TP-DKEY (TP DKEY)                                  05980099
059900*** 5.  FGTRST-TP-DKEY-TMST (TP DKEY TIMESTAMP)                   05990099
060000                                                                  06000099
060100     IF (TRDPRT-ENT-ID EQUAL WS-ENTID-SAVE AND                    06010099
060110         FGTRST-TRN-SET-CDE = WS-TRN-SET-CDE-SAVE)                06011099
060120       IF FGTRST-FUNC-CDE-CNTL-NBR EQUAL WS-GS-CNTL-NBR-SAVE      06012099
060130         IF FGTRST-TRN-DTL-TXT EQUAL WS-TRN-DTL-TXT-SAVE          06013099
060140           IF FGTRST-TP-DKEY EQUAL WS-TP-DKEY-SAVE                06014099
060150             IF FGTRST-TP-DKEY-TMST EQUAL WS-TP-DKEY-TMST-SAVE    06015099
060160               NEXT SENTENCE                                      06016099
060170             ELSE                                                 06017099
060180               MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                06018099
060190               MOVE FGTRST-FUNC-CDE-CNTL-NBR                      06019099
060200                                    TO WS-GS-CNTL-NBR-SAVE        06020099
060300               MOVE FGTRST-FUNC-CDE-SEQ-NBR                       06030099
060400                                    TO WS-FUNC-CDE-SEQ-SAVE       06040099
060500               MOVE FGTRST-TRN-SET-SEQ-NBR TO WS-TRN-SET-SEQ-SAVE 06050099
060600               MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE     06060099
060700               MOVE FGTRST-TRN-DTL-TXT TO WS-TRN-DTL-TXT-SAVE     06070099
060800               MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE     06080099
060900               MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE             06090099
061000               MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE   06100099
061100               PERFORM 4400-EMAIL-PO                              06110099
061200                  THRU 4400-EMAIL-PO-EXIT                         06120099
061300           ELSE                                                   06130099
061400             MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                  06140099
061500             MOVE FGTRST-FUNC-CDE-CNTL-NBR                        06150099
061600                                    TO WS-GS-CNTL-NBR-SAVE        06160099
061700             MOVE FGTRST-FUNC-CDE-SEQ-NBR                         06170099
061800                                    TO WS-FUNC-CDE-SEQ-SAVE       06180099
061900             MOVE FGTRST-TRN-SET-SEQ-NBR TO WS-TRN-SET-SEQ-SAVE   06190099
062000             MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE       06200099
062100             MOVE FGTRST-TRN-DTL-TXT TO WS-TRN-DTL-TXT-SAVE       06210099
062200             MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE       06220099
062300             MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE               06230099
062400             MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE     06240099
062500             PERFORM 4400-EMAIL-PO                                06250099
062600                THRU 4400-EMAIL-PO-EXIT                           06260099
062700         ELSE                                                     06270099
062800           MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                    06280099
062900           MOVE FGTRST-FUNC-CDE-CNTL-NBR                          06290099
063000                                    TO WS-GS-CNTL-NBR-SAVE        06300099
063100           MOVE FGTRST-FUNC-CDE-SEQ-NBR                           06310099
063200                                    TO WS-FUNC-CDE-SEQ-SAVE       06320099
063300           MOVE FGTRST-TRN-SET-SEQ-NBR TO WS-TRN-SET-SEQ-SAVE     06330099
063400           MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE         06340099
063500           MOVE FGTRST-TRN-DTL-TXT TO WS-TRN-DTL-TXT-SAVE         06350099
063600           MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE         06360099
063700           MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE                 06370099
063800           MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE       06380099
063900           PERFORM 4400-EMAIL-PO                                  06390099
064000              THRU 4400-EMAIL-PO-EXIT                             06400099
064100       ELSE                                                       06410099
064200         MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                      06420099
064300         MOVE FGTRST-FUNC-CDE-CNTL-NBR                            06430099
064400                                    TO WS-GS-CNTL-NBR-SAVE        06440099
064500         MOVE FGTRST-FUNC-CDE-SEQ-NBR                             06450099
064600                                    TO WS-FUNC-CDE-SEQ-SAVE       06460099
064700         MOVE FGTRST-TRN-SET-SEQ-NBR TO WS-TRN-SET-SEQ-SAVE       06470099
064800         MOVE FGTRST-TRN-SET-CDE TO WS-TRN-SET-CDE-SAVE           06480099
064900         MOVE FGTRST-TRN-DTL-TXT TO WS-TRN-DTL-TXT-SAVE           06490099
065000         MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE           06500099
065100         MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE                   06510099
065200         MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE         06520099
065300         PERFORM 4400-EMAIL-PO                                    06530099
065400            THRU 4400-EMAIL-PO-EXIT                               06540099
065500     ELSE                                                         06550099
065600       MOVE ZEROS         TO WS-SUB                               06560099
065700       PERFORM 4200-EMAIL-VERB                                    06570099
065800          THRU 4200-EMAIL-VERB-EXIT                               06580099
065900            VARYING WS-SUB FROM 4 BY 1                            06590099
066000            UNTIL WS-SUB IS GREATER THAN 10                       06600099
066100       MOVE SPACES                   TO EMAIL-LINE-1              06610099
066200       WRITE PO-EMAIL-RECORD         FROM EMAIL-LINE-1            06620099
066300       MOVE TRDPRT-ENT-ID TO WS-ENTID-SAVE                        06630099
066400       MOVE FGTRST-FUNC-CDE-CNTL-NBR TO WS-GS-CNTL-NBR-SAVE       06640099
066500       MOVE FGTRST-FUNC-CDE-SEQ-NBR TO WS-FUNC-CDE-SEQ-SAVE       06650099
066600       MOVE FGTRST-TRN-SET-SEQ-NBR TO WS-TRN-SET-SEQ-SAVE         06660099
066700       MOVE FGTRST-TRN-SET-CDE       TO WS-TRN-SET-CDE-SAVE       06670099
066800       MOVE FGTRST-TRN-DTL-TXT TO WS-TRN-DTL-TXT-SAVE             06680099
066900       MOVE FGTRST-TP-DKEY-TMST TO WS-TRANS-DATE-SAVE             06690099
067000       MOVE FGTRST-TP-DKEY TO WS-TP-DKEY-SAVE                     06700099
067100       MOVE FGTRST-TP-DKEY-TMST TO WS-TP-DKEY-TMST-SAVE           06710099
067200       PERFORM 4000-EMAIL-HEADER                                  06720099
067300          THRU 4000-EMAIL-HEADER-EXIT                             06730099
067400       MOVE ZEROS         TO WS-SUB                               06740099
067500       PERFORM 4200-EMAIL-VERB                                    06750099
067600          THRU 4200-EMAIL-VERB-EXIT                               06760099
067700            VARYING WS-SUB FROM 1 BY 1                            06770099
067800            UNTIL WS-SUB IS GREATER THAN 2                        06780099
067900       PERFORM 4400-EMAIL-PO                                      06790099
068000          THRU 4400-EMAIL-PO-EXIT                                 06800099
068100     END-IF.                                                      06810099
068200                                                                  06820099
068300     MOVE 'Y'                 TO WS-PROCESSED-RECS-SW.            06830099
068400                                                                  06840099
068500 3100-GENERATE-FUNC-ACK-EXIT.                                     06850099
068600     EXIT.                                                        06860099
068700                                                                  06870099
068800******************************************************************06880099
068900* 4000-EMAIL HEADER INFORMATION...                                06890099
069000******************************************************************06900099
069100 4000-EMAIL-HEADER.                                               06910099
069200*** RFC822 - EMAIL HEADER.....                                    06920099
069300                                                                  06930099
069400     MOVE SPACES           TO EMAIL-LINE-1.                       06940099
069500     STRING 'helo' DELIMITED BY SIZE                              06950099
069600            ' ' DELIMITED BY SIZE                                 06960099
069700            'KOHLS' DELIMITED BY SIZE                             06970099
069800                           INTO EL1-VERBIAGE.                     06980099
069900     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     06990099
070000                                                                  07000099
070100*** RFC822 - MAIL FROM...                                         07010099
070200                                                                  07020099
070300     MOVE SPACES           TO EMAIL-LINE-1.                       07030099
070400     STRING 'mail from:' DELIMITED BY SIZE                        07040099
070500            '<' DELIMITED BY SIZE                                 07050099
070600            'IS-EDI@KOHLS.COM' DELIMITED BY SIZE                  07060099
070700            '>' DELIMITED BY SIZE                                 07070099
070800                           INTO EL1-VERBIAGE.                     07080099
070900     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07090099
071000                                                                  07100099
071100*** RFC822 - RCPT FROM...                                         07110099
071200                                                                  07120099
071300     MOVE SPACES           TO EMAIL-LINE-1.                       07130099
071400     STRING 'rcpt to:' DELIMITED BY SIZE                          07140099
071500            '<' DELIMITED BY SIZE                                 07150099
071600            'EDIMIO@KOHLS.COM' DELIMITED BY SIZE                  07160099
071700            '>' DELIMITED BY SIZE                                 07170099
071800                           INTO EL1-VERBIAGE.                     07180099
071900     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07190099
072000                                                                  07200099
072100*** RFC822 - RCPT FROM (CC: - carbon copy) same as rcpt to:.... 07210099
072200*                                                                 07220099
072300*    MOVE SPACES           TO EMAIL-LINE-1.                       07230099
072400*    STRING 'rcpt to:' DELIMITED BY SIZE                          07240099
072500*           '<' DELIMITED BY SIZE                                 07250099
072600*           'ROD.JANSSEN@KOHLS.COM' DELIMITED BY SIZE             07260099
072700*           '>' DELIMITED BY SIZE                                 07270099
072800*                          INTO EL1-VERBIAGE.                     07280099
072900*    WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07290099
073000*                                                                 07300099
073100*** RFC822 - DATA...                                              07310099
073200                                                                  07320099
073300     MOVE SPACES           TO EMAIL-LINE-1.                       07330099
073400     MOVE 'data'           TO EL1-VERBIAGE.                       07340099
073500     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07350099
073600                                                                  07360099
073700*** EMAIL - DATE LINE...                                          07370099
073800                                                                  07380099
073900     PERFORM 5100-CALC-DTE-ROUTINE                                07390099
074000        THRU 5100-CALC-DTE-ROUTINE-EXIT.                          07400099
074100                                                                  07410099
074200     MOVE SPACES           TO EMAIL-LINE-1.                       07420099
074300     STRING 'Date:     ' DELIMITED BY SIZE                        07430099
074400            WS-TIMESTAMP-REFORMAT DELIMITED BY SIZE               07440099
074500                           INTO EL1-VERBIAGE.                     07450099
074600     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07460099
074700                                                                  07470099
074800*** EMAIL - FROM LINE..                                           07480099
074900                                                                  07490099
075000     MOVE SPACES           TO EMAIL-LINE-1.                       07500099
075100     STRING 'From:     ' DELIMITED BY SIZE                        07510099
075200            'IS-EDI@KOHLS.COM' DELIMITED BY SIZE                  07520099
075300                           INTO EL1-VERBIAGE.                     07530099
075400     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07540099
075500                                                                  07550099
075600*** EMAIL - TO LINE..                                             07560099
075700                                                                  07570099
075800     MOVE SPACES           TO EMAIL-LINE-1.                       07580099
075900     STRING 'To:       ' DELIMITED BY SIZE                        07590099
076000            'EDIMIO@KOHLS.COM' DELIMITED BY SIZE                  07600099
076100                           INTO EL1-VERBIAGE.                     07610099
076200     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07620099
076300                                                                  07630099
076400*** EMAIL - CC LINE(S)...                                         07640099
076500*                                                                 07650099
076600*    MOVE SPACES           TO EMAIL-LINE-1.                       07660099
076700*    STRING 'Cc:       ' DELIMITED BY SIZE                        07670099
076800*           'ROD.JANSSEN@KOHLS.COM' DELIMITED BY SIZE             07680099
076900*                          INTO EL1-VERBIAGE.                     07690099
077000*    WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07700099
077100*                                                                 07710099
077200*** EMAIL - SUBJECT LINE...                                       07720099
077300                                                                  07730099
077400     MOVE SPACES           TO EMAIL-LINE-1.                       07740099
077500     STRING 'Subject:  ' DELIMITED BY SIZE                        07750099
077600            'Missing 997 (SECOND REQUEST)' DELIMITED BY SIZE      07760099
077700            ' - ' DELIMITED BY SIZE                               07770099
077800            ENTNME-ENT-NAME-DESC DELIMITED BY SIZE                07780099
077900                           INTO EL1-VERBIAGE.                     07790099
078000     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07800099
078100                                                                  07810099
078200*** EMAIL BREAK....                                               07820099
078300                                                                  07830099
078400     MOVE SPACES           TO EMAIL-LINE-1.                       07840099
078500     WRITE PO-EMAIL-RECORD FROM EMAIL-LINE-1.                     07850099
078600                                                                  07860099
078700 4000-EMAIL-HEADER-EXIT.                                          07870099
078800     EXIT.                                                        07880099
078900                                                                  07890099
079000******************************************************************07900099
079100* 4200-EMAIL VERBIAGE.                                            07910099
079200******************************************************************07920099
079300 4200-EMAIL-VERB.                                                 07930099
079400                                                                  07940099
079500     IF WS-SUB = 1                                                07950099
079600        MOVE WS-MSG-DETAIL(WS-SUB) TO WS-MSG-HEADER               07960099
079700        MOVE WS-TRN-SET-CDE-SAVE TO WS-MSGHDR-DOC                 07970099
079710        WRITE PO-EMAIL-RECORD FROM WS-MSG-HEADER                  07971099
079720     ELSE                                                         07972099
079730        WRITE PO-EMAIL-RECORD FROM WS-MSG-DETAIL (WS-SUB).        07973099
079740                                                                  07974099
079750 4200-EMAIL-VERB-EXIT.                                            07975099
079760     EXIT.                                                        07976099
079770                                                                  07977099
079780******************************************************************07978099
079790* 4400-EMAIL - PURCHASE ORDER INFORMATION.                        07979099
079800******************************************************************07980099
079900 4400-EMAIL-PO.                                                   07990099
080000                                                                  08000099
080100     MOVE SPACES               TO EMAIL-LINE-1.                   08010099
080200                                                                  08020099
080300     MOVE WS-MSG-DETAIL (3)    TO WS-MSG-INVOICE.                 08030099
080400     MOVE WS-TRN-DTL-TXT-SAVE (1:15) TO WS-MSG-PO.                08040099
080500                                                                  08050099
080600     MOVE WS-GS-CNTL-NBR-SAVE  TO WS-MSG-ISA.                     08060099
080700                                                                  08070099
080800     MOVE WS-TRANS-DATE-SAVE   TO WS-REFORMAT-DATE.               08080099
080900     MOVE WS-REFDTE-MM         TO WS-DTE-MM.                      08090099
081000     MOVE '/'                  TO WS-DTE-P1.                      08100099
081100     MOVE WS-REFDTE-DD         TO WS-DTE-DD.                      08110099
081200     MOVE '/'                  TO WS-DTE-P2.                      08120099
081300     MOVE WS-REFDTE-CCYY       TO WS-DTE-YY.                      08130099
081400                                                                  08140099
081500     PERFORM 5000-GET-PO-SHIP-DATE                                08150099
081600        THRU 5000-GET-PO-SHIP-DATE-EXIT.                          08160099
081700                                                                  08170099
081800     MOVE WS-MSG-INVOICE       TO EL1-VERBIAGE.                   08180099
081900                                                                  08190099
082000     WRITE PO-EMAIL-RECORD     FROM EMAIL-LINE-1.                 08200099
082100                                                                  08210099
082200**** UPDATE TFGTRST WITH THE ACKNOWLEDGEMENT STATUS....           08220099
082300                                                                  08230099
082400     PERFORM 5200-UPD-TFGTRST-STATUS                              08240099
082500        THRU 5200-UPD-TFGTRST-STATUS-EXIT.                        08250099
082600                                                                  08260099
082700 4400-EMAIL-PO-EXIT.                                              08270099
082800     EXIT.                                                        08280099
082900                                                                  08290099
083000******************************************************************08300099
083100* 5000-GET THE PURCHASE ORDER SHIPMENT DATE....                   08310099
083200******************************************************************08320099
083300 5000-GET-PO-SHIP-DATE.                                           08330099
083400                                                                  08340099
083500     MOVE WS-TRN-DTL-TXT-SAVE(1:15) TO DP010I-UNEDITED-FIELD.     08350099
083600     MOVE 17                        TO DP010I-MAXIMUM-DIGITS.     08360099
083700     MOVE ZEROS                     TO DP010I-MAXIMUM-DECIMALS.   08370099
083800                                                                  08380099
083900     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     08390099
084000                                                                  08400099
084100     CALL DP010I-NUMERIC-EDIT-ROUTINE                             08410099
084110                   USING DP010I-NUMERIC-EDIT-AREA                 08411099
084120                                                                  08412099
084130     IF DP010I-ERROR-DETECTED                                     08413099
084140         MOVE ZEROS           TO WS-EDIT-PO-NUMBER                08414099
084150     ELSE                                                         08415099
084160         MOVE DP010I-NUM-FIELD-17-DIG-0-DEC TO WS-EDIT-PO-NUMBER. 08416099
084170                                                                  08417099
084180     EXEC SQL                                                     08418099
084190       SELECT DONT_SHIP_BEF_DTE                                   08419099
084200       INTO :PLNSHP-DONT-SHIP-BEF-DTE                             08420099
084300       FROM TPLNSHP                                               08430099
084400       WHERE PO_NBR = :WS-EDIT-PO-NUMBER                          08440099
084500         AND VER_STATUS_CDE = 'A'                                 08450099
084600     END-EXEC.                                                    08460099
084700                                                                  08470099
084800     EVALUATE TRUE                                                08480099
084900       WHEN SQLCODE IS EQUAL TO ZERO                              08490099
085000         MOVE PLNSHP-DONT-SHIP-BEF-DTE TO WS-REFORMAT-DATE        08500099
085100       WHEN SQLWARN IS NOT EQUAL TO SPACES                        08510099
085200       WHEN SQLCODE IS NOT EQUAL TO ZERO                          08520099
085300         MOVE '9999-09-09'    TO WS-REFORMAT-DATE                 08530099
085400     END-EVALUATE.                                                08540099
085500                                                                  08550099
085600     MOVE WS-REFDTE-MM         TO WS-SHPDTE-MM.                   08560099
085700     MOVE '/'                  TO WS-SHPDTE-P1.                   08570099
085800     MOVE WS-REFDTE-DD         TO WS-SHPDTE-DD.                   08580099
085900     MOVE '/'                  TO WS-SHPDTE-P2.                   08590099
086000     MOVE WS-REFDTE-CCYY       TO WS-SHPDTE-YY.                   08600099
086100                                                                  08610099
086200 5000-GET-PO-SHIP-DATE-EXIT.                                      08620099
086300     EXIT.                                                        08630099
086400                                                                  08640099
086500******************************************************************08650099
086600* 5100-CALCULATE THE DATE FOR THE EMAIL.....                      08660099
086700******************************************************************08670099
086800 5100-CALC-DTE-ROUTINE.                                           08680099
086900                                                                  08690099
087000     EXEC SQL                                                     08700099
087100        SET :WS-TIMESTAMP = CURRENT TIMESTAMP                     08710099
087200     END-EXEC.                                                    08720099
087300                                                                  08730099
087400     MOVE WS-TIMESTAMP         TO WS-DB2-TIMESTAMP.               08740099
087500                                                                  08750099
087600     MOVE WS-DB2-YEAR          TO WS-YEAR.                        08760099
087700     MOVE WS-DB2-DAY           TO WS-DAY.                         08770099
087800     MOVE WS-DB2-MTH           TO WS-MONTH.                       08780099
087900                                                                  08790099
088000     PERFORM 6000-GET-MONTH                                       08800099
088100        THRU 6000-GET-MONTH-EXIT                                  08810099
088200            VARYING MTH-NDX FROM 1 BY 1                           08820099
088300            UNTIL MTH-NDX IS GREATER THAN 12.                     08830099
088400                                                                  08840099
088500     MOVE WS-DB2-HR            TO WS-HOUR.                        08850099
088600     MOVE ':'                  TO WS-VERB-P1, WS-VERB-P2.         08860099
088700     MOVE WS-DB2-MIN           TO WS-MINUTE.                      08870099
088800     MOVE WS-DB2-SEC           TO WS-SECOND.                      08880099
088900     MOVE 'CDT'                TO WS-ZONE.                        08890099
089000                                                                  08900099
089100 5100-CALC-DTE-ROUTINE-EXIT.                                      08910099
089200     EXIT.                                                        08920099
089300                                                                  08930099
089400******************************************************************08940099
089500* 5200-UPDATE TFGTRST WITH THE ACKNOWLEDGEMENT STATUS CODE.       08950099
089600***   IF A CHANGE IS MADE TO THIS ROUTINE, VERIFY THAT THE CHANGE 08960099
089700*** IS NEEDED/NOT NEEDED TO THE 5300- ROUTINE.                    08970099
089800******************************************************************08980099
089900 5200-UPD-TFGTRST-STATUS.                                         08990099
090000                                                                  09000099
090100     EXEC SQL                                                     09010099
090200         UPDATE TFGTRST                                           09020099
090300           SET PO_ACKNL_STAT_CDE = 'F'                            09030099
090400         WHERE TP_DKEY          = :WS-TP-DKEY-SAVE                09040099
090500           AND TP_DKEY_TMST     = :WS-TP-DKEY-TMST-SAVE           09050099
090600           AND FUNC_CDE_SEQ_NBR = :WS-FUNC-CDE-SEQ-SAVE           09060099
090700           AND TRN_SET_SEQ_NBR  = :WS-TRN-SET-SEQ-SAVE            09070099
090800           AND TRN_SET_CDE      = :WS-TRN-SET-CDE-SAVE            09080099
090900     END-EXEC.                                                    09090099
091000                                                                  09100099
091100     EVALUATE TRUE                                                09110099
091200         WHEN SQLCODE IS EQUAL TO ZERO                            09120099
091300             CONTINUE                                             09130099
091400         WHEN SQLWARN0 IS NOT EQUAL TO SPACES                     09140099
091500         WHEN SQLCODE IS NOT EQUAL TO ZERO                        09150099
091600             DISPLAY SPACES                                       09160099
091700             DISPLAY '** ETKUP050 **'                             09170099
091800             DISPLAY '** 5200-UPDATE-TFGTRST-W-STATUS **'         09180099
091900             DISPLAY 'SQLCODE = ' SQLCODE                         09190099
092000             PERFORM 7000-GET-VENDOR-NAME                         09200099
092100             DISPLAY 'VENDOR = ' ENTNME-ENT-NAME-DESC             09210099
092200             DISPLAY 'TP_DKEY = ' WS-TP-DKEY-SAVE                 09220099
092300             DISPLAY 'TP_DKEY_TMST = ' WS-TP-DKEY-TMST-SAVE       09230099
092400             DISPLAY 'FUNC_CDE_SEQ_NBR = ' WS-FUNC-CDE-SEQ-SAVE   09240099
092500             DISPLAY 'TRN_SET_SEQ_NBR = ' WS-TRN-SET-SEQ-SAVE     09250099
092600             DISPLAY 'TRN_SET_CDE      = ' WS-TRN-SET-CDE-SAVE    09260099
092700             DISPLAY 'FUNC_CDE_CNTL_NBR = ' WS-GS-CNTL-NBR-SAVE   09270099
092800             MOVE 'Y' TO WS-ERROR-FOUND-SW                        09280099
092900     END-EVALUATE.                                                09290099
093000                                                                  09300099
093100 5200-UPD-TFGTRST-STATUS-EXIT.                                    09310099
093200     EXIT.                                                        09320099
093300                                                                  09330099
093400******************************************************************09340099
093500* 5300-UPDATE TFGTRST WITH THE ACKNOWLEDGEMENT STATUS CODE.       09350099
093600***   IF A CHANGE IS MADE TO THIS ROUTINE, VERIFY THAT THE CHANGE 09360099
093700*** IS NEEDED/NOT NEEDED TO THE 5200- ROUTINE.                    09370099
093800******************************************************************09380099
093900 5300-UPD-TFGTRST-STATUS.                                         09390099
094000                                                                  09400099
094100     EXEC SQL                                                     09410099
094200         UPDATE TFGTRST                                           09420099
094300           SET PO_ACKNL_STAT_CDE = 'F'                            09430099
094400         WHERE TP_DKEY          = :FGTRST-TP-DKEY                 09440099
094500           AND TP_DKEY_TMST     = :FGTRST-TP-DKEY-TMST            09450099
094600           AND FUNC_CDE_SEQ_NBR = :FGTRST-FUNC-CDE-SEQ-NBR        09460099
094700           AND TRN_SET_SEQ_NBR  = :FGTRST-TRN-SET-SEQ-NBR         09470099
094800           AND TRN_SET_CDE      = :FGTRST-TRN-SET-CDE             09480099
094900     END-EXEC.                                                    09490099
095000                                                                  09500099
095100     EVALUATE TRUE                                                09510099
095200         WHEN SQLCODE IS EQUAL TO ZERO                            09520099
095300             CONTINUE                                             09530099
095400         WHEN SQLWARN0 IS NOT EQUAL TO SPACES                     09540099
095500         WHEN SQLCODE IS NOT EQUAL TO ZERO                        09550099
095600             DISPLAY SPACES                                       09560099
095700             DISPLAY '** ETKUP048 **'                             09570099
095800             DISPLAY '** 5300-UPDATE-TFGTRST-W-STATUS **'         09580099
095900             DISPLAY 'SQLCODE = ' SQLCODE                         09590099
096000             PERFORM 7100-GET-VENDOR-NAME                         09600099
096100             DISPLAY 'VENDOR = ' ENTNME-ENT-NAME-DESC             09610099
096200             DISPLAY 'TP_DKEY = ' FGTRST-TP-DKEY                  09620099
096300             DISPLAY 'TP_DKEY_TMST = ' FGTRST-TP-DKEY-TMST        09630099
096400             DISPLAY 'FUNC_CDE_SEQ_NBR = ' FGTRST-FUNC-CDE-SEQ-NBR09640099
096500             DISPLAY 'TRN_SET_SEQ_NBR = ' FGTRST-TRN-SET-SEQ-NBR  09650099
096600             DISPLAY 'TRN_SET_CDE      = ' FGTRST-TRN-SET-CDE     09660099
096700             MOVE 'Y' TO WS-ERROR-FOUND-SW                        09670099
096800     END-EVALUATE.                                                09680099
096900                                                                  09690099
097000 5300-UPD-TFGTRST-STATUS-EXIT.                                    09700099
097100     EXIT.                                                        09710099
097200                                                                  09720099
097300******************************************************************09730099
097400* 6000-GET THE MONTH NAME...                                      09740099
097500******************************************************************09750099
097600 6000-GET-MONTH.                                                  09760099
097700                                                                  09770099
097800     IF WS-MONTH IS EQUAL TO WS-MTH (MTH-NDX)                     09780099
097900         MOVE WS-MTH-VARIABLE (MTH-NDX) TO WS-MONTH               09790099
098000         MOVE 99                        TO MTH-NDX.               09800099
098100                                                                  09810099
098200 6000-GET-MONTH-EXIT.                                             09820099
098300     EXIT.                                                        09830099
098400                                                                  09840099
098500 7000-GET-VENDOR-NAME.                                            09850099
098600                                                                  09860099
098700     EXEC SQL                                                     09870099
098800        SELECT ENT_NAME_DESC                                      09880099
098900          INTO :ENTNME-ENT-NAME-DESC                              09890099
099000          FROM TENTNME E                                          09900099
099100              ,TTRDPRT T                                          09910099
099200         WHERE TP_DKEY = :WS-TP-DKEY-SAVE                         09920099
099300           AND T.ENT_ID = E.ENT_ID                                09930099
099400           AND TYPE_CDE = '01'                                    09940099
099500     END-EXEC.                                                    09950099
099600                                                                  09960099
099700     IF SQLCODE NOT = +000                                        09970099
099800        MOVE 'NOT FOUND' TO ENTNME-ENT-NAME-DESC                  09980099
099900     END-IF.                                                      09990099
100000                                                                  10000099
100100 7100-GET-VENDOR-NAME.                                            10010099
100200                                                                  10020099
100300     EXEC SQL                                                     10030099
100400        SELECT ENT_NAME_DESC                                      10040099
100500          INTO :ENTNME-ENT-NAME-DESC                              10050099
100600          FROM TENTNME E                                          10060099
100700              ,TTRDPRT T                                          10070099
100800         WHERE TP_DKEY = :FGTRST-TP-DKEY                          10080099
100900           AND T.ENT_ID = E.ENT_ID                                10090099
101000           AND TYPE_CDE = '01'                                    10100099
101100     END-EXEC.                                                    10110099
101200                                                                  10120099
101300     IF SQLCODE NOT = +000                                        10130099
101400        MOVE 'NOT FOUND' TO ENTNME-ENT-NAME-DESC                  10140099
101500     END-IF.                                                      10150099
101600                                                                  10160099
101700******************************************************************10170099
101710* 9000-END OF JOB TASKS......                                     10171099
101720******************************************************************10172099
101730 9000-END-OF-JOB-TASKS.                                           10173099
101740*** GENERATE A FINAL CONTROL BREAK, IF NECESSARY......            10174099
101750                                                                  10175099
101760     IF TEXT-PROCESSED                                            10176099
101770         MOVE ZEROS         TO WS-SUB                             10177099
101780         PERFORM 4200-EMAIL-VERB                                  10178099
101790            THRU 4200-EMAIL-VERB-EXIT                             10179099
101800              VARYING WS-SUB FROM 4 BY 1                          10180099
101801              UNTIL WS-SUB IS GREATER THAN 10.                    10180199
101802                                                                  10180299
101803*** CLOSE THE FILES...                                            10180399
101804                                                                  10180499
101805     IF ERRORS-FOUND AND                                          10180599
101806        ABEND-CODE IS NOT EQUAL TO +4013                          10180699
101807         SET ABEND-4095 TO TRUE.                                  10180799
101808                                                                  10180899
101809     CLOSE PO-OUTPUT-FILE.                                        10180999
101810                                                                  10181099
101811     EXEC SQL                                                     10181199
101812         CLOSE TRDPRT_CURSOR                                      10181299
101813     END-EXEC.                                                    10181399
101814                                                                  10181499
101815     EVALUATE TRUE                                                10181599
101816       WHEN SQLCODE IS EQUAL TO ZERO                              10181699
101817         CONTINUE                                                 10181799
101818       WHEN SQLWARN IS NOT EQUAL TO SPACES                        10181899
101819       WHEN SQLCODE IS NOT EQUAL TO ZERO                          10181999
101820        MOVE '9000-END-OF-JOB-TASKS' TO PV-PARAGRAPH-NAME         10182099
101830        MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED              10183099
101840        PERFORM 9900-SQL-ERROR                                    10184099
101850     END-EVALUATE.                                                10185099
101860                                                                  10186099
101870 9000-END-OF-JOB-TASKS-EXIT.                                      10187099
101880     EXIT.                                                        10188099
101890                                                                  10189099
101900******************************************************************10190099
102000* 9900-SQL ERROR HANDLING...                                      10200099
102100******************************************************************10210099
102200 9900-SQL-ERROR.                                                  10220099
102300                                                                  10230099
102400     SET ABEND-4013 TO TRUE.                                      10240099
102500                                                                  10250099
102600     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            10260099
102700     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        10270099
102800                                                                  10280099
102900     COPY DPPD004.                                                10290099
103000                                                                  10300099
103100     CALL 'ILBOABN0'  USING ABEND-CODE.                           10310099
103200                                                                  10320099
