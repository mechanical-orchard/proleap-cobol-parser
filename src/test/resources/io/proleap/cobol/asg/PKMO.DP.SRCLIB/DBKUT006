000100 IDENTIFICATION DIVISION.                                         00010017
000200                                                                  00020017
000300 PROGRAM-ID.             DBKUT006.                                00030017
000400 AUTHOR.                 BRAD DORN.                               00040017
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050017
000600 DATE-WRITTEN.           NOVEMBER 2010.                           00060017
000700 DATE-COMPILED.                                                   00070017
000800                                                                  00080017
000900***************************************************************** 00090017
001000***  REORG DETERMINATION PROGRAM                              *** 00100017
001100***  ---------------------------                              *** 00110017
001200***  THIS PROGRAM WILL GENERATE IBM DB2 REORG CONTROL CARDS   *** 00120017
001300***  FOR TABLESPACES AND INDEXES WHEN CERTAIN STATISTICAL     *** 00130017
001400***  VALUES EXCEED A THRESHOLD.                               *** 00140017
001500***************************************************************** 00150017
001600*                                                                 00160017
001700***************************************************************** 00170017
001800***-----------------------------------------------------------*** 00180017
001900***  IMPORTANT!!!                                             *** 00190017
002000***-----------------------------------------------------------*** 00200017
002100***  WHENEVER THIS PROGRAM IS TURNED OVER TO PRODUCTION, A    *** 00210017
002200***  BIND TO DB6P IS REQUIRED.  BIND JCL CAN BE FOUND IN THE  *** 00220017
002300***  FOLLOWING MEMBER:                                        *** 00230017
002400***     TKMD.DB2.CNTL(BINDRO6P)                               *** 00240017
002500***************************************************************** 00250017
002600*                                                                 00260017
002700***************************************************************** 00270017
002800***  THE FOLLOWING STATISTICS ARE COMPARED TO A THRESHOLD     *** 00280017
002900***  VALUE TO DETERMINE WHETHER THE OBJECT QUALIFIES FOR A    *** 00290017
003000***  REORG:                                                   *** 00300017
003100***                                                           *** 00310017
003200***  NON-LOB TABLESPACES:                                     *** 00320017
003300***  --------------------                                     *** 00330017
003400***  - EXTENTS                                                *** 00340017
003500***  - CLUSTERING DEGRADATION                                 *** 00350017
003600***  - RELOCATED ROWS                                         *** 00360017
003700***  - COMPRESSION PAGE SAVINGS DEGRADATION                   *** 00370017
003800***  - COMPRESSION TURNED OFF/COMPRESSION DICTIONARY EXISTS   *** 00380017
003900***    (IF COMPRESSION IS BLANK AND PAGE SAVINGS IS NOT ZERO, *** 00390017
004000***     COMPRESSION HAS BEEN TURNED OFF.  A REORG IS FORCED   *** 00400017
004100***     IN ORDER TO ERASE THE COMPRESSION DICTIONARY).        *** 00410017
004200***  - MEMBER CLUSTER/0 FREE SPACE (INSERT-AT-END): PERCENT   *** 00420017
004300***    OF INSERTED/UPDATED/DELETED ROWS SINCE PREVIOUS REORG  *** 00430017
004400***                                                           *** 00440017
004500***  LOB TABLESPACES:                                         *** 00450017
004600***  ----------------                                         *** 00460017
004700***  - LOB FRAGMENTATION                                      *** 00470017
004800***  - EXTENTS                                                *** 00480017
004900***                                                           *** 00490017
005000***  INDEXES:                                                 *** 00500017
005100***  --------                                                 *** 00510017
005200***  - EXTENTS                                                *** 00520017
005300***  - LEAF PAGE SPLITS                                       *** 00530017
005400***  - PSEUDO-DELETED INDEX ENTRIES                           *** 00540017
005500***                                                           *** 00550017
005600***  WITH THE EXCEPTION OF COMPRESSION DEGRADATION, REALTIME  *** 00560017
005700***  STATISTICAL VALUES ARE USED.  A REORG WILL BE FORCED     *** 00570017
005800***  IN THE EVENT THAT REORG-RELATED REALTIME STATS ARE NOT   *** 00580017
005900***  PRESENT.                                                 *** 00590017
006000***************************************************************** 00600017
006100*                                                                 00610017
006200***************************************************************** 00620017
006300***  OBJECT RESIZING: PRIQTY/SECQTY ALTER STATEMENTS WILL BE  *** 00630017
006400***                   GENERATED FOR OBJECTS THAT EXCEED THE   *** 00640017
006500***                   EXTENT THRESHOLD.                       *** 00650017
006600***************************************************************** 00660017
006700*                                                                 00670017
006800 ENVIRONMENT DIVISION.                                            00680017
006900                                                                  00690017
007000 CONFIGURATION SECTION.                                           00700017
007100                                                                  00710017
007200 SOURCE-COMPUTER.    IBM.                                         00720017
007300 OBJECT-COMPUTER.    IBM.                                         00730017
007400                                                                  00740017
007500 INPUT-OUTPUT SECTION.                                            00750017
007600                                                                  00760017
007700 FILE-CONTROL.                                                    00770017
007800                                                                  00780017
007900     SELECT THRESHOLD-VALUES-FILE                                 00790017
008000         ASSIGN TO IN01.                                          00800017
008100                                                                  00810017
008200     SELECT REORG-SCOPE-FILE                                      00820017
008300         ASSIGN TO IN02.                                          00830017
008400                                                                  00840017
008500     SELECT SHRLVL-CHANGE-PARMS-FILE                              00850017
008600         ASSIGN TO IN03.                                          00860017
008700                                                                  00870017
008800     SELECT TS-REORG-KEEPDICT-FILE                                00880017
008900         ASSIGN TO OUT01.                                         00890017
009000                                                                  00900017
009100     SELECT TS-REORG-NOKEEPDICT-FILE                              00910017
009200         ASSIGN TO OUT02.                                         00920017
009300                                                                  00930017
009400     SELECT TS-REORG-LOB-FILE                                     00940017
009500         ASSIGN TO OUT03.                                         00950017
009600                                                                  00960017
009700     SELECT IX-REORG-FILE                                         00970017
009800         ASSIGN TO OUT04.                                         00980017
009900                                                                  00990017
010000     SELECT ALTER-QTY-FILE                                        01000017
010100         ASSIGN TO OUT05.                                         01010017
010200                                                                  01020017
010300 DATA DIVISION.                                                   01030017
010400                                                                  01040017
010500 FILE SECTION.                                                    01050017
010600                                                                  01060017
010700 FD  THRESHOLD-VALUES-FILE                                        01070017
010800     RECORDING MODE IS F                                          01080017
010900     BLOCK CONTAINS 0 RECORDS.                                    01090017
011000                                                                  01100017
011100 01  THRESHOLD-VALUES-RECORD    PIC X(080).                       01110017
011200                                                                  01120017
011300 FD  REORG-SCOPE-FILE                                             01130017
011400     RECORDING MODE IS V                                          01140017
011500     BLOCK CONTAINS 0 RECORDS.                                    01150017
011600                                                                  01160017
011700 01  REORG-SCOPE-RECORD         PIC X(120).                       01170017
011800                                                                  01180017
011900 FD  SHRLVL-CHANGE-PARMS-FILE                                     01190017
012000     RECORDING MODE IS F                                          01200017
012100     BLOCK CONTAINS 0 RECORDS.                                    01210017
012200                                                                  01220017
012300 01  SHRLVL-CHANGE-PARMS-RECORD PIC X(080).                       01230017
012400                                                                  01240017
012500 FD  TS-REORG-KEEPDICT-FILE                                       01250017
012600     RECORDING MODE IS F                                          01260017
012700     BLOCK CONTAINS 0 RECORDS.                                    01270017
012800                                                                  01280017
012900 01  TS-REORG-KEEPDICT-RECORD   PIC X(080).                       01290017
013000                                                                  01300017
013100 FD  TS-REORG-NOKEEPDICT-FILE                                     01310017
013200     RECORDING MODE IS F                                          01320017
013300     BLOCK CONTAINS 0 RECORDS.                                    01330017
013400                                                                  01340017
013500 01  TS-REORG-NOKEEPDICT-RECORD PIC X(080).                       01350017
013600                                                                  01360017
013700 FD  TS-REORG-LOB-FILE                                            01370017
013800     RECORDING MODE IS F                                          01380017
013900     BLOCK CONTAINS 0 RECORDS.                                    01390017
014000                                                                  01400017
014100 01  TS-REORG-LOB-RECORD        PIC X(080).                       01410017
014200                                                                  01420017
014300 FD  IX-REORG-FILE                                                01430017
014400     RECORDING MODE IS F                                          01440017
014500     BLOCK CONTAINS 0 RECORDS.                                    01450017
014600                                                                  01460017
014700 01  IX-REORG-RECORD            PIC X(080).                       01470017
014800                                                                  01480017
014900 FD  ALTER-QTY-FILE                                               01490017
015000     RECORDING MODE IS F                                          01500017
015100     BLOCK CONTAINS 0 RECORDS.                                    01510017
015200                                                                  01520017
015300 01  ALTER-QTY-RECORD           PIC X(080).                       01530017
015400                                                                  01540017
015500                                                                  01550017
015600 WORKING-STORAGE SECTION.                                         01560017
015700                                                                  01570017
015800 01  WS-ABEND-CODE                 PIC S9(04) VALUE +0 COMP SYNC. 01580017
015900 01  WS-NO-MORE-INDEXES            PIC X(01)  VALUE 'N'.          01590017
016000 01  WS-BUILD-COMP-DICT            PIC X(01)  VALUE 'N'.          01600017
016100 01  WS-CHANGED-ROWS               PIC S9(12)V9(2) COMP-3         01610017
016200                                                   VALUE +0.      01620017
016300 01  WS-CURR-PRIQTY-KB             PIC S9(09) COMP  VALUE +0.     01630017
016400 01  WS-CURR-SECQTY-KB             PIC S9(09) COMP  VALUE +0.     01640017
016500 01  WS-DISORG-LEAF                PIC S9(09)V9(2) COMP-3         01650017
016600                                                   VALUE +0.      01660017
016700 01  WS-DSNU1010I-HIT              PIC X(01)  VALUE 'N'.          01670017
016800 01  WS-HOSTVAR-PART               PIC S9(04) VALUE +0 COMP SYNC. 01680017
016900 01  WS-HIGH-HIST-PAGESAVE         PIC S9(04) COMP  VALUE +0.     01690017
017000 01  WS-INDREFLIMIT                PIC S9(09)V9(2) COMP-3         01700017
017100                                                   VALUE +0.      01710017
017200 01  WS-IX-CREATOR                 PIC X(128) VALUE SPACES.       01720017
017300 01  WS-IX-CSR-DATABASE            PIC X(08)  VALUE SPACES.       01730017
017400 01  WS-IX-CSR-TABLESPACE          PIC X(08)  VALUE SPACES.       01740017
017500 01  WS-IX-NAME                    PIC X(128) VALUE SPACES.       01750017
017600 01  WS-IX-REORG-COUNT             PIC S9(04) VALUE +0  COMP.     01760017
017700 01  WS-LAST-BUILT-ROW-FOUND       PIC X(01)  VALUE 'N'.          01770017
017800 01  WS-LOB-DISORG                 PIC S9(09) COMP  VALUE +0.     01780017
017900 01  WS-LOB-TS-REORG-COUNT         PIC S9(04) VALUE +0  COMP.     01790017
018000 01  WS-NBR-CHARACTERS             PIC S9(04) VALUE +0  COMP.     01800017
018100 01  WS-NBR-TABLES-WITH-APPEND-YES PIC S9(09) COMP  VALUE +0.     01810017
018100 01  WS-NBR-TBLS-WITH-DATACAPTURE  PIC S9(09) COMP  VALUE +0.     01820017
018200 01  WS-NEW-PRIQTY-KB              PIC S9(18) COMP  VALUE +0.     01830017
018300 01  WS-NEW-SECQTY-KB              PIC S9(18) COMP  VALUE +0.     01840017
018400 01  WS-OFFPOSLIMIT                PIC S9(09)V9(2) COMP-3         01850017
018500                                                   VALUE +0.      01860017
018600 01  WS-PAGESAVE-DEGRADATION       PIC S9(04) COMP  VALUE +0.     01870017
018700 01  WS-PARTITIONED-INDEX          PIC X(01)  VALUE 'N'.          01880017
018800 01  WS-PARTITIONED-TSPACE         PIC X(01)  VALUE 'N'.          01890017
018900 01  WS-PART-NBR                   PIC S9(04) VALUE +0 COMP SYNC. 01900017
019000 01  WS-PREV-DATABASE              PIC X(08)  VALUE SPACES.       01910017
019100 01  WS-PREV-TABLESPACE            PIC X(08)  VALUE SPACES.       01920017
019200 01  WS-PSEUDO-DEL-ENTRIES         PIC S9(09)V9(2) COMP-3         01930017
019300                                                   VALUE +0.      01940017
019400 01  WS-SCOPE-EOF                  PIC X(01)  VALUE 'N'.          01950017
019500 01  WS-SHRLEVEL                   PIC X(01)  VALUE SPACE.        01960017
019600 01  WS-TS-PART-REORGED            PIC X(01)  VALUE SPACE.        01970017
019700 01  WS-TS-REORG-COUNT-KEEPDICT    PIC S9(04) VALUE +0  COMP.     01980017
019800 01  WS-TS-REORG-COUNT-NOKEEPDICT  PIC S9(04) VALUE +0  COMP.     01990017
019900 01  WS-TS-REORG                   PIC X(01)  VALUE 'N'.          02000017
020000                                                                  02010017
020100 01  TS-TOTALROWS-NULLIND          PIC S9(04) VALUE +0  COMP.     02020017
020200 01  TS-SPACE-NULLIND              PIC S9(04) VALUE +0  COMP.     02030017
020300 01  TS-EXTENTS-NULLIND            PIC S9(04) VALUE +0  COMP.     02040017
020400 01  TS-REORGUNCLUSTINS-NULLIND    PIC S9(04) VALUE +0  COMP.     02050017
020500 01  TS-REORGDISORGLOB-NULLIND     PIC S9(04) VALUE +0  COMP.     02060017
020600 01  TS-REORGNEARINDREF-NULLIND    PIC S9(04) VALUE +0  COMP.     02070017
020700 01  TS-REORGFARINDREF-NULLIND     PIC S9(04) VALUE +0  COMP.     02080017
020800 01  TS-REORGINSERTS-NULLIND       PIC S9(04) VALUE +0  COMP.     02090017
020900 01  TS-REORGDELETES-NULLIND       PIC S9(04) VALUE +0  COMP.     02100017
021000 01  TS-REORGUPDATES-NULLIND       PIC S9(04) VALUE +0  COMP.     02110017
021010 01  TS-NPAGES-NULLIND             PIC S9(04) VALUE +0  COMP.     02120017
021100 01  IX-TOTALENTRIES-NULLIND       PIC S9(04) VALUE +0  COMP.     02130017
021200 01  IX-NLEVELS-NULLIND            PIC S9(04) VALUE +0  COMP.     02140017
021300 01  IX-NACTIVE-NULLIND            PIC S9(04) VALUE +0  COMP.     02150017
021400 01  IX-SPACE-NULLIND              PIC S9(04) VALUE +0  COMP.     02160017
021500 01  IX-EXTENTS-NULLIND            PIC S9(04) VALUE +0  COMP.     02170017
021600 01  IX-REORGPSEUDODELETES-NULLIND PIC S9(04) VALUE +0  COMP.     02180017
021700 01  IX-REORGLEAFFAR-NULLIND       PIC S9(04) VALUE +0  COMP.     02190017
021800                                                                  02200017
021900 01  WS-IX-CREATOR-NAME            PIC  X(257) VALUE SPACES.      02210017
022000                                                                  02220017
022100 01  FILLER  REDEFINES WS-IX-CREATOR-NAME.                        02230017
022200     05  WS-IX-CREATOR-NAME-1-72       PIC X(72).                 02240017
022300     05  WS-IX-CREATOR-NAME-73-144     PIC X(72).                 02250017
022400     05  WS-IX-CREATOR-NAME-145-216    PIC X(72).                 02260017
022500     05  WS-IX-CREATOR-NAME-217-257    PIC X(41).                 02270017
022600                                                                  02280017
023500 01  WS-SCOPE-RECORD.                                             02370017
023600     05  FILLER                    PIC X(01).                     02380017
023700     05  WS-DSNU-MSG               PIC X(09).                     02390017
023800     05  FILLER                    PIC X(110).                    02400017
023900                                                                  02410017
024000 01  WS-INCLUDE-LINE  REDEFINES WS-SCOPE-RECORD.                  02420017
024100     05  FILLER                    PIC X(15).                     02430017
024200     05  WS-INCLUDE-KEYWORD        PIC X(18).                     02440017
024300     05  FILLER                    PIC X(01).                     02450017
024400     05  FILLER                    PIC X(86).                     02460017
024500                                                                  02470017
026000 01  WS-DSNU050I-LINE.                                            02620017
026100     05  WS-DSNU050I-LIT1          PIC X(11).                     02630017
026200     05  WS-DSNU050I-LIT2          PIC X(11).                     02640017
026300     05  WS-DSNU050I-LIT3          PIC X(11).                     02650017
026400     05  WS-DSNU050I-LIT4          PIC X(11).                     02660017
026500     05  WS-DSNU050I-LIT5          PIC X(11).                     02670017
026600     05  WS-DSNU050I-LIT6          PIC X(11).                     02680017
026700     05  WS-DSNU050I-LIT7          PIC X(11).                     02690017
026800     05  WS-DSNU050I-LIT8          PIC X(11).                     02700017
026900     05  WS-DSNU050I-LIT9          PIC X(11).                     02710017
027000     05  WS-DSNU050I-LIT10         PIC X(11).                     02720017
027100     05  WS-DSNU050I-LIT11         PIC X(11).                     02730017
027200     05  WS-DSNU050I-LIT12         PIC X(11).                     02740017
027300                                                                  02750017
027400 01  WS-UNSTRING-LINE.                                            02760017
027500     05  WS-FILL                   PIC X(01).                     02770017
027600     05  WS-INCLUDE-LIT            PIC X(07).                     02780017
027700     05  WS-TABLESPACE-LIT         PIC X(10).                     02790017
027800     05  WS-DATABASE               PIC X(08).                     02800017
027900     05  WS-TABLESPACE             PIC X(08).                     02810017
028000     05  WS-PARTLEVEL              PIC X(16).                     02820017
028100                                                                  02830017
028200 01  WS-PARTITION.                                                02840017
028300     05  WS-PART-CHAR              PIC X(05).                     02850017
028400     05  WS-PART-NUMERIC                                          02860017
028500           REDEFINES WS-PART-CHAR  PIC 9(5).                      02870017
028600                                                                  02880017
028700 01  WS-THRESHOLD-VALUES-RECORD.                                  02890017
028800     05  WS-THRESHOLD-EXTENTS      PIC 9(03)  VALUE 0.            02900017
028900     05  FILLER                    PIC X(01).                     02910017
029000     05  WS-THRESHOLD-OFFPOSLIMIT  PIC 9(03)  VALUE 0.            02920017
029100     05  FILLER                    PIC X(01).                     02930017
029200     05  WS-THRESHOLD-INDREFLIMIT  PIC 9(03)  VALUE 0.            02940017
029300     05  FILLER                    PIC X(01).                     02950017
029400     05  WS-THRESHOLD-PAGESAVE     PIC 9(03)  VALUE 0.            02960017
029500     05  FILLER                    PIC X(01).                     02970017
029600     05  WS-THRESHOLD-LEAFFAR      PIC 9(03)  VALUE 0.            02980017
029700     05  FILLER                    PIC X(01).                     02990017
029800     05  WS-THRESHOLD-PSEUDO-DEL   PIC 9(03)  VALUE 0.            03000017
029900     05  FILLER                    PIC X(01).                     03010017
030000     05  WS-THRESHOLD-DRAIN-WAIT   PIC 9(04)  VALUE 0.            03020017
030100     05  FILLER                    PIC X(01).                     03030017
030200     05  WS-THRESHOLD-RETRY        PIC 9(03)  VALUE 0.            03040017
030300     05  FILLER                    PIC X(01).                     03050017
030400     05  WS-THRESHOLD-RETRY-DELAY  PIC 9(04)  VALUE 0.            03060017
030500     05  FILLER                    PIC X(01).                     03070017
030600     05  WS-THRESHOLD-LISTPARTS    PIC 9(02)  VALUE 0.            03080017
030700     05  FILLER                    PIC X(02).                     03090017
030600     05  WS-THRESHOLD-LOB-ORGRATIO PIC 9(03)  VALUE 0.            03091017
030700     05  FILLER                    PIC X(01).                     03092017
030800     05  WS-THRESHOLD-CHANGED-ROWS PIC 9(03)  VALUE 0.            03093017
030810     05  FILLER                    PIC X(01).                     03094017
030820     05  WS-THRESHOLD-DEADLINE     PIC X(30)  VALUE SPACES.       03095017
030900                                                                  03096017
031000 01  WS-SHRLEVEL-CHANGE-PARMS-REC.                                03097017
031100     05  WS-IN-MAXRO               PIC X(05)  VALUE SPACES.       03098017
031200     05  FILLER                    PIC X(01).                     03099017
031300     05  WS-IN-LONGLOG             PIC X(08)  VALUE SPACES.       03100017
031400     05  FILLER                    PIC X(01).                     03110017
031500     05  WS-IN-DELAY               PIC 9(04)  VALUE 0.            03120017
031600     05  FILLER                    PIC X(01).                     03130017
031700     05  WS-IN-DRAIN               PIC X(07)  VALUE SPACES.       03140017
031600     05  FILLER                    PIC X(53).                     03141019
032000                                                                  03150017
032100 01 DP004-DB2-ERROR-FIELDS.                                       03160017
032200     05  DP004-ASTERISK-LINE       PIC  X(80)  VALUE ALL '*'.     03170017
032300     05  DP004-MAX-MESSAGE-LINES   PIC S9(04)  VALUE +12          03180017
032400                                               COMP SYNC.         03190017
032500     05  DP004-ERROR-LINE-LENGTH   PIC S9(09)  VALUE +75          03200017
032600                                               COMP SYNC.         03210017
032700     05  DP004-FORMATTED-MESSAGE.                                 03220017
032800         10  FILLER                PIC S9(04)  VALUE +900         03230017
032900                                               COMP SYNC.         03240017
033000         10  DP004-MESSAGE-LINE    OCCURS 12 TIMES                03250017
033100                                   INDEXED BY DP004-MSG-IDX       03260017
033200                                   PIC  X(75).                    03270017
033300                                                                  03280017
033400 01  WS-LOB-TS.                                                   03290017
033500     05  WS-LOB-TS-ENTRIES   OCCURS 5000 TIMES                    03300017
033600         INDEXED BY WS-LOB-TS-IDX.                                03310017
033700         10  WS-LOB-TS-DB          PIC  X(08).                    03320017
033800         10  WS-LOB-TS-TS          PIC  X(08).                    03330017
033900                                                                  03340017
034000 01  WS-TS-KEEPDICT.                                              03350017
034100     05  WS-TS-KEEPDICT-ENTRIES   OCCURS 5000 TIMES               03360017
034200         INDEXED BY WS-TS-KEEPDICT-IDX.                           03370017
034300         10  WS-TS-KEEPDICT-DB     PIC  X(08).                    03380017
034400         10  WS-TS-KEEPDICT-TS     PIC  X(08).                    03390017
034500         10  WS-TS-KEEPDICT-PART   PIC  X(05).                    03400017
034600                                                                  03410017
034700 01  WS-TS-NOKEEPDICT.                                            03420017
034800     05  WS-TS-NOKEEPDICT-ENTRIES   OCCURS 5000 TIMES             03430017
034900         INDEXED BY WS-TS-NOKEEPDICT-IDX.                         03440017
035000         10  WS-TS-NOKEEPDICT-DB   PIC  X(08).                    03450017
035100         10  WS-TS-NOKEEPDICT-TS   PIC  X(08).                    03460017
035200         10  WS-TS-NOKEEPDICT-PART PIC  X(05).                    03470017
035300                                                                  03480017
035400***************************************************************** 03490017
035500*** REORG TABLESPACE STATEMENTS                               *** 03500017
035600***************************************************************** 03510017
035700                                                                  03520017
035800 01  WS-LOB-TS-REORG-LINE1         PIC X(14)   VALUE              03530017
035900     'LISTDEF LOB-TS'.                                            03540017
036000                                                                  03550017
036100 01  WS-TS-KEEPDICT-REORG-LINE1    PIC X(24)   VALUE              03560017
036200     'LISTDEF TS-LIST-KEEPDICT'.                                  03570017
036300                                                                  03580017
036400 01  WS-TS-NOKEEPDICT-REORG-LINE1  PIC X(26)   VALUE              03590017
036500     'LISTDEF TS-LIST-NOKEEPDICT'.                                03600017
036600                                                                  03610017
036700 01  WS-TS-REORG-LINE2.                                           03620017
036800     05  FILLER                    PIC X(21)   VALUE              03630017
036900     '  INCLUDE TABLESPACE '.                                     03640017
037000     05  WS-TS-REORG-DB-TS         PIC X(17)   VALUE SPACES.      03650017
037100     05  FILLER                    PIC X(01)   VALUE SPACE.       03660017
037200     05  WS-TS-REORG-PART-LIT      PIC X(12)   VALUE SPACES.      03670017
037300     05  WS-TS-REORG-PART-NBR      PIC X(05)   VALUE SPACES.      03680017
037400     05  WS-TS-REORG-RPARAN-LIT    PIC X(01)   VALUE SPACE.       03690017
037500                                                                  03700017
037600 01  WS-LOB-TS-REORG-LINE3         PIC X(28)   VALUE              03710017
037700     'REORG TABLESPACE LIST LOB-TS'.                              03720017
037800                                                                  03730017
037900 01  WS-TS-REORG-LINE3-KEEPDICT    PIC X(38)   VALUE              03740017
038000     'REORG TABLESPACE LIST TS-LIST-KEEPDICT'.                    03750017
038100                                                                  03760017
038200 01  WS-TS-REORG-LINE3-NOKEEPDICT  PIC X(40)   VALUE              03770017
038300     'REORG TABLESPACE LIST TS-LIST-NOKEEPDICT'.                  03780017
038400                                                                  03790017
038500 01  WS-TS-REORG-LINE5             PIC X(10)   VALUE              03800017
038600     '  NOSYSREC'.                                                03810017
038700                                                                  03820017
038800 01  WS-TS-REORG-LINE7             PIC X(19)   VALUE              03830017
038900     '  COPYDDN(ROCPYLOC)'.                                       03840017
039000                                                                  03850017
039100 01  WS-TS-REORG-LINE8             PIC X(16)   VALUE              03860017
039200     '  SORTDEVT SYSDA'.                                          03870017
039300                                                                  03880017
039400 01  WS-TS-REORG-LINE10            PIC X(16)   VALUE              03890017
039500     '  KEEPDICTIONARY'.                                          03900017
039600                                                                  03910017
040200 01  WS-TS-REORG-LINE12            PIC X(35)   VALUE              03970017
040300     '  STATISTICS TABLE(ALL) INDEX(ALL) '.                       03980017
040400                                                                  03990017
040500 01  WS-TS-REORG-LINE13            PIC X(24)   VALUE              04000017
040600     '  KEYCARD HISTORY SPACE '.                                  04010017
040700                                                                  04020017
040500 01  WS-TS-REORG-LINE14            PIC X(09)   VALUE              04030017
040600     '  AUX NO '.                                                 04040017
040700                                                                  04050017
039700 01  WS-TS-REORG-LINE15.                                          04060017
039800     05  FILLER                    PIC X(12)   VALUE              04070017
039900     '  LISTPARTS '.                                              04080017
040000     05  WS-TS-REORG-LISTPARTS     PIC 9(02)   VALUE ZERO.        04090017
040100                                                                  04100017
040800***************************************************************** 04110017
040900*** REORG INDEX STATEMENTS                                    *** 04120017
041000***************************************************************** 04130017
041100                                                                  04140017
041200 01  WS-IX-REORG-LINE1.                                           04150017
041300     05  FILLER                    PIC X(14)   VALUE              04160017
041400     'LISTDEF IXLIST'.                                            04170017
041500                                                                  04180017
041600 01  WS-IX-REORG-LINE2.                                           04190017
041700     05  FILLER                    PIC X(15)   VALUE              04200017
041800     ' INCLUDE INDEX '.                                           04210017
041900                                                                  04220017
042000 01  WS-IX-REORG-LINE2A.                                          04230017
042100     05  FILLER                    PIC X(12)   VALUE              04240017
042200     ' PARTLEVEL ('.                                              04250017
042300     05  WS-IX-REORG-PART-NBR      PIC X(05)   VALUE SPACES.      04260017
042400     05  FILLER                    PIC X(01)   VALUE ')'.         04270017
042500                                                                  04280017
042600 01  WS-IX-REORG-LINE3             PIC X(23)   VALUE              04290017
042700     'REORG INDEX LIST IXLIST'.                                   04300017
042800                                                                  04310017
042900 01  WS-IX-REORG-LINE4.                                           04320017
043000     05  FILLER                    PIC X(35)   VALUE              04330017
043100     '  STATISTICS KEYCARD HISTORY SPACE '.                       04340017
043200                                                                  04350017
043300                                                                  04360017
043400***************************************************************** 04370017
043500*** REORG STATEMENTS COMMON TO BOTH TABLESPACE AND INDEXES    *** 04380017
043600***************************************************************** 04390017
043700                                                                  04400017
043800 01  WS-COMMON-REORG-LINE1.                                       04410017
043900     05  FILLER                    PIC X(11)   VALUE              04420017
044000     '  SHRLEVEL '.                                               04430017
044100     05  WS-REORG-SHRLEVEL         PIC X(09)   VALUE SPACES.      04440017
044200                                                                  04450017
044300 01  WS-COMMON-REORG-LINE2.                                       04460017
044400     05  FILLER                    PIC X(13)   VALUE              04470017
044500     '  DRAIN_WAIT '.                                             04480017
044600     05  WS-DRAIN-WAIT             PIC 9(04)   VALUE 0.           04490017
044700                                                                  04500017
044800 01  WS-COMMON-REORG-LINE3.                                       04510017
044900     05  FILLER                    PIC X(08)   VALUE              04520017
045000     '  RETRY '.                                                  04530017
045100     05  WS-RETRY                  PIC 9(03)   VALUE 0.           04540017
045200                                                                  04550017
045300 01  WS-COMMON-REORG-LINE4.                                       04560017
045400     05  FILLER                    PIC X(14)   VALUE              04570017
045500     '  RETRY_DELAY '.                                            04580017
045600     05  WS-RETRY-DELAY            PIC 9(04)   VALUE 0.           04590017
045700                                                                  04600017
045800 01  WS-COMMON-REORG-LINE5         PIC X(14)   VALUE              04610017
045900     '  TIMEOUT TERM'.                                            04620017
046000                                                                  04630017
046100 01  WS-COMMON-REORG-LINE6.                                       04640017
046200     05  FILLER                    PIC X(08)   VALUE              04650017
046300     '  MAXRO '.                                                  04660017
046400     05  WS-MAXRO                  PIC X(05)   VALUE SPACES.      04670017
046500                                                                  04680017
046600 01  WS-COMMON-REORG-LINE7.                                       04690017
046700     05  FILLER                    PIC X(10)   VALUE              04700017
046800     '  LONGLOG '.                                                04710017
046900     05  WS-LONGLOG                PIC X(08)   VALUE SPACES.      04720017
047000     05  FILLER                    PIC X(09)   VALUE              04730017
047100     '   DELAY '.                                                 04740017
047200     05  WS-DELAY                  PIC 9(04)   VALUE ZEROES.      04750017
047300                                                                  04760017
047400 01  WS-COMMON-REORG-LINE8.                                       04770017
047500     05  FILLER                    PIC X(08)   VALUE              04780017
047600     '  DRAIN '.                                                  04790017
047700     05  WS-DRAIN                  PIC X(07)   VALUE SPACES.      04800017
047800                                                                  04810017
047900 01  WS-COMMON-REORG-LINE9.                                       04820017
048000     05  FILLER                    PIC X(11)   VALUE              04830017
048100     '  DEADLINE '.                                               04840017
048200     05  WS-DEADLINE               PIC X(52)   VALUE SPACES.      04850017
048300                                                                  04860017
048400 01  WS-OPTIONS-LINE.                                             04870017
048500     05  FILLER                    PIC X(29)   VALUE              04880017
048600     'OPTIONS EVENT(ITEMERROR,SKIP)'.                             04890017
048700                                                                  04900017
048800                                                                  04910017
048900***************************************************************** 04920017
049000*** ALTER PRIQTY/SECQTY STATEMENTS.                           *** 04930017
049100***************************************************************** 04940017
049200                                                                  04950017
049300 01  WS-ALTER-TS-STMT.                                            04960017
049400     05  FILLER                    PIC X(18)   VALUE              04970017
049500     ' ALTER TABLESPACE '.                                        04980017
049600     05  WS-ALT-TS-DB-TS           PIC X(17)   VALUE SPACES.      04990017
049700     05  FILLER                    PIC X(01)   VALUE SPACE.       05000017
049800     05  WS-ALT-TS-PART-KEYWORD    PIC X(04)   VALUE SPACES.      05010017
049900     05  FILLER                    PIC X(01)   VALUE SPACE.       05020017
050000     05  WS-ALT-TS-PARTITION       PIC X(05)   VALUE SPACES.      05030017
050100                                                                  05040017
050110 01  FILLER REDEFINES WS-ALTER-TS-STMT.                           05050017
050120     05  FILLER                    PIC X(18).                     05060017
050140     05  WS-ALT-DB                 PIC X(08).                     05070017
050150     05  FILLER                    PIC X(01).                     05080017
050160     05  WS-ALT-TS                 PIC X(08).                     05090017
050190                                                                  05100017
050200 01  WS-ALTER-IX-STMT-01.                                         05110017
050300     05  FILLER                    PIC X(13)   VALUE              05120017
050400     ' ALTER INDEX '.                                             05130017
050500                                                                  05140017
050600 01  WS-ALTER-IX-STMT-02.                                         05150017
050700     05  FILLER                    PIC X(05)   VALUE 'PART '.     05160017
050800     05  WS-ALT-IX-PARTITION       PIC X(05)   VALUE SPACES.      05170017
050900                                                                  05180017
051000 01  WS-ALTER-SPACE-STMT.                                         05190017
051100     05  FILLER                    PIC X(03)   VALUE SPACE.       05200017
051200     05  FILLER                    PIC X(08)   VALUE ' PRIQTY '.  05210017
051300     05  WS-ALT-PRIQTY             PIC 9(18)   VALUE 0.           05220017
051400     05  FILLER                    PIC X(08)   VALUE ' SECQTY '.  05230017
051500     05  WS-ALT-SECQTY             PIC 9(18)   VALUE 0.           05240017
051600     05  FILLER                    PIC X(01)   VALUE ';'.         05250017
051700                                                                  05260017
051800                                                                  05270017
051900*  DBT_DTE_DICTBUILT                                              05280017
052000     EXEC SQL                                                     05290017
052100         INCLUDE DBT00016                                         05300017
052200     END-EXEC.                                                    05310017
052300                                                                  05320017
052400*  SYSIBM.SYSINDEXES                                              05330017
052500     EXEC SQL                                                     05340017
052600         INCLUDE SYSINDEX                                         05350017
052700     END-EXEC.                                                    05360017
052800                                                                  05370017
052900*  SYSIBM.SYSINDEXPART                                            05380017
053000     EXEC SQL                                                     05390017
053100         INCLUDE SYSIXPT                                          05400017
053200     END-EXEC.                                                    05410017
053300                                                                  05420017
053400*  SYSIBM.SYSTABLEPART                                            05430017
053500     EXEC SQL                                                     05440017
053600         INCLUDE SYSTABPT                                         05450017
053700     END-EXEC.                                                    05460017
053800                                                                  05470017
053900*  SYSIBM.SYSTABLEPART_HIST                                       05480017
054000     EXEC SQL                                                     05490017
054100         INCLUDE SYSTBPTH                                         05500017
054200     END-EXEC.                                                    05510017
054300                                                                  05520017
054400*  SYSIBM.SYSTABLES                                               05530017
054500     EXEC SQL                                                     05540017
054600         INCLUDE SYSTABLE                                         05550017
054700     END-EXEC.                                                    05560017
054800                                                                  05570017
054900*  SYSIBM.SYSTABLESPACE                                           05580017
055000     EXEC SQL                                                     05590017
055100         INCLUDE SYSTABSP                                         05600017
055200     END-EXEC.                                                    05610017
055300                                                                  05620017
055400*  SYSIBM.SYSTABLESPACESTATS                                      05630017
055500     EXEC SQL                                                     05640017
055600         INCLUDE SYSRTSTS                                         05650017
055700     END-EXEC.                                                    05660017
055800                                                                  05670017
055900*  SYSIBM.SYSINDEXSPACESTATS                                      05680017
056000     EXEC SQL                                                     05690017
056100         INCLUDE SYSRTSIX                                         05700017
056200     END-EXEC.                                                    05710017
056300                                                                  05720017
056400                                                                  05730017
056500     EXEC SQL                                                     05740017
056600         DECLARE INDEX-CURSOR CURSOR FOR                          05750017
056700             SELECT IX.CREATOR, IX.NAME, IX.DBID,                 05760017
056800              IX.ISOBID, IP.PQTY, IP.SQTY, IP.SECQTYI, IP.SPACE   05770017
056900                 FROM SYSIBM.SYSTABLES    TBL,                    05780017
057000                      SYSIBM.SYSINDEXES   IX,                     05790017
057100                      SYSIBM.SYSINDEXPART IP                      05800017
057200             WHERE TBL.DBNAME   = :WS-IX-CSR-DATABASE             05810017
057300               AND TBL.TSNAME   = :WS-IX-CSR-TABLESPACE           05820017
057400               AND TBL.TYPE     IN ('T','X')                      05830017
057500               AND TBL.CREATOR  = IX.TBCREATOR                    05840017
057600               AND TBL.NAME     = IX.TBNAME                       05850017
057700               AND IX.CREATOR   = IP.IXCREATOR                    05860017
057800               AND IX.NAME      = IP.IXNAME                       05870017
057900               AND IP.PARTITION = :WS-HOSTVAR-PART                05880017
058000                 ORDER BY TBL.CREATOR, TBL.NAME, IX.NAME          05890017
058100         WITH UR                                                  05900017
058200     END-EXEC.                                                    05910017
058300                                                                  05920017
058400                                                                  05930017
058500     EXEC SQL                                                     05940017
058600         INCLUDE SQLCA                                            05950017
058700     END-EXEC.                                                    05960017
058800                                                                  05970017
058900                                                                  05980017
059000                                                                  05990017
059100 PROCEDURE DIVISION.                                              06000017
059200                                                                  06010017
059300***************************************************************** 06020017
059400*** OPEN FILES, INITIALIZATIONS, READ THROUGH INPUT FILE,     *** 06030017
059500*** CLOSE FILES.                                              *** 06040017
059600***************************************************************** 06050017
059700                                                                  06060017
059800 0000-PROGRAM-MAINLINE SECTION.                                   06070017
059900                                                                  06080017
060000     OPEN INPUT  THRESHOLD-VALUES-FILE                            06090017
060100                 REORG-SCOPE-FILE.                                06100017
060200                                                                  06110017
060300     OPEN OUTPUT TS-REORG-KEEPDICT-FILE                           06120017
060400                 TS-REORG-NOKEEPDICT-FILE                         06130017
060500                 TS-REORG-LOB-FILE                                06140017
060600                 IX-REORG-FILE                                    06150017
060700                 ALTER-QTY-FILE.                                  06160017
060800                                                                  06170017
060900     READ THRESHOLD-VALUES-FILE INTO WS-THRESHOLD-VALUES-RECORD   06180017
061000         AT END                                                   06190017
061100             DISPLAY '******************************************' 06200017
061200             DISPLAY '*** PROGRAM ERROR - DBKUT006           ***' 06210017
061300             DISPLAY '***                                    ***' 06220017
061400             DISPLAY '*** PARAGRAPH 0000-PROGRAM-MAINLINE    ***' 06230017
061500             DISPLAY '*** EMPTY THRESHOLD CONTROL FILE       ***' 06240017
061600             DISPLAY '******************************************' 06250017
061700             MOVE +4008 TO WS-ABEND-CODE                          06260017
061800             PERFORM 9999-ABEND.                                  06270017
061900                                                                  06280017
063500     MOVE WS-THRESHOLD-DRAIN-WAIT  TO WS-DRAIN-WAIT.              06440017
063600     MOVE WS-THRESHOLD-RETRY       TO WS-RETRY.                   06450017
063700     MOVE WS-THRESHOLD-RETRY-DELAY TO WS-RETRY-DELAY.             06460017
063710     MOVE WS-THRESHOLD-DEADLINE    TO WS-DEADLINE.                06470017
063800                                                                  06480017
063900     PERFORM 1000-READ-SCOPE-FILE THRU 1000-EXIT                  06490017
064000         UNTIL WS-SCOPE-EOF = 'Y'.                                06500017
064100                                                                  06510017
064200     IF WS-SHRLEVEL = 'C'                                         06520017
064300         AND (WS-TS-REORG-COUNT-KEEPDICT > 0                      06530017
064400                OR WS-TS-REORG-COUNT-NOKEEPDICT > 0               06540017
064410                OR WS-LOB-TS-REORG-COUNT > 0                      06550017
064500                OR WS-IX-REORG-COUNT > 0)                         06560017
064600         PERFORM 1105-SETUP-CHANGE-REORG THRU 1105-EXIT           06570017
064700     END-IF.                                                      06580017
064800                                                                  06590017
064900     PERFORM 1100-WRITE-TS-REORG-STMTS THRU 1100-EXIT.            06600017
065000                                                                  06610017
065100     PERFORM 1200-WRITE-IX-REORG-STMTS THRU 1200-EXIT.            06620017
065200                                                                  06630017
065300     CLOSE THRESHOLD-VALUES-FILE                                  06640017
065400           REORG-SCOPE-FILE                                       06650017
065500           TS-REORG-KEEPDICT-FILE                                 06660017
065600           TS-REORG-NOKEEPDICT-FILE                               06670017
065700           TS-REORG-LOB-FILE                                      06680017
065800           IX-REORG-FILE                                          06690017
065900           ALTER-QTY-FILE.                                        06700017
066000                                                                  06710017
066100     GOBACK.                                                      06720017
066200                                                                  06730017
066300                                                                  06740017
066400 1000-READ-SCOPE-FILE.                                            06750017
066500                                                                  06760017
066600***************************************************************** 06770017
066700*** THIS FILE CONTAINS THE SYSOUT FROM A REORG THAT WAS RUN   *** 06780017
066800*** USING OPTIONS PREVIEW TO EXPAND THE LISTDEF STATEMENT.    *** 06790017
066900*** THE TABLESPACES TO BE CHECKED FOR REORG ARE PARSED FROM   *** 06800017
067000*** THIS FILE.  INDEXES WILL BE DERIVED FROM THE DB2 CATALOG  *** 06810017
067100*** FOR EACH TABLESPACE.                                      *** 06820017
067200***                                                           *** 06830017
067300*** PROCESSING:                                               *** 06840017
067400*** -----------                                               *** 06850017
068100*** CHECK FOR DB2 MESSAGE DSNU1010I.  THIS MESSAGE OCCURS     *** 06920017
068200*** ONCE AND PRECEDES A GENERATED LISTDEF CONTAINING ALL      *** 06930017
068300*** EVALUATED INCLUDE AND EXCLUDE CLAUSES.                    *** 06940017
068400***                                                           *** 06950017
068500*** FOLLOWING A HIT ON THE DSNU1010I MESSAGE, BEGIN PROCESSING*** 06960017
068600*** THE GENERATED INCLUDE STATEMENTS.  THEY WILL CONTAIN THE  *** 06970017
068700*** DATABASE AND TABLESPACE NAMES AND PARTITION NUMBERS (IF   *** 06980017
068800*** APPLICABLE).                                              *** 06990017
068900***                                                           *** 07000017
069000*** CHECK FOR DB2 MESSAGE DSNU050I.  ONE VERSION OF THIS      *** 07010017
069100*** MESSAGE WILL CONTAIN THE SHRLEVEL TYPE (REFERENCE OR      *** 07020017
069200*** CHANGE).  THE SHRLEVEL TYPE WILL DETERMINE WHAT KEYWORDS  *** 07030017
069300*** NEED TO BE GENERATED FOR THE REORG STATEMENT.             *** 07040017
069400***                                                           *** 07050017
069500***************************************************************** 07060017
069600                                                                  07070017
069700     READ REORG-SCOPE-FILE INTO WS-SCOPE-RECORD                   07080017
069800         AT END                                                   07090017
069900             MOVE 'Y'  TO  WS-SCOPE-EOF                           07100017
070000             PERFORM 4001-NPI-CHECK THRU 4001-EXIT                07110017
070100             GO TO 1000-EXIT.                                     07120017
070200                                                                  07130017
070700     IF WS-DSNU-MSG = 'DSNU050I '                                 07180017
070800         PERFORM 1010-PROCESS-DSNU050I THRU 1010-EXIT             07190017
070900         GO TO 1000-EXIT.                                         07200017
071000                                                                  07210017
071100     IF WS-DSNU-MSG = 'DSNU1010I'                                 07220017
071200         MOVE 'Y' TO WS-DSNU1010I-HIT                             07230017
071300         GO TO 1000-EXIT.                                         07240017
071400                                                                  07250017
071500     IF WS-DSNU1010I-HIT = 'Y'                                    07260017
071600         AND WS-INCLUDE-KEYWORD = 'INCLUDE TABLESPACE'            07270017
071700             PERFORM 2000-PROCESS-INCLUDE THRU 2000-EXIT.         07280017
071800                                                                  07290017
071900 1000-EXIT.                                                       07300017
072000      EXIT.                                                       07310017
072100                                                                  07320017
072200                                                                  07330017
076800 1010-PROCESS-DSNU050I.                                           07790017
076900                                                                  07800017
077000***************************************************************** 07810017
077100*** PARSE THE DSNU050I LINE FOR THE SHRLEVEL TYPE.            *** 07820017
077200***************************************************************** 07830017
077300                                                                  07840017
077400     MOVE SPACES TO WS-DSNU050I-LINE.                             07850017
077500                                                                  07860017
077600     UNSTRING WS-SCOPE-RECORD DELIMITED BY ALL SPACE              07870017
077700       INTO WS-DSNU050I-LIT1                                      07880017
077800            WS-DSNU050I-LIT2                                      07890017
077900            WS-DSNU050I-LIT3                                      07900017
078000            WS-DSNU050I-LIT4                                      07910017
078100            WS-DSNU050I-LIT5                                      07920017
078200            WS-DSNU050I-LIT6                                      07930017
078300            WS-DSNU050I-LIT7                                      07940017
078400            WS-DSNU050I-LIT8                                      07950017
078500            WS-DSNU050I-LIT9                                      07960017
078600            WS-DSNU050I-LIT10                                     07970017
078700            WS-DSNU050I-LIT11                                     07980017
078800            WS-DSNU050I-LIT12                                     07990017
078900     END-UNSTRING.                                                08000017
079000                                                                  08010017
079100     IF WS-DSNU050I-LIT6     = 'REORG'                            08020017
079200       AND WS-DSNU050I-LIT7  = 'TABLESPACE'                       08030017
079300       AND WS-DSNU050I-LIT8  = 'LIST'                             08040017
079400       AND WS-DSNU050I-LIT10 = 'SHRLEVEL'                         08050017
079500         NEXT SENTENCE                                            08060017
079600     ELSE                                                         08070017
079700         GO TO 1010-EXIT.                                         08080017
079800                                                                  08090017
079900     IF WS-DSNU050I-LIT11 = 'REFERENCE'                           08100017
080000         MOVE 'R' TO WS-SHRLEVEL                                  08110017
080100     ELSE                                                         08120017
080200         IF WS-DSNU050I-LIT11 = 'CHANGE'                          08130017
080300             MOVE 'C' TO WS-SHRLEVEL                              08140017
080400         ELSE                                                     08150017
080500             DISPLAY '******************************************' 08160017
080600             DISPLAY '*** PROGRAM ERROR - DBKUT006           ***' 08170017
080700             DISPLAY '***                                    ***' 08180017
080800             DISPLAY '*** PARAGRAPH 1010-PROCESS-DSNU050I    ***' 08190017
080900             DISPLAY '*** INVALID SHRLEVEL                   ***' 08200017
081000             DISPLAY '***  '    WS-DSNU050I-LIT11 '               08210017
081100-    '        ***'                                                08220017
081200             DISPLAY '******************************************' 08230017
081300             MOVE +4008 TO WS-ABEND-CODE                          08240017
081400             PERFORM 9999-ABEND.                                  08250017
081500                                                                  08260017
081600 1010-EXIT.                                                       08270017
081700     EXIT.                                                        08280017
081800                                                                  08290017
081900                                                                  08300017
082000 1100-WRITE-TS-REORG-STMTS.                                       08310017
082100                                                                  08320017
082200***************************************************************** 08330017
082300*** WRITE REORG TABLESPACE STATEMENTS                         *** 08340017
082400***************************************************************** 08350017
082500                                                                  08360017
082600     IF WS-TS-REORG-COUNT-KEEPDICT        = 0                     08370017
082700         AND WS-TS-REORG-COUNT-NOKEEPDICT = 0                     08380017
082800         AND WS-LOB-TS-REORG-COUNT        = 0                     08390017
082900             MOVE SPACES TO TS-REORG-KEEPDICT-RECORD              08400017
083000                            TS-REORG-NOKEEPDICT-RECORD            08410017
083100                            TS-REORG-LOB-RECORD                   08420017
083200             WRITE TS-REORG-KEEPDICT-RECORD                       08430017
083300             WRITE TS-REORG-NOKEEPDICT-RECORD                     08440017
083400             WRITE TS-REORG-LOB-RECORD                            08450017
083500             GO TO 1100-EXIT                                      08460017
083600     END-IF.                                                      08470017
083700                                                                  08480017
083800     IF WS-TS-REORG-COUNT-KEEPDICT > 0                            08490017
083900         PERFORM 1110-WRITE-TS-KEEPDICT-STMTS THRU 1110-EXIT      08500017
084000     ELSE                                                         08510017
084100         MOVE SPACES TO TS-REORG-KEEPDICT-RECORD                  08520017
084200         WRITE TS-REORG-KEEPDICT-RECORD                           08530017
084300     END-IF.                                                      08540017
084400                                                                  08550017
084500     IF WS-TS-REORG-COUNT-NOKEEPDICT > 0                          08560017
084600         PERFORM 1120-WRITE-TS-NOKEEPDICT-STMTS THRU 1120-EXIT    08570017
084700     ELSE                                                         08580017
084800         MOVE SPACES TO TS-REORG-NOKEEPDICT-RECORD                08590017
084900         WRITE TS-REORG-NOKEEPDICT-RECORD                         08600017
085000     END-IF.                                                      08610017
085100                                                                  08620017
085200     IF WS-LOB-TS-REORG-COUNT > 0                                 08630017
085300         PERFORM 1150-WRITE-LOB-TS-STMTS THRU 1150-EXIT           08640017
085400     ELSE                                                         08650017
085500         MOVE SPACES TO TS-REORG-LOB-RECORD                       08660017
085600         WRITE TS-REORG-LOB-RECORD                                08670017
085700     END-IF.                                                      08680017
085800                                                                  08690017
085900                                                                  08700017
086000 1100-EXIT.                                                       08710017
086100      EXIT.                                                       08720017
086200                                                                  08730017
086300                                                                  08740017
086400 1105-SETUP-CHANGE-REORG.                                         08750017
086500                                                                  08760017
086600***************************************************************** 08770017
086700*** PREP WORK FOR GENERATING SHRLEVEL CHANGE REORG            *** 08780017
086800*** -  READ ONLINE KEYWORD VALUES FROM CONTROL CARD           *** 08790017
086900*** -  INITIALIZE REORG CONTROL STATEMENT KEYWORDS            *** 08800017
087100***************************************************************** 08820017
087200                                                                  08830017
087300     OPEN INPUT SHRLVL-CHANGE-PARMS-FILE.                         08840017
087400                                                                  08850017
087500     READ SHRLVL-CHANGE-PARMS-FILE                                08860017
087600       INTO WS-SHRLEVEL-CHANGE-PARMS-REC                          08870017
087700         AT END                                                   08880017
087800             DISPLAY '******************************************' 08890017
087900             DISPLAY '*** PROGRAM ERROR - DBKUT006           ***' 08900017
088000             DISPLAY '***                                    ***' 08910017
088100             DISPLAY '*** PARAGRAPH 1105-SETUP-CHANGE-REORG  ***' 08920017
088200             DISPLAY '*** EMPTY REORG PARMS CONTROL FILE     ***' 08930017
088300             DISPLAY '******************************************' 08940017
088400             MOVE +4008 TO WS-ABEND-CODE                          08950017
088500             PERFORM 9999-ABEND.                                  08960017
088600                                                                  08970017
088700     CLOSE SHRLVL-CHANGE-PARMS-FILE.                              08980017
088800                                                                  08990017
088900     MOVE WS-IN-MAXRO    TO WS-MAXRO.                             09000017
089000     MOVE WS-IN-LONGLOG  TO WS-LONGLOG.                           09010017
089100     MOVE WS-IN-DELAY    TO WS-DELAY.                             09020017
089200     MOVE WS-IN-DRAIN    TO WS-DRAIN.                             09030017
089400                                                                  09040017
090100                                                                  09110017
090200 1105-EXIT.                                                       09120017
090300      EXIT.                                                       09130017
090400                                                                  09140017
090500                                                                  09150017
090600 1110-WRITE-TS-KEEPDICT-STMTS.                                    09160017
090700                                                                  09170017
090800***************************************************************** 09180017
090900*** WRITE REORG TABLESPACE STATEMENTS USING KEEPDICTIONARY.   *** 09190017
091000***************************************************************** 09200017
091100                                                                  09210017
091200     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-OPTIONS-LINE.         09220017
091300                                                                  09230017
091400     MOVE SPACES TO TS-REORG-KEEPDICT-RECORD.                     09240017
091500     WRITE TS-REORG-KEEPDICT-RECORD.                              09250017
091600                                                                  09260017
091700     WRITE TS-REORG-KEEPDICT-RECORD                               09270017
091800         FROM WS-TS-KEEPDICT-REORG-LINE1.                         09280017
091900                                                                  09290017
092000     PERFORM                                                      09300017
092100         VARYING WS-TS-KEEPDICT-IDX                               09310017
092200         FROM 1 BY 1                                              09320017
092300         UNTIL WS-TS-KEEPDICT-IDX >                               09330017
092400               WS-TS-REORG-COUNT-KEEPDICT                         09340017
092500             MOVE SPACES TO WS-TS-REORG-DB-TS                     09350017
092600             STRING WS-TS-KEEPDICT-DB (WS-TS-KEEPDICT-IDX)        09360017
092700                                   DELIMITED BY ' '               09370017
092800                    '.'            DELIMITED BY SIZE              09380017
092900                    WS-TS-KEEPDICT-TS (WS-TS-KEEPDICT-IDX)        09390017
093000                                   DELIMITED BY SIZE              09400017
093100                    INTO WS-TS-REORG-DB-TS                        09410017
093200             IF WS-TS-KEEPDICT-PART (WS-TS-KEEPDICT-IDX)          09420017
093300                     = SPACES                                     09430017
093400                 MOVE SPACES TO WS-TS-REORG-PART-LIT              09440017
093500                                WS-TS-REORG-PART-NBR              09450017
093600                                WS-TS-REORG-RPARAN-LIT            09460017
093700             ELSE                                                 09470017
093800                 MOVE ' PARTLEVEL (' TO WS-TS-REORG-PART-LIT      09480017
093900                 MOVE WS-TS-KEEPDICT-PART (WS-TS-KEEPDICT-IDX)    09490017
094000                     TO WS-TS-REORG-PART-NBR                      09500017
094100                 MOVE ')' TO WS-TS-REORG-RPARAN-LIT               09510017
094200             END-IF                                               09520017
094300             WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE209530017
094400     END-PERFORM.                                                 09540017
094500                                                                  09550017
094600     MOVE SPACES TO TS-REORG-KEEPDICT-RECORD.                     09560017
094700     WRITE TS-REORG-KEEPDICT-RECORD.                              09570017
094800     WRITE TS-REORG-KEEPDICT-RECORD                               09580017
094900         FROM WS-TS-REORG-LINE3-KEEPDICT.                         09590017
095000                                                                  09600017
095000     IF WS-THRESHOLD-LISTPARTS > 0                                09610017
095000         MOVE WS-THRESHOLD-LISTPARTS TO WS-TS-REORG-LISTPARTS     09620017
095300         WRITE TS-REORG-KEEPDICT-RECORD                           09630017
095400             FROM WS-TS-REORG-LINE15                              09640017
095000     END-IF.                                                      09650017
095000                                                                  09660017
095100     IF WS-SHRLEVEL = 'R'                                         09670017
095200         MOVE 'REFERENCE' TO WS-REORG-SHRLEVEL                    09680017
095300         WRITE TS-REORG-KEEPDICT-RECORD                           09690017
095400             FROM WS-COMMON-REORG-LINE1                           09700017
095500         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE14   09710017
095500         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE5    09720017
095600         WRITE TS-REORG-KEEPDICT-RECORD                           09730017
095700             FROM WS-TS-REORG-LINE12                              09740017
095800         WRITE TS-REORG-KEEPDICT-RECORD                           09750017
095900             FROM WS-TS-REORG-LINE13                              09760017
096000     ELSE                                                         09770017
096100         MOVE 'CHANGE'    TO WS-REORG-SHRLEVEL                    09780017
096200         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE109790017
095500         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE14   09800017
096400         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE12   09820017
096500         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE13   09830017
096600         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE609840017
096700         WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE709850017
096800         WRITE TS-REORG-KEEPDICT-RECORD                           09860017
096810           FROM WS-COMMON-REORG-LINE8.                            09870017
096820                                                                  09880017
096900     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE9.   09890017
097100     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE7.       09900017
097200     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE8.       09910017
097300     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-TS-REORG-LINE10.      09920017
097400     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE2.   09930017
097500     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE3.   09940017
097600     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE4.   09950017
097700     WRITE TS-REORG-KEEPDICT-RECORD FROM WS-COMMON-REORG-LINE5.   09960017
097800                                                                  09970017
097900 1110-EXIT.                                                       09980017
098000      EXIT.                                                       09990017
098100                                                                  10000017
098200                                                                  10010017
098300 1120-WRITE-TS-NOKEEPDICT-STMTS.                                  10020017
098400                                                                  10030017
098500***************************************************************** 10040017
098600*** WRITE REORG TABLESPACE STATEMENTS WITHOUT KEEPDICTIONARY. *** 10050017
098700***************************************************************** 10060017
098800                                                                  10070017
098900     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-OPTIONS-LINE.       10080017
099000                                                                  10090017
099100     MOVE SPACES TO TS-REORG-NOKEEPDICT-RECORD.                   10100017
099200     WRITE TS-REORG-NOKEEPDICT-RECORD.                            10110017
099300                                                                  10120017
099400     WRITE TS-REORG-NOKEEPDICT-RECORD                             10130017
099500         FROM WS-TS-NOKEEPDICT-REORG-LINE1.                       10140017
099600                                                                  10150017
099700     PERFORM                                                      10160017
099800         VARYING WS-TS-NOKEEPDICT-IDX                             10170017
099900         FROM 1 BY 1                                              10180017
100000         UNTIL WS-TS-NOKEEPDICT-IDX >                             10190017
100100               WS-TS-REORG-COUNT-NOKEEPDICT                       10200017
100200             MOVE SPACES TO WS-TS-REORG-DB-TS                     10210017
100300             STRING WS-TS-NOKEEPDICT-DB (WS-TS-NOKEEPDICT-IDX)    10220017
100400                                   DELIMITED BY ' '               10230017
100500                    '.'            DELIMITED BY SIZE              10240017
100600                    WS-TS-NOKEEPDICT-TS (WS-TS-NOKEEPDICT-IDX)    10250017
100700                                   DELIMITED BY SIZE              10260017
100800                    INTO WS-TS-REORG-DB-TS                        10270017
100900             IF WS-TS-NOKEEPDICT-PART (WS-TS-NOKEEPDICT-IDX)      10280017
101000                     = SPACES                                     10290017
101100                 MOVE SPACES TO WS-TS-REORG-PART-LIT              10300017
101200                                WS-TS-REORG-PART-NBR              10310017
101300                                WS-TS-REORG-RPARAN-LIT            10320017
101400             ELSE                                                 10330017
101500                 MOVE ' PARTLEVEL (' TO WS-TS-REORG-PART-LIT      10340017
101600                 MOVE WS-TS-NOKEEPDICT-PART (WS-TS-NOKEEPDICT-IDX)10350017
101700                     TO WS-TS-REORG-PART-NBR                      10360017
101800                 MOVE ')' TO WS-TS-REORG-RPARAN-LIT               10370017
101900             END-IF                                               10380017
102000             WRITE TS-REORG-NOKEEPDICT-RECORD                     10390017
102100                 FROM WS-TS-REORG-LINE2                           10400017
102200     END-PERFORM.                                                 10410017
102300                                                                  10420017
102400     MOVE SPACES TO TS-REORG-NOKEEPDICT-RECORD.                   10430017
102500     WRITE TS-REORG-NOKEEPDICT-RECORD.                            10440017
102600     WRITE TS-REORG-NOKEEPDICT-RECORD                             10450017
102700         FROM WS-TS-REORG-LINE3-NOKEEPDICT.                       10460017
102800                                                                  10470017
095000     IF WS-THRESHOLD-LISTPARTS > 0                                10480017
095000         MOVE WS-THRESHOLD-LISTPARTS TO WS-TS-REORG-LISTPARTS     10481017
095300         WRITE TS-REORG-NOKEEPDICT-RECORD                         10482017
095400             FROM WS-TS-REORG-LINE15                              10483017
095000     END-IF.                                                      10484017
095000                                                                  10485017
102900     IF WS-SHRLEVEL = 'R'                                         10486017
103000         MOVE 'REFERENCE' TO WS-REORG-SHRLEVEL                    10487017
103100         WRITE TS-REORG-NOKEEPDICT-RECORD                         10488017
103200             FROM WS-COMMON-REORG-LINE1                           10489017
095500         WRITE TS-REORG-NOKEEPDICT-RECORD                         10490017
                   FROM WS-TS-REORG-LINE14                              10500017
103300         WRITE TS-REORG-NOKEEPDICT-RECORD                         10510017
103400             FROM WS-TS-REORG-LINE5                               10520017
103500         WRITE TS-REORG-NOKEEPDICT-RECORD                         10530017
103600             FROM WS-TS-REORG-LINE12                              10540017
103700         WRITE TS-REORG-NOKEEPDICT-RECORD                         10550017
103800             FROM WS-TS-REORG-LINE13                              10560017
103900     ELSE                                                         10570017
104000         MOVE 'CHANGE'    TO WS-REORG-SHRLEVEL                    10580017
104100         WRITE TS-REORG-NOKEEPDICT-RECORD                         10590017
104200             FROM WS-COMMON-REORG-LINE1                           10600017
095500         WRITE TS-REORG-NOKEEPDICT-RECORD                         10610017
                   FROM WS-TS-REORG-LINE14                              10620017
104500         WRITE TS-REORG-NOKEEPDICT-RECORD                         10650017
104600             FROM WS-TS-REORG-LINE12                              10660017
104700         WRITE TS-REORG-NOKEEPDICT-RECORD                         10670017
104800             FROM WS-TS-REORG-LINE13                              10680017
104900         WRITE TS-REORG-NOKEEPDICT-RECORD                         10690017
105000             FROM WS-COMMON-REORG-LINE6                           10700017
105100         WRITE TS-REORG-NOKEEPDICT-RECORD                         10710017
105200             FROM WS-COMMON-REORG-LINE7                           10720017
105300         WRITE TS-REORG-NOKEEPDICT-RECORD                         10730017
105400             FROM WS-COMMON-REORG-LINE8.                          10740017
105410                                                                  10750017
105500     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-COMMON-REORG-LINE9. 10760017
105800     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-TS-REORG-LINE7.     10770017
105900     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-TS-REORG-LINE8.     10780017
106000     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-COMMON-REORG-LINE2. 10790017
106100     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-COMMON-REORG-LINE3. 10800017
106200     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-COMMON-REORG-LINE4. 10810017
106300     WRITE TS-REORG-NOKEEPDICT-RECORD FROM WS-COMMON-REORG-LINE5. 10820017
106400                                                                  10830017
106500 1120-EXIT.                                                       10840017
106600      EXIT.                                                       10850017
106700                                                                  10860017
106800                                                                  10870017
106900 1150-WRITE-LOB-TS-STMTS.                                         10880017
107000                                                                  10890017
107100***************************************************************** 10900017
107200*** WRITE REORG TABLESPACE STATEMENTS FOR LOB TABLESPACES.    *** 10910017
107400***************************************************************** 10920017
107500                                                                  10930017
107600     WRITE TS-REORG-LOB-RECORD FROM WS-OPTIONS-LINE.              10940017
107700                                                                  10950017
107800     MOVE SPACES TO TS-REORG-LOB-RECORD.                          10960017
107900     WRITE TS-REORG-LOB-RECORD.                                   10970017
108000                                                                  10980017
108100     WRITE TS-REORG-LOB-RECORD FROM WS-LOB-TS-REORG-LINE1.        10990017
108200                                                                  11000017
108300     PERFORM                                                      11010017
108400         VARYING WS-LOB-TS-IDX                                    11020017
108500         FROM 1 BY 1                                              11030017
108600         UNTIL WS-LOB-TS-IDX >                                    11040017
108700               WS-LOB-TS-REORG-COUNT                              11050017
108800             MOVE SPACES TO WS-TS-REORG-DB-TS                     11060017
108900             STRING WS-LOB-TS-DB (WS-LOB-TS-IDX)                  11070017
109000                                   DELIMITED BY ' '               11080017
109100                    '.'            DELIMITED BY SIZE              11090017
109200                    WS-LOB-TS-TS (WS-LOB-TS-IDX)                  11100017
109300                                   DELIMITED BY SIZE              11110017
109400                    INTO WS-TS-REORG-DB-TS                        11120017
109500             MOVE SPACES TO WS-TS-REORG-PART-LIT                  11130017
109600                            WS-TS-REORG-PART-NBR                  11140017
109700                            WS-TS-REORG-RPARAN-LIT                11150017
109800             WRITE TS-REORG-LOB-RECORD FROM WS-TS-REORG-LINE2     11160017
109900     END-PERFORM.                                                 11170017
110000                                                                  11180017
110100     MOVE SPACES TO TS-REORG-LOB-RECORD.                          11190017
110200     WRITE TS-REORG-LOB-RECORD.                                   11200017
110300     WRITE TS-REORG-LOB-RECORD FROM WS-LOB-TS-REORG-LINE3.        11210017
110310                                                                  11220017
110311     IF WS-SHRLEVEL = 'R'                                         11230017
110312         MOVE 'REFERENCE' TO WS-REORG-SHRLEVEL                    11240017
110313         WRITE TS-REORG-LOB-RECORD                                11250017
110314             FROM WS-COMMON-REORG-LINE1                           11260017
110321     ELSE                                                         11270017
110322         MOVE 'CHANGE'    TO WS-REORG-SHRLEVEL                    11280017
110323         WRITE TS-REORG-LOB-RECORD                                11290017
110324             FROM WS-COMMON-REORG-LINE1                           11300017
110331         WRITE TS-REORG-LOB-RECORD                                11310017
110332             FROM WS-COMMON-REORG-LINE6                           11320017
110333         WRITE TS-REORG-LOB-RECORD                                11330017
110334             FROM WS-COMMON-REORG-LINE7                           11340017
110335         WRITE TS-REORG-LOB-RECORD                                11350017
110336             FROM WS-COMMON-REORG-LINE8.                          11360017
110337                                                                  11370017
110338     WRITE TS-REORG-LOB-RECORD FROM WS-COMMON-REORG-LINE9.        11380017
110339     WRITE TS-REORG-LOB-RECORD FROM WS-TS-REORG-LINE7.            11390017
110341     WRITE TS-REORG-LOB-RECORD FROM WS-COMMON-REORG-LINE2.        11400017
110342     WRITE TS-REORG-LOB-RECORD FROM WS-COMMON-REORG-LINE3.        11410017
110343     WRITE TS-REORG-LOB-RECORD FROM WS-COMMON-REORG-LINE4.        11420017
110344     WRITE TS-REORG-LOB-RECORD FROM WS-COMMON-REORG-LINE5.        11430017
111100                                                                  11440017
111200 1150-EXIT.                                                       11450017
111300      EXIT.                                                       11460017
111400                                                                  11470017
111500                                                                  11480017
111600 1200-WRITE-IX-REORG-STMTS.                                       11490017
111700                                                                  11500017
111800***************************************************************** 11510017
111900*** WRITE REORG INDEX STATEMENTS                              *** 11520017
112000***************************************************************** 11530017
112100                                                                  11540017
112200      MOVE SPACES TO IX-REORG-RECORD.                             11550017
112300      WRITE IX-REORG-RECORD.                                      11560017
112400                                                                  11570017
112500      IF WS-IX-REORG-COUNT = 0                                    11580017
112600          GO TO 1200-EXIT                                         11590017
112700      END-IF.                                                     11600017
112800                                                                  11610017
112900      WRITE IX-REORG-RECORD FROM WS-IX-REORG-LINE3.               11620017
113000                                                                  11630017
113100      IF WS-SHRLEVEL = 'R'                                        11640017
113200          MOVE 'REFERENCE' TO WS-REORG-SHRLEVEL                   11650017
113300          WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE1        11660017
113400      ELSE                                                        11670017
113500          MOVE 'CHANGE' TO WS-REORG-SHRLEVEL                      11680017
113600          WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE1        11690017
113700          WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE6        11700017
113800          WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE7        11710017
113900          WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE8.       11720017
113910                                                                  11730017
114000      WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE9.           11740017
114200      WRITE IX-REORG-RECORD FROM WS-IX-REORG-LINE4.               11750017
114300      WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE2.           11760017
114400      WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE3.           11770017
114500      WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE4.           11780017
114600      WRITE IX-REORG-RECORD FROM WS-COMMON-REORG-LINE5.           11790017
114700                                                                  11800017
114800 1200-EXIT.                                                       11810017
114900      EXIT.                                                       11820017
115000                                                                  11830017
115100                                                                  11840017
115200 2000-PROCESS-INCLUDE.                                            11850017
115300                                                                  11860017
115400***************************************************************** 11870017
115500*** PROCESS 'INCLUDE TABLESPACE' STATEMENT                    *** 11880017
115600*** --------------------------------------                    *** 11890017
115700*** 1) PARSE THE STATEMENT FOR DATABASE-TABLESPACE-PARTITION. *** 11900017
115800*** 2) PERFORM THRESHOLD CHECKS ON TABLESPACE AND INDEX       *** 11910017
115900***    STATISTICS.                                            *** 11920017
116000***************************************************************** 11930017
116100                                                                  11940017
116200      PERFORM 3000-PARSE-INCLUDE THRU 3000-EXIT.                  11950017
116300                                                                  11960017
116400      PERFORM 4000-CHECK-THRESHOLDS THRU 4000-EXIT.               11970017
116500                                                                  11980017
116600      MOVE WS-DATABASE   TO WS-PREV-DATABASE.                     11990017
116700      MOVE WS-TABLESPACE TO WS-PREV-TABLESPACE.                   12000017
116800                                                                  12010017
116900 2000-EXIT.                                                       12020017
117000     EXIT.                                                        12030017
117100                                                                  12040017
117200                                                                  12050017
117300 3000-PARSE-INCLUDE.                                              12060017
117400                                                                  12070017
117500***************************************************************** 12080017
117600*** PARSE THE INCLUDE TABLESPACE STATEMENT.  THE FORMAT IS AS *** 12090017
117700*** FOLLOWS (PARTLEVEL MAY OR MAY NOT BE PRESENT):            *** 12100017
117800***                                                           *** 12110017
117900***  INCLUDE TABLESPACE DATABASE.TABLESPACE PARTLEVEL(#####)  *** 12120017
118000***************************************************************** 12130017
118100                                                                  12140017
118200     MOVE SPACES TO WS-UNSTRING-LINE.                             12150017
118300                                                                  12160017
118400     UNSTRING WS-INCLUDE-LINE DELIMITED BY ALL SPACE OR '.'       12170017
118500       INTO WS-FILL                                               12180017
118600            WS-INCLUDE-LIT                                        12190017
118700            WS-TABLESPACE-LIT                                     12200017
118800            WS-DATABASE                                           12210017
118900            WS-TABLESPACE                                         12220017
119000            WS-PARTLEVEL                                          12230017
119100     END-UNSTRING.                                                12240017
119200                                                                  12250017
119300     IF WS-PARTLEVEL = SPACES                                     12260017
119400         MOVE 0 TO WS-PART-NBR                                    12270017
119500     ELSE                                                         12280017
119600         UNSTRING WS-PARTLEVEL DELIMITED BY 'PARTLEVEL(' OR ')'   12290017
119700           INTO WS-FILL                                           12300017
119800                WS-PART-CHAR                                      12310017
119900         END-UNSTRING                                             12320017
120000         MOVE WS-PART-NUMERIC TO WS-PART-NBR.                     12330017
120100                                                                  12340017
120200                                                                  12350017
120300 3000-EXIT.                                                       12360017
120400     EXIT.                                                        12370017
120500                                                                  12380017
120600                                                                  12390017
120700 4000-CHECK-THRESHOLDS.                                           12400017
120800                                                                  12410017
120900***************************************************************** 12420017
121000*** GET TABLESPACE-LEVEL INFORMATION.                         *** 12430017
121100*** GET TABLESPACE PARTITION-LEVEL STATISTICS.                *** 12440017
121200*** -- BYPASS REORG IF 'DEFINE NO' CLAUSE ON TABLESPACE       *** 12450017
121300*** -- (SPACE = -1).                                          *** 12460017
121400*** IF REALTIME REORG STATISTICS NOT FOUND, FORCE A REORG.    *** 12470017
121500*** BRANCH TO ROUTINES BASED ON TABLESPACE TYPE.              *** 12480017
121600***************************************************************** 12490017
121700                                                                  12500017
121800     IF (WS-DATABASE = WS-PREV-DATABASE                           12510017
121900           AND WS-TABLESPACE = WS-PREV-TABLESPACE)                12520017
122000         NEXT SENTENCE                                            12530017
122100     ELSE                                                         12540017
122200         IF (WS-PREV-DATABASE = SPACES                            12550017
122300               AND WS-PREV-TABLESPACE = SPACES)                   12560017
122400             PERFORM 4005-GET-TS-DETAILS THRU 4005-EXIT           12570017
122500         ELSE                                                     12580017
122600             PERFORM 4001-NPI-CHECK THRU 4001-EXIT                12590017
122700             PERFORM 4005-GET-TS-DETAILS THRU 4005-EXIT           12600017
122800         END-IF                                                   12610017
122900     END-IF.                                                      12620017
123000                                                                  12630017
123100     PERFORM 4010-GET-TS-PART-STATS THRU 4010-EXIT.               12640017
123200                                                                  12650017
123300     IF SYSTBPT-SPACE = -1                                        12660017
123400         MOVE 'N' TO WS-TS-REORG                                  12670017
123500     ELSE                                                         12680017
123600         IF (TS-TOTALROWS-NULLIND            < 0                  12690017
123700              OR TS-SPACE-NULLIND            < 0                  12700017
123800              OR TS-EXTENTS-NULLIND          < 0                  12710017
123900              OR TS-REORGUNCLUSTINS-NULLIND  < 0                  12720017
124000              OR TS-REORGDISORGLOB-NULLIND   < 0                  12730017
124100              OR TS-REORGNEARINDREF-NULLIND  < 0                  12740017
124200              OR TS-REORGFARINDREF-NULLIND   < 0                  12750017
124300              OR TS-REORGINSERTS-NULLIND     < 0                  12760017
124400              OR TS-REORGDELETES-NULLIND     < 0                  12770017
124500              OR TS-REORGUPDATES-NULLIND     < 0                  12780017
124510              OR TS-NPAGES-NULLIND           < 0)                 12790017
124600             MOVE 'Y' TO WS-TS-REORG                              12800017
124700         ELSE                                                     12810017
124800             MOVE 'N' TO WS-TS-REORG                              12820017
124900         END-IF                                                   12830017
125000     END-IF.                                                      12840017
125100                                                                  12850017
125200     IF SYSTABSP-TYPE = 'O'                                       12860017
125300         PERFORM 4020-CHECK-LOB-THRESHOLDS THRU 4020-EXIT         12870017
125400     ELSE                                                         12880017
125500         PERFORM 4030-CHECK-NONLOB-THRESHOLDS THRU 4030-EXIT.     12890017
125600                                                                  12900017
125700     IF WS-TS-REORG = 'Y'                                         12910017
125800         PERFORM 7000-REORG-TS THRU 7000-EXIT                     12920017
125900         MOVE 'Y' TO WS-TS-PART-REORGED                           12930017
126000     END-IF.                                                      12940017
126100                                                                  12950017
126200 4000-EXIT.                                                       12960017
126300     EXIT.                                                        12970017
126400                                                                  12980017
126500                                                                  12990017
126600 4001-NPI-CHECK.                                                  13000017
126700                                                                  13010017
126800***************************************************************** 13020017
126900*** AFTER COMPLETING PROCESSING FOR A TABLESPACE, IF THE      *** 13030017
127000*** TABLESPACE IS PARTITIONED CHECK ANY NON-PARTITIONED       *** 13040017
127100*** INDEXES FOR REORG ELIGIBILITY AND/OR RESIZING.            *** 13050017
127200***-----------------------------------------------------------*** 13060017
127300***   WS-TS-PART-REORGED WILL BE SET TO 'Y' IF ANY PARTITIONS *** 13070017
127400***   FOR THE TABLESPACE HAD QUALIFIED FOR A REORG.           *** 13080017
127500***************************************************************** 13090017
127600                                                                  13100017
127700     IF WS-PARTITIONED-TSPACE = 'Y'                               13110017
127800         NEXT SENTENCE                                            13120017
127900     ELSE                                                         13130017
128000         MOVE 'N' TO WS-TS-PART-REORGED                           13140017
128100         GO TO 4001-EXIT.                                         13150017
128200                                                                  13160017
128300     MOVE 'N' TO WS-PARTITIONED-INDEX.                            13170017
128400     MOVE WS-PREV-DATABASE TO WS-IX-CSR-DATABASE.                 13180017
128500     MOVE WS-PREV-TABLESPACE TO WS-IX-CSR-TABLESPACE.             13190017
128600     IF WS-TS-PART-REORGED = 'Y'                                  13200017
128700         MOVE 'Y' TO WS-TS-REORG                                  13210017
128800     ELSE                                                         13220017
128900         MOVE 'N' TO WS-TS-REORG.                                 13230017
129000                                                                  13240017
129100     PERFORM 5000-PROCESS-INDEXES THRU 5000-EXIT.                 13250017
129200                                                                  13260017
129300     MOVE 'N' TO WS-TS-PART-REORGED.                              13270017
129400                                                                  13280017
129500 4001-EXIT.                                                       13290017
129600     EXIT.                                                        13300017
129700                                                                  13310017
129800                                                                  13320017
129900 4005-GET-TS-DETAILS.                                             13330017
130000                                                                  13340017
130100***************************************************************** 13350017
130800*** SYSTABLES IS ACCESSED TO CHECK FOR THE FOLLOWING:         *** 13360017
130900*** 1)  APPEND YES                                            *** 13370017
130800*** 2)  DATACAPTURE TURNED ON                                 *** 13380017
131000***************************************************************** 13390017
131100                                                                  13400017
131200     EXEC SQL                                                     13410017
131300       SELECT TYPE,DBID,PSID,PARTITIONS,NTABLES,MEMBER_CLUSTER    13420017
131400         INTO :SYSTABSP-TYPE,                                     13430017
131500              :SYSTABSP-DBID,                                     13440017
131600              :SYSTABSP-PSID,                                     13450017
131700              :SYSTABSP-PARTITIONS,                               13460017
131800              :SYSTABSP-NTABLES,                                  13470017
131810              :SYSTABSP-MEMBER-CLUSTER                            13480017
131900            FROM SYSIBM.SYSTABLESPACE                             13490017
132000         WHERE DBNAME    = :WS-DATABASE                           13500017
132100           AND NAME      = :WS-TABLESPACE                         13510017
132200         WITH UR                                                  13520017
132300     END-EXEC.                                                    13530017
132400                                                                  13540017
132500     IF  SQLCODE NOT = ZERO                                       13550017
132600         DISPLAY '******************************************'     13560017
132700         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     13570017
132800         DISPLAY '***                                    ***'     13580017
132900         DISPLAY '*** PARAGRAPH 4005-GET-TS-DETAILS      ***'     13590017
133000         DISPLAY '*** BAD SELECT ON SYSTABLESPACE        ***'     13600017
133100         DISPLAY '******************************************'     13610017
133200         PERFORM 9999-DB2-ABEND                                   13620017
133300     END-IF.                                                      13630017
133400                                                                  13640017
133500     IF SYSTABSP-PARTITIONS = 0                                   13650017
133600         MOVE 'N' TO WS-PARTITIONED-TSPACE                        13660017
133700     ELSE                                                         13670017
133800         MOVE 'Y' TO WS-PARTITIONED-TSPACE.                       13680017
133900                                                                  13690017
134000     EXEC SQL                                                     13700017
134100       SELECT COUNT(*)                                            13710017
134200         INTO :WS-NBR-TABLES-WITH-APPEND-YES                      13720017
134300            FROM SYSIBM.SYSTABLES                                 13730017
134400         WHERE DBNAME    = :WS-DATABASE                           13740017
134500           AND TSNAME    = :WS-TABLESPACE                         13750017
134600           AND APPEND    = 'Y'                                    13760017
134700         WITH UR                                                  13770017
134800     END-EXEC.                                                    13780017
134900                                                                  13790017
135000     IF  SQLCODE NOT = ZERO                                       13800017
135100         DISPLAY '******************************************'     13810017
135200         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     13820017
135300         DISPLAY '***                                    ***'     13830017
135400         DISPLAY '*** PARAGRAPH 4005-GET-TS-DETAILS      ***'     13840017
135500         DISPLAY '*** BAD SELECT ON SYSTABLES #1         ***'     13850017
135600         DISPLAY '******************************************'     13860017
135700         PERFORM 9999-DB2-ABEND                                   13870017
135800     END-IF.                                                      13880017
135900                                                                  13890017
134000     EXEC SQL                                                     13900017
134100       SELECT COUNT(*)                                            13910017
134200         INTO :WS-NBR-TBLS-WITH-DATACAPTURE                       13920017
134300            FROM SYSIBM.SYSTABLES                                 13930017
134400         WHERE DBNAME      = :WS-DATABASE                         13940017
134500           AND TSNAME      = :WS-TABLESPACE                       13950017
134600           AND DATACAPTURE = 'Y'                                  13960017
134700         WITH UR                                                  13970017
134800     END-EXEC.                                                    13980017
134900                                                                  13990017
135000     IF  SQLCODE NOT = ZERO                                       14000017
135100         DISPLAY '******************************************'     14010017
135200         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     14020017
135300         DISPLAY '***                                    ***'     14030017
135400         DISPLAY '*** PARAGRAPH 4005-GET-TS-DETAILS      ***'     14040017
135500         DISPLAY '*** BAD SELECT ON SYSTABLES #2         ***'     14050017
135600         DISPLAY '******************************************'     14060017
135700         PERFORM 9999-DB2-ABEND                                   14070017
135800     END-IF.                                                      14080017
135900                                                                  14090017
136000 4005-EXIT.                                                       14100017
136100     EXIT.                                                        14110017
136200                                                                  14120017
136300                                                                  14130017
136400 4010-GET-TS-PART-STATS.                                          14140017
136500                                                                  14150017
136600***************************************************************** 14160017
136700*** GET SYSTABLEPART AND REALTIME STATISTICAL INFORMATION.    *** 14170017
136800***                                                           *** 14180017
136900*** IF 'DEFINE NO' ON TABLESPACE NO REALTIME STATS WILL EXIST.*** 14190017
137000***                                                           *** 14200017
137100*** FOR REALTIME STATISTICS, A VALUE OF NULL INDICATES THE    *** 14210017
137200*** ABSENCE OF REORG STATISTICS.  IN THAT SITUATION A REORG   *** 14220017
137300*** WILL BE FORCED.                                           *** 14230017
137400***************************************************************** 14240017
137500                                                                  14250017
137600     EXEC SQL                                                     14260017
137700       SELECT PAGESAVE, COMPRESS, PQTY, SQTY, SECQTYI, SPACE,     14270017
137800              CARDF                                               14280017
137900         INTO :SYSTBPT-PAGESAVE,                                  14290017
138000              :SYSTBPT-COMPRESS,                                  14300017
138100              :SYSTBPT-PQTY,                                      14310017
138200              :SYSTBPT-SQTY,                                      14320017
138300              :SYSTBPT-SECQTYI,                                   14330017
138400              :SYSTBPT-SPACE,                                     14340017
138500              :SYSTBPT-CARDF                                      14350017
138600            FROM SYSIBM.SYSTABLEPART                              14360017
138700         WHERE DBNAME    = :WS-DATABASE                           14370017
138800           AND TSNAME    = :WS-TABLESPACE                         14380017
138900           AND PARTITION = :WS-PART-NBR                           14390017
139000         WITH UR                                                  14400017
139100     END-EXEC.                                                    14410017
139200                                                                  14420017
139300     IF  SQLCODE NOT = ZERO                                       14430017
139400         DISPLAY '******************************************'     14440017
139500         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     14450017
139600         DISPLAY '***                                    ***'     14460017
139700         DISPLAY '*** PARAGRAPH 4010-GET-TS-PART-STATS   ***'     14470017
139800         DISPLAY '*** BAD SELECT ON SYSTABLEPART         ***'     14480017
139900         DISPLAY '******************************************'     14490017
140000         PERFORM 9999-DB2-ABEND                                   14500017
140100     END-IF.                                                      14510017
140200                                                                  14520017
140300     IF SYSTBPT-SPACE = -1                                        14530017
140400         GO TO 4010-EXIT                                          14540017
140500     END-IF.                                                      14550017
140600                                                                  14560017
140700     EXEC SQL                                                     14570017
140800       SELECT TOTALROWS, SPACE, EXTENTS,                          14580017
140900              REORGUNCLUSTINS, REORGDISORGLOB, REORGNEARINDREF,   14590017
141000              REORGFARINDREF, REORGINSERTS, REORGDELETES,         14600017
141100              REORGUPDATES, NPAGES                                14610017
141200         INTO :SYSRTSTS-TOTALROWS                                 14620017
141300                INDICATOR :TS-TOTALROWS-NULLIND,                  14630017
141400              :SYSRTSTS-SPACE                                     14640017
141500                INDICATOR :TS-SPACE-NULLIND,                      14650017
141600              :SYSRTSTS-EXTENTS                                   14660017
141700                INDICATOR :TS-EXTENTS-NULLIND,                    14670017
141800              :SYSRTSTS-REORGUNCLUSTINS                           14680017
141900                INDICATOR :TS-REORGUNCLUSTINS-NULLIND,            14690017
142000              :SYSRTSTS-REORGDISORGLOB                            14700017
142100                INDICATOR :TS-REORGDISORGLOB-NULLIND,             14710017
142200              :SYSRTSTS-REORGNEARINDREF                           14720017
142300                INDICATOR :TS-REORGNEARINDREF-NULLIND,            14730017
142400              :SYSRTSTS-REORGFARINDREF                            14740017
142500                INDICATOR :TS-REORGFARINDREF-NULLIND,             14750017
142600              :SYSRTSTS-REORGINSERTS                              14760017
142700                INDICATOR :TS-REORGINSERTS-NULLIND,               14770017
142800              :SYSRTSTS-REORGDELETES                              14780017
142900                INDICATOR :TS-REORGDELETES-NULLIND,               14790017
143000              :SYSRTSTS-REORGUPDATES                              14800017
143100                INDICATOR :TS-REORGUPDATES-NULLIND,               14810017
143110              :SYSRTSTS-NPAGES                                    14820017
143120                INDICATOR :TS-NPAGES-NULLIND                      14830017
143200            FROM SYSIBM.SYSTABLESPACESTATS                        14840017
143300                WHERE DBID        = :SYSTABSP-DBID                14850017
143400                    AND PSID      = :SYSTABSP-PSID                14860017
143500                    AND PARTITION = :WS-PART-NBR                  14870017
143600            WITH UR                                               14880017
143700     END-EXEC.                                                    14890017
143800                                                                  14900017
143900     IF SQLCODE = ZERO                                            14910017
144000         NEXT SENTENCE                                            14920017
144100     ELSE                                                         14930017
144200         IF SQLCODE = +100                                        14940017
144300             MOVE -99 TO  TS-TOTALROWS-NULLIND                    14950017
144400                          TS-SPACE-NULLIND                        14960017
144500                          TS-EXTENTS-NULLIND                      14970017
144600                          TS-REORGUNCLUSTINS-NULLIND              14980017
144700                          TS-REORGDISORGLOB-NULLIND               14990017
144800                          TS-REORGNEARINDREF-NULLIND              15000017
144900                          TS-REORGFARINDREF-NULLIND               15010017
145000                          TS-REORGINSERTS-NULLIND                 15020017
145100                          TS-REORGDELETES-NULLIND                 15030017
145200                          TS-REORGUPDATES-NULLIND                 15040017
145210                          TS-NPAGES-NULLIND                       15050017
145300         ELSE                                                     15060017
145400             DISPLAY '******************************************' 15070017
145500             DISPLAY '*** PROGRAM ERROR - DBKUT006           ***' 15080017
145600             DISPLAY '***                                    ***' 15090017
145700             DISPLAY '*** PARAGRAPH 4010-GET-TS-PART-STATS   ***' 15100017
145800             DISPLAY '*** BAD SELECT ON SYSTABLESPACESTATS   ***' 15110017
145900             DISPLAY '******************************************' 15120017
146000             PERFORM 9999-DB2-ABEND                               15130017
146100         END-IF                                                   15140017
146200     END-IF.                                                      15150017
146300                                                                  15160017
146400                                                                  15170017
146500 4010-EXIT.                                                       15180017
146600     EXIT.                                                        15190017
146700                                                                  15200017
146800                                                                  15210017
146900 4020-CHECK-LOB-THRESHOLDS.                                       15220017
147000                                                                  15230017
147100***************************************************************** 15240017
147200*** CHECK LOB TABLESPACE STATISTICS.  BRANCH TO CHECK ON      *** 15250017
147300*** AUXILIARY INDEX STATISTICS.                               *** 15260017
147400***************************************************************** 15270017
147500                                                                  15280017
147600     IF WS-TS-REORG = 'Y'                                         15290017
147700         NEXT SENTENCE                                            15300017
147800     ELSE                                                         15310017
147900         IF SYSRTSTS-TOTALROWS = 0                                15320017
148000             NEXT SENTENCE                                        15330017
148100         ELSE                                                     15340017
148200             COMPUTE WS-LOB-DISORG ROUNDED =                      15350017
148300                 (SYSRTSTS-REORGDISORGLOB * 100)                  15360017
148400                        / SYSRTSTS-TOTALROWS                      15370017
148500             IF WS-LOB-DISORG > WS-THRESHOLD-LOB-ORGRATIO         15380017
148600                 MOVE 'Y' TO WS-TS-REORG                          15390017
148700             ELSE                                                 15400017
148800                 NEXT SENTENCE                                    15410017
148900             END-IF                                               15420017
149000         END-IF                                                   15430017
149100     END-IF.                                                      15440017
149200                                                                  15450017
149300     IF WS-TS-REORG = 'N'                                         15460017
149400         PERFORM 4200-CHECK-TS-EXTENTS THRU 4200-EXIT             15470017
149500     END-IF.                                                      15480017
149600                                                                  15490017
149700     MOVE 'N' TO WS-PARTITIONED-INDEX.                            15500017
149800     MOVE WS-DATABASE TO WS-IX-CSR-DATABASE.                      15510017
149900     MOVE WS-TABLESPACE TO WS-IX-CSR-TABLESPACE.                  15520017
150000     PERFORM 5000-PROCESS-INDEXES THRU 5000-EXIT.                 15530017
150100                                                                  15540017
150200                                                                  15550017
150300 4020-EXIT.                                                       15560017
150400     EXIT.                                                        15570017
150500                                                                  15580017
150600                                                                  15590017
150700 4030-CHECK-NONLOB-THRESHOLDS.                                    15600017
150800                                                                  15610017
150900***************************************************************** 15620017
151000*** CHECK NON-LOB TABLESPACE AND INDEX STATISTICS.            *** 15630017
151100***************************************************************** 15640017
151200                                                                  15650017
151300     MOVE 'N' TO WS-BUILD-COMP-DICT.                              15660017
151400                                                                  15670017
151500     IF (WS-TS-REORG = 'N' AND SYSTBPT-SPACE IS NOT = -1)         15680017
151600         IF SYSTBPT-COMPRESS = 'Y'                                15690017
151700             PERFORM 4100-CHECK-COMPRESSION THRU 4100-EXIT        15700017
151800         ELSE                                                     15710017
151900             PERFORM 4150-CHECK-COMPRESS-TURNED-OFF               15720017
152000                 THRU 4150-EXIT                                   15730017
152100         END-IF                                                   15740017
152200     END-IF.                                                      15750017
152300                                                                  15760017
152400     IF (WS-TS-REORG = 'N' AND SYSTBPT-SPACE IS NOT = -1)         15770017
152500         PERFORM 4031-CHECK-CLUSTERING  THRU 4031-EXIT.           15780017
152600                                                                  15790017
152700     IF (WS-TS-REORG = 'N' AND SYSTBPT-SPACE IS NOT = -1)         15800017
152800         PERFORM 4200-CHECK-TS-EXTENTS THRU 4200-EXIT.            15810017
152900                                                                  15820017
153000     IF (WS-TS-REORG = 'N' AND SYSTBPT-SPACE IS NOT = -1)         15830017
153100         PERFORM 4300-CHECK-INDREFLIMIT THRU 4300-EXIT.           15840017
153200                                                                  15850017
153300                                                                  15860017
153400*--- FOR A PARTITIONED TABLESPACE PROCESS THE INDEX PARTITION.    15870017
153500*--- FOR A NON-PARTITIONED TABLESPACE PROCESS ANY INDEXES.        15880017
153600                                                                  15890017
153700     MOVE WS-DATABASE   TO WS-IX-CSR-DATABASE.                    15900017
153800     MOVE WS-TABLESPACE TO WS-IX-CSR-TABLESPACE.                  15910017
153900                                                                  15920017
154000     IF WS-PART-NBR IS > 0                                        15930017
154100         MOVE 'Y' TO WS-PARTITIONED-INDEX                         15940017
154200     ELSE                                                         15950017
154300         MOVE 'N' TO WS-PARTITIONED-INDEX                         15960017
154400     END-IF.                                                      15970017
154500                                                                  15980017
154600     PERFORM 5000-PROCESS-INDEXES THRU 5000-EXIT.                 15990017
154700                                                                  16000017
154800                                                                  16010017
154900 4030-EXIT.                                                       16020017
155000     EXIT.                                                        16030017
155100                                                                  16040017
155200                                                                  16050017
155300 4031-CHECK-CLUSTERING.                                           16060017
155400                                                                  16070017
155500***************************************************************** 16080017
155600*** CLUSTERING THRESHOLD IS CHECKED FOR THE FOLLOWING:        *** 16090017
155700*** - TABLESPACE NOT DEFINED WITH MEMBER CLUSTER              *** 16100017
155800*** - TABLE EXISTS WITH APPEND NO                             *** 16110017
155900***                                                           *** 16120017
156000*** CLUSTERING REALTIME STATISTICS ARE NOT MAINTAINED FOR     *** 16130017
156100*** TABLESPACES DEFINED WITH MEMBER CLUSTER OR FOR TABLES     *** 16140017
156200*** DEFINED WITH APPEND YES.  IN THESES CASES CHECK PERCENT   *** 16150017
156300*** OF ROWS CHANGED SINCE LAST REORG.                         *** 16160017
156400***************************************************************** 16170017
156500                                                                  16180017
156600                                                                  16190017
156700*------  NO MEMBER CLUSTER OR APPEND YES OBJECTS                  16200017
156800*------  (CHECK CLUSTERING THRESHOLD)                             16210017
156900                                                                  16220017
157000     IF SYSTABSP-MEMBER-CLUSTER = ' '                             16230017
157200         AND WS-NBR-TABLES-WITH-APPEND-YES = 0                    16240017
157300             PERFORM 4175-CHECK-CLUSTERING THRU 4175-EXIT         16250017
157400             GO TO 4031-EXIT                                      16260017
157500     END-IF.                                                      16270017
157600                                                                  16280017
157700*------  MEMBER CLUSTER TABLESPACE                                16290017
157800*------  (CHECK CHANGED ROW THRESHOLD)                            16300017
157900                                                                  16310017
158000     IF SYSTABSP-MEMBER-CLUSTER = 'Y'                             16320017
158200             PERFORM 4180-CHECK-CHANGED-ROWS THRU 4180-EXIT       16330017
158300             GO TO 4031-EXIT                                      16340017
158400     END-IF.                                                      16350017
158500                                                                  16360017
158600*------  ALL TABLES IN TABLESPACE ARE DEFINED WITH APPEND YES     16370017
158700*------  (CHECK CHANGED ROW THRESHOLD)                            16380017
158800                                                                  16390017
158900     IF WS-NBR-TABLES-WITH-APPEND-YES = SYSTABSP-NTABLES          16400017
159000         PERFORM 4180-CHECK-CHANGED-ROWS THRU 4180-EXIT           16410017
159100         GO TO 4031-EXIT                                          16420017
159200     END-IF.                                                      16430017
159300                                                                  16440017
159400*------  MIX OF TABLES IN TABLESPACE WITH APPEND YES AND APPEND NO16450017
159500*------  (CHECK BOTH CLUSTERING AND CHANGED ROW THRESHOLDS IF     16460017
159600*------   NECCESSARY)                                             16470017
159700                                                                  16480017
159800     IF WS-NBR-TABLES-WITH-APPEND-YES IS < SYSTABSP-NTABLES       16490017
159900         PERFORM 4175-CHECK-CLUSTERING THRU 4175-EXIT             16500017
160000         IF WS-TS-REORG = 'N'                                     16510017
160100             PERFORM 4180-CHECK-CHANGED-ROWS THRU 4180-EXIT       16520017
160200         END-IF                                                   16530017
160300     END-IF.                                                      16540017
160400                                                                  16550017
160500                                                                  16560017
160600 4031-EXIT.                                                       16570017
160700     EXIT.                                                        16580017
160800                                                                  16590017
160900                                                                  16600017
161000 4100-CHECK-COMPRESSION.                                          16610017
161100                                                                  16620017
161200***************************************************************** 16630017
161300*** THIS CODE IS EXECUTED FOR COMPRESSED TABLESPACES.         *** 16640017
161400***-----------------------------------------------------------*** 16650017
161500*** -  IF TABLE OR PARTITION IS EMPTY (SYSRTSTS-TOTALROWS=0)  *** 16660017
161600***    OR STATS HAVE NOT BEEN GATHERED (SYSTBPT-CARDF = -1)   *** 16670017
161700***    THEN EXIT THIS PARAGRAPH.  ANY SUBSEQUENT REORGS THAT  *** 16680017
161800***    ARE TRIGGERED WILL USE THE KEEPDICTIONARY PARAMETER.   *** 16690017
161500*** -  IF DATACAPTURE IS TURNED ON FOR A TABLE THEN AVOID     *** 16700017
161600***    REBUILDING THE COMPRESSION DICTIONARY.  THIS WOULD     *** 16710017
161700***    CAUSE ISSUES WITH GOLDEN GATE REPLICATION IF LOG       *** 16720017
161800***    RECORDS ARE ENCOUNTERED THAT WERE CREATED UNDER A      *** 16730017
161800***    DIFFERENT COMPRESSION DICTIONARY.                      *** 16740017
161900*** -  IF PAGESAVE = 0 THEN A COMPRESSION DICTIONARY WILL BE  *** 16750017
162000***    BUILT.                                                 *** 16760017
162100*** -  COMPARE CURRENT PAGE SAVINGS TO THE HIGHEST HISTORICAL *** 16770017
162200***    PAGE SAVINGS SINCE THE DICTIONARY WAS LAST BUILT.  THE *** 16780017
162300***    DICTIONARY WILL BE REBUILT IF THE DEGRADATION EXCEEDS  *** 16790017
162400***    THE THRESHOLD VALUE.                                   *** 16800017
162500***                                                           *** 16810017
162600***    (DBT_DTE_DICTBUILT CONTAINS THE DATE WHEN THE          *** 16820017
162700***     DICTIONARY WAS LAST BUILT).                           *** 16830017
162800***************************************************************** 16840017
162900                                                                  16850017
163000     IF (SYSRTSTS-TOTALROWS = 0                                   16860017
163100            OR SYSTBPT-CARDF = -1                                 16870017
163100            OR WS-NBR-TBLS-WITH-DATACAPTURE > 0)                  16880017
163200         GO TO 4100-EXIT                                          16890017
163300     END-IF.                                                      16900017
163400                                                                  16910017
163500     PERFORM 4110-SELECT-LAST-BUILT-TMST THRU 4110-EXIT.          16920017
163600                                                                  16930017
163700     IF SYSTBPT-PAGESAVE = 0                                      16940017
163800         MOVE 'Y' TO WS-BUILD-COMP-DICT                           16950017
163900                     WS-TS-REORG                                  16960017
164000         IF WS-LAST-BUILT-ROW-FOUND = 'Y'                         16970017
164100             PERFORM 4120-UPDATE-BUILD-TMST THRU 4120-EXIT        16980017
164200             GO TO 4100-EXIT                                      16990017
164300         ELSE                                                     17000017
164400             PERFORM 4130-INSERT-BUILD-TMST THRU 4130-EXIT        17010017
164500             GO TO 4100-EXIT                                      17020017
164600     END-IF.                                                      17030017
164700                                                                  17040017
164800     EXEC SQL                                                     17050017
164900       SELECT DISTINCT PAGESAVE                                   17060017
165000         INTO :WS-HIGH-HIST-PAGESAVE                              17070017
165100            FROM SYSIBM.SYSTABLEPART_HIST                         17080017
165200         WHERE DBNAME    = :WS-DATABASE                           17090017
165300           AND TSNAME    = :WS-TABLESPACE                         17100017
165400           AND PARTITION = :WS-PART-NBR                           17110017
165500           AND PAGESAVE =                                         17120017
165600           (SELECT MAX(PAGESAVE)                                  17130017
165700                FROM SYSIBM.SYSTABLEPART_HIST                     17140017
165800                   WHERE DBNAME  = :WS-DATABASE                   17150017
165900                   AND TSNAME    = :WS-TABLESPACE                 17160017
166000                   AND PARTITION = :WS-PART-NBR                   17170017
166100                   AND STATSTIME > :DBT00016-LAST-BUILT-TMST)     17180017
166200         WITH UR                                                  17190017
166300     END-EXEC.                                                    17200017
166400                                                                  17210017
166500     IF (SQLCODE = ZERO OR SQLCODE = +100)                        17220017
166600         NEXT SENTENCE                                            17230017
166700     ELSE                                                         17240017
166800         DISPLAY '******************************************'     17250017
166900         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     17260017
167000         DISPLAY '***                                    ***'     17270017
167100         DISPLAY '*** PARAGRAPH 4100-CHECK-COMPRESSION   ***'     17280017
167200         DISPLAY '*** BAD SELECT ON SYSTABLEPART_HIST    ***'     17290017
167300         DISPLAY '******************************************'     17300017
167400         PERFORM 9999-DB2-ABEND                                   17310017
167500     END-IF.                                                      17320017
167600                                                                  17330017
167700     IF SQLCODE = +100                                            17340017
167800         GO TO 4100-EXIT                                          17350017
167900     END-IF.                                                      17360017
168000                                                                  17370017
168100     IF WS-HIGH-HIST-PAGESAVE = 0                                 17380017
168200         GO TO 4100-EXIT                                          17390017
168300     END-IF.                                                      17400017
168400                                                                  17410017
168500     COMPUTE WS-PAGESAVE-DEGRADATION ROUNDED =                    17420017
168600         ((WS-HIGH-HIST-PAGESAVE - SYSTBPT-PAGESAVE) * 100) /     17430017
168700               WS-HIGH-HIST-PAGESAVE.                             17440017
168800                                                                  17450017
168900     IF WS-PAGESAVE-DEGRADATION > WS-THRESHOLD-PAGESAVE           17460017
169000         MOVE 'Y' TO WS-BUILD-COMP-DICT                           17470017
169100                     WS-TS-REORG                                  17480017
169200         IF WS-LAST-BUILT-ROW-FOUND = 'Y'                         17490017
169300             PERFORM 4120-UPDATE-BUILD-TMST THRU 4120-EXIT        17500017
169400         ELSE                                                     17510017
169500             PERFORM 4130-INSERT-BUILD-TMST THRU 4130-EXIT        17520017
169600     ELSE                                                         17530017
169700         NEXT SENTENCE.                                           17540017
169800                                                                  17550017
169900                                                                  17560017
170000 4100-EXIT.                                                       17570017
170100     EXIT.                                                        17580017
170200                                                                  17590017
170300                                                                  17600017
170400 4110-SELECT-LAST-BUILT-TMST.                                     17610017
170500                                                                  17620017
170600***************************************************************** 17630017
170700***  GET TIMESTAMP WHEN DICTIONARY WAS LAST BUILT.            *** 17640017
170800***************************************************************** 17650017
170900                                                                  17660017
171000     EXEC SQL                                                     17670017
171100       SELECT LAST_BUILT_TMST                                     17680017
171200         INTO :DBT00016-LAST-BUILT-TMST                           17690017
171300            FROM DBT_DTE_DICTBUILT                                17700017
171400         WHERE DBNAME    = :WS-DATABASE                           17710017
171500           AND TSNAME    = :WS-TABLESPACE                         17720017
171600           AND PARTITION = :WS-PART-NBR                           17730017
171700     END-EXEC.                                                    17740017
171800                                                                  17750017
171900     IF SQLCODE = ZERO                                            17760017
172000         MOVE 'Y' TO WS-LAST-BUILT-ROW-FOUND                      17770017
172100     ELSE                                                         17780017
172200         IF SQLCODE = +100                                        17790017
172300             MOVE 'N' TO WS-LAST-BUILT-ROW-FOUND                  17800017
172400             MOVE '0001-01-01-00.00.00.000000'                    17810017
172500                 TO DBT00016-LAST-BUILT-TMST                      17820017
172600         ELSE                                                     17830017
172700             DISPLAY '******************************************' 17840017
172800             DISPLAY '*** PROGRAM ERROR - DBKUT006           ***' 17850017
172900             DISPLAY '***                                    ***' 17860017
173000             DISPLAY '*** PARAGRAPH 4110-SELECT-LAST-BUILT_TMST*' 17870017
173100             DISPLAY '*** BAD SELECT ON DBT_DTE_DICTBUILT    ***' 17880017
173200             DISPLAY '******************************************' 17890017
173300             PERFORM 9999-DB2-ABEND                               17900017
173400     END-IF.                                                      17910017
173500                                                                  17920017
173600                                                                  17930017
173700 4110-EXIT.                                                       17940017
173800     EXIT.                                                        17950017
173900                                                                  17960017
174000                                                                  17970017
174100 4120-UPDATE-BUILD-TMST.                                          17980017
174200                                                                  17990017
174300***************************************************************** 18000017
174400***  UPDATE TIMESTAMP INDICATING WHEN DICTIONARY WAS BUILT.   *** 18010017
174500***************************************************************** 18020017
174600                                                                  18030017
174700     EXEC SQL                                                     18040017
174800       UPDATE DBT_DTE_DICTBUILT                                   18050017
174900           SET LAST_BUILT_TMST = CURRENT TIMESTAMP                18060017
175000         WHERE DBNAME    = :WS-DATABASE                           18070017
175100           AND TSNAME    = :WS-TABLESPACE                         18080017
175200           AND PARTITION = :WS-PART-NBR                           18090017
175300     END-EXEC.                                                    18100017
175400                                                                  18110017
175500     IF SQLCODE = ZERO                                            18120017
175600         NEXT SENTENCE                                            18130017
175700     ELSE                                                         18140017
175800         DISPLAY '******************************************'     18150017
175900         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     18160017
176000         DISPLAY '***                                    ***'     18170017
176100         DISPLAY '*** PARAGRAPH 4120-UPDATE-BUILD-TMST   ***'     18180017
176200         DISPLAY '*** BAD UPDATE ON DBT_DTE_DICTBUILT    ***'     18190017
176300         DISPLAY '******************************************'     18200017
176400         PERFORM 9999-DB2-ABEND                                   18210017
176500     END-IF.                                                      18220017
176600                                                                  18230017
176700                                                                  18240017
176800 4120-EXIT.                                                       18250017
176900     EXIT.                                                        18260017
177000                                                                  18270017
177100                                                                  18280017
177200 4130-INSERT-BUILD-TMST.                                          18290017
177300                                                                  18300017
177400***************************************************************** 18310017
177500***  INSERT ROW INDICATING WHEN DICTIONARY WAS BUILT.         *** 18320017
177600***************************************************************** 18330017
177700                                                                  18340017
177800     EXEC SQL                                                     18350017
177900       INSERT INTO DBT_DTE_DICTBUILT                              18360017
178000           (DBNAME, TSNAME, PARTITION, LAST_BUILT_TMST)           18370017
178100       VALUES                                                     18380017
178200           (:WS-DATABASE, :WS-TABLESPACE, :WS-PART-NBR,           18390017
178300             CURRENT TIMESTAMP)                                   18400017
178400     END-EXEC.                                                    18410017
178500                                                                  18420017
178600     IF SQLCODE = ZERO                                            18430017
178700         NEXT SENTENCE                                            18440017
178800     ELSE                                                         18450017
178900         DISPLAY '******************************************'     18460017
179000         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     18470017
179100         DISPLAY '***                                    ***'     18480017
179200         DISPLAY '*** PARAGRAPH 4130-INSERT-BUILD-TMST   ***'     18490017
179300         DISPLAY '*** BAD INSERT ON DBT_DTE_DICTBUILT    ***'     18500017
179400         DISPLAY '******************************************'     18510017
179500         PERFORM 9999-DB2-ABEND                                   18520017
179600     END-IF.                                                      18530017
179700                                                                  18540017
179800                                                                  18550017
179900 4130-EXIT.                                                       18560017
180000     EXIT.                                                        18570017
180100                                                                  18580017
180200                                                                  18590017
180300 4150-CHECK-COMPRESS-TURNED-OFF.                                  18600017
180400                                                                  18610017
180500***************************************************************** 18620017
180600***  CHECK IF COMPRESSION HAS BEEN TURNED OFF (INDICATED      *** 18630017
180700***  BY A BLANK VALUE FOR THE COMPRESS SETTING AND A          *** 18640017
180800***  NON-ZERO VALUE FOR PAGE SAVINGS).  FORCING A REORG       *** 18650017
180900***  WILL ERASE THE COMPRESSION DICTIONARY.                   *** 18660017
181000***                                                           *** 18670017
181100***  DELETE A ROW, IF FOUND, FROM DBT_DTE_DICTBUILT.          *** 18680017
181200***************************************************************** 18690017
181300                                                                  18700017
181400     IF SYSTBPT-PAGESAVE = 0                                      18710017
181500         GO TO 4150-EXIT                                          18720017
181600     END-IF.                                                      18730017
181700                                                                  18740017
181800     MOVE 'Y' TO WS-TS-REORG.                                     18750017
181900                                                                  18760017
182000     EXEC SQL                                                     18770017
182100       DELETE FROM DBT_DTE_DICTBUILT                              18780017
182200         WHERE DBNAME    = :WS-DATABASE                           18790017
182300           AND TSNAME    = :WS-TABLESPACE                         18800017
182400           AND PARTITION = :WS-PART-NBR                           18810017
182500     END-EXEC.                                                    18820017
182600                                                                  18830017
182700     IF (SQLCODE = ZERO OR SQLCODE = +100)                        18840017
182800         NEXT SENTENCE                                            18850017
182900     ELSE                                                         18860017
183000         DISPLAY '******************************************'     18870017
183100         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     18880017
183200         DISPLAY '***                                    ***'     18890017
183300         DISPLAY '*** PARAGRAPH                          ***'     18900017
183400         DISPLAY '***  4150-CHECK-COMPRESS-TURNED-OFF    ***'     18910017
183500         DISPLAY '*** BAD DELETE FROM DBT_DTE_DICTBUILT  ***'     18920017
183600         DISPLAY '******************************************'     18930017
183700         PERFORM 9999-DB2-ABEND                                   18940017
183800     END-IF.                                                      18950017
183900                                                                  18960017
184000                                                                  18970017
184100 4150-EXIT.                                                       18980017
184200     EXIT.                                                        18990017
184300                                                                  19000017
184400                                                                  19010017
184500 4175-CHECK-CLUSTERING.                                           19020017
184600                                                                  19030017
184700***************************************************************** 19040017
184800*** CHECK CLUSTERING THRESHOLD                                *** 19050017
184900***************************************************************** 19060017
185000                                                                  19070017
185100     IF SYSRTSTS-TOTALROWS = 0                                    19080017
185200         GO TO 4175-EXIT                                          19090017
185300     END-IF.                                                      19100017
185400                                                                  19110017
185500     COMPUTE WS-OFFPOSLIMIT ROUNDED =                             19120017
185600         (SYSRTSTS-REORGUNCLUSTINS * 100) / SYSRTSTS-TOTALROWS.   19130017
185700                                                                  19140017
185800     IF WS-OFFPOSLIMIT IS > WS-THRESHOLD-OFFPOSLIMIT              19150017
185900         MOVE 'Y' TO WS-TS-REORG                                  19160017
186000     END-IF.                                                      19170017
186100                                                                  19180017
186200 4175-EXIT.                                                       19190017
186300     EXIT.                                                        19200017
186400                                                                  19210017
186500                                                                  19220017
186600 4180-CHECK-CHANGED-ROWS.                                         19230017
186700                                                                  19240017
186800***************************************************************** 19250017
186900*** CHECK PERCENT OF CHANGED ROWS FOR TABLESPACES DEFINED     *** 19260017
187000*** WITH MEMBER CLUSTER OR CONTAINING TABLES DEFINED WITH     *** 19270017
187100*** APPEND YES.  REALTIME STATISTICS COUNTER REORGUNCLUSTINS  *** 19280017
187200*** IS NOT INCREMENTED FOR MEMBER CLUSTER OBJECTS             *** 19290017
187300*** (INDEPENDENT OF FREE SPACE) OR FOR APPEND OPERATIONS.     *** 19300017
187400***************************************************************** 19310017
187500                                                                  19320017
187600     IF SYSRTSTS-TOTALROWS = 0                                    19330017
187700         GO TO 4180-EXIT                                          19340017
187800     END-IF.                                                      19350017
187900                                                                  19360017
188000     COMPUTE WS-CHANGED-ROWS ROUNDED =                            19370017
188100         ( (SYSRTSTS-REORGINSERTS                                 19380017
188200            + SYSRTSTS-REORGDELETES                               19390017
188300            + SYSRTSTS-REORGUPDATES) * 100) / SYSRTSTS-TOTALROWS. 19400017
188400                                                                  19410017
188500     IF WS-CHANGED-ROWS IS > WS-THRESHOLD-CHANGED-ROWS            19420017
188600         MOVE 'Y' TO WS-TS-REORG                                  19430017
188700     END-IF.                                                      19440017
188800                                                                  19450017
188900 4180-EXIT.                                                       19460017
189000     EXIT.                                                        19470017
189100                                                                  19480017
189200                                                                  19490017
189300 4200-CHECK-TS-EXTENTS.                                           19500017
189400                                                                  19510017
189500***************************************************************** 19520017
189600*** CHECK EXTENTS THRESHOLD                                   *** 19530017
189700***************************************************************** 19540017
189800                                                                  19550017
189900     IF SYSRTSTS-EXTENTS IS > WS-THRESHOLD-EXTENTS                19560017
190000         MOVE 'Y' TO WS-TS-REORG                                  19570017
190100     END-IF.                                                      19580017
190200                                                                  19590017
190300 4200-EXIT.                                                       19600017
190400     EXIT.                                                        19610017
190500                                                                  19620017
190600                                                                  19630017
190700 4300-CHECK-INDREFLIMIT.                                          19640017
190800                                                                  19650017
190900     IF SYSRTSTS-TOTALROWS = 0                                    19660017
191000         NEXT SENTENCE                                            19670017
191100     ELSE                                                         19680017
191200         COMPUTE WS-INDREFLIMIT ROUNDED =                         19690017
191300             ((SYSRTSTS-REORGNEARINDREF + SYSRTSTS-REORGFARINDREF)19700017
191400                 * 100 ) / SYSRTSTS-TOTALROWS                     19710017
191500         IF WS-INDREFLIMIT IS > WS-THRESHOLD-INDREFLIMIT          19720017
191600             MOVE 'Y' TO WS-TS-REORG                              19730017
191700         END-IF                                                   19740017
191800     END-IF.                                                      19750017
191900                                                                  19760017
192000 4300-EXIT.                                                       19770017
192100     EXIT.                                                        19780017
192200                                                                  19790017
192300                                                                  19800017
192400 5000-PROCESS-INDEXES.                                            19810017
192500                                                                  19820017
192600***************************************************************** 19830017
192700*** GET VARIOUS INDEX-LEVEL STATISTICS.                       *** 19840017
192800***************************************************************** 19850017
192900                                                                  19860017
193000     IF WS-PARTITIONED-INDEX = 'Y'                                19870017
193100         MOVE WS-PART-NBR TO WS-HOSTVAR-PART                      19880017
193200     ELSE                                                         19890017
193300         MOVE 0 TO WS-HOSTVAR-PART                                19900017
193400     END-IF.                                                      19910017
193500                                                                  19920017
193600     EXEC SQL                                                     19930017
193700        OPEN INDEX-CURSOR                                         19940017
193800     END-EXEC.                                                    19950017
193900                                                                  19960017
194000     IF  SQLCODE NOT = ZERO                                       19970017
194100         DISPLAY '******************************************'     19980017
194200         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     19990017
194300         DISPLAY '***                                    ***'     20000017
194400         DISPLAY '*** PARAGRAPH 5000-PROCESS-INDEXES     ***'     20010017
194500         DISPLAY '*** BAD OPEN ON INDEX-CURSOR           ***'     20020017
194600         DISPLAY '******************************************'     20030017
194700         PERFORM 9999-DB2-ABEND.                                  20040017
194800                                                                  20050017
194900     MOVE 'N' TO WS-NO-MORE-INDEXES.                              20060017
195000                                                                  20070017
195100     PERFORM 5100-FETCH-IX-STATS THRU 5100-EXIT                   20080017
195200         UNTIL WS-NO-MORE-INDEXES = 'Y'.                          20090017
195300                                                                  20100017
195400     EXEC SQL                                                     20110017
195500        CLOSE INDEX-CURSOR                                        20120017
195600     END-EXEC.                                                    20130017
195700                                                                  20140017
195800     IF  SQLCODE NOT = ZERO                                       20150017
195900         DISPLAY '******************************************'     20160017
196000         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     20170017
196100         DISPLAY '***                                    ***'     20180017
196200         DISPLAY '*** PARAGRAPH 5000-PROCESS-INDEXES     ***'     20190017
196300         DISPLAY '*** BAD CLOSE ON INDEX-CURSOR          ***'     20200017
196400         DISPLAY '******************************************'     20210017
196500         PERFORM 9999-DB2-ABEND.                                  20220017
196600                                                                  20230017
196700 5000-EXIT.                                                       20240017
196800     EXIT.                                                        20250017
196900                                                                  20260017
197000                                                                  20270017
197100 5100-FETCH-IX-STATS.                                             20280017
197200                                                                  20290017
197300***************************************************************** 20300017
197400*** 1)  FETCH ROW FROM INDEX-CURSOR.                          *** 20310017
197500***     - IF 'DEFINE NO' FOR INDEX BYPASS ANY FURTHER         *** 20320017
197600***       PROCESSING SINCE INDEX WILL NOT BE REORGED.         *** 20330017
197700*** 2)  OBTAIN REALTIME STATISTICS FOR INDEX.                 *** 20340017
197800*** 3)  CHECK INDEX REORG THRESHOLDS.                         *** 20350017
197900***************************************************************** 20360017
198000                                                                  20370017
198100     MOVE SPACES TO SYSINDEX-CREATOR-TEXT.                        20380017
198200     MOVE SPACES TO SYSINDEX-NAME-TEXT.                           20390017
198300                                                                  20400017
198400     EXEC SQL                                                     20410017
198500         FETCH INDEX-CURSOR                                       20420017
198600          INTO :SYSINDEX-CREATOR,                                 20430017
198700               :SYSINDEX-NAME,                                    20440017
198800               :SYSINDEX-DBID,                                    20450017
198900               :SYSINDEX-ISOBID,                                  20460017
199000               :SYSIXPT-PQTY,                                     20470017
199100               :SYSIXPT-SQTY,                                     20480017
199200               :SYSIXPT-SECQTYI,                                  20490017
199300               :SYSIXPT-SPACE                                     20500017
199400     END-EXEC.                                                    20510017
199500                                                                  20520017
199600     IF SQLCODE = +0                                              20530017
199700         MOVE SYSINDEX-CREATOR-TEXT      TO WS-IX-CREATOR         20540017
199800         MOVE SYSINDEX-NAME-TEXT         TO WS-IX-NAME            20550017
199900     ELSE                                                         20560017
200000         IF SQLCODE = +100                                        20570017
200100             MOVE 'Y' TO WS-NO-MORE-INDEXES                       20580017
200200             GO TO 5100-EXIT                                      20590017
200300         ELSE                                                     20600017
200400             DISPLAY '*****************************************'  20610017
200500             DISPLAY '*** PROGRAM ERROR - DBKUT006          ***'  20620017
200600             DISPLAY '***                                   ***'  20630017
200700             DISPLAY '*** PARAGRAPH 5100-FETCH-IX-STATS     ***'  20640017
200800             DISPLAY '*** BAD FETCH ON INDEX-CURSOR         ***'  20650017
200900             DISPLAY '*****************************************'  20660017
201000             PERFORM 9999-DB2-ABEND.                              20670017
201100                                                                  20680017
201200     IF SYSIXPT-SPACE = -1                                        20690017
201300         GO TO 5100-EXIT                                          20700017
201400     END-IF.                                                      20710017
201500                                                                  20720017
201600     EXEC SQL                                                     20730017
201700       SELECT TOTALENTRIES, NLEVELS, NACTIVE, SPACE, EXTENTS,     20740017
201800              REORGPSEUDODELETES, REORGLEAFFAR                    20750017
201900         INTO :SYSRTSIX-TOTALENTRIES                              20760017
202000                INDICATOR :IX-TOTALENTRIES-NULLIND,               20770017
202100              :SYSRTSIX-NLEVELS                                   20780017
202200                INDICATOR :IX-NLEVELS-NULLIND,                    20790017
202300              :SYSRTSIX-NACTIVE                                   20800017
202400                INDICATOR :IX-NACTIVE-NULLIND,                    20810017
202500              :SYSRTSIX-SPACE                                     20820017
202600                INDICATOR :IX-SPACE-NULLIND,                      20830017
202700              :SYSRTSIX-EXTENTS                                   20840017
202800                INDICATOR :IX-EXTENTS-NULLIND,                    20850017
202900              :SYSRTSIX-REORGPSEUDODELETES                        20860017
203000                INDICATOR :IX-REORGPSEUDODELETES-NULLIND,         20870017
203100              :SYSRTSIX-REORGLEAFFAR                              20880017
203200                INDICATOR :IX-REORGLEAFFAR-NULLIND                20890017
203300            FROM SYSIBM.SYSINDEXSPACESTATS                        20900017
203400                WHERE DBID        = :SYSINDEX-DBID                20910017
203500                    AND ISOBID    = :SYSINDEX-ISOBID              20920017
203600                    AND PARTITION = :WS-HOSTVAR-PART              20930017
203700            WITH UR                                               20940017
203800     END-EXEC.                                                    20950017
203900                                                                  20960017
204000     IF  SQLCODE = ZERO                                           20970017
204100         NEXT SENTENCE                                            20980017
204200     ELSE                                                         20990017
204300         IF SQLCODE = +100                                        21000017
204400             MOVE -99 TO IX-TOTALENTRIES-NULLIND                  21010017
204500                         IX-NLEVELS-NULLIND                       21020017
204600                         IX-NACTIVE-NULLIND                       21030017
204700                         IX-SPACE-NULLIND                         21040017
204800                         IX-EXTENTS-NULLIND                       21050017
204900                         IX-REORGPSEUDODELETES-NULLIND            21060017
205000                         IX-REORGLEAFFAR-NULLIND                  21070017
205100         ELSE                                                     21080017
205200             DISPLAY '******************************************' 21090017
205300             DISPLAY '*** PROGRAM ERROR - DBKUT006           ***' 21100017
205400             DISPLAY '***                                    ***' 21110017
205500             DISPLAY '*** PARAGRAPH 5100-FETCH-IX-STATS      ***' 21120017
205600             DISPLAY '*** BAD SELECT ON SYSINDEXSPACESTATS   ***' 21130017
205700             DISPLAY '******************************************' 21140017
205800             PERFORM 9999-DB2-ABEND                               21150017
205900         END-IF                                                   21160017
206000     END-IF.                                                      21170017
206100                                                                  21180017
206200*--------------------------------------------------------------   21190017
206300*-- CHECK INDEXES FOR REORG ELIGIBILITY IF TABLESPACE IS NOT      21200017
206400*-- BEING REORGED.  CHECK INDEXES FOR RESIZING IF TABLESPACE      21210017
206500*-- IS BEING REORGED.                                             21220017
206600*--------------------------------------------------------------   21230017
206700     IF WS-TS-REORG = 'N'                                         21240017
206800         PERFORM 6000-CHECK-IX-THRESHOLDS THRU 6000-EXIT          21250017
206900     ELSE                                                         21260017
207000         PERFORM 6200-RESIZE-IX THRU 6200-EXIT                    21270017
207100     END-IF.                                                      21280017
207200                                                                  21290017
207300 5100-EXIT.                                                       21300017
207400     EXIT.                                                        21310017
207500                                                                  21320017
207600                                                                  21330017
207700 6000-CHECK-IX-THRESHOLDS.                                        21340017
207800                                                                  21350017
207900***************************************************************** 21360017
208000*** - FORCE A REORG IF NO REALTIME STATISTICS WERE FOUND FOR  *** 21370017
208100***   AN INDEX/INDEX PARTITION.                               *** 21380017
208200*** - CHECK THE FOLLOWING THRESHOLDS FOR THE INDEX/INDEX      *** 21390017
208300***   PARTITION:                                              *** 21400017
208400***    - EXTENTS                                              *** 21410017
208500***    - PSUEDO-DELETED ENTRIES                               *** 21420017
208600***    - LEAFFAR                                              *** 21430017
208700***************************************************************** 21440017
208800                                                                  21450017
208900     IF (IX-NACTIVE-NULLIND                < 0                    21460017
209000          OR IX-NLEVELS-NULLIND            < 0                    21470017
209100          OR IX-SPACE-NULLIND              < 0                    21480017
209200          OR IX-EXTENTS-NULLIND            < 0                    21490017
209300          OR IX-TOTALENTRIES-NULLIND       < 0                    21500017
209400          OR IX-REORGPSEUDODELETES-NULLIND < 0                    21510017
209500          OR IX-REORGLEAFFAR-NULLIND       < 0)                   21520017
209600             PERFORM 6100-GEN-IX-REORG THRU 6100-EXIT             21530017
209700             GO TO 6000-EXIT                                      21540017
209800     END-IF.                                                      21550017
209900                                                                  21560017
210000     IF SYSRTSIX-EXTENTS > WS-THRESHOLD-EXTENTS                   21570017
210100         PERFORM 6100-GEN-IX-REORG THRU 6100-EXIT                 21580017
210200         GO TO 6000-EXIT                                          21590017
210300     END-IF.                                                      21600017
210400                                                                  21610017
210500     IF SYSRTSIX-TOTALENTRIES = 0                                 21620017
210600             NEXT SENTENCE                                        21630017
210700     ELSE                                                         21640017
210800         COMPUTE WS-PSEUDO-DEL-ENTRIES ROUNDED =                  21650017
210900             (SYSRTSIX-REORGPSEUDODELETES * 100) /                21660017
211000                  SYSRTSIX-TOTALENTRIES                           21670017
211100         IF WS-PSEUDO-DEL-ENTRIES > WS-THRESHOLD-PSEUDO-DEL       21680017
211200             PERFORM 6100-GEN-IX-REORG THRU 6100-EXIT             21690017
211300             GO TO 6000-EXIT                                      21700017
211400         END-IF                                                   21710017
211500     END-IF.                                                      21720017
211600                                                                  21730017
211700     IF SYSRTSIX-NACTIVE = 0                                      21740017
211800             NEXT SENTENCE                                        21750017
211900     ELSE                                                         21760017
212000         COMPUTE WS-DISORG-LEAF ROUNDED =                         21770017
212100            (SYSRTSIX-REORGLEAFFAR * 100) / SYSRTSIX-NACTIVE      21780017
212200         IF WS-DISORG-LEAF > WS-THRESHOLD-LEAFFAR                 21790017
212300             PERFORM 6100-GEN-IX-REORG THRU 6100-EXIT             21800017
212400         END-IF                                                   21810017
212500     END-IF.                                                      21820017
212600                                                                  21830017
212700                                                                  21840017
212800 6000-EXIT.                                                       21850017
212900     EXIT.                                                        21860017
213000                                                                  21870017
213100                                                                  21880017
213200                                                                  21890017
213300 6100-GEN-IX-REORG.                                               21900017
213400                                                                  21910017
213500***************************************************************** 21920017
213600*** WRITE A REORG STATEMENT FOR INDEX/INDEX PARTITION.        *** 21930017
213700***************************************************************** 21940017
213800                                                                  21950017
213900     ADD +1 TO WS-IX-REORG-COUNT.                                 21960017
214000                                                                  21970017
214100     IF WS-IX-REORG-COUNT = 1                                     21980017
214200         WRITE IX-REORG-RECORD FROM WS-OPTIONS-LINE               21990017
214300         MOVE SPACES TO IX-REORG-RECORD                           22000017
214400         WRITE IX-REORG-RECORD                                    22010017
214500         WRITE IX-REORG-RECORD FROM WS-IX-REORG-LINE1             22020017
214600     END-IF.                                                      22030017
214700                                                                  22040017
214800     WRITE IX-REORG-RECORD FROM WS-IX-REORG-LINE2.                22050017
214900                                                                  22060017
215000     MOVE SPACES TO WS-IX-CREATOR-NAME.                           22070017
215100                                                                  22080017
215200     STRING WS-IX-CREATOR  DELIMITED BY ' '                       22090017
215300            '.'            DELIMITED BY SIZE                      22100017
215400            WS-IX-NAME     DELIMITED BY SIZE                      22110017
215500     INTO WS-IX-CREATOR-NAME.                                     22120017
215600                                                                  22130017
215700     MOVE +0 TO WS-NBR-CHARACTERS.                                22140017
215800     INSPECT WS-IX-CREATOR-NAME                                   22150017
215900       TALLYING WS-NBR-CHARACTERS                                 22160017
216000           FOR CHARACTERS BEFORE INITIAL ' '.                     22170017
216100                                                                  22180017
216200     IF WS-NBR-CHARACTERS <= 72                                   22190017
216300         WRITE IX-REORG-RECORD FROM WS-IX-CREATOR-NAME-1-72       22200017
216400     ELSE                                                         22210017
216500         IF WS-NBR-CHARACTERS <= 144                              22220017
216600             WRITE IX-REORG-RECORD                                22230017
216700                 FROM WS-IX-CREATOR-NAME-1-72                     22240017
216800             WRITE IX-REORG-RECORD                                22250017
216900                 FROM WS-IX-CREATOR-NAME-73-144                   22260017
217000         ELSE                                                     22270017
217100             IF WS-NBR-CHARACTERS <= 216                          22280017
217200                 WRITE IX-REORG-RECORD                            22290017
217300                     FROM WS-IX-CREATOR-NAME-1-72                 22300017
217400                 WRITE IX-REORG-RECORD                            22310017
217500                     FROM WS-IX-CREATOR-NAME-73-144               22320017
217600                 WRITE IX-REORG-RECORD                            22330017
217700                     FROM WS-IX-CREATOR-NAME-145-216              22340017
217800             ELSE                                                 22350017
217900                 WRITE IX-REORG-RECORD                            22360017
218000                     FROM WS-IX-CREATOR-NAME-1-72                 22370017
218100                 WRITE IX-REORG-RECORD                            22380017
218200                     FROM WS-IX-CREATOR-NAME-73-144               22390017
218300                 WRITE IX-REORG-RECORD                            22400017
218400                     FROM WS-IX-CREATOR-NAME-145-216              22410017
218500                 WRITE IX-REORG-RECORD                            22420017
218600                     FROM WS-IX-CREATOR-NAME-217-257.             22430017
218700                                                                  22440017
218800     IF WS-PARTITIONED-INDEX = 'N'                                22450017
218900         NEXT SENTENCE                                            22460017
219000     ELSE                                                         22470017
219100         MOVE WS-PART-CHAR  TO WS-IX-REORG-PART-NBR               22480017
219200         WRITE IX-REORG-RECORD FROM WS-IX-REORG-LINE2A.           22490017
219300                                                                  22500017
219400     PERFORM 6200-RESIZE-IX THRU 6200-EXIT.                       22510017
219500                                                                  22520017
219600                                                                  22530017
219700 6100-EXIT.                                                       22540017
219800     EXIT.                                                        22550017
219900                                                                  22560017
220000 6200-RESIZE-IX.                                                  22570017
220100                                                                  22580017
220200***************************************************************** 22590017
220300*** IF EXTENTS IS GREATER THAN THE THRESHOLD VALUE THEN       *** 22600017
220400*** GENERATE ALTER STATEMENTS TO RESIZE THE INDEX.            *** 22610017
220500***-----------------------------------------------------------*** 22620017
220600*** - PRIQTY IS SET TO THE LESSER OF THE FOLLOWING 2 VALUES:  *** 22630017
220700***   1) HI-ALLOCATED RBA (SPACE COLUMN)                      *** 22640017
220800***   2) 500 CYLINDERS (360000 KB)                            *** 22650017
220900***                                                           *** 22660017
221000*** - SECQTY IS SET TO THE LESSER OF THE FOLLOWING 2 VALUES:  *** 22670017
221100***   1) 10% OF HI-ALLOCATED RBA                              *** 22680017
221200***   2) 400 CYLINDERS (288000 KB)                            *** 22690017
221300***                                                           *** 22700017
221400***   - MINIMUM PRIQTY VALUE IS 1 CYLINDER  (720 KB)          *** 22710017
221500***   - MINIMUM SECQTY VALUE IS 5 CYLINDERS (3600 KB)         *** 22720017
221600***   - AN ALTER IS NOT GENERATED IF CALCULATED PRIQTY/SECQTY *** 22730017
221700***     ARE IDENTICAL TO THE CURRENT CATALOG VALUES.          *** 22740017
221800***************************************************************** 22750017
221900                                                                  22760017
222000     IF (IX-SPACE-NULLIND < 0                                     22770017
222100         OR IX-EXTENTS-NULLIND < 0)                               22780017
222200             GO TO 6200-EXIT                                      22790017
222300     END-IF.                                                      22800017
222400                                                                  22810017
222500     IF SYSRTSIX-EXTENTS > WS-THRESHOLD-EXTENTS                   22820017
222600         NEXT SENTENCE                                            22830017
222700     ELSE                                                         22840017
222800         GO TO 6200-EXIT.                                         22850017
222900                                                                  22860017
223000     MOVE SYSRTSIX-SPACE TO WS-NEW-PRIQTY-KB.                     22870017
223100     COMPUTE WS-NEW-SECQTY-KB = WS-NEW-PRIQTY-KB * .1.            22880017
223200                                                                  22890017
223300     IF WS-NEW-PRIQTY-KB > 360000                                 22900017
223400         MOVE 360000 TO WS-NEW-PRIQTY-KB.                         22910017
223500     IF WS-NEW-PRIQTY-KB < 720                                    22920017
223600         MOVE 720    TO WS-NEW-PRIQTY-KB.                         22930017
223700                                                                  22940017
223800     IF WS-NEW-SECQTY-KB > 288000                                 22950017
223900         MOVE 288000 TO WS-NEW-SECQTY-KB.                         22960017
224000     IF WS-NEW-SECQTY-KB < 3600                                   22970017
224100         MOVE 3600   TO WS-NEW-SECQTY-KB.                         22980017
224200                                                                  22990017
224300     COMPUTE WS-CURR-PRIQTY-KB = (SYSIXPT-PQTY * 4).              23000017
224400                                                                  23010017
224500     IF SYSIXPT-SECQTYI > 0                                       23020017
224600         COMPUTE WS-CURR-SECQTY-KB = (SYSIXPT-SECQTYI * 4)        23030017
224700     ELSE                                                         23040017
224800         COMPUTE WS-CURR-SECQTY-KB = (SYSIXPT-SQTY * 4).          23050017
224900                                                                  23060017
225000     IF (WS-NEW-PRIQTY-KB = WS-CURR-PRIQTY-KB                     23070017
225100         AND WS-NEW-SECQTY-KB = WS-CURR-SECQTY-KB)                23080017
225200             GO TO 6200-EXIT                                      23090017
225300     ELSE                                                         23100017
225400         NEXT SENTENCE.                                           23110017
225500                                                                  23120017
225600     WRITE ALTER-QTY-RECORD FROM WS-ALTER-IX-STMT-01.             23130017
225700                                                                  23140017
225800     MOVE SPACES TO WS-IX-CREATOR-NAME.                           23150017
225900                                                                  23160017
226000     STRING WS-IX-CREATOR  DELIMITED BY ' '                       23170017
226100            '.'            DELIMITED BY SIZE                      23180017
226200            WS-IX-NAME     DELIMITED BY SIZE                      23190017
226300         INTO WS-IX-CREATOR-NAME.                                 23200017
226400                                                                  23210017
226500     MOVE +0 TO WS-NBR-CHARACTERS.                                23220017
226600     INSPECT WS-IX-CREATOR-NAME                                   23230017
226700       TALLYING WS-NBR-CHARACTERS                                 23240017
226800           FOR CHARACTERS BEFORE INITIAL ' '.                     23250017
226900                                                                  23260017
227000     IF WS-NBR-CHARACTERS <= 72                                   23270017
227100         WRITE ALTER-QTY-RECORD FROM WS-IX-CREATOR-NAME-1-72      23280017
227200     ELSE                                                         23290017
227300         IF WS-NBR-CHARACTERS <= 144                              23300017
227400             WRITE ALTER-QTY-RECORD                               23310017
227500                 FROM WS-IX-CREATOR-NAME-1-72                     23320017
227600             WRITE ALTER-QTY-RECORD                               23330017
227700                 FROM WS-IX-CREATOR-NAME-73-144                   23340017
227800         ELSE                                                     23350017
227900             IF WS-NBR-CHARACTERS <= 216                          23360017
228000                 WRITE ALTER-QTY-RECORD                           23370017
228100                     FROM WS-IX-CREATOR-NAME-1-72                 23380017
228200                 WRITE ALTER-QTY-RECORD                           23390017
228300                     FROM WS-IX-CREATOR-NAME-73-144               23400017
228400                 WRITE ALTER-QTY-RECORD                           23410017
228500                     FROM WS-IX-CREATOR-NAME-145-216              23420017
228600             ELSE                                                 23430017
228700                 WRITE ALTER-QTY-RECORD                           23440017
228800                     FROM WS-IX-CREATOR-NAME-1-72                 23450017
228900                 WRITE ALTER-QTY-RECORD                           23460017
229000                     FROM WS-IX-CREATOR-NAME-73-144               23470017
229100                 WRITE ALTER-QTY-RECORD                           23480017
229200                     FROM WS-IX-CREATOR-NAME-145-216              23490017
229300                 WRITE ALTER-QTY-RECORD                           23500017
229400                     FROM WS-IX-CREATOR-NAME-217-257.             23510017
229500                                                                  23520017
229600     IF WS-PARTITIONED-INDEX = 'N'                                23530017
229700         NEXT SENTENCE                                            23540017
229800     ELSE                                                         23550017
229900         MOVE WS-PART-CHAR  TO WS-ALT-IX-PARTITION                23560017
230000         WRITE ALTER-QTY-RECORD FROM WS-ALTER-IX-STMT-02.         23570017
230100                                                                  23580017
230200     MOVE WS-NEW-PRIQTY-KB  TO WS-ALT-PRIQTY.                     23590017
230300     MOVE WS-NEW-SECQTY-KB  TO WS-ALT-SECQTY.                     23600017
230400                                                                  23610017
230500     WRITE ALTER-QTY-RECORD FROM WS-ALTER-SPACE-STMT.             23620017
230600                                                                  23630017
230700 6200-EXIT.                                                       23640017
230800     EXIT.                                                        23650017
230900                                                                  23660017
231000                                                                  23670017
231100 7000-REORG-TS.                                                   23680017
231200                                                                  23690017
231300***************************************************************** 23700017
231400*** SAVE THE DATABASE-TABLESPACE-PARTITION TO BE REORGED      *** 23710017
231500*** IN A WORKING STORAGE TABLE.                               *** 23720017
231600***                                                           *** 23730017
231700*** THE WORKING STORAGE TABLE TO BE POPULATED DEPENDS ON THE  *** 23740017
231800*** FOLLOWING:                                                *** 23750017
231900*** - WHETHER OR NOT KEEPDICTIONARY NEEDS TO BE SPECIFIED     *** 23760017
232000*** - WHETHER THE TABLESPACE IS A LOB                         *** 23770017
232100***                                                           *** 23780017
232200*** SEPARATE LISTDEFS WILL BE BUILT FOR EACH WORKING STORAGE  *** 23790017
232300*** TABLE.                                                    *** 23800017
232400***************************************************************** 23810017
232500                                                                  23820017
232600     IF SYSTABSP-TYPE = 'O'                                       23830017
232700         PERFORM 7030-STORE-LOB THRU 7030-EXIT                    23840017
232800         PERFORM 7100-RESIZE-TS THRU 7100-EXIT                    23850017
232900         GO TO 7000-EXIT                                          23860017
233000     END-IF.                                                      23870017
233100                                                                  23880017
233200     IF SYSTBPT-COMPRESS NOT = 'Y'                                23890017
233300         PERFORM 7010-STORE-NOKEEPDICT THRU 7010-EXIT             23900017
233400     ELSE                                                         23910017
233500         IF WS-BUILD-COMP-DICT = 'Y'                              23920017
233600             PERFORM 7010-STORE-NOKEEPDICT THRU 7010-EXIT         23930017
233700         ELSE                                                     23940017
233800             PERFORM 7020-STORE-KEEPDICT THRU 7020-EXIT.          23950017
233900                                                                  23960017
234000     PERFORM 7100-RESIZE-TS THRU 7100-EXIT.                       23970017
234100                                                                  23980017
234200                                                                  23990017
234300 7000-EXIT.                                                       24000017
234400     EXIT.                                                        24010017
234500                                                                  24020017
234600                                                                  24030017
234700 7010-STORE-NOKEEPDICT.                                           24040017
234800                                                                  24050017
234900***************************************************************** 24060017
235000*** STORE THE TABLESPACE IN THE ARRAY FOR THOSE TABLESPACES   *** 24070017
235100*** REORGED WITHOUT THE KEEPDICTIONARY KEYWORD (I.E. NOT      *** 24080017
235200*** COMPRESSED OR THE DICTIONARY NEEDS TO BE BUILT/REBUILT).  *** 24090017
235300***************************************************************** 24100017
235400                                                                  24110017
235500     IF WS-TS-REORG-COUNT-NOKEEPDICT = 5000                       24120017
235600         DISPLAY '******************************************'     24130017
235700         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     24140017
235800         DISPLAY '***                                    ***'     24150017
235900         DISPLAY '*** PARAGRAPH 7010-STORE-NOKEEPDICT    ***'     24160017
236000         DISPLAY '*** NO KEEPDICTIONARY ARRAY IS FULL    ***'     24170017
236100         DISPLAY '******************************************'     24180017
236200         MOVE +4004 TO WS-ABEND-CODE                              24190017
236300         PERFORM 9999-ABEND                                       24200017
236400     END-IF.                                                      24210017
236500                                                                  24220017
236600     ADD +1 TO WS-TS-REORG-COUNT-NOKEEPDICT.                      24230017
236700                                                                  24240017
236800     MOVE WS-DATABASE                                             24250017
236900         TO WS-TS-NOKEEPDICT-DB (WS-TS-REORG-COUNT-NOKEEPDICT).   24260017
237000                                                                  24270017
237100     MOVE WS-TABLESPACE                                           24280017
237200         TO WS-TS-NOKEEPDICT-TS (WS-TS-REORG-COUNT-NOKEEPDICT).   24290017
237300                                                                  24300017
237400     IF WS-PART-NBR = 0                                           24310017
237500         MOVE SPACES                                              24320017
237600             TO WS-TS-NOKEEPDICT-PART                             24330017
237700                  (WS-TS-REORG-COUNT-NOKEEPDICT)                  24340017
237800     ELSE                                                         24350017
237900         MOVE WS-PART-CHAR TO                                     24360017
238000             WS-TS-NOKEEPDICT-PART (WS-TS-REORG-COUNT-NOKEEPDICT) 24370017
238100     END-IF.                                                      24380017
238200                                                                  24390017
238300 7010-EXIT.                                                       24400017
238400     EXIT.                                                        24410017
238500                                                                  24420017
238600                                                                  24430017
238700 7020-STORE-KEEPDICT.                                             24440017
238800                                                                  24450017
238900***************************************************************** 24460017
239000*** STORE THE TABLESPACE IN THE ARRAY FOR THOSE TABLESPACES   *** 24470017
239100*** REORGED WITH THE KEEPDICTIONARY KEYWORD (I.E. TABLESPACE  *** 24480017
239200*** IS COMPRESSED AND THE DICTIONARY DOES NOT NEED TO BE      *** 24490017
239300*** REBUILT).                                                 *** 24500017
239400***************************************************************** 24510017
239500                                                                  24520017
239600     IF WS-TS-REORG-COUNT-KEEPDICT = 5000                         24530017
239700         DISPLAY '******************************************'     24540017
239800         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     24550017
239900         DISPLAY '***                                    ***'     24560017
240000         DISPLAY '*** PARAGRAPH 7020-STORE-KEEPDICT      ***'     24570017
240100         DISPLAY '*** KEEPDICTIONARY ARRAY IS FULL       ***'     24580017
240200         DISPLAY '******************************************'     24590017
240300         MOVE +4004 TO WS-ABEND-CODE                              24600017
240400         PERFORM 9999-ABEND                                       24610017
240500     END-IF.                                                      24620017
240600                                                                  24630017
240700     ADD +1 TO WS-TS-REORG-COUNT-KEEPDICT.                        24640017
240800                                                                  24650017
240900     MOVE WS-DATABASE                                             24660017
241000         TO WS-TS-KEEPDICT-DB (WS-TS-REORG-COUNT-KEEPDICT).       24670017
241100                                                                  24680017
241200     MOVE WS-TABLESPACE                                           24690017
241300         TO WS-TS-KEEPDICT-TS (WS-TS-REORG-COUNT-KEEPDICT).       24700017
241400                                                                  24710017
241500     IF WS-PART-NBR = 0                                           24720017
241600         MOVE SPACES                                              24730017
241700             TO WS-TS-KEEPDICT-PART (WS-TS-REORG-COUNT-KEEPDICT)  24740017
241800     ELSE                                                         24750017
241900         MOVE WS-PART-CHAR                                        24760017
242000             TO WS-TS-KEEPDICT-PART (WS-TS-REORG-COUNT-KEEPDICT)  24770017
242100     END-IF.                                                      24780017
242200                                                                  24790017
242300 7020-EXIT.                                                       24800017
242400     EXIT.                                                        24810017
242500                                                                  24820017
242600                                                                  24830017
242700 7030-STORE-LOB.                                                  24840017
242800                                                                  24850017
242900***************************************************************** 24860017
243000*** FOR LOB TABLESPACES:                                      *** 24870017
243100*** STORE THE TABLESPACE IN THE ARRAY FOR LOB TABLESPACES     *** 24880017
243200***************************************************************** 24890017
243300                                                                  24900017
243400     IF WS-LOB-TS-REORG-COUNT = 5000                              24910017
243500         DISPLAY '******************************************'     24920017
243600         DISPLAY '*** PROGRAM ERROR - DBKUT006           ***'     24930017
243700         DISPLAY '***                                    ***'     24940017
243800         DISPLAY '*** PARAGRAPH 7030-STORE-LOB           ***'     24950017
243900         DISPLAY '*** LOB ARRAY IS FULL                  ***'     24960017
244000         DISPLAY '******************************************'     24970017
244100         MOVE +4004 TO WS-ABEND-CODE                              24980017
244200         PERFORM 9999-ABEND                                       24990017
244300     END-IF.                                                      25000017
244400                                                                  25010017
244500     ADD +1 TO WS-LOB-TS-REORG-COUNT.                             25020017
244600                                                                  25030017
244700     MOVE WS-DATABASE                                             25040017
244800         TO WS-LOB-TS-DB (WS-LOB-TS-REORG-COUNT).                 25050017
244900                                                                  25060017
245000     MOVE WS-TABLESPACE                                           25070017
245100         TO WS-LOB-TS-TS (WS-LOB-TS-REORG-COUNT).                 25080017
245200                                                                  25090017
245300                                                                  25100017
245400 7030-EXIT.                                                       25110017
245500     EXIT.                                                        25120017
245600                                                                  25130017
245700                                                                  25140017
245800 7100-RESIZE-TS.                                                  25150017
245900                                                                  25160017
246000***************************************************************** 25170017
246100*** IF EXTENTS IS GREATER THAN THE THRESHOLD VALUE THEN       *** 25180017
246200*** GENERATE ALTER STATEMENTS TO RESIZE THE TABLESPACE.       *** 25190017
246300***-----------------------------------------------------------*** 25200017
246400*** - PRIQTY IS SET TO THE LESSER OF THE FOLLOWING 2 VALUES:  *** 25210017
246500***   1) HI-ALLOCATED RBA (SPACE COLUMN)                      *** 25220017
246600***   2) 500 CYLINDERS (360000 KB)                            *** 25230017
246700***                                                           *** 25240017
246800*** - SECQTY IS SET TO THE LESSER OF THE FOLLOWING 2 VALUES:  *** 25250017
246900***   1) 10% OF HI-ALLOCATED RBA                              *** 25260017
247000***   2) 400 CYLINDERS (288000 KB)                            *** 25270017
247100***                                                           *** 25280017
247200***   - MINIMUM PRIQTY VALUE IS 1 CYLINDER  (720 KB)          *** 25290017
247300***   - MINIMUM SECQTY VALUE IS 5 CYLINDERS (3600 KB)         *** 25300017
247400***   - AN ALTER IS NOT GENERATED IF CALCULATED PRIQTY/SECQTY *** 25310017
247500***     ARE IDENTICAL TO THE CURRENT CATALOG VALUES.          *** 25320017
247600***************************************************************** 25330017
247700                                                                  25340017
247800     IF (TS-SPACE-NULLIND < 0                                     25350017
247900         OR TS-EXTENTS-NULLIND < 0)                               25360017
248000             GO TO 7100-EXIT                                      25370017
248100     END-IF.                                                      25380017
248200                                                                  25390017
248300     IF SYSRTSTS-EXTENTS > WS-THRESHOLD-EXTENTS                   25400017
248400         NEXT SENTENCE                                            25410017
248500     ELSE                                                         25420017
248600         GO TO 7100-EXIT.                                         25430017
248700                                                                  25440017
248710     IF SYSTABSP-TYPE = 'G'                                       25450017
248720       AND WS-DATABASE = WS-ALT-DB                                25460017
248721       AND WS-TABLESPACE = WS-ALT-TS                              25470017
248740         GO TO 7100-EXIT                                          25480017
248741     END-IF.                                                      25490017
248750                                                                  25500017
248800     MOVE SYSRTSTS-SPACE TO WS-NEW-PRIQTY-KB.                     25510017
248900     COMPUTE WS-NEW-SECQTY-KB = WS-NEW-PRIQTY-KB * .1.            25520017
249000                                                                  25530017
249100     IF WS-NEW-PRIQTY-KB > 360000                                 25540017
249200         MOVE 360000 TO WS-NEW-PRIQTY-KB.                         25550017
249300     IF WS-NEW-PRIQTY-KB < 720                                    25560017
249400         MOVE 720    TO WS-NEW-PRIQTY-KB.                         25570017
249500                                                                  25580017
249600     IF WS-NEW-SECQTY-KB > 288000                                 25590017
249700         MOVE 288000 TO WS-NEW-SECQTY-KB.                         25600017
249800     IF WS-NEW-SECQTY-KB < 3600                                   25610017
249900         MOVE 3600   TO WS-NEW-SECQTY-KB.                         25620017
250000                                                                  25630017
250100     COMPUTE WS-CURR-PRIQTY-KB = (SYSTBPT-PQTY * 4).              25640017
250200                                                                  25650017
250300     IF SYSTBPT-SECQTYI > 0                                       25660017
250400         COMPUTE WS-CURR-SECQTY-KB = (SYSTBPT-SECQTYI * 4)        25670017
250500     ELSE                                                         25680017
250600         COMPUTE WS-CURR-SECQTY-KB = (SYSTBPT-SQTY * 4).          25690017
250700                                                                  25700017
250800     IF (WS-NEW-PRIQTY-KB = WS-CURR-PRIQTY-KB                     25710017
250900         AND WS-NEW-SECQTY-KB = WS-CURR-SECQTY-KB)                25720017
251000             GO TO 7100-EXIT                                      25730017
251100     ELSE                                                         25740017
251200         NEXT SENTENCE.                                           25750017
251300                                                                  25760017
251400     IF WS-PART-NBR = 0 OR SYSTABSP-TYPE = 'G'                    25770017
251500         MOVE SPACES TO WS-ALT-TS-PART-KEYWORD                    25780017
251600                        WS-ALT-TS-PARTITION                       25790017
251700     ELSE                                                         25800017
251800         MOVE 'PART'       TO WS-ALT-TS-PART-KEYWORD              25810017
251900         MOVE WS-PART-CHAR TO WS-ALT-TS-PARTITION.                25820017
252000                                                                  25830017
252100     MOVE SPACES TO WS-ALT-TS-DB-TS.                              25840017
252200     STRING WS-DATABASE    DELIMITED BY ' '                       25850017
252300            '.'            DELIMITED BY SIZE                      25860017
252400            WS-TABLESPACE  DELIMITED BY SIZE                      25870017
252500         INTO WS-ALT-TS-DB-TS.                                    25880017
252600                                                                  25890017
252700     MOVE WS-NEW-PRIQTY-KB  TO WS-ALT-PRIQTY.                     25900017
252800     MOVE WS-NEW-SECQTY-KB  TO WS-ALT-SECQTY.                     25910017
252900                                                                  25920017
253000     WRITE ALTER-QTY-RECORD FROM WS-ALTER-TS-STMT.                25930017
253100     WRITE ALTER-QTY-RECORD FROM WS-ALTER-SPACE-STMT.             25940017
253200                                                                  25950017
253300 7100-EXIT.                                                       25960017
253400     EXIT.                                                        25970017
253500                                                                  25980017
253600                                                                  25990017
253700 9999-DB2-ABEND.                                                  26000017
253800                                                                  26010017
253900     CALL 'DSNTIAR' USING SQLCA                                   26020017
254000                          DP004-FORMATTED-MESSAGE                 26030017
254100                          DP004-ERROR-LINE-LENGTH.                26040017
254200                                                                  26050017
254300     DISPLAY DP004-ASTERISK-LINE.                                 26060017
254400                                                                  26070017
254500     PERFORM                                                      26080017
254600         VARYING DP004-MSG-IDX                                    26090017
254700         FROM 1 BY 1                                              26100017
254800         UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES            26110017
254900             DISPLAY '**'                                         26120017
255000                     DP004-MESSAGE-LINE (DP004-MSG-IDX)           26130017
255100                     ' **'                                        26140017
255200     END-PERFORM.                                                 26150017
255300                                                                  26160017
255400     DISPLAY DP004-ASTERISK-LINE.                                 26170017
255500                                                                  26180017
255600     MOVE +4013      TO WS-ABEND-CODE                             26190017
255700     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         26200017
255800                                                                  26210017
255900 9999-ABEND.                                                      26220017
256000                                                                  26230017
256100     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         26240017
256200                                                                  26250017
