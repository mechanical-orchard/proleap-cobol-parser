000100 IDENTIFICATION DIVISION.                                         00010006
000200 PROGRAM-ID.    SUKCS801.                                         00020007
000300 AUTHOR.        Cognizant.                                        00030007
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040007
000500 DATE-WRITTEN.  MAY 2016.                                         00050007
000600 DATE-COMPILED.                                                   00060007
000700*---------------------------------------------------------------  00070007
000800*    S801 - getOutboundTripID WEBSERVICE TRANSACTION              00080007
000900*---------------------------------------------------------------  00090007
001000                                                                  00100007
001100 ENVIRONMENT DIVISION.                                            00110007
001200                                                                  00120007
001300 DATA DIVISION.                                                   00130007
001400                                                                  00140007
001500 WORKING-STORAGE SECTION.                                         00150007
001600   01  PC-PROGRAM-CONSTANTS.                                      00160007
001700     05  PC-TSYMSG-NUMBERS.                                       00170007
001701         10  PC-TSYMSG-01044         PIC 9(05) VALUE  01044.      00170107
001702         10  PC-TSYMSG-01570         PIC 9(05) VALUE  01570.      00170207
001703         10  PC-TSYMSG-03051         PIC 9(05) VALUE  03051.      00170307
001704         10  PC-TSYMSG-03053         PIC 9(05) VALUE  03053.      00170407
001705         10  PC-TSYMSG-03787         PIC 9(05) VALUE  03787.      00170507
001706     05  PC-S541-TRANSID             PIC X(04) VALUE 'S541'.      00170608
001707   01  PV-PROGRAM-VARIABLES.                                      00170700
001708     05  PV-TSYMSG-NUMBER            PIC 9(05) VALUE  0.          00170800
001709     05  PV-SQLCODE                  PIC 9(09) VALUE  0.          00170900
001710     05  PV-SHIPPED-TMST             PIC X(26).                   00171000
001711     05  PV-SHIPPED-TMST-DATE-HHMM   REDEFINES                    00171100
001720         PV-SHIPPED-TMST.                                         00172000
001730         10  PV-SHIPPED-CCYY         PIC X(04).                   00173000
001740         10  FILLER                  PIC X(01).                   00174000
001750         10  PV-SHIPPED-MM           PIC X(02).                   00175000
001760         10  FILLER                  PIC X(01).                   00176000
001770         10  PV-SHIPPED-DD           PIC X(02).                   00177000
001780         10  FILLER                  PIC X(01).                   00178000
001790         10  PV-SHIPPED-HH           PIC X(02).                   00179000
001800         10  FILLER                  PIC X(01).                   00180000
001810         10  PV-SHIPPED-MN           PIC X(02).                   00181000
001820         10  FILLER                  PIC X(01).                   00182000
001830         10  PV-SHIPPED-SC           PIC X(02).                   00183000
001840         10  FILLER                  PIC X(07).                   00184000
001850     05  PV-SEAL-UPPER-CASE          PIC X(20).                   00185014
001851     05  PV-SHIPPED-TMST-OUT         PIC X(19).                   00185114
001860     05  PV-SHIPPED-TMST-OUT-R       REDEFINES                    00186000
001870         PV-SHIPPED-TMST-OUT.                                     00187000
001880         10  PV-SHIPPED-DATE         PIC X(10).                   00188000
001890         10  PV-T                    PIC X(01).                   00189000
001900         10  PV-SHIPPED-TIME         PIC X(08).                   00190000
001910     05  PV-CICS-MSG-AREA.                                        00191000
001920         10 PV-PROGRAM-NAME          PIC X(10) VALUE ' SUKCS801 '.00192000
001921         10 PV-PARA-NAME             PIC X(25) VALUE SPACES.      00192100
001922         10 PV-ERROR-MSG             PIC X(85) VALUE SPACES.      00192200
001923     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00192300
001924                                                     COMP SYNC.   00192400
001925     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00192500
001926                                                     COMP SYNC.   00192600
001927   01  PV-PROGRAM-SWITCHES.                                       00192712
001928     05  PS-CHECK-TRLR-ST-SW        PIC X(01).                    00192812
001929         88  PS-CHECK-TRLR-ST                        VALUE 'Y'.   00192912
001930         88  PS-CHECK-TRLR-ST-NO                     VALUE 'N'.   00193012
001931                                                                  00193112
001932*INPUT                                                            00193212
001933      COPY SURD113.                                               00193312
001934*OUTPUT                                                           00193412
001940      COPY SURD114.                                               00194000
001941*                                                                 00194107
001942 01  CA-S541-COMMAREA.                                            00194207
001943     05  CA-TRLR-SEAL-ID                 PIC   X(20).             00194307
001944                                                                  00194407
001950                                                                  00195000
001960      COPY DPRD507I.                                              00196000
001970                                                                  00197000
001980     EXEC SQL                                                     00198000
001990         INCLUDE SQLCA                                            00199000
002000     END-EXEC.                                                    00200000
002100                                                                  00210000
002200     EXEC SQL                                                     00220000
002300         INCLUDE TSUOBTS                                          00230000
002400     END-EXEC.                                                    00240000
002500                                                                  00250000
002600     EXEC SQL                                                     00260000
002700         INCLUDE TSUOBTR                                          00270000
002800     END-EXEC.                                                    00280000
002900                                                                  00290000
003000     EXEC SQL                                                     00300000
003100         INCLUDE TCNTRID                                          00310000
003200     END-EXEC.                                                    00320000
003300                                                                  00330000
003400     EXEC SQL                                                     00340000
003500         INCLUDE TKRPRPM                                          00350000
003600     END-EXEC.                                                    00360000
003700                                                                  00370000
003800*----------------------------------------------------------------*00380000
003900 LINKAGE SECTION.                                                 00390000
004000                                                                  00400000
004210 01  DFHCOMMAREA.                                                 00421006
004220     05  FILLER                         OCCURS  1 TO 32000 TIMES  00422006
004230                                        DEPENDING ON EIBCALEN.    00423006
004240         10  FILLER                     PIC X.                    00424006
004300                                                                  00430000
004500 PROCEDURE DIVISION.                                              00450000
004600***************************************************************** 00460000
004700** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 00470000
004800***************************************************************** 00480000
004900 0000-MAIN-MODULE.                                                00490000
005000                                                                  00500000
005100     PERFORM 1000-INITIALIZE.                                     00510000
005200     PERFORM 1100-CHECK-WEBSERV-AVAIL.                            00520000
005300     IF EIBCALEN > 0                                              00530000
005400                                                                  00540000
005500        MOVE DFHCOMMAREA(1:20)     TO SU113-GET-OUTBOUND-TRIP     00550000
005600                                                                  00560000
005700        IF SU113-TRLR-SEAL-ID NOT EQUAL SPACES                    00570000
005800                                                                  00580000
005810           MOVE FUNCTION UPPER-CASE(SU113-TRLR-SEAL-ID)           00581014
005811             TO PV-SEAL-UPPER-CASE                                00581114
005812                                                                  00581214
005813           MOVE PV-SEAL-UPPER-CASE  TO  SU113-TRLR-SEAL-ID        00581314
005820                                                                  00582014
005900           PERFORM 2000-GET-OUTBOUND-TRIP                         00590014
006000                                                                  00600000
006001***                                                               00600107
006002           PERFORM 1200-CHECK-TRLR-STAT                           00600212
006003                                                                  00600312
006004*   if the current status of the trailer is one of the following  00600407
006005*   it is an error.  This program will kick off S541 (SUKCS541)   00600507
006006*   that will start a batch job (SUK950) to send an email to the  00600607
006007*   supporting DC LP, and various other groups.                   00600707
006008*                                                                 00600807
006009*   'DO' - Open at DC                                             00600907
006010*   'DC' - Closed at DC                                           00601007
006011*   'AO' - Open for Audit at DC                                   00601107
006012*   'AK' - Audit closed at DC - keep trailer                      00601207
006013***                                                               00601307
006014           IF  PS-CHECK-TRLR-ST                                   00601413
006015               IF  SUOBTS-TRIP-STAT-CDE = 'DO'  OR                00601512
006016                   SUOBTS-TRIP-STAT-CDE = 'DC'  OR                00601612
006017                   SUOBTS-TRIP-STAT-CDE = 'AO'  OR                00601712
006018                   SUOBTS-TRIP-STAT-CDE = 'AK'                    00601812
006020                   PERFORM 3000-START-EMAIL-TRANSACTION           00602012
006030               END-IF                                             00603012
006040           END-IF                                                 00604012
006100        ELSE                                                      00610000
006200                                                                  00620000
006300           MOVE PC-TSYMSG-03051    TO PV-TSYMSG-NUMBER            00630000
006400           MOVE 'TRAILER SEAL ID REQUIRED ' TO PV-ERROR-MSG       00640000
006500           MOVE '0000-MAIN-MODULE         ' TO PV-PARA-NAME       00650000
006600           PERFORM 9995-CSSL-LOG-RETURN                           00660000
006700                                                                  00670000
006800        END-IF                                                    00680000
006900     END-IF.                                                      00690000
007000                                                                  00700000
007100     PERFORM 9000-RETURN-TRAN                                     00710000
007200        .                                                         00720000
007300*----------------------------------------------------------------*00730000
007400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *00740000
007500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *00750000
007600*----------------------------------------------------------------*00760000
007700                                                                  00770000
007800 1000-INITIALIZE.                                                 00780000
007900     INITIALIZE SU113-GET-OUTBOUND-TRIP                           00790000
008000                SU114-OUT-OUTBOUND-TRIP.                          00800000
008100                                                                  00810000
008200 1100-CHECK-WEBSERV-AVAIL.                                        00820000
008300                                                                  00830000
008400      EXEC SQL                                                    00840000
008500        SELECT FUNC_TXT                                           00850000
008600          INTO :KRPRPM-FUNC-TXT                                   00860000
008700          FROM TKRPRPM                                            00870000
008800        WHERE LOC_ID            = 90                              00880000
008900          AND INTFC_SYS_CDE     = 'KHL'                           00890000
009000          AND SYS_PRC_FUNC_CDE  = 'STWEB1'                        00900000
009100          AND FUNC_PRC_STAT_CDE = 'AC'                            00910000
009200          AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              00920000
009300          AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              00930000
009400          AND FUNC_TXT          = 'Y'                             00940000
009500        WITH UR                                                   00950000
009600      END-EXEC.                                                   00960000
009700                                                                  00970000
009800     EVALUATE TRUE                                                00980000
009900         WHEN SQLCODE = ZERO                                      00990000
010000                                                                  01000000
010100                  CONTINUE                                        01010000
010200                                                                  01020000
010300         WHEN SQLCODE = +100                                      01030000
010400                                                                  01040000
010500              MOVE PC-TSYMSG-03787           TO PV-TSYMSG-NUMBER  01050000
010600              MOVE 'WEB SERVICE getOutboundTripId NOT AVAILABLE'  01060000
010700                                               TO PV-ERROR-MSG    01070000
010800              MOVE '1100-CHECK-WEBSERV-AVAIL ' TO PV-PARA-NAME    01080000
010900              PERFORM 9995-CSSL-LOG-RETURN                        01090000
011000                                                                  01100000
011100         WHEN SQLCODE NOT = ZERO                                  01110000
011200                                                                  01120000
011300              MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER 01130000
011400              MOVE SQLCODE                    TO PV-SQLCODE       01140000
011500              MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME     01150000
011600              STRING 'SELECT TKRPRPM FAILED WITH SQLCODE:'        01160000
011700              PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG     01170000
011800              PERFORM 9995-CSSL-LOG-RETURN                        01180000
011900                                                                  01190000
012000     END-EVALUATE.                                                01200000
012001                                                                  01200112
012002                                                                  01200212
012010 1200-CHECK-TRLR-STAT.                                            01201012
012020                                                                  01202012
012030      EXEC SQL                                                    01203012
012040        SELECT FUNC_TXT                                           01204012
012050          INTO :KRPRPM-FUNC-TXT                                   01205012
012060          FROM TKRPRPM                                            01206012
012070        WHERE LOC_ID            = 90                              01207012
012080          AND INTFC_SYS_CDE     = 'KHL'                           01208012
012090          AND SYS_PRC_FUNC_CDE  = 'SUOBCK'                        01209012
012091          AND FUNC_PRC_STAT_CDE = 'AC'                            01209112
012092          AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              01209212
012093          AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              01209312
012094          AND FUNC_TXT          = 'Y'                             01209412
012095        WITH UR                                                   01209512
012096      END-EXEC.                                                   01209612
012097                                                                  01209712
012098     EVALUATE TRUE                                                01209812
012099         WHEN SQLCODE = ZERO                                      01209912
012100              MOVE KRPRPM-FUNC-TXT  TO  PS-CHECK-TRLR-ST-SW       01210012
012102                                                                  01210212
012110                                                                  01211012
012111         WHEN SQLCODE NOT = ZERO                                  01211112
012112              SET  PS-CHECK-TRLR-ST-NO  TO  TRUE                  01211212
012120                                                                  01212012
012121     END-EVALUATE.                                                01212112
012122                                                                  01212212
012130 2000-GET-OUTBOUND-TRIP.                                          01213000
012200                                                                  01220000
012300      MOVE SU113-TRLR-SEAL-ID   TO SUOBTS-TRLR-SEAL-ID            01230000
012400                                                                  01240000
012500      EXEC SQL                                                    01250000
012600         SELECT                                                   01260000
012700            OBTS.OTBND_TRIP_ID                                    01270000
012800           ,OBTR.DEST_OPER_UNT_ID                                 01280000
012900           ,OBTR.TRLR_SRL_NBR                                     01290000
013000           ,OBTS.TRIP_STAT_CDE                                    01300000
013100           ,OBTS.OTBND_STAT_TMST                                  01310000
013200           ,TRID.SCAC_CDE                                         01320000
013300           ,TRID.TRLR_ID                                          01330000
013310           ,OBTR.ORGN_OPER_UNT_ID                                 01331001
013400          INTO                                                    01340000
013500            :SUOBTS-OTBND-TRIP-ID                                 01350000
013600           ,:SUOBTR-DEST-OPER-UNT-ID                              01360000
013700           ,:SUOBTR-TRLR-SRL-NBR                                  01370000
013800           ,:SUOBTS-TRIP-STAT-CDE                                 01380000
013900           ,:SUOBTS-OTBND-STAT-TMST                               01390000
014000           ,:CNTRID-SCAC-CDE                                      01400000
014100           ,:CNTRID-TRLR-ID                                       01410000
014110           ,:SUOBTR-ORGN-OPER-UNT-ID                              01411002
014200          FROM                                                    01420000
014300              TSUOBTS OBTS                                        01430000
014400            , TSUOBTR OBTR                                        01440000
014500            , TCNTRID TRID                                        01450000
014600          WHERE                                                   01460000
014700                OBTS.TRLR_SEAL_ID  = :SUOBTS-TRLR-SEAL-ID         01470000
014800            AND OBTS.OTBND_TRIP_ID = OBTR.OTBND_TRIP_ID           01480000
014900            AND OBTR.TRIP_ACTV_CDE = 'A'                          01490000
015000            AND OBTR.TRLR_SRL_NBR  = TRID.TRLR_SRL_NBR            01500000
015100            AND  OBTS.OTBND_STAT_TMST =                           01510000
015200                    (SELECT  MAX(OBTS1.OTBND_STAT_TMST)           01520000
015300                               FROM  TSUOBTS OBTS1                01530000
015400              WHERE  OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)    01540000
015500          WITH UR                                                 01550000
015600      END-EXEC.                                                   01560000
015700                                                                  01570000
015800      EVALUATE TRUE                                               01580000
015900         WHEN SQLCODE = ZERO                                      01590000
016000                                                                  01600000
016100            MOVE SUOBTS-OTBND-TRIP-ID    TO SU114-OTBND-TRP-ID    01610000
016200            MOVE SUOBTR-DEST-OPER-UNT-ID TO SU114-STORE-NBR       01620000
016300            MOVE SUOBTR-TRLR-SRL-NBR     TO SU114-TRLR-SRL-NBR    01630000
016400            MOVE SUOBTS-TRIP-STAT-CDE    TO SU114-TRLR-STATUS     01640000
016500            MOVE CNTRID-TRLR-ID          TO SU114-TRAILER-ID      01650000
016600            MOVE CNTRID-SCAC-CDE         TO SU114-TRLR-SCAC-CDE   01660000
016610            MOVE SUOBTR-ORGN-OPER-UNT-ID TO SU114-SHIP-NODE       01661001
016700            MOVE SUOBTS-OTBND-STAT-TMST  TO PV-SHIPPED-TMST       01670000
016800            MOVE PV-SHIPPED-TMST(1:10)   TO PV-SHIPPED-DATE       01680000
016900            MOVE PV-SHIPPED-HH           TO PV-SHIPPED-TIME(1:2)  01690000
017000            MOVE ':'                     TO PV-SHIPPED-TIME(3:1)  01700000
017100                                            PV-SHIPPED-TIME(6:1)  01710000
017200            MOVE 'T'                     TO PV-T                  01720000
017300            MOVE PV-SHIPPED-MN           TO PV-SHIPPED-TIME(4:2)  01730000
017400            MOVE PV-SHIPPED-SC           TO PV-SHIPPED-TIME(7:2)  01740000
017500            MOVE PV-SHIPPED-TMST-OUT     TO SU114-TRLR-TMST       01750000
017600            MOVE PC-TSYMSG-01044         TO PV-TSYMSG-NUMBER      01760000
017700                                                                  01770000
017800         WHEN SQLCODE = 100                                       01780000
017900                                                                  01790000
018000            MOVE PC-TSYMSG-03053         TO PV-TSYMSG-NUMBER      01800000
018100            STRING 'OUTBOUND TRIP ID NOT FOUND FOR SEAL ID: '     01810000
018200                SU113-TRLR-SEAL-ID DELIMITED BY SIZE INTO         01820000
018300                                                 PV-ERROR-MSG     01830000
018400            MOVE ' 2000-GET-OUTBOUND-TRIP '   TO PV-PARA-NAME     01840000
018500            PERFORM 9990-CSSL-LOG                                 01850000
018600                                                                  01860000
018700         WHEN SQLCODE NOT = ZERO                                  01870000
018800                                                                  01880000
018900            MOVE SQLCODE    TO PV-SQLCODE                         01890000
019000                                                                  01900000
019100            MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER     01910000
019200            STRING 'SELECT TSUOBTS TABLE FAILED WITH SQLCODE:'    01920000
019300                   PV-SQLCODE ' INPUT SEAL ID:'                   01930000
019400                SU113-TRLR-SEAL-ID DELIMITED BY SIZE INTO         01940000
019500                                               PV-ERROR-MSG       01950000
019600            MOVE ' 2000-GET-OUTBOUND-TRIP ' TO PV-PARA-NAME       01960000
019700            PERFORM 9995-CSSL-LOG-RETURN                          01970000
019800                                                                  01980000
019900      END-EVALUATE                                                01990000
020000      .                                                           02000000
020100      EJECT                                                       02010000
020110                                                                  02011007
020120                                                                  02012007
020121 3000-START-EMAIL-TRANSACTION.                                    02012107
020140                                                                  02014007
020142     MOVE SU113-TRLR-SEAL-ID   TO  CA-TRLR-SEAL-ID.               02014209
020143                                                                  02014307
020144     DISPLAY 'SUKCS801: ' SU113-TRLR-SEAL-ID.                     02014410
020145     DISPLAY 'SUKCS801: ' CA-TRLR-SEAL-ID.                        02014511
020146                                                                  02014611
020147     EXEC CICS                                                    02014711
020148         START TRANSID(PC-S541-TRANSID)                           02014811
020149               FROM   (CA-S541-COMMAREA)                          02014911
020150     END-EXEC.                                                    02015011
020160                                                                  02016011
020200 9990-CSSL-LOG.                                                   02020000
020300                                                                  02030000
020400      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     02040000
020500                                                                  02050000
020600      EXEC CICS                                                   02060000
020700           WRITEQ TD                                              02070000
020800            QUEUE   ('CSSL')                                      02080000
020900             FROM   (PV-CICS-MSG-AREA)                            02090000
021000           LENGTH   (PV-COMMAREA-LENGTH)                          02100000
021100             RESP   (PV-CICS-RESPONSE)                            02110000
021200      END-EXEC.                                                   02120000
021300                                                                  02130000
021400     .                                                            02140000
021500 9995-CSSL-LOG-RETURN.                                            02150000
021600                                                                  02160000
021700     PERFORM 9990-CSSL-LOG.                                       02170000
021800                                                                  02180000
021900     PERFORM 9000-RETURN-TRAN.                                    02190000
022000                                                                  02200000
022100 9000-RETURN-TRAN.                                                02210000
022200                                                                  02220000
022300     MOVE PV-TSYMSG-NUMBER        TO DP507I-MSG-NUMBER            02230000
022400                                     SU114-MSG-ID.                02240000
022500                                                                  02250000
022600     PERFORM 9010-READ-SYSTEM-MESSAGE.                            02260000
022700     MOVE DP507I-MSG-TEXT(1:50)   TO SU114-MSG-TEXT               02270000
022800     MOVE SU114-OUT-OUTBOUND-TRIP TO DFHCOMMAREA.                 02280000
022900                                                                  02290000
023000     EXEC CICS RETURN END-EXEC                                    02300000
023100     .                                                            02310000
023200 9010-READ-SYSTEM-MESSAGE.                                        02320000
023300     EXEC CICS READ                                               02330000
023400               DATASET ('DPSYSMSG')                               02340000
023500               RIDFLD  (DP507I-MSG-NUMBER)                        02350000
023600               INTO    (DP507I-MESSAGES-INPUT-RECORD)             02360000
023700               RESP    (PV-CICS-RESPONSE)                         02370000
023800     END-EXEC.                                                    02380000
023900*                                                                 02390000
024000     IF  PV-CICS-RESPONSE NOT = 0                                 02400000
024100         MOVE ' ** ABEND **   UNABLE TO TRANSLATE MESSAGE NUMBER' 02410000
024200                                TO DP507I-MSG-TEXT                02420000
024300     END-IF.                                                      02430000
024400                                                                  02440000
