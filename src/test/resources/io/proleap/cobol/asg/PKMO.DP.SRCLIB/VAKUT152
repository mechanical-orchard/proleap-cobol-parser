       IDENTIFICATION DIVISION.                                         11/04/94
00002                                                                   VAKUT152
W34517 PROGRAM-ID.    VAKUT152                                             LV024
00004  AUTHOR.        CLARK SCHWENN.                                       CL**1
00005  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
00006  DATE-WRITTEN.  03-21-06.                                            CL**1
00007  DATE-COMPILED.                                                      CL**1
00008                                                                      CL**1
W34517****IMPORTANT*****************************************************        
W34517* THIS IS A CLONE OF THE INKUT152 CREATED FOR THE VA PROJECT     *        
W34517* THE MAJOR CHANGES ARE .....                                    *        
W34517******************************************************************        
00009 ******************************************************************   CL**1
W34517*      VAKUT152 - CONVERT NEXT-YEAR DATES TO THIS-YEAR DATES         CL**9
00011 *                                                                    CL**1
00012 * THIS PROGRAM IS EXECUTED AS PART OF THE INVENTORY LEDGER FLOW.     CL**1
00013 * IT IS NEEDED TO ACCOMODATE THE SITUATION WHERE SOME STORES ARE     CL**1
00014 * NOT INVENTORIED UNTIL AFTER THE LAST DAY OF THE FISCAL YEAR.  IN   CL**1
00015 * THIS SITUATION, TRANSACTIONS THAT OCCUR AFTER THE LAST DAY OF      CL**1
00016 * THE FISCAL YEAR ARE PROCESSED AS THOUGH THEY BELONG TO THE LAST    CL**1
00017 * FISCAL PERIOD OF THE CURRENT YEAR.  THE CURRENT FISCAL YEAR IS     CL**1
00018 * DETERMINED FROM THE DATE ON THE INPUT CONTROL CARD.  FOUR          CL**1
00019 * TRANSACTION EXTRACT FILES (PURCHASE, SALE, PRICE CHANGE, AND       CL**1
00020 * ADJUSTMENT) ARE READ, AND THE TRANSACTION DATE ON EACH RECORD IS   CL**8
00021 * COMPARED TO THE YEAR-END DATE OF THE CURRENT DATE. IF THE          CL**1
00022 * TRANSACTION DATE FALLS INTO THE NEXT FISCAL YEAR, IT IS CHANGED    CL**1
00023 * TO THE YEAR-END DATE OF THE CURRENT FISCAL YEAR.                   CL**1
      *                                                                         
      *CHANGE HISTORY:                                                          
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES                   
      * ------- ---------- ----------- --------------------------------         
W28582* 12/20/05  CLARK SCHWENN                                                 
W28582*           NEW PROGRAM TO HANDLE BRAND/VENDOR CHANGES FOR JOB       CL**1
W28582*           INK1611.                                                 CL**1
      **  BELOW ARE COMMENTS FROM THE COPIED PROGRAM INKUT151!!!!!!!!           
00008 * 08/03/98  JULIE SEIDLER                                            CL**1
00023 *           TO ACCOMODATE THE TAKING OF MID-YEAR INVENTORIES,        CL**1
 0025 *           LOGIC WAS CHANGED TO LOOK AT FISCL-MONTH-END INSTEAD     CL**1
00026 *           OF FISCAL-YEAR-END.  THE FISCAL-MONTH-END DATE IS        CL**1
00026 *           OBTAINED FROM THE TMLCNTL DB2 TABLE. THE INPUT FISCAL-   CL**1
00026 *           YEAR-END CONTROL CARD WAS REMOVED FROM THE PGM.          CL**1
00008 * 08/09/99  JULIE SEIDLER                                            CL**1
00023 *           REMOVED REFERENCE TO DPG51-SYSTEM-DATE.                  CL**1
00008 * 01/28/00  SCOTT JACKSON                                            CL**1
00023 *           REMOVED EXCESSIVE SYSOUT DISPLAYS FROM GENERATING.       CL**1
W20445* W20445  09-01-2004 ROD JANSSEN DETAILED INVNENTORY ADJUSTMENT           
W34517* W34517  10-14-2008  INFOSYS    CLONE OF INKUT152 FOR VA                 
W34517*                                INVENTORY STREAM.                        
00024 ******************************************************************   CL**1
00027                                                                      CL**1
00028  ENVIRONMENT DIVISION.                                               CL**1
00029                                                                      CL**1
00030                                                                      CL**8
00031  CONFIGURATION SECTION.                                              CL**1
00032                                                                      CL**8
00033  SOURCE-COMPUTER.        IBM-3090.                                   CL**1
00034  OBJECT-COMPUTER.        IBM-3090.                                   CL**1
00035                                                                      CL**8
00036                                                                      CL**8
00037  INPUT-OUTPUT SECTION.                                               CL**1
00038                                                                      CL**8
00039  FILE-CONTROL.                                                       CL**1
00040                                                                      CL**8
00041      SELECT PURCHASE-EXTRACT-FILE-I      ASSIGN TO INP01.            CL**8
00042      SELECT SALE-EXTRACT-FILE-I          ASSIGN TO INP02.            CL**8
00043      SELECT PRICE-CHNG-EXTRACT-FILE-I    ASSIGN TO INP03.            CL*10
00044      SELECT ADJUSTMENT-EXTRACT-FILE-I    ASSIGN TO INP04.            CL**8
00045                                                                      CL**2
00046      SELECT PURCHASE-EXTRACT-FILE-O      ASSIGN TO OUT01.            CL**8
00047      SELECT SALE-EXTRACT-FILE-O          ASSIGN TO OUT02.            CL**8
00048      SELECT PRICE-CHNG-EXTRACT-FILE-O    ASSIGN TO OUT03.            CL*10
00049      SELECT ADJUSTMENT-EXTRACT-FILE-O    ASSIGN TO OUT04.            CL**8
00050                                                                      CL**1
00051                                                                      CL**1
00052                                                                      CL**1
00053  DATA DIVISION.                                                      CL**1
00054                                                                      CL**8
00055                                                                      CL**8
00056  FILE SECTION.                                                       CL**1
00057                                                                      CL**1
00058  FD  PURCHASE-EXTRACT-FILE-I                                         CL**2
00059      LABEL RECORDS ARE STANDARD                                      CL**1
00060      RECORDING MODE IS F                                             CL**1
00061      BLOCK CONTAINS 0 RECORDS.                                       CL**1
00062  01  PURCHASE-EXTRACT-RECORD-I   PIC X(200).                         CL**2
00063                                                                      CL**1
00064  FD  SALE-EXTRACT-FILE-I                                             CL**2
00065      LABEL RECORDS ARE STANDARD                                      CL**1
00066      RECORDING MODE IS F                                             CL**1
00067      BLOCK CONTAINS 0 RECORDS.                                       CL**1
00068  01  SALE-EXTRACT-RECORD-I       PIC X(80).                          CL**2
00069                                                                      CL**1
00070  FD  PRICE-CHNG-EXTRACT-FILE-I                                       CL*10
00071      LABEL RECORDS ARE STANDARD                                      CL**1
00072      RECORDING MODE IS F                                             CL**1
00073      BLOCK CONTAINS 0 RECORDS.                                       CL**1
00074  01  PRICE-CHNG-EXTRACT-RECORD-I                                     CL*10
00075                                  PIC X(200).                         CL**2
00076                                                                      CL**1
00077  FD  ADJUSTMENT-EXTRACT-FILE-I                                       CL**2
00078      LABEL RECORDS ARE STANDARD                                      CL**1
00079      RECORDING MODE IS F                                             CL**1
00080      BLOCK CONTAINS 0 RECORDS.                                       CL**1
00081  01  ADJUSTMENT-EXTRACT-RECORD-I                                     CL**2
00082                                PIC X(90).                            CL**2
00083                                                                      CL**1
00084  FD  PURCHASE-EXTRACT-FILE-O                                         CL**2
00085      LABEL RECORDS ARE STANDARD                                      CL**2
00086      RECORDING MODE IS F                                             CL**2
00087      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00088  01  PURCHASE-EXTRACT-RECORD-O   PIC X(200).                         CL**2
00089                                                                      CL**2
00090  FD  SALE-EXTRACT-FILE-O                                             CL**2
00091      LABEL RECORDS ARE STANDARD                                      CL**2
00092      RECORDING MODE IS F                                             CL**2
00093      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00094  01  SALE-EXTRACT-RECORD-O       PIC X(80).                          CL**2
00095                                                                      CL**2
00096  FD  PRICE-CHNG-EXTRACT-FILE-O                                       CL*10
00097      LABEL RECORDS ARE STANDARD                                      CL**2
00098      RECORDING MODE IS F                                             CL**2
00099      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00100  01  PRICE-CHNG-EXTRACT-RECORD-O                                     CL*10
00101                                  PIC X(200).                         CL**2
00102                                                                      CL**2
00103  FD  ADJUSTMENT-EXTRACT-FILE-O                                       CL**2
00104      LABEL RECORDS ARE STANDARD                                      CL**2
00105      RECORDING MODE IS F                                             CL**2
00106      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00107  01  ADJUSTMENT-EXTRACT-RECORD-O                                     CL**2
00108                                PIC X(90).                            CL**2
00109                                                                      CL**2
00110                                                                      CL**1
00111  WORKING-STORAGE SECTION.                                            CL**1
00112                                                                      CL**1
00113  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00114      05  PC-CALENDAR-ROUTINE               PIC  X(08) VALUE          CL**8
00115                                                        'DPKUT500'.   CL**1
           05  PC-MAX-RETRIES                    PIC S9(04) COMP SYNC           
                                                       VALUE +3.                
00116                                                                      CL**1
00117  01  PS-PROGRAM-SWITCHES.                                            CL**1
00118      05  PS-EOF-PURCHASE-EXTRACT-SW        PIC  X     VALUE 'N'.     CL**8
00119          88  PS-EOF-PURCHASE-EXTRACT                  VALUE 'Y'.     CL**8
00120      05  PS-EOF-SALE-EXTRACT-SW            PIC  X     VALUE 'N'.     CL**8
00121          88  PS-EOF-SALE-EXTRACT                      VALUE 'Y'.     CL**8
00122      05  PS-EOF-PRICE-CHNG-EXTRACT-SW      PIC  X     VALUE 'N'.     CL*10
00123          88  PS-EOF-PRICE-CHNG-EXTRACT                VALUE 'Y'.     CL*10
00124      05  PS-EOF-ADJUSTMENT-EXTRACT-SW      PIC  X     VALUE 'N'.     CL**8
00125          88  PS-EOF-ADJUSTMENT-EXTRACT                VALUE 'Y'.     CL**8
00126                                                                      CL**1
00127  01  PV-PROGRAM-VARIABLES.                                           CL**1
           05  PV-RETRY-COUNT                  PIC S9(04) COMP SYNC             
                                                       VALUE ZERO.              
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE.         
           05  PV-DB2-OPER-ATTEMPTED           PIC X(30)   VALUE SPACE.         
           05  PV-MAX-RETRIES                  PIC S9(3)   VALUE +3.            
00128      05  PV-LAST-FD-DB2-ISO-FMT            PIC  X(10).               CL*12
00129      05  PV-LAST-FD-CCYY.                                            CL*12
00130          10  PV-LAST-FD-CC                 PIC  9(02).               CL*12
00131          10  PV-LAST-FD-YY                 PIC  9(02).               CL*12
00132      05  PV-LAST-FD-PERIOD-NBR-X           PIC  X(02).               CL**8
00133      05  PV-LAST-FD-WEEK-NBR               PIC  9(02).               CL**8
00134      05  PV-LAST-FD-PERIOD-WEEK            PIC  9.                   CL*14
00135      05  PV-LAST-FD-NUMERIC-WEEK-DAY-X     PIC  X.                   CL**8
00136                                                                      CL**1
00137                                                                      CL**1
00138  01  PA-PROGRAM-ACCUMULATORS.                                        CL*16
00139      05  PA-PURCHASE-RECORDS-READ          PIC S9(7)     COMP-3      CL*19
00140                                                          VALUE 0.    CL*19
00141      05  PA-PURCHASE-COST-READ             PIC S9(13)V99 COMP-3      CL*16
00142                                                          VALUE 0.    CL*16
00143      05  PA-PURCHASE-RTL-READ              PIC S9(13)V99 COMP-3      CL*16
00144                                                          VALUE 0.    CL*16
00145      05  PA-PURCHASE-RECORDS-CHANGED       PIC S9(7)     COMP-3      CL*19
00146                                                          VALUE 0.    CL*19
00147      05  PA-PURCHASE-COST-CHANGED          PIC S9(13)V99 COMP-3      CL*19
00148                                                          VALUE 0.    CL*19
00149      05  PA-PURCHASE-RTL-CHANGED           PIC S9(13)V99 COMP-3      CL*19
00150                                                          VALUE 0.    CL*19
00151                                                                      CL*19
00152      05  PA-XFER-FROM-RECORDS-READ         PIC S9(7)     COMP-3      CL*19
00153                                                          VALUE 0.    CL*19
00154      05  PA-XFER-FROM-COST-READ            PIC S9(13)V99 COMP-3      CL*16
00155                                                          VALUE 0.    CL*16
00156      05  PA-XFER-FROM-RTL-READ             PIC S9(13)V99 COMP-3      CL*16
00157                                                          VALUE 0.    CL*16
00158      05  PA-XFER-FROM-RECORDS-CHANGED      PIC S9(7)     COMP-3      CL*19
00159                                                          VALUE 0.    CL*19
00160      05  PA-XFER-FROM-COST-CHANGED         PIC S9(13)V99 COMP-3      CL*19
00161                                                          VALUE 0.    CL*19
00162      05  PA-XFER-FROM-RTL-CHANGED          PIC S9(13)V99 COMP-3      CL*19
00163                                                          VALUE 0.    CL*19
00164                                                                      CL*19
00165      05  PA-XFER-TO-RECORDS-READ           PIC S9(7)     COMP-3      CL*19
00166                                                          VALUE 0.    CL*19
00167      05  PA-XFER-TO-COST-READ              PIC S9(13)V99 COMP-3      CL*16
00168                                                          VALUE 0.    CL*16
00169      05  PA-XFER-TO-RTL-READ               PIC S9(13)V99 COMP-3      CL*16
00170                                                          VALUE 0.    CL*16
00171      05  PA-XFER-TO-RECORDS-CHANGED        PIC S9(7)     COMP-3      CL*19
00172                                                          VALUE 0.    CL*19
00173      05  PA-XFER-TO-COST-CHANGED           PIC S9(13)V99 COMP-3      CL*16
00174                                                          VALUE 0.    CL*16
00175      05  PA-XFER-TO-RTL-CHANGED            PIC S9(13)V99 COMP-3      CL*16
00176                                                          VALUE 0.    CL*16
00177                                                                      CL*19
00178      05  PA-SALE-RECORDS-READ              PIC S9(7)     COMP-3      CL*19
00179                                                          VALUE 0.    CL*19
00180      05  PA-SALE-COST-READ                 PIC S9(13)V99 COMP-3      CL*19
00181                                                          VALUE 0.    CL*19
00182      05  PA-SALE-RTL-READ                  PIC S9(13)V99 COMP-3      CL*19
00183                                                          VALUE 0.    CL*19
00184      05  PA-SALE-RECORDS-CHANGED           PIC S9(7)     COMP-3      CL*19
00185                                                          VALUE 0.    CL*19
00186      05  PA-SALE-COST-CHANGED              PIC S9(13)V99 COMP-3      CL*19
00187                                                          VALUE 0.    CL*19
00188      05  PA-SALE-RTL-CHANGED               PIC S9(13)V99 COMP-3      CL*19
00189                                                          VALUE 0.    CL*19
00190                                                                      CL*19
00191      05  PA-MARKDOWN-RECORDS-READ          PIC S9(7)     COMP-3      CL*19
00192                                                          VALUE 0.    CL*19
00193      05  PA-MARKDOWN-COST-READ             PIC S9(13)V99 COMP-3      CL*19
00194                                                          VALUE 0.    CL*19
00195      05  PA-MARKDOWN-RTL-READ              PIC S9(13)V99 COMP-3      CL*19
00196                                                          VALUE 0.    CL*19
00197      05  PA-MARKDOWN-RECORDS-CHANGED       PIC S9(7)     COMP-3      CL*19
00198                                                          VALUE 0.    CL*19
00199      05  PA-MARKDOWN-COST-CHANGED          PIC S9(13)V99 COMP-3      CL*19
00200                                                          VALUE 0.    CL*19
00201      05  PA-MARKDOWN-RTL-CHANGED           PIC S9(13)V99 COMP-3      CL*19
00202                                                          VALUE 0.    CL*19
00203                                                                      CL*19
00204      05  PA-MARKUP-RECORDS-READ            PIC S9(7)     COMP-3      CL*19
00205                                                          VALUE 0.    CL*19
00206      05  PA-MARKUP-COST-READ               PIC S9(13)V99 COMP-3      CL*19
00207                                                          VALUE 0.    CL*19
00208      05  PA-MARKUP-RTL-READ                PIC S9(13)V99 COMP-3      CL*19
00209                                                          VALUE 0.    CL*19
00210      05  PA-MARKUP-RECORDS-CHANGED         PIC S9(7)     COMP-3      CL*19
00211                                                          VALUE 0.    CL*19
00212      05  PA-MARKUP-COST-CHANGED            PIC S9(13)V99 COMP-3      CL*19
00213                                                          VALUE 0.    CL*19
00214      05  PA-MARKUP-RTL-CHANGED             PIC S9(13)V99 COMP-3      CL*19
00215                                                          VALUE 0.    CL*19
00216                                                                      CL*19
00217      05  PA-ADJUSTMENT-RECORDS-READ        PIC S9(7)     COMP-3      CL*19
00218                                                          VALUE 0.    CL*19
00219      05  PA-ADJUSTMENT-COST-READ           PIC S9(13)V99 COMP-3      CL*19
00220                                                          VALUE 0.    CL*19
00221      05  PA-ADJUSTMENT-RTL-READ            PIC S9(13)V99 COMP-3      CL*19
00222                                                          VALUE 0.    CL*19
00223      05  PA-ADJUSTMENT-RECORDS-CHANGED     PIC S9(7)     COMP-3      CL*19
00224                                                          VALUE 0.    CL*19
00225      05  PA-ADJUSTMENT-COST-CHANGED        PIC S9(13)V99 COMP-3      CL*19
00226                                                          VALUE 0.    CL*19
00227      05  PA-ADJUSTMENT-RTL-CHANGED         PIC S9(13)V99 COMP-3      CL*19
00228                                                          VALUE 0.    CL*19
00229  01  DF-DISPLAY-FIELDS.                                              CL**1
00230      05  DF-HEADING-1                 PIC  X(24)    VALUE            CL*17
W34517                                       '*** VAKUT152 STATISTICS:'.   CL*17
00232      05  DF-HEADING-2.                                               CL*17
00233          10  FILLER                   PIC  X(17)    VALUE SPACE.     CL*17
00234          10  FILLER                   PIC  X(10)    VALUE ALL '-'.   CL*17
00235          10  FILLER                   PIC  X(19)    VALUE            CL*17
00236                                             ' TRANSACTIONS READ '.   CL*17
00237          10  FILLER                   PIC  X(18)    VALUE ALL '-'.   CL*17
00238          10  FILLER                   PIC  X(07)    VALUE SPACE.     CL*17
00239          10  FILLER                   PIC  X(12)    VALUE ALL '-'.   CL*17
00240          10  FILLER                   PIC  X(22)    VALUE            CL*17
00241                                          ' TRANSACTIONS CHANGED '.   CL*17
00242          10  FILLER                   PIC  X(13)    VALUE ALL '-'.   CL*17
00243                                                                      CL*19
00244      05  DF-HEADING-3.                                               CL*17
00245          10  FILLER                   PIC  X(05)    VALUE SPACE.     CL*17
00246          10  FILLER                   PIC  X(04)    VALUE 'TYPE'.    CL*17
00247          10  FILLER                   PIC  X(10)    VALUE SPACE.     CL*17
00248          10  FILLER                   PIC  X(05)    VALUE 'COUNT'.   CL*17
00249          10  FILLER                   PIC  X(11)    VALUE SPACE.     CL*17
00250          10  FILLER                   PIC  X(04)    VALUE 'COST'.    CL*17
00251          10  FILLER                   PIC  X(15)    VALUE SPACE.     CL*17
00252          10  FILLER                   PIC  X(06)    VALUE            CL*18
00253                                                          'RETAIL'.   CL*18
00254          10  FILLER                   PIC  X(13)    VALUE SPACE.     CL*18
00255          10  FILLER                   PIC  X(05)    VALUE 'COUNT'.   CL*18
00256          10  FILLER                   PIC  X(11)    VALUE SPACE.     CL*18
00257          10  FILLER                   PIC  X(04)    VALUE 'COST'.    CL*18
00258          10  FILLER                   PIC  X(15)    VALUE SPACE.     CL*18
00259          10  FILLER                   PIC  X(06)    VALUE            CL*18
00260                                                          'RETAIL'.   CL*18
00261                                                                      CL*18
00262      05  DF-DETAIL.                                                  CL*18
00263          10  FILLER                   PIC  X        VALUE SPACE.     CL**7
00264          10  DF-TRAN-TYPE             PIC  X(14).                    CL*19
00265          10  FILLER                   PIC  X(02)    VALUE SPACE.     CL*17
00266          10  DF-RECORDS-READ          PIC  Z,ZZZ,ZZ9.                CL**7
00267          10  FILLER                   PIC  X(02)    VALUE SPACE.     CL*17
00268          10  DF-COST-READ             PIC  Z,ZZZ,ZZZ,ZZZ.99-.        CL*17
00269          10  FILLER                   PIC  X(02)    VALUE SPACE.     CL*17
00270          10  DF-RTL-READ              PIC  Z,ZZZ,ZZZ,ZZZ.99-.        CL*17
00271          10  FILLER                   PIC  X(07)    VALUE SPACE.     CL*17
00272          10  DF-RECORDS-CHANGED       PIC  Z,ZZZ,ZZ9.                CL**7
00273          10  FILLER                   PIC  X(02)    VALUE SPACE.     CL*17
00274          10  DF-COST-CHANGED          PIC  Z,ZZZ,ZZZ,ZZZ.99-.        CL*17
00275          10  FILLER                   PIC  X(02)    VALUE SPACE.     CL*17
00276          10  DF-RTL-CHANGED           PIC  Z,ZZZ,ZZZ,ZZZ.99-.        CL*17
00277                                                                      CL**1
00278  01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.   CL**1
00279                                                                      CL**1
      ******************************************************************        
      *  DCLGEN FOR THE M/L OPEN FISCAL MONTH DB2 TABLE.                        
      ****************************************************************          
           EXEC SQL                                                             
               INCLUDE TMLCNTL                                                  
           END-EXEC.                                                            
                                                                                
00280 ******************************************************************   CL**1
00281 * CALENDAR ROUTINE WORK AREA.                                        CL**1
00282 ******************************************************************   CL**1
00283                                                                      CL**1
00284      COPY DPWS500.                                                   CL**1
00285                                                                      CL**1
00286                                                                      CL**1
00287 ******************************************************************   CL**1
00288 * INPUT CONTROL CARD LAYOUT.                                         CL**1
00289 ******************************************************************   CL**1
00290  01  CC-CONTROL-CARD.                                                CL**1
00291      05  CC-ISO-FMT-DATE.                                            CL**1
00292          10  CC-ISO-FMT-CC       PIC  X(02)    VALUE SPACE.          CL**1
00293          10  CC-ISO-FMT-YY       PIC  X(02)    VALUE SPACE.          CL**1
00294          10  CC-ISO-FMT-DASH1    PIC  X        VALUE SPACE.          CL**1
00295          10  CC-ISO-FMT-MM       PIC  X(02)    VALUE SPACE.          CL**1
00296          10  CC-ISO-FMT-DASH2    PIC  X        VALUE SPACE.          CL**1
00297          10  CC-ISO-FMT-DD       PIC  X(02)    VALUE SPACE.          CL**1
00298      05  FILLER                  PIC  X(70)    VALUE SPACE.          CL*11
00299                                                                      CL**1
00300                                                                      CL**1
00301 *****************************************************************    CL**1
00302 * PURCHASE EXTRACT RECORD LAYOUT                                     CL**1
00303 *****************************************************************    CL**1
00304                                                                      CL**1
00305      COPY MLRD030.                                                   CL**1
00306                                                                      CL**1
00307                                                                      CL**1
00308 *****************************************************************    CL**1
00309 * SALE EXTRACT RECORD LAYOUT                                         CL**1
00310 *****************************************************************    CL**1
00311                                                                      CL**1
00312      COPY MLRD022.                                                   CL**1
00313                                                                      CL**1
00314                                                                      CL**1
00315 *****************************************************************    CL**1
00316 * PRICE CHANGE EXTRACT RECORD LAYOUT                                 CL**1
00317 *****************************************************************    CL**1
00318                                                                      CL**1
00319      COPY MLRD029.                                                   CL**1
00320                                                                      CL**1
00321                                                                      CL**1
00322 *****************************************************************    CL**1
00323 * ADJUSTMENT EXTRACT RECORD LAYOUT                                   CL**1
00324 *****************************************************************    CL**1
00325                                                                      CL**1
00326      COPY MLRD024.                                                   CL**1
00327                                                                      CL**1
                                                                                
00328                                                                      CL**1
      ****************************************************************          
      *  ERROR MESSAGE AREA FOR DB2                                             
      ****************************************************************          
                                                                                
           COPY DPWS004.                                                        
                                                                                
                                                                                
00331                                                                      CL**1
      *                                                                         
      ******************************************************************        
      *  COMMUNICATIONS AREA FOR DB2                                   *        
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
00331                                                                      CL**1
00329  LINKAGE SECTION.                                                    CL**1
00330                                                                      CL**1
      *                                                                         
00332  PROCEDURE DIVISION.                                                 CL**1
00333                                                                      CL**1
00334  A100-MAIN-MODULE.                                                   CL**1
00335                                                                      CL**1
00475      PERFORM B050-PROCESS-OPN-FSCL-MN.                               CL**1
00337                                                                      CL**1
00338 *    *------------------------------------------------------------   CL**1
00339 *    * PROCESS THE PURCHASE EXTRACT FILE.                            CL**7
00340 *    *------------------------------------------------------------   CL**1
00341                                                                      CL**8
00342      OPEN INPUT  PURCHASE-EXTRACT-FILE-I                             CL**2
00343           OUTPUT PURCHASE-EXTRACT-FILE-O.                            CL**2
00344                                                                      CL**8
00345      PERFORM Z100-READ-PURCHASE-EXTRACT.                             CL**1
00346      PERFORM B100-PROCESS-PURCHASE-EXT                               CL**2
00347          UNTIL PS-EOF-PURCHASE-EXTRACT.                              CL**1
00348                                                                      CL**8
00349      CLOSE PURCHASE-EXTRACT-FILE-I                                   CL**2
00350            PURCHASE-EXTRACT-FILE-O.                                  CL**2
00351                                                                      CL**1
00352 *    *------------------------------------------------------------   CL**1
00353 *    * PROCESS THE SALE EXTRACT FILE.                                CL**7
00354 *    *------------------------------------------------------------   CL**1
00355                                                                      CL**8
00356      OPEN INPUT  SALE-EXTRACT-FILE-I                                 CL**2
00357           OUTPUT SALE-EXTRACT-FILE-O.                                CL**2
00358                                                                      CL**8
00359      PERFORM Z200-READ-SALE-EXTRACT.                                 CL**1
00360      PERFORM B200-PROCESS-SALE-EXT                                   CL**2
00361          UNTIL PS-EOF-SALE-EXTRACT.                                  CL**1
00362                                                                      CL**8
00363      CLOSE SALE-EXTRACT-FILE-I                                       CL**2
00364            SALE-EXTRACT-FILE-O.                                      CL**2
00365                                                                      CL**1
00366 *    *------------------------------------------------------------   CL**1
00367 *    * PROCESS THE PRICE CHANGE EXTRACT FILE.                        CL**7
00368 *    *------------------------------------------------------------   CL**1
00369                                                                      CL**8
00370      OPEN INPUT  PRICE-CHNG-EXTRACT-FILE-I                           CL*10
00371           OUTPUT PRICE-CHNG-EXTRACT-FILE-O.                          CL*10
00372                                                                      CL**8
00373      PERFORM Z300-READ-PRICE-CHNG-EXTRACT.                           CL*10
00374      PERFORM B300-PROCES-PRICE-CHNG-EXT                              CL*10
00375          UNTIL PS-EOF-PRICE-CHNG-EXTRACT.                            CL*10
00376                                                                      CL**8
00377      CLOSE PRICE-CHNG-EXTRACT-FILE-I                                 CL*10
00378            PRICE-CHNG-EXTRACT-FILE-O.                                CL*10
00379                                                                      CL**1
00380 *    *------------------------------------------------------------   CL**1
00381 *    * PROCESS THE ADJUSTMENT EXTRACT FILE.                          CL**7
00382 *    *------------------------------------------------------------   CL**1
00383                                                                      CL**8
00384      OPEN INPUT  ADJUSTMENT-EXTRACT-FILE-I                           CL**2
00385           OUTPUT ADJUSTMENT-EXTRACT-FILE-O.                          CL**2
00386                                                                      CL**8
00387      PERFORM Z400-READ-ADJUSTMENT-EXTRACT.                           CL**1
00388      PERFORM B400-PROCESS-ADJUSTMENT-EXT                             CL**2
00389          UNTIL PS-EOF-ADJUSTMENT-EXTRACT.                            CL**1
00390                                                                      CL**8
00391      CLOSE ADJUSTMENT-EXTRACT-FILE-I                                 CL**2
00392            ADJUSTMENT-EXTRACT-FILE-O.                                CL**2
00393                                                                      CL**1
00394 *    *------------------------------------------------------------   CL**7
00395 *    * DISPLAY THE NUMBER OF RECORDS READ AND CHANGED FOR EACH       CL**7
00396 *    * INPUT FILE.                                                   CL**7
00397 *    *------------------------------------------------------------   CL**7
00398                                                                      CL**8
00399      DISPLAY DF-HEADING-1.                                           CL**7
00400      DISPLAY ' '.                                                    CL*18
00401      DISPLAY DF-HEADING-2.                                           CL**7
00402      DISPLAY DF-HEADING-3.                                           CL*18
00403      DISPLAY ' '.                                                    CL*18
00404                                                                      CL**7
00405      MOVE 'PURCHASE'                    TO DF-TRAN-TYPE.             CL*19
00406      MOVE PA-PURCHASE-RECORDS-READ      TO DF-RECORDS-READ.          CL*19
00407      MOVE PA-PURCHASE-COST-READ         TO DF-COST-READ.             CL*18
00408      MOVE PA-PURCHASE-RTL-READ          TO DF-RTL-READ.              CL*18
00409      MOVE PA-PURCHASE-RECORDS-CHANGED   TO DF-RECORDS-CHANGED.       CL*19
00410      MOVE PA-PURCHASE-COST-CHANGED      TO DF-COST-CHANGED.          CL*18
00411      MOVE PA-PURCHASE-RTL-CHANGED       TO DF-RTL-CHANGED.           CL*18
00412      DISPLAY DF-DETAIL.                                              CL*18
00413                                                                      CL**7
00414      MOVE 'TRANSFER FROM'               TO DF-TRAN-TYPE.             CL*19
00415      MOVE PA-XFER-FROM-RECORDS-READ     TO DF-RECORDS-READ.          CL*19
00416      MOVE PA-XFER-FROM-COST-READ        TO DF-COST-READ.             CL*18
00417      MOVE PA-XFER-FROM-RTL-READ         TO DF-RTL-READ.              CL*18
00418      MOVE PA-XFER-FROM-RECORDS-CHANGED  TO DF-RECORDS-CHANGED.       CL*19
00419      MOVE PA-XFER-FROM-COST-CHANGED     TO DF-COST-CHANGED.          CL*18
00420      MOVE PA-XFER-FROM-RTL-CHANGED      TO DF-RTL-CHANGED.           CL*18
00421      DISPLAY DF-DETAIL.                                              CL*18
00422                                                                      CL*18
00423      MOVE 'TRANSFER TO'                 TO DF-TRAN-TYPE.             CL*19
00424      MOVE PA-XFER-TO-RECORDS-READ       TO DF-RECORDS-READ.          CL*19
00425      MOVE PA-XFER-TO-COST-READ          TO DF-COST-READ.             CL*18
00426      MOVE PA-XFER-TO-RTL-READ           TO DF-RTL-READ.              CL*18
00427      MOVE PA-XFER-TO-RECORDS-CHANGED    TO DF-RECORDS-CHANGED.       CL*19
00428      MOVE PA-XFER-TO-COST-CHANGED       TO DF-COST-CHANGED.          CL*18
00429      MOVE PA-XFER-TO-RTL-CHANGED        TO DF-RTL-CHANGED.           CL*18
00430      DISPLAY DF-DETAIL.                                              CL*18
00431                                                                      CL*18
00432      MOVE 'SALE'                        TO DF-TRAN-TYPE.             CL*19
00433      MOVE PA-SALE-RECORDS-READ          TO DF-RECORDS-READ.          CL*19
00434      MOVE PA-SALE-COST-READ             TO DF-COST-READ.             CL*19
00435      MOVE PA-SALE-RTL-READ              TO DF-RTL-READ.              CL*19
00436      MOVE PA-SALE-RECORDS-CHANGED       TO DF-RECORDS-CHANGED.       CL*19
00437      MOVE PA-SALE-COST-CHANGED          TO DF-COST-CHANGED.          CL*19
00438      MOVE PA-SALE-RTL-CHANGED           TO DF-RTL-CHANGED.           CL*19
00439      DISPLAY DF-DETAIL.                                              CL*18
00440                                                                      CL**7
00441      MOVE 'MARKDOWN'                    TO DF-TRAN-TYPE.             CL*19
00442      MOVE PA-MARKDOWN-RECORDS-READ      TO DF-RECORDS-READ.          CL*19
00443      MOVE PA-MARKDOWN-COST-READ         TO DF-COST-READ.             CL*19
00444      MOVE PA-MARKDOWN-RTL-READ          TO DF-RTL-READ.              CL*19
00445      MOVE PA-MARKDOWN-RECORDS-CHANGED   TO DF-RECORDS-CHANGED.       CL*19
00446      MOVE PA-MARKDOWN-COST-CHANGED      TO DF-COST-CHANGED.          CL*19
00447      MOVE PA-MARKDOWN-RTL-CHANGED       TO DF-RTL-CHANGED.           CL*19
00448      DISPLAY DF-DETAIL.                                              CL*18
00449                                                                      CL**7
00450      MOVE 'MARKUP'                      TO DF-TRAN-TYPE.             CL*23
00451      MOVE PA-MARKUP-RECORDS-READ        TO DF-RECORDS-READ.          CL*19
00452      MOVE PA-MARKUP-COST-READ           TO DF-COST-READ.             CL*19
00453      MOVE PA-MARKUP-RTL-READ            TO DF-RTL-READ.              CL*19
00454      MOVE PA-MARKUP-RECORDS-CHANGED     TO DF-RECORDS-CHANGED.       CL*19
00455      MOVE PA-MARKUP-COST-CHANGED        TO DF-COST-CHANGED.          CL*19
00456      MOVE PA-MARKUP-RTL-CHANGED         TO DF-RTL-CHANGED.           CL*19
00457      DISPLAY DF-DETAIL.                                              CL*19
00458                                                                      CL*19
00459      MOVE 'ADJUSTMENT'                  TO DF-TRAN-TYPE.             CL*19
00460      MOVE PA-ADJUSTMENT-RECORDS-READ    TO DF-RECORDS-READ.          CL*19
00461      MOVE PA-ADJUSTMENT-COST-READ       TO DF-COST-READ.             CL*19
00462      MOVE PA-ADJUSTMENT-RTL-READ        TO DF-RTL-READ.              CL*19
00463      MOVE PA-ADJUSTMENT-RECORDS-CHANGED TO DF-RECORDS-CHANGED.       CL*19
00464      MOVE PA-ADJUSTMENT-COST-CHANGED    TO DF-COST-CHANGED.          CL*19
00465      MOVE PA-ADJUSTMENT-RTL-CHANGED     TO DF-RTL-CHANGED.           CL*19
00466      DISPLAY DF-DETAIL.                                              CL*18
00467                                                                      CL**1
00468      STOP RUN.                                                       CL**1
00469                                                                      CL**1
00470                                                                      CL**1
00475  B050-PROCESS-OPN-FSCL-MN.                                           CL**1
00527                                                                      CL**3
00528 *    *------------------------------------------------------------   CL**5
00529 *    * GET THE OPEN FISCAL MONTH FROM DB2 TABLE - TMLCNTL            CL**5
00528 *    *------------------------------------------------------------   CL**5
00476      PERFORM Z010-GET-OPN-FSCL-MN.                                   CL**1
00527                                                                      CL**3
00528 *    *------------------------------------------------------------   CL**5
00529 *    * GET THE FISCAL DATE FIELDS ASSOCIATED WITH THE LAST DAY       CL**5
00530 *    * OF THE FISCAL MONTH.                                          CL**5
00531 *    *------------------------------------------------------------   CL**5
00532                                                                      CL**8
00533      MOVE MLCNTL-OPN-FSCL-MN-DTE TO PV-LAST-FD-DB2-ISO-FMT.          CL**5
           DISPLAY 'OPN FSCL MN DTE ' MLCNTL-OPN-FSCL-MN-DTE.                   
00534                                                                      CL**5
00535      INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 CL**3
00537      SET DPG51-FISCAL-454-CALENDAR TO TRUE.                          CL**3
00538      SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                          CL**8
00539      MOVE PV-LAST-FD-DB2-ISO-FMT   TO DPG52-LK-DATE-INPUT.           CL**8
00540                                                                      CL**3
00541      CALL PC-CALENDAR-ROUTINE                                        CL**3
00542          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                  CL**3
00543                                                                      CL**3
00544      EVALUATE TRUE                                                   CL**3
00545          WHEN DPG54-SEVERE-ERROR                                     CL**3
00546              DISPLAY '** ABEND **'                                   CL**3
W34517             DISPLAY '** PGM = VAKUT152'                             CL**9
00548              DISPLAY '** PARAGRAPH = B050-PROCESS-CONTROL-CARD'      CL**5
00549              DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'       CL**3
00550              DISPLAY '** USING LAST FISCAL DAY AS INPUT.'            CL**5
00551              DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE       CL**8
00552              DISPLAY '** DPG51 = ' DPG51                             CL**3
00553              DISPLAY '** DPG52 = ' DPG52                             CL**3
00554              DISPLAY '** DPG53 = ' DPG53                             CL**3
00555              DISPLAY '** DPG54 = ' DPG54                             CL**3
00556              MOVE +4003 TO ABEND-CODE                                CL**3
00557              CALL 'ILBOABN0' USING ABEND-CODE                        CL**3
00558          WHEN OTHER                                                  CL**3
00559              CONTINUE                                                CL**3
00560      END-EVALUATE.                                                   CL**3
00561                                                                      CL**3
00562      MOVE DPG56-FISCAL-YEAR-NBR  TO PV-LAST-FD-YY.                   CL*12
00563      IF PV-LAST-FD-YY > 80                                           CL*13
00564          MOVE 19                 TO PV-LAST-FD-CC                    CL*12
00565      ELSE                                                            CL*12
00566          MOVE 20                 TO PV-LAST-FD-CC                    CL*12
00567      END-IF.                                                         CL*12
00568      MOVE DPG56-FISCAL-PERIOD-NBR-X                                  CL**5
00569                                  TO PV-LAST-FD-PERIOD-NBR-X.         CL**5
00570      MOVE DPG56-FISCAL-WEEK-NBR  TO PV-LAST-FD-WEEK-NBR.             CL**5
00571      MOVE DPG56-FISCAL-PERIOD-WEEK                                   CL*13
00572                                  TO PV-LAST-FD-PERIOD-WEEK.          CL*13
00573      MOVE DPG55-NUMERIC-WEEK-DAY-X                                   CL**5
00574                                  TO PV-LAST-FD-NUMERIC-WEEK-DAY-X.   CL**5
00575                                                                      CL**1
00576                                                                      CL**1
00577  B100-PROCESS-PURCHASE-EXT.                                          CL**2
00578                                                                      CL**1
00579      EVALUATE TRUE                                                   CL*16
00580          WHEN ML030-PURCH-PURCHASE                                   CL*16
00581              ADD +1 TO PA-PURCHASE-RECORDS-READ                      CL*19
00582              IF ML030-PURCH-DR-CR-CDE = '01' OR '07'                 CL*16
00583                  COMPUTE PA-PURCHASE-COST-READ                       CL*16
00584                        = PA-PURCHASE-COST-READ                       CL*16
00585                        + ML030-PURCH-EXTD-NET-COST-AMT               CL*16
00586                  COMPUTE PA-PURCHASE-RTL-READ                        CL*16
00587                        = PA-PURCHASE-RTL-READ                        CL*16
00588                        + ML030-PURCH-EXTD-RTL-AMT                    CL*16
00589              ELSE                                                    CL*16
00590                  COMPUTE PA-PURCHASE-COST-READ                       CL*16
00591                        = PA-PURCHASE-COST-READ                       CL*16
00592                        - ML030-PURCH-EXTD-NET-COST-AMT               CL*16
00593                  COMPUTE PA-PURCHASE-RTL-READ                        CL*16
00594                        = PA-PURCHASE-RTL-READ                        CL*16
00595                        - ML030-PURCH-EXTD-RTL-AMT                    CL*16
00596              END-IF                                                  CL*16
00597          WHEN ML030-PURCH-TRANSFER-FRM-STORE                         CL*16
00598              ADD +1 TO PA-XFER-FROM-RECORDS-READ                     CL*19
00599              COMPUTE PA-XFER-FROM-COST-READ                          CL*17
00600                    = PA-XFER-FROM-COST-READ                          CL*17
00601                    + ML030-PURCH-EXTD-NET-COST-AMT                   CL*16
00602              COMPUTE PA-XFER-FROM-RTL-READ                           CL*17
00603                    = PA-XFER-FROM-RTL-READ                           CL*17
00604                    + ML030-PURCH-EXTD-RTL-AMT                        CL*16
00605          WHEN ML030-PURCH-TRANSFER-TO-STORE                          CL*16
00606              ADD +1 TO PA-XFER-TO-RECORDS-READ                       CL*19
00607              COMPUTE PA-XFER-TO-COST-READ                            CL*17
00608                    = PA-XFER-TO-COST-READ                            CL*17
00609                    + ML030-PURCH-EXTD-NET-COST-AMT                   CL*16
00610              COMPUTE PA-XFER-TO-RTL-READ                             CL*17
00611                    = PA-XFER-TO-RTL-READ                             CL*17
00612                    + ML030-PURCH-EXTD-RTL-AMT                        CL*16
00613      END-EVALUATE.                                                   CL*16
00614                                                                      CL**1
00615 *    *------------------------------------------------------------   CL**6
00616 *    * IF THE TRANSACTION DATE IS PAST THE LAST FISCAL DAY OF THE    CL**6
00617 *    * YEAR, CHANGE IT TO THE LAST FISCAL DAY OF THE YEAR.           CL**6
00618 *    *------------------------------------------------------------   CL**6
00619                                                                      CL**8
SJ    *    DISPLAY 'ML030 FIN ' ML030-PURCH-FIN-LIAB-DTE                        
SJ    *            '   DB2-ISO-FMT ' PV-LAST-FD-DB2-ISO-FMT.                    
00619                                                                      CL**8
00620      IF ML030-PURCH-FIN-LIAB-DTE > PV-LAST-FD-DB2-ISO-FMT            CL**6
00621          MOVE PV-LAST-FD-DB2-ISO-FMT   TO ML030-PURCH-FIN-LIAB-DTE   CL**6
00622          MOVE PV-LAST-FD-CCYY          TO ML030-PURCH-FSCL-YR        CL*12
00623          MOVE PV-LAST-FD-PERIOD-NBR-X  TO ML030-PURCH-FSCL-PER       CL**6
00624          MOVE PV-LAST-FD-PERIOD-WEEK   TO ML030-PURCH-FSCL-WK        CL*12
00625          MOVE PV-LAST-FD-NUMERIC-WEEK-DAY-X                          CL**6
00626                                        TO ML030-PURCH-FSCL-DAY       CL**6
               DISPLAY '**  NEW DTE ' ML030-PURCH-FIN-LIAB-DTE                  
00627          EVALUATE TRUE                                               CL*17
00628              WHEN ML030-PURCH-PURCHASE                               CL*17
00629                  ADD +1 TO PA-PURCHASE-RECORDS-CHANGED               CL*19
00630                  IF ML030-PURCH-DR-CR-CDE = '01' OR '07'             CL*17
00631                      COMPUTE PA-PURCHASE-COST-CHANGED                CL*17
00632                            = PA-PURCHASE-COST-CHANGED                CL*17
00633                            + ML030-PURCH-EXTD-NET-COST-AMT           CL*17
00634                      COMPUTE PA-PURCHASE-RTL-CHANGED                 CL*17
00635                            = PA-PURCHASE-RTL-CHANGED                 CL*17
00636                            + ML030-PURCH-EXTD-RTL-AMT                CL*17
00637                  ELSE                                                CL*17
00638                      COMPUTE PA-PURCHASE-COST-CHANGED                CL*17
00639                            = PA-PURCHASE-COST-CHANGED                CL*17
00640                            - ML030-PURCH-EXTD-NET-COST-AMT           CL*17
00641                      COMPUTE PA-PURCHASE-RTL-CHANGED                 CL*17
00642                            = PA-PURCHASE-RTL-CHANGED                 CL*17
00643                            - ML030-PURCH-EXTD-RTL-AMT                CL*17
00644                  END-IF                                              CL*17
00645              WHEN ML030-PURCH-TRANSFER-FRM-STORE                     CL*17
00646                  ADD +1 TO PA-XFER-FROM-RECORDS-CHANGED              CL*19
00647                  COMPUTE PA-XFER-FROM-COST-CHANGED                   CL*17
00648                        = PA-XFER-FROM-COST-CHANGED                   CL*17
00649                        + ML030-PURCH-EXTD-NET-COST-AMT               CL*17
00650                  COMPUTE PA-XFER-FROM-RTL-CHANGED                    CL*17
00651                        = PA-XFER-FROM-RTL-CHANGED                    CL*17
00652                        + ML030-PURCH-EXTD-RTL-AMT                    CL*17
00653              WHEN ML030-PURCH-TRANSFER-TO-STORE                      CL*17
00654                  ADD +1 TO PA-XFER-TO-RECORDS-CHANGED                CL*19
00655                  COMPUTE PA-XFER-TO-COST-CHANGED                     CL*17
00656                        = PA-XFER-TO-COST-CHANGED                     CL*17
00657                        + ML030-PURCH-EXTD-NET-COST-AMT               CL*17
00658                  COMPUTE PA-XFER-TO-RTL-CHANGED                      CL*17
00659                        = PA-XFER-TO-RTL-CHANGED                      CL*17
00660                        + ML030-PURCH-EXTD-RTL-AMT                    CL*17
00661          END-EVALUATE                                                CL*17
00662      END-IF.                                                         CL**5
00663                                                                      CL**5
00664      MOVE ML030-PURCH-RECORD TO PURCHASE-EXTRACT-RECORD-O.           CL**2
00665      PERFORM Z500-WRITE-PURCHASE-EXTRACT.                            CL**2
00666      PERFORM Z100-READ-PURCHASE-EXTRACT.                             CL**1
00667                                                                      CL**1
00668                                                                      CL**1
00669  B200-PROCESS-SALE-EXT.                                              CL**8
00670                                                                      CL**1
00671      ADD +1                      TO PA-SALE-RECORDS-READ.            CL*19
00672      ADD ML022-SALE-EXTD-RTL-AMT TO PA-SALE-RTL-READ.                CL*19
00673                                                                      CL**1
00674 *    *------------------------------------------------------------   CL**6
00675 *    * IF THE TRANSACTION DATE IS PAST THE LAST FISCAL DAY OF THE    CL**6
00676 *    * YEAR, CHANGE IT TO THE LAST FISCAL DAY OF THE YEAR.           CL**6
00677 *    *------------------------------------------------------------   CL**6
00678                                                                      CL**8
00679      IF ML022-SALE-FIN-LIAB-DTE > PV-LAST-FD-DB2-ISO-FMT             CL**6
00680          MOVE PV-LAST-FD-DB2-ISO-FMT   TO ML022-SALE-FIN-LIAB-DTE    CL**6
00681          MOVE PV-LAST-FD-CCYY          TO ML022-SALE-FSCL-YR         CL*12
00682          MOVE PV-LAST-FD-PERIOD-NBR-X  TO ML022-SALE-FSCL-PER        CL**6
00683          MOVE PV-LAST-FD-WEEK-NBR      TO ML022-SALE-FSCL-WK-NBR     CL**6
00684          MOVE PV-LAST-FD-PERIOD-WEEK   TO ML022-SALE-FSCL-WK         CL*13
00685          MOVE PV-LAST-FD-NUMERIC-WEEK-DAY-X                          CL**6
00686                                        TO ML022-SALE-FSCL-DAY        CL**6
00687          ADD +1                        TO PA-SALE-RECORDS-CHANGED    CL*19
00688          ADD ML022-SALE-EXTD-RTL-AMT   TO PA-SALE-RTL-CHANGED        CL*19
00689      END-IF.                                                         CL**6
00690                                                                      CL**6
00691      MOVE ML022-SALE-RECORD TO SALE-EXTRACT-RECORD-O.                CL**2
00692      PERFORM Z600-WRITE-SALE-EXTRACT.                                CL**2
00693      PERFORM Z200-READ-SALE-EXTRACT.                                 CL**1
00694                                                                      CL**1
00695                                                                      CL**1
00696  B300-PROCES-PRICE-CHNG-EXT.                                         CL*10
00697                                                                      CL**1
00698      IF ML029-PC-TRANS-CDE = '40'                                    CL*20
00699          ADD +1 TO PA-MARKDOWN-RECORDS-READ                          CL*20
00700          COMPUTE PA-MARKDOWN-RTL-READ                                CL*20
00701                = PA-MARKDOWN-RTL-READ                                CL*20
00702                + ML029-PC-EXTD-RTL-AMT                               CL*20
00703      ELSE                                                            CL*20
00704          ADD +1 TO PA-MARKUP-RECORDS-READ                            CL*20
00705          COMPUTE PA-MARKUP-RTL-READ                                  CL*20
00706                = PA-MARKUP-RTL-READ                                  CL*20
00707                + ML029-PC-EXTD-RTL-AMT                               CL*20
00708      END-IF.                                                         CL*20
00709                                                                      CL**1
00710 *    *------------------------------------------------------------   CL**7
00711 *    * IF THE TRANSACTION DATE IS PAST THE LAST FISCAL DAY OF THE    CL**7
00712 *    * YEAR, CHANGE IT TO THE LAST FISCAL DAY OF THE YEAR.           CL**7
00713 *    *------------------------------------------------------------   CL**7
00714                                                                      CL**8
00715      IF ML029-PC-FIN-LIAB-DTE > PV-LAST-FD-DB2-ISO-FMT               CL**7
00716          MOVE PV-LAST-FD-DB2-ISO-FMT   TO ML029-PC-FIN-LIAB-DTE      CL**7
00717          MOVE PV-LAST-FD-CCYY          TO ML029-PC-FSCL-YR           CL*12
00718          MOVE PV-LAST-FD-PERIOD-NBR-X  TO ML029-PC-FSCL-PER          CL**7
00719          MOVE PV-LAST-FD-PERIOD-WEEK   TO ML029-PC-FSCL-WK           CL*13
00720          MOVE PV-LAST-FD-NUMERIC-WEEK-DAY-X                          CL**7
00721                                        TO ML029-PC-FSCL-DAY          CL**7
00722          IF ML029-PC-TRANS-CDE = '40'                                CL*20
00723              ADD +1 TO PA-MARKDOWN-RECORDS-CHANGED                   CL*20
00724              COMPUTE PA-MARKDOWN-RTL-CHANGED                         CL*20
00725                    = PA-MARKDOWN-RTL-CHANGED                         CL*20
00726                    + ML029-PC-EXTD-RTL-AMT                           CL*20
00727          ELSE                                                        CL*20
00728              ADD +1 TO PA-MARKUP-RECORDS-CHANGED                     CL*20
00729              COMPUTE PA-MARKUP-RTL-CHANGED                           CL*20
00730                    = PA-MARKUP-RTL-CHANGED                           CL*20
00731                    + ML029-PC-EXTD-RTL-AMT                           CL*20
00732          END-IF                                                      CL*20
00733      END-IF.                                                         CL**7
00734                                                                      CL**7
00735      MOVE ML029-PC-RECORD TO PRICE-CHNG-EXTRACT-RECORD-O.            CL*10
00736      PERFORM Z700-WRITE-PRICE-CHNG-EXTRACT.                          CL*10
00737      PERFORM Z300-READ-PRICE-CHNG-EXTRACT.                           CL*10
00738                                                                      CL**1
00739                                                                      CL**1
00740  B400-PROCESS-ADJUSTMENT-EXT.                                        CL**8
00741                                                                      CL**1
00742      ADD +1                    TO PA-ADJUSTMENT-RECORDS-READ.        CL*20
00743      ADD ML024-ADJ-AT-RTL-AMT  TO PA-ADJUSTMENT-RTL-READ.            CL*20
00744      ADD ML024-ADJ-AT-COST-AMT TO PA-ADJUSTMENT-COST-READ.           CL*20
00745                                                                      CL**1
00746 *    *------------------------------------------------------------   CL**7
00747 *    * IF THE TRANSACTION DATE IS PAST THE LAST FISCAL DAY OF THE    CL**7
00748 *    * YEAR, CHANGE IT TO THE LAST FISCAL DAY OF THE YEAR.           CL**7
00749 *    *------------------------------------------------------------   CL**7
00750                                                                      CL**8
00751      IF ML024-ADJ-FIN-LIAB-DTE > PV-LAST-FD-DB2-ISO-FMT              CL**7
00752          MOVE PV-LAST-FD-DB2-ISO-FMT   TO ML024-ADJ-FIN-LIAB-DTE     CL**7
00753          MOVE PV-LAST-FD-CCYY          TO ML024-ADJ-FSCL-YR          CL*12
00754          MOVE PV-LAST-FD-PERIOD-NBR-X  TO ML024-ADJ-FSCL-PER         CL**7
00755          MOVE PV-LAST-FD-PERIOD-WEEK   TO ML024-ADJ-FSCL-WK          CL*13
00756          MOVE PV-LAST-FD-NUMERIC-WEEK-DAY-X                          CL**7
00757                                        TO ML024-ADJ-FSCL-DAY         CL**7
00758          ADD +1                   TO PA-ADJUSTMENT-RECORDS-CHANGED   CL*20
00759          ADD ML024-ADJ-AT-RTL-AMT TO PA-ADJUSTMENT-RTL-READ          CL*22
00760          ADD ML024-ADJ-AT-COST-AMT                                   CL*20
00761                                   TO PA-ADJUSTMENT-COST-READ         CL*22
00762      END-IF.                                                         CL**7
00763                                                                      CL**7
00764      MOVE ML024-ADJ-RECORD TO ADJUSTMENT-EXTRACT-RECORD-O.           CL**2
00765      PERFORM Z800-WRITE-ADJUSTMENT-EXTRACT.                          CL**2
00766      PERFORM Z400-READ-ADJUSTMENT-EXTRACT.                           CL**1
00767                                                                      CL**1
00768                                                                      CL**1
       Z010-GET-OPN-FSCL-MN.                                                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNT FROM 1 BY 1                               
                 UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                        
                    OR (SQLCODE         = +000)                                 
                    OR (SQLCODE         = +100)                                 
                                                                                
               EXEC SQL                                                         
                    SELECT                                                      
                        OPN_FSCL_MN_DTE                                         
                    INTO                                                        
                       :MLCNTL-OPN-FSCL-MN-DTE                                  
                    FROM                                                        
                        TMLCNTL                                                 
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE        = +000                                   
                   WHEN SQLCODE        = -904                                   
                   WHEN SQLCODE        = -911                                   
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       MOVE    'B325-GET-OPN-FSCL-MN'                           
                                                TO PV-PARAGRAPH-NAME            
                       MOVE    'SELECT ROW FROM TMLCNTL'                        
                                                TO PV-DB2-OPER-ATTEMPTED        
                       PERFORM Z900-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                                  
               DISPLAY '** MAX RETRIES EXCEEDED ON TMLCNTL **'                  
               MOVE    'B325-GET-OPN-FSCL-MN'                                   
                                                TO PV-PARAGRAPH-NAME            
               MOVE    'SELECT ROW FROM TMLCNTL'                                
                                                TO PV-DB2-OPER-ATTEMPTED        
               PERFORM Z900-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
00769  Z100-READ-PURCHASE-EXTRACT.                                         CL**1
00770                                                                      CL**1
00771      READ PURCHASE-EXTRACT-FILE-I                                    CL**2
00772          INTO ML030-PURCH-RECORD                                     CL**1
00773              AT END SET PS-EOF-PURCHASE-EXTRACT TO TRUE.             CL**1
00774                                                                      CL**1
00775                                                                      CL**1
00776  Z200-READ-SALE-EXTRACT.                                             CL**1
00777                                                                      CL**1
00778      READ SALE-EXTRACT-FILE-I                                        CL**2
00779          INTO ML022-SALE-RECORD                                      CL**1
00780              AT END SET PS-EOF-SALE-EXTRACT TO TRUE.                 CL**1
00781                                                                      CL**1
00782                                                                      CL**1
00783  Z300-READ-PRICE-CHNG-EXTRACT.                                       CL*10
00784                                                                      CL**1
00785      READ PRICE-CHNG-EXTRACT-FILE-I                                  CL*10
00786          INTO ML029-PC-RECORD                                        CL**1
00787              AT END SET PS-EOF-PRICE-CHNG-EXTRACT TO TRUE.           CL*10
00788                                                                      CL**1
00789                                                                      CL**1
00790  Z400-READ-ADJUSTMENT-EXTRACT.                                       CL**2
00791                                                                      CL**1
00792      READ ADJUSTMENT-EXTRACT-FILE-I                                  CL**2
00793          INTO ML024-ADJ-RECORD                                       CL**1
00794              AT END SET PS-EOF-ADJUSTMENT-EXTRACT TO TRUE.           CL**1
00795                                                                      CL**1
00796                                                                      CL**1
00797  Z500-WRITE-PURCHASE-EXTRACT.                                        CL**2
00798                                                                      CL**1
00799      WRITE PURCHASE-EXTRACT-RECORD-O.                                CL**2
00800                                                                      CL**1
00801                                                                      CL**2
00802  Z600-WRITE-SALE-EXTRACT.                                            CL**2
00803                                                                      CL**2
00804      WRITE SALE-EXTRACT-RECORD-O.                                    CL**2
00805                                                                      CL**2
00806                                                                      CL**2
00807  Z700-WRITE-PRICE-CHNG-EXTRACT.                                      CL*10
00808                                                                      CL**2
00809      WRITE PRICE-CHNG-EXTRACT-RECORD-O.                              CL*10
00810                                                                      CL**2
00811                                                                      CL**2
00812  Z800-WRITE-ADJUSTMENT-EXTRACT.                                      CL**8
00813                                                                      CL**2
00814      WRITE ADJUSTMENT-EXTRACT-RECORD-O.                              CL**2
00815                                                                      CL**2
00815                                                                      CL**2
      ******************************************************************        
      * PERFORMS THE ABEND FOR THE PROGRAM IN THE                               
      * EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                         
      ******************************************************************        
       Z900-SQL-ABEND.                                                          
                                                                                
           DISPLAY '** ABEND     **'.                                           
W34517     DISPLAY '** PROGRAM   ** = VAKUT152'.                                
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
           DISPLAY '** OPERATION ** = ' PV-DB2-OPER-ATTEMPTED.                  
                                                                                
      ******************************************************************        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
      * FORMAT.                                                                 
      ******************************************************************        
           COPY DPPD004.                                                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
                                                                               
