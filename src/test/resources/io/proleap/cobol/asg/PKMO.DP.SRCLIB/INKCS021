000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    INKCS021.                                         00040000
000500 AUTHOR.        TESS BESTE.                                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  09-08-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    I021 - STOCKROOM WITHDRAWAL SHEET UPDATE/DELETE PROGRAM    * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM DISPLAYS THE SKU, UPC, QUANTITY, AND UNIT     * 00130000
001400*    PRICE FOR EACH LINE ON A SHEET AND ALLOWS THE OPERATOR     * 00140000
001500*    TO DELETE THE ENTIRE SHEET, OR ADD, CHANGE, AND DELETE       00150000
001600*    INDIVIDUAL LINES WITHIN A SHEET.                             00160000
001700*                                                               * 00170000
001800*----------------------------------------------------------------*00180000
001900*  KIM WRIGHT                                   9/16/94         * 00190000
002000*  CHANGED THE SELECTION OF CUTOFF PRICE ON THE TSKST TABLE TO  * 00200000
002100*  SELECT FROM STORE '000' INSTEAD OF THE SPECIFIC STORE        * 00210000
002200*---------------------------------------------------------------* 00220000
001900*  SCOTT JACKSON       CHANGE ID 'JUNE99'       4/16/99         * 00230000
002000*  CHANGED THE SELECTION OF CUTOFF PRICE ON THE TSKST TABLE TO  * 00240000
002100*  SELECT FROM SPECIFIC STORE INSTEAD OF FROM STORE '000'       * 00250000
002200*---------------------------------------------------------------* 00260000
001900*  SCOTT JACKSON       CHANGE ID 'IN2000'       9/16/99         * 00270000
002000*  CHANGED THE SELECTION OF CUTOFF PRICE FROM TABLE TSKST TO    * 00280000
002100*  USE DB2 TABLE TUPCPLS. REGIONAL CLEARANCE PRICING (RCP) WILL * 00290000
002200*  BE IN EFFECT TO DETERMINE IF STORE SPECIFIC RTL/COST IS TO   * 00300000
002200*  BE USED OR STORE '000' ROW. TSK.REGN_PRIC_IND IS THE SWITCH  * 00310000
002200*  AND TUPCPLS/TSK ITEM NUMBER ARE LINKED AND STATUS CODE ON    * 00320000
002200*  TUPCPLS WILL DRIVE USE OF STORE 000 OR STORE SPECIFIC AMOUNTS* 00330000
      *---------------------------------------------------------------* 00340000
      * 03/04/2000  SCOTT JACKSON      CHG ID:SMJ                     * 00350000
      *  ONLINE ABENDS (-913) OCCUR UPON ENTRY TO STKRM MAINTENANCE   * 00360000
      *  IF TINVPAR IS WAS BEING UPDATED BY BATCH PROCESSES. 'SOFT'   * 00370000
      *  ABEND TO USER WITH 'RESOURCE UNAVAIL' ON CALL TO TINVPAR     * 00380000
IN2001*---------------------------------------------------------------* 00390000
IN2001* 09/06/2000  SCOTT JACKSON      CHG ID:IN2001                  * 00400000
IN2001*  DURING INVENTORY, AN ITEM IN RCP STATUS AS OF A STORES INV   * 00410000
IN2001*  DATE MAY BE RETURNED TO NON-RCP STATUS PRIOR TO PROCESSING   * 00420000
IN2001*  ALL STORE'S DATA. THEREFORE TSK.REGN_PRICE_IND MAY PROVE TO  * 00430000
IN2001*  BE INCORRECT AND UNRELIABLE BASED ON WHEN DATA IS PROCESSED. * 00440000
IN2001*  TUPCPLS WILL BE USED SOLELY IN DETERMINING AN ITEM'S STATUS. * 00450000
IN2001*  CHECK STORE 000 ROW 1ST (IF STATUS = '25' OR '30' CHECK FOR  * 00460000
IN2001*  STORE-SPECIFIC ROW). USE STORE 000 PRICING IF NO STORE ROW.  * 00470000
IN2001*  IF STATUS <> '25' THEN STORE-SPECIFIC ROW WILL NOT BE CHECKED* 00480000
RENUM *---------------------------------------------------------------* 00490000
      * WR22842    09-26-2001  SCOTT JACKSON      CHG ID:RENUM          00500000
      * ENTERED SKU'S MAY BE IN A RENUMBERED STATUS. THIS PROGRAM GETS  00510000
      * THE MOST RECENT SKU FOR PRICING PURPOSES, BUT STILL PASSES THE  00520000
      * OUT-DATED SKU TO TSTKRMW. CONVERT 'RENUMBERED' SKU'S TO CURRENT 00530000
      * SKU NUMBER AND LOAD THE NEW SKU TO DB2.                         00540000
445144*---------------------------------------------------------------* 00550000
445144* PM00445144 01-22-2002  R. JANSSEN         CHG ID:445144         00560000
445144*   SQLCODE -310 ABEND ON A SKU WHIHC DOES NOT EXITS IN TUPC,     00570000
445144* TUPCSKU, TUPCPLS.                                               00580000
23511C*---------------------------------------------------------------* 00590000
23511C* 05/21/2002 CAROL WOJCIECHOWSKI CHG ID:23511C                  * 00600000
23511C*  DISPLAY THE PRICE FOR A YELLOW TICKET SKU WHEN THE           * 00610000
23511C*  UPC_STAT_CHG_DTE IS EQUAL TO THE UNT_RTL_CHG_DTE             * 00620000
23511C*                                                               * 00630000
W21732*---------------------------------------------------------------* 00640000
W21732* 10/25/2002 IGSI                CHG ID:W21732                  * 00650000
W21732* ACCEPT NON-INTELLIGENT SKU IN PLACE OF THE CURRENT DEPT/CLASS/* 00660000
W21732* SEQ NUMBER.                                                   * 00670000
C21732*---------------------------------------------------------------* 00680000
C21732*    CHANGE BY S JACKSON  3/17/03                               * 00690000
C21732*    CHANGE DPKUT040 TO USE DPKUT041 FOR CHECK DIGIT COMPUTATION* 00700000
C21732*    REMOVE DPKUT040 MODULE (FOR INTERNAL UPC GENERATOR) WITH   * 00710000
C21732*    A DB2 CALL USING TUPC/XREF FOR RENUMBERS / CURRENT INTR-UPC* 00720000
      ***************************************************************** 00730000
W25428*    CHANGE BY S JACKSON 10/17/03                               * 00740001
W25428*    PREVENT STORES FORM ADDING NEW SHEET ENTRIES AFTER THE     * 00750001
W25428*    HAS ALREADY BEEN SELECTED FOR UNIT BOOKING                 * 00760001
      *                                                                 00770002
W26600* W26600   06-29-2004  ROD JANSSEN INV STORE EXPANSION            00780002
W25428*----------------------------------------------------------------*00790001
W28545* W28545   04-18-2006  J SELWITSCHKA                            * 00800012
W28545*    ADD COMMON PRICING INWS400 AND INPD400 TO REPLACE SKU AND  * 00810015
W28545*    UPC LOOK UPS.                                              * 00820016
J25428*----------------------------------------------------------------*00830035
J28545* W28545 06-16-2006 JAN BLAZICH TINVPAR/TINCNTL ARE USED TO GET   00840035
J28545*                               THE PROPER INV-ID AND STORE       00850035
974311*P974311 01-23-2007 S JACKSON   INVALID HANDLING OF MIXED STATUS  00860038
974311*                               SKUS-RETURNING 0.00 RETAIL        00870038
W28582*----------------------------------------------------------------*00870139
W28582* W28582 07-31-2007 J SELWITSCHKA                                 00871042
W28582*                               AFTER LOOKING UP RETAIL WITH UPC, 00872039
W28582*                               IF DUMMY UPC GET DATA FROM        00873041
W28582*                               ATTRIBUTES.                       00874039
      * W33304 05-01-2008 JILL LIN    HOLDING INVENTORY LEDGER OPEN     00875043
      *                               ACROSS PERIODS INVENTORY SHORTAGE 00876043
      *                               REPORTING                         00877043
SR3403* SR3403 03-27-2012 ROHIT SINGH LARGE RETAIL PROJECT :            00878048
SR3403*                               AMOUNT FIELD EXPANSION            00879047
W28545***************************************************************** 00880012
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126         00881050
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00882050
263126* MAKING THE CALL DYNAMIC VS STATIC.                              00883050
263126***************************************************************** 00884050
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00885051
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00886051
1122RM* THE CICS ARCHITECTURE API.                                      00887051
1122RM*---------------------------------------------------------------* 00888051
002301* CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369         00889052
002301* REMOVED UPC CHECK DIGIT COPYBOOK AND THE COMMENTED CODE THAT    00889152
002301* WAS CALLING IT                                                  00889252
002301*---------------------------------------------------------------* 00889352
002300                                                                  00890000
002400 ENVIRONMENT DIVISION.                                            00900000
002600 DATA DIVISION.                                                   00910000
002700                                                                  00920000
002800 WORKING-STORAGE SECTION.                                         00930000
002900                                                                  00940000
003000 01  PC-PROGRAM-CONSTANTS.                                        00950000
003100     05  PC-CURRENT-MAP-NAME     PIC  X(08) VALUE 'IN021A  '.     00960000
003200     05  PC-CURRENT-MAPSET-NAME  PIC  X(08) VALUE 'INKM021 '.     00970000
003300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'INKCS021'.     00980000
003400     05  PC-CALENDAR-ROUTINE     PIC  X(08) VALUE 'DPKUT500'.     00990000
003500     05  PC-LINES-PER-PANEL      PIC S9(04) VALUE +16   COMP SYNC.01000000
003600     05  PC-MDSELV-CDE           PIC  X(03) VALUE 'SCL'.          01010000
003700     05  PC-OPERCO-NBR           PIC  X(02) VALUE '03'.           01020000
003800     05  PC-APLSYS-CDE           PIC  X(02) VALUE 'IN'.           01030000
003900     05  PC-ITM-UNIT-PR-MAX-DIGITS                                01040000
004000                                 PIC S9(04) VALUE +5.             01050000
IN2001     05  PC-MIXED-STATUS         PIC  X(02) VALUE '25'.           01060000
IN2000     05  PC-CLEARANCE-SKU-STATUS PIC  X(02) VALUE '30'.           01070000
JUNE99     05  PC-RENUMBERED-SKU-STAT98                                 01080000
JUNE99                                 PIC  X(02) VALUE '98'.           01090000
004800     05  PC-MAX-QTY              PIC  9(07) VALUE 99.             01100000
004900     05  PC-MIN-PRICE            PIC  9(05)V99                    01110000
005000                                            VALUE .2.             01120000
005100     05  PC-MAX-PRICE            PIC  9(05)V99                    01130000
005200                                            VALUE 99999.99.       01140046
005300*    05  PC-STORE-000            PIC X(03)  VALUE '000'.          01150000
IN2000     05  PC-STORE-000            PIC S9(04) COMP        VALUE +0. 01160000
005400                                                                  01170000
005500 01  PC-TSYMSG-NUMBERS.                                           01180000
005600     05  PC-TSYMSG-00004         PIC 9(5)   VALUE 00004.          01190000
005700     05  PC-TSYMSG-00005         PIC 9(5)   VALUE 00005.          01200000
005800     05  PC-TSYMSG-00007         PIC 9(5)   VALUE 00007.          01210000
005900     05  PC-TSYMSG-00008         PIC 9(5)   VALUE 00008.          01220000
006000     05  PC-TSYMSG-00010         PIC 9(5)   VALUE 00010.          01230000
006100     05  PC-TSYMSG-00046         PIC 9(5)   VALUE 00046.          01240000
006200     05  PC-TSYMSG-00059         PIC 9(5)   VALUE 00059.          01250000
006300     05  PC-TSYMSG-00069         PIC 9(5)   VALUE 00069.          01260000
006400     05  PC-TSYMSG-00070         PIC 9(5)   VALUE 00070.          01270000
006500     05  PC-TSYMSG-00115         PIC 9(5)   VALUE 00115.          01280000
006600     05  PC-TSYMSG-00137         PIC 9(5)   VALUE 00137.          01290000
006700     05  PC-TSYMSG-00148         PIC 9(5)   VALUE 00148.          01300000
006800     05  PC-TSYMSG-00343         PIC 9(5)   VALUE 00343.          01310000
RENUM      05  PC-TSYMSG-00453         PIC 9(5)   VALUE 00453.          01320000
006900     05  PC-TSYMSG-00474         PIC 9(5)   VALUE 00474.          01330000
007000     05  PC-TSYMSG-00547         PIC 9(5)   VALUE 00547.          01340000
007100     05  PC-TSYMSG-00551         PIC 9(5)   VALUE 00551.          01350000
007200     05  PC-TSYMSG-00560         PIC 9(5)   VALUE 00560.          01360000
007300     05  PC-TSYMSG-00614         PIC 9(5)   VALUE 00614.          01370000
007400     05  PC-TSYMSG-00684         PIC 9(5)   VALUE 00684.          01380000
007500     05  PC-TSYMSG-00685         PIC 9(5)   VALUE 00685.          01390000
SMJ        05  PC-TSYMSG-01063         PIC 9(5)   VALUE 01063.          01400000
W25428     05  PC-TSYMSG-02895         PIC 9(5)   VALUE 02895.          01410001
007600                                                                  01420000
007700 01  PS-PROGRAM-SUBSCRIPTS.                                       01430000
007800     05  PS-SUB                  PIC S9(04) VALUE +0    COMP SYNC.01440000
007900     05  PS-SUB2                 PIC S9(04) VALUE +0    COMP SYNC.01450000
008000     05  PS-ORIG-SUB             PIC S9(04) VALUE +0    COMP SYNC.01460000
008100                                                                  01470000
008200 01  PS-PROGRAM-SWITCHES.                                         01480000
008300     05  PS-ERROR-SW                 PIC X  VALUE 'Y'.            01490000
008400         88  PS-NO-ERROR                    VALUE 'Y'.            01500000
008500         88  PS-ERROR                       VALUE 'N'.            01510000
008600     05  PS-ERRORS-IN-LINE-SW        PIC X  VALUE 'N'.            01520000
008700         88  PS-ERRORS-IN-LINE              VALUE 'Y'.            01530000
008800         88  PS-NO-ERRORS-IN-LINE           VALUE 'N'.            01540000
008900     05  PS-INVALID-SKU-SW           PIC X  VALUE 'N'.            01550000
009000         88  PS-VALID-SKU                   VALUE 'Y'.            01560000
009100         88  PS-INVALID-SKU                 VALUE 'N'.            01570000
009200     05  PS-LIST-END-SW              PIC X  VALUE 'N'.            01580000
009300         88  PS-LIST-END                    VALUE 'Y'.            01590000
009400         88  PS-NO-LIST-END                 VALUE 'N'.            01600000
009500     05  PS-DATA-ENTERED-SW          PIC X  VALUE 'N'.            01610000
009600         88  PS-DATA-ENTERED                VALUE 'Y'.            01620000
009700         88  PS-NO-DATA-ENTERED             VALUE 'N'.            01630000
009800     05  PS-SHEET-FOUND-SW           PIC X  VALUE 'N'.            01640000
009900         88  PS-SHEET-FOUND                 VALUE 'Y'.            01650000
010000         88  PS-NO-SHEET-FOUND              VALUE 'N'.            01660000
010100     05  PS-UPDATES-REQUESTED-SW     PIC X  VALUE 'N'.            01670000
010200         88  PS-UPDATES-REQUESTED           VALUE 'Y'.            01680000
010300         88  PS-NO-UPDATES-REQUESTED        VALUE 'N'.            01690000
010400     05  PS-UPDATE-ERROR-FOUND-SW    PIC X  VALUE 'N'.            01700000
010500         88  PS-UPDATE-ERROR-FOUND          VALUE 'Y'.            01710000
010600         88  PS-NO-UPDATE-ERROR-FOUND       VALUE 'N'.            01720000
010700     05  PS-DONE-RENUMBERING-SW      PIC X  VALUE 'N'.            01730000
010800         88  PS-DONE-RENUMBERING            VALUE 'Y'.            01740000
010900         88  PS-NOT-DONE-RENUMBERING        VALUE 'N'.            01750000
011000     05  PS-GOT-LAST-PRICE-SW        PIC X.                       01760000
011100         88  PS-GOT-LAST-PRICE-FROM-SCREEN                        01770000
011200                                            VALUE 'S'.            01780000
011300         88  PS-GOT-LAST-PRICE-FROM-TSKST                         01790000
011400                                            VALUE 'T'.            01800000
011500         88  PS-DIDNT-GET-LAST-PRICE        VALUE 'N'.            01810000
SMJ        05  PS-INVPAR-SW                PIC X  VALUE 'N'.            01820000
SMJ            88  PS-UNAVAILABLE-RESOURCE        VALUE 'Y'.            01830000
SMJ            88  PS-INVPAR-PROCESSED            VALUE 'N'.            01840000
011600     EJECT                                                        01850000
011700 01  PV-PROGRAM-VARIABLES.                                        01860000
W21732     05  PV-DUMMY-SKU            PIC X(08).                       01870000
011800     05  PV-CICS-RESP            PIC S9(04) VALUE +0    COMP SYNC.01880000
011900     05  PV-STAT-CHNGD-DATE-YYYYMMDD                              01890000
012000                                 PIC  X(08).                      01900000
012100     05  PV-MAJ-CL-NBR.                                           01910000
012200         10 PV-MAJ-CL-NBR-1      PIC  X     VALUE SPACES.         01920000
012300         10 PV-MAJ-CL-NBR-2      PIC  X     VALUE SPACES.         01930000
012400     05  PV-SUB-CL-NBR.                                           01940000
012500         10 PV-SUB-CL-NBR-1      PIC  X     VALUE SPACES.         01950000
012600         10 PV-SUB-CL-NBR-2-3    PIC  X(02) VALUE SPACES.         01960000
W21732     05  PV-DATE                 PIC X(10).                       01970000
W21732     05  PV-YYMMDD-DATE          PIC  X(6).                       01980000
W21732     05  FILLER                  REDEFINES                        01990000
W21732         PV-YYMMDD-DATE.                                          02000000
W21732         10  PV-YYMMDD-YY        PIC  X(02).                      02010000
W21732         10  PV-YYMMDD-MMDD.                                      02020000
W21732             15 PV-YYMMDD-MM     PIC  X(02).                      02030000
W21732             15 PV-YYMMDD-DD     PIC  X(02).                      02040000
W21732     05  PV-MMDDYY-DATE.                                          02050000
W21732         10  PV-MMDDYY-MMDD      PIC  X(04).                      02060000
W21732         10  PV-MMDDYY-YY        PIC  X(02).                      02070000
013600 01  PV-DB2-KEY-AREA.                                             02080000
W26600     05  PV-DB2-STORE-NBR        PIC  X(04).                      02090002
S26600     05  PV-DB2-STORE-NUMBER REDEFINES                            02100011
S26600         PV-DB2-STORE-NBR        PIC  9(04).                      02110011
013800     05  PV-DB2-SHEET-NBR        PIC S9(09)             COMP SYNC.02120000
013900     05  PV-DB2-LINE-NBR         PIC S9(04)             COMP SYNC.02130000
014000     05  PV-DB2-UPC-NBR          PIC S9(15)             COMP-3.   02140000
014100     05  PV-DB2-ITEM-NMBR        PIC S9(15)             COMP-3.   02150000
W21732     05  PV-DB2-SKU-NBR          PIC  X(08).                      02160000
W21732     05  PV-DB2-SKU-NBR-N REDEFINES                               02170000
W21732         PV-DB2-SKU-NBR          PIC  9(08).                      02180000
IN2000     05  PV-STR-NBR              PIC S9(04) COMP.                 02190000
SR3403     05  PV-GROUP-UNIT-RTL       PIC  9(05)V99 VALUE ZEROES.      02201045
IN2000                                                                  02210000
IN2000 01  PV-PLND-INV-TMST            PIC  X(26) VALUE SPACES.         02220000
IN2000                                                                  02230000
IN2000 01  PV-PLND-INV-TIMESTAMP.                                       02240000
IN2000     05  PV-PLND-INV-DTE         PIC  X(10) VALUE SPACES.         02250000
IN2000     05  PV-DASH                 PIC  X(01) VALUE '-'.            02260000
IN2000     05  PV-PLND-DTE-HOUR        PIC  X(02) VALUE '23'.           02270000
IN2000     05  PV-SEPARATOR            PIC  X(01) VALUE '.'.            02280000
IN2000     05  PV-PLND-DTE-MINUTE      PIC  X(02) VALUE '59'.           02290000
IN2000     05  PV-SEPARATOR            PIC  X(01) VALUE '.'.            02300000
IN2000     05  PV-PLND-DTE-SECOND      PIC  X(02) VALUE '59'.           02310000
IN2000     05  PV-SEPARATOR            PIC  X(01) VALUE '.'.            02320000
IN2000     05  PV-PLND-DTE-MSEC        PIC  X(06) VALUE '999999'.       02330000
IN2000                                                                  02340000
IN2001     05  PV-STR000-ROW.                                           02350000
IN2001         10  PV-STR000-UPC-STAT-CDE  PIC X(02)    VALUE SPACES.   02360000
IN2001         10  PV-STR000-UNT-RTL-AMT   PIC S9(7)V99 VALUE +0 COMP-3.02370000
IN2001         10  PV-STR000-MEITGP-NBR    PIC S9(9)    VALUE +0 COMP-3.02380000
RENUM                                                                   02390000
RENUM      05  PV-RENUMBERED-SKU.                                       02400000
W21732         10  PV-RSKU-NBR          PIC X(08).                      02410000
      *                                                                 02420000
014700                                                                  02430000
014800                                                                  02440000
014900*----------------------------------------------------------------*02450000
015000*    COPY BOOK FOR NUMERIC EDIT SUBROUTINE (DPKUT100) PARAMETER  *02460000
015100*    LIST.                                                       *02470000
015200*----------------------------------------------------------------*02480000
015300                                                                  02490000
015400     COPY DPWS010I.                                               02500000
015500                                                                  02510000
015600*---------------------------------------------------------------* 02520000
015700*    ABEND PROCESSING COPYBOOK.                                 * 02530000
015800*---------------------------------------------------------------* 02540000
015900                                                                  02550000
016000     COPY DPWS013.                                                02560000
016100                                                                  02570000
016200     EJECT                                                        02580000
016300*---------------------------------------------------------------* 02590000
016400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02600000
016500*---------------------------------------------------------------* 02610000
016600                                                                  02620000
016700     COPY DPWS015.                                                02630000
016800                                                                  02640000
016900*---------------------------------------------------------------* 02650000
017000*    FUNCTION KEYS COPYBOOK.                                    * 02660000
017100*---------------------------------------------------------------* 02670000
017200                                                                  02680000
017300     COPY DPWS016.                                                02690000
017400                                                                  02700000
017500*----------------------------------------------------------------*02710000
017600*    COPY BOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION   *02720000
017700*    ROUTINE                                                      02730000
017800*----------------------------------------------------------------*02740000
017900                                                                  02750000
018000     COPY DPWS017.                                                02760000
018100                                                                  02770000
018900*----------------------------------------------------------------*02850000
019000*    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                 02860000
019100*----------------------------------------------------------------*02870000
019200                                                                  02880000
019300     COPY DPWS500.                                                02890000
019400                                                                  02900000
019500*---------------------------------------------------------------* 02910000
019600*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02920000
019700*---------------------------------------------------------------* 02930000
019800                                                                  02940000
019900     COPY DPWS030.                                                02950000
1122RM     COPY DPWS930.                                                02951051
020000                                                                  02960000
020100*---------------------------------------------------------------* 02970000
020200*    STANDARD COMMAREA.                                         * 02980000
020300*---------------------------------------------------------------* 02990000
020400                                                                  03000000
020500     COPY DPWS020.                                                03010000
020600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03020000
020700                                                                  03030000
020800*---------------------------------------------------------------* 03040000
020900*    INTER-APPLICATION COMMAREA.                                * 03050000
021000*---------------------------------------------------------------* 03060000
021100                                                                  03070000
021200         10  INTER-APPL-COMM-AREA       PIC X(200).               03080000
W26600     COPY INWS001.                                                03090002
021400*---------------------------------------------------------------* 03100000
021500*    SPECIFIC COMMMAREA FOR INKCS021.                           * 03110000
021600*---------------------------------------------------------------* 03120000
021700         10  ASC-SPECIFIC-COMMAREA.                               03130000
021800             15  ASC-IN-WITHDRAWAL-PERIOD-SW PIC  X.              03140000
021900                 88  ASC-IN-WITHDRAWAL-PERIOD           VALUE 'Y'.03150000
022000                 88  ASC-NOT-IN-WITHDRAWAL-PERIOD       VALUE 'N'.03160000
022100             15  ASC-ITM-CTOFF-IND      PIC  X.                   03170000
022200                 88  ASC-ITM-CTOFF-HAS-OCCURRED         VALUE 'Y'.03180000
022300                 88  ASC-ITM-CTOFF-HASNT-OCCURRED       VALUE 'N'.03190000
W26600             15  ASC-KEY-STORE-NBR-X.                             03200008
W26600                 20  ASC-KEY-STORE-NBR       PIC  9(04).          03210008
022500             15  ASC-KEY-SHEET-NBR-X.                             03220000
022600                 20  ASC-KEY-SHEET-NBR       PIC  9(06).          03230000
022700             15  ASC-STORE-NAME              PIC  X(25).          03240000
022800             15  ASC-ACTL-INV-DTE-YYYYMMDD   PIC  X(08).          03250000
022900             15  ASC-INT-APPL-FORMAT-IND     PIC  X.              03260000
023000                 88  ASC-CRIT-SPEC-FMT              VALUE '1' '2'.03270000
023100                 88  ASC-LIST-FMT                   VALUE '3' '4'.03280000
023200                 88  ASC-UPDATE-FMT                 VALUE '1' '3'.03290000
023300                 88  ASC-DELETE-FMT                 VALUE '2' '4'.03300000
023400             15  ASC-DATA-EXISTS-SW          PIC X.               03310000
023500                 88  ASC-DATA-EXISTS                VALUE 'Y'.    03320000
023600                 88  ASC-DATA-DOES-NOT-EXIST        VALUE 'N'.    03330000
023700                                                                  03340000
023800             15  ASC-SEL-SUB                 PIC S9(04) COMP.     03350000
023900             15  ASC-SEL-ITEM                PIC S9(04) COMP.     03360000
024000             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.   03370000
024100             15  ASC-USE-SELECTION-QUEUE-IND PIC  X.              03380000
024200                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    03390000
024300             15  ASC-SEL-QUEUE-NAME.                              03400000
024400                 20  ASC-SEL-TERM-ID         PIC  X(04).          03410000
024500                 20  ASC-SEL-TASK-NUMBER     PIC S9(05)           03420000
024600                                                        COMP-3.   03430000
024700                 20  ASC-SEL-SEQ             PIC  9.              03440000
024800             15  ASC-LAST-LINE-NBR           PIC S9(04)           03450000
024900                                                        COMP SYNC.03460000
025000                                                                  03470000
025100             15  ASC-ITEM-ARRAY.                                  03480000
025200                 20  ASC-MAP-DETAIL-LINE     OCCURS 16 TIMES.     03490000
025300                     25  ASC-LINE-CHANGED-SW PIC X.               03500000
025400                         88  ASC-LINE-CHANGED      VALUE 'Y'.     03510000
025500                         88  ASC-LINE-DIDNT-CHANGE VALUE SPACE.   03520000
025600                     25  ASC-LINE-NBR        PIC S9(04)           03530000
025700                                                        COMP SYNC.03540000
025800                     25  ASC-LINE-NBR-X      REDEFINES            03550000
025900                         ASC-LINE-NBR        PIC  X(02).          03560000
W21732                     25  ASC-SKU-NBR         PIC  X(08).          03570000
W21732                     25  ASC-SKU-NBR-N       REDEFINES            03580000
W21732                         ASC-SKU-NBR         PIC  9(08).          03590000
027300                     25  ASC-UPC-NBR-X       PIC  X(15).          03600000
027400                     25  ASC-UPC-NBR         REDEFINES            03610000
027500                         ASC-UPC-NBR-X       PIC  9(15).          03620000
027600                     25  FILLER              REDEFINES            03630000
027700                         ASC-UPC-NBR-X.                           03640000
027800                         30  FILLER          PIC  X(02).          03650000
027900                         30  ASC-UPC-1-2     PIC  X(02).          03660000
028000                             88  ASC-UPC-INTERNAL   VALUE '04'.   03670000
028100                         30  ASC-UPC-3-4     PIC  X(02).          03680000
W21732                         30  ASC-UPC-SKU     PIC  X(08).          03690000
028800                         30  ASC-UPC-CHECK-DIGIT                  03700000
028900                                             PIC  9.              03710000
029000                     25  ASC-INV-QTY-X       PIC  X(07).          03720000
029100                     25  ASC-INV-QTY         REDEFINES            03730000
029200                         ASC-INV-QTY-X       PIC  9(07).          03740000
029300                     25  ASC-ITM-UNIT-PR-AMT-X                    03750000
029400                                             PIC  X(08).          03760000
029500                     25  ASC-ITM-UNIT-PR-AMT-X-FMT                03770000
029600                                             REDEFINES            03780000
029700                         ASC-ITM-UNIT-PR-AMT-X                    03790000
029800                                             PIC  Z(5).99.        03800000
029900                     25  ASC-ITM-UNIT-PR-AMT PIC  9(5)V99.        03810000
030000                     25  ASC-SKU-ENTERED-SW  PIC  X.              03820000
030100                         88 ASC-SKU-ENTERED         VALUE 'Y'.    03830000
030200                         88 ASC-SKU-NOT-ENTERED     VALUE 'N'.    03840000
030300                     25  ASC-GET-PRICE-SW    PIC X.               03850000
030400                         88  ASC-GET-PRICE-FROM-SCREEN            03860000
030500                                                    VALUE 'S'.    03870000
IN2000*                        88  ASC-GET-PRICE-FROM-TSKST             03880000
IN2000*                                                   VALUE 'T'.    03890000
W28545                         88  ASC-GET-PRICE-FROM-INPD400           03900034
IN2000                                                    VALUE 'T'.    03910000
IN2001                         88  ASC-GOT-STR000-PRICE   VALUE 'O'.    03920000
030800                         88  ASC-DONT-GET-PRICE     VALUE 'N'.    03930000
030900                                                                  03940000
031000             15  ASC-ORIG-ITEM-ARRAY.                             03950000
031100                 20  ASC-ORIG-MAP-DETAIL-LINE                     03960000
031200                                             OCCURS 16 TIMES.     03970000
031300                     25  ASC-ORIG-LINE-NBR   PIC S9(04)           03980000
031400                                                        COMP SYNC.03990000
W21732                     25  ASC-ORIG-SKU-NBR    PIC  X(08).          04000000
032000                     25  ASC-ORIG-UPC-NBR-X  PIC  X(15).          04010000
032100                     25  ASC-ORIG-UPC-NBR    REDEFINES            04020000
032200                         ASC-ORIG-UPC-NBR-X  PIC  9(15).          04030000
032300                     25  ASC-ORIG-INV-QTY-X  PIC  X(07).          04040000
032400                     25  ASC-ORIG-INV-QTY    REDEFINES            04050000
032500                         ASC-ORIG-INV-QTY-X  PIC  9(07).          04060000
032600                     25  ASC-ORIG-ITM-UNIT-PR-AMT-X               04070000
032700                                             PIC X(08).           04080000
032800                     25  ASC-ORIG-ITM-UNIT-PR-AMT-X-FMT           04090000
032900                                             REDEFINES            04100000
033000                         ASC-ORIG-ITM-UNIT-PR-AMT-X               04110000
033100                                             PIC Z(5).99.         04120000
033200                                                                  04130000
033300         10  FILLER                          PIC  X(1328).        04140000
033400     EJECT                                                        04150000
033500*---------------------------------------------------------------* 04160000
033600*    SHEET SELECTION TSQ B QUEUE RECORD LAYOUT.                 * 04170000
033700*---------------------------------------------------------------* 04180000
033800                                                                  04190000
033900     COPY INWS022.                                                04200000
034000                                                                  04210000
034100     EJECT                                                        04220000
034200*---------------------------------------------------------------* 04230000
034300*    MAP LAYOUT                                                 * 04240000
034400*---------------------------------------------------------------* 04250000
034500                                                                  04260000
W26600     COPY INKM021.                                                04270002
034700                                                                  04280000
034800 01  MR-OCCURS-LAYOUT          REDEFINES  IN021AO.                04290000
W26600     05  FILLER                PIC X(62).                         04300010
035000     05  MR-DETAIL-LINE OCCURS 16 TIMES.                          04310000
W21732         10  MR-SKUL           PIC S9(04) COMP.                   04320000
W21732         10  MR-SKUA           PIC  X(01).                        04330000
W21732         10  MR-SKUF           REDEFINES                          04340000
W21732             MR-SKUA           PIC  X(01).                        04350000
W21732         10  MR-SKUC           PIC  X(01).                        04360000
W21732         10  MR-SKUH           PIC  X(01).                        04370000
W21732         10  MR-SKU            PIC  X(08).                        04380000
037200         10  MR-UPCL           PIC S9(04) COMP.                   04390000
037300         10  MR-UPCA           PIC  X(01).                        04400000
037400         10  MR-UPCF           REDEFINES                          04410000
037500             MR-UPCA           PIC  X(01).                        04420000
037600         10  MR-UPCC           PIC  X(01).                        04430000
037700         10  MR-UPCH           PIC  X(01).                        04440000
037800         10  MR-UPC-X.                                            04450000
037900             15  MR-UPC        PIC  Z(14)9.                       04460000
038000         10  MR-QTYL           PIC S9(04) COMP.                   04470000
038100         10  MR-QTYA           PIC  X(01).                        04480000
038200         10  MR-QTYF           REDEFINES                          04490000
038300             MR-QTYA           PIC  X(01).                        04500000
038400         10  MR-QTYC           PIC  X(01).                        04510000
038500         10  MR-QTYH           PIC  X(01).                        04520000
038600         10  MR-QTY-X.                                            04530000
038700             15  MR-QTY        PIC  Z(6)9.                        04540000
038800         10  MR-PRCEL          PIC S9(04) COMP.                   04550000
038900         10  MR-PRCEA          PIC  X(01).                        04560000
039000         10  MR-PRCEF          REDEFINES                          04570000
039100             MR-PRCEA          PIC  X(01).                        04580000
039200         10  MR-PRCEC          PIC  X(01).                        04590000
039300         10  MR-PRCEH          PIC  X(01).                        04600000
039400         10  MR-PRCE-X.                                           04610000
039500             15  MR-PRCE       PIC  Z(05).99.                     04620000
039600                                                                  04630000
039700 EJECT                                                            04640000
W28545*    DB2 AREA AND WS AREA FOR COMMON PRICING LOOK-UP              04650012
W28545                                                                  04660012
W28545     COPY INWS400.                                                04670012
W28545                                                                  04680012
IN2000*    DB2 AREA FOR TINVPAR (INVENTORY PARAMETERS TABLE)            04690000
IN2000                                                                  04700000
IN2000     EXEC SQL                                                     04710000
IN2000          INCLUDE TINVPAR                                         04720000
IN2000     END-EXEC.                                                    04730000
IN2000                                                                  04740000
J28545*    DB2 AREA FOR TINCNTL (INVENTORY CONTROL TABLE)               04750035
J28545                                                                  04760035
J28545     EXEC SQL                                                     04770035
J28545          INCLUDE TINCNTL                                         04780035
J28545     END-EXEC.                                                    04790035
J28545                                                                  04800035
039800*    DB2 AREA FOR TSTKRMW (STOCKROOM WITHDRAWAL)                  04810000
039900                                                                  04820000
040000     EXEC SQL                                                     04830000
040100          INCLUDE TSTKRMW                                         04840000
040200     END-EXEC.                                                    04850000
040300                                                                  04860000
041600*    DB2 AREA FOR TSKST (SKU STORE)                               04870000
041700                                                                  04880000
041800     EXEC SQL                                                     04890000
041900          INCLUDE TSKST                                           04900000
042000     END-EXEC.                                                    04910000
042100                                                                  04920000
      ***  DB2 AREA FOR TSKXREF/TUPC VIEW TABLE (IMV_SKU)               04930000
      * *                                                               04940000
      * *  EXEC SQL                                                     04950000
C21732* *       INCLUDE IMV00001                                        04960000
      * *  END-EXEC.                                                    04970000
      ***                                                               04980000
043400*---------------------------------------------------------------* 04990000
043500*    DB2 AREA FOR COMMUNICATIONS                                * 05000000
043600*---------------------------------------------------------------* 05010000
043700     EXEC SQL                                                     05020000
043800          INCLUDE SQLCA                                           05030000
043900     END-EXEC.                                                    05040000
044000                                                                  05050000
044100*---------------------------------------------------------------* 05060000
044200*    CURSOR TO OBTAIN ALL LINES FOR A STOCKROOM WITHDRAWAL SHEET* 05070000
044300*---------------------------------------------------------------* 05080000
044400                                                                  05090000
046000                                                                  05100000
044500     EXEC SQL                                                     05110000
044600          DECLARE LINE-NBR-CSR CURSOR FOR                         05120000
044700          SELECT LINE_NBR                                         05130000
W21732               , SKU_NBR                                          05140000
045100               , UPC_NBR                                          05150000
045200               , INV_QTY                                          05160000
045300               , ITM_UNIT_PR_AMT                                  05170000
045400          FROM   TSTKRMW                                          05180000
W26600          WHERE  LOC_NBR = :STKRMW-LOC-NBR AND                    05190002
W21732                 SHEET_NBR = :STKRMW-SHEET-NBR                    05200000
045700          ORDER BY                                                05210000
045800                 LINE_NBR                                         05220000
045900     END-EXEC.                                                    05230000
046100 EJECT                                                            05240000
046200 LINKAGE SECTION.                                                 05250000
046300                                                                  05260000
046400 01  DFHCOMMAREA.                                                 05270000
046500     05  FILLER                         OCCURS  1 TO 4072 TIMES   05280000
046600                                        DEPENDING ON EIBCALEN.    05290000
046700         10  FILLER                     PIC X.                    05300000
046800                                                                  05310000
046900 EJECT                                                            05320000
047000 PROCEDURE DIVISION.                                              05330000
047100                                                                  05340000
047200 0000-MAIN-MODULE.                                                05350000
047300                                                                  05360000
047400     INITIALIZE DP030-CICS-API-FIELDS.                            05370000
047500     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        05380000
047600     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           05390000
047700     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          05400000
047800     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        05410000
047900     MOVE LENGTH OF IN021AI       TO DP030-MAP-LENGTH (1).        05420000
048000     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      05430000
048100     PERFORM 0001-CALL-CICS-ARCH-API.                             05440000
048200                                                                  05450000
048300     PERFORM 1000-CONTROL-PROCESSING.                             05460000
048400                                                                  05470000
048500     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      05480000
048600     PERFORM 0001-CALL-CICS-ARCH-API.                             05490000
048700                                                                  05500000
048800*----------------------------------------------------------------*05510000
048900*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *05520000
049000*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *05530000
049100*----------------------------------------------------------------*05540000
049200                                                                  05550000
049300 0001-CALL-CICS-ARCH-API.                                         05560000
049400                                                                  05570000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               05580051
1122RM     CALL DP930-CICS-ARCH-API                                     05581051
1122RM                     USING DFHEIBLK                               05582051
049600                           DFHCOMMAREA                            05590000
049700                           DP030-CICS-API-FIELDS                  05600000
049800                           DP020-STANDARD-COMMAREA                05610000
049900                           IN021AI.                               05620000
050000                                                                  05630000
050100     IF  DP030-RC-CALL-SUCCESSFUL                                 05640000
050200         CONTINUE                                                 05650000
050300     ELSE                                                         05660000
050400         SET DP013-NO-ROLLBACK TO TRUE                            05670000
050500         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   05680000
050600         SET DP013-CICS-ABEND TO TRUE                             05690000
050700         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        05700000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05710051
1122RM*             'T LINE'         TO DP013-MESSAGE-TEXT (2)          05720051
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05721051
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05722051
051000         MOVE DP030-RETURN-CODE                                   05730000
051100                               TO DP013-MESSAGE-TEXT (3)          05740000
051200         PERFORM DP013-0000-PROCESS-ABEND                         05750000
051300     END-IF.                                                      05760000
051400                                                                  05770000
051500*----------------------------------------------------------------*05780000
051600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05790000
051700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05800000
051800*----------------------------------------------------------------*05810000
051900                                                                  05820000
052000 1000-CONTROL-PROCESSING.                                         05830000
052100                                                                  05840000
052200                                                                  05850000
052300     EVALUATE TRUE                                                05860000
052400         WHEN DP020-NEXT-ACT-INITIAL                              05870000
052500             INITIALIZE ASC-SPECIFIC-COMMAREA                     05880000
052600             MOVE DP020-INT-APPL-FORMAT-IND                       05890000
052700                                    TO ASC-INT-APPL-FORMAT-IND    05900000
052800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05910000
052900             IF  DP020-NEXT-ACT-APPL-ERROR                        05920000
053000                 CONTINUE                                         05930000
053100             ELSE                                                 05940000
053200                 PERFORM 4000-BUILD-INITIAL-PANEL                 05950000
IN2000                 PERFORM 3480-READ-TINVPAR                        05960000
053300             END-IF                                               05970000
053400                                                                  05980000
053500         WHEN DP020-NEXT-ACT-READ-MAP                             05990000
IN2000             PERFORM 3480-READ-TINVPAR                            06000000
SMJ                IF  PS-INVPAR-PROCESSED                              06010000
053600                 PERFORM 2000-PROCESS-PANEL                       06020000
SMJ                END-IF                                               06030000
053700                                                                  06040000
053800         WHEN DP020-NEXT-ACT-RETURN                               06050000
IN2000             PERFORM 3480-READ-TINVPAR                            06060000
SMJ                IF  PS-INVPAR-PROCESSED                              06070000
053900                 IF ASC-DATA-DOES-NOT-EXIST                       06080000
054000                     PERFORM 4500-SET-ATTRIBUTES-TO-PROT          06090000
054100                 ELSE                                             06100000
054200                     IF ASC-UPDATE-FMT                            06110000
054300                         PERFORM 3000-EDIT-DATA-IN-COMMAREA       06120000
54400                      ELSE                                         06130000
054500                         PERFORM 4500-SET-ATTRIBUTES-TO-PROT      06140000
054600                         SET DP020-MSG-INFORMATIONAL TO TRUE      06150000
054700*                        ---- PRESS F2 TO CONFIRM REQUEST ----    06160000
054800                         MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER 06170000
054900                     END-IF                                       06180000
055000                 END-IF                                           06190000
055100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06200000
SMJ                END-IF                                               06210000
055200                                                                  06220000
055300         WHEN OTHER                                               06230000
055400             SET DP013-LOGIC-ABEND                                06240000
055500                 DP013-NO-ROLLBACK TO TRUE                        06250000
055600             MOVE '1000-CONTROL-PROCESSING'                       06260000
055700                               TO  DP013-PARAGRAPH                06270000
055800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06280000
055900                               TO  DP013-MESSAGE-TEXT(1)          06290000
056000             PERFORM DP013-0000-PROCESS-ABEND                     06300000
056100     END-EVALUATE.                                                06310000
SMJ                                                                     06320000
SMJ        IF  PS-UNAVAILABLE-RESOURCE                                  06330000
SMJ           SET DP030-OVERRIDE-APPL-ERROR                             06340000
SMJ               DP020-MSG-WARNING    TO TRUE                          06350000
SMJ   *      ---- SYSTEM UNAVAILABLE, TRY AGAIN LATER ---               06360000
SMJ           MOVE PC-TSYMSG-01063  TO DP020-MSG-NUMBER                 06370000
SMJ           SET DP030-SET-CURSOR-APPL-1    TO TRUE                    06380000
SMJ        END-IF.                                                      06390000
056200                                                                  06400000
056300 EJECT                                                            06410000
056400*----------------------------------------------------------------*06420000
056500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA.       06430000
056600*----------------------------------------------------------------*06440000
056700                                                                  06450000
056800 1100-PROCESS-INTER-APPL-COMM.                                    06460000
056900                                                                  06470000
057000     IF IN001-NOT-IN-WITHDRAWAL-PERIOD                            06480000
057100     OR IN001-ITM-CTOFF-HASNT-OCCURRED                            06490000
057200         SET DP020-NEXT-ACT-APPL-ERROR                            06500000
057300             DP020-MSG-FATAL           TO TRUE                    06510000
057400*        ---- STORE NOT YET AVAILABLE FOR STKRM WITHDRAWAL ----   06520000
057500         MOVE PC-TSYMSG-00560 TO DP020-MSG-NUMBER                 06530000
057600     ELSE                                                         06540000
W25428          IF IN001-UNIT-BOOK-HAS-OCCURRED                         06550001
W25428              SET DP020-NEXT-ACT-APPL-ERROR                       06560001
W25428                  DP020-MSG-FATAL           TO TRUE               06570001
W25428*           ---- LOCATION HAS ALREADY BEEN SELECTED FOR BOOKING---06580001
W25428              MOVE PC-TSYMSG-02895 TO DP020-MSG-NUMBER            06590001
W25428          ELSE                                                    06600001
057700            IF ASC-CRIT-SPEC-FMT AND IN001-SHEET-NBR-X NOT NUMERIC06610001
057800                 SET DP020-NEXT-ACT-APPL-ERROR                    06620001
057900                     DP020-MSG-FATAL           TO TRUE            06630001
058000*                ---- ASTERISK NOT PERMITTED FOR SELECTED ----    06640001
058100*                ---- FUNCTION                            ----    06650001
058200                 MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER         06660001
058300             ELSE                                                 06670001
058400                 MOVE IN001-STORE-NAME  TO ASC-STORE-NAME         06680001
058500                 MOVE IN001-STORE-NBR-X TO ASC-KEY-STORE-NBR-X    06690001
058600                 MOVE IN001-ACTL-INV-DTE-YYYYMMDD                 06700001
058700                                  TO ASC-ACTL-INV-DTE-YYYYMMDD    06710001
058800                 MOVE IN001-IN-WITHDRAWAL-PERIOD-SW               06720001
058900                                TO ASC-IN-WITHDRAWAL-PERIOD-SW    06730001
059000                 MOVE IN001-ITM-CTOFF-IND   TO ASC-ITM-CTOFF-IND  06740001
059100                 IF ASC-CRIT-SPEC-FMT                             06750001
059200                     MOVE IN001-SHEET-NBR   TO ASC-KEY-SHEET-NBR  06760001
059300                 ELSE                                             06770001
059400                     IF ASC-LIST-FMT                              06780001
059500                         SET ASC-USE-SELECTION-QUEUE TO TRUE      06790001
059600                         MOVE IN001-NUMBER-OF-TS-ITEMS            06800001
059700                                         TO ASC-NUMBER-OF-TS-ITEMS06810001
059800                         MOVE IN001-SEL-QUEUE-NAME                06820001
059900                                           TO ASC-SEL-QUEUE-NAME  06830001
060000                         PERFORM 1120-PREPARE-LIST-ENTRY          06840001
060100                     ELSE                                         06850001
060200*                        ---- DATA DOES NOT EXIST ----            06860001
060300                         MOVE PC-TSYMSG-00148                     06870001
060400                                       TO DP020-MSG-NUMBER        06880001
060500                         SET DP020-MSG-FATAL TO TRUE              06890001
060600                         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE    06900001
060700                     END-IF                                       06910001
060800                 END-IF                                           06920001
060900             END-IF                                               06930001
060900         END-IF                                                   06940001
061000     END-IF.                                                      06950000
061100                                                                  06960000
061200                                                                  06970000
061300*----------------------------------------------------------------*06980000
061400*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *06990000
061500*----------------------------------------------------------------*07000000
061600                                                                  07010000
061700 1120-PREPARE-LIST-ENTRY.                                         07020000
061800                                                                  07030000
061900     MOVE IN022-MAX-ITEMS TO ASC-SEL-SUB.                         07040000
062000     MOVE ZERO            TO ASC-SEL-ITEM.                        07050000
062100     PERFORM 2140-GET-NEXT-SHEET.                                 07060000
062200 EJECT                                                            07070000
062300*----------------------------------------------------------------*07080000
062400*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *07090000
062500*    ON THE FUNCTION KEY THAT WAS SELECTED.                      *07100000
062600*----------------------------------------------------------------*07110000
062700                                                                  07120000
062800 2000-PROCESS-PANEL.                                              07130000
062900                                                                  07140000
063000     EVALUATE TRUE                                                07150000
063100         WHEN DP020-SRC-AID = DP016-CLEAR                         07160000
063200             IF ASC-DATA-DOES-NOT-EXIST                           07170000
063300                 PERFORM 4500-SET-ATTRIBUTES-TO-PROT              07180000
063400             ELSE                                                 07190000
063500                 IF ASC-UPDATE-FMT                                07200000
063600                     PERFORM 3000-EDIT-DATA-IN-COMMAREA           07210000
063700                 ELSE                                             07220000
063800                     PERFORM 4500-SET-ATTRIBUTES-TO-PROT          07230000
063900                     SET DP020-MSG-INFORMATIONAL TO TRUE          07240000
064000*                    ---- PRESS F2 TO CONFIRM REQUEST ----        07250000
064100                     MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER     07260000
064200                 END-IF                                           07270000
064300             END-IF                                               07280000
064400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07290000
064500                                                                  07300000
064600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07310000
064700             PERFORM 4000-BUILD-INITIAL-PANEL                     07320000
064800                                                                  07330000
064900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07340000
065000             IF  ASC-USE-SELECTION-QUEUE                          07350000
065100                 PERFORM 2140-GET-NEXT-SHEET                      07360000
065200                 IF PS-LIST-END                                   07370000
065300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07380000
065400                     SET PS-NO-LIST-END TO TRUE                   07390000
065500                 ELSE                                             07400000
065600                     PERFORM 4000-BUILD-INITIAL-PANEL             07410000
065700                 END-IF                                           07420000
065800             ELSE                                                 07430000
065900*                ---- BOTTOM OF LIST ----                         07440000
066000                 MOVE PC-TSYMSG-00070                             07450000
066100                                  TO DP020-MSG-NUMBER             07460000
066200                 SET DP020-MSG-INFORMATIONAL TO TRUE              07470000
066300             END-IF                                               07480000
066400                                                                  07490000
066500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07500000
066600             IF  ASC-USE-SELECTION-QUEUE                          07510000
066700                 PERFORM 2150-GET-PREV-SHEET                      07520000
066800                 IF PS-LIST-END                                   07530000
066900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07540000
067000                     SET PS-NO-LIST-END TO TRUE                   07550000
067100                 ELSE                                             07560000
067200                     PERFORM 4000-BUILD-INITIAL-PANEL             07570000
067300                 END-IF                                           07580000
067400             ELSE                                                 07590000
067500*                ---- TOP OF LIST ----                            07600000
067600                 MOVE PC-TSYMSG-00069                             07610000
067700                                  TO DP020-MSG-NUMBER             07620000
067800                 SET DP020-MSG-INFORMATIONAL TO TRUE              07630000
067900             END-IF                                               07640000
068000                                                                  07650000
068100         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    07660000
068200             PERFORM 2170-DELETE-SHEET                            07670000
068300                                                                  07680000
068400         WHEN OTHER                                               07690000
068500             IF ASC-UPDATE-FMT AND ASC-DATA-EXISTS                07700000
068600                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             07710000
068700                     VARYING PS-SUB FROM 1 BY 1                   07720000
068800                       UNTIL PS-SUB > PC-LINES-PER-PANEL          07730000
068900                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07740000
069000                 IF  PS-NO-ERROR                                  07750000
069100                     PERFORM 2100-CHECK-FUNCTION-KEY              07760000
069200                 END-IF                                           07770000
069300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07780000
069400             ELSE                                                 07790000
069500                 PERFORM 2100-CHECK-FUNCTION-KEY                  07800000
069600             END-IF                                               07810000
069700     END-EVALUATE.                                                07820000
069800                                                                  07830000
069900                                                                  07840000
070000 2100-CHECK-FUNCTION-KEY.                                         07850000
070100                                                                  07860000
070200     EVALUATE TRUE                                                07870000
070300                                                                  07880000
070400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07890000
070500          AND ASC-UPDATE-FMT                                      07900000
070600             IF ASC-DATA-EXISTS                                   07910000
070700                 IF PS-NO-UPDATES-REQUESTED                       07920000
070800*                    ---- DATA NOT CHANGED; NO UPDATE PERFORMED --07930000
070900                     MOVE PC-TSYMSG-00046     TO DP020-MSG-NUMBER 07940000
071000                     SET DP020-MSG-FATAL      TO TRUE             07950000
071100                 ELSE                                             07960000
071200                     PERFORM 2180-UPDATE-SHEET                    07970000
071300                 END-IF                                           07980000
071400             ELSE                                                 07990000
071500                 PERFORM 4500-SET-ATTRIBUTES-TO-PROT              08000000
071600*                ---- DATA DOES NOT EXIST ----                    08010000
071700                 MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER         08020000
071800                 SET DP020-MSG-FATAL  TO TRUE                     08030000
071900             END-IF                                               08040000
072000                                                                  08050000
072100         WHEN DP020-SRC-AID = DP016-ENTER                         08060000
072200                 CONTINUE                                         08070000
072300                                                                  08080000
072400         WHEN OTHER                                               08090000
072500             SET DP013-NO-ROLLBACK                                08100000
072600                 DP013-XCTL-DISPLAY-RESTART                       08110000
072700                 DP013-CICS-ABEND  TO TRUE                        08120000
072800             MOVE '2100-CHECK-FUNCTION-KEY'                       08130000
072900                                   TO DP013-PARAGRAPH             08140000
073000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08150000
073100                                   TO DP013-MESSAGE-TEXT (1)      08160000
073200             PERFORM DP013-0000-PROCESS-ABEND                     08170000
073300     END-EVALUATE.                                                08180000
073400*----------------------------------------------------------------*08190000
073500*    GET THE NEXT SHEET IF A LIST OF SHEETS IS BEING PROCESSED.  *08200000
073600*----------------------------------------------------------------*08210000
073700                                                                  08220000
073800 2140-GET-NEXT-SHEET.                                             08230000
073900                                                                  08240000
074000     ADD +1                       TO ASC-SEL-SUB.                 08250000
074100     IF  ASC-SEL-SUB > IN022-MAX-ITEMS                            08260000
074200         ADD +1                   TO ASC-SEL-ITEM                 08270000
074300         MOVE +1                  TO ASC-SEL-SUB                  08280000
074400     END-IF.                                                      08290000
074500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                08300000
074600         PERFORM 9100-READ-SEL-QUEUE                              08310000
074700         IF  IN022-ITEM (ASC-SEL-SUB) > ZERO                      08320000
074800             MOVE IN022-SHEET-NBR (ASC-SEL-SUB)                   08330000
074900                                   TO ASC-KEY-SHEET-NBR           08340000
075000             SET IN022-INQ (ASC-SEL-SUB) TO TRUE                  08350000
075100             PERFORM 9200-REWRITE-SEL-QUEUE                       08360000
075200         ELSE                                                     08370000
075300             SUBTRACT +1 FROM ASC-SEL-SUB                         08380000
075400*            ---- BOTTOM OF LIST ----                             08390000
075500             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             08400000
075600             SET DP020-MSG-INFORMATIONAL TO TRUE                  08410000
075700             SET PS-LIST-END             TO TRUE                  08420000
075800         END-IF                                                   08430000
075900     ELSE                                                         08440000
076000         SUBTRACT +1 FROM ASC-SEL-ITEM                            08450000
076100         MOVE IN022-MAX-ITEMS     TO ASC-SEL-SUB                  08460000
076200*        ---- BOTTOM OF LIST ----                                 08470000
076300         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             08480000
076400         SET DP020-MSG-INFORMATIONAL TO TRUE                      08490000
076500         SET PS-LIST-END             TO TRUE                      08500000
076600     END-IF.                                                      08510000
076700                                                                  08520000
076800*----------------------------------------------------------------*08530000
076900*    GET THE PREVIOUS SHEET IF A LIST OF SHEETS IS BEING         *08540000
077000*    PROCESSED.                                                  *08550000
077100*----------------------------------------------------------------*08560000
077200                                                                  08570000
077300 2150-GET-PREV-SHEET.                                             08580000
077400                                                                  08590000
077500     SUBTRACT +1 FROM ASC-SEL-SUB.                                08600000
077600     IF  ASC-SEL-SUB < +1                                         08610000
077700         SUBTRACT +1 FROM ASC-SEL-ITEM                            08620000
077800         MOVE IN022-MAX-ITEMS     TO ASC-SEL-SUB                  08630000
077900     END-IF.                                                      08640000
078000                                                                  08650000
078100     IF  ASC-SEL-ITEM > ZERO                                      08660000
078200         PERFORM 9100-READ-SEL-QUEUE                              08670000
078300         MOVE IN022-SHEET-NBR (ASC-SEL-SUB)                       08680000
078400                                  TO ASC-KEY-SHEET-NBR            08690000
078500     ELSE                                                         08700000
078600         MOVE +1                  TO ASC-SEL-ITEM                 08710000
078700                                     ASC-SEL-SUB                  08720000
078800*        ---- TOP OF LIST ----                                    08730000
078900         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             08740000
079000         SET DP020-MSG-INFORMATIONAL TO TRUE                      08750000
079100         SET PS-LIST-END             TO TRUE                      08760000
079200     END-IF.                                                      08770000
079300                                                                  08780000
079400                                                                  08790000
079500 2170-DELETE-SHEET.                                               08800000
079600                                                                  08810000
079700     MOVE ASC-KEY-STORE-NBR-X TO PV-DB2-STORE-NBR                 08820000
S26600*                                PV-STR-NBR.                      08830011
S26600     MOVE PV-DB2-STORE-NUMBER TO PV-STR-NBR.                      08840011
079800     MOVE ASC-KEY-SHEET-NBR   TO PV-DB2-SHEET-NBR.                08850000
079900     PERFORM 2175-DELETE-TSTKRMW-SHEET.                           08860000
080000                                                                  08870000
080100     EVALUATE TRUE                                                08880000
080200         WHEN SQLCODE = 0                                         08890000
080300*            ---- DELETE SUCCESSFUL ----                          08900000
080400             MOVE PC-TSYMSG-00115         TO DP020-MSG-NUMBER     08910000
080500             MOVE ASC-KEY-SHEET-NBR-X     TO DP020-MSG-TEXT       08920000
080600             SET  DP020-MSG-INFORMATIONAL TO TRUE                 08930000
080700             IF ASC-USE-SELECTION-QUEUE                           08940000
080800                 PERFORM 9100-READ-SEL-QUEUE                      08950000
080900                 SET IN022-DEL (ASC-SEL-SUB) TO TRUE              08960000
081000                 PERFORM 9200-REWRITE-SEL-QUEUE                   08970000
081100             ELSE                                                 08980000
081200*                *------------------------------------------------08990000
081300*                * RETURN THE SPECIFICATION SCREEN WITH THE       09000000
081400*                * APPROPRIATE MESSAGE. THIS IS ACCOMPLISHED BY   09010000
081500*                * EMULATING THE SETTING OF PF3.                  09020000
081600*                *------------------------------------------------09030000
081700                 SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE      09040000
081800             END-IF                                               09050000
081900         WHEN SQLCODE = +100                                      09060000
082000*            ---- DATA DOES NOT EXIST ----                        09070000
082100             MOVE PC-TSYMSG-00148         TO DP020-MSG-NUMBER     09080000
082200             SET  DP020-MSG-FATAL         TO TRUE                 09090000
082300             IF ASC-USE-SELECTION-QUEUE                           09100000
082400                 CONTINUE                                         09110000
082500             ELSE                                                 09120000
082600                 SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE      09130000
082700             END-IF                                               09140000
082800         WHEN OTHER                                               09150000
082900             SET DP020-MSG-WARNING TO TRUE                        09160000
083000*        ---- WAIT 15 SECONDS, THEN RETRY ----                    09170000
083100             MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER            09180000
083200     END-EVALUATE.                                                09190000
083300                                                                  09200000
083400     SET ASC-DATA-DOES-NOT-EXIST TO TRUE.                         09210000
083500                                                                  09220000
083600                                                                  09230000
083700 2175-DELETE-TSTKRMW-SHEET.                                       09240000
083800                                                                  09250000
W26600     MOVE PV-STR-NBR          TO STKRMW-LOC-NBR.                  09260002
W26600                                                                  09270002
083900     EXEC SQL                                                     09280000
084000         DELETE FROM TSTKRMW                                      09290000
W26600         WHERE  LOC_NBR = :STKRMW-LOC-NBR AND                     09300002
084200                SHEET_NBR = :PV-DB2-SHEET-NBR                     09310000
084300     END-EXEC.                                                    09320000
084400                                                                  09330000
084500     EVALUATE TRUE                                                09340000
084600         WHEN SQLCODE = ZERO                                      09350000
084700         WHEN SQLCODE = +100                                      09360000
084800         WHEN SQLCODE = -904                                      09370000
084900         WHEN SQLCODE = -913                                      09380000
085000             CONTINUE                                             09390000
085100         WHEN SQLWARN0 NOT = SPACES                               09400000
085200         WHEN SQLCODE  NOT = ZERO                                 09410000
085300             MOVE '2175-DELETE-TSTKRMW-SHEET'                     09420000
085400                               TO DP013-PARAGRAPH                 09430000
085500             MOVE 'DELETE ALL LINES FOR A SHEET FROM THE STOCKROOM09440000
085600-                 'WITHDRAWAL TABLE'      TO DP013-MESSAGE-TEXT(1)09450000
085700             MOVE SQLCA        TO DP013-SQLCA                     09460000
085800             MOVE 'TSTKRMW'    TO DP013-DB2-TABLE-NAME (1)        09470000
085900             SET DP013-DB2-ABEND                                  09480000
086000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09490000
086100             PERFORM DP013-0000-PROCESS-ABEND                     09500000
086200     END-EVALUATE.                                                09510000
086300                                                                  09520000
086400                                                                  09530000
086500 2180-UPDATE-SHEET.                                               09540000
086600                                                                  09550000
086700     MOVE ASC-KEY-STORE-NBR-X TO PV-DB2-STORE-NBR                 09560000
S26600*                                PV-STR-NBR.                      09570011
S26600     MOVE PV-DB2-STORE-NUMBER TO PV-STR-NBR.                      09580011
086800     MOVE ASC-KEY-SHEET-NBR   TO PV-DB2-SHEET-NBR.                09590000
086900                                                                  09600000
087000     PERFORM VARYING PS-SUB FROM PC-LINES-PER-PANEL BY -1         09610000
087100       UNTIL ASC-LINE-NBR (PS-SUB) NOT = ZERO                     09620000
087200       OR    PS-SUB < 1                                           09630000
087300         CONTINUE                                                 09640000
087400     END-PERFORM.                                                 09650000
087500                                                                  09660000
087600     PERFORM VARYING PS-ORIG-SUB FROM PC-LINES-PER-PANEL BY -1    09670000
087700       UNTIL PS-ORIG-SUB < 1                                      09680000
087800          OR ASC-ORIG-LINE-NBR (PS-ORIG-SUB) NOT = ZERO           09690000
087900         CONTINUE                                                 09700000
088000     END-PERFORM.                                                 09710000
088100                                                                  09720000
088200     PERFORM UNTIL PS-SUB < 1 OR PS-UPDATE-ERROR-FOUND            09730000
088300         IF ASC-ORIG-LINE-NBR (PS-ORIG-SUB) =                     09740000
088400            ASC-LINE-NBR      (PS-SUB)                            09750000
088500             IF ASC-LINE-CHANGED (PS-SUB)                         09760000
088600                 PERFORM 2187-CHANGE-LINE                         09770000
088700             END-IF                                               09780000
088800             SUBTRACT 1 FROM PS-SUB                               09790000
088900                             PS-ORIG-SUB                          09800000
089000         ELSE                                                     09810000
089100             IF ASC-ORIG-LINE-NBR (PS-ORIG-SUB) >                 09820000
089200                ASC-LINE-NBR      (PS-SUB)                        09830000
089300                 PERFORM 2193-DELETE-LINE                         09840000
089400                 SUBTRACT 1 FROM PS-ORIG-SUB                      09850000
089500             ELSE                                                 09860000
089600                 PERFORM 2183-ADD-LINE                            09870000
089700                 SUBTRACT 1 FROM PS-SUB                           09880000
089800            END-IF                                                09890000
089900         END-IF                                                   09900000
090000     END-PERFORM.                                                 09910000
090100                                                                  09920000
090200*    *------------------------------------------------------------09930000
090300*    * IF ANY UNMATCHED LINES REMAIN ON THE ORIGINAL SHEET, THEY  09940000
090400*    * ARE TO BE DELETED.                                         09950000
090500*    *------------------------------------------------------------09960000
090600                                                                  09970000
090700     PERFORM VARYING PS-ORIG-SUB FROM PS-ORIG-SUB BY -1           09980000
090800       UNTIL PS-ORIG-SUB < 1                                      09990000
090900       OR    PS-UPDATE-ERROR-FOUND                                10000000
091000         PERFORM 2193-DELETE-LINE                                 10010000
091100         SUBTRACT 1 FROM PS-ORIG-SUB                              10020000
091200     END-PERFORM.                                                 10030000
091300                                                                  10040000
091400     IF PS-NO-UPDATE-ERROR-FOUND                                  10050000
091500         PERFORM VARYING PS-SUB FROM 1 BY 1                       10060000
091600               UNTIL PS-SUB > PC-LINES-PER-PANEL                  10070000
091700             MOVE ASC-LINE-NBR               (PS-SUB)             10080000
091800               TO ASC-ORIG-LINE-NBR          (PS-SUB)             10090000
W21732             MOVE ASC-SKU-NBR                (PS-SUB)             10100000
W21732               TO ASC-ORIG-SKU-NBR           (PS-SUB)             10110000
092500             MOVE ASC-UPC-NBR-X              (PS-SUB)             10120000
092600               TO ASC-ORIG-UPC-NBR-X         (PS-SUB)             10130000
092700             MOVE ASC-INV-QTY-X              (PS-SUB)             10140000
092800               TO ASC-ORIG-INV-QTY-X         (PS-SUB)             10150000
092900             MOVE ASC-ITM-UNIT-PR-AMT-X      (PS-SUB)             10160000
093000               TO ASC-ORIG-ITM-UNIT-PR-AMT-X (PS-SUB)             10170000
093100         END-PERFORM                                              10180000
093200         SET DP020-MSG-INFORMATIONAL TO TRUE                      10190000
093300*        ---- UPDATES SUCCESSFUL ----                             10200000
093400         MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER          10210000
093500         IF ASC-USE-SELECTION-QUEUE                               10220000
093600             PERFORM 9100-READ-SEL-QUEUE                          10230000
093700             SET IN022-UPD (ASC-SEL-SUB) TO TRUE                  10240000
093800             PERFORM 9200-REWRITE-SEL-QUEUE                       10250000
093900         END-IF                                                   10260000
094000     END-IF.                                                      10270000
094100                                                                  10280000
094200                                                                  10290000
094300 2183-ADD-LINE.                                                   10300000
094400                                                                  10310000
W26600     MOVE PV-STR-NBR                    TO STKRMW-LOC-NBR.        10320002
094600     MOVE PV-DB2-SHEET-NBR              TO STKRMW-SHEET-NBR.      10330000
094700     MOVE ASC-LINE-NBR        (PS-SUB)  TO STKRMW-LINE-NBR.       10340000
W21732     MOVE ASC-SKU-NBR         (PS-SUB)  TO STKRMW-SKU-NBR.        10350000
095100     IF ASC-UPC-NBR (PS-SUB) IS NUMERIC                           10360000
095200         MOVE ASC-UPC-NBR     (PS-SUB)  TO STKRMW-UPC-NBR         10370000
095300     ELSE                                                         10380000
095400         MOVE ZERO                      TO STKRMW-UPC-NBR         10390000
095500     END-IF.                                                      10400000
095600     MOVE ASC-INV-QTY         (PS-SUB)  TO STKRMW-INV-QTY.        10410000
095700     MOVE ASC-ITM-UNIT-PR-AMT (PS-SUB)  TO STKRMW-ITM-UNIT-PR-AMT.10420000
095800     COMPUTE STKRMW-ITM-EXTD-AMT                                  10430000
095900           = STKRMW-INV-QTY                                       10440000
096000           * STKRMW-ITM-UNIT-PR-AMT.                              10450000
096100     MOVE DP020-USERID                  TO STKRMW-CHG-ID-NBR.     10460000
096200                                                                  10470000
096300*    *-----------------------------------------------------------*10480000
096400*    * INSERT THE ROW INTO THE STOCKROOM WITHDRAWAL TABLE        *10490000
096500*    *-----------------------------------------------------------*10500000
099500                                                                  10510000
096700     EXEC SQL                                                     10520000
096800         INSERT INTO TSTKRMW                                      10530000
W26600              (LOC_NBR                                            10540002
097000            ,  SHEET_NBR                                          10550000
097100            ,  LINE_NBR                                           10560000
W21732            ,  SKU_NBR                                            10570000
097500            ,  UPC_NBR                                            10580000
097600            ,  INV_QTY                                            10590000
097700            ,  ITM_UNIT_PR_AMT                                    10600000
097800            ,  ITM_EXTD_AMT                                       10610000
097900            ,  CHG_TMST                                           10620000
098000            ,  CHG_ID_NBR)                                        10630000
098100         VALUES                                                   10640000
W26600             (:STKRMW-LOC-NBR                                     10650002
098300            , :STKRMW-SHEET-NBR                                   10660000
098400            , :STKRMW-LINE-NBR                                    10670000
W21732            , :STKRMW-SKU-NBR                                     10680000
098800            , :STKRMW-UPC-NBR                                     10690000
098900            , :STKRMW-INV-QTY                                     10700000
099000            , :STKRMW-ITM-UNIT-PR-AMT                             10710000
099100            , :STKRMW-ITM-EXTD-AMT                                10720000
099200            , CURRENT TIMESTAMP                                   10730000
099300            , :STKRMW-CHG-ID-NBR)                                 10740000
099400     END-EXEC.                                                    10750000
099600     EVALUATE TRUE                                                10760000
099700         WHEN SQLCODE = ZERO                                      10770000
099800             CONTINUE                                             10780000
099900         WHEN SQLCODE = -904                                      10790000
100000         WHEN SQLCODE = -913                                      10800000
100100             EXEC CICS                                            10810000
100200                 SYNCPOINT                                        10820000
100300                     ROLLBACK                                     10830000
100400             END-EXEC                                             10840000
100500             SET DP020-MSG-WARNING                                10850000
100600                 PS-UPDATE-ERROR-FOUND TO TRUE                    10860000
100700*            ---- WAIT 15 SECONDS, THEN RETRY ----                10870000
100800             MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER            10880000
100900         WHEN SQLWARN0 NOT = SPACES                               10890000
101000         WHEN SQLCODE  NOT = ZERO                                 10900000
101100             MOVE '2183-ADD-LINE'                                 10910000
101200                               TO DP013-PARAGRAPH                 10920000
101300             MOVE 'INSERT A ROW INTO THE STOCKROOM WITHDRAWAL TABL10930000
101400-                 'E'          TO DP013-MESSAGE-TEXT(1)           10940000
101500             MOVE SQLCA        TO DP013-SQLCA                     10950000
101600             MOVE 'TSTKRMW'    TO DP013-DB2-TABLE-NAME (1)        10960000
101700             SET DP013-DB2-ABEND                                  10970000
101800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10980000
101900             PERFORM DP013-0000-PROCESS-ABEND                     10990000
102000     END-EVALUATE.                                                11000000
102100                                                                  11010000
102200                                                                  11020000
102300 2187-CHANGE-LINE.                                                11030000
102400                                                                  11040000
102500     MOVE ASC-LINE-NBR        (PS-SUB)  TO PV-DB2-LINE-NBR.       11050000
W21732     MOVE ASC-SKU-NBR         (PS-SUB)  TO STKRMW-SKU-NBR.        11060000
103000     IF ASC-SKU-ENTERED (PS-SUB)                                  11070000
103100         MOVE ZERO                      TO STKRMW-UPC-NBR         11080000
103200     ELSE                                                         11090000
103300         MOVE ASC-UPC-NBR     (PS-SUB)  TO STKRMW-UPC-NBR         11100000
103400     END-IF.                                                      11110000
103500     MOVE ASC-INV-QTY         (PS-SUB)  TO STKRMW-INV-QTY.        11120000
103600     MOVE ASC-ITM-UNIT-PR-AMT (PS-SUB)  TO STKRMW-ITM-UNIT-PR-AMT.11130000
103700     COMPUTE STKRMW-ITM-EXTD-AMT                                  11140000
103800           = STKRMW-INV-QTY                                       11150000
103900           * STKRMW-ITM-UNIT-PR-AMT.                              11160000
104000     MOVE DP020-USERID                  TO STKRMW-CHG-ID-NBR.     11170000
104100                                                                  11180000
104200*    *-----------------------------------------------------------*11190000
104300*    * UPDATE THE ROW IN THE STOCKROOM WITHDRAWAL TABLE          *11200000
104400*    *-----------------------------------------------------------*11210000
104500                                                                  11220000
106100                                                                  11230000
W26600     MOVE PV-STR-NBR       TO STKRMW-LOC-NBR                      11240002
W21732     MOVE PV-DB2-SHEET-NBR TO STKRMW-SHEET-NBR                    11250000
W21732     MOVE PV-DB2-LINE-NBR  TO STKRMW-LINE-NBR                     11260000
104600     EXEC SQL                                                     11270000
104700         UPDATE TSTKRMW                                           11280000
W21732             SET  SKU_NBR         = :STKRMW-SKU-NBR               11290000
105100                 ,UPC_NBR         = :STKRMW-UPC-NBR               11300000
105200                 ,INV_QTY         = :STKRMW-INV-QTY               11310000
105300                 ,ITM_UNIT_PR_AMT = :STKRMW-ITM-UNIT-PR-AMT       11320000
105400                 ,ITM_EXTD_AMT    = :STKRMW-ITM-EXTD-AMT          11330000
105500                 ,CHG_TMST        = CURRENT TIMESTAMP             11340000
105600                 ,CHG_ID_NBR      = :STKRMW-CHG-ID-NBR            11350000
W26600             WHERE  LOC_NBR = :STKRMW-LOC-NBR   AND               11360002
W21732                    SHEET_NBR = :STKRMW-SHEET-NBR   AND           11370000
W21732                    LINE_NBR  = :STKRMW-LINE-NBR                  11380000
106000     END-EXEC.                                                    11390000
106200     EVALUATE TRUE                                                11400000
106300         WHEN SQLCODE = ZERO                                      11410000
106400             CONTINUE                                             11420000
106500         WHEN SQLCODE = +100                                      11430000
106600             EXEC CICS                                            11440000
106700                 SYNCPOINT                                        11450000
106800                     ROLLBACK                                     11460000
106900             END-EXEC                                             11470000
107000             SET DP020-MSG-FATAL                                  11480000
107100                 PS-UPDATE-ERROR-FOUND TO TRUE                    11490000
107200*            ---- DATA DOES NOT EXIST ----                        11500000
107300             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            11510000
W21732             MOVE DP015-UNP-NUM-BRT-OFF  TO MR-SKUA  (PS-SUB)     11520000
107700                                            MR-UPCA  (PS-SUB)     11530000
107800                                            MR-QTYA  (PS-SUB)     11540000
107900                                            MR-PRCEA (PS-SUB)     11550000
W21732             MOVE DP015-RED              TO MR-SKUC  (PS-SUB)     11560000
108300                                            MR-UPCC  (PS-SUB)     11570000
108400                                            MR-QTYC  (PS-SUB)     11580000
108500                                            MR-PRCEC (PS-SUB)     11590000
W21732             MOVE DP015-REVERSE          TO MR-SKUH  (PS-SUB)     11600000
108900                                            MR-UPCH  (PS-SUB)     11610000
109000                                            MR-QTYH  (PS-SUB)     11620000
109100                                            MR-PRCEH (PS-SUB)     11630000
W21732             MOVE -1                     TO MR-SKUL  (PS-SUB)     11640000
109300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11650000
109400         WHEN SQLCODE = -904                                      11660000
109500         WHEN SQLCODE = -913                                      11670000
109600             EXEC CICS                                            11680000
109700                 SYNCPOINT                                        11690000
109800                     ROLLBACK                                     11700000
109900             END-EXEC                                             11710000
110000             SET DP020-MSG-WARNING                                11720000
110100                 PS-UPDATE-ERROR-FOUND TO TRUE                    11730000
110200*            ---- WAIT 15 SECONDS, THEN RETRY ----                11740000
110300             MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER            11750000
110400         WHEN SQLWARN0 NOT = SPACES                               11760000
110500         WHEN SQLCODE  NOT = ZERO                                 11770000
110600             MOVE '2187-CHANGE-LINE'                              11780000
110700                               TO DP013-PARAGRAPH                 11790000
110800             MOVE 'UPDATE A ROW IN THE STOCKROOM WITHDRAWAL TABLE'11800000
110900                               TO DP013-MESSAGE-TEXT(1)           11810000
111000             MOVE SQLCA        TO DP013-SQLCA                     11820000
111100             MOVE 'TSTKRMW'    TO DP013-DB2-TABLE-NAME (1)        11830000
111200             SET DP013-DB2-ABEND                                  11840000
111300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11850000
111400             PERFORM DP013-0000-PROCESS-ABEND                     11860000
111500     END-EVALUATE.                                                11870000
111600                                                                  11880000
111700                                                                  11890000
111800 2193-DELETE-LINE.                                                11900000
111900                                                                  11910000
W26600     MOVE PV-STR-NBR          TO STKRMW-LOC-NBR.                  11920002
112000     MOVE ASC-ORIG-LINE-NBR (PS-ORIG-SUB)  TO PV-DB2-LINE-NBR.    11930000
112100                                                                  11940000
112200*    *-----------------------------------------------------------*11950000
112300*    * DELETE THE ROW FROM THE STOCKROOM WITHDRAWAL TABLE        *11960000
112400*    *-----------------------------------------------------------*11970000
112500                                                                  11980000
112600     EXEC SQL                                                     11990000
112700         DELETE FROM TSTKRMW                                      12000000
W26600         WHERE  LOC_NBR = :STKRMW-LOC-NBR AND                     12010002
112900                SHEET_NBR = :PV-DB2-SHEET-NBR AND                 12020000
113000                LINE_NBR  = :PV-DB2-LINE-NBR                      12030000
113100     END-EXEC.                                                    12040000
113200                                                                  12050000
113300     EVALUATE TRUE                                                12060000
113400         WHEN SQLCODE = ZERO                                      12070000
113500         WHEN SQLCODE = +100                                      12080000
113600             CONTINUE                                             12090000
113700         WHEN SQLCODE = -904                                      12100000
113800         WHEN SQLCODE = -913                                      12110000
113900             EXEC CICS                                            12120000
114000                 SYNCPOINT                                        12130000
114100                     ROLLBACK                                     12140000
114200             END-EXEC                                             12150000
114300             SET DP020-MSG-WARNING                                12160000
114400                 PS-UPDATE-ERROR-FOUND TO TRUE                    12170000
114500*            ---- WAIT 15 SECONDS, THEN RETRY ----                12180000
114600             MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER            12190000
114700         WHEN SQLWARN0 NOT = SPACES                               12200000
114800         WHEN SQLCODE  NOT = ZERO                                 12210000
114900             MOVE '2193-DELETE-LINE'                              12220000
115000                               TO DP013-PARAGRAPH                 12230000
115100             MOVE 'DELETE A ROW FROM THE STOCKROOM WITHDRAWAL TABL12240000
115200-                 'E'          TO DP013-MESSAGE-TEXT(1)           12250000
115300             MOVE SQLCA        TO DP013-SQLCA                     12260000
115400             MOVE 'TSTKRMW'    TO DP013-DB2-TABLE-NAME (1)        12270000
115500             SET DP013-DB2-ABEND                                  12280000
115600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12290000
115700             PERFORM DP013-0000-PROCESS-ABEND                     12300000
115800     END-EVALUATE.                                                12310000
115900                                                                  12320000
116000                                                                  12330000
116100 2200-MOVE-SCREEN-TO-COMMAREA.                                    12340000
116200                                                                  12350000
116300*    *------------------------------------------------------------12360000
116400*    * IF A LINE HAD A UPC ENTERED ON THE LAST SCREEN, RATHER     12370000
116500*    * THAN A SKU, THE SKU IN THE ASC WAS FILLED IN BY THE EDIT   12380000
116600*    * PROCESS, PROVIDING NO ERRORS WERE DETECTED. THAT SKU IS    12390000
116700*    * BLANKED OUT NOW SO THAT THERE WON'T BE ANY 'LEFTOVERS'     12400000
116800*    * IF THE EDIT PROCESS FAILS TO FILL IN THE SKU THIS TIME     12410000
116900*    * BECAUSE OF EDIT ERRORS.                                    12420000
117000*    *------------------------------------------------------------12430000
117100                                                                  12440000
117200     IF ASC-SKU-NOT-ENTERED (PS-SUB)                              12450000
W21732         MOVE SPACE           TO ASC-SKU-NBR         (PS-SUB).    12460000
W21732     IF  MR-SKUL (PS-SUB) > ZERO                                  12470000
W21732         MOVE MR-SKU (PS-SUB)     TO ASC-SKU-NBR (PS-SUB)         12480000
W21732         IF ASC-SKU-NBR (PS-SUB) > SPACE                          12490000
W21732             SET ASC-SKU-ENTERED (PS-SUB) TO TRUE                 12500000
W21732         ELSE                                                     12510000
W21732             SET ASC-SKU-NOT-ENTERED (PS-SUB) TO TRUE             12520000
W21732         END-IF                                                   12530000
W21732     ELSE                                                         12540000
W21732         IF  MR-SKUF (PS-SUB) = DP015-ERASE-EOF                   12550000
W21732             MOVE SPACE           TO ASC-SKU-NBR (PS-SUB)         12560000
W21732             SET ASC-SKU-NOT-ENTERED (PS-SUB) TO TRUE             12570000
W21732         END-IF                                                   12580000
W21732     END-IF.                                                      12590000
120600                                                                  12600000
120700     IF  MR-UPCL (PS-SUB) > ZERO                                  12610000
120800         MOVE MR-UPC-X (PS-SUB)   TO ASC-UPC-NBR-X (PS-SUB)       12620000
120900     ELSE                                                         12630000
121000         IF  MR-UPCF (PS-SUB) = DP015-ERASE-EOF                   12640000
121100             MOVE SPACE           TO ASC-UPC-NBR-X (PS-SUB)       12650000
121200         END-IF                                                   12660000
121300     END-IF.                                                      12670000
121400                                                                  12680000
121500     IF  MR-QTYL (PS-SUB) > ZERO                                  12690000
121600         MOVE MR-QTY-X (PS-SUB)   TO ASC-INV-QTY-X (PS-SUB)       12700000
121700     ELSE                                                         12710000
121800         IF  MR-QTYF (PS-SUB) = DP015-ERASE-EOF                   12720000
121900             MOVE SPACE           TO ASC-INV-QTY-X (PS-SUB)       12730000
122000         END-IF                                                   12740000
122100     END-IF.                                                      12750000
122200                                                                  12760000
122300     IF  MR-PRCEL (PS-SUB) > ZERO                                 12770000
122400         MOVE MR-PRCE-X (PS-SUB)                                  12780000
122500                         TO ASC-ITM-UNIT-PR-AMT-X (PS-SUB)        12790000
122600     ELSE                                                         12800000
122700         IF  MR-PRCEF (PS-SUB) = DP015-ERASE-EOF                  12810000
122800             MOVE SPACE  TO ASC-ITM-UNIT-PR-AMT-X (PS-SUB)        12820000
122900         END-IF                                                   12830000
123000     END-IF.                                                      12840000
123100                                                                  12850000
123200                                                                  12860000
123300 3000-EDIT-DATA-IN-COMMAREA.                                      12870000
123400                                                                  12880000
123500     PERFORM 3220-REMOVE-DELETED-LINES.                           12890000
123600                                                                  12900000
123700     MOVE ASC-KEY-STORE-NBR-X TO PV-DB2-STORE-NBR                 12910000
S26600*                                PV-STR-NBR.                      12920011
S26600     MOVE PV-DB2-STORE-NUMBER TO PV-STR-NBR.                      12930011
123800     MOVE ASC-KEY-SHEET-NBR   TO PV-DB2-SHEET-NBR.                12940000
123900                                                                  12950000
124000     PERFORM VARYING PS-SUB FROM PC-LINES-PER-PANEL BY -1         12960000
124100       UNTIL PS-SUB < 1                                           12970000
124200          OR ASC-LINE-NBR (PS-SUB) NOT = ZERO                     12980000
124300         PERFORM 4525-SET-ATTRIBUTES-TO-UNPROT                    12990000
124400     END-PERFORM.                                                 13000000
124500                                                                  13010000
124600     IF PS-SUB < 1                                                13020000
124700         SET PS-ERROR                                             13030000
124800             DP020-MSG-FATAL         TO TRUE                      13040000
124900*        ---- SHEET MUST CONTAIN AT LEAST ONE LINE ----           13050000
125000         MOVE PC-TSYMSG-00614        TO DP020-MSG-NUMBER          13060000
125100     ELSE                                                         13070000
125200         PERFORM VARYING PS-ORIG-SUB FROM PC-LINES-PER-PANEL BY -113080000
125300           UNTIL PS-ORIG-SUB < 1                                  13090000
125400              OR ASC-ORIG-LINE-NBR (PS-ORIG-SUB) NOT = ZERO       13100000
125500             CONTINUE                                             13110000
125600         END-PERFORM                                              13120000
125700         PERFORM 3230-EDIT-LINES                                  13130000
125800         IF PS-NO-ERROR                                           13140000
W21732             MOVE -1 TO MR-SKUL (1)                               13150000
126000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13160000
126100         END-IF                                                   13170000
126200     END-IF.                                                      13180000
126300                                                                  13190000
126400                                                                  13200000
126500*----------------------------------------------------------------*13210000
126600* IF THE UPC AND THE DEPARTMENT PORTION OF THE SKU ARE EMPTY,    *13220000
126700* REMOVE THE ENTIRE LINE AND MOVE THE SUBSEQUENT LINES UP TO     *13230000
126800* CLOSE THE GAP. ALSO, ASSIGN LINE NUMBERS TO LINES THAT ARE     *13240000
126900* BEING ADDED.                                                   *13250000
127000*----------------------------------------------------------------*13260000
127100                                                                  13270000
127200 3220-REMOVE-DELETED-LINES.                                       13280000
127300                                                                  13290000
127400     MOVE +1 TO PS-SUB2.                                          13300000
127500     PERFORM VARYING PS-SUB FROM 1 BY 1                           13310000
127600               UNTIL PS-SUB > PC-LINES-PER-PANEL                  13320000
127700         IF ASC-SKU-ENTERED (PS-SUB)                              13330000
127800         OR ASC-UPC-NBR-X   (PS-SUB) > SPACE                      13340000
127900             MOVE ASC-MAP-DETAIL-LINE (PS-SUB)                    13350000
128000               TO ASC-MAP-DETAIL-LINE (PS-SUB2)                   13360000
128100             IF ASC-SKU-NOT-ENTERED (PS-SUB2)                     13370000
W21732                 MOVE SPACE TO ASC-SKU-NBR         (PS-SUB2)      13380000
128500             END-IF                                               13390000
128600             IF ASC-LINE-NBR (PS-SUB2) = ZERO                     13400000
128700                 ADD +1 TO ASC-LAST-LINE-NBR                      13410000
128800                 MOVE ASC-LAST-LINE-NBR TO ASC-LINE-NBR (PS-SUB2) 13420000
128900             END-IF                                               13430000
129000             ADD +1 TO PS-SUB2                                    13440000
129100         END-IF                                                   13450000
129200     END-PERFORM.                                                 13460000
129300                                                                  13470000
129400     PERFORM VARYING PS-SUB2 FROM PS-SUB2 BY 1                    13480000
129500       UNTIL PS-SUB2 > PC-LINES-PER-PANEL                         13490000
129600         INITIALIZE ASC-MAP-DETAIL-LINE (PS-SUB2)                 13500000
129700     END-PERFORM.                                                 13510000
129800                                                                  13520000
129900                                                                  13530000
130000*-----------------------------------------------------------------13540000
130100*  MATCH THE LINES ON THE ORIGINAL SHEET TO THE LINES ON THE      13550000
130200*  UPDATED SHEET TO DETERMINE WHICH LINES ARE BEING ADDED,        13560000
130300*  SUBTRACTED, OR CHANGED.  EDIT THE FIELDS ON THE LINES BEING    13570000
130400*  ADDED OR CHANGED. SET A SWITCH INDICATING WHETHER OR NOT       13580000
130500*  ANY UPDATES WERE MADE TO THE SHEET.                            13590000
130600*-----------------------------------------------------------------13600000
130700                                                                  13610000
130800 3230-EDIT-LINES.                                                 13620000
130900                                                                  13630000
131000     PERFORM UNTIL PS-SUB < 1                                     13640000
131100         PERFORM 4525-SET-ATTRIBUTES-TO-UNPROT                    13650000
131200         IF ASC-ORIG-LINE-NBR (PS-ORIG-SUB) =                     13660000
131300            ASC-LINE-NBR      (PS-SUB)                            13670000
131400             PERFORM 3250-EDIT-MAP-DETAIL-FIELDS                  13680000
W21732             IF  ASC-SKU-NBR                (PS-SUB) =            13690000
W21732                 ASC-ORIG-SKU-NBR           (PS-ORIG-SUB)         13700000
132100             AND ASC-UPC-NBR-X              (PS-SUB) =            13710000
132200                 ASC-ORIG-UPC-NBR-X         (PS-ORIG-SUB)         13720000
132300             AND ASC-INV-QTY-X              (PS-SUB) =            13730000
132400                 ASC-ORIG-INV-QTY-X         (PS-ORIG-SUB)         13740000
132500                 IF ASC-GET-PRICE-FROM-SCREEN      (PS-SUB)       13750000
132600                     IF ASC-ITM-UNIT-PR-AMT-X      (PS-SUB) =     13760000
132700                        ASC-ORIG-ITM-UNIT-PR-AMT-X (PS-ORIG-SUB)  13770000
132800                         SET ASC-LINE-DIDNT-CHANGE (PS-SUB)       13780000
132900                                                        TO TRUE   13790000
133000                     ELSE                                         13800000
133100                         SET ASC-LINE-CHANGED (PS-SUB)            13810000
133200                             PS-UPDATES-REQUESTED     TO TRUE     13820000
133300                     END-IF                                       13830000
133400                 ELSE                                             13840000
133500                     SET ASC-LINE-DIDNT-CHANGE (PS-SUB) TO TRUE   13850000
133600                 END-IF                                           13860000
133700             ELSE                                                 13870000
133800                 SET ASC-LINE-CHANGED (PS-SUB)                    13880000
133900                     PS-UPDATES-REQUESTED      TO TRUE            13890000
134000             END-IF                                               13900000
134100             SUBTRACT 1 FROM PS-SUB                               13910000
134200                             PS-ORIG-SUB                          13920000
134300         ELSE                                                     13930000
134400             IF ASC-ORIG-LINE-NBR (PS-ORIG-SUB) >                 13940000
134500                ASC-LINE-NBR      (PS-SUB)                        13950000
134600                 SET PS-UPDATES-REQUESTED TO TRUE                 13960000
134700                 SUBTRACT 1 FROM PS-ORIG-SUB                      13970000
134800             ELSE                                                 13980000
134900                 PERFORM 3250-EDIT-MAP-DETAIL-FIELDS              13990000
135000                 SET PS-UPDATES-REQUESTED TO TRUE                 14000000
135100                 SUBTRACT 1 FROM PS-SUB                           14010000
135200            END-IF                                                14020000
135300         END-IF                                                   14030000
135400     END-PERFORM.                                                 14040000
135500                                                                  14050000
135600*    *------------------------------------------------------------14060000
135700*    * IF ANY UNMATCHED LINES REMAIN ON THE ORIGINAL SHEET, THEY  14070000
135800*    * ARE TO BE DELETED. SET THE SWITCH THAT INDICATES THAT      14080000
135900*    * UPDATES WERE REQUESTED.                                    14090000
136000*    *------------------------------------------------------------14100000
136100                                                                  14110000
136200     IF PS-ORIG-SUB < 1                                           14120000
136300         CONTINUE                                                 14130000
136400     ELSE                                                         14140000
136500         SET PS-UPDATES-REQUESTED TO TRUE                         14150000
136600     END-IF.                                                      14160000
136700                                                                  14170000
136800                                                                  14180000
136900 3250-EDIT-MAP-DETAIL-FIELDS.                                     14190000
137000                                                                  14200000
137100*    *------------------------------------------------------------14210000
137200*    * EDIT THE QUANTITY                                          14220000
137300*    *------------------------------------------------------------14230000
137400                                                                  14240000
137500     SET PS-NO-ERRORS-IN-LINE                                     14250000
137600         PS-VALID-SKU         TO TRUE.                            14260000
IN2001                                                                  14270000
IN2001     INITIALIZE PV-STR000-UPC-STAT-CDE                            14280000
IN2001                PV-STR000-UNT-RTL-AMT                             14290000
IN2001                PV-STR000-MEITGP-NBR.                             14300000
137700                                                                  14310000
137800     IF ASC-INV-QTY-X (PS-SUB) = SPACE                            14320000
137900         SET PS-ERROR                                             14330000
138000             PS-ERRORS-IN-LINE                                    14340000
138100             DP020-MSG-FATAL         TO TRUE                      14350000
138200*        ---- REQUIRED FIELD ----                                 14360000
138300         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          14370000
138400         MOVE DP015-UNP-NUM-BRT-OFF  TO MR-QTYA (PS-SUB)          14380000
138500         MOVE DP015-RED              TO MR-QTYC (PS-SUB)          14390000
138600         MOVE DP015-REVERSE          TO MR-QTYH (PS-SUB)          14400000
138700         MOVE -1                     TO MR-QTYL (PS-SUB)          14410000
138800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      14420000
138900     ELSE                                                         14430000
139000         MOVE ASC-INV-QTY-X (PS-SUB) TO DP010I-UNEDITED-FIELD     14440000
139100         MOVE LENGTH OF ASC-INV-QTY (PS-SUB)                      14450000
139200                                     TO DP010I-MAXIMUM-DIGITS     14460000
139300         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   14470000
139400         SET  DP010I-NEGATIVE-NOT-ALLOWED                         14480000
139500                                     TO TRUE                      14490000
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14501050
263126              USING DP010I-NUMERIC-EDIT-AREA                      14502050
139700                                                                  14510000
139800         IF DP010I-ERROR-DETECTED                                 14520000
139900             SET  PS-ERROR                                        14530000
140000                  PS-ERRORS-IN-LINE                               14540000
140100                  DP020-MSG-FATAL        TO TRUE                  14550000
140200*            ---- MUST BE NUMERIC ----                            14560000
140300             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      14570000
140400             MOVE DP015-UNP-NUM-BRT-OFF  TO MR-QTYA (PS-SUB)      14580000
140500             MOVE DP015-RED              TO MR-QTYC (PS-SUB)      14590000
140600             MOVE DP015-REVERSE          TO MR-QTYH (PS-SUB)      14600000
140700             MOVE -1                     TO MR-QTYL (PS-SUB)      14610000
140800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14620000
140900         ELSE                                                     14630000
141000             MOVE DP010I-NUMERIC-FIELD   TO ASC-INV-QTY (PS-SUB)  14640000
141100             IF ASC-INV-QTY (PS-SUB) = ZERO                       14650000
141200                 SET  PS-ERROR                                    14660000
141300                      PS-ERRORS-IN-LINE                           14670000
141400                      DP020-MSG-FATAL    TO TRUE                  14680000
141500*                ---- CANNOT BE ZERO ----                         14690000
141600                 MOVE PC-TSYMSG-00010    TO DP020-MSG-NUMBER      14700000
141700                 MOVE DP015-UNP-NUM-BRT-OFF                       14710000
141800                                         TO MR-QTYA (PS-SUB)      14720000
141900                 MOVE DP015-RED          TO MR-QTYC (PS-SUB)      14730000
142000                 MOVE DP015-REVERSE      TO MR-QTYH (PS-SUB)      14740000
142100                 MOVE -1                 TO MR-QTYL (PS-SUB)      14750000
142200                 SET DP030-SET-CURSOR-APPL-1                      14760000
142300                                         TO TRUE                  14770000
142400             ELSE                                                 14780000
142500                 IF ASC-INV-QTY (PS-SUB) > PC-MAX-QTY             14790000
142600                     SET  PS-ERROR                                14800000
142700                          PS-ERRORS-IN-LINE                       14810000
142800                          DP020-MSG-FATAL    TO TRUE              14820000
142900*                    -- CANNOT EXCEED 99 UNITS PER STKRMW LINE -- 14830000
143000                     MOVE PC-TSYMSG-00684    TO DP020-MSG-NUMBER  14840000
143100                     MOVE DP015-UNP-NUM-BRT-OFF                   14850000
143200                                             TO MR-QTYA (PS-SUB)  14860000
143300                     MOVE DP015-RED          TO MR-QTYC (PS-SUB)  14870000
143400                     MOVE DP015-REVERSE      TO MR-QTYH (PS-SUB)  14880000
143500                     MOVE -1                 TO MR-QTYL (PS-SUB)  14890000
143600                     SET DP030-SET-CURSOR-APPL-1                  14900000
143700                                             TO TRUE              14910000
143800                 END-IF                                           14920000
143900             END-IF                                               14930000
144000         END-IF                                                   14940000
144100     END-IF.                                                      14950000
144200                                                                  14960000
144300*    *------------------------------------------------------------14970000
144400*    * EDIT THE SKU AND UPC                                       14980000
144500*    *------------------------------------------------------------14990000
144600                                                                  15000000
144700     MOVE ASC-GET-PRICE-SW  (PS-SUB) TO PS-GOT-LAST-PRICE-SW.     15010000
144800     SET ASC-DONT-GET-PRICE (PS-SUB) TO TRUE.                     15020000
144900                                                                  15030000
145000     IF ASC-SKU-ENTERED (PS-SUB)                                  15040000
145100         IF ASC-UPC-NBR-X (PS-SUB) > SPACE                        15050000
145200             SET PS-ERROR                                         15060000
145300                 DP020-MSG-FATAL         TO TRUE                  15070000
145400*            ---- SPECIFY UPC OR SKU; NOT BOTH ----               15080000
145500             MOVE PC-TSYMSG-00547        TO DP020-MSG-NUMBER      15090000
W21732             MOVE DP015-UNP-NUM-BRT-OFF  TO MR-SKUA  (PS-SUB)     15100000
145900                                            MR-UPCA  (PS-SUB)     15110000
W21732             MOVE DP015-RED              TO MR-SKUC  (PS-SUB)     15120000
146300                                            MR-UPCC  (PS-SUB)     15130000
W21732             MOVE DP015-REVERSE          TO MR-SKUH  (PS-SUB)     15140000
146700                                            MR-UPCH  (PS-SUB)     15150000
W21732             MOVE -1                     TO MR-SKUL  (PS-SUB)     15160000
146900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15170000
147000         ELSE                                                     15180000
147100             PERFORM 3325-EDIT-SKU                                15190000
147200             IF PS-VALID-SKU                                      15200000
147300                 PERFORM 3350-VALIDATE-SKU                        15210000
147400             END-IF                                               15220000
147500         END-IF                                                   15230000
147600     ELSE                                                         15240000
147700         MOVE ASC-UPC-NBR-X (PS-SUB)                              15250000
147800                                    TO DP010I-UNEDITED-FIELD      15260000
147900         MOVE LENGTH OF ASC-UPC-NBR-X (PS-SUB)                    15270000
148000                                    TO DP010I-MAXIMUM-DIGITS      15280000
148100         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    15290000
148200         SET  DP010I-NEGATIVE-NOT-ALLOWED                         15300000
148300                                    TO TRUE                       15310000
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15321050
263126              USING DP010I-NUMERIC-EDIT-AREA                      15322050
148500                                                                  15330000
148600         IF DP010I-ERROR-DETECTED                                 15340000
148700             SET  PS-ERROR                                        15350000
148800                  DP020-MSG-FATAL        TO TRUE                  15360000
148900*            ---- MUST BE NUMBERIC ----                           15370000
149000             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      15380000
149100             MOVE DP015-UNP-NUM-BRT-OFF  TO MR-UPCA (PS-SUB)      15390000
149200             MOVE DP015-RED              TO MR-UPCC (PS-SUB)      15400000
149300             MOVE DP015-REVERSE          TO MR-UPCH (PS-SUB)      15410000
149400             MOVE -1                     TO MR-UPCL (PS-SUB)      15420000
149500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15430000
149600         ELSE                                                     15440000
149700             MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                   15450000
149800                                       TO ASC-UPC-NBR (PS-SUB)    15460000
149900             IF ASC-UPC-NBR (PS-SUB) = ZERO                       15470000
150000                 SET  PS-ERROR                                    15480000
150100                      DP020-MSG-FATAL    TO TRUE                  15490000
150200*                ---- CANNOT BE ZERO ----                         15500000
150300                 MOVE PC-TSYMSG-00010    TO DP020-MSG-NUMBER      15510000
150400                 MOVE DP015-UNP-NUM-BRT-OFF                       15520000
150500                                         TO MR-UPCA (PS-SUB)      15530000
150600                 MOVE DP015-RED          TO MR-UPCC (PS-SUB)      15540000
150700                 MOVE DP015-REVERSE      TO MR-UPCH (PS-SUB)      15550000
150800                 MOVE -1                 TO MR-UPCL (PS-SUB)      15560000
150900                 SET DP030-SET-CURSOR-APPL-1                      15570000
151000                                         TO TRUE                  15580000
151100             ELSE                                                 15590000
151200                 PERFORM 3300-VALIDATE-UPC                        15600000
151300             END-IF                                               15610000
151400         END-IF                                                   15620000
151500     END-IF.                                                      15630000
151600                                                                  15640000
151700                                                                  15650000
151800*    *------------------------------------------------------------15660000
151900*    * EDIT THE CUTOFF PRICE. FOR CLEARANCE SKUS OR UPCS/SKUS     15670000
152000*    * WITH A SEQUENCE NUMBER OF '000' OR '999', THE PRICE MUST   15680000
152100*    * BE ENTERED ON THE SCREEN.  IN ALL OTHER CASES, THE PRICE   15690000
152200*    * IS RETRIEVED FROM THE TABLE TUPCPLS. A SWITCH WAS SET      15700000
152300*    * WHILE EDITING THE UPC OR SKU, INDICATING WHETHER THE SOURCE15710000
152400*    * OF THE CUTOFF PRICE SHOULD BE THE SCREEN OR THE TABLE.     15720000
152500*    *                                                            15730000
152600*    * BECAUSE THE EDITING OF THE PRICE FIELD IS DEPENDENT UPON   15740000
152700*    * THE RESULTS OF EDITING THE UPC OR SKU, THE NORMAL          15750000
152800*    * CONVENTION OF EDITING FIELDS IN REVERSE ORDER CANNOT BE    15760000
152900*    * FOLLOWED WITHIN EACH LINE. THEREFORE, IF AN ERROR IS       15770000
153000*    * DISCOVERED WHILE EDITING PRICE, THE ERROR MESSAGE IS       15780000
153100*    * ONLY FILLED IN IF NO OTHER ERRORS OCCURRED ON THE LINE.    15790000
153200*    * THIS WILL ENSURE THAT THE ERROR MESSAGE DISPLAYED          15800000
153300*    * CORRESPONDS TO THE FIELD ON WHICH THE CURSOR IS SET.       15810000
153400*    *------------------------------------------------------------15820000
153500                                                                  15830000
153600     IF ASC-GET-PRICE-FROM-SCREEN (PS-SUB)                        15840000
IN2001         PERFORM 3275-PROCESS-CLEARANCE-ITEM                      15850000
166800     END-IF.                                                      15860000
166900 EJECT                                                            15870000
      *                                                                 15880000
23511C*------------------------------------------------------------     15890000
23511C* THIS PARAGRAPH WAS MOVED FROM WITHIN 3250-EDIT-MAP-DETAIL-FIELDS15900000
23511C* TO CHECK THE DATES TO DECIDE IF THE PRICE SHOULD BE DISPLAYED   15910000
23511C* OR THE USER SHOULD ENTER THE PRICE                              15920000
23511C*------------------------------------------------------------     15930000
      *                                                                 15940000
23511C  3265-PROCESS-CLEARANCE-DATES.                                   15950000
W28545      IF IN400-PRC-STAT-CHG-DTE-OUT                               15960022
W28545                         EQUAL IN400-PRC-UPC-CHG-DTE-OUT          15970020
W28545          SET ASC-GET-PRICE-FROM-INPD400 (PS-SUB) TO TRUE         15980034
W28545          MOVE IN400-PRC-STATUS-OUT TO PV-STR000-UPC-STAT-CDE     15990020
W28545          MOVE IN400-PRC-UNIT-RTL-OUT                             16000020
23511C              TO PV-STR000-UNT-RTL-AMT                            16010000
23511C                 ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)               16020000
23511C                 ASC-ITM-UNIT-PR-AMT       (PS-SUB)               16030000
W28545          MOVE IN400-PRC-MEITGP-NBR TO PV-STR000-MEITGP-NBR       16040020
23511C      ELSE                                                        16050000
23511C          SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE          16060000
23511C      END-IF.                                                     16070000
      *                                                                 16080000
IN2001*                                                                 16090000
IN2001*------------------------------------------------------------     16100000
IN2001* THIS PARAGRAPH WAS MOVED FROM WITHIN 3250-EDIT-MAP-DETAIL-FIELDS16110000
IN2001* TO ACCOUNT FOR RE-ANALYSIS OF CLEARANCE ITEMS (IF STR000 ROW WAS16120000
IN2001* FOUND TO BE A MIXED ('25') STATUS).                             16130000
IN2001* THIS WILL BE EXECUTED AT LEAST ONCE FROM THE INITIAL REVIEW OF  16140000
IN2001* SWITCH THAT WAS SET FROM THE STR000 ROW. IF THE STORE-SPECIFIC  16150000
IN2001* ROW IS CALLED AND FOUND TO BE A CLEARANCE STATUS, THIS MUST BE  16160000
IN2001* RE-EVALUATED.                                                   16170000
IN2001*------------------------------------------------------------     16180000
IN2001 3275-PROCESS-CLEARANCE-ITEM.                                     16190000
IN2001     IF PS-GOT-LAST-PRICE-FROM-TSKST                              16200000
IN2001         MOVE SPACE TO ASC-ITM-UNIT-PR-AMT-X (PS-SUB)             16210000
IN2001     END-IF                                                       16220000
IN2001     IF ASC-ITM-UNIT-PR-AMT-X (PS-SUB) = SPACE                    16230000
IN2001         IF PS-NO-ERRORS-IN-LINE                                  16240000
IN2001             SET DP020-MSG-FATAL         TO TRUE                  16250000
IN2001*            ---- REQUIRED FIELD ----                             16260000
IN2001             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      16270000
IN2001             MOVE -1                     TO MR-PRCEL (PS-SUB)     16280000
IN2001             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  16290000
IN2001         END-IF                                                   16300000
IN2001         SET PS-ERROR                    TO TRUE                  16310000
IN2001         MOVE DP015-UNP-NUM-BRT-OFF      TO MR-PRCEA (PS-SUB)     16320000
IN2001         MOVE DP015-RED                  TO MR-PRCEC (PS-SUB)     16330000
IN2001         MOVE DP015-REVERSE              TO MR-PRCEH (PS-SUB)     16340000
IN2001     ELSE                                                         16350000
IN2001         MOVE ASC-ITM-UNIT-PR-AMT-X (PS-SUB)                      16360000
IN2001                                    TO DP010I-UNEDITED-FIELD      16370000
IN2001         MOVE PC-ITM-UNIT-PR-MAX-DIGITS                           16380000
IN2001                                    TO DP010I-MAXIMUM-DIGITS      16390000
IN2001         MOVE 2                     TO DP010I-MAXIMUM-DECIMALS    16400000
IN2001         SET  DP010I-NEGATIVE-NOT-ALLOWED                         16410000
IN2001                                    TO TRUE                       16420000
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                         16431050
263126              USING DP010I-NUMERIC-EDIT-AREA                      16432050
IN2001                                                                  16440000
IN2001         IF DP010I-ERROR-DETECTED                                 16450000
IN2001             IF PS-NO-ERRORS-IN-LINE                              16460000
IN2001                 SET DP020-MSG-FATAL      TO TRUE                 16470000
IN2001*                ---- MUST BE NUMBERIC, NON-NEGATIVE, ----        16480000
IN2001*                ---- AND WITHIN SIZE CONSTRAINT      ----        16490000
IN2001                 MOVE PC-TSYMSG-00343     TO DP020-MSG-NUMBER     16500000
IN2001                 MOVE -1                  TO MR-PRCEL (PS-SUB)    16510000
IN2001                 SET DP030-SET-CURSOR-APPL-1                      16520000
IN2001                                          TO TRUE                 16530000
IN2001             END-IF                                               16540000
IN2001             SET  PS-ERROR                TO TRUE                 16550000
IN2001             MOVE DP015-UNP-NUM-BRT-OFF   TO MR-PRCEA (PS-SUB)    16560000
IN2001             MOVE DP015-RED               TO MR-PRCEC (PS-SUB)    16570000
IN2001             MOVE DP015-REVERSE           TO MR-PRCEH (PS-SUB)    16580000
IN2001         ELSE                                                     16590000
IN2001             MOVE DP010I-NUMERIC-FIELD                            16600000
IN2001                         TO ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)    16610000
IN2001                            ASC-ITM-UNIT-PR-AMT       (PS-SUB)    16620000
IN2001             IF DP010I-NUMERIC-FIELD  = ZERO                      16630000
IN2001                 IF PS-NO-ERRORS-IN-LINE                          16640000
IN2001                     SET  DP020-MSG-FATAL TO TRUE                 16650000
IN2001*                    ---- CANNOT BE ZERO ----                     16660000
IN2001                     MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER     16670000
IN2001                     MOVE -1              TO MR-PRCEL (PS-SUB)    16680000
IN2001                     SET DP030-SET-CURSOR-APPL-1                  16690000
IN2001                                          TO TRUE                 16700000
IN2001                 END-IF                                           16710000
IN2001                 SET  PS-ERROR            TO TRUE                 16720000
IN2001                 MOVE DP015-UNP-NUM-BRT-OFF                       16730000
IN2001                                          TO MR-PRCEA (PS-SUB)    16740000
IN2001                 MOVE DP015-RED           TO MR-PRCEC (PS-SUB)    16750000
IN2001                 MOVE DP015-REVERSE       TO MR-PRCEH (PS-SUB)    16760000
IN2001             ELSE                                                 16770000
IN2001                 IF ASC-ITM-UNIT-PR-AMT (PS-SUB)                  16780000
IN2001                                                < PC-MIN-PRICE    16790000
IN2001                 OR ASC-ITM-UNIT-PR-AMT (PS-SUB)                  16800000
IN2001                                                > PC-MAX-PRICE    16810000
IN2001                     IF PS-NO-ERRORS-IN-LINE                      16820000
IN2001                         SET  DP020-MSG-FATAL TO TRUE             16830000
IN2001*                        -- UNIT PRICE MUST BE BETWEEN .20 --     16840000
IN2001*                        -- AND 999.99                     --     16850000
IN2001                         MOVE PC-TSYMSG-00685                     16860000
IN2001                                          TO DP020-MSG-NUMBER     16870000
IN2001                         MOVE -1          TO MR-PRCEL (PS-SUB)    16880000
IN2001                         SET DP030-SET-CURSOR-APPL-1              16890000
IN2001                                          TO TRUE                 16900000
IN2001                     END-IF                                       16910000
IN2001                     SET  PS-ERROR            TO TRUE             16920000
IN2001                     MOVE DP015-UNP-NUM-BRT-OFF                   16930000
IN2001                                          TO MR-PRCEA (PS-SUB)    16940000
IN2001                     MOVE DP015-RED       TO MR-PRCEC (PS-SUB)    16950000
IN2001                     MOVE DP015-REVERSE   TO MR-PRCEH (PS-SUB)    16960000
IN2001                 ELSE                                             16970000
IN2001                     MOVE DP015-UNP-NUM-NOR-OFF                   16980000
IN2001                                          TO MR-PRCEA (PS-SUB)    16990000
IN2001                     MOVE DP015-GREEN     TO MR-PRCEC (PS-SUB)    17000000
IN2001                     MOVE DP015-UNDERLINE TO MR-PRCEH (PS-SUB)    17010000
IN2001                 END-IF                                           17020000
IN2001             END-IF                                               17030000
IN2001         END-IF                                                   17040000
IN2001     END-IF.                                                      17050000
IN2001*                                                                 17060000
167000*----------------------------------------------------------------*17070000
167100* FOR ALL UPC'S, VALIDATE THE CHECK DIGIT.                        17080000
167200* IF THE UPC IS AN INTERNAL UPC WITH A SEQUENCE NUMBER OF '000'  *17090000
167300* OR '999' IN THE EMBEDDED SKU, VALIDATE THE DEPARTMENT AND       17100000
167400* CLASS AGAINST TMDSEAR. IF NOT, CONVERT THE UPC TO A SKU.        17110000
167500*----------------------------------------------------------------*17120000
167600                                                                  17130000
167700 3300-VALIDATE-UPC.                                               17140000
167800                                                                  17150000
W28545     INITIALIZE IN400-PV-INPUT-AREA.                              17160020
W28545     MOVE ASC-UPC-NBR (PS-SUB) TO PV-DB2-UPC-NBR                  17170019
W28545                                  IN400-PV-UPC-NBR-IN.            17180020
W28545     SET IN400-PV-UPC-NBR-LOOKUP TO TRUE.                         17190020
W28545     MOVE PV-STR-NBR             TO IN400-PV-LOC-IN-NUM.          17200020
W28545     MOVE PV-PLND-INV-TMST       TO IN400-PV-EFF-DTE-IN.          17210029
W28545     PERFORM IN400-LOOKUP-RETAIL.                                 17220020
W28545     EVALUATE TRUE                                                17230019
W28545         WHEN IN400-PV-FOUND                                      17240019
W28582*            IF IN400-PV-DUMMY-SKU                                17250040
W28582             IF IN400-PV-DUMMY-UPC                                17251040
W28545                 SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB)           17260020
W28545                                                      TO TRUE     17270020
W28582                 MOVE IN400-ATT-SKU-OUT TO ASC-SKU-NBR (PS-SUB)   17271039
W28582                 MOVE IN400-ATT-ITM-NBR-OUT TO PV-DB2-ITEM-NMBR   17272039
W28545             ELSE                                                 17280020
W28545                 PERFORM 3352-PROCESS-PRICE                       17290020
W28545                 MOVE IN400-PRC-SKU-OUT TO ASC-SKU-NBR (PS-SUB)   17300031
W28545                 MOVE IN400-PRC-ITM-NBR-OUT TO PV-DB2-ITEM-NMBR   17310031
W28545             END-IF                                               17320031
W28545         WHEN IN400-PV-NOT-FOUND                                  17330019
W28545             SET  PS-ERROR                                        17480019
W28545                  PS-ERRORS-IN-LINE                               17490019
W28545                  DP020-MSG-FATAL        TO TRUE                  17500019
W28545*            ---- INVALID ENTRY ----                              17510019
W28545             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      17520019
W28545             MOVE DP015-UNP-NUM-BRT-OFF  TO MR-UPCA (PS-SUB)      17530019
W28545             MOVE DP015-RED              TO MR-UPCC (PS-SUB)      17540019
W28545             MOVE DP015-REVERSE          TO MR-UPCH (PS-SUB)      17550019
W28545             MOVE -1                     TO MR-UPCL (PS-SUB)      17560019
W28545             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17570019
W285??*            END-IF                                               17580020
W28545         WHEN IN400-PV-SQL-ERROR                                  17590020
W28545             SET  PS-ERROR                                        17600020
W28545                  DP020-MSG-WARNING      TO TRUE                  17610020
W28545*            ---- WAIT 15 SECONDS, THEN RETRY ----                17620020
W28545             MOVE PC-TSYMSG-00551        TO DP020-MSG-NUMBER      17630020
W28545     END-EVALUATE.                                                17640020
179900                                                                  17650000
180000 3325-EDIT-SKU.                                                   17660000
180100                                                                  17670000
180200*    *------------------------------------------------------------17680000
180300*    * EDIT THE SKU                                               17690000
180400*    *------------------------------------------------------------17700000
W21732     IF ASC-SKU-NBR (PS-SUB) > SPACE                              17710000
W21732         MOVE ASC-SKU-NBR (PS-SUB) TO DP010I-UNEDITED-FIELD       17720000
W21732         MOVE LENGTH OF ASC-SKU-NBR (PS-SUB)                      17730000
W21732                                   TO DP010I-MAXIMUM-DIGITS       17740000
181000         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     17750000
181100         SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                 17760000
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17771050
263126              USING DP010I-NUMERIC-EDIT-AREA                      17772050
181300                                                                  17780000
181400         IF DP010I-ERROR-DETECTED                                 17790000
181500                 SET  PS-ERROR                                    17800000
181600                      PS-INVALID-SKU                              17810000
181700                      DP020-MSG-FATAL        TO TRUE              17820000
181800*                ---- MUST BE NUMBERIC ----                       17830000
181900                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  17840000
W21732                 MOVE DP015-UNP-NUM-BRT-OFF  TO MR-SKUA  (PS-SUB) 17850000
W21732                 MOVE DP015-RED              TO MR-SKUC  (PS-SUB) 17860000
W21732                 MOVE DP015-REVERSE          TO MR-SKUH  (PS-SUB) 17870000
W21732                 MOVE -1                     TO MR-SKUL  (PS-SUB) 17880000
182400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              17890000
182500         ELSE                                                     17900000
182600             MOVE DP010I-NUM-FIELD-11-DIG-6-DEC                   17910000
182700                                     TO ASC-SKU-NBR-N (PS-SUB)    17920000
182800         END-IF                                                   17930000
182900     END-IF.                                                      17940000
183000                                                                  17950000
188900                                                                  17960000
189000                                                                  17970000
189100*-----------------------------------------------------------------17980000
189200* IF THE SKU HAS A SEQUENCE NUMBER OF '000' OR '999', VALIDATE   *17990000
189300* THE DEPARTMENT AND CLASS AGAINST TMDSEAR.  IF NOT, LOOK UP     *18000000
189400* THE SKU ON TSKXREF. IF IT IS NOT FOUND, IT IS INVALID. IF THE  *18010000
189500* SKU WAS RENUMBERED ON OR BEFORE THE ACTUAL INVENTORY DATE, THE *18020000
189600* RENUMBERED SKU IS OBTAINED SO THAT ITS ITEM NUMBER CAN BE USED *18030000
189700* LATER TO RETRIEVE THE CUTOFF PRICE.                            *18040000
189800*----------------------------------------------------------------*18050000
189900                                                                  18060000
190000 3350-VALIDATE-SKU.                                               18070000
W28545                                                                  18080032
W28545     INITIALIZE IN400-PV-INPUT-AREA.                              18090032
W28545     MOVE ASC-SKU-NBR (PS-SUB) TO PV-DB2-SKU-NBR                  18100020
W28545                                 IN400-PV-SKU-IN-NUM.             18110020
W28545     SET IN400-PV-SKU-LOOKUP TO TRUE.                             18120020
W28545     MOVE PV-STR-NBR       TO IN400-PV-LOC-IN-NUM.                18130020
W28545     MOVE PV-PLND-INV-TMST TO IN400-PV-EFF-DTE-IN.                18140028
W28545     PERFORM IN400-LOOKUP-RETAIL.                                 18150020
W28545     EVALUATE TRUE                                                18160020
W28545         WHEN IN400-PV-FOUND                                      18170020
W28545             IF IN400-PV-DUMMY-SKU                                18180023
W28545                 SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB)           18190023
W28545                                                      TO TRUE     18200023
W28545             ELSE                                                 18210023
W28545                 PERFORM 3352-PROCESS-PRICE                       18220023
W28545             END-IF                                               18230023
W28545         WHEN IN400-PV-NOT-FOUND                                  18240023
W28545             SET PS-ERROR                                         18250023
W28545                 PS-ERRORS-IN-LINE                                18260023
W28545                 DP020-MSG-FATAL         TO TRUE                  18270023
W28545*            ---- INVALID ENTRY ----                              18280023
W28545             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      18290023
W28545             MOVE DP015-UNP-NUM-BRT-OFF  TO MR-SKUA  (PS-SUB)     18300023
W28545             MOVE DP015-RED              TO MR-SKUC  (PS-SUB)     18310023
W28545             MOVE DP015-REVERSE          TO MR-SKUH  (PS-SUB)     18320023
W28545             MOVE -1                     TO MR-SKUL  (PS-SUB)     18330023
W28545             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  18340023
W28545         WHEN IN400-PV-SQL-ERROR                                  18350023
W28545             SET  PS-ERROR                                        18360023
W28545                  DP020-MSG-WARNING TO TRUE                       18370023
W28545*            ---- WAIT 15 SECONDS, THEN RETRY ----                18380023
W28545             MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER             18390023
W28545     END-EVALUATE.                                                18400023
192200                                                                  18410000
197400                                                                  18420000
W28545 3352-PROCESS-PRICE.                                              18430012
W28545                                                                  18440012
W28545     IF IN400-PS-RENUMBER-SKU                                     18450026
W28545         PERFORM 3380-PROCESS-RENUMBERED-SKU                      18460026
W28545         SET DP020-MSG-INFORMATIONAL   TO TRUE                    18470026
W28545         MOVE PC-TSYMSG-00453      TO DP020-MSG-NUMBER            18480026
W28545         MOVE IN400-PRC-SKU-OUT    TO PV-RSKU-NBR                 18490031
W28545                                      ASC-SKU-NBR     (PS-SUB)    18500031
W28545         MOVE PV-RENUMBERED-SKU    TO DP020-MSG-TEXT              18510031
W28545     END-IF.                                                      18520031
W28545                                                                  18530031
W28545     IF IN400-PRC-STATUS-OUT = PC-CLEARANCE-SKU-STATUS            18540031
W28545         PERFORM 3265-PROCESS-CLEARANCE-DATES                     18550012
W28545     ELSE                                                         18560012
W28545         IF IN400-PRC-STATUS-OUT = PC-MIXED-STATUS                18570026
W28545             SET ASC-GET-PRICE-FROM-INPD400 (PS-SUB)  TO TRUE     18580034
W28545*            MOVE IN400-PRC-ITM-NBR-OUT TO PV-DB2-ITEM-NMBR       18590037
974311             MOVE IN400-PRC-UNIT-RTL-OUT TO                       18600038
974311                                ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)18610038
974311                                ASC-ITM-UNIT-PR-AMT       (PS-SUB)18620038
W28545         ELSE                                                     18630031
W28545             SET ASC-GOT-STR000-PRICE (PS-SUB)        TO TRUE     18640031
W28545             PERFORM 3359-CHECK-GROUP-PRICING                     18650031
W28545         END-IF                                                   18660026
W28545     END-IF.                                                      18670012
W28545                                                                  18680012
W28545                                                                  18690012
IN2001******************************************************************18700000
IN2001* USE GROUP ITEM INDICATOR FROM TUPCPLS TO DETERMINE IF RETAIL    18710000
IN2001* IS PRICED AS PART OF A GROUPING. IF SO - RETRIEVE GROUP PRICING 18720000
IN2001* FROM DB2 (TMITGPL). THEN POPULATES SCREEN ITEM UNIT RETAIL      18730000
IN2001******************************************************************18740000
IN2001 3359-CHECK-GROUP-PRICING.                                        18750000
IN2001                                                                  18760000
W28545     IF IN400-PRC-MEITGP-NBR NOT EQUAL 0                          18770020
IN2001      COMPUTE PV-GROUP-UNIT-RTL ROUNDED =                         18780020
W28545            (IN400-PRC-GP-AMT /                                   18790020
W28545             IN400-PRC-MITGPL-QTY )                               18800020
IN2001         MOVE PV-GROUP-UNIT-RTL      TO                           18810000
IN2001          ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                      18820000
IN2001          ASC-ITM-UNIT-PR-AMT       (PS-SUB)                      18830000
IN2001      ELSE                                                        18840000
W28545          MOVE IN400-PRC-UNIT-RTL-OUT TO                          18850020
IN2001          ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                      18860000
IN2001          ASC-ITM-UNIT-PR-AMT       (PS-SUB)                      18870000
IN2001      END-IF.                                                     18880000
IN2001                                                                  18890000
212000 3380-PROCESS-RENUMBERED-SKU.                                     18900000
212100                                                                  18910000
212200     PERFORM 3385-FMT-STCHNG-DTE-FOR-CMPARE.                      18920000
212300                                                                  18930000
212400     IF ASC-ACTL-INV-DTE-YYYYMMDD < PV-STAT-CHNGD-DATE-YYYYMMDD   18940000
W28545         SET ASC-GET-PRICE-FROM-INPD400 (PS-SUB) TO TRUE          18950034
W28545         MOVE IN400-PRC-ITM-NBR-OUT TO PV-DB2-ITEM-NMBR           18960031
212700     ELSE                                                         18970000
W28545         MOVE IN400-PRC-UPC-OUT TO PV-DB2-UPC-NBR                 18980020
213200     END-IF.                                                      18990000
213300                                                                  19000000
213500 3385-FMT-STCHNG-DTE-FOR-CMPARE.                                  19010000
213600                                                                  19020000
213700     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       19030000
213800*    MOVE DP017-CURRENT-DATE-YMD      TO DPG51-SYSTEM-DATE.       19040000
213900     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    19050000
214000     SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    19060000
214100     MOVE ZERO                      TO DPG51-INCR-DECR-DAYS-9     19070000
214200                                       DPG51-INCR-DECR-BUS-DAYS-9.19080000
214300     SET  DPG52-LK-DTE-GREG           TO TRUE.                    19090000
W28545     MOVE IN400-PRC-STAT-CHG-DTE-OUT TO PV-DATE.                  19100020
W21732     MOVE PV-DATE(3:2)              TO PV-YYMMDD-YY.              19110000
W21732     MOVE PV-DATE(6:2)              TO PV-YYMMDD-MM.              19120000
W21732     MOVE PV-DATE(9:2)              TO PV-YYMMDD-DD.              19130000
214500     MOVE PV-YYMMDD-MMDD            TO PV-MMDDYY-MMDD.            19140000
214600     MOVE PV-YYMMDD-YY              TO PV-MMDDYY-YY.              19150000
214700     MOVE PV-MMDDYY-DATE            TO DPG52-LK-DATE-INPUT.       19160000
214800                                                                  19170000
214900     CALL PC-CALENDAR-ROUTINE USING DPG51                         19180000
215000                                    DPG52                         19190000
215100                                    DPG53                         19200000
215200                                    DPG54                         19210000
215300                                    DPG55                         19220000
215400                                    DPG56.                        19230000
215500     EVALUATE TRUE                                                19240000
215600     WHEN DPG54-SEVERE-ERROR                                      19250000
215700     WHEN DPG54-DATE-INVALID                                      19260000
215800         MOVE '3385-FMT-STCHNG-DTE-FOR-CMPARE'                    19270000
215900                               TO  DP013-PARAGRAPH                19280000
216000         MOVE 'ERROR DETECTED BY CALENDAR ROUTINE:'               19290000
216100                               TO  DP013-MESSAGE-TEXT (1)         19300000
216200         MOVE DPG54-ERROR-MESSAGE                                 19310000
216300                               TO  DP013-MESSAGE-TEXT (2)         19320000
216400         SET DP013-LOGIC-ABEND TO  TRUE                           19330000
216500         PERFORM DP013-0000-PROCESS-ABEND                         19340000
216600     END-EVALUATE.                                                19350000
216700                                                                  19360000
216800     MOVE DPG55-DB2-ISO-DATE TO PV-STAT-CHNGD-DATE-YYYYMMDD.      19370000
216900                                                                  19380000
217000                                                                  19390000
IN2000 3480-READ-TINVPAR.                                               19400000
IN2000                                                                  19410000
W26600     MOVE ASC-KEY-STORE-NBR   TO INVPAR-LOC-NBR.                  19420009
J28545     MOVE IN001-INV-ID        TO INVPAR-INV-ID                    19430035
W26600                                                                  19440002
IN2000     EXEC SQL                                                     19450000
J28545       SELECT A.PLND_INV_DTE                                      19460036
J28545             ,A.LOC_NBR                                           19470036
IN2000       INTO  :INVPAR-PLND-INV-DTE                                 19480000
W26600            ,:INVPAR-LOC-NBR                                      19490002
J28545       FROM   TINVPAR A                                           19500036
J28545            , TINCNTL B                                           19510035
W26600       WHERE A.LOC_NBR   = :INVPAR-LOC-NBR                        19520035
J28545         AND A.INV_ID    = :INVPAR-INV-ID                         19530035
J28545         AND A.INV_ID    = B.INV_ID                               19540035
W33304         AND A.ACTL_FIN_BK_DTE = '9999-09-09'                     19550044
W33304         AND A.LOC_INV_STAT_CDE = 'IN'                            19551044
W33304         AND B.ACTV_IND = 'Y'                                     19552044
IN2000     END-EXEC.                                                    19560000
IN2000                                                                  19570000
IN2000     EVALUATE TRUE                                                19580000
IN2000         WHEN SQLCODE = 0                                         19590000
W26600             MOVE INVPAR-LOC-NBR        TO PV-STR-NBR             19600002
IN2000             MOVE INVPAR-PLND-INV-DTE   TO PV-PLND-INV-DTE        19610000
IN2000             MOVE PV-PLND-INV-TIMESTAMP TO PV-PLND-INV-TMST       19620000
SMJ            WHEN SQLCODE = -913                                      19630000
SMJ            WHEN SQLCODE = -904                                      19640000
SMJ            WHEN SQLCODE = -911                                      19650000
SMJ                SET  PS-ERROR                                        19660000
SMJ                     PS-UNAVAILABLE-RESOURCE  TO TRUE                19670000
IN2000         WHEN SQLCODE = +100                                      19680000
IN2000         WHEN SQLWARN NOT = SPACE                                 19690000
IN2000         WHEN SQLCODE NOT = ZERO                                  19700000
IN2000             MOVE '3480-READ-TINVPAR'                             19710000
IN2000                               TO DP013-PARAGRAPH                 19720000
IN2000             MOVE 'RETRIEVE STORE PLANNED INV DATE'               19730000
IN2000                               TO DP013-MESSAGE-TEXT(1)           19740000
IN2000             MOVE SQLCA        TO DP013-SQLCA                     19750000
IN2000             MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)        19760000
IN2000             SET DP013-DB2-ABEND                                  19770000
IN2000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19780000
IN2000             PERFORM DP013-0000-PROCESS-ABEND                     19790000
IN2000     END-EVALUATE.                                                19800000
IN2000                                                                  19810000
227400                                                                  19820000
227500*----------------------------------------------------------------*19830000
227600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19840000
227700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19850000
227800*    DISPLAY THE PANEL TO USER.                                  *19860000
227900*----------------------------------------------------------------*19870000
228000                                                                  19880000
228100 4000-BUILD-INITIAL-PANEL.                                        19890000
228200                                                                  19900000
228300     INITIALIZE ASC-ITEM-ARRAY                                    19910000
228400                ASC-ORIG-ITEM-ARRAY.                              19920000
228500                                                                  19930000
228600     MOVE ASC-KEY-STORE-NBR-X TO PV-DB2-STORE-NBR                 19940000
S26600*                                PV-STR-NBR.                      19950011
S26600     MOVE PV-DB2-STORE-NUMBER TO PV-STR-NBR.                      19960011
228700     MOVE ASC-KEY-SHEET-NBR   TO PV-DB2-SHEET-NBR.                19970000
228800                                                                  19980000
228900     PERFORM 4010-OPEN-CURSOR.                                    19990000
229000                                                                  20000000
229100     PERFORM 4300-READ-ITEMS-FROM-DB.                             20010000
229200                                                                  20020000
229300     PERFORM 4020-CLOSE-CURSOR.                                   20030000
229400                                                                  20040000
229500     IF PS-NO-SHEET-FOUND                                         20050000
229600         SET DP020-MSG-FATAL                                      20060000
229700             ASC-DATA-DOES-NOT-EXIST TO TRUE                      20070000
229800*        ---- DATA DOES NOT EXIST ----                            20080000
229900         MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER                 20090000
230000         IF  ASC-CRIT-SPEC-FMT                                    20100000
230100         AND NOT DP020-FK-REFRESH (DP020-SRC-AID)                 20110000
230200             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                20120000
230300         ELSE                                                     20130000
230400             PERFORM 4500-SET-ATTRIBUTES-TO-PROT                  20140000
230500             IF ASC-LIST-FMT                                      20150000
230600                 PERFORM 9100-READ-SEL-QUEUE                      20160000
230700                 SET IN022-DEL (ASC-SEL-SUB) TO TRUE              20170000
230800                 PERFORM 9200-REWRITE-SEL-QUEUE                   20180000
230900             END-IF                                               20190000
231000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 20200000
231100         END-IF                                                   20210000
231200     ELSE                                                         20220000
231300         SET ASC-DATA-EXISTS TO TRUE                              20230000
231400         IF ASC-DELETE-FMT                                        20240000
231500             PERFORM 4500-SET-ATTRIBUTES-TO-PROT                  20250000
231600             SET DP020-MSG-INFORMATIONAL TO TRUE                  20260000
231700*            ---- PRESS F2 TO CONFIRM REQUEST ----                20270000
231800             MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER             20280000
231900         ELSE                                                     20290000
232000             PERFORM 4525-SET-ATTRIBUTES-TO-UNPROT                20300000
232100                 VARYING PS-SUB FROM 1 BY 1                       20310000
232200                 UNTIL PS-SUB > PC-LINES-PER-PANEL                20320000
W21732             MOVE -1 TO MR-SKUL (1)                               20330000
232400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  20340000
232500         END-IF                                                   20350000
232600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20360000
232700     END-IF.                                                      20370000
232800 EJECT                                                            20380000
232900*----------------------------------------------------------------*20390000
233000* OPEN THE CURSOR.                                               *20400000
233100*----------------------------------------------------------------*20410000
233200                                                                  20420000
233300 4010-OPEN-CURSOR.                                                20430000
W26600     MOVE PV-STR-NBR       TO STKRMW-LOC-NBR                      20440002
W21732     MOVE PV-DB2-SHEET-NBR TO STKRMW-SHEET-NBR                    20450000
233400                                                                  20460000
233500     EXEC SQL                                                     20470000
233600          OPEN LINE-NBR-CSR                                       20480000
233700     END-EXEC.                                                    20490000
233800                                                                  20500000
233900     EVALUATE TRUE                                                20510000
234000         WHEN SQLCODE = ZERO                                      20520000
234100              CONTINUE                                            20530000
234200         WHEN SQLWARN0 NOT EQUAL SPACE                            20540000
234300         WHEN SQLCODE NOT EQUAL ZERO                              20550000
234400              MOVE '4010-OPEN-CURSOR'                             20560000
234500                           TO  DP013-PARAGRAPH                    20570000
234600              MOVE 'OPEN STOCKROOM WITHDRAWAL LINE-NBR CURSOR'    20580000
234700                           TO  DP013-MESSAGE-TEXT (1)             20590000
234800              MOVE SQLCA   TO  DP013-SQLCA                        20600000
234900              SET DP013-DB2-ABEND                                 20610000
235000                           TO  TRUE                               20620000
235100              PERFORM DP013-0000-PROCESS-ABEND                    20630000
235200     END-EVALUATE.                                                20640000
235300                                                                  20650000
235400 EJECT                                                            20660000
235500*----------------------------------------------------------------*20670000
235600* CLOSE THE CURSOR.                                              *20680000
235700*----------------------------------------------------------------*20690000
235800                                                                  20700000
235900 4020-CLOSE-CURSOR.                                               20710000
236000                                                                  20720000
236100     EXEC SQL                                                     20730000
236200         CLOSE LINE-NBR-CSR                                       20740000
236300     END-EXEC.                                                    20750000
236400                                                                  20760000
236500     EVALUATE TRUE                                                20770000
236600         WHEN SQLCODE = ZERO                                      20780000
236700              CONTINUE                                            20790000
236800         WHEN SQLWARN0 NOT = SPACE                                20800000
236900         WHEN SQLCODE  NOT = ZERO                                 20810000
237000              MOVE '4020-CLOSE-CURSOR'                            20820000
237100                           TO  DP013-PARAGRAPH                    20830000
237200              MOVE 'CLOSE STOCKROOM WITHDRAWAL LINE-NBR CURSOR'   20840000
237300                           TO  DP013-MESSAGE-TEXT (1)             20850000
237400              MOVE SQLCA   TO  DP013-SQLCA                        20860000
237500              SET DP013-DB2-ABEND                                 20870000
237600                           TO  TRUE                               20880000
237700              PERFORM DP013-0000-PROCESS-ABEND                    20890000
237800     END-EVALUATE.                                                20900000
237900                                                                  20910000
238000                                                                  20920000
238100*----------------------------------------------------------------*20930000
238200* READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE ARRAY. 20940000
238300*----------------------------------------------------------------*20950000
238400                                                                  20960000
238500 4300-READ-ITEMS-FROM-DB.                                         20970000
238600                                                                  20980000
238700     PERFORM VARYING PS-SUB FROM 1 BY 1                           20990000
238800       UNTIL PS-SUB > PC-LINES-PER-PANEL                          21000000
238900       OR    SQLCODE = +100                                       21010000
239000                                                                  21020000
239100         PERFORM 4310-FETCH                                       21030000
239200                                                                  21040000
239300         EVALUATE TRUE                                            21050000
239400             WHEN SQLCODE = 0                                     21060000
239500                 SET PS-SHEET-FOUND TO TRUE                       21070000
239600                 MOVE STKRMW-LINE-NBR                             21080000
239700                              TO ASC-LINE-NBR             (PS-SUB)21090000
239800                                 ASC-ORIG-LINE-NBR        (PS-SUB)21100000
239900                                 ASC-LAST-LINE-NBR                21110000
W21732                 MOVE STKRMW-SKU-NBR                              21120000
W21732                              TO ASC-SKU-NBR              (PS-SUB)21130000
W21732                                 ASC-ORIG-SKU-NBR         (PS-SUB)21140000
240900                 IF STKRMW-UPC-NBR = ZERO                         21150000
241000                     MOVE SPACE   TO ASC-UPC-NBR-X        (PS-SUB)21160000
241100                                     ASC-ORIG-UPC-NBR-X   (PS-SUB)21170000
241200                 ELSE                                             21180000
241300                     MOVE STKRMW-UPC-NBR                          21190000
241400                                  TO ASC-UPC-NBR          (PS-SUB)21200000
241500                                     ASC-ORIG-UPC-NBR     (PS-SUB)21210000
241600                 END-IF                                           21220000
241700                 MOVE STKRMW-INV-QTY                              21230000
241800                              TO ASC-INV-QTY              (PS-SUB)21240000
241900                                 ASC-ORIG-INV-QTY         (PS-SUB)21250000
242000                 MOVE STKRMW-ITM-UNIT-PR-AMT                      21260000
242100                        TO ASC-ITM-UNIT-PR-AMT            (PS-SUB)21270000
242200                           ASC-ITM-UNIT-PR-AMT-X-FMT      (PS-SUB)21280000
242300                           ASC-ORIG-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)21290000
242400                 IF STKRMW-UPC-NBR = ZERO                         21300000
242500                     SET ASC-SKU-ENTERED     (PS-SUB) TO TRUE     21310000
242600                 ELSE                                             21320000
242700                     SET ASC-SKU-NOT-ENTERED (PS-SUB) TO TRUE     21330000
242800                 END-IF                                           21340000
242900             WHEN OTHER                                           21350000
243000                 CONTINUE                                         21360000
243100         END-EVALUATE                                             21370000
243200     END-PERFORM.                                                 21380000
243300                                                                  21390000
243400 EJECT                                                            21400000
243500*----------------------------------------------------------------*21410000
243600*    FETCH THE LINE-NBR CURSOR.                                  *21420000
243700*----------------------------------------------------------------*21430000
243800                                                                  21440000
243900 4310-FETCH.                                                      21450000
244000                                                                  21460000
244100     EXEC SQL                                                     21470000
244200          FETCH LINE-NBR-CSR                                      21480000
244300          INTO  :STKRMW-LINE-NBR                                  21490000
W21732              , :STKRMW-SKU-NBR                                   21500000
244700              , :STKRMW-UPC-NBR                                   21510000
244800              , :STKRMW-INV-QTY                                   21520000
244900              , :STKRMW-ITM-UNIT-PR-AMT                           21530000
245000     END-EXEC.                                                    21540000
245100                                                                  21550000
245200     EVALUATE TRUE                                                21560000
245300         WHEN SQLCODE = ZERO                                      21570000
245400         WHEN SQLCODE = +100                                      21580000
245500              CONTINUE                                            21590000
245600         WHEN SQLWARN0 NOT = SPACE                                21600000
245700         WHEN SQLCODE  NOT = ZERO                                 21610000
245800             MOVE '4310-FETCH-CURSOR'                             21620000
245900                          TO  DP013-PARAGRAPH                     21630000
246000             MOVE 'FETCH STOCKROOM WITHDRAWAL LINE-NBR CURSOR'    21640000
246100                          TO  DP013-MESSAGE-TEXT (1)              21650000
246200             MOVE SQLCA   TO  DP013-SQLCA                         21660000
246300             SET DP013-DB2-ABEND                                  21670000
246400                          TO  TRUE                                21680000
246500             PERFORM DP013-0000-PROCESS-ABEND                     21690000
246600     END-EVALUATE.                                                21700000
246700                                                                  21710000
246800                                                                  21720000
246900*----------------------------------------------------------------*21730000
247000*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *21740000
247100*----------------------------------------------------------------*21750000
247200                                                                  21760000
247300 4400-MOVE-COMMAREA-TO-SCREEN.                                    21770000
247400                                                                  21780000
W26600     MOVE ASC-KEY-STORE-NBR-X TO ASTRNBRO.                        21790006
247500     MOVE ASC-STORE-NAME      TO ASTNAMEO.                        21800002
247600     MOVE ASC-KEY-SHEET-NBR-X TO ASHEETO.                         21810000
247700                                                                  21820000
247800     PERFORM VARYING PS-SUB FROM 1 BY 1                           21830000
247900         UNTIL PS-SUB > PC-LINES-PER-PANEL                        21840000
248000         IF ASC-SKU-ENTERED (PS-SUB)                              21850000
W21732             MOVE ASC-SKU-NBR         (PS-SUB) TO MR-SKU  (PS-SUB)21860000
248400         ELSE                                                     21870000
W21732            MOVE SPACE                        TO  MR-SKU  (PS-SUB)21880000
248800         END-IF                                                   21890000
248900                                                                  21900000
249000         IF ASC-UPC-NBR (PS-SUB) IS NUMERIC                       21910000
249100             MOVE ASC-UPC-NBR   (PS-SUB) TO MR-UPC   (PS-SUB)     21920000
249200         ELSE                                                     21930000
249300             MOVE ASC-UPC-NBR-X (PS-SUB) TO MR-UPC-X (PS-SUB)     21940000
249400         END-IF                                                   21950000
249500                                                                  21960000
249600         IF ASC-INV-QTY (PS-SUB) IS NUMERIC                       21970000
249700             MOVE ASC-INV-QTY   (PS-SUB) TO MR-QTY   (PS-SUB)     21980000
249800         ELSE                                                     21990000
249900             MOVE ASC-INV-QTY-X (PS-SUB) TO MR-QTY-X (PS-SUB)     22000000
250000         END-IF                                                   22010000
250100                                                                  22020000
250200         MOVE ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                  22030000
250300                                         TO MR-PRCE-X (PS-SUB)    22040000
250400     END-PERFORM.                                                 22050000
250500                                                                  22060000
250600                                                                  22070000
250700 4500-SET-ATTRIBUTES-TO-PROT.                                     22080000
250800                                                                  22090000
250900     PERFORM VARYING PS-SUB FROM 1 BY 1                           22100000
251000       UNTIL PS-SUB > PC-LINES-PER-PANEL                          22110000
W21732         MOVE DP015-PRO-NOR-OFF        TO MR-SKUA (PS-SUB)        22120000
251400                                          MR-UPCA  (PS-SUB)       22130000
251500                                          MR-QTYA  (PS-SUB)       22140000
251600                                          MR-PRCEA (PS-SUB)       22150000
W21732         MOVE DP015-BLUE               TO MR-SKUC  (PS-SUB)       22160000
252000                                          MR-UPCC  (PS-SUB)       22170000
252100                                          MR-QTYC  (PS-SUB)       22180000
252200                                          MR-PRCEC (PS-SUB)       22190000
W21732         MOVE DP015-HL-OFF             TO MR-SKUH  (PS-SUB)       22200000
252600                                          MR-UPCH  (PS-SUB)       22210000
252700                                          MR-QTYH  (PS-SUB)       22220000
252800                                          MR-PRCEH (PS-SUB)       22230000
252900     END-PERFORM.                                                 22240000
253000                                                                  22250000
253100                                                                  22260000
253200 4525-SET-ATTRIBUTES-TO-UNPROT.                                   22270000
253300                                                                  22280000
W21732     MOVE DP015-UNP-NUM-NOR-OFF    TO MR-SKUA  (PS-SUB)           22290000
                                            MR-UPCA  (PS-SUB)           22300000
253800                                      MR-QTYA  (PS-SUB).          22310000
W21732     MOVE DP015-GREEN              TO MR-SKUC  (PS-SUB)           22320000
254200                                      MR-UPCC  (PS-SUB)           22330000
254300                                      MR-QTYC  (PS-SUB).          22340000
W21732     MOVE DP015-UNDERLINE          TO MR-SKUH  (PS-SUB)           22350000
254700                                      MR-UPCH  (PS-SUB)           22360000
254800                                      MR-QTYH  (PS-SUB).          22370000
254900     MOVE DP015-PRO-NOR-OFF        TO MR-PRCEA (PS-SUB).          22380000
255000     MOVE DP015-BLUE               TO MR-PRCEC (PS-SUB).          22390000
255100     MOVE DP015-HL-OFF             TO MR-PRCEH (PS-SUB).          22400000
255200                                                                  22410000
255300                                                                  22420000
255400*----------------------------------------------------------------*22430000
255500*    CURRENT SYSTEM DATE/TIME MODULE                              22440000
255600*----------------------------------------------------------------*22450000
255700                                                                  22460000
255800     COPY DPPD017.                                                22470000
255900                                                                  22480000
256000*----------------------------------------------------------------*22490000
256100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22500000
256200*----------------------------------------------------------------*22510000
256300                                                                  22520000
256400 9100-READ-SEL-QUEUE.                                             22530000
256500     EXEC CICS                                                    22540000
256600         READQ TS                                                 22550000
256700             QUEUE (ASC-SEL-QUEUE-NAME)                           22560000
256800             INTO  (IN022-SHEET-SEL-REC)                          22570000
256900             ITEM  (ASC-SEL-ITEM)                                 22580000
257000             RESP  (PV-CICS-RESP)                                 22590000
257100     END-EXEC.                                                    22600000
257200                                                                  22610000
257300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22620000
257400         CONTINUE                                                 22630000
257500     ELSE                                                         22640000
257600         SET DP013-LOGIC-ABEND                                    22650000
257700             DP013-NO-ROLLBACK     TO TRUE                        22660000
257800         MOVE '9100-READ-SEL-QUEUE'                               22670000
257900                                   TO DP013-PARAGRAPH             22680000
258000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   22690000
258100                                   TO DP013-MESSAGE-TEXT (1)      22700000
258200         PERFORM DP013-0000-PROCESS-ABEND                         22710000
258300     END-IF.                                                      22720000
258400*----------------------------------------------------------------*22730000
258500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22740000
258600*----------------------------------------------------------------*22750000
258700 9200-REWRITE-SEL-QUEUE.                                          22760000
258800     EXEC CICS                                                    22770000
258900          WRITEQ TS                                               22780000
259000              QUEUE  (ASC-SEL-QUEUE-NAME)                         22790000
259100              FROM   (IN022-SHEET-SEL-REC)                        22800000
259200              ITEM   (ASC-SEL-ITEM)                               22810000
259300              RESP   (PV-CICS-RESP)                               22820000
259400              REWRITE                                             22830000
259500     END-EXEC.                                                    22840000
259600                                                                  22850000
259700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   22860000
259800         SET DP013-CICS-ABEND                                     22870000
259900             DP013-NO-ROLLBACK     TO TRUE                        22880000
260000         MOVE '9200-REWRITE-SEL-QUEUE'                            22890000
260100                                   TO DP013-PARAGRAPH             22900000
260200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   22910000
260300                                   TO DP013-MESSAGE-TEXT (1)      22920000
260400         PERFORM DP013-0000-PROCESS-ABEND                         22930000
260500     END-IF.                                                      22940000
260600                                                                  22950000
260700 EJECT                                                            22960000
W28545*----------------------------------------------------------------*22970014
W28545*    PRICE LOOK-UP PROCEDURE DIVISION COPYBOOK                    22980014
W28545*----------------------------------------------------------------*22990014
W28545                                                                  23000014
W28545     COPY INPD400.                                                23010014
W28545                                                                  23020014
W28545 EJECT                                                            23030014
260800*----------------------------------------------------------------*23040000
260900*    ABEND PROCESSOR MODULE                                      *23050000
261000*----------------------------------------------------------------*23060000
261100                                                                  23070000
261200     COPY DPPD013.                                                23080000
