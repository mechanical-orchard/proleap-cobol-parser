      ***************************************************************** 00010000
       IDENTIFICATION DIVISION.                                         00020000
      ***************************************************************** 00030000
                                                                        00040000
       PROGRAM-ID.             TCKUT004.                                00050000
       AUTHOR.                 J MYERS.                                 00060000
       INSTALLATION.           KOHLS.                                   00070000
       DATE-WRITTEN            03/2002.                                 00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ***************************************************************** 00110000
      *  PURPOSE:                                                       00120000
      *  CREATE A FLAT FILE OF DAILY DEBIT INFORMATION FROM COSA TABLES 00130000
      *  TO BE USED LATER TO MATCH THE RAW DATA FILE FOR CREATING A     00140000
      *  REPORT OF DIFFERENCES.                                         00150000
      ***************************************************************** 00161026
W3540C* REQUIREMENT   : PAYMENT RELATED CHANGES FOR FSH PROJECT         00162013
W3540C* PROJECT ID    : W3540C                                          00163013
W3540C* AUTHOR        : COGNIZANT                                       00164013
W3540C* DATES CHANGED : 15-OCT-2012                                     00165013
W3540C* CHANGES MADE  : THE COSA-CURSOR IS MODIFIED TO FILTER THE       00166015
W3540C*                 RECORDS FOR THE PAST 14 DAYS FROM THE CONTROL   00167022
W3540C*                 CARD DATE IN ADDITION TO THE EXISITNG CONDITIONS00169022
W3540C******************************************************************00169126
W3540C*                                                                 00169228
W10849* REQUIREMENT   : MATCHING THE 4 DIGIT OF THE DEBIT CARD          00169332
W10849* PROJECT ID    : CHG0139454                                      00169434
W10849* AUTHOR        : ACCENTURE                                       00169532
W10849* DATES CHANGED : 05/18/2016                                      00169634
W10849* CHANGES MADE  : THE COSA-CRSOR IS MODIFIED TO REMOVE THE TNDR-ID00169733
W10849*                 WS-ADJ-CARD-NBR AND WS-MAF-CARD-NBR ARE CHANGED 00169832
W10849*                 TO STORE LAST 4 DIGIT.                          00169932
W10849*                 PV-CARD-NBR-RJ IS DECLARED TO STORE THE CARD#.  00170032
W10849*                 2000-READ-ADJ-FILE AND 3000-READ-MAF-FILE PARA  00170132
W10849*                 ARE CHANGED TO MOVE THE LAST 4 DIGIT TO THE KEYS00170232
W10849*                 REVEL WILL BE SENDING THE LAST 4 DIGITS OF CARD.00170341
052623******************************************************************00170444
052623* REQUIREMENT   : FIX UPDATE FILE LENGTH TO BE 100 BYTES          00170544
052623* PROJECT ID    : CHG0289075                                      00170644
052623* AUTHOR        : ACCENTURE                                       00170744
052623* DATES CHANGED : 05/26/2023                                      00170844
052623* CHANGES MADE  : UPDATE FILE LENGTH TO 100 BYTES                 00170944
      ******************************************************************00171044
       ENVIRONMENT DIVISION.                                            00172032
      ***************************************************************** 00180000
                                                                        00190000
       CONFIGURATION SECTION.                                           00200000
                                                                        00210000
       SOURCE-COMPUTER.        IBM-3090.                                00220000
                                                                        00230000
       OBJECT-COMPUTER.        IBM-3090.                                00240000
                                                                        00250000
       INPUT-OUTPUT SECTION.                                            00260000
                                                                        00270000
       FILE-CONTROL.                                                    00280000
                                                                        00290000
           SELECT CONTROL-DATE-FILE                                     00300000
               ASSIGN TO INP01.                                         00310000
                                                                        00320000
           SELECT ADJ-INPUT-FILE                                        00320100
               ASSIGN TO INP02.                                         00320200
                                                                        00320300
           SELECT MAF-INPUT-FILE                                        00320400
               ASSIGN TO INP03.                                         00320500
                                                                        00320600
           SELECT UPDATE-EXTRACT-FILE                                   00320700
               ASSIGN TO OUT01.                                         00320800
                                                                        00320900
           SELECT MAF-EXTRACT-FILE                                      00321000
               ASSIGN TO OUT02.                                         00322000
                                                                        00323000
           SELECT ADJ-ERROR-REPORT                                      00324000
               ASSIGN TO RPT01.                                         00325000
                                                                        00326000
      ******************************************************************00327000
       DATA DIVISION.                                                   00328000
      ******************************************************************00329000
                                                                        00330000
       FILE SECTION.                                                    00340000
                                                                        00350000
       FD  CONTROL-DATE-FILE                                            00360000
           RECORDING MODE IS F                                          00370000
           BLOCK CONTAINS 0 RECORDS                                     00380000
           LABEL RECORDS ARE OMITTED.                                   00390000
                                                                        00400000
       01  CONTROL-DATE-RECORD         PIC X(80).                       00410000
                                                                        00420000
       FD  ADJ-INPUT-FILE                                               00430000
           RECORDING MODE IS F                                          00440000
           BLOCK CONTAINS 0 RECORDS.                                    00450000
                                                                        00460000
       01  ADJ-INPUT-RECORD            PIC X(258).                      00470000
                                                                        00480000
       FD  MAF-INPUT-FILE                                               00490000
           RECORDING MODE IS F                                          00491000
           BLOCK CONTAINS 0 RECORDS.                                    00492000
                                                                        00493000
       01  MAF-INPUT-RECORD            PIC X(80).                       00494000
                                                                        00495000
       FD  UPDATE-EXTRACT-FILE                                          00496000
           RECORDING MODE IS F                                          00497000
           LABEL RECORDS ARE STANDARD                                   00498000
           BLOCK CONTAINS 0 RECORDS                                     00499000
052623     RECORD CONTAINS 100 CHARACTERS.                              00500044
                                                                        00510000
052623 01  UPDATE-EXTRACT-RECORD         PIC X(100).                    00520044
                                                                        00530000
       FD  MAF-EXTRACT-FILE                                             00540000
           RECORDING MODE IS F                                          00550000
           LABEL RECORDS ARE STANDARD                                   00560000
           BLOCK CONTAINS 0 RECORDS                                     00570000
           RECORD CONTAINS  80 CHARACTERS.                              00571000
                                                                        00572000
       01  MAF-EXTRACT-RECORD            PIC X(80).                     00573000
                                                                        00574000
       FD  ADJ-ERROR-REPORT                                             00575000
           RECORDING MODE IS F                                          00576000
           BLOCK CONTAINS 0 RECORDS.                                    00577000
                                                                        00578000
       01  ADJ-ERROR-REPORT-RECORD       PIC X(132).                    00579000
                                                                        00580000
      ******************************************************************00590000
       WORKING-STORAGE SECTION.                                         00600000
      ******************************************************************00610000
       01  FILLER                            PIC X(50)  VALUE           00620000
           ' *** WORKING STORAGE STARTS HERE FOR TCKUT004 *** '.        00630000
                                                                        00640000
      ******************************************************************00650000
      * RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                   *00660000
      ******************************************************************00670000
       01  CC-CONTROL-CARD.                                             00680017
           05  CC-CONTROL-CARD-DISPLAY.                                 00690000
               10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        00700000
                   88  CC-VALID-CONTROL-NAME        VALUE               00710000
                      'P.O.S. DATE = '.                                 00720000
               10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         00730000
          05  FILLER                  PIC X(60)    VALUE SPACE.         00740000
                                                                        00750000
      ******************************************************************00760000
      *  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)            *00770000
      ******************************************************************00780000
           COPY DPWS500.                                                00790000
                                                                        00800000
       01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     00810000
                                                        COMP SYNC.      00820000
           88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00830000
           88  AC-DB2-ERROR                             VALUE +4013.    00840000
           88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00850000
                                                                        00860000
        01  PS-PROGRAM-SWITCHES.                                        00870000
           05  PS-END-OF-CONTROL-FILE-SW     PIC X(01)  VALUE 'N'.      00880000
               88  PS-END-OF-CONTROL-FILE               VALUE 'Y'.      00890000
           05  PS-END-OF-ADJ-SW              PIC X(01)  VALUE 'N'.      00891000
               88  PS-NOT-END-OF-ADJ-FILE               VALUE 'N'.      00892000
               88  PS-END-OF-ADJ-FILE                   VALUE 'Y'.      00893000
           05  PS-END-OF-MAF-SW              PIC X(01)  VALUE 'N'.      00894000
               88  PS-NOT-END-OF-MAF-FILE               VALUE 'N'.      00895000
               88  PS-END-OF-MAF-FILE                   VALUE 'Y'.      00896000
                                                                        00897000
           05  PS-ROW-FOUND-ON-COSA          PIC X(01)  VALUE 'N'.      00898000
               88  NO-ROW-FOUND-ON-COSA                 VALUE 'N'.      00899000
               88  ROW-FOUND-ON-COSA                    VALUE 'Y'.      00900000
                                                                        00910000
W10849     05  PS-TNDR-MATCH-ON-COSA         PIC X(01)  VALUE 'N'.      00911040
W10849         88  NO-TNDR-MTCH-ON-COSA                 VALUE 'N'.      00912038
W10849         88  TNDR-MTCH-ON-COSA                    VALUE 'Y'.      00913038
                                                                        00914038
           05  PS-BANK-MATCH-SW              PIC X(01)  VALUE 'N'.      00920000
               88  BANK-NOT-MATCHED                     VALUE 'N'.      00930000
               88  BANK-MATCH                           VALUE 'Y'.      00931000
                                                                        00932000
      ******************************************************************00933000
      *   PROGRAM CONSTANTS                                            *00934000
      ******************************************************************00935000
       01  PC-CONSTANTS.                                                00936000
           05  PC-LINE-LIMIT                 PIC S9(04) VALUE +60.      00937000
           05  PC-ROW-NOT-FOUND              PIC S9(04) VALUE +100      00938000
                                                        COMP SYNC.      00939000
           05  PC-PROGRAM-NAME               PIC  X(08) VALUE           00940000
                                                       'TCKUT004'.      00950000
           05  PC-REPORT-NBR-1             PIC 9(01)     VALUE 1.       00960000
                                                                        00970000
       01  PV-TC03-MAF-DATA.                                            00980000
           05  PV-T3-STORE-NBR         PIC  9(04).                      00990000
           05  PV-T3-REG-NBR           PIC  9(04).                      00991000
           05  PV-T3-TRAN-NBR          PIC  9(04).                      00992000
           05  PV-T3-SLS-DTE           PIC  X(08).                      00993000
           05  PV-T3-STRT-TM           PIC  X(6).                       00994000
           05  PV-T3-TRAN-SEQ-NBR      PIC S9(04).                      00995000
           05  PV-T3-TRAN-TYPE         PIC  X(02).                      00996000
           05  PV-T3-TRAN-DISP         PIC  X(01).                      00997000
           05  PV-T3-CARD-NBR          PIC  X(19).                      00998000
           05  PV-T3-TRAN-AMT          PIC  S9(7)V99.                   00999000
           05  PV-T3-TYP-CDE           PIC  X(01).                      00999100
           05  PV-T3-ADJ-DISP          PIC  X(03).                      00999200
                                                                        00999300
       01  WS-ADJ-KEY.                                                  00999400
           05  WS-ADJ-DATE                   PIC X(06).                 00999500
           05  WS-ADJ-STORE-NBR              PIC X(04).                 00999600
           05  WS-ADJ-REG-NBR                PIC X(04).                 00999700
           05  WS-ADJ-TRAN-NBR               PIC X(04).                 00999800
W10849     05  WS-ADJ-CARD-NBR-LAST4         PIC X(04).                 01000030
                                                                        01000100
       01  WS-MAF-KEY.                                                  01001000
           05  WS-MAF-DATE                   PIC X(06).                 01001100
           05  WS-MAF-STORE-NBR              PIC X(04).                 01001200
           05  WS-MAF-REG-NBR                PIC X(04).                 01001300
           05  WS-MAF-TRAN-NBR               PIC X(04).                 01001400
W10849     05  WS-MAF-CARD-NBR-LAST4         PIC X(04).                 01001630
                                                                        01001700
       01  WS-TEMP-FIELDS.                                              01001800
           05  WS-ADJ-AMT                    PIC S9(07)V99.             01001901
           05  WS-ADJ-AMT1                   PIC S9(07)V99.             01002001
           05  WS-DIFFERENCE                 PIC S9(07)V99.             01002101
           05  WS-BANK-TRAN-AMT              PIC S9(07)V99.             01002201
           05  WS-TEMP-ADJ-AMT               PIC S9(07)V99.             01003000
           05  WS-COSA-TNDR-AMT              PIC S9(09)V99.             01003100
           05  WS-TEMP-TNDR-ID.                                         01003200
               10  WS-TEMP-CARD-NBR          PIC X(19).                 01003300
               10  WS-TEMP-FILLER            PIC X(14).                 01003400
           05  WS-TEMP-DATE-CCYYMMDD.                                   01003500
               10  WS-TEMP-FMT-CCYY.                                    01003600
                   15  WS-TEMP-FMT-CC        PIC X(02).                 01003700
                   15  WS-TEMP-FMT-YY        PIC X(02).                 01003800
               10  WS-TEMP-FMT-MM            PIC X(02).                 01003900
               10  WS-TEMP-FMT-DD            PIC X(02).                 01004000
           05  WS-DB2-FMT-DATE.                                         01005000
               10  WS-DB2-FMT-CCYY.                                     01006000
                   15  WS-DB2-FMT-CC         PIC X(02).                 01007000
                   15  WS-DB2-FMT-YY         PIC X(02).                 01008000
               10  WS-DB2-DASH               PIC X(01).                 01008100
               10  WS-DB2-FMT-MM             PIC X(02).                 01008200
               10  WS-DB2-DASH1              PIC X(01).                 01008300
               10  WS-DB2-FMT-DD             PIC X(02).                 01008400
           05  WS-FMT-DATE.                                             01008500
               10  WS-FMT-YY                 PIC X(02).                 01008600
               10  WS-FMT-MM                 PIC X(02).                 01008700
               10  WS-FMT-DD                 PIC X(02).                 01008800
           05  WS-TEMP-DATE.                                            01008900
               10  WS-TEMP-YY                PIC X(02).                 01009000
               10  WS-TEMP-MM                PIC X(02).                 01009100
               10  WS-TEMP-DD                PIC X(02).                 01009200
           05  WS-TEMP-ORIG-DATE.                                       01009300
               10  WS-TEMP-ORIG-MM           PIC X(02).                 01009400
               10  WS-SLASH1                 PIC X(01)    VALUE '/'.    01009500
               10  WS-TEMP-ORIG-DD           PIC X(02).                 01009600
               10  WS-SLASH2                 PIC X(01)    VALUE '/'.    01009700
               10  WS-TEMP-ORIG-CCYY.                                   01009800
                   15  WS-TEMP-ORIG-CC       PIC 9(02).                 01009900
                   15  WS-TEMP-ORIG-YY       PIC X(02).                 01010000
           05  WS-TEMP-TIME.                                            01010100
               10  WS-TEMP-TIME-HH           PIC X(02).                 01010200
               10  WS-TEMP-TIME-MM           PIC X(02).                 01010300
               10  WS-TEMP-TIME-SS           PIC X(02).                 01010400
           05  WS-TEMP-ORIG-TIME.                                       01010500
               10  WS-TEMP-TM-HH             PIC X(02).                 01010600
               10  WS-TEMP-COLON1            PIC X(01)     VALUE ':'.   01010700
               10  WS-TEMP-TM-MM             PIC X(02).                 01010800
               10  WS-TEMP-COLON2            PIC X(01)     VALUE ':'.   01010900
               10  WS-TEMP-TM-SS             PIC X(02).                 01011000
                                                                        01012000
       01  PV-PROGRAM-VARIABLES.                                        01013000
           05  PV-MISC-COUNT-FIELDS                         COMP-3.     01014000
                10  PV-LINE-CNT-1            PIC S9(05) VALUE ZERO.     01015000
                10  PV-PAGE-CNT-1            PIC S9(05) VALUE ZERO.     01016000
                10  PV-ERROR-CNT             PIC S9(05) VALUE ZERO.     01017000
           05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACE.    01018000
           05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.    01019000
           05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.    01020000
           05  PV-DB2-OPERATION              PIC  X(30) VALUE SPACE.    01030000
           05  PV-POS-CCYY-MM-DD             PIC  X(10).                01040000
           05  PV-STR-NBR                  PIC  S9(4) VALUE ZERO COMP.  01050000
           05  PV-RGST-ID                  PIC  S9(4) VALUE ZERO COMP.  01060000
           05  PV-TRN-NBR                  PIC  S9(4) VALUE ZERO COMP.  01070000
           05  PV-ORIG-CARD-NBR            PIC  X(19).                  01080000
           05  PV-ORIG-TRANS-AMT           PIC S9(08)V99 COMP-3.        01081012
           05  PV-STRT-TM.                                              01090000
               10   PV-STRT-HH             PIC  X(02).                  01100000
               10   PV-STRT-MM             PIC  X(02).                  01110000
               10   PV-STRT-SS             PIC  X(02).                  01120000
           05  PV-FMT-STRT-TM.                                          01130000
               10   PV-FMT-STRT-HH         PIC  X(02).                  01140000
               10   PV-FMT-COLON-1         PIC  X(01).                  01150000
               10   PV-FMT-STRT-MM         PIC  X(02).                  01160000
               10   PV-FMT-COLON-2         PIC  X(01).                  01170000
               10   PV-FMT-STRT-SS PIC  X(02).                          01180000
           05  PV-CARD-NUMBER.                                          01190006
               10  PV-SPACE-CARD-NUMBER    PIC  X(12)                   01191007
                                             VALUE 'XXXXXXXXXXXX'.      01191107
               10  PV-CARD-NBR             PIC  X(04) VALUE SPACE.      01192006
                                                                        01193006
W10849     05  PV-CARD-NBR-RJ      PIC X(19) JUST RIGHT.                01194030
W10849     05  PV-TNDR-ID-RJ       PIC X(19) JUST RIGHT.                01195038
      ******************************************************************01200000
      *   DATE AND TIME FIELDS.                                        *01210000
      ******************************************************************01220000
       01  PV-DATE-AND-TIME-FIELDS.                                     01230000
           05  PV-POS-MMDDYY.                                           01240000
               10  PV-POS-MM               PIC X(02).                   01250000
               10  PV-POS-DD               PIC X(02).                   01260000
               10  PV-POS-YY               PIC X(02).                   01270000
           05  PV-CURR-DATE-CCYYMMDD.                                   01280000
               10  PV-CURR-DATE-CCYY       PIC  9(04).                  01290000
               10  PV-CURR-DATE-MM         PIC  9(02).                  01300000
               10  PV-CURR-DATE-DD         PIC  9(02).                  01310000
           05  PV-CURR-TIME.                                            01311000
               10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01311100
               10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01311200
               10  PV-CURR-TIME-SS         PIC  9(02)    VALUE ZERO.    01311300
           05  PV-SPLIT-TIME.                                           01311400
               10  PV-SPLIT-TIME-HH        PIC  9(02)    VALUE ZERO.    01311500
               10  PV-SPLIT-TIME-MM        PIC  9(02)    VALUE ZERO.    01311600
               10  PV-SPLIT-TIME-SS        PIC  9(02)    VALUE ZERO.    01311700
           05  PV-SPLIT-TIME-S.                                         01311800
               10  PV-TIME-HH-S            PIC  9(02)    VALUE ZERO.    01311900
               10  FILLER                  PIC  X(01)    VALUE ':'.     01312000
               10  PV-TIME-MM-S            PIC  9(02)    VALUE ZERO.    01312100
               10  FILLER                  PIC  X(01)    VALUE ':'.     01312200
               10  PV-TIME-SS-S            PIC  9(02)    VALUE ZERO.    01312300
           05  PV-SPLIT-DATE.                                           01312400
               10  PV-CC-S                 PIC  9(02)    VALUE 20.      01312500
               10  PV-YY-S                 PIC  9(02)    VALUE ZERO.    01312600
               10  PV-S1                   PIC  X(01)    VALUE '-'.     01312700
               10  PV-MM-S                 PIC  9(02)    VALUE ZERO.    01312800
               10  PV-S2                   PIC  X(01)    VALUE '-'.     01312900
               10  PV-DD-S                 PIC  9(02)    VALUE ZERO.    01313000
           05  PV-DB2-DATE REDEFINES PV-SPLIT-DATE PIC X(10).           01313100
           05  PV-SPLIT-DATE-CCYYMMDD.                                  01313200
               10  PV-SPLIT-DATE-CCYY      PIC  9(04).                  01313300
               10  PV-SPLIT-DATE-MM        PIC  9(02).                  01313400
               10  PV-SPLIT-DATE-DD        PIC  9(02).                  01313500
           05  PV-MATCH-DATE-CCYYMMDD.                                  01313600
               10  PV-MATCH-DATE-CCYY      PIC  9(04).                  01313700
               10  PV-MATCH-DATE-MM        PIC  9(02).                  01313800
               10  PV-MATCH-DATE-DD        PIC  9(02).                  01313900
           05  PV-MDATE-MMDDCCYY.                                       01314000
               10  PV-MDATE-MM        PIC  9(02).                       01314100
               10  PV-MDATE-DD        PIC  9(02).                       01314200
               10  PV-MDATE-CCYY      PIC  9(04).                       01314300
           05  PV-SPLIT-MMDD.                                           01314400
               10  PV-MM                   PIC  9(02)    VALUE ZERO.    01314500
               10  PV-DD                   PIC  9(02)    VALUE ZERO.    01314600
           05  PV-SPLIT-CCYY.                                           01314700
               10  PV-CC                   PIC  9(02)    VALUE ZERO.    01314800
               10  PV-YY                   PIC  9(02)    VALUE ZERO.    01314900
           05  PV-SPLIT-DATE-1.                                         01315000
               10  PV-SPLIT-MM             PIC  9(02)    VALUE ZERO.    01315100
               10  PV-SLASH-1              PIC  X(01)    VALUE '/'.     01315200
               10  PV-SPLIT-DD             PIC  9(02)    VALUE ZERO.    01315300
               10  PV-SLASH-2              PIC  X(01)    VALUE '/'.     01315400
               10  PV-SPLIT-CC             PIC  9(02)    VALUE ZERO.    01315500
               10  PV-SPLIT-YY             PIC  9(02)    VALUE ZERO.    01315600
           05  PV-TRAN-DATE.                                            01315700
               10  PV-TRAN-MM              PIC  9(02)    VALUE ZERO.    01315800
               10  PV-SLASH-1              PIC  X(01)    VALUE '/'.     01315900
               10  PV-TRAN-DD              PIC  9(02)    VALUE ZERO.    01316000
               10  PV-SLASH-2              PIC  X(01)    VALUE '/'.     01316100
               10  PV-TRAN-CCYY            PIC  9(02)    VALUE ZERO.    01316200
                                                                        01316300
W3540C     05  PV-SLS-DTE-STRT             PIC  X(10)    VALUE SPACES.  01316416
W3540C     05  PV-SLS-DTE-END              PIC  X(10)    VALUE SPACES.  01316516
W3540C*                                                                 01316627
       01  PC-PROGRAM-CONSTANTS.                                        01316816
           05  PC-PERIOD                   PIC  X(01)    VALUE '.'.     01316916
                                                                        01317016
      ******************************************************************01317116
      *  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT. *01317216
      ******************************************************************01317316
           COPY DPWS132.                                                01317416
                                                                        01317516
       01  SPACE-LINE.                                                  01317616
           05  FILLER                      PIC  X(132)   VALUE SPACES.  01317716
                                                                        01317816
      ***************************************************************** 01317916
      *  MERCHANT ACTIVITY FILE                                         01318016
      ******************************************************************01318116
           COPY TCWS003.                                                01318216
                                                                        01318316
      ***************************************************************** 01318416
      *  ADJUSTMENT INPUT FILE                                          01319000
      ******************************************************************01320000
           COPY TCWS005.                                                01330006
                                                                        01340000
      ***************************************************************** 01350000
      *  UPDATE EXTRACT FILE LAYOUT                                     01360000
      ******************************************************************01361000
           COPY TCWS006.                                                01362006
                                                                        01363000
      ***************************************************************** 01364000
      *  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01365000
      ******************************************************************01366000
           COPY DPWS004.                                                01367006
                                                                        01368000
      ******************************************************************01369000
      *  DB2 COMMUNICATION AREA.                                        01370000
      ******************************************************************01380000
           EXEC SQL                                                     01390000
                INCLUDE SQLCA                                           01400000
           END-EXEC.                                                    01410000
                                                                        01420000
      ******************************************************************01430000
      *  DB2 TABLE DB2PDBA.TEPPART - PARTITION CONTROL TABLE            01440000
      ******************************************************************01450000
           EXEC SQL                                                     01460000
                INCLUDE TEPPART                                         01470000
           END-EXEC.                                                    01480000
                                                                        01490000
      ******************************************************************01500000
      *  DB2 TABLE DB2TDBA.TEPTND - TENDER TABLE                        01510000
      ******************************************************************01520000
           EXEC SQL                                                     01530000
                INCLUDE TEPTND                                          01540000
           END-EXEC.                                                    01550000
                                                                        01560000
      ******************************************************************01570000
      *  CREATE CURSOR COSA TABLE INFORMATION                           01580000
      ******************************************************************01590000
           EXEC SQL                                                     01600000
               DECLARE COSA-CURSOR  CURSOR                              01610000
               FOR SELECT TNDR_AMT                                      01620000
                    , STR_NBR                                           01630000
                    , RGST_ID                                           01640000
                    , TRN_NBR                                           01650000
                    , STRT_TM                                           01660000
                    , SLS_CORR_SEQ_NBR                                  01670000
                    , TNDR_SEQ_NBR                                      01671010
                    , SLS_DTE                                           01680000
W10849              , TNDR_ID                                           01690036
                 FROM TEPPART            PRT                            01700000
                    , TEPTND             TND                            01710000
                 WHERE TND.STR_NBR          = :PV-STR-NBR               01720000
                   AND TND.RGST_ID          = :PV-RGST-ID               01730000
                   AND TND.TRN_NBR          = :PV-TRN-NBR               01740000
W10849*            AND TND.TNDR_ID          = :PV-ORIG-CARD-NBR         01750030
                   AND TND.TNDR_AMT         = :PV-ORIG-TRANS-AMT        01751011
                   AND TND.PARTN_NBR        = PRT.PARTN_NBR             01760000
                   AND TND.TNDR_TYP_CDE     = '19'                      01761002
W3540C             AND PRT.SLS_DTE         >= :PV-SLS-DTE-STRT          01762021
W3540C             AND PRT.SLS_DTE         <= :PV-SLS-DTE-END           01763021
W10849             AND TNDR_VOID_IND        = 'N'                       01764036
                 ORDER BY SLS_CORR_SEQ_NBR                              01770002
                WITH UR                                                 01780000
           END-EXEC.                                                    01790000
                                                                        01800000
      ******************************************************************01810000
      *  HEADING LINES DEBIT EXCEPTION REPORT                          *01820000
      ******************************************************************01830000
       01  T1-TITLE-LINE-1.                                             01840000
           05  FILLER                      PIC  X(42)    VALUE SPACES.  01850000
           05  T1-TITLE                    PIC  X(38)    VALUE          01860000
               'DEBIT ADJUSTMENT EXCEPTION REPORT FOR '.                01870000
           05  T1-PROCESS-DTE              PIC  X(10)    VALUE SPACES.  01880000
           05  FILLER                      PIC  X(43)    VALUE SPACES.  01890000
                                                                        01900000
       01  SPACE-REPORT-LINE.                                           01910000
           05  FILLER                      PIC  X(132)   VALUE SPACES.  01920000
                                                                        01930000
       01  NO-ERRORS-LINE.                                              01940000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  01950000
           05  FILLER                      PIC  X(22)    VALUE          01960000
               'NO ERRORS FOR THIS RUN'.                                01970000
           05  FILLER                      PIC  X(106)   VALUE SPACES.  01980000
                                                                        01990000
       01  H1-COLUMN-HEADING-1.                                         02000000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  02010000
           05  FILLER                      PIC  X(05)    VALUE          02020000
               'STORE'.                                                 02030000
           05  FILLER                      PIC  X(03)    VALUE SPACES.  02040000
           05  FILLER                      PIC  X(03)    VALUE          02050000
               'REG'.                                                   02060000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  02070000
           05  FILLER                      PIC  X(04)    VALUE          02080000
               'TRAN'.                                                  02090000
           05  FILLER                      PIC  X(06)    VALUE SPACES.  02100000
           05  FILLER                      PIC  X(11)    VALUE          02110000
               'CARD NUMBER'.                                           02120000
           05  FILLER                      PIC  X(09)    VALUE SPACES.  02130000
           05  FILLER                      PIC  X(09)    VALUE          02140000
               'ORIG DATE'.                                             02150000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  02160000
           05  FILLER                      PIC  X(09)    VALUE          02170000
               'ORIG TIME'.                                             02180000
           05  FILLER                      PIC  X(05)    VALUE SPACES.  02190000
           05  FILLER                      PIC  X(13)    VALUE          02200000
               'BANK ORIG AMT'.                                         02210000
           05  FILLER                      PIC  X(07)    VALUE SPACES.  02220000
           05  FILLER                      PIC  X(12)    VALUE          02230000
               'ADJ BANK AMT'.                                          02240000
                                                                        02250000
      ******************************************************************02260000
      *  DETAIL LINE.                                                   02270000
      ******************************************************************02280000
       01  D1-DETAIL-LINE-1.                                            02290000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  02300000
           05  D1-STORE                    PIC  X(04).                  02310000
           05  FILLER                      PIC  X(03)    VALUE SPACES.  02320000
           05  D1-REG                      PIC  X(04).                  02330000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  02340000
           05  D1-TRAN                     PIC  X(04).                  02350000
           05  FILLER                      PIC  X(04)    VALUE SPACES.  02360000
           05  D1-CARD-NUMBER              PIC  X(16).                  02370000
           05  FILLER                      PIC  X(06)    VALUE SPACES.  02380000
           05  D1-ORIG-DATE                PIC  X(10).                  02390000
           05  FILLER                      PIC  X(03)    VALUE SPACES.  02400000
           05  D1-ORIG-TIME                PIC  X(08).                  02401000
           05  FILLER                      PIC  X(07)    VALUE SPACES.  02402000
           05  D1-BANK-ORIG-AMT            PIC  ZZZZZZZ9.99.            02403000
           05  FILLER                      PIC  X(09)    VALUE SPACES.  02404000
           05  D1-ADJ-AMT                  PIC  ZZZZZZZ.99-.            02405000
                                                                        02406000
       PROCEDURE DIVISION.                                              02407000
                                                                        02408000
      ******************************************************************02409000
      * 0000-MAINLINE-PARAGRAPH                                         02410000
      ******************************************************************02420000
       0000-MAINLINE-PARAGRAPH.                                         02430000
                                                                        02440000
           PERFORM 1000-INITIALIZE-PROGRAM.                             02450000
           PERFORM 2000-READ-ADJ-FILE.                                  02460000
           PERFORM 3000-READ-MAF-FILE.                                  02470000
                                                                        02480000
           PERFORM 4000-PROCESS                                         02490000
                 UNTIL PS-END-OF-ADJ-FILE AND PS-END-OF-MAF-FILE.       02500000
                                                                        02510000
           IF PV-ERROR-CNT   = 0                                        02520000
               WRITE ADJ-ERROR-REPORT-RECORD FROM NO-ERRORS-LINE        02530000
               AFTER ADVANCING +5 LINES                                 02540000
           END-IF.                                                      02550000
                                                                        02560000
           CLOSE CONTROL-DATE-FILE                                      02570000
                 ADJ-INPUT-FILE                                         02580000
                 MAF-INPUT-FILE                                         02590000
                 MAF-EXTRACT-FILE                                       02600000
                 ADJ-ERROR-REPORT                                       02610000
                 UPDATE-EXTRACT-FILE.                                   02620000
                                                                        02630000
           GOBACK.                                                      02640000
                                                                        02650000
      ******************************************************************02660000
      * 1000-INITIALIZE-PROGRAM                                         02670000
      *     OPEN FILES, PROCESS CONTROL CARD                            02680000
      ******************************************************************02690000
       1000-INITIALIZE-PROGRAM.                                         02700000
                                                                        02710000
           OPEN INPUT  CONTROL-DATE-FILE                                02720000
                       ADJ-INPUT-FILE                                   02730000
                       MAF-INPUT-FILE                                   02740000
                OUTPUT MAF-EXTRACT-FILE                                 02750000
                       UPDATE-EXTRACT-FILE                              02760000
                       ADJ-ERROR-REPORT.                                02770000
                                                                        02780000
           READ CONTROL-DATE-FILE INTO CC-CONTROL-CARD                  02790000
              AT END                                                    02800000
                 SET PS-END-OF-CONTROL-FILE TO TRUE.                    02810000
                                                                        02820000
           IF PS-END-OF-CONTROL-FILE                                    02830000
              DISPLAY 'DATE CARD MISSING '                              02840000
              MOVE '1000-INITIALIZE-PROGRAM ' TO PV-PARAGRAPH-NAME      02850000
              SET AC-CONTROL-CARD-ERROR TO TRUE                         02860000
              PERFORM 9999-ABEND                                        02870000
           ELSE                                                         02880000
              DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                02890000
                   CC-POS-DATE-MMDDYY                                   02900000
              MOVE CC-POS-DATE-MMDDYY TO PV-POS-MMDDYY                  02910000
              MOVE 20              TO PV-SPLIT-CC                       02920000
              MOVE PV-POS-YY       TO PV-SPLIT-YY                       02930000
              MOVE PV-POS-MM       TO PV-SPLIT-MM                       02940000
              MOVE PV-POS-DD       TO PV-SPLIT-DD                       02950000
              MOVE PV-SPLIT-DATE-1 TO T1-PROCESS-DTE                    02960000
           END-IF.                                                      02970000
                                                                        02980000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02990000
                                                                        03000000
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   03010000
           SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   03020000
           SET  DPG52-LK-DTE-GREG            TO TRUE.                   03030000
           MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    03040000
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03050000
                                                   DPG54 DPG55 DPG56.   03060000
           EVALUATE TRUE                                                03070000
               WHEN DPG54-SEVERE-ERROR                                  03080000
               WHEN DPG54-DATE-INVALID                                  03090000
                   MOVE '1000-PROCESS-DATE-CARD'                        03100000
                                                 TO PV-PARAGRAPH-NAME   03110000
                   MOVE 'ERROR CONVERTING INPUT CARD DATE'              03120000
                                                 TO PV-OPERATION-MSG-1  03130000
                   SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                03140000
                   MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  03150000
                   PERFORM 9999-ABEND                                   03160000
           END-EVALUATE.                                                03170000
                                                                        03180000
           MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      03190000
W3540C     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-SLS-DTE-END.         03191016
W3540C*                                                                 03200027
W3540C     INITIALIZE DPG51 DPG52 DPG53                                 03201018
W3540C                DPG54 DPG55 DPG56.                                03202018
W3540C                                                                  03203018
W3540C     SET DPG51-DECREMENT-DATE       TO TRUE.                      03204018
W3540C     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      03205018
W3540C     SET DPG52-LK-DTE-GREG          TO TRUE.                      03206018
W3540C                                                                  03207018
W3540C     MOVE 14                        TO DPG51-INCR-DECR-DAYS-9.    03208018
W3540C     MOVE ZEROES                    TO DPG51-INCR-DECR-BUS-DAYS-9.03209018
W3540C                                                                  03209118
W3540C     MOVE CC-POS-DATE-MMDDYY        TO DPG52-LK-DATE-INPUT.       03209218
W3540C                                                                  03209318
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                03209418
W3540C                                             DPG52                03209518
W3540C                                             DPG53                03209618
W3540C                                             DPG54                03209718
W3540C                                             DPG55                03209818
W3540C                                             DPG56.               03209918
W3540C                                                                  03210018
W3540C     EVALUATE TRUE                                                03210119
W3540C         WHEN DPG54-SEVERE-ERROR                                  03210219
W3540C         WHEN DPG54-DATE-INVALID                                  03210319
W3540C             MOVE '1000-PROCESS-DATE-CARD'                        03210419
W3540C                                           TO PV-PARAGRAPH-NAME   03210519
W3540C             MOVE 'ERROR IN DECREMENTING 14 DAYS FROM INPUT DATE' 03210619
W3540C                                           TO PV-OPERATION-MSG-1  03210719
W3540C             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                03210819
W3540C             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  03210919
W3540C             PERFORM 9999-ABEND                                   03211019
W3540C     END-EVALUATE.                                                03211119
W3540C                                                                  03212819
W3540C     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-SLS-DTE-STRT.           03212919
W3540C                                                                  03213029
W3540C     DISPLAY 'PV-SLS-START-DATE ' PV-SLS-DTE-STRT.                03213129
W3540C     DISPLAY 'PV-SLS-END-DATE '   PV-SLS-DTE-END.                 03213229
                                                                        03213329
           PERFORM 1400-FORMAT-HEADINGS.                                03213429
                                                                        03213529
      ******************************************************************03213629
      * 1400-FORMAT-HEADINGS                                            03213729
      *     GET CURRENT DATE AND TIME FROM SYSTEM.                      03214000
      *     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          03215000
      *     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              03216000
      ******************************************************************03217000
       1400-FORMAT-HEADINGS.                                            03218000
                                                                        03219000
           MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   03219100
           ACCEPT PV-CURR-TIME FROM TIME.                               03219200
                                                                        03219300
           MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         03219400
           MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           03219500
           MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          03219600
                                                                        03219700
           MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          03219800
           MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        03219900
           MOVE PC-PROGRAM-NAME             TO DP132-PROGRAM-NAME.      03220000
           MOVE PC-REPORT-NBR-1             TO DP132-REPORT-NUMBER.     03220100
                                                                        03220200
           PERFORM 1450-WRITE-REPORT-HEADINGS.                          03220300
                                                                        03220400
      ******************************************************************03220500
      * 1450-WRITE-REPORT-HEADINGS                                      03220600
      *     WRITE REPORT HEADING AND TITLE LINES.                       03220700
      ******************************************************************03220800
        1450-WRITE-REPORT-HEADINGS.                                     03220900
                                                                        03221000
            MOVE +5 TO PV-LINE-CNT-1.                                   03221100
            ADD  +1 TO PV-PAGE-CNT-1.                                   03221200
                                                                        03221300
            MOVE PV-PAGE-CNT-1 TO DP132-PAGE-NUMBER.                    03221400
                                                                        03221500
            WRITE ADJ-ERROR-REPORT-RECORD                               03221600
             FROM DP132-STANDRD-HEADER-132-COLS                         03221700
             AFTER ADVANCING PAGE.                                      03221800
                                                                        03221900
            WRITE ADJ-ERROR-REPORT-RECORD                               03222000
             FROM T1-TITLE-LINE-1                                       03222100
             AFTER ADVANCING 1 LINE.                                    03222200
                                                                        03222300
            WRITE ADJ-ERROR-REPORT-RECORD                               03222400
             FROM  H1-COLUMN-HEADING-1                                  03222500
             AFTER ADVANCING 2 LINE.                                    03222600
                                                                        03222700
            WRITE ADJ-ERROR-REPORT-RECORD                               03222800
             FROM  SPACE-REPORT-LINE                                    03222900
             AFTER ADVANCING 1 LINE.                                    03223000
                                                                        03223100
      ******************************************************************03223200
      * 2000-READ-INPUT-FILE                                            03223300
      *     READ THE ADJUSTMENT INPUT FILE                              03223400
      ******************************************************************03223500
       2000-READ-ADJ-FILE.                                              03223600
                                                                        03223700
           READ ADJ-INPUT-FILE  INTO TC005-ADJUSTMENT-FILE              03223800
               AT END                                                   03223900
                   SET PS-END-OF-ADJ-FILE TO TRUE                       03224000
           END-READ.                                                    03224100
                                                                        03224200
           IF  PS-END-OF-ADJ-FILE                                       03224300
               MOVE HIGH-VALUES        TO WS-ADJ-KEY                    03224400
           ELSE                                                         03224500
               MOVE TC005-STORE-NUMBER TO WS-ADJ-STORE-NBR              03224600
               MOVE TC005-REG-NBR      TO WS-ADJ-REG-NBR                03224700
               MOVE TC005-TRAN-NBR     TO WS-ADJ-TRAN-NBR               03224800
               MOVE TC005-ORIG-TRAN-DTE                                 03224900
                                       TO WS-ADJ-DATE                   03225000
W10849*        MOVE TC005-ORIG-CARD-NBR                                 03225130
W10849*                                TO WS-ADJ-CARD-NBR               03225230
W10849         MOVE TC005-ORIG-CARD-NBR                                 03225330
W10849                                 TO PV-CARD-NBR-RJ                03225430
W10849         MOVE PV-CARD-NBR-RJ(16:4)                                03225530
W10849                                 TO WS-ADJ-CARD-NBR-LAST4         03225630
           END-IF.                                                      03225730
                                                                        03225830
      ******************************************************************03225930
      * 3000-READ-MAF-FILE                                              03226030
      *     READ THE MERCHANT ACTIVITY FILE                             03226130
      ******************************************************************03226230
       3000-READ-MAF-FILE.                                              03226330
                                                                        03226430
           READ  MAF-INPUT-FILE INTO TC003-MAF-DATA                     03227000
               AT END                                                   03228000
                   SET PS-END-OF-MAF-FILE TO TRUE                       03229000
           END-READ.                                                    03230000
                                                                        03240000
           IF  PS-END-OF-MAF-FILE                                       03250000
               MOVE HIGH-VALUES        TO WS-MAF-KEY                    03251000
           ELSE                                                         03252000
               MOVE TC003-STORE-NBR    TO WS-MAF-STORE-NBR              03253000
               MOVE TC003-REG-NBR      TO WS-MAF-REG-NBR                03254000
               MOVE TC003-TRAN-NBR     TO WS-MAF-TRAN-NBR               03255000
               MOVE TC003-SLS-DTE      TO WS-TEMP-DATE-CCYYMMDD         03256000
               MOVE WS-TEMP-FMT-YY     TO WS-FMT-YY                     03257000
               MOVE WS-TEMP-FMT-MM     TO WS-FMT-MM                     03258000
               MOVE WS-TEMP-FMT-DD     TO WS-FMT-DD                     03259000
               MOVE WS-FMT-DATE        TO WS-MAF-DATE                   03260000
W10849*        MOVE TC003-CARD-NBR     TO WS-MAF-CARD-NBR               03261031
W10849         MOVE TC003-CARD-NBR     TO PV-CARD-NBR-RJ                03261131
W10849         MOVE PV-CARD-NBR-RJ(16:4) TO WS-MAF-CARD-NBR-LAST4       03261231
           END-IF.                                                      03262000
                                                                        03263000
      ***************************************************************** 03264000
      * 4000-PROCESS                                                    03265000
      *      MATCH PROCESS OF THE ADJ AND MAF FILES                     03266000
      *      KEYS ARE                                                   03267000
      *      WS-ADJ-STORE-NBR            WS-MAF-STORE-NBR               03268000
      *      WS-ADJ-REG-NBR              WS-MAF-REG-NBR                 03269000
      *      WS-ADJ-TRAN-NBR             WS-MAF-TRAN-NBR                03270000
      *      WS-ADJ-DATE                 WS-MAF-DATE                    03280000
      *      WS-ADJ-CARD-NBR             WS-MAF-CARD-NBR                03290000
      ***************************************************************** 03300000
        4000-PROCESS.                                                   03310000
                                                                        03320000
           INITIALIZE TC006-DATA.                                       03450000
           SET BANK-MATCH      TO TRUE.                                 03460000
                                                                        03470000
           IF WS-ADJ-KEY    =  WS-MAF-KEY                               03480000
               PERFORM 5000-MATCH-PROCESS                               03490000
               PERFORM 2000-READ-ADJ-FILE                               03500000
               PERFORM 3000-READ-MAF-FILE                               03510000
           ELSE                                                         03520000
               IF WS-ADJ-KEY   <  WS-MAF-KEY                            03530000
                   PERFORM 6000-NO-MATCH-TO-MAF                         03540000
                   PERFORM 2000-READ-ADJ-FILE                           03550000
               ELSE                                                     03560000
                   PERFORM 7000-NO-MATCH-TO-ADJ                         03570000
                   PERFORM 3000-READ-MAF-FILE                           03580000
               END-IF                                                   03590000
           END-IF.                                                      03600000
                                                                        03610000
      ***************************************************************** 03620000
      * 5000-MATCH-PROCESS                                              03630000
      *      PROCESS WHEN MATCHED ON KEYS.                              03640000
      *      CHECK TO SEE IF THE ADJUSTMENT IS FOR THE CORRECT AMOUNT   03650005
      *         BY READING THE COSA RECORD.  IF THE COSA RECORD DOES    03651004
      *         NOT EXIST, THEN THE ADJUSTMENT WAS MEANT TO BACK OUT    03652004
      *         THE MAF RECORD.  THE CUSTOMER DID NOT RECEIVE THE GOODS.03653004
      *      IF THE ADJUSTMENT IS NOT FOR THE CORRECT AMOUNT OF MONEY   03660004
      *         WRITE AN UPDATE RECORD AND CREATE AN ERROR LINE.        03661005
      ***************************************************************** 03680000
      **  MULTIPLY THE TC003 TRAN AMT BY -1 TO SET THE SIGN          ** 03690000
      ***************************************************************** 03700000
       5000-MATCH-PROCESS.                                              03710000
                                                                        03720000
           PERFORM 6100-SELECT-COSA-TABLES.                             03730000
                                                                        03740000
           IF  ROW-FOUND-ON-COSA                                        03750000
               COMPUTE WS-ADJ-AMT = (EPTND-TNDR-AMT  - TC005-ADJUST-AMT)03760000
               COMPUTE WS-ADJ-AMT1 = (EPTND-TNDR-AMT  -                 03761001
                                      TC005-ORIG-TRANS-AMT)             03762001
               IF WS-ADJ-AMT    =  0.00  OR                             03762101
                  WS-ADJ-AMT1   =  0.00                                 03762201
                   MOVE TC005-STORE-NUMBER TO TC006-STR-NBR             03780000
                   MOVE TC005-REG-NBR      TO TC006-RGST-ID             03790000
                   MOVE TC005-TRAN-NBR     TO TC006-TRN-NBR             03800000
                   MOVE TC003-STRT-TM      TO PV-STRT-TM                03810000
                   MOVE PV-STRT-HH         TO PV-FMT-STRT-HH            03820000
                   MOVE PV-STRT-MM         TO PV-FMT-STRT-MM            03830000
                   MOVE PV-STRT-SS         TO PV-FMT-STRT-SS            03840000
                   MOVE PC-PERIOD          TO PV-FMT-COLON-1            03850000
                   MOVE PC-PERIOD          TO PV-FMT-COLON-2            03860000
                   MOVE PV-FMT-STRT-TM     TO TC006-STRT-TIME           03870000
                   MOVE TC003-TRAN-SEQ-NBR TO TC006-SLS-CORR-SEQ-NBR    03880000
                   MOVE TC003-SLS-DTE      TO WS-TEMP-DATE-CCYYMMDD     03890000
                   MOVE WS-TEMP-FMT-CCYY   TO  WS-DB2-FMT-CCYY          03900000
                   MOVE '-'                TO  WS-DB2-DASH              03910000
                   MOVE WS-TEMP-FMT-MM     TO  WS-DB2-FMT-MM            03920000
                   MOVE '-'                TO  WS-DB2-DASH1             03930000
                   MOVE WS-TEMP-FMT-DD     TO  WS-DB2-FMT-DD            03940000
                   MOVE WS-DB2-FMT-DATE    TO TC006-SLS-DTE             03950000
                   MOVE TC003-CARD-NBR     TO TC006-CARD-NBR            03960031
                   MOVE EPTND-TNDR-SEQ-NBR TO TC006-TNDR-SEQ-NBR        03961010
                   PERFORM 5100-WRITE-UPDATE-EXTRACT-REC                03970000
               ELSE                                                     03980000
                   PERFORM 8000-WRITE-ERROR-LINE                        03990000
                   PERFORM 7000-NO-MATCH-TO-ADJ                         04000000
           ELSE                                                         04010000
               MOVE TC005-STORE-NUMBER TO TC006-STR-NBR                 04011004
               MOVE TC005-REG-NBR      TO TC006-RGST-ID                 04012004
               MOVE TC005-TRAN-NBR     TO TC006-TRN-NBR                 04013004
               MOVE TC003-STRT-TM      TO PV-STRT-TM                    04014004
               MOVE PV-STRT-HH         TO PV-FMT-STRT-HH                04015004
               MOVE PV-STRT-MM         TO PV-FMT-STRT-MM                04016004
               MOVE PV-STRT-SS         TO PV-FMT-STRT-SS                04017004
               MOVE PC-PERIOD          TO PV-FMT-COLON-1                04018004
               MOVE PC-PERIOD          TO PV-FMT-COLON-2                04019004
               MOVE PV-FMT-STRT-TM     TO TC006-STRT-TIME               04019104
               MOVE TC003-TRAN-SEQ-NBR TO TC006-SLS-CORR-SEQ-NBR        04019204
               MOVE TC003-SLS-DTE      TO WS-TEMP-DATE-CCYYMMDD         04019304
               MOVE WS-TEMP-FMT-CCYY   TO  WS-DB2-FMT-CCYY              04019404
               MOVE '-'                TO  WS-DB2-DASH                  04019504
               MOVE WS-TEMP-FMT-MM     TO  WS-DB2-FMT-MM                04019604
               MOVE '-'                TO  WS-DB2-DASH1                 04019704
               MOVE WS-TEMP-FMT-DD     TO  WS-DB2-FMT-DD                04019804
               MOVE WS-DB2-FMT-DATE    TO TC006-SLS-DTE                 04019904
               MOVE TC003-CARD-NBR     TO TC006-CARD-NBR                04020004
               MOVE ZEROES             TO TC006-TNDR-SEQ-NBR            04020110
               PERFORM 5100-WRITE-UPDATE-EXTRACT-REC                    04020204
           END-IF.                                                      04040000
                                                                        04050000
      ***************************************************************** 04060000
      *  5100-WRITE-UPDATE-EXTRACT-RECORD                               04070000
      *      WRITE AN UPDATE EXTRACT RECORD                             04080000
      ***************************************************************** 04090000
       5100-WRITE-UPDATE-EXTRACT-REC.                                   04100000
                                                                        04110000
           WRITE UPDATE-EXTRACT-RECORD FROM TC006-DATA.                 04120000
                                                                        04130000
      ***************************************************************** 04140000
      * 6000-NO-MATCH-TO-MAF                                            04150000
      *      PROCESS WHEN THERE IS AN ADJUSTMENT RECORD AND NO ACTIVITY 04160000
      *      RECORD                                                     04170000
      *      CHECK TO SEE IF ROW EXISTS ON COSA TABLE                   04180000
      *      IF ROW EXISTS THEN CHECK THAT ADJ AMT IS CORRECT           04190000
      ***************************************************************** 04200000
       6000-NO-MATCH-TO-MAF.                                            04210000
                                                                        04220000
           PERFORM 6100-SELECT-COSA-TABLES.                             04230000
           SET BANK-NOT-MATCHED        TO TRUE.                         04240000
                                                                        04250000
           IF  ROW-FOUND-ON-COSA                                        04260000
               COMPUTE WS-ADJ-AMT = (EPTND-TNDR-AMT  - TC005-ADJUST-AMT)04270000
               COMPUTE WS-ADJ-AMT1 = (EPTND-TNDR-AMT  -                 04280001
                                      TC005-ORIG-TRANS-AMT)             04281001
               IF WS-ADJ-AMT    =  0.00  OR                             04282001
                  WS-ADJ-AMT1   =  0.00                                 04283001
                   MOVE TC005-STORE-NUMBER                              04290000
                                       TO TC006-STR-NBR                 04300000
                   MOVE TC005-REG-NBR  TO TC006-RGST-ID                 04310000
                   MOVE TC005-TRAN-NBR TO TC006-TRN-NBR                 04320000
                   MOVE EPTND-STRT-TM  TO TC006-STRT-TIME               04330000
                   MOVE EPTND-SLS-CORR-SEQ-NBR                          04340000
                                       TO TC006-SLS-CORR-SEQ-NBR        04350000
                   MOVE EPPART-SLS-DTE TO TC006-SLS-DTE                 04360000
                   MOVE TC005-ORIG-CARD-NBR                             04370000
                                       TO  TC006-CARD-NBR               04380000
                   MOVE EPTND-TNDR-SEQ-NBR TO TC006-TNDR-SEQ-NBR        04381010
                   PERFORM 5100-WRITE-UPDATE-EXTRACT-REC                04390000
               ELSE                                                     04400000
                   PERFORM 8000-WRITE-ERROR-LINE                        04410000
                   PERFORM 7100-TC05-TO-MAF-FILE                        04420000
           ELSE                                                         04430000
                                                                        04431004
               PERFORM 8000-WRITE-ERROR-LINE                            04440000
               PERFORM 7100-TC05-TO-MAF-FILE                            04450000
           END-IF.                                                      04460000
                                                                        04470000
      ***************************************************************** 04480000
      *  6100-SELECT-COSA-TABLES                                        04490000
      *      SELECT COLUMNS FROM TEPPART AND TEPTND TABLES              04500000
      ***************************************************************** 04510000
       6100-SELECT-COSA-TABLES.                                         04520000
                                                                        04530000
           MOVE TC005-STORE-NUMBER     TO  PV-STR-NBR.                  04540000
           MOVE TC005-REG-NBR          TO  PV-RGST-ID.                  04550000
           MOVE TC005-TRAN-NBR         TO  PV-TRN-NBR.                  04560000
           MOVE TC005-ORIG-TRANS-AMT   TO  PV-ORIG-TRANS-AMT.           04561011
           MOVE TC005-ORIG-CARD-NBR    TO  PV-ORIG-CARD-NBR.            04570000
                                                                        04582013
           SET ROW-FOUND-ON-COSA       TO TRUE.                         04590000
                                                                        04600000
           EXEC SQL                                                     04610000
                OPEN COSA-CURSOR                                        04620000
           END-EXEC.                                                    04630000
                                                                        04640000
           EVALUATE TRUE                                                04650000
               WHEN SQLCODE = ZERO                                      04651000
                    CONTINUE                                            04652000
               WHEN SQLWARN0 NOT EQUAL SPACE                            04653000
               WHEN SQLCODE NOT EQUAL ZERO                              04654000
                   MOVE '6100-SELECT-COSA-TABLES'                       04655000
                                                  TO PV-PARAGRAPH-NAME  04656000
                   MOVE 'ERROR ON OPEN OF COSA-CURSOR'                  04656100
                                                  TO PV-DB2-OPERATION   04656200
                   PERFORM 9100-SQL-ABEND                               04656300
           END-EVALUATE.                                                04656400
                                                                        04656500
W10849         SET NO-TNDR-MTCH-ON-COSA TO TRUE.                        04656639
W10849     PERFORM 6200-FETCH-COSA-CURSOR                               04656739
W10849         UNTIL NO-ROW-FOUND-ON-COSA OR TNDR-MTCH-ON-COSA.         04656839
W10849                                                                  04656939
           EXEC SQL                                                     04664700
                CLOSE COSA-CURSOR                                       04664800
           END-EXEC.                                                    04664900
                                                                        04665000
           EVALUATE TRUE                                                04666000
               WHEN SQLCODE = ZERO                                      04667000
                    CONTINUE                                            04667100
               WHEN SQLWARN0 NOT EQUAL SPACE                            04667200
               WHEN SQLCODE NOT EQUAL ZERO                              04667300
                   MOVE '6100-CLOSE-COSA-CURSOR'                        04667400
                                                  TO PV-PARAGRAPH-NAME  04667500
                   MOVE 'ERROR ON CLOSE OF COSA-CURSOR'                 04667600
                                                  TO PV-DB2-OPERATION   04667700
                   PERFORM 9100-SQL-ABEND                               04667800
           END-EVALUATE.                                                04667900
                                                                        04668000
W10849 6200-FETCH-COSA-CURSOR.                                          04668136
                                                                        04668236
           EXEC SQL                                                     04668336
              FETCH COSA-CURSOR                                         04668436
                 INTO :EPTND-TNDR-AMT                                   04668536
                     ,:EPTND-STR-NBR                                    04668636
                     ,:EPTND-RGST-ID                                    04668736
                     ,:EPTND-TRN-NBR                                    04668836
                     ,:EPTND-STRT-TM                                    04668936
                     ,:EPTND-SLS-CORR-SEQ-NBR                           04669036
                     ,:EPTND-TNDR-SEQ-NBR                               04669136
                     ,:EPPART-SLS-DTE                                   04669236
                     ,:EPTND-TNDR-ID                                    04669336
           END-EXEC.                                                    04669436
                                                                        04669536
           EVALUATE TRUE                                                04669636
               WHEN SQLCODE = ZERO                                      04669736
               PERFORM 9000-TNDR-MATCH-ON-COSA                          04669843
               WHEN SQLCODE = +100                                      04670438
                   SET NO-ROW-FOUND-ON-COSA   TO TRUE                   04670538
                                                                        04670638
               WHEN SQLWARN0 NOT EQUAL SPACE                            04670738
               WHEN SQLCODE NOT EQUAL ZERO                              04670838
                   MOVE ' 6100-SELECT-COSA-TABLES'                      04670938
                                                  TO PV-PARAGRAPH-NAME  04671038
                   MOVE 'ERROR ON FETCH  OF COSA TABLES'                04671138
                                                  TO PV-DB2-OPERATION   04671238
                   PERFORM 9100-SQL-ABEND                               04671338
                                                                        04671438
           END-EVALUATE.                                                04671538
                                                                        04671638
                                                                        04671738
      ***************************************************************** 04671838
      *   7000-NO-MATCH-TO-ADJ                                          04671938
      *      WRITE MAF FILE WHEN NO MATCH ON ADJ FILE                   04672038
      ***************************************************************** 04672138
       7000-NO-MATCH-TO-ADJ.                                            04672238
                                                                        04672338
           WRITE MAF-EXTRACT-RECORD  FROM TC003-MAF-DATA.               04672438
                                                                        04672538
       7100-TC05-TO-MAF-FILE.                                           04672638
                                                                        04672738
           INITIALIZE   PV-TC03-MAF-DATA.                               04673000
           MOVE TC005-STORE-NUMBER     TO  PV-T3-STORE-NBR.             04680000
           MOVE TC005-REG-NBR          TO  PV-T3-REG-NBR.               04690000
           MOVE TC005-TRAN-NBR         TO  PV-T3-TRAN-NBR.              04691000
           MOVE TC005-ORIG-TRAN-DTE    TO  WS-FMT-DATE.                 04692000
           MOVE WS-FMT-MM              TO  WS-TEMP-FMT-MM.              04693000
           MOVE WS-FMT-DD              TO  WS-TEMP-FMT-DD.              04693100
           MOVE 20                     TO  WS-TEMP-FMT-CC.              04693200
           MOVE WS-FMT-YY              TO  WS-TEMP-FMT-YY.              04693300
           MOVE WS-TEMP-DATE-CCYYMMDD  TO  PV-T3-SLS-DTE.               04693400
           MOVE TC005-ORIG-TRAN-TM     TO  PV-T3-STRT-TM.               04693500
           MOVE 0000                   TO  PV-T3-TRAN-SEQ-NBR.          04693600
           MOVE '05'                   TO  PV-T3-TRAN-TYPE.             04693700
           MOVE TC005-TRAN-DISP        TO  PV-T3-TRAN-DISP.             04693800
           MOVE TC005-ORIG-CARD-NBR    TO  PV-T3-CARD-NBR.              04693900
           MOVE TC005-ADJUST-AMT       TO  PV-T3-TRAN-AMT.              04694000
           MOVE 'A'                    TO  PV-T3-TYP-CDE.               04695000
           IF   TC005-AUTH-PAYMENT                                      04695100
               MOVE '110'              TO  PV-T3-ADJ-DISP               04695200
           ELSE                                                         04695300
               IF   TC005-REQ-PAY-FORCE                                 04695400
                   MOVE '111'          TO  PV-T3-ADJ-DISP               04695500
               ELSE                                                     04695600
                   IF   TC005-REQ-PAY-APPR                              04695700
                       MOVE '112'      TO  PV-T3-ADJ-DISP               04695800
                   END-IF                                               04695900
               END-IF                                                   04696000
           END-IF.                                                      04696100
                                                                        04696200
           WRITE MAF-EXTRACT-RECORD  FROM PV-TC03-MAF-DATA.             04696300
                                                                        04696400
      ***************************************************************** 04696500
      *    8000-WRITE-ERROR-LINE                                        04696600
      *      WRITE ERROR REPORT LINE                                    04696700
      ***************************************************************** 04696800
       8000-WRITE-ERROR-LINE.                                           04696900
                                                                        04697000
           IF PV-LINE-CNT-1 > PC-LINE-LIMIT                             04698000
               PERFORM 1450-WRITE-REPORT-HEADINGS                       04699000
           END-IF.                                                      04700000
                                                                        04701000
           ADD +1                      TO  PV-ERROR-CNT.                04702000
                                                                        04703000
           MOVE TC005-STORE-NUMBER     TO  D1-STORE.                    04704000
           MOVE TC005-REG-NBR          TO  D1-REG.                      04705000
           MOVE TC005-TRAN-NBR         TO  D1-TRAN.                     04706000
           MOVE TC005-ORIG-CARD-NBR    TO  PV-CARD-NUMBER.              04707106
           MOVE 'XXXXXXXXXXXXXX'       TO  PV-SPACE-CARD-NUMBER.        04707209
           MOVE PV-CARD-NUMBER         TO  D1-CARD-NUMBER.              04707308
           MOVE TC005-ORIG-TRAN-DTE    TO  WS-TEMP-DATE.                04708000
           MOVE 20                     TO  WS-TEMP-ORIG-CC.             04709000
           MOVE WS-TEMP-YY             TO  WS-TEMP-ORIG-YY.             04710000
           MOVE WS-TEMP-MM             TO  WS-TEMP-ORIG-MM.             04720000
           MOVE WS-TEMP-DD             TO  WS-TEMP-ORIG-DD.             04730000
           MOVE WS-TEMP-ORIG-DATE      TO  D1-ORIG-DATE.                04740000
           MOVE TC005-ORIG-TRAN-TM     TO  WS-TEMP-TIME.                04750000
           MOVE WS-TEMP-TIME-HH        TO  WS-TEMP-TM-HH.               04760000
           MOVE WS-TEMP-TIME-MM        TO  WS-TEMP-TM-MM.               04770000
           MOVE WS-TEMP-TIME-SS        TO  WS-TEMP-TM-SS.               04780000
           MOVE WS-TEMP-ORIG-TIME      TO  D1-ORIG-TIME.                04790000
                                                                        04800000
           IF BANK-MATCH                                                04810000
               MOVE TC003-TRAN-AMT     TO  WS-BANK-TRAN-AMT             04820000
           ELSE                                                         04830000
               MOVE ZEROES             TO  WS-BANK-TRAN-AMT             04840000
           END-IF.                                                      04850000
                                                                        04851000
           MOVE WS-BANK-TRAN-AMT       TO  D1-BANK-ORIG-AMT.            04852000
           MOVE TC005-ADJUST-AMT       TO  D1-ADJ-AMT.                  04853000
                                                                        04854000
           WRITE ADJ-ERROR-REPORT-RECORD FROM D1-DETAIL-LINE-1          04855000
           AFTER ADVANCING +1 LINES.                                    04856000
                                                                        04857000
           ADD +1                      TO  PV-LINE-CNT-1.               04858000
                                                                        04859000
      ******************************************************************04859143
      * 9000-TNDR-MATCH-ON-COSA                                         04859243
      ******************************************************************04859343
       9000-TNDR-MATCH-ON-COSA.                                         04859443
                                                                        04859543
W10849     MOVE EPTND-TNDR-ID     TO PV-TNDR-ID-RJ.                     04859643
W10849      IF PV-TNDR-ID-RJ(16:4) =  WS-MAF-CARD-NBR-LAST4             04859743
W10849         SET TNDR-MTCH-ON-COSA  TO TRUE                           04859843
W10849      END-IF.                                                     04859943
                                                                        04860043
      ******************************************************************04861000
      * 9100-SQL-ABEND                                                  04870000
      *     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.04880000
      ******************************************************************04890000
       9100-SQL-ABEND.                                                  04900000
           DISPLAY '** ABEND     **'.                                   04910000
           DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04920000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04930000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04940000
                                                                        04950000
      ******************************************************************04960000
      * COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     04970000
      * TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      04980000
      ******************************************************************04990000
           COPY DPPD004.                                                05000006
                                                                        05010000
           SET AC-DB2-ERROR TO TRUE.                                    05020000
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05030000
                                                                        05040000
      ******************************************************************05050000
      * 9999-ABEND                                                      05060000
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  05070000
      ******************************************************************05080000
       9999-ABEND.                                                      05090000
           DISPLAY '** ABEND           **'.                             05100000
           DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          05110000
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05120000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05130000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05140000
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05150000
