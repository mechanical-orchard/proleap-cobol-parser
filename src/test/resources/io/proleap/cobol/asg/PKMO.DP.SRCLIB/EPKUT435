000100*----------------------------------------------------------------*00010027
000200 IDENTIFICATION DIVISION.                                         00020027
000300*----------------------------------------------------------------*00030027
000400 PROGRAM-ID.    EPKUT435.                                         00040027
000500 AUTHOR.        COGNIZANT.                                        00050027
000600 DATE-WRITTEN.  18 JUNE 2012.                                     00060027
000700 DATE-COMPILED.                                                   00070027
000800                                                                  00080027
000900*----------------------------------------------------------------*00090027
001000*     **   CREATE OFFERS FULL FILE REFRESH EXTRACT FILE   **     *00100027
001100*                **   OFFER RESEND **                            *00110027
001200*----------------------------------------------------------------*00120027
001300*  THIS PROGRAM USES A UPDATED INPUT FILE WITH STORE NUMBERS,     00130027
001400*  GROUP TYPE CODES, STORE GROUP AND OFFER ID TO EXTRACT THE      00140027
001500*  RECORDS WHICH APPLY TO THE SOURCE STORE AND WRITE THE SAME     00150027
001600*  INFORMATION FOR ALL THE TARGET STORES THAT NEED OFFER RESEND.  00160027
001700*                                                                 00170027
001800*  THIS PROGRAM EXTRACTS THE OFFERS INFORMATION FROM THE OFFERS   00180027
001900*  MANAGEMENT DATABASE, WHICH IS IN ORACLE.                       00190027
002000*                                                                 00200027
002100*----------------------------------------------------------------*00210027
002200*  ORACLE TABLES:                         DCLGEN:                *00220027
002300*  --------------                         -------                *00230027
002400*   K_OM01.OMT_OFR                        OMT00001               *00240027
002500*   K_OM01.OMT_OFR_SECT                   OMT00002               *00250027
002600*   K_OM01.OMT_OFR_SECT_BWP               OMT00003               *00260027
002700*   K_OM01.OMT_OFR_LOC_GP                 OMT00004               *00270027
002800*   K_OM01.OMT_MDSE_SET                   OMT00005               *00280027
002900*   K_OM01.OMT_POS_BTN                    OMT00006               *00290027
003000*   K_OM01.OMT_EVNT_CTG                   OMT00007               *00300027
003100*   K_OM01.OMT_OFR_CUSTFACG_DESC          OMT00008               *00310027
003200*   K_OM01.OMT_EVNT                       OMT00009               *00320027
003300*                                                                *00330027
003400*----------------------------------------------------------------*00340027
003500* HISTORY LOG:                                                    00350027
003600*----------------------------------------------------------------*00360027
003700* DATE:        18 JUNE 2012                                       00370027
003800* WR/IR#: CRQ000000032161                                         00380027
003900* PROGRAMMER:  COGNIZANT.                                         00390027
004000* DESCRIPTION: INITIAL CREATION                                   00400027
004100*----------------------------------------------------------------*00410027
214901* DATE: 12/19/2018                                                00413030
214901* WR/IR#: CHG0214901                                              00414030
214901* PROGRAMMER: JIM ARENDT                                          00415030
214901* DESCRIPTION: IN CURSROR OFFERCRSR ADDED 'TO_CHAR' TO CHANGE THE 00416030
214901*              INPUT FORMAT OF THE TIMESTAMP DATES.               00417030
004100*----------------------------------------------------------------*00418030
004200* DATE:                                                           00420027
004300* WR/IR#:                                                         00430027
004400* PROGRAMMER:                                                     00440027
004500* DESCRIPTION:                                                    00450027
004600*                                                                 00460027
004700*----------------------------------------------------------------*00470027
004800*                                                                 00480027
004900 ENVIRONMENT DIVISION.                                            00490027
005000*----------------------------------------------------------------*00500027
005010 CONFIGURATION SECTION.                                           00501027
005020 SOURCE-COMPUTER. IBM-3090.                                       00502027
005030 OBJECT-COMPUTER. IBM-3090.                                       00503027
005040                                                                  00504027
005050 INPUT-OUTPUT SECTION.                                            00505027
005060                                                                  00506027
005070 FILE-CONTROL.                                                    00507027
005080                                                                  00508027
005090     SELECT STORE-INPUT-FILE                  ASSIGN TO INP01.    00509027
005100                                                                  00510027
005200     SELECT CONTROL-CARD-NXT-FUT-DAY          ASSIGN TO INP02.    00520027
005300                                                                  00530027
005400     SELECT ORACLE-LOGON-FILE                 ASSIGN TO ORALOGON. 00540027
005500                                                                  00550027
005600     SELECT CONTROL-CARD-BATCH-DATE           ASSIGN TO INP04.    00560027
005700                                                                  00570027
005800     SELECT OFFERS-FULL-REFRESH-FILE          ASSIGN TO OUT01.    00580027
005900                                                                  00590027
006000     SELECT REFRESH-STORE-LIST-FILE           ASSIGN TO OUT02.    00600027
006100                                                                  00610027
006200*----------------------------------------------------------------*00620027
006300 DATA DIVISION.                                                   00630027
006400*----------------------------------------------------------------*00640027
006500 FILE SECTION.                                                    00650027
006600 FD  STORE-INPUT-FILE                                             00660027
006700     RECORDING MODE IS F                                          00670027
006800     LABEL RECORDS ARE STANDARD                                   00680027
006900     RECORD CONTAINS 080 CHARACTERS                               00690027
007000     BLOCK CONTAINS 0 RECORDS                                     00700027
007100     DATA RECORD IS STORE-INPUT-RECORD.                           00710027
007200                                                                  00720027
007300 01  STORE-INPUT-RECORD               PIC X(080).                 00730027
007400                                                                  00740027
007500 FD  CONTROL-CARD-NXT-FUT-DAY                                     00750027
007600     RECORDING MODE IS F                                          00760027
007700     LABEL RECORDS ARE STANDARD                                   00770027
007800     RECORD CONTAINS 080 CHARACTERS                               00780027
007900     BLOCK CONTAINS 0 RECORDS                                     00790027
008000     DATA RECORD IS CONTROL-NXT-FUT-DAY-RECORD.                   00800027
008100                                                                  00810027
008200 01  CONTROL-NXT-FUT-DAY-RECORD       PIC X(080).                 00820027
008300                                                                  00830027
008400 FD  ORACLE-LOGON-FILE                                            00840027
008500     RECORDING MODE IS F                                          00850027
008600     LABEL RECORDS ARE STANDARD                                   00860027
008700     RECORD CONTAINS 080 CHARACTERS                               00870027
008800     BLOCK CONTAINS 0 RECORDS                                     00880027
008900     DATA RECORD IS ORACLE-LOGON-FILE-RCD.                        00890027
009000                                                                  00900027
009100 01  ORACLE-LOGON-FILE-RCD            PIC X(080).                 00910027
009200                                                                  00920027
009300 FD  CONTROL-CARD-BATCH-DATE                                      00930027
009400     RECORDING MODE IS F                                          00940027
009500     LABEL RECORDS ARE STANDARD                                   00950027
009600     RECORD CONTAINS 080 CHARACTERS                               00960027
009700     BLOCK CONTAINS 0 RECORDS                                     00970027
009800     DATA RECORD IS CONTROL-BATCH-DATE-RECORD.                    00980027
009900                                                                  00990027
010000 01  CONTROL-BATCH-DATE-RECORD        PIC X(080).                 01000027
010100                                                                  01010027
010200 FD  OFFERS-FULL-REFRESH-FILE                                     01020027
010300     RECORDING MODE IS F                                          01030027
010400     LABEL RECORDS ARE STANDARD                                   01040027
010500     RECORD CONTAINS 176 CHARACTERS                               01050027
010600     BLOCK CONTAINS 0 RECORDS                                     01060027
010700     DATA RECORD IS OFFERS-FULL-REFRESH-RECORD.                   01070027
010800                                                                  01080027
010900 01  OFFERS-FULL-REFRESH-RECORD        PIC X(176).                01090027
011000                                                                  01100027
011100 FD  REFRESH-STORE-LIST-FILE                                      01110027
011200     RECORDING MODE IS F                                          01120027
011300     LABEL RECORDS ARE STANDARD                                   01130027
011400     RECORD CONTAINS 050 CHARACTERS                               01140027
011500     BLOCK CONTAINS 0 RECORDS                                     01150027
011600     DATA RECORD IS REFRESH-STORE-LIST-RECORD.                    01160027
011700                                                                  01170027
011800 01  REFRESH-STORE-LIST-RECORD        PIC X(050).                 01180027
011900                                                                  01190027
012000*----------------------------------------------------------------*01200027
012100                                                                  01210027
012200 WORKING-STORAGE SECTION.                                         01220027
012300                                                                  01230027
012400*----------------------------------------------------------------*01240027
012500                                                                  01250027
012600*----------------------------------------------------------------*01260027
012700* PC- PROGRAM CONSTANTS                                          *01270027
012800*----------------------------------------------------------------*01280027
012900 01  PC-PROGRAM-CONSTANTS.                                        01290027
013000     05  FILLER                       PIC  X(27) VALUE            01300027
013100        'WORKING STORAGE STARTS HERE'.                            01310027
013200     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'EPKUT435'.01320027
013300     05  PC-MAX-RETRIES               PIC  9(01) VALUE 5.         01330027
013400     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.01340027
013500     05  PC-START-DTE-DECR-DAYS       PIC  9(03) VALUE 365.       01350027
013600     05  PC-SUB-DAYS                  PIC  9(03) VALUE 001.       01360027
013700     05  PC-NO-REFRESHES-FOUND        PIC  X(49) VALUE            01370027
013800             'NO STORES IDENTIFIED TO RECEIVE AN OFFERS REFRESH'. 01380027
013900     05  PC-DFLT-PROMO-SCHM-CDE-1008  PIC  9(04) VALUE 1008.      01390027
014000     05  PC-DFLT-PROMO-SCHM-CDE-1009  PIC  9(04) VALUE 1009.      01400027
014100     05  PC-DFLT-PROMO-SCHM-CDE-1010  PIC  9(04) VALUE 1010.      01410027
014200     05  PC-NULL-FIELD-VALUE          PIC  X(01) VALUE '~'.       01420027
014300     05  PC-ROW-NOT-FOUND             PIC  9(04) VALUE 1403.      01430027
014400     05  PC-STR-GP-TYP-SPECIFIC-STR   PIC  9(05) VALUE 5000.      01440027
014500     05  PC-MAX-BTN-INDEX-VALUE       PIC  9(04) VALUE 10.        01450027
014510     05  PC-AUTO-LOGON               PIC X(01)       VALUE '/'.   01451027
014520                                                                  01452027
014530*----------------------------------------------------------------*01453027
014540* PS- PROGRAM SWITCHES                                           *01454027
014550*----------------------------------------------------------------*01455027
014560 01  PS-PROGRAM-SWITCHES.                                         01456027
014570     05  PS-BATCH-DTE-CNTL-EOF-SW     PIC  X(01) VALUE 'N'.       01457027
014580         88  PS-END-OF-CC-BATCH-DTE              VALUE 'Y'.       01458027
014590         88  PS-NOT-EOF-CC-BATCH-DTE             VALUE 'N'.       01459027
014600     05  PS-END-OF-CC-NXT-FUT-DAY-SW  PIC  X(01) VALUE 'N'.       01460027
014700         88  PS-END-OF-CC-NXT-FUT-DAY            VALUE 'Y'.       01470027
014800         88  PS-NOT-END-OF-CC-NXT-FUT-DAY        VALUE 'N'.       01480027
014900     05  PS-END-OF-REFRESH-CSR-SW     PIC  X(01) VALUE 'N'.       01490027
015000         88  PS-END-OF-REFRESH-CSR               VALUE 'Y'.       01500027
015100         88  PS-NOT-END-OF-REFRESH-CSR           VALUE 'N'.       01510027
015200     05  PS-DATE-ROUTINE-1-SW         PIC  X(01) VALUE 'N'.       01520027
015300         88  PS-DATE-FOUND                       VALUE 'Y'.       01530027
015400         88  PS-DATE-NOT-FOUND                   VALUE 'N'.       01540027
015500     05  PS-DATE-ROUTINE-2-SW         PIC  X(01) VALUE 'N'.       01550027
015600         88  PS-DATE-VALID                       VALUE 'Y'.       01560027
015700         88  PS-DATE-NOT-VALID                   VALUE 'N'.       01570027
015800     05  PS-END-OF-FETCH-BTN-SW       PIC  X(01) VALUE 'N'.       01580027
015900         88  PS-END-OF-FETCH-BTN                 VALUE 'Y'.       01590027
016000         88  PS-NOT-END-OF-FETCH-BTN             VALUE 'N'.       01600027
016100     05  PS-FIRST-READ-STR-GP-SW      PIC  X(01) VALUE 'Y'.       01610027
016200         88  PS-FIRST-READ-STR-GP                VALUE 'Y'.       01620027
016300         88  PS-NOT-FIRST-READ-STR-GP            VALUE 'N'.       01630027
016400     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       01640027
016500         88  PS-ERROR-FOUND                      VALUE 'Y'.       01650027
016600         88  PS-NO-ERROR-FOUND                   VALUE 'N'.       01660027
016700     05  PS-END-OF-INPUT-SW           PIC X(01)  VALUE 'N'.       01670027
016800         88  PS-END-OF-INPUT                     VALUE 'Y'.       01680027
016900         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       01690027
017000     05  PS-END-OF-TARGET-SW          PIC X(01)  VALUE 'N'.       01700027
017100         88  PS-END-OF-TARGET                    VALUE 'Y'.       01710027
017200         88  PS-NOT-END-OF-TARGET                VALUE 'N'.       01720027
017300     05  PS-RECORD-SW                 PIC X(01)  VALUE ' '.       01730027
017400         88  PS-SOURCE-STORE                     VALUE 'S'.       01740027
017500         88  PS-TARGET-STORE                     VALUE 'T'.       01750027
017600     05  PS-PROCESSED-SW              PIC X(01)  VALUE 'N'.       01760027
017700         88  PS-PROCESSED-ALL                    VALUE 'Y'.       01770027
017800     05  PS-ORACLE-LOGIN-EOF-SW      PIC X(01)  VALUE 'N'.        01780027
017900         88  ORACLE-LOGIN-EOF                   VALUE 'Y'.        01790027
018000                                                                  01800027
018010*-----------------------------------------------------------      01801027
018020* PA PROGRAM ACCUMULATORS                                        *01802027
018030*-----------------------------------------------------------      01803027
018040 01  PA-PROGRAM-ACCUMULATORS.                                     01804027
018050     05  PA-INPUT-RECS-READ      PIC S9(7)  COMP-3   VALUE ZEROES.01805027
018060     05  PA-TARGET-STORE-COUNT   PIC S9(7)  COMP-3   VALUE ZEROES.01806027
018070     05  PA-ERROR-COUNT          PIC S9(7)  COMP-3   VALUE ZEROES.01807027
018080*---------------------------------------------------------------* 01808027
018090 01  CC-ORACLE-CONNECTION.                                        01809027
018100     05  CC-ORACLE-USERID        PIC X(40).                       01810027
018110         88 CC-AUTO-LOGON                   VALUE '/'.            01811027
018120     05  CC-ORACLE-PASSWORD      PIC X(40).                       01812027
018130                                                                  01813027
018140*--------------------------------------------------------------*  01814027
018150* PV- PROGRAM VARIABLES                                           01815027
018160*--------------------------------------------------------------*  01816027
018170 01  PV-LOGON-SYSIN.                                              01817027
018171     05  PV-ORACLE-USERID-LEN        PIC S9(04)      VALUE ZEROS. 01817127
018172     05  PV-ORACLE-PASSWORD-LEN      PIC S9(04)      VALUE ZEROS. 01817227
018173                                                                  01817327
018174 01  PV-PROGRAM-VARIABLES.                                        01817427
018175     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01817527
018176     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      01817627
018177     05  PV-SPACE                     PIC  X(01) VALUE SPACE.     01817727
018178     05  PV-SQL-SUB                   PIC S9(04) VALUE 0  COMP.   01817827
018179     05  PV-DAYS-AHEAD                PIC  9(05) VALUE 0.         01817927
018180     05  PV-BATCH-DATE                PIC  X(10) VALUE SPACES.    01818027
018190     05  PV-EXTR-START-DTE            PIC  X(10) VALUE SPACES.    01819027
018200     05  PV-EFF-BEG-TMST.                                         01820027
018300         10  PV-EFF-BEG-DATE          PIC X(10).                  01830027
018400         10  PV-EFF-BEG-TIME          PIC X(09).                  01840027
018500     05  PV-EFF-END-TMST.                                         01850027
018600         10  PV-EFF-END-DATE          PIC X(10).                  01860027
018700         10  PV-EFF-END-TIME          PIC X(09).                  01870027
018800     05  PV-EFF-DATE.                                             01880027
018900         10 PV-DATE-CCYY              PIC X(04).                  01890027
019000         10 PV-DATE-MM                PIC X(02).                  01900027
019100         10 PV-DATE-DD                PIC X(02).                  01910027
019200     05  PV-FORMAT-DATE.                                          01920027
019300         10 PV-FORMAT-DATE-CCYY.                                  01930027
019400            15 PV-FORMAT-CC           PIC X(02).                  01940027
019500            15 PV-FORMAT-YY           PIC X(02).                  01950027
019600         10 PV-DASH1                  PIC X(01).                  01960027
019700         10 PV-FORMAT-DATE-MM         PIC X(02).                  01970027
019800         10 PV-DASH2                  PIC X(01).                  01980027
019900         10 PV-FORMAT-DATE-DD         PIC X(02).                  01990027
020000     05  PV-SOURCE-STORE              PIC  X(04) VALUE SPACES.    02000027
020100     05  PV-NEXT-SOURCE-STORE         PIC  X(04) VALUE SPACES.    02010027
020200     05  PV-ARRAY-COUNT               PIC S9(07) COMP-3           02020027
020300                                                 VALUE 1.         02030027
020400     05  PV-TARGET-STORE-TABLE OCCURS 1000 TIMES.                 02040027
020500         10  PV-TARGET-STORE          PIC  X(04) VALUE ZEROS.     02050027
020600     05  PV-TARGET-STORE-SUB          PIC  9(05) VALUE ZEROS.     02060027
020700     05  PV-SUB                       PIC  9(05) VALUE ZEROS.     02070027
020800     05  PV-SYSOUT-SUB                PIC  9(05) VALUE ZEROS.     02080027
020900     05  PV-STORE-NUM                 PIC  9(04) VALUE ZEROS.     02090027
021000                                                                  02100027
021100 01  PV-STORE-DATA.                                               02110027
021200     05  PV-SAVE-STR-NBR              PIC  9(05) VALUE 0.         02120027
021300     05  PV-STR-NBR                   PIC  9(05) VALUE 0.         02130027
021400     05  PV-STR-GP-TYP-CDE            PIC  9(05) VALUE 0.         02140027
021500     05  PV-STR-GRP-ID                PIC  9(10) VALUE 0.         02150027
021600     05  PV-OFFER-ID                  PIC  9(10) VALUE 0.         02160027
021700                                                                  02170027
021800 01  PV-OFFER-DATA-WRITTEN.                                       02180027
021900     05  PV-OFR-ID                    PIC  9(10) VALUE ZEROS.     02190027
022000     05  PV-EVNT-ID                   PIC  9(10) VALUE ZEROS.     02200027
022100     05  PV-OFR-SECT-TYP-CDE          PIC  X(01) VALUE SPACE.     02210027
022200     05  PV-OFR-SECT-BWP-ID           PIC  9(10) VALUE ZEROS.     02220027
022300     05  PV-MDSE-SET-ID               PIC  9(10) VALUE ZEROS.     02230027
022400*                                                                 02240027
022500*----------------------------------------------------------------*02250027
022600* DF- DATE AND TIME FIELDS USED IN P9990-                        *02260027
022700*----------------------------------------------------------------*02270027
022800 01  DF-DATE-TIME-FIELDS.                                         02280027
022900     05  DF-CURRENT-DATE-TIME.                                    02290027
023000         10  DF-CURRENT-YR            PIC  9(04) VALUE ZEROS.     02300027
023100         10  DF-CURRENT-MO            PIC  9(02) VALUE ZEROS.     02310027
023200         10  DF-CURRENT-DY            PIC  9(02) VALUE ZEROS.     02320027
023300         10  DF-CURRENT-HR            PIC  9(02) VALUE ZEROS.     02330027
023400         10  DF-CURRENT-MIN           PIC  9(02) VALUE ZEROS.     02340027
023500         10  DF-CURRENT-SEC           PIC  9(02) VALUE ZEROS.     02350027
023600         10  DF-CURRENT-HSEC          PIC  9(02) VALUE ZEROS.     02360027
023700     05  DF-DISPLAY-DATE.                                         02370027
023800         10  DF-DD-YR                 PIC  X(04) VALUE SPACES.    02380027
023900         10  FILLER                   PIC  X(01) VALUE '-'.       02390027
024000         10  DF-DD-MO                 PIC  X(02) VALUE SPACES.    02400027
024100         10  FILLER                   PIC  X(01) VALUE '-'.       02410027
024200         10  DF-DD-DY                 PIC  X(02) VALUE SPACES.    02420027
024300     05  DF-DISPLAY-TIME.                                         02430027
024400         10  DF-DT-HR                 PIC  X(02) VALUE SPACES.    02440027
024500         10  FILLER                   PIC  X(01) VALUE ':'.       02450027
024600         10  DF-DT-MIN                PIC  X(02) VALUE SPACES.    02460027
024700         10  FILLER                   PIC  X(01) VALUE ':'.       02470027
024800         10  DF-DT-SEC                PIC  X(02) VALUE SPACES.    02480027
024900                                                                  02490027
025000*----------------------------------------------------------------*02500027
025100* NULL INDICATORS                                                 02510027
025200*    -1 INDICATES VALUE IS NULL                                   02520027
025300*    +0 INDICATES NON-NULL VALUE                                  02530027
025400*----------------------------------------------------------------*02540027
025500 01  PV-NULL-INDICATORS.                                          02550027
025600     05  PV-POS-RLTV-NUM-NULL-IND     PIC S9(4) COMP VALUE +0.    02560027
025700     05  PV-ITM-DISC-APL-NULL-IND     PIC S9(4) COMP VALUE +0.    02570027
025800     05  PV-POS-BTN-CDE-NULL-IND      PIC S9(4) COMP VALUE +0.    02580027
025900     05  PV-BWP-BUY-QTY-NULL-IND      PIC S9(4) COMP VALUE +0.    02590027
026000     05  PV-BWP-BUY-AMT-NULL-IND      PIC S9(4) COMP VALUE +0.    02600027
026100     05  PV-BWP-BUY-TOL-AMT-NULL-IND  PIC S9(4) COMP VALUE +0.    02610027
026200     05  PV-BWP-GET-QTY-NULL-IND      PIC S9(4) COMP VALUE +0.    02620027
026300     05  PV-BWP-GET-PCT-NULL-IND      PIC S9(4) COMP VALUE +0.    02630027
026400     05  PV-BWP-GET-DOL-NULL-IND      PIC S9(4) COMP VALUE +0.    02640027
026500     05  PV-BWP-GET-PRPT-NULL-IND     PIC S9(4) COMP VALUE +0.    02650027
026600     05  PV-MDSE-DEPT-NBR-NULL-IND    PIC S9(4) COMP VALUE +0.    02660027
026700     05  PV-MDSE-MAJ-CLS-NULL-IND     PIC S9(4) COMP VALUE +0.    02670027
026800     05  PV-MDSE-SUB-CLS-NULL-IND     PIC S9(4) COMP VALUE +0.    02680027
026900     05  PV-MDSE-STL-ID-NULL-IND      PIC S9(4) COMP VALUE +0.    02690027
027000     05  PV-MDSE-SKU-NB-NULL-IND      PIC S9(4) COMP VALUE +0.    02700027
027100     05  PV-MDSE-EMP-DS-NULL-IND      PIC S9(4) COMP VALUE +0.    02710027
027200     05  PV-MDSE-DSC-EL-NULL-IND      PIC S9(4) COMP VALUE +0.    02720027
027300     05  PV-MDSE-TKT-CL-NULL-IND      PIC S9(4) COMP VALUE +0.    02730027
027400*                                                                 02740027
027500*----------------------------------------------------------       02750027
027600* PV- PROGRAM VARIABLES                                           02760027
027700*     (THE BELOW TABLE WILL HOLD ALL THE ROWS OF                  02770027
027800*                       K_OM01.OMT_POS_BTN TABLE )                02780027
027900*----------------------------------------------------------       02790027
028000 01  PV-OMT-POS-BTN.                                              02800027
028100     05  PV-BTN-RECORD                OCCURS 10 TIMES             02810027
028200                                      INDEXED BY PV-BTN-INDEX.    02820027
028300         10  PV-POS-BTN-CDE           PIC X(03).                  02830027
028400         10  PV-POS-BTN-TEXT          PIC X(16).                  02840027
028500         10  PV-POS-BTN-RLTV-SEQ-NBR  PIC 9(10).                  02850027
028600         10  PV-POS-BTN-RLTV-SEQ-NBR-X REDEFINES                  02860027
028700             PV-POS-BTN-RLTV-SEQ-NBR  PIC X(10).                  02870027
028800*                                                                 02880027
028900*----------------------------------------------------------------*02890027
029000* PV- PROGRAM COUNT VARIABLES                                    *02900027
029100*----------------------------------------------------------------*02910027
029200 01  PV-PROGRAM-COUNTERS.                                         02920027
029300     05  PV-RECS-READ                 PIC  9(09) VALUE 0.         02930027
029400     05  PV-STORE-RFRSH-COUNT         PIC  9(09) VALUE 0.         02940027
029500     05  PV-SRC-STORE-COUNT           PIC  9(09) VALUE 0.         02950027
029600     05  PV-POS-BTN-REC-FETCHED       PIC  9(09) VALUE 0.         02960027
029700     05  PV-OFR-CRSR-RECS-FETCHED     PIC  9(09) VALUE 0.         02970027
029800     05  PV-OFFER-RECS-OUT            PIC  9(09) VALUE 0.         02980027
029900     05  PV-OFRSECT-RECS-OUT          PIC  9(09) VALUE 0.         02990027
030000     05  PV-OFRBWP-RECS-OUT           PIC  9(09) VALUE 0.         03000027
030100     05  PV-MDSESET-RECS-OUT          PIC  9(09) VALUE 0.         03010027
030200     05  PV-STR-LIST-RECS-OUT         PIC  9(09) VALUE 0.         03020027
030300     05  PV-OFR-CRSR-RECS-FETCHED1    PIC  9(09) VALUE 0.         03030027
030400     05  PV-OFFER-RECS-OUT1           PIC  9(09) VALUE 0.         03040027
030500     05  PV-OFRSECT-RECS-OUT1         PIC  9(09) VALUE 0.         03050027
030600     05  PV-OFRBWP-RECS-OUT1          PIC  9(09) VALUE 0.         03060027
030610     05  PV-MDSESET-RECS-OUT1         PIC  9(09) VALUE 0.         03061027
030620     05  PV-STR-LIST-RECS-OUT1        PIC  9(09) VALUE 0.         03062027
030630                                                                  03063027
030640*----------------------------------------------------------------*03064027
030650* ERROR HANDLING                                                  03065027
030660*----------------------------------------------------------------*03066027
030670 01  PV-MISC-ABEND-FIELDS.                                        03067027
030680     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     03068027
030690     05  PV-ORA-OPERATION             PIC  X(50) VALUE SPACES.    03069027
030700     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     03070027
030800     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     03080027
030900     05  PV-CALLING-FUNCTION          PIC  X(40) VALUE SPACE.     03090027
031000         88  PV-BATCH-DATE-CARD       VALUE 'BATCH DATE CARD'.    03100027
031100         88  PV-NEXT-FUTURE-DATE-CARD VALUE                       03110027
031200                                       'NEXT/FUTURE DATE CARD'.   03120027
031300                                                                  03130027
031400*--------------------------------------------------------------*  03140027
031500*    INPUT CONTROL CARD RECORD                                   *03150027
031600*    FIRST RECORD SHOULD CONTAIN THE SOURCE STORE AND OFFER ID   *03160027
031700*    FOR THE OFFER RECORDS TO BE COPIED.                         *03170027
031800*    THE REST OF THE RECORDS SHOULD CONTAIN ONLY THE STORES      *03180027
031900*    THAT THE DATA WILL BE SENT TO - 1 STORE PER RECORD.         *03190027
032000*--------------------------------------------------------------*  03200027
032010                                                                  03201027
032020 01  INPUT-RECORD.                                                03202027
032030     05  INPUT-STORE                 PIC  X(04)  VALUE ZEROES.    03203027
032040     05  FILLER                      PIC  X(01)  VALUE SPACES.    03204027
032050     05  INPUT-OFFER-ID              PIC  X(10)  VALUE ZEROES.    03205027
032060     05  FILLER                      PIC  X(01)  VALUE SPACES.    03206027
032070     05  INPUT-STR-GP-TYP-CDE        PIC  9(05)  VALUE ZEROES.    03207027
032080     05  FILLER                      PIC  X(01)  VALUE SPACES.    03208027
032090     05  INPUT-STR-GRP-ID            PIC  9(05)  VALUE ZEROES.    03209027
032091     05  FILLER                      PIC  X(53)  VALUE SPACES.    03209127
032092                                                                  03209227
032093                                                                  03209327
032094                                                                  03209427
032095 01  SYSOUT-OFFER-REQUEST-RECORD.                                 03209527
032096     05  FILLER                      PIC  X(15)                   03209627
032097                                     VALUE 'OFFER ID      '.      03209727
032098     05  SYSOUT-OFFER-ID             PIC  X(10)  VALUE ZEROES.    03209827
032099     05  FILLER                      PIC  X(09)  VALUE SPACES.    03209927
032100     05  SYSOUT-OFFR-ID-ERROR-MSG    PIC  X(47)  VALUE SPACES.    03210027
032110*                                                                 03211027
032120 01  SYSOUT-HEADER-1.                                             03212027
032130     05  SYSOUT-HDR1-STORE-TYPE  PIC  X(14)  VALUE 'STORE TYPE'.  03213027
032131     05  SYSOUT-HDR1-STORE-NBR   PIC  X(05)  VALUE 'STORE'.       03213127
032132                                                                  03213227
032133 01  SYSOUT-HEADER-2.                                             03213327
032134     05  SYSOUT-HDR2-STORE-TYPE  PIC  X(14)  VALUE '------------'.03213427
032135     05  SYSOUT-HDR2-STORE-NBR   PIC  X(05)  VALUE '-----'.       03213527
032136                                                                  03213627
032137 01  SYSOUT-RECORD-TABLE.                                         03213727
032138     05  SYSOUT-STORE-RECORDS OCCURS 1000 TIMES.                  03213827
032139         10  SYSOUT-FIELD-NAME       PIC  X(15)  VALUE SPACES.    03213927
032140         10  SYSOUT-STORE            PIC  X(04)  VALUE ZEROES.    03214027
032141                                                                  03214127
032142 01  AC-ABEND-CODE                    PIC S9(04) VALUE +0         03214227
032143                                                 COMP SYNC.       03214327
032144     88  AC-4003-CONTROL-CARD-ERROR              VALUE +4003.     03214427
032145     88  AC-4004-TABLE-OVERFLOW-ERROR            VALUE +4004.     03214527
032146     88  AC-4008-INVALID-DATA                    VALUE +4008.     03214627
032147     88  AC-4013-ORACLE-ERROR                    VALUE +4013.     03214727
032148     88  AC-4019-CAL-SUB-ERROR                   VALUE +4019.     03214827
032149                                                                  03214927
032150*----------------------------------------------------------------*03215027
032160* VARIABLES REQUIRED FOR THE KOHL'S DATE ROUTINE DPKUT500        *03216027
032170*----------------------------------------------------------------*03217027
032180     COPY DPWS500.                                                03218027
032190                                                                  03219027
032200*----------------------------------------------------------       03220027
032300* COPYBOOK FOR DATA VALIDATION ROUTINE EPPD208                    03230027
032400*----------------------------------------------------------       03240027
032500     COPY EPWS208.                                                03250027
032600                                                                  03260027
032700*----------------------------------------------------------       03270027
032800* NETCOOL ERROR MESSAGE COPYBOOK                                  03280027
032900*----------------------------------------------------------       03290027
033000     COPY ISWS003.                                                03300027
033100                                                                  03310027
033200*----------------------------------------------------------------*03320027
033300* COPYBOOK FOR INPUT REFRESH STORES FILE                         *03330027
033400*----------------------------------------------------------------*03340027
033500     COPY EPRD250.                                                03350027
033600                                                                  03360027
033700*----------------------------------------------------------------*03370027
033800* COPYBOOK FOR INPUT NEXT FUTURE DAY CONTROL CARD EPCC813.       *03380027
033900*----------------------------------------------------------------*03390027
034000     COPY EPRD252 REPLACING 'EP252-' BY 'EP813-'.                 03400027
034100                                                                  03410027
034200*----------------------------------------------------------------*03420027
034300* COPYBOOK FOR INPUT BATCH DATE CONTROL CARD EPCC812             *03430027
034400*----------------------------------------------------------------*03440027
034500     COPY EPRD257 REPLACING 'EP257-' BY 'EP812-'.                 03450027
034600                                                                  03460027
034700*----------------------------------------------------------------*03470027
034800* COPYBOOK FOR OUTPUT OFFERS REFRESH FILE - INTERMEDIATE         *03480027
034900*----------------------------------------------------------------*03490027
035000     COPY EPRD205.                                                03500027
035100                                                                  03510027
035200*----------------------------------------------------------------*03520027
035300* COPYBOOK FOR OUTPUT REFRESH STORE LIST FILE                    *03530027
035400*----------------------------------------------------------------*03540027
035500     COPY EPRD206.                                                03550027
035600                                                                  03560027
035700*----------------------------------------------------------------*03570027
035800* ORACLE DELARE SECTION START                                    *03580027
035900*----------------------------------------------------------------*03590027
036000     EXEC SQL                                                     03600027
036100        BEGIN DECLARE SECTION                                     03610027
036200     END-EXEC.                                                    03620027
036300                                                                  03630027
036400*----------------------------------------------------------------*03640027
036500* PD- ORA VARIABLES (NON DCLGEN)                                 *03650027
036600*----------------------------------------------------------------*03660027
036700 01  USERNAME                      PIC X(10)  VARYING.            03670027
036800 01  PASSWD                        PIC X(10)  VARYING.            03680027
036900 01  PV-ORACLE-ID                  PIC X(01)  VALUE '/'.          03690027
037000                                                                  03700027
037100*----------------------------------------------------------------*03710027
037200* OMT00001 - OMT_OFR  COPYBOOK                                   *03720027
037300* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR              *03730027
037400*----------------------------------------------------------------*03740027
037500     EXEC SQL                                                     03750027
037600         INCLUDE OMT00001                                         03760027
037700     END-EXEC.                                                    03770027
037800                                                                  03780027
037900*----------------------------------------------------------------*03790027
038000* OMT00002 - OMT_OFR_SECT COPYBOOK                               *03800027
038100* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_SECT         *03810027
038200*----------------------------------------------------------------*03820027
038300     EXEC SQL                                                     03830027
038400         INCLUDE OMT00002                                         03840027
038500     END-EXEC.                                                    03850027
038600                                                                  03860027
038700*----------------------------------------------------------------*03870027
038800* OMT00003 - OMT_OFR_SECT_BWP COPYBOOK                           *03880027
038900* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_SECT_BWP     *03890027
039000*----------------------------------------------------------------*03900027
039100     EXEC SQL                                                     03910027
039200         INCLUDE OMT00003                                         03920027
039300     END-EXEC.                                                    03930027
039400                                                                  03940027
039500*----------------------------------------------------------------*03950027
039600* OMT00004 - OMT_OFR_LOC_GP COPYBOOK                             *03960027
039700* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_LOC_GP       *03970027
039800*----------------------------------------------------------------*03980027
039900     EXEC SQL                                                     03990027
040000         INCLUDE OMT00004                                         04000027
040100     END-EXEC.                                                    04010027
040200                                                                  04020027
040300*----------------------------------------------------------------*04030027
040400* OMT00005 - OMT_MDSE_SET COPYBOOK                               *04040027
040500* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_MDSE_SET         *04050027
040600*----------------------------------------------------------------*04060027
040700     EXEC SQL                                                     04070027
040800         INCLUDE OMT00005                                         04080027
040900     END-EXEC.                                                    04090027
041000                                                                  04100027
041100*----------------------------------------------------------------*04110027
041200* OMT00006 - OMT_POS_BTN COPYBOOK                                *04120027
041300* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_POS_BTN          *04130027
041400*----------------------------------------------------------------*04140027
041500     EXEC SQL                                                     04150027
041600         INCLUDE OMT00006                                         04160027
041700     END-EXEC.                                                    04170027
041800                                                                  04180027
041900*----------------------------------------------------------------*04190027
042000* OMT00007 - OMT_EVNT_CTG COPYBOOK                               *04200027
042100* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_EVNT_CTG         *04210027
042200*----------------------------------------------------------------*04220027
042300     EXEC SQL                                                     04230027
042400         INCLUDE OMT00007                                         04240027
042500     END-EXEC.                                                    04250027
042600                                                                  04260027
042700*----------------------------------------------------------------*04270027
042800* OMT00008 - OMT_OFR_CUSTFACG_DESC COPYBOOK                      *04280027
042900* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_CUSTFACG_DESC*04290027
043000*----------------------------------------------------------------*04300027
043100     EXEC SQL                                                     04310027
043200         INCLUDE OMT00008                                         04320027
043300     END-EXEC.                                                    04330027
043400                                                                  04340027
043500*----------------------------------------------------------------*04350027
043600* OMT00009 - OMT_EVNT COPYBOOK                                   *04360027
043700* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_EVNT             *04370027
043800*----------------------------------------------------------------*04380027
043900     EXEC SQL                                                     04390027
044000         INCLUDE OMT00009                                         04400027
044100     END-EXEC.                                                    04410027
044200                                                                  04420027
044300*----------------------------------------------------------------*04430027
044400* ORACLE END OF DECLARATIVE SECTION                              *04440027
044500*----------------------------------------------------------------*04450027
044600     EXEC SQL                                                     04460027
044700       END DECLARE SECTION                                        04470027
044800     END-EXEC.                                                    04480027
044900                                                                  04490027
045000     EXEC SQL                                                     04500027
045100       INCLUDE SQLCACOB                                           04510027
045200     END-EXEC.                                                    04520027
045300*----------------------------------------------------------------*04530027
045400* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *04540027
045500*----------------------------------------------------------------*04550027
045600     COPY DPWS004.                                                04560027
045700                                                                  04570027
045800*----------------------------------------------------------------*04580027
045900* ORA ABEND COPYBOOK                                             *04590027
046000*----------------------------------------------------------------*04600027
046100     COPY DPWS900.                                                04610027
046200                                                                  04620027
046300******************************************************************04630027
046400 PROCEDURE DIVISION.                                              04640027
046500******************************************************************04650027
046600 0000-MAINLINE.                                                   04660027
046700                                                                  04670027
046800     PERFORM 1000-INITIALIZATION.                                 04680027
046900                                                                  04690027
047000     PERFORM 2000-PROCESS-RFRSH-STRS                              04700027
047100       UNTIL PS-PROCESSED-ALL.                                    04710027
047200                                                                  04720027
047300     PERFORM 9000-WRAPUP.                                         04730027
047400                                                                  04740027
047500     GOBACK.                                                      04750027
047600                                                                  04760027
047700*0000-EXIT.                                                       04770027
047800******************************************************************04780027
047900*   1000-INITIALIZATION.                                         *04790027
048000*     INTIALIZES VARIABLES, OPENS FILES, READS CONTROL CARDS,    *04800027
048100*     AND PERFORMS SET-UP ROUTINES.                              *04810027
048200******************************************************************04820027
048300 1000-INITIALIZATION.                                             04830027
048400     MOVE '1000-INITIALIZATION             ' TO PV-PARAGRAPH-NAME.04840027
048500                                                                  04850027
048600     PERFORM 9990-GET-CURRENT.                                    04860027
048700                                                                  04870027
048800     DISPLAY '****************************************'.          04880027
048900     DISPLAY '**          EPKUT435 STARTED          **'.          04890027
049000     DISPLAY '****************************************'.          04900027
049100     DISPLAY '** CURRENT DATE ' DF-DISPLAY-DATE                   04910027
049200             '            **'.                                    04920027
049300     DISPLAY '** CURRENT TIME ' DF-DISPLAY-TIME                   04930027
049400             '              **'.                                  04940027
049500     DISPLAY '****************************************'.          04950027
049600                                                                  04960027
049700     OPEN INPUT  STORE-INPUT-FILE                                 04970027
049800                 CONTROL-CARD-NXT-FUT-DAY                         04980027
049900                 ORACLE-LOGON-FILE                                04990027
050000                 CONTROL-CARD-BATCH-DATE                          05000027
050100          OUTPUT OFFERS-FULL-REFRESH-FILE                         05010027
050200                 REFRESH-STORE-LIST-FILE.                         05020027
050300                                                                  05030027
050400     INITIALIZE EP250-CC-CONTROL-CARD.                            05040027
050500     INITIALIZE EP813-CC-CONTROL-CARD.                            05050027
050600     INITIALIZE EP812-CC-CONTROL-CARD.                            05060027
050700     INITIALIZE PS-PROGRAM-SWITCHES.                              05070027
050800     INITIALIZE PV-NULL-INDICATORS.                               05080027
050900     INITIALIZE PV-OMT-POS-BTN.                                   05090027
051000     INITIALIZE PV-PROGRAM-VARIABLES.                             05100027
051100     INITIALIZE PV-OFFER-DATA-WRITTEN.                            05110027
051200     MOVE 1 TO PV-ARRAY-COUNT.                                    05120027
051300     SET  PS-NOT-EOF-CC-BATCH-DTE      TO TRUE.                   05130027
051400     SET  PS-NOT-END-OF-CC-NXT-FUT-DAY TO TRUE.                   05140027
051500                                                                  05150027
051600** READ BATCH DATE CONTROL CARD                                   05160027
051700     PERFORM 8000-READ-BATCH-DATE-CNTL-CARD.                      05170027
051800                                                                  05180027
051900     DISPLAY '** INPUT BATCH DATE: ' EP812-CC-CRNT-DTE            05190027
052000             '            **'.                                    05200027
052100     DISPLAY '****************************************'.          05210027
052200                                                                  05220027
052300**  VALIDATE BATCH DATE CONTROL CARD                              05230027
052400     PERFORM 1100-VALIDATE-BATCH-DATE.                            05240027
052500                                                                  05250027
052600** READ NEXT/FUTURE DAY CONTROL CARD                              05260027
052700     PERFORM 8100-READ-CC-NXT-FUT-DAY.                            05270027
052800                                                                  05280027
052900     DISPLAY '** INPUT NEXT/FUTURE DAY CC: ' EP813-CC-CONTROL-CARD05290027
053000             '            **'.                                    05300027
053100     DISPLAY '****************************************'.          05310027
053200                                                                  05320027
053300     PERFORM 1200-DATE-ROUTINES.                                  05330027
053400                                                                  05340027
053500*   INITIAL READ OF INPUT STORE GROUP FILE                        05350027
053600     SET  PS-NOT-END-OF-INPUT       TO TRUE.                      05360027
053700     SET  PS-FIRST-READ-STR-GP      TO TRUE.                      05370027
053800                                                                  05380027
053900     PERFORM 8250-READ-STORE-INPUT.                               05390027
054000                                                                  05400027
054100     IF  PS-NOT-END-OF-INPUT                                      05410027
054200         PERFORM 1300-SETUP-FOR-ORACLE                            05420027
054300         PERFORM 1400-POPULATE-BTN-TBL                            05430027
054400     END-IF.                                                      05440027
054500                                                                  05450027
054600     PERFORM 1500-LOAD-TARGET-ARRAY                               05460027
054700       UNTIL PS-END-OF-TARGET OR                                  05470027
054800             PS-END-OF-INPUT.                                     05480027
054900                                                                  05490027
055000*1000-EXIT.                                                       05500027
055100******************************************************************05510027
055200* 1100-VALIDATE-BATCH-DATE.                                       05520027
055300*    VALIDATE THE INPUT BATCH DATE BY CALLING THE KOHLS CALENDAR  05530027
055400*    ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.      05540027
055500******************************************************************05550027
055600 1100-VALIDATE-BATCH-DATE.                                        05560027
055700                                                                  05570027
055800     IF  EP812-CC-CRNT-DTE  = SPACES                              05580027
055900         DISPLAY 'INVALID CONTROL CARD'                           05590027
056000         DISPLAY 'BATCH DATE: ' EP812-CC-CRNT-DTE                 05600027
056100         MOVE '1100-VALIDATE-BATCH-DATE' TO PV-PARAGRAPH-NAME     05610027
056200         MOVE 'CONTROL CARD IS INVALID'  TO PV-OPERATION-MSG-1    05620027
056300         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  05630027
056400         PERFORM 9800-ABEND                                       05640027
056500     END-IF.                                                      05650027
056600                                                                  05660027
056700     INITIALIZE DPG51 DPG52 DPG53                                 05670027
056800                DPG54 DPG55 DPG56.                                05680027
056900                                                                  05690027
057000     SET  PV-BATCH-DATE-CARD    TO TRUE.                          05700027
057100     MOVE EP812-CC-CRNT-DTE          TO DPG52-LK-DATE-INPUT.      05710027
057200                                                                  05720027
057300     PERFORM 6000-VALIDATE-DATE-INPUT.                            05730027
057400                                                                  05740027
057500     IF  PS-DATE-VALID                                            05750027
057600         MOVE EP812-CC-CRNT-DTE      TO PV-BATCH-DATE             05760027
057700     END-IF.                                                      05770027
057800                                                                  05780027
057900*1100-EXIT.                                                       05790027
058000******************************************************************05800027
058100*1200-DATE-ROUTINES.                                             *05810027
058200*  VALIDATE INPUT NEXT FUTURE DATE - USED FOR EXTRACT END DATE,  *05820027
058300*  AND CALCULATE START DATE FOR EXTRACT.                         *05830027
058400******************************************************************05840027
058500 1200-DATE-ROUTINES.                                              05850027
058600     MOVE '1200-DATE-ROUTINES       ' TO PV-PARAGRAPH-NAME        05860027
058700                                                                  05870027
058800** ABEND IF BATCH DATE CONTROL CARD IS EMPTY                      05880027
058900     IF  EP813-CC-FUTURE-DATE  = SPACES                           05890027
059000         MOVE '1200-DATE-ROUTINES        ' TO PV-PARAGRAPH-NAME   05900027
059100         MOVE 'FUTURE DATE IS EMPTY '      TO PV-OPERATION-MSG-1  05910027
059200         SET  AC-4003-CONTROL-CARD-ERROR   TO TRUE                05920027
059300         PERFORM 9800-ABEND                                       05930027
059400     END-IF.                                                      05940027
059500                                                                  05950027
059600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05960027
059700     SET  PV-NEXT-FUTURE-DATE-CARD  TO TRUE.                      05970027
059800     MOVE EP813-CC-FUTURE-DATE      TO DPG52-LK-DATE-INPUT.       05980027
059900                                                                  05990027
060000     PERFORM 6000-VALIDATE-DATE-INPUT.                            06000027
060100     PERFORM 6050-CALC-FUTURE-DATE.                               06010027
060200                                                                  06020027
060300     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP813-CC-FUTURE-DATE.      06030027
060400     PERFORM 6100-CALC-EXTR-START-DATE.                           06040027
060500                                                                  06050027
060600     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-EXTR-START-DTE.         06060027
060700                                                                  06070027
060800     DISPLAY ' '.                                                 06080027
060900     DISPLAY '=================================================='.06090027
061000     DISPLAY ' *  EPKUT435  * '.                                  06100027
061100     DISPLAY ' NEXT FUTURE DATE ====> '   EP813-CC-FUTURE-DATE.   06110027
061200     DISPLAY ' EXTRACT START DATE ==> '   PV-EXTR-START-DTE.      06120027
061300     DISPLAY '=================================================='.06130027
061400     DISPLAY ' '.                                                 06140027
061500                                                                  06150027
061600*1200-EXIT.                                                       06160027
061700******************************************************************06170027
061800*   1300-SETUP-FOR-ORACLE.                                       *06180027
061900*     SET UP TO CONNECT TO THE ORACLE DATABASE.                  *06190027
062000******************************************************************06200027
062100 1300-SETUP-FOR-ORACLE.                                           06210027
062200     MOVE '1300-SETUP-FOR-ORACLE          ' TO  PV-PARAGRAPH-NAME.06220027
062300*                                                                 06230027
062400                                                                  06240027
062500     READ ORACLE-LOGON-FILE INTO CC-ORACLE-CONNECTION             06250028
062600        AT END                                                    06260027
062700           SET ORACLE-LOGIN-EOF TO TRUE.                          06270027
062800     CLOSE ORACLE-LOGON-FILE.                                     06280028
062900                                                                  06290027
063000     IF  ((ORACLE-LOGIN-EOF)                                      06300027
063100           OR ((CC-ORACLE-CONNECTION = SPACES)))                  06310027
063200           DISPLAY '** ABEND **'                                  06320027
063300           DISPLAY ' ORACLE LOGON NOT PROVIDED'                   06330027
063400           MOVE    '1300-SET-UP-FOR-ORACLE'   TO PV-PARAGRAPH-NAME06340027
063500           PERFORM 9900-ORA-ERROR                                 06350027
063600     END-IF.                                                      06360027
063700                                                                  06370027
063800*---------------------------------------------------------------  06380027
063900* IF USERNAME-LEN IS ZERO, THE LOGON ID IS MISSING FROM SYSIN.    06390027
064000* THEREFORE IT IS A PRODUCTION RUN WHERE THE LOGON INFO COMES     06400027
064100* FROM THE JCL                                                    06410027
064200*---------------------------------------------------------------  06420027
064300     PERFORM 7000-CONNECT-TO-ORACLE.                              06430027
064400                                                                  06440027
064500*1300-EXIT.                                                       06450027
064600******************************************************************06460027
064700*   1400-POPULATE-BTN-TBL.                                       *06470027
064800*     POPULATE THE INTERNAL BUTTON INFO TABLE.                   *06480027
064900******************************************************************06490027
065000 1400-POPULATE-BTN-TBL.                                           06500027
065100     MOVE '1400-POPULATE-BTN-TBL           ' TO PV-PARAGRAPH-NAME.06510027
065200                                                                  06520027
065300     PERFORM 7100-DEC-OPEN-BTN-CURSOR.                            06530027
065400                                                                  06540027
065500     SET PS-NOT-END-OF-FETCH-BTN TO TRUE.                         06550027
065600                                                                  06560027
065700     SET PV-BTN-INDEX TO 1.                                       06570027
065800                                                                  06580027
065900     PERFORM 2300-PROCESS-BTN-CSR                                 06590027
066000          UNTIL PS-END-OF-FETCH-BTN.                              06600027
066100                                                                  06610027
066200     PERFORM 7200-CLOSE-BTN-CURSOR.                               06620027
066300                                                                  06630027
066400     PERFORM 2450-DISPLAY-BTN-CSR.                                06640027
066500                                                                  06650027
066600*1400-EXIT.                                                       06660027
066700******************************************************************06670027
066800* - LOAD THE TARGET STORE INTO INTERNAL ARRAY FOR THE SOURCE STORE06680027
066900******************************************************************06690027
067000 1500-LOAD-TARGET-ARRAY.                                          06700027
067100     IF PS-SOURCE-STORE                                           06710027
067200         MOVE INPUT-OFFER-ID      TO PV-OFFER-ID                  06720027
067300                                     SYSOUT-OFFER-ID              06730027
067400         MOVE 'SOURCE STORE  '    TO SYSOUT-FIELD-NAME (1)        06740027
067500                                                                  06750027
067600         MOVE INPUT-STORE         TO PV-SOURCE-STORE              06760027
067700                                     SYSOUT-STORE (1)             06770027
067800         MOVE INPUT-STR-GP-TYP-CDE                                06780027
067900                                  TO PV-STR-GP-TYP-CDE            06790027
068000         MOVE INPUT-STR-GRP-ID    TO PV-STR-GRP-ID                06800027
068100     ELSE                                                         06810027
068200         ADD +1                   TO PV-ARRAY-COUNT               06820027
068300         ADD +1                   TO PA-TARGET-STORE-COUNT        06830027
068400         MOVE 'TARGET STORE  '    TO                              06840027
068401                        SYSOUT-FIELD-NAME (PV-ARRAY-COUNT)        06840127
068402         MOVE INPUT-STORE         TO                              06840227
068403                        SYSOUT-STORE    (PV-ARRAY-COUNT)          06840327
068404                        PV-TARGET-STORE (PA-TARGET-STORE-COUNT)   06840427
068405     END-IF.                                                      06840527
068406                                                                  06840627
068407                                                                  06840727
068408     PERFORM 8250-READ-STORE-INPUT.                               06840827
068409                                                                  06840927
068410                                                                  06841027
068420*1500-EXIT.                                                       06842027
068430******************************************************************06843027
068431*   2000-PROCESS-RFRSH-STRS.                                     *06843127
068432*     MAIN DRIVING PARAGRAPH OF PROGRAM.                         *06843227
068433*   PROCESS AND READ INPUT STORE GROUP RECORDS FOR THE SOURCE    *06843327
068434*   STORE                                                        *06843427
068435*   THIS PARAGRAPH IS EXECUTED IF THERE ARE INPUT STR GRPS.      *06843527
068436*   - DECLARE AND OPEN OFFERS REFRESH CURSOR, FOR EACH INPUT     *06843627
068437*     STORE GROUP RECORD AND OFFER ID                            *06843727
068438*   - FETCH OFFERS DATA FOR EACH STORE GROUP IN INPUT.           *06843827
068439*   - READ NEXT RECORD.                                          *06843927
068440******************************************************************06844027
068450 2000-PROCESS-RFRSH-STRS.                                         06845027
068460     MOVE '2000-PROCESS-RFRSH-STRS      ' TO PV-PARAGRAPH-NAME.   06846027
068470                                                                  06847027
068480                                                                  06848027
068490     PERFORM 7300-DEC-OPEN-OFFER-CURSOR.                          06849027
068500                                                                  06850027
068600     PERFORM 2100-PROCESS-OFFER-REFRESH-CSR                       06860027
068700           UNTIL PS-END-OF-REFRESH-CSR.                           06870027
068800                                                                  06880027
068900     PERFORM 7500-CLOSE-OFFER-CURSOR.                             06890027
069000                                                                  06900027
069100     IF  PV-SOURCE-STORE  NOT EQUAL TO  PV-NEXT-SOURCE-STORE      06910027
069200         ADD +1 TO   PV-SRC-STORE-COUNT                           06920027
069300         PERFORM 5000-DISPLAY-STATS                               06930027
069400     END-IF.                                                      06940027
069500     SET  PS-NOT-END-OF-REFRESH-CSR TO TRUE.                      06950027
069600     IF PS-END-OF-INPUT                                           06960027
069700        SET PS-PROCESSED-ALL   TO TRUE                            06970027
069800        PERFORM 5000-DISPLAY-STATS                                06980027
069900     ELSE                                                         06990027
070000        PERFORM 5100-INITIALIZE                                   07000027
070100     END-IF                                                       07010027
070200                                                                  07020027
070300     PERFORM 1500-LOAD-TARGET-ARRAY                               07030027
070400       UNTIL PS-END-OF-TARGET OR                                  07040027
070500             PS-END-OF-INPUT.                                     07050027
070600                                                                  07060027
070700*2000-EXIT.                                                       07070027
070800******************************************************************07080027
070900*  2100-PROCESS-OFFER-REFRESH-CSR.                               *07090027
071000*   PROCESS THE INPUT STORE GROUP RECORDS TO OBTAIN OFFERS       *07100027
071100*   - PROCESS THE INPUT STORE GROUP RECORDS                      *07110027
071200******************************************************************07120027
071300 2100-PROCESS-OFFER-REFRESH-CSR.                                  07130027
071400     MOVE '2100-PROCESS-OFFER-REFRESH-CSR  ' TO PV-PARAGRAPH-NAME.07140027
071500                                                                  07150027
071600     SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE.                     07160027
071700                                                                  07170027
071800     PERFORM 7400-FETCH-OFFER-REFRESH-CSR.                        07180027
071900                                                                  07190027
072000     EVALUATE TRUE                                                07200027
072100       WHEN SQLCODE IS EQUAL TO ZEROS                             07210027
072200           ADD 1             TO PV-OFR-CRSR-RECS-FETCHED          07220027
072300           ADD 1             TO PV-OFR-CRSR-RECS-FETCHED1         07230027
072400           PERFORM EP208-1000-DETERMNE-FLD-OVRFLW                 07240027
072500           IF EPWS208-OFFER-DATA-IN-RANGE                         07250027
072600              PERFORM 2200-PROCESS-OFFER-DATA                     07260027
072700           END-IF                                                 07270027
072800       WHEN SQLCODE IS EQUAL TO PC-ROW-NOT-FOUND                  07280027
072900           SET PS-END-OF-REFRESH-CSR TO TRUE                      07290027
073000       WHEN OTHER                                                 07300027
073100           DISPLAY '**  BAD SQLCODE IN FETCH FROM OFFERCRSR  **'  07310027
073200           DISPLAY '**  CALLED FROM ' PV-PARAGRAPH-NAME '  **'    07320027
073300           MOVE 'FETCH DATA FROM OFFERCRSR '                      07330027
073400                                   TO PV-ORA-OPERATION            07340027
073500           PERFORM 7500-CLOSE-OFFER-CURSOR                        07350027
073600           PERFORM 9900-ORA-ERROR                                 07360027
073700     END-EVALUATE.                                                07370027
073800                                                                  07380027
073900*2100-EXIT.                                                       07390027
074000******************************************************************07400027
074100*   2200-PROCESS-OFFER-DATA.                                     *07410027
074200*     PROCESS FETCHED OFFER DATA.                                *07420027
074300******************************************************************07430027
074400 2200-PROCESS-OFFER-DATA.                                         07440027
074500     MOVE '2200-PROCESS-OFFER-DATA         ' TO PV-PARAGRAPH-NAME.07450027
074600                                                                  07460027
074700     PERFORM 3000-MOVE-COMMON-VALUES.                             07470027
074800                                                                  07480027
074900     IF OFR-ID IN OMT00001 NOT = PV-OFR-ID                        07490027
075000        PERFORM 3100-BUILD-XST-OFR-DATA                           07500027
075100        PERFORM 3200-BUILD-XST-SEC-DATA                           07510027
075200        PERFORM 3300-BUILD-XST-BWP-DATA                           07520027
075300        PERFORM 3400-BUILD-XST-MDSE-DATA                          07530027
075400        PERFORM 3500-BUILD-STORE-LIST-REC                         07540027
075500     ELSE                                                         07550027
075600       IF OFR-ID IN OMT00001 = PV-OFR-ID AND                      07560027
075700          OFR-SECT-TYP-CDE IN OMT00002 NOT = PV-OFR-SECT-TYP-CDE  07570027
075800          PERFORM 3200-BUILD-XST-SEC-DATA                         07580027
075900          PERFORM 3300-BUILD-XST-BWP-DATA                         07590027
076000          PERFORM 3400-BUILD-XST-MDSE-DATA                        07600027
076100       ELSE                                                       07610027
076200         IF OFR-ID IN OMT00001 = PV-OFR-ID AND                    07620027
076300            OFR-SECT-TYP-CDE IN OMT00002  =                       07630027
076400                                      PV-OFR-SECT-TYP-CDE AND     07640027
076500            OFR-SECT-BWP-ID IN OMT00003 NOT = PV-OFR-SECT-BWP-ID  07650027
076600            PERFORM 3300-BUILD-XST-BWP-DATA                       07660027
076700            PERFORM 3400-BUILD-XST-MDSE-DATA                      07670027
076800         ELSE                                                     07680027
076900           IF OFR-ID IN OMT00001 = PV-OFR-ID AND                  07690027
077000              OFR-SECT-TYP-CDE IN OMT00002 =                      07700027
077100                                           PV-OFR-SECT-TYP-CDE AND07710027
077200              OFR-SECT-BWP-ID IN OMT00003  =                      07720027
077300                                           PV-OFR-SECT-BWP-ID AND 07730027
077400              MDSE-SET-ID IN OMT00005 NOT = PV-MDSE-SET-ID        07740027
077500              PERFORM 3400-BUILD-XST-MDSE-DATA                    07750027
077600           END-IF                                                 07760027
077700         END-IF                                                   07770027
077800       END-IF                                                     07780027
077900     END-IF.                                                      07790027
078000                                                                  07800027
078100*2200-EXIT.                                                       07810027
078200******************************************************************07820027
078300*   2300-PROCESS-BTN-CSR.                                        *07830027
078400*   PROCESS THE BTNCRSR CURSOR AND POPULATE THE PROGRAM TABLE    *07840027
078500*    (PV-OMT-POS-BTN)                                            *07850027
078600******************************************************************07860027
078700 2300-PROCESS-BTN-CSR.                                            07870027
078800     MOVE '2300-PROCESS-BTN-CSR           ' TO PV-PARAGRAPH-NAME. 07880027
078900*                                                                 07890027
079000     SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE.                     07900027
079100                                                                  07910027
079200     PERFORM 7150-FETCH-BTN-CURSOR.                               07920027
079300                                                                  07930027
079400     EVALUATE TRUE                                                07940027
079500        WHEN SQLCODE IS EQUAL TO ZEROS                            07950027
079600            ADD 1 TO PV-POS-BTN-REC-FETCHED                       07960027
079700            IF  PV-POS-RLTV-NUM-NULL-IND = -1                     07970027
079800                SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE           07980027
079900            ELSE                                                  07990027
080000                PERFORM EP208-1100-DETERMNE-POS-OVRFLW            08000027
080100            END-IF                                                08010027
080200            IF  EPWS208-OFFER-DATA-IN-RANGE                       08020027
080300                PERFORM 2400-MOVE-BTNCRSR-VALUES                  08030027
080400            END-IF                                                08040027
080500        WHEN SQLCODE IS EQUAL TO PC-ROW-NOT-FOUND                 08050027
080600           SET  PS-END-OF-FETCH-BTN   TO TRUE                     08060027
080700        WHEN OTHER                                                08070027
080800           MOVE 'FETCH DATA FROM BTNCRSR   '                      08080027
080900                                   TO PV-ORA-OPERATION            08090027
081000           PERFORM 9900-ORA-ERROR                                 08100027
081100      END-EVALUATE.                                               08110027
081200                                                                  08120027
081300     IF PV-BTN-INDEX > PC-MAX-BTN-INDEX-VALUE                     08130027
081400        DISPLAY 'LIMIT OF POS-BTN-CURSOR ARRAY REACHED'           08140027
081500        MOVE '2300-PROCESS-BTN-CSR       ' TO PV-PARAGRAPH-NAME   08150027
081600        MOVE 'TABLE LIMIT REACHED FOR POS-BTN-ARRAY' TO           08160027
081700                             PV-OPERATION-MSG-1                   08170027
081800        SET AC-4004-TABLE-OVERFLOW-ERROR TO TRUE                  08180027
081900        PERFORM 9800-ABEND                                        08190027
082000     END-IF.                                                      08200027
082100                                                                  08210027
082200*2300-EXIT.                                                       08220027
082300******************************************************************08230027
082400*  2400-MOVE-BTNCRSR-VALUES.                                     *08240027
082500*  POPULATE INTERNAL TABLE OF POS BUTTONS                        *08250027
082600******************************************************************08260027
082700 2400-MOVE-BTNCRSR-VALUES.                                        08270027
082800                                                                  08280027
082900     MOVE POS-BTN-CDE IN OMT00006                                 08290027
083000                              TO PV-POS-BTN-CDE(PV-BTN-INDEX).    08300027
083100     MOVE POS-BTN-TXT IN OMT00006                                 08310027
083200                              TO PV-POS-BTN-TEXT(PV-BTN-INDEX).   08320027
083300*    THE OMT TABLE ALLOWS NULL IN POS-BTN-RLTV-SEQ-NBR,           08330027
083400*      SO MUST ACCOUNT FOR IT                                     08340027
083500     IF  PV-POS-RLTV-NUM-NULL-IND = -1                            08350027
083600         MOVE PC-NULL-FIELD-VALUE                                 08360027
083700           TO PV-POS-BTN-RLTV-SEQ-NBR-X(PV-BTN-INDEX)             08370027
083800     ELSE                                                         08380027
083900         MOVE POS-BTN-RLTV-SEQ-NBR IN OMT00006                    08390027
084000           TO PV-POS-BTN-RLTV-SEQ-NBR(PV-BTN-INDEX)               08400027
084100     END-IF.                                                      08410027
084200                                                                  08420027
084300     SET PV-BTN-INDEX UP BY 1.                                    08430027
084400                                                                  08440027
084500*2400-EXIT.                                                       08450027
084600******************************************************************08460027
084700*   2450-DISPLAY-BTN-CSR.                                        *08470027
084800*   DISPLAY CONTENTS OF BTNCRSR TABLE.                           *08480027
084900******************************************************************08490027
085000 2450-DISPLAY-BTN-CSR.                                            08500027
085100                                                                  08510027
085200     SET PV-BTN-INDEX TO 1.                                       08520027
085300     PERFORM VARYING PV-BTN-INDEX FROM 1 BY 1                     08530027
085400            UNTIL PV-BTN-INDEX > PC-MAX-BTN-INDEX-VALUE           08540027
085500              OR  PV-POS-BTN-CDE(PV-BTN-INDEX) = SPACES           08550027
085600                                                                  08560027
085700        DISPLAY                                                   08570027
085800            'POS BTN CDE > ' PV-POS-BTN-CDE(PV-BTN-INDEX)         08580027
085900           ' POS BTN TXT > ' PV-POS-BTN-TEXT(PV-BTN-INDEX)        08590027
086000           ' RLTV SEQ NBR> ' PV-POS-BTN-RLTV-SEQ-NBR(PV-BTN-INDEX)08600027
086100     END-PERFORM.                                                 08610027
086200                                                                  08620027
086300*2450-EXIT.                                                       08630027
086400******************************************************************08640027
086500* 3000-MOVE-COMMON-VALUES                                         08650027
086600* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITTEN OUT 08660027
086700******************************************************************08670027
086800 3000-MOVE-COMMON-VALUES.                                         08680027
086900     MOVE '3000-MOVE-COMMON-VALUES         ' TO PV-PARAGRAPH-NAME.08690027
087000                                                                  08700027
087100     SET  EP205-TRIGGER-TYPE-ADD TO TRUE.                         08710027
087200     SET  EP205-FILE-TYPE-FUL    TO TRUE.                         08720027
087300                                                                  08730027
087400     MOVE PV-STR-NBR                   TO EP205-STR-NBR.          08740027
087500     MOVE OFR-ID           IN OMT00001 TO EP205-OFFER-ID.         08750027
087600     MOVE EVNT-ID          IN OMT00001 TO EP205-EVENT-ID.         08760027
087700     MOVE OFR-SECT-TYP-CDE IN OMT00002 TO EP205-OFR-SECT-TYP-CDE. 08770027
087800                                                                  08780027
087900*3000-EXIT.                                                       08790027
088000******************************************************************08800027
088100* 3100-BUILD-XST-OFR-DATA                                         08810027
088200* BUILD OFFER RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH         08820027
088300******************************************************************08830027
088400 3100-BUILD-XST-OFR-DATA.                                         08840027
088500     MOVE '3100-BUILD-XST-OFR-DATA         ' TO PV-PARAGRAPH-NAME.08850027
088600                                                                  08860027
088700     INITIALIZE EP205-VARIABLE-DATA.                              08870027
088800     SET  EP205-XST-OFFER TO TRUE.                                08880027
088900                                                                  08890027
089000*    MOVE PC-DFLT-PROMO-SCHM-CDE-1008  TO EP205-PROMO-SCHM-CDE.   08900027
089100                                                                  08910027
089200     EVALUATE TRUE                                                08920027
089300         WHEN EVNT-TYP-CDE   IN OMT00009 = 'SP'                   08930027
089400            MOVE PC-DFLT-PROMO-SCHM-CDE-1008  TO                  08940027
089500                                      EP205-PROMO-SCHM-CDE        08950027
089600         WHEN EVNT-TYP-CDE   IN OMT00009 = 'TR'                   08960027
089700            MOVE PC-DFLT-PROMO-SCHM-CDE-1009  TO                  08970027
089800                                      EP205-PROMO-SCHM-CDE        08980027
089900         WHEN EVNT-TYP-CDE   IN OMT00009 = 'BW'                   08990027
090000            MOVE PC-DFLT-PROMO-SCHM-CDE-1010  TO                  09000027
090010                                      EP205-PROMO-SCHM-CDE        09001027
090020     END-EVALUATE.                                                09002027
090030                                                                  09003027
090040     MOVE EVNT-TYP-CDE     IN OMT00009 TO EP205-EVENT-TYP-CODE.   09004027
090050     MOVE EVNT-CTG-NM      IN OMT00007 TO EP205-EVENT-NAME.       09005027
090051     MOVE OFR-NM           IN OMT00001 TO EP205-OFFER-NAME.       09005127
090052     MOVE DISC-LVL-CDE     IN OMT00001 TO EP205-DISC-LEVEL-CODE.  09005227
090053     MOVE OFR-USG-TYP-CDE  IN OMT00001                            09005327
090054                                   TO EP205-OFFER-USAGE-TYPE-CODE.09005427
090055     MOVE BRCDE-TYP-CDE    IN OMT00001 TO EP205-BARCODE-TYPE-CODE.09005527
090056     MOVE UNEARN-IND       IN OMT00001 TO EP205-UNEARN-IND.       09005627
090057     MOVE OFR-TRGR-TYP-CDE IN OMT00001 TO EP205-OFR-TRGR-TYP-CDE. 09005727
090058                                                                  09005827
090059     IF PV-ITM-DISC-APL-NULL-IND = -1                             09005927
090060        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-ITM-APPL-CDE        09006027
090070     ELSE                                                         09007027
090080        MOVE ITM-DISC-APPL-CDE IN OMT00001                        09008027
090090                                       TO EP205-BWP-ITM-APPL-CDE  09009027
090100     END-IF.                                                      09010027
090200                                                                  09020027
090300     MOVE SPACES TO EP205-OFFER-FILLER.                           09030027
090400                                                                  09040027
090500     PERFORM 3600-BUILD-TARGET-STORE-OFFER.                       09050027
090600                                                                  09060027
090700     ADD 1 TO PV-OFFER-RECS-OUT.                                  09070027
090800     ADD 1 TO PV-OFFER-RECS-OUT1.                                 09080027
090900                                                                  09090027
091000     MOVE OFR-ID  IN OMT00001  TO PV-OFR-ID.                      09100027
091100     MOVE EVNT-ID IN OMT00001  TO PV-EVNT-ID.                     09110027
091200                                                                  09120027
091300*3100-EXIT.                                                       09130027
091400******************************************************************09140027
091500* 3200-BUILD-XST-SEC-DATA                                         09150027
091600* BUILD OFFER-SECT RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH    09160027
091700******************************************************************09170027
091800 3200-BUILD-XST-SEC-DATA.                                         09180027
091900     MOVE '3200-BUILD-XST-SEC-DATA         ' TO PV-PARAGRAPH-NAME.09190027
092000                                                                  09200027
092100     INITIALIZE EP205-VARIABLE-DATA.                              09210027
092200     SET  EP205-XST-OFR-SECT   TO TRUE.                           09220027
092300                                                                  09230027
092400     PERFORM 4000-CALCULATE-DATES.                                09240027
092500     MOVE BWP-GET-CNCTR-CDE IN OMT00002                           09250027
092600                               TO EP205-BWP-GET-CNCTR-CDE.        09260027
092700     MOVE BWP-BUY-CNCTR-CDE IN OMT00002                           09270027
092800                               TO EP205-BWP-BUY-CNCTR-CDE.        09280027
092900     MOVE VLD-POS-TNDR-COMB-TYP-CDE IN OMT00002                   09290027
093000                               TO EP205-VLD-POS-TNDR-CMP-TYP-CDE. 09300027
093100     MOVE LMT-PER-TRN-QTY   IN OMT00002 TO EP205-LMT-PER-TRN-QTY. 09310027
093200     MOVE CUSTFACG-SHRT-DESC IN OMT00008                          09320027
093300                               TO EP205-CUSTFACG-SHRT-DESC.       09330027
093400                                                                  09340027
093500     IF PV-POS-BTN-CDE-NULL-IND = -1                              09350027
093600         MOVE PC-NULL-FIELD-VALUE TO EP205-POS-BTN-TXT            09360027
093700         MOVE PC-NULL-FIELD-VALUE                                 09370027
093800                               TO EP205-POS-BTN-RLTV-SEQ-NBR-X    09380027
093900     ELSE                                                         09390027
094000         PERFORM 6200-POPULATE-BTN-VALUE                          09400027
094100     END-IF.                                                      09410027
094200                                                                  09420027
094300     PERFORM 3600-BUILD-TARGET-STORE-OFFER.                       09430027
094400                                                                  09440027
094500     ADD 1 TO PV-OFRSECT-RECS-OUT.                                09450027
094600     ADD 1 TO PV-OFRSECT-RECS-OUT1.                               09460027
094700     MOVE OFR-SECT-TYP-CDE IN OMT00002 TO PV-OFR-SECT-TYP-CDE.    09470027
094800                                                                  09480027
094900*3200-EXIT.                                                       09490027
095000******************************************************************09500027
095100* 3300-BUILD-XST-BWP-DATA                                         09510027
095200* BUILD OFFER BWP RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH     09520027
095300******************************************************************09530027
095400 3300-BUILD-XST-BWP-DATA.                                         09540027
095500     MOVE '3300-BUILD-XST-BWP-DATA         ' TO PV-PARAGRAPH-NAME.09550027
095600                                                                  09560027
095700     INITIALIZE EP205-VARIABLE-DATA.                              09570027
095800     SET  EP205-XST-OFR-BWP TO TRUE.                              09580027
095900                                                                  09590027
096000     MOVE OFR-SECT-BWP-ID  IN OMT00003 TO EP205-OFR-SECT-BWP-ID.  09600027
096100     MOVE TIER-LVL-NBR     IN OMT00003 TO EP205-TIER-LVL-NBR.     09610027
096200     MOVE BWP-SELN-TYP-CDE IN OMT00003 TO EP205-BWP-SELN-TYP-CDE. 09620027
096300                                                                  09630027
096400     IF PV-BWP-BUY-QTY-NULL-IND = -1                              09640027
096500        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-BUY-QTY-X           09650027
096600     ELSE                                                         09660027
096700        MOVE BWP-BUY-QTY IN OMT00003 TO EP205-BWP-BUY-QTY         09670027
096800     END-IF.                                                      09680027
096900                                                                  09690027
097000     IF PV-BWP-BUY-AMT-NULL-IND = -1                              09700027
097100        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-BUY-AMT-X           09710027
097200     ELSE                                                         09720027
097300        MOVE BWP-BUY-AMT IN OMT00003 TO EP205-BWP-BUY-AMT         09730027
097400     END-IF.                                                      09740027
097500                                                                  09750027
097600     IF PV-BWP-BUY-TOL-AMT-NULL-IND = -1                          09760027
097700        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-BUY-TOL-AMT-X       09770027
097800     ELSE                                                         09780027
097900        MOVE BWP-BUY-TOL-AMT IN OMT00003 TO EP205-BWP-BUY-TOL-AMT 09790027
098000     END-IF.                                                      09800027
098100                                                                  09810027
098200     IF PV-BWP-GET-QTY-NULL-IND = -1                              09820027
098300        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-QTY-X           09830027
098400     ELSE                                                         09840027
098500        MOVE BWP-GET-QTY   IN OMT00003 TO EP205-BWP-GET-QTY       09850027
098600     END-IF.                                                      09860027
098700                                                                  09870027
098800     IF PV-BWP-GET-PCT-NULL-IND = -1                              09880027
098900        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-PCT-OFF-PCT-X   09890027
099000     ELSE                                                         09900027
099100        MOVE BWP-GET-PCT-OFF-PCT IN OMT00003                      09910027
099200                                 TO EP205-BWP-GET-PCT-OFF-PCT     09920027
099300     END-IF.                                                      09930027
099400                                                                  09940027
099500     IF PV-BWP-GET-DOL-NULL-IND = -1                              09950027
099600        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-DOL-OFF-AMT-X   09960027
099700     ELSE                                                         09970027
099800        MOVE BWP-GET-DOL-OFF-AMT IN OMT00003                      09980027
099900                                 TO EP205-BWP-GET-DOL-OFF-AMT     09990027
100000     END-IF.                                                      10000027
100100                                                                  10010027
100200     IF PV-BWP-GET-PRPT-NULL-IND = -1                             10020027
100300        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-PRPT-AMT-X      10030027
100400     ELSE                                                         10040027
100500        MOVE BWP-GET-PRPT-AMT    IN OMT00003                      10050027
100600                                 TO EP205-BWP-GET-PRPT-AMT        10060027
100700     END-IF.                                                      10070027
100800                                                                  10080027
100900     PERFORM 3600-BUILD-TARGET-STORE-OFFER.                       10090027
101000                                                                  10100027
101100     ADD 1 TO PV-OFRBWP-RECS-OUT.                                 10110027
101200     ADD 1 TO PV-OFRBWP-RECS-OUT1.                                10120027
101300     MOVE OFR-SECT-BWP-ID IN OMT00003  TO PV-OFR-SECT-BWP-ID.     10130027
101400                                                                  10140027
101500*3300-EXIT.                                                       10150027
101600******************************************************************10160027
101700* 3400-BUILD-XST-MDSE-DATA                                        10170027
101800* BUILD OFFER MDSE RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH    10180027
101900******************************************************************10190027
102000 3400-BUILD-XST-MDSE-DATA.                                        10200027
102100     MOVE '3400-BUILD-XST-MDSE-DATA        ' TO PV-PARAGRAPH-NAME.10210027
102200                                                                  10220027
102300     INITIALIZE EP205-VARIABLE-DATA.                              10230027
102400     SET  EP205-XST-OFR-MDSE TO TRUE.                             10240027
102500                                                                  10250027
102600     MOVE OFR-SECT-BWP-ID  IN OMT00003 TO EP205-OFR-SECT-BWP-ID-M.10260027
102700     MOVE MDSE-SET-ID      IN OMT00005 TO EP205-MDSE-SET-ID.      10270027
102800     MOVE MDSE-HIER-CDE    IN OMT00005 TO EP205-MDSE-HIER-CDE.    10280027
102900                                                                  10290027
103000     IF PV-MDSE-DEPT-NBR-NULL-IND = -1                            10300027
103100        MOVE PC-NULL-FIELD-VALUE       TO EP205-DEPT-NBR-X        10310027
103200     ELSE                                                         10320027
103300        MOVE DEPT-NBR      IN OMT00005 TO EP205-DEPT-NBR          10330027
103400     END-IF.                                                      10340027
103500                                                                  10350027
103600     IF PV-MDSE-MAJ-CLS-NULL-IND = -1                             10360027
103700        MOVE PC-NULL-FIELD-VALUE       TO EP205-MAJ-CL-NBR-X      10370027
103800     ELSE                                                         10380027
103900        MOVE MAJ-CL-NBR    IN OMT00005 TO EP205-MAJ-CL-NBR        10390027
104000     END-IF.                                                      10400027
104100                                                                  10410027
104200     IF PV-MDSE-SUB-CLS-NULL-IND = -1                             10420027
104300        MOVE PC-NULL-FIELD-VALUE       TO EP205-SUB-CL-NBR-X      10430027
104400     ELSE                                                         10440027
104500        MOVE SUB-CL-NBR    IN OMT00005 TO EP205-SUB-CL-NBR        10450027
104600     END-IF.                                                      10460027
104700                                                                  10470027
104800     IF PV-MDSE-STL-ID-NULL-IND = -1                              10480027
104900        MOVE PC-NULL-FIELD-VALUE       TO EP205-STYL-ID-X         10490027
105000     ELSE                                                         10500027
105100        MOVE STYL-ID       IN OMT00005 TO EP205-STYL-ID           10510027
105200     END-IF.                                                      10520027
105300                                                                  10530027
105400     IF PV-MDSE-SKU-NB-NULL-IND = -1                              10540027
105500        MOVE PC-NULL-FIELD-VALUE       TO EP205-SKU-NBR-X         10550027
105600     ELSE                                                         10560027
105700        MOVE SKU-NBR       IN OMT00005 TO EP205-SKU-NBR           10570027
105800     END-IF.                                                      10580027
105900                                                                  10590027
106000     MOVE IE-IND           IN OMT00005 TO EP205-IE-IND.           10600027
106100                                                                  10610027
106200     IF PV-MDSE-EMP-DS-NULL-IND = -1                              10620027
106300        MOVE PC-NULL-FIELD-VALUE       TO EP205-EMP-DISC-CDE      10630027
106400     ELSE                                                         10640027
106500        MOVE EMP-DISC-CDE  IN OMT00005 TO EP205-EMP-DISC-CDE      10650027
106600     END-IF.                                                      10660027
106700                                                                  10670027
106800     IF PV-MDSE-DSC-EL-NULL-IND = -1                              10680027
106900        MOVE PC-NULL-FIELD-VALUE       TO EP205-DISC-ELIG-IND     10690027
107000     ELSE                                                         10700027
107100        MOVE DISC-ELIG-IND IN OMT00005 TO EP205-DISC-ELIG-IND     10710027
107200     END-IF.                                                      10720027
107300                                                                  10730027
107400     IF PV-MDSE-TKT-CL-NULL-IND = -1                              10740027
107500        MOVE PC-NULL-FIELD-VALUE       TO EP205-TKT-CLOR-CDE      10750027
107600     ELSE                                                         10760027
107700        MOVE TKT-CLOR-CDE  IN OMT00005 TO EP205-TKT-CLOR-CDE      10770027
107800     END-IF.                                                      10780027
107900                                                                  10790027
108000     PERFORM 3600-BUILD-TARGET-STORE-OFFER.                       10800027
108100                                                                  10810027
108200     ADD 1 TO PV-MDSESET-RECS-OUT.                                10820027
108300     ADD 1 TO PV-MDSESET-RECS-OUT1.                               10830027
108400     MOVE MDSE-SET-ID      IN OMT00005 TO PV-MDSE-SET-ID.         10840027
108500                                                                  10850027
108600*3400-EXIT.                                                       10860027
108700******************************************************************10870027
108800* 3500-BUILD-STORE-LIST-REC                                       10880027
108900* BUILD STORE LIST RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH    10890027
109000******************************************************************10900027
109100 3500-BUILD-STORE-LIST-REC.                                       10910027
109200     MOVE '3500-BUILD-STORE-LIST-REC       ' TO PV-PARAGRAPH-NAME.10920027
109300                                                                  10930027
109400     INITIALIZE EP206-STORE-LIST-RCD.                             10940027
109500                                                                  10950027
109600     SET  EP206-ADD                  TO TRUE.                     10960027
109700     MOVE PV-EVNT-ID                 TO EP206-EVENT-ID.           10970027
109800     MOVE PV-OFR-ID                  TO EP206-OFFER-ID.           10980027
109900     MOVE PV-OFR-SECT-TYP-CDE        TO EP206-OFR-SECT-TYP-CDE.   10990027
110000     MOVE PC-STR-GP-TYP-SPECIFIC-STR TO EP206-STR-GRP-TYP-CDE.    11000027
110100     SET  EP206-STR-GP-INCLUDED      TO TRUE.                     11010027
110200     PERFORM                                                      11020027
110300       VARYING PV-TARGET-STORE-SUB                                11030027
110400         FROM 1 BY 1 UNTIL                                        11040027
110500           PV-TARGET-STORE-SUB > PA-TARGET-STORE-COUNT            11050027
110600             MOVE PV-TARGET-STORE (PV-TARGET-STORE-SUB)           11060027
110610               TO PV-STORE-NUM                                    11061027
110620             MOVE PV-STORE-NUM       TO EP206-STR-GRP-ID          11062027
110630                                        EP206-STORE-NUMBER        11063027
110640             PERFORM 8400-WRITE-STR-LIST-REC                      11064027
110650     END-PERFORM.                                                 11065027
110660                                                                  11066027
110670                                                                  11067027
110680*3500-EXIT.                                                       11068027
110690***************************************************************** 11069027
110700* - BUILD 1 TARGET STORE RECORD FOR EACH TARGET STORE READ        11070027
110800*   FROM THE INPUT FILE, BY OVERLAYING THE SOURCE STORE NUMBER    11080027
110900*   WITH THE TARGET STORE NUMBER.                                 11090027
111000***************************************************************** 11100027
111010 3600-BUILD-TARGET-STORE-OFFER.                                   11101027
111020     PERFORM                                                      11102027
111030       VARYING PV-TARGET-STORE-SUB                                11103027
111040         FROM 1 BY 1 UNTIL                                        11104027
111050           PV-TARGET-STORE-SUB > PA-TARGET-STORE-COUNT            11105027
111060             MOVE PV-TARGET-STORE (PV-TARGET-STORE-SUB)           11106027
111070               TO PV-STORE-NUM                                    11107027
111080             MOVE PV-STORE-NUM  TO EP205-STR-NBR                  11108027
111090             PERFORM 8300-WRITE-XST-OFR-DATA                      11109027
111091     END-PERFORM.                                                 11109127
111092                                                                  11109227
111093*3600-EXIT.                                                       11109327
111094******************************************************************11109427
111095* 4000-CALCULATE-DATES                                            11109527
111096* CALCULATE DATES, BASED UPON TOL-STRT-NMOFDA-QTY                 11109627
111097******************************************************************11109727
111098 4000-CALCULATE-DATES.                                            11109827
111099     MOVE '4000-CALCULATE-DATES       ' TO PV-PARAGRAPH-NAME.     11109927
111100                                                                  11110027
111200     IF TOL-STRT-NMOFDA-QTY IN OMT00002 = 0                       11120027
111300        MOVE EFF-BEG-TMST IN OMT00002 TO PV-EFF-BEG-TMST          11130027
111400        MOVE PV-EFF-BEG-DATE          TO PV-FORMAT-DATE           11140027
111500        MOVE PV-FORMAT-DATE-CCYY      TO PV-DATE-CCYY             11150027
111600        MOVE PV-FORMAT-DATE-MM        TO PV-DATE-MM               11160027
111700        MOVE PV-FORMAT-DATE-DD        TO PV-DATE-DD               11170027
111800        MOVE PV-EFF-DATE              TO EP205-EFF-BEG-DTE        11180027
111900     ELSE                                                         11190027
112000        PERFORM 4100-CALC-EFF-BEG-DATE                            11200027
112100     END-IF.                                                      11210027
112200                                                                  11220027
112300     IF TOL-END-NMOFDA-QTY IN OMT00002 = 0                        11230027
112400        MOVE EFF-END-TMST IN OMT00002 TO PV-EFF-END-TMST          11240027
112500        MOVE PV-EFF-END-DATE          TO PV-FORMAT-DATE           11250027
112600        MOVE PV-FORMAT-DATE-CCYY      TO PV-DATE-CCYY             11260027
112700        MOVE PV-FORMAT-DATE-MM        TO PV-DATE-MM               11270027
112800        MOVE PV-FORMAT-DATE-DD        TO PV-DATE-DD               11280027
112900        MOVE PV-EFF-DATE              TO EP205-EFF-END-DTE        11290027
113000     ELSE                                                         11300027
113100        PERFORM 4200-CALC-EFF-END-DATE                            11310027
113200     END-IF.                                                      11320027
113300                                                                  11330027
113400     IF REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002 = 0             11340027
113500        MOVE EP205-EFF-END-DTE    TO EP205-REDMN-SUPVR-OVRRID-DTE 11350027
113600     ELSE                                                         11360027
113700        PERFORM 4300-CALC-SUP-END-DATE                            11370027
113800     END-IF.                                                      11380027
113900                                                                  11390027
114000*4000-EXIT.                                                       11400027
114100******************************************************************11410027
114200* 4100-CALC-EFF-BEG-DATE                                          11420027
114300* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     11430027
114400* THE EFFECTIVE BEGIN DATE FOR THE POS STORE SERVER DB.           11440027
114500* WHICH WILL BE THE (EFF-BEG-TMST - TOL-START-QTY)                11450027
114600******************************************************************11460027
114700 4100-CALC-EFF-BEG-DATE.                                          11470027
114800                                                                  11480027
114900     MOVE EFF-BEG-TMST IN OMT00002  TO PV-EFF-BEG-TMST.           11490027
115000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11500027
115100     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      11510027
115200     SET DPG51-DECREMENT-DATE       TO TRUE.                      11520027
115300     MOVE TOL-STRT-NMOFDA-QTY  IN OMT00002                        11530027
115400                                    TO DPG51-INCR-DECR-DAYS-9.    11540027
115500     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11550027
115600     MOVE PV-EFF-BEG-DATE           TO DPG52-LK-DATE-INPUT.       11560027
115700                                                                  11570027
115800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          11580027
115900                                             DPG53 DPG54          11590027
116000                                             DPG55 DPG56.         11600027
116100                                                                  11610027
116200     EVALUATE TRUE                                                11620027
116300         WHEN DPG54-NO-ERROR                                      11630027
116400             CONTINUE                                             11640027
116500         WHEN OTHER                                               11650027
116600             DISPLAY ' '                                          11660027
116700             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    11670027
116800                       ' TO CALCULATE EFFECTIVE BEGIN DATE'       11680027
116900             DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    11690027
117000             DISPLAY '** DPG51-CALENDAR-TYPE = '                  11700027
117100                                         DPG51-CALENDAR-TYPE      11710027
117200             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE11720027
117300             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      11730027
117400                      ', INCREMENT/DECREMENT FLAG = '             11740027
117500                                  DPG51-INCREMENT-DECREMENT-FLAG  11750027
117600                      ', DECREMENT DAYS = '                       11760027
117700                                  DPG51-INCR-DECR-DAYS-9-X        11770027
117800             MOVE '4100-CALC-EFF-BEG-DATE' TO PV-PARAGRAPH-NAME   11780027
117900             MOVE 'ERROR CALCULATING EFF BEGIN DATE'              11790027
118000                                           TO PV-OPERATION-MSG-1  11800027
118100             SET  AC-4019-CAL-SUB-ERROR    TO TRUE                11810027
118200             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  11820027
118300             PERFORM 9800-ABEND                                   11830027
118400      END-EVALUATE.                                               11840027
118500                                                                  11850027
118600      MOVE DPG55-DB2-ISO-DATE     TO EP205-EFF-BEG-DTE.           11860027
118700                                                                  11870027
118800*4100-EXIT.                                                       11880027
118900******************************************************************11890027
119000* 4200-CALC-EFF-END-DATE                                          11900027
119100* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     11910027
119200* THE EFFECTIVE END DATE FOR THE POS STORE SERVER DB.             11920027
119300******************************************************************11930027
119400 4200-CALC-EFF-END-DATE.                                          11940027
119500     MOVE '4200-CALC-EFF-END-DATE     ' TO PV-PARAGRAPH-NAME.     11950027
119600                                                                  11960027
119700     MOVE EFF-END-TMST IN OMT00002    TO PV-EFF-END-TMST.         11970027
119800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11980027
119900     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    11990027
120000     SET  DPG51-INCREMENT-DATE        TO TRUE.                    12000027
120100     MOVE TOL-END-NMOFDA-QTY IN OMT00002 TO                       12010027
120200                                    DPG51-INCR-DECR-DAYS-9.       12020027
120300     SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    12030027
120400     MOVE PV-EFF-END-DATE             TO DPG52-LK-DATE-INPUT.     12040027
120500                                                                  12050027
120600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          12060027
120700                                             DPG53 DPG54          12070027
120800                                             DPG55 DPG56.         12080027
120900                                                                  12090027
121000     EVALUATE TRUE                                                12100027
121100         WHEN DPG54-NO-ERROR                                      12110027
121200             CONTINUE                                             12120027
121300         WHEN OTHER                                               12130027
121400             DISPLAY ' '                                          12140027
121500             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    12150027
121600                       ' TO CALCULATE EFFECTIVE END DATE'         12160027
121700             DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    12170027
121800             DISPLAY '** DPG51-CALENDAR-TYPE = '                  12180027
121900                                         DPG51-CALENDAR-TYPE      12190027
122000             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE12200027
122100             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      12210027
122200                      ', INCREMENT/DECREMENT FLAG = '             12220027
122300                                  DPG51-INCREMENT-DECREMENT-FLAG  12230027
122400                      ', INCREMENT DAYS = '                       12240027
122500                                  DPG51-INCR-DECR-DAYS-9-X        12250027
122600             MOVE '4200-CALC-EFF-END-DATE'                        12260027
122700                                           TO PV-PARAGRAPH-NAME   12270027
122800             MOVE 'ERROR CALCULATING EFF END DATE'                12280027
122900                                           TO PV-OPERATION-MSG-1  12290027
123000             SET  AC-4019-CAL-SUB-ERROR    TO TRUE                12300027
123100             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  12310027
123200             PERFORM 9800-ABEND                                   12320027
123300      END-EVALUATE.                                               12330027
123400                                                                  12340027
123500      MOVE DPG55-DB2-ISO-DATE     TO EP205-EFF-END-DTE.           12350027
123600                                                                  12360027
123700*4200-EXIT.                                                       12370027
123800******************************************************************12380027
123900* 4300-CALC-SUP-END-DATE                                          12390027
124000* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     12400027
124100* THE SUPERVISOR END DATE FOR THE POS STORE SERVER DB.            12410027
124200******************************************************************12420027
124300 4300-CALC-SUP-END-DATE.                                          12430027
124400     MOVE '4300-CALC-SUP-END-DATE     ' TO PV-PARAGRAPH-NAME.     12440027
124500                                                                  12450027
124600     MOVE EFF-END-TMST IN OMT00002   TO PV-EFF-END-TMST.          12460027
124700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              12470027
124800     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     12480027
124900     SET  DPG51-INCREMENT-DATE       TO TRUE.                     12490027
125000     ADD  TOL-END-NMOFDA-QTY IN OMT00002   TO                     12500027
125100          REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002               12510027
125200     MOVE REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002 TO            12520027
125300                                    DPG51-INCR-DECR-DAYS-9.       12530027
125400     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     12540027
125500     MOVE PV-EFF-END-DATE            TO DPG52-LK-DATE-INPUT.      12550027
125600                                                                  12560027
125700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          12570027
125800                                             DPG53 DPG54          12580027
125900                                             DPG55 DPG56.         12590027
126000                                                                  12600027
126100     EVALUATE TRUE                                                12610027
126200         WHEN DPG54-NO-ERROR                                      12620027
126300             MOVE DPG55-DB2-ISO-DATE                              12630027
126400                                  TO EP205-REDMN-SUPVR-OVRRID-DTE 12640027
126500         WHEN OTHER                                               12650027
126600             DISPLAY ' '                                          12660027
126700             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    12670027
126800                     ' TO CALCULATE SUPERVISOR END DATE'          12680027
126900             DISPLAY '** CALLED BY 4300-CALC-SUP-END-DATE'        12690027
127000             DISPLAY '** ERROR MESSAGE = '                        12700027
127100                               DPG54-ERROR-MESSAGE                12710027
127200             DISPLAY '** DPG51-CALENDAR-TYPE = '                  12720027
127300                                         DPG51-CALENDAR-TYPE      12730027
127400             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE12740027
127500             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      12750027
127600                      ', INCREMENT/DECREMENT FLAG = '             12760027
127700                                  DPG51-INCREMENT-DECREMENT-FLAG  12770027
127800                      ', INCREMENT DAYS = '                       12780027
127900                                  DPG51-INCR-DECR-DAYS-9-X        12790027
128000             MOVE '4300-CALC-SUP-END-DATE'                        12800027
128100                                           TO PV-PARAGRAPH-NAME   12810027
128200             MOVE 'ERROR CALCULATING SUP OVERRIDE END DATE'       12820027
128300                                           TO PV-OPERATION-MSG-1  12830027
128400             SET  AC-4019-CAL-SUB-ERROR    TO TRUE                12840027
128500             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  12850027
128600             PERFORM 9800-ABEND                                   12860027
128700      END-EVALUATE.                                               12870027
128800                                                                  12880027
128900*4300-EXIT.                                                       12890027
129000*----------------------------------------------------------       12900027
129100* - DISPLAY THE NUMBER OF RECORDS READ, WRITTEN AND IN ERROR.    *12910027
129200* - DISPLAY SYSOUT LINE FOR EACH INPUT RECORD READ.              *12920027
129300*----------------------------------------------------------       12930027
129400 5000-DISPLAY-STATS.                                              12940027
129500                                                                  12950027
129501     DISPLAY ' '.                                                 12950127
129502     DISPLAY 'JOB TOTALS'                                         12950227
129503     DISPLAY '----------'                                         12950327
129504     DISPLAY 'INPUT RECORD COUNT       = ' PA-INPUT-RECS-READ.    12950427
129505     DISPLAY 'TARGET STORE COUNT       = ' PA-TARGET-STORE-COUNT. 12950527
129506     DISPLAY ' '.                                                 12950627
129507     DISPLAY 'DETAILS'                                            12950727
129508     DISPLAY '-------'                                            12950827
129509     DISPLAY SYSOUT-OFFER-REQUEST-RECORD.                         12950927
129510     DISPLAY ' '.                                                 12951027
129511     DISPLAY SYSOUT-HEADER-1.                                     12951127
129512     DISPLAY SYSOUT-HEADER-2.                                     12951227
129513     PERFORM                                                      12951327
129514       VARYING PV-SYSOUT-SUB FROM 1 BY 1                          12951427
129515         UNTIL PV-SYSOUT-SUB > PV-ARRAY-COUNT                     12951527
129516            OR PV-SYSOUT-SUB > 1000                               12951627
129517           DISPLAY SYSOUT-STORE-RECORDS (PV-SYSOUT-SUB)           12951727
129518     END-PERFORM.                                                 12951827
129519                                                                  12951927
129520     DISPLAY ' '.                                                 12952027
129521     DISPLAY '** OFFER CRSR RECS FETCHED => '                     12952127
129522             PV-OFR-CRSR-RECS-FETCHED1                            12952227
129523             ' **'.                                               12952327
129524     DISPLAY '** OFFER RCDS WRITTEN ======> '                     12952427
129525             PV-OFFER-RECS-OUT1                                   12952527
129526             ' **'.                                               12952627
129527     DISPLAY '** OFFER SECT RCDS WRITTEN => '                     12952727
129528             PV-OFRSECT-RECS-OUT1                                 12952827
129529             ' **'.                                               12952927
129530     DISPLAY '** OFFER BWP RCDS WRITTEN ==> '                     12953027
129531             PV-OFRBWP-RECS-OUT1                                  12953127
129532             ' **'.                                               12953227
129533     DISPLAY '** MDSE SET RCDS WRITTEN ===> '                     12953327
129534             PV-MDSESET-RECS-OUT1                                 12953427
129535             ' **'.                                               12953527
129536     DISPLAY '** STR LIST RCDS WRITTEN ===> '                     12953627
129537             PV-STR-LIST-RECS-OUT1                                12953727
129538             ' **'.                                               12953827
129539     INITIALIZE PV-OFR-CRSR-RECS-FETCHED1                         12953927
129540                PV-OFFER-RECS-OUT1                                12954027
129541                PV-OFRSECT-RECS-OUT1                              12954127
129542                PV-OFRBWP-RECS-OUT1                               12954227
129543                PV-MDSESET-RECS-OUT1                              12954327
129544                PV-STR-LIST-RECS-OUT1.                            12954427
129545                                                                  12954527
129546                                                                  12954627
129547*5000-EXIT.                                                       12954727
129548*----------------------------------------------------------       12954827
129549* - INITIALIZE THE VARIABLE FOR PROCESSING THE NEXT SET OF        12954927
129550*   SOURCE STORE AND TARGET STORES IN THE INPUT FILE              12955027
129560*----------------------------------------------------------       12956027
129561 5100-INITIALIZE.                                                 12956127
129562                                                                  12956227
129563     PERFORM                                                      12956327
129564       VARYING PV-SYSOUT-SUB FROM 1 BY 1                          12956427
129565         UNTIL PV-SYSOUT-SUB > PV-ARRAY-COUNT                     12956527
129566            OR PV-SYSOUT-SUB > 1000                               12956627
129567           INITIALIZE SYSOUT-STORE-RECORDS (PV-SYSOUT-SUB)        12956727
129568           INITIALIZE PV-TARGET-STORE (PV-SYSOUT-SUB)             12956827
129569     END-PERFORM.                                                 12956927
129570                                                                  12957027
129580     INITIALIZE PV-OFFER-ID                                       12958027
129590                PA-TARGET-STORE-COUNT                             12959027
129591                PV-ARRAY-COUNT                                    12959127
129592                PS-END-OF-TARGET-SW.                              12959227
129593     SET PS-SOURCE-STORE            TO TRUE.                      12959327
129594     MOVE 1 TO PV-ARRAY-COUNT.                                    12959427
129595                                                                  12959527
129596*5100-EXIT.                                                       12959627
129597 EJECT.                                                           12959727
129598******************************************************************12959827
129599* 6000-VALIDATE-DATE-INPUT.                                       12959927
129600*     VALIDIATE THE DATE INPUT BY CALLING THE KOHLS CALENDAR      12960027
129610*     ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.     12961027
129620******************************************************************12962027
129630 6000-VALIDATE-DATE-INPUT.                                        12963027
129640     MOVE '6000-VALIDATE-DATE-INPUT   ' TO PV-PARAGRAPH-NAME.     12964027
129650                                                                  12965027
129660     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      12966027
129670     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      12967027
129680     SET PS-DATE-NOT-VALID          TO TRUE.                      12968027
129690                                                                  12969027
129700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    12970027
129800                                             DPG54 DPG55 DPG56.   12980027
129900                                                                  12990027
130000     EVALUATE TRUE                                                13000027
130100        WHEN DPG54-NO-ERROR                                       13010027
130200           SET   PS-DATE-VALID      TO TRUE                       13020027
130300        WHEN OTHER                                                13030027
130400           SET   PS-DATE-NOT-VALID  TO TRUE                       13040027
130500           DISPLAY ' '                                            13050027
130600           DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'      13060027
130700           DISPLAY '** CALLED BY 6000-VALIDATE-DATE-INPUT'        13070027
130800           DISPLAY '** TO VALIDATE ' PV-CALLING-FUNCTION          13080027
130900           DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE      13090027
131000           DISPLAY '** CALENDAR TYPE = ' DPG51-CALENDAR-TYPE      13100027
131100           DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE  13110027
131200           DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT        13120027
131300           MOVE '6000-VALIDATE-DATE-INPUT' TO PV-PARAGRAPH-NAME   13130027
131400           MOVE 'INVALID DATE PASSED IN CNTL CARD'                13140027
131500                                            TO PV-OPERATION-MSG-1 13150027
131600           MOVE  DPG54-ERROR-MESSAGE        TO PV-OPERATION-MSG-2 13160027
131700           SET   AC-4019-CAL-SUB-ERROR      TO TRUE               13170027
131800           PERFORM 9800-ABEND                                     13180027
131900     END-EVALUATE.                                                13190027
132000                                                                  13200027
132100*6000-EXIT.                                                       13210027
132200******************************************************************13220027
132300* 6050-CALC-FUTURE-DATE.                                          13230027
132400*     USE THE KOHLS DATE ROUTINE TO CALCULATE THE FUTURE DATE     13240027
132500*     SUBTRACT 1 DAY FROM THE FUTURE DATE AVAILABLE IN THE        13250027
132600*     CONTROL CARD                                                13260027
132700******************************************************************13270027
132800 6050-CALC-FUTURE-DATE.                                           13280027
132900     MOVE '6050-CALC-FUTURE-DATE      ' TO PV-PARAGRAPH-NAME.     13290027
133000                                                                  13300027
133100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              13310027
133200     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      13320027
133210     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      13321027
133220     SET DPG51-DECREMENT-DATE       TO TRUE.                      13322027
133230     SET PS-DATE-NOT-FOUND          TO TRUE.                      13323027
133240                                                                  13324027
133250     MOVE EP813-CC-FUTURE-DATE      TO DPG52-LK-DATE-INPUT.       13325027
133260                                                                  13326027
133270     MOVE PC-SUB-DAYS               TO DPG51-INCR-DECR-DAYS-9.    13327027
133280                                                                  13328027
133290     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13329027
133300                                             DPG54 DPG55 DPG56.   13330027
133301                                                                  13330127
133302     EVALUATE TRUE                                                13330227
133303        WHEN DPG54-NO-ERROR                                       13330327
133304           SET    PS-DATE-FOUND     TO TRUE                       13330427
133305        WHEN OTHER                                                13330527
133306           SET    PS-DATE-NOT-FOUND TO TRUE                       13330627
133307           DISPLAY ' '                                            13330727
133308           DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'      13330827
133309           DISPLAY '** CALLED BY 6100-CALC-EXTR-START-DATE '      13330927
133310           DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE      13331027
133311           DISPLAY '** DPG51-CALENDAR-TYPE = '                    13331127
133312                                       DPG51-CALENDAR-TYPE        13331227
133313           DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE  13331327
133314           DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT        13331427
133315                    ', INCREMENT/DECREMENT FLAG = '               13331527
133316                                DPG51-INCREMENT-DECREMENT-FLAG    13331627
133317                    ', DECREMENT DAYS = '                         13331727
133318                                DPG51-INCR-DECR-DAYS-9-X          13331827
133319           MOVE '6050-CALC-FUTURE-DATE    '                       13331927
133320                                         TO PV-PARAGRAPH-NAME     13332027
133321           MOVE 'ERROR CALCULATING FUTURE DATE       '            13332127
133322                                         TO PV-OPERATION-MSG-1    13332227
133323           MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2    13332327
133324           SET  AC-4019-CAL-SUB-ERROR    TO TRUE                  13332427
133325           PERFORM 9800-ABEND                                     13332527
133326     END-EVALUATE.                                                13332627
133327                                                                  13332727
133328*6050-EXIT.                                                       13332827
133329******************************************************************13332927
133330* 6100-CALC-EXTR-START-DATE.                                      13333027
133331*     USE THE KOHLS DATE ROUTINE TO CALCULATE THE START DATE FOR  13333127
133332*     THE OFFERS EXTRACT.  AT THIS TIME, THE START DATE IS        13333227
133333*     365 DAYS PRIOR TO THE BATCH DATE.                           13333327
133334*     THIS DATE IS ADJUSTED BY TOLERANCES TO SELECT THE OFFERS.   13333427
133335******************************************************************13333527
133336 6100-CALC-EXTR-START-DATE.                                       13333627
133337     MOVE '6100-CALC-EXTR-START-DATE  ' TO PV-PARAGRAPH-NAME.     13333727
133338                                                                  13333827
133339     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              13333927
133340     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      13334027
133350     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      13335027
133360     SET DPG51-DECREMENT-DATE       TO TRUE.                      13336027
133370     SET PS-DATE-NOT-FOUND          TO TRUE.                      13337027
133380                                                                  13338027
133390     MOVE PV-BATCH-DATE             TO DPG52-LK-DATE-INPUT.       13339027
133400                                                                  13340027
133500     MOVE PC-START-DTE-DECR-DAYS    TO DPG51-INCR-DECR-DAYS-9.    13350027
133600                                                                  13360027
133700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13370027
133800                                             DPG54 DPG55 DPG56.   13380027
133900                                                                  13390027
134000     EVALUATE TRUE                                                13400027
134100        WHEN DPG54-NO-ERROR                                       13410027
134200           SET    PS-DATE-FOUND     TO TRUE                       13420027
134300        WHEN OTHER                                                13430027
134400           SET    PS-DATE-NOT-FOUND TO TRUE                       13440027
134500           DISPLAY ' '                                            13450027
134600           DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'      13460027
134700           DISPLAY '** CALLED BY 6100-CALC-EXTR-START-DATE '      13470027
134800           DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE      13480027
134900           DISPLAY '** DPG51-CALENDAR-TYPE = '                    13490027
135000                                       DPG51-CALENDAR-TYPE        13500027
135100           DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE  13510027
135200           DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT        13520027
135300                    ', INCREMENT/DECREMENT FLAG = '               13530027
135400                                DPG51-INCREMENT-DECREMENT-FLAG    13540027
135500                    ', DECREMENT DAYS = '                         13550027
135600                                DPG51-INCR-DECR-DAYS-9-X          13560027
135700           MOVE '6100-CALC-EXTR-START-DATE'                       13570027
135800                                         TO PV-PARAGRAPH-NAME     13580027
135900           MOVE 'ERROR CALCULATING EXTRACT START DATE'            13590027
136000                                         TO PV-OPERATION-MSG-1    13600027
136100           MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2    13610027
136200           SET  AC-4019-CAL-SUB-ERROR    TO TRUE                  13620027
136300           PERFORM 9800-ABEND                                     13630027
136400     END-EVALUATE.                                                13640027
136500                                                                  13650027
136600*6100-EXIT.                                                       13660027
136700******************************************************************13670027
136800* 6200-POPULATE-BTN-VALUE                                         13680027
136900*  THIS PARAGRAPH WILL POPULATE THE POS-BTN-TXT AND THE           13690027
137000*  POS-BTN-RLTV-SEQ-NBR IN THE OUTPUT FILE, FOR A NON NULL        13700027
137100*  VALUE OF POS-BTN-CDE IN OMT_OFR_SECT TABLE.                    13710027
137200******************************************************************13720027
137300 6200-POPULATE-BTN-VALUE.                                         13730027
137400     MOVE '6200-POPULATE-BTN-VALUE  ' TO PV-PARAGRAPH-NAME.       13740027
137500                                                                  13750027
137600     SET PV-BTN-INDEX TO 1                                        13760027
137700     SEARCH PV-BTN-RECORD                                         13770027
137800       AT END                                                     13780027
137900          DISPLAY '*** POS-BTN-CDE NOT FOUND IN INTERNAL TBL ***' 13790027
138000          MOVE 'SEARCH FOR POS-BTN-CDE FAILED'                    13800027
138100                                     TO PV-OPERATION-MSG-1        13810027
138200          STRING 'POS-BTN-CDE > '         DELIMITED BY SIZE       13820027
138300                 POS-BTN-CDE IN OMT00002  DELIMITED BY SIZE       13830027
138400                                   INTO PV-OPERATION-MSG-2        13840027
138500          SET   AC-4008-INVALID-DATA TO TRUE                      13850027
138600          PERFORM 9800-ABEND                                      13860027
138700       WHEN POS-BTN-CDE IN OMT00002 = PV-POS-BTN-CDE(PV-BTN-INDEX)13870027
138800          MOVE PV-POS-BTN-TEXT(PV-BTN-INDEX)                      13880027
138900                                 TO EP205-POS-BTN-TXT             13890027
139000          MOVE PV-POS-BTN-RLTV-SEQ-NBR-X(PV-BTN-INDEX)            13900027
139100                                 TO EP205-POS-BTN-RLTV-SEQ-NBR-X  13910027
139200     END-SEARCH.                                                  13920027
139300                                                                  13930027
139400*6200-EXIT.                                                       13940027
139500******************************************************************13950027
139600*   7000-CONNECT-TO-ORACLE.                                      *13960027
139700*     CONNECT TO THE ORACLE DATABASE.                            *13970027
139800******************************************************************13980027
139900 7000-CONNECT-TO-ORACLE.                                          13990027
140000     MOVE '7000-CONNECT-TO-ORACLE          ' TO PV-PARAGRAPH-NAME.14000027
140100*                                                                 14010027
140200                                                                  14020027
140300     IF CC-AUTO-LOGON                                             14030027
140400        DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         14040027
140500        EXEC SQL                                                  14050027
140600             CONNECT :PC-AUTO-LOGON                               14060027
140700        END-EXEC                                                  14070027
140800     ELSE                                                         14080027
140900        INITIALIZE PV-ORACLE-USERID-LEN                           14090027
141000                   PV-ORACLE-PASSWORD-LEN                         14100027
141100        INSPECT CC-ORACLE-USERID                                  14110027
141200                TALLYING PV-ORACLE-USERID-LEN                     14120027
141300                FOR CHARACTERS BEFORE INITIAL SPACE               14130027
141400        INSPECT CC-ORACLE-PASSWORD                                14140027
141500                TALLYING PV-ORACLE-PASSWORD-LEN                   14150027
141600                FOR CHARACTERS BEFORE INITIAL SPACE               14160027
141700        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         14170027
141800                USERNAME-ARR                                      14180027
141900        MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                 14190027
142000        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     14200027
142100                PASSWD-ARR                                        14210027
142200        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 14220027
142300        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     14230027
142400             PASSWD-ARR                                           14240027
142500        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 14250027
142600        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         14260027
142700             USERNAME-ARR                                         14270027
142800        MOVE PV-ORACLE-USERID-LEN  TO USERNAME-LEN                14280027
142900        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     14290027
142901             PASSWD-ARR                                           14290127
142902        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                14290227
142903        DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    14290327
142904             USERNAME-ARR                                         14290427
142905        EXEC SQL                                                  14290527
142906             CONNECT :USERNAME IDENTIFIED BY :PASSWD              14290627
142907        END-EXEC                                                  14290727
142908        INITIALIZE CC-ORACLE-PASSWORD                             14290827
142909                   PASSWD                                         14290927
142910     END-IF                                                       14291027
142911                                                                  14291127
142912     IF (SQLCODE NOT = 0)                                         14291227
142913         DISPLAY PV-PARAGRAPH-NAME                                14291327
142914         PERFORM 9900-ORA-ERROR                                   14291427
142915     END-IF.                                                      14291527
142916                                                                  14291627
142917*7000-EXIT.                                                       14291727
142918******************************************************************14291827
142919* 7100-DEC-OPEN-BTN-CURSOR.                                       14291927
142920* THIS PARAGRAPH WILL DECLARE AND OPEN BTNCRSR                    14292027
142930******************************************************************14293027
142940 7100-DEC-OPEN-BTN-CURSOR.                                        14294027
142950     MOVE '7100-DEC-OPEN-BTN-CURSOR        ' TO PV-PARAGRAPH-NAME.14295027
142960                                                                  14296027
142970        EXEC SQL  DECLARE BTNCRSR CURSOR FOR                      14297027
142980           SELECT                                                 14298027
142990               POS_BTN_CDE                                        14299027
143000              ,POS_BTN_TXT                                        14300027
143100              ,POS_BTN_RLTV_SEQ_NBR                               14310027
143200          FROM  OMT_POS_BTN                                       14320027
143300          WHERE POS_BTN_CDE IS NOT NULL                           14330027
143400        END-EXEC.                                                 14340027
143500                                                                  14350027
143600     PERFORM                                                      14360027
143700         WITH TEST AFTER                                          14370027
143800         VARYING PV-SQL-SUB                                       14380027
143900         FROM 1 BY 1                                              14390027
144000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14400027
144100                   OR  SQLCODE = 0)                               14410027
144200                                                                  14420027
144300           EXEC SQL                                               14430027
144400              OPEN BTNCRSR                                        14440027
144500           END-EXEC                                               14450027
144600                                                                  14460027
144700           EVALUATE TRUE                                          14470027
144800               WHEN SQLCODE = 0                                   14480027
144900                    CONTINUE                                      14490027
145000               WHEN SQLWARN0 NOT EQUAL SPACE                      14500027
145100               WHEN SQLCODE NOT EQUAL ZERO                        14510027
145200                    MOVE 'OPEN CURSOR FOR BTNCRSR     '           14520027
145300                                       TO PV-ORA-OPERATION        14530027
145400                    PERFORM 9900-ORA-ERROR                        14540027
145500           END-EVALUATE                                           14550027
145600                                                                  14560027
145700     END-PERFORM.                                                 14570027
145800                                                                  14580027
145900*7100-EXIT.                                                       14590027
146000******************************************************************14600027
146100* 7150-FETCH-BTN-CURSOR                                           14610027
146200* FETCH DATA FROM THE BTNCRSR CURSOR TO POPULATE THE              14620027
146300*   PROGRAM TABLE (PV-OMT-POS-BTN)                                14630027
146400******************************************************************14640027
146500 7150-FETCH-BTN-CURSOR.                                           14650027
146600     MOVE '7150-FETCH-BTN-CURSOR           ' TO PV-PARAGRAPH-NAME.14660027
146700                                                                  14670027
146800     EXEC SQL                                                     14680027
146900         FETCH BTNCRSR                                            14690027
147000          INTO                                                    14700027
147100               :OMT00006.POS-BTN-CDE                              14710027
147200              ,:OMT00006.POS-BTN-TXT                              14720027
147300              ,:OMT00006.POS-BTN-RLTV-SEQ-NBR                     14730027
147400               :PV-POS-RLTV-NUM-NULL-IND                          14740027
147500     END-EXEC.                                                    14750027
147600                                                                  14760027
147700*7150-EXIT.                                                       14770027
147800******************************************************************14780027
147900*  7200-CLOSE-BTN-CURSOR.                                        *14790027
148000*  CLOSE BTNCRSR CURSOR                                          *14800027
148100******************************************************************14810027
148200 7200-CLOSE-BTN-CURSOR.                                           14820027
148300     MOVE '7200-CLOSE-BTN-CURSOR         ' TO  PV-PARAGRAPH-NAME. 14830027
148400                                                                  14840027
148500     PERFORM                                                      14850027
148600         WITH TEST AFTER                                          14860027
148700         VARYING PV-SQL-SUB                                       14870027
148800         FROM 1 BY 1                                              14880027
148900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14890027
149000                   OR  SQLCODE = 0)                               14900027
149100                                                                  14910027
149200           EXEC SQL                                               14920027
149300              CLOSE BTNCRSR                                       14930027
149400           END-EXEC                                               14940027
149500                                                                  14950027
149600         EVALUATE TRUE                                            14960027
149700             WHEN SQLCODE = 0                                     14970027
149800                  CONTINUE                                        14980027
149900             WHEN SQLWARN0 NOT EQUAL SPACE                        14990027
150000             WHEN SQLCODE NOT EQUAL ZERO                          15000027
150100                  MOVE 'CLOSE CURSOR FOR OMT_POS_BTN'             15010027
150200                                     TO PV-ORA-OPERATION          15020027
150300                  PERFORM 9900-ORA-ERROR                          15030027
150400         END-EVALUATE                                             15040027
150500     END-PERFORM.                                                 15050027
150600                                                                  15060027
150700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15070027
150800        MOVE 'CLOSE BTNCRSR CURSOR RETRIES EXCEEDED'              15080027
150900                              TO  PV-ORA-OPERATION                15090027
151000        PERFORM 9900-ORA-ERROR                                    15100027
151100     END-IF.                                                      15110027
151200                                                                  15120027
151300*7200-EXIT.                                                       15130027
151400******************************************************************15140027
151500* 7300-DEC-OPEN-OFFER-CURSOR.                                     15150027
151600*  DECLARE AND OPEN OFFERCRSR TO OBTAIN OFFER RECORDS FOR THE     15160027
151700*  SOURCE STORE                                                   15170027
151800*  NOTE: THIS IS IN THE PROCEDURE DIVISION BECAUSE OF THE WAY     15180027
151900*        COBOL AND ORACLE INTERACT.                               15190027
152000*  CURSOR WHERE CLAUSE CONDITION NOTES:                           15200027
152100*   - OMT_OFR_LOC_GP.LOC_DLT_IND = 'N' -> NON-DELETED STR GRPS    15210027
152200*   - OMT_MDSE_SET.MDSE_DLT_IND = 'N'  -> NON-DELETED MERCH SETS  15220027
152300*   - OMT_OFR_LOC_GP.IE_IND = 'Y' -> INCLUDED STORE GROUPS        15230027
152400*     (IE_IND = 'Y' MEANS INCLUDED, IE_IND = 'N' MEANS EXCLUDED)  15240027
152500*   - TO BE EXTRACTED, AN OFFER NEEDS TO END AFTER THE EXTRACT    15250027
152600*     END DATE, ALLOWING FOR END DATE TOLERANCE AND SUPERVISOR    15260027
152700*     OVERRIDE DAYS TOLERANCE, WHICH ARE ADDED ONTO THE END DATE. 15270027
152800*     RESULT: EXTRACT-START-DATE - SUM(TOLERANCES)                15280027
152900******************************************************************15290027
153000 7300-DEC-OPEN-OFFER-CURSOR.                                      15300027
153100     MOVE '7300-DEC-OPEN-OFFER-CURSOR      ' TO PV-PARAGRAPH-NAME.15310027
153200                                                                  15320027
153300        EXEC SQL DECLARE OFFERCRSR CURSOR FOR                     15330027
153400          SELECT C.EVNT_ID                                        15340027
153500                ,C.OFR_ID                                         15350027
153600                ,C.OFR_NM                                         15360027
153700                ,C.DISC_LVL_CDE                                   15370027
153800                ,C.OFR_USG_TYP_CDE                                15380027
153900                ,C.BRCDE_TYP_CDE                                  15390027
154000                ,C.UNEARN_IND                                     15400027
154100                ,C.OFR_TRGR_TYP_CDE                               15410027
154200                ,C.ITM_DISC_APPL_CDE                              15420027
154300                ,B.EVNT_TYP_CDE                                   15430027
154400                ,A.EVNT_CTG_NM                                    15440027
154500                ,D.OFR_SECT_TYP_CDE                               15450027
214901**              ,D.EFF_BEG_TMST                                   15460030
214901                ,TO_CHAR(D.EFF_BEG_TMST,'YYYY-MM-DD.HH24.MI.SS')  15461030
214901**              ,D.EFF_END_TMST                                   15470030
214901                ,TO_CHAR(D.EFF_END_TMST,'YYYY-MM-DD.HH24.MI.SS')  15471030
154800                ,D.TOL_STRT_NMOFDA_QTY                            15480027
154900                ,D.TOL_END_NMOFDA_QTY                             15490027
155000                ,D.REDMN_SUPVR_OVRRID_NMOFDA_QTY                  15500027
155100                ,D.BWP_GET_CNCTR_CDE                              15510027
155200                ,D.BWP_BUY_CNCTR_CDE                              15520027
155300                ,D.LMT_PER_TRN_QTY                                15530027
155400                ,D.VLD_POS_TNDR_COMB_TYP_CDE                      15540027
155500                ,D.POS_BTN_CDE                                    15550027
155600                ,E.CUSTFACG_SHRT_DESC                             15560027
155700                ,G.OFR_SECT_BWP_ID                                15570027
155800                ,G.TIER_LVL_NBR                                   15580027
155900                ,G.BWP_SELN_TYP_CDE                               15590027
156000                ,G.BWP_BUY_QTY                                    15600027
156100                ,G.BWP_BUY_AMT                                    15610027
156200                ,G.BWP_BUY_TOL_AMT                                15620027
156300                ,G.BWP_GET_QTY                                    15630027
156400                ,G.BWP_GET_PCT_OFF_PCT                            15640027
156500                ,G.BWP_GET_DOL_OFF_AMT                            15650027
156600                ,G.BWP_GET_PRPT_AMT                               15660027
156700                ,H.MDSE_SET_ID                                    15670027
156800                ,H.MDSE_HIER_CDE                                  15680027
156900                ,H.DEPT_NBR                                       15690027
157000                ,H.MAJ_CL_NBR                                     15700027
157100                ,H.SUB_CL_NBR                                     15710027
157200                ,H.STYL_ID                                        15720027
157300                ,H.SKU_NBR                                        15730027
157400                ,H.IE_IND                                         15740027
157500                ,H.EMP_DISC_CDE                                   15750027
157600                ,H.DISC_ELIG_IND                                  15760027
157700                ,H.TKT_CLOR_CDE                                   15770027
157800            FROM OMT_EVNT_CTG A                                   15780027
157900                ,OMT_EVNT B                                       15790027
158000                ,OMT_OFR C                                        15800027
158100                ,OMT_OFR_SECT D                                   15810027
158200                ,OMT_OFR_CUSTFACG_DESC E                          15820027
158300                ,OMT_OFR_SECT_BWP G                               15830027
158400                ,OMT_MDSE_SET H                                   15840027
158500                ,OMT_OFR_LOC_GP I                                 15850027
158600         WHERE   I.STR_GP_TYP_CDE   = :PV-STR-GP-TYP-CDE          15860027
158700             AND I.STR_GP_ID        = :PV-STR-GRP-ID              15870027
158800             AND I.OFR_ID           = :PV-OFFER-ID                15880027
158900             AND (D.EFF_END_TMST >= TO_DATE(:PV-EXTR-START-DTE    15890027
159000                                       ,'YYYY-MM-DD HH24.MI.SS')  15900027
159100                             - ( D.TOL_END_NMOFDA_QTY +           15910027
159200                                 D.REDMN_SUPVR_OVRRID_NMOFDA_QTY )15920027
159300             AND  D.EFF_BEG_TMST <= TO_DATE(:EP813-CC-FUTURE-DATE 15930027
159400                                       ,'YYYY-MM-DD HH24.MI.SS')) 15940027
159500             AND I.IE_IND           = 'Y'                         15950027
159600             AND I.LOC_DLT_IND      = 'N'                         15960027
159700             AND I.EVNT_ID          = D.EVNT_ID                   15970027
159800             AND I.OFR_ID           = D.OFR_ID                    15980027
159900             AND C.EVNT_ID          = B.EVNT_ID                   15990027
160000             AND B.EVNT_CTG_ID      = A.EVNT_CTG_ID               16000027
160100             AND C.EVNT_ID          = D.EVNT_ID                   16010027
160200             AND C.OFR_ID           = D.OFR_ID                    16020027
160300             AND D.CUSTFACG_DESC_ID = E.CUSTFACG_DESC_ID          16030027
160400             AND D.OFR_ID           = G.OFR_ID                    16040027
160500             AND D.OFR_SECT_TYP_CDE = G.OFR_SECT_TYP_CDE          16050027
160600             AND D.OFR_ID           = H.OFR_ID                    16060027
160700             AND G.OFR_SECT_BWP_ID  = H.OFR_SECT_BWP_ID           16070027
160800             AND D.EVNT_ID          = G.EVNT_ID                   16080027
160900             AND G.OFR_SECT_TYP_CDE = H.OFR_SECT_TYP_CDE          16090027
161000             AND G.OFR_ID           = H.OFR_ID                    16100027
161100             AND G.EVNT_ID          = H.EVNT_ID                   16110027
161200             AND D.OFR_SECT_TYP_CDE = I.OFR_SECT_TYP_CDE          16120027
161300             AND G.BWP_DLT_IND      = 'N'                         16130027
161400             AND H.MDSE_DLT_IND     = 'N'                         16140027
161500             AND C.OFR_STAT_CDE     = 'A'                         16150027
161600         ORDER BY C.OFR_ID                                        16160027
161700                                                                  16170027
161800      END-EXEC.                                                   16180027
161900                                                                  16190027
162000     PERFORM                                                      16200027
162100         WITH TEST AFTER                                          16210027
162200         VARYING PV-SQL-SUB                                       16220027
162300         FROM 1 BY 1                                              16230027
162400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16240027
162500                   OR  SQLCODE = 0)                               16250027
162600                                                                  16260027
162700           EXEC SQL                                               16270027
162800              OPEN OFFERCRSR                                      16280027
162900           END-EXEC                                               16290027
163000                                                                  16300027
163100           EVALUATE TRUE                                          16310027
163200               WHEN SQLCODE = 0                                   16320027
163300                    CONTINUE                                      16330027
163400               WHEN SQLWARN0 NOT EQUAL SPACE                      16340027
163500               WHEN SQLCODE NOT EQUAL ZERO                        16350027
163600                    MOVE 'OPEN CURSOR FOR OFFERCRSR   '           16360027
163700                                       TO PV-ORA-OPERATION        16370027
163800                    PERFORM 9900-ORA-ERROR                        16380027
163900           END-EVALUATE                                           16390027
164000                                                                  16400027
164100      END-PERFORM.                                                16410027
164200                                                                  16420027
164300*7300-EXIT.                                                       16430027
164400******************************************************************16440027
164500* 7400-FETCH-OFFER-REFRESH-CSR                                    16450027
164600* THIS PARAGRAPH WILL FETCH DATA FROM THE OFFERCRSR CURSOR        16460027
164700******************************************************************16470027
164800 7400-FETCH-OFFER-REFRESH-CSR.                                    16480027
164900     MOVE '7400-FETCH-OFFER-REFRESH-CSR    ' TO PV-PARAGRAPH-NAME.16490027
165000                                                                  16500027
165100     INITIALIZE PV-NULL-INDICATORS.                               16510027
165200                                                                  16520027
165300     EXEC SQL                                                     16530027
165400         FETCH OFFERCRSR                                          16540027
165500          INTO                                                    16550027
165600               :OMT00001.EVNT-ID                                  16560027
165700              ,:OMT00001.OFR-ID                                   16570027
165800              ,:OMT00001.OFR-NM                                   16580027
165900              ,:OMT00001.DISC-LVL-CDE                             16590027
166000              ,:OMT00001.OFR-USG-TYP-CDE                          16600027
166100              ,:OMT00001.BRCDE-TYP-CDE                            16610027
166200              ,:OMT00001.UNEARN-IND                               16620027
166300              ,:OMT00001.OFR-TRGR-TYP-CDE                         16630027
166400              ,:OMT00001.ITM-DISC-APPL-CDE                        16640027
166500               :PV-ITM-DISC-APL-NULL-IND                          16650027
166600              ,:OMT00009.EVNT-TYP-CDE                             16660027
166700              ,:OMT00007.EVNT-CTG-NM                              16670027
166800              ,:OMT00002.OFR-SECT-TYP-CDE                         16680027
166900              ,:OMT00002.EFF-BEG-TMST                             16690027
167000              ,:OMT00002.EFF-END-TMST                             16700027
167100              ,:OMT00002.TOL-STRT-NMOFDA-QTY                      16710027
167200              ,:OMT00002.TOL-END-NMOFDA-QTY                       16720027
167300              ,:OMT00002.REDMN-SUPVR-OVRRID-NMOFDA-QTY            16730027
167400              ,:OMT00002.BWP-GET-CNCTR-CDE                        16740027
167500              ,:OMT00002.BWP-BUY-CNCTR-CDE                        16750027
167600              ,:OMT00002.LMT-PER-TRN-QTY                          16760027
167700              ,:OMT00002.VLD-POS-TNDR-COMB-TYP-CDE                16770027
167800              ,:OMT00002.POS-BTN-CDE                              16780027
167900               :PV-POS-BTN-CDE-NULL-IND                           16790027
168000              ,:OMT00008.CUSTFACG-SHRT-DESC                       16800027
168100              ,:OMT00003.OFR-SECT-BWP-ID                          16810027
168200              ,:OMT00003.TIER-LVL-NBR                             16820027
168300              ,:OMT00003.BWP-SELN-TYP-CDE                         16830027
168400              ,:OMT00003.BWP-BUY-QTY                              16840027
168500               :PV-BWP-BUY-QTY-NULL-IND                           16850027
168600              ,:OMT00003.BWP-BUY-AMT                              16860027
168700               :PV-BWP-BUY-AMT-NULL-IND                           16870027
168800              ,:OMT00003.BWP-BUY-TOL-AMT                          16880027
168900               :PV-BWP-BUY-TOL-AMT-NULL-IND                       16890027
169000              ,:OMT00003.BWP-GET-QTY                              16900027
169100               :PV-BWP-GET-QTY-NULL-IND                           16910027
169200              ,:OMT00003.BWP-GET-PCT-OFF-PCT                      16920027
169300               :PV-BWP-GET-PCT-NULL-IND                           16930027
169400              ,:OMT00003.BWP-GET-DOL-OFF-AMT                      16940027
169500               :PV-BWP-GET-DOL-NULL-IND                           16950027
169600              ,:OMT00003.BWP-GET-PRPT-AMT                         16960027
169700               :PV-BWP-GET-PRPT-NULL-IND                          16970027
169800              ,:OMT00005.MDSE-SET-ID                              16980027
169900              ,:OMT00005.MDSE-HIER-CDE                            16990027
170000              ,:OMT00005.DEPT-NBR                                 17000027
170100               :PV-MDSE-DEPT-NBR-NULL-IND                         17010027
170200              ,:OMT00005.MAJ-CL-NBR                               17020027
170300               :PV-MDSE-MAJ-CLS-NULL-IND                          17030027
170400              ,:OMT00005.SUB-CL-NBR                               17040027
170500               :PV-MDSE-SUB-CLS-NULL-IND                          17050027
170600              ,:OMT00005.STYL-ID                                  17060027
170700               :PV-MDSE-STL-ID-NULL-IND                           17070027
170800              ,:OMT00005.SKU-NBR                                  17080027
170900               :PV-MDSE-SKU-NB-NULL-IND                           17090027
171000              ,:OMT00005.IE-IND                                   17100027
171100              ,:OMT00005.EMP-DISC-CDE                             17110027
171200               :PV-MDSE-EMP-DS-NULL-IND                           17120027
171300              ,:OMT00005.DISC-ELIG-IND                            17130027
171400               :PV-MDSE-DSC-EL-NULL-IND                           17140027
171500              ,:OMT00005.TKT-CLOR-CDE                             17150027
171600               :PV-MDSE-TKT-CL-NULL-IND                           17160027
171700     END-EXEC.                                                    17170027
171800                                                                  17180027
171900*7400-EXIT.                                                       17190027
172000******************************************************************17200027
172100*  7500-CLOSE-OFFER-CURSOR.                                      *17210027
172200*  CLOSE OFFERCRSR CURSOR                                        *17220027
172300******************************************************************17230027
172400 7500-CLOSE-OFFER-CURSOR.                                         17240027
172500     MOVE '7500-CLOSE-OFFER-CURSOR   ' TO      PV-PARAGRAPH-NAME. 17250027
172600                                                                  17260027
172700     PERFORM                                                      17270027
172800         WITH TEST AFTER                                          17280027
172900         VARYING PV-SQL-SUB                                       17290027
173000         FROM 1 BY 1                                              17300027
173100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 17310027
173200                   OR  SQLCODE = 0)                               17320027
173300                                                                  17330027
173400           EXEC SQL                                               17340027
173500              CLOSE OFFERCRSR                                     17350027
173600           END-EXEC                                               17360027
173700                                                                  17370027
173800         EVALUATE TRUE                                            17380027
173900             WHEN SQLCODE = 0                                     17390027
174000                  CONTINUE                                        17400027
174100             WHEN SQLWARN0 NOT EQUAL SPACE                        17410027
174200             WHEN SQLCODE NOT EQUAL ZERO                          17420027
174300                  MOVE 'CLOSE CURSOR FOR OFFERS EXTRACT'          17430027
174400                                     TO PV-ORA-OPERATION          17440027
174500                  PERFORM 9900-ORA-ERROR                          17450027
174600         END-EVALUATE                                             17460027
174700     END-PERFORM.                                                 17470027
174800                                                                  17480027
174900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17490027
175000        MOVE 'CLOSE OFFER CURSOR RETRIES EXCEEDED'                17500027
175100                              TO  PV-ORA-OPERATION                17510027
175200        PERFORM 9900-ORA-ERROR                                    17520027
175300     END-IF.                                                      17530027
175400                                                                  17540027
175500*7500-EXIT.                                                       17550027
175600***********************************************************       17560027
175700* 8000-READ-BATCH-DATE-CNTL-CARD                                  17570027
175800*     READ INPUT BATCH DATE CONTROL CARD - TODAY'S DATE           17580027
175900***********************************************************       17590027
176000 8000-READ-BATCH-DATE-CNTL-CARD.                                  17600027
176100                                                                  17610027
176200     READ CONTROL-CARD-BATCH-DATE INTO EP812-CC-CONTROL-CARD      17620027
176300        AT END SET PS-END-OF-CC-BATCH-DTE TO TRUE                 17630027
176400     END-READ.                                                    17640027
176500                                                                  17650027
176600     IF  PS-END-OF-CC-BATCH-DTE                                   17660027
176700        MOVE '8000-READ-BATCH-DATE-CNTL-CARD' TO PV-PARAGRAPH-NAME17670027
176800        MOVE 'BATCH DATE CARD IS EMPTY' TO PV-OPERATION-MSG-1     17680027
176900        SET   AC-4008-INVALID-DATA TO TRUE                        17690027
177000        PERFORM 9800-ABEND                                        17700027
177100     END-IF.                                                      17710027
177200                                                                  17720027
177300*8000-EXIT.                                                       17730027
177400******************************************************************17740027
177500* 8100-READ-CC-NXT-FUT-DAY                                        17750027
177600*     READ SALES PROCESSING DATE FROM INPUT CONTROL CARD          17760027
177700******************************************************************17770027
177800 8100-READ-CC-NXT-FUT-DAY.                                        17780027
177900                                                                  17790027
178000     INITIALIZE EP813-CC-CONTROL-CARD.                            17800027
178100                                                                  17810027
178200     READ CONTROL-CARD-NXT-FUT-DAY INTO EP813-CC-CONTROL-CARD     17820027
178300        AT END SET PS-END-OF-CC-NXT-FUT-DAY TO TRUE.              17830027
178400                                                                  17840027
178500     IF  PS-END-OF-CC-NXT-FUT-DAY                                 17850027
178600         MOVE '8100-READ-CC-NXT-FUT-DAY  ' TO PV-PARAGRAPH-NAME   17860027
178700         MOVE 'FUTURE DATE CARD IS EMPTY ' TO PV-OPERATION-MSG-1  17870027
178800         SET  AC-4008-INVALID-DATA         TO TRUE                17880027
178900         PERFORM 9800-ABEND                                       17890027
179000     END-IF.                                                      17900027
179100                                                                  17910027
179200*8100-EXIT.                                                       17920027
179300******************************************************************17930027
179400* 8250-READ-STORE-INPUT.                                          17940027
179500*     READ INPUT STORE FILE WITH STORES TO PROCESS                17950027
179600******************************************************************17960027
179700 8250-READ-STORE-INPUT.                                           17970027
179800                                                                  17980027
179900     READ STORE-INPUT-FILE   INTO INPUT-RECORD                    17990027
180000        AT END                                                    18000027
180100           SET PS-END-OF-INPUT       TO TRUE                      18010027
180200     END-READ.                                                    18020027
180300                                                                  18030027
180400     IF PS-NOT-END-OF-INPUT                                       18040027
180500         ADD +1     TO PA-INPUT-RECS-READ                         18050027
180600         IF INPUT-OFFER-ID NOT EQUAL TO SPACES                    18060027
180700            MOVE INPUT-STORE   TO PV-NEXT-SOURCE-STORE            18070027
180800            SET PS-SOURCE-STORE     TO TRUE                       18080027
180900            IF PA-TARGET-STORE-COUNT > 0                          18090027
181000                SET PS-END-OF-TARGET    TO TRUE                   18100027
181100            END-IF                                                18110027
181200         ELSE                                                     18120027
181300            SET PS-TARGET-STORE     TO TRUE                       18130027
181400         END-IF                                                   18140027
181500         IF PA-INPUT-RECS-READ > 1000                             18150027
181600             DISPLAY 'LIMIT OF 1,000 INPUT RECORDS EXCEEDED'      18160027
181700             DISPLAY 'PROGRAM IS ENDING.'                         18170027
181800             SET PS-ERROR-FOUND     TO TRUE                       18180027
181900             SET PS-END-OF-INPUT    TO TRUE                       18190027
182000             ADD +1                 TO PA-ERROR-COUNT             18200027
182100         END-IF                                                   18210027
182200     END-IF.                                                      18220027
182300                                                                  18230027
182400*8250-EXIT.                                                       18240027
182500******************************************************************18250027
182600* 8300-WRITE-XST-OFR-DATA                                         18260027
182700*     WRITE OFFER DATA RECORD                                     18270027
182800*     ALL RECORD TYPES WILL USE THIS WRITE STATEMENT              18280027
182900******************************************************************18290027
183000 8300-WRITE-XST-OFR-DATA.                                         18300027
183100     MOVE '8300-WRITE-XST-OFR-DATA      ' TO PV-PARAGRAPH-NAME.   18310027
183200                                                                  18320027
183300     MOVE SPACES TO OFFERS-FULL-REFRESH-RECORD.                   18330027
183400                                                                  18340027
183500     WRITE OFFERS-FULL-REFRESH-RECORD FROM EP205-OFFER-EXTRACT.   18350027
183600                                                                  18360027
183700*8300-EXIT.                                                       18370027
183800******************************************************************18380027
183900* 8400-WRITE-STR-LIST-REC                                         18390027
184000*     WRITE STORE LIST RECORD                                     18400027
184100******************************************************************18410027
184200 8400-WRITE-STR-LIST-REC.                                         18420027
184300     MOVE '8400-WRITE-STR-LIST-REC      ' TO PV-PARAGRAPH-NAME.   18430027
184400                                                                  18440027
184500     MOVE SPACES TO REFRESH-STORE-LIST-RECORD.                    18450027
184600                                                                  18460027
184700     WRITE  REFRESH-STORE-LIST-RECORD  FROM EP206-STORE-LIST-RCD. 18470027
184800                                                                  18480027
184900     ADD 1 TO PV-STR-LIST-RECS-OUT.                               18490027
185000     ADD 1 TO PV-STR-LIST-RECS-OUT1.                              18500027
185100                                                                  18510027
185200*8400-EXIT.                                                       18520027
185300******************************************************************18530027
185400*   9000-WRAPUP.                                                 *18540027
185500*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *18550027
185600******************************************************************18560027
185700 9000-WRAPUP.                                                     18570027
185800     MOVE '9000-WRAPUP                     ' TO PV-PARAGRAPH-NAME.18580027
185900                                                                  18590027
186000     PERFORM EP208-1200-DETERMINE-IF-ALERT.                       18600027
186100     PERFORM 9920-DISPLAY-TOTALS.                                 18610027
186200                                                                  18620027
186300     PERFORM 9990-GET-CURRENT.                                    18630027
186400                                                                  18640027
186500     DISPLAY '****************************************'.          18650027
186600     DISPLAY '**          EPKUT435 END              **'.          18660027
186700     DISPLAY '****************************************'.          18670027
186800     DISPLAY '**     END DATE ' DF-DISPLAY-DATE                   18680027
186900             '            **'.                                    18690027
187000     DISPLAY '**     END TIME ' DF-DISPLAY-TIME                   18700027
187100             '              **'.                                  18710027
187200     DISPLAY '****************************************'.          18720027
187300                                                                  18730027
187400     CLOSE STORE-INPUT-FILE                                       18740027
187500           CONTROL-CARD-NXT-FUT-DAY                               18750027
187600           CONTROL-CARD-BATCH-DATE                                18760027
187700           OFFERS-FULL-REFRESH-FILE                               18770027
187800           REFRESH-STORE-LIST-FILE.                               18780027
187900                                                                  18790027
188000*9000-EXIT.                                                       18800027
188100******************************************************************18810027
188200*     DATA RANGE VALIDATION ROUTINE AND NETCOOL ALERT CALL       *18820027
188300******************************************************************18830027
188400      COPY EPPD208.                                               18840027
188500                                                                  18850027
188600******************************************************************18860027
188700* 9800-ABEND.                                                    *18870027
188800*     ABEND PROGRAM WHEN A NON-ORACLE ERROR OCCURS.              *18880027
188900*     ROLLBACK ORACLE IN THE EVENT THAT THE ABEND OCCURS AFTER   *18890027
189000*     ORACLE PROCESSING IS UNDER WAY, TO CLOSE CURSOR(S) AND     *18900027
189100*     RELEASE RESOURCES.                                         *18910027
189200******************************************************************18920027
189300 9800-ABEND.                                                      18930027
189400                                                                  18940027
189500     EXEC SQL                                                     18950027
189600        ROLLBACK                                                  18960027
189700     END-EXEC.                                                    18970027
189800                                                                  18980027
189900     PERFORM 9920-DISPLAY-TOTALS.                                 18990027
190000     PERFORM 9990-GET-CURRENT.                                    19000027
190100                                                                  19010027
190200     DISPLAY '** ABEND           **'.                             19020027
190300     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          19030027
190400     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        19040027
190500     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       19050027
190600     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       19060027
190700     DISPLAY '** TIME            ** = ' DF-DISPLAY-TIME.          19070027
190800                                                                  19080027
190900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         19090027
191000                                                                  19100027
191100*9800-EXIT.                                                       19110027
191200***************************************************************** 19120027
191300*   9900-ORA-ERROR.                                             * 19130027
191400*     ORACLE ABEND ROUTINE.                                     * 19140027
191500***************************************************************** 19150027
191600 9900-ORA-ERROR.                                                  19160027
191700                                                                  19170027
191800     EXEC SQL                                                     19180027
191900        ROLLBACK                                                  19190027
192000     END-EXEC.                                                    19200027
192100                                                                  19210027
192200     PERFORM 9920-DISPLAY-TOTALS.                                 19220027
192300     PERFORM 9990-GET-CURRENT.                                    19230027
192400                                                                  19240027
192500     SET AC-4013-ORACLE-ERROR      TO TRUE.                       19250027
192600     DISPLAY '** ABEND     **'.                                   19260027
192700     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                19270027
192800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              19280027
192900     DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               19290027
193000     DISPLAY '** TIME      ** = ' DF-DISPLAY-TIME.                19300027
193100                                                                  19310027
193200     COPY DPPD004.                                                19320027
193300     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         19330027
193400                                                                  19340027
193500*9900-EXIT.                                                       19350027
193600******************************************************************19360027
193700*   9920-DISPLAY-TOTALS.                                         *19370027
193800*     DISPLAY END OF JOB TOTALS                                  *19380027
193900******************************************************************19390027
194000 9920-DISPLAY-TOTALS.                                             19400027
194100                                                                  19410027
194200     DISPLAY '****************************************'.          19420027
194300     DISPLAY '**     EOJ STATISTICS FOR EPKUT435    **'           19430027
194400     DISPLAY '****************************************'.          19440027
194500                                                                  19450027
194600     DISPLAY '** BUTTON RECS FETCHED =====> '                     19460027
194700             PV-POS-BTN-REC-FETCHED                               19470027
194800             ' **'.                                               19480027
194900     DISPLAY '** OFFER CRSR RECS FETCHED => '                     19490027
195000             PV-OFR-CRSR-RECS-FETCHED                             19500027
195100             ' **'.                                               19510027
195200     DISPLAY '** OFFER RCDS WRITTEN ======> '                     19520027
195300             PV-OFFER-RECS-OUT                                    19530027
195400             ' **'.                                               19540027
195500     DISPLAY '** OFFER SECT RCDS WRITTEN => '                     19550027
195600             PV-OFRSECT-RECS-OUT                                  19560027
195700             ' **'.                                               19570027
195800     DISPLAY '** OFFER BWP RCDS WRITTEN ==> '                     19580027
195900             PV-OFRBWP-RECS-OUT                                   19590027
196000             ' **'.                                               19600027
196100     DISPLAY '** MDSE SET RCDS WRITTEN ===> '                     19610027
196200             PV-MDSESET-RECS-OUT                                  19620027
196300             ' **'.                                               19630027
196400     DISPLAY '** STR LIST RCDS WRITTEN ===> '                     19640027
196500             PV-STR-LIST-RECS-OUT                                 19650027
196600             ' **'.                                               19660027
196700     DISPLAY '** ERROR RECORDS ===========> '                     19670027
196800             EP208-ERROR-RCD-COUNT                                19680027
196900             ' **'.                                               19690027
197000     DISPLAY '** ALERT RECORDS ===========> '                     19700027
197100             EP208-ALERT-RECS-OUT                                 19710027
197200             ' **'.                                               19720027
197300     DISPLAY '****************************************'.          19730027
197400                                                                  19740027
197500                                                                  19750027
197600     IF PV-STORE-RFRSH-COUNT > ZERO                               19760027
197700        AND  PV-OFR-CRSR-RECS-FETCHED = ZERO                      19770027
197800           DISPLAY '*********************************************'19780027
197900           DISPLAY '**  NO OFFERS FOUND FOR REQUESTED STORES   **'19790027
198000           DISPLAY '**  NUMBER OF STORES: ' PV-STORE-RFRSH-COUNT  19800027
198100                                                  '            **'19810027
198200           DISPLAY '*********************************************'19820027
198300     END-IF.                                                      19830027
198400                                                                  19840027
198500*9920-EXIT.                                                       19850027
198600******************************************************************19860027
198700*  9990-GET-CURRENT.                                             *19870027
198800*     GET CURRENT DATE, TIME AND TIMESTAMP FROM ORA / SYSTEM     *19880027
198900******************************************************************19890027
199000 9990-GET-CURRENT.                                                19900027
199100                                                                  19910027
199200     MOVE FUNCTION CURRENT-DATE(1:16) TO DF-CURRENT-DATE-TIME.    19920027
199300                                                                  19930027
199400     MOVE DF-CURRENT-YR            TO DF-DD-YR.                   19940027
199500     MOVE DF-CURRENT-MO            TO DF-DD-MO.                   19950027
199600     MOVE DF-CURRENT-DY            TO DF-DD-DY.                   19960027
199700     MOVE DF-CURRENT-HR            TO DF-DT-HR.                   19970027
199800     MOVE DF-CURRENT-MIN           TO DF-DT-MIN.                  19980027
199900     MOVE DF-CURRENT-SEC           TO DF-DT-SEC.                  19990027
200000                                                                  20000027
200100*9990-EXIT.                                                       20010027
200200************************  END OF PROGRAM  ************************20020027
