000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XLKUP005.                                         00020000
000300 AUTHOR.        JOE LAROSA.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  02/24/2003.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00080000
000900******************************************************************00090000
001000* THIS DB2 PROGRAM IS CALLED TO PROCESS CERTAIN TYPES OF PO DATA  00100000
001100* PASSED FROM RMS.  THE PROGRAM INSERTS, UPDATES OR DELETES ROWS  00110000
001200* ON THE LEGACY TPURCHS TABLE.                                    00120000
001300* ****************************************************************00130000
001400* CHANGE DESCRIPTION                                              00140000
001500* ****************************************************************00150000
001600* DATE  05/04/2010                                                00160000
001700*  CHANGE MADE: ADDED A NEW IR INDICATOR(WHSE_RPLNT_IND) IN       00170000
001800*  TPURCHS TABLE UNDER IMPORT REPLENISHMENT PROJECT. CHANGES MADE 00180000
001900*  ACCORDINGLY TO THE INSERT AND UPDATE CALLS FOR TPURCHS TABLE.  00190000
002000* MADE BY: MONIKA SACHDEVA         TKID: TKMAW78                  00200000
002100* CHANGES TAGGED AS MS 05/04/2010                                 00210000
002200******************************************************************00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400 CONFIGURATION SECTION.                                           00240000
002500 SOURCE-COMPUTER.  IBM-3090.                                      00250000
002600 OBJECT-COMPUTER.  IBM-3090.                                      00260000
002700 DATA DIVISION.                                                   00270000
002800                                                                  00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000******************************************************************00300000
003100**PROGRAM SWITCHES                                                00310000
003200******************************************************************00320000
003300 01  PS-PROGRAM-SWITCHES.                                         00330000
003400     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00340000
003500         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00350000
003600         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00360000
003700     05  PS-UPDATE-SW                PIC X(01)  VALUE 'Y'.        00370000
003800         88  PS-UPDATE-YES                      VALUE 'Y'.        00380000
003900         88  PS-UPDATE-NO                       VALUE 'N'.        00390000
004000     05  PS-SKIPIT-SW                PIC X(01)  VALUE 'Y'.        00400000
004100         88  PS-SKIP-IT-YES                     VALUE 'Y'.        00410000
004200         88  PS-SKIP-IT-NO                      VALUE 'N'.        00420000
004300                                                                  00430000
004400******************************************************************00440000
004500**PROGRAM CONSTANTS                                               00450000
004600******************************************************************00460000
004700 01  PC-PROGRAM-CONSTANTS.                                        00470000
004800     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00480000
004900     05  PC-P                        PIC X(01)  VALUE 'P'.        00490000
005000                                                                  00500000
005100******************************************************************00510000
005200**SQL DATABASE KEYS                                               00520000
005300******************************************************************00530000
005400 01  DK-DATABASE-KEYS.                                            00540000
005500     05  DK-PO-NBR                   PIC S9(9)  COMP.             00550000
005600     05  DK-VER-NBR                  PIC S9(9)  COMP.             00560000
005700     05  DK-ENT-ID                   PIC S9(9)  COMP.             00570000
005800     05  DK-YEAR                     PIC X(4).                    00580000
005900     05  DK-MONTH                    PIC X(2).                    00590000
006000     05  DN-DELY-ID-NULL             PIC S9(4)  COMP.             00600000
006100                                                                  00610000
006200******************************************************************00620000
006300**PROGRAM VARIABLES                                               00630000
006400******************************************************************00640000
006500 01  PV-PROGRAM-VARIABLES.                                        00650000
006600     05  PV-RETRY-COUNTER            PIC 9(01)  VALUE ZEROES.     00660000
006700     05  PV-CLOSE-DATE.                                           00670000
006800         10  PV-CLOSE-DATE-CC        PIC X(02).                   00680000
006900         10  PV-CLOSE-DATE-YY        PIC X(02).                   00690000
007000         10  PV-CLOSE-DATE-MM        PIC X(02).                   00700000
007100         10  PV-CLOSE-DATE-DD        PIC X(02).                   00710000
007200         10  PV-CLOSE-DATE-HH        PIC X(02).                   00720000
007300         10  PV-CLOSE-DATE-MI        PIC X(02).                   00730000
007400         10  PV-CLOSE-DATE-SS        PIC X(02).                   00740000
007500                                                                  00750000
007600     05  PV-CURRENT-TMST             PIC X(26).                   00760000
007700     05  FILLER REDEFINES PV-CURRENT-TMST.                        00770000
007800         10  PV-CURR-TMST-DATE       PIC X(10).                   00780000
007900         10  PV-CURR-TMST-TIME       PIC X(16).                   00790000
008000                                                                  00800000
008100     05  PV-DATE-X08                 PIC X(08).                   00810000
008200     05  FILLER REDEFINES PV-DATE-X08.                            00820000
008300         10  PV-X08-CC               PIC 9(02).                   00830000
008400         10  PV-X08-YY               PIC 9(02).                   00840000
008500         10  PV-X08-MM               PIC 9(02).                   00850000
008600         10  PV-X08-DD               PIC 9(02).                   00860000
008700                                                                  00870000
008800     05  PV-DATE-X10                 PIC X(10).                   00880000
008900     05  FILLER REDEFINES PV-DATE-X10.                            00890000
009000         10  PV-X10-CC               PIC 9(02).                   00900000
009100         10  PV-X10-YY               PIC 9(02).                   00910000
009200         10  PV-X10-H1               PIC X(01).                   00920000
009300         10  PV-X10-MM               PIC 9(02).                   00930000
009400         10  PV-X10-H2               PIC X(01).                   00940000
009500         10  PV-X10-DD               PIC 9(02).                   00950000
009600                                                                  00960000
009700     05  PV-TIME-X16                 PIC X(16).                   00970000
009800     05  FILLER REDEFINES PV-TIME-X16.                            00980000
009900         10  PV-X16-H1               PIC X(01).                   00990000
010000         10  PV-X16-HH               PIC 9(02).                   01000000
010100         10  PV-X16-P1               PIC X(01).                   01010000
010200         10  PV-X16-MI               PIC 9(02).                   01020000
010300         10  PV-X16-P2               PIC X(01).                   01030000
010400         10  PV-X16-SS               PIC 9(02).                   01040000
010500         10  PV-X16-P3               PIC X(01).                   01050000
010600         10  PV-X16-999999           PIC 9(06).                   01060000
010700                                                                  01070000
010800     05  PV-TMST-X26.                                             01080000
010900         10  PV-X26-DATE             PIC X(10).                   01090000
011000         10  PV-X26-TIME             PIC X(16).                   01100000
011100                                                                  01110000
011200     05  PV-OTB-WORK-DATE.                                        01120000
011300         10  PV-OTB-WORK-CC           PIC  X(02).                 01130000
011400         10  PV-OTB-WORK-YY           PIC  X(02).                 01140000
011500         10  FILLER                   PIC  X     VALUE '-'.       01150000
011600         10  PV-OTB-WORK-MM           PIC  X(02).                 01160000
011700         10  FILLER                   PIC  X     VALUE '-'.       01170000
011800         10  PV-OTB-WORK-DD           PIC  X(02).                 01180000
011900     05  PV-NEW-OTB-DTE.                                          01190000
012000         10  PV-NEW-OTB-CCYY          PIC  X(04).                 01200000
012100         10  PV-NEW-OTB-MM            PIC  X(02).                 01210000
012200                                                                  01220000
012300     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   01230000
012400         88  PS-PO-EXISTS-YES                       VALUE 1.      01240000
012500         88  PS-PO-EXISTS-NO                        VALUE ZERO.   01250000
012600     05  PV-YEAR-X.                                               01260000
012700         10  PV-YEAR-N               PIC 9(04).                   01270000
012800     05  PV-MONTH-X.                                              01280000
012900         10  PV-MONTH-N              PIC 9(04).                   01290000
013000                                                                  01300000
013100** MS 05/04/2010                                                  01310000
013200     05  PV-DISPLAY-SQLCODE          PIC 9(04).                   01320000
013300     05  PV-DISPLAY-PO-NBR           PIC 9(09).                   01330000
013400** MS 05/04/2010                                                  01340000
013500                                                                  01350000
013600******************************************************************01360000
013700**COPYBOOKS                                                       01370000
013800******************************************************************01380000
013900***DB2 MESSAGE AREA                                               01390000
014000     COPY SQLCA2.                                                 01400000
014100                                                                  01410000
014200******************************************************************01420000
014300*    OPEN TO BUY COPYBOOK                                        *01430000
014400******************************************************************01440000
014500                                                                  01450000
014600     COPY POWS055.                                                01460000
014700/                                                                 01470000
014800     COPY DPWS010I.                                               01480000
014900******************************************************************01490000
015000**TABLE INCLUSIONS                                                01500000
015100******************************************************************01510000
015200***DB2 COMMUNICATIONS AREA                                        01520000
015300     EXEC SQL                                                     01530000
015400          INCLUDE SQLCA                                           01540000
015500     END-EXEC.                                                    01550000
015600                                                                  01560000
015700* ------------------------------------------------------------- * 01570000
015800*  SQL AND COBOL DECLARATIONS FOR PURCHASING HEADER TABLE         01580000
015900* ------------------------------------------------------------- * 01590000
016000     EXEC SQL                                                     01600000
016100         INCLUDE TPURCHS                                          01610000
016200     END-EXEC.                                                    01620000
016300                                                                  01630000
016400* ------------------------------------------------------------- * 01640000
016500*  SQL AND COBOL DECLARATIONS FOR ALLOCATION PLAN TABLE           01650000
016600* ------------------------------------------------------------- * 01660000
016700     EXEC SQL                                                     01670000
016800         INCLUDE TALLPLN                                          01680000
016900     END-EXEC.                                                    01690000
017000                                                                  01700000
017100* ------------------------------------------------------------- * 01710000
017200*  SQL AND COBOL DECLARATIONS FOR STATUS CODE TABLE               01720000
017300* ------------------------------------------------------------- * 01730000
017400     EXEC SQL                                                     01740000
017500         INCLUDE TSTATCD                                          01750000
017600     END-EXEC.                                                    01760000
017700                                                                  01770000
017800* ------------------------------------------------------------- * 01780000
017900*  SQL AND COBOL DECLARATIONS FOR ENTERPRISE REPRESENTATIVE TABLE 01790000
018000* ------------------------------------------------------------- * 01800000
018100     EXEC SQL                                                     01810000
018200         INCLUDE TENTREP                                          01820000
018300     END-EXEC.                                                    01830000
018400                                                                  01840000
018500******************************************************************01850000
018600*    CURSOR FOR OBTAINING TENTREP SEQUENCE NUMBER                 01860000
018700******************************************************************01870000
018800     EXEC SQL                                                     01880000
018900          DECLARE ENTREP-CSR CURSOR FOR                           01890000
019000          SELECT SEQ_NBR                                          01900000
019100            FROM TENTREP                                          01910000
019200           WHERE ENT_ID      = :DK-ENT-ID                         01920000
019300             AND FUNCTION_ID = 2                                  01930000
019400          ORDER BY                                                01940000
019500                 SEQ_NBR                                          01950000
019600     END-EXEC                                                     01960000
019700                                                                  01970000
019800 LINKAGE SECTION.                                                 01980000
019900 01  XLRD011-RECORD.                                              01990000
020000     COPY XLRD011.                                                02000000
020100                                                                  02010000
020200 PROCEDURE DIVISION USING XLRD011-RECORD.                         02020000
020300******************************************************************02030000
020400 0000-MAINLINE.                                                   02040000
020500                                                                  02050000
020600     IF XL011-DEBUG-YES                                           02060000
020700         DISPLAY 'XLKUP005 - 0000-MAINLINE'                       02070000
020800     END-IF.                                                      02080000
020900                                                                  02090000
021000     EXEC SQL                                                     02100000
021100         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 02110000
021200     END-EXEC.                                                    02120000
021300                                                                  02130000
021400     EVALUATE TRUE                                                02140000
021500       WHEN SQLCODE EQUAL +0                                      02150000
021600           CONTINUE                                               02160000
021700       WHEN OTHER                                                 02170000
021800           SET PS-PROCESS-COMPLETE TO TRUE                        02180000
021900     END-EVALUATE.                                                02190000
022000                                                                  02200000
022100* JAK 04/2007 - ADD DEBUG LOGIC                                   02210000
022200     IF XL011-DEBUG-YES                                           02220000
022300         DISPLAY 'XLKUP005 - XL011-ORDER-NBR = ' XL011-ORDER-NBR  02230000
022400         DISPLAY 'XLKUP005 - XL011-ROW-COMMITTED = '              02240000
022500                             XL011-ROW-COMMITTED                  02250000
022600     END-IF.                                                      02260000
022700                                                                  02270000
022800     MOVE XL011-ORDER-NBR            TO DK-PO-NBR.                02280000
022900     IF XL011-ROW-COMMITTED-YES                                   02290000
023000         EXEC SQL                                                 02300000
023100           UPDATE TPURCHS                                         02310000
023200              SET RMS_PO_UPD_TMST  = :PV-CURRENT-TMST             02320000
023300           WHERE PO_NBR            = :DK-PO-NBR                   02330000
023400              AND VER_STATUS_CDE   = 'A'                          02340000
023500         END-EXEC                                                 02350000
023600                                                                  02360000
023700         EVALUATE TRUE                                            02370000
023800             WHEN SQLCODE = 0                                     02380000
023900                 SET PS-PROCESS-COMPLETE TO TRUE                  02390000
024000             WHEN OTHER                                           02400000
024100                 SET PS-PROCESS-COMPLETE TO TRUE                  02410000
024200                 MOVE SQLCODE            TO PV-DISPLAY-SQLCODE    02420000
024300                 MOVE DK-PO-NBR          TO PV-DISPLAY-PO-NBR     02430000
024400                 DISPLAY 'XLKUP005 - RMS PO TMST UPD FAIL '       02440000
024500                         'PO NBR = ' PV-DISPLAY-PO-NBR            02450000
024600                         ' SQLCODE = ' PV-DISPLAY-SQLCODE         02460000
024700         END-EVALUATE                                             02470000
024800                                                                  02480000
024900         SET XL011-ROW-NOT-COMMITTED        TO TRUE               02490000
025000     ELSE                                                         02500000
025100         PERFORM 1000-INITIALIZATION                              02510000
025200                                                                  02520000
025300         PERFORM 2000-PROCESS-MESSAGE                             02530000
025400             UNTIL PS-PROCESS-COMPLETE                            02540000
025500     END-IF.                                                      02550000
025600                                                                  02560000
025700     PERFORM 9999-WRAPUP.                                         02570000
025800                                                                  02580000
025900     GOBACK.                                                      02590000
026000***************************************************************** 02600000
026100**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                02610000
026200***************************************************************** 02620000
026300 1000-INITIALIZATION.                                             02630000
026400                                                                  02640000
026500* JAK 04/2007 - ADD DEBUG LOGIC                                   02650000
026600     IF XL011-DEBUG-YES                                           02660000
026700         DISPLAY 'XLKUP005 - 1000-INITIALIZATION'                 02670000
026800         DISPLAY 'XLKUP005 - XL011-MSG-ID = ' XL011-MSG-ID        02680000
026900     END-IF.                                                      02690000
027000                                                                  02700000
027100     SET PS-PROCESS-CONTINUE TO TRUE.                             02710000
027200     INITIALIZE XL011-RETURN-AREA.                                02720000
027300     INITIALIZE DCLTPURCHS.                                       02730000
027400     MOVE 'XLKUP005'                  TO XL011-ERROR-PROGRAM.     02740000
027500                                                                  02750000
027600                                                                  02760000
027700     IF XL011-MSG-ID = 'HDR_ADD             '                     02770000
027800        PERFORM 2050-CHECK-PO                                     02780000
027900     END-IF.                                                      02790000
028000                                                                  02800000
028100***************************************************************** 02810000
028200**MAIN PROGRAM LOGIC - READS MESSAGE TYPE ON XLRD011-RECORD       02820000
028300***************************************************************** 02830000
028400 2000-PROCESS-MESSAGE.                                            02840000
028500                                                                  02850000
028600* JAK 04/2007 - ADD DEBUG LOGIC                                   02860000
028700     IF XL011-DEBUG-YES                                           02870000
028800         DISPLAY 'XLKUP005 - 2000-PROCESS-MESSAGE'                02880000
028900     END-IF.                                                      02890000
029000                                                                  02900000
029100     EVALUATE TRUE                                                02910000
029200       WHEN XL011-MSG-ID = 'HDR_ADD             '                 02920000
029300           PERFORM 2110-LOAD-INSERT-DATA                          02930000
029400           PERFORM 2100-INSERT-DATA                               02940000
029500       WHEN XL011-MSG-ID = 'HDR_CHANGE          '                 02950000
029600           PERFORM 2200-UPDATE-DATA                               02960000
029700       WHEN XL011-MSG-ID = 'HDR_ATTR_CHANGE     '                 02970000
029800           PERFORM 2300-UPDATE-DATA                               02980000
029900       WHEN XL011-MSG-ID = 'HDR_IMPRT_CHANGE    '                 02990000
030000           PERFORM 2400-UPDATE-DATA                               03000000
030100       WHEN XL011-MSG-ID = 'HDR_IMPRT_ATT_CHANGE'                 03010000
030200           PERFORM 2500-UPDATE-DATA                               03020000
030300       WHEN XL011-MSG-ID = 'HDR_STATUS_CHANGE   '                 03030000
030400           PERFORM 2600-UPDATE-DATA                               03040000
030500       WHEN XL011-MSG-ID = 'HDR_ORIG_CTRY_CHANGE'                 03050000
030600           PERFORM 2700-UPDATE-DATA                               03060000
030700       WHEN XL011-MSG-ID = 'HDR_DELETE          '                 03070000
030800           PERFORM 2800-DELETE-DATA                               03080000
030900       WHEN OTHER                                                 03090000
031000           SET PS-PROCESS-COMPLETE TO TRUE                        03100000
031100     END-EVALUATE.                                                03110000
031200                                                                  03120000
031300***************************************************************** 03130000
031400**END PROCESSSING IF PO ALREADY EXISTS ON TPURCHS                 03140000
031500***************************************************************** 03150000
031600 2050-CHECK-PO.                                                   03160000
031700                                                                  03170000
031800* JAK 04/2007 - ADD DEBUG LOGIC                                   03180000
031900     IF XL011-DEBUG-YES                                           03190000
032000         DISPLAY 'XLKUP005 - 2050-CHECK-PO'                       03200000
032100         DISPLAY 'XLKUP005 - XL011-ORDER-NBR = ' XL011-ORDER-NBR  03210000
032200     END-IF.                                                      03220000
032300                                                                  03230000
032400     MOVE XL011-ORDER-NBR            TO DK-PO-NBR.                03240000
032500                                                                  03250000
032600     EXEC SQL                                                     03260000
032700          SELECT A.PO_NBR                                         03270000
032800            INTO :PURCHS-PO-NBR                                   03280000
032900            FROM TPURCHS A                                        03290000
033000           WHERE A.PO_NBR         = :DK-PO-NBR                    03300000
033100             AND A.VER_STATUS_CDE = 'A'                           03310000
033200     END-EXEC                                                     03320000
033300                                                                  03330000
033400     EVALUATE TRUE                                                03340000
033500       WHEN SQLCODE = 0                                           03350000
033600           SET PS-PROCESS-COMPLETE   TO TRUE                      03360000
033700       WHEN OTHER                                                 03370000
033800           CONTINUE                                               03380000
033900     END-EVALUATE.                                                03390000
034000                                                                  03400000
034100***************************************************************** 03410000
034200**INSERT ACTION TYPE                                              03420000
034300***************************************************************** 03430000
034400 2100-INSERT-DATA.                                                03440000
034500                                                                  03450000
034600* JAK 04/2007 - ADD DEBUG LOGIC                                   03460000
034700     IF XL011-DEBUG-YES                                           03470000
034800         DISPLAY 'XLKUP005 - 2100-INSERT-DATA'                    03480000
034900     END-IF.                                                      03490000
035000** INCLUDE THE NEW WAREHOUSE INDICATOR FIELD ON THE TPURCHS TABLE*03500000
035100** MS 05/04/2010                                                  03510000
035200                                                                  03520000
035300         EXEC SQL                                                 03530000
035400             INSERT INTO TPURCHS                                  03540000
035500                   (PO_NBR                                        03550000
035600                   ,VER_NBR                                       03560000
035700                   ,VER_STATUS_CDE                                03570000
035800                   ,PO_TYP_CDE                                    03580000
035900                   ,PO_CATEG_CDE                                  03590000
036000                   ,EDI_IND                                       03600000
036100                   ,TOT_UNT_QTY                                   03610000
036200                   ,TOT_VAL_COST_AMT                              03620000
036300                   ,TOT_VAL_RTL_AMT                               03630000
036400                   ,TOT_MU_PCT                                    03640000
036500                   ,TOT_SKUS_QTY                                  03650000
036600                   ,IMPRT_AGNT_PO_NBR                             03660000
036700                   ,IMPRT_ORD_OFF_NAME                            03670000
036800                   ,IMPRT_VEND_NAME                               03680000
036900                   ,IMPRT_FCTRY_NAME                              03690000
037000                   ,IMPRT_CNTRY_NAME                              03700000
037100                   ,VEND_CNTRY_NAME                               03710000
037200                   ,NEW_STR_PO_IND                                03720000
037300                   ,IMPRT_PO_IND                                  03730000
037400                   ,IMPRT_AGNT_PO_IND                             03740000
037500                   ,STATUS_TMST                                   03750000
037600                   ,LAST_UPD_TMST                                 03760000
037700                   ,EDI_REXMIT_IND                                03770000
037800                   ,EDI_REXMIT_TMST                               03780000
037900                   ,DIR_STR_IND                                   03790000
038000                   ,LAST_UPD_BY_UID                               03800000
038100                   ,APP_BY_UID                                    03810000
038200                   ,OTB_PER_NBR                                   03820000
038300                   ,DEPT_NBR                                      03830000
038400                   ,ENT_ID                                        03840000
038500                   ,STATUS_CDE                                    03850000
038600                   ,CRE_BY_UID                                    03860000
038700                   ,REJ_CT                                        03870000
038800                   ,REJ_UID                                       03880000
038900                   ,ORD_DTE                                       03890000
039000                   ,REVISION_CT                                   03900000
039100                   ,ADR_SEQ_NBR                                   03910000
039200                   ,DEST_KNOWN_IND                                03920000
039300                   ,RLSE_IND                                      03930000
039400                   ,RLSE_DTE                                      03940000
039500                   ,ANLYS_HOLD_IND                                03950000
039600                   ,PLCMNT_CNTRY_CDE                              03960000
039700                   ,PROD_CNTRY_CDE                                03970000
039800                   ,UNT_PER_CBMT_QTY                              03980000
039900                   ,TKT_FMT_NBR                                   03990000
040000                   ,TKT_FMT_DESC                                  04000000
040100                   ,CRE_TMST                                      04010000
040200                   ,PRG_LAST_ACTVY_DTE                            04020000
040300                   ,PKGNG_CDE                                     04030000
040400                   ,SEASET_YR                                     04040000
040500                   ,SEASET_SHRT_NM                                04050000
040600                   ,QTA_CTG_CDE                                   04060000
040700                   ,PO_IN_RMS_IND                                 04070000
040800                   ,RMS_PO_UPD_TMST                               04080000
040900                   ,IMPRT_VND_ID                                  04090000
041000                   ,IMPRT_FCTRY_ID                                04100000
041100                   ,DERVD_LBL_TYP_CDE                             04110000
041200                   ,DELY_ID                                       04120000
041300                   ,PO_SHRT_CYC_IND                               04130000
041400                   ,WHSE_RPLNT_IND)                               04140000
041500             VALUES (:PURCHS-PO-NBR                               04150000
041600                   , :PURCHS-VER-NBR                              04160000
041700                   , :PURCHS-VER-STATUS-CDE                       04170000
041800                   , :PURCHS-PO-TYP-CDE                           04180000
041900                   , :PURCHS-PO-CATEG-CDE                         04190000
042000                   , :PURCHS-EDI-IND                              04200000
042100                   , :PURCHS-TOT-UNT-QTY                          04210000
042200                   , :PURCHS-TOT-VAL-COST-AMT                     04220000
042300                   , :PURCHS-TOT-VAL-RTL-AMT                      04230000
042400                   , :PURCHS-TOT-MU-PCT                           04240000
042500                   , :PURCHS-TOT-SKUS-QTY                         04250000
042600                   , :PURCHS-IMPRT-AGNT-PO-NBR                    04260000
042700                   , :PURCHS-IMPRT-ORD-OFF-NAME                   04270000
042800                   , :PURCHS-IMPRT-VEND-NAME                      04280000
042900                   , :PURCHS-IMPRT-FCTRY-NAME                     04290000
043000                   , :PURCHS-IMPRT-CNTRY-NAME                     04300000
043100                   , :PURCHS-VEND-CNTRY-NAME                      04310000
043200                   , :PURCHS-NEW-STR-PO-IND                       04320000
043300                   , :PURCHS-IMPRT-PO-IND                         04330000
043400                   , :PURCHS-IMPRT-AGNT-PO-IND                    04340000
043500                   , :PURCHS-STATUS-TMST                          04350000
043600                   , :PURCHS-LAST-UPD-TMST                        04360000
043700                   , :PURCHS-EDI-REXMIT-IND                       04370000
043800                   , :PURCHS-EDI-REXMIT-TMST                      04380000
043900                   , :PURCHS-DIR-STR-IND                          04390000
044000                   , :PURCHS-LAST-UPD-BY-UID                      04400000
044100                   , :PURCHS-APP-BY-UID                           04410000
044200                   , :PURCHS-OTB-PER-NBR                          04420000
044300                   , :PURCHS-DEPT-NBR                             04430000
044400                   , :PURCHS-ENT-ID                               04440000
044500                   , :PURCHS-STATUS-CDE                           04450000
044600                   , :PURCHS-CRE-BY-UID                           04460000
044700                   , :PURCHS-REJ-CT                               04470000
044800                   , :PURCHS-REJ-UID                              04480000
044900                   , :PURCHS-ORD-DTE                              04490000
045000                   , :PURCHS-REVISION-CT                          04500000
045100                   , :PURCHS-ADR-SEQ-NBR                          04510000
045200                   , :PURCHS-DEST-KNOWN-IND                       04520000
045300                   , :PURCHS-RLSE-IND                             04530000
045400                   , :PURCHS-RLSE-DTE                             04540000
045500                   , :PURCHS-ANLYS-HOLD-IND                       04550000
045600                   , :PURCHS-PLCMNT-CNTRY-CDE                     04560000
045700                   , :PURCHS-PROD-CNTRY-CDE                       04570000
045800                   , :PURCHS-UNT-PER-CBMT-QTY                     04580000
045900                   , :PURCHS-TKT-FMT-NBR                          04590000
046000                   , :PURCHS-TKT-FMT-DESC                         04600000
046100                   , :PURCHS-CRE-TMST                             04610000
046200                   , :PURCHS-PRG-LAST-ACTVY-DTE                   04620000
046300                   , :PURCHS-PKGNG-CDE                            04630000
046400                   , :PURCHS-SEASET-YR                            04640000
046500                   , :PURCHS-SEASET-SHRT-NM                       04650000
046600                   , :PURCHS-QTA-CTG-CDE                          04660000
046700                   , :PURCHS-PO-IN-RMS-IND                        04670000
046800                   , :PV-CURRENT-TMST                             04680000
046900                   , :PURCHS-IMPRT-VND-ID                         04690000
047000                   , :PURCHS-IMPRT-FCTRY-ID                       04700000
047100                   , :PURCHS-DERVD-LBL-TYP-CDE                    04710000
047200                   , :PURCHS-DELY-ID:DN-DELY-ID-NULL              04720000
047300                   , :PURCHS-PO-SHRT-CYC-IND                      04730000
047400                   , :PURCHS-WHSE-RPLNT-IND)                      04740000
047500         END-EXEC                                                 04750000
047600                                                                  04760000
047700*CHECK SQL RETURN CODE FOR SUCCESS.                               04770000
047800         EVALUATE TRUE                                            04780000
047900           WHEN SQLCODE = 0                                       04790000
048000               SET PS-PROCESS-COMPLETE TO TRUE                    04800000
048100           WHEN OTHER                                             04810000
048200               SET PS-PROCESS-COMPLETE TO TRUE                    04820000
048300               SET XL011-SQL-ERROR     TO TRUE                    04830000
048400         END-EVALUATE.                                            04840000
048500                                                                  04850000
048600******************************************************************04860000
048700 2110-LOAD-INSERT-DATA.                                           04870000
048800                                                                  04880000
048900* JAK 04/2007 - ADD DEBUG LOGIC                                   04890000
049000     IF XL011-DEBUG-YES                                           04900000
049100         DISPLAY 'XLKUP005 - 2110-LOAD-INSERT-DATA'               04910000
049200     END-IF.                                                      04920000
049300                                                                  04930000
049400     MOVE XL011-ORDER-NBR            TO PURCHS-PO-NBR.            04940000
049500     MOVE 'A'                        TO PURCHS-VER-STATUS-CDE.    04950000
049600     MOVE +1                         TO PURCHS-VER-NBR.           04960000
049700     MOVE XL011-HA-PO-TYPE           TO PURCHS-PO-TYP-CDE.        04970000
049800     MOVE 'MR'                       TO PURCHS-PO-CATEG-CDE.      04980000
049900     MOVE XL011-HA-EDI-PO-IND        TO PURCHS-EDI-IND.           04990000
050000     MOVE ZEROES                     TO PURCHS-TOT-UNT-QTY.       05000000
050100     MOVE ZEROES                     TO PURCHS-TOT-VAL-COST-AMT.  05010000
050200     MOVE ZEROES                     TO PURCHS-TOT-VAL-RTL-AMT.   05020000
050300     MOVE ZEROES                     TO PURCHS-TOT-MU-PCT.        05030000
050400     MOVE ZEROES                     TO PURCHS-TOT-SKUS-QTY.      05040000
050500     MOVE ZEROES                     TO PURCHS-IMPRT-AGNT-PO-NBR. 05050000
050600     MOVE SPACES                     TO PURCHS-IMPRT-ORD-OFF-NAME.05060000
050700                                                                  05070000
050800     MOVE XL011-HA-IMPORT-VENDOR-NAME                             05080000
050900                                     TO PURCHS-IMPRT-VEND-NAME.   05090000
051000     MOVE XL011-HA-IMPORT-FACTORY-NAM                             05100000
051100                                     TO PURCHS-IMPRT-FCTRY-NAME.  05110000
051200     MOVE SPACES                     TO PURCHS-IMPRT-CNTRY-NAME.  05120000
051300     MOVE SPACES                     TO PURCHS-VEND-CNTRY-NAME.   05130000
051400     MOVE XL011-HA-NEW-STORE-PO-IND  TO PURCHS-NEW-STR-PO-IND.    05140000
051500     MOVE XL011-HA-IMPORT-ORDER-IND  TO PURCHS-IMPRT-PO-IND.      05150000
051600     MOVE SPACES                     TO PURCHS-IMPRT-AGNT-PO-IND. 05160000
051700     MOVE 'N'                        TO PURCHS-DEST-KNOWN-IND.    05170000
051800     MOVE XL011-HA-DERVD-LBL-TYP-CDE TO PURCHS-DERVD-LBL-TYP-CDE. 05180000
051900     IF XL011-HA-IMPORT-VENDOR-ID NUMERIC                         05190000
052000         MOVE XL011-HA-IMPORT-VENDOR-ID                           05200000
052100                                     TO PURCHS-IMPRT-VND-ID       05210000
052200     ELSE                                                         05220000
052300         MOVE ZERO                   TO PURCHS-IMPRT-VND-ID       05230000
052400     END-IF.                                                      05240000
052500     IF XL011-HA-IMPORT-FACTORY-ID NUMERIC                        05250000
052600         MOVE XL011-HA-IMPORT-FACTORY-ID                          05260000
052700                                     TO PURCHS-IMPRT-FCTRY-ID     05270000
052800     ELSE                                                         05280000
052900         MOVE ZERO                   TO PURCHS-IMPRT-FCTRY-ID     05290000
053000     END-IF.                                                      05300000
053100                                                                  05310000
053200*PURCHS-STATUS-TMST                                               05320000
053300     IF XL011-HA-STATUS = 'C'                                     05330000
053400        IF XL011-HA-CLOSE-DATE         > SPACES                   05340000
053500           MOVE XL011-HA-CLOSE-DATE    TO PV-CLOSE-DATE           05350000
053600           MOVE PV-CLOSE-DATE-CC       TO PV-X10-CC               05360000
053700           MOVE PV-CLOSE-DATE-YY       TO PV-X10-YY               05370000
053800           MOVE PV-CLOSE-DATE-MM       TO PV-X10-MM               05380000
053900           MOVE PV-CLOSE-DATE-DD       TO PV-X10-DD               05390000
054000           MOVE '-'                    TO PV-X10-H1               05400000
054100                                          PV-X10-H2               05410000
054200           MOVE PV-DATE-X10            TO PV-X26-DATE             05420000
054300                                                                  05430000
054400           MOVE '-'                    TO PV-X16-H1               05440000
054500           MOVE PV-CLOSE-DATE-HH       TO PV-X16-HH               05450000
054600           MOVE PV-CLOSE-DATE-MI       TO PV-X16-MI               05460000
054700           MOVE PV-CLOSE-DATE-SS       TO PV-X16-SS               05470000
054800           MOVE ZEROES                 TO PV-X16-999999           05480000
054900           MOVE '.'                    TO PV-X16-P1               05490000
055000                                          PV-X16-P2               05500000
055100                                          PV-X16-P3               05510000
055200           MOVE PV-TIME-X16            TO PV-X26-TIME             05520000
055300                                                                  05530000
055400           MOVE PV-TMST-X26            TO PURCHS-STATUS-TMST      05540000
055500        ELSE                                                      05550000
055600           MOVE PV-CURRENT-TMST        TO PURCHS-STATUS-TMST      05560000
055700        END-IF                                                    05570000
055800     ELSE                                                         05580000
055900         MOVE PV-CURRENT-TMST        TO PV-TMST-X26               05590000
056000         IF XL011-HA-ORIG-APPROVAL-DATE > SPACES                  05600000
056100             MOVE XL011-HA-ORIG-APPROVAL-DATE                     05610000
056200                                         TO PV-DATE-X08           05620000
056300             MOVE PV-X08-CC              TO PV-X10-CC             05630000
056400             MOVE PV-X08-YY              TO PV-X10-YY             05640000
056500             MOVE PV-X08-MM              TO PV-X10-MM             05650000
056600             MOVE PV-X08-DD              TO PV-X10-DD             05660000
056700             MOVE '-'                    TO PV-X10-H1             05670000
056800                                            PV-X10-H2             05680000
056900             MOVE PV-DATE-X10            TO PV-X26-DATE           05690000
057000             MOVE PV-TMST-X26            TO PURCHS-STATUS-TMST    05700000
057100         ELSE                                                     05710000
057200             MOVE PV-CURRENT-TMST        TO PURCHS-STATUS-TMST    05720000
057300         END-IF                                                   05730000
057400     END-IF.                                                      05740000
057500                                                                  05750000
057600     MOVE PV-CURRENT-TMST            TO PURCHS-LAST-UPD-TMST.     05760000
057700                                                                  05770000
057800     IF XL011-HA-PO-TYPE  = 'VN'                                  05780000
057900       AND XL011-HA-EDI-PO-IND = 'Y'                              05790000
058000         MOVE 'T'                    TO PURCHS-EDI-REXMIT-IND     05800000
058100     ELSE                                                         05810000
058200         MOVE ' '                    TO PURCHS-EDI-REXMIT-IND     05820000
058300     END-IF.                                                      05830000
058400     MOVE '0001-01-01-00.00.00.000000'                            05840000
058500                                     TO PURCHS-EDI-REXMIT-TMST    05850000
058600                                                                  05860000
058700     MOVE XL011-HA-DIR-TO-STORE-IND TO PURCHS-DIR-STR-IND.        05870000
058800     MOVE 'XLKUP005'                 TO PURCHS-LAST-UPD-BY-UID.   05880000
058900     MOVE XL011-HA-ORIG-APPROVAL-ID  TO PURCHS-APP-BY-UID.        05890000
059000                                                                  05900000
059100     MOVE XL011-HA-NOT-BEFORE-DATE(1:2)  TO PV-OTB-WORK-CC.       05910000
059200     MOVE XL011-HA-NOT-BEFORE-DATE(3:2)  TO PV-OTB-WORK-YY.       05920000
059300     MOVE XL011-HA-NOT-BEFORE-DATE(5:2)  TO PV-OTB-WORK-MM.       05930000
059400     MOVE XL011-HA-NOT-BEFORE-DATE(7:2)  TO PV-OTB-WORK-DD.       05940000
059500     PERFORM 4096-GET-WEEK-DATE.                                  05950000
059600     MOVE PV-NEW-OTB-DTE                 TO PURCHS-OTB-PER-NBR.   05960000
059700                                                                  05970000
059800     MOVE XL011-HA-DEPT(2:3)            TO PURCHS-DEPT-NBR.       05980000
059900                                                                  05990000
060000     MOVE XL011-HA-ENT-ID               TO PURCHS-ENT-ID.         06000000
060100                                                                  06010000
060200*PURCHS-STATUS-CDE.                                               06020000
060300     MOVE XL011-HA-STATUS TO STATCD-RMS-PO-STAT-CDE.              06030000
060400     EXEC SQL                                                     06040000
060500         SELECT STATUS_CDE                                        06050000
060600           INTO :STATCD-STATUS-CDE                                06060000
060700           FROM TSTATCD                                           06070000
060800          WHERE STATUS_TYP_CDE  = :PC-P                           06080000
060900            AND RMS_PO_STAT_CDE = :STATCD-RMS-PO-STAT-CDE         06090000
061000     END-EXEC.                                                    06100000
061100     EVALUATE TRUE                                                06110000
061200       WHEN SQLCODE = 0                                           06120000
061300           MOVE STATCD-STATUS-CDE    TO PURCHS-STATUS-CDE         06130000
061400       WHEN OTHER                                                 06140000
061500           SET PS-PROCESS-COMPLETE   TO TRUE                      06150000
061600     END-EVALUATE.                                                06160000
061700                                                                  06170000
061800     MOVE XL011-HA-CREATE-BY-USER-ID TO PURCHS-CRE-BY-UID.        06180000
061900     MOVE ZEROES                     TO PURCHS-REJ-CT.            06190000
062000     MOVE SPACES                     TO PURCHS-REJ-UID.           06200000
062100                                                                  06210000
062200*PURCHS-ORD-DTE.                                                  06220000
062300     IF XL011-HA-ORIG-APPROVAL-DATE = SPACES                      06230000
062400         MOVE '0001-01-01'               TO PURCHS-ORD-DTE        06240000
062500     ELSE                                                         06250000
062600         MOVE XL011-HA-ORIG-APPROVAL-DATE TO PV-DATE-X08          06260000
062700         MOVE PV-X08-CC                  TO PV-X10-CC             06270000
062800         MOVE PV-X08-YY                  TO PV-X10-YY             06280000
062900         MOVE PV-X08-MM                  TO PV-X10-MM             06290000
063000         MOVE PV-X08-DD                  TO PV-X10-DD             06300000
063100         MOVE '-'                        TO PV-X10-H1             06310000
063200                                            PV-X10-H2             06320000
063300         MOVE PV-DATE-X10                TO PURCHS-ORD-DTE        06330000
063400     END-IF.                                                      06340000
063500                                                                  06350000
063600     MOVE ZEROES                     TO PURCHS-REVISION-CT.       06360000
063700                                                                  06370000
063800* READ FIRST 2 TENTREP ROWS FOR PURCHS-ADR-SEQ-NBR.  IF THERE IS  06380000
063900* ONLY ONE ROW, USE IT.  IF MORE THAN ONE ROW, DEFAULT TO ZERO.   06390000
064000     MOVE ZEROES                     TO PURCHS-ADR-SEQ-NBR.       06400000
064100     MOVE PURCHS-ENT-ID              TO DK-ENT-ID.                06410000
064200     PERFORM 2120-OPEN-ENTREP-CSR.                                06420000
064300     PERFORM 2130-FETCH-ENTREP-CSR.                               06430000
064400     PERFORM 2140-CLOSE-ENTREP-CSR.                               06440000
064500                                                                  06450000
064600     IF XL011-HA-RELEASE-DATE > ZEROES                            06460000
064700         MOVE 'Y'                    TO PURCHS-RLSE-IND           06470000
064800         MOVE XL011-HA-RELEASE-DATE  TO PV-DATE-X08               06480000
064900         MOVE PV-X08-CC              TO PV-X10-CC                 06490000
065000         MOVE PV-X08-YY              TO PV-X10-YY                 06500000
065100         MOVE PV-X08-MM              TO PV-X10-MM                 06510000
065200         MOVE PV-X08-DD              TO PV-X10-DD                 06520000
065300         MOVE '-'                    TO PV-X10-H1                 06530000
065400                                        PV-X10-H2                 06540000
065500         MOVE PV-DATE-X10            TO PURCHS-RLSE-DTE           06550000
065600     ELSE                                                         06560000
065700         MOVE 'N'                    TO PURCHS-RLSE-IND           06570000
065800         MOVE '0001-01-01'           TO PURCHS-RLSE-DTE           06580000
065900     END-IF.                                                      06590000
066000     MOVE 'N'                        TO PURCHS-ANLYS-HOLD-IND.    06600000
066100                                                                  06610000
066200     MOVE XL011-HA-AGNT-OFC-CNTRY-CDE TO PURCHS-PLCMNT-CNTRY-CDE. 06620000
066300                                                                  06630000
066400     MOVE XL011-HA-C-O-PROD-CDE        TO PURCHS-PROD-CNTRY-CDE.  06640000
066500     MOVE XL011-HA-UNTS-PER-CUBIC-MTR                             06650000
066600                                     TO PURCHS-UNT-PER-CBMT-QTY.  06660000
066700     MOVE SPACES                     TO PURCHS-TKT-FMT-NBR.       06670000
066800     MOVE SPACES                     TO PURCHS-TKT-FMT-DESC.      06680000
066900                                                                  06690000
067000*WRITTEN DATE IS ACTUALLY THE CREATION DATE.                      06700000
067100     MOVE XL011-HA-WRITTEN-DATE      TO PV-DATE-X08.              06710000
067200     MOVE PV-X08-CC                  TO PV-X10-CC.                06720000
067300     MOVE PV-X08-YY                  TO PV-X10-YY.                06730000
067400     MOVE PV-X08-MM                  TO PV-X10-MM.                06740000
067500     MOVE PV-X08-DD                  TO PV-X10-DD.                06750000
067600     MOVE '-'                        TO PV-X10-H1                 06760000
067700                                        PV-X10-H2.                06770000
067800     MOVE PV-DATE-X10                TO PURCHS-PRG-LAST-ACTVY-DTE.06780000
067900     MOVE PV-CURRENT-TMST            TO PV-TMST-X26.              06790000
068000     MOVE PV-DATE-X10                TO PV-X26-DATE.              06800000
068100     MOVE PV-TMST-X26                TO PURCHS-CRE-TMST.          06810000
068200                                                                  06820000
068300     MOVE XL011-HA-PACKAGING-CODE    TO PURCHS-PKGNG-CDE.         06830000
068400     MOVE XL011-HA-SEASET-YEAR       TO PURCHS-SEASET-YR.         06840000
068500     MOVE XL011-HA-SEASET-SHORT-DESC TO PURCHS-SEASET-SHRT-NM.    06850000
068600                                                                  06860000
068700     MOVE 'Y'                        TO PURCHS-PO-IN-RMS-IND.     06870000
068800     MOVE XL011-HA-QTA-CTG-CDE       TO PURCHS-QTA-CTG-CDE.       06880000
068900                                                                  06890000
069000     IF XL011-HA-DELY-ID = SPACES                                 06900000
069100         MOVE -1                      TO DN-DELY-ID-NULL          06910000
069200     ELSE                                                         06920000
069300         MOVE ZERO                    TO DN-DELY-ID-NULL          06930000
069400         MOVE XL011-HA-DELY-ID        TO DP010I-UNEDITED-FIELD    06940000
069500         PERFORM 8000-NUMERIC-EDIT                                06950000
069600         IF NOT DP010I-ERROR-DETECTED                             06960000
069700             MOVE DP010I-NUMERIC-FIELD                            06970000
069800                                      TO PURCHS-DELY-ID           06980000
069900         ELSE                                                     06990000
070000             MOVE ZEROES              TO PURCHS-DELY-ID           07000000
070100     END-IF.                                                      07010000
070200                                                                  07020000
070300     IF XL011-HA-PO-SHRT-CYC-IND = SPACES                         07030000
070400         MOVE 'N'                     TO PURCHS-PO-SHRT-CYC-IND   07040000
070500     ELSE                                                         07050000
070600         MOVE XL011-HA-PO-SHRT-CYC-IND TO PURCHS-PO-SHRT-CYC-IND  07060000
070700     END-IF.                                                      07070000
070800** TO STORE THE RECEIVED WAREHOUSE INDICATOR FIELD ON THE TPURCHS 07080000
070900** TABLE **                                                       07090000
071000** MS 05/04/2010 BEG                                              07100000
071100                                                                  07110000
071200     IF XL011-HA-WHSE-RPLNT-IND = SPACES                          07120000
071300         MOVE 'N'                     TO PURCHS-WHSE-RPLNT-IND    07130000
071400     ELSE                                                         07140000
071410         MOVE XL011-HA-WHSE-RPLNT-IND TO PURCHS-WHSE-RPLNT-IND    07141000
071420     END-IF.                                                      07142000
071430                                                                  07143000
071440*    MOVE XL011-HA-WHSE-RPLNT-IND   TO PURCHS-WHSE-RPLNT-IND.     07144000
071450** MS 05/04/2010 END                                              07145000
071460                                                                  07146000
071470******************************************************************07147000
071480 2120-OPEN-ENTREP-CSR.                                            07148000
071490                                                                  07149000
071500* JAK 04/2007 - ADD DEBUG LOGIC                                   07150000
071600     IF XL011-DEBUG-YES                                           07160000
071700         DISPLAY 'XLKUP005 - 2120-OPEN-ENTREP-CSR'                07170000
071800     END-IF.                                                      07180000
071900                                                                  07190000
072000     EXEC SQL                                                     07200000
072100         OPEN ENTREP-CSR                                          07210000
072200     END-EXEC.                                                    07220000
072300                                                                  07230000
072400     EVALUATE TRUE                                                07240000
072500       WHEN SQLCODE = ZERO                                        07250000
072600           CONTINUE                                               07260000
072700       WHEN OTHER                                                 07270000
072800           SET PS-PROCESS-COMPLETE TO TRUE                        07280000
072900     END-EVALUATE.                                                07290000
073000                                                                  07300000
073100******************************************************************07310000
073200 2130-FETCH-ENTREP-CSR.                                           07320000
073300                                                                  07330000
073400* JAK 04/2007 - ADD DEBUG LOGIC                                   07340000
073500     IF XL011-DEBUG-YES                                           07350000
073600         DISPLAY 'XLKUP005 - 2130-FETCH-ENTREP-CSR'               07360000
073700     END-IF.                                                      07370000
073800                                                                  07380000
073900     EXEC SQL                                                     07390000
074000         FETCH ENTREP-CSR                                         07400000
074100          INTO :ENTREP-SEQ-NBR                                    07410000
074200     END-EXEC.                                                    07420000
074300                                                                  07430000
074400     EVALUATE TRUE                                                07440000
074500       WHEN SQLCODE = ZERO                                        07450000
074600           MOVE ENTREP-SEQ-NBR TO PURCHS-ADR-SEQ-NBR              07460000
074700       WHEN OTHER                                                 07470000
074800           MOVE ZERO           TO PURCHS-ADR-SEQ-NBR              07480000
074900     END-EVALUATE.                                                07490000
075000                                                                  07500000
075100******************************************************************07510000
075200 2140-CLOSE-ENTREP-CSR.                                           07520000
075300                                                                  07530000
075400* JAK 04/2007 - ADD DEBUG LOGIC                                   07540000
075500     IF XL011-DEBUG-YES                                           07550000
075600         DISPLAY 'XLKUP005 - 2140-CLOSE-ENTREP-CSR'               07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900     EXEC SQL                                                     07590000
076000         CLOSE ENTREP-CSR                                         07600000
076100     END-EXEC.                                                    07610000
076200                                                                  07620000
076300     EVALUATE TRUE                                                07630000
076400       WHEN SQLCODE = ZERO                                        07640000
076500           CONTINUE                                               07650000
076600       WHEN OTHER                                                 07660000
076700           SET PS-PROCESS-COMPLETE TO TRUE                        07670000
076800     END-EVALUATE.                                                07680000
076900                                                                  07690000
077000******************************************************************07700000
077100** ACTION TYPE - "HDR_CHANGE".                                    07710000
077200** BECAUSE OF VERSIONING SELECT THE ROW THAT IS BEING UPDATED     07720000
077300** UPDATE THAT ROW'S VER_STATUS_CDE FROM 'A' TO 'I' THEN INSERT   07730000
077400** A NEW ROW WITH VER_STATUS_CDE = 'A' AND ADD +1 TO VER_NBR.     07740000
077500******************************************************************07750000
077600 2200-UPDATE-DATA.                                                07760000
077700                                                                  07770000
077800* JAK 04/2007 - ADD DEBUG LOGIC                                   07780000
077900     IF XL011-DEBUG-YES                                           07790000
078000         DISPLAY 'XLKUP005 - 2200-UPDATE-DATA'                    07800000
078100     END-IF.                                                      07810000
078200                                                                  07820000
078300*SET TABLE DB2 KEYS.                                              07830000
078400     MOVE XL011-ORDER-NBR         TO PURCHS-PO-NBR.               07840000
078500     PERFORM 5000-VERSION-TPURCHS                                 07850000
078600     PERFORM 5010-UPDATE-VER-STATUS-CDE                           07860000
078700     IF PS-PROCESS-CONTINUE                                       07870000
078800         PERFORM 2210-HDR-CHANGE                                  07880000
078900     END-IF.                                                      07890000
079000                                                                  07900000
079100 2210-HDR-CHANGE.                                                 07910000
079200                                                                  07920000
079300* JAK 04/2007 - ADD DEBUG LOGIC                                   07930000
079400     IF XL011-DEBUG-YES                                           07940000
079500         DISPLAY 'XLKUP005 - 2210-HDR-CHANGE'                     07950000
079600     END-IF.                                                      07960000
079700                                                                  07970000
079800     MOVE '2210-HDR-CHANGE'         TO XL011-ERROR-PARAGRAPH      07980000
079900*SET FIELDS BEING UPDATED.                                        07990000
080000     MOVE XL011-HC-PO-TYPE        TO PURCHS-PO-TYP-CDE.           08000000
080100     MOVE XL011-HC-EDI-PO-IND     TO PURCHS-EDI-IND.              08010000
080200     MOVE XL011-HC-IMPORT-ORDER-IND TO PURCHS-IMPRT-PO-IND.       08020000
080300     MOVE 'XLKUP005'              TO PURCHS-LAST-UPD-BY-UID.      08030000
080400     MOVE PV-CURRENT-TMST         TO PURCHS-LAST-UPD-TMST.        08040000
080500                                                                  08050000
080600     MOVE XL011-HC-NOT-BEFORE-DATE(1:2)  TO PV-OTB-WORK-CC.       08060000
080700     MOVE XL011-HC-NOT-BEFORE-DATE(3:2)  TO PV-OTB-WORK-YY.       08070000
080800     MOVE XL011-HC-NOT-BEFORE-DATE(5:2)  TO PV-OTB-WORK-MM.       08080000
080900     MOVE XL011-HC-NOT-BEFORE-DATE(7:2)  TO PV-OTB-WORK-DD.       08090000
081000     PERFORM 4096-GET-WEEK-DATE.                                  08100000
081100     MOVE PV-NEW-OTB-DTE                 TO PURCHS-OTB-PER-NBR.   08110000
081200                                                                  08120000
081300     ADD +1                          TO PURCHS-VER-NBR.           08130000
081400     MOVE 'A'                        TO PURCHS-VER-STATUS-CDE.    08140000
081500     MOVE XL011-HC-DEPT(2:3)         TO PURCHS-DEPT-NBR.          08150000
081600** TO STORE THE RECEIVED WAREHOUSE INDICATOR FIELD ON THE TPURCHS 08160000
081700** TABLE **                                                       08170000
081800** MS 05/04/2010 BEG                                              08180000
081900*    IF XL011-HC-WHSE-RPLNT-IND = SPACES                          08190000
082000*        MOVE 'N'                     TO PURCHS-WHSE-RPLNT-IND    08200000
082100*    ELSE                                                         08210000
082200*        MOVE XL011-HC-WHSE-RPLNT-IND TO PURCHS-WHSE-RPLNT-IND    08220000
082300*    END-IF.                                                      08230000
082400*                                                                 08240000
082410*    MOVE XL011-HC-WHSE-RPLNT-IND        TO PURCHS-WHSE-RPLNT-IND.08241000
082420** MS 05/04/2010 END                                              08242000
082430                                                                  08243000
082440                                                                  08244000
082450     PERFORM 2100-INSERT-DATA.                                    08245000
082460                                                                  08246000
082470******************************************************************08247000
082480**UPDATE ACTION TYPE - "HDR_ATTR_CHANGE"                          08248000
082490******************************************************************08249000
082500 2300-UPDATE-DATA.                                                08250000
082600                                                                  08260000
082700* JAK 04/2007 - ADD DEBUG LOGIC                                   08270000
082800     IF XL011-DEBUG-YES                                           08280000
082900         DISPLAY 'XLKUP005 - 2300-UPDATE-DATA'                    08290000
083000     END-IF.                                                      08300000
083100                                                                  08310000
083200*SET TABLE DB2 KEYS.                                              08320000
083300     MOVE XL011-ORDER-NBR           TO PURCHS-PO-NBR.             08330000
083400     PERFORM 5000-VERSION-TPURCHS                                 08340000
083500     PERFORM 5010-UPDATE-VER-STATUS-CDE                           08350000
083600     IF PS-PROCESS-CONTINUE                                       08360000
083700         PERFORM 2310-HDR-ATTR-CHANGE                             08370000
083800     END-IF.                                                      08380000
083900                                                                  08390000
084000 2310-HDR-ATTR-CHANGE.                                            08400000
084100                                                                  08410000
084200* JAK 04/2007 - ADD DEBUG LOGIC                                   08420000
084300     IF XL011-DEBUG-YES                                           08430000
084400         DISPLAY 'XLKUP005 - 2310-HDR-ATTR-CHANGE'                08440000
084500     END-IF.                                                      08450000
084600                                                                  08460000
084700     MOVE '2310-HDR-ATTR-CHANGE'    TO XL011-ERROR-PARAGRAPH      08470000
084800                                                                  08480000
084900*SET FIELDS BEING UPDATED.                                        08490000
085000     MOVE 'XLKUP005'                 TO PURCHS-LAST-UPD-BY-UID.   08500000
085100     MOVE PV-CURRENT-TMST            TO PURCHS-LAST-UPD-TMST.     08510000
085200     MOVE XL011-HAC-NEW-STORE-PO-IND TO PURCHS-NEW-STR-PO-IND.    08520000
085300     MOVE XL011-HAC-DIR-TO-STORE-IND TO PURCHS-DIR-STR-IND.       08530000
085400     MOVE XL011-HAC-PACKAGING-CODE   TO PURCHS-PKGNG-CDE.         08540000
085500**GB 09/02/14                                                     08550000
085600**GB MOVE XL011-HAC-SEASET-YEAR      TO PURCHS-SEASET-YR.         08560000
085700**GB MOVE XL011-HAC-SEASET-SHORT-DESC TO PURCHS-SEASET-SHRT-NM.   08570000
085800     MOVE XL011-HAC-DERVD-LBL-TYP-CDE TO PURCHS-DERVD-LBL-TYP-CDE.08580000
085900     IF XL011-HAC-RELEASE-DATE > ZEROES                           08590000
086000         MOVE 'Y'                    TO PURCHS-RLSE-IND           08600000
086100         MOVE XL011-HAC-RELEASE-DATE  TO PV-DATE-X08              08610000
086200         MOVE PV-X08-CC              TO PV-X10-CC                 08620000
086300         MOVE PV-X08-YY              TO PV-X10-YY                 08630000
086400         MOVE PV-X08-MM              TO PV-X10-MM                 08640000
086500         MOVE PV-X08-DD              TO PV-X10-DD                 08650000
086600         MOVE '-'                    TO PV-X10-H1                 08660000
086700                                        PV-X10-H2                 08670000
086800         MOVE PV-DATE-X10            TO PURCHS-RLSE-DTE           08680000
086900     ELSE                                                         08690000
087000         MOVE 'N'                    TO PURCHS-RLSE-IND           08700000
087100         MOVE '0001-01-01'           TO PURCHS-RLSE-DTE           08710000
087200     END-IF.                                                      08720000
087300     ADD +1                          TO PURCHS-VER-NBR.           08730000
087400     MOVE 'A'                        TO PURCHS-VER-STATUS-CDE.    08740000
087500                                                                  08750000
087600     IF XL011-HAC-DELY-ID = SPACES                                08760000
087700         MOVE -1                      TO DN-DELY-ID-NULL          08770000
087800     ELSE                                                         08780000
087900         MOVE ZERO                    TO DN-DELY-ID-NULL          08790000
088000         MOVE XL011-HAC-DELY-ID       TO DP010I-UNEDITED-FIELD    08800000
088100         PERFORM 8000-NUMERIC-EDIT                                08810000
088200         IF NOT DP010I-ERROR-DETECTED                             08820000
088300             MOVE DP010I-NUMERIC-FIELD                            08830000
088400                                      TO PURCHS-DELY-ID           08840000
088500         ELSE                                                     08850000
088600             MOVE ZEROES              TO PURCHS-DELY-ID           08860000
088601     END-IF.                                                      08860100
088602                                                                  08860200
088603     IF XL011-HAC-PO-SHRT-CYC-IND = SPACES                        08860300
088604         MOVE 'N'                     TO PURCHS-PO-SHRT-CYC-IND   08860400
088605     ELSE                                                         08860500
088606         MOVE XL011-HAC-PO-SHRT-CYC-IND TO PURCHS-PO-SHRT-CYC-IND 08860600
088607     END-IF.                                                      08860700
088608** TO STORE THE RECEIVED WAREHOUSE INDICATOR FIELD ON THE TPURCHS 08860800
088609** TABLE **                                                       08860900
088610** MS 05/04/2010 BEG                                              08861000
088620     IF XL011-HAC-WHSE-RPLNT-IND = SPACES                         08862000
088630         MOVE 'N'                      TO PURCHS-WHSE-RPLNT-IND   08863000
088640     ELSE                                                         08864000
088650         MOVE XL011-HAC-WHSE-RPLNT-IND TO PURCHS-WHSE-RPLNT-IND   08865000
088660     END-IF.                                                      08866000
088670                                                                  08867000
088680*    MOVE XL011-HAC-WHSE-RPLNT-IND    TO PURCHS-WHSE-RPLNT-IND.   08868000
088690** MS 05/04/2010 END                                              08869000
088700                                                                  08870000
088800     PERFORM 2100-INSERT-DATA.                                    08880000
088900                                                                  08890000
089000******************************************************************08900000
089100**UPDATE ACTION TYPE - "HDR_IMPRT_CHANGE"                         08910000
089200******************************************************************08920000
089300 2400-UPDATE-DATA.                                                08930000
089400                                                                  08940000
089500* JAK 04/2007 - ADD DEBUG LOGIC                                   08950000
089600     IF XL011-DEBUG-YES                                           08960000
089700         DISPLAY 'XLKUP005 - 2400-UPDATE-DATA'                    08970000
089800     END-IF.                                                      08980000
089900                                                                  08990000
090000*SET TABLE DB2 KEYS.                                              09000000
090100     MOVE XL011-ORDER-NBR           TO PURCHS-PO-NBR.             09010000
090200     PERFORM 5000-VERSION-TPURCHS                                 09020000
090300     PERFORM 5010-UPDATE-VER-STATUS-CDE                           09030000
090400     IF PS-PROCESS-CONTINUE                                       09040000
090500         PERFORM 2410-HDR-IMPRT-CHANGE                            09050000
090600     END-IF.                                                      09060000
090700                                                                  09070000
090800 2410-HDR-IMPRT-CHANGE.                                           09080000
090900                                                                  09090000
091000* JAK 04/2007 - ADD DEBUG LOGIC                                   09100000
091100     IF XL011-DEBUG-YES                                           09110000
091200         DISPLAY 'XLKUP005 - 2410-HDR-IMPRT-CHANGE'               09120000
091300     END-IF.                                                      09130000
091400                                                                  09140000
091500     MOVE '2410-HDR-IMPRT-CHANGE'   TO XL011-ERROR-PARAGRAPH      09150000
091600*SET FIELDS BEING UPDATED.                                        09160000
091700     MOVE 'XLKUP005'                 TO PURCHS-LAST-UPD-BY-UID.   09170000
091800     MOVE PV-CURRENT-TMST           TO PURCHS-LAST-UPD-TMST.      09180000
091900     ADD +1                         TO PURCHS-VER-NBR.            09190000
092000     MOVE 'A'                       TO PURCHS-VER-STATUS-CDE.     09200000
092100                                                                  09210000
092200                                                                  09220000
092300     PERFORM 2100-INSERT-DATA.                                    09230000
092400                                                                  09240000
092500******************************************************************09250000
092600**UPDATE ACTION TYPE - "HDR_IMPRT_ATT_CHANGE"                     09260000
092700******************************************************************09270000
092800 2500-UPDATE-DATA.                                                09280000
092900                                                                  09290000
093000* JAK 04/2007 - ADD DEBUG LOGIC                                   09300000
093100     IF XL011-DEBUG-YES                                           09310000
093200         DISPLAY 'XLKUP005 - 2500-UPDATE-DATA'                    09320000
093300     END-IF.                                                      09330000
093400                                                                  09340000
093500*SET TABLE DB2 KEYS.                                              09350000
093600     MOVE XL011-ORDER-NBR           TO PURCHS-PO-NBR.             09360000
093700     PERFORM 5000-VERSION-TPURCHS                                 09370000
093800     PERFORM 5010-UPDATE-VER-STATUS-CDE                           09380000
093900     IF PS-PROCESS-CONTINUE                                       09390000
094000         PERFORM 2510-HDR-IMPRT-ATT-CHANGE                        09400000
094100     END-IF.                                                      09410000
094200                                                                  09420000
094300 2510-HDR-IMPRT-ATT-CHANGE.                                       09430000
094400                                                                  09440000
094500* JAK 04/2007 - ADD DEBUG LOGIC                                   09450000
094600     IF XL011-DEBUG-YES                                           09460000
094700         DISPLAY 'XLKUP005 - 2510-HDR-IMPRT-ATT-CHANGE'           09470000
094800     END-IF.                                                      09480000
094900                                                                  09490000
095000     MOVE '2510-HDR-IMPRT-ATT-CHANGE'   TO XL011-ERROR-PARAGRAPH  09500000
095100                                                                  09510000
095200*SET FIELDS BEING UPDATED.                                        09520000
095300     MOVE 'XLKUP005'                TO PURCHS-LAST-UPD-BY-UID.    09530000
095400     MOVE PV-CURRENT-TMST           TO PURCHS-LAST-UPD-TMST.      09540000
095500     MOVE XL011-IAC-QTA-CTG-CDE     TO PURCHS-QTA-CTG-CDE.        09550000
095600     MOVE XL011-IAC-IMPORT-VENDOR-NAME                            09560000
095700                                    TO PURCHS-IMPRT-VEND-NAME.    09570000
095800     MOVE XL011-IAC-IMPORT-FACTORY-NAM                            09580000
095900                                    TO PURCHS-IMPRT-FCTRY-NAME.   09590000
096000     MOVE XL011-IAC-AGNT-OFC-CNTRY-CDE                            09600000
096100                                    TO PURCHS-PLCMNT-CNTRY-CDE.   09610000
096200     MOVE XL011-IAC-UNTS-PER-CUBIC-MTR                            09620000
096300                                    TO PURCHS-UNT-PER-CBMT-QTY.   09630000
096400     IF XL011-IAC-IMPORT-VENDOR-ID NUMERIC                        09640000
096500         MOVE XL011-IAC-IMPORT-VENDOR-ID                          09650000
096600                                    TO PURCHS-IMPRT-VND-ID        09660000
096700     ELSE                                                         09670000
096800         MOVE ZERO                  TO PURCHS-IMPRT-VND-ID        09680000
096900     END-IF.                                                      09690000
097000     IF XL011-IAC-IMPORT-FACTORY-ID NUMERIC                       09700000
097100         MOVE XL011-IAC-IMPORT-FACTORY-ID                         09710000
097200                                    TO PURCHS-IMPRT-FCTRY-ID      09720000
097300     ELSE                                                         09730000
097400         MOVE ZERO                  TO PURCHS-IMPRT-FCTRY-ID      09740000
097500     END-IF.                                                      09750000
097600     ADD +1                         TO PURCHS-VER-NBR.            09760000
097700     MOVE 'A'                       TO PURCHS-VER-STATUS-CDE.     09770000
097800                                                                  09780000
097900                                                                  09790000
098000     PERFORM 2100-INSERT-DATA.                                    09800000
098100                                                                  09810000
098200******************************************************************09820000
098300* IF XL011-SC-STATUS = 'W' (WORKSHEET STATUS) AND THE CURRENT ROW 09830000
098400* STATUS IS 'AP' (APPROVED) OR 'CA' (CANCEL) OR 'CM' (COMPLETE)   09840000
098500* NO ERRORS WILL BE REPORTED AND PROCESSING WILL END AFTER THE    09850000
098600* RMS_UPD_TMST IS UPDATED.                                        09860000
098700******************************************************************09870000
098800******************************************************************09880000
098900**UPDATE ACTION TYPE - "HDR_STATUS_CHANGE"                        09890000
099000******************************************************************09900000
099100 2600-UPDATE-DATA.                                                09910000
099200                                                                  09920000
099300* JAK 04/2007 - ADD DEBUG LOGIC                                   09930000
099400     IF XL011-DEBUG-YES                                           09940000
099500         DISPLAY 'XLKUP005 - 2600-UPDATE-DATA'                    09950000
099600     END-IF.                                                      09960000
099700                                                                  09970000
099800*SET TABLE DB2 KEYS.                                              09980000
099900     MOVE XL011-ORDER-NBR           TO PURCHS-PO-NBR.             09990000
100000     PERFORM 5000-VERSION-TPURCHS                                 10000000
100100                                                                  10010000
100200* JAK 04/2007 - ADD DEBUG LOGIC                                   10020000
100300     IF XL011-DEBUG-YES                                           10030000
100400         DISPLAY 'XLKUP005 - XL011-SC-STATUS = ' XL011-SC-STATUS  10040000
100500         DISPLAY 'XLKUP005 - PURCHS-STATUS-CDE = '                10050000
100600                             PURCHS-STATUS-CDE                    10060000
100700     END-IF.                                                      10070000
100800                                                                  10080000
100900*    PURCHS-STATUS-CDE IS THE CURRENT STATUS.                     10090000
101000*    XL011-SC-STATUS IS THE FUTURE STATUS                         10100000
101100                                                                  10110000
101200     SET PS-SKIP-IT-NO        TO TRUE                             10120000
101300                                                                  10130000
101400     EVALUATE TRUE                                                10140000
101500     WHEN XL011-SC-STATUS = 'W'                                   10150000
101600*        CHANGE TO WORKSHEET STATUS                               10160000
101700         EVALUATE PURCHS-STATUS-CDE                               10170000
101800             WHEN 'AP'                                            10180000
101900             WHEN 'AC'                                            10190000
102000                 SET PS-SKIP-IT-YES   TO TRUE                     10200000
102100             WHEN 'CM'                                            10210000
102200             WHEN 'CA'                                            10220000
102300*               (THIS WILL CAUSE PURCHS-STATUS-CDE TO BE 'AP')    10230000
102400                 MOVE 'A'             TO XL011-SC-STATUS          10240000
102500         END-EVALUATE                                             10250000
102600                                                                  10260000
102700     WHEN XL011-SC-STATUS = 'S'                                   10270000
102800*        CHANGE TO SUBMITTED STATUS                               10280000
102900         IF PURCHS-STATUS-CDE  = 'AP' OR 'CA' OR 'CM' OR 'AC'     10290000
103000             SET PS-SKIP-IT-YES       TO TRUE                     10300000
103100         END-IF                                                   10310000
103200     END-EVALUATE                                                 10320000
103300                                                                  10330000
103400*    IF (XL011-SC-STATUS   = 'W' OR 'S') AND                      10340000
103500*      (PURCHS-STATUS-CDE  = 'AP' OR 'CA' OR 'CM' OR 'AC')        10350000
103600*       SET PS-PROCESS-COMPLETE TO TRUE                           10360000
103700*       EXEC SQL                                                  10370000
103800*         UPDATE TPURCHS                                          10380000
103900*            SET RMS_PO_UPD_TMST  = :PV-CURRENT-TMST              10390000
104000*         WHERE PO_NBR            = :DK-PO-NBR                    10400000
104100*            AND VER_STATUS_CDE   = 'A'                           10410000
104200*       END-EXEC                                                  10420000
104300*                                                                 10430000
104400*    END-IF.                                                      10440000
104500                                                                  10450000
104600     IF PS-SKIP-IT-NO                                             10460000
104700         PERFORM 5010-UPDATE-VER-STATUS-CDE                       10470000
104800         PERFORM 2610-HDR-STATUS-CHANGE                           10480000
104900     ELSE                                                         10490000
105000         EXEC SQL                                                 10500000
105100             UPDATE TPURCHS                                       10510000
105200                 SET RMS_PO_UPD_TMST  = :PV-CURRENT-TMST          10520000
105300             WHERE PO_NBR            = :DK-PO-NBR                 10530000
105400               AND VER_STATUS_CDE   = 'A'                         10540000
105500         END-EXEC                                                 10550000
105600                                                                  10560000
105700         SET PS-PROCESS-COMPLETE TO TRUE                          10570000
105800     END-IF.                                                      10580000
105900                                                                  10590000
106000 2610-HDR-STATUS-CHANGE.                                          10600000
106100                                                                  10610000
106200* JAK 04/2007 - ADD DEBUG LOGIC                                   10620000
106300     IF XL011-DEBUG-YES                                           10630000
106400         DISPLAY 'XLKUP005 - 2610-HDR-STATUS-CHANGE'              10640000
106500     END-IF.                                                      10650000
106600                                                                  10660000
106700     MOVE '2610-HDR-STATUS-CHANGE'  TO XL011-ERROR-PARAGRAPH      10670000
106800                                                                  10680000
106900*SET FIELDS BEING UPDATED.                                        10690000
107000     MOVE 'XLKUP005'                TO PURCHS-LAST-UPD-BY-UID.    10700000
107100     MOVE PV-CURRENT-TMST           TO PURCHS-LAST-UPD-TMST.      10710000
107200*    MOVE PV-CURRENT-TMST           TO PURCHS-STATUS-TMST.        10720000
107300     IF XL011-SC-STATUS = 'C'                                     10730000
107400        IF XL011-SC-CLOSE-DATE         > SPACES                   10740000
107500           MOVE XL011-SC-CLOSE-DATE    TO PV-CLOSE-DATE           10750000
107600           MOVE PV-CLOSE-DATE-CC       TO PV-X10-CC               10760000
107700           MOVE PV-CLOSE-DATE-YY       TO PV-X10-YY               10770000
107800           MOVE PV-CLOSE-DATE-MM       TO PV-X10-MM               10780000
107900           MOVE PV-CLOSE-DATE-DD       TO PV-X10-DD               10790000
108000           MOVE '-'                    TO PV-X10-H1               10800000
108100                                          PV-X10-H2               10810000
108200           MOVE PV-DATE-X10            TO PV-X26-DATE             10820000
108300                                                                  10830000
108400           MOVE '-'                    TO PV-X16-H1               10840000
108500           MOVE PV-CLOSE-DATE-HH       TO PV-X16-HH               10850000
108600           MOVE PV-CLOSE-DATE-MI       TO PV-X16-MI               10860000
108700           MOVE PV-CLOSE-DATE-SS       TO PV-X16-SS               10870000
108800           MOVE ZEROES                 TO PV-X16-999999           10880000
108900           MOVE '.'                    TO PV-X16-P1               10890000
109000                                          PV-X16-P2               10900000
109100                                          PV-X16-P3               10910000
109200           MOVE PV-TIME-X16            TO PV-X26-TIME             10920000
109300                                                                  10930000
109400           MOVE PV-TMST-X26            TO PURCHS-STATUS-TMST      10940000
109500        ELSE                                                      10950000
109600           MOVE PV-CURRENT-TMST        TO PURCHS-STATUS-TMST      10960000
109700        END-IF                                                    10970000
109800     ELSE                                                         10980000
109900         MOVE PV-CURRENT-TMST          TO PURCHS-STATUS-TMST      10990000
110000     END-IF.                                                      11000000
110100                                                                  11010000
110200     MOVE XL011-SC-ORIG-APPROVAL-ID                               11020000
110300                                    TO PURCHS-APP-BY-UID.         11030000
110400*    MOVE XL011-SC-ORIG-APPROVAL-ID                               11040000
110500*                                   TO PURCHS-CRE-BY-UID.         11050000
110600     ADD +1                         TO PURCHS-VER-NBR.            11060000
110700     MOVE 'A'                       TO PURCHS-VER-STATUS-CDE.     11070000
110800*PURCHS-ORD-DTE.                                                  11080000
110900     IF XL011-SC-ORIG-APPROVAL-DATE = SPACES                      11090000
111000         MOVE '0001-01-01'               TO PURCHS-ORD-DTE        11100000
111100     ELSE                                                         11110000
111200         MOVE XL011-SC-ORIG-APPROVAL-DATE TO PV-DATE-X08          11120000
111300         MOVE PV-X08-CC                  TO PV-X10-CC             11130000
111400         MOVE PV-X08-YY                  TO PV-X10-YY             11140000
111500         MOVE PV-X08-MM                  TO PV-X10-MM             11150000
111600         MOVE PV-X08-DD                  TO PV-X10-DD             11160000
111700         MOVE '-'                        TO PV-X10-H1             11170000
111800                                            PV-X10-H2             11180000
111900         MOVE PV-DATE-X10                TO PURCHS-ORD-DTE        11190000
112000     END-IF.                                                      11200000
112100                                                                  11210000
112200*PURCHS-STATUS-CDE.                                               11220000
112300     MOVE XL011-SC-STATUS        TO STATCD-RMS-PO-STAT-CDE.       11230000
112400     EXEC SQL                                                     11240000
112500         SELECT STATUS_CDE                                        11250000
112600           INTO :STATCD-STATUS-CDE                                11260000
112700           FROM TSTATCD                                           11270000
112800          WHERE STATUS_TYP_CDE  = :PC-P                           11280000
112900            AND RMS_PO_STAT_CDE = :STATCD-RMS-PO-STAT-CDE         11290000
113000     END-EXEC.                                                    11300000
113100     EVALUATE TRUE                                                11310000
113200       WHEN SQLCODE = 0                                           11320000
113300           MOVE STATCD-STATUS-CDE  TO PURCHS-STATUS-CDE           11330000
113400       WHEN OTHER                                                 11340000
113500           SET PS-PROCESS-COMPLETE TO TRUE                        11350000
113600           SET XL011-SQL-ERROR     TO TRUE                        11360000
113700     END-EVALUATE.                                                11370000
113800                                                                  11380000
113900     PERFORM 2100-INSERT-DATA.                                    11390000
114000                                                                  11400000
114100                                                                  11410000
114200                                                                  11420000
114300                                                                  11430000
114400******************************************************************11440000
114500******************************************************************11450000
114600**UPDATE ACTION TYPE - "HDR_ORIG_CTRY_CHANGE"                     11460000
114700******************************************************************11470000
114800 2700-UPDATE-DATA.                                                11480000
114900                                                                  11490000
115000* JAK 04/2007 - ADD DEBUG LOGIC                                   11500000
115100     IF XL011-DEBUG-YES                                           11510000
115200         DISPLAY 'XLKUP005 - 2700-UPDATE-DATA'                    11520000
115300     END-IF.                                                      11530000
115400                                                                  11540000
115500*SET TABLE DB2 KEYS.                                              11550000
115600     MOVE XL011-ORDER-NBR           TO PURCHS-PO-NBR.             11560000
115700                                                                  11570000
115800     PERFORM 5000-VERSION-TPURCHS                                 11580000
115900     PERFORM 5010-UPDATE-VER-STATUS-CDE                           11590000
116000     IF PS-PROCESS-CONTINUE                                       11600000
116100         PERFORM 2710-HDR-ORIG-CTRY-CHANGE                        11610000
116200     END-IF.                                                      11620000
116300                                                                  11630000
116400 2710-HDR-ORIG-CTRY-CHANGE.                                       11640000
116500                                                                  11650000
116600* JAK 04/2007 - ADD DEBUG LOGIC                                   11660000
116700     IF XL011-DEBUG-YES                                           11670000
116800         DISPLAY 'XLKUP005 - 2710-HDR-ORIG-CTRY-CHANGE'           11680000
116900     END-IF.                                                      11690000
117000                                                                  11700000
117100     MOVE '2710-HDR-ORIG-CTRY-CHANGE'   TO XL011-ERROR-PARAGRAPH  11710000
117200*SET FIELDS BEING UPDATED.                                        11720000
117300     MOVE 'XLKUP005'                TO PURCHS-LAST-UPD-BY-UID.    11730000
117400     MOVE PV-CURRENT-TMST           TO PURCHS-LAST-UPD-TMST.      11740000
117500     MOVE XL011-OCC-C-O-PROD-CDE    TO PURCHS-PROD-CNTRY-CDE.     11750000
117600     ADD +1                         TO PURCHS-VER-NBR.            11760000
117700     MOVE 'A'                       TO PURCHS-VER-STATUS-CDE.     11770000
117800                                                                  11780000
117900                                                                  11790000
118000     PERFORM 2100-INSERT-DATA.                                    11800000
118100                                                                  11810000
118200******************************************************************11820000
118300**DELETE TYPE ACTION                                              11830000
118400******************************************************************11840000
118500 2800-DELETE-DATA.                                                11850000
118600                                                                  11860000
118700* JAK 04/2007 - ADD DEBUG LOGIC                                   11870000
118800     IF XL011-DEBUG-YES                                           11880000
118900         DISPLAY 'XLKUP005 - 2800-DELETE-DATA'                    11890000
119000     END-IF.                                                      11900000
119100                                                                  11910000
119200     MOVE XL011-ORDER-NBR        TO DK-PO-NBR.                    11920000
119300                                                                  11930000
119400                                                                  11940000
119500         EXEC SQL                                                 11950000
119600             DELETE FROM TPURCHS                                  11960000
119700              WHERE PO_NBR   = :DK-PO-NBR                         11970000
119800         END-EXEC                                                 11980000
119900                                                                  11990000
120000         MOVE SQLCODE                     TO XL011-SQLCODE        12000000
120100*CHECK SQL RETURN CODE FOR SUCCESS.                               12010000
120200         EVALUATE TRUE                                            12020000
120300           WHEN SQLCODE = 0                                       12030000
120400               SET PS-PROCESS-COMPLETE TO TRUE                    12040000
120500                                                                  12050000
120600           WHEN OTHER                                             12060000
120700               SET XL011-SQL-ERROR      TO TRUE                   12070000
120800               SET PS-PROCESS-COMPLETE TO TRUE                    12080000
120900         END-EVALUATE.                                            12090000
121000                                                                  12100000
121100                                                                  12110000
121200                                                                  12120000
121300                                                                  12130000
121400******************************************************************12140000
121500*   GET OTB MONTH, YEAR AND WEEK                                  12150000
121600******************************************************************12160000
121700 4096-GET-WEEK-DATE.                                              12170000
121800                                                                  12180000
121900* JAK 04/2007 - ADD DEBUG LOGIC                                   12190000
122000     IF XL011-DEBUG-YES                                           12200000
122100         DISPLAY 'XLKUP005 - 4096-GET-WEEK-DATE'                  12210000
122200     END-IF.                                                      12220000
122300                                                                  12230000
122400     MOVE PV-OTB-WORK-DATE TO POWS055-INPUT-DATE.                 12240000
122500     PERFORM POPD055-CALC-WEEKLY-OTB.                             12250000
122600     IF POWS055-NO-ERROR                                          12260000
122700           MOVE POWS055-OTB-YEAR  TO PV-NEW-OTB-CCYY              12270000
122800           MOVE POWS055-OTB-MONTH TO PV-NEW-OTB-MM                12280000
122900     ELSE                                                         12290000
123000           PERFORM 7000-SELECT-LAST-OTB                           12300000
123100           MOVE DK-YEAR           TO PV-NEW-OTB-CCYY              12310000
123200           MOVE DK-MONTH          TO PV-NEW-OTB-MM                12320000
123300     END-IF.                                                      12330000
123400                                                                  12340000
123500***************************************************************** 12350000
123600**VERSIONING FOR TPURCHS.                                         12360000
123700***************************************************************** 12370000
123800 5000-VERSION-TPURCHS.                                            12380000
123900                                                                  12390000
124000* JAK 04/2007 - ADD DEBUG LOGIC                                   12400000
124100     IF XL011-DEBUG-YES                                           12410000
124200         DISPLAY 'XLKUP005 - 5000-VERSION-TPURCHS'                12420000
124300     END-IF.                                                      12430000
124400                                                                  12440000
124500     INITIALIZE DCLTPURCHS.                                       12450000
124600     MOVE '5000-VERSION-TPURCHS'      TO XL011-ERROR-PARAGRAPH.   12460000
124700                                                                  12470000
124800** TO INCLUDE THE WAREHOUSE REPLENISHMENT INDICATOR COLUMN IN THE 12480000
124900** QUERY TO MAINTAIN THE PURCHASE ORDER VERSION **                12490000
125000** MS 05/04/2010                                                  12500000
125100         EXEC SQL                                                 12510000
125200             SELECT PO_NBR                                        12520000
125300                   ,VER_NBR                                       12530000
125400                   ,VER_STATUS_CDE                                12540000
125500                   ,PO_TYP_CDE                                    12550000
125600                   ,PO_CATEG_CDE                                  12560000
125700                   ,EDI_IND                                       12570000
125800                   ,TOT_UNT_QTY                                   12580000
125900                   ,TOT_VAL_COST_AMT                              12590000
126000                   ,TOT_VAL_RTL_AMT                               12600000
126100                   ,TOT_MU_PCT                                    12610000
126200                   ,TOT_SKUS_QTY                                  12620000
126300                   ,IMPRT_AGNT_PO_NBR                             12630000
126400                   ,IMPRT_ORD_OFF_NAME                            12640000
126500                   ,IMPRT_VEND_NAME                               12650000
126600                   ,IMPRT_FCTRY_NAME                              12660000
126700                   ,IMPRT_CNTRY_NAME                              12670000
126800                   ,VEND_CNTRY_NAME                               12680000
126900                   ,NEW_STR_PO_IND                                12690000
127000                   ,IMPRT_PO_IND                                  12700000
127100                   ,IMPRT_AGNT_PO_IND                             12710000
127200                   ,STATUS_TMST                                   12720000
127300                   ,LAST_UPD_TMST                                 12730000
127400                   ,EDI_REXMIT_IND                                12740000
127500                   ,EDI_REXMIT_TMST                               12750000
127600                   ,DIR_STR_IND                                   12760000
127700                   ,LAST_UPD_BY_UID                               12770000
127800                   ,APP_BY_UID                                    12780000
127900                   ,OTB_PER_NBR                                   12790000
128000                   ,DEPT_NBR                                      12800000
128100                   ,ENT_ID                                        12810000
128200                   ,STATUS_CDE                                    12820000
128300                   ,CRE_BY_UID                                    12830000
128400                   ,REJ_CT                                        12840000
128500                   ,REJ_UID                                       12850000
128600                   ,ORD_DTE                                       12860000
128700                   ,REVISION_CT                                   12870000
128800                   ,ADR_SEQ_NBR                                   12880000
128900                   ,DEST_KNOWN_IND                                12890000
129000                   ,RLSE_IND                                      12900000
129100                   ,RLSE_DTE                                      12910000
129200                   ,ANLYS_HOLD_IND                                12920000
129300                   ,PLCMNT_CNTRY_CDE                              12930000
129400                   ,PROD_CNTRY_CDE                                12940000
129500                   ,UNT_PER_CBMT_QTY                              12950000
129600                   ,TKT_FMT_NBR                                   12960000
129700                   ,TKT_FMT_DESC                                  12970000
129800                   ,CRE_TMST                                      12980000
129900                   ,PRG_LAST_ACTVY_DTE                            12990000
130000                   ,PKGNG_CDE                                     13000000
130100                   ,SEASET_YR                                     13010000
130200                   ,SEASET_SHRT_NM                                13020000
130300                   ,QTA_CTG_CDE                                   13030000
130400                   ,PO_IN_RMS_IND                                 13040000
130500                   ,RMS_PO_UPD_TMST                               13050000
130600                   ,DUP_SKU_IND                                   13060000
130700                   ,ORIG_PKGNG_CDE                                13070000
130800                   ,IMPRT_VND_ID                                  13080000
130900                   ,IMPRT_FCTRY_ID                                13090000
131000                   ,DERVD_LBL_TYP_CDE                             13100000
131100                   ,DELY_ID                                       13110000
131200                   ,PO_SHRT_CYC_IND                               13120000
131300                   ,WHSE_RPLNT_IND                                13130000
131400               INTO  :PURCHS-PO-NBR                               13140000
131500                   , :PURCHS-VER-NBR                              13150000
131600                   , :PURCHS-VER-STATUS-CDE                       13160000
131700                   , :PURCHS-PO-TYP-CDE                           13170000
131800                   , :PURCHS-PO-CATEG-CDE                         13180000
131900                   , :PURCHS-EDI-IND                              13190000
132000                   , :PURCHS-TOT-UNT-QTY                          13200000
132100                   , :PURCHS-TOT-VAL-COST-AMT                     13210000
132200                   , :PURCHS-TOT-VAL-RTL-AMT                      13220000
132300                   , :PURCHS-TOT-MU-PCT                           13230000
132400                   , :PURCHS-TOT-SKUS-QTY                         13240000
132500                   , :PURCHS-IMPRT-AGNT-PO-NBR                    13250000
132600                   , :PURCHS-IMPRT-ORD-OFF-NAME                   13260000
132700                   , :PURCHS-IMPRT-VEND-NAME                      13270000
132800                   , :PURCHS-IMPRT-FCTRY-NAME                     13280000
132900                   , :PURCHS-IMPRT-CNTRY-NAME                     13290000
133000                   , :PURCHS-VEND-CNTRY-NAME                      13300000
133100                   , :PURCHS-NEW-STR-PO-IND                       13310000
133200                   , :PURCHS-IMPRT-PO-IND                         13320000
133300                   , :PURCHS-IMPRT-AGNT-PO-IND                    13330000
133400                   , :PURCHS-STATUS-TMST                          13340000
133500                   , :PURCHS-LAST-UPD-TMST                        13350000
133600                   , :PURCHS-EDI-REXMIT-IND                       13360000
133700                   , :PURCHS-EDI-REXMIT-TMST                      13370000
133800                   , :PURCHS-DIR-STR-IND                          13380000
133900                   , :PURCHS-LAST-UPD-BY-UID                      13390000
134000                   , :PURCHS-APP-BY-UID                           13400000
134100                   , :PURCHS-OTB-PER-NBR                          13410000
134200                   , :PURCHS-DEPT-NBR                             13420000
134300                   , :PURCHS-ENT-ID                               13430000
134400                   , :PURCHS-STATUS-CDE                           13440000
134500                   , :PURCHS-CRE-BY-UID                           13450000
134600                   , :PURCHS-REJ-CT                               13460000
134700                   , :PURCHS-REJ-UID                              13470000
134800                   , :PURCHS-ORD-DTE                              13480000
134900                   , :PURCHS-REVISION-CT                          13490000
135000                   , :PURCHS-ADR-SEQ-NBR                          13500000
135100                   , :PURCHS-DEST-KNOWN-IND                       13510000
135200                   , :PURCHS-RLSE-IND                             13520000
135300                   , :PURCHS-RLSE-DTE                             13530000
135400                   , :PURCHS-ANLYS-HOLD-IND                       13540000
135500                   , :PURCHS-PLCMNT-CNTRY-CDE                     13550000
135600                   , :PURCHS-PROD-CNTRY-CDE                       13560000
135700                   , :PURCHS-UNT-PER-CBMT-QTY                     13570000
135800                   , :PURCHS-TKT-FMT-NBR                          13580000
135900                   , :PURCHS-TKT-FMT-DESC                         13590000
136000                   , :PURCHS-CRE-TMST                             13600000
136100                   , :PURCHS-PRG-LAST-ACTVY-DTE                   13610000
136200                   , :PURCHS-PKGNG-CDE                            13620000
136300                   , :PURCHS-SEASET-YR                            13630000
136400                   , :PURCHS-SEASET-SHRT-NM                       13640000
136500                   , :PURCHS-QTA-CTG-CDE                          13650000
136600                   , :PURCHS-PO-IN-RMS-IND                        13660000
136700                   , :PURCHS-RMS-PO-UPD-TMST                      13670000
136800                   , :PURCHS-DUP-SKU-IND                          13680000
136900                   , :PURCHS-ORIG-PKGNG-CDE                       13690000
137000                   , :PURCHS-IMPRT-VND-ID                         13700000
137100                   , :PURCHS-IMPRT-FCTRY-ID                       13710000
137200                   , :PURCHS-DERVD-LBL-TYP-CDE                    13720000
137300                   , :PURCHS-DELY-ID:DN-DELY-ID-NULL              13730000
137400                   , :PURCHS-PO-SHRT-CYC-IND                      13740000
137500                   , :PURCHS-WHSE-RPLNT-IND                       13750000
137600          FROM TPURCHS                                            13760000
137700             WHERE PO_NBR         = :DK-PO-NBR                    13770000
137800               AND VER_STATUS_CDE = 'A'                           13780000
137900         END-EXEC                                                 13790000
138000                                                                  13800000
138100*CHECK SQL RETURN CODE FOR SUCCESS.                               13810000
138200         EVALUATE TRUE                                            13820000
138300           WHEN SQLCODE = 0                                       13830000
138400               CONTINUE                                           13840000
138500           WHEN OTHER                                             13850000
138600               SET PS-PROCESS-COMPLETE TO TRUE                    13860000
138700               SET XL011-SQL-ERROR     TO TRUE                    13870000
138800         END-EVALUATE.                                            13880000
138900/                                                                 13890000
139000***************************************************************** 13900000
139100**VERSIONING FOR TPURCHS.                                         13910000
139200***************************************************************** 13920000
139300 5010-UPDATE-VER-STATUS-CDE.                                      13930000
139400                                                                  13940000
139500* JAK 04/2007 - ADD DEBUG LOGIC                                   13950000
139600     IF XL011-DEBUG-YES                                           13960000
139700         DISPLAY 'XLKUP005 - 5010-UPDATE-VER-STATUS-CDE'          13970000
139800     END-IF.                                                      13980000
139900                                                                  13990000
140000     EXEC SQL                                                     14000000
140100         UPDATE TPURCHS                                           14010000
140200             SET VER_STATUS_CDE = 'I'                             14020000
140300             WHERE PO_NBR         = :DK-PO-NBR                    14030000
140400             AND VER_STATUS_CDE = 'A'                             14040000
140500     END-EXEC                                                     14050000
140600                                                                  14060000
140700     MOVE SQLCODE                   TO XL011-SQLCODE              14070000
140800     EVALUATE TRUE                                                14080000
140900         WHEN SQLCODE = 0                                         14090000
141000             CONTINUE                                             14100000
141100         WHEN OTHER                                               14110000
141200             SET PS-PROCESS-COMPLETE TO TRUE                      14120000
141300             SET XL011-SQL-ERROR     TO TRUE                      14130000
141400     END-EVALUATE.                                                14140000
141500                                                                  14150000
141600 7000-SELECT-LAST-OTB.                                            14160000
141700                                                                  14170000
141800* JAK 04/2007 - ADD DEBUG LOGIC                                   14180000
141900     IF XL011-DEBUG-YES                                           14190000
142000         DISPLAY 'XLKUP005 - 7000-SELECT-LAST-OTB'                14200000
142100         DISPLAY 'XLKUP005 - XL011-ORDER-NBR = ' XL011-ORDER-NBR  14210000
142200     END-IF.                                                      14220000
142300                                                                  14230000
142400     EXEC SQL                                                     14240000
142500            SELECT                                                14250000
142600                CHAR(YEAR(KY_DTE))                                14260000
142700               ,CHAR(MONTH(KY_DTE))                               14270000
142800             INTO                                                 14280000
142900                :DK-YEAR                                          14290000
143000               ,:DK-MONTH                                         14300000
143100            FROM                                                  14310000
143200                TDTATTR  A                                        14320000
143300            WHERE                                                 14330000
143400                A.KY_DTE =                                        14340000
143500                (                                                 14350000
143600                SELECT MAX(B.KY_DTE)                              14360000
143700                FROM TDTATTR B                                    14370000
143800                )                                                 14380000
143900             WITH UR                                              14390000
144000     END-EXEC                                                     14400000
144100                                                                  14410000
144200     EVALUATE TRUE                                                14420000
144300       WHEN SQLCODE = ZERO                                        14430000
144400           SET PS-PROCESS-COMPLETE   TO TRUE                      14440000
144500           MOVE DK-YEAR               TO PV-YEAR-N                14450000
144600           MOVE DK-MONTH              TO PV-MONTH-N               14460000
144700           MOVE PV-YEAR-X             TO POWS055-OTB-YEAR         14470000
144800           MOVE PV-MONTH-X (3:2)      TO POWS055-OTB-MONTH        14480000
144900       WHEN OTHER                                                 14490000
145000           CONTINUE                                               14500000
145100     END-EVALUATE.                                                14510000
145200                                                                  14520000
145300 8000-NUMERIC-EDIT.                                               14530000
145400                                                                  14540000
145500     MOVE +10                         TO DP010I-MAXIMUM-DIGITS    14550000
145600     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  14560000
145700     SET DP010I-NEGATIVE-NOT-ALLOWED                              14570000
145800                                      TO TRUE                     14580000
145900                                                                  14590000
146000     CALL DP010I-NUMERIC-EDIT-ROUTINE                             14600000
146010         USING DP010I-NUMERIC-EDIT-AREA.                          14601000
146100                                                                  14610000
146200******************************************************************14620000
146300**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        14630000
146400******************************************************************14640000
146500 9999-WRAPUP.                                                     14650000
146600                                                                  14660000
146700* JAK 04/2007 - ADD DEBUG LOGIC                                   14670000
146800     IF XL011-DEBUG-YES                                           14680000
146900         DISPLAY 'XLKUP005 - 9999-WRAPUP'                         14690000
147000     END-IF.                                                      14700000
147100                                                                  14710000
147200     MOVE SQLCODE                     TO XL011-SQLCODE            14720000
147300     MOVE SQLCA                       TO XL011-SQLCA.             14730000
147400                                                                  14740000
147500******************************************************************14750000
147600*    COPYBOOK MODULE FOR OPEN TO BUY CALCULATIONS                *14760000
147700******************************************************************14770000
147800                                                                  14780000
147900     COPY POPD055.                                                14790000
148000/                                                                 14800000
148100******************************************************************14810000
148200*    EXIT PROGRAM.                                                14820000
