000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400*                                                                 00040000
000500 PROGRAM-ID.    MPKUT023.                                         00050000
000600 AUTHOR.        CHUCK ALBERTY -- STRATAGEM.                       00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800 DATE-WRITTEN.  05/17/94.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000*                                                                 00100000
001100******************************************************************00110000
001200*                                                                 00120000
001300*    THIS PROGRAM SUMS THE STORE QUANTITIES AND COMPARES THAT     00130000
001400*    WITH THE TOTAL AMOUNT KEYED FROM DATA ENTRY.  IF THERE ARE   00140000
001500*    DISCREPANCIES AN ERROR LINE IS WRITTEN.  THE FILE IS THEN    00150000
001600*    REFORMATTED INTO A VERTICAL FILE TO BE PROCESSED BACK INTO   00160000
001700*    THE MP SYSTEM AND A HORIZONTAL FILE IS PROCESSED INTO THE    00170000
001800*    COMMON B10 RECEIPT LAYOUTS FOR THE FASHION SALES SYSTEM.     00180000
141630*                                                                 00190022
141630*    MAY, 2016 - JIM HUNTER     CHG0141630                        00200022
141630*    WRITING GIV RECORDS FOR AP RECEIVERS THAT ARE                00210022
141630*    NOT LOC-TYPE 'CS' CENTRAL STOCK.                             00220022
141630*                                                                 00230022
141630*    02/14/2023- JEAN KURK      CHG0281369                        00231023
141630*    REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE                  00232023
141630*                                                                 00234023
141630*                                                                 00240022
002000******************************************************************00250000
002100                                                                  00260000
002200******************************************************************00270000
002300 ENVIRONMENT DIVISION.                                            00280000
002400******************************************************************00290000
002500*                                                                 00300000
002600 CONFIGURATION SECTION.                                           00310000
002700*                                                                 00320000
002800 OBJECT-COMPUTER.  IBM-3090.                                      00330000
002900 SOURCE-COMPUTER.  IBM-3090.                                      00340000
003000*                                                                 00350000
003100 INPUT-OUTPUT SECTION.                                            00360000
003200*                                                                 00370000
003300 FILE-CONTROL.                                                    00380000
003400     SELECT STORE-EXTRACT-FILE                                    00390000
003500         ASSIGN TO INP01.                                         00400000
003600     SELECT RECEIPTS-OUTPUT-FILE                                  00410000
003700         ASSIGN TO OUT01.                                         00420000
003800     SELECT STR-EXT-BALANCE-FILE                                  00430000
003900         ASSIGN TO OUT02.                                         00440000
      * GIV JULY RELEASE CHG0115958 START                               00450009
           SELECT DTS-RECEIPTS-OUTPUT-FILE                              00460009
               ASSIGN TO OUT03.                                         00470001
      * GIV JULY RELEASE CHG0115958 END                                 00480009
004000     SELECT ERROR-REPORT-FILE                                     00490000
004100         ASSIGN TO RPT01.                                         00500000
004200*                                                                 00510000
004300*                                                                 00520000
004400******************************************************************00530000
004500 DATA DIVISION.                                                   00540000
004600******************************************************************00550000
004700*                                                                 00560000
004800 FILE SECTION.                                                    00570000
004900*                                                                 00580000
005000 FD  STORE-EXTRACT-FILE                                           00590000
005100     RECORDING MODE IS F                                          00600000
005200     BLOCK CONTAINS 0 RECORDS.                                    00610000
005300 01  STORE-EXTRACT-RECORD          PIC  X(300).                   00620000
005400*                                                                 00630000
005500 FD  RECEIPTS-OUTPUT-FILE                                         00640000
005600     RECORDING MODE IS F                                          00650000
005700     BLOCK CONTAINS 0 RECORDS.                                    00660000
005800 01  RECEIPTS-OUTPUT-RECORD        PIC  X(200).                   00670000
005900*                                                                 00680000
      * GIV JULY RELEASE CHG0115958 START                               00690009
       FD  DTS-RECEIPTS-OUTPUT-FILE                                     00700001
           RECORDING MODE IS F                                          00710001
           BLOCK CONTAINS 0 RECORDS.                                    00720001
       01  DTS-RECEIPTS-OUTPUT-RECORD    PIC  X(200).                   00730001
      *                                                                 00740001
      * GIV JULY RELEASE CHG0115958 END                                 00750009
006000 FD  STR-EXT-BALANCE-FILE                                         00760000
006100     RECORDING MODE IS F                                          00770000
006200     BLOCK CONTAINS 0 RECORDS.                                    00780000
006300 01  STR-EXT-BAL-OUTPUT-RECORD     PIC  X(200).                   00790000
006400*                                                                 00800000
006500 FD  ERROR-REPORT-FILE                                            00810000
006600     RECORDING MODE IS F                                          00820000
006700     BLOCK CONTAINS 0 RECORDS.                                    00830000
006800 01  ERROR-REPORT-RECORD           PIC  X(132).                   00840000
006900*                                                                 00850000
007000*                                                                 00860000
007100 WORKING-STORAGE SECTION.                                         00870000
007200*                                                                 00880000
007300 01  CC-CONTROL-CARD                  PIC X(27).                  00890000
007400 01  CC-CONTROL-CARDR REDEFINES CC-CONTROL-CARD.                  00900000
007500     05  CC-YEAR                      PIC X(04).                  00910000
007600     05  CC-DASH1                     PIC X(01).                  00920000
007700     05  CC-MONTH                     PIC X(02).                  00930000
007800     05  CC-DASH2                     PIC X(01).                  00940000
007900     05  CC-DAY                       PIC X(02).                  00950000
008000     05  FILLER                       PIC X(01).                  00960000
008100     05  CC-RUN-DESCRIPTION           PIC X(16).                  00970000
008200         88  CC-VALID-MODE-IND        VALUE 'ORIG-NIGHTLY-RUN'    00980000
008300                                            'PRE-RUN         '.   00990000
008400         88  CC-ORIG-NIGHTLY-RUN      VALUE 'ORIG-NIGHTLY-RUN'.   01000000
008500         88  CC-PRE-RUN               VALUE 'PRE-RUN         '.   01010000
008600*                                                                 01020000
008700 01  PS-PROGRAM-SWITCHES.                                         01030000
008800     05  PS-RENUM-SKU-SW           PIC  X(01)      VALUE 'Y'.     01040000
008900         88  PS-RENUM-SKU-FOUND                    VALUE 'Y'.     01050000
009000         88  PS-RENUM-SKU-NOT-FOUND                VALUE 'N'.     01060000
009100     05  PS-SKU-SW                 PIC  X(01)      VALUE 'Y'.     01070000
009200         88  PS-SKU-VALID                          VALUE 'Y'.     01080000
009300         88  PS-SKU-INVALID                        VALUE 'N'.     01090000
009400     05  PS-STORE-EXTRACT-EOF-SW   PIC  X(03)      VALUE 'BOF'.   01100000
009500         88  PS-STORE-EXTRACT-EOF                  VALUE 'EOF'.   01110000
009600     05  PS-SPLIT-SW               PIC  X(01)      VALUE 'N'.     01120000
009700         88  PS-SPLITS-DONE                        VALUE 'Y'.     01130000
009800     05  PS-NOT-INTIAL-READ-SW     PIC  X(01)      VALUE 'N'.     01140000
009900         88  PS-INTIAL-READ                        VALUE 'Y'.     01150000
010000         88  PS-NOT-INTIAL-READ                    VALUE 'N'.     01160000
010100*                                                                 01170000
010200*                                                                 01180000
010300 01  PC-PROGRAM-CONSTANTS.                                        01190000
010400     05  PC-END-REPORT-LINE.                                      01200000
010500         10  FILLER                PIC  X(46)      VALUE SPACES.  01210000
010600         10  FILLER                PIC  X(41)      VALUE          01220000
010700             '*****   E N D   O F   R E P O R T   *****'.         01230000
010800         10  FILLER                PIC  X(45)      VALUE SPACES.  01240000
010900     05  PC-ITEM-NBR               PIC S9(15)      COMP-3         01250000
011000                                                   VALUE ZERO.    01260000
011100     05  PC-MAX-RETRIES            PIC S9(04)      COMP SYNC      01270000
011200                                                   VALUE +2.      01280000
011300     05  PC-MBS-PGM                PIC  X(08)      VALUE          01290000
011400         'DPKUT039'.                                              01300000
011500     05  PC-MBS-OP-CO-03           PIC  X(02)      VALUE '03'.    01310000
011600     05  PC-MBS-SYSTEM-CODE-ML     PIC  X(02)      VALUE 'ML'.    01320000
011700     05  PC-SKU-RECEIPT-CODE       PIC  X(08)      VALUE          01330000
011800         'DFSMSB10'.                                              01340000
011900     05  PC-TSK-STATUS-CODE-RENUM  PIC S9(03)      COMP-3         01350000
012000                                                   VALUE +98.     01360000
012100     05  PC-UNIT-OF-MEASURE        PIC  9(02)      VALUE 01.      01370000
012200     05  PC-UPC-CODE-ALL-ZERO      PIC S9(15)      COMP-3         01380000
012300                                                   VALUE ZERO.    01390000
012400     05  PC-QTY                    PIC S9(07)      COMP-3         01400000
012500                                                   VALUE ZERO.    01410000
012600     05  PC-QTY-REMAINDER          PIC S9(07)      COMP-3         01420000
012700                                                   VALUE ZERO.    01430000
012800     05  PC-QTY-MAX                PIC 9(05)       VALUE          01440000
012900                                                   99999.         01450000
013000*                                                                 01460000
013100*                                                                 01470000
013200 01  PV-PROGRAM-VARIABLES.                                        01480000
013300     05  PV-ABEND-CODE             PIC S9(04)      COMP SYNC      01490000
013400                                                   VALUE ZERO.    01500000
013500     05  PV-ABEND-PARAGRAPH        PIC  X(30)      VALUE SPACES.  01510000
013600     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01520000
013700     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01530000
013800     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    01540000
013900     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    01550000
014000     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01560000
014100     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01570000
014200     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01580000
014300     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01590000
014400                                                                  01600000
014500     05  PV-JOB-RUN                   PIC X(16)  VALUE SPACES.    01610000
014600                                                                  01620000
014700     05  PV-BATCH.                                                01630000
014800         10  PV-BATCH-1            PIC  9(01)      VALUE 9.       01640000
014900         10  PV-BATCH-JULIAN-DATE-DDD                             01650000
015000                                   PIC  9(03)      VALUE ZERO.    01660000
015100     05  PV-CURR-KEY.                                             01670000
015200         10  PV-CURR-KEY-PO-NBR    PIC  9(08)      VALUE ZERO.    01680000
015300         10  PV-CURR-KEY-REC-SEQ   PIC  9(03)      VALUE ZERO.    01690000
015400         10  PV-CURR-KEY-LINE-NBR  PIC  9(03)      VALUE ZERO.    01700000
015500     05  PV-ERR-MSG-1              PIC  X(80)      VALUE SPACES.  01710000
015600         88  PV-ERR-MSG-1-01                       VALUE          01720000
015700             'ERROR ON OPEN OF STORE-CSR'.                        01730000
015800         88  PV-ERR-MSG-1-02                       VALUE          01740000
015900             'ERROR ON FETCH OF STORE-CSR'.                       01750000
016000         88  PV-ERR-MSG-1-03                       VALUE          01760000
016100             'ERROR ON CLOSE OF STORE-CSR'.                       01770000
016200         88  PV-ERR-MSG-1-04                       VALUE          01780000
016300             'ERROR ON CALL TO XLKUT001   '.                      01790000
016400     05  PV-ERR-MSG-2              PIC  X(80)      VALUE SPACES.  01800000
016500     05  PV-ITEM-NBR               PIC S9(15)      COMP-3         01810000
016600                                                   VALUE ZERO.    01820000
016700     05  PV-CURRENT-CC             PIC  X(02)      VALUE SPACES.  01830000
016800                                                                  01840000
016900     05  PV-RCPT-YEAR.                                            01850000
017000         10  PV-RCPT-CC            PIC  X(02)      VALUE SPACES.  01860000
017100         10  PV-RCPT-YY            PIC  X(02)      VALUE SPACES.  01870000
017200     05  PV-VFRD-YEAR.                                            01880000
017300         10  PV-VRFD-CC            PIC  X(02)      VALUE SPACES.  01890000
017400         10  PV-VRFD-YY            PIC  X(02)      VALUE SPACES.  01900000
017500     05  PV-JULIAN-DATE.                                          01910000
017600         10  PV-JULIAN-DATE-YY     PIC  9(02)      VALUE ZERO.    01920000
017700         10  PV-JULIAN-DATE-DDD    PIC  9(03)      VALUE ZERO.    01930000
017800     05  PV-LINE-COUNT             PIC S9(04)      VALUE ZERO     01940000
017900                                                   COMP SYNC.     01950000
018000     05  PV-MBS-MCL.                                              01960000
018100         10  PV-MBS-MCL-1          PIC  X(01)      VALUE SPACE.   01970000
018200         10  PV-MBS-MCL-2          PIC  X(01)      VALUE '0'.     01980000
018300     05  PV-MBS-SCL.                                              01990000
018400         10  PV-MBS-SCL-1          PIC  X(01)      VALUE '0'.     02000000
018500         10  PV-MBS-SCL-2-3.                                      02010000
018600             15  PV-MBS-SCL-2      PIC  X(01)      VALUE SPACE.   02020000
018700             15  PV-MBS-SCL-3      PIC  X(01)      VALUE SPACE.   02030000
018800     05  PV-PAGE-COUNT             PIC S9(04)      VALUE ZERO     02040000
018900                                                   COMP SYNC.     02050000
019000     05  PV-READ-COUNT             PIC S9(07)      VALUE ZERO.    02060000
019100                                                                  02070000
019200     05  PV-RECORD-COUNT           PIC S9(09)      COMP-3         02080000
019300                                                   VALUE ZERO.    02090000
019400     05  PV-RECS-IN                PIC S9(07)      VALUE ZERO.    02100000
019500     05  PV-RECS-IN-ED             PIC  Z,ZZZ,ZZZ  VALUE ZERO.    02110000
019600     05  PV-RECS-OUT               PIC S9(07)      VALUE ZERO.    02120000
019700     05  PV-RECS-OUT-ED            PIC  Z,ZZZ,ZZZ  VALUE ZERO.    02130000
      * GIV JULY RELEASE CHG0115958 START                               02140009
           05  PV-DTS-RECS-OUT           PIC S9(07)      VALUE ZERO.    02150001
           05  PV-DTS-RECS-OUT-ED        PIC  Z,ZZZ,ZZZ  VALUE ZERO.    02160001
      * GIV JULY RELEASE CHG0115958 END                                 02170009
141630     05  PV-AP-RECS-OUT            PIC S9(07)      VALUE ZERO.    02180022
141630     05  PV-AP-RECS-OUT-ED         PIC  Z,ZZZ,ZZZ  VALUE ZERO.    02190022
019800     05  PV-BAL-RECS-OUT           PIC S9(07)      VALUE ZERO.    02200000
019900     05  PV-RETRY-COUNT            PIC S9(04)      COMP SYNC      02210000
020000                                                   VALUE ZERO.    02220000
020100     05  PV-SEQ-NBR                PIC  9(03)      VALUE ZERO.    02230000
020200     05  PV-LOCATION-NBR           PIC  S9(04) COMP.              02240000
141630     05  PV-LOC-TYP-CDE            PIC  X(02)      VALUE SPACES.  02250022
020300     05  PV-SAVE-KEY.                                             02260000
020400         10  PV-SAVE-KEY-PO-NBR    PIC  9(08)      VALUE ZERO.    02270000
020500         10  PV-SAVE-KEY-REC-SEQ   PIC  9(03)      VALUE ZERO.    02280000
020600         10  PV-SAVE-KEY-LINE-NBR  PIC  9(03)      VALUE ZERO.    02290000
020700     05  PV-SAVE-SKU               PIC  X(08)      VALUE SPACES.  02300000
020800     05  PV-SYSTEM-DATE.                                          02310000
020900         10  PV-SYSTEM-DATE-YY     PIC  X(02)      VALUE SPACES.  02320000
021000         10  PV-SYSTEM-DATE-MM     PIC  X(02)      VALUE SPACES.  02330000
021100         10  PV-SYSTEM-DATE-DD     PIC  X(02)      VALUE SPACES.  02340000
021200     05  PV-SYSTEM-TIME.                                          02350000
021300         10  PV-SYSTEM-TIME-HH     PIC  9(02)      VALUE ZERO.    02360000
021400         10  PV-SYSTEM-TIME-MM     PIC  9(02)      VALUE ZERO.    02370000
021500         10  FILLER                PIC  9(04)      VALUE ZERO.    02380000
021600*                                                                 02390000
021700     05  PV-UPC-CODE               PIC S9(15)      COMP-3         02400000
021800                                                   VALUE ZERO.    02410000
021900     05  PV-DISPLAY-SKU            PIC  X(08).                    02420000
022000     05  PV-DISPLAY-ITM            PIC  X(16).                    02430000
022100                                                                  02440000
022200     05  PV-TOTAL-UNIT-QTY         PIC S9(09)      COMP-3         02450000
022300                                                   VALUE ZERO.    02460000
022400                                                                  02470000
022500     05  PV-TOTAL-RETAIL-QTY       PIC S9(11)V99   COMP-3         02480000
022600                                                   VALUE ZERO.    02490000
022700*                                                                 02500000
022800*                                                                 02510000
022900 01  PT-LOC-TABLE.                                                02520000
023000     05  PT-LOC-OCC OCCURS 9999 TIMES                             02530000
023100                      INDEXED BY PTST-INDX                        02540000
023200                                 PTST-INDX-MAX.                   02550000
023300         10  PT-LOC-NBR            PIC S9(04)      COMP.          02560000
023400         10  PT-LOC-QTY            PIC S9(09)      COMP-3.        02570000
      * GIV JULY RELEASE CHG0115958 START                               02580009
023400         10  PT-LOC-TYP            PIC  X(02).                    02590006
      * GIV JULY RELEASE CHG0115958 END                                 02600009
141630* SOURCE OF THE PT-LOC-TYP ABOVE IS THE SE-RECEIVING-LOCATION     02610022
141630* FIELD ON THE STORE EXTRACT INPUT FILE.  IT IS CREATED IN        02620022
141630* RCKUT004 - IT WILL BE SET TO EITHER 'DC' (FOR DC'S) OR          02630022
141630* 'DS' FOR EVERYTHING ELSE ('DS', 'CS' OR 'RV').                  02640022
141630* THE VALUE IS BASED ON THE OPER_UNT_ID VALUE ON TRECEIV.         02650022
141630         10  PT-LOC-REC-TYP        PIC  X(02).                    02660022
141630* SOURCE OF THE PT-LOC-REC-TYP ABOVE IS THE SE-REC-TYP-CDE        02670022
141630* FIELD ON THE STORE EXTRACT INPUT FILE.  IT IS BEING ADDED       02680022
141630* AS PART OF THE REQUEST TO SEND UPDATES FOR 'AP' RECEIVERS       02690022
141630* TO GIV.                                                         02700022
141630         10  PT-LOC-TYP-AP-CHECK   PIC  X(02).                    02710022
141630* SOURCE OF THE PT-LOC-TYP-AP-CHECK FIELD ABOVE IS THE            02720022
141630* LOC_TYP_CDE FIELD ON THE XLT_LOC TABLE.                         02730022
141630* IT IS BEING ADDED AS PART OF THE REQUEST TO SEND UPDATES FOR    02740022
141630* 'AP' RECEIVERS TO GIV - IT WILL BE USED TO MAKE SURE THAT       02750022
141630* CENTRAL STOCK ('CS') UPDATES ARE NOT SENT SINCE THEY ARE        02760022
141630* HANDLED BY ANOTHER PROGRAM.                                     02770022
023500*                                                                 02780000
023600*                                                                 02790000
023700 01  HEADING-LINES.                                               02800000
023800     05  HEADING-LINE-1.                                          02810000
023900         10  FILLER                PIC  X(52)      VALUE SPACES.  02820000
024000         10  FILLER                PIC  X(29)      VALUE          02830000
024100             'PURCHASE ORDER RECEIPT ERRORS'.                     02840000
024200         10  FILLER                PIC  X(51)      VALUE SPACES.  02850000
024300     05  HEADING-LINE-2.                                          02860000
024400         10  FILLER                PIC  X(44)      VALUE          02870000
024500             'BATCH     PO DATE    PO NUMBER   SEQ      OR'.      02880000
024600         10  FILLER                PIC  X(44)      VALUE          02890000
024700             'IG SKU       RENUM SKU     TOTAL PRICE     T'.      02900000
024800         10  FILLER                PIC  X(44)      VALUE          02910000
024900             'OTAL QTY     ----- DESCRIPTION ----         '.      02920000
025000 01  DETAIL-LINE.                                                 02930000
025100     05  DL-BATCH                  PIC  X(04).                    02940000
025200     05  FILLER                    PIC  X(05)      VALUE SPACES.  02950000
025300     05  DL-PO-DATE-MM             PIC  X(02).                    02960000
025400     05  FILLER                    PIC  X(01)      VALUE '/'.     02970000
025500     05  DL-PO-DATE-DD             PIC  X(02).                    02980000
025600     05  FILLER                    PIC  X(01)      VALUE '/'.     02990000
025700     05  DL-PO-DATE-YY             PIC  X(02).                    03000000
025800     05  FILLER                    PIC  X(05)      VALUE SPACES.  03010000
025900     05  DL-PO-NUMBER              PIC  X(08).                    03020000
026000     05  FILLER                    PIC  X(03)      VALUE ' - '.   03030000
026100     05  DL-PO-REC-SEQ             PIC  X(03).                    03040000
026200     05  FILLER                    PIC  X(05)      VALUE SPACES.  03050000
026300     05  DL-ORIG-SKU               PIC  X(08).                    03060000
026400     05  FILLER                    PIC  X(07)      VALUE SPACES.  03070000
026500     05  DL-SKU-RENUM              PIC  X(03).                    03080000
026600     05  FILLER                    PIC  X(11)      VALUE SPACES.  03090000
026700     05  DL-TOTAL-PRICE            PIC  Z,ZZZ,ZZ9.99.             03100000
026800     05  FILLER                    PIC  X(05)      VALUE SPACES.  03110000
026900     05  DL-TOTAL-QTY              PIC  Z,ZZZ,ZZ9.                03120000
027000     05  FILLER                    PIC  X(05)      VALUE SPACES.  03130000
027100     05  DL-ERROR-MSG              PIC  X(22).                    03140000
027200         88  DL-SKU-NOT-FOUND                      VALUE          03150000
027300             'SKU NOT FOUND         '.                            03160000
027400     05  FILLER                    PIC  X(09)      VALUE SPACES.  03170000
027500*                                                                 03180000
027600*                                                                 03190000
027700******************************************************************03200000
027800*   STORE EXTRACT RECORD LAYOUT                                   03210000
027900******************************************************************03220000
028000     COPY STOREEXT.                                               03230000
028100*                                                                 03240000
028200*                                                                 03250000
028300******************************************************************03260000
028400*   FASHION SALES MAINTENANCE RECORD LAYOUTS.                     03270000
028500******************************************************************03280000
028600     COPY FSRD036.                                                03290000
028700*                                                                 03300000
028800******************************************************************03310000
028900*  USED FOR MBS EXTRACT ROUTINE (USED TO VALIDATE DEPT/CLASS)     03320000
029000******************************************************************03330000
029100     COPY DPWS003.                                                03340000
029200*                                                                 03350000
029300*                                                                 03360000
029400******************************************************************03370000
029500*  USED FOR DB2 ERROR MESSAGE BUILDING                            03380000
029600******************************************************************03390000
029700     COPY DPWS004.                                                03400000
029800*                                                                 03410000
029900*                                                                 03420000
030600******************************************************************03490000
030700*   FIELDS FOR PRINTING 132 CHARACTER REPORT                      03500000
030800******************************************************************03510000
030900     COPY DPWS132O.                                               03520000
031000*                                                                 03530000
031100******************************************************************03540000
031200*  DOMAIN ITEM MODULE                                             03550000
031300     COPY XLWS001.                                                03560000
031400******************************************************************03570000
031500*                                                                 03580000
031600******************************************************************03590000
031700*   RECORD LAYOUT FOR BALANCE FILE - USED TO COMPARE RCK080 EARLY 03600000
031800*   RUN WITH MPK060 NORMAL RUN.                                   03610000
031900******************************************************************03620000
032000     COPY RCRD077.                                                03630000
032100*                                                                 03640000
032200*                                                                 03650000
032300/                                                                 03660000
032400                                                                  03670000
032500*                                                                 03680000
032600******************************************************************03690000
032700*  DB2 COMMUNICATION AREA                                         03700000
032800******************************************************************03710000
032900     EXEC SQL                                                     03720000
033000          INCLUDE SQLCA                                           03730000
033100     END-EXEC.                                                    03740000
033200*                                                                 03750000
033300******************************************************************03760000
033400*  DB2 COMMUNICATION AREA 2                                       03770000
033500******************************************************************03780000
033600     COPY SQLCA2.                                                 03790000
033700*                                                                 03800000
033800*                                                                 03810000
033900******************************************************************03820000
034000*DB2 AREA FOR COMPANY CONTROL TABLE                               03830000
034100******************************************************************03840000
034200     EXEC SQL                                                     03850000
034300          INCLUDE TCOCNTL                                         03860000
034400     END-EXEC.                                                    03870000
034500*                                                                 03880000
034600******************************************************************03890000
034700*  MERCHANDISE LEDGER - DATE RECORD TABLE                         03900000
034800******************************************************************03910000
034900     EXEC SQL                                                     03920000
035000          INCLUDE TDTATTR                                         03930000
035100     END-EXEC.                                                    03940000
035200*                                                                 03950000
035300******************************************************************03960000
035400*  DOMAIN LOCATION TABLE                                          03970000
035500******************************************************************03980000
035600     EXEC SQL                                                     03990000
035700          INCLUDE XLT00010                                        04000000
035800     END-EXEC.                                                    04010000
035900*                                                                 04020000
036000******************************************************************04030000
036100*  STORE DB2 SELECT                                               04040000
036200******************************************************************04050000
036300     EXEC SQL                                                     04060000
036400          DECLARE STORE-CSR CURSOR FOR                            04070000
036500           SELECT LOC_NBR                                         04080000
036600              ,   SUBSTR(CHAR(YEAR(CURRENT DATE)),1,2)            04090000
141630              ,   LOC_TYP_CDE                                     04100022
036700             FROM XLT_LOC                                         04110000
036800            WHERE LOC_TYP_CDE  IN ('DS', 'DC', 'CS', 'RV')        04120000
036900              AND FINCL_CLO_DTE IS NULL                           04130000
037000             ORDER BY LOC_NBR                                     04140000
037100     END-EXEC.                                                    04150000
037200*                                                                 04160000
037300*                                                                 04170000
037400******************************************************************04180000
037500 PROCEDURE DIVISION.                                              04190000
037600******************************************************************04200000
037700     EXEC SQL                                                     04210000
037800          WHENEVER SQLWARNING GO TO 9800-SQL-WARNING              04220000
037900     END-EXEC.                                                    04230000
038000*                                                                 04240000
038100*                                                                 04250000
038200 0000-MAIN-DRIVER.                                                04260000
038300******************************************************************04270000
038400*  THIS PARAGRAPH CONTROLS THE OVERALL FLOW OF THE PROGRAM.  IT   04280000
038500*  FIRST OPENS THE FILES, THEN FORMATS THE BATCH NUMBER FOR THE   04290000
038600*  PARTICULAR RUN.  THEN IT LOADS THE WORKING STORAGE TABLE WITH  04300000
038700*  VALID STORE NUMBERS FROM THE BATCH STORE DATABASE.  THE INIT-  04310000
038800*  IAL READ IS THEN PERFORMED ON THE INPUT FILE.  THE MAIN LOGIC  04320000
038900*  IS THEN PERFORMED UNTIL ITS END.  THE FILES ARE THEN CLOSED    04330000
039000*  AND THE PROGRAM IS TERMINATED.                                 04340000
039100******************************************************************04350000
039200     PERFORM 1000-INITIAL-PROCESS.                                04360000
039300*                                                                 04370000
039400     PERFORM 2000-MAIN-PROCESS                                    04380000
039500       UNTIL PS-STORE-EXTRACT-EOF.                                04390000
039600*                                                                 04400000
039700     PERFORM 9000-END-PROCESS.                                    04410000
039800*                                                                 04420000
039900     GOBACK.                                                      04430000
040000*                                                                 04440000
040100*                                                                 04450000
040200 1000-INITIAL-PROCESS.                                            04460000
040300******************************************************************04470000
040400*  IS THEN PERFORMED UNTIL ITS END.  THE FILES ARE THEN CLOSED    04480000
040500*  AND THE PROGRAM IS TERMINATED.                                 04490000
040600******************************************************************04500000
040700     INITIALIZE PT-LOC-TABLE.                                     04510000
040800     ACCEPT PV-JULIAN-DATE FROM DAY.                              04520000
040900     ACCEPT PV-SYSTEM-DATE FROM DATE.                             04530000
041000     ACCEPT PV-SYSTEM-TIME FROM TIME.                             04540000
041100     MOVE PV-JULIAN-DATE-DDD         TO PV-BATCH-JULIAN-DATE-DDD. 04550000
041200*                                                                 04560000
041300     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           04570000
041400     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS:  '             04580000
041500             CC-CONTROL-CARD.                                     04590000
041600     IF NOT CC-VALID-MODE-IND                                     04600000
041700        DISPLAY '***************************'                     04610000
041800        DISPLAY 'CONTROL PARAMETERS: '                            04620000
041900                 CC-CONTROL-CARD                                  04630000
042000        DISPLAY 'MODE INDICATOR "' CC-RUN-DESCRIPTION '"'         04640000
042100                ' IS INVALID.'                                    04650000
042200        DISPLAY 'RUN ABORTED'                                     04660000
042300        DISPLAY '***************************'                     04670000
042400        PERFORM 9999-ABEND-PROGRAM                                04680000
042500     END-IF                                                       04690000
042600                                                                  04700000
042700                                                                  04710000
042800     IF CC-PRE-RUN                                                04720000
042900        PERFORM 1005-SELECT-TCOCNTL                               04730000
043000     ELSE                                                         04740000
043100        IF CC-ORIG-NIGHTLY-RUN                                    04750000
043200           PERFORM 1005A-SELECT-TCOCNTL                           04760000
043300        END-IF                                                    04770000
043400     END-IF.                                                      04780000
043500                                                                  04790000
043600     PERFORM 1006-SELECT-TDTATTR.                                 04800000
043700                                                                  04810000
043800     PERFORM 1010-OPEN-STORE-CSR.                                 04820000
043900     PERFORM 1025-FETCH-STORE-CSR.                                04830000
044000*                                                                 04840000
044100     PERFORM 1020-PROCESS-STORE-CSR                               04850000
044200       UNTIL SQLCODE = +100.                                      04860000
044300*                                                                 04870000
044400     PERFORM 1030-CLOSE-STORE-CSR.                                04880000
044500*                                                                 04890000
044600     OPEN INPUT  STORE-EXTRACT-FILE                               04900000
044700          OUTPUT RECEIPTS-OUTPUT-FILE                             04910000
044800                 STR-EXT-BALANCE-FILE                             04920000
      * GIV JULY RELEASE CHG0115958 START                               04930009
                       DTS-RECEIPTS-OUTPUT-FILE                         04940001
      * GIV JULY RELEASE CHG0115958 END                                 04950009
044900                 ERROR-REPORT-FILE.                               04960000
045000*                                                                 04970000
045100     MOVE PV-SYSTEM-DATE-YY          TO DP132O-RUN-YEAR.          04980000
045200     MOVE PV-SYSTEM-DATE-MM          TO DP132O-RUN-MONTH.         04990000
045300     MOVE PV-SYSTEM-DATE-DD          TO DP132O-RUN-DAY.           05000000
045400     MOVE PV-SYSTEM-TIME-HH          TO DP132O-RUN-HOUR.          05010000
045500     MOVE PV-SYSTEM-TIME-MM          TO DP132O-RUN-MINUTE.        05020000
045600     MOVE 'MPKUT023'                 TO DP132O-PROGRAM-NAME.      05030000
045700     MOVE '1'                        TO DP132O-REPORT-NUMBER.     05040000
045800*                                                                 05050000
045900     PERFORM 7000-READ-STORE-EXTRACT-FILE.                        05060000
046000*                                                                 05070000
046100     IF  PS-STORE-EXTRACT-EOF                                     05080000
046200         CONTINUE                                                 05090000
046300     ELSE                                                         05100000
046400         MOVE SE-PO                  TO PV-CURR-KEY-PO-NBR        05110000
046500         MOVE SE-REC-SEQ-NBR         TO PV-CURR-KEY-REC-SEQ       05120000
046600         MOVE SE-POLINENO            TO PV-CURR-KEY-LINE-NBR      05130000
046700         MOVE SE-SKU-NBR             TO PV-SAVE-SKU               05140000
046800         PERFORM 2300-SET-UP-NEW-LINE                             05150000
046900         SET PS-INTIAL-READ          TO TRUE                      05160000
047000     END-IF.                                                      05170000
047100*                                                                 05180000
047200     PERFORM 7210-PRINT-HEADINGS.                                 05190000
047300*                                                                 05200000
047400 1005-SELECT-TCOCNTL.                                             05210000
047500     EXEC SQL                                                     05220000
047600         SELECT BTCH_PRC_DTE                                      05230000
047700         INTO  :COCNTL-BTCH-PRC-DTE                               05240000
047800         FROM TCOCNTL                                             05250000
047900         WHERE OPER_UNT_ID = 90                                   05260000
048000     END-EXEC.                                                    05270000
048100                                                                  05280000
048200     EVALUATE TRUE                                                05290000
048300         WHEN SQLCODE = +0                                        05300000
048400         WHEN SQLCODE = -811                                      05310000
048500              CONTINUE                                            05320000
048600         WHEN SQLWARN0 NOT = SPACE                                05330000
048700         WHEN SQLCODE  NOT = +0                                   05340000
048800              MOVE '1005-SELECT-TCOCNTL   '                       05350000
048900                                   TO PV-ABEND-PARAGRAPH          05360000
049000              MOVE 'ERROR SELECTING BTCH PRC DTE     '            05370000
049100                                   TO PV-ABEND-OPERATION          05380000
049200              MOVE 'TCOCNTL'       TO PV-ABEND-STRUCTURE-1        05390000
049300              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        05400000
049400              PERFORM 9900-SQL-ABEND                              05410000
049500     END-EVALUATE.                                                05420000
049600                                                                  05430000
049700 1005A-SELECT-TCOCNTL.                                            05440000
049800     EXEC SQL                                                     05450000
049900         SELECT DATE(BTCH_PRC_DTE - 1 DAYS)                       05460000
050000         INTO  :COCNTL-BTCH-PRC-DTE                               05470000
050100         FROM TCOCNTL                                             05480000
050200         WHERE OPER_UNT_ID = 90                                   05490000
050300     END-EXEC.                                                    05500000
050400                                                                  05510000
050500     EVALUATE TRUE                                                05520000
050600         WHEN SQLCODE = +0                                        05530000
050700         WHEN SQLCODE = -811                                      05540000
050800              CONTINUE                                            05550000
050900         WHEN SQLWARN0 NOT = SPACE                                05560000
051000         WHEN SQLCODE  NOT = +0                                   05570000
051100              MOVE '1005A-SELECT-TCOCNTL   '                      05580000
051200                                   TO PV-ABEND-PARAGRAPH          05590000
051300              MOVE 'ERROR SELECTING BTCH PRC DTE     '            05600000
051400                                   TO PV-ABEND-OPERATION          05610000
051500              MOVE 'TCOCNTL'       TO PV-ABEND-STRUCTURE-1        05620000
051600              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        05630000
051700              PERFORM 9900-SQL-ABEND                              05640000
051800     END-EVALUATE.                                                05650000
051900                                                                  05660000
052000 1006-SELECT-TDTATTR.                                             05670000
052100                                                                  05680000
052200     EXEC SQL                                                     05690000
052300          SELECT FSCL_MN_NBR                                      05700000
052400               , FSCL_WK_NBR                                      05710000
052500               , DAY_OF_WK_NBR                                    05720000
052600            INTO :DTATTR-FSCL-MN-NBR                              05730000
052700               , :DTATTR-FSCL-WK-NBR                              05740000
052800               , :DTATTR-DAY-OF-WK-NBR                            05750000
052900            FROM  TDTATTR                                         05760000
053000           WHERE KY_DTE   = :COCNTL-BTCH-PRC-DTE                  05770000
053100     END-EXEC.                                                    05780000
053200                                                                  05790000
053300     EVALUATE TRUE                                                05800000
053400         WHEN SQLCODE = +0                                        05810000
053500         WHEN SQLCODE = -811                                      05820000
053600              CONTINUE                                            05830000
053700         WHEN SQLWARN0 NOT = SPACE                                05840000
053800         WHEN SQLCODE  NOT = +0                                   05850000
053900              MOVE '1006-SELECT-TDTATTR   '                       05860000
054000                                   TO PV-ABEND-PARAGRAPH          05870000
054100              MOVE 'ERROR SELECTING FISCAL DATA      '            05880000
054200                                   TO PV-ABEND-OPERATION          05890000
054300              MOVE 'TDTATTR'       TO PV-ABEND-STRUCTURE-1        05900000
054400              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        05910000
054500              PERFORM 9900-SQL-ABEND                              05920000
054600     END-EVALUATE.                                                05930000
054700                                                                  05940000
054800*                                                                 05950000
054900 1010-OPEN-STORE-CSR.                                             05960000
055000******************************************************************05970000
055100*  OPEN THE STORE-CSR                                             05980000
055200******************************************************************05990000
055300     EXEC SQL                                                     06000000
055400          OPEN STORE-CSR                                          06010000
055500     END-EXEC.                                                    06020000
055600*                                                                 06030000
055700     IF  SQLCODE = ZERO                                           06040000
055800         CONTINUE                                                 06050000
055900     ELSE                                                         06060000
056000         SET PV-ERR-MSG-1-01         TO TRUE                      06070000
056100         MOVE '1010-OPEN-STORE-CSR'  TO PV-ABEND-PARAGRAPH        06080000
056200         PERFORM 9900-SQL-ABEND                                   06090000
056300     END-IF.                                                      06100000
056400*                                                                 06110000
056500*                                                                 06120000
056600 1020-PROCESS-STORE-CSR.                                          06130000
056700******************************************************************06140000
056800*  LOAD THE STORES INTO A TABLE                                   06150000
056900******************************************************************06160000
057000*                                                                 06170000
057100     SET PTST-INDX           TO PV-LOCATION-NBR                   06180016
057200     MOVE PV-LOCATION-NBR    TO PT-LOC-NBR (PTST-INDX).           06190016
141630     MOVE PV-LOC-TYP-CDE     TO PT-LOC-TYP-AP-CHECK (PTST-INDX).  06200022
057300*                                                                 06210000
057400     PERFORM 1025-FETCH-STORE-CSR.                                06220000
057500*                                                                 06230000
057600*                                                                 06240000
057700 1025-FETCH-STORE-CSR.                                            06250000
057800******************************************************************06260000
057900*  FETCH THE NEXT ROW OF THE RESULTS TABLE USING THE STORE-CSR    06270000
058000******************************************************************06280000
058100     EXEC SQL                                                     06290000
058200          FETCH STORE-CSR                                         06300000
058300           INTO :PV-LOCATION-NBR                                  06310000
058400              , :PV-CURRENT-CC                                    06320000
141630              , :PV-LOC-TYP-CDE                                   06330022
058500     END-EXEC.                                                    06340000
058600*                                                                 06350000
058700     IF  SQLCODE = ZERO                                           06360000
058800      OR SQLCODE = +100                                           06370000
058900         MOVE PV-CURRENT-CC TO PV-RCPT-CC                         06380000
059000                               PV-VRFD-CC                         06390000
059100     ELSE                                                         06400000
059200         SET PV-ERR-MSG-1-02         TO TRUE                      06410000
059300         MOVE '1025-FETCH-STORE-CSR' TO PV-ABEND-PARAGRAPH        06420000
059400         PERFORM 9900-SQL-ABEND                                   06430000
059500     END-IF.                                                      06440000
059600*                                                                 06450000
059700*                                                                 06460000
059800 1030-CLOSE-STORE-CSR.                                            06470000
059900******************************************************************06480000
060000*  CLOSE THE STORE-CSR                                            06490000
060100******************************************************************06500000
060200     EXEC SQL                                                     06510000
060300          CLOSE STORE-CSR                                         06520000
060400     END-EXEC.                                                    06530000
060500*                                                                 06540000
060600     IF  SQLCODE = ZERO                                           06550000
060700         CONTINUE                                                 06560000
060800     ELSE                                                         06570000
060900         SET PV-ERR-MSG-1-03         TO TRUE                      06580000
061000         MOVE '1030-CLOSE-STORE-CSR' TO PV-ABEND-PARAGRAPH        06590000
061100         PERFORM 9900-SQL-ABEND                                   06600000
061200     END-IF.                                                      06610000
061300*                                                                 06620000
061400*                                                                 06630000
061500 2000-MAIN-PROCESS.                                               06640000
061600******************************************************************06650000
061700*  THIS PARAGRAPH IS A LOOP THAT PERFORMS THE FOLLOWING FUNCTIONS 06660000
061800*  UNTIL THE END OF THE INPUT FILE IS REACHED:                    06670000
061900*    -- BUILD THE CURRENT KEY FROM THE INPUT RECORD (AN INPUT     06680000
062000*       RECORD IS READ BEFORE GETTING INTO THIS PARAGRAPH).       06690000
062100*    -- COMPARE THE CURRENT KEY AGAINST THE SAVED KEY.            06700000
062200*       THE 'KEY' IS MADE UP OF:                                  06710000
062300*          PO NUMBER                                              06720000
062400*          RECEIVER SEQUENCE NUMBER                               06730000
062500*          PO LINE NUMBER                                         06740000
062600*    -- IF THE CURRENT KEY IS THE SAME AS THE SAVED KEY, THE      06750000
062700*       FOLLOWING OCCURS:                                         06760000
062800*         -- THE RECEIPT QUANTITY IS ADDED TO THE APPROPRIATE     06770000
062900*            OCCURRENCE IN THE STORE TABLE.                       06780000
063000*         -- ANOTHER INPUT RECORD IS READ.                        06790000
063100*    -- IF THE CURRENT KEY IS DIFFERENT THAN THE SAVED KEY, THE   06800000
063200*       FOLLOWING OCCURS:                                         06810000
063300*         -- SET THE MAXIMUM INDEX TO THE INDEX (THIS IS USED AS  06820000
063400*            A STOPPING POINT WHEN PRINTING RECORDS FROM THE      06830000
063500*            STORE TABLE.  THERE'S NO REASON TO CHECK OCCURRENCES 06840000
063600*            FOR PRINTING AFTER THE LAST OCCURRENCE (STORE) THAT  06850000
063700*            HAS A RECEIPT QUANTITY IS PRINTED).                  06860000
063800*         -- LOOP THROUGH THE STORE TABLE, PRINTING AN OUTPUT     06870000
063900*            RECORD FOR EACH STORE THAT HAS A RECEIPT QUANTITY    06880000
064000*            NOT EQUAL TO ZERO.                                   06890000
064100*         -- THE COMMON INFORMATION IS SAVED FOR THE NEW KEY.     06900000
064200*            THE RECORDS ARE WRITTEN WHEN A BREAK OCCURS IN THE   06910000
064300*            KEY (PO LINE), BUT ALL THE STORES WITHIN THE SAME    06920000
064400*            PO LINE SHARE A BUNCH OF COMMON INFORMATION.         06930000
064500*         -- THE RECEIPT QUANTITY IS ADDED TO THE APPROPRIATE     06940000
064600*            OCCURRENCE IN THE STORE TABLE.                       06950000
064700*         -- ANOTHER INPUT RECORD IS READ.                        06960000
064800******************************************************************06970000
064900     ADD +1                          TO PV-RECS-IN.               06980000
065000*                                                                 06990000
065100     MOVE SE-PO                      TO PV-CURR-KEY-PO-NBR.       07000000
065200     MOVE SE-REC-SEQ-NBR             TO PV-CURR-KEY-REC-SEQ.      07010000
065300     MOVE SE-POLINENO                TO PV-CURR-KEY-LINE-NBR.     07020000
065400*                                                                 07030000
065500     IF  PV-CURR-KEY = PV-SAVE-KEY                                07040000
065600         CONTINUE                                                 07050000
065700     ELSE                                                         07060000
065800         SET PS-NOT-INTIAL-READ TO TRUE                           07070000
065900         PERFORM 8000-VALIDATE-SKU                                07080000
066000         IF  PS-SKU-INVALID                                       07090000
066100             PERFORM 7200-WRITE-ERROR-REPORT                      07100000
066200         END-IF                                                   07110000
066300         SET PTST-INDX-MAX       TO PTST-INDX                     07120000
066400         PERFORM 2200-LOOP-RECEIPTS-FOR-OUTPUT                    07130000
066500           VARYING PTST-INDX FROM 1 BY 1                          07140000
066600             UNTIL PTST-INDX > PTST-INDX-MAX                      07150000
066700         PERFORM 2300-SET-UP-NEW-LINE                             07160000
066800     END-IF.                                                      07170000
066900*                                                                 07180000
067000     PERFORM 2100-TALLY-UNITS.                                    07190000
067100     PERFORM 7000-READ-STORE-EXTRACT-FILE.                        07200000
067200*                                                                 07210000
067300*                                                                 07220000
067400 2100-TALLY-UNITS.                                                07230000
067500******************************************************************07240000
067600*  THE RECEIPT QUANTITY IS ADDED TO THE APPROPRIATE OCCURRENCE    07250000
067700*  IN THE STORE TABLE AND INTO THE FIELD ON THE OUTPUT RECORD     07260000
067800*  THAT CONTAINS THE TOTAL QUANTITY FOR THE ENTIRE PO LINE        07270000
067900*  (FS036-TOT-RCPT-QTY).                                          07280000
068000******************************************************************07290000
068100     SET PTST-INDX                   TO SE-LOC-NBR                07300000
068200     ADD SE-RETAIL-UNITS-MARK        TO PT-LOC-QTY (PTST-INDX)    07310000
068300                                        FS036-TOT-RCPT-QTY.       07320000
      * GIV JULY RELEASE CHG0115958 START                               07330009
           MOVE SE-RECEIVING-LOCATION      TO PT-LOC-TYP (PTST-INDX).   07340016
      * GIV JULY RELEASE CHG0115958 END                                 07350009
141630     MOVE SE-REC-TYP-CDE           TO PT-LOC-REC-TYP (PTST-INDX). 07360022
068400*                                                                 07370000
068500*                                                                 07380000
068600 2200-LOOP-RECEIPTS-FOR-OUTPUT.                                   07390000
068700******************************************************************07400000
068800*  LOOP THROUGH THE STORE TABLE, PRINTING AN OUTPUT RECORD FOR    07410000
068900*  EACH STORE THAT HAS A RECEIPT QUANTITY NOT EQUAL TO ZERO.      07420000
069000*  ADDITIONALLY, WHEN AN OCCURRENCE IS USED, THE STORE QUANTITY   07430000
069100*  IS RESET TO ZERO.                                              07440000
069200******************************************************************07450000
069300     IF  PT-LOC-QTY (PTST-INDX) NOT = ZERO AND > PC-QTY-MAX       07460000
069400         IF  PT-LOC-NBR (PTST-INDX) > ZERO                        07470000
069500              MOVE PT-LOC-NBR (PTST-INDX) TO FS036-LOC-NBR        07480000
069600              MOVE PT-LOC-QTY (PTST-INDX) TO PC-QTY               07490000
069700              PERFORM 2250-SPLIT-RECEIPTS UNTIL PS-SPLITS-DONE    07500000
069800              MOVE ZERO              TO PT-LOC-QTY (PTST-INDX)    07510000
069900              MOVE ZERO              TO PC-QTY                    07520000
070000              MOVE ZERO              TO PC-QTY-REMAINDER          07530000
070100              MOVE 'N'               TO PS-SPLIT-SW               07540000
070200         END-IF                                                   07550000
070300     ELSE                                                         07560000
070400         IF  PT-LOC-QTY (PTST-INDX) NOT = ZERO                    07570000
070500             IF  PT-LOC-NBR (PTST-INDX) > ZERO                    07580000
070600                  MOVE PT-LOC-NBR (PTST-INDX)                     07590000
070700                                TO FS036-LOC-NBR                  07600000
070800                  MOVE PT-LOC-QTY (PTST-INDX)                     07610000
070900                                TO FS036-LOC-RCPT-QTY             07620000
071000                  MOVE ZERO     TO PT-LOC-QTY (PTST-INDX)         07630000
071100                  PERFORM 7100-WRITE-OUTPUT                       07640000
071200             END-IF                                               07650000
071300         END-IF                                                   07660000
071400     END-IF.                                                      07670000
071500*                                                                 07680000
071600 2250-SPLIT-RECEIPTS.                                             07690000
071700     IF  PC-QTY > PC-QTY-MAX                                      07700000
071800         COMPUTE PC-QTY-REMAINDER = (PC-QTY - PC-QTY-MAX)         07710000
071900         MOVE PT-LOC-NBR (PTST-INDX)    TO FS036-LOC-NBR          07720000
072000         MOVE PC-QTY-MAX                TO FS036-LOC-RCPT-QTY     07730000
072100         PERFORM 7100-WRITE-OUTPUT                                07740000
072200         MOVE PC-QTY-REMAINDER TO PC-QTY                          07750000
072300     ELSE                                                         07760000
072400         MOVE PT-LOC-NBR (PTST-INDX) TO FS036-LOC-NBR             07770000
072500         MOVE PC-QTY-REMAINDER         TO FS036-LOC-RCPT-QTY      07780000
072600         PERFORM 7100-WRITE-OUTPUT                                07790000
072700         MOVE 'Y' TO PS-SPLIT-SW                                  07800000
072800     END-IF.                                                      07810000
072900                                                                  07820000
073000*                                                                 07830000
073100*                                                                 07840000
073200 2300-SET-UP-NEW-LINE.                                            07850000
073300******************************************************************07860000
073400*  THIS PARAGRAPH IS PERFORMED WHEN A BREAK OCCURS IN THE KEY     07870000
073500*  (THAT'D BE PO LINE).  THE FOLLOWING OCCURS:                    07880000
073600*    -- THE CURRENT KEY IS MOVED TO THE SAVED KEY.                07890000
073700*    -- THE SKU RECEIPTS SEGMENT IS INITIALIZED AND FILLED IN     07900000
073800*       WITH THE COMMON DATA FOR ALL STORES IN THE SPECIFIC PO    07910000
073900*       LINE.                                                     07920000
074000*    -- THE CURRENT KEY FIELDS ARE SAVED WITH THE NEW VALUES.     07930000
074100******************************************************************07940000
074200     MOVE PV-CURR-KEY                TO PV-SAVE-KEY.              07950000
074300     MOVE SE-POLINENO                TO PV-CURR-KEY-LINE-NBR.     07960000
074400     MOVE SE-SKU-NBR                 TO PV-SAVE-SKU.              07970000
074500     INITIALIZE FS036-RECEIPT-RECORD.                             07980000
074600     MOVE SE-PO                      TO FS036-PO-NBR              07990000
074700                                        PV-CURR-KEY-PO-NBR.       08000000
074800     MOVE SE-REC-SEQ-NBR             TO FS036-RCVR-NBR            08010000
074900                                        PV-CURR-KEY-REC-SEQ.      08020000
075000     MOVE SE-DR-MM                   TO FS036-RCPT-MN             08030000
075100     MOVE SE-DR-DD                   TO FS036-RCPT-DAY            08040000
075200     MOVE SE-DR-YY                   TO PV-RCPT-YY                08050000
075300     MOVE PV-RCPT-YEAR               TO FS036-RCPT-YR             08060000
075400                                                                  08070000
075500     MOVE PV-BATCH                   TO FS036-BTCH-NBR.           08080000
075600     MOVE 'MPKUT023'                 TO FS036-RCPT-SRC-PGM-NM.    08090000
075700     MOVE SE-DV-YY                   TO PV-VRFD-YY.               08100000
075800     MOVE PV-VFRD-YEAR               TO FS036-VRFD-YR.            08110000
075900     MOVE SE-DV-MM                   TO FS036-VRFD-MN.            08120000
076000     MOVE SE-DV-DD                   TO FS036-VRFD-DAY.           08130000
076100     MOVE SE-ENROUTE-IND             TO FS036-ENRTE-IND.          08140000
076200*                                                                 08150000
076300*                                                                 08160000
076400 7000-READ-STORE-EXTRACT-FILE.                                    08170000
076500******************************************************************08180000
076600*  READ THE INPUT FILE STORE-EXTRACT-FILE                         08190000
076700******************************************************************08200000
076800     READ STORE-EXTRACT-FILE INTO STORE-EXTRACT-LINE              08210000
076900       AT END                                                     08220000
077000          SET PS-STORE-EXTRACT-EOF       TO TRUE                  08230000
077100          MOVE PV-TOTAL-UNIT-QTY         TO RC077-TOTAL-UNIT-QTY  08240000
077200          MOVE PV-TOTAL-RETAIL-QTY       TO RC077-TOTAL-RETAIL-QTY08250000
077300                                                                  08260000
077400          IF CC-PRE-RUN                                           08270000
077500             MOVE 'PRE-RUN         '     TO PV-JOB-RUN            08280000
077600          ELSE                                                    08290000
077700             IF CC-ORIG-NIGHTLY-RUN                               08300000
077800                MOVE 'ORIG-NIGHTLY-RUN'  TO PV-JOB-RUN            08310000
077900             END-IF                                               08320000
078000          END-IF                                                  08330000
078100                                                                  08340000
078200          MOVE COCNTL-BTCH-PRC-DTE       TO RC077-CREATE-DATE     08350000
078300          MOVE DTATTR-FSCL-MN-NBR        TO RC077-FISCAL-MONTH    08360000
078400          MOVE DTATTR-FSCL-WK-NBR        TO RC077-FISCAL-WEEK     08370000
078500          MOVE DTATTR-DAY-OF-WK-NBR      TO RC077-DAY-OF-WEEK     08380000
078600          MOVE PV-RECORD-COUNT           TO RC077-RECORD-COUNT    08390000
078700          PERFORM 7150-WRITE-OUTPUT2                              08400000
078800                                                                  08410000
078900       NOT AT END                                                 08420000
079000          ADD +1 TO PV-RECORD-COUNT                               08430000
079100          ADD SE-RETAIL-UNITS-RECVD TO PV-TOTAL-UNIT-QTY          08440000
079200          ADD SE-RETAIL-EXTENSION   TO PV-TOTAL-RETAIL-QTY        08450000
079300     END-READ.                                                    08460000
079400                                                                  08470000
079500*                                                                 08480000
079600 7100-WRITE-OUTPUT.                                               08490000
                                                                        08500002
      * GIV JULY RELEASE CHG0115958 START                               08510009
      ******************************************************************08520002
      *  WRITE THE OUTPUT FILE DTS-RECEIPTS-OUTPUT-FILE                 08530002
      ******************************************************************08540002
070900                                                                  08550019
141630     IF (PT-LOC-TYP(PTST-INDX)      = 'DS')                       08560022
141630         PERFORM 7300-DTS-WRITE-OUTPUT                            08570022
141630     ELSE                                                         08580022
141630         IF (PT-LOC-REC-TYP (PTST-INDX) = 'AP'  AND               08590022
141630             PT-LOC-TYP-AP-CHECK (PTST-INDX) NOT = 'CS')          08600022
141630             ADD +1                  TO PV-AP-RECS-OUT            08610022
141630             PERFORM 7300-DTS-WRITE-OUTPUT                        08620022
141630     END-IF.                                                      08630022
079600* GIV JULY RELEASE CHG0115958 END                                 08640010
                                                                        08650002
079700******************************************************************08660000
079800*  WRITE THE OUTPUT FILE RECEIPTS-OUTPUT-FILE                     08670000
079900******************************************************************08680000
080000     WRITE RECEIPTS-OUTPUT-RECORD                                 08690000
080100         FROM FS036-RECEIPT-RECORD.                               08700000
080200*                                                                 08710000
080300     ADD +1                          TO PV-RECS-OUT.              08720000
080400*                                                                 08730000
080500*                                                                 08740000
080600 7150-WRITE-OUTPUT2.                                              08750000
080700******************************************************************08760000
080800*  WRITE THE OUTPUT FILE STR-EXT-BALANCE-FILE                     08770000
080900******************************************************************08780000
081000     WRITE STR-EXT-BAL-OUTPUT-RECORD                              08790000
081100         FROM RC077-RECORD.                                       08800000
081200*                                                                 08810000
081300     ADD +1                          TO PV-BAL-RECS-OUT.          08820000
081400*                                                                 08830000
081500*                                                                 08840000
081600 7200-WRITE-ERROR-REPORT.                                         08850000
081700******************************************************************08860000
081800*  FORMAT AND WRITE THE ERROR REPORT                              08870000
081900******************************************************************08880000
082000     IF  PV-LINE-COUNT > 60                                       08890000
082100         PERFORM 7210-PRINT-HEADINGS                              08900000
082200     END-IF.                                                      08910000
082300*                                                                 08920000
082400     MOVE FS036-BTCH-NBR             TO DL-BATCH                  08930000
082500     MOVE FS036-RCPT-MN              TO DL-PO-DATE-MM             08940000
082600     MOVE FS036-RCPT-DAY             TO DL-PO-DATE-DD             08950000
082700     MOVE FS036-RCPT-YR              TO DL-PO-DATE-YY             08960000
082800     MOVE PV-CURR-KEY-PO-NBR         TO DL-PO-NUMBER              08970000
082900     MOVE PV-CURR-KEY-REC-SEQ        TO DL-PO-REC-SEQ.            08980000
083000*                                                                 08990000
083100     MOVE SE-SKU-NBR                 TO DL-ORIG-SKU               09000000
083200*                                                                 09010000
083300     MOVE 9999999                    TO DL-TOTAL-PRICE            09020000
083400     MOVE FS036-TOT-RCPT-QTY         TO DL-TOTAL-QTY              09030000
083500*                                                                 09040000
083600     IF PS-SKU-INVALID                                            09050000
083700         SET DL-SKU-NOT-FOUND        TO TRUE                      09060000
083800     END-IF                                                       09070000
083900*                                                                 09080000
084000     WRITE ERROR-REPORT-RECORD                                    09090000
084100       FROM DETAIL-LINE                                           09100000
084200         AFTER ADVANCING 2 LINES.                                 09110000
084300*                                                                 09120000
084400     ADD 2                           TO PV-LINE-COUNT.            09130000
084500*                                                                 09140000
084600     SET PS-SKU-VALID                TO TRUE.                     09150000
084700*                                                                 09160000
084800*                                                                 09170000
084900 7210-PRINT-HEADINGS.                                             09180000
085000******************************************************************09190000
085100*  PRINT THE ERROR REPORT HEADINGS                                09200000
085200******************************************************************09210000
085300     ADD 1                       TO PV-PAGE-COUNT.                09220000
085400     MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           09230000
085500*                                                                 09240000
085600     WRITE ERROR-REPORT-RECORD                                    09250000
085700       FROM DP132O-STANDRD-HEADER-132-COLS                        09260000
085800         AFTER ADVANCING PAGE.                                    09270000
085900*                                                                 09280000
086000     WRITE ERROR-REPORT-RECORD                                    09290000
086100       FROM HEADING-LINE-1                                        09300000
086200         AFTER ADVANCING 1 LINE.                                  09310000
086300*                                                                 09320000
086400     WRITE ERROR-REPORT-RECORD                                    09330000
086500       FROM HEADING-LINE-2                                        09340000
086600         AFTER ADVANCING 2 LINES.                                 09350000
086700*                                                                 09360000
086800     MOVE 4                      TO PV-LINE-COUNT.                09370000
086900*                                                                 09380000
      * GIV JULY RELEASE CHG0115958 START                               09390009
       7300-DTS-WRITE-OUTPUT.                                           09400001
                                                                        09410002
      ******************************************************************09420001
      *  WRITE THE OUTPUT FILE DTS-RECEIPTS-OUTPUT-FILE                 09430001
      ******************************************************************09440001
           WRITE DTS-RECEIPTS-OUTPUT-RECORD                             09450001
             FROM FS036-RECEIPT-RECORD.                                 09460001
      *                                                                 09470001
           ADD +1                      TO PV-DTS-RECS-OUT.              09480002
      *                                                                 09490001
      * GIV JULY RELEASE CHG0115958 END                                 09500009
087000*                                                                 09510002
087100 8000-VALIDATE-SKU.                                               09520000
087200*                                                                 09530000
087300                                                                  09540000
087400     MOVE '8000-VALIDATE-SKU '   TO PV-ABEND-PARAGRAPH            09550000
087500                                                                  09560000
087600                                                                  09570000
087700     INITIALIZE XL001-ITEM-COMMAREA                               09580000
087800     SET XL001-BY-NUMERIC-SKU                                     09590000
087900         XL001-SELECT-SKU             TO TRUE                     09600000
088000                                                                  09610000
088100     MOVE PV-SAVE-SKU                 TO XL001-KEY-SKU            09620000
088200                                         PV-DISPLAY-SKU.          09630000
088300*    DISPLAY 'SKU NUMBER'   PV-DISPLAY-SKU                        09640000
088400     CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                09650000
088500                                                                  09660000
088600     EVALUATE TRUE                                                09670000
088700         WHEN XL001-SUCCESSFUL                                    09680000
088800              SET PS-SKU-VALID    TO TRUE                         09690000
088900              MOVE XL001-ITM-NBR  TO FS036-ITM-NBR                09700000
089000                                     PV-DISPLAY-ITM               09710000
089100*             DISPLAY 'ITEM NUMBER'   PV-DISPLAY-ITM              09720000
089200         WHEN XL001-SKU-NOT-FOUND                                 09730000
089300              MOVE SPACES   TO       PV-DISPLAY-ITM               09740000
089400*             DISPLAY 'ITEM NUMBER'   PV-DISPLAY-ITM              09750000
089500              SET PS-SKU-INVALID  TO TRUE                         09760000
089600         WHEN XL001-SQL-ERROR                                     09770000
089700         WHEN XL001-INVALID-ACCESS                                09780000
089800              SET PV-ERR-MSG-1-04         TO TRUE                 09790000
089900              STRING   ' MPKUT023-8000-'                          09800000
090000                      ' '                                         09810000
090100                      'SKU NUMBER'                                09820000
090200                      PV-DISPLAY-SKU                              09830000
090300                      DELIMITED BY SIZE                           09840000
090400                                      INTO PV-ERR-MSG-2           09850000
090500              MOVE XL001-SQLCA        TO SQLCA                    09860000
090600              PERFORM 9900-SQL-ABEND                              09870000
090700         WHEN OTHER                                               09880000
090800              SET PV-ERR-MSG-1-04         TO TRUE                 09890000
090900              STRING   ' MPKUT023-8000-'                          09900000
091000                      ' '                                         09910000
091100                      'SKU NUMBER'                                09920000
091200                      PV-DISPLAY-SKU                              09930000
091300                      DELIMITED BY SIZE                           09940000
091400                                      INTO PV-ERR-MSG-2           09950000
091500              MOVE XL001-SQLCA        TO SQLCA                    09960000
091600              PERFORM 9900-SQL-ABEND                              09970000
091700     END-EVALUATE.                                                09980000
091800                                                                  09990000
091900 9000-END-PROCESS.                                                10000000
092000******************************************************************10010000
092100*  THIS PARAGRAPH PERFORMS THE FOLLOWING AT THE END OF THE        10020000
092200*  PROGRAM:                                                       10030000
092300*    -- SET THE MAXIMUM INDEX TO THE INDEX (THIS IS USED AS A     10040000
092400*       STOPPING POINT WHEN PRINTING RECORDS FROM THE STORE       10050000
092500*       TABLE.  THERE'S NO REASON TO CHECK OCCURRENCES FOR        10060000
092600*       PRINTING AFTER THE LAST OCCURRENCE (STORE) THAT HAS A     10070000
092700*       RECEIPT QUANTITY IS PRINTED).                             10080000
092800*    -- LOOP THROUGH THE STORE TABLE, PRINTING AN OUTPUT RECORD   10090000
092900*       FOR EACH STORE THAT HAS A RECEIPT QUANTITY NOT EQUAL TO   10100000
093000*       ZERO.                                                     10110000
093100*    -- DISPLAY READ/WRITE TOTALS.                                10120000
093200*    -- CLOSE THE FILES.                                          10130000
093300******************************************************************10140000
093400     SET PTST-INDX-MAX               TO PTST-INDX.                10150000
093500*                                                                 10160000
093600      PERFORM 8000-VALIDATE-SKU                                   10170000
093700      IF  PS-SKU-INVALID                                          10180000
093800          PERFORM 7200-WRITE-ERROR-REPORT                         10190000
093900     END-IF                                                       10200000
094000     PERFORM 2200-LOOP-RECEIPTS-FOR-OUTPUT                        10210000
094100       VARYING PTST-INDX FROM 1 BY 1                              10220000
094200         UNTIL PTST-INDX > PTST-INDX-MAX.                         10230000
094300*                                                                 10240000
094400     PERFORM 9100-DISPLAY-TOTALS.                                 10250000
094500*                                                                 10260000
094600     WRITE ERROR-REPORT-RECORD                                    10270000
094700       FROM PC-END-REPORT-LINE                                    10280000
094800         AFTER ADVANCING 1 LINE.                                  10290000
094900*                                                                 10300000
095000     CLOSE STORE-EXTRACT-FILE                                     10310000
095100           RECEIPTS-OUTPUT-FILE                                   10320000
095200           STR-EXT-BALANCE-FILE                                   10330000
      * GIV JULY RELEASE CHG0115958 START                               10340009
                 DTS-RECEIPTS-OUTPUT-FILE                               10350001
      * GIV JULY RELEASE CHG0115958 END                                 10360009
095300           ERROR-REPORT-FILE.                                     10370000
095400*                                                                 10380000
095500*                                                                 10390000
095600 9100-DISPLAY-TOTALS.                                             10400000
095700******************************************************************10410000
095800*  THIS PARAGRAPH FORMATS AND DISPLAYS THE RECORD COUNTS TO       10420000
095900*  APPEAR IN THE SYSLOG.                                          10430000
096000******************************************************************10440000
096100     MOVE PV-RECS-IN                 TO PV-RECS-IN-ED.            10450000
096200     MOVE PV-RECS-OUT                TO PV-RECS-OUT-ED.           10460000
141630     MOVE PV-AP-RECS-OUT             TO PV-AP-RECS-OUT-ED.        10470022
      * GIV JULY RELEASE CHG0115958 START                               10480009
           MOVE PV-DTS-RECS-OUT            TO PV-DTS-RECS-OUT-ED.       10490001
096300     DISPLAY 'MPKUT023'.                                          10500001
096400     DISPLAY ' '.                                                 10510000
096500     DISPLAY 'RECORDS READ        = ' PV-RECS-IN-ED.              10520002
096600     DISPLAY 'RECORDS WRITTEN     = ' PV-RECS-OUT-ED.             10530002
           DISPLAY 'DTS RECORDS WRITTEN = ' PV-DTS-RECS-OUT-ED.         10540002
141630     DISPLAY 'AP  RECORDS WRITTEN = ' PV-AP-RECS-OUT-ED.          10550022
141630     DISPLAY 'AP RECORDS ARE INCLUDED IN DTS (TOTAL GIV) COUNT'.  10560022
096700     DISPLAY 'JOB RUN             = ' PV-JOB-RUN.                 10570002
      * GIV JULY RELEASE CHG0115958 END                                 10580009
096800*                                                                 10590000
096900*                                                                 10600000
097000 9800-SQL-WARNING.                                                10610000
097100******************************************************************10620000
097200*     SQL WARNING OR ERROR PROCESSING                             10630000
097300******************************************************************10640000
097400     MOVE SQLERRD(3)                 TO SQLERRD3.                 10650000
097500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 10660000
097600     DISPLAY '** PROGRAM        ** = MPKUT023'.                   10670000
097700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  10680000
097800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  10690000
097900     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  10700000
098000     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  10710000
098100     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  10720000
098200     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  10730000
098300     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  10740000
098400     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  10750000
098500     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  10760000
098600     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  10770000
098700                                                                  10780000
098800     EXEC SQL                                                     10790000
098900          COMMIT                                                  10800000
099000     END-EXEC.                                                    10810000
099100                                                                  10820000
099200     MOVE 4013                       TO PV-ABEND-CODE.            10830000
099300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         10840000
099400*                                                                 10850000
099500*                                                                 10860000
099600 9900-SQL-ABEND.                                                  10870000
099700******************************************************************10880000
099800*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    10890000
099900*  ERROR OR WARNING CODE OCCURS.                                  10900000
100000******************************************************************10910000
100100     DISPLAY '***************************'.                       10920000
100200     DISPLAY '**       ABEND           **'.                       10930000
100300     DISPLAY '**  IN PROGRAM MPKUT023  **'.                       10940000
100400     DISPLAY '***************************'.                       10950000
100500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             10960000
100600     DISPLAY '** ERROR     ** = ' PV-ERR-MSG-1.                   10970000
100700     DISPLAY '** MORE      ** = ' PV-ERR-MSG-2.                   10980000
100800*                                                                 10990000
100900******************************************************************11000000
101000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    11010000
101100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         11020000
101200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     11030000
101300* FORMAT.                                                         11040000
101400******************************************************************11050000
101500     COPY DPPD004.                                                11060000
101600*                                                                 11070000
101700     MOVE +4013                      TO PV-ABEND-CODE.            11080000
101800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11090000
101900*                                                                 11100000
102000*                                                                 11110000
102100 9999-ABEND-PROGRAM.                                              11120000
102200******************************************************************11130000
102300*  PERFORMS THE ABEND FOR THE PROGRAM WHEN NO DB2 IS INVLOVED.    11140000
102400******************************************************************11150000
102500     DISPLAY '***************************'.                       11160000
102600     DISPLAY '**       ABEND           **'.                       11170000
102700     DISPLAY '**  IN PROGRAM MPKUT023  **'.                       11180000
102800     DISPLAY '***************************'.                       11190000
102900     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             11200000
103000     DISPLAY '** ERROR     ** = ' PV-ERR-MSG-1.                   11210000
103100     DISPLAY '** MORE      ** = ' PV-ERR-MSG-2.                   11220000
103200                                                                  11230000
103300     MOVE +4014                      TO PV-ABEND-CODE.            11240000
103400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11250000
