000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.      ICKUP161.                                       00020099
000300 AUTHOR.          MARGARET MORRISON.                              00030099
000400 DATE-WRITTEN.    MARCH 2008.                                     00040099
000500                                                                  00050099
000600*--------------------------------------------------------------*  00060099
000700*                                                              *  00070099
000800* DESCRIPTION:                                                 *  00080099
000900*      THIS PROGRAM WILL APPLY SALES & RETURN INFORMATION TO   *  00090099
001000*      APPROVED COMPLETED COUNTS FOR USA INVENTORY COUNTS.     *  00100099
001800*                                                              *  00110099
001900* INPUTS:                                                      *  00120099
002000*      YES                                                     *  00130099
002300*                                                              *  00140099
002400* OUTPUTS:                                                     *  00150099
002500*      YES                                                     *  00160099
002600*                                                              *  00170099
002700*--------------------------------------------------------------*  00180099
002800*--------------------------------------------------------------*  00190099
002900* HISTORY LOG:                                                    00200099
003000*--------------------------------------------------------------*  00210099
003100* DATE:        03/2008                                            00220099
003200* WR/IR#:      WR30388(USA INVENTORY COUNTS)                      00230099
003300* PROGRAMMER:  MARGARET MORRISON                                  00240099
003400* DESCRIPTION: INITIAL PROGRAM WRITE.                             00250099
003700*--------------------------------------------------------------*  00260099
004680* DATE:        05/2010                                            00270099
004690* WR/IR#:                                                         00280099
004700* PROGRAMMER:  COGNIZANT                                          00290099
004710* DESCRIPTION: ADDED 2200-SELECT-SKU PARA AND 2250-SELECT-        00300099
004710*              -SKU-FOR-REV PARA TO PULL THE CORRECT              00310099
004710*              ON-HANDS QUANTITY WHICH THE SYSTEM HAS INSERTED.   00320099
003700*--------------------------------------------------------------*  00330099
CL3132* DATE:        07/2010                                            00340099
CL3132* WR/IR#:                                                         00350099
CL3132* PROGRAMMER:  COGNIZANT                                          00360099
CL3132* DESCRIPTION: CHANGED PROGRAM TO TAKE SCANNED QUANTITY FROM      00370099
CL3132*              ROW WITH USER ID <> SYSTEM AND ONHAND QUANTITY     00380099
CL3132*              FROM ROW WITH USER ID = SYSTEM.                    00390099
004800*--------------------------------------------------------------*  00400099
      * 03/28/2012 CHANGED BY:  DEANNA BRANTNER   PR#3403               00410099
      *            DESCRIPTION: COMPILE ONLY CHANGES TO TTFITEM DATABASE00420099
      *                         FOR LARGE RETAIL PROJECT.               00430099
      *--------------------------------------------------------------*  00440099
C88463* 05/13/2014 CHANGED BY:  JIM HUNTER        CHG0088463            00450099
C88463* DESCRIPTION: CHANGED FOR RFID PROJECT.  CHECK FOR DUPLICATE     00460099
C88463*              COUNTS (SAME STORE, SKU, COUNT DATE).  IF FOUND    00470099
C88463*              DO NOT SEND THEM TO FASHION.  DO NOT SEND NULL     00480099
C88463*              RFID COUNTS TO FASHION - THEY WERE NOT COUNTED.    00490099
C88463*              NULL USA COUNTS MEAN THAT ZERO WERE COUNTED.       00500099
111890*--------------------------------------------------------------*  00510099
111890* 05/21/2015 CHANGED BY:  JIM HUNTER        CHG0111890            00520099
111890* DESCRIPTION: CHANGED FOR RFID PROJECT.  PASSING CNT-TYP-CDE     00530099
111890*              FROM INPUT FILE TO THE ICTW_OPUT_REC TABLE.        00540099
111890*              IT WILL BE USED IN LATER PROGRAMS TO               00550099
111890*              DISTINGUISH RFID COUNTS FROM USA COUNTS ON THE     00560099
111890*              FASHION REPORTS.                                   00570099
111890*--------------------------------------------------------------*  00580099
C32847* 03/03/2016 CHANGED BY:  COGNIZANT         CHG0132847            00581099
C32847* DESCRIPTION: CHANGED 2200-SELECT-SKU CURSOR TO FETCH THE        00582099
C32847*              EXECUTION TIMESTAMP FROM LAST_UPD_USR_ID NOT       00583099
C32847*              EQUAL TO SYSTEM AND HANDLED THE NULL TIMESTAMP     00584099
C32847*              SCENARIO AS WELL. CHANGED THE FORMULA TO CALCULATE 00585099
C32847*              PV-ADJ-QTY.                                        00586099
C32847*--------------------------------------------------------------*  00587099
004900 ENVIRONMENT DIVISION.                                            00588099
005000*--------------------------------------------------------------*  00589099
005100 CONFIGURATION SECTION.                                           00590099
005200 SOURCE-COMPUTER.        IBM-3090.                                00600099
005300 OBJECT-COMPUTER.        IBM-3090.                                00610099
005400                                                                  00620099
005500 INPUT-OUTPUT SECTION.                                            00630099
005600                                                                  00640099
005700 FILE-CONTROL.                                                    00650099
005800                                                                  00660099
005900     SELECT ICRD060-COUNTS-FILE                                   00670099
006000         ASSIGN TO INP01.                                         00680099
006100                                                                  00690099
006200******************************************************************00700099
006300 DATA DIVISION.                                                   00710099
006400******************************************************************00720099
006500                                                                  00730099
006600 FILE SECTION.                                                    00740099
006700                                                                  00750099
006800 FD  ICRD060-COUNTS-FILE                                          00760099
006900     RECORDING MODE IS F                                          00770099
007000     LABEL RECORDS ARE STANDARD                                   00780099
007100     BLOCK CONTAINS 0 RECORDS.                                    00790099
007200                                                                  00800099
007300 01  ICRD060-COUNTS-RECORD           PIC X(70).                   00810099
007400                                                                  00820099
009200 WORKING-STORAGE SECTION.                                         00830099
009300*--------------------------------------------------------------*  00840099
009400* PS - PROGRAM SWITCHES                                           00850099
009500*--------------------------------------------------------------*  00860099
009600 01  PS-PROGRAM-SWITCHES.                                         00870099
011200     05  PS-END-OF-FILE-SW           PIC  X(001).                 00880099
011300         88  PS-END-OF-FILE                       VALUE 'Y'.      00890099
011400         88  PS-END-OF-FILE-NO                    VALUE 'N'.      00900099
011500                                                                  00910099
011501     05  PS-SKU-CNTS-CSR-SW          PIC  X(001).                 00920099
011502         88  MORE-SKU-CNTS                        VALUE 'Y'.      00930099
011503         88  NO-MORE-SKU-CNTS                     VALUE 'N'.      00940099
011504                                                                  00950099
011505     05  PS-REVIEW-CHECK-SW          PIC  X(001).                 00960099
011506         88  PS-REVIEW-CHECK                      VALUE 'Y'.      00970099
011507         88  PS-REVIEW-CHECK-NO                   VALUE 'N'.      00980099
011508                                                                  00990099
011509     05  PS-NEW-CNT-LOC-SW           PIC  X(001).                 01000099
011510         88  PS-NEW-CNT-LOC                       VALUE 'Y'.      01010099
011511         88  PS-NEW-CNT-LOC-NO                    VALUE 'N'.      01020099
011512                                                                  01030099
011513     05  PS-AUTO-APPROVAL-SW         PIC  X(001).                 01040099
011514         88  PS-AUTO-APPROVAL-YES                 VALUE 'Y'.      01050099
011515         88  PS-AUTO-APPROVAL-NO                  VALUE 'N'.      01060099
011516                                                                  01070099
011517     05  PS-CNT-STAT-CDE-SW          PIC  X(001).                 01080099
011518         88  VALID-CNT-STAT-CDE                   VALUE 'Y'.      01090099
011519         88  INVALID-CNT-STAT-CDE                 VALUE 'N'.      01100099
011520                                                                  01110099
011521     05  PS-FIRST-COMMIT-SW          PIC  X(001)  VALUE 'Y'.      01120099
011522         88  PS-FIRST-COMMIT                      VALUE 'Y'.      01130099
011523         88  PS-FIRST-COMMIT-NO                   VALUE 'N'.      01140099
011524                                                                  01150099
011525     05  PS-COMMITS-TAKEN-SW         PIC  X(01)   VALUE 'N'.      01160099
011526         88  COMMITS-TAKEN                        VALUE 'T'.      01170099
011527         88  NO-COMMITS-TAKEN                     VALUE 'N'.      01180099
011524                                                                  01190099
C88463     05  PS-DUPLICATE-COUNT-SW       PIC  X(01)   VALUE 'N'.      01200099
C88463         88  DUPLICATE-COUNT                      VALUE 'Y'.      01210099
C88463         88  NO-DUPLICATE-COUNT                   VALUE 'N'.      01220099
C88463                                                                  01230099
C88463     05  PS-NULL-ICC-COUNT-SW        PIC  X(01)   VALUE 'N'.      01240099
C88463         88  NULL-ICC-COUNT                       VALUE 'Y'.      01250099
C88463         88  NOT-NULL-ICC-COUNT                   VALUE 'N'.      01260099
011600*--------------------------------------------------------------*  01270099
011700* PROGRAM CONSTANTS                                               01280099
011800*--------------------------------------------------------------*  01290099
011900 01  PC-PROGRAM-CONSTANTS.                                        01300099
012000     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'ICKUP161'.     01310099
012010     05  PC-JOB-NAME              PIC X(08) VALUE 'ICK082'.       01320099
012100     05  PC-MAX-RETRIES           PIC 9(9)  VALUE 5.              01330099
012300     05  PC-COMMIT-MAX            PIC 9(9)  VALUE 9999.           01340099
012310     05  PC-7                     PIC 9(9)  VALUE 7.              01350099
012320     05  PC-COM                   PIC X(03) VALUE 'COM'.          01360099
012330     05  PC-AUT                   PIC X(03) VALUE 'AUT'.          01370099
012331     05  PC-APP                   PIC X(03) VALUE 'APP'.          01380099
012332     05  PC-REV                   PIC X(03) VALUE 'REV'.          01390099
012333     05  PC-PRC                   PIC X(03) VALUE 'PRC'.          01400099
012340     05  PC-A                     PIC X(01) VALUE 'A'.            01410099
012350     05  PC-SYSTEM                PIC X(06) VALUE 'SYSTEM'.       01420099
012360     05  PC-TER                   PIC X(03) VALUE 'TER'.          01430099
012370     05  PC-REG                   PIC X(03) VALUE 'REG'.          01440099
012380     05  PC-DIS                   PIC X(03) VALUE 'DIS'.          01450099
012390     05  PC-STR                   PIC X(03) VALUE 'STR'.          01460099
012400     05  PC-DEP                   PIC X(03) VALUE 'DEP'.          01470099
012500     05  PC-NULL-VALUE            PIC S9(04) VALUE -1             01480099
012600                                             COMP SYNC.           01490099
012700     05  PC-IN-PROCESS-CODE       PIC X(01) VALUE '9'.            01500099
012800     05  PC-RUN-COMPLETE-CODE     PIC X(01) VALUE '0'.            01510099
012900                                                                  01520099
012901*--------------------------------------------------------------*  01530099
012902* PV- PROGRAM VARIABLES                                           01540099
012903*--------------------------------------------------------------*  01550099
012904 01  PV-PROGRAM-VARAIBLES.                                        01560099
012905     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       01570099
013000     05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       01580099
013100                                                                  01590099
013200     05  PV-SQL-SUB               PIC S9(09)  VALUE 0  COMP.      01600099
013300     05  PV-RETRY                 PIC 9999    VALUE 0  COMP.      01610099
013400     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      01620099
C88463     05  PV-ADJ-QTY               PIC S9(09)  VALUE +0 COMP.      01630099
C88463     05  PV-ADJ-QTY-DISPLAY       PIC ---------9.                 01640099
013500     05  PV-CALC-DB2-DATE         PIC  X(10)  VALUE SPACES.       01650099
013600     05  PV-CALC-NBR-DAYS         PIC  9(05)  VALUE 0.            01660099
013700     05  PV-SUM-ONHAND            PIC S9(09)  VALUE +0 COMP.      01670099
013800     05  PV-SUM-SCANNED           PIC S9(09)  VALUE +0 COMP.      01680099
013900     05  PV-SUM-SLD-QTY           PIC S9(09)  VALUE +0 COMP.      01690099
014000     05  PV-SUM-RET-QTY           PIC S9(09)  VALUE +0 COMP.      01700099
014100     05  PV-XFER-IN-QTY           PIC S9(09)  VALUE +0 COMP.      01710099
014200     05  PV-XFER-OUT-QTY          PIC S9(09)  VALUE +0 COMP.      01720099
014300     05  PV-THRESHOLD             PIC S9(3)V9(2) VALUE +0 COMP-3. 01730099
014400     05  PV-THRESHOLD1            PIC S9(3)V9(2) VALUE +0 COMP-3. 01740099
014500     05  PV-RETRY-COUNTER         PIC S9(04)     VALUE +0         01750099
014501                                                 COMP SYNC.       01760099
014502                                                                  01770099
014503     05  PV-CURRENT-TMST          PIC X(26)   VALUE SPACES.       01780099
014504     05  PV-CURRENT-DATE          PIC X(10)   VALUE SPACES.       01790099
014505     05  PV-EXEC-TMST             PIC X(26)   VALUE SPACES.       01800099
014506     05  PV-MAX-SKU-LAST-UPD-TMST PIC X(26)   VALUE SPACES.       01810099
015000                                                                  01820099
015100     05  PV-TIMEZONE-TMST         PIC X(26)   VALUE SPACES.       01830099
015200                                                                  01840099
015300     05  PV-COM-CNT-TMST.                                         01850099
015400         10  PV-COM-CNT-DTE       PIC X(10)   VALUE SPACES.       01860099
015500         10  FILLER               PIC X(01)   VALUE SPACES.       01870099
015600         10  PV-COM-CNT-TM        PIC X(08)   VALUE SPACES.       01880099
015700         10  FILLER               PIC X(01)   VALUE SPACES.       01890099
015800         10  PV-COM-CNT-MSEC      PIC X(06)   VALUE SPACES.       01900099
015900                                                                  01910099
016000     05  PV-COM-CNT-TMST-HOLD     PIC X(26)   VALUE SPACES.       01920099
016100     05  PV-COMPARE-TMST-HOLD     PIC X(26)   VALUE SPACES.       01930099
016200                                                                  01940099
016300     05  PV-COMPARE-TMST.                                         01950099
016400         10  PV-COMPARE-DTE       PIC X(10)   VALUE SPACES.       01960099
016500         10  FILLER               PIC X(01)   VALUE SPACES.       01970099
016600         10  PV-COMPARE-TM        PIC X(08)   VALUE '00.00.00'.   01980099
016700         10  FILLER               PIC X(01)   VALUE SPACES.       01990099
016800         10  PV-COMPARE-MSEC      PIC X(06)   VALUE '000000'.     02000099
016900                                                                  02010099
017000     05  PV-HOLD-CNT-STUP-ID      PIC S9(09)  VALUE +0 COMP.      02020099
017100     05  PV-HOLD-LOC-NBR          PIC S9(04)  VALUE +0 COMP.      02030099
017200     05  PV-HOLD-CNT-STAT-CDE     PIC X(03)   VALUE SPACES.       02040099
017300                                                                  02050099
017400                                                                  02060099
017500     05  PV-TMST                  PIC X(26)   VALUE SPACES.       02070099
017600     05  PV-HOLD-TMST             PIC X(26)   VALUE SPACES.       02080099
017700                                                                  02090099
017800                                                                  02100099
017900 01  PV-NULL-VARIABLES.                                           02110099
018000     05  PV-INTRNST-QTY-NULL-IND    PIC S9(04) VALUE +0           02120099
018100                                               COMP SYNC.         02130099
018200     05  PV-ACPTD-TRUK-QTY-NULL-IND PIC S9(04) VALUE +0           02140099
018300                                               COMP SYNC.         02150099
018400     05  PV-RTL-SAL-QTY-NULL-IND    PIC S9(04) VALUE +0           02160099
018500                                               COMP SYNC.         02170099
018600     05  PV-RTL-RET-QTY-NULL-IND    PIC S9(04) VALUE +0           02180099
018700                                               COMP SYNC.         02190099
018800     05  PV-XFER-IN-QTY-NULL-IND    PIC S9(04) VALUE +0           02200099
018900                                               COMP SYNC.         02210099
019000     05  PV-XFER-OUT-QTY-NULL-IND   PIC S9(04) VALUE +0           02220099
019100                                               COMP SYNC.         02230099
019200     05  PV-SCND-UPC-NBR-NULL-IND   PIC S9(04) VALUE +0           02240099
019300                                               COMP SYNC.         02250099
019400     05  PV-SCND-UNT-QTY-NULL-IND   PIC S9(04) VALUE +0           02260099
019500                                               COMP SYNC.         02270099
019600     05  PV-CNT-GP-CDE-NULL-IND     PIC S9(04) VALUE +0           02280099
019700                                               COMP SYNC.         02290099
019800     05  PV-EXEC-TMST-NULL-IND      PIC S9(04) VALUE +0           02300099
019900                                               COMP SYNC.         02310099
020000     05  PV-EXEC-TMST-NULL-IND2     PIC S9(04) VALUE +0           02320099
020100                                               COMP SYNC.         02330099
020200     05  PV-MDSE-EXPRN-DTE-NULL-IND PIC S9(04) VALUE +0           02340099
020300                                               COMP SYNC.         02350099
020400     05  PV-SUM-SLD-QTY-NULL-IND    PIC S9(04) VALUE +0           02360099
020500                                               COMP SYNC.         02370099
020600     05  PV-SUM-RET-QTY-NULL-IND    PIC S9(04) VALUE +0           02380099
020700                                               COMP SYNC.         02390099
020800     05  PV-SUM-XFER-IN-NULL-IND    PIC S9(04) VALUE +0           02400099
020900                                               COMP SYNC.         02410099
021000     05  PV-SUM-XFER-OUT-NULL-IND   PIC S9(04) VALUE +0           02420099
021100                                               COMP SYNC.         02430099
021200 01  PV-CKPT-RESTART-VARIABLES.                                   02440099
021300*MAM 05  PV-COMMIT-INTERVAL       PIC S9(09)  VALUE +1000         02450099
021400*MAM                                          COMP-3.             02460099
021500     05  PV-COMMIT-INTERVAL       PIC S9(09)  VALUE +1            02470099
021600                                              COMP-3.             02480099
021700     05  PV-CKPT-STAT-CODE        PIC X(01)   VALUE SPACES.       02490099
021800     05  PV-TOTAL-COMMITS         PIC 9(09)   VALUE ZERO.         02500099
021900**   05  PV-COMMIT-CNTR           PIC S9(04)  VALUE +1            02510099
022000**                                            COMP-3.             02520099
022100                                                                  02530099
022200 01  CKPT-RESTART-INFO.                                           02540099
022300     05  CR-INPUT-FILE-SW            PIC X(01)     VALUE 'I'.     02550099
022400         88  INPUT-COUNTS-FILE                     VALUE 'I'.     02560099
022500     05  CR-COUNTS-RECS-WORKED       PIC 9(09)     VALUE ZERO.    02570099
022600                                                                  02580099
022700     05  CR-TOTAL-COMMITS            PIC 9(13)     VALUE ZERO.    02590099
022800                                                                  02600099
022900     05  CR-INSERT-CNT-STAT          PIC 9(09)     VALUE 0.       02610099
023000     05  CR-INSERT-CNT-SKU           PIC 9(09)     VALUE 0.       02620099
023100     05  CR-SELECT-SKU-CNT           PIC 9(09)     VALUE 0.       02630099
023200     05  CR-FS-REC-CNT               PIC 9(09)     VALUE 0.       02640099
023300                                                                  02650099
023400     05  CR-PV-INPUT-CNT             PIC 9(09)     VALUE 0.       02660099
023401                                                                  02670099
023402*--------------------------------------------------------------*  02680099
023403* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02690099
023404*--------------------------------------------------------------*  02700099
023405     COPY DPWS004.                                                02710099
023406                                                                  02720099
023407*--------------------------------------------------------------*  02730099
023408* DATE ROUTINE COPY MEMBERS                                       02740099
023409*--------------------------------------------------------------*  02750099
023410     COPY DPWS500.                                                02760099
023411                                                                  02770099
023412*--------------------------------------------------------------*  02780099
023413* DB2 ABEND COPYBOOK                                              02790099
023414*--------------------------------------------------------------*  02800099
023415     COPY DPWS900.                                                02810099
023416                                                                  02820099
023417*--------------------------------------------------------------*  02830099
023418* DB2 MESSAGE AREA                                                02840099
023419*--------------------------------------------------------------*  02850099
023420     COPY SQLCA2.                                                 02860099
023421                                                                  02870099
023422*--------------------------------------------------------------*  02880099
023423* PROGRAM COUNTERS                                                02890099
023424*--------------------------------------------------------------*  02900099
023425 01  PV-PROGRAM-COUNTERS         COMP-3.                          02910099
023426     05  PV-NUMBER-OF-RETRIES     PIC 9(9) VALUE 0.               02920099
023427     05  PV-INPUT-CNT             PIC 9(9) VALUE 0.               02930099
023428     05  PV-SELECT-SKU-CNT        PIC 9(9) VALUE 0.               02940099
023429     05  PV-INSERT-CNT-STAT       PIC 9(9) VALUE 0.               02950099
023430     05  PV-INSERT-CNT-SKU        PIC 9(9) VALUE 0.               02960099
023440     05  PV-CNT-SINCE-COMMIT      PIC 9(9) VALUE 0.               02970099
023441     05  PV-FS-REC-CNT            PIC 9(9) VALUE 0.               02980099
023442                                                                  02990099
023443*--------------------------------------------------------------*  03000099
023444* ERROR HANDLING                                                  03010099
023445*--------------------------------------------------------------*  03020099
023446 01  PV-MISC-ABEND-FIELDS.                                        03030099
023447     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          03040099
023448     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          03050099
023449     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          03060099
023450                                                                  03070099
023451 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    03080099
023452     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           03090099
023453     88  ABEND-4013-DB2-ERROR              VALUE +4013.           03100099
023454     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           03110099
023455     88  ABEND-4020-MQ-ERROR               VALUE +4020.           03120099
023456     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           03130099
023457     88  ABEND-4008                        VALUE +4008.           03140099
023458     88  ABEND-4005                        VALUE +4005.           03150099
023459                                                                  03160099
023460************************************************************      03170099
023470*    TIMEZONE CONVERSION ROUTINE COPYBOOK                         03180099
023480************************************************************      03190099
023490     COPY ICWS010.                                                03200099
023500                                                                  03210099
023600************************************************************      03220099
023700*    USA INVENTORY COUNTS APPROVED COMPLETED COUNTS               03230099
023800*    FILE LAYOUT.                                                 03240099
023900************************************************************      03250099
024000     COPY ICRD060.                                                03260099
024100                                                                  03270099
024200************************************************************      03280099
024300*    USA INVENTORY COUNTS UPDATED APPROVED COMPLETED COUNTS       03290099
024400*    FILE LAYOUT.                                                 03300099
024500************************************************************      03310099
024600     COPY ICRD061.                                                03320099
024601                                                                  03330099
024602*--------------------------------------------------------------*  03340099
024603* DB2 COMMUNICATIONS AREA                                         03350099
024604*--------------------------------------------------------------*  03360099
024605     EXEC SQL                                                     03370099
024606       INCLUDE SQLCA                                              03380099
024607     END-EXEC.                                                    03390099
024608                                                                  03400099
024609***************************************************************** 03410099
024610*  XST_LOC TABLE                                                  03420099
024620***************************************************************** 03430099
024630     EXEC SQL                                                     03440099
024640          INCLUDE XST00001                                        03450099
024650     END-EXEC.                                                    03460099
024660                                                                  03470099
024670***************************************************************** 03480099
024680*  XST_SKU                                                        03490099
024690***************************************************************** 03500099
024700     EXEC SQL                                                     03510099
024800          INCLUDE XST00010                                        03520099
024900     END-EXEC.                                                    03530099
025000                                                                  03540099
025010***************************************************************** 03550099
025020*  XST_UPC                                                        03560099
025030***************************************************************** 03570099
025040     EXEC SQL                                                     03580099
025050          INCLUDE XST00012                                        03590099
025060     END-EXEC.                                                    03600099
025070                                                                  03610099
025100***************************************************************** 03620099
025200*  XST_VND_STYL                                                   03630099
025300***************************************************************** 03640099
025400     EXEC SQL                                                     03650099
025500          INCLUDE XST00013                                        03660099
025600     END-EXEC.                                                    03670099
025601                                                                  03680099
025602*--------------------------------------------------------------*  03690099
025603* DB2 TABLE ICT00020 (ICT_LOC_CNT_STAT)                           03700099
025604*           IC - LOCATION COUNT STATUS TABLE                   *  03710099
025605*--------------------------------------------------------------*  03720099
025606     EXEC SQL                                                     03730099
025607       INCLUDE ICT00020                                           03740099
025608     END-EXEC.                                                    03750099
025609                                                                  03760099
025610*--------------------------------------------------------------*  03770099
025611* DB2 TABLE ICT00010 (ICT_CNT_STUP)                               03780099
025612*           IC - COUNT SETUP TABLE                                03790099
025613*--------------------------------------------------------------*  03800099
025614     EXEC SQL                                                     03810099
025615       INCLUDE ICT00010                                           03820099
025616     END-EXEC.                                                    03830099
025617                                                                  03840099
025618*--------------------------------------------------------------*  03850099
025619* DB2 TABLE ICT00011 (ICT_SKU_LOC_CNT)                            03860099
025620*           IC - SKU LOCATION COUNT TABLE                         03870099
025621*--------------------------------------------------------------*  03880099
025622     EXEC SQL                                                     03890099
025623       INCLUDE ICT00011                                           03900099
025624     END-EXEC.                                                    03910099
025625                                                                  03920099
025626*--------------------------------------------------------------*  03930099
025627* DB2 TABLE TTFSTAT -- TF TRANSFER STATUS TABLE                   03940099
025628*--------------------------------------------------------------*  03950099
025629     EXEC SQL                                                     03960099
025630       INCLUDE TTFSTAT                                            03970099
025640     END-EXEC.                                                    03980099
025650                                                                  03990099
025651*--------------------------------------------------------------*  04000099
025652* DB2 TABLE TTFITEM -- TF TRANSFER ITEM TABLE                     04010099
025653*--------------------------------------------------------------*  04020099
025654     EXEC SQL                                                     04030099
025655       INCLUDE TTFITEM                                            04040099
025656     END-EXEC.                                                    04050099
025657                                                                  04060099
025658*--------------------------------------------------------------*  04070099
025659* DB2 TABLE TTFMSTR -- TF TRANSFER MASTER TABLE                   04080099
025660*--------------------------------------------------------------*  04090099
025661     EXEC SQL                                                     04100099
025662       INCLUDE TTFMSTR                                            04110099
025663     END-EXEC.                                                    04120099
025664                                                                  04130099
025665*--------------------------------------------------------------*  04140099
025670* DB2 TABLE TEPPART -- COSA PARTIONING TABLE                      04150099
025680*--------------------------------------------------------------*  04160099
025690     EXEC SQL                                                     04170099
025700       INCLUDE TEPPART                                            04180099
025800     END-EXEC.                                                    04190099
025900                                                                  04200099
026000*--------------------------------------------------------------*  04210099
026100* DB2 TABLE TEPTRN -- COSA TRANSACTION TABLE                      04220099
026200*--------------------------------------------------------------*  04230099
026300     EXEC SQL                                                     04240099
026400       INCLUDE TEPTRN                                             04250099
026500     END-EXEC.                                                    04260099
026600                                                                  04270099
026700*--------------------------------------------------------------*  04280099
026800* DB2 TABLE TEPITM -- COSA ITEM TABLE                             04290099
026900*--------------------------------------------------------------*  04300099
027000     EXEC SQL                                                     04310099
027100       INCLUDE TEPITM                                             04320099
027200     END-EXEC.                                                    04330099
027300                                                                  04340099
027400******************************************************************04350099
027500*  DB2 TABLE DECLARATION - IC UPDATED APPROVED COUNTS EXTRACT     04360099
027600*                          WORK TABLE  (ICTW_OPUT_REC).           04370099
027700******************************************************************04380099
027800     EXEC SQL                                                     04390099
027900          INCLUDE ICT00023                                        04400099
028000     END-EXEC.                                                    04410099
028100                                                                  04420099
028200******************************************************************04430099
028300*  DB2 TABLE DECLARATION - CHECKPOINT RESTART CONTROL (TCKRSTCNTL)04440099
028400*  THIS TABLE IS BEING USED IN THIS PROGRAM TO CONTROL COMMIT     04450099
028500*  INTERVALS.                                                     04460099
028600******************************************************************04470099
028700     EXEC SQL                                                     04480099
028800         INCLUDE TCKRSTCN                                         04490099
028900     END-EXEC.                                                    04500099
029000                                                                  04510099
029100******************************************************************04520099
029200*  DB2 TABLE DECLARATION - CHECKPOINT RESTART         (TCKRSTINF) 04530099
029300*  THIS TABLE IS BEING USED IN THIS PROGRAM TO CONTROL COMMIT     04540099
029400*  INTERVALS.                                                     04550099
029500******************************************************************04560099
029600     EXEC SQL                                                     04570099
029700         INCLUDE TCKRSTIN                                         04580099
029800     END-EXEC.                                                    04590099
029900                                                                  04600099
030000                                                                  04610099
039400 LINKAGE SECTION.                                                 04620099
039500                                                                  04630099
039600*--------------------------------------------------------------*  04640099
039700 PROCEDURE DIVISION.                                              04650099
039800*--------------------------------------------------------------*  04660099
039900 0000-MAINLINE.                                                   04670099
040000                                                                  04680099
040100     PERFORM 1000-INITIALIZATION.                                 04690099
040500                                                                  04700099
040600     PERFORM 2000-PROCESS-COUNTS                                  04710099
040700       UNTIL PS-END-OF-FILE.                                      04720099
040701                                                                  04730099
040702*MAM PERFORM 9000-COMMIT.                                         04740099
040800                                                                  04750099
041100     PERFORM 9999-WRAPUP.                                         04760099
041200                                                                  04770099
041300     GOBACK.                                                      04780099
041400                                                                  04790099
041500*0000-EXIT.                                                       04800099
041600                                                                  04810099
041700*--------------------------------------------------------------*  04820099
041800* 1000-INITIALIZATION.                                            04830099
041900*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04840099
042000*     FILES, READS CONTROL CARDS, AND PROCESSES ANY INPUT FILE    04850099
042100*     PARAMETERS IT MAY NEED.                                     04860099
042200*--------------------------------------------------------------*  04870099
042300 1000-INITIALIZATION.                                             04880099
042400     DISPLAY ' '.                                                 04890099
042500     DISPLAY '*********************************************'.     04900099
042600     DISPLAY '   START OF PROGRAM NAME: ' PC-PROGRAM-NAME.        04910099
042700     DISPLAY '*********************************************'.     04920099
042800     DISPLAY ' '.                                                 04930099
043100                                                                  04940099
043200     OPEN INPUT  ICRD060-COUNTS-FILE.                             04950099
043300                                                                  04960099
043400     PERFORM 6000-GET-CHECKPOINT-CNTL.                            04970099
043500     MOVE TCKRSTCNTL-CKPT-STAT-CODE TO PV-CKPT-STAT-CODE.         04980099
043600     MOVE TCKRSTCNTL-CKPT-FRQNCY-QTY TO PV-COMMIT-INTERVAL.       04990099
043700                                                                  05000099
043800     IF TCKRSTCNTL-CKPT-STAT-CODE = '9'                           05010099
043900         PERFORM 6110-CHECKPOINT-RESTART                          05020099
044000     ELSE                                                         05030099
044100         PERFORM 1010-CONTINUE-INITIALIZE                         05040099
044200     END-IF.                                                      05050099
044300                                                                  05060099
044400*MAM PERFORM 6020-SET-COMMIT-TIME.                                05070099
044500                                                                  05080099
044600******************************************************************05090099
044700* CONTINUE THE INITIALIZATION PROCESS.                           *05100099
044800******************************************************************05110099
044900 1010-CONTINUE-INITIALIZE.                                        05120099
045000                                                                  05130099
045100     INITIALIZE PV-HOLD-CNT-STUP-ID                               05140099
045200                PV-HOLD-LOC-NBR                                   05150099
045300                PV-HOLD-CNT-STAT-CDE                              05160099
045400                PV-SUM-SLD-QTY                                    05170099
045500                PV-SUM-RET-QTY                                    05180099
045600                PV-XFER-IN-QTY                                    05190099
045700                PV-XFER-OUT-QTY.                                  05200099
045800                                                                  05210099
045900     INITIALIZE ICT00023-UPD-CNT-ODR.                             05220099
046000                                                                  05230099
090800     SET MORE-SKU-CNTS TO TRUE.                                   05240099
090900     SET PS-END-OF-FILE-NO TO TRUE.                               05250099
091000     SET PS-NEW-CNT-LOC-NO TO TRUE.                               05260099
091001                                                                  05270099
091002     EXEC SQL                                                     05280099
091003         SET :PV-CURRENT-DATE = CURRENT DATE                      05290099
091004     END-EXEC.                                                    05300099
091005                                                                  05310099
091006     EXEC SQL                                                     05320099
091007         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 05330099
091008     END-EXEC.                                                    05340099
091009                                                                  05350099
091010                                                                  05360099
091011     PERFORM 9000-TIMEZONE-CONVERSION-SETUP.                      05370099
091012                                                                  05380099
091013     PERFORM 2110-INITIAL-READ.                                   05390099
091014                                                                  05400099
091015                                                                  05410099
091016*1000-EXIT.                                                       05420099
091017                                                                  05430099
091018*--------------------------------------------------------------*  05440099
091019* 2000-PROCESS-COUNTS.                                         *  05450099
091020*  PROCESS COMPLETED COUNTS                                    *  05460099
091021*--------------------------------------------------------------*  05470099
091022 2000-PROCESS-COUNTS.                                             05480099
091023                                                                  05490099
091024     SET MORE-SKU-CNTS    TO TRUE.                                05500099
091025                                                                  05510099
091026     PERFORM 2800-PROCESS-SKU-CNTS                                05520099
091027         UNTIL PS-NEW-CNT-LOC OR                                  05530099
091028               PS-END-OF-FILE                                     05540099
091029                                                                  05550099
091030     IF PS-NEW-CNT-LOC                                            05560099
091040         MOVE PV-INPUT-CNT TO CR-COUNTS-RECS-WORKED               05570099
091050                              CR-PV-INPUT-CNT                     05580099
091060         SUBTRACT 1 FROM CR-COUNTS-RECS-WORKED                    05590099
091070         PERFORM 9000-COMMIT                                      05600099
091080         PERFORM 4500-DETERMINE-TIMEZONE                          05610099
091090         PERFORM 5100-INSERT-PROCESSED-REC                        05620099
091100         SET PS-NEW-CNT-LOC-NO TO TRUE                            05630099
091200     END-IF.                                                      05640099
091201                                                                  05650099
091202*--------------------------------------------------------------*  05660099
091203* 2100-READ-INPUT-FILE.                                        *  05670099
091204*  READ THE INPUT FILE                                         *  05680099
091205*--------------------------------------------------------------*  05690099
091206 2100-READ-INPUT-FILE.                                            05700099
091207                                                                  05710099
091208     READ ICRD060-COUNTS-FILE                                     05720099
091209         INTO ICRD060-APRVD-COUNTS-RECORD                         05730099
091210         AT END                                                   05740099
091220           SET PS-END-OF-FILE TO TRUE.                            05750099
091230                                                                  05760099
091240     IF PS-END-OF-FILE                                            05770099
091250        DISPLAY '* NO MORE COUNTS TO PROCESS *'                   05780099
091260     ELSE                                                         05790099
091270         ADD +1 TO PV-INPUT-CNT                                   05800099
205700                                                                  05810099
091280         IF (ICRD060-CNT-STUP-ID NOT EQUAL PV-HOLD-CNT-STUP-ID)   05820099
091290             OR (ICRD060-LOC-NBR NOT EQUAL PV-HOLD-LOC-NBR)       05830099
091300             MOVE ICRD060-CNT-STUP-ID  TO PV-HOLD-CNT-STUP-ID     05840099
091400             MOVE ICRD060-LOC-NBR      TO PV-HOLD-LOC-NBR         05850099
091500             MOVE ICRD060-CNT-STAT-CDE TO PV-HOLD-CNT-STAT-CDE    05860099
091600             SET PS-NEW-CNT-LOC TO TRUE                           05870099
091700         ELSE                                                     05880099
091800             SET PS-NEW-CNT-LOC-NO TO TRUE                        05890099
091900         END-IF                                                   05900099
092000     END-IF.                                                      05910099
092001                                                                  05920099
092002*--------------------------------------------------------------*  05930099
092003* 2110-INITIAL-READ.                                           *  05940099
092004*  READ THE INPUT FILE                                         *  05950099
092005*--------------------------------------------------------------*  05960099
092006 2110-INITIAL-READ.                                               05970099
092007                                                                  05980099
092008     READ ICRD060-COUNTS-FILE                                     05990099
092009         INTO ICRD060-APRVD-COUNTS-RECORD                         06000099
092010         AT END                                                   06010099
092020           SET PS-END-OF-FILE TO TRUE.                            06020099
092030                                                                  06030099
092040     IF PS-END-OF-FILE                                            06040099
092050        DISPLAY '* NO MORE COUNTS TO PROCESS *'                   06050099
092060     ELSE                                                         06060099
092070        ADD +1 TO PV-INPUT-CNT                                    06070099
092080        MOVE ICRD060-CNT-STUP-ID  TO PV-HOLD-CNT-STUP-ID          06080099
092090        MOVE ICRD060-LOC-NBR      TO PV-HOLD-LOC-NBR              06090099
092100        MOVE ICRD060-CNT-STAT-CDE TO PV-HOLD-CNT-STAT-CDE         06100099
092200        PERFORM 4500-DETERMINE-TIMEZONE                           06110099
092300        PERFORM 5100-INSERT-PROCESSED-REC                         06120099
092400        SET PS-NEW-CNT-LOC-NO TO TRUE                             06130099
092500     END-IF.                                                      06140099
092501                                                                  06150099
092502*--------------------------------------------------------------*  06160099
092503* 2200-SELECT-SKU.                                             *  06170099
092504*  SELECT SKU                                                  *  06180099
092505*--------------------------------------------------------------*  06190099
092506 2200-SELECT-SKU.                                                 06200099
092507                                                                  06210099
092508     PERFORM                                                      06220099
092509        WITH TEST AFTER                                           06230099
092510        VARYING PV-RETRY  FROM 1 BY 1                             06240099
092520          UNTIL (PV-RETRY > PC-MAX-RETRIES                        06250099
092530             OR (SQLCODE = +100 OR +0))                           06260099
092540                                                                  06270099
092550     EXEC SQL                                                     06280099
092560             SELECT C.LOC_NBR                                     06290099
092570                   ,C.SKU_NBR                                     06300099
092580                   ,C.CNT_STUP_ID                                 06310099
092590                   ,C.LAST_UPD_TMST                               06320099
092600                   ,C.CNT_SEQ_NBR                                 06330099
092700                   ,C.LAST_UPD_USR_ID                             06340099
092800                   ,C.LAST_ACTN_CDE                               06350099
092900                   ,C.UNT_RTL_AMT                                 06360099
093000                   ,C.LOC_EXPTED_UNT_QTY                          06370099
093100                   ,C.IN_TRNST_UNT_QTY                            06380099
093200                   ,C.ACPTD_TRUK_UNT_QTY                          06390099
093300                   ,C.RTL_SAL_UNT_QTY                             06400099
093400                   ,C.RTL_RET_UNT_QTY                             06410099
093500                   ,C.XFER_IN_UNT_QTY                             06420099
093600                   ,C.XFER_OUT_UNT_QTY                            06430099
CL3132                   ,T.SCND_UPC_NBR                                06440099
CL3132                   ,T.SCND_UNT_QTY                                06450099
093900                   ,C.CNT_GP_CDE                                  06460099
094000                   ,C.EXEC_TMST                                   06470099
094100                   ,C.MDSE_EXPRN_DTE                              06480099
C32847                   ,T.EXEC_TMST                                   06490099
094300               INTO :ICT00011-LOC-NBR                             06500099
094400                   ,:ICT00011-SKU-NBR                             06510099
094500                   ,:ICT00011-CNT-STUP-ID                         06520099
094600                   ,:PV-MAX-SKU-LAST-UPD-TMST                     06530099
094700                   ,:ICT00011-CNT-SEQ-NBR                         06540099
094800                   ,:ICT00011-LAST-UPD-USR-ID                     06550099
094900                   ,:ICT00011-LAST-ACTN-CDE                       06560099
095000                   ,:ICT00011-UNT-RTL-AMT                         06570099
095100                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  06580099
095200          ,:ICT00011-IN-TRNST-UNT-QTY  :PV-INTRNST-QTY-NULL-IND   06590099
095300       ,:ICT00011-ACPTD-TRUK-UNT-QTY  :PV-ACPTD-TRUK-QTY-NULL-IND 06600099
095400          ,:ICT00011-RTL-SAL-UNT-QTY  :PV-RTL-SAL-QTY-NULL-IND    06610099
095500          ,:ICT00011-RTL-RET-UNT-QTY  :PV-RTL-RET-QTY-NULL-IND    06620099
095600          ,:ICT00011-XFER-IN-UNT-QTY  :PV-XFER-IN-QTY-NULL-IND    06630099
095700          ,:ICT00011-XFER-OUT-UNT-QTY :PV-XFER-OUT-QTY-NULL-IND   06640099
095800          ,:ICT00011-SCND-UPC-NBR  :PV-SCND-UPC-NBR-NULL-IND      06650099
095900          ,:ICT00011-SCND-UNT-QTY  :PV-SCND-UNT-QTY-NULL-IND      06660099
096000          ,:ICT00011-CNT-GP-CDE  :PV-CNT-GP-CDE-NULL-IND          06670099
096100          ,:ICT00011-EXEC-TMST  :PV-EXEC-TMST-NULL-IND            06680099
096200          ,:ICT00011-MDSE-EXPRN-DTE  :PV-MDSE-EXPRN-DTE-NULL-IND  06690099
096300          ,:PV-EXEC-TMST  :PV-EXEC-TMST-NULL-IND2                 06700099
096400               FROM ICT_SKU_LOC_CNT  C                            06710099
CL3132               LEFT OUTER JOIN                                    06720099
CL3132              ( SELECT D.LOC_NBR                                  06730099
CL3132                      ,D.SKU_NBR                                  06740099
CL3132                      ,D.CNT_STUP_ID                              06750099
CL3132                      ,D.CNT_SEQ_NBR                              06760099
CL3132                      ,D.SCND_UNT_QTY                             06770099
CL3132                      ,D.SCND_UPC_NBR                             06780099
C32847                      ,D.EXEC_TMST                                06790099
CL3132                  FROM ICT_SKU_LOC_CNT D                          06800099
CL3132                 WHERE D.LOC_NBR = :ICRD060-LOC-NBR               06810099
CL3132                   AND D.CNT_STUP_ID = :ICRD060-CNT-STUP-ID       06820099
CL3132                   AND D.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR       06830099
CL3132                   AND D.SKU_NBR =  :ICRD060-SKU-NBR              06840099
CL3132                   AND D.LAST_UPD_USR_ID <> 'SYSTEM'              06850099
CL3132                   AND D.LAST_UPD_TMST =                          06860099
CL3132                 (SELECT MAX(T2.LAST_UPD_TMST)                    06870099
CL3132                   FROM ICT_SKU_LOC_CNT   T2                      06880099
CL3132                  WHERE T2.CNT_STUP_ID = D.CNT_STUP_ID            06890099
CL3132                    AND T2.LOC_NBR = D.LOC_NBR                    06900099
CL3132                    AND T2.SKU_NBR = D.SKU_NBR                    06910099
CL3132                    AND T2.CNT_SEQ_NBR = D.CNT_SEQ_NBR            06920099
CL3132                    AND T2.LAST_UPD_USR_ID <> 'SYSTEM')           06930099
CL3132              ) T                                                 06940099
CL3132                  ON C.CNT_STUP_ID = T.CNT_STUP_ID AND            06950099
CL3132                     C.CNT_SEQ_NBR = T.CNT_SEQ_NBR AND            06960099
CL3132                     C.LOC_NBR     = T.LOC_NBR     AND            06970099
CL3132                     C.SKU_NBR     = T.SKU_NBR                    06980099
096500                   ,ICT_LOC_CNT_STAT A                            06990099
096600                                                                  07000099
096700               WHERE C.LOC_NBR = :ICRD060-LOC-NBR                 07010099
096800                 AND C.CNT_STUP_ID = :ICRD060-CNT-STUP-ID         07020099
096900                 AND C.SKU_NBR = :ICRD060-SKU-NBR                 07030099
097000                 AND C.LOC_NBR = A.LOC_NBR                        07040099
097100                 AND C.CNT_STUP_ID = A.CNT_STUP_ID                07050099
097200                 AND C.CNT_SEQ_NBR = A.CNT_SEQ_NBR                07060099
097300                 AND C.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR         07070099
097400                 AND A.CNT_STAT_CDE = :ICRD060-CNT-STAT-CDE       07080099
CL3132                 AND C.LAST_UPD_USR_ID = 'SYSTEM'                 07090099
097500                                                                  07100099
097600                 AND C.LAST_UPD_TMST  =                           07110099
097700                     (SELECT MAX(G.LAST_UPD_TMST)                 07120099
097800                        FROM ICT_SKU_LOC_CNT   G                  07130099
097900                       WHERE G.CNT_STUP_ID = C.CNT_STUP_ID        07140099
098000                         AND G.SKU_NBR = C.SKU_NBR                07150099
098100                         AND G.CNT_SEQ_NBR = C.CNT_SEQ_NBR        07160099
CL3132                         AND G.LAST_UPD_USR_ID = 'SYSTEM'         07170099
098200                         AND G.LOC_NBR = C.LOC_NBR)               07180099
098300                                                                  07190099
098400                 AND A.LAST_UPD_TMST  =                           07200099
098500                     (SELECT MAX(H.LAST_UPD_TMST)                 07210099
098600                        FROM ICT_LOC_CNT_STAT  H                  07220099
098700                       WHERE H.CNT_STUP_ID = A.CNT_STUP_ID        07230099
098800                         AND H.LOC_NBR = A.LOC_NBR                07240099
098900                         AND H.CNT_STAT_CDE = A.CNT_STAT_CDE      07250099
099000                         AND H.CNT_SEQ_NBR = A.CNT_SEQ_NBR)       07260099
099100                                                                  07270099
099200           ORDER BY C.LOC_NBR                                     07280099
099300                   ,C.SKU_NBR                                     07290099
099400                   ,C.CNT_STUP_ID                                 07300099
099500                                                                  07310099
099600     END-EXEC                                                     07320099
099700                                                                  07330099
099800       MOVE SQLCODE TO PV-SQL-SUB                                 07340099
099900     EVALUATE TRUE                                                07350099
100000         WHEN SQLCODE = ZERO                                      07360099
C32847         IF  PV-EXEC-TMST-NULL-IND2 = PC-NULL-VALUE               07370099
C32847             MOVE ICT00011-EXEC-TMST TO                           07371099
C32847                  PV-EXEC-TMST                                    07372099
C32847         END-IF                                                   07373099
100100             ADD +1 TO PV-SELECT-SKU-CNT                          07374099
100200             MOVE PV-EXEC-TMST(1:10)                              07375099
100300               TO PV-COM-CNT-DTE                                  07376099
100400             MOVE PV-EXEC-TMST(12:8)                              07377099
100500               TO PV-COM-CNT-TM                                   07378099
100600             MOVE PV-EXEC-TMST(21:6)                              07379099
100700               TO PV-COM-CNT-MSEC                                 07380099
100800             MOVE PV-EXEC-TMST                                    07390099
100900               TO PV-COMPARE-TMST,                                07400099
101000                  PV-COMPARE-TMST-HOLD,                           07410099
101100                  PV-COM-CNT-TMST-HOLD                            07420099
205700                                                                  07430099
101200         WHEN SQLCODE = -904                                      07440099
101300         WHEN SQLCODE = -911                                      07450099
101400         WHEN SQLCODE = -913                                      07460099
101500             CONTINUE                                             07470099
101600         WHEN SQLCODE = +100                                      07480099
101700             SET NO-MORE-SKU-CNTS TO TRUE                         07490099
101800         WHEN OTHER                                               07500099
101900              DISPLAY '*2200 BLOWING UP ON BAD SQL-'              07510099
102000                 '* SELECT KEY-',                                 07520099
102100                  ICRD060-SKU-NBR,                                07530099
102200                  ICRD060-LOC-NBR,                                07540099
102300                  ICRD060-CNT-STUP-ID,                            07550099
102400                 ' SQL CODE -', PV-SQL-SUB, '**'                  07560099
102500              MOVE '2200-SELECT-SKU'                              07570099
102600                  TO PV-PARAGRAPH-NAME                            07580099
102700             MOVE 'ERROR ON SELECT OF SKU NUMBER  '               07590099
102800                  TO PV-DB2-OPERATION                             07600099
102900             PERFORM 9900-SQL-ABEND                               07610099
103000         END-EVALUATE                                             07620099
103100     END-PERFORM.                                                 07630099
103200                                                                  07640099
103300     IF PV-RETRY GREATER PC-MAX-RETRIES                           07650099
103400       DISPLAY '*2200 BLOWING UP ON RETRIES ON SELECT-'           07660099
103500        PV-RETRY '**'                                             07670099
103600               '* SELECT KEY-',                                   07680099
103700                  ICRD060-SKU-NBR,                                07690099
103800                  ICRD060-LOC-NBR,                                07700099
103900                  ICRD060-CNT-STUP-ID,                            07710099
104000               ' SQL CODE -', PV-SQL-SUB, '**'                    07720099
104100        MOVE '2200-SELECT-SKU         '                           07730099
104200                 TO PV-PARAGRAPH-NAME                             07740099
104300        MOVE 'ERROR ON SELECT OF SKU NUMBER '                     07750099
104400                 TO PV-DB2-OPERATION                              07760099
104500        PERFORM 9900-SQL-ABEND                                    07770099
104600     END-IF.                                                      07780099
104601                                                                  07790099
104602*--------------------------------------------------------------*  07800099
104603* 2250-SELECT-SKU-FOR-REV.                                     *  07810099
104604*  SELECT SKU FOR REVERSALS                                    *  07820099
104605*--------------------------------------------------------------*  07830099
104606 2250-SELECT-SKU-FOR-REV.                                         07840099
104607                                                                  07850099
104608     PERFORM                                                      07860099
104609        WITH TEST AFTER                                           07870099
104610        VARYING PV-RETRY  FROM 1 BY 1                             07880099
104620          UNTIL (PV-RETRY > PC-MAX-RETRIES                        07890099
104630             OR (SQLCODE = +100 OR +0))                           07900099
104640                                                                  07910099
104650     EXEC SQL                                                     07920099
104660             SELECT C.LOC_NBR                                     07930099
104670                   ,C.SKU_NBR                                     07940099
104680                   ,C.CNT_STUP_ID                                 07950099
104690                   ,C.CNT_SEQ_NBR                                 07960099
104700                   ,C.LAST_UPD_USR_ID                             07970099
104800                   ,C.LAST_ACTN_CDE                               07980099
104900                   ,C.UNT_RTL_AMT                                 07990099
105000                   ,C.LOC_EXPTED_UNT_QTY                          08000099
105100                   ,C.IN_TRNST_UNT_QTY                            08010099
105200                   ,C.ACPTD_TRUK_UNT_QTY                          08020099
105300                   ,C.RTL_SAL_UNT_QTY                             08030099
105400                   ,C.RTL_RET_UNT_QTY                             08040099
105500                   ,C.XFER_IN_UNT_QTY                             08050099
105600                   ,C.XFER_OUT_UNT_QTY                            08060099
CL3132                   ,T.SCND_UPC_NBR                                08070099
CL3132                   ,T.SCND_UNT_QTY                                08080099
105900                   ,C.CNT_GP_CDE                                  08090099
106000                   ,C.EXEC_TMST                                   08100099
106100                   ,C.MDSE_EXPRN_DTE                              08110099
106200               INTO :ICT00011-LOC-NBR                             08120099
106300                   ,:ICT00011-SKU-NBR                             08130099
106400                   ,:ICT00011-CNT-STUP-ID                         08140099
106500                   ,:ICT00011-CNT-SEQ-NBR                         08150099
106600                   ,:ICT00011-LAST-UPD-USR-ID                     08160099
106700                   ,:ICT00011-LAST-ACTN-CDE                       08170099
106800                   ,:ICT00011-UNT-RTL-AMT                         08180099
106900                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  08190099
107000          ,:ICT00011-IN-TRNST-UNT-QTY  :PV-INTRNST-QTY-NULL-IND   08200099
107100       ,:ICT00011-ACPTD-TRUK-UNT-QTY  :PV-ACPTD-TRUK-QTY-NULL-IND 08210099
107200          ,:ICT00011-RTL-SAL-UNT-QTY  :PV-RTL-SAL-QTY-NULL-IND    08220099
107300          ,:ICT00011-RTL-RET-UNT-QTY  :PV-RTL-RET-QTY-NULL-IND    08230099
107400          ,:ICT00011-XFER-IN-UNT-QTY  :PV-XFER-IN-QTY-NULL-IND    08240099
107500          ,:ICT00011-XFER-OUT-UNT-QTY :PV-XFER-OUT-QTY-NULL-IND   08250099
107600          ,:ICT00011-SCND-UPC-NBR  :PV-SCND-UPC-NBR-NULL-IND      08260099
107700          ,:ICT00011-SCND-UNT-QTY  :PV-SCND-UNT-QTY-NULL-IND      08270099
107800          ,:ICT00011-CNT-GP-CDE  :PV-CNT-GP-CDE-NULL-IND          08280099
107900          ,:ICT00011-EXEC-TMST  :PV-EXEC-TMST-NULL-IND            08290099
108000          ,:ICT00011-MDSE-EXPRN-DTE  :PV-MDSE-EXPRN-DTE-NULL-IND  08300099
108100               FROM ICT_SKU_LOC_CNT  C                            08310099
CL3132               LEFT OUTER JOIN                                    08320099
CL3132              ( SELECT D.LOC_NBR                                  08330099
CL3132                      ,D.SKU_NBR                                  08340099
CL3132                      ,D.CNT_STUP_ID                              08350099
CL3132                      ,D.CNT_SEQ_NBR                              08360099
CL3132                      ,D.SCND_UNT_QTY                             08370099
CL3132                      ,D.SCND_UPC_NBR                             08380099
CL3132                  FROM ICT_SKU_LOC_CNT D                          08390099
CL3132                 WHERE D.LOC_NBR = :ICRD060-LOC-NBR               08400099
CL3132                   AND D.CNT_STUP_ID = :ICRD060-CNT-STUP-ID       08410099
CL3132                   AND D.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR       08420099
CL3132                   AND D.SKU_NBR =  :ICRD060-SKU-NBR              08430099
CL3132                   AND D.LAST_UPD_USR_ID <> 'SYSTEM'              08440099
CL3132                   AND D.LAST_UPD_TMST =                          08450099
CL3132                (SELECT MAX(T2.LAST_UPD_TMST)                     08460099
CL3132                   FROM ICT_SKU_LOC_CNT   T2                      08470099
CL3132                  WHERE T2.CNT_STUP_ID = D.CNT_STUP_ID            08480099
CL3132                    AND T2.LOC_NBR = D.LOC_NBR                    08490099
CL3132                    AND T2.SKU_NBR = D.SKU_NBR                    08500099
CL3132                    AND T2.CNT_SEQ_NBR = D.CNT_SEQ_NBR            08510099
CL3132                    AND T2.LAST_UPD_USR_ID <> 'SYSTEM')           08520099
CL3132              ) T                                                 08530099
CL3132                  ON C.CNT_STUP_ID = T.CNT_STUP_ID AND            08540099
CL3132                     C.CNT_SEQ_NBR = T.CNT_SEQ_NBR AND            08550099
CL3132                     C.LOC_NBR     = T.LOC_NBR     AND            08560099
CL3132                     C.SKU_NBR     = T.SKU_NBR                    08570099
108200                                                                  08580099
108300               WHERE C.LOC_NBR = :ICRD060-LOC-NBR                 08590099
108400                 AND C.CNT_STUP_ID = :ICRD060-CNT-STUP-ID         08600099
108500                 AND C.SKU_NBR = :ICRD060-SKU-NBR                 08610099
108600                 AND C.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR         08620099
CL3132                 AND C.LAST_UPD_USR_ID = 'SYSTEM'                 08630099
108700                                                                  08640099
108800                 AND C.LAST_UPD_TMST  =                           08650099
108900                     (SELECT MAX(G.LAST_UPD_TMST)                 08660099
109000                        FROM ICT_SKU_LOC_CNT   G                  08670099
109100                       WHERE G.CNT_STUP_ID = C.CNT_STUP_ID        08680099
109200                         AND G.SKU_NBR = C.SKU_NBR                08690099
109300                         AND G.CNT_SEQ_NBR = C.CNT_SEQ_NBR        08700099
CL3132                         AND G.LAST_UPD_USR_ID = 'SYSTEM'         08710099
109400                         AND G.LOC_NBR = C.LOC_NBR)               08720099
109500                                                                  08730099
109600     END-EXEC                                                     08740099
109700                                                                  08750099
109800       MOVE SQLCODE TO PV-SQL-SUB                                 08760099
109900     EVALUATE TRUE                                                08770099
110000         WHEN SQLCODE = ZERO                                      08780099
110100             ADD +1 TO PV-SELECT-SKU-CNT                          08790099
110200         WHEN SQLCODE = -904                                      08800099
110300         WHEN SQLCODE = -911                                      08810099
110400         WHEN SQLCODE = -913                                      08820099
110500             CONTINUE                                             08830099
110600         WHEN SQLCODE = +100                                      08840099
110700             SET NO-MORE-SKU-CNTS TO TRUE                         08850099
110800         WHEN OTHER                                               08860099
110900              DISPLAY '*2250 BLOWING UP ON BAD SQL-'              08870099
111000                 '* SELECT KEY-',                                 08880099
111100                  ICRD060-SKU-NBR,                                08890099
111200                  ICRD060-LOC-NBR,                                08900099
111300                  ICRD060-CNT-STUP-ID,                            08910099
111400                  ICRD060-CNT-STAT-CDE,                           08920099
111500                 ' SQL CODE -', PV-SQL-SUB, '**'                  08930099
111600              MOVE '2250-SELECT-SKU-FOR-REV'                      08940099
111700                  TO PV-PARAGRAPH-NAME                            08950099
111800             MOVE 'ERROR ON SELECT OF SKU NUMBER  '               08960099
111900                  TO PV-DB2-OPERATION                             08970099
112000             PERFORM 9900-SQL-ABEND                               08980099
112100         END-EVALUATE                                             08990099
112200     END-PERFORM.                                                 09000099
112300                                                                  09010099
112400     IF PV-RETRY GREATER PC-MAX-RETRIES                           09020099
112500       DISPLAY '*2250 BLOWING UP ON RETRIES ON SELECT-'           09030099
112600        PV-RETRY '**'                                             09040099
112700               '* SELECT KEY-',                                   09050099
112800                  ICRD060-SKU-NBR,                                09060099
112900                  ICRD060-LOC-NBR,                                09070099
113000                  ICRD060-CNT-STUP-ID,                            09080099
113100                  ICRD060-CNT-STAT-CDE,                           09090099
113200               ' SQL CODE -', PV-SQL-SUB, '**'                    09100099
113300        MOVE '2250-SELECT-SKU-FOR-REV '                           09110099
113400                 TO PV-PARAGRAPH-NAME                             09120099
113500        MOVE 'ERROR ON SELECT OF SKU NUMBER '                     09130099
113600                 TO PV-DB2-OPERATION                              09140099
113700        PERFORM 9900-SQL-ABEND                                    09150099
113800     END-IF.                                                      09160099
113801                                                                  09170099
113802*--------------------------------------------------------------*  09180099
113803* 2800-PROCESS-SKU-CNTS                                           09190099
113804*--------------------------------------------------------------*  09200099
113805 2800-PROCESS-SKU-CNTS.                                           09210099
113806                                                                  09220099
113807     SET PS-REVIEW-CHECK-NO TO TRUE.                              09230099
113808                                                                  09240099
113809     EVALUATE ICRD060-CNT-STAT-CDE                                09250099
113810         WHEN PC-AUT                                              09260099
113820             PERFORM 2200-SELECT-SKU                              09270099
113830             PERFORM 4000-PROCESS-SALES                           09280099
113840             PERFORM 4010-PROCESS-RETURNS                         09290099
113850             PERFORM 4020-PROCESS-TRANS-IN                        09300099
113860             PERFORM 4030-PROCESS-TRANS-OUT                       09310099
113870             PERFORM 5125-FS-CHECK                                09320099
113880         WHEN PC-APP                                              09330099
113890             PERFORM 2200-SELECT-SKU                              09340099
113900             PERFORM 4000-PROCESS-SALES                           09350099
114000             PERFORM 4010-PROCESS-RETURNS                         09360099
114100             PERFORM 4020-PROCESS-TRANS-IN                        09370099
114200             PERFORM 4030-PROCESS-TRANS-OUT                       09380099
114300             PERFORM 5125-FS-CHECK                                09390099
114400         WHEN PC-REV                                              09400099
114500             PERFORM 4040-PROCESS-REVERSE-APRVLS                  09410099
115500         WHEN OTHER                                               09420099
115600             SET INVALID-CNT-STAT-CDE TO TRUE                     09430099
115700     END-EVALUATE.                                                09440099
115800                                                                  09450099
115900                                                                  09460099
116000     PERFORM 2100-READ-INPUT-FILE.                                09470099
116100                                                                  09480099
116200******************************************************************09490099
116300* 4000-PROCESS-SALES                                             *09500099
116400* SUMS ALL SALES FOR A STORE/SKU PRIOR TO THE COMPLETED COUNTS   *09510099
116500* DATE.  (SEE ICCC018)                                           *09520099
116600******************************************************************09530099
116700 4000-PROCESS-SALES.                                              09540099
116800                                                                  09550099
116900     EXEC SQL                                                     09560099
117000           SELECT                                                 09570099
117100                 SUM (C.SLD_QTY)                                  09580099
117200             INTO                                                 09590099
117300                :PV-SUM-SLD-QTY  :PV-SUM-SLD-QTY-NULL-IND         09600099
117400             FROM TEPPART A                                       09610099
117500                 ,TEPTRN  B                                       09620099
117600                 ,TEPITM  C                                       09630099
117700                 ,XST_SKU D                                       09640099
117800            WHERE A.PARTN_NBR = B.PARTN_NBR                       09650099
117900              AND A.PARTN_NBR = C.PARTN_NBR                       09660099
118000              AND B.STR_NBR = :ICRD060-LOC-NBR                    09670099
118100              AND B.STR_NBR = C.STR_NBR                           09680099
118200              AND B.RGST_ID = C.RGST_ID                           09690099
118300              AND B.TRN_NBR = C.TRN_NBR                           09700099
118400              AND B.STRT_TM = C.STRT_TM                           09710099
118500              AND C.SKU_NBR = :ICRD060-SKU-NBR                    09720099
118600              AND C.SKU_NBR = D.SKU_NBR                           09730099
118700              AND B.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR         09740099
118800              AND A.SLS_DTE = :PV-COM-CNT-DTE                     09750099
118900              AND B.STRT_TM BETWEEN                               09760099
119000                        '00.00.00' AND :PV-COM-CNT-TM             09770099
119100              AND B.TRN_TYP_CDE                                   09780099
119200                    IN ('01','02','11','12','21','22','23')       09790099
119300              AND B.VOID_ABRT_CDE = 'N'                           09800099
119400              AND B.TRN_STAT_CDE IN ('V', 'Z', 'L')               09810099
119500              AND C.LIV_RSLU_CDE IN ('+', '-')                    09820099
119600              AND C.SAL_RET_CDE = 'S'                             09830099
119700              AND C.SKU_NBR > 0                                   09840099
119800              AND A.STR_GP_CDE = 'A'                              09850099
119900              AND A.DB_STRUC_CDE = 'O'                            09860099
120000              WITH UR                                             09870099
120100                                                                  09880099
120200     END-EXEC                                                     09890099
120300                                                                  09900099
120400         EVALUATE TRUE                                            09910099
120500             WHEN SQLCODE = ZERO                                  09920099
120600                 IF PV-SUM-SLD-QTY-NULL-IND = PC-NULL-VALUE       09930099
120700                   MOVE ZERO TO                                   09940099
120800                           ICT00011-RTL-SAL-UNT-QTY               09950099
120900                 ELSE                                             09960099
121000                     MOVE PV-SUM-SLD-QTY TO                       09970099
121100                            ICT00011-RTL-SAL-UNT-QTY              09980099
121200                 END-IF                                           09990099
121300                                                                  10000099
121400             WHEN SQLCODE = +100                                  10010099
121500                 MOVE ZERO TO                                     10020099
121600                            ICT00011-RTL-SAL-UNT-QTY              10030099
121700                                                                  10040099
121800             WHEN SQLWARN0 NOT EQUAL SPACE                        10050099
121900             WHEN SQLCODE NOT EQUAL ZERO                          10060099
122000                 DISPLAY '**************************************' 10070099
122100                 DISPLAY '** ABEND                            **' 10080099
122200                 DISPLAY '** PARAGRAPH 4000 SUM SALES PROBLEM **' 10090099
122300                 DISPLAY '*COUNT SETUP ID   = '                   10100099
122400                              ICRD060-CNT-STUP-ID                 10110099
122500                 DISPLAY '*LOCATION NUMBER  = '                   10120099
122600                              ICRD060-LOC-NBR                     10130099
122700                 DISPLAY '*SKU NUMBER       = '                   10140099
122800                              ICRD060-SKU-NBR                     10150099
122900                 DISPLAY '*PV-COM-CNT-DTE   = '                   10160099
123000                              PV-COM-CNT-DTE                      10170099
123100                 DISPLAY '*PV-COM-CNT-TM    = '                   10180099
123200                              PV-COM-CNT-TM                       10190099
123300                 DISPLAY '**************************************' 10200099
123400                 MOVE '4000-PROCESS-SALES' TO                     10210099
123500                      PV-PARAGRAPH-NAME                           10220099
123600                 MOVE 'ERROR ON SELECT OF SUM SALES ' TO          10230099
123700                      PV-DB2-OPERATION                            10240099
123800                 PERFORM 9900-SQL-ABEND                           10250099
123900                                                                  10260099
124000         END-EVALUATE.                                            10270099
124100                                                                  10280099
125300******************************************************************10290099
125400* 4010-PROCESS-RETURNS                                           *10300099
125500* SUMS ALL RETURNS FOR A STORE/SKU PRIOR TO THE COMPLETED COUNTS *10310099
125600* DATE.  (SEE ICCC018)                                           *10320099
125700******************************************************************10330099
125800 4010-PROCESS-RETURNS.                                            10340099
125900                                                                  10350099
126000     EXEC SQL                                                     10360099
126100           SELECT                                                 10370099
126200                 SUM (C.SLD_QTY)                                  10380099
126300             INTO                                                 10390099
126400                :PV-SUM-RET-QTY  :PV-SUM-RET-QTY-NULL-IND         10400099
126500             FROM TEPPART A                                       10410099
126600                 ,TEPTRN  B                                       10420099
126700                 ,TEPITM  C                                       10430099
126800                 ,XST_SKU D                                       10440099
126900            WHERE A.PARTN_NBR = B.PARTN_NBR                       10450099
127000              AND A.PARTN_NBR = C.PARTN_NBR                       10460099
127100              AND B.STR_NBR = :ICRD060-LOC-NBR                    10470099
127200              AND B.STR_NBR = C.STR_NBR                           10480099
127300              AND B.RGST_ID = C.RGST_ID                           10490099
127400              AND B.TRN_NBR = C.TRN_NBR                           10500099
127500              AND B.STRT_TM = C.STRT_TM                           10510099
127600              AND C.SKU_NBR = :ICRD060-SKU-NBR                    10520099
127700              AND C.SKU_NBR = D.SKU_NBR                           10530099
127800              AND B.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR         10540099
127900              AND A.SLS_DTE = :PV-COM-CNT-DTE                     10550099
128000              AND B.STRT_TM BETWEEN                               10560099
128100                        '00.00.00' AND :PV-COM-CNT-TM             10570099
128200              AND B.TRN_TYP_CDE                                   10580099
128210                    IN ('01','02','11','12','21','22','23')       10590099
128400              AND B.VOID_ABRT_CDE = 'N'                           10600099
128500              AND B.TRN_STAT_CDE IN ('V', 'Z', 'L')               10610099
128600              AND C.LIV_RSLU_CDE IN ('+', '-')                    10620099
128700              AND C.SAL_RET_CDE = 'R'                             10630099
128800              AND C.SKU_NBR > 0                                   10640099
128900              AND A.STR_GP_CDE = 'A'                              10650099
129000              AND A.DB_STRUC_CDE = 'O'                            10660099
129100              WITH UR                                             10670099
129200                                                                  10680099
129300     END-EXEC                                                     10690099
129400                                                                  10700099
129500         EVALUATE TRUE                                            10710099
129600             WHEN SQLCODE = ZERO                                  10720099
129700                 IF PV-SUM-RET-QTY-NULL-IND = PC-NULL-VALUE       10730099
129800                   MOVE ZERO TO                                   10740099
129900                            ICT00011-RTL-RET-UNT-QTY              10750099
130000                 ELSE                                             10760099
130100                     MOVE PV-SUM-RET-QTY TO                       10770099
130200                            ICT00011-RTL-RET-UNT-QTY              10780099
130300                 END-IF                                           10790099
130400                                                                  10800099
130500             WHEN SQLCODE = +100                                  10810099
130600                 MOVE ZERO TO                                     10820099
130700                            ICT00011-RTL-RET-UNT-QTY              10830099
130800                                                                  10840099
130900             WHEN SQLWARN0 NOT EQUAL SPACE                        10850099
131000             WHEN SQLCODE NOT EQUAL ZERO                          10860099
131100                 DISPLAY '**************************************' 10870099
131200                 DISPLAY '** ABEND                            **' 10880099
131300                 DISPLAY '** PARAGRAPH 4010 SUM RETURN PROBLEM**' 10890099
131400                 DISPLAY '*COUNT SETUP ID   = '                   10900099
131500                              ICRD060-CNT-STUP-ID                 10910099
131600                 DISPLAY '*LOCATION NUMBER  = '                   10920099
131700                              ICRD060-LOC-NBR                     10930099
131800                 DISPLAY '*SKU NUMBER       = '                   10940099
131900                              ICRD060-SKU-NBR                     10950099
132000                 DISPLAY '**************************************' 10960099
132100                 MOVE '4010-PROCESS-RETURNS' TO                   10970099
132200                      PV-PARAGRAPH-NAME                           10980099
132300                 MOVE 'ERROR ON SELECT OF SUM RETURNS' TO         10990099
132400                      PV-DB2-OPERATION                            11000099
132500                 PERFORM 9900-SQL-ABEND                           11010099
132600                                                                  11020099
132700         END-EVALUATE.                                            11030099
132800                                                                  11040099
133900******************************************************************11050099
134000* 4020-PROCESS-TRANS-IN                                          *11060099
134100*   PROCESS TRANSFERS IN FOR APPROVED COUNTS.                    *11070099
134200******************************************************************11080099
134300 4020-PROCESS-TRANS-IN.                                           11090099
134400                                                                  11100099
134500     EXEC SQL                                                     11110099
134600           SELECT                                                 11120099
134700                 SUM (B.XFER_QTY)                                 11130099
134800             INTO                                                 11140099
134900                :PV-XFER-IN-QTY  :PV-SUM-XFER-IN-NULL-IND         11150099
135000            FROM TTFMSTR       A                                  11160099
135100                ,TTFITEM       B                                  11170099
135200                ,XST_UPC       C                                  11180099
135300                ,XST_SKU       D                                  11190099
135400                ,TTFSTAT       F                                  11200099
135900           WHERE A.XFER_DKEY_ID   = B.XFER_DKEY_ID                11210099
136000             AND B.SCN_UPC_NBR    = C.UPC_NBR                     11220099
136100             AND C.INTR_UPC_ID    = D.INTR_UPC_ID                 11230099
136200             AND D.SKU_NBR        = :ICRD060-SKU-NBR              11240099
136300             AND A.TO_STR_NBR     = :ICRD060-LOC-NBR              11250099
136400             AND A.CMPT_XFER_END_TMST < :PV-COM-CNT-TMST-HOLD     11260099
136410             AND A.CMPT_XFER_END_TMST > :PV-COMPARE-TMST-HOLD     11270099
136420             AND F.XFER_STAT_CDE NOT IN ('PR','RC','RN','VD')     11280099
136421             AND A.XFER_DKEY_ID   = F.XFER_DKEY_ID                11290099
136430             AND F.XFER_STAT_TMST =                               11300099
136440                   (SELECT MAX(G.XFER_STAT_TMST)                  11310099
136450                      FROM TTFSTAT  G                             11320099
136460                     WHERE F.XFER_DKEY_ID = G.XFER_DKEY_ID)       11330099
137100             WITH UR                                              11340099
137200                                                                  11350099
137300     END-EXEC.                                                    11360099
137400                                                                  11370099
137500         EVALUATE TRUE                                            11380099
137600             WHEN SQLCODE = ZERO                                  11390099
137700                 IF PV-XFER-IN-QTY-NULL-IND = PC-NULL-VALUE       11400099
137800                   MOVE ZERO TO                                   11410099
137900                           ICT00011-XFER-IN-UNT-QTY               11420099
138000                 ELSE                                             11430099
138100                     MOVE PV-XFER-IN-QTY TO                       11440099
138200                            ICT00011-XFER-IN-UNT-QTY              11450099
138300                 END-IF                                           11460099
138400                                                                  11470099
138500             WHEN SQLCODE = +100                                  11480099
138600                 MOVE ZERO TO                                     11490099
138700                            ICT00011-XFER-IN-UNT-QTY              11500099
138800                                                                  11510099
138900             WHEN SQLWARN0 NOT EQUAL SPACE                        11520099
139000             WHEN SQLCODE NOT EQUAL ZERO                          11530099
139100                 DISPLAY '**************************************' 11540099
139200                 DISPLAY '** ABEND                            **' 11550099
139300                 DISPLAY '** PARA 4020 SUM TRANSFERS IN PROBLEM*' 11560099
139400                 DISPLAY '*LOCATION NUMBER  = '                   11570099
139500                              ICRD060-LOC-NBR                     11580099
139600                 DISPLAY '*SKU NUMBER       = '                   11590099
139700                              ICRD060-SKU-NBR                     11600099
139800                 DISPLAY '**************************************' 11610099
139900                 MOVE '4020-PROCESS-TRANS-IN' TO                  11620099
140000                      PV-PARAGRAPH-NAME                           11630099
140100                 MOVE 'ERROR ON SELECT OF TRANS IN' TO            11640099
140200                      PV-DB2-OPERATION                            11650099
140300                 PERFORM 9900-SQL-ABEND                           11660099
140400                                                                  11670099
140500         END-EVALUATE.                                            11680099
140600                                                                  11690099
141700******************************************************************11700099
141800* 4030-PROCESS-TRANS-OUT                                         *11710099
141900*   PROCESS TRANSFERS OUT FOR APPROVED COUNTS.                   *11720099
142000******************************************************************11730099
142100 4030-PROCESS-TRANS-OUT.                                          11740099
142200                                                                  11750099
142300     EXEC SQL                                                     11760099
142400           SELECT                                                 11770099
142500                 SUM (B.XFER_QTY)                                 11780099
142600             INTO                                                 11790099
142700                :PV-XFER-OUT-QTY :PV-SUM-XFER-OUT-NULL-IND        11800099
142800            FROM TTFMSTR       A                                  11810099
142900                ,TTFITEM       B                                  11820099
143000                ,XST_UPC       C                                  11830099
143100                ,XST_SKU       D                                  11840099
143200                ,TTFSTAT       F                                  11850099
143700           WHERE A.XFER_DKEY_ID   = B.XFER_DKEY_ID                11860099
143800             AND B.SCN_UPC_NBR    = C.UPC_NBR                     11870099
143900             AND C.INTR_UPC_ID    = D.INTR_UPC_ID                 11880099
144000             AND D.SKU_NBR        = :ICRD060-SKU-NBR              11890099
144100             AND A.FR_STR_NBR     = :ICRD060-LOC-NBR              11900099
144110             AND A.CMPT_XFER_END_TMST < :PV-COM-CNT-TMST-HOLD     11910099
144120             AND A.CMPT_XFER_END_TMST > :PV-COMPARE-TMST-HOLD     11920099
144130             AND F.XFER_STAT_CDE NOT IN ('PR','RC','RN','VD')     11930099
144131             AND A.XFER_DKEY_ID   = F.XFER_DKEY_ID                11940099
144140             AND F.XFER_STAT_TMST =                               11950099
144150                   (SELECT MAX(G.XFER_STAT_TMST)                  11960099
144160                      FROM TTFSTAT  G                             11970099
144170                     WHERE F.XFER_DKEY_ID = G.XFER_DKEY_ID)       11980099
144800             WITH UR                                              11990099
144900                                                                  12000099
145000     END-EXEC.                                                    12010099
145100                                                                  12020099
145200         EVALUATE TRUE                                            12030099
145300             WHEN SQLCODE = ZERO                                  12040099
145400                 IF PV-XFER-OUT-QTY-NULL-IND = PC-NULL-VALUE      12050099
145500                   MOVE ZERO TO                                   12060099
145600                           ICT00011-XFER-OUT-UNT-QTY              12070099
145700                 ELSE                                             12080099
145800                     MOVE PV-XFER-OUT-QTY TO                      12090099
145900                            ICT00011-XFER-OUT-UNT-QTY             12100099
146000                 END-IF                                           12110099
146100                                                                  12120099
146200                                                                  12130099
146300             WHEN SQLCODE = +100                                  12140099
146400                 MOVE ZERO TO                                     12150099
146500                            ICT00011-XFER-OUT-UNT-QTY             12160099
146600                                                                  12170099
146700             WHEN SQLWARN0 NOT EQUAL SPACE                        12180099
146800             WHEN SQLCODE NOT EQUAL ZERO                          12190099
146900                 DISPLAY '**************************************' 12200099
147000                 DISPLAY '** ABEND                            **' 12210099
147100                 DISPLAY '** PARA 4030 SUM TRANSFERS OUT PROBLEM*'12220099
147200                 DISPLAY '*LOCATION NUMBER  = '                   12230099
147300                              ICRD060-LOC-NBR                     12240099
147400                 DISPLAY '*SKU NUMBER       = '                   12250099
147500                              ICRD060-SKU-NBR                     12260099
147600                 DISPLAY '**************************************' 12270099
147700                 MOVE '4030-PROCESS-TRANS-OUT' TO                 12280099
147800                      PV-PARAGRAPH-NAME                           12290099
147900                 MOVE 'ERROR ON SELECT OF TRANS OUT' TO           12300099
148000                      PV-DB2-OPERATION                            12310099
148100                 PERFORM 9900-SQL-ABEND                           12320099
148200                                                                  12330099
148300         END-EVALUATE.                                            12340099
148400                                                                  12350099
149500******************************************************************12360099
149600* 4040-PROCESS-REVERSE-APRVLS.                                   *12370099
149700*   PROCESS INFORMATION FOR REVERSE APPROVALS.                   *12380099
149800******************************************************************12390099
149900 4040-PROCESS-REVERSE-APRVLS.                                     12400099
150000                                                                  12410099
150100     PERFORM 2250-SELECT-SKU-FOR-REV.                             12420099
C88463     SET NOT-NULL-ICC-COUNT   TO TRUE                             12430099
199390     PERFORM 5175-PREP-FS-OUTPUT-RECORD.                          12440099
220300                                                                  12450099
C88463*    IF AN RFID COUNT WASN'T ENTERED (SCANNED COUNT IS NULL)      12460099
C88463*    AND COUNT TYPE = 'ICC', DO NOT SEND AN UPDATE TO FASHION.    12470099
C88463*    IF AN RFID COUNT WAS ENTERED (SCANNED COUNT IS NOT NULL)     12480099
C88463*    OR THIS IS A USA COUNT (COUNT TYPE = 'USA') CHECK IF THE     12490099
C88463*    QTY IS BEING ADJUSTED.  A NULL USA COUNT REFLECTS A ZERO     12500099
C88463*    QTY.                                                         12510099
C88463*    CALC ADJ QTY - IF IT'S ZERO, THERE IS NO REASON TO           12520099
C88463*    WRITE TO THE WORK TABLE OR UPDATE FASHION SALES.             12530099
C88463*    (CHANGE IS FOR ICC ONLY - LEAVE USA WORKING LIKE IT WAS).    12540099
C88463     IF NULL-ICC-COUNT                                            12550099
C88463         MOVE ZEROES TO PV-ADJ-QTY                                12560099
C88463     ELSE                                                         12570099
C88463         COMPUTE PV-ADJ-QTY  =                                    12580099
C88463         ((ICRD061-SCANNED-UNT-QTY - ICRD061-START-ONHAND-QTY) +  12590099
C32847          (ICRD061-SALES-QTY - ICRD061-RETURNS-QTY)) * -1         12600099
C88463                                                                  12610099
C88463         IF PV-ADJ-QTY = ZERO AND ICRD060-CNT-TYP-CDE = 'ICC'     12620099
C88463             CONTINUE                                             12630099
C88463         ELSE                                                     12640099
C88463***          ALL USA REVERSALS WILL PASS THROUGH HERE.            12650099
C88463***          ONLY APPROVED ICC (RFID) REVERSALS CAUSING           12660099
C88463***          ADJUSTMENTS WILL PASS THROUGH HERE.                  12670099
199400             PERFORM 5300-INSERT-WORK-TABLE                       12680099
C88463         END-IF                                                   12690099
C88463     END-IF.                                                      12700099
199500                                                                  12710099
150400                                                                  12720099
150500*--------------------------------------------------------------*  12730099
168300* 4500-DETERMINE-TIMEZONE                                      *  12740099
168400*   DETERMINE THE TIMEZONE FOR THE STORE                       *  12750099
168500*--------------------------------------------------------------*  12760099
168600 4500-DETERMINE-TIMEZONE.                                         12770099
168700                                                                  12780099
168800     PERFORM 8500-SELECT-XST-LOC.                                 12790099
168900     MOVE XST00001-STD-TM-ZN-CDE TO                               12800099
168910          ICWS010-TZC-TZ-IN-TM-ZN-CDE.                            12810099
169000     MOVE XST00001-DST-IND       TO ICWS010-TZC-TZ-IND-ST-IND.    12820099
169100     PERFORM 9000-TIMEZONE-CONVERSION.                            12830099
169200     MOVE ICWS010-TZC-LOCATION-TMST TO ICT00020-LAST-UPD-TMST,    12840099
169300                                  ICT00011-LAST-UPD-TMST.         12850099
169301*MAM MOVE ICWS010-TZC-LOCATION-TMST TO ICT00011-LAST-UPD-TMST.    12860099
169302                                                                  12870099
169303                                                                  12880099
196700*--------------------------------------------------------------*  12890099
196800* 5100-INSERT-PROCESSED-REC                                    *  12900099
196900*   INSERT ROW FOR PROCESSED RECORD                            *  12910099
197000*--------------------------------------------------------------*  12920099
197100 5100-INSERT-PROCESSED-REC.                                       12930099
197200                                                                  12940099
197300     MOVE '5100-INSERT-PROCESSED-REC' TO PV-PARAGRAPH-NAME.       12950099
197400                                                                  12960099
198402     PERFORM                                                      12970099
198403         WITH TEST AFTER                                          12980099
198404         VARYING PV-NUMBER-OF-RETRIES                             12990099
198405         FROM 1 BY 1                                              13000099
198406         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       13010099
198407                OR SQLCODE = 0)                                   13020099
198408                                                                  13030099
199110         EXEC SQL                                                 13040099
199120             INSERT INTO ICT_LOC_CNT_STAT                         13050099
199121                   (CNT_STAT_CDE,                                 13060099
199122                    LOC_NBR,                                      13070099
199123                    CNT_STUP_ID,                                  13080099
199124                    CNT_SEQ_NBR,                                  13090099
199125                    LAST_UPD_TMST,                                13100099
199126                    LAST_UPD_USR_ID,                              13110099
199127                    LAST_ACTN_CDE)                                13120099
199128                                                                  13130099
199129             VALUES                                               13140099
199130                  (:PC-PRC,                                       13150099
199131                   :ICRD060-LOC-NBR,                              13160099
199140                   :ICRD060-CNT-STUP-ID,                          13170099
199150                   :ICRD060-CNT-SEQ-NBR,                          13180099
199151                   :ICT00020-LAST-UPD-TMST,                       13190099
199160                   :PC-SYSTEM,                                    13200099
199170                   :PC-A)                                         13210099
199238         END-EXEC                                                 13220099
199239                                                                  13230099
199240                                                                  13240099
199241         EVALUATE TRUE                                            13250099
199242             WHEN SQLCODE = 0                                     13260099
199243                 ADD +1 TO PV-INSERT-CNT-STAT                     13270099
199244                 ADD +1 TO PV-CNT-SINCE-COMMIT                    13280099
199249                                                                  13290099
199250             WHEN SQLCODE = -803                                  13300099
199252                 DISPLAY '**************************************' 13310099
199254                 DISPLAY '** 5100 INSERT PROBLEM ON TABLE --  **' 13320099
199255                 DISPLAY '** ICT_LOC_CNT_STAT                 **' 13330099
199256                 DISPLAY '** DUPLICATE INSERT ATTEMPTED       **' 13340099
199259                 DISPLAY '*COUNT SETUP ID   = '                   13350099
199260                              ICT00020-CNT-STUP-ID                13360099
199261                 DISPLAY '*LOCATION NUMBER  = '                   13370099
199262                              ICT00020-LOC-NBR                    13380099
199263                 DISPLAY '**************************************' 13390099
199264                 MOVE 'ERROR ON INSERT TO ICT_LOC_CNT_STAT' TO    13400099
199265                      PV-DB2-OPERATION                            13410099
199266                 PERFORM 9900-SQL-ABEND                           13420099
199267                                                                  13430099
199268             WHEN SQLWARN0 NOT EQUAL SPACE                        13440099
199269             WHEN SQLCODE NOT EQUAL ZERO                          13450099
199270                 DISPLAY '**************************************' 13460099
199271                 DISPLAY '** ABEND                            **' 13470099
199272                 DISPLAY '** 5100 INSERT PROBLEM              **' 13480099
199273                 DISPLAY '*COUNT SETUP ID   = '                   13490099
199274                              ICT00020-CNT-STUP-ID                13500099
199275                 DISPLAY '*LOCATION NUMBER  = '                   13510099
199276                              ICT00020-LOC-NBR                    13520099
199277                 DISPLAY '**************************************' 13530099
199281                 MOVE 'ERROR ON INSERT OF COUNT ' TO              13540099
199282                      PV-DB2-OPERATION                            13550099
199283                 PERFORM 9900-SQL-ABEND                           13560099
199284                                                                  13570099
199285         END-EVALUATE                                             13580099
199286     END-PERFORM.                                                 13590099
199287                                                                  13600099
199288     IF  PV-NUMBER-OF-RETRIES > PC-MAX-RETRIES AND                13610099
199289         (SQLCODE NOT = ZERO AND                                  13620099
199290          SQLCODE NOT = -803)                                     13630099
199291         DISPLAY '****************************************'       13640099
199300         DISPLAY '** ABEND                              **'       13650099
199301         DISPLAY '** 5100 INSERT PROBLEM ON TABLE ---   **'       13660099
199302         DISPLAY 'ICT_LOC_CNT_STAT                      **'       13670099
199303         DISPLAY '*COUNT SETUP ID   = '                           13680099
199304                      ICT00020-CNT-STUP-ID                        13690099
199305         DISPLAY '*LOCATION NUMBER  = '                           13700099
199306                      ICT00020-LOC-NBR                            13710099
199307         DISPLAY '****************************************'       13720099
199308         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       13730099
199311         PERFORM 9900-SQL-ABEND                                   13740099
199312     END-IF.                                                      13750099
199313                                                                  13760099
199314*--------------------------------------------------------------*  13770099
199315* 5125-FS-CHECK                                                *  13780099
199316*   DETERMINE IF SKU/AMOUNTS SHOULD BE SENT TO FASHION SALES.  *  13790099
199317*--------------------------------------------------------------*  13800099
199318 5125-FS-CHECK.                                                   13810099
C88463*    DESCRIPTION: CHANGED FOR RFID PROJECT.                       13820099
199319                                                                  13830099
199320     MOVE '5125-FS-CHECK'                                         13840099
199330                     TO PV-PARAGRAPH-NAME.                        13850099
199340                                                                  13860099
199350**   MOVE ZERO TO ICT00011-RTL-RET-UNT-QTY.                       13870099
199360     PERFORM 4500-DETERMINE-TIMEZONE.                             13880099
199370     MOVE PV-EXEC-TMST TO ICT00011-EXEC-TMST.                     13890099
199380     PERFORM 5150-INSERT-SKU-LOC-CNT.                             13900099
C88463     SET NOT-NULL-ICC-COUNT   TO TRUE                             13910099
199390     PERFORM 5175-PREP-FS-OUTPUT-RECORD.                          13920099
220300                                                                  13930099
C88463*    IF AN RFID COUNT WASN'T ENTERED (SCANNED COUNT IS NULL)      13940099
C88463*    AND COUNT TYPE = 'ICC', DO NOT SEND AN UPDATE TO FASHION.    13950099
C88463*    IF AN RFID COUNT WAS ENTERED (SCANNED COUNT IS NOT NULL)     13960099
C88463*    OR THIS IS A USA COUNT (COUNT TYPE = 'USA') CHECK IF THE     13970099
C88463*    QTY IS BEING ADJUSTED.  A NULL USA COUNT REFLECTS A ZERO     13980099
C88463*    QTY.                                                         13990099
C88463*    CALC ADJ QTY - IF IT'S ZERO, THERE IS NO REASON TO           14000099
C88463*    WRITE TO THE WORK TABLE OR UPDATE FASHION SALES.             14010099
C88463*    IF THE CALC ADJ QTY IS NOT ZERO, CHECK FOR DUPLICATE         14020099
C88463*    COUNTS, REGARDLESS OF COUNT TYPE (USA OR RFID).              14030099
C88463     IF NULL-ICC-COUNT                                            14040099
C88463         MOVE ZEROES TO PV-ADJ-QTY                                14050099
C88463     ELSE                                                         14060099
C88463         COMPUTE PV-ADJ-QTY  =                                    14070099
C88463         (ICRD061-SCANNED-UNT-QTY - ICRD061-START-ONHAND-QTY) +   14080099
C32847         (ICRD061-SALES-QTY - ICRD061-RETURNS-QTY)                14090099
C88463                                                                  14100099
C88463         IF PV-ADJ-QTY = ZERO                                     14110099
C88463            CONTINUE                                              14120099
C88463         ELSE                                                     14130099
C88463             SET NO-DUPLICATE-COUNT TO TRUE                       14140099
C88463             PERFORM 5160-CHECK-FOR-DUP-COUNT                     14150099
C88463             IF DUPLICATE-COUNT                                   14160099
C88463                 MOVE PV-ADJ-QTY TO PV-ADJ-QTY-DISPLAY            14170099
C88463                 DISPLAY 'SKIPPING DUP COUNT.'                    14180099
C88463                  ' STR: ' ICRD061-LOC-NBR                        14190099
C88463                  ' SKU: ' ICRD061-SKU-NBR                        14200099
C88463                  ' QTY: ' PV-ADJ-QTY-DISPLAY                     14210099
C88463                  ' STUP ID: ' ICRD061-CNT-STUP-ID                14220099
C88463                  ' CNT SEQ: ' ICRD061-CNT-SEQ-NBR                14230099
C88463                  ' ALREADY UPDATED BY '                          14240099
C88463                  ' STUP ID: ' ICT00011-CNT-STUP-ID               14250099
C88463                  ' CNT SEQ: ' ICT00011-CNT-SEQ-NBR               14260099
C88463             ELSE                                                 14270099
199400                 PERFORM 5300-INSERT-WORK-TABLE                   14280099
C88463             END-IF                                               14290099
C88463         END-IF                                                   14300099
C88463     END-IF.                                                      14310099
199500                                                                  14320099
220300                                                                  14330099
199600**   IF PV-SUM-SLD-QTY NOT EQUAL ZERO  OR                         14340099
199700**      PV-SUM-RET-QTY NOT EQUAL ZERO  OR                         14350099
199800**      PV-XFER-IN-QTY NOT EQUAL ZERO  OR                         14360099
199900**      PV-XFER-OUT-QTY NOT EQUAL ZERO                            14370099
200000**       PERFORM 4500-DETERMINE-TIMEZONE                          14380099
200100**       MOVE PV-EXEC-TMST TO ICT00011-EXEC-TMST                  14390099
200200**       PERFORM 5150-INSERT-SKU-LOC-CNT                          14400099
200300**       PERFORM 5175-PREP-FS-OUTPUT-RECORD                       14410099
200400**       PERFORM 5200-WRITE-OUTPUT-RECORD                         14420099
200500**   END-IF.                                                      14430099
200600                                                                  14440099
200700*--------------------------------------------------------------*  14450099
200800* 5130-REVIEW-CHECK                                            *  14460099
200900*   DETERMINE IF SKU/AMOUNTS HAVE CHANGED FOR REVIEW TYPES.    *  14470099
201000*--------------------------------------------------------------*  14480099
201100 5130-REVIEW-CHECK.                                               14490099
201200                                                                  14500099
201300     MOVE '5130-REVIEW-CHECK'                                     14510099
201400                     TO PV-PARAGRAPH-NAME.                        14520099
201500                                                                  14530099
201600     PERFORM 4500-DETERMINE-TIMEZONE.                             14540099
201700     MOVE PV-EXEC-TMST TO ICT00011-EXEC-TMST.                     14550099
201800     PERFORM 5150-INSERT-SKU-LOC-CNT.                             14560099
201900                                                                  14570099
202000**   IF PV-SUM-SLD-QTY NOT EQUAL ZERO  OR                         14580099
202100**      PV-SUM-RET-QTY NOT EQUAL ZERO  OR                         14590099
202200**      PV-XFER-IN-QTY NOT EQUAL ZERO  OR                         14600099
202300**      PV-XFER-OUT-QTY NOT EQUAL ZERO                            14610099
202400**       PERFORM 4500-DETERMINE-TIMEZONE                          14620099
202500**       MOVE PV-EXEC-TMST TO ICT00011-EXEC-TMST                  14630099
202600**       PERFORM 5150-INSERT-SKU-LOC-CNT                          14640099
202700**   END-IF.                                                      14650099
202800                                                                  14660099
202900*--------------------------------------------------------------*  14670099
203000* 5150-INSERT-SKU-LOC-CNT                                      *  14680099
203100*   INSERT ROW FOR SKU-LOC-CNT                                 *  14690099
203200*--------------------------------------------------------------*  14700099
203300 5150-INSERT-SKU-LOC-CNT.                                         14710099
203400                                                                  14720099
203500     MOVE '5150-INSERT-SKU-LOC-CNT'                               14730099
203600                     TO PV-PARAGRAPH-NAME.                        14740099
205700                                                                  14750099
205800     PERFORM                                                      14760099
205900         WITH TEST AFTER                                          14770099
206000         VARYING PV-NUMBER-OF-RETRIES                             14780099
206100         FROM 1 BY 1                                              14790099
206200         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       14800099
206300                OR SQLCODE = 0)                                   14810099
206400                                                                  14820099
206500         EXEC SQL                                                 14830099
206600             INSERT INTO ICT_SKU_LOC_CNT                          14840099
206700                   (LOC_NBR,                                      14850099
206800                    SKU_NBR,                                      14860099
206900                    CNT_STUP_ID,                                  14870099
207000                    LAST_UPD_TMST,                                14880099
207100                    CNT_SEQ_NBR,                                  14890099
207200                    LAST_UPD_USR_ID,                              14900099
207300                    LAST_ACTN_CDE,                                14910099
207400                    UNT_RTL_AMT,                                  14920099
207500                    LOC_EXPTED_UNT_QTY,                           14930099
207600                    IN_TRNST_UNT_QTY,                             14940099
207700                    ACPTD_TRUK_UNT_QTY,                           14950099
207800                    RTL_SAL_UNT_QTY,                              14960099
207900                    RTL_RET_UNT_QTY,                              14970099
208000                    XFER_IN_UNT_QTY,                              14980099
208100                    XFER_OUT_UNT_QTY,                             14990099
208200                    SCND_UPC_NBR,                                 15000099
208300                    SCND_UNT_QTY,                                 15010099
208400                    CNT_GP_CDE,                                   15020099
208500                    EXEC_TMST,                                    15030099
208600                    MDSE_EXPRN_DTE)                               15040099
208700                                                                  15050099
208800             VALUES                                               15060099
208900                  (:ICT00011-LOC-NBR,                             15070099
209000                   :ICT00011-SKU-NBR,                             15080099
209100                   :ICT00011-CNT-STUP-ID,                         15090099
209200                   :ICT00011-LAST-UPD-TMST,                       15100099
209300                   :ICT00011-CNT-SEQ-NBR,                         15110099
209400                   :PC-SYSTEM,                                    15120099
209500                   :PC-A,                                         15130099
209600                   :ICT00011-UNT-RTL-AMT,                         15140099
209700                   :ICT00011-LOC-EXPTED-UNT-QTY                   15150099
209800          ,:ICT00011-IN-TRNST-UNT-QTY  :PV-INTRNST-QTY-NULL-IND   15160099
209900       ,:ICT00011-ACPTD-TRUK-UNT-QTY  :PV-ACPTD-TRUK-QTY-NULL-IND 15170099
210000          ,:ICT00011-RTL-SAL-UNT-QTY                              15180099
210100          ,:ICT00011-RTL-RET-UNT-QTY                              15190099
210200          ,:ICT00011-XFER-IN-UNT-QTY                              15200099
210300          ,:ICT00011-XFER-OUT-UNT-QTY                             15210099
210400          ,:ICT00011-SCND-UPC-NBR  :PV-SCND-UPC-NBR-NULL-IND      15220099
210500          ,:ICT00011-SCND-UNT-QTY  :PV-SCND-UNT-QTY-NULL-IND      15230099
210600          ,:ICT00011-CNT-GP-CDE  :PV-CNT-GP-CDE-NULL-IND          15240099
210700          ,:ICT00011-EXEC-TMST  :PV-EXEC-TMST-NULL-IND            15250099
210800          ,:ICT00011-MDSE-EXPRN-DTE  :PV-MDSE-EXPRN-DTE-NULL-IND) 15260099
210900                                                                  15270099
211000         END-EXEC                                                 15280099
211100                                                                  15290099
211200                                                                  15300099
211300         EVALUATE TRUE                                            15310099
211400             WHEN SQLCODE = 0                                     15320099
211500                 ADD +1 TO PV-INSERT-CNT-SKU                      15330099
211600                 ADD +1 TO PV-CNT-SINCE-COMMIT                    15340099
211700                                                                  15350099
211800             WHEN SQLCODE = -803                                  15360099
211900                 DISPLAY '**************************************' 15370099
212000                 DISPLAY '** 5150 INSERT PROBLEM ON TABLE --  **' 15380099
212100                 DISPLAY '** ICT_SKU_LOC_CNT                  **' 15390099
212200                 DISPLAY '** DUPLICATE INSERT ATTEMPTED       **' 15400099
212300                 DISPLAY '*COUNT SETUP ID   = '                   15410099
212400                              ICT00011-CNT-STUP-ID                15420099
212500                 DISPLAY '*LOCATION NUMBER  = '                   15430099
212600                              ICT00011-LOC-NBR                    15440099
212700                 DISPLAY '*SKU NUMBER       = '                   15450099
212800                              ICT00011-SKU-NBR                    15460099
212900                 DISPLAY '**************************************' 15470099
213000                 MOVE 'ERROR ON INSERT TO ICT_SKU_LOC_CNT' TO     15480099
213100                      PV-DB2-OPERATION                            15490099
213200                 PERFORM 9900-SQL-ABEND                           15500099
213300                                                                  15510099
213400             WHEN SQLWARN0 NOT EQUAL SPACE                        15520099
213500             WHEN SQLCODE NOT EQUAL ZERO                          15530099
213600                 DISPLAY '**************************************' 15540099
213700                 DISPLAY '** ABEND                            **' 15550099
213800                 DISPLAY '** 5150 INSERT PROBLEM              **' 15560099
213900                 DISPLAY '*COUNT SETUP ID   = '                   15570099
214000                              ICT00011-CNT-STUP-ID                15580099
214100                 DISPLAY '*LOCATION NUMBER  = '                   15590099
214200                              ICT00011-LOC-NBR                    15600099
214300                 DISPLAY '*SKU NUMBER       = '                   15610099
214400                              ICT00011-SKU-NBR                    15620099
214500                 DISPLAY '**************************************' 15630099
214600                 MOVE 'ERROR ON INSERT OF SKU   ' TO              15640099
214700                      PV-DB2-OPERATION                            15650099
214800                 PERFORM 9900-SQL-ABEND                           15660099
214900                                                                  15670099
215000         END-EVALUATE                                             15680099
215100     END-PERFORM.                                                 15690099
215200                                                                  15700099
215300     IF  PV-NUMBER-OF-RETRIES > PC-MAX-RETRIES AND                15710099
215400         (SQLCODE NOT = ZERO AND                                  15720099
215500          SQLCODE NOT = -803)                                     15730099
215600         DISPLAY '****************************************'       15740099
215700         DISPLAY '** ABEND                              **'       15750099
215800         DISPLAY '** 5150 INSERT PROBLEM ON TABLE ---   **'       15760099
215900         DISPLAY 'ICT_SKU_LOC_CNT                       **'       15770099
216000         DISPLAY '*COUNT SETUP ID   = '                           15780099
216100                      ICT00011-CNT-STUP-ID                        15790099
216200         DISPLAY '*LOCATION NUMBER  = '                           15800099
216300                      ICT00011-LOC-NBR                            15810099
216400         DISPLAY '*SKU NUMBER       = '                           15820099
216500                      ICT00011-SKU-NBR                            15830099
216600         DISPLAY '****************************************'       15840099
216700         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       15850099
216800         PERFORM 9900-SQL-ABEND                                   15860099
216900     END-IF.                                                      15870099
217000                                                                  15880099
C88463                                                                  15890099
C88463*--------------------------------------------------------------*  15900099
C88463* 5160-CHECK-FOR-DUP-COUNT                                     *  15910099
C88463*   CHECK IF A COUNT FOR THE SAME STORE, SKU AND DATE HAS      *  15920099
C88463*   BEEN ENTERED.  IF IT HAS THEN THE COUNT BEING PROCESSED    *  15930099
C88463*   SHOULD NOT BE PASSED TO FASHION SALES.                     *  15940099
C88463*--------------------------------------------------------------*  15950099
C88463 5160-CHECK-FOR-DUP-COUNT.                                        15960099
C88463     MOVE '5160-CHECK-FOR-DUP-COUNT'                              15970099
C88463                     TO PV-PARAGRAPH-NAME.                        15980099
C88463     PERFORM                                                      15990099
C88463        WITH TEST AFTER                                           16000099
C88463        VARYING PV-RETRY  FROM 1 BY 1                             16010099
C88463          UNTIL (PV-RETRY > PC-MAX-RETRIES                        16020099
C88463             OR (SQLCODE = +100 OR +0))                           16030099
C88463                                                                  16040099
C88463* THIS GETS COMPLETED COUNTS FOR SAME DATE, STORE, SKU            16050099
C88463* IF A ROW IS FOUND, THIS IS A DUPLICATE COUNT                    16060099
C88463         EXEC SQL                                                 16070099
C88463                                                                  16080099
C88463           SELECT C.CNT_STUP_ID                                   16090099
C88463                , C.CNT_SEQ_NBR                                   16100099
C88463             INTO :ICT00011-CNT-STUP-ID                           16110099
C88463                , :ICT00011-CNT-SEQ-NBR                           16120099
C88463             FROM ICT_LOC_CNT_STAT A                              16130099
C88463                , ICT_SKU_LOC_CNT  C                              16140099
C88463            WHERE C.LOC_NBR             = :ICRD061-LOC-NBR        16150099
C88463              AND C.SKU_NBR             = :ICRD061-SKU-NBR        16160099
C88463              AND A.CNT_STAT_CDE        = 'COM'                   16170099
C88463              AND A.LOC_NBR             = C.LOC_NBR               16180099
C88463              AND A.CNT_STUP_ID         = C.CNT_STUP_ID           16190099
C88463              AND A.CNT_SEQ_NBR         = C.CNT_SEQ_NBR           16200099
C88463              AND (C.CNT_STUP_ID       <> :ICRD061-CNT-STUP-ID    16210099
C88463               OR  C.CNT_SEQ_NBR       <> :ICRD061-CNT-SEQ-NBR)   16220099
C88463              AND DATE(C.EXEC_TMST)     = :ICRD060-EXEC-DATE      16230099
C88463              AND  EXISTS                                         16240099
C88463                  (SELECT 1                                       16250099
C88463                     FROM ICT_LOC_CNT_STAT  I                     16260099
C88463                    WHERE I.CNT_STUP_ID  = A.CNT_STUP_ID          16270099
C88463                      AND I.CNT_SEQ_NBR  = A.CNT_SEQ_NBR          16280099
C88463                      AND I.LOC_NBR      = A.LOC_NBR              16290099
C88463                      AND I.CNT_STAT_CDE = 'PRC')                 16300099
C88463           FETCH FIRST 1 ROW ONLY                                 16310099
C88463             WITH UR                                              16320099
C88463                                                                  16330099
C88463         END-EXEC                                                 16340099
C88463                                                                  16350099
C88463*-- CNT_STUP_ID AND CNT_SEQ_NBR <> CHECKS EXCLUDE COUNT           16360099
C88463*-- BEING PROCESSED                                               16370099
C88463*-- EXISTS GETS COMPLETED COUNTS FOR THE SAME DATE, STORE, SKU    16380099
C88463                                                                  16390099
C88463         MOVE SQLCODE TO PV-SQL-SUB                               16400099
C88463         EVALUATE TRUE                                            16410099
C88463           WHEN SQLCODE = ZERO                                    16420099
C88463               SET DUPLICATE-COUNT TO TRUE                        16430099
C88463           WHEN SQLCODE = +100                                    16440099
C88463               SET NO-DUPLICATE-COUNT TO TRUE                     16450099
C88463           WHEN SQLCODE = -904                                    16460099
C88463           WHEN SQLCODE = -911                                    16470099
C88463           WHEN SQLCODE = -913                                    16480099
C88463               CONTINUE                                           16490099
C88463           WHEN OTHER                                             16500099
C88463                DISPLAY '*ABENDING ON BAD SQL-'                   16510099
C88463                   '* SELECT KEY-',                               16520099
C88463                    ICRD061-LOC-NBR                               16530099
C88463                    ICRD061-SKU-NBR                               16540099
C88463                   ' SQL CODE -', PV-SQL-SUB, '**'                16550099
C88463                MOVE '5160-CHECK-FOR-DUP-COUNT'                   16560099
C88463                    TO PV-PARAGRAPH-NAME                          16570099
C88463               MOVE 'ERROR WHEN CHECKING FOR DUP COUNTS '         16580099
C88463                    TO PV-DB2-OPERATION                           16590099
C88463               PERFORM 9900-SQL-ABEND                             16600099
C88463         END-EVALUATE                                             16610099
C88463     END-PERFORM.                                                 16620099
C88463                                                                  16630099
C88463     IF PV-RETRY GREATER PC-MAX-RETRIES                           16640099
C88463       DISPLAY '*ABENDING ON RETRIES FOR DUP COUNT CHECK-'        16650099
C88463        PV-RETRY '**'                                             16660099
C88463               '* SELECT KEY-',                                   16670099
C88463                    ICRD061-LOC-NBR                               16680099
C88463                    ICRD061-SKU-NBR                               16690099
C88463               ' SQL CODE -', PV-SQL-SUB, '**'                    16700099
C88463        MOVE '5160-CHECK-FOR-DUP-COUNT'                           16710099
C88463                 TO PV-PARAGRAPH-NAME                             16720099
C88463        MOVE 'ERROR WHEN CHECKING FOR DUP COUNTS '                16730099
C88463                 TO PV-DB2-OPERATION                              16740099
C88463        PERFORM 9900-SQL-ABEND                                    16750099
C88463     END-IF.                                                      16760099
C88463                                                                  16770099
C88463                                                                  16780099
217190*--------------------------------------------------------------*  16790099
217200* 5175-PREP-FS-OUTPUT-RECORD                                   *  16800099
217300*   PREP OUTPUT RECORD FOR FASHION SALES                       *  16810099
217400*--------------------------------------------------------------*  16820099
217500 5175-PREP-FS-OUTPUT-RECORD.                                      16830099
217600                                                                  16840099
217700     INITIALIZE ICRD061-UPDATED-COUNTS-RECORD.                    16850099
217800                                                                  16860099
217900     MOVE ICRD060-CNT-STAT-CDE TO                                 16870099
218000                               ICRD061-CNT-STAT-CDE.              16880099
218100     MOVE ICRD060-LOC-NBR      TO                                 16890099
218200                               ICRD061-LOC-NBR.                   16900099
218300     MOVE ICRD060-CNT-STUP-ID  TO                                 16910099
218400                               ICRD061-CNT-STUP-ID.               16920099
218500     MOVE ICRD060-CNT-SEQ-NBR  TO                                 16930099
218600                               ICRD061-CNT-SEQ-NBR.               16940099
218700     MOVE ICT00011-LAST-UPD-TMST TO                               16950099
218800                               ICRD061-LAST-UPD-TMST.             16960099
218900     MOVE ICRD060-SKU-NBR      TO                                 16970099
219000                               ICRD061-SKU-NBR.                   16980099
219100     MOVE ICT00011-RTL-SAL-UNT-QTY TO                             16990099
219200                               ICRD061-SALES-QTY.                 17000099
C32847     MOVE ICT00011-RTL-RET-UNT-QTY TO                             17010099
C32847                               ICRD061-RETURNS-QTY.               17020099
219500     MOVE ICT00011-XFER-IN-UNT-QTY TO                             17030099
219600                               ICRD061-TRANS-IN-QTY.              17040099
219700     MOVE ICT00011-XFER-OUT-UNT-QTY TO                            17050099
219800                               ICRD061-TRANS-OUT-QTY.             17060099
219801     IF  PV-SCND-UNT-QTY-NULL-IND = PC-NULL-VALUE                 17070099
219810         MOVE +0 TO            ICRD061-SCANNED-UNT-QTY            17080099
C88463         IF ICRD060-CNT-TYP-CDE = 'ICC'                           17090099
C88463             SET NULL-ICC-COUNT TO TRUE                           17100099
C88463         END-IF                                                   17110099
219820     ELSE                                                         17120099
219900         MOVE ICT00011-SCND-UNT-QTY TO                            17130099
220000                               ICRD061-SCANNED-UNT-QTY.           17140099
220100     MOVE ICT00011-LOC-EXPTED-UNT-QTY TO                          17150099
220200                               ICRD061-START-ONHAND-QTY.          17160099
111890     MOVE ICRD060-CNT-TYP-CDE TO                                  17170099
111890                               ICRD061-CNT-TYP-CDE.               17180099
220400     MOVE ICRD061-UPDATED-COUNTS-RECORD TO                        17190099
220500                               ICT00023-UPD-CNT-ODR.              17200099
220600                                                                  17210099
220700*--------------------------------------------------------------*  17220099
220800* 5300-INSERT-WORK-TABLE                                       *  17230099
220900*   INSERT OUTPUT RECORDS TO IC WORK TABLE                     *  17240099
221000*--------------------------------------------------------------*  17250099
221100 5300-INSERT-WORK-TABLE.                                          17260099
221200                                                                  17270099
221300     PERFORM                                                      17280099
221400         WITH TEST AFTER                                          17290099
221500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     17300099
221600         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            17310099
221700                 SQLCODE = ZERO                                   17320099
221800                                                                  17330099
221900         EXEC SQL                                                 17340099
222000              INSERT INTO ICTW_OPUT_REC                           17350099
222100                   (UPD_CNT_ODR)                                  17360099
CHG749                 VALUES (:ICT00023-UPD-CNT-ODR)                   17370099
222300         END-EXEC                                                 17380099
222400                                                                  17390099
222500         EVALUATE TRUE                                            17400099
222600             WHEN SQLCODE = ZERO                                  17410099
222700                 ADD +1 TO PV-FS-REC-CNT                          17420099
222800                                                                  17430099
222900             WHEN SQLWARN0 NOT EQUAL SPACE                        17440099
223000             WHEN SQLCODE NOT EQUAL ZERO                          17450099
223100                 DISPLAY '**************************************' 17460099
223200                 DISPLAY '** ABEND                            **' 17470099
223300                 DISPLAY '** PROGRAM = ICKUP161               **' 17480099
223400                 DISPLAY '** PARAGRAPH = 5300-INSERT-WORK-    **' 17490099
223500                 DISPLAY '**                  TABLE           **' 17500099
223600                 DISPLAY '** INSERT ICTW_OPUT_REC             **' 17510099
223700                 DISPLAY '** ICTW-OPUT-REC  = '                   17520099
223800                 DISPLAY '*'           ICT00023-UPD-CNT-ODR       17530099
223900                 DISPLAY '**************************************' 17540099
224000                 PERFORM 9900-SQL-ABEND                           17550099
224100         END-EVALUATE                                             17560099
224200     END-PERFORM.                                                 17570099
224300                                                                  17580099
224400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    17590099
224500         SQLCODE NOT = ZERO                                       17600099
224600         DISPLAY '****************************************'       17610099
224700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       17620099
224800         DISPLAY '** INSERT INTO TOUTTR5                **'       17630099
224900         DISPLAY '** PARAGRAPH = 5300-INSERT-WORK-TABLE **'       17640099
225000         DISPLAY '** ICTW-OPUT-REC  = ' ICT00023-UPD-CNT-ODR      17650099
225100         DISPLAY '****************************************'       17660099
225200         PERFORM 9900-SQL-ABEND                                   17670099
225300     END-IF.                                                      17680099
225400                                                                  17690099
225500 EJECT                                                            17700099
225600******************************************************************17710099
225700*    SELECT CHECKPOINT RESTART CONTROL INFORMATION.              *17720099
225800******************************************************************17730099
225900 6000-GET-CHECKPOINT-CNTL.                                        17740099
226000                                                                  17750099
226100     PERFORM WITH TEST AFTER                                      17760099
226200         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     17770099
226300         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR             17780099
226400                 SQLCODE = ZERO                                   17790099
226500                                                                  17800099
226600         EXEC SQL                                                 17810099
226700           SELECT  CKPT_STAT_CODE                                 17820099
226800                  ,CKPT_FRQNCY_QTY                                17830099
226900             INTO :TCKRSTCNTL-CKPT-STAT-CODE                      17840099
227000                 ,:TCKRSTCNTL-CKPT-FRQNCY-QTY                     17850099
227100             FROM  TCKRSTCNTL                                     17860099
227200            WHERE  JOB_NAME  = :PC-JOB-NAME                       17870099
227300              AND  PLAN_NAME = :PC-PROGRAM-NAME                   17880099
227400         END-EXEC                                                 17890099
227500                                                                  17900099
227600         EVALUATE TRUE                                            17910099
227700             WHEN SQLCODE = ZERO                                  17920099
227800             WHEN SQLCODE = -904                                  17930099
227900             WHEN SQLCODE = -913                                  17940099
228000                  CONTINUE                                        17950099
228100                                                                  17960099
228200             WHEN SQLWARN0 NOT EQUAL SPACE                        17970099
228300             WHEN SQLCODE NOT EQUAL ZERO                          17980099
228400                 DISPLAY '**************************************' 17990099
228500                 DISPLAY '** ABEND                            **' 18000099
228600                 DISPLAY '** PROGRAM = ICKUP161               **' 18010099
228700                 DISPLAY '** PARAGRAPH = 6000-GET-CHECKPOINT- **' 18020099
228800                 DISPLAY '**                  CNTL            **' 18030099
228900                 DISPLAY '** SELECT FROM TCKRSTCNTL           **' 18040099
229000                 DISPLAY '**CKPT-STAT-CODE ='                     18050099
229100                 DISPLAY              TCKRSTCNTL-CKPT-STAT-CODE   18060099
229200                 DISPLAY '**************************************' 18070099
229300                 PERFORM 9900-SQL-ABEND                           18080099
229400         END-EVALUATE                                             18090099
229500     END-PERFORM.                                                 18100099
229600                                                                  18110099
229700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    18120099
229800         SQLCODE NOT = ZERO                                       18130099
229900         DISPLAY '****************************************'       18140099
230000         DISPLAY '** MAX RETRIES EXCEEDED ON SELECT     **'       18150099
230100         DISPLAY '** FROM TCKRSTCNTL                    **'       18160099
230200         DISPLAY '** PARAGRAPH = 6000-GET-CHECKPOINT-CNTL*'       18170099
230300         DISPLAY '****************************************'       18180099
230400         PERFORM 9900-SQL-ABEND                                   18190099
230500     END-IF.                                                      18200099
230600                                                                  18210099
230700 EJECT                                                            18220099
230800                                                                  18230099
230900******************************************************************18240099
231000*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO  *18250099
231100******************************************************************18260099
231200 6010-GET-CHECKPOINT-INFO.                                        18270099
231300                                                                  18280099
231400     PERFORM                                                      18290099
231500         WITH TEST AFTER                                          18300099
231600         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     18310099
231700         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            18320099
231800                 SQLCODE = ZERO                                   18330099
231900                                                                  18340099
232000         EXEC SQL                                                 18350099
232100           SELECT WORK_STRG_DESC                                  18360099
232200           INTO :TCKRSTINF-WORK-STRG-DESC                         18370099
232300           FROM TCKRSTINF                                         18380099
232400           WHERE PLAN_NAME = :PC-PROGRAM-NAME                     18390099
232500             AND JOB_NAME  = :PC-JOB-NAME                         18400099
232600         END-EXEC                                                 18410099
232700                                                                  18420099
232800         EVALUATE TRUE                                            18430099
232900             WHEN SQLCODE = ZERO                                  18440099
233000             WHEN SQLCODE = -904                                  18450099
233100             WHEN SQLCODE = -913                                  18460099
233200                  CONTINUE                                        18470099
233300                                                                  18480099
233400             WHEN SQLWARN0 NOT EQUAL SPACE                        18490099
233500             WHEN SQLCODE NOT EQUAL ZERO                          18500099
233600                 DISPLAY '**************************************' 18510099
233700                 DISPLAY '** ABEND                            **' 18520099
233800                 DISPLAY '** PROGRAM = ICKUP161               **' 18530099
233900                 DISPLAY '** PARAGRAPH = 6010-GET-CHECKPOINT- **' 18540099
234000                 DISPLAY '**                  INFO            **' 18550099
234100                 DISPLAY '** SELECT FROM TCKRSTINF            **' 18560099
234200                 DISPLAY '**************************************' 18570099
234300                 PERFORM 9900-SQL-ABEND                           18580099
234400         END-EVALUATE                                             18590099
234500     END-PERFORM.                                                 18600099
234600                                                                  18610099
234700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    18620099
234800         SQLCODE NOT = ZERO                                       18630099
234900         DISPLAY '****************************************'       18640099
235000         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       18650099
235100         DISPLAY '** SELECT FROM TCKRSTINF              **'       18660099
235200         DISPLAY '** PARAGRAPH = 6010-GET-CHECKPOINT-INFO*'       18670099
235300         DISPLAY '****************************************'       18680099
235400         PERFORM 9900-SQL-ABEND                                   18690099
235500     END-IF.                                                      18700099
235600                                                                  18710099
235700 EJECT                                                            18720099
235800******************************************************************18730099
235900*    SET THE TIME FOR THE NEXT CHECKPOINT.                       *18740099
236000******************************************************************18750099
236100 6020-SET-COMMIT-TIME.                                            18760099
236200                                                                  18770099
236300      EXEC SQL                                                    18780099
236400          SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    18790099
236500          INTO :PV-HOLD-TMST                                      18800099
236600          FROM TCKRSTCNTL                                         18810099
236700          WHERE PLAN_NAME = :PC-PROGRAM-NAME                      18820099
236800      END-EXEC.                                                   18830099
236900                                                                  18840099
237000     EVALUATE TRUE                                                18850099
237100         WHEN SQLWARN0 NOT EQUAL SPACE                            18860099
237200         WHEN SQLCODE NOT EQUAL ZERO                              18870099
237300     DISPLAY '**********************************'                 18880099
237400     DISPLAY '** ABEND **'                                        18890099
237500     DISPLAY '** PROGRAM = ICKUP161 **'                           18900099
237600     DISPLAY '** PARAGRAPH = 6020-SET-COMMIT-TIME**'              18910099
237700     DISPLAY '**UNSUCESSFUL SET OF COMMIT INTERVAL**'             18920099
237800     DISPLAY 'TOTAL COMMITS          = ' PV-TOTAL-COMMITS         18930099
237900     DISPLAY '**********************************'                 18940099
238000                                                                  18950099
238100             PERFORM 9900-SQL-ABEND                               18960099
238200     END-EVALUATE.                                                18970099
238300                                                                  18980099
238400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    18990099
238500         SQLCODE NOT = ZERO                                       19000099
238600         DISPLAY '****************************************'       19010099
238700         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       19020099
238800         DISPLAY '** SELECT FROM TCKRSTCNTL             **'       19030099
238900         DISPLAY '** PARAGRAPH = 6020-SET-COMMIT-TIME   **'       19040099
239000         DISPLAY '****************************************'       19050099
239100         PERFORM 9900-SQL-ABEND                                   19060099
239200     END-IF.                                                      19070099
239300                                                                  19080099
239400 EJECT                                                            19090099
239500******************************************************************19100099
239600*    CHECK TO SEE IF A CHECKPOINT RESTART SHOULD BE DONE.        *19110099
239700******************************************************************19120099
239800 6110-CHECKPOINT-RESTART.                                         19130099
239900                                                                  19140099
240000     PERFORM 6010-GET-CHECKPOINT-INFO.                            19150099
240100     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     19160099
240200                                                                  19170099
240300     DISPLAY '***********************************************'.   19180099
240400     DISPLAY '** ICKUP161 CHECKPOINT RESTART **'.                 19190099
240500     DISPLAY '** IC COUNTS RECS BYPASSED ON RESTART = '.          19200099
240600     DISPLAY  CR-COUNTS-RECS-WORKED.                              19210099
240700     DISPLAY '***********************************************'.   19220099
240800                                                                  19230099
240900     IF INPUT-COUNTS-FILE                                         19240099
241000         PERFORM 2100-READ-INPUT-FILE                             19250099
241100             CR-COUNTS-RECS-WORKED TIMES                          19260099
241200                                                                  19270099
241300         MOVE CR-TOTAL-COMMITS         TO PV-TOTAL-COMMITS        19280099
241400         MOVE CR-INSERT-CNT-STAT       TO PV-INSERT-CNT-STAT      19290099
241500         MOVE CR-INSERT-CNT-SKU        TO PV-INSERT-CNT-SKU       19300099
241600         MOVE CR-SELECT-SKU-CNT        TO PV-SELECT-SKU-CNT       19310099
241700         MOVE CR-FS-REC-CNT            TO PV-FS-REC-CNT           19320099
241800         MOVE CR-PV-INPUT-CNT          TO PV-INPUT-CNT            19330099
241900                                                                  19340099
242000         MOVE CR-COUNTS-RECS-WORKED    TO PV-INPUT-CNT            19350099
242100     ELSE                                                         19360099
242200         MOVE CR-COUNTS-RECS-WORKED TO PV-INPUT-CNT               19370099
242300         SET PS-END-OF-FILE TO TRUE                               19380099
242400     END-IF.                                                      19390099
242500                                                                  19400099
242600 EJECT                                                            19410099
242700*MAM ********************                                         19420099
242800******************************************************************19430099
242900*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *19440099
243000*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *19450099
243100******************************************************************19460099
243200 6200-UPDATE-TCKRSTCNTL.                                          19470099
243300                                                                  19480099
243400     PERFORM WITH TEST AFTER                                      19490099
243500             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 19500099
243600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         19510099
243700                     SQLCODE = ZERO                               19520099
243800                                                                  19530099
243900         EXEC SQL                                                 19540099
244000             UPDATE TCKRSTCNTL                                    19550099
244100             SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE              19560099
244200             WHERE PLAN_NAME      = :PC-PROGRAM-NAME              19570099
244300               AND JOB_NAME       = :PC-JOB-NAME                  19580099
244400         END-EXEC                                                 19590099
244500                                                                  19600099
244600         EVALUATE TRUE                                            19610099
244700             WHEN SQLCODE = ZERO                                  19620099
244800             WHEN SQLCODE = -904                                  19630099
244900             WHEN SQLCODE = -913                                  19640099
245000                  CONTINUE                                        19650099
245100                                                                  19660099
245200             WHEN SQLWARN0 NOT EQUAL SPACE                        19670099
245300             WHEN SQLCODE NOT EQUAL ZERO                          19680099
245400                 DISPLAY '**************************************' 19690099
245500                 DISPLAY '** ABEND                            **' 19700099
245600                 DISPLAY '** PROGRAM = ICKUP161               **' 19710099
245700                 DISPLAY '** PARAGRAPH = 6200-UPDATE-TCKRSTCNTL*' 19720099
245800                 DISPLAY '** UPDATE TCKRSTCNTL                **' 19730099
245900                 DISPLAY '**' PV-CKPT-STAT-CODE                   19740099
246000                 DISPLAY '**************************************' 19750099
246100                 PERFORM 9900-SQL-ABEND                           19760099
246200         END-EVALUATE                                             19770099
246300     END-PERFORM.                                                 19780099
246400                                                                  19790099
246500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    19800099
246600         SQLCODE NOT = ZERO                                       19810099
246700         DISPLAY '****************************************'       19820099
246800         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       19830099
246900         DISPLAY '** UPDATE TO TCKRSTCNTL               **'       19840099
247000         DISPLAY '** PARAGRAPH = 6200-UPDATE-TCKRSTCNTL **'       19850099
247100         DISPLAY '**' PV-CKPT-STAT-CODE                           19860099
247200         DISPLAY '****************************************'       19870099
247300         PERFORM 9900-SQL-ABEND                                   19880099
247400     END-IF.                                                      19890099
247500                                                                  19900099
247600 EJECT                                                            19910099
247700******************************************************************19920099
247800*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *19930099
247900*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *19940099
248000*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *19950099
248100******************************************************************19960099
248200 6210-UPDATE-TCKRSTINF.                                           19970099
248300                                                                  19980099
248400*MAM MOVE PV-INPUT-CNT             TO CR-COUNTS-RECS-WORKED.      19990099
248500     MOVE PV-TOTAL-COMMITS         TO CR-TOTAL-COMMITS.           20000099
248600                                                                  20010099
248700     MOVE PV-INSERT-CNT-STAT       TO CR-INSERT-CNT-STAT.         20020099
248800     MOVE PV-INSERT-CNT-SKU        TO CR-INSERT-CNT-SKU.          20030099
248900     MOVE PV-SELECT-SKU-CNT        TO CR-SELECT-SKU-CNT.          20040099
249000     MOVE PV-FS-REC-CNT            TO CR-FS-REC-CNT.              20050099
249100     MOVE PV-INPUT-CNT             TO CR-PV-INPUT-CNT.            20060099
249200                                                                  20070099
249300                                                                  20080099
249400     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   20090099
249500     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.    20100099
249600                                                                  20110099
249700     PERFORM WITH TEST AFTER                                      20120099
249800             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 20130099
249900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         20140099
250000                     SQLCODE = ZERO                               20150099
250100                                                                  20160099
250200         EXEC SQL                                                 20170099
250300             UPDATE TCKRSTINF                                     20180099
250400             SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC     20190099
250500             WHERE PLAN_NAME      = :PC-PROGRAM-NAME              20200099
250600               AND JOB_NAME       = :PC-JOB-NAME                  20210099
250700         END-EXEC                                                 20220099
250800                                                                  20230099
250900         EVALUATE TRUE                                            20240099
251000             WHEN SQLCODE = ZERO                                  20250099
251100             WHEN SQLCODE = -904                                  20260099
251200             WHEN SQLCODE = -913                                  20270099
251300                  CONTINUE                                        20280099
251400                                                                  20290099
251500             WHEN SQLWARN0 NOT EQUAL SPACE                        20300099
251600             WHEN SQLCODE NOT EQUAL ZERO                          20310099
251700                 DISPLAY '**************************************' 20320099
251800                 DISPLAY '** ABEND                            **' 20330099
251900                 DISPLAY '** PROGRAM = ICKUP161               **' 20340099
252000                 DISPLAY '** PARAGRAPH = 6210-UPDATE-TCKRSTINF**' 20350099
252100                 DISPLAY '** UPDATE TCKRSTINF                 **' 20360099
252200                 DISPLAY '**' TCKRSTINF-WORK-STRG-DESC            20370099
252300                 DISPLAY '**************************************' 20380099
252400                 PERFORM 9900-SQL-ABEND                           20390099
252500         END-EVALUATE                                             20400099
252600     END-PERFORM.                                                 20410099
252700                                                                  20420099
252800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    20430099
252900         SQLCODE NOT = ZERO                                       20440099
253000         DISPLAY '****************************************'       20450099
253100         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       20460099
253200         DISPLAY '** UPDATE TCKRSTINF                   **'       20470099
253300         DISPLAY '** PARAGRAPH = 6210-UPDATE-TCKRSTINF  **'       20480099
253400         DISPLAY '**' TCKRSTINF-WORK-STRG-DESC                    20490099
253500         DISPLAY '****************************************'       20500099
253600         PERFORM 9900-SQL-ABEND                                   20510099
253700     END-IF.                                                      20520099
253800                                                                  20530099
253900 EJECT                                                            20540099
254000*----------------------------------------------------------       20550099
254100*  SELECT FROM XST_LOC TO GET A STORE TIMEZONE.                   20560099
254200*----------------------------------------------------------       20570099
254300 8500-SELECT-XST-LOC.                                             20580099
254400     MOVE '8400-XST-LOC' TO  PV-PARAGRAPH-NAME.                   20590099
254500                                                                  20600099
254600     EXEC SQL                                                     20610099
254700       SELECT                                                     20620099
254800            STD_TM_ZN_CDE                                         20630099
254900           ,DST_IND                                               20640099
255000         INTO                                                     20650099
255100            :XST00001-STD-TM-ZN-CDE                               20660099
255200           ,:XST00001-DST-IND                                     20670099
255300         FROM  XST_LOC                                            20680099
255400        WHERE  LOC_NBR   = :ICRD060-LOC-NBR                       20690099
255500*MAM    WHERE  LOC_NBR   = :ICT00020-LOC-NBR                      20700099
255600**MAM   WHERE  LOC_NBR   = :XST00001-LOC-NBR                      20710099
255700     END-EXEC.                                                    20720099
255800                                                                  20730099
255900     EVALUATE TRUE                                                20740099
256000        WHEN SQLCODE = 0                                          20750099
256100            CONTINUE                                              20760099
256200        WHEN OTHER                                                20770099
256300         DISPLAY '** ICKUP161 SELECT XST_LOC'                     20780099
256400                 ' HAD SQLCODE OF ' SQLCODE                       20790099
256500         PERFORM 9900-SQL-ABEND                                   20800099
256600     END-EVALUATE.                                                20810099
256700                                                                  20820099
256800******************************************************************20830099
256900     COPY ICPD010.                                                20840099
257000******************************************************************20850099
257100                                                                  20860099
257200*--------------------------------------------------------------*  20870099
257300* 9000-COMMIT.                                                    20880099
257400*--------------------------------------------------------------*  20890099
257500 9000-COMMIT.                                                     20900099
257600                                                                  20910099
257700     MOVE '9000-COMMIT' TO PV-PARAGRAPH-NAME.                     20920099
257800                                                                  20930099
257900     IF PS-FIRST-COMMIT                                           20940099
258000        MOVE '9'  TO TCKRSTCNTL-CKPT-STAT-CODE                    20950099
258100        PERFORM 6200-UPDATE-TCKRSTCNTL                            20960099
258200        MOVE 'N'  TO PS-FIRST-COMMIT-SW                           20970099
258300     END-IF.                                                      20980099
258400                                                                  20990099
258500     PERFORM 6210-UPDATE-TCKRSTINF.                               21000099
258501                                                                  21010099
258502     PERFORM                                                      21020099
258503         WITH TEST AFTER                                          21030099
258504         VARYING PV-NUMBER-OF-RETRIES                             21040099
258505         FROM 1 BY 1                                              21050099
258506         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       21060099
258507                OR SQLCODE = 0)                                   21070099
258508                                                                  21080099
258509         EXEC SQL                                                 21090099
258510             COMMIT                                               21100099
258511         END-EXEC                                                 21110099
258512                                                                  21120099
258513         EVALUATE TRUE                                            21130099
258514           WHEN SQLCODE = -904                                    21140099
258515           WHEN SQLCODE = -911                                    21150099
258516           WHEN SQLCODE = -913                                    21160099
258517             CONTINUE                                             21170099
258518           WHEN SQLCODE = 0                                       21180099
258519             MOVE ZERO TO PV-CNT-SINCE-COMMIT                     21190099
258520             ADD +1 TO PV-TOTAL-COMMITS                           21200099
258521           WHEN OTHER                                             21210099
258522             MOVE 'ERROR ON COMMMIT' TO                           21220099
258523                  PV-DB2-OPERATION                                21230099
258524             PERFORM 9900-SQL-ABEND                               21240099
258525         END-EVALUATE                                             21250099
258526     END-PERFORM.                                                 21260099
258527                                                                  21270099
258528     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               21280099
258529         MOVE 'COMMIT RETRIES EXCEEDED' TO PV-DB2-OPERATION       21290099
258530         PERFORM 9900-SQL-ABEND                                   21300099
258531     END-IF.                                                      21310099
258532                                                                  21320099
258533*--------------------------------------------------------------*  21330099
258534* 9900-SQL-ABEND.                                                 21340099
258535*     SQL ABEND ROUTINE.                                          21350099
258536*--------------------------------------------------------------*  21360099
258537 9900-SQL-ABEND.                                                  21370099
258538                                                                  21380099
258539     DISPLAY '** ABEND     **'.                                   21390099
258540     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                21400099
258541     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              21410099
258542     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               21420099
258543                                                                  21430099
258544     COPY DPPD004.                                                21440099
258545     SET ABEND-4013-DB2-ERROR TO TRUE.                            21450099
258546     CALL 'ILBOABN0' USING ABEND-CODE.                            21460099
258547                                                                  21470099
258548*9900-EXIT.                                                       21480099
258549                                                                  21490099
258550*--------------------------------------------------------------*  21500099
258551* 9999-WRAPUP.                                                    21510099
258552*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      21520099
258553*     DATA COUNTS FROM THE PROGRAM.                               21530099
258554*--------------------------------------------------------------*  21540099
258555 9999-WRAPUP.                                                     21550099
258556                                                                  21560099
258557     MOVE PV-INPUT-CNT TO CR-COUNTS-RECS-WORKED                   21570099
258558                          CR-PV-INPUT-CNT.                        21580099
258559     PERFORM 9000-COMMIT.                                         21590099
258560                                                                  21600099
258561     CLOSE ICRD060-COUNTS-FILE.                                   21610099
258562                                                                  21620099
258563     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              21630099
258564     PERFORM 6200-UPDATE-TCKRSTCNTL.                              21640099
258565                                                                  21650099
258566     DISPLAY '********************************************'.      21660099
258567     DISPLAY '**** SUMMARY OF PROGRAM ICKUP161         ***'.      21670099
258568     DISPLAY '********************************************'.      21680099
258569     DISPLAY 'TOTAL LOC CNT STAT INSERTS  :' PV-INSERT-CNT-STAT.  21690099
258570     DISPLAY 'TOTAL SKU LOC CNT  INSERTS  :' PV-INSERT-CNT-SKU.   21700099
258580     DISPLAY 'TOTAL INPUT RECORDS READ    :' PV-INPUT-CNT.        21710099
258590     DISPLAY 'TOTAL SKUS SELECTED         :' PV-SELECT-SKU-CNT.   21720099
258600     DISPLAY 'TOTAL FS RECORDS WRITTEN    :' PV-FS-REC-CNT.       21730099
258601     DISPLAY 'TOTAL COMMITS                ' PV-TOTAL-COMMITS.    21740099
258602     DISPLAY '********************************************'.      21750099
258603     DISPLAY '*********************************************'.     21760099
258604     DISPLAY '       END OF PROGRAM: ' PC-PROGRAM-NAME.           21770099
258605     DISPLAY '*********************************************'.     21780099
258606     DISPLAY ' '.                                                 21790099
258607                                                                  21800099
258608*9999-EXIT.                                                       21810099
258609                                                                  21820099
