000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      DPKUT031.                                       00020000
000300 AUTHOR.          CHET WROBLEWSKI.                                00030019
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
000500 DATE-WRITTEN.    04-30-2007.                                     00050000
000600***************************************************************** 00060000
000900*  PUT AN MQSERIES INCIDENT MESSAGE ONTO THE INCIDENT QUEUE TO  * 00090011
001000*  ALLOW NETCOOL TO CREATE A MESSAGE THAT WILL BE SENT TO       * 00100011
001010*  HAVE AN INCIDENT CREATED.  THE DEFAULT MESSAGE WILL          * 00101011
001020*  REFLECT A JOB FAILURE CONDITION.  ASSIGNMENT DETAILS         * 00102011
001030*  ARE OPTIONAL.  IF AN IMPACT, URGENCY AND ASSIGNMENT GROUP    * 00103011
001040*  ARE PROVIDED THEY WILL BE USED, OTHERWISE NETCOOL WILL       * 00104011
001050*  ASSIGN THE DEFAULTS.                                         * 00105011
001100***************************************************************** 00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 CONFIGURATION SECTION.                                           00130000
001400 SOURCE-COMPUTER.       IBM-3090.                                 00140000
001500 OBJECT-COMPUTER.       IBM-3090.                                 00150000
001600*                                                                 00160000
001700 INPUT-OUTPUT SECTION.                                            00170000
001800 FILE-CONTROL.                                                    00180000
001900     SELECT LOCAL-QMGR-FILE                                       00190000
002000            ASSIGN TO INP01.                                      00200000
002010     SELECT DEST-QMGR-FILE                                        00201000
002020            ASSIGN TO INP02.                                      00202000
002030     SELECT REQ-QUEUE-NAME-FILE                                   00203000
002040            ASSIGN TO INP03.                                      00204000
002041     SELECT ASSIGNMENT-DTL-FILE                                   00204101
002042            ASSIGN TO INP04.                                      00204201
002043     SELECT INCIDENT-DESC-FILE                                    00204313
002044            ASSIGN TO INP05.                                      00204413
002045     SELECT INCIDENT-IMAGE-FILE                                   00204522
002046            ASSIGN TO OUT01.                                      00204622
002050*                                                                 00205000
002060 DATA DIVISION.                                                   00206000
002070 FILE SECTION.                                                    00207000
002080*                                                                 00208000
002090 FD  LOCAL-QMGR-FILE                                              00209000
002100     RECORDING MODE F                                             00210000
002200     LABEL RECORDS ARE STANDARD                                   00220000
002300     BLOCK CONTAINS 0 RECORDS                                     00230000
002400     RECORD CONTAINS 80 CHARACTERS                                00240000
002500     DATA RECORD IS LQ-LOCAL-QMGR-RECORD.                         00250000
002600 01  LQ-LOCAL-QMGR-RECORD        PIC  X(80).                      00260000
002700*                                                                 00270000
002800 FD  DEST-QMGR-FILE                                               00280000
002900     RECORDING MODE F                                             00290000
002910     LABEL RECORDS ARE STANDARD                                   00291000
002920     BLOCK CONTAINS 0 RECORDS                                     00292000
002930     RECORD CONTAINS 80 CHARACTERS                                00293000
002940     DATA RECORD IS DQ-DEST-QMGR-RECORD.                          00294000
002950 01  DQ-DEST-QMGR-RECORD         PIC  X(80).                      00295000
002960*                                                                 00296000
002970 FD  REQ-QUEUE-NAME-FILE                                          00297000
002980     RECORDING MODE F                                             00298000
002990     LABEL RECORDS ARE STANDARD                                   00299000
002991     BLOCK CONTAINS 0 RECORDS                                     00299100
002992     RECORD CONTAINS 80 CHARACTERS                                00299200
002993     DATA RECORD IS RQ-REQ-QUEUE-NAME-RECORD.                     00299300
002994 01  RQ-REQ-QUEUE-NAME-RECORD    PIC  X(80).                      00299400
002995*                                                                 00299500
002996 FD  ASSIGNMENT-DTL-FILE                                          00299600
002997     RECORDING MODE F                                             00299700
002998     LABEL RECORDS ARE STANDARD                                   00299800
002999     BLOCK CONTAINS 0 RECORDS                                     00299900
003000     RECORD CONTAINS 80 CHARACTERS                                00300000
003001     DATA RECORD IS AD-ASSIGNMENT-DTL-RECORD.                     00300100
003002 01  AD-ASSIGNMENT-DTL-RECORD    PIC  X(80).                      00300200
003003*                                                                 00300313
003004 FD  INCIDENT-DESC-FILE                                           00300413
003005     RECORDING MODE F                                             00300513
003006     LABEL RECORDS ARE STANDARD                                   00300613
003007     BLOCK CONTAINS 0 RECORDS                                     00300713
003008     RECORD CONTAINS 80 CHARACTERS                                00300813
003009     DATA RECORD IS ID-INCIDENT-DESC-RECORD.                      00300913
003010 01  ID-INCIDENT-DESC-RECORD     PIC  X(80).                      00301013
003011*                                                                 00301122
003012 FD  INCIDENT-IMAGE-FILE                                          00301222
003013     RECORDING MODE F                                             00301322
003014     LABEL RECORDS ARE STANDARD                                   00301422
003015     BLOCK CONTAINS 0 RECORDS                                     00301522
003016     RECORD CONTAINS 350 CHARACTERS                               00301626
003017     DATA RECORD IS II-INCIDENT-IMAGE-RECORD.                     00301722
003018 01  II-INCIDENT-IMAGE-RECORD    PIC  X(350).                     00301826
003019                                                                  00301922
003020 WORKING-STORAGE SECTION.                                         00302022
003021                                                                  00302122
003022 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          00302222
003023                                              COMP SYNC.          00302322
003030     88  AC-CONTROL-CARD-ERROR                VALUE +4003.        00303022
003100     88  AC-MQ-ERROR                          VALUE +4020.        00310000
003200                                                                  00320000
003300 01  WS-MQCONN               PIC X(8)  VALUE 'CSQBCONN'.          00330000
003400*01  WS-MQOPEN               PIC X(8)  VALUE 'CSQBOPEN'.          00340000
003500*01  WS-MQINQ                PIC X(8)  VALUE 'CSQBINQ'.           00350000
003600*01  WS-MQPUT                PIC X(8)  VALUE 'CSQBPUT'.           00360000
003700 01  WS-MQPUT1               PIC X(8)  VALUE 'CSQBPUT1'.          00370000
003800*01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQBCLOS'.          00380000
003900 01  WS-MQDISC               PIC X(8)  VALUE 'CSQBDISC'.          00390000
004000 01  WS-MQCHECK              PIC X(8)  VALUE 'MQR2C'.             00400000
004100                                                                  00410000
004200                                                                  00420000
004300*   Parameter variables                                           00430000
004400                                                                  00440000
004500 01  QM-NAME               PIC X(48).                             00450000
004600 01  QNAME                 PIC X(48).                             00460000
004700 01  PADCHAR               PIC X(1) VALUE '*'.                    00470000
004800 01  MSGBUFFER.                                                   00480000
004900   02  MSGBUFFER-ARRAY     PIC X(1) OCCURS 65535 TIMES.           00490000
005000 01  NUMMSGS-CHAR          PIC X(4) VALUE SPACES.                 00500000
005100 01  NUMMSGS               PIC S9(9) BINARY VALUE 1.              00510000
005200 01  MSGLENGTH-CHAR        PIC X(4) VALUE SPACES.                 00520000
005300 01  MSGLENGTH             PIC S9(9) BINARY VALUE 200.            00530000
005400 01  SELECT-COUNT1         PIC S9(9) BINARY VALUE 3.              00540000
005500 01  SELECTOR-TABLE1.                                             00550000
005600   02  SELECTOR1           PIC S9(9) BINARY OCCURS 3 TIMES.       00560000
005700 01  INT-ATTR-COUNT1       PIC S9(9) BINARY VALUE 1.              00570000
005800 01  INT-ATTR-TABLE1.                                             00580000
005900   02  INT-ATTR1           PIC S9(9) BINARY OCCURS 1 TIMES.       00590000
006000 01  CHAR-ATTR-LENGTH1     PIC S9(9) BINARY VALUE 112.            00600000
006100 01  CHAR-ATTRS1           PIC X(112).                            00610000
006200 01  SELECT-COUNT2         PIC S9(9) BINARY VALUE 3.              00620000
006300 01  SELECTOR-TABLE2.                                             00630000
006400   02  SELECTOR2           PIC S9(9) BINARY OCCURS 3 TIMES.       00640000
006500 01  INT-ATTR-COUNT2       PIC S9(9) BINARY VALUE 2.              00650000
006600 01  INT-ATTR-TABLE2.                                             00660000
006700   02  INT-ATTR2           PIC S9(9) BINARY OCCURS 2 TIMES.       00670000
006800 01  CHAR-ATTR-LENGTH2     PIC S9(9) BINARY VALUE 64.             00680000
006900 01  CHAR-ATTRS2           PIC X(64).                             00690000
007000                                                                  00700000
007100 01  PROGRAM-VARIABLES.                                           00710000
007200   05  HCONN               PIC S9(9) BINARY VALUE 0.              00720000
007300*                                                                 00730000
007400*    API fields                                                   00740000
007500*                                                                 00750000
007600*01  HCONN                   PIC S9(9) BINARY VALUE 0.            00760000
007700 01  PQ-HANDLE               PIC S9(9) BINARY VALUE 0.            00770000
007800 01  OPEN-OPTIONS            PIC S9(9) BINARY.                    00780000
007900 01  COMPLETION-CODE         PIC S9(9) BINARY.                    00790000
008000 01  REASON                  PIC S9(9) BINARY.                    00800000
008100 01  CON-REASON              PIC S9(9) BINARY.                    00810000
008200*                                                                 00820000
008300*    API control blocks                                           00830000
008400*                                                                 00840000
008500 01  MQM-OBJECT-DESCRIPTOR.                                       00850000
008600     COPY CMQODV.                                                 00860000
008700 01  MQM-MESSAGE-DESCRIPTOR.                                      00870000
008800     COPY CMQMDV.                                                 00880000
008900 01  MQM-PUT-MESSAGE-OPTIONS.                                     00890000
009000     COPY CMQPMOV.                                                00900000
009100*                                                                 00910000
009200*    MQV contains constants (for filling in the control blocks)   00920000
009300*    and return codes (for testing the result of a call)          00930000
009400*                                                                 00940000
009500 01  MQM-CONSTANTS.                                               00950000
009600     COPY CMQV.                                                   00960000
009700*----------------------------------------------------------------*00970000
009800*    CONTROL CARD 1 - LOCAL QUEUE MANAGER NAME                    00980000
009900*----------------------------------------------------------------*00990000
010000 01  CC-CONTROL-CARD-1.                                           01000000
010100     05  CC-LOCAL-QMGR           PIC X(48)    VALUE SPACES.       01010021
010200     05  FILLER                  PIC X(32)    VALUE SPACES.       01020021
010300                                                                  01030000
010400*----------------------------------------------------------------*01040000
010500*    CONTROL CARD 2 - DESTINATION QUEUE MANAGER NAME              01050000
010600*----------------------------------------------------------------*01060000
010700 01  CC-CONTROL-CARD-2.                                           01070000
010800     05  CC-DEST-QMGR            PIC X(48)    VALUE SPACES.       01080021
010810     05  FILLER                  PIC X(32)    VALUE SPACES.       01081021
011000                                                                  01100000
011100*----------------------------------------------------------------*01110000
011200*    CONTROL CARD 3 - DESTINATION QUEUE NAME                      01120000
011210*----------------------------------------------------------------*01121000
011220 01  CC-CONTROL-CARD-3.                                           01122000
011230     05  CC-REQUEST-QUEUE-NAME   PIC X(48)    VALUE SPACES.       01123021
011231     05  FILLER                  PIC X(32)    VALUE SPACES.       01123121
011250                                                                  01125000
011260*----------------------------------------------------------------*01126000
011270*    PROGRAM CONSTANTS                                            01127000
011280*----------------------------------------------------------------*01128000
011290 01  PC-PROGRAM-CONSTANTS.                                        01129000
011300     05  PC-PROGRAM-NAME         PIC X(8)     VALUE 'DPKUT031'.   01130021
011401     05  PC-RC-OVERDUE           PIC X(12)    VALUE 'OVERDUE'.    01140121
011402     05  PC-RC-ADHOC             PIC X(12)    VALUE 'ADHOC'.      01140221
011410     05  PC-COMPUTER-TYPE        PIC X(7)     VALUE 'TYPE=MF'.    01141021
011500     05  PC-COMPUTER-SRC         PIC X(4)     VALUE 'SRC='.       01150021
011600     05  PC-JOB-NAME             PIC X(6)     VALUE 'PRGNM='.     01160021
011700     05  PC-JOB-STEP             PIC X(6)     VALUE 'STPNM='.     01170021
011800     05  PC-JOB-NUMBER           PIC X(6)     VALUE 'JBNBR='.     01180021
011900     05  PC-JOB-RC               PIC X(6)     VALUE 'RTNCD='.     01190021
012000     05  PC-JOB-DATE             PIC X(4)     VALUE 'DAY='.       01200021
012100     05  PC-JOB-TIME             PIC X(5)     VALUE 'TIME='.      01210021
012110     05  PC-NOT-APPLICABLE       PIC X(3)     VALUE 'N/A'.        01211021
012200     05  PC-FAILURE-DESC         PIC X(20)    VALUE               01220021
012300         'DESC=JOB/SYS/FAILURE'.                                  01230000
012310     05  PC-OVERDUE-DESC         PIC X(20)    VALUE               01231021
012320         'DESC=OVERDUE'.                                          01232003
012330     05  PC-ADHOC-DESC           PIC X(5)     VALUE 'DESC='.      01233021
012400     05  PC-IMPACT               PIC X(4)     VALUE 'IMP='.       01240021
012500     05  PC-URGENCY              PIC X(4)     VALUE 'URG='.       01250021
012600     05  PC-ASSIGNMENT-GROUP     PIC X(4)     VALUE 'GRP='.       01260021
012700     05  PC-ASSIGNMENT-PARM-COUNT                                 01270021
012710                                 PIC S9(4)    VALUE +3            01271021
012720                                              COMP SYNC.          01272021
012800                                                                  01280000
012900*----------------------------------------------------------------*01290000
013000*    PROGRAM VARIABLES                                            01300000
013010*----------------------------------------------------------------*01301000
013020 01  PV-PROGRAM-VARIABLES.                                        01302000
013021     05  PV-CURRENT-DATE-JULIAN  PIC 9(5)     VALUE ZEROS.        01302119
013022     05  PV-CURRENT-DATE         PIC X(8)     VALUE SPACES.       01302219
013023     05  FILLER                  REDEFINES PV-CURRENT-DATE.       01302319
013024         10  PV-CD-YEAR          PIC 9(4).                        01302419
013025         10  PV-CD-MONTH         PIC 9(2).                        01302519
013026         10  PV-CD-DAY           PIC 9(2).                        01302619
013027     05  PV-CURRENT-INCIDENT-TIME.                                01302720
013028         10  PV-CI-HOUR          PIC 9(2)     VALUE ZEROS.        01302821
013029         10  FILLER              PIC X(1)     VALUE ':'.          01302920
013030         10  PV-CI-MINUTE        PIC 9(2)     VALUE ZEROS.        01303021
013031         10  FILLER              PIC X(1)     VALUE ':'.          01303120
013032         10  PV-CI-SECOND        PIC 9(2)     VALUE ZEROS.        01303221
013033         10  FILLER              PIC X(1)     VALUE '.'.          01303320
013034         10  PV-CI-SECOND-HUNDREDTHS                              01303420
013035                                 PIC 9(2)     VALUE ZEROS.        01303521
013036     05  PV-CURRENT-TIME.                                         01303620
013037         10  PV-CT-HOUR          PIC 9(2)     VALUE ZEROS.        01303721
013038         10  PV-CT-MINUTE        PIC 9(2)     VALUE ZEROS.        01303821
013039         10  PV-CT-SECOND        PIC 9(2)     VALUE ZEROS.        01303921
013041         10  PV-CT-SECOND-HUNDREDTHS                              01304120
013042                                 PIC 9(2)     VALUE ZEROS.        01304221
013043     05  PV-INCIDENT-TYPE-TRUNC  PIC X(10)    VALUE SPACES.       01304322
013044     05  PV-ASSIGNMENT-DTL-RECORD                                 01304422
013045                                 PIC X(80)    VALUE SPACES.       01304522
013046     05  PV-INCIDENT-DESC-RECORD PIC X(80)    VALUE SPACES.       01304622
013047         88  PV-ID-NO-ADHOC-INC-DESC          VALUE               01304722
013048             'NO ADHOC INCIDENT DESCRIPTION SPECIFIED'.           01304822
013049     05  PV-DESC                 PIC X(45)    VALUE SPACES.       01304922
013050     05  PV-MSG-TEXT             PIC X(250)   VALUE SPACES.       01305022
013051     05  PV-MSG-TEXT-BASE        PIC X(250)   VALUE SPACES.       01305122
013052     05  PV-MQ-PUT-COUNT         PIC S9(9)    VALUE ZEROS         01305222
013053                                              COMP SYNC.          01305322
013060     05  PV-ERROR-MESSAGE        PIC X(48)    VALUE SPACES.       01306021
013070     05  PV-MQ-TEXT-REASON       PIC X(30)    VALUE SPACES.       01307021
013080     05  PV-PARM-POINTER         PIC S9(9)    VALUE ZEROS         01308021
013081                                              COMP SYNC.          01308121
013090     05  PV-PARM-TALLY           PIC S9(9)    VALUE ZEROS         01309021
013091                                              COMP SYNC.          01309121
013092     05  PV-OVERFLOW-DETAILS     PIC X(100)   VALUE SPACES.       01309221
013093     05  PV-ASSIGN-DETAILS       PIC X(80)    VALUE SPACES.       01309321
013094*                                                                 01309400
013095*    PARM STRING PASSED FROM JCL EXEC WITH "," DELIMITERS         01309500
013096*    MAXIMUM PARM THAT CAN BE PASSED FROM JCL IS 100 CHARACTERS   01309600
013097*                                                                 01309700
013098     05  PV-PARM-STRING          PIC X(100)   VALUE SPACES.       01309821
013099     05  PV-PARM-FIELDS.                                          01309900
013100         10 PV-PARM-SYSNAME      PIC X(8)     VALUE SPACES.       01310021
013101         10 PV-PARM-M3           PIC X(17)    VALUE SPACES.       01310121
013102         10 PV-PARM-M4           PIC X(10)    VALUE SPACES.       01310221
013103         10 PV-PARM-M5           PIC X(10)    VALUE SPACES.       01310321
013104         10 PV-PARM-M6           PIC X(40)    VALUE SPACES.       01310421
013105         10 PV-PARM-IMP          PIC X(5)     VALUE SPACES.       01310521
013106         10 PV-PARM-URG          PIC X(5)     VALUE SPACES.       01310621
013107         10 PV-PARM-GRP          PIC X(70)    VALUE SPACES.       01310721
013108                                                                  01310800
013109*----------------------------------------------------------------*01310900
013110*    PROGRAM SWITCHES                                             01311000
013111*----------------------------------------------------------------*01311100
013112 01  PS-PROGRAM-SWITCHES.                                         01311200
013120     05  PS-END-OF-LQM-FILE-SW   PIC X(1)     VALUE 'N'.          01312000
013130         88  PS-END-OF-LQM-FILE               VALUE 'Y'.          01313000
013140     05  PS-END-OF-DQM-FILE-SW   PIC X(1)     VALUE 'N'.          01314000
013150         88  PS-END-OF-DQM-FILE               VALUE 'Y'.          01315000
013160     05  PS-END-OF-RQN-FILE-SW   PIC X(1)     VALUE 'N'.          01316000
013170         88  PS-END-OF-RQN-FILE               VALUE 'Y'.          01317000
013171     05  PS-END-OF-ASSIGN-DTL-FILE-SW                             01317100
013172                                 PIC X(1)     VALUE 'N'.          01317200
013173         88  PS-END-OF-ASSIGN-DTL-FILE        VALUE 'Y'.          01317300
013174     05  PS-END-OF-INC-DESC-FILE-SW                               01317413
013175                                 PIC X(1)     VALUE 'N'.          01317513
013176         88  PS-END-OF-INC-DESC-FILE          VALUE 'Y'.          01317613
013180     05  PS-PARM-OVERFLOW-SW     PIC X(1)     VALUE 'N'.          01318000
013190         88  PS-PARM-OVERFLOW                 VALUE 'Y'.          01319000
013200         88  PS-NO-PARM-OVERFLOW              VALUE 'N'.          01320000
014600                                                                  01460000
014700*                                                                 01470000
014800 LINKAGE SECTION.                                                 01480000
014900 01  LS-PARAMETER-LIST.                                           01490000
015000     05  LS-PARM-LENGTH          PIC S9(4) COMP.                  01500021
015100     05  LS-PARM-VALUES          PIC X(256).                      01510021
015200*                                                                 01520000
015300 PROCEDURE DIVISION USING LS-PARAMETER-LIST.                      01530000
015400 0000-MAINLINE.                                                   01540000
015500     PERFORM 1000-INITIALIZE.                                     01550000
015600                                                                  01560000
015700* ------------------------------------------- *                   01570000
015800*    CONNECT TO THE QUEUE MANAGER                                 01580019
015900* ------------------------------------------- *                   01590000
016000     MOVE CC-LOCAL-QMGR TO QM-NAME.                               01600000
016100     CALL WS-MQCONN USING QM-NAME                                 01610000
016200                         HCONN                                    01620000
016300                         COMPLETION-CODE                          01630000
016400                         REASON.                                  01640000
016500*                                                                 01650000
016600*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              01660019
016700*    AND EXIT                                                     01670019
016800*                                                                 01680000
016900     MOVE REASON TO CON-REASON.                                   01690000
017000     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      01700000
017100        MOVE 'MQCONN ERROR'   TO PV-ERROR-MESSAGE                 01710000
017200        SET AC-MQ-ERROR TO TRUE                                   01720000
017300        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        01730000
017400     ELSE                                                         01740000
017500        DISPLAY PC-PROGRAM-NAME 'MQCONN SUCCESSFUL TO ' QM-NAME   01750019
017600     END-IF.                                                      01760000
017700                                                                  01770000
017800* -------------------------------------- *                        01780000
017900*    WRITE THE MESSAGE TO THE QUEUE                               01790000
018000* -------------------------------------- *                        01800000
018100     PERFORM 2000-MQPUT-MSG.                                      01810000
018200*                                                                 01820000
018300     PERFORM 3000-DISCONNECT-QMGR.                                01830000
018400*                                                                 01840000
018500* DISPLAY THE NUMBER OF MESSAGES SUCCESSFULLY PUT TO THE QUEUE    01850019
018700*                                                                 01870000
018800     DISPLAY PV-MQ-PUT-COUNT  ' MESSAGES PUT TO QUEUE'.           01880000
018900*                                                                 01890000
018910     PERFORM 8000-WRITE-INCIDENT-IMAGE.                           01891023
018920*                                                                 01892023
019000     PERFORM 9100-EOJ-ROUTINE.                                    01900000
019100     STOP RUN.                                                    01910000
019200                                                                  01920000
019300* ------------------------------------------------------------- * 01930000
019400*                                                                 01940000
019500* ------------------------------------------------------------- * 01950000
019600 1000-INITIALIZE.                                                 01960000
019700                                                                  01970000
019800     ACCEPT PV-CURRENT-DATE-JULIAN FROM DAY.                      01980019
019910     MOVE FUNCTION CURRENT-DATE (1:4) TO PV-CD-YEAR.              01991019
019920     MOVE FUNCTION CURRENT-DATE (5:2) TO PV-CD-MONTH.             01992019
019930     MOVE FUNCTION CURRENT-DATE (7:2) TO PV-CD-DAY.               01993019
019940     MOVE FUNCTION CURRENT-DATE (9:2) TO PV-CI-HOUR               01994020
019941                                         PV-CT-HOUR.              01994120
019950     MOVE FUNCTION CURRENT-DATE (11:2) TO PV-CI-MINUTE            01995020
019951                                          PV-CT-MINUTE.           01995120
019960     MOVE FUNCTION CURRENT-DATE (13:2) TO PV-CI-SECOND            01996020
019961                                          PV-CT-SECOND.           01996120
019970     MOVE FUNCTION CURRENT-DATE (15:2) TO PV-CI-SECOND-HUNDREDTHS 01997020
019980                                          PV-CT-SECOND-HUNDREDTHS.01998020
020000                                                                  02000000
020100* ---------------------------------------------------- *          02010000
020200*    DISPLAY PARMS PASSED FROM PITSOPN PROCEDURE                  02020000
020300* ---------------------------------------------------- *          02030000
020400     IF LS-PARM-LENGTH > ZEROES                                   02040000
020500         MOVE LS-PARM-VALUES(1:LS-PARM-LENGTH) TO PV-PARM-STRING  02050000
020600         DISPLAY PC-PROGRAM-NAME ' - PARMS="'                     02060019
020700                   LS-PARM-VALUES(1:LS-PARM-LENGTH) '"'           02070000
020800         IF PV-PARM-STRING = SPACES                               02080000
020900             DISPLAY PC-PROGRAM-NAME ' - BLANK PARMS PASSED'      02090019
021000             SET AC-CONTROL-CARD-ERROR TO TRUE                    02100000
021100             PERFORM 9000-DISPLAY-ERROR-MESSAGE                   02110000
021200         END-IF                                                   02120000
021300     ELSE                                                         02130000
021400         DISPLAY PC-PROGRAM-NAME ' - NO PARMS PASSED'             02140019
021500         SET AC-CONTROL-CARD-ERROR TO TRUE                        02150000
021600         PERFORM 9000-DISPLAY-ERROR-MESSAGE                       02160000
021700     END-IF.                                                      02170000
021800                                                                  02180000
021900     INITIALIZE PV-PARM-FIELDS                                    02190000
022000                PV-ASSIGN-DETAILS.                                02200000
022100     MOVE +1 TO PV-PARM-POINTER.                                  02210000
022110     SET PS-NO-PARM-OVERFLOW TO TRUE.                             02211000
022200     UNSTRING PV-PARM-STRING                                      02220000
022300         DELIMITED BY ","                                         02230000
022400         INTO PV-PARM-SYSNAME                                     02240000
022500              PV-PARM-M3                                          02250000
022600              PV-PARM-M4                                          02260000
022700              PV-PARM-M5                                          02270000
022800              PV-PARM-M6                                          02280000
022900         WITH POINTER PV-PARM-POINTER                             02290000
023000         ON OVERFLOW SET PS-PARM-OVERFLOW TO TRUE                 02300000
023100     END-UNSTRING.                                                02310000
023101                                                                  02310100
023110     IF (PS-PARM-OVERFLOW)                                        02311000
023120         MOVE LS-PARM-VALUES (PV-PARM-POINTER:                    02312000
023121                   (LS-PARM-LENGTH - PV-PARM-POINTER + 1)) TO     02312100
023122             PV-OVERFLOW-DETAILS                                  02312200
023130         DISPLAY PC-PROGRAM-NAME ' - OVERFLOW ERROR'              02313019
023140         DISPLAY PC-PROGRAM-NAME ' -     CURRENT POINTER = '      02314019
023150                   PV-PARM-POINTER                                02315000
023160         DISPLAY PC-PROGRAM-NAME ' -     OVERFLOW DETAILS = '     02316019
023170                   PV-OVERFLOW-DETAILS                            02317000
023193         SET AC-CONTROL-CARD-ERROR TO TRUE                        02319300
023194         PERFORM 9000-DISPLAY-ERROR-MESSAGE                       02319400
023195     END-IF.                                                      02319500
026700                                                                  02670000
026800     OPEN INPUT  LOCAL-QMGR-FILE                                  02680022
026900                 DEST-QMGR-FILE                                   02690022
027010                 REQ-QUEUE-NAME-FILE                              02701022
027020                 ASSIGNMENT-DTL-FILE                              02702022
027030                 INCIDENT-DESC-FILE                               02703022
027040          OUTPUT INCIDENT-IMAGE-FILE.                             02704022
027100                                                                  02710000
027200     PERFORM 7000-READ-LOCAL-QMGR-FILE.                           02720000
027300                                                                  02730000
027400     IF ((PS-END-OF-LQM-FILE)                                     02740000
027500             OR (CC-LOCAL-QMGR = SPACES))                         02750000
027600         DISPLAY PC-PROGRAM-NAME ' - LOCAL QUEUE MANAGER NAME '   02760019
027700                   'CONTROL CARD MISSING'                         02770000
027800         SET AC-CONTROL-CARD-ERROR TO TRUE                        02780000
027900         PERFORM 9000-DISPLAY-ERROR-MESSAGE                       02790000
028000     ELSE                                                         02800000
028100         DISPLAY PC-PROGRAM-NAME ' - LOCAL QUEUE MANAGER NAME = ' 02810019
028200                   CC-LOCAL-QMGR                                  02820000
028300     END-IF.                                                      02830000
028400                                                                  02840000
028500     PERFORM 7100-READ-DEST-QMGR-FILE.                            02850000
028600                                                                  02860000
028700     IF ((PS-END-OF-DQM-FILE)                                     02870000
028800             OR (CC-DEST-QMGR = SPACES))                          02880000
028810         DISPLAY PC-PROGRAM-NAME ' - DESTINATION QUEUE MANAGER '  02881019
028820                   'NAME CONTROL CARD MISSING'                    02882019
028821         SET AC-CONTROL-CARD-ERROR TO TRUE                        02882100
028822         PERFORM 9000-DISPLAY-ERROR-MESSAGE                       02882200
028823     ELSE                                                         02882300
028824         DISPLAY PC-PROGRAM-NAME ' - DESTINATION QUEUE MANAGER '  02882419
028825                   'NAME = '  CC-DEST-QMGR                        02882519
028826     END-IF.                                                      02882600
028827                                                                  02882700
028828     PERFORM 7200-READ-REQ-QUEUE-NAME-FILE.                       02882800
028829                                                                  02882900
028830     IF ((PS-END-OF-RQN-FILE)                                     02883000
028831             OR (CC-REQUEST-QUEUE-NAME = SPACES))                 02883100
028832         DISPLAY PC-PROGRAM-NAME ' - REQUEST QUEUE NAME '         02883219
028833                   'CONTROL CARD MISSING'                         02883300
028834         SET AC-CONTROL-CARD-ERROR TO TRUE                        02883400
028835         PERFORM 9000-DISPLAY-ERROR-MESSAGE                       02883500
028836     ELSE                                                         02883600
028837         DISPLAY PC-PROGRAM-NAME ' - REQUEST QUEUE NAME = '       02883719
028838                   CC-REQUEST-QUEUE-NAME                          02883800
028839     END-IF.                                                      02883900
028840                                                                  02884000
028841     PERFORM 7300-READ-ASSIGNMENT-DTL-FILE.                       02884100
028842                                                                  02884200
028843     IF ((PS-END-OF-ASSIGN-DTL-FILE)                              02884302
028844             OR (PV-ASSIGNMENT-DTL-RECORD = SPACES))              02884402
028845         DISPLAY PC-PROGRAM-NAME ' - NO ASSIGNMENT DETAILS '      02884519
028846                   'SPECIFIED'                                    02884619
028849     ELSE                                                         02884900
028850         PERFORM 1100-GET-ASSIGNMENT-DETAILS                      02885001
028852     END-IF.                                                      02885200
028853                                                                  02885313
028854     PERFORM 7400-READ-INCIDENT-DESC-FILE.                        02885413
028855                                                                  02885513
028856     IF ((PS-END-OF-INC-DESC-FILE)                                02885613
028857             OR (PV-INCIDENT-DESC-RECORD = SPACES))               02885713
028858         DISPLAY PC-PROGRAM-NAME ' - NO INCIDENT DESCRIPTION '    02885819
028859                   'SPECIFIED'                                    02885913
028860     ELSE                                                         02886013
028861         DISPLAY PC-PROGRAM-NAME ' - OPTIONAL INCIDENT '          02886119
028862                   'DESCRIPTION SPECIFIED = '                     02886219
028863                   PV-INCIDENT-DESC-RECORD                        02886319
028864     END-IF.                                                      02886413
028865                                                                  02886513
028866     MOVE PC-FAILURE-DESC TO PV-DESC.                             02886613
028867                                                                  02886713
028868     IF (PV-PARM-M6 = PC-RC-OVERDUE)                              02886813
028869         MOVE PC-NOT-APPLICABLE TO PV-PARM-M4                     02886913
028870                                   PV-PARM-M5                     02887013
028871         MOVE PC-OVERDUE-DESC TO PV-DESC                          02887113
028872         DISPLAY PC-PROGRAM-NAME ' - OVERDUE INCIDENT '           02887219
028873                   'DESCRIPTION USED'                             02887319
028874     ELSE                                                         02887413
028875         IF (PV-PARM-M6 = PC-RC-ADHOC)                            02887513
028876             MOVE PC-NOT-APPLICABLE TO PV-PARM-M4                 02887613
028877                                       PV-PARM-M5                 02887713
028878             IF (PV-INCIDENT-DESC-RECORD = SPACES)                02887813
028879                SET PV-ID-NO-ADHOC-INC-DESC TO TRUE               02887913
028880                DISPLAY PC-PROGRAM-NAME ' - REQUIRED ADHOC '      02888019
028881                          'INCIDENT DESCRIPTION WAS NOT SPECIFIED'02888119
028882             ELSE                                                 02888215
028883                DISPLAY PC-PROGRAM-NAME ' - ADHOC INCIDENT '      02888319
028884                          'DESCRIPTION USED'                      02888415
028885             END-IF                                               02888513
028886             INITIALIZE PV-DESC                                   02888613
028887             STRING PC-ADHOC-DESC             DELIMITED BY SIZE   02888713
028888                    PV-INCIDENT-DESC-RECORD   DELIMITED BY '  '   02888813
028889                 INTO PV-DESC                                     02888913
028890         END-IF                                                   02889013
028891     END-IF.                                                      02889113
028893                                                                  02889315
028894     STRING PC-COMPUTER-TYPE                                      02889419
028895            ';'                                                   02889519
028896            PC-COMPUTER-SRC                                       02889615
028897            PV-PARM-SYSNAME                                       02889719
028898            ';'                                                   02889819
028899            PC-JOB-NAME                                           02889915
028900            PV-PARM-M3                                            02890019
028901            ';'                                                   02890119
028902            PC-JOB-STEP                                           02890215
028903            PV-PARM-M4                                            02890319
028904            ';'                                                   02890419
028905            PC-JOB-NUMBER                                         02890515
028906            PV-PARM-M5                                            02890619
028907            ';'                                                   02890719
028908            PC-JOB-RC                                             02890815
028909            PV-PARM-M6                                            02890919
028910            ';'                                                   02891019
028911            PC-JOB-DATE                                           02891115
028912            PV-CURRENT-DATE-JULIAN                                02891219
028913            ';'                                                   02891319
028914            PC-JOB-TIME                                           02891415
028915            PV-CURRENT-INCIDENT-TIME                              02891520
028925            ';'                                                   02892519
028926            PV-DESC                 DELIMITED BY '  '             02892619
028927         INTO PV-MSG-TEXT.                                        02892715
028928                                                                  02892816
028929     IF (PV-PARM-IMP NOT = SPACES)                                02892915
028930         MOVE PV-MSG-TEXT TO PV-MSG-TEXT-BASE                     02893015
028931         INITIALIZE PV-MSG-TEXT                                   02893115
028932         STRING PV-MSG-TEXT-BASE    DELIMITED BY '  '             02893217
028933                ';'                 DELIMITED BY SIZE             02893317
028934                PC-IMPACT           DELIMITED BY SIZE             02893417
028935                PV-PARM-IMP         DELIMITED BY SPACE            02893517
028936                ';'                 DELIMITED BY SIZE             02893617
028937                PC-URGENCY          DELIMITED BY SIZE             02893717
028938                PV-PARM-URG         DELIMITED BY SPACE            02893817
028939                ';'                 DELIMITED BY SIZE             02893917
028940                PC-ASSIGNMENT-GROUP DELIMITED BY SIZE             02894017
028941                PV-PARM-GRP         DELIMITED BY '  '             02894115
028942             INTO PV-MSG-TEXT                                     02894215
028943     END-IF.                                                      02894315
028944     DISPLAY PC-PROGRAM-NAME ' - MESSAGE="' PV-MSG-TEXT '"'.      02894419
028945                                                                  02894515
028946* ------------------------------------------------------------- * 02894615
028947* GET THE INCIDENT ASSIGNMENT DETAILS, WHEN PROVIDED              02894715
028948* ------------------------------------------------------------- * 02894815
028949 1100-GET-ASSIGNMENT-DETAILS.                                     02894915
028950     DISPLAY PC-PROGRAM-NAME ' - OPTIONAL ASSIGNMENT DETAIL '     02895019
028951               'SPECIFIED = ' PV-ASSIGNMENT-DTL-RECORD.           02895115
028952                                                                  02895215
028953     SET PS-NO-PARM-OVERFLOW TO TRUE.                             02895315
028954     INITIALIZE PV-PARM-TALLY.                                    02895415
028955     UNSTRING PV-ASSIGNMENT-DTL-RECORD                            02895515
028956         DELIMITED BY ","                                         02895615
028957         INTO PV-PARM-IMP                                         02895715
028958              PV-PARM-URG                                         02895815
028959              PV-PARM-GRP                                         02895915
028960         TALLYING IN PV-PARM-TALLY                                02896015
028961         ON OVERFLOW SET PS-PARM-OVERFLOW TO TRUE                 02896115
028962     END-UNSTRING.                                                02896215
028963                                                                  02896315
028964     DISPLAY PC-PROGRAM-NAME ' - PARSED ASSIGNMENT DETAILS'.      02896419
028965     DISPLAY PC-PROGRAM-NAME ' -     IMPACT = ' PV-PARM-IMP.      02896519
028966     DISPLAY PC-PROGRAM-NAME ' -     URGENCY = ' PV-PARM-URG.     02896619
028967     DISPLAY PC-PROGRAM-NAME ' -     ASSIGNMENT GROUP = '         02896719
028968               PV-PARM-GRP.                                       02896815
028969                                                                  02896915
028970     IF ((PV-PARM-TALLY NOT = PC-ASSIGNMENT-PARM-COUNT) OR        02897015
028971             (PS-PARM-OVERFLOW))                                  02897115
028972         DISPLAY PC-PROGRAM-NAME ' - ASSIGNMENT DETAILS ERROR'    02897219
028973         DISPLAY PC-PROGRAM-NAME ' -     FIELD COUNT TALLY = '    02897319
028974                   PV-PARM-TALLY                                  02897415
028975         DISPLAY PC-PROGRAM-NAME ' -     OVERFLOW INDICATOR = '   02897519
028976                   PS-PARM-OVERFLOW-SW                            02897615
028977         SET AC-CONTROL-CARD-ERROR TO TRUE                        02897715
028978         PERFORM 9000-DISPLAY-ERROR-MESSAGE                       02897815
028979     END-IF.                                                      02897915
028980                                                                  02898015
028981                                                                  02898115
028982* ------------------------------------------------------------- * 02898215
028983* PUT A SINGLE MESSAGE ON THE QUEUE TO END THE PUT MSG PROCESS    02898315
028984* ------------------------------------------------------------- * 02898415
028985 2000-MQPUT-MSG.                                                  02898515
028986*                                                                 02898615
028990*    SET PERSISTENCE                                              02899019
029000*                                                                 02900000
029100     MOVE CC-DEST-QMGR           TO MQOD-OBJECTQMGRNAME.          02910000
029200     MOVE CC-REQUEST-QUEUE-NAME  TO MQOD-OBJECTNAME.              02920000
029300     MOVE MQMI-NONE TO MQMD-MSGID.                                02930000
029400     MOVE PV-MSG-TEXT            TO MSGBUFFER.                    02940000
029500     MOVE MQFMT-STRING           TO MQMD-FORMAT.                  02950000
029600     MOVE MQPER-PERSISTENT       TO MQMD-PERSISTENCE.             02960000
029700*                                                                 02970000
029800*                                                                 02980000
029900     CALL WS-MQPUT1 USING HCONN                                   02990000
030000*    CALL WS-MQPUT USING HCONN                                    03000000
030100*                       PQ-HANDLE                                 03010000
030200                        MQM-OBJECT-DESCRIPTOR                     03020000
030300                        MQM-MESSAGE-DESCRIPTOR                    03030000
030400                        MQM-PUT-MESSAGE-OPTIONS                   03040000
030500                        MSGLENGTH                                 03050000
030600                        MSGBUFFER                                 03060000
030700                        COMPLETION-CODE                           03070000
030800                        REASON                                    03080000
030900*                                                                 03090000
031000*        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 03100019
031100*        AND BREAK OUT OF LOOP                                    03110019
031200*                                                                 03120000
031300     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      03130000
031400        CALL WS-MQCHECK USING REASON                              03140000
031500                              PV-MQ-TEXT-REASON                   03150000
031600        MOVE 'MQPUT ERROR'     TO PV-ERROR-MESSAGE                03160000
031700        SET AC-MQ-ERROR TO TRUE                                   03170000
031800        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        03180000
031900     ELSE                                                         03190000
032000        ADD 1 TO PV-MQ-PUT-COUNT                                  03200000
032100     END-IF.                                                      03210000
032200*                                                                 03220000
032300* 2000-END-MQPUT-MSG.                                             03230000
032400*                                                                 03240000
032500* ------------------------------------------------------------- * 03250000
032600* DISCONNECT FROM THE MQ QUEUE MANAGER                            03260000
032700* ------------------------------------------------------------- * 03270000
032800 3000-DISCONNECT-QMGR.                                            03280000
032900*                                                                 03290000
033000*    DISCONNECT FROM THE QUEUE MANAGER                            03300019
033100*                                                                 03310000
033200     IF CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED         03320000
033300        CALL WS-MQDISC USING HCONN                                03330000
033400                            COMPLETION-CODE                       03340000
033500                            REASON                                03350000
033600        IF (COMPLETION-CODE NOT = MQCC-OK) THEN                   03360000
033700           MOVE 'MQDISC ERROR'   TO PV-ERROR-MESSAGE              03370000
033800           SET AC-MQ-ERROR TO TRUE                                03380000
033900           PERFORM 9000-DISPLAY-ERROR-MESSAGE                     03390000
034000        ELSE                                                      03400000
034100           DISPLAY PC-PROGRAM-NAME 'MQDISC SUCCESSFUL'            03410019
034200        END-IF                                                    03420000
034300     END-IF.                                                      03430000
034400*                                                                 03440000
034500* 3000-END-DISCONNECT.                                            03450000
034600*                                                                 03460000
034700                                                                  03470000
034800*                                                                 03480000
034900 7000-READ-LOCAL-QMGR-FILE.                                       03490000
035000     READ LOCAL-QMGR-FILE                                         03500000
035100         INTO CC-CONTROL-CARD-1                                   03510000
035200         AT END                                                   03520000
035300             SET PS-END-OF-LQM-FILE TO TRUE                       03530000
035400     END-READ.                                                    03540000
035500*                                                                 03550000
035600 7100-READ-DEST-QMGR-FILE.                                        03560000
035700     READ DEST-QMGR-FILE                                          03570000
035800         INTO CC-CONTROL-CARD-2                                   03580000
035900         AT END                                                   03590000
035901             SET PS-END-OF-DQM-FILE TO TRUE                       03590100
035902     END-READ.                                                    03590200
035903*                                                                 03590300
035904 7200-READ-REQ-QUEUE-NAME-FILE.                                   03590400
035905     READ REQ-QUEUE-NAME-FILE                                     03590500
035906         INTO CC-CONTROL-CARD-3                                   03590600
035907         AT END                                                   03590700
035908             SET PS-END-OF-RQN-FILE TO TRUE                       03590800
035909     END-READ.                                                    03590900
035910*                                                                 03591000
035911 7300-READ-ASSIGNMENT-DTL-FILE.                                   03591100
035912     READ ASSIGNMENT-DTL-FILE                                     03591200
035913         INTO PV-ASSIGNMENT-DTL-RECORD                            03591300
035914         AT END                                                   03591400
035915             SET PS-END-OF-ASSIGN-DTL-FILE TO TRUE                03591500
035916     END-READ.                                                    03591600
035917*                                                                 03591713
035918 7400-READ-INCIDENT-DESC-FILE.                                    03591813
035919     READ INCIDENT-DESC-FILE                                      03591913
035920         INTO PV-INCIDENT-DESC-RECORD                             03592013
035921         AT END                                                   03592113
035922             SET PS-END-OF-INC-DESC-FILE TO TRUE                  03592213
035923     END-READ.                                                    03592313
035924*                                                                 03592422
035925 8000-WRITE-INCIDENT-IMAGE.                                       03592522
035926     INITIALIZE II-INCIDENT-IMAGE-RECORD.                         03592622
035927     MOVE PV-PARM-M6 TO PV-INCIDENT-TYPE-TRUNC                    03592722
035928     STRING PV-CURRENT-DATE              DELIMITED BY SIZE        03592822
035929            PV-CURRENT-TIME              DELIMITED BY SIZE        03592922
035930            PV-PARM-SYSNAME              DELIMITED BY SIZE        03593024
035931            PV-PARM-M3                   DELIMITED BY SIZE        03593122
035932            PV-INCIDENT-TYPE-TRUNC       DELIMITED BY SIZE        03593222
035933            PV-MSG-TEXT                  DELIMITED BY SIZE        03593322
035934         INTO II-INCIDENT-IMAGE-RECORD.                           03593422
035935                                                                  03593522
035936     WRITE II-INCIDENT-IMAGE-RECORD.                              03593622
035937*                                                                 03593722
035938* ------------------------------------------------------------- * 03593822
035940* DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   03594000
035950* ------------------------------------------------------------- * 03595000
035960 9000-DISPLAY-ERROR-MESSAGE.                                      03596000
035970* ------------------------------------------------------------- * 03597000
035980*                                                                 03598000
035990     DISPLAY '** ABEND **'.                                       03599000
036000     DISPLAY '* ' PC-PROGRAM-NAME.                                03600019
036100     DISPLAY '* ' PV-ERROR-MESSAGE.                               03610000
036200     DISPLAY '* COMPLETION CODE : ' COMPLETION-CODE.              03620000
036300     DISPLAY '* REASON CODE     : ' REASON.                       03630000
036400     DISPLAY '* TEXT REASON     : ' PV-MQ-TEXT-REASON.            03640000
036500     CALL 'ILBOABN0' USING ABEND-CODE.                            03650000
036600*                                                                 03660000
036700* 9000-DISPLAY-ERROR-MSG-END.                                     03670000
036800*                                                                 03680000
036900                                                                  03690000
037000 9100-EOJ-ROUTINE.                                                03700000
037100     CLOSE LOCAL-QMGR-FILE                                        03710000
037200           DEST-QMGR-FILE                                         03720000
037300           REQ-QUEUE-NAME-FILE                                    03730004
037400           ASSIGNMENT-DTL-FILE                                    03740013
037500           INCIDENT-DESC-FILE                                     03750023
037600           INCIDENT-IMAGE-FILE.                                   03760022
