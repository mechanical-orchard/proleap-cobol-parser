      ******************************************************************00010000
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020000
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030000
      *   TEMPORARY STORAGE QUEUE.                                      00040000
      ******************************************************************00050000
       IDENTIFICATION DIVISION.                                         00060000
      ******************************************************************00070000
                                                                        00080000
       PROGRAM-ID.       TFKCS405.                                      00090000
       AUTHOR.           WILLIAM B. BURT.                               00100000
       INSTALLATION.     KOHLS.                                         00110000
       DATE-WRITTEN      AUGUST, 1996.                                  00120000
       DATE-COMPILED.                                                   00130000
                                                                        00140000
      ******************************************************************00150000
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160000
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170000
      * IS A REQUEST FOR INFORMATION REGARDING A PARTICULAR UPC/SKU.    00180000
      * THE TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.              00190000
      ******************************************************************00200000
      *  DATE 01/15/01                                                  00210000
      *  ADD CODE FOR 2ND LISTNER                                       00220000
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230000
      ******************************************************************00240000
      *  1/20/2003 - RAY GRAF                                           00241000
      *   PROCESS NONINTELLIGENT SKU.                                   00242000
      ******************************************************************00243000
      * 11/28/2003 - DAVE WELLER          WR/IR #: 25501                00244000
      *   MOS AND RTV DEF/DAMAGE TRANSFERS                              00245000
      ******************************************************************00246000
      * 10/25/2004 - DAVE WELLER          WR/IR #: 27349                00247000
      *   XS DOMAIN COMPLIANCE                                          00248000
      ******************************************************************00249000
021605* 02/16/2005 - DAVE WELLER          WR/IR #: 27349                00249100
021605*   XS DOMAIN COMPLIANCE                                          00249200
021605******************************************************************00249300
PB5760* DATE 10/20/10 CHANGED BY: COGNIZANT     PBI5760                 00249400
PB5760*   MODIFIED THE CODE IN 2000-PROCESS-PTC-REQUEST AND             00249500
PB5760*   7000-SELECT-UPC-FROM-TUPCSKU TO HANDLE SQL CONDITION IN THE   00249600
PB5760*   PROGRAM WITHOUT ABENDING THE TRANSACTION IN CICS REGION.      00249700
PB5760*   A ERROR MESSAGE WILL BE SEND TO RF DEVICE WITH PC-TSYMSG-0010000249800
PB5760*   MSG CODE WITHOUT ABENDING THE TRANSACTION IN CICS.            00249900
PB5760******************************************************************00250000
SR3403* 03/15/2012 - ANUJ GUPTA          SR3403                         00251000
SR3403*   LARGE RETAIL EXPANSION                                        00252000
SR3403******************************************************************00253000
P11870* 07/12/2017 - BARB SCHULTZ        P11870    CHG0170592           00254000
P11870*  BLOCK PREMIUM SUNGLASSES - DEPT 431 AND APPLE WATCHES - DEPT   00255000
P11870*  30, MAJOR CLASS = 10 AND (SUBCLASS = 11 OR 12)                 00256000
      ******************************************************************00257000
      * 02/14/2023 - JEAN KURK                     CHG0281369           00257101
      *  REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE                    00257201
      ******************************************************************00257401
       ENVIRONMENT DIVISION.                                            00258000
      ******************************************************************00259000
                                                                        00260000
      ******************************************************************00270000
       DATA DIVISION.                                                   00280000
      ******************************************************************00290000
                                                                        00300000
      ******************************************************************00310000
       WORKING-STORAGE SECTION.                                         00320000
      ******************************************************************00330000
                                                                        00340000
      *                                                                 00350000
      *  LISTENER QUEUE NAMES                                           00360000
      *                                                                 00370000
           COPY RFWS001.                                                00380000
                                                                        00390000
      *                                                                 00400000
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00410000
      *                                                                 00420000
           COPY TFRD011.                                                00430000
                                                                        00440000
      *                                                                 00450000
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00460000
      *                                                                 00470000
           COPY TFRD012.                                                00480000
                                                                        00490000
      *                                                                 00500000
      *  NISKU WORK AREA                                                00510000
      *                                                                 00520000
           COPY ISWS006.                                                00521000
                                                                        00522000
      *                                                                 00523000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00524000
      *                                                                 00525000
           COPY DPWS013.                                                00526000
                                                                        00527000
      *                                                                 00528000
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00529000
      *                                                                 00530000
           COPY DPRD507I.                                               00540000
                                                                        00550000
      *                                                                 00560000
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00570000
      *                                                                 00580000
           COPY DPWS011.                                                00590000
                                                                        00600000
      *                                                                 00660000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE     00670000
      *                                                                 00680000
           EXEC SQL                                                     00690000
               INCLUDE TTFMSTR                                          00700000
           END-EXEC.                                                    00710000
                                                                        00720000
      *                                                                 00730000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE00740000
      *                                                                 00750000
           EXEC SQL                                                     00760000
               INCLUDE TTFITEM                                          00770000
           END-EXEC.                                                    00780000
                                                                        00790000
      *                                                                 00800000
      *  SKU CROSS REFERENCE TABLE                                      00810000
      *                                                                 00820000
           EXEC SQL                                                     00830000
               INCLUDE TSKXREF                                          00840000
           END-EXEC.                                                    00850000
                                                                        00860000
      *  DCLGEN LAYOUTS AND COBOL DECLARATIONS FOR THE XS DOMAIN        00870000
      *         TABLES                                                  00880000
      *                                                                 00890000
           EXEC SQL                                                     00900000
               INCLUDE XST00008                                         00910000
           END-EXEC.                                                    00920000
           EXEC SQL                                                     00930000
               INCLUDE XST00010                                         00940000
           END-EXEC.                                                    00950000
           EXEC SQL                                                     00960000
               INCLUDE XST00012                                         00970000
           END-EXEC.                                                    00980000
           EXEC SQL                                                     00990000
               INCLUDE XST00013                                         01000000
           END-EXEC.                                                    01010000
                                                                        01020000
      *                                                                 01030000
      *  COMMUNICATIONS AREA FOR DB2                                    01040000
      *                                                                 01050000
           EXEC SQL                                                     01060000
               INCLUDE SQLCA                                            01070000
           END-EXEC.                                                    01080000
                                                                        01090000
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01100000
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01110000
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01120000
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01130000
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01140000
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01150000
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01160000
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01170000
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01180000
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01190000
                                                                        01200000
      *    API CONTROL BLOCKS                                           01210000
                                                                        01220000
       01  MQM-OBJECT-DESCRIPTOR.                                       01230000
           COPY CMQODV.                                                 01240000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01250000
           COPY CMQMDV.                                                 01260000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01270000
           COPY CMQGMOV.                                                01280000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01290000
           COPY CMQPMOV.                                                01300000
                                                                        01310000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01320000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01330000
                                                                        01340000
       01  MQM-CONSTANTS.                                               01350000
           COPY CMQV.                                                   01360000
      *                                                                 01370000
      **---------------------------------------------------------------*01380000
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01390000
      **  (EPPD000)                                                    *01400000
      **---------------------------------------------------------------*01410000
                                                                        01420000
           COPY EPWS000.                                                01430000
021605     COPY TFWS007.                                                01440000
                                                                        01450000
      *                                                                 01460000
       01  DK-DB2-KEYS.                                                 01470000
           05  DK-UPC-NBR                      PIC S9(15)  VALUE ZEROS  01480000
                                                           COMP-3.      01490000
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01500000
                                                           COMP SYNC.   01510000
SR3403     05  DK-XFER-PRIC-AMT                PIC S9(07)V9(02)         01520000
                                                           VALUE ZEROS  01530000
                                                           COMP-3.      01540000
           05  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01550000
                                                           COMP.        01560000
           05  PV-GP-RTL-QTY-NULL-IND  PIC S9(04)  VALUE +0             01570000
                                                   COMP SYNC.           01580000
      *                                                                 01590000
       01  PC-PROGRAM-CONSTANTS.                                        01600000
           05  PC-LOG-QUEUE-RESOURCE   PIC  X(04)  VALUE 'CSSL'.        01610000
           05  PC-LOG-QUEUE            PIC  X(04)  VALUE 'CSSL'.        01620000
           05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   01630000
                                                           COMP SYNC.   01640000
           05  PC-MAX-PER-ITM-QTY              PIC  9(03)  VALUE 999.   01650000
           05  PC-MAX-LINES-PER-XFER           PIC  9(03)  VALUE 999.   01660000
           05  PC-ONE                          PIC  9(01)  VALUE 1.     01670000
           05  PC-CLEARANCE                    PIC  9(02)  VALUE 30.    01680000
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   01690000
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01700000
021605*    COPY TFWS007                                                 01710000
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01720000
               'TFKCS405'.                                              01730000
                                                                        01740000
           05  PC-TSYMSG-NUMBERS.                                       01750000
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01760000
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01770000
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01780000
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.01790000
      *  MAXIMUM TRANSFER LINES EXCEEDED.  MUST CREATE A NEW TRANSFER.  01800000
               10  PC-TSYMSG-01447             PIC  9(05)  VALUE  01447.01810000
      *  UNDO INVALID.  ITEM NOT FOUND.                                 01820000
               10  PC-TSYMSG-01448             PIC  9(05)  VALUE  01448.01830000
      *  UNDO WAS SUCCESSFUL BUT THERE WERE ONLY &VAR ITEMS TO UNDO     01840000
               10  PC-TSYMSG-01512             PIC  9(05)  VALUE  01512.01850000
      *  ADDING &VAR NOT ACCEPTED. EXCEEDS THE 999 QUANTITY PER ITEM    01860000
      *  LIMIT                                                          01870000
               10  PC-TSYMSG-01513             PIC  9(05)  VALUE  01513.01880000
      *  THIS TRANSFER WAS DELETED.  PRESS 'ESC' AND RE-CREATE IT       01890000
               10  PC-TSYMSG-01639             PIC  9(05)  VALUE  01639.01900000
PB5760*  UPC DOES NOT EXIST                                             01910000
PB5760         10  PC-TSYMSG-00100             PIC  9(05)  VALUE  00100.01920000
                                                                        01930000
P11870*  ITEM NOT ELIGIBLE. PLEASE REFER TO THE DAMAGED/DEFECTIVE BEST  01940000
P11870*  PRACTICE. (NEW MESSAGE)                                        01950000
P11870***                                                               01960000
P11870         10  PC-TSYMSG-03795             PIC  9(05)  VALUE  03795.01970000
                                                                        01980000
                                                                        01990000
                                                                        02000000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   02010000
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          02020000
           05  PH-REASON                   PIC  S9(09) BINARY.          02030000
      *                                                                 02040000
       01  PS-PROGRAM-SWITCHES.                                         02050000
           05  PS-XFER-MSTR-FOUND-IND          PIC  X(01)  VALUE 'N'.   02060000
               88  PS-XFER-MSTR-NOT-FOUND                  VALUE 'N'.   02070000
               88  PS-XFER-MSTR-FOUND                      VALUE 'Y'.   02080000
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   02090000
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   02100000
      *                                                                 02110000
       01  PV-PROGRAM-VARIABLES.                                        02120000
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02130000
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02140000
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02150000
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02160000
           05  PV-QM-NAME              PIC X(48).                       02170000
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02180000
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02190000
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02200000
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02210000
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02220000
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02230000
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02240000
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02250000
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02260000
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02270000
                                                                        02280000
           05  PV-NEW-XFER-LNE-NBR             PIC  9(04)  VALUE ZEROS. 02290000
           05  PV-DB2-NULL-IND                 PIC S9(04)  VALUE ZEROS  02300000
                                                           COMP SYNC.   02310000
           05  PV-XFER-LNE-NBR                 PIC S9(04)  VALUE ZEROS  02320000
                                                           COMP SYNC.   02330000
           05  PV-XFER-QTY                     PIC S9(04)  VALUE ZEROS. 02340000
           05  PV-KOHLS-INTERNAL-UPC-NBR       PIC  9(13)  VALUE ZEROS. 02350000
           05  PV-DISPLAY-UPC-NBR              PIC  9(13)  VALUE ZEROS. 02360000
           05  PV-DISPLAY-ITEM-NBR             PIC  9(15)  VALUE ZEROS. 02370000
           05  PV-DISPLAY-INTR-UPC-ID          PIC  9(09)  VALUE ZEROS. 02380000
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 02390000
SR3403     05  PV-DISPLAY-XFER-PRIC-AMT        PIC  9(07).9(02)         02400000
                                                           VALUE ZEROS. 02410000
           05  PV-DISPLAY-LINE.                                         02420000
               10  FILLER                      PIC  X(01)  VALUE SPACE. 02430000
               10  PV-DISPLAY-CUR-RTL          PIC  X(04)  VALUE SPACE. 02440000
               10  FILLER                      PIC  X(01)  VALUE SPACE. 02450000
               10  PV-DISPLAY-XFER-QTY         PIC  X(03)  VALUE SPACE. 02460000
               10  FILLER                      PIC  X(01)  VALUE SPACE. 02470000
               10  PV-DISPLAY-DKEY-NBR         PIC  9(09)  VALUE ZEROS. 02480000
               10  FILLER                      PIC  X(01)  VALUE SPACE. 02490000
               10  PV-DISPLAY-XFER-TYP         PIC  X(02)  VALUE SPACE. 02500000
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02510000
                                                           COMP SYNC.   02520000
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02530000
                                                           COMP SYNC.   02540000
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02550000
                                                                        02560000
           05  PV-TCPIPPRQ-RECORD1.                                     02570000
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02580000
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02590000
               10  FILLER                      PIC X(4104) VALUE SPACE. 02600000
           05  PV-TCPIPPRQ-RECORD2.                                     02610000
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02620000
               10  FILLER                      PIC X(4112) VALUE SPACE. 02630000
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02640000
                                                           COMP SYNC.   02650000
           05  PV-XFER-QTY-X.                                           02660000
               10  PV-XFER-QTY-MASK            PIC  ZZ9    VALUE ZEROS. 02670000
           05  PV-CUR-RTL-AMT                  PIC S9(7)V9(2) COMP-3.   02680000
           05  PV-GP-QTY                       PIC S9(3)V COMP-3.       02690000
P11870     05  PS-BLOCK-SUNGLASS-WATCHES-SW    PIC  X(01)  VALUE 'N'.   02700000
P11870         88  PS-BLOCK-SUNGLASS-WATCHES               VALUE 'Y'.   02710000
P11870     05  PV-DEPT-NBR                     PIC  9(4)   VALUE ZERO.  02720000
P11870     05  PV-MAJ-CL-NBR                   PIC  9(4)   VALUE ZERO.  02730000
P11870     05  PV-SUB-CL-NBR                   PIC  9(4)   VALUE ZERO.  02740000
      *                                                                 02750000
      ******************************************************************02760000
       PROCEDURE DIVISION.                                              02770000
      ******************************************************************02780000
       0000-PROGRAM-MAINLINE.                                           02790000
           INITIALIZE TF012-XFER-TO-PTC-RECORD.                         02800000
                                                                        02810000
           PERFORM 1000-RETRIEVE-TEXT.                                  02820000
                                                                        02830000
           PERFORM 2000-PROCESS-PTC-REQUEST.                            02840000
                                                                        02850000
           GOBACK.                                                      02860000
      *                                                                 02870000
       1000-RETRIEVE-TEXT.                                              02880000
           EXEC CICS                                                    02890000
               RETRIEVE                                                 02900000
                   INTO  (TF011-XFER-FROM-PTC-RECORD)                   02910000
                   RESP  (PV-CICS-RESPONSE)                             02920000
           END-EXEC.                                                    02930000
                                                                        02940000
           EVALUATE TRUE                                                02950000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02960000
                   CONTINUE                                             02970000
               WHEN OTHER                                               02980000
                   MOVE '1000-RETRIEVE-TEXT'                            02990000
                                   TO DP013-PARAGRAPH                   03000000
                   MOVE 'UNABLE TO RECEIVE TEXT'                        03010000
                                   TO DP013-MESSAGE-TEXT (1)            03020000
                   MOVE  TF011-XFER-FROM-PTC-RECORD                     03030000
                                   TO DP013-MESSAGE-TEXT (2)            03040000
                   SET DP013-CICS-ABEND                                 03050000
                       DP013-NO-ROLLBACK                                03060000
                                   TO TRUE                              03070000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      03080000
                   SET  DP011-MSG-FATAL                                 03090000
                                   TO TRUE                              03100000
                   MOVE PC-TSYMSG-01064                                 03110000
                                   TO DP011-MSG-NUMBER                  03120000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03130000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03140000
           END-EVALUATE.                                                03150000
                                                                        03160000
                                                                        03170000
           MOVE TF011-LISTENER-CODE                                     03180000
                                   TO PV-QUEUE-PARM.                    03190000
                                                                        03200000
           IF  PV-VALID-PARM                                            03210000
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03220000
                                   TO PV-TSQ-NAME                       03230000
                                                                        03240000
           ELSE                                                         03250000
               MOVE '1000-RETRIEVE-TEXT'                                03260000
                                   TO DP013-PARAGRAPH                   03261000
               MOVE 'INVALID PARM VALUE'                                03262000
                                   TO DP013-MESSAGE-TEXT (1)            03263000
               MOVE 'PARM VALUE = '                                     03264000
                                   TO DP013-MESSAGE-TEXT (2)            03265000
               MOVE TF011-LISTENER-CODE                                 03266000
                                   TO DP013-MESSAGE-TEXT (3)            03267000
                                                                        03268000
               SET DP013-LOGIC-ABEND                                    03269000
                   DP013-NO-ROLLBACK                                    03270000
                                   TO TRUE                              03280000
                                                                        03290000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          03300000
                                                                        03310000
               SET DP011-MSG-FATAL TO TRUE                              03320000
                                                                        03330000
               MOVE PC-TSYMSG-01064                                     03340000
                                   TO DP011-MSG-NUMBER                  03350000
                                                                        03360000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03370000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03380000
           END-IF.                                                      03390000
                                                                        03400000
                                                                        03410000
      ******************************************************************03420000
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 03430000
      ******************************************************************03440000
       2000-PROCESS-PTC-REQUEST.                                        03450000
                                                                        03460000
           IF TF011-XFER-QTY = ZERO                                     03470000
               SET DP011-MSG-FATAL TO TRUE                              03480000
               MOVE 'TRANSFER QUANTITY MUST BE GREATER THAN ZERO'       03490000
                                   TO DP011-MSG-TEXT                    03490100
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03490200
           END-IF.                                                      03490300
                                                                        03490400
           PERFORM 7650-SELECT-XFER-MSTR.                               03490500
                                                                        03490600
           IF PS-XFER-MSTR-NOT-FOUND                                    03490700
PB5760         SET DP011-MSG-FATAL TO  TRUE                             03490800
               MOVE PC-TSYMSG-01639                                     03490900
                                   TO  DP011-MSG-NUMBER                 03491000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03492000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03493000
           END-IF.                                                      03494000
                                                                        03495000
021605     IF TF011-XFER-TYP-CDE-X  =  TF007-NON-RETAIL                 03496000
               PERFORM 2100-UPDATE-NON-RETAIL-ITM                       03497000
           ELSE                                                         03498000
               PERFORM 2200-UPDATE-RETAIL-ITM                           03499000
           END-IF.                                                      03500000
                                                                        03510000
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          03520000
      *                                                                 03530000
       2100-UPDATE-NON-RETAIL-ITM.                                      03540000
           PERFORM 7400-SELECT-MAX-XFER-LINE-NBR.                       03550000
           PERFORM 7600-INSERT-NON-RTL-XFER-ITEM.                       03560000
      *                                                                 03570000
       2200-UPDATE-RETAIL-ITM.                                          03580000
           MOVE TF011-UPC-NBR      TO  DK-UPC-NBR.                      03590000
           PERFORM 7000-SELECT-UPC-FROM-TUPCSKU.                        03600000
           PERFORM 3000-GENERATE-INTRNL-UPC-CODE.                       03610000
                                                                        03620000
           PERFORM 7100-SELECT-XFER-ITM-QTY.                            03630000
                                                                        03640000
           IF TF011-NEGATIVE                                            03650000
               IF SQLCODE = PC-ROW-NOT-FOUND                            03660000
                   SET  DP011-MSG-FATAL                                 03670000
                                   TO TRUE                              03680000
                   MOVE PC-TSYMSG-01448                                 03690000
                                   TO DP011-MSG-NUMBER                  03700000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03710000
               ELSE                                                     03720000
                   COMPUTE PV-XFER-QTY =                                03730000
                       TFITEM-XFER-QTY - TF011-XFER-QTY                 03740000
                   IF PV-XFER-QTY POSITIVE                              03750000
                       PERFORM 7200-UPDATE-XFER-ITEM-QTY                03760000
                   ELSE                                                 03770000
                       PERFORM 7300-DELETE-XFER-ITEM                    03780000
                       IF PV-XFER-QTY NEGATIVE                          03790000
                           SET  DP011-MSG-WARNING                       03800000
                                   TO TRUE                              03810000
                           MOVE TFITEM-XFER-QTY                         03820000
                                   TO PV-XFER-QTY-MASK                  03830000
                           MOVE PV-XFER-QTY-X                           03840000
                                   TO DP011-MSG-TEXT                    03850000
                           MOVE PC-TSYMSG-01512                         03860000
                                   TO DP011-MSG-NUMBER                  03870000
                           PERFORM 9000-FMT-ERR-MSG-TO-PTC              03880000
                       END-IF                                           03890000
                   END-IF                                               03900000
               END-IF                                                   03910000
           ELSE                                                         03920000
               IF SQLCODE = PC-ROW-NOT-FOUND                            03930000
                   PERFORM 7400-SELECT-MAX-XFER-LINE-NBR                03940000
                   PERFORM 7500-INSERT-RTL-XFER-ITEM                    03950000
               ELSE                                                     03960000
                   COMPUTE PV-XFER-QTY =                                03970000
                       TFITEM-XFER-QTY + TF011-XFER-QTY                 03980000
                   IF PV-XFER-QTY > PC-MAX-PER-ITM-QTY                  03990000
                       SET  DP011-MSG-FATAL                             04000000
                                   TO TRUE                              04010000
                       MOVE TF011-XFER-QTY                              04020000
                                   TO PV-XFER-QTY-MASK                  04030000
                       MOVE PV-XFER-QTY-X                               04040000
                                   TO DP011-MSG-TEXT                    04050000
                       MOVE PC-TSYMSG-01513                             04060000
                                   TO DP011-MSG-NUMBER                  04070000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  04080000
                   ELSE                                                 04090000
                       PERFORM 7200-UPDATE-XFER-ITEM-QTY                04100000
                   END-IF                                               04110000
               END-IF                                                   04120000
           END-IF.                                                      04130000
      *                                                                 04140000
       3000-GENERATE-INTRNL-UPC-CODE.                                   04150000
           INITIALIZE DCLXST00008.                                      04160000
                                                                        04170000
           EXEC SQL                                                     04180000
               SELECT  UPC_NBR                                          04190000
                 INTO  :XST00012-UPC-NBR                                04200000
                 FROM  XST_UPC                                          04210000
                WHERE  INTR_UPC_ID     =  :XST00012-INTR-UPC-ID         04220000
                  AND  UPC_TYP_CDE     =  'I'                           04230000
                 WITH  UR                                               04240000
           END-EXEC.                                                    04250000
                                                                        04260000
           EVALUATE SQLCODE                                             04270000
               WHEN ZERO                                                04280000
                   MOVE XST00012-UPC-NBR                                04290000
                                   TO DK-UPC-NBR                        04300000
                                      PV-KOHLS-INTERNAL-UPC-NBR         04310000
               WHEN -904                                                04320000
               WHEN -913                                                04330000
                   SET  DP011-MSG-FATAL                                 04340000
                                   TO TRUE                              04350000
                   MOVE PC-TSYMSG-01063                                 04360000
                                   TO DP011-MSG-NUMBER                  04370000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04380000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04390000
               WHEN OTHER                                               04400000
                   MOVE '3000-GENERATE-INTRNL-UPC-CODE'                 04410000
                                   TO DP013-PARAGRAPH                   04420000
                   MOVE 'GENERATE INTERNAL UPC NUMBER'                  04430000
                                   TO DP013-MESSAGE-TEXT (1)            04440000
                   MOVE XST00012-INTR-UPC-ID                            04450000
                                   TO PV-DISPLAY-INTR-UPC-ID            04460000
                   MOVE PV-DISPLAY-INTR-UPC-ID                          04470000
                                   TO DP013-MESSAGE-TEXT (2)            04480000
                   MOVE SQLCA      TO DP013-SQLCA                       04490000
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          04500000
                   SET DP013-DB2-ABEND                                  04510000
                       DP013-NO-ROLLBACK                                04520000
                                   TO TRUE                              04530000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04540000
                   SET  DP011-MSG-FATAL                                 04550000
                                   TO TRUE                              04560000
                   MOVE PC-TSYMSG-01064                                 04570000
                                   TO DP011-MSG-NUMBER                  04580000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04590000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04600000
           END-EVALUATE.                                                04610000
      *                                                                 04620000
       7000-SELECT-UPC-FROM-TUPCSKU.                                    04630000
           INITIALIZE DCLXST00008.                                      04640000
           INITIALIZE DCLXST00010.                                      04650000
           INITIALIZE DCLXST00012.                                      04660000
                                                                        04670000
           EXEC SQL                                                     04680000
               SELECT  A.INTR_UPC_ID                                    04690000
                     , C.UNT_RTL_AMT                                    04700000
                     , C.GP_RTL_QTY                                     04710000
                     , B.REGN_PRIC_IND                                  04720000
                     , D.ITM_NBR                                        04730000
P11870               , E.DEPT_NBR                                       04740000
P11870               , E.MAJ_CL_NBR                                     04750000
P11870               , E.SUB_CL_NBR                                     04760000
                 INTO  :XST00012-INTR-UPC-ID                            04770000
                     , :XST00008-UNT-RTL-AMT                            04780000
                     , :XST00008-GP-RTL-QTY                             04790000
                           :PV-GP-RTL-QTY-NULL-IND                      04800000
                     , :XST00010-REGN-PRIC-IND                          04810000
                     , :SKXREF-ITM-NBR                                  04820000
P11870               , :XST00013-DEPT-NBR                               04830000
P11870               , :XST00013-MAJ-CL-NBR                             04840000
P11870               , :XST00013-SUB-CL-NBR                             04850000
                 FROM  XST_UPC      A                                   04860000
                     , XST_SKU      B                                   04870000
                     , XST_SKU_LOC  C                                   04880000
                     , TSKXREF      D                                   04890000
                     , XST_VND_STYL E                                   04891000
                WHERE  A.UPC_NBR       =  :DK-UPC-NBR                   04892000
                  AND  A.LAST_ACTN_CDE IN ('A', 'U')                    04893000
                  AND  B.INTR_UPC_ID   =  A.INTR_UPC_ID                 04894000
                  AND  C.INTR_UPC_ID   =  A.INTR_UPC_ID                 04895000
                  AND  C.LOC_NBR       =  +0                            04896000
                  AND  C.BEG_TMST      <= CURRENT TIMESTAMP             04897000
                  AND  (C.END_TMST     >  CURRENT TIMESTAMP             04898000
                   OR  C.END_TMST      IS NULL)                         04899000
                  AND  D.INTR_UPC_ID   =  A.INTR_UPC_ID                 04900000
                  AND  D.SKU_STAT_CDE  <> '98'                          04910000
P11870            AND  B.STYL_ID       = E.STYL_ID                      04911000
                 WITH  UR                                               04912000
           END-EXEC.                                                    04913000
                                                                        04914000
           EVALUATE SQLCODE                                             04915000
               WHEN ZERO                                                04916000
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        04917000
                       MOVE ZEROS  TO XST00008-GP-RTL-QTY               04918000
                   END-IF                                               04919000
                   MOVE XST00008-UNT-RTL-AMT                            04920000
                                   TO PV-CUR-RTL-AMT                    04930000
                   MOVE XST00008-GP-RTL-QTY                             04940000
                                   TO PV-GP-QTY                         04941000
P11870             MOVE XST00013-DEPT-NBR   TO PV-DEPT-NBR              04942000
P11870             MOVE XST00013-MAJ-CL-NBR TO PV-MAJ-CL-NBR            04943000
P11870             MOVE XST00013-SUB-CL-NBR TO PV-SUB-CL-NBR            04944000
P11870* PREMIUM SUNGLASSES                                              04945000
P11870             IF PV-DEPT-NBR = 431 OR                              04946000
P11870* APPLE WATCHES                                                   04946100
P11870               (PV-DEPT-NBR = 30 AND                              04946200
P11870                PV-MAJ-CL-NBR = 10 AND                            04946300
P11870               (PV-SUB-CL-NBR = 11 OR                             04946400
P11870                PV-SUB-CL-NBR = 12))                              04946500
P11870                   SET PS-BLOCK-SUNGLASS-WATCHES TO TRUE          04946600
P11870             END-IF                                               04946700
P11870             EVALUATE TF011-XFER-TYP-CDE-X                        04946800
P11870                 WHEN TF007-DEFECTIVES-DAMAGES-SORT1              04946900
P11870                 WHEN TF007-DEFECTIVES-DAMAGES-SORT2              04947000
P11870***                                                               04947100
P11870* CERTAIN DEPARTMENTS CAN'T BE RETURNED AS DEF/DAMAGE             04947200
P11870***                                                               04947300
P11870                 IF PS-BLOCK-SUNGLASS-WATCHES                     04947400
P11870                    SET DP011-MSG-FATAL                           04947500
P11870                             TO TRUE                              04947600
P11870                    MOVE PC-TSYMSG-03795                          04947700
P11870                             TO DP011-MSG-NUMBER                  04947800
P11870                    PERFORM 9000-FMT-ERR-MSG-TO-PTC               04947900
P11870                    PERFORM 8000-SEND-DATA-TO-LISTENER            04948000
P11870                 END-IF                                           04948100
P11870             END-EVALUATE                                         04948200
P11870                                                                  04948300
                   IF XST00010-REGN-PRIC-IND = PC-YES                   04948400
                       EVALUATE TF011-XFER-TYP-CDE-X                    04948500
021605                     WHEN  TF007-DEFECTIVES-DAMAGES-SORT1         04948600
021605                     WHEN  TF007-DEFECTIVES-DAMAGES-SORT2         04948700
021605                     WHEN  TF007-CALLBACK                         04948800
                               MOVE TFMSTR-FR-STR-NBR                   04948900
                                   TO DK-STR-NBR                        04949000
                               PERFORM 7800-CHECK-REGN-PRC              04949100
021605                     WHEN  TF007-STOCK-BALANCE-CORPORATE          04949200
021605                     WHEN  TF007-STOCK-BALANCE-STORE              04949300
021605                     WHEN  TF007-CUSTOMER                         04949400
                               MOVE TFMSTR-TO-STR-NBR                   04949500
                                   TO DK-STR-NBR                        04949600
                               PERFORM 7800-CHECK-REGN-PRC              04949700
                       END-EVALUATE                                     04949800
                   END-IF                                               04949900
PB5760         WHEN +100                                                04950000
PB5760             SET  DP011-MSG-FATAL                                 04950100
PB5760                             TO TRUE                              04950200
PB5760             MOVE PC-TSYMSG-00100                                 04950300
PB5760                             TO DP011-MSG-NUMBER                  04950400
PB5760             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04950500
PB5760             PERFORM 8000-SEND-DATA-TO-LISTENER                   04950600
               WHEN -904                                                04950700
               WHEN -913                                                04950800
                   SET  DP011-MSG-FATAL                                 04950900
                                   TO TRUE                              04951000
                   MOVE PC-TSYMSG-01063                                 04952000
                                   TO DP011-MSG-NUMBER                  04953000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04954000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04955000
               WHEN OTHER                                               04956000
                   MOVE '7000-SELECT-UPC-FROM-TUPCSKU'                  04957000
                                   TO DP013-PARAGRAPH                   04958000
                   MOVE 'SELECT AN ITEM NMBR FOR THE FOLLOWING UPC: '   04959000
                                   TO DP013-MESSAGE-TEXT (1)            04960000
                   MOVE DK-UPC-NBR TO PV-DISPLAY-UPC-NBR                04970000
                   MOVE PV-DISPLAY-UPC-NBR                              04980000
                                   TO DP013-MESSAGE-TEXT (2)            04990000
                   MOVE SQLCA      TO DP013-SQLCA                       05000000
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          05010000
                   MOVE 'XST_SKU'  TO DP013-DB2-TABLE-NAME (2)          05020000
                   MOVE 'XST_SKU_LOC'                                   05030000
                                   TO DP013-DB2-TABLE-NAME (3)          05040000
                   SET DP013-DB2-ABEND                                  05050000
                       DP013-NO-ROLLBACK                                05060000
                                   TO TRUE                              05070000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05080000
                   SET  DP011-MSG-FATAL                                 05090000
                                   TO TRUE                              05100000
                   MOVE PC-TSYMSG-01064                                 05110000
                                   TO DP011-MSG-NUMBER                  05120000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05130000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05140000
           END-EVALUATE.                                                05150000
      *                                                                 05160000
       7100-SELECT-XFER-ITM-QTY.                                        05170000
           INITIALIZE DCLTTFITEM.                                       05180000
           MOVE TF011-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 05190000
           COMPUTE DK-XFER-PRIC-AMT  =                                  05200000
               (TF011-TKT-PRICE  /  100).                               05210000
                                                                        05220000
           EXEC SQL                                                     05230000
               SELECT  XFER_QTY                                         05240000
                 INTO  :TFITEM-XFER-QTY                                 05250000
                 FROM  TTFITEM                                          05260000
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID              05270000
                  AND   ITM_NBR        =  :SKXREF-ITM-NBR               05280000
                  AND   XFER_PRIC_AMT  =  :DK-XFER-PRIC-AMT)            05290000
                 WITH  UR                                               05300000
           END-EXEC.                                                    05310000
                                                                        05320000
           EVALUATE SQLCODE                                             05330000
               WHEN ZERO                                                05340000
               WHEN +100                                                05350000
                   CONTINUE                                             05360000
               WHEN -904                                                05370000
               WHEN -913                                                05380000
                   SET  DP011-MSG-FATAL                                 05390000
                                   TO TRUE                              05400000
                   MOVE PC-TSYMSG-01063                                 05410000
                                   TO DP011-MSG-NUMBER                  05420000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05430000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05440000
               WHEN OTHER                                               05450000
                   MOVE '7100-SELECT-XFER-ITM-QTY'                      05460000
                                   TO DP013-PARAGRAPH                   05470000
                   MOVE 'SELECT TRANSFER ITEM QTY FOR XFER_DKEY_ID/ITM_N05480000
      -                 'BR/XFER_PRIC_AMT: '                            05490000
                                   TO DP013-MESSAGE-TEXT (1)            05500000
                   MOVE DK-XFER-DKEY-ID                                 05510000
                                   TO PV-DISPLAY-XFER-DKEY-ID           05520000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         05530000
                                   TO DP013-MESSAGE-TEXT (2)            05540000
                   MOVE SKXREF-ITM-NBR                                  05550000
                                   TO PV-DISPLAY-ITEM-NBR               05560000
                   MOVE PV-DISPLAY-ITEM-NBR                             05570000
                                   TO DP013-MESSAGE-TEXT (3)            05580000
                   MOVE DK-XFER-PRIC-AMT                                05590000
                                   TO PV-DISPLAY-XFER-PRIC-AMT          05600000
                   MOVE PV-DISPLAY-XFER-PRIC-AMT                        05610000
                                   TO DP013-MESSAGE-TEXT (4)            05620000
                   MOVE SQLCA      TO DP013-SQLCA                       05630000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          05640000
                   SET DP013-DB2-ABEND                                  05650000
                       DP013-NO-ROLLBACK                                05660000
                                   TO TRUE                              05670000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05680000
                   SET  DP011-MSG-FATAL                                 05690000
                                   TO TRUE                              05700000
                   MOVE PC-TSYMSG-01064                                 05710000
                                   TO DP011-MSG-NUMBER                  05720000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05730000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05740000
           END-EVALUATE.                                                05750000
      *                                                                 05760000
       7200-UPDATE-XFER-ITEM-QTY.                                       05770000
           INITIALIZE DCLTTFITEM.                                       05780000
           MOVE TF011-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 05790000
           COMPUTE DK-XFER-PRIC-AMT  =                                  05800000
               (TF011-TKT-PRICE  /  100).                               05810000
           MOVE PV-XFER-QTY        TO  TFITEM-XFER-QTY.                 05820000
                                                                        05830000
           EXEC SQL                                                     05840000
               UPDATE  TTFITEM                                          05850000
                  SET  XFER_QTY        =  :TFITEM-XFER-QTY              05860000
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID              05870000
                  AND   ITM_NBR        =  :SKXREF-ITM-NBR               05880000
                  AND   XFER_PRIC_AMT  =  :DK-XFER-PRIC-AMT)            05890000
           END-EXEC.                                                    05900000
                                                                        05910000
           EVALUATE SQLCODE                                             05920000
               WHEN ZERO                                                05930000
                   CONTINUE                                             05940000
               WHEN -904                                                05950000
               WHEN -913                                                05960000
                   SET  DP011-MSG-FATAL                                 05970000
                                   TO TRUE                              05980000
                   MOVE PC-TSYMSG-01063                                 05990000
                                   TO DP011-MSG-NUMBER                  06000000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06010000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06020000
               WHEN OTHER                                               06030000
                   MOVE '7200-UPDATE-XFER-ITEM-QTY'                     06040000
                                   TO DP013-PARAGRAPH                   06050000
                   MOVE 'UPDATE TRANSFER ITEM QTY FOR XFER_DKEY_ID/ITM_N06060000
      -                 'BR/XFER_PRIC_AMT: '                            06070000
                                   TO DP013-MESSAGE-TEXT (1)            06080000
                   MOVE DK-XFER-DKEY-ID                                 06090000
                                   TO PV-DISPLAY-XFER-DKEY-ID           06100000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06110000
                                   TO DP013-MESSAGE-TEXT (2)            06120000
                   MOVE SKXREF-ITM-NBR                                  06130000
                                   TO PV-DISPLAY-ITEM-NBR               06140000
                   MOVE PV-DISPLAY-ITEM-NBR                             06150000
                                   TO DP013-MESSAGE-TEXT (3)            06160000
                   MOVE DK-XFER-PRIC-AMT                                06170000
                                   TO PV-DISPLAY-XFER-PRIC-AMT          06180000
                   MOVE PV-DISPLAY-XFER-PRIC-AMT                        06190000
                                   TO DP013-MESSAGE-TEXT (4)            06200000
                   MOVE SQLCA      TO DP013-SQLCA                       06210000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          06220000
                   SET DP013-DB2-ABEND                                  06230000
                       DP013-NO-ROLLBACK                                06240000
                                   TO TRUE                              06250000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06260000
                   SET  DP011-MSG-FATAL                                 06270000
                                   TO TRUE                              06280000
                   MOVE PC-TSYMSG-01064                                 06290000
                                   TO DP011-MSG-NUMBER                  06300000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06310000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06320000
           END-EVALUATE.                                                06330000
      *                                                                 06340000
       7300-DELETE-XFER-ITEM.                                           06350000
           MOVE TF011-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 06360000
           COMPUTE DK-XFER-PRIC-AMT  =                                  06370000
               (TF011-TKT-PRICE  /  100).                               06380000
                                                                        06390000
           EXEC SQL                                                     06400000
               DELETE FROM TTFITEM                                      06410000
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID              06420000
                  AND   ITM_NBR        =  :SKXREF-ITM-NBR               06430000
                  AND   XFER_PRIC_AMT  =  :DK-XFER-PRIC-AMT)            06440000
           END-EXEC.                                                    06450000
                                                                        06460000
           EVALUATE SQLCODE                                             06470000
               WHEN ZERO                                                06480000
                   CONTINUE                                             06490000
               WHEN -904                                                06500000
               WHEN -913                                                06510000
                   SET  DP011-MSG-FATAL                                 06520000
                                   TO TRUE                              06530000
                   MOVE PC-TSYMSG-01063                                 06540000
                                   TO DP011-MSG-NUMBER                  06550000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06560000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06570000
               WHEN OTHER                                               06580000
                   MOVE '7300-DELETE-XFER-ITEM'                         06590000
                                   TO DP013-PARAGRAPH                   06600000
                   MOVE 'DELETE TRANSFER ITEM FOR XFER_DKEY_ID/ITM_NBR/X06610000
      -                 'FER_PRIC_AMT: '                                06620000
                                   TO DP013-MESSAGE-TEXT (1)            06630000
                   MOVE DK-XFER-DKEY-ID                                 06640000
                                   TO PV-DISPLAY-XFER-DKEY-ID           06650000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06660000
                                   TO DP013-MESSAGE-TEXT (2)            06670000
                   MOVE SKXREF-ITM-NBR                                  06680000
                                   TO PV-DISPLAY-ITEM-NBR               06690000
                   MOVE PV-DISPLAY-ITEM-NBR                             06700000
                                   TO DP013-MESSAGE-TEXT (3)            06701000
                   MOVE DK-XFER-PRIC-AMT                                06702000
                                   TO PV-DISPLAY-XFER-PRIC-AMT          06703000
                   MOVE PV-DISPLAY-XFER-PRIC-AMT                        06704000
                                   TO DP013-MESSAGE-TEXT (4)            06705000
                   MOVE SQLCA      TO DP013-SQLCA                       06706000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          06707000
                   SET DP013-DB2-ABEND                                  06708000
                       DP013-NO-ROLLBACK                                06709000
                                   TO TRUE                              06710000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06720000
                   SET  DP011-MSG-FATAL                                 06730000
                                   TO TRUE                              06740000
                   MOVE PC-TSYMSG-01064                                 06750000
                                   TO DP011-MSG-NUMBER                  06760000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06770000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06780000
           END-EVALUATE.                                                06790000
      *                                                                 06800000
       7400-SELECT-MAX-XFER-LINE-NBR.                                   06810000
           INITIALIZE DCLTTFITEM.                                       06820000
           MOVE TF011-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 06830000
                                                                        06840000
           EXEC SQL                                                     06850000
               SELECT  MAX(XFER_LNE_NBR)                                06860000
                 INTO  :PV-XFER-LNE-NBR                                 06870000
                           :PV-DB2-NULL-IND                             06880000
                 FROM  TTFITEM                                          06890000
                WHERE  XFER_DKEY_ID  =  :DK-XFER-DKEY-ID                06900000
                 WITH  UR                                               06910000
           END-EXEC.                                                    06920000
                                                                        06930000
           EVALUATE SQLCODE                                             06940000
               WHEN ZERO                                                06950000
                   CONTINUE                                             06960000
               WHEN -904                                                06970000
               WHEN -913                                                06980000
                   SET DP011-MSG-FATAL                                  06990000
                                   TO TRUE                              07000000
                   MOVE PC-TSYMSG-01063                                 07010000
                                   TO DP011-MSG-NUMBER                  07020000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07030000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07040000
               WHEN OTHER                                               07050000
                   MOVE '7400-SELECT-MAX-XFER-LINE-NBR'                 07060000
                                   TO DP013-PARAGRAPH                   07070000
                   MOVE 'SELECT MAX XFER_LNE_NBR FOR XFER_DKEY_ID: '    07080000
                                   TO DP013-MESSAGE-TEXT (1)            07090000
                   MOVE DK-XFER-DKEY-ID                                 07100000
                                   TO PV-DISPLAY-XFER-DKEY-ID           07110000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         07120000
                                   TO DP013-MESSAGE-TEXT (2)            07130000
                   MOVE SQLCA      TO DP013-SQLCA                       07140000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          07150000
                   SET DP013-DB2-ABEND                                  07160000
                       DP013-NO-ROLLBACK                                07170000
                                   TO TRUE                              07180000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07190000
                   SET  DP011-MSG-FATAL                                 07200000
                                   TO TRUE                              07210000
                   MOVE PC-TSYMSG-01064                                 07220000
                                   TO DP011-MSG-NUMBER                  07221000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07222000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07223000
           END-EVALUATE.                                                07224000
                                                                        07225000
           COMPUTE PV-NEW-XFER-LNE-NBR  =                               07226000
               PV-XFER-LNE-NBR + 1.                                     07227000
                                                                        07228000
           IF PV-NEW-XFER-LNE-NBR > PC-MAX-LINES-PER-XFER               07229000
               SET DP011-MSG-FATAL TO TRUE                              07230000
               MOVE PC-TSYMSG-01447                                     07240000
                                   TO DP011-MSG-NUMBER                  07250000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          07260000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       07270000
           END-IF.                                                      07280000
      *                                                                 07290000
       7500-INSERT-RTL-XFER-ITEM.                                       07300000
           INITIALIZE DCLTTFITEM.                                       07310000
                                                                        07320000
           MOVE DK-XFER-DKEY-ID    TO  TFITEM-XFER-DKEY-ID.             07330000
           MOVE PV-NEW-XFER-LNE-NBR                                     07340000
                                   TO  TFITEM-XFER-LNE-NBR.             07350000
           MOVE PV-KOHLS-INTERNAL-UPC-NBR                               07360000
                                   TO  TFITEM-KOHLS-UPC-NBR.            07370000
           MOVE SKXREF-ITM-NBR     TO  TFITEM-ITM-NBR.                  07380000
           MOVE DK-XFER-PRIC-AMT   TO  TFITEM-XFER-PRIC-AMT.            07390000
           MOVE TF011-UPC-NBR      TO  TFITEM-SCN-UPC-NBR.              07400000
                                                                        07410000
           IF PV-GP-QTY  >  PC-ONE                                      07420000
               MOVE PC-YES         TO  TFITEM-ITM-PRIC-MLT-IND          07430000
           ELSE                                                         07440000
               MOVE PC-NO          TO  TFITEM-ITM-PRIC-MLT-IND          07450000
           END-IF                                                       07460000
           MOVE PV-CUR-RTL-AMT     TO  TFITEM-CPLD-RTL-PRIC-AMT         07470000
                                                                        07480000
           MOVE TF011-XFER-QTY     TO  TFITEM-XFER-QTY.                 07490000
           MOVE TF011-SKU-RENUM-IND                                     07500000
                                   TO  TFITEM-RNBR-SKU-IND.             07510000
                                                                        07520000
           EXEC SQL                                                     07530000
               INSERT INTO TTFITEM                                      07540000
                   (XFER_DKEY_ID,                                       07550000
                    XFER_LNE_NBR,                                       07560000
                    CPLD_RTL_PRIC_AMT,                                  07570000
                    SCN_UPC_NBR,                                        07580000
                    KOHLS_UPC_NBR,                                      07590000
                    ITM_NBR,                                            07600000
                    XFER_PRIC_AMT,                                      07610000
                    XFER_QTY,                                           07620000
                    RNBR_SKU_IND,                                       07630000
                    ITM_PRIC_MLT_IND)                                   07640000
                                                                        07650000
               VALUES                                                   07660000
                   (:TFITEM-XFER-DKEY-ID,                               07670000
                    :TFITEM-XFER-LNE-NBR,                               07680000
                    :TFITEM-CPLD-RTL-PRIC-AMT,                          07690000
                    :TFITEM-SCN-UPC-NBR,                                07700000
                    :TFITEM-KOHLS-UPC-NBR,                              07710000
                    :TFITEM-ITM-NBR,                                    07720000
                    :TFITEM-XFER-PRIC-AMT,                              07730000
                    :TFITEM-XFER-QTY,                                   07740000
                    :TFITEM-RNBR-SKU-IND,                               07750000
                    :TFITEM-ITM-PRIC-MLT-IND)                           07760000
           END-EXEC.                                                    07770000
                                                                        07780000
           EVALUATE SQLCODE                                             07790000
               WHEN ZERO                                                07800000
                   CONTINUE                                             07810000
               WHEN -904                                                07820000
               WHEN -913                                                07830000
                   SET  DP011-MSG-FATAL                                 07840000
                                   TO TRUE                              07850000
                   MOVE PC-TSYMSG-01063                                 07860000
                                   TO DP011-MSG-NUMBER                  07870000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07880000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07890000
               WHEN OTHER                                               07900000
                   MOVE '7500-INSERT-RTL-XFER-ITEM'                     07910000
                                   TO DP013-PARAGRAPH                   07920000
                   MOVE 'INSERT RETAIL TRANSFER ITEM FOR XFER_DKEY_ID: '07930000
                                   TO DP013-MESSAGE-TEXT (1)            07940000
                   MOVE DK-XFER-DKEY-ID                                 07950000
                                   TO PV-DISPLAY-XFER-DKEY-ID           07960000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         07970000
                                   TO DP013-MESSAGE-TEXT (2)            07980000
                   MOVE SQLCA      TO DP013-SQLCA                       07990000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          08000000
                   SET DP013-DB2-ABEND                                  08010000
                       DP013-NO-ROLLBACK                                08020000
                                   TO TRUE                              08030000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08040000
                   SET  DP011-MSG-FATAL                                 08050000
                                   TO TRUE                              08060000
                   MOVE PC-TSYMSG-01064                                 08070000
                                   TO DP011-MSG-NUMBER                  08080000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08090000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08100000
           END-EVALUATE.                                                08110000
      *                                                                 08120000
       7600-INSERT-NON-RTL-XFER-ITEM.                                   08130000
           INITIALIZE DCLTTFITEM.                                       08140000
                                                                        08150000
           MOVE DK-XFER-DKEY-ID                                         08160000
                                   TO  TFITEM-XFER-DKEY-ID.             08170000
           MOVE PV-NEW-XFER-LNE-NBR                                     08180000
                                   TO  TFITEM-XFER-LNE-NBR.             08190000
           MOVE TF011-ITEM-DESC-LN1                                     08200000
                                   TO  TFITEM-NRTL-1ST-LNE-DESC.        08210000
           MOVE TF011-ITEM-DESC-LN2                                     08220000
                                   TO  TFITEM-NRTL-2ND-LNE-DESC.        08230000
           MOVE TF011-FIXTURE-NBR  TO  TFITEM-NRTL-FIXT-ID.             08240000
           MOVE TF011-DEPT-NBR-X   TO  TFITEM-NRTL-DEPT-NBR.            08250000
           MOVE TF011-XFER-QTY     TO  TFITEM-XFER-QTY.                 08260000
                                                                        08270000
           EXEC SQL                                                     08280000
               INSERT INTO TTFITEM                                      08290000
                   (XFER_DKEY_ID,                                       08300000
                    XFER_LNE_NBR,                                       08310000
                    NRTL_1ST_LNE_DESC,                                  08320000
                    NRTL_2ND_LNE_DESC,                                  08330000
                    NRTL_FIXT_ID,                                       08340000
                    NRTL_DEPT_NBR,                                      08350000
                    XFER_QTY)                                           08360000
               VALUES                                                   08370000
                   (:TFITEM-XFER-DKEY-ID,                               08380000
                    :TFITEM-XFER-LNE-NBR,                               08390000
                    :TFITEM-NRTL-1ST-LNE-DESC,                          08400000
                    :TFITEM-NRTL-2ND-LNE-DESC,                          08410000
                    :TFITEM-NRTL-FIXT-ID,                               08420000
                    :TFITEM-NRTL-DEPT-NBR,                              08430000
                    :TFITEM-XFER-QTY)                                   08440000
           END-EXEC.                                                    08450000
                                                                        08460000
           EVALUATE SQLCODE                                             08470000
               WHEN ZERO                                                08480000
                   CONTINUE                                             08490000
               WHEN -904                                                08500000
               WHEN -913                                                08510000
                   SET  DP011-MSG-FATAL                                 08520000
                                   TO TRUE                              08530000
                   MOVE PC-TSYMSG-01063                                 08540000
                                   TO DP011-MSG-NUMBER                  08550000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08560000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08570000
               WHEN OTHER                                               08580000
                   MOVE '7600-INSERT-NON-RTL-XFER-ITEM'                 08590000
                                   TO DP013-PARAGRAPH                   08600000
                   MOVE 'INSERT NON-RETAIL TRANSFER ITEM FOR XFER_DKEY_I08610000
      -                 'D: '      TO DP013-MESSAGE-TEXT (1)            08620000
                   MOVE DK-XFER-DKEY-ID                                 08630000
                                   TO PV-DISPLAY-XFER-DKEY-ID           08640000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         08650000
                                   TO DP013-MESSAGE-TEXT (2)            08660000
                   MOVE SQLCA      TO DP013-SQLCA                       08670000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          08680000
                   SET DP013-DB2-ABEND                                  08690000
                       DP013-NO-ROLLBACK                                08700000
                                   TO TRUE                              08710000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08720000
                   SET  DP011-MSG-FATAL                                 08730000
                                   TO TRUE                              08740000
                   MOVE PC-TSYMSG-01064                                 08750000
                                   TO DP011-MSG-NUMBER                  08760000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08770000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08780000
           END-EVALUATE.                                                08790000
      *                                                                 08800000
       7650-SELECT-XFER-MSTR.                                           08810000
           INITIALIZE DCLTTFMSTR.                                       08820000
           MOVE TF011-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 08830000
                                                                        08840000
           EXEC SQL                                                     08850000
               SELECT  XFER_DKEY_ID                                     08860000
                      ,FR_STR_NBR                                       08870000
                      ,TO_STR_NBR                                       08880000
                 INTO  :TFMSTR-XFER-DKEY-ID                             08890000
                      ,:TFMSTR-FR-STR-NBR                               08900000
                      ,:TFMSTR-TO-STR-NBR                               08910000
                 FROM  TTFMSTR                                          08920000
                WHERE  XFER_DKEY_ID  =  :DK-XFER-DKEY-ID                08930000
                 WITH  UR                                               08940000
           END-EXEC.                                                    08950000
                                                                        08960000
           EVALUATE SQLCODE                                             08970000
               WHEN ZERO                                                08980000
                   SET PS-XFER-MSTR-FOUND                               08990000
                                   TO TRUE                              09000000
               WHEN +100                                                09010000
                   CONTINUE                                             09020000
               WHEN OTHER                                               09030000
                   MOVE '7650-SELECT-XFER-MSTR'                         09040000
                                   TO DP013-PARAGRAPH                   09050000
                   MOVE 'SELECT TRANSFER MASTER FOR XFER_DKEY_ID: '     09060000
                                   TO DP013-MESSAGE-TEXT (1)            09070000
                   MOVE DK-XFER-DKEY-ID                                 09080000
                                   TO PV-DISPLAY-XFER-DKEY-ID           09090000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         09100000
                                   TO DP013-MESSAGE-TEXT (2)            09110000
                   MOVE SQLCA      TO DP013-SQLCA                       09120000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          09130000
                   SET DP013-DB2-ABEND                                  09140000
                       DP013-NO-ROLLBACK                                09150000
                                   TO TRUE                              09160000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09170000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              09180000
                       MOVE PC-TSYMSG-01063                             09190000
                                   TO DP011-MSG-NUMBER                  09200000
                   ELSE                                                 09210000
                       MOVE PC-TSYMSG-01064                             09220000
                                   TO DP011-MSG-NUMBER                  09230000
                   END-IF                                               09240000
                   SET  DP011-MSG-FATAL                                 09250000
                                   TO TRUE                              09260000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09270000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09280000
           END-EVALUATE.                                                09290000
                                                                        09300000
       7800-CHECK-REGN-PRC.                                             09310000
                                                                        09320000
           EXEC SQL                                                     09330000
               SELECT  LOC_SKU_STAT_CDE                                 09340000
                     , UNT_RTL_AMT                                      09350000
                 INTO :XST00008-LOC-SKU-STAT-CDE                        09360000
                    , :XST00008-UNT-RTL-AMT                             09370000
                 FROM  XST_SKU_LOC                                      09380000
                WHERE  LOC_NBR        = :DK-STR-NBR                     09390000
                  AND  INTR_UPC_ID    = :XST00012-INTR-UPC-ID           09400000
                  AND  BEG_TMST      <= CURRENT TIMESTAMP               09410000
                  AND  (END_TMST      > CURRENT TIMESTAMP               09420000
                   OR   END_TMST     IS NULL)                           09430000
                 WITH  UR                                               09440000
           END-EXEC.                                                    09450000
                                                                        09460000
           EVALUATE SQLCODE                                             09470000
               WHEN ZERO                                                09480000
                   IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE          09481000
                       MOVE XST00008-UNT-RTL-AMT                        09482000
                                   TO PV-CUR-RTL-AMT                    09483000
                       MOVE +1     TO PV-GP-QTY                         09484000
                   END-IF                                               09485000
               WHEN +100                                                09486000
                   CONTINUE                                             09487000
               WHEN OTHER                                               09488000
                   MOVE '7800-CHECK-REGN-PRC'                           09489000
                                   TO DP013-PARAGRAPH                   09490000
                   MOVE 'SELECT DATA FROM XST_SKU_LOC'                  09500000
                                   TO DP013-MESSAGE-TEXT (1)            09510000
                   MOVE SQLCA      TO DP013-SQLCA                       09520000
                   MOVE 'XST_SKU_LOC'                                   09530000
                                   TO DP013-DB2-TABLE-NAME (1)          09540000
                   SET DP013-DB2-ABEND                                  09550000
                       DP013-ROLLBACK                                   09560000
                                   TO TRUE                              09570000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09580000
                   SET  DP011-MSG-FATAL                                 09590000
                                   TO TRUE                              09600000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              09610000
                       MOVE PC-TSYMSG-01063                             09620000
                                   TO DP011-MSG-NUMBER                  09630000
                   ELSE                                                 09640000
                       MOVE PC-TSYMSG-01064                             09650000
                                   TO DP011-MSG-NUMBER                  09660000
                   END-IF                                               09670000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09680000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09690000
           END-EVALUATE.                                                09700000
      *                                                                 09710000
      ******************************************************************09720000
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  09730000
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           09740000
      ******************************************************************09750000
       8000-SEND-DATA-TO-LISTENER.                                      09760000
           IF TF011-MQ-INDICATOR-Y                                      09770000
               PERFORM 8500-MQ-SETUP                                    09780000
               PERFORM 8510-MQ-SETUP-REMOTE                             09790000
               PERFORM 8520-PUT-QUEUE                                   09800000
               PERFORM 8600-CLOSE-PUT-Q                                 09810000
               PERFORM 8610-DISCONNECT-QMGR                             09820000
               PERFORM 9100-EXEC-CICS-RETURN                            09830000
           ELSE                                                         09840000
               PERFORM 8110-ENQ-TCPIPPRQ                                09850000
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      09860000
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      09870000
                                                                        09880000
      *MUST BE HERE                                                     09890000
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   09900000
      *MUST BE HERE                                                     09910000
               ADD 1               TO PV-NEXT-RECORD                    09920000
                                                                        09930000
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     09940000
                   MOVE 3          TO PV-NEXT-RECORD                    09950000
               END-IF                                                   09960000
                                                                        09970000
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    09980000
               PERFORM 8160-DEQ-TCPIPPRQ                                09990000
                                                                        10000000
               PERFORM 9100-EXEC-CICS-RETURN                            10010000
           END-IF.                                                      10020000
      *                                                                 10030000
      ******************************************************************10040000
       8110-ENQ-TCPIPPRQ.                                               10050000
           EXEC CICS                                                    10060000
               ENQ                                                      10070000
                   RESOURCE  (PV-TSQ-NAME)                              10080000
                   RESP      (PV-CICS-RESPONSE)                         10090000
           END-EXEC.                                                    10100000
                                                                        10110000
           EVALUATE TRUE                                                10120000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10130000
                   CONTINUE                                             10140000
               WHEN OTHER                                               10150000
                   MOVE '8110-ENQ-TCPIPPRQ'                             10160000
                                   TO DP013-PARAGRAPH                   10170000
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q10180000
      -                 'UEUE: '                                        10190000
                                   TO DP013-MESSAGE-TEXT (1)            10200000
                   MOVE PV-TSQ-NAME                                     10210000
                                   TO DP013-MESSAGE-TEXT (2)            10220000
                   SET DP013-CICS-ABEND                                 10230000
                       DP013-NO-ROLLBACK                                10240000
                                   TO TRUE                              10250000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10260000
                   PERFORM 9100-EXEC-CICS-RETURN                        10270000
           END-EVALUATE.                                                10280000
      *                                                                 10290000
      ******************************************************************10300000
       8120-READQ-TCPIPPRQ-RECORD1.                                     10310000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           10320000
                                   TO PV-TSQ-LENGTH.                    10330000
                                                                        10340000
           EXEC CICS                                                    10350000
               READQ TS                                                 10360000
                   QUEUE   (PV-TSQ-NAME)                                10370000
                   INTO    (PV-TCPIPPRQ-RECORD1)                        10380000
                   LENGTH  (PV-TSQ-LENGTH)                              10390000
                   ITEM    (1)                                          10400000
                   RESP    (PV-CICS-RESPONSE)                           10410000
           END-EXEC.                                                    10420000
                                                                        10430000
           EVALUATE TRUE                                                10440000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10450000
                   CONTINUE                                             10460000
               WHEN OTHER                                               10470000
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   10480000
                                   TO DP013-PARAGRAPH                   10490000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 10500000
      -                 'QUEUE: '                                       10510000
                                   TO DP013-MESSAGE-TEXT (1)            10520000
                   MOVE PV-TSQ-NAME                                     10530000
                                   TO DP013-MESSAGE-TEXT (2)            10540000
                   SET DP013-CICS-ABEND                                 10550000
                       DP013-NO-ROLLBACK                                10560000
                                   TO TRUE                              10570000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10580000
                   PERFORM 9100-EXEC-CICS-RETURN                        10590000
           END-EVALUATE.                                                10600000
      *                                                                 10610000
      ******************************************************************10620000
       8130-READQ-TCPIPPRQ-RECORD2.                                     10630000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           10640000
                                   TO PV-TSQ-LENGTH.                    10641000
                                                                        10642000
           EXEC CICS                                                    10643000
               READQ TS                                                 10644000
                   QUEUE   (PV-TSQ-NAME)                                10645000
                   INTO    (PV-TCPIPPRQ-RECORD2)                        10646000
                   LENGTH  (PV-TSQ-LENGTH)                              10647000
                   ITEM    (2)                                          10648000
                   RESP    (PV-CICS-RESPONSE)                           10649000
           END-EXEC.                                                    10650000
                                                                        10660000
           EVALUATE TRUE                                                10670000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10680000
                   CONTINUE                                             10690000
               WHEN OTHER                                               10700000
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   10710000
                                   TO DP013-PARAGRAPH                   10720000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 10730000
      -                 'QUEUE: '                                       10740000
                                   TO DP013-MESSAGE-TEXT (1)            10750000
                   MOVE PV-TSQ-NAME                                     10760000
                                   TO DP013-MESSAGE-TEXT (2)            10770000
                   SET DP013-CICS-ABEND                                 10780000
                       DP013-NO-ROLLBACK                                10790000
                                   TO TRUE                              10800000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10810000
                   PERFORM 9100-EXEC-CICS-RETURN                        10820000
           END-EVALUATE.                                                10830000
      *                                                                 10840000
      ******************************************************************10850000
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  10860000
           MOVE LENGTH OF TF012-XFER-TO-PTC-RECORD                      10870000
                                   TO  TF012-TOT-REC-LENGTH.            10880000
                                                                        10890000
           MOVE TF011-MATCHING-NBR-FIELD                                10900000
                                   TO  TF012-MATCHING-NBR-FIELD.        10910000
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     10920000
                                                                        10930000
           EXEC CICS                                                    10940000
               WRITEQ TS                                                10950000
                   QUEUE   (PV-TSQ-NAME)                                10960000
                   FROM    (TF012-XFER-TO-PTC-RECORD)                   10970000
                   LENGTH  (PV-TSQ-LENGTH)                              10980000
                   ITEM    (PV-ITEM-NBR)                                10990000
                       REWRITE                                          11000000
                   RESP    (PV-CICS-RESPONSE)                           11010000
           END-EXEC.                                                    11020000
                                                                        11030000
           EVALUATE TRUE                                                11040000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11050000
                   CONTINUE                                             11060000
               WHEN OTHER                                               11070000
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                11080000
                                   TO DP013-PARAGRAPH                   11090000
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA11100000
      -                 'STORAGE QUEUE: '                               11110000
                                   TO DP013-MESSAGE-TEXT (1)            11120000
                   MOVE PV-TSQ-NAME                                     11130000
                                   TO DP013-MESSAGE-TEXT (2)            11140000
                   SET DP013-CICS-ABEND                                 11150000
                       DP013-NO-ROLLBACK                                11160000
                                   TO TRUE                              11170000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11180000
                   PERFORM 9100-EXEC-CICS-RETURN                        11190000
           END-EVALUATE.                                                11200000
      *                                                                 11210000
      ******************************************************************11220000
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   11230000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           11240000
                                   TO PV-TSQ-LENGTH.                    11250000
           MOVE +1                 TO PV-ITEM-NBR.                      11260000
                                                                        11270000
           EXEC CICS                                                    11280000
               WRITEQ TS                                                11290000
                   QUEUE   (PV-TSQ-NAME)                                11300000
                   FROM    (PV-TCPIPPRQ-RECORD1)                        11310000
                   LENGTH  (PV-TSQ-LENGTH)                              11320000
                   ITEM    (PV-ITEM-NBR)                                11330000
                       REWRITE                                          11340000
                   RESP    (PV-CICS-RESPONSE)                           11350000
           END-EXEC.                                                    11360000
                                                                        11370000
           EVALUATE TRUE                                                11380000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11390000
                   CONTINUE                                             11400000
               WHEN OTHER                                               11410000
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 11420000
                                   TO DP013-PARAGRAPH                   11430000
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   11440000
                                   TO DP013-MESSAGE-TEXT (1)            11450000
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     11460000
                                   TO DP013-MESSAGE-TEXT (2)            11470000
                   MOVE PV-TSQ-NAME                                     11480000
                                   TO DP013-MESSAGE-TEXT (3)            11490000
                   MOVE PV-TCPIPPRQ-RECORD1                             11500000
                                   TO DP013-MESSAGE-TEXT (4)            11510000
                   SET DP013-CICS-ABEND                                 11520000
                       DP013-NO-ROLLBACK                                11530000
                                   TO TRUE                              11531000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11532000
                   PERFORM 9100-EXEC-CICS-RETURN                        11533000
           END-EVALUATE.                                                11534000
      *                                                                 11535000
      ******************************************************************11536000
       8160-DEQ-TCPIPPRQ.                                               11537000
           EXEC CICS                                                    11538000
               DEQ                                                      11539000
                   RESOURCE  (PV-TSQ-NAME)                              11540000
                   RESP      (PV-CICS-RESPONSE)                         11550000
           END-EXEC.                                                    11560000
                                                                        11570000
           EVALUATE TRUE                                                11580000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11590000
                   CONTINUE                                             11600000
               WHEN OTHER                                               11610000
                   MOVE '8160-DEQ-TCPIPPRQ'                             11620000
                                   TO DP013-PARAGRAPH                   11630000
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q11640000
      -                 'UEUE: '                                        11650000
                                   TO DP013-MESSAGE-TEXT (1)            11660000
                   MOVE PV-TSQ-NAME                                     11670000
                                   TO DP013-MESSAGE-TEXT (2)            11680000
                   SET DP013-CICS-ABEND                                 11690000
                       DP013-NO-ROLLBACK                                11700000
                                   TO TRUE                              11710000
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        11720000
                 PERFORM 9100-EXEC-CICS-RETURN                          11730000
           END-EVALUATE.                                                11740000
                                                                        11750000
       8500-MQ-SETUP.                                                   11760000
                                                                        11770000
      * DETERMINE THE SYSTEM                                            11780000
                                                                        11790000
           PERFORM EP000-0000-INITIALIZE.                               11800000
           IF EP000-PV-KOHLS-PROD-SYSTEM                                11810000
               SET PV-PROD-QMGR-NAME                                    11820000
                                   TO TRUE                              11830000
           ELSE                                                         11840000
                IF EP000-PV-KOHLS-QA-SYSTEM                             11850000
                    SET PV-QA-QMGR-NAME                                 11860000
                                   TO TRUE                              11870000
                ELSE                                                    11880000
                    SET PV-TEST-QMGR-NAME                               11890000
                                   TO TRUE                              11900000
                END-IF                                                  11910000
           END-IF.                                                      11920000
                                                                        11930000
      ***************************************************************   11940000
      *    CONNECT TO THE QUEUE MANAGER                                 11950000
      ***************************************************************   11960000
                                                                        11970000
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       11980000
           CALL WS-MQCONN USING PV-QM-NAME                              11990000
                                PV-HCONN                                12000000
                                PV-COMPLETION-CODE                      12010000
                                PV-REASON.                              12020000
                                                                        12030000
      ***************************************************************   12040000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              12050000
      *    AND EXIT                                                     12060000
      ***************************************************************   12070000
                                                                        12080000
           MOVE PV-REASON          TO PV-CON-REASON.                    12090000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12100000
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  12110000
               MOVE '8500-MQ-SETUP'                                     12120000
                                   TO DP013-PARAGRAPH                   12130000
               MOVE  PV-ERROR-MESSAGE                                   12140000
                                   TO DP013-MESSAGE-TEXT (1)            12150000
               MOVE  PV-COMPLETION-CODE                                 12160000
                                   TO DP013-MESSAGE-TEXT (2)            12170000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12180000
               SET DP013-CICS-ABEND                                     12190000
                   DP013-NO-ROLLBACK                                    12200000
                                   TO TRUE                              12201000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12202000
               PERFORM 9100-EXEC-CICS-RETURN                            12203000
           END-IF.                                                      12204000
                                                                        12205000
                                                                        12206000
       8510-MQ-SETUP-REMOTE.                                            12207000
      ***************************************************************   12208000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     12209000
      *    THIS IS A REMOTE QUEUE.                                      12210000
      ***************************************************************   12220000
                                                                        12230000
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      12240000
                                     MQOO-FAIL-IF-QUIESCING.            12250000
                                                                        12260000
           MOVE TF011-REPLYTOQ     TO MQOD-OBJECTNAME.                  12270000
           MOVE TF011-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12280000
                                                                        12290000
           CALL WS-MQOPEN USING PV-HCONN                                12300000
                                MQM-OBJECT-DESCRIPTOR                   12310000
                                PV-OPEN-OPTIONS                         12320000
                                PV-PQ-HANDLE                            12330000
                                PV-COMPLETION-CODE                      12340000
                                PV-REASON.                              12350000
                                                                        12360000
      ********************************************************          12370000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    12380000
      *    AND EXIT.                                                    12390000
      ********************************************************          12400000
      *                                                                 12410000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12420000
               PERFORM 8600-CLOSE-PUT-Q                                 12430000
               PERFORM 8610-DISCONNECT-QMGR                             12440000
               MOVE 'MQOPEN WRITE Q'                                    12450000
                                   TO PV-ERROR-MESSAGE                  12460000
               MOVE '8510-MQ-SETUP-REMOTE'                              12470000
                                   TO DP013-PARAGRAPH                   12480000
               MOVE  PV-ERROR-MESSAGE                                   12490000
                                   TO DP013-MESSAGE-TEXT (1)            12500000
               MOVE  PV-COMPLETION-CODE                                 12510000
                                   TO DP013-MESSAGE-TEXT (2)            12520000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12530000
               SET DP013-CICS-ABEND                                     12540000
                   DP013-NO-ROLLBACK                                    12550000
                                   TO TRUE                              12560000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12570000
               PERFORM 9100-EXEC-CICS-RETURN                            12580000
           END-IF.                                                      12590000
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          12600000
      *                                                                 12610000
      ******************************************************************12620000
       8520-PUT-QUEUE.                                                  12630000
           MOVE TF011-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12640000
           MOVE TF011-REPLYTOQ     TO MQOD-OBJECTNAME.                  12650000
           MOVE TF011-MSGID        TO MQMD-CORRELID.                    12660000
           MOVE MQMI-NONE          TO MQMD-MSGID.                       12670000
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      12680000
           MOVE 5000               TO MQMD-EXPIRY.                      12690000
           MOVE LENGTH OF TF012-XFER-TO-PTC-RECORD                      12700000
                                   TO PV-DATA-LENGTH.                   12710000
           MOVE TF012-XFER-TO-PTC-RECORD                                12720000
                                   TO PV-MSGBUFFER.                     12730000
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 12740000
                                                                        12750000
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      12760000
                                                                        12770000
                                                                        12780000
                                                                        12790000
           CALL WS-MQPUT USING PV-HCONN                                 12800000
                               PV-FMT-OPEN-OUTPUT-HNDL                  12810000
                               MQM-MESSAGE-DESCRIPTOR                   12820000
                               MQM-PUT-MESSAGE-OPTIONS                  12830000
                               PV-DATA-LENGTH                           12840000
                               PV-MSGBUFFER                             12850000
                               PV-COMPLETION-CODE                       12860000
                               PV-REASON.                               12870000
                                                                        12880000
      ***********************************************************       12890000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 12900000
      *        AND BREAK OUT OF LOOP                                    12910000
      ***********************************************************       12920000
                                                                        12930000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12940000
               MOVE PV-COMPLETION-CODE                                  12950000
                                   TO PH-COMPLETION-CODE                12960000
               MOVE PV-REASON      TO PH-REASON                         12970000
               PERFORM 8600-CLOSE-PUT-Q                                 12980000
               PERFORM 8610-DISCONNECT-QMGR                             12990000
               MOVE 'MQPUT ERR'    TO PV-ERROR-MESSAGE                  13000000
               MOVE '8520-PUT-QUEUE'                                    13010000
                                   TO DP013-PARAGRAPH                   13020000
               MOVE PV-ERROR-MESSAGE                                    13030000
                                   TO DP013-MESSAGE-TEXT (1)            13031000
               MOVE PH-COMPLETION-CODE                                  13032000
                                   TO DP013-MESSAGE-TEXT (2)            13033000
               MOVE PH-REASON      TO DP013-MESSAGE-TEXT (3)            13034000
               SET DP013-CICS-ABEND                                     13035000
                   DP013-NO-ROLLBACK                                    13036000
                                   TO TRUE                              13037000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          13038000
               PERFORM 9100-EXEC-CICS-RETURN                            13039000
           ELSE                                                         13040000
               SET PS-MQPUT-SUCCESSFUL                                  13050000
                                   TO TRUE                              13060000
           END-IF.                                                      13070000
      *                                                                 13080000
      ******************************************************************13090000
       8600-CLOSE-PUT-Q.                                                13100000
           CALL WS-MQCLOSE USING PV-HCONN                               13110000
                                 PV-PQ-HANDLE                           13120000
                                 MQCO-NONE                              13130000
                                 PV-COMPLETION-CODE                     13140000
                                 PV-REASON.                             13150000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   13160000
               MOVE 'MQCLOSE PQ HANDLE'                                 13170000
                                   TO PV-ERROR-MESSAGE                  13180000
               MOVE '8600-CLOSE-PUT-Q'                                  13190000
                                   TO DP013-PARAGRAPH                   13200000
               MOVE  PV-ERROR-MESSAGE                                   13210000
                                   TO DP013-MESSAGE-TEXT (1)            13220000
               MOVE  PV-COMPLETION-CODE                                 13230000
                                   TO DP013-MESSAGE-TEXT (2)            13240000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            13250000
               SET DP013-CICS-ABEND                                     13260000
                   DP013-NO-ROLLBACK                                    13270000
                                   TO TRUE                              13280000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          13290000
               PERFORM 9100-EXEC-CICS-RETURN                            13300000
           END-IF.                                                      13310000
      *                                                                 13320000
      ******************************************************************13330000
       8610-DISCONNECT-QMGR.                                            13340000
                                                                        13350000
           IF PV-CON-REASON IS NOT EQUAL                                13360000
                                  TO MQRC-ALREADY-CONNECTED             13361000
              CALL WS-MQDISC USING PV-HCONN                             13362000
                                   PV-COMPLETION-CODE                   13363000
                                   PV-REASON                            13364000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                13365000
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  13366000
                  MOVE '8610-DISCONNECT'                                13367000
                                   TO DP013-PARAGRAPH                   13368000
                  MOVE PV-ERROR-MESSAGE                                 13369000
                                   TO DP013-MESSAGE-TEXT (1)            13370000
                  MOVE PV-COMPLETION-CODE                               13380000
                                   TO DP013-MESSAGE-TEXT (2)            13390000
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            13400000
                  SET DP013-CICS-ABEND                                  13410000
                      DP013-NO-ROLLBACK                                 13420000
                                   TO TRUE                              13430000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       13440000
                  PERFORM 9100-EXEC-CICS-RETURN                         13450000
              END-IF                                                    13460000
           END-IF.                                                      13470000
                                                                        13480000
      *                                                                 13490000
      ******************************************************************13500000
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          13510000
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   13520000
      *    STREAM BEING SENT BACK TO THE PTC.                           13530000
      ******************************************************************13540000
       9000-FMT-ERR-MSG-TO-PTC.                                         13550000
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         13560000
           MOVE DP011-MSG-LEVEL    TO  TF012-ERR-TYP-IND.               13570000
           MOVE DP011-MSG-TEXT     TO  TF012-ERR-MSG.                   13580000
      *                                                                 13590000
       9100-EXEC-CICS-RETURN.                                           13600000
           EXEC CICS                                                    13610000
               RETURN                                                   13620000
           END-EXEC.                                                    13630000
      *                                                                 13640000
       9999-WRITE-CICS-LOG-MSG.                                         13650000
           MOVE PC-CURRENT-PROGRAM-NAME                                 13660000
                                   TO  DP013-PROGRAM.                   13670000
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  13680000
                                                                        13690000
           INITIALIZE DP013-SRC-TASK-NUMBER                             13700000
                      DP013-STACK.                                      13710000
                                                                        13720000
           SET DP013-LINK-RETURN   TO  TRUE.                            13730000
                                                                        13740000
           EXEC CICS                                                    13750000
               LINK                                                     13760000
                   PROGRAM   (DP013-NAME)                               13770000
                   COMMAREA  (DP013-PARAMETERS)                         13780000
                   LENGTH    (DP013-LENGTH)                             13790000
           END-EXEC.                                                    13800000
                                                                        13810000
      *                                                                 13820000
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           13830000
      *                                                                 13840000
                                                                        13850000
           COPY DPPD011.                                                13860000
      *                                                                 13870000
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     13880000
      *                                                                 13890000
                                                                        13900000
           COPY DPPD014.                                                13910000
                                                                        13920000
           COPY EPPD000.                                                13930000
