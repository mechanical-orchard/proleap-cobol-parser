000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    IQKCS413.                                         00040001
000500 AUTHOR.        BARB ERTL.                                        00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DECEMBER 2003.                                    00070001
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    I413 - TRANSACTION ITEM INQUIRY PROGRAM.                   * 00110002
001200*                                                               * 00120000
001300*    THIS PROGRAM DISPLAYS ALL ITEMS AND RETURN AMOUNTS THAT    * 00130002
001400*    ARE PART OF A PARTICULAR TRANSACTION                       * 00140002
001500*                                                               * 00150000
001600*----------------------------------------------------------------*00160071
001700* HISTORY LOG:                                                    00170068
001800*                                                                 00180068
001900* DATE: 09/06/13                                                  00190068
002000* WR/IR#: CHG0062728                                              00200068
002100* PROGRAMMER: COGNIZANT                                           00210068
002200* DESCRIPTION: REMOVED LOGIC THAT REFERENCING THE FOLLOWING       00220068
002300*              HISTORY TABLES.                                    00230068
002400*              TEPLIDH                                            00240068
002500*              TEPITMH                                            00250068
002600*---------------------------------------------------------------* 00260000
002700* DATE: 09/19/18                                                  00270071
002800* WR/IR#: CHG0208819                                              00280071
002900* PROGRAMMER: JIM HUNTER                                          00290071
003000* DESCRIPTION: MAINFRAME REFACTORING - REPLACE CGU042MC WITH      00300071
003100*              DPWS036 AND CGU040MC WITH DPPS036.                 00310071
003200*---------------------------------------------------------------* 00320071
003220* DATE:        09/14/2021                                         00322073
003230* WR/IR#:      CHG0261678                                         00323074
003240* PROGRAMMER:  GERMAN BANDA                                       00324073
003250* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00325073
003260*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00326073
003270*              MAKING THE CALL DYNAMIC VS STATIC                  00327073
003280*---------------------------------------------------------------* 00328073
CICS  * CHANGED 11/01/2022    BY JIM HUNTER      WR: CHG0277565         00329075
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00329175
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00329275
CICS  ******************************************************************00329375
003300                                                                  00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500                                                                  00350000
003600 DATA DIVISION.                                                   00360000
003700                                                                  00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900                                                                  00390000
004000 01  DB2-KEYS.                                                    00400000
004100     05  DK-STORE                       PIC S9(04)  VALUE ZERO    00410000
004200                                                    COMP.         00420000
004300     05  DK-REGISTER                    PIC S9(04)  VALUE ZERO    00430000
004400                                                    COMP.         00440000
004500     05  DK-TRANS                       PIC S9(04)  VALUE ZERO    00450000
004600                                                    COMP.         00460000
004700     05  DK-PARTITION                   PIC S9(04)  VALUE ZERO    00470000
004800                                                    COMP.         00480000
004900     05  DK-DB-STRUC-CDE                PIC  X(01)  VALUE SPACE.  00490021
005000     05  DK-SALES-DATE-ISO              PIC  X(10)  VALUE SPACE.  00500021
005100     05  DK-START-TIME                  PIC  X(08)  VALUE SPACE.  00510000
005200     05  DK-SALES-CORR-SEQ-NBR          PIC S9(04)  VALUE ZERO    00520000
005300                                                    COMP.         00530000
005400                                                                  00540000
005500 01  PC-PROGRAM-CONSTANTS.                                        00550000
005600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00560000
005700                                                    'IQ413A  '.   00570002
005800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00580000
005900                                                    'IQKM413 '.   00590002
006000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00600000
006100                                                    'IQKCS413'.   00610001
006200     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00620000
006300     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE ' '.    00630010
006400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00640030
006500                                                    COMP SYNC.    00650000
006600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00660000
006700                                                    COMP SYNC.    00670000
006800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00680000
006900                                                    +1000000      00690000
007000                                                    COMP-3.       00700000
007100     05  PC-MAX-LIDS                    PIC S9(09)  VALUE         00710006
007200                                                    +100          00720006
007300                                                    COMP-3.       00730006
007400     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00740000
007500                                                     COMP-3.      00750000
007600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00760000
007700                                                    COMP SYNC.    00770000
007800                                                                  00780000
007900 01  PC-TSYMSG-NUMBERS.                                           00790000
008000     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00800000
008100     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00810000
008200     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00820000
008300     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00830000
008400     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00840000
008500     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00850035
008600     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00860000
008700                                                                  00870000
008800 01  PS-PROGRAM-SWITCHES.                                         00880000
008900     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00890000
009000         88  PS-NO-ERROR                             VALUE 'Y'.   00900000
009100         88  PS-ERROR                                VALUE 'N'.   00910000
009200     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   00920000
009300         88  PS-COMMAREA-VALID                       VALUE 'Y'.   00930000
009400         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00940000
009500     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00950000
009600         88  PS-LIST-END                             VALUE 'Y'.   00960000
009700         88  PS-NO-LIST-END                          VALUE 'N'.   00970000
009800     05  PS-LIDS-LEFT-INDICATOR         PIC  X(01).               00980006
009900         88  PS-LIDS-LEFT-ON-DB                     VALUE 'Y'.    00990006
010000         88  PS-NO-LIDS-LEFT-ON-DB                  VALUE 'N'.    01000006
010100                                                                  01010000
010200 01  PV-PROGRAM-VARIABLES.                                        01020000
010300     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01030000
010400                                                     COMP SYNC.   01040000
010500     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01050000
010600                                                     COMP-3.      01060000
010700     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01070000
010800                                                     COMP-3.      01080000
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01090000
011000                                                     COMP-3.      01100000
011100     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01110000
011200                                                     COMP SYNC.   01120000
011300     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01130000
011400                                                     COMP SYNC.   01140000
011500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01150000
011600                                                     COMP SYNC.   01160000
011700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01170000
011800                                                     COMP SYNC.   01180000
011900     05  PV-RETRY-COUNTER               PIC S9(04)   VALUE ZERO   01190000
012000                                                     COMP SYNC.   01200000
012100     05  PV-SUB                         PIC S9(04) VALUE ZERO     01210000
012200                                                   COMP SYNC.     01220000
012300     05  PV-RETURN-AMT                  PIC  9(07)V99 VALUE 0.    01230004
012400                                                                  01240000
012500     05  PV-LID-COUNT                   PIC S9(09)  VALUE +0      01250006
012600                                                    COMP-3.       01260006
012700     05  PV-LID-PCT                     PIC S9(03) COMP-3 VALUE 0.01270004
012800     05  PV-SKU-DISPLAY                 PIC  9(08).               01280017
012900     05  PV-SKU-DISPLAY-X REDEFINES PV-SKU-DISPLAY                01290017
013000                                        PIC  X(08).               01300017
013100     05  PV-NOTE                        PIC X(30).                01310004
013200     05  PV-NOTE-R REDEFINES PV-NOTE.                             01320004
013300         10  PV-NOTE-1                  PIC X(10).                01330004
013400         10  PV-NOTE-2                  PIC X(10).                01340004
013500         10  PV-NOTE-3                  PIC X(10).                01350004
013600     05  PV-NOTE-MORE-DISCOUNTS         PIC X(10)                 01360004
013700                                            VALUE 'MORE DISC'.    01370004
013800     05  PV-NOTE-BOGO                   PIC X(10)                 01380004
013900                                            VALUE 'BOGO     '.    01390004
014000     05  PV-OFFERS-BWP                  PIC X(10)                 01400066
014100                                            VALUE 'OFFERS BWP'.   01410066
014200     05  PV-NOTE-DLR-OFF.                                         01420004
014300         10  FILLER                     PIC X(04)                 01430004
014400                                            VALUE 'MKDN'.         01440004
014500         10  PV-NOTE-DLR-OFF-DLR        PIC $$$.99.               01450004
014600     05  PV-NOTE-PCT-OFF.                                         01460004
014700         10  FILLER                     PIC X(04)                 01470004
014800                                            VALUE 'MKDN'.         01480004
014900         10  PV-NOTE-PCT-OFF-PCT        PIC ZZZ.                  01490004
015000         10  FILLER                     PIC X(03)                 01500004
015100                                            VALUE '%  '.          01510004
015200     05  PV-NOTE-TTL-DLR-OFF.                                     01520004
015300         10  FILLER                     PIC X(04)                 01530004
015400                                            VALUE 'TTL '.         01540004
015500         10  PV-NOTE-TTL-DLR            PIC $$$.99.               01550004
015600     05  PV-NOTE-TTL-PCT-OFF.                                     01560004
015700         10  FILLER                     PIC X(04)                 01570004
015800                                            VALUE 'TTL '.         01580004
015900         10  PV-NOTE-TTL-PCT            PIC ZZZ.                  01590004
016000         10  FILLER                     PIC X(03)                 01600004
016100                                            VALUE '%  '.          01610004
016200     05  PV-NOTE-SCD-OFF.                                         01620004
016300         10  FILLER                     PIC X(04)                 01630004
016400                                            VALUE 'SCD '.         01640004
016500         10  PV-NOTE-SCD-PCT            PIC ZZZ.                  01650004
016600         10  FILLER                     PIC X(03)                 01660004
016700                                            VALUE '%  '.          01670004
016800     05  PV-TIME.                                                 01680054
016900         10  PV-TIME-HH                 PIC  9(02) VALUE ZERO.    01690054
017000         10  FILLER                     PIC  X(01).               01700054
017100         10  PV-TIME-MM                 PIC  9(02) VALUE ZERO.    01710054
017200         10  FILLER                     PIC  X(03).               01720054
017300                                                                  01730056
017400     05  PV-TIME-A-P                    PIC  X(01) VALUE SPACE.   01740054
017500                                                                  01750056
017600     05  PV-SALES-DATE.                                           01760056
017700         10  PV-SALES-DATE-MM           PIC  X(02) VALUE ZERO.    01770059
017800         10  FILLER                     PIC  X(01) VALUE '/'.     01780056
017900         10  PV-SALES-DATE-DD           PIC  X(02) VALUE ZERO.    01790059
018000         10  FILLER                     PIC  X(01) VALUE '/'.     01800056
018100         10  PV-SALES-DATE-YY           PIC  X(02) VALUE ZERO.    01810059
018200                                                                  01820056
018300                                                                  01830004
018400     05  PV-BASE-NUMBER                 PIC 9(17) VALUE 0.        01840049
018500     05  PV-BASE-NUMBER-NBR   REDEFINES  PV-BASE-NUMBER.          01850045
018600         10  PV-BASE-MM           PIC  9(02).                     01860045
018700         10  PV-BASE-DD           PIC  9(02).                     01870045
018800         10  PV-BASE-YY           PIC  9(02).                     01880045
018900         10  PV-BASE-STR-NBR      PIC  9(04).                     01890045
019000         10  PV-BASE-REG-NBR      PIC  9(02).                     01900048
019100         10  PV-BASE-TRAN-NBR     PIC  9(04).                     01910045
019200         10  PV-BASE-CHK-DIG      PIC  9(01).                     01920048
019300                                                                  01930045
019400*---------------------------------------------------------------* 01940000
019500*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01950075
019600*---------------------------------------------------------------* 01960000
019700                                                                  01970000
019800     COPY DPWS030.                                                01980000
CICS       COPY DPWS930.                                                01981075
019900                                                                  01990002
020000*---------------------------------------------------------------* 02000000
020100*    STANDARD COMMAREA.                                         * 02010000
020200*---------------------------------------------------------------* 02020000
020300                                                                  02030000
020400     COPY DPWS020.                                                02040000
020500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02050000
020600                                                                  02060000
020700*---------------------------------------------------------------* 02070000
020800*    INTER-APPLICATION COMMAREA.                                * 02080000
020900*---------------------------------------------------------------* 02090000
021000                                                                  02100000
021100         10  INTER-APPL-COMM-AREA       PIC X(200).               02110000
021200     COPY IQWS004.                                                02120002
021300                                                                  02130000
021400*---------------------------------------------------------------* 02140000
021500*    SPECIFIC COMMMAREA FOR IQKCS413.                           * 02150001
021600*---------------------------------------------------------------* 02160000
021700         10  ASC-SPECIFIC-COMMAREA.                               02170000
021800             15  ASC-LIST-KEYS.                                   02180000
021900                 20  ASC-KEY-PARTITION               PIC S9(04)   02190000
022000                                                           COMP.  02200000
022100                 20  ASC-KEY-DB-STRUC-CDE            PIC  X(01).  02210021
022200                 20  ASC-KEY-SALES-DATE-ISO          PIC  X(10).  02220000
022300                 20  ASC-KEY-SALES-DATE-DISPLAY      PIC  X(10).  02230025
022400                 20  ASC-KEY-STORE                   PIC  9(05).  02240000
022500                 20  ASC-KEY-REGISTER                PIC  9(04).  02250000
022600                 20  ASC-KEY-TRANSACTION             PIC  9(04).  02260000
022700                 20  ASC-CDIG                        PIC  9(01).  02270036
022800                 20  ASC-KEY-START-TIME              PIC  X(08).  02280000
022900                 20  ASC-KEY-SALES-CORR-SEQ-NBR      PIC S9(04)   02290000
023000                                                           COMP.  02300000
023100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02310000
023200                 20  ASC-ITEM-ARRAY.                              02320000
023300                                                                  02330000
023400                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02340013
023500                         30  ASC-LIST-ITEM-NUMBER                 02350000
023600                                                     PIC S9(09)   02360000
023700                                                     COMP-3.      02370000
023800                         30  ASC-SKU                 PIC  X(08).  02380018
023900                         30  ASC-SKU-N REDEFINES ASC-SKU          02390000
024000                                                     PIC  9(08).  02400018
024100                         30  ASC-SKU-DESC            PIC  X(20).  02410002
024200                         30  ASC-SOLD-QUANTITY       PIC  X(02).  02420000
024300                         30  ASC-SOLD-QUANTITY-N     REDEFINES    02430000
024400                                 ASC-SOLD-QUANTITY   PIC  9(02).  02440000
024500                         30  ASC-RETURN-AMT-N                     02450002
024600                                                  PIC S9(5)V9(2)  02460000
024700                                                      COMP-3.     02470000
024800                         30  ASC-NOTE               PIC  X(27).   02480006
024900                                                                  02490000
025000             15  ASC-BLK-SUB                         PIC S9(04)   02500000
025100                                                         COMP     02510000
025200                                                         SYNC.    02520000
025300             15  ASC-ITEM-SUB                        PIC S9(04)   02530000
025400                                                         COMP     02540000
025500                                                         SYNC.    02550000
025600             15  ASC-SEL-SUB                         PIC S9(04)   02560000
025700                                                         COMP.    02570000
025800             15  ASC-SEL-ITEM                        PIC S9(04)   02580000
025900                                                         COMP.    02590000
026000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02600000
026100                                                         COMP-3.  02610000
026200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02620000
026300                                                         COMP-3.  02630000
026400             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02640000
026500                                                         COMP-3.  02650000
026600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02660000
026700                                                         COMP-3.  02670000
026800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02680000
026900                                                         COMP-3.  02690000
027000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02700000
027100                                                         COMP-3.  02710000
027200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02720000
027300                                                         COMP     02730000
027400                                                         SYNC.    02740000
027500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02750000
027600                                                         COMP-3.  02760000
027700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02770000
027800                                                         COMP-3.  02780000
027900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02790000
028000                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 02800000
028100                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 02810000
028200             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02820000
028300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02830000
028400             15  ASC-LIST-QUEUE-NAME.                             02840000
028500                 20  ASC-LIST-TERM-ID                PIC  X(04).  02850000
028600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02860000
028700                                                         COMP-3.  02870000
028800                 20  ASC-LIST-SEQ                    PIC  9(01).  02880000
028900             15  ASC-SEL-QUEUE-NAME.                              02890000
029000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  02900000
029100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   02910000
029200                                                          COMP-3. 02920000
029300                 20  ASC-SEL-SEQ                     PIC  9(01).  02930000
029400             15  ASC-DTL-QUEUE-NAME.                              02940000
029500                 20  ASC-DTL-TERM-ID                 PIC  X(04).  02950000
029600                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   02960000
029700                                                         COMP-3.  02970000
029800                 20  ASC-DTL-SEQ                     PIC  9(01).  02980000
029900                                                                  02990000
030000             15  ASC-START-ITEM-REQUEST.                          03000000
030100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03010000
030200             15  ASC-TRAN-SEL-SUB                    PIC  9(02).  03020000
030300             15  ASC-NBR-OF-TRAN-SEL-ITEMS           PIC S9(09)   03030000
030400                                                     COMP-3.      03040000
030500             15  ASC-NBR-OF-TRAN-TS-ITEMS            PIC S9(05)   03050000
030600                                                     COMP-3.      03060000
030700             15  ASC-TRAN-SEL-QUEUE-NAME             PIC  X(08).  03070000
030800             15  ASC-TRAN-SEL-ITEM                   PIC S9(04)   03080000
030900                                                     COMP SYNC.   03090000
031000         10  FILLER                                  PIC  X(871). 03100036
031100                                                                  03110000
031200*----------------------------------------------------------------*03120000
031300*  RECORD LAYOUT FOR THE TRAN SELECTION TEMP STORAGE QUEUE       *03130000
031400*----------------------------------------------------------------*03140000
031500                                                                  03150000
031600     COPY IQWS003.                                                03160002
031700                                                                  03170000
031800*---------------------------------------------------------------* 03180000
031900*    ABEND PROCESSING COPYBOOK.                                 * 03190000
032000*---------------------------------------------------------------* 03200000
032100                                                                  03210000
032200     COPY DPWS013.                                                03220000
032300                                                                  03230000
032400*---------------------------------------------------------------* 03240000
032500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03250000
032600*---------------------------------------------------------------* 03260000
032700                                                                  03270000
032800     COPY DPWS015.                                                03280000
032900                                                                  03290000
033000*---------------------------------------------------------------* 03300000
033100*    FUNCTION KEYS COPYBOOK.                                    * 03310000
033200*---------------------------------------------------------------* 03320000
033300                                                                  03330000
033400     COPY DPWS016.                                                03340000
033500                                                                  03350000
033600*---------------------------------------------------------------* 03360000
033700*    NUMERIC EDIT LAYOUT.                                       * 03370000
033800*---------------------------------------------------------------* 03380000
033900                                                                  03390000
034000     COPY DPWS010I.                                               03400000
034100                                                                  03410000
034200*---------------------------------------------------------------* 03420000
034300*    MAP LAYOUT                                                 * 03430000
034400*---------------------------------------------------------------* 03440000
034500                                                                  03450000
034600     COPY IQKM413.                                                03460002
034700                                                                  03470000
034800 01  MR-OCCURS-LAYOUT          REDEFINES  IQ413AO.                03480002
034900     05  FILLER                PIC X(108).                        03490053
035000     05  MR-SCROLL-AREA OCCURS 14 TIMES.                          03500002
035100                                                                  03510000
035200         10  MR-SKUL                    PIC S9(04) COMP.          03520012
035300         10  MR-SKUA                    PIC  X(01).               03530012
035400         10  MR-SKUC                    PIC  X(01).               03540012
035500         10  MR-SKUH                    PIC  X(01).               03550012
035600         10  MR-SKU                     PIC  X(08).               03560017
035700                                                                  03570012
035800         10  MR-SKUDESCL                PIC S9(04) COMP.          03580012
035900         10  MR-SKUDESCA                PIC  X(01).               03590012
036000         10  MR-SKUDESCC                PIC  X(01).               03600012
036100         10  MR-SKUDESCH                PIC  X(01).               03610012
036200         10  MR-SKU-DESC                PIC  X(20).               03620002
036300                                                                  03630012
036400         10  MR-UNITSL                  PIC S9(04) COMP.          03640012
036500         10  MR-UNITSA                  PIC  X(01).               03650012
036600         10  MR-UNITSC                  PIC  X(01).               03660012
036700         10  MR-UNITSH                  PIC  X(01).               03670012
036800         10  MR-UNITS                   PIC  Z(02).               03680017
036900                                                                  03690012
037000         10  MR-AMOUNTL                 PIC S9(04) COMP.          03700012
037100         10  MR-AMOUNTA                 PIC  X(01).               03710012
037200         10  MR-AMOUNTC                 PIC  X(01).               03720012
037300         10  MR-AMOUNTH                 PIC  X(01).               03730012
037400         10  MR-AMOUNT                  PIC  ZZZZZZZ.ZZ.          03740004
037500                                                                  03750012
037600         10  MR-NOTEL                   PIC S9(04) COMP.          03760012
037700         10  MR-NOTEA                   PIC  X(01).               03770012
037800         10  MR-NOTEC                   PIC  X(01).               03780012
037900         10  MR-NOTEH                   PIC  X(01).               03790012
038000         10  MR-NOTE                    PIC  X(27).               03800002
038100                                                                  03810000
038200******************************************************************03820045
038300* CREATE/VERIFY CHECK DIGIT ROUTINE WORKING STORAGE              *03830045
038400******************************************************************03840045
038500     COPY DPWS036.                                                03850071
038600                                                                  03860045
038700*---------------------------------------------------------------* 03870000
038800*    DB2 AREA FOR TEPITM (ITEM TABLE)                           * 03880000
038900*---------------------------------------------------------------* 03890000
039000     EXEC SQL                                                     03900000
039100          INCLUDE TEPITM                                          03910000
039200     END-EXEC.                                                    03920000
039300                                                                  03930000
039400*---------------------------------------------------------------* 03940000
039500*    DB2 AREA FOR LID (LINE ITEM DISCOUNT TABLE)                * 03950000
039600*---------------------------------------------------------------* 03960000
039700     EXEC SQL                                                     03970000
039800         INCLUDE TEPLID                                           03980000
039900     END-EXEC.                                                    03990000
040000                                                                  04000000
040100*---------------------------------------------------------------* 04010000
040200*    DB2 AREA FOR XST_SKU (DOMAIN SKU TABLE)                    * 04020002
040300*---------------------------------------------------------------* 04030000
040400     EXEC SQL                                                     04040000
040500         INCLUDE XST00010                                         04050002
040600     END-EXEC.                                                    04060000
040700                                                                  04070000
040800*---------------------------------------------------------------* 04080000
040900*    DB2 AREA FOR COMMUNICATIONS                                * 04090000
041000*---------------------------------------------------------------* 04100000
041100     EXEC SQL                                                     04110000
041200          INCLUDE SQLCA                                           04120000
041300     END-EXEC.                                                    04130000
041400                                                                  04140000
041500*---------------------------------------------------------------* 04150000
041600*    THIS CURSOR WILL RETRIEVE ITEMS FROM THE OPERATIONAL TABLE * 04160021
041700*---------------------------------------------------------------* 04170000
041800                                                                  04180000
041900     EXEC SQL                                                     04190000
042000          DECLARE ITEMS CURSOR FOR                                04200002
042100          SELECT                                                  04210002
042200                A.SKU_NBR                                         04220002
042300              , SKU_DESC                                          04230002
042400              , SLD_QTY                                           04240000
042500              , CUST_CHRGD_AMT                                    04250000
042600              , LNE_ITM_SEQ_NBR                                   04260002
042700            FROM TEPITM A                                         04270002
042800                ,XST_SKU B                                        04280002
042900                WHERE A.SKU_NBR         = B.SKU_NBR               04290002
043000                  AND  PARTN_NBR        = :DK-PARTITION           04300002
043100                  AND  STR_NBR          = :DK-STORE               04310000
043200                  AND  RGST_ID          = :DK-REGISTER            04320000
043300                  AND  TRN_NBR          = :DK-TRANS               04330000
043400                  AND  STRT_TM          = :DK-START-TIME          04340000
043500                  AND  SLS_CORR_SEQ_NBR = :DK-SALES-CORR-SEQ-NBR  04350002
043600                  AND  LIV_RSLU_CDE     = '+'                     04360002
043700          WITH UR                                                 04370021
043800     END-EXEC.                                                    04380021
043900                                                                  04390000
044000*----------------------------------------------------------------*04400000
044100*     THIS CURSOR WILL RETRIEVE ITEM LEVEL DISCOUNTS             *04410002
044200*     FROM THE OPERATIONAL TABLES.                               *04420000
044300*----------------------------------------------------------------*04430000
044400                                                                  04440000
044500     EXEC SQL                                                     04450000
044600         DECLARE DISCOUNT-CSR CURSOR FOR                          04460002
044700             SELECT  LID_TYP_CDE                                  04470002
044800                   , LID_AMT                                      04480002
044900                   , LID_PCT                                      04490002
045000             FROM    TEPLID                                       04500002
045100             WHERE   PARTN_NBR        = :DK-PARTITION             04510000
045200               AND   STR_NBR          = :DK-STORE                 04520000
045300               AND   RGST_ID          = :DK-REGISTER              04530000
045400               AND   TRN_NBR          = :DK-TRANS                 04540000
045500               AND   STRT_TM          = :DK-START-TIME            04550000
045600               AND   SLS_CORR_SEQ_NBR = :DK-SALES-CORR-SEQ-NBR    04560000
045700               AND   LNE_ITM_SEQ_NBR  = :EPITM-LNE-ITM-SEQ-NBR    04570002
045800               AND   LID_TYP_CDE NOT IN ('R','E','G')             04580066
045900             WITH UR                                              04590021
046000     END-EXEC.                                                    04600021
046100                                                                  04610000
046200 LINKAGE SECTION.                                                 04620000
046300                                                                  04630000
046400 01  DFHCOMMAREA.                                                 04640000
046500     05  FILLER                         OCCURS  1 TO 4072 TIMES   04650000
046600                                        DEPENDING ON EIBCALEN.    04660000
046700         10  FILLER                     PIC X.                    04670000
046800                                                                  04680000
046900 PROCEDURE DIVISION.                                              04690000
047000                                                                  04700000
047100 0000-MAIN-MODULE.                                                04710000
047200                                                                  04720000
047300     INITIALIZE DP030-CICS-API-FIELDS.                            04730000
047400     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        04740000
047500     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           04750000
047600     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          04760000
047700     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        04770000
047800     MOVE LENGTH OF IQ413AI       TO DP030-MAP-LENGTH (1).        04780002
047900     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      04790000
048000     PERFORM 0001-CALL-CICS-ARCH-API.                             04800000
048100                                                                  04810000
048200     PERFORM 1000-CONTROL-PROCESSING.                             04820000
048300                                                                  04830000
048400     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      04840000
048500     PERFORM 0001-CALL-CICS-ARCH-API.                             04850000
048600                                                                  04860000
048700*----------------------------------------------------------------*04870000
048800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *04880000
048900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *04890000
049000*----------------------------------------------------------------*04900000
049100                                                                  04910000
049200 0001-CALL-CICS-ARCH-API.                                         04920000
049300                                                                  04930000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04940075
049500                                    DFHCOMMAREA                   04950075
049600                                    DP030-CICS-API-FIELDS         04960075
049700                                    DP020-STANDARD-COMMAREA       04970075
049800                                    IQ413AI.                      04980075
049900                                                                  04990000
050000     IF  DP030-RC-CALL-SUCCESSFUL                                 05000000
050100         CONTINUE                                                 05010000
050200     ELSE                                                         05020000
050300         SET DP013-NO-ROLLBACK TO TRUE                            05030000
050400         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   05040000
050500         SET DP013-CICS-ABEND TO TRUE                             05050000
050600         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        05060000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05061075
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05062075
050900         MOVE DP030-RETURN-CODE                                   05090000
051000                               TO DP013-MESSAGE-TEXT (3)          05100000
051100         PERFORM DP013-0000-PROCESS-ABEND                         05110000
051200     END-IF.                                                      05120000
051300                                                                  05130000
051400*----------------------------------------------------------------*05140000
051500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05150000
051600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05160000
051700*                                                                *05170000
051800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05180000
051900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05190000
052000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05200000
052100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05210000
052200*----------------------------------------------------------------*05220000
052300                                                                  05230000
052400 1000-CONTROL-PROCESSING.                                         05240000
052500                                                                  05250000
052600     EVALUATE TRUE                                                05260000
052700         WHEN DP020-NEXT-ACT-INITIAL                              05270000
052800             MOVE EIBTRMID          TO ASC-DTL-TERM-ID            05280000
052900             MOVE DP020-SRC-TASK-NUMBER                           05290000
053000                                    TO ASC-DTL-TASK-NUMBER        05300000
053100             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                05310000
053200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05320000
053300***-----$TEMPLATE NOTE$-------------------------------------------05330000
053400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05340000
053500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05350000
053600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05360000
053700***---------------------------------------------------------------05370000
053800                                                                  05380000
053900             IF PS-COMMAREA-NOT-VALID                             05390034
054000                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            05400034
054100             ELSE                                                 05410034
054200                 PERFORM 2050-DELETE-DETAIL-QUEUE                 05420034
054300                 PERFORM 4000-BUILD-INITIAL-PANEL                 05430034
054400             END-IF                                               05440034
054500                                                                  05450000
054600         WHEN DP020-NEXT-ACT-READ-MAP                             05460000
054700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05470000
054800                               TO PV-TOP-ITEM                     05480000
054900             PERFORM 2000-PROCESS-PANEL                           05490000
055000                                                                  05500000
055100         WHEN DP020-NEXT-ACT-RETURN                               05510000
055200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05520000
055300                               TO PV-TOP-ITEM                     05530000
055400             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        05540000
055500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05550000
055600                                                                  05560000
055700         WHEN OTHER                                               05570000
055800             SET DP013-LOGIC-ABEND TO TRUE                        05580000
055900             SET DP013-NO-ROLLBACK TO TRUE                        05590000
056000             MOVE '1000-CONTROL-PROCESSING'                       05600000
056100                               TO  DP013-PARAGRAPH                05610000
056200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05620000
056300                               TO  DP013-MESSAGE-TEXT(1)          05630000
056400             PERFORM DP013-0000-PROCESS-ABEND                     05640000
056500     END-EVALUATE.                                                05650000
056600                                                                  05660000
056700*----------------------------------------------------------------*05670000
056800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05680000
056900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05690000
057000*----------------------------------------------------------------*05700000
057100                                                                  05710000
057200 1100-PROCESS-INTER-APPL-COMM.                                    05720000
057300                                                                  05730000
057400     SET PS-COMMAREA-VALID     TO TRUE.                           05740000
057500     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05750032
057600     MOVE SPACE                TO ASC-START-ITEM-REQUEST.         05760000
057700     EVALUATE TRUE                                                05770000
057800         WHEN DP020-INT-APPL-FORMAT-IND                           05780000
057900                                   = PC-LIST-FORMAT               05790000
058000             SET ASC-USE-SELECTION-QUEUE TO TRUE                  05800034
058100             MOVE IQ004-NUMBER-OF-SELECTED-ITEMS                  05810002
058200                                   TO ASC-NBR-OF-TRAN-SEL-ITEMS   05820000
058300             MOVE IQ004-NUMBER-OF-TS-ITEMS                        05830002
058400                                   TO ASC-NBR-OF-TRAN-TS-ITEMS    05840000
058500             MOVE IQ004-SEL-QUEUE-NAME                            05850002
058600                                   TO ASC-TRAN-SEL-QUEUE-NAME     05860000
058700             PERFORM 1120-PREPARE-LIST-ENTRY                      05870000
058800                                                                  05880000
058900         WHEN OTHER                                               05890000
059000             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             05900034
059100             SET DP020-MSG-FATAL                                  05910034
059200                 DP020-NEXT-ACT-APPL-ERROR TO TRUE                05920034
059300                                                                  05930000
059400     END-EVALUATE.                                                05940000
059500                                                                  05950000
059600*----------------------------------------------------------------*05960000
059700*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *05970000
059800*----------------------------------------------------------------*05980000
059900                                                                  05990000
060000 1120-PREPARE-LIST-ENTRY.                                         06000000
060100                                                                  06010000
060200     MOVE IQ003-MAX-ITEMS TO ASC-TRAN-SEL-SUB.                    06020002
060300     MOVE ZERO            TO ASC-TRAN-SEL-ITEM.                   06030000
060400     PERFORM 2140-GET-NEXT-TRAN.                                  06040031
060500                                                                  06050002
060600*----------------------------------------------------------------*06060000
060700*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *06070000
060800*    ON WHAT FUNCTION KEY WAS SELECTED.                          *06080000
060900*----------------------------------------------------------------*06090000
061000                                                                  06100000
061100 2000-PROCESS-PANEL.                                              06110000
061200                                                                  06120000
061300     EVALUATE TRUE                                                06130000
061400         WHEN DP020-SRC-AID = DP016-CLEAR                         06140000
061500             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06150000
061600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06160000
061700             PERFORM 3200-RESET-ATTRIBUTES                        06170000
061800                                                                  06180000
061900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06190000
062000             MOVE ASC-KEY-PARTITION                               06200000
062100                                   TO DK-PARTITION                06210000
062200             MOVE ASC-KEY-DB-STRUC-CDE                            06220021
062300                                   TO DK-DB-STRUC-CDE             06230021
062400             MOVE ASC-KEY-SALES-DATE-ISO                          06240021
062500                                   TO DK-SALES-DATE-ISO           06250021
062600             MOVE ASC-KEY-STORE                                   06260000
062700                                   TO DK-STORE                    06270000
062800             MOVE ASC-KEY-REGISTER                                06280000
062900                                   TO DK-REGISTER                 06290000
063000             MOVE ASC-KEY-TRANSACTION                             06300000
063100                                   TO DK-TRANS                    06310000
063200             MOVE ASC-KEY-START-TIME                              06320000
063300                                   TO DK-START-TIME               06330000
063400             MOVE ASC-KEY-SALES-CORR-SEQ-NBR                      06340000
063500                                   TO DK-SALES-CORR-SEQ-NBR       06350000
063600             PERFORM 2050-DELETE-DETAIL-QUEUE                     06360000
063700             PERFORM 4000-BUILD-INITIAL-PANEL                     06370000
063800             PERFORM 3200-RESET-ATTRIBUTES                        06380000
063900                                                                  06390000
064000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06400000
064100             IF  ASC-USE-SELECTION-QUEUE                          06410000
064200                 PERFORM 2140-GET-NEXT-TRAN                       06420031
064300                 IF PS-LIST-END                                   06430000
064400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06440000
064500                     SET PS-NO-LIST-END TO TRUE                   06450000
064600                 ELSE                                             06460000
064700                     PERFORM 2050-DELETE-DETAIL-QUEUE             06470000
064800                     PERFORM 4000-BUILD-INITIAL-PANEL             06480000
064900                 END-IF                                           06490000
065000                 PERFORM 3200-RESET-ATTRIBUTES                    06500000
065100             ELSE                                                 06510000
065200                 MOVE PC-TSYMSG-00070                             06520000
065300                                  TO DP020-MSG-NUMBER             06530000
065400                 SET DP020-MSG-INFORMATIONAL TO TRUE              06540000
065500             END-IF                                               06550000
065600                                                                  06560000
065700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06570000
065800             IF  ASC-USE-SELECTION-QUEUE                          06580000
065900                 PERFORM 2150-GET-PREV-TRAN                       06590031
066000                 IF PS-LIST-END                                   06600000
066100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06610000
066200                     SET PS-NO-LIST-END TO TRUE                   06620000
066300                 ELSE                                             06630000
066400                     PERFORM 2050-DELETE-DETAIL-QUEUE             06640000
066500                     PERFORM 4000-BUILD-INITIAL-PANEL             06650000
066600                 END-IF                                           06660000
066700                 PERFORM 3200-RESET-ATTRIBUTES                    06670000
066800             ELSE                                                 06680000
066900                 MOVE PC-TSYMSG-00069                             06690000
067000                                  TO DP020-MSG-NUMBER             06700000
067100                 SET DP020-MSG-INFORMATIONAL TO TRUE              06710000
067200             END-IF                                               06720000
067300                                                                  06730000
067400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06740000
067500             MOVE +1 TO PV-TOP-ITEM                               06750000
067600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06760000
067700             PERFORM 3200-RESET-ATTRIBUTES                        06770000
067800                                                                  06780000
067900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06790000
068000             PERFORM 2110-BROWSE-BACKWARD                         06800000
068100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06810000
068200             PERFORM 3200-RESET-ATTRIBUTES                        06820000
068300                                                                  06830000
068400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06840000
068500             PERFORM 2120-BROWSE-FORWARD                          06850000
068600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06860000
068700             PERFORM 3200-RESET-ATTRIBUTES                        06870000
068800                                                                  06880000
068900         WHEN DP020-SRC-AID = DP016-ENTER                         06890000
069000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06900000
069100             IF  PS-ERROR                                         06910000
069200                 CONTINUE                                         06920000
069300             ELSE                                                 06930000
069400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06940000
069500                 PERFORM 3200-RESET-ATTRIBUTES                    06950000
069600             END-IF                                               06960000
069700                                                                  06970000
069800         WHEN OTHER                                               06980000
069900             SET DP013-NO-ROLLBACK TO TRUE                        06990000
070000             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               07000000
070100             SET DP013-CICS-ABEND TO TRUE                         07010000
070200             MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH         07020034
070300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07030000
070400                                   TO DP013-MESSAGE-TEXT (1)      07040000
070500             PERFORM DP013-0000-PROCESS-ABEND                     07050000
070600                                                                  07060000
070700     END-EVALUATE.                                                07070000
070800                                                                  07080002
070900*----------------------------------------------------------------*07090000
071000*    DELETE THE TEMPORARY STORAGE QUEUE.                         *07100000
071100*----------------------------------------------------------------*07110000
071200                                                                  07120000
071300 2050-DELETE-DETAIL-QUEUE.                                        07130000
071400                                                                  07140000
071500     EXEC CICS                                                    07150000
071600         DELETEQ TS                                               07160000
071700             QUEUE (ASC-DTL-QUEUE-NAME)                           07170000
071800             RESP  (PV-CICS-RESP)                                 07180000
071900     END-EXEC.                                                    07190000
072000                                                                  07200000
072100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07210000
072200        (PV-CICS-RESP = DFHRESP(QIDERR))                          07220000
072300         CONTINUE                                                 07230000
072400     ELSE                                                         07240000
072500         SET DP013-CICS-ABEND TO TRUE                             07250000
072600         SET DP013-NO-ROLLBACK TO TRUE                            07260000
072700                                                                  07270000
072800         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       07280000
072900         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  07290000
073000                        TO DP013-MESSAGE-TEXT (1)                 07300000
073100         PERFORM DP013-0000-PROCESS-ABEND                         07310000
073200     END-IF.                                                      07320000
073300                                                                  07330000
073400     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        07340000
073500                                                                  07350002
073600*----------------------------------------------------------------*07360000
073700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07370000
073800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07380000
073900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07390000
074000*    MESSAGE.                                                    *07400000
074100*----------------------------------------------------------------*07410000
074200                                                                  07420000
074300 2110-BROWSE-BACKWARD.                                            07430000
074400                                                                  07440000
074500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07450000
074600         GIVING PV-TOP-ITEM.                                      07460000
074700                                                                  07470000
074800     IF  PV-TOP-ITEM < +1                                         07480000
074900         MOVE +1              TO PV-TOP-ITEM                      07490000
075000*        -- TOP OF LIST --                                        07500000
075100         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 07510000
075200         SET DP020-MSG-INFORMATIONAL TO TRUE                      07520000
075300     END-IF.                                                      07530000
075400                                                                  07540000
075500*----------------------------------------------------------------*07550000
075600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07560000
075700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07570000
075800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07580000
075900*----------------------------------------------------------------*07590000
076000                                                                  07600000
076100 2120-BROWSE-FORWARD.                                             07610000
076200                                                                  07620000
076300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07630000
076400         GIVING PV-TOP-ITEM.                                      07640000
076500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07650000
076600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07660000
076700                                   TO PV-TOP-ITEM                 07670000
076800*        -- BOTTOM OF LIST --                                     07680000
076900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07690000
077000         SET DP020-MSG-INFORMATIONAL                              07700000
077100                                   TO TRUE                        07710000
077200     ELSE                                                         07720000
077300         COMPUTE PV-BOTTOM-ITEM =                                 07730000
077400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07740000
077500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07750000
077600*            -- BOTTOM OF LIST --                                 07760000
077700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07770000
077800             SET DP020-MSG-INFORMATIONAL                          07780000
077900                                   TO TRUE                        07790000
078000         END-IF                                                   07800000
078100     END-IF.                                                      07810000
078200                                                                  07820002
078300*----------------------------------------------------------------*07830000
078400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07840000
078500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07850000
078600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07860000
078700*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *07870000
078800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07880000
078900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07890000
079000*----------------------------------------------------------------*07900000
079100                                                                  07910000
079200 2130-CHECK-FOR-JUMP-BROWSE.                                      07920000
079300                                                                  07930000
079400     IF ASTRTITL > ZERO                                           07940000
079500         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      07950000
079600     ELSE                                                         07960000
079700         IF ASTRTITF = DP015-ERASE-EOF                            07970000
079800             INITIALIZE ASC-START-ITEM-REQUEST                    07980000
079900         END-IF                                                   07990000
080000     END-IF.                                                      08000000
080100                                                                  08010000
080200     SET PS-NO-ERROR               TO TRUE.                       08020000
080300     IF (ASC-START-ITEM-REQUEST = SPACE)                          08030000
080400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08040000
080500                                   TO PV-TOP-ITEM                 08050000
080600     ELSE                                                         08060000
080700         MOVE ASC-START-ITEM-REQUEST                              08070000
080800                                   TO DP010I-UNEDITED-FIELD       08080000
080900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08090000
081000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08100000
081100         SET DP010I-NEGATIVE-NOT-ALLOWED                          08110000
081200                                   TO TRUE                        08120000
081310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08131072
081320                         USING DP010I-NUMERIC-EDIT-AREA           08132072
081400                                                                  08140000
081500         IF  NOT DP010I-ERROR-DETECTED                            08150000
081600             MOVE DP010I-NUMERIC-FIELD                            08160000
081700                                   TO  ASC-START-ITEM-REQUEST-N   08170000
081800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08180000
081900                 IF  ASC-START-ITEM-REQUEST-N >                   08190000
082000                                          ASC-NUMBER-OF-ITEMS-READ08200000
082100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08210000
082200                     COMPUTE PV-TOP-ITEM =                        08220000
082300                             ASC-NUMBER-OF-ITEMS-READ             08230000
082400                             - PC-ITEMS-PER-PANEL + 1             08240000
082500                     IF  PV-TOP-ITEM < +1                         08250000
082600                         MOVE +1   TO PV-TOP-ITEM                 08260000
082700                         MOVE PC-TSYMSG-00070                     08270000
082800                                   TO DP020-MSG-NUMBER            08280000
082900                         SET DP020-MSG-INFORMATIONAL              08290000
083000                                   TO TRUE                        08300000
083100                     END-IF                                       08310000
083200                 ELSE                                             08320000
083300                     MOVE ASC-START-ITEM-REQUEST-N                08330000
083400                                   TO PV-TOP-ITEM                 08340000
083500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08350000
083600                     COMPUTE PV-BOTTOM-ITEM =                     08360000
083700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08370000
083800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08380000
083900*                        -- BOTTOM OF LIST --                     08390000
084000                         MOVE PC-TSYMSG-00070                     08400000
084100                                   TO DP020-MSG-NUMBER            08410000
084200                         SET DP020-MSG-INFORMATIONAL              08420000
084300                                   TO TRUE                        08430000
084400                     END-IF                                       08440000
084500                 END-IF                                           08450000
084600             ELSE                                                 08460000
084700*                --- VALUE OUT OF RANGE ----                      08470000
084800                 MOVE PC-TSYMSG-00101                             08480000
084900                                   TO DP020-MSG-NUMBER            08490000
085000                 MOVE -1           TO ASTRTITL                    08500000
085100                 SET DP030-SET-CURSOR-APPL-1                      08510000
085200                                   TO TRUE                        08520000
085300                 MOVE DP015-REVERSE                               08530000
085400                                   TO ASTRTITH                    08540000
085500                 MOVE DP015-RED    TO ASTRTITC                    08550000
085600                 MOVE DP015-UNP-NUM-BRT-MDT                       08560000
085700                                   TO ASTRTITA                    08570000
085800                 SET DP020-MSG-FATAL                              08580000
085900                                   TO TRUE                        08590000
086000                 SET PS-ERROR      TO TRUE                        08600000
086100             END-IF                                               08610000
086200                                                                  08620000
086300         ELSE                                                     08630000
086400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08640000
086500             MOVE -1               TO ASTRTITL                    08650000
086600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08660000
086700             MOVE DP015-REVERSE    TO ASTRTITH                    08670000
086800             MOVE DP015-RED        TO ASTRTITC                    08680000
086900             MOVE DP015-UNP-NUM-BRT-MDT                           08690000
087000                                   TO ASTRTITA                    08700000
087100             SET DP020-MSG-FATAL   TO TRUE                        08710000
087200             SET PS-ERROR          TO TRUE                        08720000
087300         END-IF                                                   08730000
087400     END-IF.                                                      08740000
087500                                                                  08750000
087600*----------------------------------------------------------------*08760000
087700*    GET THE NEXT TRANSACTION IF A LIST OF TRANSACTIONS IS BEING *08770031
087800*    PROCESSED.                                                  *08780000
087900*----------------------------------------------------------------*08790000
088000                                                                  08800000
088100 2140-GET-NEXT-TRAN.                                              08810031
088200                                                                  08820000
088300     ADD +1                       TO ASC-TRAN-SEL-SUB.            08830000
088400     IF  ASC-TRAN-SEL-SUB         > IQ003-MAX-ITEMS               08840002
088500         ADD +1                   TO ASC-TRAN-SEL-ITEM            08850000
088600         MOVE +1                  TO ASC-TRAN-SEL-SUB             08860000
088700     END-IF.                                                      08870000
088800     IF  ASC-TRAN-SEL-ITEM NOT > ASC-NBR-OF-TRAN-TS-ITEMS         08880000
088900         PERFORM 9100-READ-TRAN-SEL-QUEUE                         08890000
089000         IF  IQ003-ITEM (ASC-TRAN-SEL-SUB) > ZERO                 08900034
089100             MOVE IQ003-PARTITION (ASC-TRAN-SEL-SUB)              08910002
089200                                   TO DK-PARTITION                08920000
089300                                      ASC-KEY-PARTITION           08930000
089400             MOVE IQ003-DB-STRUC-CDE (ASC-TRAN-SEL-SUB)           08940021
089500                                   TO DK-DB-STRUC-CDE             08950021
089600                                      ASC-KEY-DB-STRUC-CDE        08960021
089700             MOVE IQ003-SALES-DATE-ISO (ASC-TRAN-SEL-SUB)         08970021
089800                                   TO DK-SALES-DATE-ISO           08980025
089900                                      ASC-KEY-SALES-DATE-ISO      08990025
090000             MOVE IQ003-SALES-DATE     (ASC-TRAN-SEL-SUB)         09000025
090100                                   TO ASC-KEY-SALES-DATE-DISPLAY  09010025
090200             MOVE IQ003-STORE (ASC-TRAN-SEL-SUB)                  09020002
090300                                   TO ASC-KEY-STORE               09030000
090400                                      DK-STORE                    09040000
090500             MOVE IQ003-REGISTER (ASC-TRAN-SEL-SUB)               09050002
090600                                   TO ASC-KEY-REGISTER            09060000
090700                                      DK-REGISTER                 09070000
090800             MOVE IQ003-TRANS (ASC-TRAN-SEL-SUB)                  09080002
090900                                   TO ASC-KEY-TRANSACTION         09090000
091000                                      DK-TRANS                    09100000
091100             MOVE IQ003-START-TIME (ASC-TRAN-SEL-SUB)             09110002
091200                                   TO ASC-KEY-START-TIME          09120000
091300                                      DK-START-TIME               09130000
091400             MOVE IQ003-SALES-CORR-SEQ-NBR (ASC-TRAN-SEL-SUB)     09140002
091500                                   TO ASC-KEY-SALES-CORR-SEQ-NBR  09150000
091600                                      DK-SALES-CORR-SEQ-NBR       09160000
091700             SET IQ003-INQ (ASC-TRAN-SEL-SUB)                     09170002
091800                                   TO TRUE                        09180000
091900             PERFORM 9200-REWRITE-SEL-QUEUE                       09190000
092000         ELSE                                                     09200000
092100             SUBTRACT +1 FROM ASC-TRAN-SEL-SUB                    09210000
092200             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             09220000
092300             SET DP020-MSG-INFORMATIONAL TO TRUE                  09230000
092400             SET PS-LIST-END             TO TRUE                  09240000
092500         END-IF                                                   09250000
092600     ELSE                                                         09260000
092700         SUBTRACT +1 FROM ASC-TRAN-SEL-ITEM                       09270000
092800         MOVE IQ003-MAX-ITEMS     TO ASC-TRAN-SEL-SUB             09280002
092900         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             09290000
093000         SET DP020-MSG-INFORMATIONAL TO TRUE                      09300000
093100         SET PS-LIST-END             TO TRUE                      09310000
093200     END-IF.                                                      09320000
093300                                                                  09330000
093400*----------------------------------------------------------------*09340000
093500*    GET THE PREVIOUS TRANSACTION IF A LIST OF TRANSACTIONS IS   *09350031
093600*    BEING PROCESSED.                                            *09360031
093700*----------------------------------------------------------------*09370000
093800                                                                  09380000
093900 2150-GET-PREV-TRAN.                                              09390031
094000                                                                  09400000
094100     SUBTRACT +1 FROM ASC-TRAN-SEL-SUB.                           09410000
094200     IF  ASC-TRAN-SEL-SUB < +1                                    09420000
094300         SUBTRACT +1 FROM ASC-TRAN-SEL-ITEM                       09430000
094400         MOVE IQ003-MAX-ITEMS     TO ASC-TRAN-SEL-SUB             09440002
094500     END-IF.                                                      09450000
094600                                                                  09460000
094700     IF  ASC-TRAN-SEL-ITEM > ZERO                                 09470000
094800         PERFORM 9100-READ-TRAN-SEL-QUEUE                         09480000
094900         MOVE IQ003-PARTITION (ASC-TRAN-SEL-SUB)                  09490002
095000                                   TO DK-PARTITION                09500000
095100                                      ASC-KEY-PARTITION           09510000
095200         MOVE IQ003-DB-STRUC-CDE (ASC-TRAN-SEL-SUB)               09520021
095300                                   TO DK-DB-STRUC-CDE             09530021
095400                                      ASC-KEY-DB-STRUC-CDE        09540021
095500         MOVE IQ003-SALES-DATE-ISO (ASC-TRAN-SEL-SUB)             09550021
095600                                   TO DK-SALES-DATE-ISO           09560021
095700                                      ASC-KEY-SALES-DATE-ISO      09570021
095800         MOVE IQ003-SALES-DATE     (ASC-TRAN-SEL-SUB)             09580025
095900                                   TO ASC-KEY-SALES-DATE-DISPLAY  09590025
096000         MOVE IQ003-STORE (ASC-TRAN-SEL-SUB)                      09600002
096100                                   TO ASC-KEY-STORE               09610000
096200                                      DK-STORE                    09620000
096300         MOVE IQ003-REGISTER (ASC-TRAN-SEL-SUB)                   09630002
096400                                   TO ASC-KEY-REGISTER            09640000
096500                                      DK-REGISTER                 09650000
096600         MOVE IQ003-TRANS (ASC-TRAN-SEL-SUB)                      09660002
096700                                   TO ASC-KEY-TRANSACTION         09670000
096800                                      DK-TRANS                    09680000
096900         MOVE IQ003-START-TIME (ASC-TRAN-SEL-SUB)                 09690002
097000                                   TO ASC-KEY-START-TIME          09700000
097100                                      DK-START-TIME               09710000
097200         MOVE IQ003-SALES-CORR-SEQ-NBR (ASC-TRAN-SEL-SUB)         09720002
097300                                   TO ASC-KEY-SALES-CORR-SEQ-NBR  09730000
097400                                      DK-SALES-CORR-SEQ-NBR       09740000
097500     ELSE                                                         09750000
097600         MOVE +1                  TO ASC-TRAN-SEL-ITEM            09760000
097700                                     ASC-TRAN-SEL-SUB             09770000
097800         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             09780000
097900         SET DP020-MSG-INFORMATIONAL TO TRUE                      09790000
098000         SET PS-LIST-END             TO TRUE                      09800000
098100     END-IF.                                                      09810000
098200                                                                  09820000
098300*----------------------------------------------------------------*09830000
098400*    RESET ATTRIBUTES.                                           *09840000
098500*----------------------------------------------------------------*09850000
098600                                                                  09860000
098700 3200-RESET-ATTRIBUTES.                                           09870000
098800                                                                  09880000
098900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   09890000
099000     MOVE DP015-GREEN              TO ASTRTITC.                   09900000
099100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   09910000
099200     MOVE -1                       TO ASTRTITL.                   09920000
099300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       09930000
099400                                                                  09940000
099500*----------------------------------------------------------------*09950000
099600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *09960000
099700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *09970000
099800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *09980000
099900*    DISPLAY THE PANEL TO USER.                                  *09990000
100000*----------------------------------------------------------------*10000000
100100                                                                  10010000
100200 4000-BUILD-INITIAL-PANEL.                                        10020000
100300                                                                  10030000
100400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            10040000
100500                                 ASC-BLOCK-ENTRIES (2).           10050000
100600     MOVE +1                 TO  ASC-BLK-SUB.                     10060000
100700     SET ASC-ITEMS-LEFT-ON-DB                                     10070000
100800                             TO  TRUE.                            10080000
100900                                                                  10090000
101000     MOVE +0                 TO  ASC-ITEM-SUB                     10100000
101100                                 ASC-NUMBER-OF-ITEMS-READ         10110000
101200                                 ASC-NUMBER-OF-SELECTED-ITEMS     10120000
101300                                 ASC-HIGHEST-BLOCK-WRITTEN        10130000
101400                                 ASC-START-OF-SELECTED-RANGE      10140000
101500                                 ASC-END-OF-SELECTED-RANGE        10150000
101600                                 ASC-ITEM-AT-TOP-OF-PANEL.        10160000
101700                                                                  10170000
101800     PERFORM 4010-OPEN-CURSOR.                                    10180000
101900                                                                  10190000
102000     PERFORM 4300-READ-ITEMS-FROM-DB.                             10200000
102100                                                                  10210000
102200     PERFORM 4020-CLOSE-CURSOR.                                   10220000
102300                                                                  10230000
102400     MOVE +1                 TO  PV-TOP-ITEM.                     10240000
102500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          10250000
102600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    10260000
102700         SET DP020-MSG-FATAL   TO  TRUE                           10270000
102800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               10280000
102900     ELSE                                                         10290000
103000         MOVE -1             TO ASTRTITL                          10300000
103100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      10310000
103200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     10320000
103300     END-IF.                                                      10330000
103400                                                                  10340002
103500*----------------------------------------------------------------*10350000
103600* OPEN THE CURSOR.                                               *10360000
103700*----------------------------------------------------------------*10370000
103800                                                                  10380000
103900 4010-OPEN-CURSOR.                                                10390000
104000                                                                  10400000
104100     PERFORM                                                      10410000
104200         WITH TEST AFTER                                          10420000
104300         VARYING PV-RETRY-COUNTER                                 10430000
104400         FROM 1 BY 1                                              10440000
104500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10450000
104600                   OR (SQLCODE = ZERO))                           10460000
104700                                                                  10470000
104800             MOVE 'CURSOR:  ITEMS'                                10480002
104900                                   TO DP013-MESSAGE-TEXT (2)      10490000
105000             EXEC SQL                                             10500002
105100                  OPEN ITEMS                                      10510002
105200             END-EXEC                                             10520002
105300                                                                  10530000
105400         EVALUATE TRUE                                            10540021
105500             WHEN SQLCODE = ZERO                                  10550021
105600             WHEN SQLCODE = -904                                  10560021
105700             WHEN SQLCODE = -913                                  10570021
105800                 CONTINUE                                         10580021
105900             WHEN SQLWARN0 NOT = SPACES                           10590021
106000             WHEN SQLCODE < ZERO                                  10600021
106100             WHEN SQLCODE > ZERO                                  10610021
106200                 MOVE '4010-OPEN-CURSOR'                          10620021
106300                               TO DP013-PARAGRAPH                 10630021
106400                 MOVE 'OPEN ITEMS CURSOR - '                      10640021
106500                               TO DP013-MESSAGE-TEXT (1)          10650021
106600                 MOVE SQLCA        TO DP013-SQLCA                 10660021
106700                 MOVE 'TEPITM  '   TO DP013-DB2-TABLE-NAME (1)    10670021
106800                 SET DP013-DB2-ABEND                              10680021
106900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10690021
107000                 PERFORM DP013-0000-PROCESS-ABEND                 10700021
107100         END-EVALUATE                                             10710021
107200     END-PERFORM.                                                 10720000
107300*                                                                 10730000
107400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10740000
107500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             10750000
107600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   10760000
107700                                   TO DP013-MESSAGE-TEXT (1)      10770000
107800         MOVE SQLCA                TO DP013-SQLCA                 10780000
107900         MOVE 'TEPITM        '     TO DP013-DB2-TABLE-NAME (1)    10790002
108000         SET DP013-DB2-ABEND                                      10800000
108100             DP013-XCTL-DISPLAY-RESTART                           10810000
108200                                   TO TRUE                        10820000
108300         PERFORM DP013-0000-PROCESS-ABEND                         10830000
108400     END-IF.                                                      10840000
108500                                                                  10850000
108600*----------------------------------------------------------------*10860000
108700* CLOSE THE CURSOR.                                              *10870000
108800*----------------------------------------------------------------*10880000
108900                                                                  10890000
109000 4020-CLOSE-CURSOR.                                               10900000
109100                                                                  10910000
109200     MOVE 'CURSOR:  ITEMS'         TO DP013-MESSAGE-TEXT (2).     10920000
109300                                                                  10930002
109400         EXEC SQL                                                 10940021
109500             CLOSE ITEMS                                          10950021
109600         END-EXEC                                                 10960021
109700                                                                  10970000
109800     EVALUATE TRUE                                                10980000
109900         WHEN SQLCODE = ZERO                                      10990000
110000             CONTINUE                                             11000000
110100         WHEN SQLWARN0 NOT = SPACES                               11010000
110200         WHEN SQLCODE < ZERO                                      11020000
110300         WHEN SQLCODE > ZERO                                      11030000
110400             MOVE '4020-CLOSE-CURSOR'                             11040000
110500                               TO DP013-PARAGRAPH                 11050000
110600             MOVE 'CLOSE ITEMS CURSOR '                           11060000
110700                               TO DP013-MESSAGE-TEXT (1)          11070000
110800             MOVE SQLCA        TO DP013-SQLCA                     11080000
110900             MOVE 'TEPITM        ' TO DP013-DB2-TABLE-NAME (1)    11090002
111000             SET DP013-DB2-ABEND                                  11100000
111100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11110000
111200             PERFORM DP013-0000-PROCESS-ABEND                     11120000
111300     END-EVALUATE.                                                11130000
111400                                                                  11140000
111500*----------------------------------------------------------------*11150000
111600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *11160000
111700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *11170000
111800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *11180000
111900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *11190000
112000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *11200000
112100*                                                                *11210000
112200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *11220000
112300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *11230000
112400*    UPON INITIALIZATION.                                        *11240000
112500*----------------------------------------------------------------*11250000
112600                                                                  11260000
112700 4300-READ-ITEMS-FROM-DB.                                         11270000
112800                                                                  11280000
112900     PERFORM                                                      11290000
113000         VARYING PV-READ-COUNT                                    11300000
113100         FROM 1 BY 1                                              11310000
113200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    11320000
113300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         11330000
113400                                                                  11340000
113500         PERFORM 4310-FETCH                                       11350000
113600                                                                  11360000
113700         IF  ASC-ITEMS-LEFT-ON-DB                                 11370002
113800             PERFORM 4320-SET-BLK-ITEM-INFORMATION                11380000
113900             MOVE EPITM-SKU-NBR                                   11390000
114000                                   TO ASC-SKU                     11400000
114100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 11410000
114200             MOVE XST00010-SKU-DESC    TO ASC-SKU-DESC            11420026
114300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 11430002
114400             MOVE EPITM-SLD-QTY        TO ASC-SOLD-QUANTITY-N     11440026
114500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 11450000
114600                                                                  11460000
114700             MOVE EPITM-CUST-CHRGD-AMT TO PV-RETURN-AMT           11470018
114800             MOVE SPACES               TO PV-NOTE                 11480028
114900                                                                  11490018
115000             PERFORM 4330-CALC-RETURN-AMT                         11500002
115100                                                                  11510002
115200             COMPUTE PV-RETURN-AMT = PV-RETURN-AMT                11520002
115300                                   / EPITM-SLD-QTY                11530002
115400             MOVE PV-RETURN-AMT        TO ASC-RETURN-AMT-N        11540026
115500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 11550000
115600             MOVE PV-NOTE              TO ASC-NOTE                11560026
115700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 11570026
115800         END-IF                                                   11580000
115900                                                                  11590000
116000     END-PERFORM.                                                 11600000
116100                                                                  11610000
116200     MOVE +1                       TO  ASC-BLK-SUB.               11620033
116300     PERFORM 5100-WRITE-TEMP-STORAGE.                             11630033
116400     ADD +1                        TO  ASC-BLK-SUB.               11640033
116500     PERFORM 5100-WRITE-TEMP-STORAGE.                             11650033
116600                                                                  11660033
116700     MOVE 1                        TO  ASC-BLK-SUB                11670033
116800                                       PV-BLOCK-NUMBER.           11680033
116900     PERFORM 4410-READ-TEMP-STORAGE.                              11690033
117000     IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                 11700033
117100         MOVE 2                    TO  ASC-BLK-SUB                11710033
117200                                       PV-BLOCK-NUMBER            11720033
117300         PERFORM 4410-READ-TEMP-STORAGE                           11730033
117400     END-IF.                                                      11740033
117500                                                                  11750033
117600*----------------------------------------------------------------*11760000
117700*    FETCH THE ITEMS CURSOR                                      *11770002
117800*----------------------------------------------------------------*11780000
117900                                                                  11790000
118000 4310-FETCH.                                                      11800000
118100                                                                  11810000
118200         EXEC SQL                                                 11820021
118300              FETCH ITEMS                                         11830021
118400              INTO                                                11840021
118500                    :EPITM-SKU-NBR                                11850021
118600                  , :XST00010-SKU-DESC                            11860021
118700                  , :EPITM-SLD-QTY                                11870021
118800                  , :EPITM-CUST-CHRGD-AMT                         11880021
118900                  , :EPITM-LNE-ITM-SEQ-NBR                        11890021
119000         END-EXEC                                                 11900021
119100                                                                  11910000
119200     EVALUATE TRUE                                                11920000
119300         WHEN SQLCODE = ZERO                                      11930000
119400              CONTINUE                                            11940000
119500         WHEN SQLCODE = +100                                      11950002
119600             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  11960002
119700         WHEN SQLWARN0 NOT = SPACE                                11970000
119800         WHEN SQLCODE NOT = ZERO                                  11980000
119900              MOVE '4310-FETCH       '                            11990002
120000                               TO DP013-PARAGRAPH                 12000000
120100              MOVE 'FETCH ITEMS CURSOR'                           12010002
120200                               TO DP013-MESSAGE-TEXT (1)          12020000
120300              MOVE SQLCA       TO DP013-SQLCA                     12030000
120400              SET DP013-DB2-ABEND                                 12040000
120500                               TO TRUE                            12050000
120600              PERFORM DP013-0000-PROCESS-ABEND                    12060000
120700     END-EVALUATE.                                                12070000
120800                                                                  12080000
120900*----------------------------------------------------------------*12090000
121000* SET THE SUBSCRIPTS WHEN BUIDLIGN ITEMS THAT WILL BE PUT INTO   *12100000
121100* THE ASC COMMAREA.  NOTE: IN A NORMAL LIST PROGRAM THIS         *12110000
121200* FUNCTIONALITY IS NORMALLY IN THE 4300 PARAGRAPH.  FOR THIS     *12120000
121300* UPDATEABLE LIST THIS FUNCTIONALIY NEEDED TO BE USED IN SEVERAL *12130000
121400* PLACES SO IT WAS BROKEN OUT INTO ITS OWN PARAGRAPH.            *12140000
121500*----------------------------------------------------------------*12150000
121600                                                                  12160000
121700 4320-SET-BLK-ITEM-INFORMATION.                                   12170000
121800                                                                  12180000
121900     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        12190000
122000         ADD +1                    TO ASC-ITEM-SUB                12200000
122100     ELSE                                                         12210000
122200         ADD +1                    TO ASC-BLK-SUB                 12220000
122300         MOVE +1                   TO ASC-ITEM-SUB                12230000
122400                                                                  12240000
122500         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 12250000
122600             MOVE +1               TO ASC-BLK-SUB                 12260000
122700             PERFORM 5100-WRITE-TEMP-STORAGE                      12270000
122800             MOVE ASC-BLOCK-ENTRIES                               12280000
122900                                   (PC-MAX-BLOCKS-IN-ARRAY)       12290000
123000                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)12300000
123100             ADD +1                TO ASC-BLK-SUB                 12310000
123200             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           12320000
123300         END-IF                                                   12330000
123400     END-IF.                                                      12340000
123500                                                                  12350000
123600     ADD +1                        TO ASC-NUMBER-OF-ITEMS-READ.   12360000
123700                                                                  12370000
123800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER        12380031
123900                                      (ASC-BLK-SUB                12390031
124000                                       ASC-ITEM-SUB).             12400031
124100                                                                  12410031
124200*----------------------------------------------------------------*12420000
124300* CALCULATE THE RETURN AMOUNT                                    *12430002
124400*----------------------------------------------------------------*12440000
124500                                                                  12450000
124600 4330-CALC-RETURN-AMT.                                            12460002
124700                                                                  12470000
124800     PERFORM                                                      12480000
124900         WITH TEST AFTER                                          12490000
125000         VARYING PV-RETRY-COUNTER                                 12500000
125100         FROM 1 BY 1                                              12510000
125200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12520000
125300                   OR (SQLCODE = ZERO))                           12530000
125400                                                                  12540000
125500         MOVE 'CURSOR:  DISCOUNT-CSR'                             12550002
125600                                   TO DP013-MESSAGE-TEXT (2)      12560000
125700             EXEC SQL                                             12570021
125800                 OPEN DISCOUNT-CSR                                12580021
125900             END-EXEC                                             12590021
126000                                                                  12600000
126100         EVALUATE TRUE                                            12610000
126200             WHEN SQLCODE = ZERO                                  12620000
126300              SET PS-LIDS-LEFT-ON-DB TO TRUE                      12630019
126400             WHEN SQLCODE = -904                                  12640000
126500             WHEN SQLCODE = -913                                  12650000
126600                 CONTINUE                                         12660000
126700             WHEN SQLWARN0 NOT = SPACES                           12670000
126800             WHEN SQLCODE < ZERO                                  12680000
126900             WHEN SQLCODE > ZERO                                  12690000
127000                 MOVE '4330-CALC-RETURN-AMT'                      12700002
127100                                   TO DP013-PARAGRAPH             12710000
127200                 MOVE 'OPEN DISCOUNT CURSOR - '                   12720002
127300                                   TO DP013-MESSAGE-TEXT (1)      12730000
127400                 MOVE SQLCA        TO DP013-SQLCA                 12740000
127500                 MOVE 'TEPLID  '   TO DP013-DB2-TABLE-NAME (1)    12750002
127600                 SET DP013-DB2-ABEND                              12760000
127700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12770000
127800                 PERFORM DP013-0000-PROCESS-ABEND                 12780000
127900         END-EVALUATE                                             12790000
128000     END-PERFORM.                                                 12800000
128100*                                                                 12810000
128200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12820000
128300         MOVE '4330-CALC-RETURN-AMT'                              12830002
128400                                   TO DP013-PARAGRAPH             12840000
128500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   12850000
128600                                   TO DP013-MESSAGE-TEXT (1)      12860000
128700         MOVE SQLCA                TO DP013-SQLCA                 12870000
128800         MOVE 'TEPLID  '           TO DP013-DB2-TABLE-NAME (1)    12880002
128900         SET DP013-DB2-ABEND                                      12890000
129000             DP013-XCTL-DISPLAY-RESTART                           12900000
129100                                   TO TRUE                        12910000
129200         PERFORM DP013-0000-PROCESS-ABEND                         12920000
129300     END-IF.                                                      12930000
129400                                                                  12940000
129500     PERFORM                                                      12950002
129600         VARYING PV-LID-COUNT                                     12960002
129700         FROM 1 BY 1                                              12970002
129800         UNTIL ((PV-LID-COUNT > PC-MAX-LIDS)                      12980002
129900            OR (PS-NO-LIDS-LEFT-ON-DB))                           12990002
130000                                                                  13000002
130100         PERFORM 4331-FETCH                                       13010002
130200                                                                  13020002
130300         IF  PS-LIDS-LEFT-ON-DB                                   13030002
130400             PERFORM 4345-RETURN-AMT-NOTE                         13040002
130500         END-IF                                                   13050002
130600     END-PERFORM.                                                 13060002
130700                                                                  13070002
130800         EXEC SQL                                                 13080021
130900             CLOSE DISCOUNT-CSR                                   13090021
131000         END-EXEC                                                 13100021
131100                                                                  13110002
131200     EVALUATE TRUE                                                13120002
131300         WHEN SQLCODE = ZERO                                      13130002
131400              CONTINUE                                            13140002
131500         WHEN SQLWARN0 NOT = SPACE                                13150002
131600         WHEN SQLCODE NOT = ZERO                                  13160002
131700              MOVE '4330-CALC-RETURN-AMT'                         13170002
131800                               TO DP013-PARAGRAPH                 13180002
131900              MOVE 'CLOSE DISCOUNT-CSR'                           13190002
132000                               TO DP013-MESSAGE-TEXT (1)          13200002
132100              MOVE SQLCA       TO DP013-SQLCA                     13210002
132200              SET DP013-DB2-ABEND                                 13220002
132300                               TO TRUE                            13230002
132400              PERFORM DP013-0000-PROCESS-ABEND                    13240002
132500     END-EVALUATE.                                                13250002
132600                                                                  13260002
132700*----------------------------------------------------------------*13270000
132800*  READ THE LINE ITEM DISCOUNT TABLE FOR DISCOUNTS               *13280002
132900*----------------------------------------------------------------*13290000
133000                                                                  13300000
133100 4331-FETCH.                                                      13310002
133200                                                                  13320000
133300     PERFORM                                                      13330000
133400         WITH TEST AFTER                                          13340000
133500         VARYING PV-RETRY-COUNTER                                 13350000
133600         FROM 1 BY 1                                              13360000
133700         UNTIL SQLCODE = 0                                        13370020
133800            OR PS-NO-LIDS-LEFT-ON-DB                              13380021
133900                                                                  13390000
134000             EXEC SQL                                             13400021
134100                 FETCH DISCOUNT-CSR                               13410021
134200                 INTO                                             13420021
134300                       :EPLID-LID-TYP-CDE                         13430021
134400                     , :EPLID-LID-AMT                             13440021
134500                     , :EPLID-LID-PCT                             13450021
134600             END-EXEC                                             13460021
134700                                                                  13470000
134800         EVALUATE TRUE                                            13480002
134900             WHEN SQLCODE = ZERO                                  13490002
135000                  CONTINUE                                        13500002
135100             WHEN SQLCODE = +100                                  13510002
135200                 SET PS-NO-LIDS-LEFT-ON-DB TO TRUE                13520002
135300             WHEN SQLWARN0 NOT = SPACE                            13530002
135400             WHEN SQLCODE NOT = ZERO                              13540002
135500                  MOVE '4331-FETCH'                               13550002
135600                               TO DP013-PARAGRAPH                 13560002
135700                  MOVE 'FETCH DISCOUNT CURSOR '                   13570002
135800                               TO DP013-MESSAGE-TEXT (1)          13580002
135900                  MOVE SQLCA       TO DP013-SQLCA                 13590002
136000                  SET DP013-DB2-ABEND                             13600002
136100                               TO TRUE                            13610002
136200                  PERFORM DP013-0000-PROCESS-ABEND                13620002
136300         END-EVALUATE                                             13630002
136400     END-PERFORM.                                                 13640000
136500                                                                  13650000
136600*----------------------------------------------------------------*13660002
136700* POPULATE THE RETURN AMOUNT AND NOTES COLUMNS                   *13670002
136800*----------------------------------------------------------------*13680002
136900                                                                  13690002
137000 4345-RETURN-AMT-NOTE.                                            13700002
137100                                                                  13710002
137200     COMPUTE PV-RETURN-AMT = PV-RETURN-AMT                        13720002
137300                           + EPLID-LID-AMT.                       13730002
137400                                                                  13740002
137500     EVALUATE EPLID-LID-TYP-CDE                                   13750002
137600         WHEN 'P'                                                 13760002
137700             COMPUTE PV-LID-PCT = EPLID-LID-PCT * 100             13770002
137800             MOVE PV-LID-PCT TO PV-NOTE-PCT-OFF-PCT               13780002
137900             IF PV-NOTE-1 = SPACES                                13790002
138000                 MOVE PV-NOTE-PCT-OFF         TO PV-NOTE-1        13800002
138100             ELSE                                                 13810002
138200                 IF PV-NOTE-2 = SPACES                            13820002
138300                     MOVE PV-NOTE-PCT-OFF     TO PV-NOTE-2        13830002
138400                 ELSE                                             13840002
138500                     IF PV-NOTE-3 = SPACES                        13850002
138600                         MOVE PV-NOTE-PCT-OFF TO PV-NOTE-3        13860002
138700                     ELSE                                         13870002
138800                         MOVE PV-NOTE-MORE-DISCOUNTS              13880002
138900                                              TO PV-NOTE-3        13890002
139000                     END-IF                                       13900002
139100                 END-IF                                           13910002
139200             END-IF                                               13920002
139300         WHEN 'C'                                                 13930002
139400         WHEN 'D'                                                 13940002
139500             MOVE EPLID-LID-AMT TO PV-NOTE-DLR-OFF-DLR            13950002
139600             IF PV-NOTE-1 = SPACES                                13960002
139700                 MOVE PV-NOTE-DLR-OFF         TO PV-NOTE-1        13970002
139800             ELSE                                                 13980002
139900                 IF PV-NOTE-2 = SPACES                            13990002
140000                     MOVE PV-NOTE-DLR-OFF     TO PV-NOTE-2        14000002
140100                 ELSE                                             14010002
140200                     IF PV-NOTE-3 = SPACES                        14020002
140300                         MOVE PV-NOTE-DLR-OFF TO PV-NOTE-3        14030002
140400                     ELSE                                         14040002
140500                         MOVE PV-NOTE-MORE-DISCOUNTS              14050002
140600                                              TO PV-NOTE-3        14060002
140700                     END-IF                                       14070002
140800                 END-IF                                           14080002
140900             END-IF                                               14090002
141000         WHEN 'B'                                                 14100002
141100             MOVE EPLID-LID-AMT TO PV-NOTE-TTL-DLR                14110002
141200             IF PV-NOTE-1 = SPACES                                14120002
141300                 MOVE PV-NOTE-TTL-DLR-OFF     TO PV-NOTE-1        14130002
141400             ELSE                                                 14140002
141500                 IF PV-NOTE-2 = SPACES                            14150002
141600                     MOVE PV-NOTE-TTL-DLR-OFF TO PV-NOTE-2        14160002
141700                 ELSE                                             14170002
141800                     IF PV-NOTE-3 = SPACES                        14180002
141900                        MOVE PV-NOTE-TTL-DLR-OFF                  14190002
142000                                              TO PV-NOTE-3        14200002
142100                     ELSE                                         14210002
142200                         MOVE PV-NOTE-MORE-DISCOUNTS              14220002
142300                                              TO PV-NOTE-3        14230002
142400                     END-IF                                       14240002
142500                 END-IF                                           14250002
142600             END-IF                                               14260002
142700         WHEN 'S'                                                 14270002
142800             COMPUTE PV-LID-PCT = EPLID-LID-PCT * 100             14280002
142900             MOVE PV-LID-PCT TO PV-NOTE-SCD-PCT                   14290002
143000             IF PV-NOTE-1 = SPACES                                14300002
143100                 MOVE PV-NOTE-SCD-OFF         TO PV-NOTE-1        14310002
143200             ELSE                                                 14320002
143300                 IF PV-NOTE-2 = SPACES                            14330002
143400                     MOVE PV-NOTE-SCD-OFF     TO PV-NOTE-2        14340002
143500                 ELSE                                             14350002
143600                     IF PV-NOTE-3 = SPACES                        14360002
143700                         MOVE PV-NOTE-SCD-OFF TO PV-NOTE-3        14370002
143800                     ELSE                                         14380002
143900                         MOVE PV-NOTE-MORE-DISCOUNTS              14390002
144000                                              TO PV-NOTE-3        14400002
144100                     END-IF                                       14410002
144200                 END-IF                                           14420002
144300             END-IF                                               14430002
144400         WHEN 'A'                                                 14440002
144500         WHEN 'Q'                                                 14450002
144600         WHEN 'T'                                                 14460002
144700         WHEN 'I'                                                 14470066
144800         WHEN 'J'                                                 14480066
144900             COMPUTE PV-LID-PCT = EPLID-LID-PCT * 100             14490002
145000             MOVE PV-LID-PCT TO PV-NOTE-TTL-PCT                   14500002
145100             IF PV-NOTE-1 = SPACES                                14510002
145200                 MOVE PV-NOTE-TTL-PCT-OFF     TO PV-NOTE-1        14520002
145300             ELSE                                                 14530002
145400                 IF PV-NOTE-2 = SPACES                            14540002
145500                     MOVE PV-NOTE-TTL-PCT-OFF TO PV-NOTE-2        14550002
145600                 ELSE                                             14560002
145700                     IF PV-NOTE-3 = SPACES                        14570002
145800                         MOVE PV-NOTE-TTL-PCT-OFF                 14580002
145900                                              TO PV-NOTE-3        14590002
146000                     ELSE                                         14600002
146100                         MOVE PV-NOTE-MORE-DISCOUNTS              14610002
146200                                              TO PV-NOTE-3        14620002
146300                     END-IF                                       14630002
146400                 END-IF                                           14640002
146500             END-IF                                               14650002
146600         WHEN 'F'                                                 14660002
146700             IF PV-NOTE-1 = SPACES                                14670002
146800                 MOVE PV-NOTE-BOGO            TO PV-NOTE-1        14680002
146900             ELSE                                                 14690002
147000                 IF PV-NOTE-2 = SPACES                            14700002
147100                     MOVE PV-NOTE-BOGO        TO PV-NOTE-2        14710002
147200                 ELSE                                             14720002
147300                     IF PV-NOTE-3 = SPACES                        14730002
147400                         MOVE PV-NOTE-BOGO    TO PV-NOTE-3        14740002
147500                     ELSE                                         14750002
147600                         MOVE PV-NOTE-MORE-DISCOUNTS              14760002
147700                                              TO PV-NOTE-3        14770002
147800                     END-IF                                       14780002
147900                END-IF                                            14790002
148000             END-IF                                               14800002
148100         WHEN 'H'                                                 14810066
148200             IF PV-NOTE-1 = SPACES                                14820066
148300                 MOVE PV-OFFERS-BWP           TO PV-NOTE-1        14830066
148400             ELSE                                                 14840066
148500                 IF PV-NOTE-2 = SPACES                            14850066
148600                     MOVE PV-OFFERS-BWP       TO PV-NOTE-2        14860066
148700                 ELSE                                             14870066
148800                     IF PV-NOTE-3 = SPACES                        14880066
148900                         MOVE PV-OFFERS-BWP   TO PV-NOTE-3        14890066
149000                     ELSE                                         14900066
149100                         MOVE PV-NOTE-MORE-DISCOUNTS              14910066
149200                                              TO PV-NOTE-3        14920066
149300                     END-IF                                       14930066
149400                END-IF                                            14940066
149500             END-IF                                               14950066
149600     END-EVALUATE.                                                14960002
149700                                                                  14970002
149800*----------------------------------------------------------------*14980000
149900*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *14990000
150000*----------------------------------------------------------------*15000000
150100                                                                  15010000
150200 4400-MOVE-COMMAREA-TO-SCREEN.                                    15020000
150300                                                                  15030000
150400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15040000
150500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15050000
150600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15060000
150700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15070000
150800                 GIVING PV-BLOCK-NUMBER                           15080000
150900                 REMAINDER PV-REMAINDER                           15090000
151000             IF  PV-REMAINDER > ZERO                              15100000
151100                 ADD +1 TO PV-BLOCK-NUMBER                        15110000
151200             END-IF                                               15120000
151300             MOVE +1    TO ASC-BLK-SUB                            15130000
151400             PERFORM 4410-READ-TEMP-STORAGE                       15140000
151500             ADD +1     TO ASC-BLK-SUB                            15150000
151600                           PV-BLOCK-NUMBER                        15160000
151700             PERFORM 4410-READ-TEMP-STORAGE                       15170000
151800     END-IF.                                                      15180000
151900                                                                  15190032
152000     MOVE +1                       TO ASC-BLK-SUB.                15200000
152100                                                                  15210032
152200     COMPUTE ASC-ITEM-SUB =                                       15220000
152300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15230000
152400         + PC-ITEMS-PER-PANEL).                                   15240000
152500                                                                  15250000
152600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15260000
152700         ADD +1   TO ASC-BLK-SUB                                  15270000
152800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15280000
152900     END-IF.                                                      15290000
153000                                                                  15300000
153100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15310000
153200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15320000
153300     PERFORM 4420-FORMAT-LIST-LINES                               15330000
153400         VARYING PV-SUB                                           15340000
153500         FROM PC-ITEMS-PER-PANEL BY -1                            15350000
153600         UNTIL PV-SUB < +1.                                       15360000
153700                                                                  15370000
153800     COMPUTE ASC-ITEMS-DISPLAYED =                                15380000
153900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15390000
154000     MOVE PV-TOP-ITEM                TO ASC-ITEM-AT-TOP-OF-PANEL  15400025
154100                                        ASTRTITO.                 15410025
154200     MOVE ASC-ITEM-AT-BOT-OF-PANEL   TO AENDITO.                  15420025
154300     MOVE ASC-NUMBER-OF-ITEMS-READ   TO ATOTITO.                  15430025
154400     MOVE ASC-KEY-SALES-DATE-DISPLAY(1:2) TO PV-SALES-DATE-MM.    15440064
154500     MOVE ASC-KEY-SALES-DATE-DISPLAY(4:2) TO PV-SALES-DATE-DD.    15450064
154600     MOVE ASC-KEY-SALES-DATE-DISPLAY(9:2) TO PV-SALES-DATE-YY.    15460064
154700     MOVE PV-SALES-DATE              TO ASLSDTEO.                 15470057
154800     MOVE ASC-KEY-STORE              TO ASTOREO.                  15480025
154900     MOVE ASC-KEY-REGISTER           TO AREGO.                    15490043
155000     MOVE ASC-KEY-TRANSACTION        TO ATRANSO.                  15500025
155100                                                                  15510054
155200     PERFORM 4430-FORMAT-TRANSACTION-TIME.                        15520065
155300     MOVE PV-TIME-HH                 TO ATIMEHO.                  15530054
155400     MOVE PV-TIME-MM                 TO ATIMEMO.                  15540054
155500     MOVE PV-TIME-A-P                TO AAMPMIO.                  15550054
155600                                                                  15560054
155700     PERFORM 4440-CALCULATE-TRAN-CHECK-DIG.                       15570065
155800     MOVE ASC-CDIG                   TO ACDIGO.                   15580046
155900                                                                  15590000
156000     IF  DP020-MSG-NUMBER-X = SPACE                               15600000
156100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  15610000
156200*            --- MORE ITEMS TO DISPLAY ----                       15620000
156300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            15630000
156400             SET DP020-MSG-INFORMATIONAL TO TRUE                  15640000
156500         END-IF                                                   15650000
156600     END-IF.                                                      15660000
156700                                                                  15670000
156800*----------------------------------------------------------------*15680000
156900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *15690000
157000*----------------------------------------------------------------*15700000
157100                                                                  15710000
157200 4410-READ-TEMP-STORAGE.                                          15720000
157300                                                                  15730000
157400     EXEC CICS                                                    15740000
157500         READQ TS                                                 15750000
157600             QUEUE (ASC-DTL-QUEUE-NAME)                           15760000
157700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               15770000
157800             ITEM  (PV-BLOCK-NUMBER)                              15780000
157900             RESP  (PV-CICS-RESP)                                 15790000
158000     END-EXEC.                                                    15800000
158100                                                                  15810000
158200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       15820000
158300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     15830000
158400         CONTINUE                                                 15840000
158500     ELSE                                                         15850000
158600         SET DP013-CICS-ABEND TO  TRUE                            15860000
158700         SET DP013-NO-ROLLBACK TO  TRUE                           15870000
158800         MOVE '4410-READ-TEMP-STORAGE'                            15880000
158900                               TO  DP013-PARAGRAPH                15890000
159000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      15900000
159100                               TO  DP013-MESSAGE-TEXT(1)          15910000
159200         PERFORM DP013-0000-PROCESS-ABEND                         15920000
159300     END-IF.                                                      15930000
159400                                                                  15940000
159500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         15950000
159600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               15960000
159700     END-IF.                                                      15970000
159800                                                                  15980002
159900*----------------------------------------------------------------*15990000
160000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *16000000
160100*----------------------------------------------------------------*16010000
160200                                                                  16020000
160300 4420-FORMAT-LIST-LINES.                                          16030000
160400                                                                  16040000
160500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16050000
160600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16060000
160700         MOVE SPACE              TO MR-SKU-DESC        (PV-SUB)   16070007
160800                                    MR-NOTE            (PV-SUB)   16080005
160900                                    MR-SKU             (PV-SUB)   16090017
161000         MOVE ZERO               TO MR-UNITS           (PV-SUB)   16100005
161100                                    MR-AMOUNT          (PV-SUB)   16110005
161200     ELSE                                                         16120000
161300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16130002
161400             MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)              16140000
161500                                   TO PV-SKU-DISPLAY              16150017
161600             MOVE PV-SKU-DISPLAY-X TO MR-SKU (PV-SUB)             16160017
161700             MOVE ASC-SKU-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         16170005
161800                                   TO MR-SKU-DESC (PV-SUB)        16180005
161900             MOVE ASC-SOLD-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB)    16190000
162000                                   TO MR-UNITS (PV-SUB)           16200005
162100             MOVE ASC-RETURN-AMT-N (ASC-BLK-SUB ASC-ITEM-SUB)     16210026
162200                                   TO MR-AMOUNT (PV-SUB)          16220005
162300             MOVE ASC-NOTE (ASC-BLK-SUB ASC-ITEM-SUB)             16230005
162400                                   TO MR-NOTE (PV-SUB)            16240005
162500         END-IF                                                   16250005
162600     END-IF.                                                      16260000
162700                                                                  16270005
162800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16280000
162900     IF  ASC-ITEM-SUB < + 1                                       16290000
163000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16300000
163100         MOVE +1                 TO ASC-BLK-SUB                   16310000
163200     END-IF.                                                      16320000
163300                                                                  16330000
163400*----------------------------------------------------------------*16340059
163500*    FORMATS THE TIME INTO AM/PM FORMAT FOR DISPLAY.             *16350059
163600*----------------------------------------------------------------*16360059
163700                                                                  16370059
163800 4430-FORMAT-TRANSACTION-TIME.                                    16380065
163900                                                                  16390059
164000     MOVE ASC-KEY-START-TIME       TO PV-TIME.                    16400059
164100     IF PV-TIME-HH                 >= 12                          16410059
164200         MOVE 'P'                  TO PV-TIME-A-P                 16420059
164300     ELSE                                                         16430059
164400         MOVE 'A'                  TO PV-TIME-A-P                 16440059
164500     END-IF.                                                      16450059
164600                                                                  16460059
164700     IF PV-TIME-HH                 >  12                          16470059
164800         SUBTRACT 12 FROM PV-TIME-HH                              16480059
164900     END-IF.                                                      16490059
165000                                                                  16500059
165100*----------------------------------------------------------------*16510054
165200*    CALCULATES THE CHECK DIGIT FOR THE KEY TRANSACTION.         *16520054
165300*    BASE NUMBER FOR POS = MMDDYY + STORE + REGISTER + TRANS     *16530054
165400*----------------------------------------------------------------*16540054
165500                                                                  16550054
165600 4440-CALCULATE-TRAN-CHECK-DIG.                                   16560065
165700                                                                  16570054
165800     MOVE ASC-KEY-SALES-DATE-DISPLAY(1:2) TO PV-BASE-MM.          16580054
165900     MOVE ASC-KEY-SALES-DATE-DISPLAY(4:2) TO PV-BASE-DD.          16590054
166000     MOVE ASC-KEY-SALES-DATE-DISPLAY(9:2) TO PV-BASE-YY.          16600054
166100     MOVE ASC-KEY-STORE                   TO PV-BASE-STR-NBR.     16610054
166200     MOVE ASC-KEY-REGISTER(3:2)           TO PV-BASE-REG-NBR.     16620054
166300     MOVE ASC-KEY-TRANSACTION             TO PV-BASE-TRAN-NBR.    16630054
166400                                                                  16640054
166500     MOVE PV-BASE-NUMBER TO BASE-NUMBER.                          16650054
166600     PERFORM CREATE-CHECK-DIGIT-NUMBER.                           16660054
166700     MOVE BASE-DIGIT (CD-X) TO ASC-CDIG.                          16670054
166800                                                                  16680054
166900*----------------------------------------------------------------*16690054
167000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *16700000
167100*----------------------------------------------------------------*16710000
167200                                                                  16720000
167300 5100-WRITE-TEMP-STORAGE.                                         16730000
167400                                                                  16740000
167500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     16750000
167600                               TO  PV-LIST-ITEM-NUMBER.           16760000
167700     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           16770000
167800         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           16780000
167900                                                                  16790000
168000     EXEC CICS                                                    16800000
168100         WRITEQ TS                                                16810000
168200             QUEUE (ASC-DTL-QUEUE-NAME)                           16820000
168300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16830000
168400             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     16840000
168500             RESP  (PV-CICS-RESP)                                 16850000
168600     END-EXEC.                                                    16860000
168700                                                                  16870000
168800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      16880000
168900         SET DP013-CICS-ABEND                                     16890000
169000                       TO  TRUE                                   16900000
169100         SET DP013-NO-ROLLBACK                                    16910000
169200                       TO  TRUE                                   16920000
169300         MOVE '5100-WRITE-TEMP-STORAGE'                           16930000
169400                       TO  DP013-PARAGRAPH                        16940000
169500         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       16950000
169600                       TO  DP013-MESSAGE-TEXT(1)                  16960000
169700         PERFORM DP013-0000-PROCESS-ABEND                         16970000
169800     END-IF.                                                      16980000
169900     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             16990000
170000                                                                  17000000
170100*----------------------------------------------------------------*17010000
170200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *17020000
170300*----------------------------------------------------------------*17030000
170400                                                                  17040000
170500 9100-READ-TRAN-SEL-QUEUE.                                        17050000
170600                                                                  17060000
170700     EXEC CICS                                                    17070000
170800         READQ TS                                                 17080000
170900             QUEUE (ASC-TRAN-SEL-QUEUE-NAME)                      17090000
171000             INTO  (IQ003-TRANSACTION-SEL-REC)                    17100002
171100             ITEM  (ASC-TRAN-SEL-ITEM)                            17110000
171200             RESP  (PV-CICS-RESP)                                 17120000
171300     END-EXEC.                                                    17130000
171400                                                                  17140000
171500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       17150000
171600         CONTINUE                                                 17160000
171700     ELSE                                                         17170000
171800         SET DP013-LOGIC-ABEND                                    17180000
171900             DP013-NO-ROLLBACK     TO TRUE                        17190000
172000         MOVE '9100-READ-SEL-QUEUE'                               17200000
172100                                   TO DP013-PARAGRAPH             17210000
172200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   17220000
172300                                   TO DP013-MESSAGE-TEXT (1)      17230000
172400         PERFORM DP013-0000-PROCESS-ABEND                         17240000
172500     END-IF.                                                      17250000
172600*----------------------------------------------------------------*17260000
172700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *17270000
172800*----------------------------------------------------------------*17280000
172900 9200-REWRITE-SEL-QUEUE.                                          17290000
173000     EXEC CICS                                                    17300000
173100          WRITEQ TS                                               17310000
173200              QUEUE  (ASC-TRAN-SEL-QUEUE-NAME)                    17320000
173300              FROM   (IQ003-TRANSACTION-SEL-REC)                  17330002
173400              ITEM   (ASC-TRAN-SEL-ITEM)                          17340000
173500              RESP   (PV-CICS-RESP)                               17350000
173600              REWRITE                                             17360000
173700     END-EXEC.                                                    17370000
173800                                                                  17380000
173900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   17390000
174000         SET DP013-CICS-ABEND                                     17400000
174100             DP013-NO-ROLLBACK     TO TRUE                        17410000
174200         MOVE '9200-REWRITE-SEL-QUEUE'                            17420000
174300                                   TO DP013-PARAGRAPH             17430000
174400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   17440000
174500                                   TO DP013-MESSAGE-TEXT (1)      17450000
174600         PERFORM DP013-0000-PROCESS-ABEND                         17460000
174700     END-IF.                                                      17470000
174800                                                                  17480000
174900*----------------------------------------------------------------*17490000
175000*    ABEND PROCESSOR MODULE                                      *17500000
175100*----------------------------------------------------------------*17510000
175200                                                                  17520000
175300     COPY DPPD013.                                                17530000
175400                                                                  17540045
175500***********************************************************       17550045
175600*    CREATE/VERIFY CHECK DIGIT ROUTINE                    *       17560045
175700***********************************************************       17570045
175800*                                                                 17580045
175900     COPY DPPD036.                                                17590071
