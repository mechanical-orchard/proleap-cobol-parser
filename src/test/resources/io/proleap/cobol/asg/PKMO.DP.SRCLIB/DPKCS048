000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    DPKCS048.                                         00030000
000400 AUTHOR.        CAL BUSH.                                         00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  04-25-96.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000**                                                              **00100000
001100** THIS PROGRAM DELETES RECORDS FROM THE SAVED COMMAREA FILE    **00110000
001200** THAT ARE FOR TERMINALS THAT ARE NO LONGER ATTACHED TO THE    **00120000
001300** CICS REGION.                                                 **00130000
001400**                                                              **00140000
001500**--------------------------------------------------------------**00150000
001600**  04/27/2000  JEFF ROUBIK                                     **00160000
001700**              ADDED GRAND TOTAL MESSAGE TO LOG.               **00170000
001800**  06/25/2002  JEFF ROUBIK                                     **00180000
001900**              DELETE RECORDS MORE THAN PC-CUTOFF-HOURS OLD.   **00190000
002000**  10/17/2003  JEFF ROUBIK                                     **00200000
002100**              DELETE CORRESPONDING TSQUEUES TOO.              **00210000
002200******************************************************************00220000
002300                                                                  00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500                                                                  00250000
002600 DATA DIVISION.                                                   00260000
002700                                                                  00270000
002800 WORKING-STORAGE SECTION.                                         00280000
002900                                                                  00290000
003000 01  PC-PROGRAM-CONSTANTS.                                        00300000
003100     05  PC-DP515-KEYLENGTH             PIC S9(04)  COMP          00310000
003200                                                    VALUE 15.     00320000
003300     05  PC-NETNAME-LENGTH              PIC S9(04)  COMP          00330000
003400                                                    VALUE 8.      00340000
003500     05  PC-MESSAGE-LENGTH              PIC S9(04)  COMP          00350000
003600                                                    VALUE +400.   00360000
003700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00370000
003800                                                    'DPKCS048'.   00380000
003900     05  PC-SAVE-COMM-DD                PIC  X(08)  VALUE         00390000
004000                                                    'DPSAVCMK'.   00400000
004100     05  PC-CUTOFF-HOURS                PIC  9(07)  VALUE 10.     00410000
004200     05  PC-LOG-QUEUE-RESOURCE          PIC  X(04)  VALUE 'CSSL'. 00420000
004300     05  PC-LOG-QUEUE                   PIC  X(04)  VALUE 'CSSL'. 00430000
004310     05  PC-CR-INDENT.                                            00431000
004320         10  FILLER                     PIC  X(01)  VALUE X'15'.  00432000
004330         10  FILLER                     PIC  X(10)  VALUE SPACES. 00433000
004340     05  PC-2CR-INDENT.                                           00434000
004350         10  FILLER                     PIC  X(01)  VALUE X'15'.  00435000
004351         10  FILLER                     PIC  X(01)  VALUE X'15'.  00435100
004360         10  FILLER                     PIC  X(10)  VALUE SPACES. 00436000
004400                                                                  00440000
004500 01  PS-PROGRAM-SWITCHES.                                         00450000
004600     05  PS-EOF-SAVE-COMM-SW            PIC  X(01)  VALUE 'N'.    00460000
004700         88  PS-EOF-SAVE-COMM                       VALUE 'Y'.    00470000
004800         88  PS-NOT-EOF-SAVE-COMM                   VALUE 'N'.    00480000
004900     05  PS-AN-OLD-DELETE-SW            PIC  X(01)  VALUE 'N'.    00490000
005000         88  PS-AN-OLD-DELETE                       VALUE 'Y'.    00500000
005100         88  PS-NOT-AN-OLD-DELETE                   VALUE 'N'.    00510000
005200     05  PS-STATUS-SW                   PIC  X(01)  VALUE 'D'.    00520000
005300         88  PS-STATUS-KEEP                         VALUE 'K'.    00530000
005400         88  PS-STATUS-DELETE                       VALUE 'D'.    00540000
005500     05  PS-DELETE-TYPE                 PIC  X(01)  VALUE 'U'.    00550000
005600         88  PS-DELETE-UNATTACHED                   VALUE 'U'.    00560000
005700         88  PS-DELETE-EXPIRED                      VALUE 'E'.    00570000
005800                                                                  00580000
005900 01  PV-PROGRAM-VARIABLES.                                        00590000
006000     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      00600000
006100                                                    COMP SYNC.    00610000
006200     05  PV-RECORD-LENGTH               PIC S9(04)  VALUE +0      00620000
006300                                                    COMP SYNC.    00630000
006400     05  PV-DEL-RECS-TERM               PIC S9(04)  VALUE +0      00640000
006500                                                    COMP SYNC.    00650000
006600     05  PV-DEL-RECS-TOTAL              PIC S9(04)  VALUE +0      00660000
006700                                                    COMP SYNC.    00670000
006800     05  PV-DEL-TSQS-TERM               PIC S9(04)  VALUE +0      00680000
006900                                                    COMP SYNC.    00690000
007000     05  PV-DEL-TSQS-TOTAL              PIC S9(04)  VALUE +0      00700000
007100                                                    COMP SYNC.    00710000
007200     05  PV-START-KEY.                                            00720000
007300         10  PV-START-KEY-NETNAME       PIC  X(08)  VALUE         00730000
007400                                                    LOW-VALUES.   00740000
007500         10  FILLER                     PIC  X(07)  VALUE         00750000
007600                                                    LOW-VALUES.   00760000
007700                                                                  00770000
007800     05  PV-TS-KEY.                                               00780000
007900         10  PV-TS-KEY-TERM-ID          PIC  X(04)  VALUE         00790000
008000                                                    LOW-VALUES.   00800000
008100         10  FILLER                     PIC  X(04)  VALUE         00810000
008200                                                    LOW-VALUES.   00820000
008300                                                                  00830000
008400     05  PV-CUTOFF-AMOUNT               PIC  9(07)  VALUE ZERO.   00840000
008500                                                                  00850000
008600     05  PV-CUTOFF-TIMESTAMP            PIC  9(14)  VALUE ZERO.   00860000
008700     05  FILLER  REDEFINES  PV-CUTOFF-TIMESTAMP.                  00870000
008800         10  PV-CUTOFF-DATE             PIC  9(07).               00880000
008900         10  PV-CUTOFF-TIME             PIC  9(07).               00890000
009000                                                                  00900000
009100     05  PV-RECORD-TIMESTAMP            PIC  9(14)  VALUE ZERO.   00910000
009200     05  FILLER  REDEFINES  PV-RECORD-TIMESTAMP.                  00920000
009300         10  PV-RECORD-DATE             PIC  9(07).               00930000
009400         10  PV-RECORD-TIME             PIC  9(07).               00940000
009500                                                                  00950000
009600     05  PV-UNATTACHED-SESSIONS         PIC 9(07) VALUE ZERO.     00960000
009700     05  PV-EXPIRED-SESSIONS            PIC 9(07) VALUE ZERO.     00970000
009800     05  PV-UNATTACHED-RECORDS          PIC 9(07) VALUE ZERO.     00980000
009900     05  PV-EXPIRED-RECORDS             PIC 9(07) VALUE ZERO.     00990000
010000                                                                  01000000
010100     05  PV-TRANS-ID-CODE               PIC  X(04)  VALUE SPACE.  01010000
010200     05  PV-OLD-NETNAME                 PIC  X(08)  VALUE SPACE.  01020000
010300     05  PV-LOG-LINE                    PIC  X(90)  VALUE SPACE.  01030000
010400     05  PV-LOG-START-LINE.                                       01040000
010500         10  FILLER                     PIC  X(22)  VALUE         01050000
010600                                        ' DPKCS048: STARTED AT '. 01060000
010700         10  PV-LOG-START-TIME          PIC  X(08)  VALUE SPACE.  01070000
010800         10  FILLER                     PIC  X(01)  VALUE SPACE.  01080000
010900         10  PV-LOG-START-DATE          PIC  X(10)  VALUE SPACE.  01090000
011000*                                                                 01100000
011100     05  PV-LOG-END-LINE.                                         01110000
011200         10  FILLER                     PIC  X(20)  VALUE         01120000
011300                                        ' DPKCS048: ENDED AT '.   01130000
011400         10  PV-LOG-END-TIME            PIC  X(08)  VALUE SPACE.  01140000
011500         10  FILLER                     PIC  X(01)  VALUE SPACE.  01150000
011600         10  PV-LOG-END-DATE            PIC  X(10)  VALUE SPACE.  01160000
011700*                                                                 01170000
011800     05  PV-LOG-TERM-LINE.                                        01180000
011900         10  FILLER                     PIC  X(10)  VALUE         01190000
012000                                        ' DPKCS048:'.             01200000
012100         10  PV-LOG-TERM-NUM            PIC  ZZZ9   VALUE ZERO.   01210000
012200         10  FILLER                     PIC  X(11)  VALUE         01220000
012300             ' SAVECOMM &'.                                       01230000
012400         10  PV-LOG-TERM-TSQ            PIC  ZZZ9   VALUE ZERO.   01240000
012500         10  FILLER                     PIC  X(25)  VALUE         01250000
012600             ' TSQ DELETED FOR NETNAME '.                         01260000
012700         10  PV-LOG-TERM-NETNAME        PIC  X(08)  VALUE ZERO.   01270000
012800         10  PV-LOG-TERM-REASON         PIC  X(17)  VALUE SPACES. 01280000
012900                                                                  01290000
013000     05  PV-PARM-DATA.                                            01300000
013100         10  PV-PARM-TRANID             PIC  X(04)  VALUE SPACE.  01310000
013200         10                             PIC  X(01)  VALUE SPACE.  01320000
013300             88  PV-VALID-FORMAT                    VALUE SPACE.  01330000
013400         10  PV-PARM-HOURS              PIC  X(01)  VALUE SPACE.  01340000
013500         10  PV-PARM-HOURS-9  REDEFINES                           01350000
013600             PV-PARM-HOURS              PIC  9(01).               01360000
013700     05  PV-PARM-LENGTH                 PIC S9(04)  COMP          01370000
013800                                                    VALUE +6.     01380000
013900******************************************************************01390000
014000*    LAYOUT USED TO GET THE SYSTEM DATE AND TIME                  01400000
014100******************************************************************01410000
014200 01  DT-DATE-TIME-VARIABLES.                                      01420000
014300     05  DT-ABSTIME                  PIC S9(15)  VALUE ZERO       01430000
014400                                                 COMP-3.          01440000
014500     05  DT-YEAR-BIN                 PIC S9(09)  VALUE ZERO       01450000
014600                                                 COMP SYNC.       01460000
014700     05  DT-FORMATTED-TIME           PIC  X(08)  VALUE SPACE.     01470000
014800     05  DT-FORMATTED-DATE           PIC  X(10)  VALUE SPACE.     01480000
014900     05  FILLER                      REDEFINES DT-FORMATTED-DATE. 01490000
015000         10  DT-FORMATTED-MMDDYY     PIC  X(08).                  01500000
015100         10  FILLER                  PIC  X(02).                  01510000
015200     05  FILLER                      REDEFINES DT-FORMATTED-DATE. 01520000
015300         10  FILLER                  PIC  X(06).                  01530000
015400         10  DT-FORMATTED-YYYY       PIC  9(04).                  01540000
015500                                                                  01550000
015600 01  PM-PROGRAM-MESSAGE-ERROR.                                    01560000
015700     05  PM-PARM-ERROR.                                           01570000
015800         10  CARRIAGE-RETURN-1          PIC X(1)     VALUE X'15'. 01580000
015900         10  FILLER                     PIC X(22)    VALUE        01590000
016000                                        'DPKCS048 PARM ERROR!!!'. 01600000
016100         10  CARRIAGE-RETURN-2          PIC X(1)     VALUE X'15'. 01610000
016200         10  FILLER                     PIC X(16)    VALUE        01620000
016300                                     'USE FORMAT: Z048'.          01630000
016400         10  CARRIAGE-RETURN-3          PIC X(1)     VALUE X'15'. 01640000
016500         10  FILLER                     PIC X(32)    VALUE        01650000
016600                          '        OR: Z048 # (where # is a'.     01660000
016700         10  FILLER                     PIC X(46)    VALUE        01670000
016800             ' single digit number indicating HOURS to keep)'.    01680000
016900         10  CARRIAGE-RETURN-4          PIC X(1)     VALUE X'15'. 01690000
017000         10  FILLER                     PIC X(47)    VALUE        01700000
017100               '               (The default number of hours is '. 01710000
017200         10  PM-ERROR-DEFAULT           PIC 9(02).                01720000
017300         10  FILLER                     PIC X(01)    VALUE        01730000
017400                                                           ')'.   01740000
017500         10  CARRIAGE-RETURN-5          PIC X(1)     VALUE X'15'. 01750000
017600     05  PM-PARM-ERROR-LEN              PIC S9(4)    COMP         01760000
017700                                                     VALUE +0171. 01770000
017800                                                                  01780000
017900 01  PM-SCREEN-DISPLAY               PIC X(400)   VALUE SPACES.   01790000
018000 01  PM-GRAND-TOTAL.                                              01800000
018100     05  FILLER                      PIC X(01)    VALUE ' '.      01810000
018200     05  PM-TOTAL-DELETED.                                        01820000
018300         10  FILLER                  PIC X(10)    VALUE           01830000
018400                                     'DPKCS048: '.                01840000
018500         10  PM-NUM-RECS             PIC ZZZZZZ9  VALUE ZERO.     01850000
018600         10  FILLER                  PIC X(30)    VALUE           01860000
018700             ' RECORDS DELETED FROM DPSAVCMK'.                    01870000
018800 01  PM-GRAND-TOTAL-TSQ.                                          01880000
018900     05  FILLER                      PIC X(01)    VALUE ' '.      01890000
019000     05  FILLER                      PIC X(10)    VALUE           01900000
019100                                     'DPKCS048: '.                01910000
019200     05  PM-TOTAL-TSQ-DELETED.                                    01920000
019300         10  PM-NUM-TSQS             PIC ZZZZZZ9  VALUE ZERO.     01930000
019400         10  FILLER                  PIC X(18)    VALUE           01940000
019500             ' TS QUEUES DELETED'.                                01950000
019600 01  PM-LOG-SESSIONS-UNATTACHED.                                  01960000
019700     05  FILLER                      PIC X(01)    VALUE ' '.      01970000
019800     05  FILLER                      PIC X(10)    VALUE           01980000
019900                                     'DPKCS048: '.                01990000
020000     05  PM-TOTAL-SESSIONS-UNATTACHED.                            02000000
020100         10  PM-SESSIONS-UNATTACHED  PIC ZZZZZZ9  VALUE ZERO.     02010000
020200         10  FILLER                  PIC X(33)    VALUE           02020000
020300             ' DELETED SESSIONS WERE UNATTACHED'.                 02030000
020400 01  PM-LOG-SESSIONS-EXPIRED.                                     02040000
020500     05  FILLER                      PIC X(01)    VALUE ' '.      02050000
020600     05  FILLER                      PIC X(10)    VALUE           02060000
020700                                     'DPKCS048: '.                02070000
020800     05  PM-TOTAL-SESSIONS-EXPIRED.                               02080000
020900         10  PM-SESSIONS-EXPIRED     PIC ZZZZZZ9  VALUE ZERO.     02090000
021000         10  FILLER                  PIC X(30)    VALUE           02100000
021100             ' DELETED SESSIONS WERE EXPIRED'.                    02110000
021200 01  PM-LOG-RECORDS-UNATTACHED.                                   02120000
021300     05  FILLER                      PIC X(01)    VALUE ' '.      02130000
021400     05  FILLER                      PIC X(10)    VALUE           02140000
021500                                     'DPKCS048: '.                02150000
021600     05  PM-TOTAL-RECORDS-UNATTACHED.                             02160000
021700         10  PM-RECORDS-UNATTACHED   PIC ZZZZZZ9  VALUE ZERO.     02170000
021800         10  FILLER                  PIC X(32)    VALUE           02180000
021900             ' DELETED RECORDS WERE UNATTACHED'.                  02190000
022000 01  PM-LOG-RECORDS-EXPIRED.                                      02200000
022100     05  FILLER                      PIC X(01)    VALUE ' '.      02210000
022200     05  FILLER                      PIC X(10)    VALUE           02220000
022300                                     'DPKCS048: '.                02230000
022400     05  PM-TOTAL-RECORDS-EXPIRED.                                02240000
022500         10  PM-RECORDS-EXPIRED      PIC ZZZZZZ9  VALUE ZERO.     02250000
022600         10  FILLER                  PIC X(29)    VALUE           02260000
022700             ' DELETED RECORDS WERE EXPIRED'.                     02270000
022800***************************************************************** 02280000
022900*    SAVED COMMAREA VSAM RECORD LAYOUT.                           02290000
023000***************************************************************** 02300000
023100     COPY DPRD515.                                                02310000
023200                                                                  02320000
023300***************************************************************** 02330000
023400*    ABEND PROCESSING COPYBOOK.                                   02340000
023500***************************************************************** 02350000
023600     COPY DPWS013.                                                02360000
023700                                                                  02370000
023800                                                                  02380000
023900********************                                              02390000
024000 PROCEDURE DIVISION.                                              02400000
024100********************                                              02410000
024200                                                                  02420000
024300 0000-MAIN-MODULE.                                                02430000
024400                                                                  02440000
024500     PERFORM 1000-INITIALIZATION.                                 02450000
024600     PERFORM 2000-PROCESS-SAVE-COMM                               02460000
024700         UNTIL PS-EOF-SAVE-COMM.                                  02470000
024800     PERFORM 3000-TERMINATION.                                    02480000
024900                                                                  02490000
025000     GOBACK.                                                      02500000
025100                                                                  02510000
025200****************************************************************  02520000
025300**  WRITE A START LINE TO THE LOG AND START THE BROWSE ON THE **  02530000
025400**  SAVED COMMAREA VSAM FILE AND DO THE PRIMING READ.         **  02540000
025500****************************************************************  02550000
025600 1000-INITIALIZATION.                                             02560000
025700     PERFORM 1100-READ-PARM.                                      02570000
025800     MOVE EIBDATE             TO PV-CUTOFF-DATE.                  02580000
025900     MOVE EIBTIME             TO PV-CUTOFF-TIME.                  02590000
026000     COMPUTE PV-CUTOFF-AMOUNT = PC-CUTOFF-HOURS * 10000.          02600000
026100     IF PV-CUTOFF-TIME > PV-CUTOFF-AMOUNT                         02610000
026200         COMPUTE PV-CUTOFF-TIME = PV-CUTOFF-TIME                  02620000
026300                                - PV-CUTOFF-AMOUNT                02630000
026400     ELSE                                                         02640000
026500         COMPUTE PV-CUTOFF-DATE = PV-CUTOFF-DATE - 1              02650000
026600         COMPUTE PV-CUTOFF-TIME = PV-CUTOFF-TIME                  02660000
026700                                + 240000                          02670000
026800                                - PV-CUTOFF-AMOUNT                02680000
026900     END-IF.                                                      02690000
027000                                                                  02700000
027100     MOVE LOW-VALUES          TO DP515-KEY                        02710000
027200                                 PV-START-KEY.                    02720000
027300     PERFORM 4000-GET-CURR-DATE-TIME.                             02730000
027400     MOVE DT-FORMATTED-TIME   TO PV-LOG-START-TIME.               02740000
027500     MOVE DT-FORMATTED-DATE   TO PV-LOG-START-DATE.               02750000
027600     MOVE PV-LOG-START-LINE   TO PV-LOG-LINE.                     02760000
027700     EXEC CICS                                                    02770000
027800         ENQ                                                      02780000
027900             RESOURCE (PC-LOG-QUEUE-RESOURCE)                     02790000
028000     END-EXEC.                                                    02800000
028100     PERFORM 3100-WRITEQ-TD.                                      02810000
028200*                                                                 02820000
028300     PERFORM 2430-START-BROWSE.                                   02830000
028400     IF  PS-NOT-EOF-SAVE-COMM                                     02840000
028500         PERFORM 2100-READNEXT-VSAM                               02850000
028600     END-IF.                                                      02860000
028700                                                                  02870000
028800                                                                  02880000
028900 1100-READ-PARM.                                                  02890000
029000     EXEC CICS RECEIVE                                            02900000
029100         INTO   (PV-PARM-DATA)                                    02910000
029200         LENGTH (PV-PARM-LENGTH)                                  02920000
029300         RESP   (PV-CICS-RESPONSE)                                02930000
029400     END-EXEC.                                                    02940000
029500     IF (PV-CICS-RESPONSE = DFHRESP(NORMAL)                       02950000
029600     OR  PV-CICS-RESPONSE = DFHRESP(EOC))                         02960000
029700     AND PV-VALID-FORMAT                                          02970000
029800         IF PV-PARM-HOURS IS NUMERIC                              02980000
029900             IF  PV-PARM-HOURS >= 1                               02990000
030000             AND PV-PARM-HOURS <= 9                               03000000
030100                 MOVE PV-PARM-HOURS-9 TO PC-CUTOFF-HOURS          03010000
030200             END-IF                                               03020000
030300         END-IF                                                   03030000
030400     ELSE                                                         03040000
030500         MOVE PC-CUTOFF-HOURS TO PM-ERROR-DEFAULT                 03050000
030600         EXEC CICS SEND TEXT                                      03060000
030700             FROM   (PM-PARM-ERROR)                               03070000
030800             LENGTH (PM-PARM-ERROR-LEN)                           03080000
030900         END-EXEC                                                 03090000
031000         GOBACK                                                   03100000
031100     END-IF.                                                      03110000
031200                                                                  03120000
031300****************************************************************  03130000
031400** OVERALL CONTROL WHILE PROCESSING THROUGH THE VSAM FILE.    **  03140000
031500** IF THE TERMINAL IS FOUND IN THE REGION (STATUS-FND)        **  03150000
031600** CONTINUE TO THE NEXT RECORD, OTHERWISE DELETE ALL RECORDS  **  03160000
031700** FOR THE TERMINAL (NETNAME).                                **  03170000
031800****************************************************************  03180000
031900 2000-PROCESS-SAVE-COMM.                                          03190000
032000     PERFORM 2200-DETERMINE-STATUS.                               03200000
032100     IF  PS-STATUS-KEEP                                           03210000
032200         CONTINUE                                                 03220000
032300     ELSE                                                         03230000
032400         PERFORM 2400-DELETE-SAVED-COMMAREAS                      03240000
032500         PERFORM 2500-DELETE-TSQUEUES                             03250000
032600         PERFORM 2900-LOG-TOTALS                                  03260000
032700     END-IF.                                                      03270000
032800     IF  PS-NOT-EOF-SAVE-COMM                                     03280000
032900         PERFORM 2100-READNEXT-VSAM                               03290000
033000     END-IF.                                                      03300000
033100                                                                  03310000
033200******************************************************************03320000
033300*  UTILITY PARAGRAPH TO READ THE NEXT RECORD IN THE DPSAVCMK     *03330000
033400*  VSAM FILE.                                                    *03340000
033500******************************************************************03350000
033600 2100-READNEXT-VSAM.                                              03360000
033700     PERFORM                                                      03370000
033800     WITH TEST AFTER                                              03380000
033900     UNTIL ((DP515-KEY > PV-START-KEY)                            03390000
034000        OR (PS-EOF-SAVE-COMM))                                    03400000
034100         MOVE LENGTH OF DP515-SAVED-COMMAREA-RECORD               03410000
034200                       TO PV-RECORD-LENGTH                        03420000
034300         EXEC CICS                                                03430000
034400             READNEXT                                             03440000
034500                 DATASET (PC-SAVE-COMM-DD)                        03450000
034600                 RIDFLD  (DP515-KEY)                              03460000
034700                 INTO    (DP515-SAVED-COMMAREA-RECORD)            03470000
034800                 LENGTH  (PV-RECORD-LENGTH)                       03480000
034900                 RESP    (PV-CICS-RESPONSE)                       03490000
035000         END-EXEC                                                 03500000
035100                                                                  03510000
035200         EVALUATE PV-CICS-RESPONSE                                03520000
035300             WHEN DFHRESP(NORMAL)                                 03530000
035400                 CONTINUE                                         03540000
035500             WHEN DFHRESP(ENDFILE)                                03550000
035600             WHEN DFHRESP(NOTFND)                                 03560000
035700                 SET PS-EOF-SAVE-COMM TO TRUE                     03570000
035800             WHEN OTHER                                           03580000
035900                 SET DP013-CICS-ABEND                             03590000
036000                     DP013-XCTL-DISPLAY-LOGOFF TO TRUE            03600000
036100                 MOVE '2100-READNEXT-VSAM'     TO DP013-PARAGRAPH 03610000
036200                 STRING 'ATTEMPTING TO READ THE NEXT RECORD '     03620000
036300                                                DELIMITED BY SIZE 03630000
036400                        'THE ITEM FILE ('       DELIMITED BY SIZE 03640000
036500                        PC-SAVE-COMM-DD         DELIMITED BY SIZE 03650000
036600                        ')  RIDFLD = ('         DELIMITED BY SIZE 03660000
036700                        DP515-KEY               DELIMITED BY SIZE 03670000
036800                        ')'                     DELIMITED BY SIZE 03680000
036900                    INTO DP013-MESSAGE-TEXT (1)                   03690000
037000                 PERFORM DP014-0000-PROCESS-ABEND                 03700000
037100         END-EVALUATE                                             03710000
037200     END-PERFORM.                                                 03720000
037300                                                                  03730000
037400******************************************************************03740000
037500** THIS PARAGRAPH WILL DETERMINE IF THE NETNAME FROM THE DPSAVCMK*03750000
037600** RECORD IS CURRENTLY KNOWN TO THIS CICS REGION.                *03760000
037700******************************************************************03770000
037800 2200-DETERMINE-STATUS.                                           03780000
037900     IF  DP515-NETNAME = PV-OLD-NETNAME                           03790000
038000         CONTINUE                                                 03800000
038100     ELSE                                                         03810000
038200         EXEC CICS                                                03820000
038300             INQUIRE                                              03830000
038400                 NETNAME (DP515-NETNAME)                          03840000
038500             RESP (PV-CICS-RESPONSE)                              03850000
038600         END-EXEC                                                 03860000
038700                                                                  03870000
038800         IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                  03880000
038900             SET PS-STATUS-KEEP TO TRUE                           03890000
039000         ELSE                                                     03900000
039100             SET PS-STATUS-DELETE     TO TRUE                     03910000
039200             SET PS-DELETE-UNATTACHED TO TRUE                     03920000
039300         END-IF                                                   03930000
039400         MOVE DP515-NETNAME    TO PV-OLD-NETNAME                  03940000
039500     END-IF.                                                      03950000
039600                                                                  03960000
039700     IF PS-STATUS-KEEP                                            03970000
039800         MOVE DP515-CREATE-EIBDATE TO PV-RECORD-DATE              03980000
039900         MOVE DP515-CREATE-EIBTIME TO PV-RECORD-TIME              03990000
040000         PERFORM  UNTIL DP515-NETNAME NOT = PV-OLD-NETNAME        04000000
040100                     OR PV-RECORD-TIMESTAMP > PV-CUTOFF-TIMESTAMP 04010000
040200                     OR PS-EOF-SAVE-COMM                          04020000
040300             PERFORM 2100-READNEXT-VSAM                           04030000
040400             MOVE DP515-CREATE-EIBDATE TO PV-RECORD-DATE          04040000
040500             MOVE DP515-CREATE-EIBTIME TO PV-RECORD-TIME          04050000
040600         END-PERFORM                                              04060000
040700         IF DP515-NETNAME NOT = PV-OLD-NETNAME                    04070000
040800             SET PS-STATUS-DELETE  TO TRUE                        04080000
040900             SET PS-DELETE-EXPIRED TO TRUE                        04090000
041000             MOVE PV-OLD-NETNAME  TO DP515-NETNAME                04100000
041100         END-IF                                                   04110000
041200     END-IF.                                                      04120000
041300                                                                  04130000
041400******************************************************************04140000
041500** END THE BROWSE ON THE SAVED COMMAREA FILE.  DO A GENERIC     **04150000
041600** DELETE ON THE NETNAME, WRITE A RECORD TO THE LOG INDICATING  **04160000
041700** NUMBER OF RECORDS DELETED AND THEN START THE BROWSE FOR THE  **04170000
041800** NEXT HIGHER RECORD.                                          **04180000
041900******************************************************************04190000
042000 2400-DELETE-SAVED-COMMAREAS.                                     04200000
042100     MOVE DP515-NETNAME       TO PV-START-KEY-NETNAME.            04210000
042200     PERFORM 2410-END-SAVE-COMM-FILE.                             04220000
042300     PERFORM 2420-DELETE-SAVE-COMM-GNRC.                          04230000
042400     ADD PV-DEL-RECS-TERM     TO PV-DEL-RECS-TOTAL.               04240000
042500     MOVE ' (UNKNOWN REASON)' TO PV-LOG-TERM-REASON               04250000
042600     IF PS-DELETE-UNATTACHED                                      04260000
042700         ADD 1                TO PV-UNATTACHED-SESSIONS           04270000
042800         ADD PV-DEL-RECS-TERM TO PV-UNATTACHED-RECORDS            04280000
042900         MOVE ' (UNATTACHED)' TO PV-LOG-TERM-REASON               04290000
043000     END-IF                                                       04300000
043100     IF PS-DELETE-EXPIRED                                         04310000
043200         ADD 1                TO PV-EXPIRED-SESSIONS              04320000
043300         ADD PV-DEL-RECS-TERM TO PV-EXPIRED-RECORDS               04330000
043400         MOVE ' (EXPIRED)'    TO PV-LOG-TERM-REASON               04340000
043500     END-IF                                                       04350000
043600*                                                                 04360000
043700     MOVE PV-START-KEY-NETNAME TO DP515-NETNAME.                  04370000
043800     PERFORM 2430-START-BROWSE.                                   04380000
043900                                                                  04390000
044000******************************************************************04400000
044100*  UTILITY PARAGRAPH TO END THE BROWSING OF THE DPSAVCMK VSAM    *04410000
044200*  FILE.                                                         *04420000
044300******************************************************************04430000
044400 2410-END-SAVE-COMM-FILE.                                         04440000
044500     EXEC CICS                                                    04450000
044600         ENDBR                                                    04460000
044700             DATASET (PC-SAVE-COMM-DD)                            04470000
044800             RESP    (PV-CICS-RESPONSE)                           04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    04510000
045200         SET DP013-CICS-ABEND TO TRUE                             04520000
045300         MOVE '2410-END-SAVE-COMM-FILE' TO DP013-PARAGRAPH        04530000
045400         STRING 'ATTEMPTING TO END A BROWSE ON THE SAVE COMM'     04540000
045500                                                DELIMITED BY SIZE 04550000
045600                'FILE ('                        DELIMITED BY SIZE 04560000
045700                PC-SAVE-COMM-DD                 DELIMITED BY SIZE 04570000
045800                ')'                             DELIMITED BY SIZE 04580000
045900             INTO DP013-MESSAGE-TEXT (1)                          04590000
046000         PERFORM DP014-0000-PROCESS-ABEND                         04600000
046100     END-IF.                                                      04610000
046200                                                                  04620000
046300****************************************************************  04630000
046400**  DELETE ALL RECORDS FOR A GIVEN NETNAME.                   **  04640000
046500****************************************************************  04650000
046600 2420-DELETE-SAVE-COMM-GNRC.                                      04660000
046700                                                                  04670000
046800     EXEC CICS DELETE                                             04680000
046900          FILE      (PC-SAVE-COMM-DD)                             04690000
047000          RIDFLD    (DP515-KEY)                                   04700000
047100          KEYLENGTH (PC-NETNAME-LENGTH)                           04710000
047200          GENERIC                                                 04720000
047300          NUMREC    (PV-DEL-RECS-TERM)                            04730000
047400          RESP      (PV-CICS-RESPONSE)                            04740000
047500     END-EXEC.                                                    04750000
047600                                                                  04760000
047700     IF (PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   04770000
047800     OR  PV-CICS-RESPONSE EQUAL DFHRESP(NOTFND))                  04780000
047900         CONTINUE                                                 04790000
048000     ELSE                                                         04800000
048100         SET DP013-CICS-ABEND  TO  TRUE                           04810000
048200         SET DP013-LINK-RETURN TO  TRUE                           04820000
048300         SET DP013-NO-ROLLBACK TO  TRUE                           04830000
048400         MOVE '2420-DELETE-SAVE-COMM-GNRC'                        04840000
048500                               TO  DP013-PARAGRAPH                04850000
048600         MOVE 'BAD RETURN CODE FROM SAVECOMM VSAM DELETE'         04860000
048700                               TO  DP013-MESSAGE-TEXT (1)         04870000
048800         PERFORM DP014-0000-PROCESS-ABEND                         04880000
048900     END-IF.                                                      04890000
049000                                                                  04900000
049100******************************************************************04910000
049200*  UTILITY PARAGRAPH TO INITIATE THE RETREIVAL OF THE SAVED COMM *04920000
049300*  RECORDS FROM THE VSAM FILE.                                   *04930000
049400******************************************************************04940000
049500 2430-START-BROWSE.                                               04950000
049600     EXEC CICS                                                    04960000
049700         STARTBR                                                  04970000
049800             DATASET (PC-SAVE-COMM-DD)                            04980000
049900             RIDFLD  (DP515-KEY)                                  04990000
050000             KEYLENGTH (PC-DP515-KEYLENGTH)                       05000000
050100             GTEQ                                                 05010000
050200             RESP    (PV-CICS-RESPONSE)                           05020000
050300     END-EXEC.                                                    05030000
050400                                                                  05040000
050500     EVALUATE PV-CICS-RESPONSE                                    05050000
050600         WHEN DFHRESP(NORMAL)                                     05060000
050700             CONTINUE                                             05070000
050800         WHEN DFHRESP(ENDFILE)                                    05080000
050900         WHEN DFHRESP(NOTFND)                                     05090000
051000             SET PS-EOF-SAVE-COMM  TO TRUE                        05100000
051100         WHEN OTHER                                               05110000
051200             SET DP013-CICS-ABEND  TO  TRUE                       05120000
051300             SET DP013-LINK-RETURN TO  TRUE                       05130000
051400             SET DP013-NO-ROLLBACK TO  TRUE                       05140000
051500             MOVE '2430-START-BROWSE'                             05150000
051600                               TO  DP013-PARAGRAPH                05160000
051700             MOVE 'BAD RETURN CODE FROM DPSAVCOMM VSAM START'     05170000
051800                               TO  DP013-MESSAGE-TEXT (1)         05180000
051900             PERFORM DP014-0000-PROCESS-ABEND                     05190000
052000     END-EVALUATE.                                                05200000
052100******************************************************************05210000
052200** BROWSE FOR TSQUEUES THAT EXIST FOR THIS TERMID AND DELETE    **05220000
052300** THEM.                                                        **05230000
052400******************************************************************05240000
052500 2500-DELETE-TSQUEUES.                                            05250000
052600     MOVE LOW-VALUES    TO PV-TS-KEY.                             05260000
052700     MOVE DP515-TERM-ID TO PV-TS-KEY-TERM-ID.                     05270000
052800     PERFORM 2510-TSQUEUE-BROWSE-START.                           05280000
052900                                                                  05290000
053000     MOVE 0 TO PV-DEL-TSQS-TERM.                                  05300000
053100     PERFORM 2520-TSQUEUE-BROWSE-NEXT.                            05310000
053200     PERFORM  UNTIL PV-TS-KEY-TERM-ID NOT = DP515-TERM-ID         05320000
053300                 OR PV-CICS-RESPONSE      = DFHRESP(END)          05330000
053400         PERFORM 2540-DELETE-TSQUEUE                              05340000
053500         PERFORM 2520-TSQUEUE-BROWSE-NEXT                         05350000
053600     END-PERFORM.                                                 05360000
053700     PERFORM 2530-TSQUEUE-BROWSE-END.                             05370000
053800     ADD PV-DEL-TSQS-TERM TO PV-DEL-TSQS-TOTAL.                   05380000
053900                                                                  05390000
054000******************************************************************05400000
054100** START BROWSING THE TSQUEUE NAMES.                            **05410000
054200******************************************************************05420000
054300 2510-TSQUEUE-BROWSE-START.                                       05430000
054400     EXEC CICS                                                    05440000
054500         INQUIRE TSQNAME                                          05450000
054600             START AT (PV-TS-KEY)                                 05460000
054700             RESP     (PV-CICS-RESPONSE)                          05470000
054800     END-EXEC                                                     05480000
054900     EVALUATE PV-CICS-RESPONSE                                    05490000
055000         WHEN DFHRESP(NORMAL)                                     05500000
055100         WHEN DFHRESP(END)                                        05510000
055200             CONTINUE                                             05520000
055300         WHEN OTHER                                               05530000
055400             SET DP013-CICS-ABEND                                 05540000
055500                 DP013-XCTL-DISPLAY-LOGOFF TO TRUE                05550000
055600             MOVE '2510-TSQUEUE-BROWSE-START' TO DP013-PARAGRAPH  05560000
055700             STRING 'ATTEMPTING TO START BROWSE ON TSQUEUE '      05570000
055800                    PV-TS-KEY               DELIMITED BY SIZE     05580000
055900                INTO DP013-MESSAGE-TEXT (1)                       05590000
056000             PERFORM DP014-0000-PROCESS-ABEND                     05600000
056100     END-EVALUATE.                                                05610000
056200                                                                  05620000
056300******************************************************************05630000
056400** BROWSE FOR THE NEXT TSQUEUE NAME.                            **05640000
056500******************************************************************05650000
056600 2520-TSQUEUE-BROWSE-NEXT.                                        05660000
056700     EXEC CICS                                                    05670000
056800         INQUIRE TSQNAME (PV-TS-KEY)                              05680000
056900             NEXT                                                 05690000
057000             RESP    (PV-CICS-RESPONSE)                           05700000
057100     END-EXEC                                                     05710000
057200     EVALUATE PV-CICS-RESPONSE                                    05720000
057300         WHEN DFHRESP(NORMAL)                                     05730000
057400         WHEN DFHRESP(END)                                        05740000
057500             CONTINUE                                             05750000
057600         WHEN OTHER                                               05760000
057700             SET DP013-CICS-ABEND                                 05770000
057800                 DP013-XCTL-DISPLAY-LOGOFF TO TRUE                05780000
057900             MOVE '2520-TSQUEUE-BROWSE-NEXT' TO DP013-PARAGRAPH   05790000
058000             STRING 'ATTEMPTING TO BROWSE NEXT ON TSQUEUE '       05800000
058100                    PV-TS-KEY               DELIMITED BY SIZE     05810000
058200                INTO DP013-MESSAGE-TEXT (1)                       05820000
058300             PERFORM DP014-0000-PROCESS-ABEND                     05830000
058400     END-EVALUATE.                                                05840000
058500                                                                  05850000
058600******************************************************************05860000
058700** STOP BROWSING THE TSQUEUE NAMES.                             **05870000
058800******************************************************************05880000
058900 2530-TSQUEUE-BROWSE-END.                                         05890000
059000     EXEC CICS                                                    05900000
059100         INQUIRE TSQNAME                                          05910000
059200             END                                                  05920000
059300             RESP (PV-CICS-RESPONSE)                              05930000
059400     END-EXEC                                                     05940000
059500     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05950000
059600         SET DP013-CICS-ABEND                                     05960000
059700             DP013-XCTL-DISPLAY-LOGOFF TO TRUE                    05970000
059800         MOVE '2530-TSQUEUE-BROWSE-END' TO DP013-PARAGRAPH        05980000
059900         MOVE 'ATTEMPTING TO END BROWSE ON TSQUEUES'              05990000
060000           TO DP013-MESSAGE-TEXT (1)                              06000000
060100         PERFORM DP014-0000-PROCESS-ABEND                         06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
060400******************************************************************06040000
060500** DELETE THE TSQUEUE NAME.                                     **06050000
060600******************************************************************06060000
060700 2540-DELETE-TSQUEUE.                                             06070000
060800     EXEC CICS                                                    06080000
060900         DELETEQ                                                  06090000
061000             TS QNAME (PV-TS-KEY)                                 06100000
061100             RESP     (PV-CICS-RESPONSE)                          06110000
061200     END-EXEC.                                                    06120000
061300     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        06130000
061400         ADD 1 TO PV-DEL-TSQS-TERM                                06140000
061500     ELSE                                                         06150000
061600         SET DP013-CICS-ABEND                                     06160000
061700             DP013-XCTL-DISPLAY-LOGOFF TO TRUE                    06170000
061800         MOVE '2540-DELETE-TSQUEUE'    TO DP013-PARAGRAPH         06180000
061900         STRING 'ATTEMPTING TO DELETEQ ON TSQUEUE '               06190000
062000                PV-TS-KEY               DELIMITED BY SIZE         06200000
062100            INTO DP013-MESSAGE-TEXT (1)                           06210000
062200         PERFORM DP014-0000-PROCESS-ABEND                         06220000
062300     END-IF.                                                      06230000
062400                                                                  06240000
062500****************************************************************  06250000
062600** WRITE TO THE CSSL LOG A MESSAGE ABOUT WHAT WAS DELETED.    **  06260000
062700****************************************************************  06270000
062800 2900-LOG-TOTALS.                                                 06280000
062900*  WRITE THE NUMBER OF RECORDS DELETED TO CSSL                    06290000
063000     MOVE PV-DEL-RECS-TERM TO PV-LOG-TERM-NUM.                    06300000
063100     MOVE DP515-NETNAME    TO PV-LOG-TERM-NETNAME.                06310000
063200     MOVE PV-DEL-TSQS-TERM TO PV-LOG-TERM-TSQ.                    06320000
063300     MOVE PV-LOG-TERM-LINE TO PV-LOG-LINE.                        06330000
063400     PERFORM 3100-WRITEQ-TD.                                      06340000
063500                                                                  06350000
063600****************************************************************  06360000
063700** WRITE A TERMINATION LINE TO THE CICS LOG, RELEASE THE      **  06370000
063800** QUEUE ON THE LOG, WRITE A MESSAGE TO THE SCREEN INDICATING **  06380000
063900** NUMBER OF RECORDS DELETED AND RETURN.                      **  06390000
064000****************************************************************  06400000
064100 3000-TERMINATION.                                                06410000
064200     MOVE PV-DEL-RECS-TOTAL          TO PM-NUM-RECS.              06420000
064300     MOVE PM-GRAND-TOTAL             TO PV-LOG-LINE.              06430000
064400     PERFORM 3100-WRITEQ-TD.                                      06440000
064500                                                                  06450000
064600     MOVE PV-DEL-TSQS-TOTAL          TO PM-NUM-TSQS.              06460000
064700     MOVE PM-GRAND-TOTAL-TSQ         TO PV-LOG-LINE.              06470000
064800     PERFORM 3100-WRITEQ-TD.                                      06480000
064900                                                                  06490000
065000     MOVE PV-UNATTACHED-SESSIONS     TO PM-SESSIONS-UNATTACHED.   06500000
065100     MOVE PM-LOG-SESSIONS-UNATTACHED TO PV-LOG-LINE.              06510000
065200     PERFORM 3100-WRITEQ-TD.                                      06520000
065300                                                                  06530000
065400     MOVE PV-EXPIRED-SESSIONS        TO PM-SESSIONS-EXPIRED.      06540000
065500     MOVE PM-LOG-SESSIONS-EXPIRED    TO PV-LOG-LINE.              06550000
065600     PERFORM 3100-WRITEQ-TD.                                      06560000
065700                                                                  06570000
065800     MOVE PV-UNATTACHED-RECORDS      TO PM-RECORDS-UNATTACHED.    06580000
065900     MOVE PM-LOG-RECORDS-UNATTACHED  TO PV-LOG-LINE.              06590000
066000     PERFORM 3100-WRITEQ-TD.                                      06600000
066100                                                                  06610000
066200     MOVE PV-EXPIRED-RECORDS         TO PM-RECORDS-EXPIRED.       06620000
066300     MOVE PM-LOG-RECORDS-EXPIRED     TO PV-LOG-LINE.              06630000
066400     PERFORM 3100-WRITEQ-TD.                                      06640000
066500                                                                  06650000
066600     PERFORM 4000-GET-CURR-DATE-TIME.                             06660000
066700     MOVE DT-FORMATTED-TIME   TO PV-LOG-END-TIME.                 06670000
066800     MOVE DT-FORMATTED-DATE   TO PV-LOG-END-DATE.                 06680000
066900     MOVE PV-LOG-END-LINE   TO PV-LOG-LINE.                       06690000
067000     PERFORM 3100-WRITEQ-TD.                                      06700000
067100     EXEC CICS                                                    06710000
067200         DEQ                                                      06720000
067300             RESOURCE (PC-LOG-QUEUE-RESOURCE)                     06730000
067400     END-EXEC.                                                    06740000
067500     PERFORM 3200-SEND-TEXT.                                      06750000
067600     EXEC CICS                                                    06760000
067700         RETURN                                                   06770000
067800     END-EXEC.                                                    06780000
067900                                                                  06790000
068000****************************************************************  06800000
068100** WRITE TO THE LOG                                           **  06810000
068200****************************************************************  06820000
068300 3100-WRITEQ-TD.                                                  06830000
068400     EXEC CICS                                                    06840000
068500         WRITEQ TD                                                06850000
068600             QUEUE (PC-LOG-QUEUE)                                 06860000
068700             FROM  (PV-LOG-LINE)                                  06870000
068800             RESP  (PV-CICS-RESPONSE)                             06880000
068900     END-EXEC.                                                    06890000
069000*                                                                 06900000
069100     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       06910000
069200         CONTINUE                                                 06920000
069300     ELSE                                                         06930000
069400         INITIALIZE                DP013-MESSAGE-TABLE            06940000
069500         SET DP013-CICS-ABEND  TO  TRUE                           06950000
069600         SET DP013-LINK-RETURN TO  TRUE                           06960000
069700         SET DP013-NO-ROLLBACK TO  TRUE                           06970000
069800         MOVE '3100-WRITEQ-TD'                                    06980000
069900                               TO  DP013-PARAGRAPH                06990000
070000         MOVE 'BAD RETURN CODE FROM WRITE TO CSSL'                07000000
070100                               TO  DP013-MESSAGE-TEXT (1)         07010000
070200         PERFORM DP014-0000-PROCESS-ABEND                         07020000
070300     END-IF.                                                      07030000
070400****************************************************************  07040000
070500**  SEND A LINE OF TEXT TO THE TERMINAL SHOWING TOTAL         **  07050000
070600**  RECORDS DELETED.                                          **  07060000
070700****************************************************************  07070000
070800 3200-SEND-TEXT.                                                  07080000
071100     STRING PM-TOTAL-DELETED                                      07110000
071200        PC-CR-INDENT PM-TOTAL-TSQ-DELETED                         07120000
071300        PC-2CR-INDENT PM-TOTAL-SESSIONS-UNATTACHED                07130000
071400        PC-CR-INDENT PM-TOTAL-SESSIONS-EXPIRED                    07140000
071500        PC-2CR-INDENT PM-TOTAL-RECORDS-UNATTACHED                 07150000
071600        PC-CR-INDENT PM-TOTAL-RECORDS-EXPIRED                     07160000
071700        DELIMITED BY SIZE INTO PM-SCREEN-DISPLAY.                 07170000
071800                                                                  07180000
071900     EXEC CICS                                                    07190000
072000          SEND TEXT                                               07200000
072100          FROM   (PM-SCREEN-DISPLAY)                              07210000
072200          LENGTH (PC-MESSAGE-LENGTH)                              07220000
072300          ERASE                                                   07230000
072400          RESP   (PV-CICS-RESPONSE)                               07240000
072500     END-EXEC.                                                    07250000
072600     IF (PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL))                  07260000
072700         CONTINUE                                                 07270000
072800     ELSE                                                         07280000
072900         SET DP013-CICS-ABEND  TO  TRUE                           07290000
073000         SET DP013-LINK-RETURN TO  TRUE                           07300000
073100         SET DP013-NO-ROLLBACK TO  TRUE                           07310000
073200         MOVE '3200-SEND-TEXT' TO DP013-PARAGRAPH                 07320000
073300         MOVE 'BAD RETURN CODE FROM SEND TEXT'                    07330000
073400                               TO  DP013-MESSAGE-TEXT (1)         07340000
073500         PERFORM DP014-0000-PROCESS-ABEND                         07350000
073600     END-IF.                                                      07360000
073700****************************************************************  07370000
073800**  GET THE CURRENT FORMATTED DATE AND TIME                   **  07380000
073900****************************************************************  07390000
074000 4000-GET-CURR-DATE-TIME.                                         07400000
074100     EXEC CICS                                                    07410000
074200         ASKTIME                                                  07420000
074300             ABSTIME (DT-ABSTIME)                                 07430000
074400     END-EXEC.                                                    07440000
074500                                                                  07450000
074600     EXEC CICS                                                    07460000
074700         FORMATTIME                                               07470000
074800             ABSTIME (DT-ABSTIME)                                 07480000
074900             MMDDYY  (DT-FORMATTED-MMDDYY)                        07490000
075000             DATESEP                                              07500000
075100             TIME    (DT-FORMATTED-TIME)                          07510000
075200             TIMESEP                                              07520000
075300     END-EXEC.                                                    07530000
075400*                                                                 07540000
075500     EXEC CICS                                                    07550000
075600         FORMATTIME                                               07560000
075700             ABSTIME (DT-ABSTIME)                                 07570000
075800             YEAR    (DT-YEAR-BIN)                                07580000
075900     END-EXEC.                                                    07590000
076000     MOVE DT-YEAR-BIN   TO DT-FORMATTED-YYYY.                     07600000
076100                                                                  07610000
076200******************************************************************07620000
076300*    ABEND PROCESSOR MODULE - FOR NON-ARCHITECTURE PROGRAMS      *07630000
076400******************************************************************07640000
076500     COPY DPPD014.                                                07650000
