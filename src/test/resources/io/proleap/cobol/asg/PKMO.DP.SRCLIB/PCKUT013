000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    PCKUT013.                                         00040001
000500 AUTHOR.        DENISE HAHN.                                      00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   OCTOBER 2000.                                     00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS BATCH DB2 PROGRAM READS THE FILE CREATED BY PCKUT012    * 00100001
001100*  CONTAINING CARTON UCC128 CARTON INFORMATION BY PO/PACKSLIP   * 00110001
001200*  SEQUENCE.  INSERTS ROWS INTO THE CARTON COMBINATION TABLE    * 00120001
001300*  TSHPSUM                                                      * 00130001
001400***************************************************************** 00140012
      * DAVE WELLER 10/7/2014 PO-NBR EXPANSION                          00140112
      *                                                                 00140212
001400***************************************************************** 00141012
001500 ENVIRONMENT DIVISION.                                            00150001
001600 INPUT-OUTPUT SECTION.                                            00160001
001700                                                                  00170001
001800 FILE-CONTROL.                                                    00180001
001900                                                                  00190001
002000     SELECT INPUT-FILE     ASSIGN TO UT-S-INP01.                  00200001
002100                                                                  00210001
002200***************************************************************** 00220001
002300 DATA DIVISION.                                                   00230001
002400***************************************************************** 00240001
002500 FILE SECTION.                                                    00250001
002600                                                                  00260001
002700 FD  INPUT-FILE                                                   00270001
002710     RECORDING MODE IS F                                          00271007
002730     BLOCK CONTAINS 0 RECORDS                                     00273007
002740     LABEL RECORDS ARE STANDARD.                                  00274007
002750                                                                  00275007
003300 01  INPUT-RECORD.                                                00330001
003400     05  INPUT-PO-NBR             PIC 9(09).                      00340013
003500     05  INPUT-SEQ-NBR            PIC 9(04).                      00350001
003600     05  FILLER                   PIC X(317).                     00360013
003700                                                                  00370001
003800                                                                  00380001
003900***************************************************************** 00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004100                                                                  00410001
004200 01  PS-PROGRAM-SWITCHES.                                         00420001
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00430001
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00440001
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00450001
004600                                                                  00460001
004700 01  PC-PROGRAM-CONSTANTS.                                        00470001
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PCKUT013'.00480001
004900     05  PC-ZERO                      PIC S9(04) VALUE ZERO COMP. 00490001
005000                                                                  00500001
005100 01  PV-PROGRAM-VARIABLES.                                        00510001
005200     05  PV-PREV-RECORD               PIC X(330).                 00520001
005300     05  PV-PREV-RECORD-R REDEFINES PV-PREV-RECORD.               00530001
005400         10  PV-PREV-PO-NBR           PIC 9(09).                  00540013
005500         10  PV-PREV-SEQ-NBR          PIC 9(04).                  00550001
005600         10  FILLER                   PIC X(317).                 00560013
005700     05  PV-COMBINATION               PIC S9(04).                 00570001
005800     05  PV-CARTONS-WITH-COMBO        PIC  9(04).                 00580001
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00590002
006000     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00600002
006100     05  PV-DISP-PO                   PIC 9(09).                  00610001
006200     05  PV-DISP-SEQ                  PIC 9(04).                  00620001
006300     05  PV-DISP-COMBO                PIC 9(04).                  00630001
006400     05  PV-DISP-LINE                 PIC 9(04).                  00640001
006500     05  PV-DISP-CRTN-CNT             PIC 9(04).                  00650001
006600     05  PV-DISP-OTPK                 PIC 9(04).                  00660001
006700     05  PV-SQLCODE                   PIC S9(9)  VALUE +0.        00670001
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00680001
006900                                                                  00690001
007000                                                                  00700001
007100 01  PV-ABEND-FIELDS.                                             00710001
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00720001
007300                                                 COMP SYNC.       00730001
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUT013'.00740001
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00750001
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00760001
007700     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    00770001
007800     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    00780001
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790001
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800001
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810001
008200                                                                  00820001
008300                                                                  00830001
008400***********************************************************       00840001
008500*  COPYBOOK USED FOR THE INPUT FILE.                      *       00850001
008600***********************************************************       00860001
008700     COPY PCRD007.                                                00870001
008800                                                                  00880001
008900***********************************************************       00890001
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00900001
009100***********************************************************       00910001
009200     COPY DPWS004.                                                00920001
009300                                                                  00930001
009400***********************************************************       00940001
009500*  DB2 SQL COMMUNICATION AREA                             *       00950001
009600***********************************************************       00960001
009700     EXEC SQL                                                     00970001
009800          INCLUDE SQLCA                                           00980001
009900     END-EXEC.                                                    00990001
010000                                                                  01000001
010100***********************************************************       01010001
010200*  SU-SHIPMENT CARTON SUMMARY                             *       01020001
010300***********************************************************       01030001
010400     EXEC SQL                                                     01040001
010500          INCLUDE TSHPSUM                                         01050001
010600     END-EXEC.                                                    01060001
010700                                                                  01070001
010800***************************************************************** 01080001
010900 PROCEDURE DIVISION.                                              01090001
011000***************************************************************** 01100001
011100     DISPLAY '**** BEGINNING PCKUT013 ****'.                      01110001
011200     DISPLAY ' '.                                                 01120001
011300                                                                  01130001
011400     OPEN INPUT  INPUT-FILE.                                      01140001
011500                                                                  01150001
011600     PERFORM 1000-READ-INPUT-FILE.                                01160001
011700                                                                  01170001
011800     MOVE  INPUT-RECORD  TO  PV-PREV-RECORD.                      01180001
011900     MOVE  1             TO  PV-COMBINATION.                      01190001
012000                                                                  01200001
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01210001
012200       UNTIL PS-EOF-INPUT-YES.                                    01220001
012300                                                                  01230001
012400     CLOSE INPUT-FILE.                                            01240001
012500                                                                  01250001
012600     DISPLAY '  INPUT RECORDS READ     = ' PV-RECORDS-READ.       01260001
012700     DISPLAY '  TSHPSUM ROWS INSERTED  = ' PV-RECORDS-INSERTED.   01270001
012800     DISPLAY ' '.                                                 01280001
012900     DISPLAY '****  END OF  PCKUT013  ****'.                      01290001
013000                                                                  01300001
013100     GOBACK.                                                      01310001
013200                                                                  01320001
013300                                                                  01330001
013400***************************************************************** 01340001
013500*                                                               * 01350001
013600***************************************************************** 01360001
013700 1000-READ-INPUT-FILE.                                            01370001
013800                                                                  01380001
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01390001
014000                                                                  01400001
014100     READ INPUT-FILE                                              01410001
014300            AT END                                                01430001
014400               SET PS-EOF-INPUT-YES TO TRUE                       01440001
014500                                                                  01450001
014600            NOT AT END                                            01460001
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01470001
014800               ADD +1 TO PV-RECORDS-READ                          01480001
014900     END-READ.                                                    01490001
015000                                                                  01500001
015100                                                                  01510001
015200***************************************************************** 01520001
015300*                                                               * 01530001
015400***************************************************************** 01540001
015500 2000-PROCESS-INPUT-FILE.                                         01550001
015600                                                                  01560001
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01570001
015800                                                                  01580001
015900     IF  INPUT-RECORD   =  PV-PREV-RECORD                         01590001
016000         ADD  1  TO  PV-CARTONS-WITH-COMBO                        01600001
016100     ELSE                                                         01610001
016200     IF  INPUT-PO-NBR   =  PV-PREV-PO-NBR  AND                    01620001
016300         INPUT-SEQ-NBR  =  PV-PREV-SEQ-NBR                        01630001
016400             PERFORM 2010-PROCESS-TSHPSUM                         01640001
016500             PERFORM 2100-TABLE-COMMIT                            01650001
016600             MOVE  1  TO  PV-CARTONS-WITH-COMBO                   01660001
016700             ADD   1  TO  PV-COMBINATION                          01670001
016800             MOVE  INPUT-RECORD  TO  PV-PREV-RECORD               01680001
016900     ELSE                                                         01690001
017000         PERFORM 2010-PROCESS-TSHPSUM                             01700001
017100         PERFORM 2100-TABLE-COMMIT                                01710001
017200         MOVE  1  TO  PV-CARTONS-WITH-COMBO                       01720001
017300         MOVE  1  TO  PV-COMBINATION                              01730001
017400         MOVE  INPUT-RECORD  TO  PV-PREV-RECORD                   01740001
017500     END-IF                                                       01750001
017600     END-IF.                                                      01760001
017700                                                                  01770001
017800     PERFORM 1000-READ-INPUT-FILE.                                01780001
017900                                                                  01790001
018000     IF  PS-EOF-INPUT-YES  AND                                    01800001
018100         PV-CARTONS-WITH-COMBO  >  0                              01810001
018200         PERFORM 2010-PROCESS-TSHPSUM                             01820001
018300         PERFORM 2100-TABLE-COMMIT                                01830001
018400     END-IF.                                                      01840001
018500                                                                  01850001
018600                                                                  01860001
018700***************************************************************** 01870001
018800*                                                               * 01880001
018900***************************************************************** 01890001
019000 2010-PROCESS-TSHPSUM.                                            01900001
019100                                                                  01910001
019200     MOVE PV-PREV-RECORD  TO  PC007-CRTN-SUM-RECORD.              01920001
019300                                                                  01930001
019400     PERFORM VARYING CRTN-IDX                                     01940001
019500                FROM 1 BY 1                                       01950001
019600               UNTIL CRTN-IDX  > PC007-TABLE-ENTRIES              01960001
019700                  OR CRTN-IDX  > PC007-MAX-ENTRIES                01970001
019800                                                                  01980001
019900                     INITIALIZE DCLTSHPSUM                        01990001
020000                     MOVE PC007-PO-NBR                            02000001
020100                       TO SHPSUM-PO-NBR                           02010001
020200                     MOVE PC007-SEQ-NBR                           02020001
020300                       TO SHPSUM-PKSL-SEQ-NBR                     02030001
020400                     MOVE PV-COMBINATION                          02040001
020500                       TO SHPSUM-CART-COMB-NBR                    02050001
020600                     MOVE PC007-TBL-LNE-NBR (CRTN-IDX)            02060001
020700                       TO SHPSUM-PO-LNE-NBR                       02070001
020800                     MOVE PV-CARTONS-WITH-COMBO                   02080001
020900                       TO SHPSUM-TOT-CART-CNT                     02090001
021000                     MOVE PC007-TBL-QTY (CRTN-IDX)                02100001
021100                       TO SHPSUM-OTPK-UNT-QTY                     02110001
021200                     PERFORM 2020-INSERT-TSHPSUM                  02120001
021300     END-PERFORM.                                                 02130001
021400                                                                  02140001
021500                                                                  02150001
021600***************************************************************** 02160001
021700*                                                               * 02170001
021800***************************************************************** 02180001
021900 2020-INSERT-TSHPSUM.                                             02190001
022000                                                                  02200001
022100     EXEC SQL                                                     02210001
022200          INSERT                                                  02220001
022300          INTO  TSHPSUM                                           02230001
022400              ( PO_NBR                                            02240001
022500               ,PKSL_SEQ_NBR                                      02250001
022600               ,CART_COMB_NBR                                     02260001
022700               ,PO_LNE_NBR                                        02270001
022800               ,TOT_CART_CNT                                      02280001
022900               ,OTPK_UNT_QTY                                      02290001
023000               ,CRE_TMST)                                         02300001
023100                                                                  02310001
023200          VALUES                                                  02320001
023300              ( :SHPSUM-PO-NBR                                    02330001
023400               ,:SHPSUM-PKSL-SEQ-NBR                              02340001
023500               ,:SHPSUM-CART-COMB-NBR                             02350001
023600               ,:SHPSUM-PO-LNE-NBR                                02360001
023700               ,:SHPSUM-TOT-CART-CNT                              02370001
023800               ,:SHPSUM-OTPK-UNT-QTY                              02380001
023900               , CURRENT TIMESTAMP)                               02390001
024000     END-EXEC.                                                    02400001
024100                                                                  02410001
024200     EVALUATE TRUE                                                02420001
024300         WHEN SQLCODE = ZERO                                      02430001
024400              ADD +1            TO PV-RECORDS-INSERTED            02440001
024500         WHEN SQLCODE NOT = +0                                    02450001
024600              MOVE '2020-INSERT-TSHPSUM'                          02460001
024700                           TO PV-ABEND-PARAGRAPH                  02470001
024800              MOVE ' INSERT TSHPSUM '   TO PV-ABEND-OPERATION     02480001
024900              MOVE SHPSUM-PO-NBR        TO PV-DISP-PO             02490001
025000              MOVE SHPSUM-PKSL-SEQ-NBR  TO PV-DISP-SEQ            02500001
025100              MOVE SHPSUM-CART-COMB-NBR TO PV-DISP-COMBO          02510001
025200              MOVE SHPSUM-PO-LNE-NBR    TO PV-DISP-LINE           02520001
025300              MOVE SHPSUM-TOT-CART-CNT  TO PV-DISP-CRTN-CNT       02530001
025400              MOVE SHPSUM-OTPK-UNT-QTY  TO PV-DISP-OTPK           02540001
025500              STRING ' PO-'                 DELIMITED BY SIZE     02550001
025600                     PV-DISP-PO             DELIMITED BY SIZE     02560001
025700                     '  PKSLIP SEQ-'        DELIMITED BY SIZE     02570001
025800                     PV-DISP-SEQ            DELIMITED BY SIZE     02580001
025900                     '  COMB-'              DELIMITED BY SIZE     02590001
026000                     PV-DISP-COMBO          DELIMITED BY SIZE     02600001
026100                     '  LINE-'              DELIMITED BY SIZE     02610001
026200                     PV-DISP-LINE           DELIMITED BY SIZE     02620001
026300                     '  CRTN CNT-'          DELIMITED BY SIZE     02630001
026400                     PV-DISP-CRTN-CNT       DELIMITED BY SIZE     02640001
026500                     '  OTPK-'              DELIMITED BY SIZE     02650001
026600                     PV-DISP-OTPK           DELIMITED BY SIZE     02660001
026700                                  INTO PV-DB2-OPERATION-MESSAGE-1 02670001
026800                                                                  02680001
026900              MOVE 'TSHPSUM'   TO PV-ABEND-STRUCTURE-1            02690001
027000              PERFORM Z999-SQL-ABEND                              02700001
027100     END-EVALUATE.                                                02710001
027200                                                                  02720001
027300                                                                  02730001
027400***************************************************************** 02740001
027500*                                                               * 02750001
027600***************************************************************** 02760001
027700 2100-TABLE-COMMIT.                                               02770001
027800                                                                  02780001
027900     EXEC SQL                                                     02790001
028000          COMMIT                                                  02800001
028100     END-EXEC.                                                    02810001
028200                                                                  02820001
028300                                                                  02830001
028400***************************************************************** 02840001
028500*                                                               * 02850001
028600***************************************************************** 02860001
028700 Z999-SQL-ABEND.                                                  02870001
028800                                                                  02880001
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02890001
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02900001
029100     DISPLAY '*** DB2 ERROR '.                                    02910001
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02920001
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02930001
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02940001
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02950001
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02960001
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02970001
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02980001
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             02990001
030000                                                                  03000001
030100     COPY DPPD004.                                                03010001
030200                                                                  03020001
030300     MOVE +4013         TO PV-ABEND-CODE.                         03030001
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03040001
