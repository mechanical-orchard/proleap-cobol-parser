000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     APKUT220.                                        00020099
000300 AUTHOR.         MIKE BESKE.                                      00030099
000400 DATE-WRITTEN.   AUGUST 2001.                                     00040099
000500******************************************************************00050099
000600*    COBOL 2 WITH DB2 SQL.                                        00060099
000700*                                                                 00070099
000800*    EDIT EDI IMPORT LANDED COST INVOICES.                        00080099
000900*                                                                 00090099
001000* THIS PROGRAM EDITS THE FILE OF INVOICES COMING FROM THE EDI     00100099
001100* TRANSLATOR TO DETERMINE IF THEY MEET ALL OF THE REQUIREMENTS    00110099
001200* FOR BEING LOADED INTO THE INVOICE DATABASE.  MOST EDITS ARE AT A00120099
001300* FIELD VERIFICATION LEVEL.  SOME VERIFICATION IS TO ENSURE       00130099
001400* CERTAIN DATA IS PRESENT FOR INVOICES COMING FROM SPECIFIC VENDOR00140099
001500* TYPES.  ALL INVOICES THAT PASS THE EDITS WILL BE WRITTEN TO AN  00150099
001600* AUDIT FILE & ALL INVOICES THAT FAIL THE EDITS WILL BE WRITTEN TO00160099
001700* A REJECTION FILE WHICH WILL BE USED TO GENERATE A REPORT OF ALL 00170099
001800* REJECTIONS.  THERE WILL BE SPECIAL HANDLING OF DECONSOLIDATION  00180099
001900* INVOICES, WHERE THE PROGRAM WILL DETERMINE IF THERE ARE MULTIPLE00190099
002000* INVOICES FOR THE SAME SHIPMENT THAT NEED TO BE GROUPED TOGETHER.00200099
002100* THESE WILL BE SAVED AFTER BEING EDITED, SO THAT THE CHARGES ON  00210099
002200* EACH CAN BE TOTALED AND EACH INDIVIDUAL INVOICE CAN BE WRITTEN  00220099
002300* WITH BOTH ITS OWN CHARGES PLUS THE TOTAL OF THE CHARGES OF THE  00230099
002400* RELATED INVOICES.  THESE TOTALS WILL FACILITATE THE AUDIT THAT  00240099
002500* WILL BE PERFORMED IN A LATER STEP.                              00250099
002600*                                                                 00260099
002700******************************************************************00270099
002800* INPUT:                                                          00280099
002900* 1. EDI IMPORT EXPENSE INVOICE RECORD    (APRD015)               00290099
003000*                                                                 00300099
003100* OUTPUT:                                                         00310099
003200* 1. IMPORT EXPENSE INVOICES TO AUDIT     (APRD019)               00320099
003300* 2. REJECTED EDI INVOICES TO REPORT      (APRD018)               00330099
003400*                                                                 00340099
003500* DB2 TABLES:                                                     00350099
003600* 1. TEXTENT - EXTERNAL ENTERPRISE VENDOR TABLE                   00360099
003700* 2. TENTNME - VENDOR NAME TABLE                                  00370099
003800* 3. TPURCHS - PURCHASE ORDER TABLE                               00380099
003900* 4. TIMCNPO - PO TRACKING CONTAINER PO TABLE                     00390099
004000* 5. TIMCSPO - IMPORT CUSTOMS PO TABLE                            00400099
004100* 6. TIMCSCN - IMPORT CUSTOMS CONTAINER TABLE                     00410099
004200* 7. TIMCSBL - IMPORT CUSTOMS BILL OF LADING TABLE                00420099
004300* 8. TIMCSEN - IMPORT CUSTOMS ENTRY TABLE                         00430099
004400* 9. SYSDUMMY - DUMMY TABLE USED FOR EXISTENCE CHECKING           00440099
004500*                                                                 00450099
004600***************************************************************** 00460099
004700*                                                                 00470099
004800* CHANGE LOG:                                                     00480099
004900*                                                                 00490099
005000* 06/06/02  ADDED LOGIC IN F400-VALIDATE-REC-TYPE-04 TO CHECK IF  00500099
005100*           THE VENDOR IS A CUSTOMS BROKER WHEN A DRAYAGE ENTRY IS00510099
005200*           FOUND IN THE CHARGE TABLE.  IF SO, THE CHARGE CODE OF 00520099
005300*           690 WILL BE SUBSTITUTED.                              00530099
005400*           BY: NANCY EILBES               WR/IR#: 471774         00540099
005500*                                                                 00550099
005600* 07/10/02  ADDED LOGIC IN H100-INITIALIZE TO INITIALIZE THE AP01900560099
005700*           RECORD.  WHEN AN INVOICE WAS REJECTED, ITS DATA WAS   00570099
005800*           BEING LEFT IN THIS LAYOUT AND THE CHARGES WERE GETTING00580099
005900*           ATTACHED TO THE NEXT GOOD INVOICE.                    00590099
006000*           BY: NANCY EILBES               WR/IR#: 22902          00600099
006100*                                                                 00610099
006200* 07/30/02  ADDED LOGIC IN E300-EDIT-OVERALL-INVOICE TO ALLOW     00620099
006300*           ANY RECORDS WITH A PROD COUNTY CODE OF 'MU' AND       00630099
006400*           NO DUTY CHARGES TO BE WRITTEN TO THE AUDIT EDI FILE.  00640099
006500*           BY: BRIAN HASSLINGER           WR/IR#: WR23958        00650099
006600*                                                                 00660099
006700* 10/30/02  ADDED LOGIC IN E300-EDIT-OVERALL-INVOICE CHECKING     00670099
006800*           PO-SKU-QUANTITY < 999. IF THE QUANTITY IS MORE        00680099
006900*           WRITE RECORD TO ERROR FILE.                           00690099
007000*           BY: L SCHALLHORN               WR/IR#: PM00503558     00700099
007100*                                                                 00710099
007200* DATE  05/22/2003                                                00720099
007300*     CHANGE MADE:  EDI 210 HANDLING OF MIAMI DECONSOLIDATOR      00730099
007400*     AND OVERSEAS CONSOLIDATOR.  ADD DUN NBRS INTO WORKING       00740099
007500*     STORAGE.  ADD ADDITIONAL EDITS IN PARAGRAPHS E300, F200,    00750099
007600*     F400, AND M500 FOR PO QTY AND PO UOM CODES.  CHANGED ALL    00760099
007700*     REFERENCES FROM PO-SKU-QTY TO PO-QTY.                       00770099
007800*     MADE BY: KEVIN CATLIN            WR/IR #: WR24632           00780099
007900*                                                                 00790099
008000* DATE  07/31/2003                                                00800099
008100*     CHANGE MADE:  EDI 210 HANDLING OF WEST COAST DECON-         00810099
008200*     SOLIDATORS.  ADDED VALIDATION IN E300- TO VERIFY DRAYAGE    00820099
008300*     PROVIDERS HAVE DRAYAGE CHARGES ON INVOICE. ADDED            00830099
008400*     PO/CONTAINER ID, PO/MASTER BILL OF LADING #, AND PO/BROKER  00840099
008500*     REFERENCE # COMBINATION CHECKS ON TABLES TIMCSPO, TIMCSCN,  00850099
008600*     TIMCSBL, AND TIMCSEN FOR ALL DECONSOLIDATORS IN F300,       00860099
008700*     S300, S400, S500, AND S600.                                 00870099
008800*     MADE BY: KEVIN CATLIN          WR/IR #: WR24931/WR24933     00880099
008900*                                                                 00890099
009000* DATE  08/21/2003                                                00900099
009100*     CHANGE MADE:  FOR NYK LOGISTICS DOMESTIC, WHICH HAVE ONLY   00910099
009200*     DECONSOLIDATION CHARGES, THE WS-ACCUM-DECONSOLID-AMT        00920099
009300*     FIELD WILL BE INITIALIZED.  MODIFIED PARAGRAPH B200.        00930099
009400*     MADE BY: KEVIN CATLIN          WR/IR #: P000578278          00940099
009500*                                                                 00950099
009600* DATE  01/19/2004                                                00960099
009700*     CHANGE MADE:  CHANGED TRIANGLE VENDORS TO BE CARTON         00970099
009800*     DECONSOLIDATORS INSTEAD OF SKU DECONSOLIDATORS.  LEFT THE   00980099
009900*     SKU LOGIC IN PLACE, EVEN THOUGH IT IS NO LONGER USED.       00990099
010000*     REMOVED 2 TRIANGLE VENDOR NUMBERS, 000595330 AND 009207796, 01000099
010100*     FROM THE LIST OF VALID DECONSOLIDATORS BECAUSE WE ARE NO    01010099
010200*     LONGER DOING BUSINESS WITH THESE OFFICES.                   01020099
010300*     MADE BY: NANCY EILBES          WR/IR #: WR26156             01030099
010400*                                                                 01040099
010500* DATE  05/23/2005                                                01050099
010600*     CHANGE MADE: ADDED THE VENDOR NUMBERS '000595330' (IDS),    01060099
010700*     '001019611' (AMERICAN PORT SERVICE), AND '001025197'        01070099
010800*     (GALE TRIANGLE DALLAS) AS 88 LEVELS TO                      01080099
010900*     WS-DECONSOLIDATOR AND WS-CARTON-DECONSOL.  ALSO REMOVED ALL 01090099
011000*     LOGIC IN PARAGRAPHS E300- AND F200- REFERRING TO            01100099
011100*     WS-SKU-DECONSOL.                                            01110099
011200*     MADE BY: KRYSTEN LEARY         WR/IR #: WR28623             01120099
011300*                                                                 01130099
011400* DATE  06/07/2005                                                01140099
011500*     CHANGE MADE: CORRECTED LOGIC IN F400 THAT WAS ADDING THE    01150099
011600*     DRAYAGE AMOUNT INTO THE WS-ACCUM-DRAYAGE-AMT TWICE.  THIS   01160099
011700*     CAUSED ALL INVOICES WITH DRAYGE TO GO INTO PENDING REVIEW   01170099
011800*     STATUS IN THE NEXT PROGRAM.                                 01180099
011900*     MADE BY: NANCY EILBES          WR/IR #: P000769187          01190099
012000*                                                                 01200099
012100* DATE  09/29/2005                                                01210099
012200*     CHANGE MADE: ADDED THE VENDOR NUMBER '001027924' (HUDD WEST 01220099
012300*     COAST) AS AN 88 LEVEL TO WS-DECONSOLIDATOR AND              01230099
012400*     WS-CARTON-DECONSOL.                                         01240099
012500*     MADE BY: KRYSTEN LEARY         WR/IR #: WR29394             01250099
012600*                                                                 01260099
012700* DATE  08/28/2006                                                01270099
012800*     CHANGE MADE: ADDED THE VENDOR NUMBER '001035244' (GILBERT   01280099
012900*     COMPANY) AS AN 88 LEVEL TO WS-DECONSOLIDATOR AND            01290099
013000*     AND WS-CARTON-DECONSOL.                                     01300099
013100*     MADE BY: KRYSTEN LEARY         WR/IR #: WR31042             01310099
013200*                                                                 01320099
013300* DATE  08/28/2006                                                01330099
013400*     CHANGE MADE: ADDED THE VENDOR NUMBER '001035274' (GALE      01340099
013500*     TRIANGLE - MIAMI) AS AN 88 LEVEL TO WS-DECONSOLIDATOR       01350099
013600*     AND WS-CARTON-DECONSOL.                                     01360099
013700*     MADE BY: KRYSTEN LEARY         WR/IR #: WR30888             01370099
013800*                                                                 01380099
013900* DATE  01/12/2007                                                01390099
014000*     CHANGE MADE: ADDED THE VENDOR NUMBER '001037111' (UPS SUPPLY01400099
014100*     CHAIN SOLUTIONS) AS AN 88 LEVEL TO WS-DRAYAGE-PROVIDER TO   01410099
014200*     REPLACE PACER GLOBAL LOGISTICS ('000750349').               01420099
014300*     MADE BY: KRYSTEN LEARY         WR/IR #: WR31470             01430099
014400*                                                                 01440099
014500* DATE  01/12/2007                                                01450099
014600*     CHANGE MADE: ADDED THE VENDOR NUMBER '001037782' (CALIFORNIA01460099
014700*     INTERMODAL ASSOCIATES) AS AN 88 LEVEL TO                    01470099
014800*     WS-DRAYAGE-PROVIDER.                                        01480099
014900*     MADE BY: KRYSTEN LEARY         WR/IR #: WR31469             01490099
015000*                                                                 01500099
015100* DATE  01/22/2007                                                01510099
015200*     CHANGE MADE: ADDED THE VENDOR NUMBER '001038202' (GALE      01520099
015300*     TRIANGLE - SOUTH EAST) AS AN 88 LEVEL TO WS-DECONSOLIDATOR  01530099
015400*     AND WS-CARTON-DECONSOL.                                     01540099
015500*     MADE BY: KRYSTEN LEARY         WR/IR #: WR31493             01550099
015600*                                                                 01560099
015700* DATE  06/08/2007                                                01570099
015800*     CHANGE MADE:    CHANGED VENDOR 001037111 TO 001029555     * 01580099
015900*     MADE BY: GREG WISIALOWSKI      WR/IR #: WR32840             01590099
016000*                                                                 01600099
016100* DATE  01/31/2008                                                01610099
016200*     CHANGE MADE: ADDED THE VENDOR NUMBER '001051034' (TOTAL     01620099
016300*     TRANSPORTATION SERVICE) AS AN 88 LEVEL TO                   01630099
016400*     WS-DRAYAGE-PROVIDER.                                        01640099
016500*     MADE BY: MICHELE RINDFLEISCH   WR/IR #: WR33727             01650099
016600*                                                                 01660099
016700* DATE  10/21/2008                                                01670099
016800*     CHANGE MADE: ADDED THE VENDOR NUMBER '001053905' (SOUTHERN  01680099
016900*     COUNTIES EXPRESS) AS AN 88 LEVEL TO                         01690099
017000*     WS-DRAYAGE-PROVIDER.                                        01700099
017100*     MADE BY: GREG WISIALOWSKI      WR/IR #: WR34923             01710099
017200*                                                                 01720099
017300* DATE  03/16/2009                                                01730099
017400*     CHANGE MADE:  RECOMPILE FROM PRODUCTION TO INCORPORATE      01740099
017500*     COPYBOOK APWS010 CHANGES.                                   01750099
017600*     MADE BY: KEVIN CATLIN            WR/IR #: WR33680           01760099
017700*                                                                 01770099
017800* DATE  10/20/2009                                                01780099
017900*     CHANGE MADE:  RECOMPILE FOR 310 EDI PROJECT.                01790099
018000*     COPYBOOK APRD018 WENT FROM 475 TO 750 BYTES.                01800099
018100*     MADE BY: PAUL STROEDE            WR/IR #: WR23145           01810099
018200*                                                                 01820099
018300* DATE  05/25/2010                                                01830099
018400*     CHANGE MADE:  RECOMPILE FOR CHANGES TO APWS010 COPYBOOK     01840099
018500*     MADE BY: PAUL STROEDE            WR/IR #: PKE000000003991   01850099
018600*                                                                 01860099
018700* DATE  03/17/2014                                                01870099
018800*     CHANGE MADE:  ADDED NEW DUTY FREE COUNTRIES TO THE LIST ON  01880099
018900*     THE 88LEVEL N WORKING STORAGE.                              01890099
019000*     MADE BY: NANCY EILBES            WR/IR #: CHG0076793        01900099
019100*                                                                 01910099
019200* DATE  06/08/2015                                                01920099
019300*     CHANGE MADE: TO HANDLE THE 210 WITHOUT DUTY FEE AND TO      01930099
019400*     ADD A NEW FEE - MPF MGMT FEE 'BSS'                          01940099
019500*     MADE BY: MEENAKSHI MITTAL        WR/IR #: CHG0112172        01950099
019600*                                                                 01960099
019700* DATE  09/25/2015                                                01970099
019800*     CHANGE MADE: ADDED BROKER REFERENCE NUMBER AND ENTRY NUMBER 01980099
019900*     TO THE ERROR FILE.                                          01990099
020000*     MADE BY: BARB SCHULTZ            WR/IR #: CHG0126130        02000099
020100*                                                                 02010099
020200* DATE  01/07/2016                                                02020099
020300*     CHANGE MADE: MODIFIED SQL IN S500-CHECK-PO-BOL TO USE THE   02030099
020400*     TIMCNPO TABLE TO VALIDATE THE PO/BOL INSTEAD OF USING THE   02040099
020500*     IMPORT CUSTOMS TABLES. THE TIMCNPO TABLE IS POPULATED       02050099
020600*     EARLIER IN THE SUPPLY CHAIN LIFE CYCLE, SO THIS SHOULD      02060099
020700*     REDUCE THE REJECTION OF OCS (YUSEN) INVOICES.               02070099
020800*     MADE BY: NANCY EILBES            WR/IR #: CHG0131409        02080099
020900*                                                                 02090099
021000* DATE  06/07/2016                                                02100099
021100* CHANGE MADE: ADDED OUTPUT RECYCLE FILE AND INPUT CONTROL CARD   02110099
021200* CONTAINING MAX NUMBER OF RECYCLE DAYS.  ADDED LOGIC IN B100 TO  02120099
021300* VALIDATE THE CONTROL CARD.  ADDED LOGIC IN B200 TO DETERMINE    02130099
021400* IF AN INVOICE SHOULD CONTINUE TO RECYCLE OR REJECT IF IT HAS    02140099
021500* PASSED THE MAX NUMBER OF RECYCLE DAYS.                          02150099
021600* MADE BY: NANCY EILBES            WR/IR #: CHG0143455            02160099
021700*                                                                 02170099
021800* CHANGE MADE: ADDED NEW PARAGRAPH S550-CHECK-PO-HOUSE-BOL TO     02180099
021900* BE PERFORMED WHEN A NOT FOUND CONDITION OCCURS WHEN LOOKING     02190099
022000* UP THE PO/MASTER BOL.  THIS CHANGE WILL ALLOW AN INVOICE TO     02200099
022100* PASS THE BOL EDIT WHEN THE HOUSE BOL IS PROVIDED RATHER THAN    02210099
022200* THE MASTER BOL.                                                 02220099
022300* MADE BY: NANCY EILBES            WR/IR #: CHG0148607            02230099
022400*                                                                 02240099
022500* DATE  11/02/2020                                                02250099
022600*    CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO COPYBOOK       02260099
022700*    APWS010.                                                     02270099
022800*    MADE BY: NANCY EILBES            WR/IR #: CHG0250510         02280099
022900*                                                                 02290099
023000* DATE  06/07/2022                                                02300099
023100*    CHANGE MADE: ADDED VENDORS 001178352 AND 001181236 AS 88     02310099
023200*    LEVEL VALUES FOR WS-DECONSOLIDATOR AND WS-CARTON-DECONSOL.   02320099
023300*    THIS WILL ALLOW THE DRAYAGE TOTAL TO BE PASSED ON THE        02330099
023400*    AUDIT FILE SO THE RATE CAN BE CHECKED IN PROGRAM APKUT224.   02340099
023500*    MADE BY: NANCY EILBES            WR/IR #: CHG0270833         02350099
023600*                                                                 02360099
023700* DATE  06/16/2022                                                02370099
023800*    CHANGE MADE: INITIALIZE REJECT RECORD STRUCTURE IN           02380099
023900*    PARAGRAPH C100                                               02390099
024000*    MADE BY: JEAN KURK               WR/IR #: CHG0271159         02400099
024100*                                                                 02410099
024200* DATE  06/28/2022                                                02420099
024300*    CHANGE MADE: INITIALIZE REJECT RECORD STRUCTURE IN           02430099
024400*    PARAGRAPH M600                                               02440099
024500*    MADE BY: JEAN KURK               WR/IR #: CHG0271522         02450099
024510*                                                                 02451099
024520* DATE  05/10/2023                                                02452099
024530*    CHANGE MADE: RECOMPILE FOR UPDATED COPYBOOK APWS010          02453099
024540*                 ADD LIVINGSTON DUN NBR AS CUSTOMS BROKER        02454099
024550*    MADE BY: JEAN KURK               WR/IR #: CHG0288104         02455099
024551*                                                                 02455199
024560* DATE  06/20/2023                                                02456099
024570*    CHANGE MADE: ADDED VENDORS 001182335 (EAST GROUP LOGISTICS)  02457099
024580*    LEVEL VALUES FOR WS-DECONSOLIDATOR AND WS-CARTON-DECONSOL.   02458099
024590*    THIS WILL ALLOW THE DRAYAGE TOTAL TO BE PASSED ON THE        02459099
024591*    AUDIT FILE SO THE RATE CAN BE CHECKED IN PROGRAM APKUT224.   02459199
024592*    MADE BY: NANCY EILBES            WR/IR #: CHG0289931         02459299
024593*                                                                 02459399
024594* DATE  06/20/2023                                                02459499
024595*    CHANGE MADE: ADDED VENDOR 001182163 (CARGOMATIC INC) TO 88   02459599
024596*    LEVEL VALUES FOR WS-DECONSOLIDATOR AND WS-CARTON-DECONSOL.   02459699
024599*    MADE BY: NANCY EILBES            WR/IR #: CHG0293922         02459999
024600*                                                                 02460099
024610***************************************************************** 02461099
024700                                                                  02470099
024800 ENVIRONMENT DIVISION.                                            02480099
024900                                                                  02490099
025000 INPUT-OUTPUT SECTION.                                            02500099
025100                                                                  02510099
025200 FILE-CONTROL.                                                    02520099
025300                                                                  02530099
025400     SELECT EDI-INPUT-FILE    ASSIGN TO INP01.                    02540099
025500     SELECT AUDIT-EDI-FILE    ASSIGN TO OUT01.                    02550099
025600     SELECT REJECT-EDI-FILE   ASSIGN TO OUT02.                    02560099
025700     SELECT RECYCLE-EDI-FILE  ASSIGN TO OUT03.                    02570099
025800                                                                  02580099
025900 DATA DIVISION.                                                   02590099
026000                                                                  02600099
026100 FILE SECTION.                                                    02610099
026200                                                                  02620099
026300 FD  EDI-INPUT-FILE                                               02630099
026400     RECORDING MODE IS  F                                         02640099
026500     LABEL RECORDS  ARE STANDARD                                  02650099
026600     DATA RECORD    IS  EDI-INPUT-RECORD.                         02660099
026700                                                                  02670099
026800 01  EDI-INPUT-RECORD              PIC X(200).                    02680099
026900                                                                  02690099
027000 FD  AUDIT-EDI-FILE                                               02700099
027100     RECORDING MODE IS  F                                         02710099
027200     LABEL RECORDS  ARE STANDARD                                  02720099
027300     DATA RECORD    IS  AUDIT-EDI-RECORD.                         02730099
027400                                                                  02740099
027500 01  AUDIT-EDI-RECORD              PIC X(360).                    02750099
027600                                                                  02760099
027700 FD  REJECT-EDI-FILE                                              02770099
027800     RECORDING MODE IS  F                                         02780099
027900     LABEL RECORDS  ARE STANDARD                                  02790099
028000     DATA RECORD    IS  REJECT-EDI-RECORD.                        02800099
028100                                                                  02810099
028200 01  REJECT-EDI-RECORD             PIC X(750).                    02820099
028300                                                                  02830099
028400 FD  RECYCLE-EDI-FILE                                             02840099
028500     RECORDING MODE IS  F                                         02850099
028600     LABEL RECORDS  ARE STANDARD                                  02860099
028700     DATA RECORD    IS  RECYCLE-EDI-RECORD.                       02870099
028800                                                                  02880099
028900 01  RECYCLE-EDI-RECORD            PIC X(200).                    02890099
029000                                                                  02900099
029100 EJECT                                                            02910099
029200 WORKING-STORAGE SECTION.                                         02920099
029300                                                                  02930099
029400 01  FILLER                          PIC X(25) VALUE              02940099
029500                             'WS FOR APKUT220 BEGINS==>'.         02950099
029600                                                                  02960099
029700 01  WS-DISPLAY-COUNTER              PIC 9(07) VALUE ZEROS.       02970099
029800 01  WS-COUNT                        PIC S9(4) COMP SYNC          02980099
029900                                               VALUE ZEROS.       02990099
030000                                                                  03000099
030100 01  ABEND-CODE                      PIC S9(4) COMP SYNC          03010099
030200                                               VALUE ZEROS.       03020099
030300     88 AP-INVALID-CONTROL-CARD      VALUE +4003.                 03030099
030400     88 AP-TABLE-FULL                VALUE +4004.                 03040099
030500     88 AP-EMPTY-FILE                VALUE +4005.                 03050099
030600     88 AP-DB2-ERROR                 VALUE +4013.                 03060099
030700                                                                  03070099
030800 01  WS-RETRY-COUNTER                PIC S9(4) COMP VALUE ZERO.   03080099
030900 01  WS-ABEND-FILEDS.                                             03090099
031000     05  WS-ABEND-PROGRAM            PIC X(8)  VALUE 'APKUT220'.  03100099
031100     05  WS-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      03110099
031200     05  WS-ABEND-OPERATION          PIC X(50) VALUE SPACES.      03120099
031300     05  WS-ABEND-STRUCTURE-1        PIC X(8)  VALUE SPACES.      03130099
031400     05  WS-ABEND-STRUCTURE-2        PIC X(8)  VALUE SPACES.      03140099
031500     05  WS-ABEND-STATUS             PIC XX    VALUE SPACES.      03150099
031600                                                                  03160099
031700 01  WS-WORK-AREA.                                                03170099
031800     05  WS-EXTENT-DUN-NBR           PIC X(09)  VALUE SPACES.     03180099
031900*  EXPEDITORS                                                     03190099
031901         88 WS-CUSTOMS-BROKER            VALUES '009207259'       03190199
031902*  LIVINGSTON                                                     03190299
031903                                              , '001182576'.      03190399
031910***      88 WS-CUSTOMS-BROKER            VALUE  '009207259'.      03191099
032000         88 WS-DECONSOLIDATOR            VALUES '009068065'       03200099
032100*****  REMOVED IDS (TRIANGLE'S MIAMI OFFICE)  , '000595330'       03210099
032200*****  REMOVED TRIANGLE NORTHWEST             , '009207796'       03220099
032300                                              , '009022104'       03230099
032400                                              , '000763425'       03240099
032500                                              , '000595330'       03250099
032600                                              , '001019611'       03260099
032700                                              , '001025197'       03270099
032800                                              , '001027924'       03280099
032900                                              , '001035244'       03290099
033000                                              , '001035274'       03300099
033100                                              , '001038202'       03310099
033200                                              , '001178352'       03320099
033300                                              , '001181236'       03330099
033310                                              , '001182335'       03331099
033320                                              , '001182163'.      03332099
033400         88 WS-CARRIER                   VALUE  '000000000'.      03340099
033500         88 WS-OVERSEAS-CONSOL           VALUE  '000532689'.      03350099
033600***** ALTHOUGH IDS AND TRIANGLE NORTHWEST WERE REMOVED AS VALID   03360099
033700***** DECONSOLIDATORS, LEFT THE VALUES HERE SO THAT ALL OF THE    03370099
033800***** LOGIC REFERRING TO WS-SKU-DECONSOL COULD BE LEFT IN PLACE.  03380099
033900         88 WS-SKU-DECONSOL              VALUES '000595330'       03390099
034000                                              , '009207796'.      03400099
034100         88 WS-CARTON-DECONSOL           VALUES '000763425'       03410099
034200                                              , '000786178'       03420099
034300                                              , '009068065'       03430099
034400                                              , '009022104'       03440099
034500                                              , '000595330'       03450099
034600                                              , '001019611'       03460099
034700                                              , '001025197'       03470099
034800                                              , '001027924'       03480099
034900                                              , '001035244'       03490099
035000                                              , '001035274'       03500099
035100                                              , '001038202'       03510099
035200                                              , '001178352'       03520099
035300                                              , '001181236'       03530099
035310                                              , '001182335'       03531099
035320                                              , '001182163'.      03532099
035400         88 WS-DRAYAGE-PROVIDER          VALUES '001029555'       03540099
035500                                              , '001037782'       03550099
035600                                              , '001051034'       03560099
035700                                              , '001053905'.      03570099
035800** PACER GLOBAL LOGISTICS                     , '000750349'.      03580099
035900         88 WS-DECON-ONLY-DECONS         VALUES '000786178'.      03590099
036000                                                                  03600099
036100     05  WS-DECON-INVC-ID            PIC X(22)     VALUE SPACES.  03610099
036200     05  WS-DECON-INVC-ID-BASE       PIC X(22)     VALUE SPACES.  03620099
036300     05  WS-SAVE-DECON-INVC-ID1      PIC X(22)     VALUE SPACES.  03630099
036400     05  WS-SAVE-DECON-INVC-ID2      PIC X(22)     VALUE SPACES.  03640099
036500     05  WS-COUNTRY-OF-PRODUCTION    PIC X(2).                    03650099
036600         88  WS-DUTY-FREE-COUNTRY                  VALUES         03660099
036700      'MP' , 'MU' , 'BH' , 'MX' , 'KE' , 'LS' , 'SZ' , 'IN' , 'ID'03670099
036800    , 'TH' , 'SV' , 'GT' , 'HN' , 'NI' , 'DO' , 'CR' , 'HT' , 'EG'03680099
036900    , 'JO' , 'PK'.                                                03690099
037000*      MP  =  NORTHERN MARIANA ISLANDS                            03700099
037100*      MU  =  MAURITIUS (AGOA) - PLU                              03710099
037200*      BH  =  BAHRAIN - BAH                                       03720099
037300*      MX  =  MEXICO (NAFTA) - CJS, LZC, PRO, MEX, MTY, NOG, PMS, 03730099
037400*      KE  =  KENYA (AGOA)  - MBA                                 03740099
037500*      LS   =  LESOTHO (AGOA)  - DUR, CPT                         03750099
037600*      SZ  =   SWAZILAND (AGOA) - DUR                             03760099
037700*      IN   =   INDIA (GSP) - BOM, COK, MAA, MUN, TUT, DEL, BLR, C03770099
037800*      ID   =   INDONESIA (GSP) -  SRG, JKT, SUB                  03780099
037900*      TH   =  THAILAND (GSP) - BKK                               03790099
038000*      SV   =  EL SALVADOR (DR-CAFTA) - SAL                       03800099
038100*      GT   =  GUATEMALA (DR-CAFTA) - GUA                         03810099
038200*      HN  =  HUNDORAS (DR-CAFTA) - SAP                           03820099
038300*      NI  =  NICARAGUA (DR-CAFTA) - MGA                          03830099
038400*      DO  =  DOMINICAN REPUBLIC (DR-CAFTA) - SDQ, POP, PAP       03840099
038500*      CR  =  COSTA RICA (DR-CAFTA)                               03850099
038600*      HT  =  HAITI (HOPE) SDQ, POP, PAP                          03860099
038700*      EG  =  EGYPT (QIZ TRADE PROGRAM)                           03870099
038800*      JO  =  JORDAN (JO/N TRADE PROGRAM)                         03880099
038900*      PK  =  PAKISTAN (GSP TRADE PROGRAM)                        03890099
039000     05  WS-SAVE-PO-NBR-COMP         PIC S9(09) COMP VALUE ZEROS. 03900099
039100     05  WS-SAVE-NET-COST            PIC S9(09)V99 VALUE ZEROS.   03910099
039200     05  WS-ACCUM-CHRG-AMT           PIC S9(09)V99 VALUE ZEROS.   03920099
039300     05  WS-ACCUM-DUT-CHRG-AMT       PIC S9(09)V99 VALUE ZEROS.   03930099
039400*    05  WS-ACCUM-BSS-CHRG-AMT       PIC S9(09)V99 VALUE ZEROS.   03940099
039500     05  WS-ACCUM-CHRG-CNT           PIC 99        VALUE ZEROS.   03950099
039600     05  WS-ACCUM-DRAYAGE-AMT        PIC S9(09)V99 VALUE ZEROS.   03960099
039700     05  WS-ACCUM-DECONSOLID-AMT     PIC S9(09)V99 VALUE ZEROS.   03970099
039800     05  PV-START                    PIC S9(04)    VALUE +0       03980099
039900                                                   COMP.          03990099
040000     05  PV-INVC-CUTOFF              PIC S9(04)    VALUE +0       04000099
040100                                                   COMP.          04010099
040200     05  PV-ONE                      PIC X(01)     VALUE SPACES.  04020099
040300     05  WS-VNDR-INVC-KEY.                                        04030099
040400         10  WS-VENDOR-NBR           PIC X(09)     VALUE SPACES.  04040099
040500         10  WS-INVOICE-NBR          PIC X(22)     VALUE SPACES.  04050099
040600     05  WS-CCYYMMDD.                                             04060099
040700         10  WS-CENTURY              PIC X(02)     VALUE '00'.    04070099
040800         10  WS-YYMMDD.                                           04080099
040900             15  WS-YY               PIC X(02)     VALUE '00'.    04090099
041000             15  WS-MM               PIC X(02)     VALUE '00'.    04100099
041100             15  WS-DD               PIC X(02)     VALUE '00'.    04110099
041200                                                                  04120099
041300*     EX. 231-9566039-8                                           04130099
041400     05  WS-CSTM-ENTR-ID             PIC X(16)     VALUE SPACES.  04140099
041500     05  WS-CSTM-ENTRY REDEFINES WS-CSTM-ENTR-ID.                 04150099
041600         10  WS-ENTRY-PREFIX         PIC X(03).                   04160099
041700         10  WS-ENTRY-DASH           PIC X(01).                   04170099
041800         10  WS-ENTRY-SUFFIX1        PIC X(07).                   04180099
041900         10  WS-ENTRY-DASH           PIC X(01).                   04190099
042000         10  WS-ENTRY-SUFFIX2        PIC X(04).                   04200099
042100     05  WS-ENTRY-ID.                                             04210099
042200         10  WS-ENTRY-ID-FIRST       PIC X(03).                   04220099
042300         10  WS-ENTRY-ID-LAST1       PIC X(07).                   04230099
042400         10  WS-ENTRY-ID-LAST2       PIC X(04).                   04240099
042500         10  WS-FILLER               PIC X(02).                   04250099
042600                                                                  04260099
042700     05  WS-ERROR-CODE-AREA.                                      04270099
042800         10  WS-ERR-TABLE        OCCURS 10 TIMES                  04280099
042900                                   INDEXED BY WS-ERR-IDX.         04290099
043000             15  WS-ERR-CDE          PIC 9(02).                   04300099
043100                                                                  04310099
043200     05  WS-DECONSOLIDATION-AREA.                                 04320099
043300         10  WS-DECON-TBL        OCCURS 50 TIMES                  04330099
043400                                   INDEXED BY DCN-IDX.            04340099
043500             15  WS-DECON-INVC-ERR   PIC X(1).                    04350099
043600             15  WS-DECON-INVC       PIC X(360).                  04360099
043700             15  WS-DECON-INVC-RED REDEFINES WS-DECON-INVC.       04370099
043800                 20  WS-DECON-KEY.                                04380099
043900                     25  WS-DECON-VENDOR-NBR  PIC X(09).          04390099
044000                     25  WS-DECON-INVOICE-NBR PIC X(22).          04400099
044100                 20  FILLER                   PIC X(114).         04410099
044200                 20  WS-DECON-DRAYAGE-AMT     PIC S9(9)V99 COMP-3.04420099
044300                 20  WS-DECON-DECONSOL-AMT    PIC S9(9)V99 COMP-3.04430099
044400                 20  FILLER                   PIC X(203).         04440099
044500                                                                  04450099
044600     COPY DPWS500.                                                04460099
044700                                                                  04470099
044800 01  WS-PROGRAM-COUNTERS.                                         04480099
044900     05  WS-EDIIN-REC-CNT            PIC 9(9)      VALUE ZEROS.   04490099
045000     05  WS-EDIOUT-REC-CNT           PIC 9(9)      VALUE ZEROS.   04500099
045100     05  WS-AUDIT-COUNT              PIC 9(9)      VALUE ZEROS.   04510099
045200     05  WS-REJECT-COUNT             PIC 9(9)      VALUE ZEROS.   04520099
045300     05  WS-RECYCLE-COUNT            PIC 9(9)      VALUE ZEROS.   04530099
045400     05  WS-MAX-RECYCLE-DAYS         PIC 99        VALUE ZEROS.   04540099
045500                                                                  04550099
045600 01  WS-INVOICE-COUNTERS.                                         04560099
045700     05  WS-TOT-REC-CNT              PIC 9(3)      VALUE ZEROS.   04570099
045800     05  WS-REC-01-CNT               PIC 9(3)      VALUE ZEROS.   04580099
045900     05  WS-REC-02-CNT               PIC 9(3)      VALUE ZEROS.   04590099
046000     05  WS-REC-03-CNT               PIC 9(3)      VALUE ZEROS.   04600099
046100     05  WS-REC-04-CNT               PIC 9(3)      VALUE ZEROS.   04610099
046200     05  WS-REC-OTHER-CNT            PIC 9(3)      VALUE ZEROS.   04620099
046300                                                                  04630099
046400 01  PS-SWITCHES-MISC.                                            04640099
046500     05  PS-WRITE-EDI-REC-SW         PIC X(01)     VALUE 'N'.     04650099
046600         88  WRITE-EDI-REC                         VALUE 'Y'.     04660099
046700         88  NO-WRITE-EDI-REC                      VALUE 'N'.     04670099
046800     05  PS-ERROR-SW                 PIC X(01)     VALUE 'N'.     04680099
046900         88  ERROR-EDI                             VALUE 'Y'.     04690099
047000         88  NO-EDI-ERROR                          VALUE 'N'.     04700099
047100     05  PS-1ST-ENTRY-NBR-SW         PIC X(01)     VALUE 'Y'.     04710099
047200         88  PS-1ST-ENTRY-NBR                      VALUE 'Y'.     04720099
047300         88  PS-NOT-1ST-ENTRY-NBR                  VALUE 'N'.     04730099
047400     05  PS-1ST-BOL-ID-SW            PIC X(01)     VALUE 'Y'.     04740099
047500         88  PS-1ST-BOL-ID                         VALUE 'Y'.     04750099
047600         88  PS-NOT-1ST-BOL-ID                     VALUE 'N'.     04760099
047700     05  PS-1ST-CONTAINER-ID-SW      PIC X(01)     VALUE 'Y'.     04770099
047800         88  PS-1ST-CONTAINER-ID                   VALUE 'Y'.     04780099
047900         88  PS-NOT-1ST-CONTAINER-ID               VALUE 'N'.     04790099
048000     05  PS-MULT-REC-01-FOUND-SW     PIC X(01)     VALUE 'N'.     04800099
048100         88  PS-MULT-REC-01-FOUND                  VALUE 'Y'.     04810099
048200         88  PS-MULT-REC-01-NOT-FND                VALUE 'N'.     04820099
048300     05  PS-MULT-REC-02-FOUND-SW     PIC X(01)     VALUE 'N'.     04830099
048400         88  PS-MULT-REC-02-FOUND                  VALUE 'Y'.     04840099
048500         88  PS-MULT-REC-02-NOT-FND                VALUE 'N'.     04850099
048600     05  PS-MULT-REC-03-FOUND-SW     PIC X(01)     VALUE 'N'.     04860099
048700         88  PS-MULT-REC-03-FOUND                  VALUE 'Y'.     04870099
048800         88  PS-MULT-REC-03-NOT-FND                VALUE 'N'.     04880099
048900     05  PS-MULT-REC-04-FOUND-SW     PIC X(01)     VALUE 'N'.     04890099
049000         88  PS-MULT-REC-04-FOUND                  VALUE 'Y'.     04900099
049100         88  PS-MULT-REC-04-NOT-FND                VALUE 'N'.     04910099
049200     05  PS-DECON-GROUP-SW           PIC X(01)     VALUE 'N'.     04920099
049300         88  PS-PROCESSING-DECON-GROUP             VALUE 'Y'.     04930099
049400         88  PS-NOT-PROCESSING-DECON-GROUP         VALUE 'N'.     04940099
049500     05  PS-DECON-INVOICE-ERR-SW     PIC X(01)     VALUE 'N'.     04950099
049600         88  PS-DECON-INVOICE-ERR-FND              VALUE 'Y'.     04960099
049700         88  PS-DECON-INVOICE-ERR-NOT-FND          VALUE 'N'.     04970099
049800     05  PS-PO-WEIGHT-FOUND-SW       PIC X(01)     VALUE 'N'.     04980099
049900         88  PS-PO-WEIGHT-FOUND                    VALUE 'Y'.     04990099
050000         88  PS-PO-WEIGHT-NOT-FOUND                VALUE 'N'.     05000099
050100     05  PS-PO-SKU-COUNT-FOUND-SW    PIC X(01)     VALUE 'N'.     05010099
050200         88  PS-PO-SKU-COUNT-FOUND                 VALUE 'Y'.     05020099
050300         88  PS-PO-SKU-COUNT-NOT-FOUND             VALUE 'N'.     05030099
050400     05  PS-INVLD-SKU-CNT-FOUND-SW   PIC X(01)     VALUE 'N'.     05040099
050500         88  PS-INVLD-SKU-CNT-FOUND                VALUE 'Y'.     05050099
050600         88  PS-INVLD-SKU-CNT-NOT-FOUND            VALUE 'N'.     05060099
050700                                                                  05070099
050800 01  PS-SWITCHES.                                                 05080099
050900     05  END-OF-EDIIN-SW             PIC X(01)     VALUE ' '.     05090099
051000         88  END-OF-EDIIN                          VALUE 'Y'.     05100099
051100     05  PS-DATE-INVALID             PIC X(01)     VALUE ' '.     05110099
051200         88  PS-VALID-DATE                         VALUE 'Y'.     05120099
051300         88  PS-NOT-VALID-DATE                     VALUE 'N'.     05130099
051400     05  VALID-DUNS-NUMBER-SW        PIC X(01)     VALUE ' '.     05140099
051500         88  PS-VALID-DUNS                         VALUE 'Y'.     05150099
051600         88  PS-NOT-VALID-DUNS                     VALUE 'N'.     05160099
051700     05  PS-PO-NBR-VALID             PIC X(01)     VALUE ' '.     05170099
051800         88  PS-VALID-PO-NBR                       VALUE 'Y'.     05180099
051900         88  PS-NOT-VALID-PO-NBR                   VALUE 'N'.     05190099
052000     05  PS-ENTRY-NBR-FND-SW         PIC X(01)     VALUE ' '.     05200099
052100         88  PS-ENTRY-NBR-FND                      VALUE 'Y'.     05210099
052200     05  PS-CUSTOMER-REF-FND-SW      PIC X(01)     VALUE ' '.     05220099
052300         88  PS-CUSTOMER-REF-FND                   VALUE 'Y'.     05230099
052400     05  PS-CONTAINER-ID-FND-SW      PIC X(01)     VALUE ' '.     05240099
052500         88  PS-CONTAINER-ID-FND                   VALUE 'Y'.     05250099
052600     05  PS-BOL-NBR-FND-SW           PIC X(01)     VALUE ' '.     05260099
052700         88  PS-BOL-NBR-FND                        VALUE 'Y'.     05270099
052800     05  PS-DECONSOLID-FND-SW        PIC X(01)     VALUE ' '.     05280099
052900         88  PS-DECONSOLID-FND                     VALUE 'Y'.     05290099
053000     05  PS-DRAYAGE-FND-SW           PIC X(01)     VALUE ' '.     05300099
053100         88  PS-DRAYAGE-FND                        VALUE 'Y'.     05310099
053200     05  PS-ENTRY-FEE-FND-SW         PIC X(01)     VALUE ' '.     05320099
053300         88  PS-ENTRY-FEE-FND                      VALUE 'Y'.     05330099
053400     05  PS-DUTY-FND-SW              PIC X(01)     VALUE ' '.     05340099
053500         88  PS-DUTY-FND                           VALUE 'Y'.     05350099
053600     05  PS-690-FND-SW               PIC X(01)     VALUE ' '.     05360099
053700         88  PS-690-FND                            VALUE 'Y'.     05370099
053800     05  PS-BSS-FND-SW               PIC X(01)     VALUE ' '.     05380099
053900         88  PS-BSS-FND                            VALUE 'Y'.     05390099
054000     05  PS-NET-COST-NE-CHRG-TOTL-SW PIC X(01)     VALUE ' '.     05400099
054100         88  PS-NET-COST-NE-CHRG-TOTL              VALUE 'Y'.     05410099
054200     05  PS-OCF-FND-SW               PIC X(01)     VALUE ' '.     05420099
054300         88  PS-OCF-FND                            VALUE 'Y'.     05430099
054400     05  PS-CTN-COUNT-SW             PIC X(01)     VALUE ' '.     05440099
054500         88  PS-CTN-COUNT-FND                      VALUE 'Y'.     05450099
054600     05  PS-PO-CONTNR-SW             PIC X(01)     VALUE 'N'.     05460099
054700         88  PS-PO-CONTNR-NOT-FND                  VALUE 'N'.     05470099
054800         88  PS-PO-CONTNR-FND                      VALUE 'Y'.     05480099
054900     05  PS-CUSTOMS-CNTNR-SW         PIC X(01)     VALUE 'N'.     05490099
055000         88  PS-CUSTOMS-CNTNR-NOT-FND              VALUE 'N'.     05500099
055100         88  PS-CUSTOMS-CNTNR-FND                  VALUE 'Y'.     05510099
055200     05  PS-PO-BOL-SW                PIC X(01)     VALUE 'N'.     05520099
055300         88  PS-PO-BOL-NOT-FND                     VALUE 'N'.     05530099
055400         88  PS-PO-BOL-FND                         VALUE 'Y'.     05540099
055500     05  PS-PO-BKR-SW                PIC X(01)     VALUE 'N'.     05550099
055600         88  PS-PO-BKR-NOT-FND                     VALUE 'N'.     05560099
055700         88  PS-PO-BKR-FND                         VALUE 'Y'.     05570099
055800     05  PS-PO-ENTRY-SW              PIC X(01)     VALUE 'N'.     05580099
055900         88  PS-PO-ENTRY-NOT-FND                   VALUE 'N'.     05590099
056000         88  PS-PO-ENTRY-FND                       VALUE 'Y'.     05600099
056100     05  PS-RECYCLE-SW               PIC X(01)     VALUE 'N'.     05610099
056200         88  RECYCLE-EDI                           VALUE 'Y'.     05620099
056300         88  NO-EDI-RECYCLE                        VALUE 'N'.     05630099
056400                                                                  05640099
056500 01  RUN-TIME                        PIC 9(8).                    05650099
056600 01  DATE-IN                         PIC X(6).                    05660099
056700 EJECT                                                            05670099
056800*--------------------------------------------------------------*  05680099
056900*  CONTROL CARD RECORD LAYOUT                                  *  05690099
057000*--------------------------------------------------------------*  05700099
057100 01  CONTROL-CARD-RECORD.                                         05710099
057200     05  CC-RECYCLE-DAYS         PIC  9(02).                      05720099
057300     05  FILLER                  PIC  X(78).                      05730099
057400                                                                  05740099
057500*----------------------------------------------------------------*05750099
057600*  EDI IMPORT LANDED COST INVOICE INPUT FILE.                     05760099
057700*----------------------------------------------------------------*05770099
057800     COPY APRD015.                                                05780099
057900 EJECT                                                            05790099
058000*----------------------------------------------------------------*05800099
058100*  EDI IMPORT LANDED COST INVOICE EDITING AREA.                   05810099
058200*----------------------------------------------------------------*05820099
058300 01  WS-EDIT-AREA.                                                05830099
058400     COPY APWS015.                                                05840099
058500 EJECT                                                            05850099
058600*----------------------------------------------------------------*05860099
058700*  IMPORT EXPENSE INVOICE AUDIT OUTPUT FILE.                      05870099
058800*----------------------------------------------------------------*05880099
058900     COPY APRD019.                                                05890099
059000 EJECT                                                            05900099
059100*----------------------------------------------------------------*05910099
059200*  EDI IMPORT INVOICE REJECTION OUTPUT FILE.                      05920099
059300*----------------------------------------------------------------*05930099
059400     COPY APRD018.                                                05940099
059500 EJECT                                                            05950099
059600*----------------------------------------------------------------*05960099
059700*  EDI IMPORT LANDED COST INVOICE EDIT CODES.                     05970099
059800*----------------------------------------------------------------*05980099
059900 01  WS-EDIT-CODES.                                               05990099
060000     COPY APWS010.                                                06000099
060100 EJECT                                                            06010099
060200     COPY DPWS004.                                                06020099
060300*                                                                 06030099
060400*----------------------------------------------------------------*06040099
060500*  COMMUNICATIONS AREA2 FOR DB2                                   06050099
060600*----------------------------------------------------------------*06060099
060700     COPY SQLCA2.                                                 06070099
060800*                                                                 06080099
060900     EXEC SQL                                                     06090099
061000          INCLUDE SQLCA                                           06100099
061100     END-EXEC.                                                    06110099
061200*----------------------------------------------------------------*06120099
061300*  EXTERNAL ENTITY NAME TABLE                                     06130099
061400*----------------------------------------------------------------*06140099
061500     EXEC SQL                                                     06150099
061600          INCLUDE TENTNME                                         06160099
061700     END-EXEC.                                                    06170099
061800*----------------------------------------------------------------*06180099
061900*  EXTERNAL ENTITY TABLE                                          06190099
062000*----------------------------------------------------------------*06200099
062100     EXEC SQL                                                     06210099
062200          INCLUDE TEXTENT                                         06220099
062300     END-EXEC.                                                    06230099
062400*----------------------------------------------------------------*06240099
062500*  PURCHASE ORDER TABLE                                           06250099
062600*----------------------------------------------------------------*06260099
062700     EXEC SQL                                                     06270099
062800          INCLUDE TPURCHS                                         06280099
062900     END-EXEC.                                                    06290099
063000*----------------------------------------------------------------*06300099
063100*  PO TRACKING CONTAINER PO TABLE                                 06310099
063200*----------------------------------------------------------------*06320099
063300     EXEC SQL                                                     06330099
063400          INCLUDE TIMCNPO                                         06340099
063500     END-EXEC.                                                    06350099
063600*----------------------------------------------------------------*06360099
063700*  PO TRACKING CUSTOMS PO NUMBER                                  06370099
063800*----------------------------------------------------------------*06380099
063900     EXEC SQL                                                     06390099
064000          INCLUDE TIMCSPO                                         06400099
064100     END-EXEC.                                                    06410099
064200*----------------------------------------------------------------*06420099
064300*  PO TRACKING CUSTOMS CONTAINER                                  06430099
064400*----------------------------------------------------------------*06440099
064500     EXEC SQL                                                     06450099
064600          INCLUDE TIMCSCN                                         06460099
064700     END-EXEC.                                                    06470099
064800*----------------------------------------------------------------*06480099
064900*  PO TRACKING CUSTOMS BILL OF LADING                             06490099
065000*----------------------------------------------------------------*06500099
065100     EXEC SQL                                                     06510099
065200          INCLUDE TIMCSBL                                         06520099
065300     END-EXEC.                                                    06530099
065400*----------------------------------------------------------------*06540099
065500*  PO TRACKING CUSTOMS ENTRY                                      06550099
065600*----------------------------------------------------------------*06560099
065700     EXEC SQL                                                     06570099
065800          INCLUDE TIMCSEN                                         06580099
065900     END-EXEC.                                                    06590099
066000*----------------------------------------------------------------*06600099
066100*    DB2 AREA FOR SYSDUMMY1                                       06610099
066200*----------------------------------------------------------------*06620099
066300     EXEC SQL                                                     06630099
066400          INCLUDE SYSDUMMY                                        06640099
066500     END-EXEC.                                                    06650099
066600                                                                  06660099
066700                                                                  06670099
066800 01  FILLER                        PIC X(25) VALUE                06680099
066900          '<====WS FOR APKUT220 ENDS'.                            06690099
067000 EJECT                                                            06700099
067100 PROCEDURE DIVISION.                                              06710099
067200                                                                  06720099
067300 A100-MAINLINE.                                                   06730099
067400                                                                  06740099
067500     PERFORM B100-HOUSEKEEPING.                                   06750099
067600                                                                  06760099
067700     PERFORM B200-PROCESS-IMPORT-INVOICES UNTIL END-OF-EDIIN.     06770099
067800                                                                  06780099
067900     PERFORM B300-END-OF-JOB.                                     06790099
068000                                                                  06800099
068100     GOBACK.                                                      06810099
068200                                                                  06820099
068300 EJECT                                                            06830099
068400*---------------------------------------------------------------* 06840099
068500* GET DATE, TIME, OPEN FILES, INITIALIZE RECORD LAYOUTS AND       06850099
068600* PERFORM INITIAL READ OF INPUT FILE.                             06860099
068700*---------------------------------------------------------------* 06870099
068800 B100-HOUSEKEEPING.                                               06880099
068900                                                                  06890099
069000     ACCEPT RUN-TIME FROM TIME.                                   06900099
069100     ACCEPT DATE-IN  FROM DATE.                                   06910099
069200     DISPLAY '------------ START OF APKUT220 ------------'.       06920099
069300     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    06930099
069400                                                                  06940099
069500     ACCEPT CONTROL-CARD-RECORD.                                  06950099
069600     IF CC-RECYCLE-DAYS IS NUMERIC                                06960099
069700        MOVE CC-RECYCLE-DAYS TO WS-MAX-RECYCLE-DAYS               06970099
069800        DISPLAY 'MAX RECYCLE DAYS = ' WS-MAX-RECYCLE-DAYS         06980099
069900     ELSE                                                         06990099
070000        DISPLAY 'CONTROL CARD = ' CONTROL-CARD-RECORD             07000099
070100        MOVE 'B100-INITIALIZATION' TO WS-ABEND-PARAGRAPH          07010099
070200        MOVE 'ERROR IN CONTROL CARD' TO WS-ABEND-OPERATION        07020099
070300        SET  AP-INVALID-CONTROL-CARD TO TRUE                      07030099
070400        PERFORM Z998-ABEND                                        07040099
070500     END-IF.                                                      07050099
070600                                                                  07060099
070700     OPEN  INPUT   EDI-INPUT-FILE.                                07070099
070800     OPEN  OUTPUT  AUDIT-EDI-FILE                                 07080099
070900                   REJECT-EDI-FILE                                07090099
071000                   RECYCLE-EDI-FILE.                              07100099
071100                                                                  07110099
071200     INITIALIZE DCLTENTNME                                        07120099
071300                DCLTEXTENT                                        07130099
071400                DCLTPURCHS                                        07140099
071500                DCLTIMCNPO                                        07150099
071600                DCLTIMCSPO                                        07160099
071700                DCLTIMCSCN                                        07170099
071800                DCLTIMCSBL                                        07180099
071900                DCLTIMCSEN.                                       07190099
072000     INITIALIZE AP015-EDI-IMPORT-INVOICE                          07200099
072100                AP018-REJECT-IMPORT-INVOICE                       07210099
072200                AP019-IMPORT-EXP-AUDIT-RECORD.                    07220099
072300                                                                  07230099
072400     PERFORM H100-INITIALIZE.                                     07240099
072500     PERFORM H200-INITIALIZE-DECON-TBL.                           07250099
072600                                                                  07260099
072700     PERFORM R100-READ-EDI-INPUT.                                 07270099
072800     IF END-OF-EDIIN                                              07280099
072900        DISPLAY '***************************************'         07290099
073000        DISPLAY '* INPUT FILE IS EMPTY.  NO INVOICES   *'         07300099
073100        DISPLAY '* TO PROCESS.                         *'         07310099
073200        DISPLAY '***************************************'         07320099
073300        CLOSE EDI-INPUT-FILE                                      07330099
073400              AUDIT-EDI-FILE                                      07340099
073500              REJECT-EDI-FILE                                     07350099
073600              RECYCLE-EDI-FILE                                    07360099
073700        GOBACK                                                    07370099
073800     END-IF.                                                      07380099
073900                                                                  07390099
074000     MOVE AP015-VENDOR-NBR  TO WS-VENDOR-NBR                      07400099
074100                               WS-EXTENT-DUN-NBR.                 07410099
074200     MOVE AP015-INVOICE-NBR TO WS-INVOICE-NBR.                    07420099
074300                                                                  07430099
074400* DETERMINE THE INVOICE BASE OF THE DECON INVOICE.                07440099
074500     IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER                  07450099
074600        MOVE SPACES            TO WS-DECON-INVC-ID                07460099
074700        MOVE AP015-INVOICE-NBR TO WS-DECON-INVC-ID                07470099
074800        PERFORM E400-EDIT-INVOICE-NBR-FOR-BASE                    07480099
074900        SET PS-PROCESSING-DECON-GROUP TO TRUE                     07490099
075000     ELSE                                                         07500099
075100        SET PS-NOT-PROCESSING-DECON-GROUP TO TRUE                 07510099
075200     END-IF.                                                      07520099
075300                                                                  07530099
075400 EJECT                                                            07540099
075500*---------------------------------------------------------------* 07550099
075600* THE INPUT FILE WILL CONTAIN MULTIPLE RECORDS FOR EACH VENDOR/   07560099
075700* INVOICE.  AS EACH RECORD IS READ, IT MUST BE DETERMINED IF THE  07570099
075800* SAME INVOICE IS BEING PROCESSED.  EACH RECORD FOR THE INVOICE   07580099
075900* WILL BE LOADED INTO THE INVOICE TABLE IN WORKING STORAGE.  WHEN 07590099
076000* A RECORD IS READ THAT IS FOR A NEW VENDOR/INVOICE OR END-OF-FILE07600099
076100* IS REACHED, THE INVOICE TABLE WILL BE EDITED.  AFTER THE INVOICE07610099
076200* TABLE EDIT FOR THE PREVIOUS INVOICE IS COMPLETE, AND BEFORE     07620099
076300* STARTING TO LOAD THE NEW INVOICE INTO THE EDIT TABLE, IT MUST BE07630099
076400* DETERMINED IF THE DECONSOLIDATION TABLE NEEDS TO BE PROCESSED.  07640099
076500* IF THE EDITED INVOICE IS A DECONSOLIDATION INVOICE, ITS VENDOR  07650099
076600* NUMBER AND INVOICE BASE WILL BE COMPARED TO THE SAME FIELDS OF  07660099
076700* ANY INVOICE ALREADY ON THE DECONSOLIDATION TABLE.  IF A MATCH   07670099
076800* IS MADE OR THE DECON TABLE IS EMPTY, THEN THE EDITED INVOICE    07680099
076900* IS ADDED TO THE TABLE.  IF NO MATCH IS MADE WITH WHAT IS ON THE 07690099
077000* TABLE, THEN THE TABLE WILL BE PROCESSED.                        07700099
077100*---------------------------------------------------------------* 07710099
077200 B200-PROCESS-IMPORT-INVOICES.                                    07720099
077300                                                                  07730099
077400     IF AP015-VNDR-INVC-KEY NOT = WS-VNDR-INVC-KEY                07740099
077500        SET NO-EDI-ERROR                                          07750099
077600            NO-EDI-RECYCLE TO TRUE                                07760099
077700        PERFORM E100-EDIT-INVC-TBL                                07770099
077800        PERFORM M300-MAP-AUDIT-RECORD                             07780099
077900        IF RECYCLE-EDI AND NOT ERROR-EDI                          07790099
078000           SET INV-IDX TO 1                                       07800099
078100           IF WS015-RECYCLE-COUNT(INV-IDX) IS NUMERIC             07810099
078200              CONTINUE                                            07820099
078300           ELSE                                                   07830099
078400              MOVE ZERO TO WS015-RECYCLE-COUNT(INV-IDX)           07840099
078500           END-IF                                                 07850099
078600           ADD +1 TO WS015-RECYCLE-COUNT(INV-IDX)                 07860099
078700           IF WS015-RECYCLE-COUNT(INV-IDX) > WS-MAX-RECYCLE-DAYS  07870099
078800              SET ERROR-EDI TO TRUE                               07880099
078900           ELSE                                                   07890099
079000              PERFORM C400-RECYCLE-INVOICE                        07900099
079100           END-IF                                                 07910099
079200        END-IF                                                    07920099
079300                                                                  07930099
079400        IF ERROR-EDI                                              07940099
079500           PERFORM C100-PROCESS-REJECT-INVOICE                    07950099
079600           IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER            07960099
079700              PERFORM C200-PROCESS-DECON-INVOICE                  07970099
079800           END-IF                                                 07980099
079900        ELSE                                                      07990099
080000           IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER            08000099
080100              PERFORM C200-PROCESS-DECON-INVOICE                  08010099
080200           ELSE                                                   08020099
080300              IF RECYCLE-EDI                                      08030099
080400                 CONTINUE                                         08040099
080500              ELSE                                                08050099
080600                 PERFORM C300-PROCESS-NON-DECON-INVOICE           08060099
080700              END-IF                                              08070099
080800           END-IF                                                 08080099
080900        END-IF                                                    08090099
081000        IF PS-PROCESSING-DECON-GROUP                              08100099
081100           IF (AP015-VENDOR-NBR = WS-VENDOR-NBR) AND              08110099
081200              (AP015-INVOICE-NBR(PV-START:PV-INVC-CUTOFF)         08120099
081300                                = WS-DECON-INVC-ID-BASE)          08130099
081400              PERFORM H100-INITIALIZE                             08140099
081500              MOVE AP015-VENDOR-NBR  TO WS-VENDOR-NBR             08150099
081600              MOVE AP015-INVOICE-NBR TO WS-INVOICE-NBR            08160099
081700           ELSE                                                   08170099
081800              PERFORM N100-SEARCH-DECON-TBL-FOR-ERRS              08180099
081900              IF PS-DECON-INVOICE-ERR-FND                         08190099
082000                 PERFORM M600-MVE-DECON-REC-TO-REJ-FILE           08200099
082100                   VARYING DCN-IDX FROM 1 BY 1                    08210099
082200                   UNTIL DCN-IDX > 50 OR                          08220099
082300                      WS-DECON-INVC-ERR(DCN-IDX) = SPACE          08230099
082400                 SET PS-DECON-INVOICE-ERR-NOT-FND TO TRUE         08240099
082500              ELSE                                                08250099
082600                 PERFORM M500-MVE-DECON-REC-TO-AUD-FILE           08260099
082700                   VARYING DCN-IDX FROM 1 BY 1                    08270099
082800                   UNTIL DCN-IDX > 50 OR                          08280099
082900                      WS-DECON-KEY(DCN-IDX) = HIGH-VALUES         08290099
083000              END-IF                                              08300099
083100              PERFORM H200-INITIALIZE-DECON-TBL                   08310099
083200              MOVE AP015-VENDOR-NBR  TO WS-EXTENT-DUN-NBR         08320099
083300              IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER         08330099
083400                 MOVE SPACES            TO WS-DECON-INVC-ID       08340099
083500                 MOVE AP015-INVOICE-NBR TO WS-DECON-INVC-ID       08350099
083600                 PERFORM E400-EDIT-INVOICE-NBR-FOR-BASE           08360099
083700                 SET PS-PROCESSING-DECON-GROUP TO TRUE            08370099
083800              ELSE                                                08380099
083900                 SET PS-NOT-PROCESSING-DECON-GROUP TO TRUE        08390099
084000              END-IF                                              08400099
084100           END-IF                                                 08410099
084200        ELSE                                                      08420099
084300           IF WS-DECON-ONLY-DECONS                                08430099
084400              MOVE ZEROES TO WS-ACCUM-DECONSOLID-AMT              08440099
084500           END-IF                                                 08450099
084600           MOVE AP015-VENDOR-NBR  TO WS-EXTENT-DUN-NBR            08460099
084700           IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER            08470099
084800              MOVE SPACES            TO WS-DECON-INVC-ID          08480099
084900              MOVE AP015-INVOICE-NBR TO WS-DECON-INVC-ID          08490099
085000              PERFORM E400-EDIT-INVOICE-NBR-FOR-BASE              08500099
085100              SET PS-PROCESSING-DECON-GROUP TO TRUE               08510099
085200           ELSE                                                   08520099
085300              SET PS-NOT-PROCESSING-DECON-GROUP TO TRUE           08530099
085400           END-IF                                                 08540099
085500        END-IF                                                    08550099
085600        PERFORM H100-INITIALIZE                                   08560099
085700        MOVE AP015-VENDOR-NBR  TO WS-VENDOR-NBR                   08570099
085800        MOVE AP015-INVOICE-NBR TO WS-INVOICE-NBR                  08580099
085900     END-IF.                                                      08590099
086000                                                                  08600099
086100     PERFORM M100-MOVE-EDI-REC-TO-TBL.                            08610099
086200     PERFORM R100-READ-EDI-INPUT.                                 08620099
086300                                                                  08630099
086400 EJECT                                                            08640099
086500*---------------------------------------------------------------* 08650099
086600* FINISH PROCESSING THE LAST VENDOR/INVOICE IN THE EDIT TABLE,    08660099
086700* THE DECON TABLE, CLOSE FILES AND DISPLAY COUNTER TOTALS.        08670099
086800*---------------------------------------------------------------* 08680099
086900 B300-END-OF-JOB.                                                 08690099
087000                                                                  08700099
087100     SET NO-EDI-ERROR TO TRUE.                                    08710099
087200     PERFORM E100-EDIT-INVC-TBL.                                  08720099
087300     PERFORM M300-MAP-AUDIT-RECORD.                               08730099
087400                                                                  08740099
087500     IF RECYCLE-EDI AND NOT ERROR-EDI                             08750099
087600        SET INV-IDX TO 1                                          08760099
087700        IF WS015-RECYCLE-COUNT(INV-IDX) IS NUMERIC                08770099
087800           CONTINUE                                               08780099
087900        ELSE                                                      08790099
088000           MOVE ZERO TO WS015-RECYCLE-COUNT(INV-IDX)              08800099
088100        END-IF                                                    08810099
088200        ADD +1 TO WS015-RECYCLE-COUNT(INV-IDX)                    08820099
088300        IF WS015-RECYCLE-COUNT(INV-IDX) > WS-MAX-RECYCLE-DAYS     08830099
088400           SET ERROR-EDI TO TRUE                                  08840099
088500        ELSE                                                      08850099
088600           PERFORM C400-RECYCLE-INVOICE                           08860099
088700        END-IF                                                    08870099
088800     END-IF.                                                      08880099
088900                                                                  08890099
089000     IF ERROR-EDI                                                 08900099
089100        PERFORM C100-PROCESS-REJECT-INVOICE                       08910099
089200        IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER               08920099
089300           PERFORM C200-PROCESS-DECON-INVOICE                     08930099
089400           PERFORM N100-SEARCH-DECON-TBL-FOR-ERRS                 08940099
089500           IF PS-DECON-INVOICE-ERR-FND                            08950099
089600              PERFORM M600-MVE-DECON-REC-TO-REJ-FILE              08960099
089700                VARYING DCN-IDX FROM 1 BY 1                       08970099
089800                UNTIL DCN-IDX > 50 OR                             08980099
089900                   WS-DECON-INVC-ERR(DCN-IDX) = SPACE             08990099
090000              SET PS-DECON-INVOICE-ERR-NOT-FND TO TRUE            09000099
090100           ELSE                                                   09010099
090200              PERFORM M500-MVE-DECON-REC-TO-AUD-FILE              09020099
090300                VARYING DCN-IDX FROM 1 BY 1                       09030099
090400                UNTIL DCN-IDX > 50 OR                             09040099
090500                   WS-DECON-KEY(DCN-IDX) = HIGH-VALUES            09050099
090600           END-IF                                                 09060099
090700        END-IF                                                    09070099
090800     ELSE                                                         09080099
090900        IF WS-DECONSOLIDATOR OR WS-DRAYAGE-PROVIDER               09090099
091000           PERFORM C200-PROCESS-DECON-INVOICE                     09100099
091100           PERFORM N100-SEARCH-DECON-TBL-FOR-ERRS                 09110099
091200           IF PS-DECON-INVOICE-ERR-FND                            09120099
091300              PERFORM M600-MVE-DECON-REC-TO-REJ-FILE              09130099
091400                VARYING DCN-IDX FROM 1 BY 1                       09140099
091500                UNTIL DCN-IDX > 50 OR                             09150099
091600                   WS-DECON-INVC-ERR(DCN-IDX) = SPACE             09160099
091700              SET PS-DECON-INVOICE-ERR-NOT-FND TO TRUE            09170099
091800           ELSE                                                   09180099
091900              PERFORM M500-MVE-DECON-REC-TO-AUD-FILE              09190099
092000                VARYING DCN-IDX FROM 1 BY 1                       09200099
092100                UNTIL DCN-IDX > 50 OR                             09210099
092200                   WS-DECON-KEY(DCN-IDX) = HIGH-VALUES            09220099
092300           END-IF                                                 09230099
092400        ELSE                                                      09240099
092500           IF RECYCLE-EDI                                         09250099
092600              CONTINUE                                            09260099
092700           ELSE                                                   09270099
092800              PERFORM C300-PROCESS-NON-DECON-INVOICE              09280099
092900           END-IF                                                 09290099
093000        END-IF                                                    09300099
093100     END-IF.                                                      09310099
093200                                                                  09320099
093300     CLOSE EDI-INPUT-FILE                                         09330099
093400           AUDIT-EDI-FILE                                         09340099
093500           REJECT-EDI-FILE                                        09350099
093600           RECYCLE-EDI-FILE.                                      09360099
093700                                                                  09370099
093800     DISPLAY '************************************************'.  09380099
093900     DISPLAY 'TOTAL INVOICE RECORDS READ     = ' WS-EDIIN-REC-CNT 09390099
094000     DISPLAY 'TOTAL INVOICE RECORDS PROCESSED= ' WS-EDIOUT-REC-CNT09400099
094100     DISPLAY 'TOTAL INVOICES TO AUDIT FILE   = ' WS-AUDIT-COUNT   09410099
094200     DISPLAY 'TOTAL INVOICES TO REJECT FILE  = ' WS-REJECT-COUNT  09420099
094300     DISPLAY 'TOTAL RECORDS TO RECYCLE FILE  = ' WS-RECYCLE-COUNT 09430099
094400     DISPLAY '************************************************'.  09440099
094500                                                                  09450099
094600     IF END-OF-EDIIN                                              09460099
094700        DISPLAY ' PROGRAM APKUT220 ENDS NORMALLY '                09470099
094800     END-IF.                                                      09480099
094900                                                                  09490099
095000     ACCEPT RUN-TIME FROM TIME.                                   09500099
095100     ACCEPT DATE-IN  FROM DATE.                                   09510099
095200                                                                  09520099
095300     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    09530099
095400     DISPLAY '************************************************'.  09540099
095500                                                                  09550099
095600 EJECT                                                            09560099
095700*---------------------------------------------------------------* 09570099
095800* PROCESS A VENDOR/INVOICE THAT HAS ERROR(S) AND WRITE IT OUT TO  09580099
095900* THE REJECT FILE.  THERE WILL BE ONE RECORD FOR EACH VENDOR/IN-  09590099
096000* VOICE THAT HAS ERROR(S).                                        09600099
096100*---------------------------------------------------------------* 09610099
096200 C100-PROCESS-REJECT-INVOICE.                                     09620099
096300                                                                  09630099
096400     INITIALIZE AP018-REJECT-IMPORT-INVOICE.                      09640099
096500     SET AP018-IDX                                                09650099
096600         CHRG-IDX  TO 1.                                          09660099
096700     SET AP018-IDX DOWN BY 1.                                     09670099
096800                                                                  09680099
096900     PERFORM M200-MAP-REJECT-RECORD                               09690099
097000       VARYING INV-IDX FROM 1 BY 1                                09700099
097100       UNTIL INV-IDX > 60 OR                                      09710099
097200          WS015-KEY(INV-IDX) = HIGH-VALUES.                       09720099
097300                                                                  09730099
097400     PERFORM P550-POPULATE-REJECT-ERRORS-II                       09740099
097500       VARYING WS-ERR-IDX FROM 1 BY 1                             09750099
097600       UNTIL WS-ERR-IDX > 10 OR                                   09760099
097700          WS-ERR-CDE(WS-ERR-IDX) = ZERO OR                        09770099
097800          AP018-IDX > 30.                                         09780099
097900                                                                  09790099
098000     PERFORM P600-POP-REJECT-RPT-DATA.                            09800099
098100     PERFORM W200-WRITE-REJECT-RECORD.                            09810099
098200                                                                  09820099
098300 EJECT                                                            09830099
098400*---------------------------------------------------------------* 09840099
098500* PROCESS THE DECONSOLIDATION VENDOR/INVOICE BY ADDING IT         09850099
098600* TO THE DECONSOLIDATON TABLE.                                    09860099
098700*---------------------------------------------------------------* 09870099
098800 C200-PROCESS-DECON-INVOICE.                                      09880099
098900                                                                  09890099
099000     SET DCN-IDX UP BY 1.                                         09900099
099100                                                                  09910099
099200     IF ERROR-EDI                                                 09920099
099300        MOVE 'Y' TO WS-DECON-INVC-ERR(DCN-IDX)                    09930099
099400     ELSE                                                         09940099
099500        MOVE 'N' TO WS-DECON-INVC-ERR(DCN-IDX)                    09950099
099600     END-IF.                                                      09960099
099700                                                                  09970099
099800     MOVE AP019-IMPORT-EXP-AUDIT-RECORD TO WS-DECON-INVC(DCN-IDX).09980099
099900                                                                  09990099
100000     INITIALIZE AP019-IMPORT-EXP-AUDIT-RECORD.                    10000099
100100                                                                  10010099
100200                                                                  10020099
100300 EJECT                                                            10030099
100400*---------------------------------------------------------------* 10040099
100500* PROCESS THE NON-DECONSOLIDATION VENDOR/INVOICE.  WRITE OUT THE  10050099
100600* CURRENT NON-DECON VENDOR/INVOICE TO THE AUDIT FILE.             10060099
100700*---------------------------------------------------------------* 10070099
100800 C300-PROCESS-NON-DECON-INVOICE.                                  10080099
100900                                                                  10090099
101000     MOVE AP019-IMPORT-EXP-AUDIT-RECORD TO AUDIT-EDI-RECORD.      10100099
101100     PERFORM W100-WRITE-AUDIT-RECORD.                             10110099
101200     INITIALIZE AP019-IMPORT-EXP-AUDIT-RECORD.                    10120099
101300**WR28623                                                         10130099
101400*    PERFORM H200-INITIALIZE-DECON-TBL.                           10140099
101500                                                                  10150099
101600*---------------------------------------------------------------* 10160099
101700* PROCESS THE RECYCLE RECORD. WRITE THE CURRENT INVOICE TO THE    10170099
101800* RECYCLE FILE.                                                   10180099
101900*---------------------------------------------------------------* 10190099
102000 C400-RECYCLE-INVOICE.                                            10200099
102100                                                                  10210099
102200     PERFORM M400-MAP-RECYCLE-RECORD                              10220099
102300        VARYING INV-IDX FROM 1 BY 1                               10230099
102400        UNTIL INV-IDX > 60 OR                                     10240099
102500           WS015-KEY(INV-IDX) = HIGH-VALUES.                      10250099
102600                                                                  10260099
102700 EJECT                                                            10270099
102800*---------------------------------------------------------------* 10280099
102900* PERFORM EDIT CHECKS PER SPECIFICATIONS                          10290099
103000* -- THE EDIT-ONE CHECK ROUTINE WILL CHECK SPECIFIC ERRORS        10300099
103100*    PER RECORD TYPE AND WILL KEEP ANY SUMMARIZATION TOTALS       10310099
103200*    AND COUNTS THAT ARE NECESSARY FOR EDITTING AFTER THE         10320099
103300*    ENTIRE INVOICE IS LOADED............................         10330099
103400* -- THE EDIT-ALL ROUTINE WILL CHECK MISSING RECORD TYPES,        10340099
103500*    DETAIL AND SUMMARY TOTAL DISCREPENCIES, ETC..........        10350099
103600*---------------------------------------------------------------* 10360099
103700 E100-EDIT-INVC-TBL.                                              10370099
103800                                                                  10380099
103900     PERFORM E200-EDIT-REC-TYPES                                  10390099
104000        VARYING INV-IDX FROM 1 BY 1                               10400099
104100        UNTIL INV-IDX > 60 OR                                     10410099
104200           WS015-KEY(INV-IDX) = HIGH-VALUES.                      10420099
104300                                                                  10430099
104400     SET WS-ERR-IDX TO 1.                                         10440099
104500     SET WS-ERR-IDX DOWN BY 1.                                    10450099
104600     PERFORM E300-EDIT-OVERALL-INVOICE.                           10460099
104700                                                                  10470099
104800     SET PS-PO-WEIGHT-NOT-FOUND                                   10480099
104900         PS-PO-SKU-COUNT-NOT-FOUND                                10490099
105000         PS-INVLD-SKU-CNT-FOUND TO TRUE.                          10500099
105100                                                                  10510099
105200 EJECT                                                            10520099
105300*---------------------------------------------------------------* 10530099
105400* PERFORM EDIT CHECKS ON THE INDIVIDUAL RECORD TYPES THAT MAKE    10540099
105500* UP ONE COMPLETE VENDOR/INVOICE.  NOTE THAT THE EDITING IS DONE  10550099
105600* ON THE DATA THAT HAS BEEN LOADED TO THE INVOICE EDIT TABLE, NOT 10560099
105700* THE EDI INPUT RECORD LAYOUT.                                    10570099
105800*---------------------------------------------------------------* 10580099
105900 E200-EDIT-REC-TYPES.                                             10590099
106000                                                                  10600099
106100     SET ERR-IDX TO 1.                                            10610099
106200     SET ERR-IDX DOWN BY 1.                                       10620099
106300                                                                  10630099
106400* EVALUATE THAT THERE IS ONLY ONE OF EACH OF THE 01 AND THE 02    10640099
106500* RECORD TYPES.  ALSO THAT THERE IS NO MORE THAN FIVE OF THE      10650099
106600* 03 RECORD TYPE AND NO MORE THAN TWENTY OF THE 04 RECORD TYPE.   10660099
106700     EVALUATE WS015-RECORD-TYP-IND(INV-IDX)                       10670099
106800        WHEN '01'                                                 10680099
106900             ADD 1 TO WS-REC-01-CNT                               10690099
107000             IF (WS-REC-01-CNT > 1) AND                           10700099
107100                (PS-MULT-REC-01-NOT-FND)                          10710099
107200                IF ERR-IDX NOT = 10                               10720099
107300                   SET ERR-IDX UP BY 1                            10730099
107400                END-IF                                            10740099
107500                SET ERROR-EDI TO TRUE                             10750099
107600                SET PS-MULT-REC-01-FOUND                          10760099
107700                    MULT-01-REC-ERR TO TRUE                       10770099
107800                MOVE WS010-ERROR-CODES TO                         10780099
107900                     WS015-ERR-CDE(INV-IDX, ERR-IDX)              10790099
108000             END-IF                                               10800099
108100        WHEN '02'                                                 10810099
108200             ADD 1 TO WS-REC-02-CNT                               10820099
108300             IF (WS-REC-02-CNT > 1) AND                           10830099
108400                (PS-MULT-REC-02-NOT-FND)                          10840099
108500                IF ERR-IDX NOT = 10                               10850099
108600                   SET ERR-IDX UP BY 1                            10860099
108700                END-IF                                            10870099
108800                SET ERROR-EDI TO TRUE                             10880099
108900                SET PS-MULT-REC-02-FOUND                          10890099
109000                    MULT-02-REC-ERR TO TRUE                       10900099
109100                MOVE WS010-ERROR-CODES TO                         10910099
109200                     WS015-ERR-CDE(INV-IDX, ERR-IDX)              10920099
109300             END-IF                                               10930099
109400        WHEN '03'                                                 10940099
109500             ADD 1 TO WS-REC-03-CNT                               10950099
109600             IF (WS-REC-03-CNT > 5) AND                           10960099
109700                (PS-MULT-REC-03-NOT-FND)                          10970099
109800                IF ERR-IDX NOT = 10                               10980099
109900                   SET ERR-IDX UP BY 1                            10990099
110000                END-IF                                            11000099
110100                SET ERROR-EDI TO TRUE                             11010099
110200                SET PS-MULT-REC-03-FOUND                          11020099
110300                    OVER-5-REF-ERR TO TRUE                        11030099
110400                MOVE WS010-ERROR-CODES   TO                       11040099
110500                     WS015-ERR-CDE(INV-IDX, ERR-IDX)              11050099
110600             END-IF                                               11060099
110700        WHEN '04'                                                 11070099
110800             ADD 1 TO WS-REC-04-CNT                               11080099
110900             IF (WS-REC-04-CNT > 20) AND                          11090099
111000                (PS-MULT-REC-04-NOT-FND)                          11100099
111100                IF ERR-IDX NOT = 10                               11110099
111200                   SET ERR-IDX UP BY 1                            11120099
111300                END-IF                                            11130099
111400                SET ERROR-EDI TO TRUE                             11140099
111500                SET PS-MULT-REC-04-FOUND                          11150099
111600                    OVER-20-CHRGS-ERR TO TRUE                     11160099
111700                MOVE WS010-ERROR-CODES   TO                       11170099
111800                     WS015-ERR-CDE(INV-IDX, ERR-IDX)              11180099
111900             END-IF                                               11190099
112000        WHEN OTHER                                                11200099
112100*            ADD 1 TO WS-REC-OTHER-CNT                            11210099
112200             IF ERR-IDX NOT = 10                                  11220099
112300                SET ERR-IDX UP BY 1                               11230099
112400             END-IF                                               11240099
112500             SET ERROR-EDI TO TRUE                                11250099
112600             SET INVALID-REC-TYPE-ERR TO TRUE                     11260099
112700             MOVE WS010-ERROR-CODES TO                            11270099
112800                  WS015-ERR-CDE(INV-IDX, ERR-IDX)                 11280099
112900     END-EVALUATE.                                                11290099
113000                                                                  11300099
113100* PERFORM SPECIFIC PARAGRAPHS TO VALIDATE THE APPROPRIATE RECORD  11310099
113200* TYPE.                                                           11320099
113300                                                                  11330099
113400     IF WS015-RECORD-TYP-IND(INV-IDX) = '01'                      11340099
113500        PERFORM F100-VALIDATE-REC-TYPE-01                         11350099
113600     END-IF.                                                      11360099
113700                                                                  11370099
113800     IF WS015-RECORD-TYP-IND(INV-IDX) = '02'                      11380099
113900        PERFORM F200-VALIDATE-REC-TYPE-02                         11390099
114000     END-IF.                                                      11400099
114100                                                                  11410099
114200     IF WS015-RECORD-TYP-IND(INV-IDX) = '03'                      11420099
114300        IF (WS-DECONSOLIDATOR OR WS-DECON-ONLY-DECONS             11430099
114400            OR WS-DRAYAGE-PROVIDER) AND                           11440099
114500           WS015-REF-ID-QUAL(INV-IDX) = SPACE                     11450099
114600           NEXT SENTENCE                                          11460099
114700        ELSE                                                      11470099
114800           IF (WS-DECONSOLIDATOR OR WS-DECON-ONLY-DECONS          11480099
114900               OR WS-DRAYAGE-PROVIDER) AND                        11490099
115000              WS015-REFERENCE-ID-NBR(INV-IDX) = SPACE             11500099
115100              NEXT SENTENCE                                       11510099
115200           ELSE                                                   11520099
115300              PERFORM F300-VALIDATE-REC-TYPE-03                   11530099
115400           END-IF                                                 11540099
115500        END-IF                                                    11550099
115600     END-IF.                                                      11560099
115700                                                                  11570099
115800     IF WS015-RECORD-TYP-IND(INV-IDX) = '04'                      11580099
115900        PERFORM F400-VALIDATE-REC-TYPE-04                         11590099
116000     END-IF.                                                      11600099
116100                                                                  11610099
116200 EJECT                                                            11620099
116300*---------------------------------------------------------------* 11630099
116400* THIS PARAGRAPH DOES VARIOUS EDIT CHECKS ON THE OVERALL INVOICE  11640099
116500* THAT CURRENTLY RESIDES IN THE INVOICE EDIT TABLE. SOME OF THE   11650099
116600* EDITS: VERIFY THAT THERE ARE IS AT LEAST ONE OF EACH OF THE     11660099
116700* FOLLOWING RECORD TYPES - 01,02,03,04; COMPARE THE SUM OF THE    11670099
116800* CHARGE AMOUNTS TO THE SENT NET COST AMOUNT SENT BY THE VENDOR.  11680099
116900*---------------------------------------------------------------* 11690099
117000 E300-EDIT-OVERALL-INVOICE.                                       11700099
117100                                                                  11710099
117200* VALIDATE THE NET COST AMOUNT = ACCUMULATED CHARGE AMOUNTS.      11720099
117300                                                                  11730099
117310     DISPLAY 'WS-SAVE-NET-COST' WS-SAVE-NET-COST                  11731099
117320     DISPLAY 'WS-ACCUM-CHRG-AMT' WS-ACCUM-CHRG-AMT                11732099
117400     IF WS-SAVE-NET-COST NOT = WS-ACCUM-CHRG-AMT                  11740099
117500        SET PS-NET-COST-NE-CHRG-TOTL TO TRUE                      11750099
117600        IF WS-ERR-IDX NOT = 10                                    11760099
117700           SET WS-ERR-IDX UP BY 1                                 11770099
117800        END-IF                                                    11780099
117900        SET ERROR-EDI TO TRUE                                     11790099
118000        SET NET-COST-NE-CHRG-SUM-ERR TO TRUE                      11800099
118010        DISPLAY 'WS010-ERROR-CODES' WS010-ERROR-CODES             11801099
118100        MOVE WS010-ERROR-CODES TO                                 11810099
118200             WS-ERR-CDE(WS-ERR-IDX)                               11820099
118300     END-IF.                                                      11830099
118400                                                                  11840099
118500* VALIDATE THAT RECORD TYPE 01 WAS FOUND.                         11850099
118600     IF WS-REC-01-CNT = 0                                         11860099
118700        IF WS-ERR-IDX NOT = 10                                    11870099
118800           SET WS-ERR-IDX UP BY 1                                 11880099
118900        END-IF                                                    11890099
119000        SET ERROR-EDI TO TRUE                                     11900099
119100        SET MISSING-01-REC-ERR TO TRUE                            11910099
119200        MOVE WS010-ERROR-CODES TO                                 11920099
119300             WS-ERR-CDE(WS-ERR-IDX)                               11930099
119400     END-IF.                                                      11940099
119500                                                                  11950099
119600* VALIDATE THAT RECORD TYPE 02 WAS FOUND.                         11960099
119700     IF WS-REC-02-CNT = 0                                         11970099
119800        IF WS-ERR-IDX NOT = 10                                    11980099
119900           SET WS-ERR-IDX UP BY 1                                 11990099
120000        END-IF                                                    12000099
120100        SET ERROR-EDI TO TRUE                                     12010099
120200        SET MISSING-02-REC-ERR TO TRUE                            12020099
120300        MOVE WS010-ERROR-CODES TO                                 12030099
120400             WS-ERR-CDE(WS-ERR-IDX)                               12040099
120500     END-IF.                                                      12050099
120600                                                                  12060099
120700* VALIDATE THAT RECORD TYPE 03 WAS FOUND.                         12070099
120800     IF WS-REC-03-CNT = 0                                         12080099
120900        IF WS-ERR-IDX NOT = 10                                    12090099
121000           SET WS-ERR-IDX UP BY 1                                 12100099
121100        END-IF                                                    12110099
121200        SET ERROR-EDI TO TRUE                                     12120099
121300        SET MISSING-03-REC-ERR TO TRUE                            12130099
121400        MOVE WS010-ERROR-CODES TO                                 12140099
121500             WS-ERR-CDE(WS-ERR-IDX)                               12150099
121600     END-IF.                                                      12160099
121700                                                                  12170099
121800* VALIDATE THAT RECORD TYPE 04 WAS FOUND.                         12180099
121900     IF WS-REC-04-CNT = 0                                         12190099
122000        IF WS-ERR-IDX NOT = 10                                    12200099
122100           SET WS-ERR-IDX UP BY 1                                 12210099
122200        END-IF                                                    12220099
122300        SET ERROR-EDI TO TRUE                                     12230099
122400        SET MISSING-04-REC-ERR TO TRUE                            12240099
122500        MOVE WS010-ERROR-CODES TO                                 12250099
122600             WS-ERR-CDE(WS-ERR-IDX)                               12260099
122700     END-IF.                                                      12270099
122800                                                                  12280099
122900* VALIDATE IF VENDOR IS A CUSTOMS BROKER THAT AN ENTRY CHARGE IS  12290099
123000* FOUND.  A DUTY CHARGE MUST ALSO BE FOUND UNLESS THE COUNTRY OF  12300099
123100* PRODUCTION IS A DUTY FREE COUNTRY. PLUS AN ENTRY NUMBER MUST BE 12310099
123200* SUPPLIED WITH A CUSTOMS BROKER.                                 12320099
123300     MOVE PURCHS-PROD-CNTRY-CDE TO WS-COUNTRY-OF-PRODUCTION.      12330099
123400     IF WS-CUSTOMS-BROKER                                         12340099
123500        IF PS-ENTRY-FEE-FND                                       12350099
123600**         IF PS-DUTY-FND OR WS-DUTY-FREE-COUNTRY                 12360099
123700**         IF (PS-DUTY-FND) OR (PURCHS-PROD-CNTRY-CDE = 'MP')     12370099
123800**                          OR (PURCHS-PROD-CNTRY-CDE = 'MU')     12380099
123900              IF PS-ENTRY-NBR-FND                                 12390099
124000                 NEXT SENTENCE                                    12400099
124100              ELSE                                                12410099
124200                 IF WS-ERR-IDX NOT = 10                           12420099
124300                    SET WS-ERR-IDX UP BY 1                        12430099
124400                 END-IF                                           12440099
124500                 SET ERROR-EDI TO TRUE                            12450099
124600                 SET NO-ENTRY-NBR-ERR TO TRUE                     12460099
124700                 MOVE WS010-ERROR-CODES TO                        12470099
124800                      WS-ERR-CDE(WS-ERR-IDX)                      12480099
124900              END-IF                                              12490099
125000*          ELSE                                                   12500099
125100*             IF WS-ERR-IDX NOT = 10                              12510099
125200*                SET WS-ERR-IDX UP BY 1                           12520099
125300*             END-IF                                              12530099
125400*             SET ERROR-EDI TO TRUE                               12540099
125500*             SET NO-DUT-CHRG-ERR TO TRUE                         12550099
125600*             MOVE WS010-ERROR-CODES TO                           12560099
125700*                  WS-ERR-CDE(WS-ERR-IDX)                         12570099
125800*          END-IF                                                 12580099
125900        ELSE                                                      12590099
126000           IF WS-ERR-IDX NOT = 10                                 12600099
126100              SET WS-ERR-IDX UP BY 1                              12610099
126200           END-IF                                                 12620099
126300           SET ERROR-EDI TO TRUE                                  12630099
126400           SET NO-ENT-CHRG-ERR TO TRUE                            12640099
126500           MOVE WS010-ERROR-CODES TO                              12650099
126600                WS-ERR-CDE(WS-ERR-IDX)                            12660099
126700        END-IF                                                    12670099
126800     END-IF.                                                      12680099
126900                                                                  12690099
127000* VALIDATE IF VENDOR IS A CUSTOMS BROKER THAT A CUSTOMER REFERENCE12700099
127100* HAS BEEN SUPPLIED.                                              12710099
127200     IF WS-CUSTOMS-BROKER                                         12720099
127300        IF PS-CUSTOMER-REF-FND                                    12730099
127400           NEXT SENTENCE                                          12740099
127500        ELSE                                                      12750099
127600           IF WS-ERR-IDX NOT = 10                                 12760099
127700              SET WS-ERR-IDX UP BY 1                              12770099
127800           END-IF                                                 12780099
127900           SET ERROR-EDI TO TRUE                                  12790099
128000           SET NO-CUSTOMER-REF-ERR TO TRUE                        12800099
128100           MOVE WS010-ERROR-CODES TO                              12810099
128200                WS-ERR-CDE(WS-ERR-IDX)                            12820099
128300        END-IF                                                    12830099
128400     END-IF.                                                      12840099
128500                                                                  12850099
128600* VALIDATE IF VENDOR IS A CARRIER OR OVERSEAS CONSOLIDATOR THAT   12860099
128700* A BILL OF LADING ID HAS BEEN SUPPLIED.                          12870099
128800     IF WS-CARRIER OR WS-OVERSEAS-CONSOL                          12880099
128900        IF PS-BOL-NBR-FND                                         12890099
129000           NEXT SENTENCE                                          12900099
129100        ELSE                                                      12910099
129200           IF WS-ERR-IDX NOT = 10                                 12920099
129300              SET WS-ERR-IDX UP BY 1                              12930099
129400           END-IF                                                 12940099
129500           SET ERROR-EDI TO TRUE                                  12950099
129600           SET NO-BOL-ID-ERR TO TRUE                              12960099
129700           MOVE WS010-ERROR-CODES TO                              12970099
129800                WS-ERR-CDE(WS-ERR-IDX)                            12980099
129900        END-IF                                                    12990099
130000     END-IF.                                                      13000099
130100                                                                  13010099
130200* VALIDATE IF VENDOR IS AN OVERSEAS CONSOLIDATOR THAT OCF         13020099
130300* (CONSOLIDATION CHARGE) HAS BEEN SUPPLIED.                       13030099
130400     IF WS-OVERSEAS-CONSOL                                        13040099
130500        IF PS-OCF-FND                                             13050099
130600           NEXT SENTENCE                                          13060099
130700        ELSE                                                      13070099
130800           IF WS-ERR-IDX NOT = 10                                 13080099
130900              SET WS-ERR-IDX UP BY 1                              13090099
131000           END-IF                                                 13100099
131100           SET ERROR-EDI TO TRUE                                  13110099
131200           SET CONSOL-CHRG-REQ-ERR TO TRUE                        13120099
131300           MOVE WS010-ERROR-CODES TO                              13130099
131400                WS-ERR-CDE(WS-ERR-IDX)                            13140099
131500        END-IF                                                    13150099
131600     END-IF.                                                      13160099
131700                                                                  13170099
131800* VALIDATE IF VENDOR IS A DECONSOLIDATOR CHARGING BY CARTON THAT  13180099
131900* CARTON COUNT HAS BEEN SUPPLIED.                                 13190099
132000     IF WS-CARTON-DECONSOL                                        13200099
132100        IF PS-CTN-COUNT-FND                                       13210099
132200           NEXT SENTENCE                                          13220099
132300        ELSE                                                      13230099
132400           IF WS-ERR-IDX NOT = 10                                 13240099
132500              SET WS-ERR-IDX UP BY 1                              13250099
132600           END-IF                                                 13260099
132700           SET ERROR-EDI TO TRUE                                  13270099
132800           SET CARTON-CNT-REQ-ERR TO TRUE                         13280099
132900           MOVE WS010-ERROR-CODES TO                              13290099
133000                WS-ERR-CDE(WS-ERR-IDX)                            13300099
133100        END-IF                                                    13310099
133200     END-IF.                                                      13320099
133300                                                                  13330099
133400* VALIDATE IF VENDOR IS A DECONSOLIDATOR THAT A DRAYAGE CHARGE OR 13340099
133500* A DECONSOLIDATION CHARGE OR A 690 CHARGE HAS BEEN FOUND.        13350099
133600     IF WS-DECONSOLIDATOR OR WS-DECON-ONLY-DECONS                 13360099
133700        OR WS-DRAYAGE-PROVIDER                                    13370099
133800        IF PS-DRAYAGE-FND OR                                      13380099
133900           PS-DECONSOLID-FND OR                                   13390099
134000           PS-690-FND                                             13400099
134100           NEXT SENTENCE                                          13410099
134200        ELSE                                                      13420099
134300           IF WS-ERR-IDX NOT = 10                                 13430099
134400              SET WS-ERR-IDX UP BY 1                              13440099
134500           END-IF                                                 13450099
134600           SET ERROR-EDI TO TRUE                                  13460099
134700           SET NO-VALID-DECONSOL-CHRG TO TRUE                     13470099
134800           MOVE WS010-ERROR-CODES TO                              13480099
134900                WS-ERR-CDE(WS-ERR-IDX)                            13490099
135000        END-IF                                                    13500099
135100     END-IF.                                                      13510099
135200                                                                  13520099
135300*  VALIDATE IF VENDOR IS A DRAYAGE PROVIDER AND THAT A DRAYAGE    13530099
135400*  CHARGE HAS BEEN FOUND.                                         13540099
135500     IF WS-DRAYAGE-PROVIDER                                       13550099
135600        IF PS-DRAYAGE-FND                                         13560099
135700           NEXT SENTENCE                                          13570099
135800        ELSE                                                      13580099
135900           IF WS-ERR-IDX NOT = 10                                 13590099
136000              SET WS-ERR-IDX UP BY 1                              13600099
136100           END-IF                                                 13610099
136200           SET ERROR-EDI TO TRUE                                  13620099
136300           SET DRAYAGE-REQ-ERR TO TRUE                            13630099
136400           MOVE WS010-ERROR-CODES TO                              13640099
136500                WS-ERR-CDE(WS-ERR-IDX)                            13650099
136600        END-IF                                                    13660099
136700     END-IF.                                                      13670099
136800                                                                  13680099
136900 EJECT                                                            13690099
137000*---------------------------------------------------------------* 13700099
137100* EDIT THE DECONSOLIDATED INVOICE NUMBER TO FIND THE BASE NUMBER. 13710099
137200* THIS IS DONE BY STRIPPING OFF THE LAST CHARACTER FROM THE       13720099
137300* INVOICE, SO THAT IT CAN BE COMPARED TO OTHER RELATED INVOICES   13730099
137400* FROM THE SAME VENDOR.                                           13740099
137500*---------------------------------------------------------------* 13750099
137600 E400-EDIT-INVOICE-NBR-FOR-BASE.                                  13760099
137700                                                                  13770099
137800     MOVE SPACES TO WS-DECON-INVC-ID-BASE.                        13780099
137900     MOVE ZEROES TO PV-START PV-INVC-CUTOFF.                      13790099
138000     MOVE LENGTH OF WS-DECON-INVC-ID  TO PV-START.                13800099
138100                                                                  13810099
138200     PERFORM                                                      13820099
138300         UNTIL WS-DECON-INVC-ID (PV-START:1) > SPACES OR          13830099
138400               PV-START = +0                                      13840099
138500         COMPUTE PV-START = PV-START - 1                          13850099
138600     END-PERFORM.                                                 13860099
138700                                                                  13870099
138800     COMPUTE PV-INVC-CUTOFF = PV-START - 1.                       13880099
138900                                                                  13890099
139000     IF PV-START < 22                                             13900099
139100         MOVE +1 TO PV-START                                      13910099
139200     ELSE                                                         13920099
139300         SUBTRACT +21 FROM PV-START                               13930099
139400     END-IF.                                                      13940099
139500                                                                  13950099
139600     MOVE WS-DECON-INVC-ID (PV-START:PV-INVC-CUTOFF)              13960099
139700                                      TO WS-DECON-INVC-ID-BASE.   13970099
139800                                                                  13980099
139900 EJECT                                                            13990099
140000*---------------------------------------------------------------* 14000099
140100* VALIDATING THE VARIOUS PARTS OF RECORD TYPE 01.                 14010099
140200*---------------------------------------------------------------* 14020099
140300 F100-VALIDATE-REC-TYPE-01.                                       14030099
140400                                                                  14040099
140500* VALIDATE THE INVOICE ID NUMBER.                                 14050099
140600     IF WS015-INVOICE-NBR(INV-IDX) = SPACES                       14060099
140700        IF ERR-IDX NOT = 10                                       14070099
140800           SET ERR-IDX UP BY 1                                    14080099
140900        END-IF                                                    14090099
141000        SET ERROR-EDI TO TRUE                                     14100099
141100        SET NO-INV-NBR-ERR TO TRUE                                14110099
141200        MOVE WS010-ERROR-CODES TO                                 14120099
141300             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      14130099
141400     END-IF.                                                      14140099
141500                                                                  14150099
141600* VALIDATE THE PURCHASE ORDER NUMBER.                             14160099
141700     IF WS015-PO-NBR(INV-IDX) NOT NUMERIC                         14170099
141800     OR WS015-PO-NBR(INV-IDX) = ZEROS                             14180099
141900        IF ERR-IDX NOT = 10                                       14190099
142000           SET ERR-IDX UP BY 1                                    14200099
142100        END-IF                                                    14210099
142200        SET ERROR-EDI TO TRUE                                     14220099
142300        SET NO-PO-NBR-ERR TO TRUE                                 14230099
142400        MOVE WS010-ERROR-CODES TO                                 14240099
142500             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      14250099
142600     ELSE                                                         14260099
142700        SET PS-NOT-VALID-PO-NBR TO TRUE                           14270099
142800        INITIALIZE DCLTPURCHS                                     14280099
142900        MOVE WS015-PO-NBR(INV-IDX) TO WS-SAVE-PO-NBR-COMP         14290099
143000        PERFORM S100-SELECT-TPURCHS                               14300099
143100        IF PS-NOT-VALID-PO-NBR                                    14310099
143200           IF ERR-IDX NOT = 10                                    14320099
143300              SET ERR-IDX UP BY 1                                 14330099
143400           END-IF                                                 14340099
143500           SET ERROR-EDI TO TRUE                                  14350099
143600           SET INVALID-PO-NBR-ERR TO TRUE                         14360099
143700           MOVE WS010-ERROR-CODES TO                              14370099
143800                WS015-ERR-CDE(INV-IDX, ERR-IDX)                   14380099
143900        ELSE                                                      14390099
144000           IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'            14400099
144100              NEXT SENTENCE                                       14410099
144200           ELSE                                                   14420099
144300              IF ERR-IDX NOT = 10                                 14430099
144400                 SET ERR-IDX UP BY 1                              14440099
144500              END-IF                                              14450099
144600              SET ERROR-EDI TO TRUE                               14460099
144700              SET NON-IMPORT-PO-NBR-ERR TO TRUE                   14470099
144800              MOVE WS010-ERROR-CODES TO                           14480099
144900                   WS015-ERR-CDE(INV-IDX, ERR-IDX)                14490099
145000           END-IF                                                 14500099
145100        END-IF                                                    14510099
145200     END-IF.                                                      14520099
145300                                                                  14530099
145400* VALIDATE THE VENDOR NUMBER.                                     14540099
145500     IF WS015-VENDOR-NBR(INV-IDX) = SPACES OR                     14550099
145600        WS015-VENDOR-NBR(INV-IDX) NOT NUMERIC                     14560099
145700        IF ERR-IDX NOT = 10                                       14570099
145800           SET ERR-IDX UP BY 1                                    14580099
145900        END-IF                                                    14590099
146000        SET ERROR-EDI TO TRUE                                     14600099
146100        SET NO-VENDOR-NBR-ERR TO TRUE                             14610099
146200        MOVE WS010-ERROR-CODES TO                                 14620099
146300             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      14630099
146400     ELSE                                                         14640099
146500        INITIALIZE DCLTEXTENT                                     14650099
146600                   DCLTENTNME                                     14660099
146700        MOVE WS015-VENDOR-NBR(INV-IDX) TO EXTENT-DUN-NBR          14670099
146800        PERFORM S200-SELECT-TENTNME                               14680099
146900        IF PS-NOT-VALID-DUNS                                      14690099
147000           IF ERR-IDX NOT = 10                                    14700099
147100              SET ERR-IDX UP BY 1                                 14710099
147200           END-IF                                                 14720099
147300           SET ERROR-EDI TO TRUE                                  14730099
147400           SET INVALID-VENDOR-NBR-ERR TO TRUE                     14740099
147500           MOVE WS010-ERROR-CODES TO                              14750099
147600                WS015-ERR-CDE(INV-IDX, ERR-IDX)                   14760099
147700        END-IF                                                    14770099
147800     END-IF.                                                      14780099
147900 EJECT                                                            14790099
148000*---------------------------------------------------------------* 14800099
148100* VALIDATING THE VARIOUS PARTS OF RECORD TYPE 02.                 14810099
148200*---------------------------------------------------------------* 14820099
148300 F200-VALIDATE-REC-TYPE-02.                                       14830099
148400                                                                  14840099
148500* VALIDATE THE INVOICE DATE.                                      14850099
148600     IF WS015-INVC-DATE(INV-IDX) NOT NUMERIC OR                   14860099
148700        WS015-INVC-DATE(INV-IDX) = '00000000'                     14870099
148800        IF ERR-IDX NOT = 10                                       14880099
148900           SET ERR-IDX UP BY 1                                    14890099
149000        END-IF                                                    14900099
149100        SET ERROR-EDI TO TRUE                                     14910099
149200        SET NO-INV-DATE-ERR TO TRUE                               14920099
149300        MOVE WS010-ERROR-CODES TO                                 14930099
149400             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      14940099
149500     ELSE                                                         14950099
149600        MOVE ZEROES                   TO  WS-CCYYMMDD             14960099
149700        MOVE WS015-INVC-DATE(INV-IDX) TO  WS-CCYYMMDD             14970099
149800        PERFORM G100-CHECK-DATE                                   14980099
149900        IF PS-NOT-VALID-DATE                                      14990099
150000           IF ERR-IDX NOT = 10                                    15000099
150100              SET ERR-IDX UP BY 1                                 15010099
150200           END-IF                                                 15020099
150300           SET ERROR-EDI TO TRUE                                  15030099
150400           SET INV-DATE-INVALID-ERR TO TRUE                       15040099
150500           MOVE WS010-ERROR-CODES TO                              15050099
150600                WS015-ERR-CDE(INV-IDX, ERR-IDX)                   15060099
150700        END-IF                                                    15070099
150800     END-IF.                                                      15080099
150900                                                                  15090099
151000* VALIDATE THE SCAC CODE WHEN THE VENDOR IS A CARRIER.            15100099
151100     IF PS-VALID-DUNS AND                                         15110099
151200        WS-CARRIER                                                15120099
151300        IF WS015-SCAC-CDE(INV-IDX) = SPACES                       15130099
151400           IF ERR-IDX NOT = 10                                    15140099
151500              SET ERR-IDX UP BY 1                                 15150099
151600           END-IF                                                 15160099
151700           SET ERROR-EDI TO TRUE                                  15170099
151800           SET NO-SCAC-ERR TO TRUE                                15180099
151900           MOVE WS010-ERROR-CODES TO                              15190099
152000                WS015-ERR-CDE(INV-IDX, ERR-IDX)                   15200099
152100        ELSE                                                      15210099
152200           IF WS015-SCAC-CDE(INV-IDX) NOT = EXTENT-SCAC-CDE       15220099
152300              IF ERR-IDX NOT = 10                                 15230099
152400                 SET ERR-IDX UP BY 1                              15240099
152500              END-IF                                              15250099
152600              SET ERROR-EDI TO TRUE                               15260099
152700              SET INVALID-SCAC-ERR TO TRUE                        15270099
152800              MOVE WS010-ERROR-CODES TO                           15280099
152900                   WS015-ERR-CDE(INV-IDX, ERR-IDX)                15290099
153000           END-IF                                                 15300099
153100        END-IF                                                    15310099
153200     END-IF.                                                      15320099
153300                                                                  15330099
153400* VALIDATE THE NET COST AMOUNT.                                   15340099
153500                                                                  15350099
153600     IF WS015-NET-INVC-AMT(INV-IDX) > ZERO                        15360099
153700        MOVE WS015-NET-INVC-AMT(INV-IDX) TO WS-SAVE-NET-COST      15370099
153800     ELSE                                                         15380099
153900        IF ERR-IDX NOT = 10                                       15390099
154000           SET ERR-IDX UP BY 1                                    15400099
154100        END-IF                                                    15410099
154200        SET ERROR-EDI TO TRUE                                     15420099
154300        SET NET-COST-GT-ZERO-ERR TO TRUE                          15430099
154400        MOVE WS010-ERROR-CODES TO                                 15440099
154500             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      15450099
154600     END-IF.                                                      15460099
154700                                                                  15470099
154800* VALIDATE THE PURCHASE ORDER UNIT OF MEASURE CODE FOR            15480099
154900* ALL VENDORS EXCEPT CUSTOMS BROKERS.                             15490099
155000     IF NOT WS-CUSTOMS-BROKER                                     15500099
155100        IF NOT WS015-VALID-PO-UOM(INV-IDX)                        15510099
155200           IF ERR-IDX NOT = 10                                    15520099
155300              SET ERR-IDX UP BY 1                                 15530099
155400           END-IF                                                 15540099
155500           SET ERROR-EDI TO TRUE                                  15550099
155600           SET INVALID-PO-QTY-UOM-ERR TO TRUE                     15560099
155700           MOVE WS010-ERROR-CODES TO                              15570099
155800                WS015-ERR-CDE(INV-IDX, ERR-IDX)                   15580099
155900     END-IF.                                                      15590099
156000                                                                  15600099
156100* VERIFY THAT THE UNIT OF MEASURE IS CARTON AND THAT THERE IS A   15610099
156200* VALID COUNT FOR A VALID VENDOR AND DECONSOLIDATOR USING CARTON. 15620099
156300     IF  PS-VALID-DUNS                                            15630099
156400     AND WS-CARTON-DECONSOL                                       15640099
156500         IF  WS015-PO-UOM-CARTON(INV-IDX)                         15650099
156600         AND WS015-PO-QTY(INV-IDX) > ZERO                         15660099
156700             SET PS-CTN-COUNT-FND TO TRUE                         15670099
156800         END-IF                                                   15680099
156900     END-IF.                                                      15690099
157000                                                                  15700099
157100* VALIDATE THE TERMS TYPE CODE.                                   15710099
157200     IF NOT WS015-VALID-TERMS-TYP(INV-IDX)                        15720099
157300        MOVE '01' TO WS015-TERMS-TYP-CDE(INV-IDX)                 15730099
157400     END-IF.                                                      15740099
157500                                                                  15750099
157600* VALIDATE THE TERMS BASIS DATE CODE.                             15760099
157700     IF NOT WS015-VALID-BASIS-DTE(INV-IDX)                        15770099
157800        MOVE '03' TO WS015-TERMS-BASIS-DTE-CDE(INV-IDX)           15780099
157900     END-IF.                                                      15790099
158000                                                                  15800099
158100* VALIDATE THE NET DUE DAYS.                                      15810099
158200     IF WS015-NET-DAYS-DUE(INV-IDX) = ZERO                        15820099
158300        MOVE '10' TO WS015-NET-DAYS-DUE(INV-IDX)                  15830099
158400     END-IF.                                                      15840099
158500                                                                  15850099
158600 EJECT                                                            15860099
158700*---------------------------------------------------------------* 15870099
158800* VALIDATING THE VARIOUS PARTS OF RECORD TYPE 03.                 15880099
158900*---------------------------------------------------------------* 15890099
159000 F300-VALIDATE-REC-TYPE-03.                                       15900099
159100                                                                  15910099
159200* VALIDATE THE REFERENCE ID QUALIFIER.                            15920099
159300                                                                  15930099
159400     IF WS015-REF-ID-QUAL(INV-IDX) = '6B' OR '98' OR 'BM' OR 'CR' 15940099
159500        NEXT SENTENCE                                             15950099
159600     ELSE                                                         15960099
159700        IF ERR-IDX NOT = 10                                       15970099
159800           SET ERR-IDX UP BY 1                                    15980099
159900        END-IF                                                    15990099
160000        SET ERROR-EDI TO TRUE                                     16000099
160100        SET INVALID-REF-QUAL-ERR TO TRUE                          16010099
160200        MOVE WS010-ERROR-CODES TO                                 16020099
160300             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      16030099
160400     END-IF.                                                      16040099
160500                                                                  16050099
160600     IF WS015-ENTRY-NBR(INV-IDX)                                  16060099
160700        SET PS-ENTRY-NBR-FND TO TRUE                              16070099
160800     END-IF.                                                      16080099
160900                                                                  16090099
161000     IF WS015-CONTAINER-ID(INV-IDX)                               16100099
161100        SET PS-CONTAINER-ID-FND TO TRUE                           16110099
161200     END-IF.                                                      16120099
161300                                                                  16130099
161400     IF WS015-BOL-NBR(INV-IDX)                                    16140099
161500        SET PS-BOL-NBR-FND TO TRUE                                16150099
161600     END-IF.                                                      16160099
161700                                                                  16170099
161800     IF WS015-CUSTOMER-REF(INV-IDX)                               16180099
161900        SET PS-CUSTOMER-REF-FND TO TRUE                           16190099
162000     END-IF.                                                      16200099
162100                                                                  16210099
162200* VALIDATE THE REFERENCE ID NUMBER.                               16220099
162300     IF WS015-REFERENCE-ID-NBR(INV-IDX) = SPACE                   16230099
162400        IF ERR-IDX NOT = 10                                       16240099
162500           SET ERR-IDX UP BY 1                                    16250099
162600        END-IF                                                    16260099
162700        SET ERROR-EDI TO TRUE                                     16270099
162800        SET NO-REF-ID-NBR-ERR TO TRUE                             16280099
162900        MOVE WS010-ERROR-CODES TO                                 16290099
163000             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      16300099
163100     END-IF.                                                      16310099
163200                                                                  16320099
163300* VALIDATE THAT THE PO/CONTAINER ID COMBINATION EXISTS.  IF NOT,  16330099
163400* CHECK FOR PO/MASTER BILL OF LADING COMBINATION.  IF NOT, CHECK  16340099
163500* FOR PO/BROKER REFERENCE #.  IF NONE OF THESE COMBINATIONS       16350099
163600* EXIST, IT WILL GENERATE AN ERROR AND REJECT THE RECORD.         16360099
163700                                                                  16370099
163800*    IF WS015-REFERENCE-ID-NBR(INV-IDX) = SPACE                   16380099
163900*       CONTINUE                                                  16390099
164000*    ELSE                                                         16400099
164100     IF WS015-CONTAINER-ID(INV-IDX) AND                           16410099
164200        WS015-REFERENCE-ID-NBR(INV-IDX) NOT = SPACE               16420099
164300*       (WS-DECONSOLIDATOR OR WS-DECON-ONLY-DECONS                16430099
164400*        OR WS-DRAYAGE-PROVIDER)                                  16440099
164500         INITIALIZE DCLTIMCNPO                                    16450099
164600         MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO                  16460099
164700                                     IMCNPO-CONTNR-ID             16470099
164800         MOVE WS-SAVE-PO-NBR-COMP TO IMCNPO-PO-NBR                16480099
164900         PERFORM S300-CHECK-PO-CONTNR                             16490099
165000         IF PS-PO-CONTNR-NOT-FND                                  16500099
165100            INITIALIZE DCLTIMCSPO                                 16510099
165200            INITIALIZE DCLTIMCSCN                                 16520099
165300            MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO               16530099
165400                                          IMCSCN-CONTNR-ID        16540099
165500            MOVE WS-SAVE-PO-NBR-COMP TO IMCSPO-PO-NBR             16550099
165600            PERFORM S400-CHECK-CUSTOMS-CNTNR                      16560099
165700            IF PS-CUSTOMS-CNTNR-NOT-FND                           16570099
165800               IF ERR-IDX NOT = 10                                16580099
165900                  SET ERR-IDX UP BY 1                             16590099
166000               END-IF                                             16600099
166100               SET ERROR-EDI TO TRUE                              16610099
166200               SET INVALID-PO-CONTNR-ERR TO TRUE                  16620099
166300               MOVE WS010-ERROR-CODES TO                          16630099
166400                                 WS015-ERR-CDE(INV-IDX, ERR-IDX)  16640099
166500            END-IF                                                16650099
166600         END-IF                                                   16660099
166700     END-IF.                                                      16670099
166800                                                                  16680099
166900     IF WS015-BOL-NBR(INV-IDX) AND                                16690099
167000        WS015-REFERENCE-ID-NBR(INV-IDX) NOT = SPACE               16700099
167100        INITIALIZE DCLTIMCSPO                                     16710099
167200        INITIALIZE DCLTIMCSBL                                     16720099
167300        MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO                   16730099
167400                                        IMCNPO-MSTR-BOL-NBR       16740099
167500                                        IMCNPO-HSE-BOL-NBR        16750099
167600        MOVE WS-SAVE-PO-NBR-COMP TO IMCNPO-PO-NBR                 16760099
167700        PERFORM S500-CHECK-PO-BOL                                 16770099
167800        IF PS-PO-BOL-NOT-FND                                      16780099
167900           IF ERR-IDX NOT = 10                                    16790099
168000              SET ERR-IDX UP BY 1                                 16800099
168100           END-IF                                                 16810099
168200        SET ERROR-EDI TO TRUE                                     16820099
168300        SET INVALID-PO-BOL-ERR TO TRUE                            16830099
168400        MOVE WS010-ERROR-CODES TO WS015-ERR-CDE(INV-IDX, ERR-IDX) 16840099
168500        END-IF                                                    16850099
168600     END-IF.                                                      16860099
168700                                                                  16870099
168800     IF WS015-CUSTOMER-REF(INV-IDX) AND                           16880099
168900        WS015-REFERENCE-ID-NBR(INV-IDX) NOT = SPACE               16890099
169000        INITIALIZE DCLTIMCSPO                                     16900099
169100        INITIALIZE DCLTIMCSEN                                     16910099
169200        MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO IMCSEN-BKR-REF-NBR16920099
169300        MOVE WS-SAVE-PO-NBR-COMP TO IMCSPO-PO-NBR                 16930099
169400        PERFORM S600-CHECK-PO-BKR                                 16940099
169500        IF PS-PO-BKR-NOT-FND                                      16950099
169600           SET RECYCLE-EDI TO TRUE                                16960099
169700           IF ERR-IDX NOT = 10                                    16970099
169800              SET ERR-IDX UP BY 1                                 16980099
169900           END-IF                                                 16990099
170000**         SET ERROR-EDI TO TRUE                                  17000099
170100           SET INVALID-PO-BROKER-ERR TO TRUE                      17010099
170200           MOVE WS015-REFERENCE-ID-NBR(INV-IDX)                   17020099
170300                              TO AP018-BROKER-REF-NBR             17030099
170400           MOVE WS010-ERROR-CODES TO                              17040099
170500                               WS015-ERR-CDE(INV-IDX, ERR-IDX)    17050099
170600        END-IF                                                    17060099
170700     END-IF.                                                      17070099
170800                                                                  17080099
170900     IF WS015-ENTRY-NBR(INV-IDX) AND                              17090099
171000        WS015-REFERENCE-ID-NBR(INV-IDX) NOT = SPACE               17100099
171100          INITIALIZE DCLTIMCSPO                                   17110099
171200          INITIALIZE DCLTIMCSEN                                   17120099
171300          MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO WS-CSTM-ENTR-ID 17130099
171400          MOVE WS-ENTRY-PREFIX     TO WS-ENTRY-ID-FIRST           17140099
171500          MOVE WS-ENTRY-SUFFIX1    TO WS-ENTRY-ID-LAST1           17150099
171600          MOVE WS-ENTRY-SUFFIX2    TO WS-ENTRY-ID-LAST2           17160099
171700          MOVE WS-ENTRY-ID         TO IMCSEN-CSTM-ENTR-ID         17170099
171800          MOVE WS-SAVE-PO-NBR-COMP TO IMCSPO-PO-NBR               17180099
171900          PERFORM S700-CHECK-PO-ENTRY                             17190099
172000          IF PS-PO-ENTRY-NOT-FND                                  17200099
172100             SET RECYCLE-EDI TO TRUE                              17210099
172200             IF ERR-IDX NOT = 10                                  17220099
172300                SET ERR-IDX UP BY 1                               17230099
172400             END-IF                                               17240099
172500**           SET ERROR-EDI TO TRUE                                17250099
172600             MOVE WS015-REFERENCE-ID-NBR(INV-IDX)                 17260099
172700                              TO AP018-ENTRY-NUMBER               17270099
172800             SET  INVALID-PO-ENTRY-ERR TO TRUE                    17280099
172900             MOVE WS010-ERROR-CODES TO                            17290099
173000                                 WS015-ERR-CDE(INV-IDX, ERR-IDX)  17300099
173100          END-IF                                                  17310099
173200     END-IF.                                                      17320099
173300 EJECT                                                            17330099
173400*---------------------------------------------------------------* 17340099
173500* VALIDATING THE VARIOUS PARTS OF RECORD TYPE 04.                 17350099
173600*---------------------------------------------------------------* 17360099
173700 F400-VALIDATE-REC-TYPE-04.                                       17370099
173800                                                                  17380099
173900* VALIDATE THE CHARGE AMOUNT.  ADD UP THE CHARGE AMOUNTS EXCEPT   17390099
174000* FOR PREPAID DUTY ('DUT') AND MANAGEMENT FEE ('BSS').            17400099
174100     IF WS015-CHARGE-AMT(INV-IDX) > ZERO                          17410099
174200        IF WS015-CHARGE-CDE(INV-IDX) = 'DUT'                      17420099
174300           ADD WS015-CHARGE-AMT(INV-IDX) TO WS-ACCUM-DUT-CHRG-AMT 17430099
174400        ELSE                                                      17440099
174500*          IF WS015-CHARGE-CDE(INV-IDX) = 'BSS'                   17450099
174600*           ADD WS015-CHARGE-AMT(INV-IDX) TO WS-ACCUM-BSS-CHRG-AMT17460099
174700*          ELSE                                                   17470099
174800            ADD WS015-CHARGE-AMT(INV-IDX) TO WS-ACCUM-CHRG-AMT    17480099
174810            DISPLAY 'WS-ACCUM-CHRG-AMT' WS-ACCUM-CHRG-AMT         17481099
174900*          END-IF                                                 17490099
175000        END-IF                                                    17500099
175100     ELSE                                                         17510099
175200        IF ERR-IDX NOT = 10                                       17520099
175300           SET ERR-IDX UP BY 1                                    17530099
175400        END-IF                                                    17540099
175500        SET ERROR-EDI TO TRUE                                     17550099
175600        SET CHRG-AMT-GT-ZERO-ERR TO TRUE                          17560099
175700        MOVE WS010-ERROR-CODES TO                                 17570099
175800             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      17580099
175900     END-IF.                                                      17590099
176000                                                                  17600099
176100* VALIDATE THE CHARGE CODE.                                       17610099
176200     IF WS015-VALID-CHRG-CDES(INV-IDX)                            17620099
176300        ADD 1 TO WS-ACCUM-CHRG-CNT                                17630099
176400     ELSE                                                         17640099
176500        IF ERR-IDX NOT = 10                                       17650099
176600           SET ERR-IDX UP BY 1                                    17660099
176700        END-IF                                                    17670099
176800        SET ERROR-EDI TO TRUE                                     17680099
176900        SET INVALID-CHRG-CDE-ERR TO TRUE                          17690099
177000        MOVE WS010-ERROR-CODES TO                                 17700099
177100             WS015-ERR-CDE(INV-IDX, ERR-IDX)                      17710099
177200     END-IF.                                                      17720099
177300                                                                  17730099
177400     IF WS015-CHARGE-CDE(INV-IDX) = 'DDF'                         17740099
177500        SET PS-DECONSOLID-FND TO TRUE                             17750099
177600        ADD WS015-CHARGE-AMT(INV-IDX) TO WS-ACCUM-DECONSOLID-AMT  17760099
177700     ELSE                                                         17770099
177800        IF WS015-CHARGE-CDE(INV-IDX) = 'DRA'                      17780099
177900*          IF WS-CUSTOMS-BROKER                                   17790099
178000*             MOVE '690' TO WS015-CHARGE-CDE(INV-IDX)             17800099
178100*             SET PS-690-FND TO TRUE                              17810099
178200*          ELSE                                                   17820099
178300           SET PS-DRAYAGE-FND TO TRUE                             17830099
178400           ADD WS015-CHARGE-AMT(INV-IDX) TO WS-ACCUM-DRAYAGE-AMT  17840099
178500*          END-IF                                                 17850099
178600        ELSE                                                      17860099
178700           IF WS015-CHARGE-CDE(INV-IDX) = 'ENT'                   17870099
178800              SET PS-ENTRY-FEE-FND TO TRUE                        17880099
178900           ELSE                                                   17890099
179000              IF WS015-CHARGE-CDE(INV-IDX) = 'DUT' OR 'DUP'       17900099
179100                 SET PS-DUTY-FND TO TRUE                          17910099
179200              ELSE                                                17920099
179300                 IF WS015-CHARGE-CDE(INV-IDX) = '690'             17930099
179400                    SET PS-690-FND TO TRUE                        17940099
179500                 ELSE                                             17950099
179600                    IF WS015-CHARGE-CDE(INV-IDX) = 'BSS'          17960099
179700                       SET PS-BSS-FND TO TRUE                     17970099
179800                    END-IF                                        17980099
179900                 END-IF                                           17990099
180000              END-IF                                              18000099
180100           END-IF                                                 18010099
180200        END-IF                                                    18020099
180300     END-IF.                                                      18030099
180400                                                                  18040099
180500* VERIFY WHETHER OCF (CONSOLIDATION CHARGE) EXISTS.               18050099
180600     IF WS015-VALID-CHRG-CDES(INV-IDX) AND                        18060099
180700        WS015-CHARGE-CDE(INV-IDX) = 'OCF'                         18070099
180800        SET PS-OCF-FND TO TRUE                                    18080099
180900     END-IF.                                                      18090099
181000 EJECT                                                            18100099
181100*---------------------------------------------------------------* 18110099
181200* VALIDATING THE SENT INVOICE DATE.                               18120099
181300*---------------------------------------------------------------* 18130099
181400 G100-CHECK-DATE.                                                 18140099
181500                                                                  18150099
181600     SET PS-NOT-VALID-DATE TO TRUE.                               18160099
181700                                                                  18170099
181800     IF WS-CCYYMMDD > '00000000'                                  18180099
181900        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    18190099
182000        SET DPG52-LK-DTE-ISO           TO TRUE                    18200099
182100        MOVE WS-CCYYMMDD       TO DPG52-LK-DATE-INPUT             18210099
182200        MOVE SPACES                    TO PS-DATE-INVALID         18220099
182300                                                                  18230099
182400        CALL  DP500-KOHLS-CALENDAR-ROUTINE USING                  18240099
182500                                          DPG51 DPG52 DPG53       18250099
182600                                          DPG54 DPG55 DPG56       18260099
182700                                                                  18270099
182800         IF (DPG54-SEVERE-ERROR                                   18280099
182900            OR                                                    18290099
183000             DPG54-WARNING-ERROR)                                 18300099
183100             SET PS-NOT-VALID-DATE TO TRUE                        18310099
183200         ELSE                                                     18320099
183300            SET PS-VALID-DATE TO TRUE                             18330099
183400         END-IF                                                   18340099
183500     END-IF.                                                      18350099
183600                                                                  18360099
183700 EJECT                                                            18370099
183800 H100-INITIALIZE.                                                 18380099
183900*---------------------------------------------------------------* 18390099
184000* INITIALIZE THE EDIT TABLE THAT WILL HOLD THE ENTIRE INVOICE.    18400099
184100* ALSO, INITIALIZE THE RELATED COUNTERS, SWITCHES AND SAVE FIELDS.18410099
184200*---------------------------------------------------------------* 18420099
184300     PERFORM VARYING INV-IDX FROM 1 BY 1                          18430099
184400        UNTIL INV-IDX > 60                                        18440099
184500        MOVE HIGH-VALUES TO WS015-KEY(INV-IDX)                    18450099
184600        MOVE SPACES TO WS015-DATA-AREA(INV-IDX)                   18460099
184700        INITIALIZE WS015-DATA-AREA(INV-IDX)                       18470099
184800        INITIALIZE WS015-ERROR-CODE-AREA(INV-IDX)                 18480099
184900     END-PERFORM.                                                 18490099
185000                                                                  18500099
185100     PERFORM VARYING WS-ERR-IDX FROM 1 BY 1                       18510099
185200        UNTIL WS-ERR-IDX > 10                                     18520099
185300        MOVE ZEROES TO WS-ERR-CDE(WS-ERR-IDX)                     18530099
185400     END-PERFORM.                                                 18540099
185500                                                                  18550099
185600     INITIALIZE AP019-IMPORT-EXP-AUDIT-RECORD.                    18560099
185700                                                                  18570099
185800     INITIALIZE WS-INVOICE-COUNTERS                               18580099
185900                PS-SWITCHES.                                      18590099
186000                                                                  18600099
186100     MOVE ZEROES TO WS-SAVE-PO-NBR-COMP                           18610099
186200                    WS-SAVE-NET-COST                              18620099
186300                    WS-ACCUM-CHRG-AMT                             18630099
186400                    WS-ACCUM-DUT-CHRG-AMT                         18640099
186500*                   WS-ACCUM-BSS-CHRG-AMT                         18650099
186600                    WS-ACCUM-CHRG-CNT.                            18660099
186700                                                                  18670099
186800     SET PS-1ST-ENTRY-NBR                                         18680099
186900         PS-1ST-BOL-ID                                            18690099
187000         PS-1ST-CONTAINER-ID                                      18700099
187100         PS-PO-WEIGHT-NOT-FOUND                                   18710099
187200         PS-PO-SKU-COUNT-NOT-FOUND                                18720099
187300         PS-INVLD-SKU-CNT-FOUND    TO TRUE.                       18730099
187400                                                                  18740099
187500     SET INV-IDX TO 1.                                            18750099
187600     SET INV-IDX DOWN BY 1.                                       18760099
187700     SET ERR-IDX TO 1.                                            18770099
187800     SET ERR-IDX DOWN BY 1.                                       18780099
187900                                                                  18790099
188000 EJECT                                                            18800099
188100*---------------------------------------------------------------* 18810099
188200* INITIALIZE THE DECONSOLIDATION TABLE.                           18820099
188300*---------------------------------------------------------------* 18830099
188400 H200-INITIALIZE-DECON-TBL.                                       18840099
188500                                                                  18850099
188600     MOVE ZEROES TO WS-ACCUM-DRAYAGE-AMT                          18860099
188700                    WS-ACCUM-DECONSOLID-AMT.                      18870099
188800                                                                  18880099
188900     PERFORM VARYING DCN-IDX FROM 1 BY 1                          18890099
189000        UNTIL DCN-IDX > 50                                        18900099
189100        INITIALIZE WS-DECON-INVC(DCN-IDX)                         18910099
189200                   WS-DECON-INVC-ERR(DCN-IDX)                     18920099
189300        MOVE HIGH-VALUES TO WS-DECON-KEY(DCN-IDX)                 18930099
189400     END-PERFORM.                                                 18940099
189500                                                                  18950099
189600     SET DCN-IDX TO 1.                                            18960099
189700     SET DCN-IDX DOWN BY 1.                                       18970099
189800                                                                  18980099
189900 EJECT                                                            18990099
190000*---------------------------------------------------------------* 19000099
190100* MOVE THE INPUT RECORD TO THE INVOICE EDIT TABLE.                19010099
190200*---------------------------------------------------------------* 19020099
190300 M100-MOVE-EDI-REC-TO-TBL.                                        19030099
190400                                                                  19040099
190500     SET INV-IDX UP BY 1.                                         19050099
190600     IF INV-IDX > 60                                              19060099
190700        DISPLAY '************** ABEND *************'              19070099
190800        DISPLAY '*   TOO MANY EDI 210 RECORDS FOR *'              19080099
190900        DISPLAY '*   VENDOR : ' AP015-VENDOR-NBR                  19090099
191000        DISPLAY '*   PO NBR : ' AP015-PO-NBR                      19100099
191100        DISPLAY '*   INVOICE: ' AP015-INVOICE-NBR                 19110099
191200        DISPLAY '*   THAT CAN NOT BE LOADED INTO  *'              19120099
191300        DISPLAY '*   THE EDIT INVOICE TABLE       *'              19130099
191400        DISPLAY '*   PROGRAM: APKUT220            *'              19140099
191500        DISPLAY '*   PARA:M100-MOVE-EDI-REC-TO-TBL*'              19150099
191600        DISPLAY '**********************************'              19160099
191700        SET AP-TABLE-FULL TO TRUE                                 19170099
191800        CALL 'ILBOABN0' USING ABEND-CODE                          19180099
191900     ELSE                                                         19190099
192000        MOVE AP015-KEY       TO WS015-KEY(INV-IDX)                19200099
192100        MOVE AP015-DATA-AREA TO WS015-DATA-AREA(INV-IDX)          19210099
192200        ADD 1 TO WS-EDIOUT-REC-CNT                                19220099
192300     END-IF.                                                      19230099
192400                                                                  19240099
192500 EJECT                                                            19250099
192600*---------------------------------------------------------------* 19260099
192700* MOVE THE INVOICE EDIT TABLE CONTENTS TO THE REJECT RECORD       19270099
192800* FORMAT IF THERE WERE ANY ERRORS FOUND DURING THE EDIT PROCESS.  19280099
192900*---------------------------------------------------------------* 19290099
193000 M200-MAP-REJECT-RECORD.                                          19300099
193100                                                                  19310099
193200     IF WS015-210-INTRCHG-HDR(INV-IDX)                            19320099
193300        PERFORM P100-POPULATE-REJECT-INTRCHG                      19330099
193400     END-IF.                                                      19340099
193500                                                                  19350099
193600     IF WS015-210-INVOICE-HDR(INV-IDX)                            19360099
193700        PERFORM P200-POPULATE-REJECT-INVOICE                      19370099
193800     END-IF.                                                      19380099
193900                                                                  19390099
194000     IF WS015-210-REF-ID(INV-IDX)                                 19400099
194100        SET ERR-IDX TO 1                                          19410099
194200        IF WS015-ERR-CDE(INV-IDX, ERR-IDX) > ZERO                 19420099
194300           PERFORM P300-POPULATE-REJECT-REFERENCE                 19430099
194400        END-IF                                                    19440099
194500     END-IF.                                                      19450099
194600                                                                  19460099
194700     IF WS015-210-CHARGES(INV-IDX)                                19470099
194800        IF PS-NET-COST-NE-CHRG-TOTL                               19480099
194900           PERFORM P400-POPULATE-REJECT-CHARGES                   19490099
195000        ELSE                                                      19500099
195100           SET ERR-IDX TO 1                                       19510099
195200           IF WS015-ERR-CDE(INV-IDX, ERR-IDX) > ZERO              19520099
195300              PERFORM P400-POPULATE-REJECT-CHARGES                19530099
195400           END-IF                                                 19540099
195500        END-IF                                                    19550099
195600     END-IF.                                                      19560099
195700                                                                  19570099
195800     IF WS015-RECORD-TYP-IND(INV-IDX) = '01' OR '02' OR '03' OR   19580099
195900                                        '04'                      19590099
196000        SET ERR-IDX TO 1                                          19600099
196100        IF WS015-ERR-CDE(INV-IDX, ERR-IDX) > ZERO                 19610099
196200           PERFORM P500-POPULATE-REJECT-ERRORS                    19620099
196300                VARYING ERR-IDX FROM 1 BY 1                       19630099
196400                UNTIL ERR-IDX > 10 OR                             19640099
196500                   WS015-ERR-CDE(INV-IDX, ERR-IDX) = ZERO OR      19650099
196600                   AP018-IDX > 30                                 19660099
196700        END-IF                                                    19670099
196800     ELSE                                                         19680099
196900        PERFORM P450-POP-REJECT-INVLD-REC-TYPE                    19690099
197000     END-IF.                                                      19700099
197100                                                                  19710099
197200 EJECT                                                            19720099
197300*---------------------------------------------------------------* 19730099
197400* MOVE THE INVOICE EDIT TABLE CONTENTS TO THE AUDIT RECORD        19740099
197500* LAYOUT IF NO ERRORS WERE FOUND.                                 19750099
197600*---------------------------------------------------------------* 19760099
197700 M300-MAP-AUDIT-RECORD.                                           19770099
197800                                                                  19780099
197900     MOVE ENTNME-ENT-NAME-DESC    TO AP019-VENDOR-NAME.           19790099
198000     MOVE EXTENT-PRTNR-TYP-CDE    TO AP019-PRTNR-TYP-CDE.         19800099
198100     MOVE ZEROES                  TO AP019-TOTAL-DRAYAGE-AMT      19810099
198200                                     AP019-TOTAL-DECONSOL-AMT     19820099
198300     SET AP019-IDX TO 1.                                          19830099
198400     SET AP019-IDX DOWN BY 1.                                     19840099
198500                                                                  19850099
198600     PERFORM P700-POPULATE-AUDIT-REC                              19860099
198700       VARYING INV-IDX FROM 1 BY 1                                19870099
198800       UNTIL INV-IDX > 60 OR                                      19880099
198900          WS015-KEY(INV-IDX) = HIGH-VALUES.                       19890099
199000                                                                  19900099
199100 EJECT                                                            19910099
199200*---------------------------------------------------------------* 19920099
199300* MOVE THE INVOICE EDIT TABLE CONTENTS TO THE RECYCLE RECORD      19930099
199400*---------------------------------------------------------------* 19940099
199500 M400-MAP-RECYCLE-RECORD.                                         19950099
199600                                                                  19960099
199700      MOVE WS015-EDIT-INVOICES(INV-IDX) TO RECYCLE-EDI-RECORD.    19970099
199800      PERFORM W300-WRITE-RECYCLE-RECORD.                          19980099
199900                                                                  19990099
200000*---------------------------------------------------------------* 20000099
200100* MOVE THE SUMS OF THE DRAYAGE AND DECONSOLIDATION CHARGE TOTALS  20010099
200200* TO EACH DECONSOLIDATION INVOICE, THEN WRITE THE INVOICE TO THE  20020099
200300* AUDIT FILE.                                                     20030099
200400*---------------------------------------------------------------* 20040099
200500 M500-MVE-DECON-REC-TO-AUD-FILE.                                  20050099
200600                                                                  20060099
200700     MOVE WS-ACCUM-DRAYAGE-AMT TO                                 20070099
200800                               WS-DECON-DRAYAGE-AMT(DCN-IDX).     20080099
200900     IF WS-SKU-DECONSOL                                           20090099
201000        MOVE WS-ACCUM-DECONSOLID-AMT TO                           20100099
201100                               WS-DECON-DECONSOL-AMT(DCN-IDX)     20110099
201200     END-IF.                                                      20120099
201300                                                                  20130099
201400     MOVE WS-DECON-INVC(DCN-IDX)  TO AUDIT-EDI-RECORD.            20140099
201500     PERFORM W100-WRITE-AUDIT-RECORD.                             20150099
201600                                                                  20160099
201700 EJECT                                                            20170099
201800*---------------------------------------------------------------* 20180099
201900* POPULATE THE DECON INVOICES THAT HAVE RELATED INVOICE(S) AL-    20190099
202000* READY WITH ERRORS TO THE REJECT FILE FORMAT AND WRITE THE       20200099
202100* RECORD TO THE REJECT FILE.                                      20210099
202200*---------------------------------------------------------------* 20220099
202300 M600-MVE-DECON-REC-TO-REJ-FILE.                                  20230099
202400                                                                  20240099
202500     IF WS-DECON-INVC-ERR(DCN-IDX) = 'N'                          20250099
202600        MOVE WS-DECON-INVC(DCN-IDX) TO                            20260099
202700                                    AP019-IMPORT-EXP-AUDIT-RECORD 20270099
202800        INITIALIZE AP018-REJECT-IMPORT-INVOICE                    20280099
202900        MOVE AP019-VENDOR-NBR       TO AP018-VENDOR-NBR           20290099
203000        MOVE AP019-INVOICE-NBR      TO AP018-INVOICE-NBR          20300099
203100        MOVE AP019-PO-NBR           TO AP018-PO-NBR               20310099
203200        MOVE AP019-INTRCHG-CNTL-NBR TO AP018-INTRCHG-CNTL-NBR     20320099
203300        MOVE AP019-INVC-DTE         TO AP018-INVC-DTE             20330099
203400        MOVE AP019-NET-INVC-AMT     TO AP018-NET-INVC-AMT         20340099
203500        MOVE AP019-VENDOR-NAME      TO AP018-VENDOR-NAME          20350099
203600        MOVE AP019-PO-QTY           TO AP018-PO-QTY               20360099
203700        MOVE AP019-PO-WEIGHT        TO AP018-PO-WEIGHT            20370099
203800        MOVE AP019-PO-UOM-CDE       TO AP018-PO-UOM-CDE           20380099
203900        SET AP018-REJECT-REPORT                                   20390099
204000            RELATED-VEND-INVC-ERR   TO TRUE                       20400099
204100        SET AP018-IDX                                             20410099
204200            CHRG-IDX                TO 1                          20420099
204300        MOVE WS010-ERROR-CODES      TO AP018-ERR-CDE(AP018-IDX)   20430099
204400        PERFORM VARYING AP019-IDX FROM 1 BY 1                     20440099
204500                UNTIL AP019-IDX > 20 OR                           20450099
204600                      AP019-CHARGE-CDE(AP019-IDX) = SPACE         20460099
204700           MOVE AP019-CHARGE-AMT(AP019-IDX)                       20470099
204800                                    TO AP018-CHARGE-AMT(CHRG-IDX) 20480099
204900           MOVE AP019-CHARGE-CDE(AP019-IDX)                       20490099
205000                                    TO AP018-CHARGE-CDE(CHRG-IDX) 20500099
205100           SET CHRG-IDX UP BY 1                                   20510099
205200        END-PERFORM                                               20520099
205300        PERFORM W200-WRITE-REJECT-RECORD                          20530099
205400     END-IF.                                                      20540099
205500                                                                  20550099
205600 EJECT                                                            20560099
205700*---------------------------------------------------------------* 20570099
205800* SEARCH THE DECOSOLIDATION TABLE FOR ANY INVOICES THAT WERE      20580099
205900* MARKED AS BEING IN ERROR.  IF ANY ARE FOUND THEN ALL OF THE     20590099
206000* DECON INVOICES WILL BE REJECTED.                                20600099
206100*---------------------------------------------------------------* 20610099
206200 N100-SEARCH-DECON-TBL-FOR-ERRS.                                  20620099
206300                                                                  20630099
206400     SET DCN-IDX TO 1.                                            20640099
206500                                                                  20650099
206600     SEARCH WS-DECON-TBL                                          20660099
206700        AT END SET PS-DECON-INVOICE-ERR-NOT-FND TO TRUE           20670099
206800        WHEN WS-DECON-INVC-ERR(DCN-IDX) = 'Y'                     20680099
206900             SET PS-DECON-INVOICE-ERR-FND TO TRUE                 20690099
207000     END-SEARCH.                                                  20700099
207100                                                                  20710099
207200 EJECT                                                            20720099
207300*---------------------------------------------------------------* 20730099
207400* POPULATE THE REJECT INTERCHANGE PART OF THE REJECT FORMAT FROM  20740099
207500* THE INVOICE EDIT TABLE.                                         20750099
207600*---------------------------------------------------------------* 20760099
207700 P100-POPULATE-REJECT-INTRCHG.                                    20770099
207800                                                                  20780099
207900     MOVE WS015-PO-NBR(INV-IDX)      TO AP018-PO-NBR.             20790099
208000     MOVE WS015-INVOICE-NBR(INV-IDX) TO AP018-INVOICE-NBR.        20800099
208100     MOVE WS015-VENDOR-NBR(INV-IDX)  TO AP018-VENDOR-NBR.         20810099
208200     MOVE WS015-EDI-SEQ-NBR(INV-IDX) TO AP018-EDI-SEQ-NBR.        20820099
208300     MOVE WS015-INTRCHG-CNTL-NBR(INV-IDX)                         20830099
208400                                     TO AP018-INTRCHG-CNTL-NBR.   20840099
208500                                                                  20850099
208600 EJECT                                                            20860099
208700*---------------------------------------------------------------* 20870099
208800* POPULATE THE REJECT INVOICE DATA PART OF THE REJECT FORMAT      20880099
208900* FROM THE INVOICE EDIT TABLE.                                    20890099
209000*---------------------------------------------------------------* 20900099
209100 P200-POPULATE-REJECT-INVOICE.                                    20910099
209200                                                                  20920099
209300     MOVE WS015-INVC-DATE(INV-IDX)    TO AP018-INVC-DTE.          20930099
209400     MOVE WS015-NET-INVC-AMT(INV-IDX) TO AP018-NET-INVC-AMT.      20940099
209500     MOVE WS015-SCAC-CDE(INV-IDX)     TO AP018-SCAC-CDE.          20950099
209600     MOVE ENTNME-ENT-NAME-DESC        TO AP018-VENDOR-NAME.       20960099
209700     MOVE WS015-PO-QTY(INV-IDX)       TO AP018-PO-QTY.            20970099
209800     MOVE WS015-PO-WEIGHT(INV-IDX)    TO AP018-PO-WEIGHT.         20980099
209900     MOVE WS015-PO-UOM-CDE(INV-IDX)   TO AP018-PO-UOM-CDE.        20990099
210000                                                                  21000099
210100 EJECT                                                            21010099
210200*---------------------------------------------------------------* 21020099
210300* POPULATE THE REJECT REFERENCE ID PART OF THE REJECT FORMAT      21030099
210400* FROM THE INVOICE EDIT TABLE.                                    21040099
210500*---------------------------------------------------------------* 21050099
210600 P300-POPULATE-REJECT-REFERENCE.                                  21060099
210700                                                                  21070099
210800     MOVE WS015-REF-ID-QUAL(INV-IDX)                              21080099
210900                                 TO AP018-REF-ID-QUAL.            21090099
211000     MOVE WS015-REFERENCE-ID-NBR(INV-IDX)                         21100099
211100                             TO AP018-REFERENCE-ID-NBR.           21110099
211200                                                                  21120099
211300 EJECT                                                            21130099
211400*---------------------------------------------------------------* 21140099
211500* POPULATE THE REJECT CHARGES PART OF THE REJECT FORMAT           21150099
211600* FROM THE INVOICE EDIT TABLE.                                    21160099
211700*---------------------------------------------------------------* 21170099
211800 P400-POPULATE-REJECT-CHARGES.                                    21180099
211900                                                                  21190099
212000     MOVE WS015-CHARGE-AMT(INV-IDX) TO AP018-CHARGE-AMT(CHRG-IDX).21200099
212100     MOVE WS015-CHARGE-CDE(INV-IDX) TO AP018-CHARGE-CDE(CHRG-IDX).21210099
212200     SET CHRG-IDX UP BY 1.                                        21220099
212300                                                                  21230099
212400*---------------------------------------------------------------* 21240099
212500* POPULATE THE REJECT KEY INFO PART OF THE REJECT FORMAT          21250099
212600* FROM THE INVOICE EDIT TABLE.                                    21260099
212700*---------------------------------------------------------------* 21270099
212800 P450-POP-REJECT-INVLD-REC-TYPE.                                  21280099
212900                                                                  21290099
213000     SET ERR-IDX TO 1.                                            21300099
213100     SET AP018-IDX UP BY 1.                                       21310099
213200     MOVE WS015-RECORD-TYP-IND(INV-IDX)                           21320099
213300                                    TO AP018-INVALID-RECD-TYP-CDE.21330099
213400     MOVE WS015-ERR-CDE(INV-IDX, ERR-IDX)                         21340099
213500                                    TO AP018-ERR-CDE(AP018-IDX).  21350099
213600                                                                  21360099
213700     IF (AP018-PO-NBR NOT > ZERO) AND                             21370099
213800        (WS015-PO-NBR(INV-IDX) > ZERO)                            21380099
213900        MOVE WS015-PO-NBR(INV-IDX)      TO AP018-PO-NBR           21390099
214000     END-IF.                                                      21400099
214100                                                                  21410099
214200     IF (AP018-INVOICE-NBR = SPACES) AND                          21420099
214300        (WS015-INVOICE-NBR(INV-IDX) NOT = SPACES)                 21430099
214400        MOVE WS015-INVOICE-NBR(INV-IDX) TO AP018-INVOICE-NBR      21440099
214500     END-IF.                                                      21450099
214600                                                                  21460099
214700     IF (AP018-VENDOR-NBR = SPACES) AND                           21470099
214800        (WS015-VENDOR-NBR(INV-IDX) NOT = SPACES)                  21480099
214900        MOVE WS015-VENDOR-NBR(INV-IDX)  TO AP018-VENDOR-NBR       21490099
215000     END-IF.                                                      21500099
215100                                                                  21510099
215200 EJECT                                                            21520099
215300*---------------------------------------------------------------* 21530099
215400* POPULATE THE REJECT ERRORS OF THE REJECT FORMAT FROM THE        21540099
215500* INVOICE EDIT TABLE.                                             21550099
215600*---------------------------------------------------------------* 21560099
215700 P500-POPULATE-REJECT-ERRORS.                                     21570099
215800                                                                  21580099
215900     SET AP018-IDX UP BY 1.                                       21590099
216000     MOVE WS015-ERR-CDE(INV-IDX, ERR-IDX)                         21600099
216100                                 TO AP018-ERR-CDE(AP018-IDX).     21610099
216200                                                                  21620099
216300*---------------------------------------------------------------* 21630099
216400* POPULATE THE REJECT ERRORS OF THE REJECT FORMAT FROM THE        21640099
216500* WORKING STORAGE ERROR TABLE.                                    21650099
216600*---------------------------------------------------------------* 21660099
216700 P550-POPULATE-REJECT-ERRORS-II.                                  21670099
216800                                                                  21680099
216900     SET AP018-IDX UP BY 1.                                       21690099
217000     MOVE WS-ERR-CDE(WS-ERR-IDX) TO AP018-ERR-CDE(AP018-IDX).     21700099
217100                                                                  21710099
217200 EJECT                                                            21720099
217300*---------------------------------------------------------------* 21730099
217400* POPULATE THE REJECT REPORT PART OF THE REJECT FORMAT            21740099
217500* FROM VARIOUS HOLD FIELDS IN WORKING STORAGE.                    21750099
217600*---------------------------------------------------------------* 21760099
217700 P600-POP-REJECT-RPT-DATA.                                        21770099
217800                                                                  21780099
217900     SET AP018-REJECT-REPORT   TO TRUE.                           21790099
218000     MOVE PURCHS-PO-TYP-CDE    TO AP018-PO-TYP-CDE.               21800099
218100     MOVE EXTENT-PRTNR-TYP-CDE TO AP018-PRTNR-TYP-CDE.            21810099
218200     MOVE WS-ACCUM-CHRG-AMT    TO AP018-TOTAL-CHRG-AMT.           21820099
218300     MOVE WS-ACCUM-DRAYAGE-AMT TO AP018-TOTAL-DRAYAGE-AMT.        21830099
218400     MOVE WS-ACCUM-DECONSOLID-AMT                                 21840099
218500                               TO AP018-TOTAL-DECONSOL-AMT.       21850099
218600     MOVE WS-ACCUM-CHRG-CNT    TO AP018-CHRG-COUNT.               21860099
218700                                                                  21870099
218800 EJECT                                                            21880099
218900*---------------------------------------------------------------* 21890099
219000* POPULATE THE AUDIT RECORD FORMAT FROM THE INVOICE EDIT TABLE.   21900099
219100*---------------------------------------------------------------* 21910099
219200 P700-POPULATE-AUDIT-REC.                                         21920099
219300                                                                  21930099
219400     IF WS015-210-INTRCHG-HDR(INV-IDX)                            21940099
219500        MOVE WS015-VENDOR-NBR(INV-IDX)  TO AP019-VENDOR-NBR       21950099
219600        MOVE WS015-INVOICE-NBR(INV-IDX) TO AP019-INVOICE-NBR      21960099
219700        MOVE WS015-PO-NBR(INV-IDX)      TO AP019-PO-NBR           21970099
219800        MOVE WS015-INTRCHG-CNTL-NBR(INV-IDX)                      21980099
219900                                        TO AP019-INTRCHG-CNTL-NBR 21990099
220000     END-IF.                                                      22000099
220100                                                                  22010099
220200     IF WS015-210-INVOICE-HDR(INV-IDX)                            22020099
220300        MOVE WS015-INVC-DATE(INV-IDX)     TO AP019-INVC-DTE       22030099
220400        COMPUTE AP019-NET-INVC-AMT = WS015-NET-INVC-AMT(INV-IDX)  22040099
220500                                   + WS-ACCUM-DUT-CHRG-AMT        22050099
220600        MOVE WS015-PO-QTY(INV-IDX)        TO AP019-PO-QTY         22060099
220700        MOVE WS015-PO-WEIGHT(INV-IDX)     TO AP019-PO-WEIGHT      22070099
220800        MOVE WS015-PO-UOM-CDE(INV-IDX)    TO AP019-PO-UOM-CDE     22080099
220900        MOVE WS015-TERMS-TYP-CDE(INV-IDX) TO AP019-TERMS-TYP-CDE  22090099
221000        MOVE WS015-TERMS-BASIS-DTE-CDE(INV-IDX)                   22100099
221100                                    TO AP019-TERMS-BASIS-DTE-CDE  22110099
221200        MOVE WS015-NET-DAYS-DUE(INV-IDX)  TO AP019-NET-DAYS-DUE   22120099
221300     END-IF.                                                      22130099
221400                                                                  22140099
221500     IF WS015-210-REF-ID(INV-IDX)                                 22150099
221600        PERFORM P750-POP-1ST-REF-ID-NBR                           22160099
221700     END-IF.                                                      22170099
221800                                                                  22180099
221900     IF WS015-210-CHARGES(INV-IDX)                                22190099
222000        PERFORM P760-POPULATE-AUDIT-CHARGES                       22200099
222100     END-IF.                                                      22210099
222200                                                                  22220099
222300 EJECT                                                            22230099
222400*---------------------------------------------------------------* 22240099
222500* POPULATE ONLY THE FIRST OCCURRENCE OF EACH TYPE OF REFERENCE    22250099
222600* NUMBER FROM THE INVOICE EDIT TABLE.                             22260099
222700*---------------------------------------------------------------* 22270099
222800 P750-POP-1ST-REF-ID-NBR.                                         22280099
222900                                                                  22290099
223000     IF  WS015-ENTRY-NBR(INV-IDX)                                 22300099
223100     AND PS-1ST-ENTRY-NBR                                         22310099
223200     AND WS-CUSTOMS-BROKER                                        22320099
223300         SET PS-NOT-1ST-ENTRY-NBR    TO TRUE                      22330099
223400         MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO AP019-ENTRY-NBR  22340099
223500     END-IF.                                                      22350099
223600                                                                  22360099
223700     IF  WS015-BOL-NBR(INV-IDX)                                   22370099
223800     AND PS-1ST-BOL-ID                                            22380099
223900     AND NOT WS-CUSTOMS-BROKER                                    22390099
224000         SET PS-NOT-1ST-BOL-ID       TO TRUE                      22400099
224100         MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO AP019-BOL-ID     22410099
224200     END-IF.                                                      22420099
224300                                                                  22430099
224400     IF  WS015-CONTAINER-ID(INV-IDX)                              22440099
224500     AND PS-1ST-CONTAINER-ID                                      22450099
224600     AND NOT WS-CUSTOMS-BROKER                                    22460099
224700        SET PS-NOT-1ST-CONTAINER-ID TO TRUE                       22470099
224800        MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO AP019-CONTAINER-ID22480099
224900     END-IF.                                                      22490099
225000                                                                  22500099
225100* WHEN THE VENDOR IS A CUSTOMS BROKER (EXPEDITORS) AND THE        22510099
225200* CUSTOMER REFERENCE NUMBER RECORD ('CR') IS ENCOUNTERED, MOVE    22520099
225300* WHAT WAS PREVIOUSLY POPULATED (P700-) IN THE OUTPUT INVOICE NUM-22530099
225400* BER INTO OUTPUT CUSTOMER REFERENCE NUMBER.  THEN MOVE WHAT IS   22540099
225500* IN THE INPUT REFERENCE ID NUMBER TO THE OUTPUT INVOICE NUMBER.  22550099
225600     IF  WS015-CUSTOMER-REF(INV-IDX)                              22560099
225700     AND WS-CUSTOMS-BROKER                                        22570099
225800*        MOVE AP019-INVOICE-NBR          TO AP019-CUSTOMER-REF-NBR22580099
225900*        MOVE SPACES                          TO AP019-INVOICE-NBR22590099
226000       MOVE WS015-REFERENCE-ID-NBR(INV-IDX) TO                    22600099
226100                                            AP019-CUSTOMER-REF-NBR22610099
226200     END-IF.                                                      22620099
226300                                                                  22630099
226400 EJECT                                                            22640099
226500*---------------------------------------------------------------* 22650099
226600* POPULATE THE CHARGES PART OF THE AUDIT RECORD FORMAT FROM THE   22660099
226700* INVOICE EDIT TABLE.                                             22670099
226800*---------------------------------------------------------------* 22680099
226900 P760-POPULATE-AUDIT-CHARGES.                                     22690099
227000                                                                  22700099
227100     SET AP019-IDX UP BY 1.                                       22710099
227200     MOVE WS015-CHARGE-AMT(INV-IDX)                               22720099
227300                                   TO AP019-CHARGE-AMT(AP019-IDX).22730099
227400     MOVE WS015-CHARGE-CDE(INV-IDX)                               22740099
227500                                   TO AP019-CHARGE-CDE(AP019-IDX).22750099
227600                                                                  22760099
227700 EJECT                                                            22770099
227800*---------------------------------------------------------------* 22780099
227900* READ THE EDI 210 INVOICE FILE.                                  22790099
228000*---------------------------------------------------------------* 22800099
228100 R100-READ-EDI-INPUT.                                             22810099
228200                                                                  22820099
228300     READ EDI-INPUT-FILE INTO AP015-EDI-IMPORT-INVOICE            22830099
228400          AT END                                                  22840099
228500             SET END-OF-EDIIN TO TRUE.                            22850099
228600                                                                  22860099
228700     IF NOT END-OF-EDIIN                                          22870099
228800        ADD 1 TO WS-EDIIN-REC-CNT                                 22880099
228900     END-IF.                                                      22890099
229000                                                                  22900099
229100 EJECT                                                            22910099
229200*---------------------------------------------------------------* 22920099
229300* CHECK FOR VALID PURCHASE ORDER NUMBER BY SELECTING THE          22930099
229400* PO_TYP_CDE (THE PO MUST BE ACTIVE).                             22940099
229500*---------------------------------------------------------------* 22950099
229600 S100-SELECT-TPURCHS.                                             22960099
229700                                                                  22970099
229800     EXEC SQL                                                     22980099
229900         SELECT PO_TYP_CDE                                        22990099
230000               ,PROD_CNTRY_CDE                                    23000099
230100         INTO  :PURCHS-PO-TYP-CDE                                 23010099
230200              ,:PURCHS-PROD-CNTRY-CDE                             23020099
230300         FROM  TPURCHS                                            23030099
230400         WHERE PO_NBR         = :WS-SAVE-PO-NBR-COMP              23040099
230500           AND VER_STATUS_CDE = 'A'                               23050099
230600     END-EXEC.                                                    23060099
230700                                                                  23070099
230800     EVALUATE TRUE                                                23080099
230900        WHEN SQLCODE = ZEROS                                      23090099
231000             SET PS-VALID-PO-NBR TO TRUE                          23100099
231100        WHEN SQLCODE = +100                                       23110099
231200             SET PS-NOT-VALID-PO-NBR TO TRUE                      23120099
231300        WHEN SQLWARN0 NOT = SPACES                                23130099
231400        WHEN SQLCODE  NOT = ZERO                                  23140099
231500             MOVE 'S100-SELECT-TPURCHS' TO WS-ABEND-PARAGRAPH     23150099
231600             MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION     23160099
231700             MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1              23170099
231800             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              23180099
231900             PERFORM Z999-SQL-ERROR                               23190099
232000     END-EVALUATE.                                                23200099
232100                                                                  23210099
232200 EJECT                                                            23220099
232300*---------------------------------------------------------------* 23230099
232400* CHECK FOR VALID DUNS NUMBER BY SELECTING THE ENT_NAME_DESC (THE 23240099
232500* VENDOR MUST BE AN EXPENSE VENDOR AND ACTIVE).                   23250099
232600*---------------------------------------------------------------* 23260099
232700 S200-SELECT-TENTNME.                                             23270099
232800                                                                  23280099
232900     EXEC SQL                                                     23290099
233000        SELECT B.ENT_NAME_DESC                                    23300099
233100              ,A.SCAC_CDE                                         23310099
233200              ,A.PRTNR_TYP_CDE                                    23320099
233300          INTO :ENTNME-ENT-NAME-DESC                              23330099
233400              ,:EXTENT-SCAC-CDE                                   23340099
233500              ,:EXTENT-PRTNR-TYP-CDE                              23350099
233600          FROM TEXTENT A                                          23360099
233700              ,TENTNME B                                          23370099
233800         WHERE  A.ENT_ID       = B.ENT_ID                         23380099
233900           AND  A.DUN_NBR      = :EXTENT-DUN-NBR                  23390099
234000           AND  A.PRIM_TYP_CDE = 'E'                              23400099
234100           AND  A.STATUS_CDE   = 'A'                              23410099
234200           AND  B.TYPE_CDE     = '01'                             23420099
234300     END-EXEC.                                                    23430099
234400                                                                  23440099
234500     EVALUATE TRUE                                                23450099
234600        WHEN SQLCODE = ZEROS                                      23460099
234700             SET PS-VALID-DUNS TO TRUE                            23470099
234800        WHEN SQLCODE = +100                                       23480099
234900             SET PS-NOT-VALID-DUNS TO TRUE                        23490099
235000        WHEN OTHER                                                23500099
235100             MOVE 'S200-SELECT-TENTNME           ' TO             23510099
235200                                       WS-ABEND-PARAGRAPH         23520099
235300             MOVE 'UNSUCCESSFUL SELECT EXTENT'                    23530099
235400                           TO WS-ABEND-OPERATION                  23540099
235500             MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-1              23550099
235600             MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-2              23560099
235700             PERFORM Z999-SQL-ERROR                               23570099
235800     END-EVALUATE.                                                23580099
235900                                                                  23590099
236000*---------------------------------------------------------------* 23600099
236100* CHECK FOR EXISTENCE OF VALID PO/CONTAINER ID COMBINATION        23610099
236200*---------------------------------------------------------------* 23620099
236300 S300-CHECK-PO-CONTNR.                                            23630099
236400                                                                  23640099
236500     EXEC SQL                                                     23650099
236600         SELECT '1'                                               23660099
236700           INTO  :PV-ONE                                          23670099
236800           FROM SYSIBM.SYSDUMMY1 X                                23680099
236900          WHERE EXISTS                                            23690099
237000               (SELECT 1                                          23700099
237100                  FROM TIMCNPO A                                  23710099
237200                 WHERE A.CONTNR_ID = :IMCNPO-CONTNR-ID            23720099
237300                   AND A.PO_NBR    = :IMCNPO-PO-NBR               23730099
237400                   AND X.IBMREQD   = X.IBMREQD)                   23740099
237500     END-EXEC.                                                    23750099
237600                                                                  23760099
237700     EVALUATE TRUE                                                23770099
237800         WHEN SQLCODE = ZERO                                      23780099
237900            SET PS-PO-CONTNR-FND TO TRUE                          23790099
238000                                                                  23800099
238100         WHEN SQLCODE = +100                                      23810099
238200            SET PS-PO-CONTNR-NOT-FND TO TRUE                      23820099
238300         WHEN SQLWARN0 NOT = SPACES                               23830099
238400         WHEN SQLCODE  NOT = ZERO                                 23840099
238500              MOVE 'S300-CHECK-PO-CONTNR          '               23850099
238600                            TO WS-ABEND-PARAGRAPH                 23860099
238700              MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                 23870099
238800                            TO WS-ABEND-OPERATION                 23880099
238900              MOVE 'TIMCNPO ' TO WS-ABEND-STRUCTURE-1             23890099
239000              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             23900099
239100              PERFORM Z999-SQL-ERROR                              23910099
239200     END-EVALUATE.                                                23920099
239300                                                                  23930099
239400*---------------------------------------------------------------* 23940099
239500* CHECK FOR EXISTENCE OF VALID PO/CONTAINER ID COMBINATION        23950099
239600*---------------------------------------------------------------* 23960099
239700 S400-CHECK-CUSTOMS-CNTNR.                                        23970099
239800                                                                  23980099
239900     EXEC SQL                                                     23990099
240000        SELECT '1'                                                24000099
240100          INTO  :PV-ONE                                           24010099
240200          FROM SYSIBM.SYSDUMMY1 X                                 24020099
240300         WHERE EXISTS                                             24030099
240400            (SELECT 1                                             24040099
240500               FROM TIMCSPO A                                     24050099
240600                   ,TIMCSCN B                                     24060099
240700              WHERE A.PO_NBR = :IMCSPO-PO-NBR                     24070099
240800                AND B.CONTNR_ID = :IMCSCN-CONTNR-ID               24080099
240900                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID               24090099
241000                AND X.IBMREQD = X.IBMREQD)                        24100099
241100     END-EXEC.                                                    24110099
241200                                                                  24120099
241300     EVALUATE TRUE                                                24130099
241400         WHEN SQLCODE = ZERO                                      24140099
241500            SET PS-CUSTOMS-CNTNR-FND TO TRUE                      24150099
241600         WHEN SQLCODE = +100                                      24160099
241700            SET PS-CUSTOMS-CNTNR-NOT-FND TO TRUE                  24170099
241800                                                                  24180099
241900         WHEN SQLWARN0 NOT = SPACES                               24190099
242000         WHEN SQLCODE  NOT = ZERO                                 24200099
242100              MOVE 'S400-CHECK-CUSTOMS-CNTNR      '               24210099
242200                            TO WS-ABEND-PARAGRAPH                 24220099
242300              MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                 24230099
242400                            TO WS-ABEND-OPERATION                 24240099
242500              MOVE 'TIMCSPO ' TO WS-ABEND-STRUCTURE-1             24250099
242600              MOVE 'TIMCSCN ' TO WS-ABEND-STRUCTURE-2             24260099
242700              PERFORM Z999-SQL-ERROR                              24270099
242800     END-EVALUATE.                                                24280099
242900                                                                  24290099
243000*---------------------------------------------------------------* 24300099
243100* CHECK FOR EXISTENCE OF VALID PO/BILL OF LADING COMBINATION      24310099
243200*---------------------------------------------------------------* 24320099
243300 S500-CHECK-PO-BOL.                                               24330099
243400                                                                  24340099
243500     EXEC SQL                                                     24350099
243600        SELECT '1'                                                24360099
243700          INTO  :PV-ONE                                           24370099
243800          FROM SYSIBM.SYSDUMMY1 X                                 24380099
243900         WHERE EXISTS                                             24390099
244000               (SELECT 1                                          24400099
244100                  FROM TIMCNPO A                                  24410099
244200                 WHERE A.MSTR_BOL_NBR = :IMCNPO-MSTR-BOL-NBR      24420099
244300                   AND A.PO_NBR    = :IMCNPO-PO-NBR               24430099
244400                   AND X.IBMREQD   = X.IBMREQD)                   24440099
244500     END-EXEC.                                                    24450099
244600                                                                  24460099
244700     EVALUATE TRUE                                                24470099
244800         WHEN SQLCODE = ZERO                                      24480099
244900            SET PS-PO-BOL-FND TO TRUE                             24490099
245000         WHEN SQLCODE = +100                                      24500099
245100            PERFORM S550-CHECK-PO-HOUSE-BOL                       24510099
245200*           SET PS-PO-BOL-NOT-FND TO TRUE                         24520099
245300         WHEN SQLWARN0 NOT = SPACES                               24530099
245400         WHEN SQLCODE  NOT = ZERO                                 24540099
245500              MOVE 'S500-CHECK-PO-BOL' TO WS-ABEND-PARAGRAPH      24550099
245600              MOVE 'EXISTENCE CHECK' TO WS-ABEND-OPERATION        24560099
245700              MOVE 'TIMCNPO ' TO WS-ABEND-STRUCTURE-1             24570099
245800              PERFORM Z999-SQL-ERROR                              24580099
245900     END-EVALUATE.                                                24590099
246000                                                                  24600099
246100*---------------------------------------------------------------* 24610099
246200* IF MASTER BOL NOT FOUND, CHECK FOR PO/HOUSE BOL.  IF FOUND,     24620099
246300* THE COMBINATION WILL BE CONSIDERED VALID.   PRB0061202          24630099
246400*---------------------------------------------------------------* 24640099
246500 S550-CHECK-PO-HOUSE-BOL.                                         24650099
246600                                                                  24660099
246700     EXEC SQL                                                     24670099
246800        SELECT '1'                                                24680099
246900          INTO  :PV-ONE                                           24690099
247000          FROM SYSIBM.SYSDUMMY1 X                                 24700099
247100         WHERE EXISTS                                             24710099
247200               (SELECT 1                                          24720099
247300                  FROM TIMCNPO A                                  24730099
247400                 WHERE A.HSE_BOL_NBR = :IMCNPO-HSE-BOL-NBR        24740099
247500                   AND A.PO_NBR    = :IMCNPO-PO-NBR               24750099
247600                   AND X.IBMREQD   = X.IBMREQD)                   24760099
247700     END-EXEC.                                                    24770099
247800                                                                  24780099
247900     EVALUATE TRUE                                                24790099
248000         WHEN SQLCODE = ZERO                                      24800099
248100            SET PS-PO-BOL-FND TO TRUE                             24810099
248200                                                                  24820099
248300         WHEN SQLCODE = +100                                      24830099
248400            SET PS-PO-BOL-NOT-FND TO TRUE                         24840099
248500                                                                  24850099
248600         WHEN SQLWARN0 NOT = SPACES                               24860099
248700         WHEN SQLCODE  NOT = ZERO                                 24870099
248800              MOVE 'S550-CHECK-PO-HOUSE-BOL' TO WS-ABEND-PARAGRAPH24880099
248900              MOVE 'EXISTENCE CHECK' TO WS-ABEND-OPERATION        24890099
249000              MOVE 'TIMCNPO ' TO WS-ABEND-STRUCTURE-1             24900099
249100              PERFORM Z999-SQL-ERROR                              24910099
249200     END-EVALUATE.                                                24920099
249300                                                                  24930099
249400                                                                  24940099
249500*---------------------------------------------------------------* 24950099
249600* CHECK FOR EXISTENCE OF VALID PO/BROKER REFERENCE # COMBINATION  24960099
249700*---------------------------------------------------------------* 24970099
249800 S600-CHECK-PO-BKR.                                               24980099
249900                                                                  24990099
250000     EXEC SQL                                                     25000099
250100        SELECT '1'                                                25010099
250200          INTO  :PV-ONE                                           25020099
250300          FROM SYSIBM.SYSDUMMY1 X                                 25030099
250400         WHERE EXISTS                                             25040099
250500            (SELECT 1                                             25050099
250600               FROM TIMCSPO A                                     25060099
250700                   ,TIMCSEN B                                     25070099
250800              WHERE A.PO_NBR = :IMCSPO-PO-NBR                     25080099
250900                AND B.BKR_REF_NBR = :IMCSEN-BKR-REF-NBR           25090099
251000                AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID               25100099
251100                AND X.IBMREQD = X.IBMREQD)                        25110099
251200     END-EXEC.                                                    25120099
251300                                                                  25130099
251400     EVALUATE TRUE                                                25140099
251500         WHEN SQLCODE = ZERO                                      25150099
251600            SET PS-PO-BKR-FND TO TRUE                             25160099
251700                                                                  25170099
251800         WHEN SQLCODE = +100                                      25180099
251900            SET PS-PO-BKR-NOT-FND TO TRUE                         25190099
252000         WHEN SQLWARN0 NOT = SPACES                               25200099
252100         WHEN SQLCODE  NOT = ZERO                                 25210099
252200              MOVE 'S600-CHECK-PO-BKR             '               25220099
252300                            TO WS-ABEND-PARAGRAPH                 25230099
252400              MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                 25240099
252500                            TO WS-ABEND-OPERATION                 25250099
252600              MOVE 'TIMCSPO ' TO WS-ABEND-STRUCTURE-1             25260099
252700              MOVE 'TIMCSEN ' TO WS-ABEND-STRUCTURE-2             25270099
252800              PERFORM Z999-SQL-ERROR                              25280099
252900     END-EVALUATE.                                                25290099
253000                                                                  25300099
253100*---------------------------------------------------------------* 25310099
253200* CHECK FOR EXISTENCE OF VALID PO/ENTRY # COMBINATION             25320099
253300*---------------------------------------------------------------* 25330099
253400 S700-CHECK-PO-ENTRY.                                             25340099
253500                                                                  25350099
253600      EXEC SQL                                                    25360099
253700         SELECT '1'                                               25370099
253800           INTO  :PV-ONE                                          25380099
253900           FROM SYSIBM.SYSDUMMY1 X                                25390099
254000           WHERE EXISTS                                           25400099
254100              (SELECT 1                                           25410099
254200                FROM TIMCSPO A,                                   25420099
254300                     TIMCSEN B                                    25430099
254400                WHERE A.PO_NBR = :IMCSPO-PO-NBR                   25440099
254500                  AND B.CSTM_ENTR_ID = :IMCSEN-CSTM-ENTR-ID       25450099
254600                  AND A.CSTM_ENTR_ID = B.CSTM_ENTR_ID             25460099
254700                  AND X.IBMREQD = X.IBMREQD)                      25470099
254800      END-EXEC                                                    25480099
254900                                                                  25490099
255000      EVALUATE TRUE                                               25500099
255100         WHEN SQLCODE = ZERO                                      25510099
255200             SET PS-PO-ENTRY-FND TO TRUE                          25520099
255300         WHEN SQLCODE = +100                                      25530099
255400             SET PS-PO-ENTRY-NOT-FND TO TRUE                      25540099
255500         WHEN SQLWARN0 NOT = SPACES                               25550099
255600         WHEN SQLCODE  NOT = ZERO                                 25560099
255700             MOVE 'S700-CHECK-PO-ENTRY           '                25570099
255800                                        TO WS-ABEND-PARAGRAPH     25580099
255900             MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                  25590099
256000                                        TO WS-ABEND-OPERATION     25600099
256100             MOVE 'TIMCSPO ' TO WS-ABEND-STRUCTURE-1              25610099
256200             MOVE 'TIMCSEN ' TO WS-ABEND-STRUCTURE-2              25620099
256300             PERFORM Z999-SQL-ERROR                               25630099
256400      END-EVALUATE.                                               25640099
256500                                                                  25650099
256600*---------------------------------------------------------------* 25660099
256700* WRITE OUT A RECORD TO THE AUDIT FILE.                           25670099
256800*---------------------------------------------------------------* 25680099
256900 W100-WRITE-AUDIT-RECORD.                                         25690099
257000                                                                  25700099
257100     WRITE AUDIT-EDI-RECORD.                                      25710099
257200                                                                  25720099
257300     ADD 1 TO WS-AUDIT-COUNT.                                     25730099
257400                                                                  25740099
257500 EJECT                                                            25750099
257600*---------------------------------------------------------------* 25760099
257700* WRITE OUT A RECORD TO THE REJECT FILE.                          25770099
257800*---------------------------------------------------------------* 25780099
257900 W200-WRITE-REJECT-RECORD.                                        25790099
258000                                                                  25800099
258100     WRITE REJECT-EDI-RECORD FROM AP018-REJECT-IMPORT-INVOICE.    25810099
258200     INITIALIZE AP018-REJECT-IMPORT-INVOICE.                      25820099
258300                                                                  25830099
258400     ADD 1 TO WS-REJECT-COUNT.                                    25840099
258500                                                                  25850099
258600 EJECT                                                            25860099
258700*---------------------------------------------------------------* 25870099
258800* WRITE OUT A RECORD TO THE RECYCLE FILE.                         25880099
258900*---------------------------------------------------------------* 25890099
259000 W300-WRITE-RECYCLE-RECORD.                                       25900099
259100                                                                  25910099
259200     WRITE RECYCLE-EDI-RECORD.                                    25920099
259300                                                                  25930099
259400     ADD 1 TO WS-RECYCLE-COUNT.                                   25940099
259500                                                                  25950099
259600 EJECT                                                            25960099
259700*----------------------------------------------------------------*25970099
259800* Z998-ABEND                                                     *25980099
259900*  ABEND ROUTINE.                                                *25990099
260000*----------------------------------------------------------------*26000099
260100 Z998-ABEND.                                                      26010099
260200                                                                  26020099
260300     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 26030099
260400     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               26040099
260500     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               26050099
260600                                                                  26060099
260700     CALL 'ILBOABN0' USING ABEND-CODE.                            26070099
260800*---------------------------------------------------------------* 26080099
260900* PROCESS DB2 ABENDS.                                             26090099
261000*---------------------------------------------------------------* 26100099
261100 Z999-SQL-ERROR.                                                  26110099
261200                                                                  26120099
261300     DISPLAY '*** DB2 ERROR '.                                    26130099
261400     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 26140099
261500     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               26150099
261600     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               26160099
261700     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             26170099
261800     IF WS-ABEND-STRUCTURE-2 > SPACES                             26180099
261900         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         26190099
262000                                                                  26200099
262100     MOVE +4013                    TO ABEND-CODE.                 26210099
262200                                                                  26220099
262300     COPY DPPD004.                                                26230099
262400     CALL 'ILBOABN0' USING ABEND-CODE.                            26240099
