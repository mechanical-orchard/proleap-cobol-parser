000100 IDENTIFICATION DIVISION.                                         00010000
000120 PROGRAM-ID.    PXKUP019.                                         00011000
000130 AUTHOR.        JOYCE KNOKE.                                      00012000
000140 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00013000
000150 DATE-WRITTEN.  DECEMBER 2006.                                    00014000
000160 DATE-COMPILED.                                                   00015000
000170***************************************************************** 00016000
000180* THIS PROGRAM IS THE MAINTENANCE PROGRAM,FOR THE PXT_MOS_SKU_STR 00017000
000190* DB2 TABLE. IT ADDS OUT NEW EVENTS AND DELETES THOSE EVENTS WHICH00018000
000200* ARE NOT ACTIVE.                                                 00019000
000170***************************************************************** 00020000
000180* REMOVED OLD CHECKPOINT/RESTART PROCESSING BECAUSE IT WAS NOT    00021000
000190* WORKING CORRECTLY.  ADDED NEW CHECKPOINT/RESTART PROCESSING.    00022000
000190* 10/2009 DEANNA BRANTNER                                         00023000
000300***************************************************************** 00024000
003000*========================== CHANGE LOG ===========================00024101
003100*  CHANGE         BY          DATE     DESCRIPTION                00024201
003200*=================================================================00024301
260107* CHG0260107   JIM HUNTER   08-16-21   ADD COPYBOOK DPWS991 TO    00024601
260107*                                      MAKE DPKUT901 CALL DYNAMIC.00024701
003500******************************************************************00024801
000400 ENVIRONMENT DIVISION.                                            00025000
000600 CONFIGURATION SECTION.                                           00026000
       SOURCE-COMPUTER.        IBM-3090.                                00027000
       OBJECT-COMPUTER.        IBM-3090.                                00028000
       INPUT-OUTPUT SECTION.                                            00029000
                                                                        00030000
001600 DATA DIVISION.                                                   00040000
001800 FILE SECTION.                                                    00050000
001900                                                                  00060000
002600****************************************************************  00070000
002700 WORKING-STORAGE SECTION.                                         00080000
002800****************************************************************  00090000
003100 01  PA-PROGRAM-ACCUMULATORS.                                     00100000
003200     05  PA-TOT-SKU-RECS-READ         PIC 9(13) VALUE ZEROS.      00110000
003300     05  PA-TOT-SKU-DELETED           PIC 9(13) VALUE ZEROS.      00120000
003400     05  PA-TOT-SKU-ADDED             PIC 9(13) VALUE ZEROS.      00130000
003500     05  PA-TOT-SKU-UPDATED           PIC 9(13) VALUE ZEROS.      00140000
003600                                                                  00150000
003700****************************************************************  00160000
003800**PROGRAM VARIABLES.                                              00170000
003900****************************************************************  00180000
004000 01  PV-PROGRAM-VARIABLES.                                        00190000
004100     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00200000
004200     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     00210000
004300     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     00220000
004400     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACE.     00230000
004600     05  PV-EVENT-DATE                PIC  X(10) VALUE SPACE.     00240000
004700     05  PV-SQL-SUB                   PIC S9(04) COMP             00250000
004800                                                 VALUE +0.        00260000
004900     05  PV-SAVE-SKU-NBR              PIC S9(08) COMP-3           00270000
005000                                                 VALUE +0.        00280000
005500     05  PV-CURRENT-TIMESTAMP         PIC  X(26) VALUE SPACES.    00290000
005600     05  PV-SKU                       PIC S9(08) COMP-3           00300000
005700                                                 VALUE +0.        00310000
005800     05  PV-STR                       PIC S9(04) COMP             00320000
005900                                                 VALUE +0.        00330000
006000                                                                  00340000
006100****************************************************************  00350000
006200**PROGRAM SWITCHES.                                               00360000
006201*****-**********************************************************  00370000
006202 01  PS-PROGRAM-SWITCHES.                                         00380000
006203     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00390000
006204         88 PS-END-OF-FILE-N                     VALUE 'N'.       00400000
006205         88 PS-END-OF-FILE-Y                     VALUE 'Y'.       00410000
           05  PS-RESTART-REQUIRED-SW       PIC X(01)  VALUE 'N'.       00420000
               88  PS-RESTART-REQUIRED                 VALUE 'Y'.       00430000
               88  PS-RESTART-NOT-REQUIRED             VALUE 'N'.       00440000
006210                                                                  00450000
006220****************************************************************  00460000
006230**PROGRAM CONSTANTS.                                              00470000
006240****************************************************************  00480000
006280 01  PC-PROGRAM-CONSTANTS.                                        00490000
006290     05  PC-JOB-NAME                  PIC  X(07) VALUE 'PXK049'.  00500000
           05  PC-CKPT-JOB-NAME        PIC  X(06)  VALUE 'PXK049'.      00510000
           05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'PXKUP019'.    00520000
           05  PC-CKPT-PLAN-NAME       PIC  X(08)  VALUE 'PXKUP019'.    00530000
           05  PC-CURRENT-PROGRAM-NAME PIC  X(08)  VALUE 'PXKUP019'.    00540000
           05  PC-MAX-RETRIES          PIC S9(03)  VALUE +3 COMP-3.     00550000
           05  PC-MAX-DEADLOCKS        PIC S9(03)  VALUE +3 COMP-3.     00560000
           05  PC-TRAN-PRES-FUNC-CODES.                                 00570000
               10  PC-TRAN-PRES-FUNC-OPEN   PIC  X(05)  VALUE 'OPEN '.  00580000
               10  PC-TRAN-PRES-FUNC-CKPT   PIC  X(05)  VALUE 'CKPT '.  00590000
               10  PC-TRAN-PRES-FUNC-TRANS  PIC  X(05)  VALUE 'TRANS'.  00600000
               10  PC-TRAN-PRES-FUNC-RSTRT  PIC  X(05)  VALUE 'RSTRT'.  00610000
               10  PC-TRAN-PRES-FUNC-CLOSE  PIC  X(05)  VALUE 'CLOSE'.  00620000
                                                                        00630000
007410******************************************************************00640000
007420**TIMESTAMP VARIABLES                                             00650000
007430******************************************************************00660000
007440 01 DF-DATE-FIELDS.                                               00670000
007450    05 DF-ACCEPT-DATE.                                            00680000
007460       10  DF-ACCEPT-YR                  PIC 9(02) VALUE ZEROS.   00690000
007470       10  DF-ACCEPT-MO                  PIC 9(02) VALUE ZEROS.   00700000
007500       10  DF-ACCEPT-DY                  PIC 9(02) VALUE ZEROS.   00710000
007600    05 DF-ACCEPT-DATE-FMT.                                        00720000
007700       10  FILLER                        PIC 9(02)  VALUE 20.     00730000
007800       10  DF-ACCEPT-FMT-YY              PIC 9(02)  VALUE ZEROS.  00740000
007900       10  FILLER                        PIC X(01)  VALUE '-'.    00750000
008000       10  DF-ACCEPT-FMT-MM              PIC 9(02)  VALUE ZEROS.  00760000
008100       10  FILLER                        PIC X(01)  VALUE '-'.    00770000
008200       10  DF-ACCEPT-FMT-DD              PIC 9(02)  VALUE ZEROS.  00780000
008300    05 DF-ACCEPT-DATE-FORMAT   REDEFINES   DF-ACCEPT-DATE-FMT     00790000
008400                                         PIC X(10).               00800000
008500                                                                  00810000
      *--------------------------------------------------------------*  00820000
      * ERROR HANDLING                                                  00830000
      *--------------------------------------------------------------*  00840000
       01  PV-MISC-ABEND-FIELDS.                                        00850000
           05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          00860000
           05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          00870000
           05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          00880000
                                                                        00890000
       01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    00900000
           88  ABEND-4013-DB2-ERROR              VALUE +4013.           00910000
                                                                        00950000
      *--------------------------------------------------------------*  00960000
      * PROGRAM COUNTERS                                                00970000
      *--------------------------------------------------------------*  00971000
       01  PV-PROGRAM-COUNTERS         COMP-3.                          00972000
           05  PV-NUMBER-OF-RETRIES     PIC 9(9) VALUE 0.               00973000
009709                                                                  00973100
009760************************************************************      00973200
009770* VALID MOS ITEMS                                                 00973300
009780************************************************************      00973400
009790     COPY PXRD032.                                                00973500
009800                                                                  00973600
010600***************************************************************** 00973700
010900*  ABEND ROUTINE INFORMATION                                      00973800
010910***************************************************************** 00973900
011000     COPY DPWS900.                                                00974000
011001                                                                  00975000
011002***************************************************************** 00976000
011100*  ABEND ROUTINE INFORMATION                                      00977000
011110***************************************************************** 00978000
011200     COPY DPWS004.                                                00979000
011300                                                                  00980000
011400************************************************************      00990000
011500* DB2 MESSAGE AREA                                                01000000
011600************************************************************      01010000
011700     COPY SQLCA2.                                                 01020000
011800                                                                  01030000
011900************************************************************      01040000
012000* DB2 COMMUNICATIONS AREA                                         01050000
012100************************************************************      01060000
012200     EXEC SQL                                                     01070000
012300       INCLUDE SQLCA                                              01080000
012400     END-EXEC.                                                    01090000
012500                                                                  01100000
012600************************************************************      01110000
012700* DB2 PXT_MOS_SKU_STR  (PXT00003)                                 01120000
012800************************************************************      01130000
012900     EXEC SQL                                                     01140000
013000       INCLUDE PXT00003                                           01150000
013100     END-EXEC.                                                    01160000
013200                                                                  01170000
      ******************************************************************01180000
      *  TRANSACTION PREPARATION MODULE COMMUNICATIONS AREA             01190000
      ******************************************************************01200000
260107     COPY DPWS991.                                                01201001
                                                                        01210001
           COPY DPLS001.                                                01211001
           05  WORK-STORAGE-PASSED.                                     01220000
      ******************************************************************01230000
      *PA - PROGRAM ACCUMULATORS                                        01240000
      ******************************************************************01250000
               10  PROGRAM-ACCUMULATORS.                                01260000
                   15  PA-ROWS-INSERTED PIC S9(11)           VALUE ZERO 01270000
                                                             COMP-3.    01280000
                                                                        01290000
016002****************************************************************  01300000
016003 PROCEDURE DIVISION.                                              01310000
016004******************************************************************01320000
016005 0000-MAINLINE.                                                   01330000
016006     PERFORM 1000-INITIALIZATION.                                 01340000
016007                                                                  01350000
           PERFORM 2000-PROCESS-INPUT-FILE UNTIL DP001-PREP-TRANS-EOF.  01360000
261402                                                                  01370000
           PERFORM 9999-WRAPUP.                                         01380000
                                                                        01390000
261406     STOP RUN.                                                    01400000
261407                                                                  01410000
      *--------------------------------------------------------------*  01420000
      * PREPARE CHECKPOINT RESTART TABLES FOR PROCESSING / RESTART      01430000
      *--------------------------------------------------------------*  01440000
       1000-INITIALIZATION.                                             01450000
           MOVE PC-TRAN-PRES-FUNC-OPEN TO DP001-FUNC-CODE.              01460000
                                                                        01470000
           PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      01480000
                                                                        01490000
263800     ACCEPT DF-ACCEPT-DATE FROM DATE.                             01500000
263900     MOVE DF-ACCEPT-YR          TO DF-ACCEPT-FMT-YY.              01510000
264000     MOVE DF-ACCEPT-MO          TO DF-ACCEPT-FMT-MM.              01520000
264100     MOVE DF-ACCEPT-DY          TO DF-ACCEPT-FMT-DD.              01530000
264101                                                                  01540000
264132****************************************************************  01550000
264133*     PROCESS INPUT FILE                                          01560000
264134****************************************************************  01570000
264135 2000-PROCESS-INPUT-FILE.                                         01580000
264137                                                                  01590000
           SET PS-RESTART-NOT-REQUIRED TO TRUE.                         01600000
264138     IF PX032-MOS-END-DATE = SPACES                               01610000
264142         PERFORM 2200-INSERT-MOS-ROW                              01620000
264150     ELSE                                                         01630000
264180         PERFORM 2400-UPDATE-FOR-DELETE                           01640000
264190     END-IF.                                                      01650000
264200                                                                  01660000
      *----------------------------------------------------------------*01670000
      *  IF A RESTART IS REQUIRED, ISSUE A RESTART CALL RATHER THAN A  *01680000
      *  TRANS CALL.  THIS WILL ALLOW PROCESSING TO RESUME WITH THE    *01690000
      *  FIRST TRANSACTION AFTER THE LAST COMMIT.                      *01700000
      *----------------------------------------------------------------*01710000
           IF PS-RESTART-REQUIRED                                       01720000
               MOVE PC-TRAN-PRES-FUNC-RSTRT TO DP001-FUNC-CODE          01730000
           ELSE                                                         01740000
               MOVE PC-TRAN-PRES-FUNC-TRANS TO DP001-FUNC-CODE          01750000
           END-IF.                                                      01760000
                                                                        01770000
           PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      01780000
           EVALUATE TRUE                                                01790000
              WHEN DP001-GOOD-RET-CODE                                  01800000
              WHEN DP001-CKPT-TAKEN                                     01810000
                  MOVE DP001-TRANS-RECORD    TO                         01820000
                    PX032-VALID-MOS-ITEMS                               01830000
              WHEN OTHER                                                01840000
                  DISPLAY '2000-PROCESS-DELETES '                       01850000
                  DISPLAY 'ERROR CALLING CHECKPOINT ROUTINE ON TRANS'   01860000
                  DISPLAY 'DP001-RET-CODE IS ' DP001-RET-CODE           01870000
                  PERFORM Z900-SQL-ABEND                                01880000
           END-EVALUATE.                                                01890000
                                                                        01900000
266030******************************************************************01910000
266040* INSERT PXT_MOS_SKU_STR ROW                                      01920000
266050******************************************************************01930000
266060 2200-INSERT-MOS-ROW.                                             01940000
266070     INITIALIZE DCLPXT00003.                                      01950000
266080                                                                  01960000
266090     PERFORM                                                      01970000
266100         WITH TEST AFTER                                          01980000
266200         VARYING PV-SQL-SUB                                       01990000
266300         FROM 1 BY 1                                              02000000
266400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 02010000
266500                   OR  SQLCODE = 0                                02020000
266600                   OR  SQLCODE = -803)                            02030000
266700                                                                  02040000
266800       EXEC SQL                                                   02050000
266900            INSERT INTO PXT_MOS_SKU_STR                           02060000
267000                   (SKU_NBR                                       02070000
267100                  , STR_NBR                                       02080000
267200                  , EFF_BEG_DTE                                   02090000
267500                  , LAST_UPD_DTE)                                 02100000
267600            VALUES (:PX032-SKU-NBR                                02110000
267700                  , :PX032-LOC-NBR                                02120000
267800                  , :PX032-MOS-EFF-DATE                           02130000
268100                  , :DF-ACCEPT-DATE-FORMAT)                       02140000
268200       END-EXEC                                                   02150000
268300                                                                  02160000
268400       EVALUATE TRUE                                              02170000
268500           WHEN SQLCODE = ZERO                                    02180000
268600             ADD 1 TO PA-TOT-SKU-ADDED                            02190000
268800           WHEN SQLCODE = -904                                    02200000
268900           WHEN SQLCODE = -911                                    02210000
269000           WHEN SQLCODE = -913                                    02220000
269100                CONTINUE                                          02230000
269200           WHEN SQLCODE = -803                                    02240000
269320             PERFORM 2300-UPDATE-MOS-ROW                          02250000
269400           WHEN SQLWARN0 NOT EQUAL SPACE                          02260000
269500           WHEN SQLCODE NOT EQUAL ZERO                            02270000
269600                DISPLAY '**********************************'      02280000
269700                DISPLAY 'SKU_NBR  = ' PX032-SKU-NBR               02290000
269800                DISPLAY 'LOC_NBR  = ' PX032-LOC-NBR               02300000
269900                DISPLAY '**********************************'      02310000
270000                MOVE '2200-INSERT-MOS-ROW'                        02320000
270100                  TO  PV-PARAGRAPH-NAME                           02330000
270200                MOVE 'INSERT PXT00003 ROW'                        02340000
270300                  TO  PV-DB2-OPERATION                            02350000
270400                PERFORM 9999-SQL-ABEND                            02360000
270500       END-EVALUATE                                               02370000
270600     END-PERFORM.                                                 02380000
271160                                                                  02390000
271170     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         02400000
271180         DISPLAY '**********************************'             02410000
271190         DISPLAY 'SKU_NBR  = ' PX032-SKU-NBR                      02420000
271200         DISPLAY 'LOC_NBR  = ' PX032-LOC-NBR                      02430000
271300         DISPLAY '**********************************'             02440000
271400         MOVE '2200-INSERT-MOS-ROW'                               02450000
271500           TO  PV-PARAGRAPH-NAME                                  02460000
271600         MOVE 'MAX RETRIES EXCEEDED'                              02470000
271700           TO  PV-DB2-OPERATION                                   02480000
271800         PERFORM 9999-SQL-ABEND                                   02490000
271900     END-IF.                                                      02500000
272000                                                                  02510000
272010******************************************************************02520000
272020* UPDATE PXT_MOS_SKU_STR ROW                                      02530000
272030******************************************************************02540000
272040 2300-UPDATE-MOS-ROW.                                             02550000
272050     INITIALIZE DCLPXT00003.                                      02560000
272060                                                                  02570000
272070     PERFORM                                                      02580000
272080         WITH TEST AFTER                                          02590000
272090         VARYING PV-SQL-SUB                                       02600000
272091         FROM 1 BY 1                                              02610000
272092         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 02620000
272093                   OR  SQLCODE = 0                                02630000
272094                   OR  SQLCODE = -803)                            02640000
272095                                                                  02650000
272096       EXEC SQL                                                   02660000
272097           UPDATE PXT_MOS_SKU_STR                                 02670000
272098              SET EFF_BEG_DTE     = :PX032-MOS-EFF-DATE           02680000
272099                 ,EFF_END_DTE     = NULL                          02690000
272100                 ,LAST_UPD_DTE    = :DF-ACCEPT-DATE-FORMAT        02700000
272101            WHERE SKU_NBR         = :PX032-SKU-NBR                02710000
272102              AND STR_NBR         = :PX032-LOC-NBR                02720000
272113       END-EXEC                                                   02730000
272114                                                                  02740000
272125       EVALUATE TRUE                                              02750000
272126           WHEN SQLCODE = ZERO                                    02760000
272127             ADD 1 TO PA-TOT-SKU-UPDATED                          02770000
272129           WHEN SQLCODE = -904                                    02780000
272130           WHEN SQLCODE = -911                                    02790000
272131           WHEN SQLCODE = -913                                    02800000
272132                CONTINUE                                          02810000
272135           WHEN SQLWARN0 NOT EQUAL SPACE                          02820000
272136           WHEN SQLCODE NOT EQUAL ZERO                            02830000
272137                DISPLAY '**********************************'      02840000
272138                DISPLAY 'SKU_NBR  = ' PX032-SKU-NBR               02850000
272139                DISPLAY 'LOC_NBR  = ' PX032-LOC-NBR               02860000
272140                DISPLAY '**********************************'      02870000
272141                MOVE '2300-UPDATE-MOS-ROW'                        02880000
272142                  TO  PV-PARAGRAPH-NAME                           02890000
272143                MOVE 'INSERT PXT00003 ROW'                        02900000
272144                  TO  PV-DB2-OPERATION                            02910000
272145                PERFORM 9999-SQL-ABEND                            02920000
272146       END-EVALUATE                                               02930000
272147     END-PERFORM.                                                 02940000
272148                                                                  02950000
272149     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         02960000
272150         DISPLAY '**********************************'             02970000
272151         DISPLAY 'SKU_NBR  = ' PX032-SKU-NBR                      02980000
272152         DISPLAY 'LOC_NBR  = ' PX032-LOC-NBR                      02990000
272153         DISPLAY '**********************************'             03000000
272154         MOVE '2300-UDPATE-MOS-ROW'                               03010000
272155           TO  PV-PARAGRAPH-NAME                                  03020000
272156         MOVE 'MAX RETRIES EXCEEDED'                              03030000
272157           TO  PV-DB2-OPERATION                                   03040000
272158         PERFORM 9999-SQL-ABEND                                   03050000
272159     END-IF.                                                      03060000
272160                                                                  03070000
272170******************************************************************03080000
272200* UPDATE PXT_MOS_SKU_STR ROW FOR DELETE STATUS                    03090000
272300******************************************************************03100000
272400 2400-UPDATE-FOR-DELETE.                                          03110000
272500     INITIALIZE DCLPXT00003.                                      03120000
272600                                                                  03130000
272700     PERFORM                                                      03140000
272800         WITH TEST AFTER                                          03150000
272900         VARYING PV-SQL-SUB                                       03160000
273000         FROM 1 BY 1                                              03170000
273100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03180000
273200                   OR  SQLCODE = 0)                               03190000
273300                                                                  03200000
273400       EXEC SQL                                                   03210000
273500           UPDATE PXT_MOS_SKU_STR                                 03220000
273700              SET EFF_END_DTE     = :PX032-MOS-END-DATE           03230000
273800                 ,LAST_UPD_DTE    = :DF-ACCEPT-DATE-FORMAT        03240000
273900            WHERE SKU_NBR         = :PX032-SKU-NBR                03250000
274000              AND STR_NBR         = :PX032-LOC-NBR                03260000
274100       END-EXEC                                                   03270000
274200                                                                  03280000
274300       EVALUATE TRUE                                              03290000
274400           WHEN SQLCODE = ZERO                                    03300000
274500             ADD 1 TO PA-TOT-SKU-DELETED                          03310000
274700           WHEN SQLCODE = -904                                    03320000
274800           WHEN SQLCODE = -911                                    03330000
274900           WHEN SQLCODE = -913                                    03340000
275000                CONTINUE                                          03350000
275100           WHEN SQLWARN0 NOT EQUAL SPACE                          03360000
275200           WHEN SQLCODE NOT EQUAL ZERO                            03370000
275300                DISPLAY '**********************************'      03380000
275400                DISPLAY 'SKU_NBR  = ' PX032-SKU-NBR               03390000
275500                DISPLAY 'LOC_NBR  = ' PX032-LOC-NBR               03400000
275600                DISPLAY '**********************************'      03410000
275700                MOVE '2400-UPDATE-FOR-DELETE'                     03420000
275800                  TO  PV-PARAGRAPH-NAME                           03430000
275900                MOVE 'UPDATE PXT00003'                            03440000
276000                  TO  PV-DB2-OPERATION                            03450000
276100                PERFORM 9999-SQL-ABEND                            03460000
276200       END-EVALUATE                                               03470000
276300     END-PERFORM.                                                 03480000
276400                                                                  03490000
276500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03500000
276600         DISPLAY '**********************************'             03510000
276700         DISPLAY 'SKU_NBR  = ' PX032-SKU-NBR                      03520000
276800         DISPLAY 'LOC_NBR  = ' PX032-LOC-NBR                      03530000
276900         DISPLAY '**********************************'             03540000
277000           MOVE '2400-UPDATE-FOR-DELETE'                          03550000
277100           TO  PV-PARAGRAPH-NAME                                  03560000
277200         MOVE 'MAX RETRIES EXCEEDED'                              03570000
277300           TO  PV-DB2-OPERATION                                   03580000
277400         PERFORM 9999-SQL-ABEND                                   03590000
277500     END-IF.                                                      03600000
277600                                                                  03610000
277601                                                                  03620000
298003******************************************************************03630000
298004*     SQL ABEND PARAGRAPH.                                        03640000
298005******************************************************************03650000
298006 9999-SQL-ABEND.                                                  03660000
298007     DISPLAY '** ABEND     **'.                                   03670000
298008     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                03680000
298009     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03690000
298010     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               03700000
298011                                                                  03710000
298016     COPY DPPD004.                                                03720000
           SET ABEND-4013-DB2-ERROR TO TRUE.                            03730000
298018     CALL 'ILBOABN0' USING ABEND-CODE.                            03740000
                                                                        03750000
      *--------------------------------------------------------------*  03760000
      * 9999-WRAPUP.                                                    03770000
      *     END OF PROGRAM ROUTINE.  RESET STATUS CODE AND DISPLAYS     03780000
      *     DATA COUNTS FROM THE PROGRAM.                               03790000
      *--------------------------------------------------------------*  03800000
       9999-WRAPUP.                                                     03810000
                                                                        03820000
297930     DISPLAY ' '.                                                 03830000
297940     DISPLAY '*********************************************'.     03840000
297950     DISPLAY '    PXKUP019 SUMMARY STATISTICS              '      03850000
297960     DISPLAY '*********************************************'.     03860000
297980     DISPLAY 'SKU RECORDS TO BE DELETED.: ' PA-TOT-SKU-DELETED    03870000
297990     DISPLAY 'SKU RECORDS UPDATED.......: ' PA-TOT-SKU-UPDATED    03880000
298000     DISPLAY 'SKU RECORDS ADDED.........: ' PA-TOT-SKU-ADDED      03890000
298001     DISPLAY '*********************************************'.     03900000
298002                                                                  03910000
           MOVE PC-TRAN-PRES-FUNC-CLOSE TO DP001-FUNC-CODE.             03920000
           PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      03930000
                                                                        03940000
      ******************************************************************03950000
      *     Z100-BUILD-COMM-AREA-TRAN-PRES                             *03960000
      *     - BUILD THE COMMUNICATION AREA FOR A CALL TO THE           *03970000
      *       TRANSACTION PRESENTATION MODULE.                         *03980000
      ******************************************************************03990000
       Z100-BUILD-COMM-AREA-TRAN-PRES.                                  04000000
                                                                        04010000
           MOVE LENGTH OF WORK-STORAGE-PASSED                           04020000
                                             TO DP001-WORK-STRG-LENGTH. 04030000
           MOVE PC-CKPT-JOB-NAME             TO DP001-JOB-NAME.         04040000
           MOVE PC-CKPT-PLAN-NAME            TO DP001-PLAN-NAME.        04050000
           PERFORM Z900-CALL-TRANS-PRES-MODULE.                         04060000
           IF DP001-GOOD-RET-CODE                                       04070000
                   OR DP001-CKPT-TAKEN                                  04080000
                   OR DP001-RESTART                                     04090000
               MOVE DP001-TRANS-RECORD TO  PX032-VALID-MOS-ITEMS        04100000
           ELSE                                                         04110000
               DISPLAY 'Z100-BUILD-COMM-AREA-TRAN-PRES '                04120000
               DISPLAY 'ERROR CALLING CHECKPOINT ROUTINE ON '           04130000
                   DP001-FUNC-CODE                                      04140000
               DISPLAY 'DP001-RET-CODE IS ' DP001-RET-CODE              04150000
               PERFORM Z900-SQL-ABEND                                   04160000
           END-IF.                                                      04170000
                                                                        04180000
      ******************************************************************04190000
      *  ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING    *04200000
      *  CODE OCCURS.                                                  *04210000
      ******************************************************************04220000
       Z900-SQL-ABEND.                                                  04230000
                                                                        04240000
           DISPLAY '** ABEND     **'.                                   04250000
           DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04260000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04270000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04280000
                                                                        04290000
      ******************************************************************04300000
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-  *04310000
      *  MENTS THAT ARE REQUIRED TO INVOKE THE TRANSACTION PRESENTATION*04320000
      *  MODULE (DPKUT901) OF THE DB2 CHECKPOINT RESTART SYSTEM.       *04330000
      ******************************************************************04340000
           COPY DPPD001.                                                04350000
