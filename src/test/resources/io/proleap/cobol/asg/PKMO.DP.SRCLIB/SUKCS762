000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKCS762.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            MARCH, 2004.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  MODULE TO AUTOMATICALLY ADJUST SYSTEM PROMPTED AUDITS IF     * 00120000
001300*  LESS THEN THE NUMBER OF CARTONS EXPECTED WERE RECEIVED       * 00130000
001400***************************************************************** 00140000
001410*                                                               * 00141000
001411*  COMMUNICATION AREA - SUWS047                                 * 00141100
001412*  - REQUIRED FIELDS FROM CALLING PROGRAM:                      * 00141200
001413*       - SU047-PO-NBR                                          * 00141300
001414*       - SU047-REC-SEQ-NBR                                     * 00141400
001415*       - SU047-PKGNG-CDE - OR - SU047-PBS-IND                  * 00141500
001416*                                                               * 00141600
001417*  - OPTIONAL FIELDS FROM CALLING PROGRAM:                      * 00141700
001418*       - SU047-PO-LNE-NBR (ONLY IF FOR A SPECIFIC LINE)        * 00141800
001419*       - SU047-PREPACK-ID (ONLY IF FOR A SPECIFIC PREPACK)     * 00141900
001420*                                                               * 00142000
001430***************************************************************** 00143000
001440                                                                  00144000
001450******************************************************************00145000
001460 ENVIRONMENT DIVISION.                                            00146000
001470******************************************************************00147000
001480                                                                  00148000
001490******************************************************************00149000
001500 DATA DIVISION.                                                   00150000
001600******************************************************************00160000
001700                                                                  00170000
001800******************************************************************00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000******************************************************************00200000
002100                                                                  00210007
002200*----------------------------------------------------------------*00220000
002300* COMMAREA USED TO PAS DATA TO AND FROM SUKCS594                  00230000
002400*----------------------------------------------------------------*00240000
002500 01  CA-SUMMARY-COMMAREA.                                         00250000
002600     COPY SUWS026.                                                00260000
002700                                                                  00270000
002800 01  DK-DB2-KEYS.                                                 00280000
002900     05  DK-OPER-UNT-ID            PIC S9(04) COMP.               00290000
003000     05  DK-FCLTY-ID               PIC S9(04) COMP.               00300000
003100     05  DK-PO-NBR                 PIC S9(09) COMP SYNC.          00310000
003200     05  DK-REC-SEQ-NBR            PIC S9(04) COMP SYNC.          00320000
003300     05  DK-BEGIN-LNE-NBR          PIC S9(04) COMP SYNC.          00330000
003400     05  DK-END-LNE-NBR            PIC S9(04) COMP SYNC.          00340000
003500     05  DK-BEGIN-PREPK-ID         PIC S9(04) COMP SYNC.          00350000
003600     05  DK-END-PREPK-ID           PIC S9(04) COMP SYNC.          00360000
003700     05  DK-INBND-TRIP-ID          PIC S9(09) COMP SYNC.          00370000
003800                                                                  00380000
003900 01  PC-PROGRAM-CONSTANTS.                                        00390000
004000     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               00400000
004100                                  '9999-09-09-09.09.09.999999'.   00410000
004200     05  PC-SUKCS594               PIC X(08)  VALUE 'SUKCS594'.   00420000
004210     05  PC-SUKCS763               PIC X(08)  VALUE 'SUKCS763'.   00421000
004211     05  PC-SUKCS769               PIC X(08)  VALUE 'SUKCS769'.   00421103
004220                                                                  00422000
004230                                                                  00423000
004240 01  PS-PROGRAM-SWITCHES.                                         00424000
004250     05  PS-ERROR-SW                    PIC  X(01)  VALUE  'N'.   00425000
004260         88  PS-NO-ERROR                            VALUE  'N'.   00426000
004270         88  PS-ERROR                               VALUE  'Y'.   00427000
004280     05  PS-EOF-CURSOR-SW               PIC  X(01)   VALUE 'N'.   00428000
004290         88  PS-EOF-CURSOR-YES                       VALUE 'Y'.   00429000
004300         88  PS-EOF-CURSOR-NO                        VALUE 'N'.   00430000
004400     05  PS-CURSOR-SW                   PIC  X(02)   VALUE '  '.  00440000
004500         88  PS-BULK-CASE-CSR                        VALUE 'BC'.  00450000
004600         88  PS-PREPACK-CSR                          VALUE 'PP'.  00460000
004700         88  PS-PACK-BY-STORE-CSR                    VALUE 'PS'.  00470000
004800                                                                  00480000
004900                                                                  00490000
005000 01  PV-PROGRAM-VARIABLES.                                        00500000
005100     05  PV-DISP-PO-NBR                  PIC  9(09).              00510000
005200     05  PV-DISP-RCVR-SEQ-NBR            PIC  9(04).              00520000
005300     05  PV-DISP-PREPK-ID                PIC  9(04).              00530000
005400     05  PV-DISP-PO-LINE-NBR             PIC  9(04).              00540000
005500     05  PV-DISP-OPER-UNT-ID             PIC  9(04).              00550000
005600     05  PV-DISP-AUDIT-CNTL-NBR          PIC  9(09).              00560000
005700     05  PV-DISP-SQLCODE                 PIC -9(05) VALUE ZEROES. 00570000
005800                                                                  00580000
005900     05  PV-PROMPT-CARTONS               PIC S9(09)  COMP.        00590000
006000     05  PV-CARTONS-NOT-AUDITED          PIC S9(09)  COMP.        00600000
006100     05  PV-UNITS-TO-BE-AUDITED          PIC S9(09)  COMP.        00610000
006200                                                                  00620000
006300     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00630000
006400                                                     COMP SYNC.   00640000
006500     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     00650000
006600                                                     COMP SYNC.   00660000
006700     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00670000
006800                                                                  00680000
006900*----------------------------------------------------------------*00690000
006901* COMMAREA USED TO PASS DATA TO AND FROM SUKCS763                 00690100
006902*----------------------------------------------------------------*00690200
006903     COPY SUWS047.                                                00690300
006904                                                                  00690400
006905*----------------------------------------------------------------*00690503
006906* COMMAREA USED TO PASS DATA TO AND FROM SUKCS769                 00690603
006907* COMMON CARTON CLOSE MODULE FOR SENDING DIRECTIVES               00690703
006908*----------------------------------------------------------------*00690803
006909     COPY SUWS091.                                                00690903
006910                                                                  00691003
006911*----------------------------------------------------------------*00691103
006912*  SQL AND COBOL DECLARATIONS FOR THE SUT_PO_AUD_REQ (SUT00015)  *00691203
006913*----------------------------------------------------------------*00691303
006914     EXEC SQL                                                     00691403
006915          INCLUDE SUT00015                                        00691503
006916     END-EXEC.                                                    00691603
006920                                                                  00692000
006930     EXEC SQL                                                     00693000
006940          INCLUDE TKRPRPM                                         00694000
006950     END-EXEC.                                                    00695000
006960                                                                  00696000
006970*----------------------------------------------------------------*00697000
006980*  SQL AND COBOL DECLARATIONS FOR THE AUDIT CARTONS  (TSUATRN)   *00698000
006990*----------------------------------------------------------------*00699000
007000     EXEC SQL                                                     00700000
007100          INCLUDE TSUATRN                                         00710000
007200     END-EXEC.                                                    00720000
007300                                                                  00730000
007400*----------------------------------------------------------------*00740000
007500*  SQL AND COBOL DECLARATIONS FOR PROMPTED UNITS     (TSHUUPC)   *00750000
007600*----------------------------------------------------------------*00760000
007700     EXEC SQL                                                     00770000
007800          INCLUDE TSHUUPC                                         00780000
007900     END-EXEC.                                                    00790000
008000                                                                  00800000
008100*----------------------------------------------------------------*00810000
008200*  COMMUNICATIONS AREA FOR DB2                                    00820000
008300*----------------------------------------------------------------*00830000
008400     EXEC SQL                                                     00840000
008500         INCLUDE SQLCA                                            00850000
008600     END-EXEC.                                                    00860000
008700                                                                  00870000
008800*----------------------------------------------------------------*00880000
008900*  CURSOR FOR BULK/CASE ORDER                                    *00890000
009000*----------------------------------------------------------------*00900000
009100     EXEC SQL                                                     00910000
009200       DECLARE BULK-CASE-CSR CURSOR FOR                           00920000
009300         SELECT OPER_UNT_ID                                       00930000
009400              , PO_NBR                                            00940000
009500              , PO_LNE_NBR                                        00950000
009600              , PO_PREPK_ID                                       00960000
009700              , INBND_TRIP_ID                                     00970000
009800              , AUD_CNTL_NBR                                      00980000
009900              , CART_QTY                                          00990000
010000              , UNT_QTY                                           01000000
010100              , AUD_CART_QTY                                      01010000
010200              , AUD_UNT_QTY                                       01020000
010300              , AUD_STAT_CDE                                      01030000
010400              , CART_PRMPT_CDE                                    01040000
010500              , PKGNG_TYP_CDE                                     01050000
010600              , AUD_STAT_RSN_CDE                                  01060000
010700              , MOD_QTY_IND                                       01070000
010800          FROM  SUT_PO_AUD_REQ                                    01080000
010900          WHERE CART_PRMPT_CDE      = 'C'                         01090000
011000            AND AUD_STAT_CDE        = 'I'                         01100000
011100            AND PO_NBR              = :DK-PO-NBR                  01110000
011200            AND RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR             01120000
011300            AND (PO_LNE_NBR        >= :DK-BEGIN-LNE-NBR           01130000
011400            AND  PO_LNE_NBR        <= :DK-END-LNE-NBR)            01140000
011500            AND PKGNG_TYP_CDE       = 'BC'                        01150000
011600     END-EXEC.                                                    01160000
011700                                                                  01170000
011800*----------------------------------------------------------------*01180000
011900*  CURSOR FOR PREPACK ORDER                                      *01190000
012000*----------------------------------------------------------------*01200000
012100     EXEC SQL                                                     01210000
012200       DECLARE PREPK-CSR CURSOR FOR                               01220000
012300         SELECT OPER_UNT_ID                                       01230000
012400              , PO_NBR                                            01240000
012500              , PO_LNE_NBR                                        01250000
012600              , PO_PREPK_ID                                       01260000
012700              , INBND_TRIP_ID                                     01270000
012800              , AUD_CNTL_NBR                                      01280000
012900              , CART_QTY                                          01290000
013000              , UNT_QTY                                           01300000
013100              , AUD_CART_QTY                                      01310000
013200              , AUD_UNT_QTY                                       01320000
013300              , AUD_STAT_CDE                                      01330000
013400              , CART_PRMPT_CDE                                    01340000
013500              , PKGNG_TYP_CDE                                     01350000
013600              , AUD_STAT_RSN_CDE                                  01360000
013700              , MOD_QTY_IND                                       01370000
013800          FROM  SUT_PO_AUD_REQ                                    01380000
013900          WHERE CART_PRMPT_CDE      = 'C'                         01390000
014000            AND AUD_STAT_CDE        = 'I'                         01400000
014100            AND PO_NBR              = :DK-PO-NBR                  01410000
014200            AND RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR             01420000
014300            AND (PO_PREPK_ID       >= :DK-BEGIN-PREPK-ID          01430000
014400            AND  PO_PREPK_ID       <= :DK-END-PREPK-ID)           01440000
014500            AND PKGNG_TYP_CDE       = 'PP'                        01450000
014600     END-EXEC.                                                    01460000
014700                                                                  01470000
014800*----------------------------------------------------------------*01480000
014900*  CURSOR FOR PACK-BY-STORE CURSOR                               *01490000
015000*----------------------------------------------------------------*01500000
015100     EXEC SQL                                                     01510000
015200       DECLARE PACK-BY-STORE-CSR CURSOR FOR                       01520000
015300         SELECT OPER_UNT_ID                                       01530000
015400              , PO_NBR                                            01540000
015500              , PO_LNE_NBR                                        01550000
015600              , PO_PREPK_ID                                       01560000
015700              , INBND_TRIP_ID                                     01570000
015800              , AUD_CNTL_NBR                                      01580000
015900              , CART_QTY                                          01590000
016000              , UNT_QTY                                           01600000
016100              , AUD_CART_QTY                                      01610000
016200              , AUD_UNT_QTY                                       01620000
016300              , AUD_STAT_CDE                                      01630000
016400              , CART_PRMPT_CDE                                    01640000
016500              , PKGNG_TYP_CDE                                     01650000
016600              , AUD_STAT_RSN_CDE                                  01660000
016700              , MOD_QTY_IND                                       01670000
016800          FROM  SUT_PO_AUD_REQ                                    01680000
016900          WHERE CART_PRMPT_CDE      = 'C'                         01690000
017000            AND AUD_STAT_CDE        = 'I'                         01700000
017100            AND PO_NBR              = :DK-PO-NBR                  01710000
017200            AND RCVR_SEQ_NBR        = :DK-REC-SEQ-NBR             01720000
017300            AND PKGNG_TYP_CDE      IN ('PS','RF')                 01730010
017400     END-EXEC.                                                    01740000
017500                                                                  01750000
017600*-----------------------------------------------------------------01760000
017700 LINKAGE SECTION.                                                 01770000
017800 01  DFHCOMMAREA.                                                 01780000
017900     05  FILLER                       OCCURS 1 TO 4072 TIMES      01790000
018000                                      DEPENDING ON EIBCALEN.      01800000
018100         10  FILLER                   PIC X.                      01810000
018200                                                                  01820000
018300*-----------------------------------------------------------------01830000
018400                                                                  01840000
018500*-----------------------------------------------------------------01850000
018600 PROCEDURE DIVISION.                                              01860000
018700                                                                  01870000
018800     SET  SU047-SUCCESSFUL  TO  TRUE.                             01880000
018900                                                                  01890000
019000     MOVE DFHCOMMAREA              TO  SU047-COMMAREA-REC.        01900000
019100                                                                  01910000
019200     MOVE SU047-OPER-UNT-ID        TO  DK-OPER-UNT-ID.            01920000
019300                                                                  01930000
019400     PERFORM 9300-CHECK-LOGGING.                                  01940000
019500                                                                  01950000
019600     IF KRPRPM-FUNC-TXT = 'Y'                                     01960000
019700         MOVE SU047-PO-NBR    TO     PV-DISP-PO-NBR               01970000
019800         MOVE SU047-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR         01980000
019900         STRING   ' SUKCS762-START'                               01990000
020000                  ' CALLED BY-'                                   02000000
020100                  SU047-CALLING-PROGRAM                           02010000
020200                  ' PO='                                          02020000
020300                  PV-DISP-PO-NBR                                  02030000
020400                  ' RCVR='                                        02040000
020500                  PV-DISP-RCVR-SEQ-NBR                            02050000
020600                  DELIMITED BY SIZE                               02060000
020700                              INTO PV-CICS-MSG-AREA               02070000
020800         PERFORM 9200-WRITE-TO-CICS-LOG                           02080000
020900     END-IF.                                                      02090000
020910                                                                  02091000
020920                                                                  02092000
020930     PERFORM 0000-PROGRAM-MAINLINE.                               02093000
020940                                                                  02094000
020950                                                                  02095000
020960*-----------------------------------------------------------------02096000
020970 0000-PROGRAM-MAINLINE.                                           02097000
020980                                                                  02098000
020990     INITIALIZE PV-PROGRAM-VARIABLES.                             02099000
021000     SET PS-NO-ERROR                                              02100000
021100         PS-EOF-CURSOR-NO  TO  TRUE.                              02110000
021200                                                                  02120000
021300     PERFORM 4000-PREPARE-CURSOR.                                 02130000
021400                                                                  02140000
021500     IF  PS-ERROR  OR                                             02150000
021600         PS-EOF-CURSOR-YES                                        02160000
021700         CONTINUE                                                 02170000
021800     ELSE                                                         02180000
021900         PERFORM 2000-PROCESS-CURSOR                              02190000
022000           UNTIL  PS-ERROR   OR                                   02200000
022100                  PS-EOF-CURSOR-YES                               02210000
022200     END-IF.                                                      02220000
022300                                                                  02230000
022400     PERFORM 4030-CLOSE-CURSOR.                                   02240000
022500                                                                  02250000
022600     PERFORM 9998-RETURN.                                         02260000
022700                                                                  02270000
022800                                                                  02280000
022900*-----------------------------------------------------------------02290000
023000*                                                                 02300000
023100*-----------------------------------------------------------------02310000
023200 2000-PROCESS-CURSOR.                                             02320000
023300                                                                  02330000
023400     MOVE  ZEROES  TO  PV-PROMPT-CARTONS                          02340000
023500                       PV-CARTONS-NOT-AUDITED                     02350000
023600                       PV-UNITS-TO-BE-AUDITED.                    02360000
023700                                                                  02370000
023800     PERFORM 2010-COUNT-PROMPT-CRTNS.                             02380000
023900                                                                  02390000
024000     IF  PS-NO-ERROR                                              02400000
024100         PERFORM 2020-COUNT-CRTNS-NOT-AUDITED                     02410000
024200     END-IF.                                                      02420000
024300                                                                  02430000
024400     IF  PS-NO-ERROR                                              02440000
024500         PERFORM 2030-SUM-UNITS-PROMPTED                          02450000
024600     END-IF.                                                      02460000
024700                                                                  02470000
024800     IF  PS-NO-ERROR                                              02480000
024900         MOVE  PV-PROMPT-CARTONS  TO  SUT00015-CART-QTY           02490000
025000         IF  SU047-BULK-CASE  OR                                  02500000
025100             SU047-PREPACK                                        02510000
025200             IF  SUT00015-UNT-QTY  >  PV-UNITS-TO-BE-AUDITED      02520000
025300                 MOVE  PV-UNITS-TO-BE-AUDITED                     02530000
025400                                  TO  SUT00015-UNT-QTY            02540000
025500             END-IF                                               02550000
025600         END-IF                                                   02560000
025700     END-IF.                                                      02570000
025800                                                                  02580000
025900     IF  PS-NO-ERROR                                              02590000
026000         PERFORM 3000-UPDATE-SYSTEM-AUDIT                         02600000
026100     END-IF.                                                      02610000
026200                                                                  02620000
026300     IF  PS-NO-ERROR                                              02630000
026400         IF  PV-CARTONS-NOT-AUDITED  >  0                         02640000
026500             CONTINUE                                             02650000
026600         ELSE                                                     02660000
026700             PERFORM 3010-CALL-AUDIT-STAT-CALC                    02670000
026701             IF  PS-NO-ERROR                                      02670106
026710                 PERFORM 3100-LINK-COMMON-CRTN-CLOSE              02671006
026720             END-IF                                               02672006
026800         END-IF                                                   02680000
026900     END-IF.                                                      02690000
027000                                                                  02700000
027100     IF  PS-NO-ERROR                                              02710000
027200         PERFORM 4020-FETCH-CURSOR                                02720000
027300     END-IF.                                                      02730000
027400                                                                  02740000
027500                                                                  02750000
027600*-----------------------------------------------------------------02760000
027700* COUNT THE NUMBER OF CARTONS THAT HAVE BEEN PROMPTED FOR THIS    02770000
027800* AUDIT                                                           02780000
027900*-----------------------------------------------------------------02790000
028000 2010-COUNT-PROMPT-CRTNS.                                         02800000
028100                                                                  02810000
028200     EXEC SQL                                                     02820000
028300          SELECT COUNT(*)                                         02830000
028400            INTO :PV-PROMPT-CARTONS                               02840000
028500            FROM TSUATRN                                          02850000
028600           WHERE AUD_CNTL_NBR  =  :SUT00015-AUD-CNTL-NBR          02860000
028700     END-EXEC.                                                    02870000
028800                                                                  02880000
028900     EVALUATE TRUE                                                02890000
029000         WHEN SQLCODE = ZERO                                      02900000
029100              CONTINUE                                            02910000
029200                                                                  02920000
029300         WHEN SQLCODE = -904                                      02930000
029400         WHEN SQLCODE = -911                                      02940000
029500         WHEN SQLCODE = -913                                      02950000
029600             SET  PS-ERROR             TO TRUE                    02960000
029700             SET  SU047-DATABASE-BUSY  TO TRUE                    02970000
029800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          02980000
029900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    02990000
030000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     03000000
030100             MOVE SUT00015-AUD-CNTL-NBR                           03010000
030200                                       TO PV-DISP-AUDIT-CNTL-NBR  03020000
030300             MOVE SQLCODE              TO PV-DISP-SQLCODE         03030000
030400             STRING   ' SUKCS762-2010-'                           03040000
030500                      ' CALLED BY-'                               03050000
030600                      SU047-CALLING-PROGRAM                       03060000
030700                      ' PO='                                      03070000
030800                      PV-DISP-PO-NBR '-'                          03080000
030900                      PV-DISP-RCVR-SEQ-NBR '-'                    03090000
031000                      PV-DISP-PO-LINE-NBR                         03100000
031100                      ' AUDIT='                                   03110000
031200                      PV-DISP-AUDIT-CNTL-NBR                      03120000
031300                      ' SQLCODE='                                 03130000
031400                      PV-DISP-SQLCODE                             03140000
031500                      ' CSR='                                     03150000
031600                      PS-CURSOR-SW                                03160000
031700                      DELIMITED BY SIZE                           03170000
031800                                      INTO SU047-CRA-RET-MSG      03180000
031900             MOVE SQLCODE               TO SU047-SQLCODE          03190000
032000             MOVE '2010-'               TO SU047-CRA-REQ-ID       03200000
032100             PERFORM 9998-RETURN                                  03210000
032200                                                                  03220000
032300         WHEN SQLWARN0 NOT = SPACES                               03230000
032400         WHEN SQLCODE < ZERO                                      03240000
032500         WHEN SQLCODE > ZERO                                      03250000
032600             SET  PS-ERROR             TO TRUE                    03260000
032700             SET  SU047-INVALID-SQL    TO TRUE                    03270000
032800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          03280000
032900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    03290000
033000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     03300000
033100             MOVE SUT00015-AUD-CNTL-NBR                           03310000
033200                                       TO PV-DISP-AUDIT-CNTL-NBR  03320000
033300             MOVE SQLCODE              TO PV-DISP-SQLCODE         03330000
033400             STRING   ' SUKCS762-2010-'                           03340000
033500                      ' CALLED BY-'                               03350000
033600                      SU047-CALLING-PROGRAM                       03360000
033700                      ' PO='                                      03370000
033800                      PV-DISP-PO-NBR '-'                          03380000
033900                      PV-DISP-RCVR-SEQ-NBR '-'                    03390000
034000                      PV-DISP-PO-LINE-NBR                         03400000
034100                      ' AUDIT='                                   03410000
034200                      PV-DISP-AUDIT-CNTL-NBR                      03420000
034300                      ' SQLCODE='                                 03430000
034400                      PV-DISP-SQLCODE                             03440000
034500                      ' CSR='                                     03450000
034600                      PS-CURSOR-SW                                03460000
034700                      DELIMITED BY SIZE                           03470000
034800                                      INTO SU047-CRA-RET-MSG      03480000
034900             MOVE SQLCODE               TO SU047-SQLCODE          03490000
035000             MOVE '2010-'               TO SU047-CRA-REQ-ID       03500000
035100             PERFORM 9998-RETURN                                  03510000
035200     END-EVALUATE.                                                03520000
035300                                                                  03530000
035400                                                                  03540000
035500*-----------------------------------------------------------------03550000
035600* COUNT THE NUMBER OF CARTONS THAT HAVE BEEN PROMPTED FOR THIS    03560000
035700* AUDIT - WHERE THE AUDIT HAS "NOT" YET BEEN PERFORMED.           03570000
035800*-----------------------------------------------------------------03580000
035900 2020-COUNT-CRTNS-NOT-AUDITED.                                    03590000
036000                                                                  03600000
036100     EXEC SQL                                                     03610000
036200          SELECT COUNT(*)                                         03620000
036300            INTO :PV-CARTONS-NOT-AUDITED                          03630000
036400            FROM TSUATRN                                          03640000
036500           WHERE AUD_CNTL_NBR      =  :SUT00015-AUD-CNTL-NBR      03650000
036600             AND UNT_AUD_STP_TMST  =  :PC-DEFAULT-TMST            03660000
036700     END-EXEC.                                                    03670000
036800                                                                  03680000
036900     EVALUATE TRUE                                                03690000
037000         WHEN SQLCODE = ZERO                                      03700000
037100              CONTINUE                                            03710000
037200                                                                  03720000
037300         WHEN SQLCODE = -904                                      03730000
037400         WHEN SQLCODE = -911                                      03740000
037500         WHEN SQLCODE = -913                                      03750000
037600             SET  PS-ERROR             TO TRUE                    03760000
037700             SET  SU047-DATABASE-BUSY  TO TRUE                    03770000
037800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          03780000
037900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    03790000
038000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     03800000
038100             MOVE SUT00015-AUD-CNTL-NBR                           03810000
038200                                       TO PV-DISP-AUDIT-CNTL-NBR  03820000
038300             MOVE SQLCODE              TO PV-DISP-SQLCODE         03830000
038400             STRING   ' SUKCS762-2020-'                           03840000
038500                      ' CALLED BY-'                               03850000
038600                      SU047-CALLING-PROGRAM                       03860000
038700                      ' PO='                                      03870000
038800                      PV-DISP-PO-NBR '-'                          03880000
038900                      PV-DISP-RCVR-SEQ-NBR '-'                    03890000
039000                      PV-DISP-PO-LINE-NBR                         03900000
039100                      ' AUDIT='                                   03910000
039200                      PV-DISP-AUDIT-CNTL-NBR                      03920000
039300                      ' SQLCODE='                                 03930000
039400                      PV-DISP-SQLCODE                             03940000
039500                      ' CSR='                                     03950000
039600                      PS-CURSOR-SW                                03960000
039700                      DELIMITED BY SIZE                           03970000
039800                                      INTO SU047-CRA-RET-MSG      03980000
039900             MOVE SQLCODE               TO SU047-SQLCODE          03990000
040000             MOVE '2020-'               TO SU047-CRA-REQ-ID       04000000
040100             PERFORM 9998-RETURN                                  04010000
040200                                                                  04020000
040300         WHEN SQLWARN0 NOT = SPACES                               04030000
040400         WHEN SQLCODE < ZERO                                      04040000
040500         WHEN SQLCODE > ZERO                                      04050000
040600             SET  PS-ERROR             TO TRUE                    04060000
040700             SET  SU047-INVALID-SQL    TO TRUE                    04070000
040800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          04080000
040900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    04090000
041000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     04100000
041100             MOVE SUT00015-AUD-CNTL-NBR                           04110000
041200                                       TO PV-DISP-AUDIT-CNTL-NBR  04120000
041300             MOVE SQLCODE              TO PV-DISP-SQLCODE         04130000
041400             STRING   ' SUKCS762-2020-'                           04140000
041500                      ' CALLED BY-'                               04150000
041600                      SU047-CALLING-PROGRAM                       04160000
041700                      ' PO='                                      04170000
041800                      PV-DISP-PO-NBR '-'                          04180000
041900                      PV-DISP-RCVR-SEQ-NBR '-'                    04190000
042000                      PV-DISP-PO-LINE-NBR                         04200000
042100                      ' AUDIT='                                   04210000
042200                      PV-DISP-AUDIT-CNTL-NBR                      04220000
042300                      ' SQLCODE='                                 04230000
042400                      PV-DISP-SQLCODE                             04240000
042500                      ' CSR='                                     04250000
042600                      PS-CURSOR-SW                                04260000
042700                      DELIMITED BY SIZE                           04270000
042800                                      INTO SU047-CRA-RET-MSG      04280000
042900             MOVE SQLCODE               TO SU047-SQLCODE          04290000
043000             MOVE '2020-'               TO SU047-CRA-REQ-ID       04300000
043100             PERFORM 9998-RETURN                                  04310000
043200     END-EVALUATE.                                                04320000
043300                                                                  04330000
043400                                                                  04340000
043500*-----------------------------------------------------------------04350000
043600* DETERMINE THE NUMBER OF UNITS EXPECTED IN THE CARTONS ALREADY   04360000
043700* PROMPTED TO BE AUDITED.                                         04370000
043800*-----------------------------------------------------------------04380000
043900 2030-SUM-UNITS-PROMPTED.                                         04390000
044000                                                                  04400000
044100     EXEC SQL                                                     04410000
044200          SELECT SUM(B.SHPD_QTY)                                  04420000
044300            INTO :PV-UNITS-TO-BE-AUDITED                          04430000
044400            FROM TSUATRN A                                        04440000
044500                ,TSHUUPC B                                        04450000
044600           WHERE A.AUD_CNTL_NBR  =  :SUT00015-AUD-CNTL-NBR        04460000
044700             AND A.SHIPT_UNT_ID  =   B.SHIPT_UNT_ID               04470000
044800           GROUP BY A.AUD_CNTL_NBR                                04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100     EVALUATE TRUE                                                04510000
045200         WHEN SQLCODE = ZERO                                      04520000
045300              CONTINUE                                            04530000
045400                                                                  04540000
045500         WHEN SQLCODE = -904                                      04550000
045600         WHEN SQLCODE = -911                                      04560000
045700         WHEN SQLCODE = -913                                      04570000
045800             SET  PS-ERROR             TO TRUE                    04580000
045900             SET  SU047-DATABASE-BUSY  TO TRUE                    04590000
046000             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          04600000
046100             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    04610000
046200             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     04620000
046300             MOVE SUT00015-AUD-CNTL-NBR                           04630000
046400                                       TO PV-DISP-AUDIT-CNTL-NBR  04640000
046500             MOVE SQLCODE              TO PV-DISP-SQLCODE         04650000
046600             STRING   ' SUKCS762-2030-'                           04660000
046700                      ' CALLED BY-'                               04670000
046800                      SU047-CALLING-PROGRAM                       04680000
046900                      ' PO='                                      04690000
047000                      PV-DISP-PO-NBR '-'                          04700000
047100                      PV-DISP-RCVR-SEQ-NBR '-'                    04710000
047200                      PV-DISP-PO-LINE-NBR                         04720000
047300                      ' AUDIT='                                   04730000
047400                      PV-DISP-AUDIT-CNTL-NBR                      04740000
047500                      ' SQLCODE='                                 04750000
047600                      PV-DISP-SQLCODE                             04760000
047700                      ' CSR='                                     04770000
047800                      PS-CURSOR-SW                                04780000
047900                      DELIMITED BY SIZE                           04790000
048000                                      INTO SU047-CRA-RET-MSG      04800000
048100             MOVE SQLCODE               TO SU047-SQLCODE          04810000
048200             MOVE '2030-'               TO SU047-CRA-REQ-ID       04820000
048300             PERFORM 9998-RETURN                                  04830000
048400                                                                  04840000
048500         WHEN SQLWARN0 NOT = SPACES                               04850000
048600         WHEN SQLCODE < ZERO                                      04860000
048700         WHEN SQLCODE > ZERO                                      04870000
048800             SET  PS-ERROR             TO TRUE                    04880000
048900             SET  SU047-INVALID-SQL    TO TRUE                    04890000
049000             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          04900000
049100             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    04910000
049200             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     04920000
049300             MOVE SUT00015-AUD-CNTL-NBR                           04930000
049400                                       TO PV-DISP-AUDIT-CNTL-NBR  04940000
049500             MOVE SQLCODE              TO PV-DISP-SQLCODE         04950000
049600             STRING   ' SUKCS762-2030-'                           04960000
049700                      ' CALLED BY-'                               04970000
049800                      SU047-CALLING-PROGRAM                       04980000
049900                      ' PO='                                      04990000
050000                      PV-DISP-PO-NBR '-'                          05000000
050100                      PV-DISP-RCVR-SEQ-NBR '-'                    05010000
050200                      PV-DISP-PO-LINE-NBR                         05020000
050300                      ' AUDIT='                                   05030000
050400                      PV-DISP-AUDIT-CNTL-NBR                      05040000
050500                      ' SQLCODE='                                 05050000
050600                      PV-DISP-SQLCODE                             05060000
050700                      ' CSR='                                     05070000
050800                      PS-CURSOR-SW                                05080000
050900                      DELIMITED BY SIZE                           05090000
051000                                      INTO SU047-CRA-RET-MSG      05100000
051100             MOVE SQLCODE               TO SU047-SQLCODE          05110000
051200             MOVE '2030-'               TO SU047-CRA-REQ-ID       05120000
051300             PERFORM 9998-RETURN                                  05130000
051400     END-EVALUATE.                                                05140000
051500                                                                  05150000
051600                                                                  05160000
051700*-----------------------------------------------------------------05170000
051800* UPDATE SYSTEM GENERATED AUDIT WITH NEW UNIT/CARTON QTYS         05180000
051900*-----------------------------------------------------------------05190000
052000 3000-UPDATE-SYSTEM-AUDIT.                                        05200000
052100                                                                  05210000
052200     EXEC SQL                                                     05220000
052300          UPDATE SUT_PO_AUD_REQ                                   05230000
052400             SET CART_QTY          = :SUT00015-CART-QTY           05240000
052500               , UNT_QTY           = :SUT00015-UNT-QTY            05250000
052600               , MOD_QTY_IND       = 'Y'                          05260000
052700           WHERE AUD_CNTL_NBR      = :SUT00015-AUD-CNTL-NBR       05270000
052800     END-EXEC.                                                    05280000
052900                                                                  05290000
053000     EVALUATE TRUE                                                05300000
053100         WHEN SQLCODE = ZERO                                      05310000
053200              CONTINUE                                            05320000
053300                                                                  05330000
053400         WHEN SQLCODE = -904                                      05340000
053500         WHEN SQLCODE = -911                                      05350000
053600         WHEN SQLCODE = -913                                      05360000
053700             SET  PS-ERROR             TO TRUE                    05370000
053800             SET  SU047-DATABASE-BUSY  TO TRUE                    05380000
053900             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          05390000
054000             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    05400000
054100             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     05410000
054200             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  05420000
054300             MOVE SQLCODE              TO PV-DISP-SQLCODE         05430000
054400             STRING   ' SUKCS762-3000-'                           05440000
054500                      ' CALLED BY-'                               05450000
054600                      SU047-CALLING-PROGRAM                       05460000
054700                      ' PO='                                      05470000
054800                      PV-DISP-PO-NBR '-'                          05480000
054900                      PV-DISP-RCVR-SEQ-NBR '-'                    05490000
055000                      PV-DISP-PO-LINE-NBR                         05500000
055100                      ' AUDIT='                                   05510000
055200                      PV-DISP-AUDIT-CNTL-NBR                      05520000
055300                      ' SQLCODE='                                 05530000
055400                      PV-DISP-SQLCODE                             05540000
055500                      ' CSR='                                     05550000
055600                      PS-CURSOR-SW                                05560000
055700                      DELIMITED BY SIZE                           05570000
055800                                      INTO SU047-CRA-RET-MSG      05580000
055900             MOVE SQLCODE               TO SU047-SQLCODE          05590000
056000             MOVE '3000-'               TO SU047-CRA-REQ-ID       05600000
056100             PERFORM 9998-RETURN                                  05610000
056200                                                                  05620000
056300         WHEN SQLWARN0 NOT = SPACES                               05630000
056400         WHEN SQLCODE < ZERO                                      05640000
056500         WHEN SQLCODE > ZERO                                      05650000
056600             SET  PS-ERROR             TO TRUE                    05660000
056700             SET  SU047-INVALID-SQL    TO TRUE                    05670000
056800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          05680000
056900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    05690000
057000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     05700000
057100             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  05710000
057200             MOVE SQLCODE              TO PV-DISP-SQLCODE         05720000
057300             STRING   ' SUKCS762-3000-'                           05730000
057400                      ' CALLED BY-'                               05740000
057500                      SU047-CALLING-PROGRAM                       05750000
057600                      ' PO='                                      05760000
057700                      PV-DISP-PO-NBR '-'                          05770000
057800                      PV-DISP-RCVR-SEQ-NBR '-'                    05780000
057900                      PV-DISP-PO-LINE-NBR                         05790000
058000                      ' AUDIT='                                   05800000
058100                      PV-DISP-AUDIT-CNTL-NBR                      05810000
058200                      ' SQLCODE='                                 05820000
058300                      PV-DISP-SQLCODE                             05830000
058400                      ' CSR='                                     05840000
058500                      PS-CURSOR-SW                                05850000
058600                      DELIMITED BY SIZE                           05860000
058700                                      INTO SU047-CRA-RET-MSG      05870000
058800             MOVE SQLCODE               TO SU047-SQLCODE          05880000
058900             MOVE '3000-'               TO SU047-CRA-REQ-ID       05890000
059000             PERFORM 9998-RETURN                                  05900000
059100     END-EVALUATE.                                                05910000
059200                                                                  05920000
059300                                                                  05930000
059400*-----------------------------------------------------------------05940000
059500* IF ALL PROMPTED CARTONS HAVE BEEN AUDITED, CALL SUKCS763 MODULE 05950000
059600* TO DETERMINE IF AUDIT PASSED OR FAILED.                         05960000
059700*-----------------------------------------------------------------05970000
059800 3010-CALL-AUDIT-STAT-CALC.                                       05980000
059900                                                                  05990000
060000     IF  PS-NO-ERROR                                              06000000
060100         PERFORM 7000-LINK-SUKCS594                               06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
060400     MOVE SU026-PICK-ERRORS       TO SU047-PICK-ERRORS            06040000
060500     MOVE SU026-PACK-ERRORS       TO SU047-PACK-ERRORS            06050000
060600     MOVE SU026-TICKET-ERRORS     TO SU047-TICKET-ERRORS          06060000
060700     MOVE SU026-AUDIT-ERROR-PCT   TO SU047-AUDIT-ERROR-PCT        06070000
060800     MOVE SU026-AUDITED-UNITS     TO SU047-AUDITED-UNITS          06080000
060900     MOVE SU026-TOTAL-UNITS       TO SU047-TOTAL-UNITS            06090000
061000     MOVE SU026-AUDITED-CARTONS   TO SU047-AUDITED-CARTONS        06100000
061100     MOVE SU026-TOTAL-CARTONS     TO SU047-TOTAL-CARTONS          06110000
061200     MOVE SU026-TOTAL-CARTONS     TO SU047-AUDIT-STATUS           06120000
061300     MOVE SU026-TOTAL-CARTONS     TO SU047-PO-AUD-REQ-STATUS      06130000
061400                                                                  06140000
061500     IF  PS-NO-ERROR                                              06150000
061600         PERFORM 7010-CALL-AUDIT-STATUS-CALC                      06160000
061700     END-IF.                                                      06170000
061800                                                                  06180000
061801*-----------------------------------------------------------------06180101
061802* LINK COMMON CARTON CLOSE MODULE (SUKCS769).  MODULE WILL        06180201
061803* A) DETERMINE IF OPER ID IS TURNED ON FOR SENDING DIRECTIVES     06180301
061804* B) IF SO, FORMAT A DIRECTIVE AND CALL THE DIRECTIVE GENERATOR   06180401
061805*    (SUKUT129).  THE DIRECTIVE GENERATOR WILL INSERT A ROW TO    06180501
061806*    SUT_CART_DIRV_TRKG AS WELL AN MQ QUEUE.                      06180603
061807*-----------------------------------------------------------------06180702
061810 3100-LINK-COMMON-CRTN-CLOSE.                                     06181006
061900                                                                  06190000
061910     INITIALIZE CCC-REQUEST-COMMUNICATION-AREA.                   06191003
061920                                                                  06192003
061930     MOVE '00'                    TO SU091-RET-CODE.              06193003
061940*    MOVE SU047-CALLING-PROGRAM   TO SU091-CALLING-PGM.           06194009
061941     MOVE 'SUKCS762'              TO SU091-CALLING-PGM.           06194109
061950     MOVE SU047-OPER-UNT-ID       TO SU091-OPER-UNT-ID.           06195003
061960                                                                  06196003
061991     MOVE ZEROS               TO SU091-SHIPT-UNT-ID               06199103
061993                                                                  06199303
061994     MOVE SUT00015-AUD-CNTL-NBR   TO SU091-AUD-CNTL-NBR.          06199403
061995     MOVE SU047-PO-AUD-REQ-STATUS TO SU091-AUD-STAT-CDE.          06199503
061996                                                                  06199603
061998     SET SU091-PROMPTED-AUDIT TO TRUE                             06199803
062004                                                                  06200403
062005     EVALUATE TRUE                                                06200503
062006         WHEN ( SU047-PICK-ERRORS = 0 ) AND                       06200603
062007              ( SU047-PACK-ERRORS = 0 ) AND                       06200703
062008              ( SU047-TICKET-ERRORS = 0 )                         06200803
062009               MOVE '     ' TO SU091-AUD-FALR-STAT-RSN-NM         06200903
062010         WHEN ( SU047-PICK-ERRORS > 0 ) AND                       06201003
062011              ( SU047-PACK-ERRORS = 0 ) AND                       06201103
062012              ( SU047-TICKET-ERRORS = 0 )                         06201203
062013               MOVE 'PICK ' TO SU091-AUD-FALR-STAT-RSN-NM         06201303
062014         WHEN ( SU047-PICK-ERRORS = 0 ) AND                       06201403
062015              ( SU047-PACK-ERRORS > 0 ) AND                       06201503
062016              ( SU047-TICKET-ERRORS = 0 )                         06201603
062017               MOVE 'PACK ' TO SU091-AUD-FALR-STAT-RSN-NM         06201703
062018         WHEN ( SU047-PICK-ERRORS = 0 ) AND                       06201803
062019              ( SU047-PACK-ERRORS = 0 ) AND                       06201903
062020              ( SU047-TICKET-ERRORS > 0 )                         06202003
062021               MOVE 'TCKT ' TO SU091-AUD-FALR-STAT-RSN-NM         06202103
062022     END-EVALUATE.                                                06202203
062023                                                                  06202303
062024     MOVE SU047-USER-ID           TO SU091-ASSOC-ID.              06202403
062025                                                                  06202503
062026     EXEC CICS LINK                                               06202603
062027               PROGRAM  (PC-SUKCS769)                             06202703
062028               COMMAREA (CCC-REQUEST-COMMUNICATION-AREA)          06202803
062029               LENGTH   (LENGTH OF CCC-REQUEST-COMMUNICATION-AREA)06202903
062030               RESP     (PV-CICS-RESP)                            06203008
062031     END-EXEC.                                                    06203103
062032                                                                  06203203
062033     EVALUATE TRUE                                                06203304
062034       WHEN PV-CICS-RESP = DFHRESP (NORMAL)                       06203404
062035           IF SU091-SUCCESS                                       06203504
062036               CONTINUE                                           06203604
062038           ELSE                                                   06203804
062039              SET  PS-ERROR           TO TRUE                     06203905
062040              MOVE SU047-PO-NBR       TO PV-DISP-PO-NBR           06204005
062041              MOVE SU047-REC-SEQ-NBR  TO PV-DISP-RCVR-SEQ-NBR     06204105
062042              MOVE SU047-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR      06204205
062043              MOVE SU047-AUDIT-CNTL-NBR                           06204305
062044                                      TO PV-DISP-AUDIT-CNTL-NBR   06204405
062045             EVALUATE TRUE                                        06204504
062050               WHEN SU091-PARAMETER-ERROR                         06205004
062075                 STRING ' SUKCS762-3100-'                         06207505
062076                        ' CALLED BY-'                             06207605
062077                         SU047-CALLING-PROGRAM                    06207705
062078                        ' PO='                                    06207805
062079                         PV-DISP-PO-NBR '-'                       06207905
062080                         PV-DISP-RCVR-SEQ-NBR '-'                 06208005
062081                         PV-DISP-PO-LINE-NBR                      06208105
062082                        ' AUDIT='                                 06208205
062083                         PV-DISP-AUDIT-CNTL-NBR                   06208305
062084                        'INVALID VALUE PASSED TO SUKCS769 '       06208405
062085                        'SU091-RET-CODE '                         06208505
062086                          SU091-RET-CODE                          06208605
062090                         DELIMITED BY SIZE                        06209005
062091                                      INTO SU047-CRA-RET-MSG      06209105
062093                 MOVE '3100-'           TO SU047-CRA-REQ-ID       06209305
062094                 PERFORM 9998-RETURN                              06209405
062095               WHEN OTHER                                         06209505
062102                 INITIALIZE PV-CICS-MSG-AREA                      06210205
062103                 MOVE SU091-SQLCA                                 06210305
062104                   TO PV-CICS-MSG-AREA                            06210405
062105                 PERFORM 9200-WRITE-TO-CICS-LOG                   06210505
062106                 MOVE SU091-SQLCODE      TO PV-DISP-SQLCODE       06210605
062107                 STRING ' SUKCS762-3100-'                         06210705
062108                        ' CALLED BY-'                             06210805
062109                         SU047-CALLING-PROGRAM                    06210905
062110                        ' PO='                                    06211005
062111                         PV-DISP-PO-NBR '-'                       06211105
062112                         PV-DISP-RCVR-SEQ-NBR '-'                 06211205
062113                         PV-DISP-PO-LINE-NBR                      06211305
062114                        ' AUDIT='                                 06211405
062115                         PV-DISP-AUDIT-CNTL-NBR                   06211505
062116                        'DB2 ERROR '                              06211605
062117                        'SU091-RET-CODE '                         06211705
062118                          SU091-RET-CODE                          06211805
062119                         DELIMITED BY SIZE                        06211905
062120                                      INTO SU047-CRA-RET-MSG      06212005
062121                 MOVE SQLCODE           TO SU047-SQLCODE          06212105
062122                 MOVE '3100-'           TO SU047-CRA-REQ-ID       06212205
062123                 PERFORM 9998-RETURN                              06212305
062124               END-EVALUATE                                       06212405
062125           END-IF                                                 06212504
062126                                                                  06212604
062127       WHEN OTHER                                                 06212704
062128                                                                  06212804
062129           INITIALIZE PV-CICS-MSG-AREA                            06212904
062130           MOVE SU047-CRA-RET-MSG                                 06213004
062131             TO PV-CICS-MSG-AREA                                  06213104
062132           PERFORM 9200-WRITE-TO-CICS-LOG                         06213204
062133                                                                  06213304
062134           INITIALIZE PV-CICS-MSG-AREA                            06213404
062135           MOVE SU047-SQLCA                                       06213504
062136             TO PV-CICS-MSG-AREA                                  06213604
062137           PERFORM 9200-WRITE-TO-CICS-LOG                         06213704
062138                                                                  06213804
062139           SET  PS-ERROR           TO TRUE                        06213904
062140           MOVE SU047-PO-NBR       TO PV-DISP-PO-NBR              06214004
062141           MOVE SU047-REC-SEQ-NBR  TO PV-DISP-RCVR-SEQ-NBR        06214104
062142           MOVE SU047-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR         06214204
062143           MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR    06214304
062144           MOVE SQLCODE            TO PV-DISP-SQLCODE             06214404
062145           STRING ' SUKCS762-7010 OTHER-'                         06214504
062146                  ' CALLED BY-'                                   06214604
062147                   SU047-CALLING-PROGRAM                          06214704
062148                  ' PO='                                          06214804
062149                   PV-DISP-PO-NBR '-'                             06214904
062150                   PV-DISP-RCVR-SEQ-NBR '-'                       06215004
062151                   PV-DISP-PO-LINE-NBR                            06215104
062152                  ' AUDIT='                                       06215204
062153                   PV-DISP-AUDIT-CNTL-NBR                         06215304
062154                  ' SQLCODE='                                     06215404
062155                   PV-DISP-SQLCODE                                06215504
062156                  ' CSR='                                         06215604
062157                   PS-CURSOR-SW                                   06215704
062158                  ' SUCC='                                        06215804
062159                   SU047-SUCCESS-IND                              06215904
062160                   DELIMITED BY SIZE                              06216004
062161                                INTO SU047-CRA-RET-MSG            06216104
062162           MOVE SQLCODE           TO SU047-SQLCODE                06216204
062163           MOVE '3100-'           TO SU047-CRA-REQ-ID             06216304
062164           PERFORM 9998-RETURN                                    06216404
062165                                                                  06216504
062166     END-EVALUATE.                                                06216604
062167/                                                                 06216703
062168*-----------------------------------------------------------------06216800
062170*                                                                 06217000
062200*-----------------------------------------------------------------06220000
062300 4000-PREPARE-CURSOR.                                             06230000
062400                                                                  06240000
062500     IF  SU047-BULK-CASE                                          06250000
062600         SET PS-BULK-CASE-CSR      TO  TRUE                       06260000
062700     ELSE                                                         06270000
062800     IF  SU047-PREPACK                                            06280000
062900         SET PS-PREPACK-CSR        TO  TRUE                       06290000
063000     ELSE                                                         06300000
063100     IF  SU047-PBS                                                06310000
063200         SET  PS-PACK-BY-STORE-CSR  TO  TRUE                      06320000
063300     END-IF                                                       06330000
063400     END-IF                                                       06340000
063500     END-IF.                                                      06350000
063600                                                                  06360000
063700     MOVE  SU047-OPER-UNT-ID     TO DK-OPER-UNT-ID.               06370000
063800     MOVE  SU047-FCLTY-ID        TO DK-FCLTY-ID.                  06380000
063900     MOVE  SU047-PO-NBR          TO DK-PO-NBR.                    06390000
064000     MOVE  SU047-REC-SEQ-NBR     TO DK-REC-SEQ-NBR.               06400000
064100                                                                  06410000
064200     IF  SU047-BULK-CASE                                          06420000
064300         IF  SU047-PO-LNE-NBR  >  0                               06430000
064400             MOVE  SU047-PO-LNE-NBR  TO DK-BEGIN-LNE-NBR          06440000
064500             MOVE  SU047-PO-LNE-NBR  TO DK-END-LNE-NBR            06450000
064600             MOVE  ZEROES            TO DK-BEGIN-PREPK-ID         06460000
064700             MOVE  ZEROES            TO DK-END-PREPK-ID           06470000
064800         ELSE                                                     06480000
064900             MOVE  0000              TO DK-BEGIN-LNE-NBR          06490000
065000             MOVE  9999              TO DK-END-LNE-NBR            06500000
065100             MOVE  ZEROES            TO DK-BEGIN-PREPK-ID         06510000
065200             MOVE  ZEROES            TO DK-END-PREPK-ID           06520000
065300         END-IF                                                   06530000
065400     ELSE                                                         06540000
065500     IF  SU047-PREPACK                                            06550000
065600         IF  SU047-PREPACK-ID  >  0                               06560000
065700             MOVE  SU047-PREPACK-ID  TO DK-BEGIN-PREPK-ID         06570000
065800             MOVE  SU047-PREPACK-ID  TO DK-END-PREPK-ID           06580000
065900             MOVE  ZEROES            TO DK-BEGIN-LNE-NBR          06590000
066000             MOVE  ZEROES            TO DK-END-LNE-NBR            06600000
066100         ELSE                                                     06610000
066200             MOVE  0000              TO DK-BEGIN-PREPK-ID         06620000
066300             MOVE  9999              TO DK-END-PREPK-ID           06630000
066400             MOVE  ZEROES            TO DK-BEGIN-LNE-NBR          06640000
066500             MOVE  ZEROES            TO DK-END-LNE-NBR            06650000
066600         END-IF                                                   06660000
066700     ELSE                                                         06670000
066800     IF  SU047-PBS                                                06680000
066900         MOVE  ZEROES                TO DK-BEGIN-PREPK-ID         06690000
067000                                        DK-END-PREPK-ID           06700000
067100                                        DK-BEGIN-LNE-NBR          06710000
067200                                        DK-END-LNE-NBR            06720000
067300     END-IF                                                       06730000
067400     END-IF                                                       06740000
067500     END-IF.                                                      06750000
067510                                                                  06751000
067520      PERFORM 4010-OPER-CURSOR.                                   06752000
067530      PERFORM 4020-FETCH-CURSOR.                                  06753000
067540                                                                  06754000
067550                                                                  06755000
067560*-----------------------------------------------------------------06756000
067570*                                                                 06757000
067580*-----------------------------------------------------------------06758000
067590 4010-OPER-CURSOR.                                                06759000
067600                                                                  06760000
067700     IF  PS-BULK-CASE-CSR                                         06770000
067800         EXEC SQL                                                 06780000
067900              OPEN BULK-CASE-CSR                                  06790000
068000         END-EXEC                                                 06800000
068100     ELSE                                                         06810000
068200     IF  PS-PREPACK-CSR                                           06820000
068300         EXEC SQL                                                 06830000
068400              OPEN PREPK-CSR                                      06840000
068500         END-EXEC                                                 06850000
068600     ELSE                                                         06860000
068700     IF  PS-PACK-BY-STORE-CSR                                     06870000
068800         EXEC SQL                                                 06880000
068900              OPEN PACK-BY-STORE-CSR                              06890000
069000         END-EXEC                                                 06900000
069100     END-IF                                                       06910000
069200     END-IF                                                       06920000
069300     END-IF.                                                      06930000
069400                                                                  06940000
069500     EVALUATE TRUE                                                06950000
069600         WHEN SQLCODE = ZERO                                      06960000
069700              CONTINUE                                            06970000
069800                                                                  06980000
069900         WHEN SQLCODE = +100                                      06990000
070000              SET  PS-EOF-CURSOR-YES  TO  TRUE                    07000000
070100                                                                  07010000
070200         WHEN SQLCODE = -904                                      07020000
070300         WHEN SQLCODE = -911                                      07030000
070400         WHEN SQLCODE = -913                                      07040000
070500             SET  PS-ERROR             TO TRUE                    07050000
070600             SET  SU047-DATABASE-BUSY  TO TRUE                    07060000
070700             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          07070000
070800             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    07080000
070900             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     07090000
071000             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  07100000
071100             MOVE SQLCODE              TO PV-DISP-SQLCODE         07110000
071200             STRING   ' SUKCS762-4010-'                           07120000
071300                      ' CALLED BY-'                               07130000
071400                      SU047-CALLING-PROGRAM                       07140000
071500                      ' PO='                                      07150000
071600                      PV-DISP-PO-NBR '-'                          07160000
071700                      PV-DISP-RCVR-SEQ-NBR '-'                    07170000
071800                      PV-DISP-PO-LINE-NBR                         07180000
071900                      ' AUDIT='                                   07190000
072000                      PV-DISP-AUDIT-CNTL-NBR                      07200000
072100                      ' SQLCODE='                                 07210000
072200                      PV-DISP-SQLCODE                             07220000
072300                      ' CSR='                                     07230000
072400                      PS-CURSOR-SW                                07240000
072500                      DELIMITED BY SIZE                           07250000
072600                                      INTO SU047-CRA-RET-MSG      07260000
072700             MOVE SQLCODE               TO SU047-SQLCODE          07270000
072800             MOVE '4010-'               TO SU047-CRA-REQ-ID       07280000
072900             PERFORM 9998-RETURN                                  07290000
073000                                                                  07300000
073100         WHEN SQLWARN0 NOT = SPACES                               07310000
073200         WHEN SQLCODE < ZERO                                      07320000
073300         WHEN SQLCODE > ZERO                                      07330000
073400             SET  PS-ERROR             TO TRUE                    07340000
073500             SET  SU047-INVALID-SQL    TO TRUE                    07350000
073600             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          07360000
073700             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    07370000
073800             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     07380000
073900             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  07390000
074000             MOVE SQLCODE              TO PV-DISP-SQLCODE         07400000
074100             STRING   ' SUKCS762-4010-'                           07410000
074200                      ' CALLED BY-'                               07420000
074300                      SU047-CALLING-PROGRAM                       07430000
074400                      ' PO='                                      07440000
074500                      PV-DISP-PO-NBR '-'                          07450000
074600                      PV-DISP-RCVR-SEQ-NBR '-'                    07460000
074700                      PV-DISP-PO-LINE-NBR                         07470000
074800                      ' AUDIT='                                   07480000
074900                      PV-DISP-AUDIT-CNTL-NBR                      07490000
075000                      ' SQLCODE='                                 07500000
075100                      PV-DISP-SQLCODE                             07510000
075200                      ' CSR='                                     07520000
075300                      PS-CURSOR-SW                                07530000
075400                      DELIMITED BY SIZE                           07540000
075500                                      INTO SU047-CRA-RET-MSG      07550000
075600             MOVE SQLCODE               TO SU047-SQLCODE          07560000
075700             MOVE '4010-'               TO SU047-CRA-REQ-ID       07570000
075800             PERFORM 9998-RETURN                                  07580000
075900     END-EVALUATE.                                                07590000
076000                                                                  07600000
076100                                                                  07610000
076200*-----------------------------------------------------------------07620000
076300*                                                                 07630000
076400*-----------------------------------------------------------------07640000
076500 4020-FETCH-CURSOR.                                               07650000
076600                                                                  07660000
076700     IF  PS-BULK-CASE-CSR                                         07670000
076800         PERFORM 4022-FETCH-BULK-CASE-CSR                         07680000
076900     ELSE                                                         07690000
077000     IF  PS-PREPACK-CSR                                           07700000
077100         PERFORM 4024-FETCH-PREPACK-CSR                           07710000
077200     ELSE                                                         07720000
077300     IF  PS-PACK-BY-STORE-CSR                                     07730000
077400         PERFORM 4026-FETCH-PACK-BY-STORE-CSR                     07740000
077500     END-IF                                                       07750000
077600     END-IF                                                       07760000
077700     END-IF.                                                      07770000
077800                                                                  07780000
077900     EVALUATE TRUE                                                07790000
078000         WHEN SQLCODE = ZERO                                      07800000
078100              CONTINUE                                            07810000
078110         WHEN SQLCODE = +100                                      07811000
078120              SET PS-EOF-CURSOR-YES TO TRUE                       07812000
078300         WHEN SQLCODE = -904                                      07830000
078400         WHEN SQLCODE = -911                                      07840000
078500         WHEN SQLCODE = -913                                      07850000
078600             SET  PS-ERROR             TO TRUE                    07860000
078700             SET  SU047-DATABASE-BUSY  TO TRUE                    07870000
078800             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              07880000
078900             MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR-SEQ-NBR    07890000
079000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     07900000
079100             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  07910000
079200             MOVE SQLCODE              TO PV-DISP-SQLCODE         07920000
079300             STRING   ' SUKCS762-4030-'                           07930000
079400                      ' CALLED BY-'                               07940000
079500                      SU047-CALLING-PROGRAM                       07950000
079600                      ' PO='                                      07960000
079700                      PV-DISP-PO-NBR '-'                          07970000
079800                      PV-DISP-RCVR-SEQ-NBR '-'                    07980000
079900                      PV-DISP-PO-LINE-NBR                         07990000
080000                      ' AUDIT='                                   08000000
080100                      PV-DISP-AUDIT-CNTL-NBR                      08010000
080200                      ' SQLCODE='                                 08020000
080300                      PV-DISP-SQLCODE                             08030000
080400                      ' CSR='                                     08040000
080500                      PS-CURSOR-SW                                08050000
080600                      DELIMITED BY SIZE                           08060000
080700                                      INTO SU047-CRA-RET-MSG      08070000
080800             MOVE SQLCODE               TO SU047-SQLCODE          08080000
080900             MOVE '4030-'               TO SU047-CRA-REQ-ID       08090000
081000             PERFORM 9998-RETURN                                  08100000
081100                                                                  08110000
081200         WHEN SQLWARN0 NOT = SPACES                               08120000
081300         WHEN SQLCODE < ZERO                                      08130000
081400         WHEN SQLCODE > ZERO                                      08140000
081500             SET  PS-ERROR             TO TRUE                    08150000
081600             SET  SU047-INVALID-SQL    TO TRUE                    08160000
081700             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          08170000
081800             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    08180000
081900             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     08190000
082000             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  08200000
082100             MOVE SQLCODE              TO PV-DISP-SQLCODE         08210000
082200             STRING   ' SUKCS762-4030-'                           08220000
082300                      ' CALLED BY-'                               08230000
082400                      SU047-CALLING-PROGRAM                       08240000
082500                      ' PO='                                      08250000
082600                      PV-DISP-PO-NBR '-'                          08260000
082700                      PV-DISP-RCVR-SEQ-NBR '-'                    08270000
082800                      PV-DISP-PO-LINE-NBR                         08280000
082900                      ' AUDIT='                                   08290000
083000                      PV-DISP-AUDIT-CNTL-NBR                      08300000
083100                      ' SQLCODE='                                 08310000
083200                      PV-DISP-SQLCODE                             08320000
083300                      ' CSR='                                     08330000
083400                      PS-CURSOR-SW                                08340000
083500                      DELIMITED BY SIZE                           08350000
083600                                      INTO SU047-CRA-RET-MSG      08360000
083700             MOVE SQLCODE               TO SU047-SQLCODE          08370000
083800             MOVE '4030-'               TO SU047-CRA-REQ-ID       08380000
083900             PERFORM 9998-RETURN                                  08390000
084000     END-EVALUATE.                                                08400000
084100                                                                  08410000
084200                                                                  08420000
084300*-----------------------------------------------------------------08430000
084400*                                                                 08440000
084500*-----------------------------------------------------------------08450000
084600 4022-FETCH-BULK-CASE-CSR.                                        08460000
084700                                                                  08470000
084800      EXEC SQL                                                    08480000
084900         FETCH BULK-CASE-CSR                                      08490000
085000          INTO :SUT00015-OPER-UNT-ID                              08500000
085100              ,:SUT00015-PO-NBR                                   08510000
085200              ,:SUT00015-PO-LNE-NBR                               08520000
085300              ,:SUT00015-PO-PREPK-ID                              08530000
085400              ,:SUT00015-INBND-TRIP-ID                            08540000
085500              ,:SUT00015-AUD-CNTL-NBR                             08550000
085600              ,:SUT00015-CART-QTY                                 08560000
085700              ,:SUT00015-UNT-QTY                                  08570000
085800              ,:SUT00015-AUD-CART-QTY                             08580000
085900              ,:SUT00015-AUD-UNT-QTY                              08590000
086000              ,:SUT00015-AUD-STAT-CDE                             08600000
086100              ,:SUT00015-CART-PRMPT-CDE                           08610000
086200              ,:SUT00015-PKGNG-TYP-CDE                            08620000
086300              ,:SUT00015-AUD-STAT-RSN-CDE                         08630000
086400              ,:SUT00015-MOD-QTY-IND                              08640000
086500      END-EXEC.                                                   08650000
086600                                                                  08660000
086700                                                                  08670000
086800*-----------------------------------------------------------------08680000
086900*                                                                 08690000
087000*-----------------------------------------------------------------08700000
087100 4024-FETCH-PREPACK-CSR.                                          08710000
087200                                                                  08720000
087300      EXEC SQL                                                    08730000
087400         FETCH PREPK-CSR                                          08740000
087500          INTO :SUT00015-OPER-UNT-ID                              08750000
087600              ,:SUT00015-PO-NBR                                   08760000
087700              ,:SUT00015-PO-LNE-NBR                               08770000
087800              ,:SUT00015-PO-PREPK-ID                              08780000
087900              ,:SUT00015-INBND-TRIP-ID                            08790000
088000              ,:SUT00015-AUD-CNTL-NBR                             08800000
088100              ,:SUT00015-CART-QTY                                 08810000
088200              ,:SUT00015-UNT-QTY                                  08820000
088300              ,:SUT00015-AUD-CART-QTY                             08830000
088400              ,:SUT00015-AUD-UNT-QTY                              08840000
088500              ,:SUT00015-AUD-STAT-CDE                             08850000
088600              ,:SUT00015-CART-PRMPT-CDE                           08860000
088700              ,:SUT00015-PKGNG-TYP-CDE                            08870000
088800              ,:SUT00015-AUD-STAT-RSN-CDE                         08880000
088900              ,:SUT00015-MOD-QTY-IND                              08890000
089000      END-EXEC.                                                   08900000
089100                                                                  08910000
089200                                                                  08920000
089300*-----------------------------------------------------------------08930000
089400*                                                                 08940000
089500*-----------------------------------------------------------------08950000
089600 4026-FETCH-PACK-BY-STORE-CSR.                                    08960000
089700                                                                  08970000
089800      EXEC SQL                                                    08980000
089900         FETCH PACK-BY-STORE-CSR                                  08990000
090000          INTO :SUT00015-OPER-UNT-ID                              09000000
090100              ,:SUT00015-PO-NBR                                   09010000
090200              ,:SUT00015-PO-LNE-NBR                               09020000
090300              ,:SUT00015-PO-PREPK-ID                              09030000
090400              ,:SUT00015-INBND-TRIP-ID                            09040000
090500              ,:SUT00015-AUD-CNTL-NBR                             09050000
090600              ,:SUT00015-CART-QTY                                 09060000
090700              ,:SUT00015-UNT-QTY                                  09070000
090800              ,:SUT00015-AUD-CART-QTY                             09080000
090900              ,:SUT00015-AUD-UNT-QTY                              09090000
091000              ,:SUT00015-AUD-STAT-CDE                             09100000
091100              ,:SUT00015-CART-PRMPT-CDE                           09110000
091200              ,:SUT00015-PKGNG-TYP-CDE                            09120000
091300              ,:SUT00015-AUD-STAT-RSN-CDE                         09130000
091400              ,:SUT00015-MOD-QTY-IND                              09140000
091500      END-EXEC.                                                   09150000
091600                                                                  09160000
091700                                                                  09170000
091800*-----------------------------------------------------------------09180000
091900*                                                                 09190000
092000*-----------------------------------------------------------------09200000
092100 4030-CLOSE-CURSOR.                                               09210000
092200                                                                  09220000
092300     IF  PS-BULK-CASE-CSR                                         09230000
092400         EXEC SQL                                                 09240000
092500              CLOSE BULK-CASE-CSR                                 09250000
092600         END-EXEC                                                 09260000
092700     ELSE                                                         09270000
092800     IF  PS-PREPACK-CSR                                           09280000
092900         EXEC SQL                                                 09290000
093000              CLOSE PREPK-CSR                                     09300000
093100         END-EXEC                                                 09310000
093200     ELSE                                                         09320000
093300     IF  PS-PACK-BY-STORE-CSR                                     09330000
093400         EXEC SQL                                                 09340000
093500              CLOSE PACK-BY-STORE-CSR                             09350000
093600         END-EXEC                                                 09360000
093700     END-IF                                                       09370000
093800     END-IF                                                       09380000
093900     END-IF.                                                      09390000
094000                                                                  09400000
094100     EVALUATE TRUE                                                09410000
094200         WHEN SQLCODE = ZERO                                      09420000
094300              CONTINUE                                            09430000
094400                                                                  09440000
094500         WHEN SQLCODE = -904                                      09450000
094600         WHEN SQLCODE = -911                                      09460000
094700         WHEN SQLCODE = -913                                      09470000
094800             SET  PS-ERROR             TO TRUE                    09480000
094900             SET  SU047-DATABASE-BUSY  TO TRUE                    09490000
095000             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          09500000
095100             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    09510000
095200             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     09520000
095300             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  09530000
095400             MOVE SQLCODE              TO PV-DISP-SQLCODE         09540000
095500             STRING   ' SUKCS762-4030-'                           09550000
095600                      ' CALLED BY-'                               09560000
095700                      SU047-CALLING-PROGRAM                       09570000
095800                      ' PO='                                      09580000
095900                      PV-DISP-PO-NBR '-'                          09590000
096000                      PV-DISP-RCVR-SEQ-NBR '-'                    09600000
096100                      PV-DISP-PO-LINE-NBR                         09610000
096200                      ' AUDIT='                                   09620000
096300                      PV-DISP-AUDIT-CNTL-NBR                      09630000
096400                      ' SQLCODE='                                 09640000
096500                      PV-DISP-SQLCODE                             09650000
096600                      ' CSR='                                     09660000
096700                      PS-CURSOR-SW                                09670000
096800                      DELIMITED BY SIZE                           09680000
096900                                      INTO SU047-CRA-RET-MSG      09690000
097000             MOVE SQLCODE               TO SU047-SQLCODE          09700000
097100             MOVE '4030-'               TO SU047-CRA-REQ-ID       09710000
097200             PERFORM 9998-RETURN                                  09720000
097300                                                                  09730000
097400         WHEN SQLWARN0 NOT = SPACES                               09740000
097500         WHEN SQLCODE < ZERO                                      09750000
097600         WHEN SQLCODE > ZERO                                      09760000
097700             SET  PS-ERROR             TO TRUE                    09770000
097800             SET  SU047-INVALID-SQL    TO TRUE                    09780000
097900             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          09790000
098000             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    09800000
098100             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     09810000
098200             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  09820000
098300             MOVE SQLCODE              TO PV-DISP-SQLCODE         09830000
098400             STRING   ' SUKCS762-4030-'                           09840000
098500                      ' CALLED BY-'                               09850000
098600                      SU047-CALLING-PROGRAM                       09860000
098700                      ' PO='                                      09870000
098800                      PV-DISP-PO-NBR '-'                          09880000
098900                      PV-DISP-RCVR-SEQ-NBR '-'                    09890000
099000                      PV-DISP-PO-LINE-NBR                         09900000
099100                      ' AUDIT='                                   09910000
099200                      PV-DISP-AUDIT-CNTL-NBR                      09920000
099300                      ' SQLCODE='                                 09930000
099400                      PV-DISP-SQLCODE                             09940000
099500                      ' CSR='                                     09950000
099600                      PS-CURSOR-SW                                09960000
099700                      DELIMITED BY SIZE                           09970000
099800                                      INTO SU047-CRA-RET-MSG      09980000
099900             MOVE SQLCODE               TO SU047-SQLCODE          09990000
100000             MOVE '4030-'               TO SU047-CRA-REQ-ID       10000000
100100             PERFORM 9998-RETURN                                  10010000
100200     END-EVALUATE.                                                10020000
100300                                                                  10030000
100400                                                                  10040000
100500*----------------------------------------------------------------*10050000
100600*  LINK TO SUKCS594 TO DETERMINE IF THE AUDIT PASSED OR FAILED    10060000
100700*----------------------------------------------------------------*10070000
100800 7000-LINK-SUKCS594.                                              10080000
100900                                                                  10090000
101000     INITIALIZE SU026-CARTON-AUDIT-RECORD.                        10100000
101100     MOVE SUT00015-AUD-CNTL-NBR   TO SU026-AUDIT-NUMBER           10110000
101200                                     SU047-AUDIT-CNTL-NBR.        10120000
101300     SET SU026-IN-PROCESS TO TRUE.                                10130000
101400     MOVE 'N'                     TO SU026-MULTIPLE-FAILURE-IND.  10140000
101500     MOVE SUT00015-OPER-UNT-ID    TO SU026-OPER-UNIT-ID.          10150000
101600     MOVE PS-CURSOR-SW            TO SU026-PACKAGE-TYPE-CODE.     10160000
101700                                                                  10170000
101800     MOVE LENGTH OF CA-SUMMARY-COMMAREA                           10180000
101900                                         TO PV-COMMAREA-LENGTH.   10190000
102000                                                                  10200000
102100     EXEC CICS                                                    10210000
102200         LINK PROGRAM  (PC-SUKCS594)                              10220000
102300              COMMAREA (CA-SUMMARY-COMMAREA)                      10230000
102400              LENGTH   (PV-COMMAREA-LENGTH)                       10240000
102500              RESP     (PV-CICS-RESP)                             10250000
102600     END-EXEC.                                                    10260000
102700                                                                  10270000
102800     EVALUATE TRUE                                                10280000
102900         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     10290000
102901              IF  SU026-INVALID-REQUEST OR                        10290100
102902                  SU026-DB2-ERROR                                 10290200
102903                                                                  10290300
102904                 SET  PS-ERROR           TO TRUE                  10290400
102905                 MOVE SU047-PO-NBR       TO PV-DISP-PO-NBR        10290500
102906                 MOVE SU047-REC-SEQ-NBR  TO PV-DISP-RCVR-SEQ-NBR  10290600
102907                 MOVE SU047-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR   10290700
102908                 MOVE SU047-AUDIT-CNTL-NBR                        10290800
102909                                         TO PV-DISP-AUDIT-CNTL-NBR10290900
102910                 MOVE SQLCODE            TO PV-DISP-SQLCODE       10291000
102920                 STRING ' SUKCS762-7000-'                         10292000
102921                        ' CALLED BY-'                             10292100
102922                         SU047-CALLING-PROGRAM                    10292200
102923                        ' PO='                                    10292300
102924                         PV-DISP-PO-NBR '-'                       10292400
102925                         PV-DISP-RCVR-SEQ-NBR '-'                 10292500
102926                         PV-DISP-PO-LINE-NBR                      10292600
102927                        ' AUDIT='                                 10292700
102928                         PV-DISP-AUDIT-CNTL-NBR                   10292800
102929                        ' SQLCODE='                               10292900
102930                         PV-DISP-SQLCODE                          10293000
102931                        ' CSR='                                   10293100
102932                         PS-CURSOR-SW                             10293200
102933                        ' SUCC='                                  10293300
102934                         SU026-AUDIT-VALIDATION-SW                10293400
102935                         DELIMITED BY SIZE                        10293500
102936                                      INTO SU047-CRA-RET-MSG      10293600
102937                 MOVE SQLCODE           TO SU047-SQLCODE          10293700
102938                 MOVE '7000-'           TO SU047-CRA-REQ-ID       10293800
102939                 PERFORM 9998-RETURN                              10293900
102940             END-IF                                               10294000
102941                                                                  10294100
102942         WHEN OTHER                                               10294200
102943                                                                  10294300
102944                 SET  PS-ERROR           TO TRUE                  10294400
102945                 MOVE SU047-PO-NBR       TO PV-DISP-PO-NBR        10294500
102946                 MOVE SU047-REC-SEQ-NBR  TO PV-DISP-RCVR-SEQ-NBR  10294600
102947                 MOVE SU047-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR   10294700
102948                 MOVE SU047-AUDIT-CNTL-NBR                        10294800
102949                                         TO PV-DISP-AUDIT-CNTL-NBR10294900
102950                 MOVE SQLCODE            TO PV-DISP-SQLCODE       10295000
102951                 STRING ' SUKCS762-7000 OTHER-'                   10295100
102952                        ' CALLED BY-'                             10295200
102953                         SU047-CALLING-PROGRAM                    10295300
102954                        ' PO='                                    10295400
102955                         PV-DISP-PO-NBR '-'                       10295500
102956                         PV-DISP-RCVR-SEQ-NBR '-'                 10295600
102957                         PV-DISP-PO-LINE-NBR                      10295700
102958                        ' AUDIT='                                 10295800
102959                         PV-DISP-AUDIT-CNTL-NBR                   10295900
102960                        ' SQLCODE='                               10296000
102961                         PV-DISP-SQLCODE                          10296100
102962                        ' CSR='                                   10296200
102963                         PS-CURSOR-SW                             10296300
102964                        ' SUCC='                                  10296400
102965                         SU026-AUDIT-VALIDATION-SW                10296500
102966                         DELIMITED BY SIZE                        10296600
102967                                      INTO SU047-CRA-RET-MSG      10296700
102968                 MOVE SQLCODE           TO SU047-SQLCODE          10296800
102969                 MOVE '7000-'           TO SU047-CRA-REQ-ID       10296900
102970                 PERFORM 9998-RETURN                              10297000
102971                                                                  10297100
102972     END-EVALUATE.                                                10297200
102973                                                                  10297300
102974                                                                  10297400
102975*----------------------------------------------------------------*10297500
102976*  CALL SUKCS763 TO CALCULATE AUDIT PASS/FAIL                     10297600
102977*----------------------------------------------------------------*10297700
102978 7010-CALL-AUDIT-STATUS-CALC.                                     10297800
102979                                                                  10297900
102980     MOVE LENGTH OF SU047-COMMAREA-REC  TO PV-COMMAREA-LENGTH.    10298000
102981                                                                  10298100
102982     EXEC CICS                                                    10298200
102983         LINK PROGRAM  (PC-SUKCS763)                              10298300
102984              COMMAREA (SU047-COMMAREA-REC)                       10298400
102985              LENGTH   (PV-COMMAREA-LENGTH)                       10298500
102986              RESP     (PV-CICS-RESP)                             10298600
102987     END-EXEC.                                                    10298700
102988                                                                  10298800
102989     EVALUATE TRUE                                                10298900
102990         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     10299000
102991             IF  SU047-SUCCESSFUL                                 10299100
102992                 CONTINUE                                         10299200
102993                                                                  10299300
102994             ELSE                                                 10299400
102995                                                                  10299500
102996                 INITIALIZE PV-CICS-MSG-AREA                      10299600
102997                 MOVE SU047-CRA-RET-MSG                           10299700
102998                   TO PV-CICS-MSG-AREA                            10299800
102999                 PERFORM 9200-WRITE-TO-CICS-LOG                   10299900
103000                                                                  10300000
103001                 INITIALIZE PV-CICS-MSG-AREA                      10300100
103002                 MOVE SU047-SQLCA                                 10300200
103003                   TO PV-CICS-MSG-AREA                            10300300
103004                 PERFORM 9200-WRITE-TO-CICS-LOG                   10300400
103005                                                                  10300500
103006                 SET  PS-ERROR           TO TRUE                  10300600
103007                 MOVE SU047-PO-NBR       TO PV-DISP-PO-NBR        10300700
103008                 MOVE SU047-REC-SEQ-NBR  TO PV-DISP-RCVR-SEQ-NBR  10300800
103009                 MOVE SU047-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR   10300900
103010                 MOVE SU047-AUDIT-CNTL-NBR                        10301000
103011                                         TO PV-DISP-AUDIT-CNTL-NBR10301100
103012                 MOVE SQLCODE            TO PV-DISP-SQLCODE       10301200
103013                 STRING ' SUKCS762-7010-'                         10301300
103014                        ' CALLED BY-'                             10301400
103015                         SU047-CALLING-PROGRAM                    10301500
103016                        ' PO='                                    10301600
103017                         PV-DISP-PO-NBR '-'                       10301700
103018                         PV-DISP-RCVR-SEQ-NBR '-'                 10301800
103019                         PV-DISP-PO-LINE-NBR                      10301900
103020                        ' AUDIT='                                 10302000
103021                         PV-DISP-AUDIT-CNTL-NBR                   10302100
103022                        ' SQLCODE='                               10302200
103023                         PV-DISP-SQLCODE                          10302300
103024                        ' CSR='                                   10302400
103025                         PS-CURSOR-SW                             10302500
103026                        ' SUCC='                                  10302600
103027                         SU047-SUCCESS-IND                        10302700
103028                         DELIMITED BY SIZE                        10302800
103029                                      INTO SU047-CRA-RET-MSG      10302900
103030                 MOVE SQLCODE           TO SU047-SQLCODE          10303000
103031                 MOVE '7010-'           TO SU047-CRA-REQ-ID       10303100
103032                 PERFORM 9998-RETURN                              10303200
103033             END-IF                                               10303300
103034                                                                  10303400
103035         WHEN OTHER                                               10303500
103036                                                                  10303600
103037             INITIALIZE PV-CICS-MSG-AREA                          10303700
103038             MOVE SU047-CRA-RET-MSG                               10303800
103039               TO PV-CICS-MSG-AREA                                10303900
103040             PERFORM 9200-WRITE-TO-CICS-LOG                       10304000
103041                                                                  10304100
103042             INITIALIZE PV-CICS-MSG-AREA                          10304200
103043             MOVE SU047-SQLCA                                     10304300
103044               TO PV-CICS-MSG-AREA                                10304400
103045             PERFORM 9200-WRITE-TO-CICS-LOG                       10304500
103046                                                                  10304600
103047             SET  PS-ERROR           TO TRUE                      10304700
103048             MOVE SU047-PO-NBR       TO PV-DISP-PO-NBR            10304800
103049             MOVE SU047-REC-SEQ-NBR  TO PV-DISP-RCVR-SEQ-NBR      10304900
103050             MOVE SU047-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR       10305000
103051             MOVE SU047-AUDIT-CNTL-NBR TO PV-DISP-AUDIT-CNTL-NBR  10305100
103052             MOVE SQLCODE            TO PV-DISP-SQLCODE           10305200
103053             STRING ' SUKCS762-7010 OTHER-'                       10305300
103054                    ' CALLED BY-'                                 10305400
103055                     SU047-CALLING-PROGRAM                        10305500
103056                    ' PO='                                        10305600
103057                     PV-DISP-PO-NBR '-'                           10305700
103058                     PV-DISP-RCVR-SEQ-NBR '-'                     10305800
103059                     PV-DISP-PO-LINE-NBR                          10305900
103060                    ' AUDIT='                                     10306000
103061                     PV-DISP-AUDIT-CNTL-NBR                       10306100
103062                    ' SQLCODE='                                   10306200
103063                     PV-DISP-SQLCODE                              10306300
103064                    ' CSR='                                       10306400
103065                     PS-CURSOR-SW                                 10306500
103066                    ' SUCC='                                      10306600
103067                     SU047-SUCCESS-IND                            10306700
103068                     DELIMITED BY SIZE                            10306800
103069                                  INTO SU047-CRA-RET-MSG          10306900
103070             MOVE SQLCODE           TO SU047-SQLCODE              10307000
103071             MOVE '7010-'           TO SU047-CRA-REQ-ID           10307100
103072             PERFORM 9998-RETURN                                  10307200
103073                                                                  10307300
103074     END-EVALUATE.                                                10307400
103075                                                                  10307500
103076                                                                  10307600
103077*-----------------------------------------------------------------10307700
103078*  WRITE TO CICS LOG CSSL                                         10307800
103079*-----------------------------------------------------------------10307900
103080 9200-WRITE-TO-CICS-LOG.                                          10308000
103081                                                                  10308100
103082     EXEC CICS                                                    10308200
103083          WRITEQ TD                                               10308300
103084          QUEUE  ('CSSL')                                         10308400
103085          FROM  (PV-CICS-MSG-AREA)                                10308500
103086          LENGTH  (PV-COMMAREA-LENGTH)                            10308600
103087          RESP  (PV-CICS-RESP)                                    10308700
103088     END-EXEC.                                                    10308800
103089                                                                  10308900
103090     MOVE SPACES TO PV-CICS-MSG-AREA.                             10309000
103091                                                                  10309100
103092                                                                  10309200
103093 9300-CHECK-LOGGING.                                              10309300
103094     EXEC SQL                                                     10309400
103095         SELECT FUNC_TXT                                          10309500
103096           INTO :KRPRPM-FUNC-TXT                                  10309600
103097           FROM TKRPRPM                                           10309700
103098          WHERE SYS_PRC_FUNC_CDE  = 'SU762D'                      10309800
103099            AND LOC_ID            = :DK-OPER-UNT-ID               10309900
103100            AND INTFC_SYS_CDE     = 'KHL'                         10310000
103101            AND FUNC_PRC_STAT_CDE = 'AC'                          10310100
103102     END-EXEC.                                                    10310200
103103                                                                  10310300
103104     EVALUATE TRUE                                                10310400
103105         WHEN SQLCODE = ZERO                                      10310500
103106         WHEN SQLCODE = +100                                      10310600
103107              CONTINUE                                            10310700
103108         WHEN SQLWARN0 NOT = SPACE                                10310800
103109         WHEN SQLCODE NOT = ZERO                                  10310900
103110             SET PS-ERROR                                         10311000
103111                 SU047-INVALID-SQL    TO TRUE                     10311100
103112             MOVE SQLCODE             TO PV-DISP-SQLCODE          10311200
103113             MOVE DK-OPER-UNT-ID      TO PV-DISP-OPER-UNT-ID      10311300
103114             STRING   ' SUKCS762-9300-'                           10311400
103115                      ' CALLED BY-'                               10311500
103116                      SU047-CALLING-PROGRAM                       10311600
103117                      '  SQLCODE='                                10311700
103118                      PV-DISP-SQLCODE                             10311800
103119                      ' OPER = '                                  10311900
103120                      PV-DISP-OPER-UNT-ID                         10312000
103121                      DELIMITED BY SIZE                           10312100
103122                                        INTO PV-CICS-MSG-AREA     10312200
103123             PERFORM 9200-WRITE-TO-CICS-LOG                       10312300
103124     END-EVALUATE.                                                10312400
103125                                                                  10312500
103126                                                                  10312600
103127*-----------------------------------------------------------------10312700
103128*  RETURN TO CALLING PROGRAM                                      10312800
103129*-----------------------------------------------------------------10312900
103130 9998-RETURN.                                                     10313000
103140                                                                  10314000
103150     MOVE SU047-COMMAREA-REC           TO DFHCOMMAREA.            10315000
103160     MOVE SQLCA                         TO SU047-SQLCA.           10316000
103170     GOBACK.                                                      10317000
103180                                                                  10318000
