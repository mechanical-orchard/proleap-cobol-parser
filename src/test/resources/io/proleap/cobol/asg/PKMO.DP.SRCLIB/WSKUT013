000100******************************************************************00010000
000200*  I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES00020000
000300*  SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.       00030000
000400*  THIS PROGRAM USES MQSERIES.                                    00040000
000500*                                                                 00050000
000600*  THIS PROGRAM COMPILES WITH A RET CODE OF 4. THE LOOP WARNING   00060000
000700*  IS RELATED TO THE CODE FOR THE STARTED TASK PROCESSING.        00070000
000800*                                                                 00080000
000900******************************************************************00090000
001000                                                                  00100000
001100 IDENTIFICATION DIVISION.                                         00110000
001200 PROGRAM-ID.             WSKUT013.                                00120000
001300 AUTHOR.                 PATRICK BURKE.                           00130000
001400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00140000
001500 DATE-WRITTEN.           MARCH 2007.                              00150000
001600 DATE-COMPILED.                                                   00160000
001700                                                                  00170000
001800******************************************************************00180000
001900*      PIX - INTRANSIT TRANSACTIONS QUEUE DOWNLOAD                00190000
002000*                                                                 00200000
002100* THIS PROGRAM WILL READ THE PIX - INTRANSIT TRANSACTIONS QUEUE   00210000
002200* MESSAGES USING THE COPYBOOK WSRD014 AND REFORMAT THEM TO WMRD01500220000
002300* LAYOUT AND WRITTEN TO THE OUTPUT FILE.                          00230000
002400*                                                                 00240000
002500*                                                                 00250000
002600* UNITS OF WORK AND COMMITS:                                      00260000
002700* --------------------------                                      00270000
002800* THEN AN MQ COMMIT WILL BE PERFORMED TO PERMANENTLY 'REMOVE' THE 00280000
002900* MESSAGES FROM THE ITEM QUEUE.                                   00290000
003000* MQ COMMITS ARE ALSO PERFORMED AFTER AN ERROR MESSAGE HAS BEEN   00300000
003100* WRITTEN TO THE ERROR QUEUE.                                     00310000
003200*                                                                 00320000
003210******************************************************************00321013
003220*  CHANGE LOG                                                     00322013
003230*  DATE       CHANGED BY    DESC                                  00323013
003240*  ---------- ------------- --------------------------------------00324013
003275******************************************************************00327513
003276*  09-05-2011 CHRISTINE TWIEHAUS                                  00327613
003277*                         WR 38972 MLOF                           00327713
003278*                         REMOVE STORE NUMBER CONVERSION          00327814
003282*                                                                 00328213
000500*  05/15/2020 JEAN KURK   REPLACE WMRD015 WITH CERD015            00328516
003283******************************************************************00328613
003284******************************************************************00328713
003285 ENVIRONMENT DIVISION.                                            00328813
003286******************************************************************00328913
003287 CONFIGURATION SECTION.                                           00329013
003288                                                                  00329113
003289 SOURCE-COMPUTER.        IBM-3090.                                00329213
003290 OBJECT-COMPUTER.        IBM-3090.                                00329313
003300                                                                  00330013
003400 INPUT-OUTPUT SECTION.                                            00340013
003500                                                                  00350013
003600 FILE-CONTROL.                                                    00360013
003700                                                                  00370013
003800* ------------------------------------------------------------- * 00380013
003900*  OUTPUT FILE                                                    00390013
004000* ------------------------------------------------------------- * 00400013
004100     SELECT OUTPUT-FILE                                           00410013
004200            ASSIGN TO OUT01.                                      00420013
004300                                                                  00430013
004400******************************************************************00440013
004500 DATA DIVISION.                                                   00450013
004600******************************************************************00460013
004700 FILE SECTION.                                                    00470013
004800                                                                  00480013
004900 FD  OUTPUT-FILE                                                  00490013
005000     RECORDING MODE F                                             00500013
005100     BLOCK CONTAINS 0 RECORDS                                     00510013
005200     LABEL RECORDS ARE OMITTED.                                   00520013
005300 01  OUTPUT-RECORD                 PIC X(158).                    00530013
005400                                                                  00540013
005500******************************************************************00550013
005600 WORKING-STORAGE SECTION.                                         00560013
005700******************************************************************00570013
005800                                                                  00580013
005900******************************************************************00590013
006000*  LV-LINKAGE-VARIABLES.                                          00600013
006100******************************************************************00610013
006200                                                                  00620013
006300 01  LV-LINKAGE-VARIABLES.                                        00630013
006400     05  LV-IMRD075-RECORD         PIC X(137).                    00640013
006500     05  LV-RETURN-CODE            PIC X(04).                     00650013
006600                                                                  00660013
006700******************************************************************00670013
006800*  COMMUNICATIONS AREA FOR DB2                                    00680013
006900******************************************************************00690013
007000     EXEC SQL                                                     00700013
007100          INCLUDE SQLCA                                           00710013
007200     END-EXEC.                                                    00720013
007300                                                                  00730013
007400******************************************************************00740013
007500*  DB2 TABLE DECLARATION                                          00750013
007600*      (WSV_CNSMR_QUE)                                            00760013
007700******************************************************************00770013
007800     EXEC SQL                                                     00780013
007900          INCLUDE WSV00006                                        00790013
008000     END-EXEC.                                                    00800013
008100                                                                  00810013
008200******************************************************************00820013
008300*  DB2 TABLE DECLARATION                                          00830013
008400*      (WSV_PRVDR_QUE)                                            00840013
008500******************************************************************00850013
008600     EXEC SQL                                                     00860013
008700          INCLUDE WSV00005                                        00870013
008800     END-EXEC.                                                    00880013
008900*                                                                 00890013
009520******************************************************************00952013
009530* INPUT LAYOUT - RECEIPT PIX TRANSACTIONS FROM WMOS               00953013
009540******************************************************************00954013
009550     COPY WSRD014.                                                00955013
009560                                                                  00956013
009570******************************************************************00957013
009580* OUTPUT LAYOUT - RECEIPT UPLOAD FROM RDM TO HOST (IBM)           00958013
009590******************************************************************00959013
009600     COPY CERD015.                                                00960016
009700                                                                  00970013
009800******************************************************************00980013
009900* I/O LAYOUT -  ERROR RECORD.                                     00990013
010000******************************************************************01000013
010100     COPY WSRD020.                                                01010013
010200                                                                  01020013
010300******************************************************************01030013
010400*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                     01040013
010500******************************************************************01050013
010600     COPY DPWS004.                                                01060013
010700                                                                  01070013
010800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01080013
010900                                                   COMP SYNC.     01090013
011000 01  PA-PROGRAM-ACCUMULATORS.                                     01100013
011100     05  PA-TOTALS.                                               01110013
011200         10 PA-END-OF-RUN-MESSAGES    PIC S9(06) VALUE +0 COMP-3. 01120013
011300         10 PA-999-STOP-PROC-MESSAGES PIC S9(06) VALUE +0 COMP-3. 01130013
011400         10 PA-TOTAL-GETS             PIC S9(09) VALUE +0 COMP-3. 01140013
011500         10 PA-COMMIT-TRIGGER-COUNT   PIC S9(09) VALUE +0 COMP-3. 01150013
011600         10 PA-TOTAL-BACKUP-RECS      PIC S9(09) VALUE +0 COMP-3. 01160013
011700         10 PA-TOTAL-OUTPUT-RECS      PIC S9(09) VALUE +0 COMP-3. 01170013
011800         10 PA-TOTAL-ERRORQ-RECS      PIC S9(09) VALUE +0 COMP-3. 01180013
011900         10 PA-TOTAL-DB2-COMMITS      PIC S9(09) VALUE +0 COMP-3. 01190013
012000         10 PA-TOTAL-MQ-COMMITS       PIC S9(09) VALUE +0 COMP-3. 01200013
012100         10 PA-ENDS-IN-MSG            PIC S9(09) VALUE +0 COMP-3. 01210013
012200         10 PA-CHARS-IN-MSG           PIC  9(09) VALUE  0.        01220013
012300         10 PA-BYTES-BEYOND-END       PIC  9(09) VALUE  0.        01230013
012400                                                                  01240013
012500 01  PS-PROGRAM-SWITCHES.                                         01250013
012600     05  PS-GOOD-MSG-SW                PIC  X(01)    VALUE 'N'.   01260013
012700         88  PS-GOOD-MSG-YES                         VALUE 'Y'.   01270013
012800         88  PS-GOOD-MSG-NO                          VALUE 'N'.   01280013
012900     05  PS-TIME-TO-END-PROGRAM-SW     PIC  X(01)    VALUE 'N'.   01290013
013000         88  PS-TIME-TO-END-PROGRAM-YES              VALUE 'Y'.   01300013
013100         88  PS-TIME-TO-END-PROGRAM-NO               VALUE 'N'.   01310013
013200     05  PS-END-OF-MSG-SW              PIC  X(01)    VALUE 'N'.   01320013
013300         88  PS-END-OF-MSG-YES                       VALUE 'Y'.   01330013
013400         88  PS-END-OF-MSG-NO                        VALUE 'N'.   01340013
013500     05  PS-END-OF-FILE-SW             PIC  X(01)    VALUE 'N'.   01350013
013600         88  PS-END-OF-FILE-YES                      VALUE 'Y'.   01360013
013700         88  PS-END-OF-FILE-NO                       VALUE 'N'.   01370013
013800     05  PS-ERROR-SW                   PIC  X(01)    VALUE 'N'.   01380013
013900         88  PS-ERROR-YES                            VALUE 'Y'.   01390013
014000         88  PS-ERROR-NO                             VALUE 'N'.   01400013
014100     05  PS-ERROR-QUEUE-IS-OPEN-SW     PIC  X(01)    VALUE 'N'.   01410013
014200         88  PS-ERROR-QUEUE-IS-OPEN-YES              VALUE 'Y'.   01420013
014300         88  PS-ERROR-QUEUE-IS-OPEN-NO               VALUE 'N'.   01430013
014400     05  PS-UPDATE-SKU-SW              PIC  X(01)    VALUE 'N'.   01440013
014500         88  PS-UPDSKU-YES                           VALUE 'Y'.   01450013
014600         88  PS-UPDSKU-NO                            VALUE 'N'.   01460013
014700     05  PS-UPDATE-UPC-SW              PIC  X(01)    VALUE 'N'.   01470013
014800         88  PS-UPDUPC-YES                           VALUE 'Y'.   01480013
014900         88  PS-UPDUPC-NO                            VALUE 'N'.   01490013
015000     05  PS-EMAIL-SW                   PIC  X(01)    VALUE 'N'.   01500013
015100         88  PS-EMAIL-YES                            VALUE 'Y'.   01510013
015200         88  PS-EMAIL-NO                             VALUE 'N'.   01520013
015300     05  PS-UPDATE-SW                  PIC  X(01)    VALUE 'N'.   01530013
015400         88  PS-UPDATE                               VALUE 'Y'.   01540013
015500         88  PS-NO-UPDATE                            VALUE 'N'.   01550013
015600     05  PS-SKU-STAT-SW                PIC  X(01)    VALUE 'N'.   01560013
015700         88  PS-YES-SKU-STAT-CHG                     VALUE 'Y'.   01570013
015800         88  PS-NO-SKU-STAT-CHG                      VALUE 'N'.   01580013
015900                                                                  01590013
016000 01  PC-PROGRAM-CONSTANTS.                                        01600013
016100     05  PC-005                     PIC X(03)  VALUE '005'.       01610013
016200     05  PC-010                     PIC X(03)  VALUE '010'.       01620013
016300     05  PC-015                     PIC X(03)  VALUE '015'.       01630013
016400     05  PC-020                     PIC X(03)  VALUE '020'.       01640013
016500     05  PC-025                     PIC X(03)  VALUE '025'.       01650013
016600     05  PC-030                     PIC X(03)  VALUE '030'.       01660013
016700     05  PC-031                     PIC X(03)  VALUE '031'.       01670013
016800     05  PC-040                     PIC X(03)  VALUE '040'.       01680013
016900     05  PC-045                     PIC X(03)  VALUE '045'.       01690013
017000     05  PC-050                     PIC X(03)  VALUE '050'.       01700013
017100     05  PC-055                     PIC X(03)  VALUE '055'.       01710013
017200     05  PC-060                     PIC X(03)  VALUE '060'.       01720013
017300     05  PC-MAX-RETRIES             PIC S9(03) VALUE +5 COMP-3.   01730013
017400     05  PC-CURRENT-PROGRAM-NAME    PIC X(08)  VALUE 'WSKUT013'.  01740013
017500     05  PC-ITEM                    PIC X(04)  VALUE 'ITEM'.      01750013
017600     05  PC-MQC                     PIC X(03)  VALUE 'MQC'.       01760013
017700     05  PC-HDR                     PIC X(03)  VALUE 'HDR'.       01770013
017800     05  PC-DTL                     PIC X(03)  VALUE 'DTL'.       01780013
017900     05  PC-01                      PIC 9(02)  VALUE 01.          01790013
018000     05  PC-001                     PIC 9(03)  VALUE 001.         01800013
018100     05  PC-GFT                     PIC X(03)  VALUE 'GFT'.       01810013
018200     05  PC-END                     PIC X(03)  VALUE 'END'.       01820013
018300     05  PC-MQPUT-RETRY-COUNTER     PIC 9(3)   VALUE ZERO.        01830013
018400     05  PC-N                       PIC X(01)  VALUE 'N'.         01840013
018500     05  PC-READY                   PIC X(06)  VALUE 'READY '.    01850013
018600     05  PC-CMPLTD                  PIC X(06)  VALUE 'CMPLTD'.    01860013
018700     05  PC-DEFAULT-TMST            PIC X(26)  VALUE              01870013
018800                                    '0001-01-01-00.00.00.000000'. 01880013
018900     05  PC-END-RUN-MSG             PIC X(18)  VALUE              01890013
019000                                            'END RUN OF PROGRAM'. 01900013
019100                                                                  01910013
019200 01  DK-DB2-KEYS.                                                 01920013
019300     05  DK-ITEM-KEY-RMS-STYL-ID      PIC S9(8)V VALUE ZEROS      01930013
019400                                               COMP-3.            01940013
019500     05  DK-SKU                       PIC S9(8)V VALUE ZEROS      01950013
019600                                               COMP-3.            01960013
019700     05  DK-ITEM-KEY-INTR-UPC-ID      PIC S9(9)  COMP.            01970013
019800     05  DK-ITEM-KEY-UPC-ID           PIC S9(9)  COMP.            01980013
019900     05  DK-SKU-RECL-REN-UPC-ID-REN   PIC S9(9) COMP.             01990013
020000     05  DK-SKU-RECL-REN-UPC-NBR-NEW  PIC S9(15)V COMP-3.         02000013
020100     05  DK-ITEM-KEY-UPC-NBR          PIC S9(15)V COMP-3.         02010013
020200     05  DK-UPC-MOVE-INTR-UPC-ID-NEW  PIC S9(9) COMP.             02020013
020300                                                                  02030013
020400 01  PV-PROGRAM-VARIABLES.                                        02040013
020500     05  PV-QUE-NM-OUTPUT           PIC X(50)  VALUE SPACES.      02050013
020600     05  PV-CURRENT-PRC-CNTL-TMST   PIC X(26)  VALUE SPACES.      02060013
020700     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.02070013
020800     05  PV-ITEM-COUNTER            PIC S9(04) VALUE +0 COMP SYNC.02080013
020900     05  PV-PARAGRAPH               PIC X(48)  VALUE SPACES.      02090013
021000     05  PV-REC-SEQ-NBR             PIC S9(09) VALUE +0 COMP.     02100013
021100     05  PV-VERSION-CNTL-NBR        PIC S9(02)V9(02) COMP-3.      02110013
021200     05  PV-MSG-LENGTH              PIC S9(9)  BINARY.            02120013
021300     05  PV-DATA-LENGTH             PIC S9(9) BINARY.             02130013
021400     05  PV-HOLD-COMPLETION-CODE    PIC S9(9)  BINARY.            02140013
021500     05  PV-HOLD-REASON             PIC S9(9)  BINARY.            02150013
021600     05  PV-HOLD-CORRELID           PIC  X(24) VALUE SPACES.      02160013
021700     05  PV-REC-TYP-LENGTH          PIC 9(09)  VALUE 3.           02170013
021800     05  PV-LAST-CNTL-SEQ-NBR       PIC S9(09) VALUE +0 COMP.     02180013
021900     05  PV-MSG-SIZE                PIC 9(09)  VALUE ZEROES.      02190013
022000     05  PV-HDR-LENGTH              PIC 9(09)  VALUE ZEROES.      02200013
022100     05  77-DTL-LENGTH              PIC 9(09)  VALUE ZEROES.      02210013
022200     05  PV-GFT-LENGTH              PIC 9(09)  VALUE ZEROES.      02220013
022300                                                                  02230013
022400     05  PV-EDIT-INTR-UPC-ID        PIC S9(18) COMP.              02240013
022500     05  PV-INTR-UPC-ID-R REDEFINES PV-EDIT-INTR-UPC-ID.          02250013
022600         10  FILLER                 PIC X(04).                    02260013
022700         10  PV-INTR-UPC-ID-COMP    PIC S9(09) COMP.              02270013
022800     05  PV-INTR-UPC-ID             PIC S9(09) COMP.              02280013
022900                                                                  02290013
023000     05  PV-EDIT-INTR-UPC-ID-NEW    PIC S9(18) COMP.              02300013
023100     05  PV-INTR-UPC-ID-NEW-R REDEFINES PV-EDIT-INTR-UPC-ID-NEW.  02310013
023200         10  FILLER                     PIC X(04).                02320013
023300         10  PV-INTR-UPC-ID-NEW-COMP    PIC S9(09) COMP.          02330013
023400     05  PV-INTR-UPC-ID-NEW             PIC S9(09) COMP.          02340013
023500                                                                  02350013
023600     05  PV-EDIT-UPC-ID             PIC S9(18) COMP.              02360013
023700     05  PV-UPC-ID-R REDEFINES PV-EDIT-UPC-ID.                    02370013
023800         10  FILLER                 PIC X(04).                    02380013
023900         10  PV-UPC-ID-COMP         PIC S9(09) COMP.              02390013
024000     05  PV-UPC-ID                  PIC S9(09) COMP.              02400013
024100                                                                  02410013
024200     05  PV-EDIT-REN-UPC-ID         PIC S9(18) COMP.              02420013
024300     05  PV-REN-UPC-ID-R REDEFINES PV-EDIT-REN-UPC-ID.            02430013
024400         10  FILLER                 PIC X(04).                    02440013
024500         10  PV-REN-UPC-ID-COMP     PIC S9(09) COMP.              02450013
024600     05  PV-REN-UPC-ID              PIC S9(09) COMP.              02460013
025000                                                                  02500013
025100 01  PV-CURRENT-TMST                PIC X(26)  VALUE SPACES.      02510013
025200 01  FILLER REDEFINES                                             02520013
025300     PV-CURRENT-TMST.                                             02530013
025400     05  PV-TMST-CCYY-MM-DD         PIC X(10).                    02540013
025500     05  FILLER                     PIC X(01).                    02550013
025600     05  PV-TMST-HH-MM-SS           PIC 9(08).                    02560013
025700     05  FILLER                     PIC X(01).                    02570013
025800     05  PV-TMST-LAST6              PIC 9(06).                    02580013
025900                                                                  02590013
026000 01  PV-DATE-TIME.                                                02600013
026100     05  PV-DATE-TIME-CCYY            PIC X(04) VALUE SPACE.      02610013
026200     05  FILLER                       PIC X(01) VALUE SPACE.      02620013
026300     05  PV-DATE-TIME-MM              PIC X(02) VALUE SPACE.      02630013
026400     05  FILLER                       PIC X(01) VALUE SPACE.      02640013
026500     05  PV-DATE-TIME-DD              PIC X(02) VALUE SPACE.      02650013
026600     05  FILLER                       PIC X(01) VALUE SPACE.      02660013
026700     05  PV-DATE-TIME-HH              PIC X(02) VALUE SPACE.      02670013
026800     05  FILLER                       PIC X(01) VALUE SPACE.      02680013
026900     05  PV-DATE-TIME-MN              PIC X(02) VALUE SPACE.      02690013
027000     05  FILLER                       PIC X(01) VALUE SPACE.      02700013
027100     05  PV-DATE-TIME-SS              PIC X(02) VALUE SPACE.      02710013
027200     05  FILLER                       PIC X(07) VALUE SPACE.      02720013
027300                                                                  02730013
027400*PV-MSG IS WHAT GETS BROKEN DOWN INTO DTLS/GFTS/END               02740013
027500 01  PV-MSG.                                                      02750013
027600     05  PV-MSG-END                 PIC X(18).                    02760013
027700         88 PV-END-RUN-MSG          VALUE 'END RUN OF PROGRAM'.   02770013
027800     05  FILLER                     PIC X(432).                   02780013
027900                                                                  02790013
028000 01  PV-DTL.                                                      02800013
028100     05  PV-DTL-EVENT               PIC 9(03)   VALUE ZERO.       02810013
028200     05  FILLER                     PIC X(447)  VALUE SPACE.      02820013
028300                                                                  02830013
028400 01  PV-HOLD-FIELDS.                                              02840013
028500     05  PV-HOLD-HDR                PIC X(568)  VALUE SPACE.      02850013
028600     05  PV-HOLD-ITEM.                                            02860013
028700         10  PV-HOLD-DTL            PIC X(245)  VALUE SPACE.      02870013
028800         10  PV-HOLD-GFT            PIC X(303)  VALUE SPACE.      02880013
028900                                                                  02890013
029000 01  PV-ABEND-VARIABLES.                                          02900013
029100     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.02910013
029200     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 02920013
029300     88  ABEND-4002-READ-ERROR                       VALUE +4002. 02930013
029400     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 02940013
029500     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 02950013
029600     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 02960013
029700     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 02970013
029800     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 02980013
029900     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 02990013
030000     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 03000013
030100     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 03010013
030200     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 03020013
030300     88  ABEND-4020-MQ-ERROR                         VALUE +4020. 03030013
030400     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 03040013
030500                                                                  03050013
030600 01  PE-MQ-ABEND-VARIABLES.                                       03060013
030700     10  PE-MQ-QMANAGER             PIC X(05) VALUE SPACES.       03070013
030800     10  PE-MQ-QNAME                PIC X(30) VALUE SPACES.       03080013
030900     10  PE-MQ-COMPLETION-CODE      PIC 9(04) VALUE ZEROS.        03090013
031000     10  PE-MQ-REASON-CODE          PIC 9(04) VALUE ZEROS.        03100013
031100                                                                  03110013
031200****************************************************************  03120013
031300**     M Q   S E R I E S    W O R K I N G   S T O R A G E     *   03130013
031400**                                                                03140013
031500**                  M  Q    C O P Y B O O K S                     03150013
031600*                                                                 03160013
031700*                                                                 03170013
031800*                                                                 03180013
031900****************************************************************  03190013
032000 01  MQM-OBJECT-DESCRIPTOR.                                       03200013
032100     COPY CMQODV.                                                 03210013
032200                                                                  03220013
032300 01  MQM-MESSAGE-DESCRIPTOR.                                      03230013
032400     COPY CMQMDV.                                                 03240013
032500                                                                  03250013
032600 01  MQM-GET-MESSAGE-OPTIONS.                                     03260013
032700     COPY CMQGMOV.                                                03270013
032800                                                                  03280013
032900 01  MQM-PUT-MESSAGE-OPTIONS.                                     03290013
033000     COPY CMQPMOV.                                                03300013
033100                                                                  03310013
033200 01  MQM-CONSTANTS.                                               03320013
033300     COPY CMQV.                                                   03330013
033400                                                                  03340013
033500****************************************************************  03350013
033600** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND    **  03360013
033700*  OPEN, CONNECT, DISCONNECT.                                     03370013
033800*                                                                 03380013
033900****************************************************************  03390013
034000 01  MQ-WORKING-STORAGE.                                          03400013
034100     05  PC-MQCONN                PIC X(08)   VALUE 'CSQBCONN'.   03410013
034200     05  PC-MQOPEN                PIC X(08)   VALUE 'CSQBOPEN'.   03420013
034300     05  PC-MQINQ                 PIC X(08)   VALUE 'CSQBINQ'.    03430013
034400     05  PC-MQPUT                 PIC X(8)    VALUE 'CSQBPUT'.    03440013
034500     05  PC-MQGET                 PIC X(08)   VALUE 'CSQBGET'.    03450013
034600     05  PC-MQCMIT                PIC X(8)    VALUE 'CSQBCOMM'.   03460013
034700     05  PC-MQBACK                PIC X(8)    VALUE 'CSQBBACK'.   03470013
034800     05  PC-MQCLOSE               PIC X(08)   VALUE 'CSQBCLOS'.   03480013
034900     05  PC-MQDISC                PIC X(08)   VALUE 'CSQBDISC'.   03490013
035000     05  PC-QMGR-NAME                 PIC X(4)  VALUE SPACES.     03500013
035100         88  PC-PROD-QMGR-NAME                  VALUE 'QKSP'.     03510013
035200         88  PC-ACCEPT-QMGR-NAME                VALUE 'QKSQ'.     03520013
035300         88  PC-TEST-QMGR-NAME                  VALUE 'QKST'.     03530013
035400     05  PC-RESPONSE-QNAME            PIC X(30) VALUE SPACES.     03540013
035500     05  PC-WAIT-15-SECS              PIC S9(9) VALUE 15000.      03550013
035600     05  PC-WAIT-6-SECS               PIC S9(9) VALUE 6000.       03560013
035700     05  PC-DELAY-INTERVAL.                                       03570013
035800         10  FILLER                   PIC X(2)  VALUE SPACES.     03580013
035900         10  PC-DELAY-TIME            PIC 9(8)  VALUE 1500.       03590013
036000                                                                  03600013
036100****************************************************************  03610013
036200** QUEUE MANAGER HANDLE                                           03620013
036300*  QUEUE HANDLES                                                  03630013
036400*                                                                 03640013
036500*                                                                 03650013
036600****************************************************************  03660013
036700 01 PV-MQ-PROGRAM-HANDLES.                                        03670013
036800     05  PV-QMGR-NAME                 PIC X(48).                  03680013
036900     05  PV-HCONN                     PIC S9(9) BINARY VALUE 0.   03690013
037000     05  PV-GQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   03700013
037100     05  PV-PQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   03710013
037200                                                                  03720013
037300****************************************************************  03730013
037400**                                                                03740013
037500*                                                                 03750013
037600* ERROR PROCESSING VARIABLES                                      03760013
037700* CODES FROM CALLS ARE STORED HERE                                03770013
037800****************************************************************  03780013
037900 01 PV-MQ-PROGRAM-VARIABLES.                                      03790013
038000     05  PV-COMPLETION-CODE           PIC S9(9) BINARY.           03800013
038100     05  PV-REASON                    PIC S9(9) BINARY.           03810013
038200     05  PV-CON-REASON                PIC S9(9) BINARY.           03820013
038300     05  PV-ERROR-MESSAGE             PIC X(48) VALUE SPACES.     03830013
038400     05  PV-OPEN-OPTIONS              PIC S9(9) BINARY.           03840013
038500     05  PV-MSGBUFFER                 PIC X(450) VALUE SPACES.    03850013
038600     05  PV-ERRMSGBUF                 PIC X(500) VALUE SPACES.    03860013
038700     05  PV-MQCHECK                   PIC X(8)  VALUE 'MQR2C'.    03870013
038800     05  PV-MQ-REASON-TEXT            PIC X(30) VALUE SPACES.     03880013
038900                                                                  03890013
039000****************************************************************  03900013
039100**                     E N D   O F   M Q                          03910013
039200*                                                                 03920013
039300*                                                                 03930013
039400****************************************************************  03940013
039500****************************************************************  03950013
039600 PROCEDURE DIVISION.                                              03960013
039700******************************************************************03970013
039800 0000-PROGRAM-MAINLINE.                                           03980013
039900     DISPLAY '************ START OF WSKUT013 ***************'     03990013
040000                                                                  04000013
040100*INIT VARIBLES, SET SWITCHES.                                     04010013
040200     PERFORM 1000-INITIALIZE.                                     04020013
040300     PERFORM 1100-SET-CURRENT-TMST.                               04030013
040400                                                                  04040013
040500*READ TABLES(FOR QUEUE MANAGER/QUEUE NAMES).                      04050013
040600     PERFORM 1200-GET-QUEUE-NAMES.                                04060013
040700                                                                  04070013
040800*OPEN OUTPUT SEQUENTIAL FILE.                                     04080013
040900     OPEN OUTPUT OUTPUT-FILE.                                     04090013
041000     INITIALIZE OUTPUT-RECORD.                                    04100013
041100                                                                  04110013
041200*CONNECT TO QUEUE MANAGER.                                        04120013
041300     PERFORM 3100-MQ-CONNECT-TO-QMGR.                             04130013
041400                                                                  04140013
041500*OPEN THE QUEUE FOR GETS.                                         04150013
041600     PERFORM 3200-MQ-QUEUE-OPEN.                                  04160013
041700                                                                  04170013
041800*GET FIRST MSG FROM QUEUE.                                        04180013
041900     PERFORM 3300-MQ-GET-MSG.                                     04190013
042000                                                                  04200013
042100*PROCESS THE ITEM MESSAGES.                                       04210013
042200     PERFORM 2000-PROCESS-MSGS                                    04220013
042300         UNTIL PS-TIME-TO-END-PROGRAM-YES.                        04230013
042400                                                                  04240013
042500******************************************************************04250013
042600* INITIALIZE VARIABLES.                                           04260013
042700* SET SWITCHES.                                                   04270013
042800******************************************************************04280013
042900 1000-INITIALIZE.                                                 04290013
043000                                                                  04300013
043100     INITIALIZE   PA-TOTAL-GETS                                   04310013
043200                  PA-TOTAL-MQ-COMMITS                             04320013
043300                  PV-HOLD-FIELDS                                  04330013
043400                  PV-MSG-LENGTH                                   04340013
043500                  PV-DATA-LENGTH.                                 04350013
043600                                                                  04360013
043700*INIT SWITCHES USED FOR EDITING EACH MSG, CONTINUING RUN OF       04370013
043800*PROGRAM AND OPENING OF THE ERROR QUEUE. ERROR QUEUE IS           04380013
043900*ONLY OPENED IF ERROR IS ENCOUNTERED, AND THEN REMAINS OPEN.      04390013
044000     SET PS-TIME-TO-END-PROGRAM-NO                                04400013
044100         PS-ERROR-QUEUE-IS-OPEN-NO  TO TRUE.                      04410013
044200                                                                  04420013
044300******************************************************************04430013
044400* SET THE CURRENT TIMESTAMP.                                      04440013
044500******************************************************************04450013
044600 1100-SET-CURRENT-TMST.                                           04460013
044700                                                                  04470013
044800     EXEC SQL                                                     04480013
044900         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 04490013
045000     END-EXEC                                                     04500013
045100                                                                  04510013
045200     EVALUATE TRUE                                                04520013
045300        WHEN SQLCODE = ZERO                                       04530013
045400            CONTINUE                                              04540013
045500                                                                  04550013
045600        WHEN SQLWARN0 NOT = SPACES                                04560013
045700        WHEN SQLCODE  NOT = ZERO                                  04570013
045800            DISPLAY '**************************************'      04580013
045900            DISPLAY '** ABEND                            **'      04590013
046000            DISPLAY '** PROGRAM = WSKUT013               **'      04600013
046100            DISPLAY '** PARAGRAPH = 1100-SET-CURRENT-TMST**'      04610013
046200            DISPLAY '** SET CURRENT TIMESTAMP            **'      04620013
046300            DISPLAY '** SQLCODE = ' SQLCODE                       04630013
046400            DISPLAY '**************************************'      04640013
046500            PERFORM 9100-SQL-ABEND                                04650013
046600     END-EVALUATE.                                                04660013
046700                                                                  04670013
046800****************************************************************  04680013
046900* READ TABLE VIEWS FOR QMGR NAME AND QUEUE NQME.                  04690013
047000* EACH TABLE VIEW MUST CONTAIN A NAME THAT IS NOT SPACES.         04700013
047100****************************************************************  04710013
047200 1200-GET-QUEUE-NAMES.                                            04720013
047300                                                                  04730013
047400*SELECT FROM WSV_CNSMR_QUE (WSV00006) FOR QUEUE MANAGER NAME      04740013
047500      PERFORM 1400-GET-INPUT-QUEUE-NAME.                          04750013
047600                                                                  04760013
047700                                                                  04770013
047800*SELECT FROM WSV_PRVDR_QUE (WSV00005) FOR ERROR QUEUE NAME        04780013
047900      PERFORM 1500-GET-ERROR-QUEUE-NAME.                          04790013
048000                                                                  04800013
048100/                                                                 04810013
048200****************************************************************  04820013
048300* INIT SOME FIELDS BEFORE THE NEXT ITEM IS PROCESSED.             04830013
048400* RESET SOME SWITCHES.                                            04840013
048500****************************************************************  04850013
048600 1300-REINITIALIZE.                                               04860013
048700                                                                  04870013
048800     INITIALIZE PV-MSG                                            04880013
048900                PV-MSGBUFFER                                      04890013
049000                PV-ERRMSGBUF                                      04900013
049100                PV-REC-SEQ-NBR.                                   04910013
049200                                                                  04920013
049300****************************************************************  04930013
049400* SELECT FROM WSV_CNSMR_QUE (WSV00006) FOR INPUT QUEUE NAME       04940013
049500****************************************************************  04950013
049600 1400-GET-INPUT-QUEUE-NAME.                                       04960013
049700                                                                  04970013
049800       EXEC SQL                                                   04980013
049900           SELECT                                                 04990013
050000                 QUE_NM,                                          05000013
050100                 QUE_MGR                                          05010013
050200           INTO                                                   05020013
050300                :WSV00006-QUE-NM,                                 05030013
050400                :WSV00006-QUE-MGR                                 05040013
050500           FROM WSV_CNSMR_QUE                                     05050013
050600           WHERE INTGRTN_TYP_CDE  =  'PIXINTRNST'                 05060013
050700       END-EXEC                                                   05070013
050800                                                                  05080013
050900       EVALUATE TRUE                                              05090013
051000           WHEN SQLCODE = +0                                      05100013
051100               CONTINUE                                           05110013
051200                                                                  05120013
051300           WHEN SQLCODE = +100                                    05130013
051400               SET PS-ERROR-YES TO TRUE                           05140013
051500               PERFORM 9200-MQ-ABEND                              05150013
051600                                                                  05160013
051700           WHEN SQLWARN0 NOT = SPACES                             05170013
051800           WHEN SQLCODE  NOT = ZERO                               05180013
051900             DISPLAY '******************************************' 05190013
052000             DISPLAY '*ABEND                                   *' 05200013
052100             DISPLAY '*PROGRAM   = WSKUT013                    *' 05210013
052200             DISPLAY '*DB2 OPER  = WSV_CNSMR_QUE              *'  05220013
052300             DISPLAY '*PARAGRAPH = 1400-GET-INPUT-QUEUE-NAME   *' 05230013
052400             DISPLAY '*SQLCODE = ' SQLCODE                        05240013
052500             DISPLAY '******************************************' 05250013
052600             PERFORM 9100-SQL-ABEND                               05260013
052700       END-EVALUATE.                                              05270013
052800/                                                                 05280013
052900****************************************************************  05290013
053000* SELECT FROM WSV_PRVDR_QUE (WSV00005) FOR ERROR QUEUE NAME       05300013
053100****************************************************************  05310013
053200 1500-GET-ERROR-QUEUE-NAME.                                       05320013
053300                                                                  05330013
053400       EXEC SQL                                                   05340013
053500           SELECT                                                 05350013
053600                 QUE_NM,                                          05360013
053700                 LCL_QUE_MGR                                      05370013
053800           INTO                                                   05380013
053900                :WSV00005-QUE-NM,                                 05390013
054000                :WSV00005-LCL-QUE-MGR                             05400013
054100           FROM WSV_PRVDR_QUE                                     05410013
054200           WHERE INTGRTN_TYP_CDE  =  'PIXLGCYERR'                 05420013
054300       END-EXEC                                                   05430013
054400                                                                  05440013
054500       EVALUATE TRUE                                              05450013
054600           WHEN SQLCODE = +0                                      05460013
054700                CONTINUE                                          05470013
054800                                                                  05480013
054900           WHEN SQLCODE = +100                                    05490013
055000               SET PS-ERROR-YES TO TRUE                           05500013
055100               PERFORM 9200-MQ-ABEND                              05510013
055200                                                                  05520013
055300           WHEN SQLWARN0 NOT = SPACES                             05530013
055400           WHEN SQLCODE  NOT = ZERO                               05540013
055500             DISPLAY '******************************************' 05550013
055600             DISPLAY '*ABEND                                   *' 05560013
055700             DISPLAY '*PROGRAM   = WSKUT013                    *' 05570013
055800             DISPLAY '*DB2 OPER  = WSV_PRVDR_QUE              *'  05580013
055900             DISPLAY '*PARAGRAPH = 1500-GET-ERROR-QUEUE-NAME   *' 05590013
056000             DISPLAY '*SQLCODE = ' SQLCODE                        05600013
056100             DISPLAY '******************************************' 05610013
056200             PERFORM 9100-SQL-ABEND                               05620013
056300       END-EVALUATE.                                              05630013
056400/                                                                 05640013
056500****************************************************************  05650013
056600* WRITE RECORD TO OUTPUT FILE.                                    05660013
056700****************************************************************  05670013
056800 1600-BUILD-OUTPUT-FILE.                                          05680013
056900                                                                  05690013
058000     MOVE WS014-CASE-NUMBER    TO CE015-CONTAINER-ID.             05800016
058100     MOVE WS014-STORE-NUMBER   TO CE015-LOCATION.                 05810016
058200     MOVE WS014-SKU-QTY        TO CE015-UNIT-QTY.                 05820016
058300     MOVE WS014-CRE-TMST       TO PV-DATE-TIME.                   05830013
058400     MOVE PV-DATE-TIME-CCYY    TO CE015-TRANS-YR.                 05840016
058500     MOVE PV-DATE-TIME-MM      TO CE015-TRANS-MO.                 05850016
058600     MOVE PV-DATE-TIME-DD      TO CE015-TRANS-DA.                 05860016
058700     MOVE PV-DATE-TIME-HH      TO CE015-TRANS-HR.                 05870016
058800     MOVE PV-DATE-TIME-MN      TO CE015-TRANS-MI.                 05880016
058900     SET  CE015-RECEIPT-TRANS  TO TRUE.                           05890016
059000     MOVE WS014-PO-NUMBER      TO CE015-PO-NBR.                   05900016
059100/                                                                 05910013
059200****************************************************************  05920013
059300* BUILD MESSAGE TO WRITE TO ERROR QUEUE USING WSRD020 COPYBOOK    05930013
059400****************************************************************  05940013
059500 1700-BUILD-ERROR-MESSAGE.                                        05950013
059600                                                                  05960013
059700     SET WS020-INVALID-REC         TO TRUE.                       05970013
059800     MOVE 'WSKUT013'               TO WS020-ERROR-PGM-NAME.       05980013
059900     MOVE WS014-RECEIPT-PIX-RECORD TO WS020-WSRD014-RECORD.       05990013
060000     MOVE 4095 TO RETURN-CODE.                                    06000013
060100                                                                  06010013
060200                                                                  06020013
064500******************************************************************06450013
064510* BREAKDOWN AND EDIT A MSG.                                       06451013
064520* EDIT DB2 TABLES -OR- PUT A MSG IN ERROR TO ERROR QUEUE.         06452013
064521* GET THE NEXT MSG.                                               06452113
064522******************************************************************06452213
064523 2000-PROCESS-MSGS.                                               06452313
064524                                                                  06452413
064525     PERFORM                                                      06452513
064526       UNTIL (PV-COMPLETION-CODE IS EQUAL TO MQCC-FAILED)         06452613
064527       IF  PA-COMMIT-TRIGGER-COUNT > 499                          06452713
064528           PERFORM 3600-MQ-COMMIT                                 06452813
064529           MOVE +1 TO PA-COMMIT-TRIGGER-COUNT                     06452913
064530       END-IF                                                     06453013
064531                                                                  06453113
064532       IF (WS014-RTE-TO-INTRANSIT AND WS014-CASE-RECEIPT)  OR     06453213
064533          (WS014-RTE-TO-RCVNG     AND WS014-CASE-RECEIPT)         06453313
064534          CONTINUE                                                06453413
064535       ELSE                                                       06453513
064536          SET PS-ERROR-YES TO TRUE                                06453613
064537       END-IF                                                     06453713
064538                                                                  06453813
064539*IF NO ERRORS, WRITE OUTPUT FILE                                  06453913
064540*ELSE REINIT AND RESET SWITCHES AND GO AFTER THE NEXT MSG         06454013
064550*(NEW ITEM) ON THE QUEUE.                                         06455013
064560       IF PS-ERROR-YES                                            06456013
064570          PERFORM 7100-ERROR-ROUTINE                              06457013
064580          MOVE 2000  TO  WS020-ERROR-PARA-NBR                     06458013
064590          PERFORM 1700-BUILD-ERROR-MESSAGE                        06459013
064600          PERFORM 3800-PUT-MSG-TO-ERROR-Q                         06460013
064700          PERFORM 3600-MQ-COMMIT                                  06470013
064800       ELSE                                                       06480013
064900          PERFORM 1600-BUILD-OUTPUT-FILE                          06490013
065000          PERFORM 8300-WRITE-OUTPUT-FILE                          06500013
065100       END-IF                                                     06510013
065200                                                                  06520013
065300                                                                  06530013
065400*THIS MOVES THE LEGACY ITEM MAINT RECORD TO A BACKUP              06540013
065500*    PERFORM 7900-BACKUP-ITEM-QUEUE-MSG.                          06550013
065600       PERFORM 1300-REINITIALIZE                                  06560013
065700                                                                  06570013
065800*GET NEXT MESSAGE FROM QUEUE.                                     06580013
065900       SET PS-ERROR-NO TO TRUE                                    06590013
066000       PERFORM 3300-MQ-GET-MSG                                    06600013
066100     END-PERFORM.                                                 06610013
066200                                                                  06620013
066300     PERFORM 5000-END-RUN-ROUTINE.                                06630013
066400                                                                  06640013
066500******************************************************************06650013
066600******************************************************************06660013
066700                                                                  06670013
066800****************************************************************  06680013
066900*                                                                 06690013
067000*                                                                 06700013
067100**   B E G I N     M Q    S E R I E S     P A R A G R A P H S **  06710013
067200*                                                                 06720013
067300*                                                                 06730013
067400****************************************************************  06740013
067500                                                                  06750013
067600****************************************************************  06760013
067700** CONNECT TO THE QUEUE MANAGER                                   06770013
067800**                                                                06780013
067900** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 06790013
068000****************************************************************  06800013
068100 3100-MQ-CONNECT-TO-QMGR.                                         06810013
068200                                                                  06820013
068300     MOVE '3100-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              06830013
068400*                                                                 06840013
068500* CONNECT TO THE QUEUE                                            06850013
068600* WSV_CNSMR_QUE  - QMGR NAME                                      06860013
068700*                                                                 06870013
068800                                                                  06880013
068900     MOVE WSV00006-QUE-MGR-TEXT    TO PV-QMGR-NAME.               06890013
069000                                                                  06900013
069100     CALL PC-MQCONN USING PV-QMGR-NAME                            06910013
069200                          PV-HCONN                                06920013
069300                          PV-COMPLETION-CODE                      06930013
069400                          PV-REASON.                              06940013
069500                                                                  06950013
069600*IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE AND EXIT         06960013
069700     MOVE PV-REASON TO PV-CON-REASON.                             06970013
069800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06980013
069900         CONTINUE                                                 06990013
070000     ELSE                                                         07000013
070100         CALL PV-MQCHECK USING PV-REASON                          07010013
070200                               PV-MQ-REASON-TEXT                  07020013
070300         MOVE PV-QMGR-NAME         TO PE-MQ-QMANAGER              07030013
070400         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       07040013
070500         MOVE PV-REASON            TO PE-MQ-REASON-CODE           07050013
070600         MOVE 'CONNECT TO QMGR'    TO PV-ERROR-MESSAGE            07060013
070700         PERFORM 9200-MQ-ABEND                                    07070013
070800     END-IF.                                                      07080013
070900                                                                  07090013
071000****************************************************************  07100013
071100** OPEN THE ITEM QUEUE FOR GETS.                                  07110013
071200****************************************************************  07120013
071300 3200-MQ-QUEUE-OPEN.                                              07130013
071400                                                                  07140013
071500     MOVE '3200-MQ-QUEUE-OPEN'     TO PV-PARAGRAPH.               07150013
071600*                                                                 07160013
071700* WSV_CNSMR_QUE - QUEUE NAME                                      07170013
071800*                                                                 07180013
071900                                                                  07190013
072000                                                                  07200013
072100     MOVE WSV00006-QUE-NM-TEXT     TO MQOD-OBJECTNAME             07210013
072200     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        07220013
072300                                                                  07230013
072400     COMPUTE PV-OPEN-OPTIONS       = MQOO-INPUT-SHARED            07240013
072500                                   + MQOO-OUTPUT                  07250013
072600                                   + MQOO-SET-IDENTITY-CONTEXT    07260013
072700                                   + MQOO-FAIL-IF-QUIESCING.      07270013
072800                                                                  07280013
072900     CALL PC-MQOPEN USING PV-HCONN                                07290013
073000                          MQM-OBJECT-DESCRIPTOR                   07300013
073100                          PV-OPEN-OPTIONS                         07310013
073200                          PV-GQ-HANDLE                            07320013
073300                          PV-COMPLETION-CODE                      07330013
073400                          PV-REASON.                              07340013
073500                                                                  07350013
073600     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07360013
073700         CONTINUE                                                 07370013
073800     ELSE                                                         07380013
073900         CALL PV-MQCHECK USING PV-REASON                          07390013
074000                               PV-MQ-REASON-TEXT                  07400013
074100         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           07410013
074200         MOVE WSV00006-QUE-NM-TEXT    TO PE-MQ-QNAME              07420013
074300         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    07430013
074400         MOVE PV-REASON               TO PE-MQ-REASON-CODE        07440013
074500         MOVE 'OPEN ITEM QUEUE'       TO PV-ERROR-MESSAGE         07450013
074600         PERFORM 9200-MQ-ABEND                                    07460013
074700     END-IF.                                                      07470013
074800                                                                  07480013
074900****************************************************************  07490013
075000** OPEN THE ITEM QUEUE FOR PUTS.                                  07500013
075100****************************************************************  07510013
075200 3205-MQ-ERROR-QUEUE-OPEN.                                        07520013
075300                                                                  07530013
075400     MOVE '3205-MQ-ERROR-QUEUE-OPEN' TO PV-PARAGRAPH.             07540013
075500*                                                                 07550013
075600* CONTROL CARD 3 - ERROR QUEUE NAME                               07560013
075700*                                                                 07570013
075800                                                                  07580013
075900     MOVE WSV00005-QUE-NM-TEXT       TO MQOD-OBJECTNAME.          07590013
076000     MOVE WSV00005-LCL-QUE-MGR-TEXT  TO MQOD-OBJECTQMGRNAME.      07600013
076100                                                                  07610013
076200     COMPUTE PV-OPEN-OPTIONS       = MQOO-OUTPUT                  07620013
076300                                   + MQOO-SET-IDENTITY-CONTEXT    07630013
076400                                   + MQOO-FAIL-IF-QUIESCING.      07640013
076500                                                                  07650013
076600     CALL PC-MQOPEN USING PV-HCONN                                07660013
076700                          MQM-OBJECT-DESCRIPTOR                   07670013
076800                          PV-OPEN-OPTIONS                         07680013
076900                          PV-PQ-HANDLE                            07690013
077000                          PV-COMPLETION-CODE                      07700013
077100                          PV-REASON.                              07710013
077200                                                                  07720013
077300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07730013
077400         SET PS-ERROR-QUEUE-IS-OPEN-YES TO TRUE                   07740013
077500     ELSE                                                         07750013
077600         CALL PV-MQCHECK USING PV-REASON                          07760013
077700                               PV-MQ-REASON-TEXT                  07770013
077800         MOVE PV-QMGR-NAME         TO PE-MQ-QMANAGER              07780013
077900         MOVE WSV00005-QUE-NM      TO PE-MQ-QNAME                 07790013
078000         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       07800013
078100         MOVE PV-REASON            TO PE-MQ-REASON-CODE           07810013
078200         MOVE 'OPEN ERROR QUEUE'   TO PV-ERROR-MESSAGE            07820013
078300         PERFORM 9200-MQ-ABEND                                    07830013
078400     END-IF.                                                      07840013
078500                                                                  07850013
078600****************************************************************  07860013
078700** GET THE FIRST MESSAGE FROM THE QUEUE.                          07870013
078800** THE QUEUE IS SET UP SO MSGS ARE RETRIEVED IN FIFO ORDER.       07880013
078900****************************************************************  07890013
079000 3300-MQ-GET-MSG.                                                 07900013
079100                                                                  07910013
079200     INITIALIZE PV-MSGBUFFER                                      07920013
079300                PV-ERRMSGBUF                                      07930013
079400                PV-DTL                                            07940013
079500                PV-MSG.                                           07950013
079600                                                                  07960013
079700*MSG ID IS NOT POPULATED IN THIS PGM.                             07970013
079800     MOVE MQMI-NONE TO MQMD-MSGID.                                07980013
079900                                                                  07990013
080000*MSGS ARE UNQUALIFIED IN THIS PGM.                                08000013
080100     MOVE MQCI-NONE         TO MQMD-CORRELID.                     08010013
080200                                                                  08020013
080300*FORMAT TRANSLATES THE DATA ACROSS PLATFORMS, 4K IS THE           08030013
080400*MAX LENGTH FOR MSGS IN THE PGM.                                  08040013
080500     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    08050013
080600     MOVE +450                 TO PV-MSG-LENGTH.                  08060013
080700                                                                  08070013
080800*THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL JUST      08080013
080900* 'WAIT' UNTIL A MESSAGE APPEARAS ON THE Q.                       08090013
081000*    MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             08100013
081100                                                                  08110013
081200     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  08120013
081300                               MQGMO-CONVERT   +                  08130013
081400                               MQGMO-ACCEPT-TRUNCATED-MSG +       08140013
081500                               MQGMO-WAIT.                        08150013
081600                                                                  08160013
081700     CALL PC-MQGET USING PV-HCONN                                 08170013
081800                         PV-GQ-HANDLE                             08180013
081900                         MQM-MESSAGE-DESCRIPTOR                   08190013
082000                         MQM-GET-MESSAGE-OPTIONS                  08200013
082100                         PV-MSG-LENGTH                            08210013
082200                         PV-MSGBUFFER                             08220013
082300                         PV-DATA-LENGTH                           08230013
082400                         PV-COMPLETION-CODE                       08240013
082500                         PV-REASON.                               08250013
082600                                                                  08260013
082700*IF GET FAILED THEN DISPLAY ERROR MESSAGE                         08270013
082800*AND BREAK OUT OF LOOP                                            08280013
082900     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        08290013
083000         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              08300013
083100          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      08310013
083200             CALL PV-MQCHECK USING PV-REASON                      08320013
083300                                   PV-MQ-REASON-TEXT              08330013
083400           MOVE 'MQGET ERROR'          TO PV-ERROR-MESSAGE        08340013
083500           MOVE '3300-MQ-GET-UNQUALIFIED' TO PV-PARAGRAPH         08350013
083600           MOVE PV-COMPLETION-CODE     TO PV-HOLD-COMPLETION-CODE 08360013
083700           MOVE PV-REASON              TO PV-HOLD-REASON          08370013
083800           PERFORM 3700-BACK-OUT-MQ                               08380013
083900           MOVE PV-HOLD-COMPLETION-CODE  TO PV-COMPLETION-CODE    08390013
084000                                            PE-MQ-COMPLETION-CODE 08400013
084100           MOVE PV-HOLD-REASON           TO PV-REASON             08410013
084200                                            PE-MQ-REASON-CODE     08420013
084300           PERFORM 9200-MQ-ABEND                                  08430013
084400         END-IF                                                   08440013
084500*THIS MEANS A MSG WAS TRUNCATED                                   08450013
084600         IF PV-COMPLETION-CODE = +1                               08460013
084700          AND PV-REASON = +2079                                   08470013
084800            PERFORM 4750-MSG-TOO-BIG-ERROR                        08480013
084900            ADD +1   TO PA-TOTAL-GETS                             08490013
085000                        PA-COMMIT-TRIGGER-COUNT                   08500013
085100         END-IF                                                   08510013
085200     ELSE                                                         08520013
085300        SET PS-GOOD-MSG-YES    TO TRUE                            08530013
085400        ADD +1                 TO PA-TOTAL-GETS                   08540013
085500                                  PA-COMMIT-TRIGGER-COUNT         08550013
085600*PV-MSG IS USED TO PARSE THE DATA, ITS AN ELEMENT THAT JUST       08560013
085700*HOLDS THE ENTIRE ITEM UNTIL                                      08570013
085800*IT IS EITHER LOADED TO THE DB2 TABLE OR PUT TO THE ERROR QUEUE.  08580013
085900        MOVE PV-MSGBUFFER                TO PV-MSG                08590013
086000        MOVE PV-MSGBUFFER                TO PV-DTL                08600013
086100                                                                  08610013
086200*THIS GETS THE MESSAGE TO THE COPYBOOK WSRD014                    08620013
086300* INITIALIZE INPUT AND OUTPUT COPYBOOK LAYOUTS (WSRD014, WMRD015) 08630013
086400                                                                  08640013
086500        INITIALIZE WS014-RECEIPT-PIX-RECORD                       08650013
086600        INITIALIZE CE015-RECEIPT-UPLOAD-RECORD                    08660016
086700        MOVE PV-MSGBUFFER TO WS014-RECEIPT-PIX-RECORD.            08670013
086800                                                                  08680013
086900*THE "END OF PROGRAM" MSG WILL SHUT DOWN THIS STARTED TASK.       08690013
087000*    IF PV-END-RUN-MSG                                            08700013
087100*       SET PS-TIME-TO-END-PROGRAM-YES TO TRUE                    08710013
087200*       ADD +1 TO PA-END-OF-RUN-MESSAGES                          08720013
087300*       SUBTRACT 1 FROM PA-TOTAL-GETS                             08730013
087400*       PERFORM 5000-END-RUN-ROUTINE                              08740013
087500*     END-IF.                                                     08750013
087600                                                                  08760013
087700*THE BUSINESS EVENT "999" WILL END PROCESS                        08770013
087800*AND SHUT DOWN THIS STARTED TASK.                                 08780013
087900                                                                  08790013
088000*    IF IM008-BUSINESS-EVENT-ID = 999                             08800013
088100*        SET PS-TIME-TO-END-PROGRAM-YES TO TRUE                   08810013
088200*        ADD +1 TO PA-999-STOP-PROC-MESSAGES                      08820013
088300*        SUBTRACT 1 FROM PA-TOTAL-GETS                            08830013
088400*        PERFORM 5000-END-RUN-ROUTINE                             08840013
088500*    END-IF.                                                      08850013
088600****************************************************************  08860013
088700** CLOSES THE TRANS QUEUE.                                        08870013
088800****************************************************************  08880013
088900 3400-MQ-QUEUE-CLOSE.                                             08890013
089000                                                                  08900013
089100     MOVE '3400-MQ-QUEUE-CLOSE'    TO PV-PARAGRAPH.               08910013
089200                                                                  08920013
089300     MOVE WSV00006-QUE-NM-TEXT     TO MQOD-OBJECTNAME.            08930013
089400     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        08940013
089500     CALL PC-MQCLOSE USING PV-HCONN                               08950013
089600                           PV-GQ-HANDLE                           08960013
089700                           MQCO-NONE                              08970013
089800                           PV-COMPLETION-CODE                     08980013
089900                           PV-REASON.                             08990013
090000                                                                  09000013
090100     IF PV-COMPLETION-CODE = MQCC-OK THEN                         09010013
090200         CONTINUE                                                 09020013
090300     ELSE                                                         09030013
090400         CALL PV-MQCHECK USING PV-REASON                          09040013
090500                               PV-MQ-REASON-TEXT                  09050013
090600         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           09060013
090700         MOVE WSV00006-QUE-NM-TEXT    TO PE-MQ-QNAME              09070013
090800         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    09080013
090900         MOVE PV-REASON               TO PE-MQ-REASON-CODE        09090013
091000         MOVE 'PE-MQ-CLOSE'           TO PV-ERROR-MESSAGE         09100013
091100         PERFORM 9200-MQ-ABEND                                    09110013
091200     END-IF.                                                      09120013
091300                                                                  09130013
091400****************************************************************  09140013
091500** CLOSES THE ERROR QUEUE.                                        09150013
091600****************************************************************  09160013
091700 3405-MQ-ERROR-QUEUE-CLOSE.                                       09170013
091800                                                                  09180013
091900     MOVE '3405-MQ-ERROR-QUEUE-CLOSE'  TO PV-PARAGRAPH.           09190013
092000                                                                  09200013
092100     MOVE WSV00005-QUE-NM          TO MQOD-OBJECTNAME.            09210013
092200     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        09220013
092300                                                                  09230013
092400     CALL PC-MQCLOSE USING PV-HCONN                               09240013
092500                           PV-PQ-HANDLE                           09250013
092600                           MQCO-NONE                              09260013
092700                           PV-COMPLETION-CODE                     09270013
092800                           PV-REASON.                             09280013
092900                                                                  09290013
093000     IF PV-COMPLETION-CODE = MQCC-OK THEN                         09300013
093100         SET PS-ERROR-QUEUE-IS-OPEN-NO TO TRUE                    09310013
093200     ELSE                                                         09320013
093300         CALL PV-MQCHECK USING PV-REASON                          09330013
093400                               PV-MQ-REASON-TEXT                  09340013
093500         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           09350013
093600         MOVE WSV00006-QUE-NM-TEXT    TO PE-MQ-QNAME              09360013
093700         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    09370013
093800         MOVE PV-REASON               TO PE-MQ-REASON-CODE        09380013
093900         MOVE 'PE-ERROR-Q-CLOSE'      TO PV-ERROR-MESSAGE         09390013
094000         PERFORM 9200-MQ-ABEND                                    09400013
094100     END-IF.                                                      09410013
094200                                                                  09420013
094300****************************************************************  09430013
094400** DISCONNECT FROM THE QUEUE MANAGER                              09440013
094500****************************************************************  09450013
094600 3500-DISCONNECT-QMGR.                                            09460013
094700                                                                  09470013
094800     MOVE '3500-DISCONNECT-QMGR'    TO PV-PARAGRAPH.              09480013
094900     CALL PC-MQDISC USING PV-HCONN                                09490013
095000                          PV-COMPLETION-CODE                      09500013
095100                          PV-REASON                               09510013
095200                                                                  09520013
095300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         09530013
095400        CONTINUE                                                  09540013
095500     ELSE                                                         09550013
095600         CALL PV-MQCHECK USING PV-REASON                          09560013
095700                               PV-MQ-REASON-TEXT                  09570013
095800        MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER            09580013
095900        MOVE WSV00006-QUE-NM-TEXT    TO PE-MQ-QNAME               09590013
096000        MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE     09600013
096100        MOVE PV-REASON               TO PE-MQ-REASON-CODE         09610013
096200        MOVE '3500-DISCONNECT-QMGR'  TO PV-ERROR-MESSAGE          09620013
096300        PERFORM 9200-MQ-ABEND                                     09630013
096400     END-IF.                                                      09640013
096500                                                                  09650013
096600******************************************************************09660013
096700*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        09670013
096800******************************************************************09680013
096900 3600-MQ-COMMIT.                                                  09690013
097000                                                                  09700013
097100     CALL PC-MQCMIT USING PV-HCONN                                09710013
097200                          PV-COMPLETION-CODE                      09720013
097300                          PV-REASON.                              09730013
097400                                                                  09740013
097500     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        09750013
097600         CALL PV-MQCHECK USING PV-REASON                          09760013
097700                               PV-MQ-REASON-TEXT                  09770013
097800        MOVE '3600-COMMIT-MQ'   TO PV-PARAGRAPH                   09780013
097900        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               09790013
098000        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        09800013
098100        MOVE PV-REASON          TO PV-HOLD-REASON                 09810013
098200        PERFORM 3700-BACK-OUT-MQ                                  09820013
098300        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        09830013
098400                                        PE-MQ-COMPLETION-CODE     09840013
098500        MOVE PV-HOLD-REASON          TO PV-REASON                 09850013
098600                                        PE-MQ-REASON-CODE         09860013
098700        PERFORM 9200-MQ-ABEND                                     09870013
098800     ELSE                                                         09880013
098900        ADD +1 TO PA-TOTAL-MQ-COMMITS                             09890013
099000     END-IF.                                                      09900013
099100                                                                  09910013
099200******************************************************************09920013
099300* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       09930013
099400******************************************************************09940013
099500 3700-BACK-OUT-MQ.                                                09950013
099600                                                                  09960013
099700     CALL PC-MQBACK USING PV-HCONN                                09970013
099800                          PV-COMPLETION-CODE                      09980013
099900                          PV-REASON.                              09990013
100000                                                                  10000013
100100     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   10010013
100200         CALL PV-MQCHECK USING PV-REASON                          10020013
100300                               PV-MQ-REASON-TEXT                  10030013
100400        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                  10040013
100500        MOVE 'MQBACK ERROR'      TO PV-ERROR-MESSAGE              10050013
100600        PERFORM 9200-MQ-ABEND                                     10060013
100700     END-IF.                                                      10070013
100800                                                                  10080013
100900****************************************************************  10090013
101000* PUT MESSAGE IN ERROR TO THE ITEM ERROR QUEUE                    10100013
101100****************************************************************  10110013
101200 3800-PUT-MSG-TO-ERROR-Q.                                         10120013
101300                                                                  10130013
101400*UPDATE THE ERROR MESSAGE COUNTER.                                10140013
101500     ADD +1 TO PA-TOTAL-ERRORQ-RECS.                              10150013
101600                                                                  10160013
101700*MSGID IS NOT POPULATED AT ALL IN THIS PGM.                       10170013
101800     MOVE MQMI-NONE        TO MQMD-MSGID.                         10180013
101900                                                                  10190013
102000*KEEP ORIGINAL CORRELID.                                          10200013
102100     MOVE PV-HOLD-CORRELID TO MQMD-CORRELID.                      10210013
102200                                                                  10220013
102300*PUT MSG BACK WITH CURRENT-TMST AND ERROR TYPE.                   10230013
102400     MOVE WS020-RECEIPT-PIX-ERROR-REC TO PV-ERRMSGBUF.            10240013
102500                                                                  10250013
102600*THE ENTIRE MSG LENGTH IS +500.                                   10260013
102700     MOVE +500 TO PV-MSG-LENGTH.                                  10270013
102800                                                                  10280013
102900*SET OPTIONS.                                                     10290013
103000     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        10300013
103100     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   10310013
103200     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  10320013
103300                               MQPMO-SET-IDENTITY-CONTEXT.        10330013
103400                                                                  10340013
103500*PUT MSG.                                                         10350013
103600     CALL PC-MQPUT USING PV-HCONN                                 10360013
103700                         PV-PQ-HANDLE                             10370013
103800                         MQM-MESSAGE-DESCRIPTOR                   10380013
103900                         MQM-PUT-MESSAGE-OPTIONS                  10390013
104000                         PV-MSG-LENGTH                            10400013
104100                         PV-ERRMSGBUF                             10410013
104200                         PV-COMPLETION-CODE                       10420013
104300                         PV-REASON.                               10430013
104400                                                                  10440013
104500*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         10450013
104600*AND BREAK OUT OF LOOP                                            10460013
104700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10470013
104800         CALL PV-MQCHECK USING PV-REASON                          10480013
104900                               PV-MQ-REASON-TEXT                  10490013
105000         DISPLAY 'MQ MESSAGE = ', PV-ERRMSGBUF                    10500013
105100         MOVE '3800-PUT-MSG-TO-ERROR-Q' TO PV-PARAGRAPH           10510013
105200         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         10520013
105300         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  10530013
105400         MOVE PV-REASON               TO PV-HOLD-REASON           10540013
105500         PERFORM 3700-BACK-OUT-MQ                                 10550013
105600         MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE       10560013
105700                                         PE-MQ-COMPLETION-CODE    10570013
105800         MOVE PV-HOLD-REASON          TO PV-REASON                10580013
105900                                         PE-MQ-REASON-CODE        10590013
106000         PERFORM 9200-MQ-ABEND                                    10600013
106100     END-IF.                                                      10610013
106200                                                                  10620013
106300******************************************************************10630013
106400* THERE IS A MSG IN THE QUEUE LARGER THAN THE CURRENT PV-MSGBUFFER10640013
106500******************************************************************10650013
106600 4750-MSG-TOO-BIG-ERROR.                                          10660013
106700                                                                  10670013
106800     SET PS-ERROR-YES                                             10680013
106900         PS-END-OF-MSG-YES TO TRUE.                               10690013
107000*        WF030-MSG-TOO-BIG-ERROR TO TRUE.                         10700013
107100                                                                  10710013
107200******************************************************************10720013
107300****************************************************************  10730013
107400* !!! I M P O R T A N T !!!                                       10740013
107500*                                                                 10750013
107600* THE 'STOP RUN' NEEDS TO BE HERE INSTEAD OF IN THE MAIN LINE OF  10760013
107700* THE PROGRAM BECAUSE THIS IS CODED AS A STARTED TASK, AND THIS   10770013
107800* PROGRAM WILL RUN CONTINUOUSLY UNTIL IT RECEIVES THE 'END RUN    10780013
107900* OF PROGRAM' MESSAGE. IF THE STOP RUN IS MOVED TO THE MAIN LINE  10790013
108000* THE RESULT WILL BE AN MQ HCONN_ERROR !!!!!                      10800013
108100*                                                                 10810013
108200* END RUN OF PROGRAM ROUTINE:                                     10820013
108300* CLOSE QUEUE(S)                                                  10830013
108400* DISCONNECT FROM QMGR                                            10840013
108500* DISPLAY SUMMARY STATISTICS                                      10850013
108600****************************************************************  10860013
108700 5000-END-RUN-ROUTINE.                                            10870013
108800                                                                  10880013
108900*CLOSE THE TRANS QUEUE.                                           10890013
109000     PERFORM 3400-MQ-QUEUE-CLOSE.                                 10900013
109100                                                                  10910013
109200*CLOSE THE ERROR QUEUE IF OPEN.                                   10920013
109300     IF PS-ERROR-QUEUE-IS-OPEN-YES                                10930013
109400        PERFORM 3405-MQ-ERROR-QUEUE-CLOSE                         10940013
109500     END-IF.                                                      10950013
109600                                                                  10960013
109700*DISCONNECT FROM THE QMGR.                                        10970013
109800     PERFORM 3500-DISCONNECT-QMGR.                                10980013
109900                                                                  10990013
110000*END OF JOB ROUTINE.                                              11000013
110100     PERFORM 8000-EOJ-ROUTINE.                                    11010013
110200                                                                  11020013
110300*END PROGRAM.                                                     11030013
110400     DISPLAY '************  END OF WSKUT013  ***************'     11040013
110500     STOP RUN.                                                    11050013
110600                                                                  11060013
110700****************************************************************  11070013
110800* OPEN THE ERROR QUEUE IF IT HAS NOT BEEN ALREADY. SET UP THE     11080013
110900* CURRENT TMST AND ERROR REASON CODE TO BE PUT INTO THE           11090013
111000* MQMD-APPLIDENTITYDATA.                                          11100013
111100****************************************************************  11110013
111200 7100-ERROR-ROUTINE.                                              11120013
111300                                                                  11130013
111400*OPEN ERROR QUEUE                                                 11140013
111500     IF PS-ERROR-QUEUE-IS-OPEN-NO                                 11150013
111600        PERFORM 3205-MQ-ERROR-QUEUE-OPEN                          11160013
111700     END-IF.                                                      11170013
111800                                                                  11180013
111900*SET CURRENT TMST FOR PUT                                         11190013
112000*    PERFORM 1100-SET-CURRENT-TMST.                               11200013
112100*    MOVE PV-CURRENT-TMST TO WF030-ORIG-PUT-TMST.                 11210013
112200                                                                  11220013
112300****************************************************************  11230013
112400*7900-BACKUP-ITEM-QUEUE-MSG.                                      11240013
112500*    INITIALIZE MSG-DATA-COLLECT-LINE.                            11250013
112600*    MOVE PV-MSGBUFFER  TO MSG-DATA-COLLECT-LINE.                 11260013
112700*    WRITE MSG-DATA-COLLECT-LINE.                                 11270013
112800*    ADD +1 TO PA-TOTAL-BACKUP-RECS.                              11280013
112900****************************************************************  11290013
113000*                                                                 11300013
113100*                                                                 11310013
113200** E N D    O F    M Q    S E R I E S     P A R A G R A P H S **  11320013
113300*                                                                 11330013
113400*                                                                 11340013
113500****************************************************************  11350013
113600                                                                  11360013
113700******************************************************************11370013
113800* UPDATE CHECKPOINT STATUS CODE WITH 0 FOR COMPLETION.            11380013
113900* DISPLAY STATISTICS FOR THE PROGRAM                              11390013
114000******************************************************************11400013
114100 8000-EOJ-ROUTINE.                                                11410013
114200                                                                  11420013
114300         CLOSE OUTPUT-FILE.                                       11430013
114400                                                                  11440013
114500         DISPLAY ' ********************************************'  11450013
114600         DISPLAY '     * WSKUT013 SUMMARY STATISTICS *         '  11460013
114700         DISPLAY ' '                                              11470013
114800         DISPLAY ' -----------------------------------------   '  11480013
114900         DISPLAY '  EXTRACT OF INTRANSIT DATA FROM QUEUE       '  11490013
115000         DISPLAY ' -----------------------------------------   '  11500013
115100         DISPLAY ' '                                              11510013
115200         DISPLAY ' TOTAL MESSAGES READ INPUT QUEUE   :'           11520013
115300                                        PA-TOTAL-GETS             11530013
115400         DISPLAY ' TOTAL MESSAGES WRITTEN TO OUTPUT  :'           11540013
115500                                        PA-TOTAL-OUTPUT-RECS      11550013
115600         DISPLAY ' TOTAL MESSAGES TO ERROR QUEUE     :'           11560013
115700                                        PA-TOTAL-ERRORQ-RECS      11570013
115800         DISPLAY ' TOTAL MQ  COMMITS                 :'           11580013
115900                                        PA-TOTAL-MQ-COMMITS       11590013
116000         DISPLAY '********************************************'.  11600013
116100                                                                  11610013
116200***************************************************************** 11620013
116300* WRITE OUTPUT FILE.                                              11630013
116400***************************************************************** 11640013
116500 8300-WRITE-OUTPUT-FILE.                                          11650013
116600                                                                  11660013
116700     WRITE OUTPUT-RECORD                                          11670013
116800       FROM CE015-RECEIPT-UPLOAD-RECORD.                          11680016
116900                                                                  11690013
117000     ADD +1 TO PA-TOTAL-OUTPUT-RECS.                              11700013
117100                                                                  11710013
117200******************************************************************11720013
117300* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      11730013
117400* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 11740013
117500******************************************************************11750013
117600 9100-SQL-ABEND.                                                  11760013
117700                                                                  11770013
117800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    11780013
117900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         11790013
118000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     11800013
118100* FORMAT                                                          11810013
118200     COPY DPPD004.                                                11820013
118300                                                                  11830013
118400     DISPLAY '***********************************'.               11840013
118500     DISPLAY '     SQL ABEND                    *'.               11850013
118600     DISPLAY '***********************************'.               11860013
118700     DISPLAY '* CURRENT STATS AT TIME OF ABEND  *'.               11870013
118800     DISPLAY '***********************************'.               11880013
118900     DISPLAY ' TOTAL MESSAGES READ INPUT QUEUE   :'               11890013
119000                                    PA-TOTAL-GETS                 11900013
119100     DISPLAY ' TOTAL MESSAGES WRITTEN TO OUTPUT  :'               11910013
119200                                    PA-TOTAL-OUTPUT-RECS          11920013
119300     DISPLAY ' TOTAL MESSAGES TO ERROR QUEUE     :'               11930013
119400                                    PA-TOTAL-ERRORQ-RECS          11940013
119500     DISPLAY ' TOTAL MQ  COMMITS                 :'               11950013
119600                                    PA-TOTAL-MQ-COMMITS           11960013
119700     DISPLAY '***********************************'.               11970013
119800     DISPLAY ' '.                                                 11980013
119900     MOVE +4013 TO ABEND-CODE.                                    11990013
120000     CALL 'ILBOABN0' USING ABEND-CODE.                            12000013
120100                                                                  12010013
120200****************************************************************  12020013
120300** PERFORM MQ-SERIES ABEND PROCESSING                             12030013
120400****************************************************************  12040013
120500 9200-MQ-ABEND.                                                   12050013
120600                                                                  12060013
120700     DISPLAY '**** ABEND *************************************'.  12070013
120800     DISPLAY '** MQSERIES ERROR **'.                              12080013
120900     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          12090013
121000     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    12100013
121100     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     12110013
121200     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 12120013
121300     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            12130013
121400     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                12140013
121500     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                12150013
121600     DISPLAY '************************************************'.  12160013
121700     MOVE +4013 TO ABEND-CODE.                                    12170013
121800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12180013
121900                                                                  12190013
122000******************************************************************12200013
122100**                      END OF PROGRAM                            12210013
122200*                                                                 12220013
122300******************************************************************12230013
