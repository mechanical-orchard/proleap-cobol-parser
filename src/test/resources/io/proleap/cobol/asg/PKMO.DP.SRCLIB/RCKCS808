000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'PREPACK TRANSCRIPTION CONTROLLER'.                                
000300 PROGRAM-ID.    RCKCS808.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  SEPTEMBER, 1999.                                          
000700 DATE-COMPILED.                                                           
000800******************************************************************        
000900*    E808 - TROUBLE CENTRAL PROCESSING                                    
001000*                                                                         
001100*    ALLOCATION ROUTINE FOR PREPACK TRANSCRIPTIONS                        
001200*                                                                         
001300*    (ENTERED FROM TMKCS520 USING TMWS500 COMMAREA)                       
001400*                                                                         
000110******************************************************************        
001300*  CHANGED 10/20/14 BY CHERI PARMLEY       CHG#0094517           *        
001400*   COMMENTED CODE NOT USE IN WS REGARDING 7 DIGIT PO# NOT NEEDED*        
001400*   TO EXPAND.                                                   *        
000110******************************************************************        
001500******************************************************************        
001600 ENVIRONMENT DIVISION.                                                    
001700 CONFIGURATION SECTION.                                                   
001800 SOURCE-COMPUTER.        IBM-3090.                                        
001900 OBJECT-COMPUTER.        IBM-3090.                                        
002000 DATA DIVISION.                                                           
002100 WORKING-STORAGE SECTION.                                                 
002200                                                                          
002300 01  PC-PROGRAM-CONSTANTS.                                                
002400     05  PC-MAX-LINES                 PIC S9(04) COMP VALUE +50.          
002500     05  PC-MAX-STORES                PIC S9(04) COMP VALUE +200.         
002600     05  PC-RCKCS234                  PIC X(08) VALUE                     
002700                                                'RCKCS234'.               
002800     05  PC-RCKCS232                  PIC X(08) VALUE                     
002900                                                'RCKCS232'.               
003000     05  PC-RCKCS233                  PIC X(08) VALUE                     
003100                                                'RCKCS233'.               
003200     05  PC-RCKCS806                  PIC X(8)  VALUE  'RCKCS806'.        
003300     05  PC-RCKCS808                  PIC X(08) VALUE                     
003400                                                'RCKCS808'.               
003500     05  PC-RCKCS809                  PIC X(08) VALUE                     
003600                                                'RCKCS809'.               
003700     05  PC-RCKCS811                  PIC X(08)  VALUE                    
003800                                                'RCKCS811'.               
003900     05  PC-DPKCS277                  PIC X(08) VALUE                     
004000                                                'DPKCS277'.               
004100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKCS808'.         
004200                                                                          
004300 01  PS-PROGRAM-SWITCHES.                                                 
004400     05  PS-DONE-SW                   PIC  X    VALUE 'N'.                
004500         88  PS-NOT-DONE                        VALUE 'N'.                
004600         88  PS-DONE                            VALUE 'Y'.                
004700     05  PS-END-OF-PREPACK-SW         PIC  X    VALUE 'N'.                
004800         88  PS-END-OF-PREPACK                  VALUE 'Y'.                
004900*    05  PS-TSPSTDS-FOUND-SW          PIC  X    VALUE 'N'.                
005000*        88  PS-TSPSTDS-FOUND                   VALUE 'Y'.                
005100*        88  PS-TSPSTDS-NOT-FOUND               VALUE 'N'.                
005200     05  PS-CURSOR-OPEN-SW            PIC  X    VALUE 'N'.                
005300         88  PS-CURSOR-OPEN                     VALUE 'Y'.                
005400         88  PS-CURSOR-NOT-OPEN                 VALUE 'N'.                
005500     05  PS-UPDATE-RECITM-SW          PIC  X    VALUE 'N'.                
005600         88  PS-DONT-UPDATE-RECITM              VALUE 'N'.                
005700         88  PS-UPDATE-RECITM                   VALUE 'Y'.                
005800     05  PS-DRIVER-LINE-SW            PIC  X    VALUE 'N'.                
005900         88  PS-SAME-DRIVER-LINE                VALUE 'N'.                
006000         88  PS-DIFFERENT-DRIVER-LINE           VALUE 'Y'.                
006100     05  PS-DRIVER-FOUND-SW           PIC  X    VALUE 'N'.                
006200         88  PS-DRIVER-NOT-FOUND                VALUE 'N'.                
006300         88  PS-DRIVER-FOUND                    VALUE 'Y'.                
006400                                                                          
006500 01  PV-PROGRAM-VARIABLES.                                                
006600     05  PV-ITEM                      PIC S9(4) VALUE ZERO                
006700                                                      COMP SYNC.          
006800     05  PV-EIBDATE.                                                      
006900         10  PV-EIBDATE-N             PIC 9(5).                           
007000         10  FILLER                   PIC X(5).                           
007100     05  PV-DB2-COUNT                 PIC S9(09)  VALUE ZERO              
007200                                              COMP-3.                     
007300     05  PV-DB2-ACK-COUNT             PIC S9(09)  VALUE ZERO              
007400                                              COMP-3.                     
007500     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO                
007600                                                COMP SYNC.                
007700     05  PV-FETCH-COUNTER             PIC S9(4) VALUE ZERO                
007800                                                COMP SYNC.                
007900                                                                          
008000     05  PV-CICS-RESP                 PIC S9(4) VALUE ZERO                
008100                                                COMP SYNC.                
008200     05  PV-CICS-MSG-AREA             PIC X(75)  VALUE SPACE.             
008300     05  PV-USERID                    PIC X(08)  VALUE SPACE.             
008400     05  PV-MSG-HEADER.                                                   
008500         10  PV-MSG-PROGRAM           PIC X(10)  VALUE SPACES.            
008600         10  FILLER                   PIC X(01)  VALUE SPACES.            
008700         10  PV-MSG-PARA              PIC X(10)  VALUE SPACES.            
008800         10  FILLER                   PIC X(11)  VALUE                    
008900             ' SQLCODE = '.                                               
009000         10  PV-MSG-SQLCODE           PIC -Z(8)9.                         
009100         10  FILLER                   PIC X(01)  VALUE SPACES.            
009200         10  PV-MSG-TEXT              PIC X(38)  VALUE SPACES.            
      *CLP 10/20/14 - NOT USED                                                  
009300*    05  PV-MSG-KEYS.                                                     
009400*        10  FILLER                   PIC X(03) VALUE 'PO '.              
009500*        10  PV-MSG-KEY-PO            PIC 9(07) VALUE ZEROES.             
009600*        10  FILLER                   PIC X(05) VALUE ' SEQ '.            
009700*        10  PV-MSG-KEY-REC-SEQ-NBR.                                      
009800*            15  PV-MSG-KEY-REC-SEQ-NBR-N                                 
009900*                                     PIC 9(03) VALUE ZEROS.              
010000*        10  FILLER                   PIC X(06) VALUE ' LINE '.           
010100*        10  PV-MSG-KEY-PO-LNE-NBR.                                       
010200*            15  PV-MSG-KEY-PO-LNE-NBR-N                                  
010300*                                     PIC 9(03) VALUE ZEROS.              
010700                                                                          
010800     05  PV-SUM-STR-PLAN-QTY          PIC S9(9) COMP VALUE ZERO.          
010900                                                                          
011200     05  PV-FCLTY.                                                        
011300         10  PV-FCLTY-N               PIC 9.                              
011400     05  PV-PO.                                                           
011500         10  PV-PO-N                  PIC 9(8).                           
011600     05  PV-LINE.                                                         
011700         10  PV-LINE-N                PIC 999.                            
011800     05  PV-REC-SEQ-NBR.                                                  
011900         10  PV-REC-SEQ-NBR-N         PIC 999.                            
012000                                                                          
012100                                                                          
012200     05  PRV-TM500-RETURN-MSG.                                            
012300         10  PRV-PGM                  PIC X(3).                           
012400         10  FILLER                   PIC X(1).                           
012500         10  PRV-PARA                 PIC X(4).                           
012600         10  FILLER                   PIC X(1).                           
012700         10  PRV-TBL                  PIC X(7).                           
012800         10  FILLER                   PIC X(1).                           
012900         10  PRV-OP                   PIC X(3).                           
013000         10  FILLER                   PIC X(1).                           
013100         10  PRV-FCLTY                PIC X(1).                           
013200         10  FILLER                   PIC X(1).                           
013300         10  PRV-PO                   PIC X(8).                           
013400         10  FILLER                   PIC X(1).                           
013500         10  PRV-LINE                 PIC X(3).                           
013600         10  FILLER                   PIC X(1).                           
013700         10  PRV-REC-SEQ-NBR          PIC X(3).                           
013800         10  FILLER                   PIC X(1).                           
013900                                                                          
014000                                                                          
014100 01  PRV-PROGRAM-RETURN-VARIABLES.                                        
014200     05  PRV-00                       PIC X(42) VALUE                     
014300         '00PROGRAM CALL WAS SUCCESSFUL             '.                    
014400     05  PRV-61                       PIC X(42) VALUE                     
014500         '61RECEIVER IS NOT PRE-PACK                '.                    
014600     05  PRV-62                       PIC X(42) VALUE                     
014700         '62DRIVER LINE MISSING                     '.                    
014800     05  PRV-63                       PIC X(42) VALUE                     
014900         '63INVALID KEY FIELDS                      '.                    
015000     05  PRV-64                       PIC X(42) VALUE                     
015100         '64DB2 TIMEOUT ERROR                       '.                    
015200     05  PRV-65                       PIC X(42) VALUE                     
015300         '65SQL ERROR                               '.                    
015400     05  PRV-66                       PIC X(42) VALUE                     
015500         '66UNRECOVERABLE ERROR                     '.                    
015600                                                                          
015700*    TROUBLE AREA                                                         
015800     COPY TMWS500.                                                        
015900/                                                                         
016000     COPY RCWS808.                                                        
016100/                                                                         
016200     COPY RCWS809.                                                        
016300/                                                                         
016400     COPY RCWS810.                                                        
016500                                                                          
016600/                                                                         
016700*    OTR AREA                                                             
016800     COPY DPWS277.                                                        
016900/                                                                         
017000*    PREPACK VALIDATION AREA                                              
017100     COPY RCWS806.                                                        
017200/                                                                         
017300*    RECDIS ROUTINE AREA                                                  
017400     COPY RCWS811.                                                        
017500/                                                                         
017600/                                                                         
017700*    GLOBAL COMMAREA                                                      
017800     COPY DPWS020.                                                        
017900/                                                                         
018000*    ABEND AREA                                                           
018100     COPY DPWS013.                                                        
018200     COPY RCWS001.                                                        
018300/                                                                         
018400     EXEC SQL                                                             
018500          INCLUDE SQLCA                                                   
018600     END-EXEC.                                                            
018700/                                                                         
018800     EXEC SQL                                                             
018900          INCLUDE TRECITM                                                 
019000     END-EXEC.                                                            
019100/                                                                         
019200     EXEC SQL                                                             
019300          INCLUDE TPURCHS                                                 
019400     END-EXEC.                                                            
019500/                                                                         
019600     EXEC SQL                                                             
019700          INCLUDE TPURITM                                                 
019800     END-EXEC.                                                            
019900/                                                                         
020000*    EXEC SQL                                                             
020100*        INCLUDE TSPSTDS                                                  
020200*    END-EXEC.                                                            
020300/                                                                         
020400     EXEC SQL                                                             
020500          DECLARE PREPACK-ITEM-CSR CURSOR FOR                             
020600       SELECT                                                             
020700          RECITM.ORD_LNE_NBR                                              
020800       ,  RECITM.PKSL_ITM_QTY                                             
020900       ,  RECITM.DTL_CK_ITM_QTY                                           
021000       ,  RECITM.PREPK_RATO_QTY                                           
021100       ,  RECITM.CASE_PACK_QTY                                            
021200                                                                          
021300       ,  CASE                                                            
021400          RECITM.INNR_PACK_QTY                                            
021500         WHEN 0                                                           
021600             THEN 1                                                       
021700          ELSE                                                            
021800             RECITM.INNR_PACK_QTY                                         
021900          END                                                             
022000                                                                          
022100       ,  RECITM.PREPK_ODD_UNT_QTY                                        
022200       ,  RECITM.PREPK_DRV_LNE_CDE                                        
022300     FROM                                                                 
022400         TRECITM RECITM                                                   
022500     WHERE                                                                
022600             RECITM.ORD_NBR         = :TM500-PO-NBR                       
022700        AND  RECITM.REC_SEQ_NBR     = :TM500-REC-SEQ-NBR                  
022800        AND  RECITM.OPER_UNT_ID     = :TM500-OPER-UNT-ID                  
022900        AND  RECITM.FCLTY_ID        = :TM500-FCLTY-ID                     
023000        AND  RECITM.VER_STATUS_CDE  = 'A'                                 
023100        AND  RECITM.PREPK_ID        = :TM500-PREPK-ID                     
023200        AND  RECITM.PREPK_RATO_QTY  > 0                                   
023300     END-EXEC.                                                            
023400                                                                          
023500                                                                          
023600 LINKAGE SECTION.                                                         
023700                                                                          
023800 01  DFHCOMMAREA.                                                         
023900     05  FILLER                       OCCURS 1 TO 4072 TIMES              
024000                                            DEPENDING ON EIBCALEN.        
024100         10  FILLER                   PIC X.                              
024200/                                                                         
024300 PROCEDURE DIVISION.                                                      
024400                                                                          
024500 0000-MAIN-MODULE.                                                        
024600                                                                          
024700     PERFORM 1000-INITIALIZE.                                             
024800                                                                          
024900* WHEN THE PREPK-ID IS 99, IT IS A SIGN OF A BAD PACK.  WE                
025000* WILL PASS THE PACK CONTENTS ON TO RCKCS809 AND CUT TROUBLE              
025100* RECORDS THERE                                                           
025200                                                                          
025300     IF PS-NOT-DONE                                                       
025400         PERFORM 2000-PROCESS                                             
025500     END-IF.                                                              
025600                                                                          
025700     IF PS-NOT-DONE                                                       
025800         PERFORM 8100-CALL-PACK-EDIT-MODULE                               
025900     END-IF.                                                              
026000                                                                          
026100     PERFORM 8250-DELETE-TEMP-QUEUE.                                      
026600     PERFORM 0000-GOBACK.                                                 
026700                                                                          
026800 0000-GOBACK.                                                             
026200                                                                          
026300     MOVE RC809-RETURN-DATA           TO TM500-RETURN-DATA                
026400     MOVE RC809-PREPACK-RETURN-AREA   TO                                  
026500                                     TM500-PREPACK-RETURN-AREA.           
026900     MOVE TM500-FIELDS TO DFHCOMMAREA.                                    
027000                                                                          
027100     GOBACK.                                                              
027200                                                                          
027300/                                                                         
027400 1000-INITIALIZE.                                                         
027500                                                                          
027600                                                                          
027700     INITIALIZE TM500-FIELDS                                              
027800                RC809-COMMAREA                                            
027900                PV-FETCH-COUNTER                                          
028000                                                                          
028100     MOVE 808                         TO RC809-PREPACK-PGM-NBR            
028200     MOVE ZERO                        TO PV-ITEM                          
028300                                                                          
028400*    SET PS-NOT-DONE                                                      
028500*        PS-TSPSTDS-NOT-FOUND         TO TRUE                             
028600     SET PS-NOT-DONE                  TO TRUE                             
028700                                                                          
028800     EVALUATE TRUE                                                        
028900     WHEN EIBCALEN = ZERO                                                 
029000         SET PS-DONE                  TO TRUE                             
029100     WHEN OTHER                                                           
029200         MOVE DFHCOMMAREA             TO TM500-FIELDS                     
029300         MOVE PRV-00                  TO TM500-RETURN-DATA                
029400         MOVE 'RCKCS808'              TO PV-MSG-PROGRAM                   
029500         MOVE EIBTRMID                TO RC809-TERM-ID                    
029600         MOVE EIBTASKN                TO RC809-TASK-NUMBER                
029700         MOVE 3                       TO RC809-SEQ                        
029800         SET RC809-CALL-SUCCESSFUL    TO TRUE                             
029900         MOVE TM500-OPER-UNT-ID       TO RC809-OPER-UNT-ID                
030000         MOVE TM500-FCLTY-ID          TO RC809-FCLTY-ID                   
030100         MOVE TM500-PO-NBR            TO RC809-PO-NBR                     
030200         MOVE TM500-REC-SEQ-NBR       TO RC809-REC-SEQ-NBR                
030300         MOVE TM500-PREPK-ID          TO RC809-PREPK-ID                   
030400                                                                          
030500         IF TM500-PO-NBR = ZERO                                           
030600             OR TM500-REC-SEQ-NBR = ZERO                                  
030700             OR TM500-PO-LNE-NBR = ZERO                                   
030800             SET PS-DONE              TO TRUE                             
030900             MOVE TM500-PO-LNE-NBR    TO RC001-PO-LNE-NBR                 
031000             MOVE 1                   TO RC809-PREPACK-ERROR-NBR          
031100             PERFORM RC001-RETURN-MSG                                     
031200         ELSE                                                             
031300             INITIALIZE RC808-PACK-CONTENTS                               
031400* IS 1010- REALLY NEEDED IF WE REBUILD THE PACK ANYWAY?                   
031500*            PERFORM 1010-VERIFY                                          
031600             IF PS-NOT-DONE                                               
031700                 PERFORM 1020-PO-INFO                                     
031800             END-IF                                                       
031900         END-IF                                                           
032000     END-EVALUATE.                                                        
032100                                                                          
032200*1010-VERIFY.                                                             
032300*                                                                         
032400*    PERFORM 7010-VERIFY-DRIVER-LINE                                      
032500*    IF PS-NOT-DONE AND PV-DB2-COUNT > ZERO                               
032600*        CONTINUE                                                         
032700*    ELSE                                                                 
032800*        SET PS-DONE      TO TRUE                                         
032900*    END-IF.                                                              
033000                                                                          
033100 1020-PO-INFO.                                                            
033200     MOVE TM500-PO-NBR                TO RC809-PO-NBR                     
033300     MOVE TM500-REC-SEQ-NBR           TO RC809-REC-SEQ-NBR                
033400     MOVE TM500-OPER-UNT-ID           TO RC809-OPER-UNT-ID                
033500     MOVE TM500-FCLTY-ID              TO RC809-FCLTY-ID                   
033600     MOVE TM500-PO-LNE-NBR            TO                                  
033700                                     RC809-PREPK-DRIVER-LINE-NBR          
033800*    MOVE TM500-UNITS-TO-ALLOC        TO RC809-UNITS-TO-ALLOC             
033900     MOVE TM500-PKGNG-CDE             TO RC809-PKGNG-CDE                  
034000     MOVE TM500-PREPK-ID              TO RC809-PREPK-ID                   
034100                                                                          
034200     IF TM500-REDISTRO-YES                                                
034300         SET RC809-RECEIVER-OTR       TO TRUE                             
034400     ELSE                                                                 
034500         SET RC809-PO-OTR             TO TRUE                             
034600     END-IF                                                               
034700                                                                          
034800     PERFORM 7020-SELECT-TPURCHS.                                         
034900     IF PS-NOT-DONE                                                       
035000         MOVE PURCHS-DEPT-NBR         TO RC809-DEPT-NBR                   
035100         MOVE PURCHS-PO-TYP-CDE       TO RC809-PO-TYP-CDE                 
035200         MOVE PURCHS-NEW-STR-PO-IND   TO RC809-NEW-STR-PO-IND             
035300         MOVE PURCHS-IMPRT-PO-IND     TO RC809-IMPRT-PO-IND               
035400     END-IF.                                                              
035500                                                                          
035600     IF PURCHS-PO-TYP-CDE = 'IM'                                          
035700         MOVE 'Y'  TO RC809-IMPRT-PO-IND                                  
035800     ELSE                                                                 
035900         MOVE 'N'  TO RC809-IMPRT-PO-IND                                  
036000     END-IF.                                                              
036100                                                                          
036200     MOVE TM500-PROCESS-IND           TO RC809-PROCESS-IND                
036300     MOVE TM500-NOTIF-UID             TO RC809-NOTIF-UID.                 
036400     MOVE TM500-PREPK-TRBL-SW         TO RC809-PREPK-TRBL-SW.             
036500/                                                                         
036600 2000-PROCESS.                                                            
036700                                                                          
036800/                                                                         
036900* 1 - DELETE ANY EXISTING RECDIS FOR ALL LINES IN THE PACK                
037000* 2 - LOAD ALL THE LINES OF THE PACK TO RC808                             
037100* 3 - FIX ANY MULTIPLE DRIVER LINES                                       
037200* 4 - CALL DPKCS277 FOR EACH LINE AND LOAD THE STORES TO RC808            
037300*     (DPKCS277 CANNOT HANDLE MULTIPLE DRIVER LINES)                      
037400                                                                          
037500     IF NOT RC809-PREPACK-EDIT-ONLY                                       
037600         PERFORM 8400-CHECK-RECDIS-ALLOC                                  
037700     END-IF                                                               
037800                                                                          
037900     IF PS-NOT-DONE                                                       
038000         PERFORM 7100-OPEN-PREPACK-CURSOR                                 
038100     END-IF                                                               
038200                                                                          
038300     IF PS-NOT-DONE                                                       
038400         PERFORM 7110-FETCH-PREPACK-CURSOR                                
038500     END-IF                                                               
038600     IF PS-NOT-DONE                                                       
038700         IF PS-END-OF-PREPACK                                             
038800             SET PS-DONE              TO TRUE                             
038900*            MOVE RC809-PURITM-LNE-NBR                                    
039000*                                     TO RC001-PO-LNE-NBR                 
039100*            MOVE 2                   TO RC809-PREPACK-ERROR-NBR          
039200*            PERFORM RC001-RETURN-MSG                                     
039300         END-IF                                                           
039400     END-IF                                                               
039500                                                                          
039600     IF PS-NOT-DONE                                                       
039700         SET PS-DRIVER-NOT-FOUND      TO TRUE                             
039800         PERFORM 2050-LOAD-PREPACK-LINES                                  
039900             VARYING RC808-LINE-IDX                                       
040000             FROM 1 BY 1                                                  
040100             UNTIL PS-END-OF-PREPACK                                      
040200             OR RC808-LINE-IDX > PC-MAX-LINES                             
040300             OR PS-DONE                                                   
040400     END-IF                                                               
040500                                                                          
040600     IF PS-CURSOR-OPEN                                                    
040700         PERFORM 7120-CLOSE-PREPACK-CURSOR                                
040800     END-IF.                                                              
040900                                                                          
041000     IF PS-NOT-DONE                                                       
041100         PERFORM 2100-RE-VERIFY-PACK                                      
041200     END-IF                                                               
041300                                                                          
041400     PERFORM 2055-LOAD-PREPACK-STORES                                     
041500             VARYING RC808-LINE-IDX                                       
041600             FROM 1 BY 1                                                  
041700             UNTIL RC808-PRPK-LNE-NBR (RC808-LINE-IDX) = ZERO             
041800             OR RC808-LINE-IDX > PC-MAX-LINES                             
041900             OR PS-DONE.                                                  
042000/                                                                         
042100 2050-LOAD-PREPACK-LINES.                                                 
042200                                                                          
042300     MOVE RECITM-ORD-LNE-NBR          TO RC808-PRPK-LNE-NBR               
042400                                         (RC808-LINE-IDX)                 
042500     MOVE RECITM-PKSL-ITM-QTY         TO RC808-PKSL-ITM-QTY               
042600                                         (RC808-LINE-IDX)                 
042700     MOVE RECITM-CASE-PACK-QTY        TO RC808-CASE-PACK-QTY              
042800                                         (RC808-LINE-IDX)                 
042900     MOVE RECITM-INNR-PACK-QTY        TO RC808-INNR-PACK-QTY              
043000                                         (RC808-LINE-IDX)                 
043100     MOVE RECITM-PREPK-DRV-LNE-CDE    TO RC808-DRV-LNE-CDE                
043200                                         (RC808-LINE-IDX)                 
043300     MOVE RECITM-PREPK-RATO-QTY       TO RC808-RECITM-RATO-QTY            
043400                                         (RC808-LINE-IDX)                 
043500                                                                          
043600     IF RECITM-DTL-CK-ITM-QTY = ZERO                                      
043700         COMPUTE RC808-BEST-CASE-UNITS (RC808-LINE-IDX) =                 
043800              RECITM-PKSL-ITM-QTY - RECITM-PREPK-ODD-UNT-QTY              
043900     ELSE                                                                 
044000         COMPUTE RC808-BEST-CASE-UNITS (RC808-LINE-IDX) =                 
044100              RECITM-DTL-CK-ITM-QTY  - RECITM-PREPK-ODD-UNT-QTY           
044200     END-IF                                                               
044300                                                                          
044400     MOVE RECITM-DTL-CK-ITM-QTY       TO RC808-DTL-CK-ITM-QTY             
044500                                         (RC808-LINE-IDX)                 
044600     MOVE RECITM-PREPK-ODD-UNT-QTY    TO RC808-ODD-UNITS                  
044700                                         (RC808-LINE-IDX)                 
044800                                                                          
044900     PERFORM 7200-SELECT-PURITM                                           
045000     IF PS-NOT-DONE                                                       
045100         PERFORM 2051-MOVE-PURITM                                         
045200     END-IF                                                               
045300                                                                          
045400     PERFORM 7110-FETCH-PREPACK-CURSOR                                    
045500     IF PV-FETCH-COUNTER > PC-MAX-LINES                                   
045600         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
045700         MOVE 24                      TO RC809-PREPACK-ERROR-NBR          
045800         SET PS-DONE                  TO TRUE                             
045900         PERFORM RC001-RETURN-MSG                                         
046000     END-IF.                                                              
046100                                                                          
046200 2051-MOVE-PURITM.                                                        
046300     MOVE PURITM-PREPK-RATO-QTY       TO RC808-PURITM-RATO-QTY            
046400                                         (RC808-LINE-IDX)                 
046500                                                                          
046600* PURITM-PO-LNE-NBR WILL BE USED TO GET TALLPLN FOR THE                   
046700* DRIVER LINE ONLY IN RCKCS810                                            
046800*    IF RECITM-PREPK-DRV-LNE-CDE = 'A'                                    
046900*        SET PS-DRIVER-FOUND          TO TRUE                             
047000*        MOVE PURITM-PO-LNE-NBR       TO RC809-PURITM-LNE-NBR             
047100*        SET RC809-DRIVER-LNE-PTR     TO RC808-LINE-IDX                   
047200*        MOVE RC808-BEST-CASE-UNITS (RC808-LINE-IDX)                      
047300*                                     TO RC809-UNITS-TO-ALLOC             
047400*    END-IF                                                               
047500                                                                          
047800                                                                          
047900* IF ANY LINE IN THE PACK IS AN ADVERTISED ITEM THEN ALL                  
048000* LINES WILL BE ALSO                                                      
048100     IF PURITM-PIC-ITM-IND = 'Y'                                          
048200         SET RC809-AD-YES             TO TRUE                             
048300     END-IF                                                               
048400                                                                          
048500     MOVE PURITM-PIC-ITM-IND          TO RC808-AD-ITM-IND                 
048600                                         (RC808-LINE-IDX).                
048700                                                                          
048800 2052-STORE-MOVES.                                                        
048900     MOVE DP277-CURR-SPLIT-QTY        TO RC808-CURR-SPLIT-QTY             
049000                                             (RC808-LINE-IDX)             
049100     MOVE DP277-ALLOC-OUTR-PK-QTY     TO RC808-ALLOC-OUTR-PK-QTY          
049200                                             (RC808-LINE-IDX)             
049300     MOVE DP277-PK-SIZE-RND-CDE       TO RC808-PK-SIZE-RND-CDE            
049400                                         (RC808-LINE-IDX)                 
049500                                                                          
049600* LOAD THE RESULTING TABLE TO THE RC808 TABLE                             
049700     PERFORM VARYING DP277-STR-IDX                                        
049800             FROM 1 BY 1 UNTIL                                            
049900             DP277-STORE-NBR (DP277-STR-IDX)                              
050000                      = ZERO OR DP277-STR-IDX > PC-MAX-STORES             
050100                                                                          
050200         SET RC808-STR-IDX            TO DP277-STR-IDX                    
050300         MOVE DP277-STORE-NBR (DP277-STR-IDX)                             
050400                                      TO RC808-STR-NBR                    
050500                              (RC808-LINE-IDX, RC808-STR-IDX)             
050600         MOVE DP277-STR-DISTRO-QTY (DP277-STR-IDX)                        
050700                                      TO RC808-STR-DISTRO-QTY             
050800                              (RC808-LINE-IDX, RC808-STR-IDX)             
050900         ADD DP277-STR-DISTRO-QTY (DP277-STR-IDX)                         
051000                                      TO RC808-LNE-DISTRO-QTY             
051100                              (RC808-LINE-IDX)                            
051200                                                                          
051300         MOVE DP277-STR-DISTRO-OTR (DP277-STR-IDX)                        
051400                                      TO RC808-STR-OTR-QTY                
051500                              (RC808-LINE-IDX, RC808-STR-IDX)             
051600*        IF DP277-STR-DISTRO-OTR (DP277-STR-IDX) > ZERO                   
051700             ADD DP277-STR-DISTRO-OTR (DP277-STR-IDX)                     
051800                                      TO RC808-LNE-OTR-QTY                
051900                                         (RC808-LINE-IDX)                 
052000*        END-IF                                                           
052100                                                                          
052200         MOVE DP277-STR-OTR-PK(DP277-STR-IDX)                             
052300                                      TO RC808-STR-OTR-PK                 
052400                              (RC808-LINE-IDX, RC808-STR-IDX)             
052500                                                                          
052600         IF DP277-STR-OTR-PK(DP277-STR-IDX) > ZERO                        
052700             ADD DP277-STR-OTR-PK(DP277-STR-IDX)                          
052800                                      TO RC808-LNE-OTR-PACK-QTY           
052900                              (RC808-LINE-IDX)                            
053000         END-IF                                                           
053100                                                                          
053200         MOVE DP277-ALLOC-SEQ-CDE (DP277-STR-IDX)                         
053300                                      TO RC808-ALLOC-SEQ-CDE              
053400                              (RC808-LINE-IDX, RC808-STR-IDX)             
053500         MOVE DP277-RNK-SEQ-NBR (DP277-STR-IDX)                           
053600                                      TO RC808-RNK-SEQ-NBR                
053700                              (RC808-LINE-IDX, RC808-STR-IDX)             
053800                                                                          
053900*   THE OTHER POSSIBLE VALUES ARE 'F' FOR FIXED ALLOCATIONS AND           
054000*   'M' FOR PREPACK ALLOCATIONS.  AN 'A' WILL TRIGGER AD EVENT            
054100*   PROCESSING IN RCKCS810                                                
054200         MOVE DP277-STR-CNSTR-CDE (DP277-STR-IDX)                         
054300                                      TO RC808-STR-CNSTR-CDE              
054400                              (RC808-LINE-IDX, RC808-STR-IDX)             
054500                                                                          
054600         MOVE DP277-STR-CNSTR-QTY (DP277-STR-IDX)                         
054700                                      TO RC808-STR-CNSTR-QTY              
054800                              (RC808-LINE-IDX, RC808-STR-IDX)             
054900                                                                          
055000         MOVE DP277-STR-DISTRO-PK (DP277-STR-IDX)                         
055100                                      TO RC808-STR-DISTRO-PK              
055200                              (RC808-LINE-IDX, RC808-STR-IDX)             
055300                                                                          
055400     END-PERFORM.                                                         
055500                                                                          
055600* THE DP277 STORE ARRAY IS 250 LONG VERSUS 200 LONG FOR                   
055700* THE RC808 ARRAY.  IF WE'VE REACHED THE LIMIT OF 200 FOR RC808           
055800* AND THERE'S STILL ANOTHER STORE LEFT TO BE MOVED IN DP277,              
055900* WE HAVE OVERFLOWED THE RC808 TABLE.                                     
056000                                                                          
056100     SET DP277-STR-IDX UP BY 1                                            
056200     IF DP277-STORE-NBR (DP277-STR-IDX) > ZERO                            
056300         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
056400         MOVE DP277-STORE-NBR (DP277-STR-IDX)                             
056500                                      TO RC001-STORE-NBR-N                
056600         MOVE 25                      TO RC809-PREPACK-ERROR-NBR          
056700         SET PS-DONE                  TO TRUE                             
056800         PERFORM RC001-RETURN-MSG                                         
056900     END-IF.                                                              
057000                                                                          
057100 2055-LOAD-PREPACK-STORES.                                                
057200                                                                          
057300* 99 SIGNIFIES A BAD PRE-PACK                                             
057400     IF TM500-PREPK-ID = 99                                               
057500         CONTINUE                                                         
057600     ELSE                                                                 
057700         IF PS-NOT-DONE                                                   
057800             PERFORM 8000-CALL-OTR-MODULE                                 
057900             IF PS-NOT-DONE                                               
058000                 PERFORM 2052-STORE-MOVES                                 
058100             END-IF                                                       
058200         END-IF                                                           
058300     END-IF.                                                              
058400/                                                                         
058500 2100-RE-VERIFY-PACK.                                                     
058600                                                                          
058700* WE CANNOT HAVE MORE THAN ONE DRIVER LINE PER PACK.  SOMETIMES A         
058800* NEW DRIVER LINE WILL BE ASSIGNED IN ADDITION TO THE EXISTING            
058900* ONE. THIS PARAGRAPH WILL DETECT THOSE DIFFERENCES AND FIX THEM.         
059000                                                                          
059100     INITIALIZE RC806-PRODUCT-PACK-VALIDATION                             
059200     SET RC806-CALC-BEST-CASE         TO TRUE                             
059300     PERFORM 2110-LOAD-RC809-FROM-RC808                                   
059400         VARYING RC808-LINE-IDX FROM 1 BY 1                               
059500         UNTIL RC808-PRPK-LNE-NBR (RC808-LINE-IDX) = ZERO                 
059600             OR RC808-LINE-IDX > PC-MAX-LINES.                            
059700                                                                          
059800     PERFORM 8300-VALIDATION-MODULE.                                      
059900                                                                          
060000     SET PS-DONT-UPDATE-RECITM                                            
060100         PS-SAME-DRIVER-LINE          TO TRUE                             
060200                                                                          
060300     IF RC806-NO-ERRORS                                                   
060400         PERFORM 2120-COMPARE-LINES                                       
060500             VARYING RC808-LINE-IDX FROM 1 BY 1                           
060600             UNTIL RC808-PRPK-LNE-NBR (RC808-LINE-IDX) = ZERO             
060700                 OR RC808-LINE-IDX > PC-MAX-LINES.                        
060800                                                                          
061400         IF PS-DIFFERENT-DRIVER-LINE                                      
061410*            (CLEAR OUT THE DRIVER LINE CODES FOR ALL LINES               
061420*              IN THE PACK)                                               
061500             PERFORM 7300-REMOVE-RECITM-DRIVER-LINE                       
061600             MOVE RC806-PKSL-LNE-NBR (RC806-DRIVER-LNE-SUB)               
061700                                      TO RECITM-ORD-LNE-NBR               
061800             PERFORM 7350-NEW-RECITM-DRIVER-LINE                          
062000     END-IF.                                                              
062001                                                                          
062010             MOVE RC806-PKSL-LNE-NBR (RC806-DRIVER-LNE-SUB)               
062020                                      TO RECITM-ORD-LNE-NBR               
062030             SET RC808-LINE-IDX       TO RC806-DRIVER-LNE-SUB             
062040             MOVE RC808-BEST-CASE-UNITS (RC808-LINE-IDX)                  
062050                                      TO RC809-UNITS-TO-ALLOC             
062060             PERFORM 7200-SELECT-PURITM                                   
062070             MOVE PURITM-PO-LNE-NBR   TO RC809-PURITM-LNE-NBR.            
062100/                                                                         
062200 2110-LOAD-RC809-FROM-RC808.                                              
062300     ADD 1                            TO RC806-NBR-OF-LINES               
062400     SET RC806-LINE-IDX               TO RC808-LINE-IDX                   
062500     MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                             
062600                                      TO RC806-PKSL-LNE-NBR               
062700                                           (RC806-LINE-IDX)               
062800     MOVE RC808-INNR-PACK-QTY (RC808-LINE-IDX)                            
062900                                      TO RC806-INNER-PACK-QTY             
063000     MOVE RC808-RECITM-RATO-QTY (RC808-LINE-IDX)                          
063100                                      TO RC806-PO-RATIO                   
063200                                           (RC806-LINE-IDX)               
063300                                         RC806-RC-RATIO                   
063400                                           (RC806-LINE-IDX)               
063500                                                                          
063600     IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                      
063700         MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                       
063800                                      TO RC806-UNIT-QTY                   
063900                                           (RC806-LINE-IDX)               
064000                                         RC806-RCVG-QTY                   
064100                                           (RC806-LINE-IDX)               
064200     ELSE                                                                 
064300         MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                         
064400                                      TO RC806-UNIT-QTY                   
064500                                           (RC806-LINE-IDX)               
064600                                         RC806-RCVG-QTY                   
064700                                           (RC806-LINE-IDX)               
064800     END-IF.                                                              
064900                                                                          
065000 2120-COMPARE-LINES.                                                      
065100     SET PS-DONT-UPDATE-RECITM        TO TRUE                             
065200     SET RC806-LINE-IDX               TO RC808-LINE-IDX                   
065300                                                                          
065400     IF RC808-BEST-CASE-UNITS (RC808-LINE-IDX) NOT =                      
065500              RC806-BEST-CASE-UNITS (RC806-LINE-IDX)                      
065600         MOVE RC806-BEST-CASE-UNITS (RC806-LINE-IDX)                      
065700                                      TO RC808-BEST-CASE-UNITS            
065800                                        (RC808-LINE-IDX)                  
065900     END-IF                                                               
066000                                                                          
066100     IF RC808-ODD-UNITS (RC808-LINE-IDX) NOT =                            
066200              RC806-ODD-UNITS (RC806-LINE-IDX)                            
066300         MOVE RC806-ODD-UNITS (RC806-LINE-IDX)                            
066400                                      TO RC808-ODD-UNITS                  
066500                                         (RC808-LINE-IDX)                 
066600         SET PS-UPDATE-RECITM         TO TRUE                             
066700     END-IF                                                               
066800                                                                          
067400                                                                          
067500     IF RC808-DRV-LNE-CDE (RC808-LINE-IDX) = 'A'                          
067600         IF RC808-LINE-IDX = RC806-DRIVER-LNE-SUB                         
067602             MOVE RC808-BEST-CASE-UNITS (RC808-LINE-IDX)                  
067603                                      TO RC809-UNITS-TO-ALLOC             
067606             MOVE RC806-DRIVER-LNE-SUB                                    
067607                                      TO RC809-DRIVER-LNE-PTR             
067610*            (DRIVER LINE IS CORRECT)                                     
067700             CONTINUE                                                     
067800         ELSE                                                             
067900             SET PS-DIFFERENT-DRIVER-LINE                                 
068000                                      TO TRUE                             
068100             MOVE RC806-DRIVER-LNE-SUB                                    
068200                                      TO RC809-DRIVER-LNE-PTR             
068210*           (THERE CAN ONLY BE ONE DRIVER LINE AND THIS AIN'T IT)         
068300         END-IF                                                           
068400     ELSE                                                                 
068500         IF RC808-LINE-IDX = RC806-DRIVER-LNE-SUB                         
068600             SET PS-DIFFERENT-DRIVER-LINE                                 
068610                                      TO TRUE                             
068700             MOVE RC806-DRIVER-LNE-SUB                                    
068800                                      TO RC809-DRIVER-LNE-PTR             
068810*            (THE DRIVER IS ON THE WRONG LINE)                            
068900         END-IF                                                           
069000     END-IF                                                               
069100                                                                          
069200     IF PS-UPDATE-RECITM                                                  
069300         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
069400                              TO RECITM-ORD-LNE-NBR                       
069500         MOVE RC808-ODD-UNITS (RC808-LINE-IDX)                            
069600                              TO RECITM-PREPK-ODD-UNT-QTY                 
069700         PERFORM 7250-UPDATE-RECITM                                       
069800     END-IF.                                                              
069900/                                                                         
070000*7010-VERIFY-DRIVER-LINE.                                                 
070100*    MOVE ZERO                TO PV-DB2-COUNT                             
070200*    EXEC SQL                                                             
070300*         SELECT COUNT(*)                                                 
070400*           INTO :PV-DB2-COUNT :PV-NULL-IND                               
070500*           FROM TRECITM                                                  
070600*          WHERE ORD_NBR       = :TM500-PO-NBR                            
070700*            AND REC_SEQ_NBR   = :TM500-REC-SEQ-NBR                       
070800*            AND ORD_LNE_NBR   = :TM500-PO-LNE-NBR                        
070900*            AND PREPK_DRV_LNE_CDE = 'A'                                  
071000*    END-EXEC.                                                            
071100*                                                                         
071200*    EVALUATE TRUE                                                        
071300*    WHEN PV-NULL-IND = -1                                                
071400*        MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
071500*        MOVE 3                       TO RC809-PREPACK-ERROR-NBR          
071600*        SET PS-DONE                  TO TRUE                             
071700*        PERFORM RC001-RETURN-MSG                                         
071800*    WHEN SQLCODE = ZERO                                                  
071900*        CONTINUE                                                         
072000*    WHEN SQLCODE = -904                                                  
072100*    WHEN SQLCODE = -911                                                  
072200*    WHEN SQLCODE = -913                                                  
072300* SOFT ABORT                                                              
072400*        MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
072500*        MOVE 16                      TO RC809-PREPACK-ERROR-NBR          
072600*        PERFORM RC001-RETURN-MSG                                         
072700*        SET PS-DONE                                                      
072800*            RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
072900*    WHEN OTHER                                                           
073000*        MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
073100*        MOVE 4                       TO RC809-PREPACK-ERROR-NBR          
073200*        SET PS-DONE                  TO TRUE                             
073300*        PERFORM RC001-RETURN-MSG                                         
073400*    END-EVALUATE.                                                        
073500/                                                                         
073600 7020-SELECT-TPURCHS.                                                     
073700     EXEC SQL                                                             
073800         SELECT                                                           
073900         DEPT_NBR                                                         
074000     ,   PO_TYP_CDE                                                       
074100         ,  NEW_STR_PO_IND                                                
074200         ,  IMPRT_PO_IND                                                  
074300         INTO                                                             
074400           :PURCHS-DEPT-NBR                                               
074500         , :PURCHS-PO-TYP-CDE                                             
074600         , :PURCHS-NEW-STR-PO-IND                                         
074700         , :PURCHS-IMPRT-PO-IND                                           
074800         FROM TPURCHS                                                     
074900         WHERE PO_NBR           = :TM500-PO-NBR                           
075000             AND VER_STATUS_CDE = 'A'                                     
075100     END-EXEC.                                                            
075200                                                                          
075300     EVALUATE TRUE                                                        
075400     WHEN SQLCODE = ZERO                                                  
075500         CONTINUE                                                         
075600     WHEN SQLCODE = +100                                                  
075700         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
075800         MOVE 5                       TO RC809-PREPACK-ERROR-NBR          
075900         SET PS-DONE                  TO TRUE                             
076000         PERFORM RC001-RETURN-MSG                                         
076100     WHEN SQLCODE = -904                                                  
076200     WHEN SQLCODE = -911                                                  
076300     WHEN SQLCODE = -913                                                  
076400* SOFT ABORT                                                              
076500         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
076600         MOVE 17                      TO RC809-PREPACK-ERROR-NBR          
076700         PERFORM RC001-RETURN-MSG                                         
076800         SET PS-DONE                                                      
076900             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
077000     WHEN OTHER                                                           
077100         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
077200         MOVE 6                       TO RC809-PREPACK-ERROR-NBR          
077300         SET PS-DONE                  TO TRUE                             
077400         PERFORM RC001-RETURN-MSG                                         
077500     END-EVALUATE.                                                        
077600                                                                          
077700 7100-OPEN-PREPACK-CURSOR.                                                
077800     EXEC SQL                                                             
077900          OPEN PREPACK-ITEM-CSR                                           
078000     END-EXEC.                                                            
078100                                                                          
078200     EVALUATE TRUE                                                        
078300     WHEN SQLCODE = ZERO                                                  
078400         SET PS-CURSOR-OPEN           TO TRUE                             
078500     WHEN SQLCODE = -904                                                  
078600     WHEN SQLCODE = -911                                                  
078700     WHEN SQLCODE = -913                                                  
078800* SOFT ABORT                                                              
078900         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
079000         MOVE 18                      TO RC809-PREPACK-ERROR-NBR          
079100         PERFORM RC001-RETURN-MSG                                         
079200         SET PS-DONE                                                      
079300             RC809-DB2-TIMEOUT-ERROR                                      
079400             PS-CURSOR-NOT-OPEN       TO TRUE                             
079500     WHEN OTHER                                                           
079600         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
079700         MOVE 7                       TO RC809-PREPACK-ERROR-NBR          
079800         SET PS-DONE                                                      
079900             PS-CURSOR-NOT-OPEN       TO TRUE                             
080000         PERFORM RC001-RETURN-MSG                                         
080100     END-EVALUATE.                                                        
080200                                                                          
080300                                                                          
080400 7110-FETCH-PREPACK-CURSOR.                                               
080500                                                                          
080600     EXEC SQL                                                             
080700     FETCH PREPACK-ITEM-CSR                                               
080800     INTO                                                                 
080900          :RECITM-ORD-LNE-NBR                                             
081000       ,  :RECITM-PKSL-ITM-QTY                                            
081100       ,  :RECITM-DTL-CK-ITM-QTY                                          
081200       ,  :RECITM-PREPK-RATO-QTY                                          
081300       ,  :RECITM-CASE-PACK-QTY                                           
081400       ,  :RECITM-INNR-PACK-QTY                                           
081500       ,  :RECITM-PREPK-ODD-UNT-QTY                                       
081600       ,  :RECITM-PREPK-DRV-LNE-CDE                                       
081700     END-EXEC.                                                            
081800                                                                          
081900     EVALUATE TRUE                                                        
082000     WHEN SQLCODE = ZERO                                                  
082100         ADD 1                        TO PV-FETCH-COUNTER                 
082200     WHEN SQLCODE = +100                                                  
082300          SET PS-END-OF-PREPACK   TO TRUE                                 
082400     WHEN SQLCODE = -904                                                  
082500     WHEN SQLCODE = -911                                                  
082600     WHEN SQLCODE = -913                                                  
082700* SOFT ABORT                                                              
082800         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
082900         MOVE 19                      TO RC809-PREPACK-ERROR-NBR          
083000         PERFORM RC001-RETURN-MSG                                         
083100         SET PS-DONE                                                      
083200             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
083300     WHEN OTHER                                                           
083400         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
083500         MOVE 8                       TO RC809-PREPACK-ERROR-NBR          
083600         SET PS-DONE                  TO TRUE                             
083700         PERFORM RC001-RETURN-MSG                                         
083800     END-EVALUATE.                                                        
083900                                                                          
084000 7120-CLOSE-PREPACK-CURSOR.                                               
084100                                                                          
084200     EXEC SQL                                                             
084300         CLOSE PREPACK-ITEM-CSR                                           
084400     END-EXEC.                                                            
084500                                                                          
084600     EVALUATE TRUE                                                        
084700     WHEN SQLCODE = ZERO                                                  
084800         CONTINUE                                                         
084900     WHEN SQLCODE = -904                                                  
085000     WHEN SQLCODE = -911                                                  
085100     WHEN SQLCODE = -913                                                  
085200* SOFT ABORT                                                              
085300         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
085400         MOVE 20                      TO RC809-PREPACK-ERROR-NBR          
085500         PERFORM RC001-RETURN-MSG                                         
085600         SET PS-DONE                                                      
085700             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
085800     WHEN OTHER                                                           
085900         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
086000         MOVE 9                       TO RC809-PREPACK-ERROR-NBR          
086100         SET PS-DONE                  TO TRUE                             
086200         PERFORM RC001-RETURN-MSG                                         
086300     END-EVALUATE.                                                        
086400/                                                                         
086500 7200-SELECT-PURITM.                                                      
086600     EXEC SQL                                                             
086700         SELECT                                                           
086800             PO_LNE_NBR                                                   
086900         ,   PREPK_RATO_QTY                                               
087000         ,   PIC_ITM_IND                                                  
087100         INTO                                                             
087200             :PURITM-PO-LNE-NBR                                           
087300         ,   :PURITM-PREPK-RATO-QTY                                       
087400         ,   :PURITM-PIC-ITM-IND                                          
087500         FROM TPURITM                                                     
087600         WHERE PO_NBR           = :TM500-PO-NBR                           
087700             AND APP_PO_LNE_NBR = :RECITM-ORD-LNE-NBR                     
087800             AND VER_STATUS_CDE = 'A'                                     
087900     END-EXEC.                                                            
088000                                                                          
088100     EVALUATE TRUE                                                        
088200     WHEN SQLCODE = ZERO                                                  
088300         CONTINUE                                                         
088400     WHEN SQLCODE = +100                                                  
088500         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
088600         MOVE 10                      TO RC809-PREPACK-ERROR-NBR          
088700         SET PS-DONE                  TO TRUE                             
088800         PERFORM RC001-RETURN-MSG                                         
088900     WHEN SQLCODE = -904                                                  
089000     WHEN SQLCODE = -911                                                  
089100     WHEN SQLCODE = -913                                                  
089200* SOFT ABORT                                                              
089300         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
089400         MOVE 21                      TO RC809-PREPACK-ERROR-NBR          
089500         PERFORM RC001-RETURN-MSG                                         
089600         SET PS-DONE                                                      
089700             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
089800     WHEN OTHER                                                           
089900         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
090000         MOVE 11                      TO RC809-PREPACK-ERROR-NBR          
090100         SET PS-DONE                  TO TRUE                             
090200         PERFORM RC001-RETURN-MSG                                         
090300     END-EVALUATE.                                                        
090400/                                                                         
090500 7250-UPDATE-RECITM.                                                      
090600                                                                          
090700     EXEC SQL                                                             
090800         UPDATE TRECITM                                                   
090900              SET                                                         
091000                  PREPK_ODD_UNT_QTY = :RECITM-PREPK-ODD-UNT-QTY           
091100         WHERE ORD_NBR        = :RC809-PO-NBR                             
091200           AND ORD_LNE_NBR    = :RECITM-ORD-LNE-NBR                       
091300           AND REC_SEQ_NBR    = :RC809-REC-SEQ-NBR                        
091400           AND OPER_UNT_ID    = :RC809-OPER-UNT-ID                        
091500           AND FCLTY_ID       = :RC809-FCLTY-ID                           
091600           AND VER_STATUS_CDE = 'A'                                       
091700     END-EXEC                                                             
091800                                                                          
091900     EVALUATE TRUE                                                        
092000     WHEN SQLCODE = ZERO                                                  
092100              CONTINUE                                                    
092200     WHEN SQLCODE = +100                                                  
092300         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
092400         MOVE 26                      TO RC809-PREPACK-ERROR-NBR          
092500         SET PS-DONE                  TO TRUE                             
092600         PERFORM RC001-RETURN-MSG                                         
092700     WHEN SQLCODE = -904                                                  
092800     WHEN SQLCODE = -911                                                  
092900     WHEN SQLCODE = -913                                                  
093000         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
093100         MOVE 27                      TO RC809-PREPACK-ERROR-NBR          
093200         PERFORM RC001-RETURN-MSG                                         
093300         SET PS-DONE                                                      
093400             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
093500                                                                          
093600     WHEN SQLWARN0 NOT = SPACES                                           
093700     WHEN SQLCODE  NOT = ZERO                                             
093800         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
093900         MOVE 28                      TO RC809-PREPACK-ERROR-NBR          
094000         SET PS-DONE                  TO TRUE                             
094100         PERFORM RC001-RETURN-MSG                                         
094200     END-EVALUATE.                                                        
094300/                                                                         
094400 7300-REMOVE-RECITM-DRIVER-LINE.                                          
094500                                                                          
094600     EXEC SQL                                                             
094700         UPDATE TRECITM                                                   
094800              SET                                                         
094900                  PREPK_DRV_LNE_CDE = ' '                                 
095000         WHERE ORD_NBR        = :RC809-PO-NBR                             
095100           AND REC_SEQ_NBR    = :RC809-REC-SEQ-NBR                        
095200           AND OPER_UNT_ID    = :RC809-OPER-UNT-ID                        
095300           AND FCLTY_ID       = :RC809-FCLTY-ID                           
095400           AND PREPK_ID       = :RC809-PREPK-ID                           
095500           AND VER_STATUS_CDE = 'A'                                       
095600     END-EXEC                                                             
095700                                                                          
095800     EVALUATE TRUE                                                        
095900     WHEN SQLCODE = ZERO                                                  
096000              CONTINUE                                                    
096100     WHEN SQLCODE = +100                                                  
096200         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
096300         MOVE 29                      TO RC809-PREPACK-ERROR-NBR          
096400         SET PS-DONE                  TO TRUE                             
096500         PERFORM RC001-RETURN-MSG                                         
096600     WHEN SQLCODE = -904                                                  
096700     WHEN SQLCODE = -911                                                  
096800     WHEN SQLCODE = -913                                                  
096900         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
097000         MOVE 30                      TO RC809-PREPACK-ERROR-NBR          
097100         PERFORM RC001-RETURN-MSG                                         
097200         SET PS-DONE                                                      
097300             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
097400                                                                          
097500     WHEN SQLWARN0 NOT = SPACES                                           
097600     WHEN SQLCODE  NOT = ZERO                                             
097700         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
097800         MOVE 31                      TO RC809-PREPACK-ERROR-NBR          
097900         SET PS-DONE                  TO TRUE                             
098000         PERFORM RC001-RETURN-MSG                                         
098100     END-EVALUATE.                                                        
098200/                                                                         
098300                                                                          
098400 7350-NEW-RECITM-DRIVER-LINE.                                             
098500     EXEC SQL                                                             
098600         UPDATE TRECITM                                                   
098700              SET                                                         
098800                  PREPK_DRV_LNE_CDE = 'A'                                 
098900         WHERE ORD_NBR        = :RC809-PO-NBR                             
099000           AND ORD_LNE_NBR    = :RECITM-ORD-LNE-NBR                       
099100           AND REC_SEQ_NBR    = :RC809-REC-SEQ-NBR                        
099200           AND OPER_UNT_ID    = :RC809-OPER-UNT-ID                        
099300           AND FCLTY_ID       = :RC809-FCLTY-ID                           
099400           AND PREPK_ID       = :RC809-PREPK-ID                           
099500           AND VER_STATUS_CDE = 'A'                                       
099600     END-EXEC                                                             
099700                                                                          
099800     EVALUATE TRUE                                                        
099900     WHEN SQLCODE = ZERO                                                  
100000              CONTINUE                                                    
100100     WHEN SQLCODE = +100                                                  
100200         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
100300         MOVE 32                      TO RC809-PREPACK-ERROR-NBR          
100400         SET PS-DONE                  TO TRUE                             
100500         PERFORM RC001-RETURN-MSG                                         
100600     WHEN SQLCODE = -904                                                  
100700     WHEN SQLCODE = -911                                                  
100800     WHEN SQLCODE = -913                                                  
100900         MOVE TM500-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
101000         MOVE 33                      TO RC809-PREPACK-ERROR-NBR          
101100         PERFORM RC001-RETURN-MSG                                         
101200         SET PS-DONE                                                      
101300             RC809-DB2-TIMEOUT-ERROR  TO TRUE                             
101400                                                                          
101500     WHEN SQLWARN0 NOT = SPACES                                           
101600     WHEN SQLCODE  NOT = ZERO                                             
101700         MOVE RECITM-ORD-LNE-NBR      TO RC001-PO-LNE-NBR                 
101800         MOVE 34                      TO RC809-PREPACK-ERROR-NBR          
101900         SET PS-DONE                  TO TRUE                             
102000         PERFORM RC001-RETURN-MSG                                         
102100     END-EVALUATE.                                                        
102200/                                                                         
102300 8000-CALL-OTR-MODULE.                                                    
102400                                                                          
102500     INITIALIZE DP277-KEYS                                                
102600     MOVE RC809-PO-NBR                TO DP277-PO-NBR                     
102700     MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                             
102800                                      TO DP277-PO-LNE-NBR                 
102900     MOVE RC809-REC-SEQ-NBR           TO DP277-REC-SEQ-NBR                
103000     MOVE RC809-OPER-UNT-ID           TO DP277-OPER-UNT-ID                
103100     MOVE RC809-FCLTY-ID              TO DP277-FCLTY-ID.                  
103200     MOVE RC809-PREPK-ID              TO DP277-PO-PREPK-ID                
103300                                                                          
103400     MOVE RC809-OTR-SCOPE             TO DP277-OTR-SCOPE                  
103500     SET DP277-STORE-LEVEL-OTR        TO TRUE                             
103600                                                                          
103700* TRY A SPECIFIC PLAN FIRST                                               
103800     SET DP277-SPECIFIC-PLAN          TO TRUE                             
103900                                                                          
104000     PERFORM 8010-LINK-TO-DPKCS277.                                       
104100     IF PS-NOT-DONE                                                       
104200         IF DP277-NO-DISTRO                                               
104300             SET DP277-MASTER-PLAN    TO TRUE                             
104400             PERFORM 8010-LINK-TO-DPKCS277                                
104500         END-IF                                                           
104600     END-IF.                                                              
104700                                                                          
104800     IF PS-NOT-DONE                                                       
104900         MOVE DP277-STORE-PLAN-SCOPE  TO RC809-STORE-PLAN-SCOPE           
105000         MOVE DP277-DISTRO-REQ-ID     TO RC809-DISTRO-REQ-ID              
105100     END-IF.                                                              
105200                                                                          
105300                                                                          
105400 8010-LINK-TO-DPKCS277.                                                   
105500     EXEC CICS LINK                                                       
105600         PROGRAM  (PC-DPKCS277)                                           
105700         COMMAREA (DP277-COMMAREA)                                        
105800         RESP     (PV-CICS-RESP)                                          
105900     END-EXEC.                                                            
106000                                                                          
106100*  CHECK CICS RETURN CODE                                                 
106200     IF PV-CICS-RESP = DFHRESP(NORMAL)                                    
106300         CONTINUE                                                         
106400     ELSE                                                                 
106500         MOVE DP277-PO-LNE-NBR        TO RC001-PO-LNE-NBR                 
106600         MOVE 12                      TO RC809-PREPACK-ERROR-NBR          
106700         SET PS-DONE                  TO TRUE                             
106800         PERFORM RC001-RETURN-MSG                                         
106900     END-IF.                                                              
107000                                                                          
107100*  CHECK DP277-RETURN-CODE                                                
107200     EVALUATE TRUE                                                        
107300     WHEN DP277-RETURN-CODE = ZERO                                        
107400         CONTINUE                                                         
107500     WHEN OTHER                                                           
107600         EVALUATE TRUE                                                    
107700         WHEN DP277-SOFT-ABORT                                            
107800             MOVE DP277-PO-LNE-NBR    TO RC001-PO-LNE-NBR                 
107900             MOVE 22                  TO RC809-PREPACK-ERROR-NBR          
108000             PERFORM RC001-RETURN-MSG                                     
108100             SET PS-DONE                                                  
108200                 RC809-DB2-TIMEOUT-ERROR TO TRUE                          
108300                                                                          
108400         WHEN DP277-NO-DISTRO                                             
108500             CONTINUE                                                     
108600         WHEN OTHER                                                       
108700             MOVE DP277-PO-LNE-NBR    TO RC001-PO-LNE-NBR                 
108800             MOVE 23                  TO RC809-PREPACK-ERROR-NBR          
109000             SET RC809-OTR-ERROR                                          
109100                 PS-DONE              TO TRUE                             
108900             PERFORM RC001-RETURN-MSG                                     
109200         END-EVALUATE                                                     
109300     END-EVALUATE.                                                        
109400/                                                                         
109500 8100-CALL-PACK-EDIT-MODULE.                                              
109600                                                                          
109700     PERFORM 8200-WRITE-TEMP-QUEUE                                        
109800         VARYING RC808-LINE-IDX FROM 1 BY 1                               
109900         UNTIL RC808-PRPK-LNE-NBR(RC808-LINE-IDX) = ZERO                  
110000             OR RC808-LINE-IDX > PC-MAX-LINES                             
110100                                                                          
110200     IF PV-CICS-RESP = DFHRESP (NORMAL)                                   
110300     EXEC CICS LINK                                                       
110400         PROGRAM  (PC-RCKCS809)                                           
110500         COMMAREA (RC809-COMMAREA)                                        
110600         RESP     (PV-CICS-RESP)                                          
110700     END-EXEC                                                             
110800                                                                          
110900*  CHECK CICS RETURN CODE                                                 
111000     IF PV-CICS-RESP = DFHRESP(NORMAL)                                    
111100         CONTINUE                                                         
111200     ELSE                                                                 
111300         MOVE RC809-PURITM-LNE-NBR    TO RC001-PO-LNE-NBR                 
111400         MOVE 13                      TO RC809-PREPACK-ERROR-NBR          
111500         SET PS-DONE                  TO TRUE                             
111600         PERFORM RC001-RETURN-MSG                                         
111700     END-IF                                                               
111800     END-IF.                                                              
111900                                                                          
112000*  CHECK RC809-RETURN-CODE                                                
112100     EVALUATE TRUE                                                        
112200     WHEN RC809-CALL-SUCCESSFUL                                           
112300         CONTINUE                                                         
112400     WHEN RC809-DIDNT-ALLOC-DUE-TO-TRBL                                   
112500         MOVE RC809-LINES-IN-TRBL-COUNT                                   
112600                                      TO                                  
112700                                      TM500-LINES-IN-TRBL-COUNT           
112800     WHEN OTHER                                                           
112900         EVALUATE TRUE                                                    
113000         WHEN RC809-SOFT-ABORT                                            
113100                                                                          
113200             MOVE RC809-SEVERITY-IND  TO DP020-MSG-SEVERITY-IND           
113300             MOVE +551                TO DP020-MSG-NUMBER                 
113400             PERFORM 9000-ROLLBACK                                        
113500         WHEN RC809-NO-DISTRO                                             
113600         WHEN RC809-PRORATE-ERROR                                         
113700             CONTINUE                                                     
113800         WHEN OTHER                                                       
113900             MOVE RC809-SEVERITY-IND                                      
114000                                 TO DP020-MSG-SEVERITY-IND                
114100             MOVE +1096          TO DP020-MSG-NUMBER                      
114200         END-EVALUATE                                                     
114300     END-EVALUATE.                                                        
114400/                                                                         
114500 8200-WRITE-TEMP-QUEUE.                                                   
114600                                                                          
114700     PERFORM 8205-BUILD-TEMP-STORAGE                                      
114800     ADD  +1                          TO PV-ITEM                          
114900                                         RC809-QUEUE-REC-COUNT            
115000     EXEC CICS WRITEQ TS                                                  
115100         QUEUE   (RC809-QUEUE-NAME)                                       
115200         FROM (RC810-TEMP-STORAGE-RECORD)                                 
115300         ITEM    (PV-ITEM)                                                
115400         RESP    (PV-CICS-RESP)                                           
115500     END-EXEC.                                                            
115600                                                                          
115700     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                               
115800         MOVE RC809-PURITM-LNE-NBR    TO RC001-PO-LNE-NBR                 
115900         MOVE 14                      TO RC809-PREPACK-ERROR-NBR          
116000         SET PS-DONE                  TO TRUE                             
116100         PERFORM RC001-RETURN-MSG                                         
116200     END-IF.                                                              
116300                                                                          
116400 8205-BUILD-TEMP-STORAGE.                                                 
116500                                                                          
116600     INITIALIZE RC810-TEMP-STORAGE-RECORD.                                
116700                                                                          
116800     MOVE RC808-PRPK-LNE-NBR(RC808-LINE-IDX)                              
116900                                      TO RC810-PRPK-LNE-NBR               
117000     MOVE RC808-PKSL-ITM-QTY(RC808-LINE-IDX)                              
117100                                      TO RC810-PKSL-ITM-QTY               
117200     MOVE RC808-DTL-CK-ITM-QTY(RC808-LINE-IDX)                            
117300                                      TO RC810-DTL-CK-ITM-QTY             
117400     MOVE RC808-CURR-SPLIT-QTY(RC808-LINE-IDX)                            
117500                                      TO RC810-CURR-SPLIT-QTY             
117600     MOVE RC808-CASE-PACK-QTY (RC808-LINE-IDX)                            
117700                                      TO RC810-CASE-PACK-QTY              
117800     MOVE RC808-INNR-PACK-QTY (RC808-LINE-IDX)                            
117900                                      TO RC810-INNR-PACK-QTY              
118000     MOVE RC808-DRV-LNE-CDE (RC808-LINE-IDX)                              
118100                                      TO RC810-DRV-LNE-CDE                
118200     MOVE RC808-RECITM-RATO-QTY (RC808-LINE-IDX)                          
118300                                      TO RC810-RECITM-RATO-QTY            
118400     MOVE RC808-PURITM-RATO-QTY (RC808-LINE-IDX)                          
118500                                      TO RC810-PURITM-RATO-QTY            
118600     MOVE RC808-BEST-CASE-UNITS (RC808-LINE-IDX)                          
118700                                      TO RC810-BEST-CASE-UNITS            
118800     MOVE RC808-ODD-UNITS (RC808-LINE-IDX)                                
118900                                      TO RC810-ODD-UNITS                  
119000     MOVE RC808-LNE-DISTRO-QTY (RC808-LINE-IDX)                           
119100                                      TO RC810-LNE-DISTRO-QTY             
119200     MOVE RC808-LNE-OTR-QTY (RC808-LINE-IDX)                              
119300                                      TO RC810-LNE-OTR-QTY                
119400     MOVE RC808-LNE-OTR-PACK-QTY (RC808-LINE-IDX)                         
119500                                      TO RC810-LNE-OTR-PACK-QTY           
119600     MOVE RC808-ALLOC-OUTR-PK-QTY (RC808-LINE-IDX)                        
119700                                      TO RC810-ALLOC-OUTR-PK-QTY          
119800     MOVE RC808-PK-SIZE-RND-CDE (RC808-LINE-IDX)                          
119900                                      TO RC810-PK-SIZE-RND-CDE            
120000     MOVE RC808-AD-ITM-IND (RC808-LINE-IDX)                               
120100                                      TO RC810-AD-ITM-IND                 
120200     MOVE RC809-PRORATE-IND                                               
120300                                      TO RC810-PRORATE-IND                
120400                                                                          
120500     PERFORM VARYING RC808-STR-IDX FROM 1 BY 1 UNTIL                      
120600             RC808-STR-NBR(RC808-LINE-IDX, RC808-STR-IDX) = ZERO          
120700                   OR RC808-STR-IDX > PC-MAX-STORES                       
120800                                                                          
120900             SET RC810-STR-IDX        TO RC808-STR-IDX                    
121000                                                                          
121100             MOVE RC808-STR-NBR                                           
121200                 (RC808-LINE-IDX, RC808-STR-IDX)                          
121300                                      TO                                  
121400                  RC810-STR-NBR (RC810-STR-IDX)                           
121500             MOVE RC808-ALLOC-UNITS                                       
121600                 (RC808-LINE-IDX, RC808-STR-IDX)                          
121700                                      TO                                  
121800                  RC810-ALLOC-UNITS (RC810-STR-IDX)                       
121900             MOVE RC808-STR-DISTRO-QTY                                    
122000                 (RC808-LINE-IDX, RC808-STR-IDX)                          
122100                                      TO                                  
122200                  RC810-STR-DISTRO-QTY (RC810-STR-IDX)                    
122300             MOVE RC808-STR-DISTRO-PK                                     
122400                 (RC808-LINE-IDX, RC808-STR-IDX)                          
122500                                      TO                                  
122600                  RC810-STR-DISTRO-PK (RC810-STR-IDX)                     
122700             MOVE RC808-ALLOC-SEQ-CDE                                     
122800                 (RC808-LINE-IDX, RC808-STR-IDX)                          
122900                                      TO                                  
123000                  RC810-ALLOC-SEQ-CDE (RC810-STR-IDX)                     
123100             MOVE RC808-RNK-SEQ-NBR                                       
123200                 (RC808-LINE-IDX, RC808-STR-IDX)                          
123300                                      TO                                  
123400                  RC810-RNK-SEQ-NBR (RC810-STR-IDX)                       
123500             MOVE RC808-STR-CNSTR-CDE                                     
123600                 (RC808-LINE-IDX, RC808-STR-IDX)                          
123700                                      TO                                  
123800                  RC810-STR-CNSTR-CDE (RC810-STR-IDX)                     
123900             MOVE RC808-STR-CNSTR-QTY                                     
124000                 (RC808-LINE-IDX, RC808-STR-IDX)                          
124100                                      TO                                  
124200                  RC810-STR-CNSTR-QTY (RC810-STR-IDX)                     
124300             MOVE RC808-STR-OTR-PK                                        
124400                 (RC808-LINE-IDX, RC808-STR-IDX)                          
124500                                      TO                                  
124600                  RC810-STR-OTR-PK (RC810-STR-IDX)                        
124700             MOVE RC808-STR-OTR-QTY                                       
124800                 (RC808-LINE-IDX, RC808-STR-IDX)                          
124900                                      TO                                  
125000                  RC810-STR-OTR-QTY (RC810-STR-IDX)                       
125100     END-PERFORM.                                                         
125200                                                                          
125300 8250-DELETE-TEMP-QUEUE.                                                  
125400                                                                          
125500     EXEC CICS DELETEQ TS                                                 
125600         QUEUE   (RC809-QUEUE-NAME)                                       
125700         RESP    (PV-CICS-RESP)                                           
125800     END-EXEC.                                                            
125900                                                                          
126000     IF PV-CICS-RESP  = DFHRESP (NORMAL)                                  
126100        OR PV-CICS-RESP = DFHRESP (QIDERR)                                
126200         CONTINUE                                                         
126300     ELSE                                                                 
126400         MOVE RC809-PURITM-LNE-NBR    TO RC001-PO-LNE-NBR                 
126500         MOVE 15                      TO RC809-PREPACK-ERROR-NBR          
126600         SET PS-DONE                  TO TRUE                             
126700         PERFORM RC001-RETURN-MSG                                         
126800     END-IF.                                                              
126900/                                                                         
127000 8300-VALIDATION-MODULE.                                                  
127100                                                                          
127200     EXEC CICS LINK                                                       
127300         PROGRAM  (PC-RCKCS806)                                           
127400         COMMAREA (RC806-PRODUCT-PACK-VALIDATION)                         
127500         RESP     (PV-CICS-RESP)                                          
127600     END-EXEC.                                                            
127700                                                                          
127800*  CHECK CICS RETURN CODE                                                 
127900     IF PV-CICS-RESP = DFHRESP(NORMAL)                                    
128000         CONTINUE                                                         
128100     ELSE                                                                 
128200         SET DP013-CICS-ABEND                                             
128300             DP013-NO-ROLLBACK   TO TRUE                                  
128400         MOVE '8300-VALIDATION-MODULE'                                    
128500                                 TO DP013-PARAGRAPH                       
128600         MOVE 'ATTEMPTING TO LINK TO PROGRAM RCKCS806'                    
128700                                 TO DP013-MESSAGE-TEXT (1)                
128800         PERFORM DP013-0000-PROCESS-ABEND                                 
128900     END-IF.                                                              
129000                                                                          
129100 8400-CHECK-RECDIS-ALLOC.                                                 
129200                                                                          
129300*  INITIALIZE FIELDS.                                                     
129400     SET RC811-DELETE-A-DISTRO-PACK   TO TRUE                             
129500     MOVE TM500-PO-NBR                TO RC811-PO-NBR                     
129600     MOVE TM500-REC-SEQ-NBR           TO RC811-REC-SEQ-NBR                
129700     MOVE TM500-OPER-UNT-ID           TO RC811-OPER-UNIT-ID               
129800     MOVE TM500-FCLTY-ID              TO RC811-FACILITY-ID                
129900     MOVE TM500-PREPK-ID              TO RC811-PREPK-ID                   
130000                                                                          
130100     EXEC CICS                                                            
130200         LINK PROGRAM  (PC-RCKCS811)                                      
130300              COMMAREA (RC811-STORE-RECDIS-PROCESSING)                    
130400     END-EXEC                                                             
130500                                                                          
130600     EVALUATE TRUE                                                        
130700         WHEN RC811-SUCCESSFUL-PACK-DELETE                                
130800         WHEN RC811-PACK-IN-RECDIS-NOT-FOUND                              
130900             CONTINUE                                                     
131000         WHEN OTHER                                                       
131100             SET PS-DONE              TO TRUE                             
131200             MOVE RC809-SEVERITY-IND                                      
131300                                      TO DP020-MSG-SEVERITY-IND           
131400             MOVE +1096               TO DP020-MSG-NUMBER                 
131500     END-EVALUATE.                                                        
131600/                                                                         
131700 9000-ROLLBACK.                                                           
131800     EXEC CICS                                                            
131900         SYNCPOINT ROLLBACK                                               
132000     END-EXEC.                                                            
132100                                                                          
132200******************************************************************        
132300*    ABEND PROCESSING                                                     
132400******************************************************************        
132500     COPY DPPD013.                                                        
132600     COPY RCPD001.                                                        
