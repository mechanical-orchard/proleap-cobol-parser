000100*-----------------------*                                         00010037
000200 IDENTIFICATION DIVISION.                                         00020038
000300*-----------------------*                                         00030038
000400 PROGRAM-ID.    TRKCS126.                                         00040038
000500 AUTHOR.        MICHAEL WALTERS                                   00050038
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060038
000700 DATE-WRITTEN.  05-05-95.                                         00070038
000800 DATE-COMPILED.                                                   00080038
000900*----------------------------------------------------------------*00090038
001000*    Y126 - FORECAST SHIPMENT DELETE                             *00100038
001100*                                                                *00110038
001200*    THIS PROGRAM ALLOWS THE USER TO DELETE A FORCAST SHIPMENT.  *00120038
001300*----------------------------------------------------------------*00130038
001400* CHANGED 12-02-2011 CHRSITINE TWIEHAUS      WR40574              00140038
001500*         ADDED CARR-AUTH-ID                                      00150038
001600*---------------------------------------------------------------* 00160038
001400* CHANGED 10-29-2014 CHERI PARMLEY           CHG0094517           00161042
001500*         RE-COMPILE ONLY FOR TRWS001 CHANGED PO# LENGTH          00162042
001600*---------------------------------------------------------------* 00163042
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00164043
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00165043
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00166043
CICS  *-----------------------------------------------------------------00167043
001700                                                                  00170038
001800 ENVIRONMENT DIVISION.                                            00180038
001900                                                                  00190038
002000 DATA DIVISION.                                                   00200038
002100                                                                  00210038
002200                                                                  00220038
002300 WORKING-STORAGE SECTION.                                         00230038
002400                                                                  00240038
002500 01  DK-DB2-KEYS.                                                 00250038
002600     05  DK-PRO-NBR                     PIC  X(16).               00260038
002700     05  DK-BOL-NBR                     PIC  X(30).               00270038
002800     05  DK-SCAC-ID                     PIC  X(04).               00280038
002900     05  DK-SHIPT-ID                    PIC S9(09)  COMP.         00290038
003000     05  DK-TRIP-ID                     PIC S9(09)  COMP.         00300038
003100*                                                                 00310038
003200 01  PC-PROGRAM-CONSTANTS.                                        00320038
003300     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR126A  '.  00330038
003400     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM126 '.  00340038
003500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS126'.  00350038
003600     05  PC-RCKUT023              PIC  X(08)  VALUE  'RCKUT023'.  00360038
003700     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00370038
003800                                              COMP.               00380038
003900     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3           00390038
004000                                              COMP.               00400038
004100     05  PC-LIST-FORMAT           PIC  X(01)  VALUE '1'.          00410038
004200     05  PC-ACTIVE                PIC  X(01)  VALUE 'A'.          00420038
004300     05  PC-PO-ACTIVE             PIC  X(02)  VALUE 'AC'.         00430038
004400     05  PC-APPROVED              PIC X(02)   VALUE 'AP'.         00440038
004500     05  PC-CANCELLED             PIC X(02)   VALUE 'CA'.         00450038
004600     05  PC-D                     PIC X(01)   VALUE 'D'.          00460038
004700     05  PC-CANBALENCE            PIC X(02)   VALUE 'CB'.         00470038
004800     05  PC-COMPLETE              PIC X(02)   VALUE 'CM'.         00480038
004900     05  PC-TSYMSG-NUMBERS.                                       00490038
005000         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.       00500038
005100         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00510038
005200         10  PC-TSYMSG-00116      PIC  9(05)  VALUE  00116.       00520038
005300         10  PC-TSYMSG-00354      PIC  9(05)  VALUE  00354.       00530038
005400         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       00540038
005500         10  PC-TSYMSG-00641      PIC  9(05)  VALUE  00641.       00550038
005600         10  PC-TSYMSG-01007      PIC  9(05)  VALUE  01007.       00560038
005700         10  PC-TSYMSG-01014      PIC  9(05)  VALUE  01014.       00570038
005800*                                                                 00580038
005900 01  PS-PROGRAM-SWITCHES.                                         00590038
006000     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         00600038
006100         88  PS-COMMAREA-VALID                VALUE  'Y'.         00610038
006200         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         00620038
006300     05  PS-FOUND-SW              PIC  X(01)  VALUE ' '.          00630038
006400         88  PS-FOUND                         VALUE 'Y'.          00640038
006500         88  PS-NOT-FOUND                     VALUE 'N'.          00650038
006600     05  PS-OTHER-SHIPT-EXIST-SW  PIC  X(01)  VALUE 'N'.          00660038
006700         88  PS-OTHER-SHIPT-EXIST             VALUE 'Y'.          00670038
006800         88  PS-OTHER-SHIPT-DONT-EXIST        VALUE 'N'.          00680038
006900     05  PS-RECEIVERS-FOUND-SW    PIC  X(01)  VALUE 'N'.          00690038
007000         88  PS-RECEIVERS-FOUND               VALUE 'Y'.          00700038
007100         88  PS-NO-RECEIVERS-FOUND            VALUE 'N'.          00710038
007200     05  PS-ALREADY-DELETED-SW    PIC  X(01)  VALUE 'N'.          00720038
007300         88  PS-ALREADY-DELETED               VALUE 'Y'.          00730038
007400         88  PS-NOT-ALREADY-DELETED           VALUE 'N'.          00740038
007500     05  PS-DONE-SW               PIC  X(01)  VALUE 'N'.          00750038
007600         88  PS-DONE                          VALUE 'Y'.          00760038
007700         88  PS-NOT-DONE                      VALUE 'N'.          00770038
007800     05  PS-ERROR-SW              PIC  X(01)  VALUE 'Y'.          00780038
007900         88  PS-NO-ERROR                      VALUE 'Y'.          00790038
008000         88  PS-ERROR                         VALUE 'N'.          00800038
008100     05  PS-NEXT-SCREEN-SW        PIC  X      VALUE 'N'.          00810038
008200         88  PS-NO-NEXT-SCREEN                VALUE 'N'.          00820038
008300         88  PS-NEXT-SCREEN                   VALUE 'Y'.          00830038
008400     05  PS-UPDATE-SW             PIC  X      VALUE 'N'.          00840038
008500         88  PS-NO-UPDATES-DONE               VALUE 'N'.          00850038
008600         88  PS-UPDATES-DONE                  VALUE 'Y'.          00860038
008700*                                                                 00870038
008800 01  PV-PROGRAM-VARIABLES.                                        00880038
008900     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00890038
009000                                              COMP SYNC.          00900038
009100     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00910038
009200                                              COMP SYNC.          00920038
009300     05  PV-TEMP-SHIPT-ID         PIC S9(9)   COMP VALUE +0.      00930038
009400     05  PV-NULL-INDICATORS.                                      00940038
009500         10  PV-NI-TRIP-ID        PIC S9(4)   VALUE +0            00950038
009600                                              COMP.               00960038
009700         10  PV-NI-VEH-NBR        PIC S9(4)   VALUE +0            00970038
009800                                              COMP.               00980038
009900         10  PV-NI-AR-DTE         PIC S9(4)   VALUE +0            00990038
010000                                              COMP.               01000038
010100         10  PV-NI-AR-TME         PIC S9(4)   VALUE +0            01010038
010200                                              COMP.               01020038
010300         10  PV-NI-AR-TMST        PIC S9(4)   VALUE +0            01030038
010400                                              COMP.               01040038
010500     05  PV-EST-AR-TME            PIC X(08).                      01050038
010600     05  PV-EST-AR-DTE            PIC X(10).                      01060038
010700     05  PV-WORK-DATE.                                            01070038
010800         10  PV-WK-DTE-MM             PIC X(02).                  01080038
010900         10  FILLER                   PIC X(01) VALUE '/'.        01090038
011000         10  PV-WK-DTE-DD             PIC X(02).                  01100038
011100         10  FILLER                   PIC X(01) VALUE '/'.        01110038
011200         10  PV-WK-DTE-YY             PIC X(04).                  01120038
011300     05  PV-TEMP-DATE.                                            01130038
011400         10  PV-DATE-CCYY             PIC X(04).                  01140038
011500         10  FILLER                   PIC X(01).                  01150038
011600         10  PV-DATE-MM               PIC X(02).                  01160038
011700         10  FILLER                   PIC X(01).                  01170038
011800         10  PV-DATE-DD               PIC X(02).                  01180038
011900     05  PV-WORK-TIME.                                            01190038
012000         10  PV-TIME-HH               PIC X(02).                  01200038
012100         10  FILLER                   PIC X(01).                  01210038
012200         10  PV-TIME-MM               PIC X(02).                  01220038
012300         10  FILLER                   PIC X(01).                  01230038
012400         10  PV-TIME-SS               PIC X(02).                  01240038
012500     05  PV-DB2-CURRENT-DATE          PIC X(10).                  01250038
012600     05  PV-DB2-CURRENT-TIME          PIC X(10).                  01260038
012700                                                                  01270038
012800                                                                  01280038
012900 EJECT                                                            01290038
013000*----------------------------------------------------------------*01300038
013100*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *01310038
013200*----------------------------------------------------------------*01320038
013300                                                                  01330038
013400     COPY DPWS044.                                                01340038
013500 EJECT                                                            01350038
013600*----------------------------------------------------------------*01360038
013700*    MAP LAYOUT                                                  *01370038
013800*----------------------------------------------------------------*01380038
013900                                                                  01390038
014000     COPY TRKM126.                                                01400038
014100                                                                  01410038
014200                                                                  01420038
014300     EJECT                                                        01430038
014400*----------------------------------------------------------------*01440038
014500*    ATTRIBUTE SETTINGS COPYBOOK.                                *01450038
014600*----------------------------------------------------------------*01460038
014700                                                                  01470038
014800     COPY DPWS015.                                                01480038
014900                                                                  01490038
015000***************************************************************** 01500038
015100*    COPY BOOKS FOR THE VALIDATION ROUTINE FOR THE FREIGHT BILL   01510038
015200*    BILL OF LADING, AND VEHICLE NUMBER                           01520038
015300***************************************************************** 01530038
015400     COPY RCWS023.                                                01540038
015500                                                                  01550038
015600 EJECT                                                            01560038
015700*----------------------------------------------------------------*01570038
015800*    FUNCTION KEYS COPYBOOK                                      *01580038
015900*----------------------------------------------------------------*01590038
016000                                                                  01600038
016100     COPY DPWS016.                                                01610038
016200******************************************************************01620038
016300** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01630038
016400** SUB-ROUTINE (DPKUT100).                                      **01640038
016500******************************************************************01650038
016600     COPY DPWS010I.                                               01660038
016700 EJECT                                                            01670038
016800***************************************************************** 01680038
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            01690043
017000***************************************************************** 01700038
017100     COPY DPWS030.                                                01710038
CICS       COPY DPWS930.                                                01711043
017200 EJECT                                                            01720038
017300***************************************************************** 01730038
017400*    STANDARD COMMAREA.                                           01740038
017500***************************************************************** 01750038
017600                                                                  01760038
017700     COPY DPWS020.                                                01770038
017800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01780038
017900                                                                  01790038
018000***************************************************************** 01800038
018100*    INTER-APPLICATION COMMAREA.                                  01810038
018200***************************************************************** 01820038
018300                                                                  01830038
018400         10  INTER-APPL-COMM-AREA PIC X(200).                     01840038
018500*---------------------------------------------------------------* 01850038
018600*   TRWS001 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED TO THIS  * 01860038
018700*             PROGRAM                                           * 01870038
018800*---------------------------------------------------------------* 01880038
018900     COPY TRWS001.                                                01890038
019000***************************************************************** 01900038
019100*    SPECIFIC COMMMAREA FOR TRKCS126.                             01910038
019200***************************************************************** 01920038
019300         10  ASC-SPECIFIC-COMMAREA.                               01930038
019400             15  ASC-KEY-FIELDS.                                  01940038
019500                 20  ASC-SHIPT-ID            PIC S9(09) COMP.     01950038
019600                 20  ASC-TRIP-ID             PIC S9(09) COMP.     01960038
019700                 20  ASC-OPER-UNT-ID         PIC  9(04).          01970038
019800                 20  ASC-FCLTY-ID            PIC  9(04).          01980038
019900             15  ASC-SCREEN-FIELDS.                               01990038
020000                 20  ASC-PRO-NBR             PIC  X(16).          02000038
020100                 20  ASC-BOL-NBR             PIC  X(30).          02010038
020200                 20  ASC-FCLTY-NME           PIC  X(25).          02020038
020300                 20  ASC-PRO-SCAC            PIC  X(04).          02030038
020400                 20  ASC-PRO-SCAC-DESC       PIC X(25).           02040038
020500                 20  ASC-ORIG-SCAC           PIC  X(04).          02050038
020600                 20  ASC-ORIG-SCAC-DESC      PIC X(25).           02060038
020700                 20  ASC-TRLR-NBR            PIC  X(10).          02070038
020800                 20  ASC-FB-CART-CNT         PIC  9(05).          02080038
020900                 20  ASC-ASN-CART-CNT        PIC  9(05).          02090038
021000                 20  ASC-FOR-CART-CNT        PIC  9(05).          02100038
021100                 20  ASC-VEND-SHIP-DTE       PIC  X(10).          02110038
021200                 20  ASC-AUTH-NBR            PIC  X(10).          02120038
021300                 20  ASC-AUTH-DTE            PIC  X(10).          02130038
021400                 20  ASC-ETA-DATE            PIC  X(10).          02140038
021500                 20  ASC-ETA-TIME.                                02150038
021600                     25  ASC-ETA-TIME-HH     PIC  X(02).          02160038
021700                     25  ASC-ETA-TIME-MM     PIC  X(02).          02170038
021800             15  ASC-SHIPT-STATUS-IND        PIC  X(01).          02180038
021900                 88  ASC-SHIPT-STATUS-OK            VALUE 'Y'.    02190038
022000                 88  ASC-SHIPT-STATUS-NOTOK         VALUE 'N'.    02200038
022100             15  ASC-DELETED-SW              PIC X(1).            02210038
022200                 88  ASC-DELETED             VALUE 'D'.           02220038
022300                 88  ASC-NOT-DELETED         VALUE 'N'.           02230038
022400             15  ASC-VHCL-ATTCHD-SW          PIC X(1).            02240038
022500                 88  ASC-VHCL-ATTCHD         VALUE 'Y'.           02250038
022600                 88  ASC-VHCL-NOT-ATTCHD     VALUE 'N'.           02260038
022700             15  FILLER                      PIC X(43).           02270038
022800     EJECT                                                        02280038
022900*----------------------------------------------------------------*02290038
023000*    ABEND PROCESSING COPYBOOK.                                  *02300038
023100*----------------------------------------------------------------*02310038
023200                                                                  02320038
023300     COPY DPWS013.                                                02330038
023400                                                                  02340038
023500*    DB2 AREA FOR TSHIPMT (SHIPMENT TABLE)                        02350038
023600                                                                  02360038
023700     EXEC SQL                                                     02370038
023800          INCLUDE TSHIPMT                                         02380038
023900     END-EXEC.                                                    02390038
024000                                                                  02400038
024100*    DB2 AREA FOR TAUSHIP (AUDIT SHIPMENT TABLE)                  02410038
024200                                                                  02420038
024300     EXEC SQL                                                     02430038
024400          INCLUDE TAUSHIP                                         02440038
024500     END-EXEC.                                                    02450038
024600                                                                  02460038
024700*    DB2 AREA FOR TSHIPST (SHIPMENT STATUS TABLE)                 02470038
024800                                                                  02480038
024900     EXEC SQL                                                     02490038
025000          INCLUDE TSHIPST                                         02500038
025100     END-EXEC.                                                    02510038
025200                                                                  02520038
025300*    DB2 AREA FOR TSHSTYP (SHIPMENT STATUS TYPE TABLE)            02530038
025400                                                                  02540038
025500     EXEC SQL                                                     02550038
025600          INCLUDE TSHSTYP                                         02560038
025700     END-EXEC.                                                    02570038
025800                                                                  02580038
025900*    DB2 AREA FOR TPKSLIP (PACK SLIP TABLE)                       02590038
026000                                                                  02600038
026100     EXEC SQL                                                     02610038
026200          INCLUDE TPKSLIP                                         02620038
026300     END-EXEC.                                                    02630038
026400                                                                  02640038
026500*    DB2 AREA FOR TAUVHCL (SHIPMENT/PO ASSOCIATION TABLE)         02650038
026600                                                                  02660038
026700     EXEC SQL                                                     02670038
026800          INCLUDE TAUVHCL                                         02680038
026900     END-EXEC.                                                    02690038
027000                                                                  02700038
027100*    DB2 AREA FOR TSHPTPO (SHIPMENT/PO ASSOCIATION TABLE)         02710038
027200                                                                  02720038
027300     EXEC SQL                                                     02730038
027400          INCLUDE TSHPTPO                                         02740038
027500     END-EXEC.                                                    02750038
027600                                                                  02760038
027700*    DB2 AREA FOR AUDIT SHIPMENT PO TABLE                         02770038
027800     EXEC SQL                                                     02780038
027900          INCLUDE TAUSHPO                                         02790038
028000     END-EXEC.                                                    02800038
028100                                                                  02810038
028200*    DB2 AREA FOR TSHIPPO (SHIPMENT/PO ASSOCIATION TABLE)         02820038
028300                                                                  02830038
028400     EXEC SQL                                                     02840038
028500          INCLUDE TSHIPPO                                         02850038
028600     END-EXEC.                                                    02860038
028700                                                                  02870038
028800*    DB2 AREA FOR TVHTRIP (VEHICLE TRIP TABLE)                    02880038
028900                                                                  02890038
029000     EXEC SQL                                                     02900038
029100          INCLUDE TVHTRIP                                         02910038
029200     END-EXEC.                                                    02920038
029300                                                                  02930038
029400*    DB2 AREA FOR VEHICLE TRIP AUDIT TABLE                      * 02940038
029500                                                                  02950038
029600     EXEC SQL                                                     02960038
029700          INCLUDE TAUTRIP                                         02970038
029800     END-EXEC.                                                    02980038
029900                                                                  02990038
030000                                                                  03000038
030100*    DB2 AREA FOR TVEHICL (VEHICLE TABLE)                         03010038
030200                                                                  03020038
030300     EXEC SQL                                                     03030038
030400          INCLUDE TVEHICL                                         03040038
030500     END-EXEC.                                                    03050038
030600                                                                  03060038
030700*    DB2 AREA FOR TTRIPST (TRIP STATUS TABLE)                     03070038
030800                                                                  03080038
030900     EXEC SQL                                                     03090038
031000          INCLUDE TTRIPST                                         03100038
031100     END-EXEC.                                                    03110038
031200                                                                  03120038
031300*    DB2 AREA FOR TTRSTYP (TRIP STATUS TYPE)                      03130038
031400                                                                  03140038
031500     EXEC SQL                                                     03150038
031600          INCLUDE TTRSTYP                                         03160038
031700     END-EXEC.                                                    03170038
031800                                                                  03180038
031900*    DB2 AREA FOR TSTATCD (PO STATUS CODE TABLE)                  03190038
032000                                                                  03200038
032100     EXEC SQL                                                     03210038
032200          INCLUDE TSTATCD                                         03220038
032300     END-EXEC.                                                    03230038
032400                                                                  03240038
032500*    DB2 AREA FOR TEXTENT (EXTERNAL ENTERPRISE TABLE)             03250038
032600                                                                  03260038
032700     EXEC SQL                                                     03270038
032800          INCLUDE TEXTENT                                         03280038
032900     END-EXEC.                                                    03290038
033000                                                                  03300038
033100*    DB2 AREA FOR TENTNME (EXTERNAL ENTERPRISE NAME TABLE)        03310038
033200                                                                  03320038
033300     EXEC SQL                                                     03330038
033400          INCLUDE TENTNME                                         03340038
033500     END-EXEC.                                                    03350038
033600                                                                  03360038
033700*    DB2 AREA FOR COMMUNICATIONS                                  03370038
033800                                                                  03380038
033900     EXEC SQL                                                     03390038
034000          INCLUDE SQLCA                                           03400038
034100     END-EXEC.                                                    03410038
034200                                                                  03420038
034300*     PO-SHIPMENT CURSOR DECLARE                                  03430038
034400                                                                  03440038
034500     EXEC SQL                                                     03450038
034600          DECLARE PO-SHIPMENT CURSOR FOR                          03460038
034700             SELECT  SHIPT_ID                                     03470038
034800                    ,PO_NBR                                       03480038
034900                    ,REC_SEQ_NBR                                  03490038
035000                    ,EXPTED_CART_CNT                              03500038
035100                    ,ACTL_CART_CNT                                03510038
035200                    ,DMG_CART_CNT                                 03520038
035300                    ,PKSL_IND                                     03530038
035400                    ,VEND_NAME                                    03540038
035500                    ,FRGT_CHG_AMT                                 03550038
035600                    ,LAST_UPD_PGM_ID                              03560038
035700                    ,CRE_USER_ID                                  03570038
035800                    ,CARR_CART_CT                                 03580038
035900                    ,CARR_LAST_UPD_DTE                            03590038
036000                    ,CARR_LAST_UPD_TIME                           03600038
036100                    ,VEND_CART_CT                                 03610038
036200                    ,VEND_LAST_UPD_DTE                            03620038
036300                    ,VEND_LAST_UPD_TIME                           03630038
036400                    ,CRE_TMST                                     03640038
036500                    ,LAST_UPD_DTE                                 03650038
036600                    ,LAST_UPD_TIME                                03660038
036700                    ,LAST_UPD_USER_ID                             03670038
036800                    ,PRIM_SHIPT_IND                               03680038
036900                    ,SPLT_XMIT_IND                                03690038
037000                    ,SPLT_XMIT_DTE                                03700038
037100                    ,SPLT_XMIT_TM                                 03710038
037200               FROM TSHPTPO                                       03720038
037300               WHERE SHIPT_ID = :DK-SHIPT-ID                      03730038
037400     END-EXEC.                                                    03740038
037500                                                                  03750038
037600 EJECT                                                            03760038
037700 LINKAGE SECTION.                                                 03770038
037800                                                                  03780038
037900 01  DFHCOMMAREA.                                                 03790038
038000     05  FILLER                         OCCURS  1 TO 4072 TIMES   03800038
038100                                        DEPENDING ON EIBCALEN.    03810038
038200         10  FILLER                     PIC  X(01).               03820038
038300                                                                  03830038
038400                                                                  03840038
038500 PROCEDURE DIVISION.                                              03850038
038600***************************************************************** 03860038
038700** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03870038
038800** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03880038
038900** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03890038
039000**                                                             ** 03900038
039100** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03910038
039200** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03920038
039300***************************************************************** 03930038
039400 0000-MAIN-MODULE.                                                03940038
039500     INITIALIZE DP030-CICS-API-FIELDS.                            03950038
039600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03960038
039700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03970038
039800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03980038
039900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03990038
040000     MOVE LENGTH OF TR126AI        TO DP030-MAP-LENGTH (1).       04000038
040100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04010038
040200     PERFORM 0001-CALL-CICS-ARCH-API.                             04020038
040300*                                                                 04030038
040400     PERFORM 1000-CONTROL-PROCESSING                              04040038
040500*                                                                 04050038
040600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04060038
040700     PERFORM 0001-CALL-CICS-ARCH-API.                             04070038
040800                                                                  04080038
040900 0001-CALL-CICS-ARCH-API.                                         04090038
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04100043
041100                                    DFHCOMMAREA                   04110043
041200                                    DP030-CICS-API-FIELDS         04120043
041300                                    DP020-STANDARD-COMMAREA       04130043
041400                                    TR126AI.                      04140043
041500*                                                                 04150038
041600     IF  DP030-RC-CALL-SUCCESSFUL                                 04160038
041700         CONTINUE                                                 04170038
041800     ELSE                                                         04180038
041900         SET DP013-NO-ROLLBACK                                    04190038
042000             DP013-XCTL-DISPLAY-RESTART                           04200038
042100             DP013-CICS-ABEND      TO TRUE                        04210038
042200         MOVE 'BEFORE 0000-MAIN-MODULE'                           04220038
042300                                   TO DP013-PARAGRAPH             04230038
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04240043
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04250043
042600         MOVE DP030-RETURN-CODE                                   04260038
042700                                   TO DP013-MESSAGE-TEXT (3)      04270038
042800         PERFORM DP013-0000-PROCESS-ABEND                         04280038
042900     END-IF.                                                      04290038
043000 EJECT                                                            04300038
043100*----------------------------------------------------------------*04310038
043200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04320038
043300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04330038
043400*----------------------------------------------------------------*04340038
043500                                                                  04350038
043600 1000-CONTROL-PROCESSING.                                         04360038
043700                                                                  04370038
043800     EVALUATE TRUE                                                04380038
043900         WHEN DP020-NEXT-ACT-INITIAL                              04390038
044000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04400038
044100                                                                  04410038
044200***-----$TEMPLATE NOTE$-------------------------------------------04420038
044300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04430038
044400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04440038
044500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04450038
044600***---------------------------------------------------------------04460038
044700             IF  PS-COMMAREA-NOT-VALID                            04470038
044800                 EVALUATE TRUE                                    04480038
044900                     WHEN ASC-SHIPT-STATUS-NOTOK                  04490038
045000                         MOVE PC-TSYMSG-00641 TO DP020-MSG-NUMBER 04500038
045100                     WHEN PS-RECEIVERS-FOUND                      04510038
045200                         MOVE PC-TSYMSG-01007 TO DP020-MSG-NUMBER 04520038
045300                     WHEN PS-NOT-FOUND                            04530038
045400                         MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER 04540038
045500                     WHEN OTHER                                   04550038
045600                         CONTINUE                                 04560038
045700                 END-EVALUATE                                     04570038
045800                 SET DP020-NEXT-ACT-APPL-ERROR                    04580038
045900                                          TO TRUE                 04590038
046000             ELSE                                                 04600038
046100                 PERFORM 4000-BUILD-INITIAL-PANEL                 04610038
046200                 MOVE PC-TSYMSG-00354  TO DP020-MSG-NUMBER        04620038
046300                 SET ASC-NOT-DELETED   TO TRUE                    04630038
046400             END-IF                                               04640038
046500                                                                  04650038
046600         WHEN DP020-NEXT-ACT-READ-MAP                             04660038
046700             MOVE ASC-SHIPT-ID    TO DK-SHIPT-ID                  04670038
046800             MOVE ASC-TRIP-ID     TO DK-TRIP-ID                   04680038
046900             PERFORM 2000-PROCESS-PANEL                           04690038
047000                                                                  04700038
047100         WHEN DP020-NEXT-ACT-RETURN                               04710038
047200             MOVE ASC-PRO-SCAC     TO DK-SCAC-ID                  04720038
047300                                                                  04730038
047400             MOVE ASC-PRO-NBR      TO RC023-FREIGHT-BILL          04740038
047500             CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA        04750038
047600             MOVE RC023-FREIGHT-BILL                              04760038
047700                                   TO DK-PRO-NBR                  04770038
047800                                                                  04780038
047900             MOVE ASC-BOL-NBR      TO RC023-BILL-OF-LADING        04790038
048000             CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA        04800038
048100             MOVE RC023-BILL-OF-LADING                            04810038
048200                                   TO DK-BOL-NBR                  04820038
048300                                                                  04830038
048400             MOVE ASC-TRIP-ID      TO DK-TRIP-ID                  04840038
048500                                                                  04850038
048600             PERFORM 4010-SELECT-VEHICLE-INFO                     04860038
048700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04870038
048800                                                                  04880038
048900         WHEN OTHER                                               04890038
049000             SET DP013-LOGIC-ABEND                                04900038
049100                 DP013-NO-ROLLBACK TO TRUE                        04910038
049200             MOVE '1000-CONTROL-PROCESSING'                       04920038
049300                                   TO DP013-PARAGRAPH             04930038
049400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04940038
049500                                   TO DP013-MESSAGE-TEXT(1)       04950038
049600             MOVE DP020-NEXT-APPL-ACTIVITY                        04960038
049700                                   TO DP013-MESSAGE-TEXT(2)       04970038
049800             PERFORM DP013-0000-PROCESS-ABEND                     04980038
049900     END-EVALUATE.                                                04990038
050000/                                                                 05000038
050100*----------------------------------------------------------------*05010038
050200* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05020038
050300*----------------------------------------------------------------*05030038
050400                                                                  05040038
050500 1100-PROCESS-INTER-APPL-COMM.                                    05050038
050600                                                                  05060038
050700     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05070038
050800                                                                  05080038
050900     SET PS-COMMAREA-VALID         TO TRUE.                       05090038
051000                                                                  05100038
051100     IF TR001-SCAC = SPACES OR                                    05110038
051200       (TR001-PRO-NBR = SPACES AND TR001-BOL-NBR = SPACES)        05120038
051300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05130038
051400         MOVE PC-TSYMSG-01014 TO DP020-MSG-NUMBER                 05140038
051500         SET DP020-MSG-FATAL                                      05150038
051600             PS-COMMAREA-NOT-VALID TO TRUE                        05160038
051700                                                                  05170038
051800     ELSE                                                         05180038
051900         MOVE TR001-OPER-UNT-ID-N      TO ASC-OPER-UNT-ID         05190038
052000         MOVE TR001-FCLTY-ID-N         TO ASC-FCLTY-ID            05200038
052100         MOVE TR001-FCLTY-NME          TO ASC-FCLTY-NME           05210038
052200         MOVE TR001-PRO-NBR            TO ASC-PRO-NBR             05220038
052300                                          RC023-FREIGHT-BILL      05230038
052400         CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA            05240038
052500         MOVE RC023-FREIGHT-BILL       TO DK-PRO-NBR              05250038
052600                                                                  05260038
052700         MOVE TR001-BOL-NBR            TO ASC-BOL-NBR             05270038
052800                                          RC023-BILL-OF-LADING    05280038
052900         CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA            05290038
053000         MOVE RC023-BILL-OF-LADING     TO DK-BOL-NBR              05300038
053100                                                                  05310038
053200         MOVE TR001-SCAC               TO ASC-PRO-SCAC            05320038
053300                                          DK-SCAC-ID              05330038
053400                                                                  05340038
053500         PERFORM 1110-SELECT-SHIPT-ID                             05350038
053600         IF PS-COMMAREA-VALID                                     05360038
053700             PERFORM 1120-SELECT-RECEIVERS                        05370038
053800     END-IF.                                                      05380038
053900                                                                  05390038
054000 1110-SELECT-SHIPT-ID.                                            05400038
054100*----------------------------------------------------------------*05410038
054200****   SELECT THE TSHIPMT INFORMATION   *****                     05420038
054300*----------------------------------------------------------------*05430038
054400     PERFORM WITH TEST AFTER                                      05440038
054500         VARYING PV-RETRY-COUNTER                                 05450038
054600         FROM 1 BY 1                                              05460038
054700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 05470038
054800                 OR SQLCODE = 0                                   05480038
054900                 OR SQLCODE = +100)                               05490038
055000                                                                  05500038
055100         EXEC SQL                                                 05510038
055200             SELECT SHIPT_ID                                      05520038
055300                  , TRIP_ID                                       05530038
055400                  , PRO_SCAC_ID                                   05540038
055500                  , ORIG_SCAC_ID                                  05550038
055600             INTO   :SHIPMT-SHIPT-ID                              05560038
055700                  , :SHIPMT-TRIP-ID                               05570038
055800                  , :SHIPMT-PRO-SCAC-ID                           05580038
055900                  , :SHIPMT-ORIG-SCAC-ID                          05590038
056000             FROM   TSHIPMT                                       05600038
056100             WHERE  PRO_NBR        = :DK-PRO-NBR                  05610038
056200             AND    BOL_NBR        = :DK-BOL-NBR                  05620038
056300             AND    PRO_SCAC_ID    = :DK-SCAC-ID                  05630038
056400         END-EXEC                                                 05640038
056500                                                                  05650038
056600         EVALUATE TRUE                                            05660038
056700             WHEN SQLCODE = +0                                    05670038
056800                  SET PS-FOUND TO TRUE                            05680038
056900                  MOVE SHIPMT-SHIPT-ID TO DK-SHIPT-ID             05690038
057000                                          ASC-SHIPT-ID            05700038
057100                  MOVE SHIPMT-TRIP-ID  TO DK-TRIP-ID              05710038
057200                                          ASC-TRIP-ID             05720038
057300                  MOVE SHIPMT-ORIG-SCAC-ID                        05730038
057400                                       TO ASC-ORIG-SCAC           05740038
057500                  MOVE SHIPMT-PRO-SCAC-ID                         05750038
057600                                       TO ASC-PRO-SCAC            05760038
057700                                                                  05770038
057800             WHEN SQLCODE = +100                                  05780038
057900                  SET PS-COMMAREA-NOT-VALID                       05790038
058000                      PS-NOT-FOUND     TO TRUE                    05800038
058100             WHEN SQLCODE = -904                                  05810038
058200             WHEN SQLCODE = -911                                  05820038
058300             WHEN SQLCODE = -913                                  05830038
058400                  CONTINUE                                        05840038
058500                                                                  05850038
058600             WHEN OTHER                                           05860038
058700                  MOVE '1110-SELECT-SHIPT-ID'                     05870038
058800                                  TO DP013-PARAGRAPH              05880038
058900                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         05890038
059000                                  TO DP013-MESSAGE-TEXT (1)       05900038
059100                  MOVE SQLCA      TO DP013-SQLCA                  05910038
059200                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     05920038
059300                  SET DP013-DB2-ABEND                             05930038
059400                      DP013-XCTL-DISPLAY-RESTART                  05940038
059500                                  TO TRUE                         05950038
059600                  PERFORM DP013-0000-PROCESS-ABEND                05960038
059700         END-EVALUATE                                             05970038
059800     END-PERFORM.                                                 05980038
059900                                                                  05990038
060000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06000038
060100         MOVE '1110-SELECT-SHIPT-ID'                              06010038
060200                         TO DP013-PARAGRAPH                       06020038
060300         MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '                  06030038
060400                         TO DP013-MESSAGE-TEXT (1)                06040038
060500         MOVE SQLCA      TO DP013-SQLCA                           06050038
060600         MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)              06060038
060700         SET DP013-DB2-ABEND                                      06070038
060800             DP013-XCTL-DISPLAY-RESTART                           06080038
060900                         TO TRUE                                  06090038
061000         PERFORM DP013-0000-PROCESS-ABEND                         06100038
061100     END-IF.                                                      06110038
061200                                                                  06120038
061300*                                                                 06130038
061400****   GET THE STATUS DESCRIPTION       *****                     06140038
061500*                                                                 06150038
061600     IF PS-FOUND                                                  06160038
061700        PERFORM WITH TEST AFTER                                   06170038
061800            VARYING PV-RETRY-COUNTER                              06180038
061900            FROM 1 BY 1                                           06190038
062000            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              06200038
062100                    OR SQLCODE = 0 )                              06210038
062200            EXEC SQL                                              06220038
062300                SELECT DISTINCT                                   06230038
062400                       A.TRIP_STATUS_CDE                          06240038
062500                      ,B.PRTY_CDE                                 06250038
062600                INTO   :TRIPST-TRIP-STATUS-CDE                    06260038
062700                      ,:TRSTYP-PRTY-CDE                           06270038
062800                FROM   TTRIPST A                                  06280038
062900                      ,TTRSTYP B                                  06290038
063000                WHERE  A.TRIP_ID     = :DK-TRIP-ID                06300038
063100                  AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE      06310038
063200                  AND  B.PRTY_CDE =                               06320038
063300                      (SELECT DISTINCT                            06330038
063400                           MAX(D.PRTY_CDE)                        06340038
063500                        FROM   TTRIPST C                          06350038
063600                              ,TTRSTYP D                          06360038
063700                        WHERE  C.TRIP_ID  = :DK-TRIP-ID           06370038
063800                          AND  C.TRIP_STATUS_CDE                  06380038
063900                                          = D.TRIP_STATUS_CDE)    06390038
064000            END-EXEC                                              06400038
064100            EVALUATE TRUE                                         06410038
064200                WHEN SQLCODE = +0                                 06420038
064300                    IF TRSTYP-PRTY-CDE <= '30'                    06430038
064400                       SET ASC-SHIPT-STATUS-OK TO TRUE            06440038
064500                    ELSE                                          06450038
064600                       SET PS-COMMAREA-NOT-VALID                  06460038
064700                           ASC-SHIPT-STATUS-NOTOK TO TRUE         06470038
064800                    END-IF                                        06480038
064900                WHEN SQLCODE = -904                               06490038
065000                WHEN SQLCODE = -911                               06500038
065100                WHEN SQLCODE = -913                               06510038
065200                     CONTINUE                                     06520038
065300                                                                  06530038
065400                WHEN OTHER                                        06540038
065500                     MOVE '1110-SELECT-SHIPT-ID'                  06550038
065600                                     TO DP013-PARAGRAPH           06560038
065700                     MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '      06570038
065800                                     TO DP013-MESSAGE-TEXT (1)    06580038
065900                     MOVE SQLCA      TO DP013-SQLCA               06590038
066000                     MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)  06600038
066100                     SET DP013-DB2-ABEND                          06610038
066200                         DP013-XCTL-DISPLAY-RESTART               06620038
066300                                     TO TRUE                      06630038
066400                     PERFORM DP013-0000-PROCESS-ABEND             06640038
066500            END-EVALUATE                                          06650038
066600        END-PERFORM                                               06660038
066700     END-IF.                                                      06670038
066800                                                                  06680038
066900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06690038
067000         MOVE '1110-SELECT-SHIPT-ID'                              06700038
067100                         TO DP013-PARAGRAPH                       06710038
067200         MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '                  06720038
067300                         TO DP013-MESSAGE-TEXT (1)                06730038
067400         MOVE SQLCA      TO DP013-SQLCA                           06740038
067500         MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)              06750038
067600         SET DP013-DB2-ABEND                                      06760038
067700             DP013-XCTL-DISPLAY-RESTART                           06770038
067800                         TO TRUE                                  06780038
067900         PERFORM DP013-0000-PROCESS-ABEND                         06790038
068000     END-IF.                                                      06800038
068100                                                                  06810038
068200                                                                  06820038
068300 1120-SELECT-RECEIVERS.                                           06830038
068400*----------------------------------------------------------------*06840038
068500****   CHECK TSHPTPO TO SEE THERE ARE ANY RECEIVERS ***           06850038
068600*----------------------------------------------------------------*06860038
068700     PERFORM WITH TEST AFTER                                      06870038
068800         VARYING PV-RETRY-COUNTER                                 06880038
068900         FROM 1 BY 1                                              06890038
069000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 06900038
069100                 OR SQLCODE = 0                                   06910038
069200                 OR SQLCODE = +100)                               06920038
069300                                                                  06930038
069400         EXEC SQL                                                 06940038
069500             SELECT SHIPT_ID                                      06950038
069600             INTO   :SHPTPO-SHIPT-ID                              06960038
069700             FROM   TSHPTPO                                       06970038
069800             WHERE  SHIPT_ID       = :DK-SHIPT-ID                 06980038
069900             AND    REC_SEQ_NBR    > 0                            06990038
070000         END-EXEC                                                 07000038
070100                                                                  07010038
070200         EVALUATE TRUE                                            07020038
070300             WHEN SQLCODE = +0                                    07030038
070400             WHEN SQLCODE = -811                                  07040038
070500                 SET PS-COMMAREA-NOT-VALID                        07050038
070600                     PS-RECEIVERS-FOUND  TO TRUE                  07060038
070700             WHEN SQLCODE = +100                                  07070038
070800                  SET PS-NO-RECEIVERS-FOUND TO TRUE               07080038
070900             WHEN SQLCODE = -904                                  07090038
071000             WHEN SQLCODE = -911                                  07100038
071100             WHEN SQLCODE = -913                                  07110038
071200                  CONTINUE                                        07120038
071300                                                                  07130038
071400             WHEN OTHER                                           07140038
071500                  MOVE '1120-SELECT-RECEIVERS'                    07150038
071600                                  TO DP013-PARAGRAPH              07160038
071700                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         07170038
071800                                  TO DP013-MESSAGE-TEXT (1)       07180038
071900                  MOVE SQLCA      TO DP013-SQLCA                  07190038
072000                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     07200038
072100                  SET DP013-DB2-ABEND                             07210038
072200                      DP013-XCTL-DISPLAY-RESTART                  07220038
072300                                  TO TRUE                         07230038
072400                  PERFORM DP013-0000-PROCESS-ABEND                07240038
072500         END-EVALUATE                                             07250038
072600     END-PERFORM.                                                 07260038
072700                                                                  07270038
072800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07280038
072900         MOVE '1120-SELECT-RECEIVERS'                             07290038
073000                         TO DP013-PARAGRAPH                       07300038
073100         MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '                  07310038
073200                         TO DP013-MESSAGE-TEXT (1)                07320038
073300         MOVE SQLCA      TO DP013-SQLCA                           07330038
073400         MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)              07340038
073500         SET DP013-DB2-ABEND                                      07350038
073600             DP013-XCTL-DISPLAY-RESTART                           07360038
073700                         TO TRUE                                  07370038
073800         PERFORM DP013-0000-PROCESS-ABEND                         07380038
073900     END-IF.                                                      07390038
074000                                                                  07400038
074100                                                                  07410038
074200                                                                  07420038
074300*----------------------------------------------------------------*07430038
074400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*07440038
074500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*07450038
074600* EDITS.                                                         *07460038
074700*----------------------------------------------------------------*07470038
074800 2000-PROCESS-PANEL.                                              07480038
074900                                                                  07490038
075000     EVALUATE TRUE                                                07500038
075100                                                                  07510038
075200         WHEN DP020-SRC-AID = DP016-CLEAR                         07520038
075300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07530038
075400                                                                  07540038
075500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     07550038
075600             PERFORM 4000-BUILD-INITIAL-PANEL                     07560038
075700                                                                  07570038
075800         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07580038
075900             PERFORM 2110-PREPARE-INTER-APPL-COMM                 07590038
076000                                                                  07600038
076100         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                     07610038
076200             IF  ASC-DELETED                                      07620038
076300                 MOVE PC-TSYMSG-00116                             07630038
076400                                  TO  DP020-MSG-NUMBER            07640038
076500                 SET DP020-MSG-FATAL                              07650038
076600                                  TO  TRUE                        07660038
076700             ELSE                                                 07670038
076800                 PERFORM 5000-DELETE-PROCESS                      07680038
076900                 IF PS-ALREADY-DELETED                            07690038
077000                     MOVE PC-TSYMSG-00116                         07700038
077100                                      TO  DP020-MSG-NUMBER        07710038
077200                     SET DP020-MSG-FATAL                          07720038
077300                                      TO  TRUE                    07730038
077400                 ELSE                                             07740038
077500                     MOVE PC-TSYMSG-00115                         07750038
077600                                      TO  DP020-MSG-NUMBER        07760038
077700                     SET DP020-MSG-INFORMATIONAL                  07770038
077800                         ASC-DELETED  TO  TRUE                    07780038
077900                 END-IF                                           07790038
078000             END-IF                                               07800038
078100                                                                  07810038
078200         WHEN DP020-SRC-AID = DP016-ENTER                         07820038
078300             CONTINUE                                             07830038
078400                                                                  07840038
078500         WHEN OTHER                                               07850038
078600             SET DP013-NO-ROLLBACK                                07860038
078700                 DP013-XCTL-DISPLAY-RESTART                       07870038
078800                 DP013-CICS-ABEND  TO TRUE                        07880038
078900             MOVE '2100-CHECK-FUNCTION-KEY'                       07890038
079000                                   TO DP013-PARAGRAPH             07900038
079100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07910038
079200                                   TO DP013-MESSAGE-TEXT (1)      07920038
079300             PERFORM DP013-0000-PROCESS-ABEND                     07930038
079400     END-EVALUATE.                                                07940038
079500 EJECT                                                            07950038
079600******************************************************************07960038
079700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **07970038
079800** INTER-APPLICATION COMMAREA.                                  **07980038
079900******************************************************************07990038
080000 2110-PREPARE-INTER-APPL-COMM.                                    08000038
080100                                                                  08010038
080200     MOVE ASC-PRO-NBR              TO TR001-PRO-NBR.              08020038
080300     MOVE ASC-BOL-NBR              TO TR001-BOL-NBR.              08030038
080400     MOVE ASC-TRLR-NBR             TO TR001-TRLR-NBR.             08040038
080500     MOVE ASC-OPER-UNT-ID          TO TR001-OPER-UNT-ID.          08050038
080600     MOVE ASC-FCLTY-ID             TO TR001-FCLTY-ID.             08060038
080700     MOVE ASC-FCLTY-NME            TO TR001-FCLTY-NME.            08070038
080800     MOVE ASC-PRO-SCAC             TO TR001-SCAC.                 08080038
080900     MOVE ASC-PRO-SCAC-DESC        TO TR001-NAME.                 08090038
081000     MOVE ASC-ETA-DATE             TO TR001-ETA-DTE.              08100038
081100     MOVE ASC-ETA-TIME             TO TR001-ETA-TIME.             08110038
081200     MOVE ASC-SHIPT-ID             TO TR001-SHIPT-ID.             08120038
081300                                                                  08130038
081400*----------------------------------------------------------------*08140038
081500*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*08150038
081600*----------------------------------------------------------------*08160038
081700                                                                  08170038
081800*                                                                 08180038
081900*----------------------------------------------------------------*08190038
082000* SET UP THE INFORMATION FOR THE CURRENT PO                      *08200038
082100*----------------------------------------------------------------*08210038
082200                                                                  08220038
082300 4000-BUILD-INITIAL-PANEL.                                        08230038
082400                                                                  08240038
082500     MOVE ASC-PRO-NBR              TO RC023-FREIGHT-BILL.         08250038
082600     CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA.               08260038
082700     MOVE RC023-FREIGHT-BILL       TO DK-PRO-NBR.                 08270038
082800                                                                  08280038
082900     MOVE ASC-BOL-NBR              TO RC023-BILL-OF-LADING.       08290038
083000     CALL PC-RCKUT023 USING RC023-FORMAT-DATA-AREA.               08300038
083100     MOVE RC023-BILL-OF-LADING     TO DK-BOL-NBR.                 08310038
083200                                                                  08320038
083300     MOVE ASC-ORIG-SCAC            TO DK-SCAC-ID.                 08330038
083400     IF DK-SCAC-ID > SPACES                                       08340038
083500        PERFORM 4020-SELECT-SCAC-NAME                             08350038
083600        MOVE ENTNME-ENT-NAME-DESC   TO ASC-ORIG-SCAC-DESC         08360038
083700                                       AOSCACDO                   08370038
083800     END-IF.                                                      08380038
083900                                                                  08390038
084000     MOVE ASC-PRO-SCAC             TO DK-SCAC-ID.                 08400038
084100     PERFORM 4020-SELECT-SCAC-NAME                                08410038
084200     MOVE ENTNME-ENT-NAME-DESC   TO ASC-PRO-SCAC-DESC             08420038
084300                                    ADSCACDO.                     08430038
084400                                                                  08440038
084500     PERFORM 4010-SELECT-VEHICLE-INFO.                            08450038
084600                                                                  08460038
084700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08470038
084800                                                                  08480038
084900 4010-SELECT-VEHICLE-INFO.                                        08490038
085000*----------------------------------------------------------------*08500038
085100*  SELECT THE INFO FROM THE SHIPMENT AND VEHICLE TALBES           08510038
085200*----------------------------------------------------------------*08520038
085300                                                                  08530038
085400     PERFORM WITH TEST AFTER                                      08540038
085500         VARYING PV-RETRY-COUNTER                                 08550038
085600         FROM 1 BY 1                                              08560038
085700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 08570038
085800                 OR SQLCODE = 0 )                                 08580038
085900                                                                  08590038
086000* CLT 12/09/2011 WR40574 ADDED CARR AUTH ID BELOW                 08600038
086100                                                                  08610038
086200         EXEC SQL                                                 08620038
086300             SELECT                                               08630038
086400                    A.TRIP_ID                                     08640038
086500                 ,  A.SHIPT_ID                                    08650038
086600                 ,  A.CRT_SRC_CDE                                 08660038
086700                 ,  A.LAST_UPD_DTE                                08670038
086800                 ,  A.LAST_UPD_TME                                08680038
086900                 ,  A.LAST_UPD_UID                                08690038
087000                 ,  A.PRO_SCAC_ID                                 08700038
087100                 ,  A.PRO_NBR                                     08710038
087200                 ,  A.BOL_NBR                                     08720038
087300                 ,  A.SHIPPER_NME                                 08730038
087400                 ,  A.SHIPT_TYP_CDE                               08740038
087500                 ,  A.EXPTED_GRO_WGHT                             08750038
087600                 ,  A.PKG_TYP_CDE                                 08760038
087700                 ,  A.EXPTED_PKG_QTY                              08770038
087800                 ,  A.FRGT_CHG_AMT                                08780038
087900                 ,  A.FRGT_TERMS_CDE                              08790038
088000                 ,  A.EXPTED_PLT_QTY                              08800038
088100                 ,  A.VEND_SHIP_DTE                               08810038
088200                 ,  A.EST_AR_TMST                                 08820038
088300                 ,  A.ORIG_SCAC_ID                                08830038
088400                 ,  A.LAST_UPD_PGM_ID                             08840038
088500                 ,  A.CRE_USER_ID                                 08850038
088600                 ,  A.CARR_CART_CT                                08860038
088700                 ,  A.CARR_LAST_UPD_DTE                           08870038
088800                 ,  A.CARR_LAST_UPD_TIME                          08880038
088900                 ,  A.VEND_CART_CT                                08890038
089000                 ,  A.VEND_LAST_UPD_DTE                           08900038
089100                 ,  A.VEND_LAST_UPD_TIME                          08910038
089200                 ,  A.VEH_NBR                                     08920038
089300                 ,  A.AUTH_NBR                                    08930038
089400                 ,  A.AUTH_DTE                                    08940038
089500                 ,  A.CONFIRM_DTE                                 08950038
089600                 ,  A.CONFIRM_TIME                                08960038
089700                 ,  A.COMPLETE_PRO_NBR                            08970038
089800                 ,  A.COMPLETE_BOL_NBR                            08980038
089900                 ,  A.PROCESSED_DTE                               08990038
090000                 ,  A.INVC_NBR                                    09000038
090100                 ,  B.VEH_NBR                                     09010038
090200                 ,  (DATE(B.EST_AR_TMST))                         09020038
090300                 ,  (TIME(B.EST_AR_TMST))                         09030038
090400                 ,  A.CARR_AUTH_ID                                09040038
090500             INTO                                                 09050038
090600                   :SHIPMT-TRIP-ID                                09060038
090700                 , :SHIPMT-SHIPT-ID                               09070038
090800                 , :SHIPMT-CRT-SRC-CDE                            09080038
090900                 , :SHIPMT-LAST-UPD-DTE                           09090038
091000                 , :SHIPMT-LAST-UPD-TME                           09100038
091100                 , :SHIPMT-LAST-UPD-UID                           09110038
091200                 , :SHIPMT-PRO-SCAC-ID                            09120038
091300                 , :SHIPMT-PRO-NBR                                09130038
091400                 , :SHIPMT-BOL-NBR                                09140038
091500                 , :SHIPMT-SHIPPER-NME                            09150038
091600                 , :SHIPMT-SHIPT-TYP-CDE                          09160038
091700                 , :SHIPMT-EXPTED-GRO-WGHT                        09170038
091800                 , :SHIPMT-PKG-TYP-CDE                            09180038
091900                 , :SHIPMT-EXPTED-PKG-QTY                         09190038
092000                 , :SHIPMT-FRGT-CHG-AMT                           09200038
092100                 , :SHIPMT-FRGT-TERMS-CDE                         09210038
092200                 , :SHIPMT-EXPTED-PLT-QTY                         09220038
092300                 , :SHIPMT-VEND-SHIP-DTE                          09230038
092400                 , :SHIPMT-EST-AR-TMST                            09240038
092500                 , :SHIPMT-ORIG-SCAC-ID                           09250038
092600                 , :SHIPMT-LAST-UPD-PGM-ID                        09260038
092700                 , :SHIPMT-CRE-USER-ID                            09270038
092800                 , :SHIPMT-CARR-CART-CT                           09280038
092900                 , :SHIPMT-CARR-LAST-UPD-DTE                      09290038
093000                 , :SHIPMT-CARR-LAST-UPD-TIME                     09300038
093100                 , :SHIPMT-VEND-CART-CT                           09310038
093200                 , :SHIPMT-VEND-LAST-UPD-DTE                      09320038
093300                 , :SHIPMT-VEND-LAST-UPD-TIME                     09330038
093400                 , :SHIPMT-VEH-NBR                                09340038
093500                 , :SHIPMT-AUTH-NBR                               09350038
093600                 , :SHIPMT-AUTH-DTE                               09360038
093700                 , :SHIPMT-CONFIRM-DTE                            09370038
093800                 , :SHIPMT-CONFIRM-TIME                           09380038
093900                 , :SHIPMT-COMPLETE-PRO-NBR                       09390038
094000                 , :SHIPMT-COMPLETE-BOL-NBR                       09400038
094100                 , :SHIPMT-PROCESSED-DTE                          09410038
094200                 , :SHIPMT-INVC-NBR                               09420038
094300                 , :VHTRIP-VEH-NBR:PV-NI-VEH-NBR                  09430038
094400                 , :PV-EST-AR-DTE:PV-NI-AR-DTE                    09440038
094500                 , :PV-EST-AR-TME:PV-NI-AR-TME                    09450038
094600                 , :SHIPMT-CARR-AUTH-ID                           09460038
094700             FROM   TSHIPMT A                                     09470038
094800                ,   TVHTRIP B                                     09480038
094900             WHERE  A.PRO_SCAC_ID = :DK-SCAC-ID                   09490038
095000             AND    A.PRO_NBR      = :DK-PRO-NBR                  09500038
095100             AND    A.BOL_NBR      = :DK-BOL-NBR                  09510038
095200             AND    A.TRIP_ID      = B.TRIP_ID                    09520038
095300             AND    A.PRO_SCAC_ID  = B.OWNER_SCAC_ID              09530038
095400         END-EXEC                                                 09540038
095500                                                                  09550038
095600         EVALUATE TRUE                                            09560038
095700             WHEN SQLCODE = +0                                    09570038
095800                 MOVE SHIPMT-BOL-NBR    TO ASC-BOL-NBR            09580038
095900                 MOVE SHIPMT-EXPTED-PKG-QTY                       09590038
096000                                        TO ASC-FB-CART-CNT        09600038
096100                 MOVE SHIPMT-CARR-CART-CT                         09610038
096200                                        TO ASC-ASN-CART-CNT       09620038
096300                 MOVE SHIPMT-VEND-CART-CT                         09630038
096400                                        TO ASC-FOR-CART-CNT       09640038
096500                 MOVE SHIPMT-VEND-SHIP-DTE                        09650038
096600                                        TO PV-TEMP-DATE           09660038
096700                 MOVE PV-DATE-DD        TO PV-WK-DTE-DD           09670038
096800                 MOVE PV-DATE-MM        TO PV-WK-DTE-MM           09680038
096900                 MOVE PV-DATE-CCYY      TO PV-WK-DTE-YY           09690038
097000                 MOVE PV-WORK-DATE      TO ASC-VEND-SHIP-DTE      09700038
097100                 MOVE SHIPMT-AUTH-DTE   TO PV-TEMP-DATE           09710038
097200                 MOVE PV-DATE-DD         TO PV-WK-DTE-DD          09720038
097300                 MOVE PV-DATE-MM        TO PV-WK-DTE-MM           09730038
097400                 MOVE PV-DATE-CCYY      TO PV-WK-DTE-YY           09740038
097500                 MOVE PV-WORK-DATE      TO ASC-AUTH-DTE           09750038
097600                 MOVE SHIPMT-AUTH-NBR   TO ASC-AUTH-NBR           09760038
097700                                                                  09770038
097800             WHEN SQLCODE = -904                                  09780038
097900             WHEN SQLCODE = -911                                  09790038
098000             WHEN SQLCODE = -913                                  09800038
098100                  CONTINUE                                        09810038
098200                                                                  09820038
098300             WHEN OTHER                                           09830038
098400                  MOVE '4010-SELECT-VEHICLE-INFO'                 09840038
098500                                  TO DP013-PARAGRAPH              09850038
098600                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT TVHTRIP'   09860038
098700                                  TO DP013-MESSAGE-TEXT (1)       09870038
098800                  MOVE SQLCA      TO DP013-SQLCA                  09880038
098900                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     09890038
099000                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (2)     09900038
099100                  SET DP013-DB2-ABEND                             09910038
099200                      DP013-XCTL-DISPLAY-RESTART                  09920038
099300                                  TO TRUE                         09930038
099400                  PERFORM DP013-0000-PROCESS-ABEND                09940038
099500         END-EVALUATE                                             09950038
099600     END-PERFORM.                                                 09960038
099700                                                                  09970038
099800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         09980038
099900         MOVE '4010-SELECT-VEHICLE-INFO'                          09990038
100000                         TO DP013-PARAGRAPH                       10000038
100100         MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT TVHTRIP'            10010038
100200                         TO DP013-MESSAGE-TEXT (1)                10020038
100300         MOVE SQLCA      TO DP013-SQLCA                           10030038
100400         MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)              10040038
100500         MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (2)              10050038
100600         SET DP013-DB2-ABEND                                      10060038
100700             DP013-XCTL-DISPLAY-RESTART                           10070038
100800                         TO TRUE                                  10080038
100900         PERFORM DP013-0000-PROCESS-ABEND                         10090038
101000     END-IF.                                                      10100038
101100                                                                  10110038
101200     IF PV-NI-AR-DTE < 0                                          10120038
101300         MOVE SPACES             TO ASC-ETA-DATE                  10130038
101400     ELSE                                                         10140038
101500         MOVE PV-EST-AR-DTE      TO PV-TEMP-DATE                  10150038
101600         MOVE PV-DATE-MM         TO PV-WK-DTE-MM                  10160038
101700         MOVE PV-DATE-DD         TO PV-WK-DTE-DD                  10170038
101800         MOVE PV-DATE-CCYY       TO PV-WK-DTE-YY                  10180038
101900         MOVE PV-WORK-DATE       TO ASC-ETA-DATE                  10190038
102000     END-IF.                                                      10200038
102100                                                                  10210038
102200     IF PV-NI-AR-TME < 0                                          10220038
102300         MOVE SPACES             TO ASC-ETA-TIME                  10230038
102400     ELSE                                                         10240038
102500         MOVE PV-EST-AR-TME      TO PV-WORK-TIME                  10250038
102600         MOVE PV-TIME-HH         TO ASC-ETA-TIME-HH               10260038
102700         MOVE PV-TIME-MM         TO ASC-ETA-TIME-MM               10270038
102800     END-IF.                                                      10280038
102900                                                                  10290038
103000     IF PV-NI-VEH-NBR < 0                                         10300038
103100         MOVE SPACES                          TO ASC-TRLR-NBR     10310038
103200     ELSE                                                         10320038
103300         EXEC SQL                                                 10330038
103400             SELECT                                               10340038
103500                     OWNER_SCAC_ID                                10350038
103600                    ,VEH_NBR                                      10360038
103700                    ,CRT_SRC_CDE                                  10370038
103800                    ,LAST_UPD_DTE                                 10380038
103900                    ,LAST_UPD_TME                                 10390038
104000                    ,LAST_UPD_UID                                 10400038
104100                    ,USAGE_CDE                                    10410038
104200                    ,VEH_TYP_CDE                                  10420038
104300                    ,CURR_STATUS_CDE                              10430038
104400                    ,CURR_STATUS_DTE                              10440038
104500                    ,CURR_STATUS_TME                              10450038
104600                    ,CURR_OPER_UNT_ID                             10460038
104700                    ,CURR_FCLTY_ID                                10470038
104800                    ,CURR_FAC_AREA_ID                             10480038
104900                    ,CURR_LOC_DTE                                 10490038
105000                    ,CURR_LOC_TME                                 10500038
105100                    ,CURR_TRIP_ID                                 10510038
105200                    ,VEH_SIZE_CDE                                 10520038
105300             INTO                                                 10530038
105400                     :VEHICL-OWNER-SCAC-ID                        10540038
105500                   , :VEHICL-VEH-NBR                              10550038
105600                   , :VEHICL-CRT-SRC-CDE                          10560038
105700                   , :VEHICL-LAST-UPD-DTE                         10570038
105800                   , :VEHICL-LAST-UPD-TME                         10580038
105900                   , :VEHICL-LAST-UPD-UID                         10590038
106000                   , :VEHICL-USAGE-CDE                            10600038
106100                   , :VEHICL-VEH-TYP-CDE                          10610038
106200                   , :VEHICL-CURR-STATUS-CDE                      10620038
106300                   , :VEHICL-CURR-STATUS-DTE                      10630038
106400                   , :VEHICL-CURR-STATUS-TME                      10640038
106500                   , :VEHICL-CURR-OPER-UNT-ID                     10650038
106600                   , :VEHICL-CURR-FCLTY-ID                        10660038
106700                   , :VEHICL-CURR-FAC-AREA-ID                     10670038
106800                   , :VEHICL-CURR-LOC-DTE                         10680038
106900                   , :VEHICL-CURR-LOC-TME                         10690038
107000                   , :VEHICL-CURR-TRIP-ID                         10700038
107100                   , :VEHICL-VEH-SIZE-CDE                         10710038
107200             FROM  TVEHICL                                        10720038
107300             WHERE CURR_TRIP_ID = :DK-TRIP-ID                     10730038
107400         END-EXEC                                                 10740038
107500                                                                  10750038
107600                                                                  10760038
107700         EVALUATE TRUE                                            10770038
107800             WHEN SQLCODE = +0                                    10780038
107900                  SET ASC-VHCL-ATTCHD         TO TRUE             10790038
108000                  MOVE VHTRIP-VEH-NBR         TO ASC-TRLR-NBR     10800038
108100             WHEN SQLCODE = +100                                  10810038
108200                  SET ASC-VHCL-NOT-ATTCHD     TO TRUE             10820038
108300                  MOVE SPACES                 TO ASC-TRLR-NBR     10830038
108400             WHEN SQLCODE = -904                                  10840038
108500             WHEN SQLCODE = -911                                  10850038
108600             WHEN SQLCODE = -913                                  10860038
108700                  CONTINUE                                        10870038
108800                                                                  10880038
108900             WHEN OTHER                                           10890038
109000                  MOVE '4010-SELECT-VEHICLE-INFO'                 10900038
109100                                  TO DP013-PARAGRAPH              10910038
109200                  MOVE 'UNSUCCESSFUL SELECT ON TVEHICL  '         10920038
109300                                  TO DP013-MESSAGE-TEXT (1)       10930038
109400                  MOVE SQLCA      TO DP013-SQLCA                  10940038
109500                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (1)     10950038
109600                  SET DP013-DB2-ABEND                             10960038
109700                      DP013-XCTL-DISPLAY-RESTART                  10970038
109800                                  TO TRUE                         10980038
109900                  PERFORM DP013-0000-PROCESS-ABEND                10990038
110000         END-EVALUATE                                             11000038
110100     END-IF.                                                      11010038
110200                                                                  11020038
110300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11030038
110400         MOVE '4010-SELECT-VEHICLE-INFO'                          11040038
110500                         TO DP013-PARAGRAPH                       11050038
110600         MOVE 'UNSUCCESSFUL SELECT ON TVEHICL  '                  11060038
110700                         TO DP013-MESSAGE-TEXT (1)                11070038
110800         MOVE SQLCA      TO DP013-SQLCA                           11080038
110900         MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (1)              11090038
111000         SET DP013-DB2-ABEND                                      11100038
111100             DP013-XCTL-DISPLAY-RESTART                           11110038
111200                         TO TRUE                                  11120038
111300         PERFORM DP013-0000-PROCESS-ABEND                         11130038
111400     END-IF.                                                      11140038
111500                                                                  11150038
111600 4020-SELECT-SCAC-NAME.                                           11160038
111700******************************************************************11170038
111800*    THIS PARAGRAPH WILL SELECT THE SCAC NAME FROM TENTNME TABLE  11180038
111900******************************************************************11190038
111910* CLT 03/16/2012 WR40574 ADDED WITH UR BELOW                      11191041
112000                                                                  11200038
112100                                                                  11210038
112200                                                                  11220038
112300     PERFORM WITH TEST AFTER                                      11230038
112400         VARYING PV-RETRY-COUNTER                                 11240038
112500         FROM 1 BY 1                                              11250038
112600         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 11260038
112700                 OR SQLCODE = +100                                11270038
112800                 OR SQLCODE = 0)                                  11280038
112900                                                                  11290038
113000         EXEC SQL                                                 11300038
113100             SELECT                                               11310038
113200                     A.ENT_NAME_DESC                              11320038
113300             INTO                                                 11330038
113400                    :ENTNME-ENT-NAME-DESC                         11340038
113500             FROM                                                 11350038
113600                    TENTNME A                                     11360038
113700                ,   TEXTENT B                                     11370038
113800             WHERE                                                11380038
113900                    B.SCAC_CDE     = :DK-SCAC-ID                  11390038
114000             AND    B.ENT_ID       = A.ENT_ID                     11400038
114100             AND    A.TYPE_CDE     = '01'                         11410038
114110             WITH UR                                              11411041
114200         END-EXEC                                                 11420038
114300                                                                  11430038
114400         EVALUATE TRUE                                            11440038
114500             WHEN SQLCODE = +0                                    11450038
114600                  CONTINUE                                        11460038
114700             WHEN SQLCODE = +100                                  11470038
114800                  MOVE SPACES TO ENTNME-ENT-NAME-DESC             11480038
114900                                                                  11490038
115000             WHEN SQLCODE = -904                                  11500038
115100             WHEN SQLCODE = -911                                  11510038
115200             WHEN SQLCODE = -913                                  11520038
115300                  CONTINUE                                        11530038
115400                                                                  11540038
115500             WHEN OTHER                                           11550038
115600                  MOVE '4020-SELECT-SCAC-NAME'                    11560038
115700                                  TO DP013-PARAGRAPH              11570038
115800                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TEXTENT'   11580038
115900                                  TO DP013-MESSAGE-TEXT (1)       11590038
116000                  MOVE SQLCA      TO DP013-SQLCA                  11600038
116100                  MOVE DK-SCAC-ID TO DP013-MESSAGE-TEXT (2)       11610038
116200                  MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)     11620038
116300                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     11630038
116400                  SET DP013-DB2-ABEND                             11640038
116500                      DP013-XCTL-DISPLAY-RESTART                  11650038
116600                                  TO TRUE                         11660038
116700                  PERFORM DP013-0000-PROCESS-ABEND                11670038
116800         END-EVALUATE                                             11680038
116900     END-PERFORM.                                                 11690038
117000                                                                  11700038
117100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11710038
117200         MOVE '4020-SELECT-SCAC-NAME' TO DP013-PARAGRAPH          11720038
117300         MOVE 'UNSUCCESSFUL SELECT ON TENTNME TEXTENT'            11730038
117400                                     TO DP013-MESSAGE-TEXT (1)    11740038
117500         MOVE DK-SCAC-ID             TO DP013-MESSAGE-TEXT (2)    11750038
117600         MOVE SQLCA                  TO DP013-SQLCA               11760038
117700         MOVE 'TEXTENT '             TO DP013-DB2-TABLE-NAME (1)  11770038
117800         MOVE 'TENTNME '             TO DP013-DB2-TABLE-NAME (1)  11780038
117900         SET DP013-DB2-ABEND                                      11790038
118000             DP013-XCTL-DISPLAY-RESTART                           11800038
118100                                     TO TRUE                      11810038
118200         PERFORM DP013-0000-PROCESS-ABEND                         11820038
118300     END-IF.                                                      11830038
118400                                                                  11840038
118500*                                                                 11850038
118600 EJECT                                                            11860038
118700*----------------------------------------------------------------*11870038
118800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *11880038
118900*----------------------------------------------------------------*11890038
119000                                                                  11900038
119100 4400-MOVE-COMMAREA-TO-SCREEN.                                    11910038
119200     MOVE ASC-OPER-UNT-ID        TO AOPERO.                       11920038
119300     MOVE ASC-FCLTY-ID           TO AFCLTYO.                      11930038
119400     MOVE ASC-FCLTY-NME          TO AFDESCO.                      11940038
119500     MOVE ASC-PRO-NBR            TO AFBNBRO.                      11950038
119600     MOVE ASC-ASN-CART-CNT       TO AASNCRTO.                     11960038
119700     MOVE ASC-BOL-NBR            TO ABOLNBRO.                     11970038
119800     MOVE ASC-FOR-CART-CNT       TO AFORCRTO.                     11980038
119900     MOVE ASC-FB-CART-CNT        TO AFBCRTO.                      11990038
120000     IF ASC-VEND-SHIP-DTE = '01/01/0001'                          12000038
120100        MOVE SPACES       TO ASC-VEND-SHIP-DTE                    12010038
120200     END-IF.                                                      12020038
120300     MOVE ASC-VEND-SHIP-DTE      TO AVNSDTEO.                     12030038
120400     MOVE ASC-ORIG-SCAC          TO AOSCACO.                      12040038
120500     MOVE ASC-ORIG-SCAC-DESC     TO AOSCACDO.                     12050038
120600     MOVE ASC-PRO-SCAC           TO ADSCACO.                      12060038
120700     MOVE ASC-PRO-SCAC-DESC      TO ADSCACDO.                     12070038
120800     MOVE ASC-TRLR-NBR           TO ATRAILRO.                     12080038
120900     IF ASC-ETA-DATE = '01/01/0001'                               12090038
121000        MOVE SPACES     TO ASC-ETA-DATE                           12100038
121100     END-IF.                                                      12110038
121200     MOVE ASC-ETA-DATE           TO AETADTEO.                     12120038
121300     IF ASC-ETA-TIME = '0000'                                     12130038
121400        MOVE SPACES TO ASC-ETA-TIME                               12140038
121500     END-IF.                                                      12150038
121600     MOVE ASC-ETA-TIME-HH        TO AETAHHO.                      12160038
121700     MOVE ASC-ETA-TIME-MM        TO AETAMMO.                      12170038
121800     MOVE ASC-AUTH-NBR           TO AAUTHNBO.                     12180038
121900     IF ASC-AUTH-DTE = '01/01/0001'                               12190038
122000        MOVE SPACES   TO ASC-AUTH-DTE                             12200038
122100     END-IF.                                                      12210038
122200     MOVE ASC-AUTH-DTE           TO AAUTHDTO.                     12220038
122300                                                                  12230038
122400 EJECT                                                            12240038
122500*----------------------------------------------------------------*12250038
122600* PERFORM UPDATES AND DELETES NECESSARY TO DELETE SHIPMENT       *12260038
122700*----------------------------------------------------------------*12270038
122800 5000-DELETE-PROCESS.                                             12280038
122900                                                                  12290038
123000     SET PS-NOT-ALREADY-DELETED TO TRUE.                          12300038
123100                                                                  12310038
123200     PERFORM 5010-OPEN-PO-SHIPMENT-CURSOR.                        12320038
123300                                                                  12330038
123400     PERFORM 5020-FETCH-PO-SHIPMENT-CSR.                          12340038
123500                                                                  12350038
123600     PERFORM 5030-CREATE-TAUSHPO UNTIL PS-DONE.                   12360038
123700                                                                  12370038
123800     PERFORM 5040-CLOSE-PO-SHIPMENT-CURSOR.                       12380038
123900                                                                  12390038
124000     PERFORM 5100-DELETE-SHIPT-PO-ROWS.                           12400038
124100                                                                  12410038
124200     PERFORM 5200-CHECK-OTHER-SHIPT.                              12420038
124300                                                                  12430038
124400     IF ASC-VHCL-ATTCHD AND PS-OTHER-SHIPT-DONT-EXIST             12440038
124500         PERFORM 5210-RELEASE-TRAILER                             12450038
124600     END-IF.                                                      12460038
124700                                                                  12470038
124800     IF PS-OTHER-SHIPT-DONT-EXIST                                 12480038
124900         PERFORM 5500-INSERT-TAUTRIP                              12490038
125000         PERFORM 5300-DELETE-TRIP                                 12500038
125100     ELSE                                                         12510038
125200         PERFORM 5600-INSERT-TAUSHIP                              12520038
125300         PERFORM 5350-DELETE-SHIPT                                12530038
125400     END-IF.                                                      12540038
125500                                                                  12550038
125600                                                                  12560038
125700 EJECT                                                            12570038
125800*----------------------------------------------------------------*12580038
125900* OPENS CURSOR FOR SHIPMENTS                                     *12590038
126000*----------------------------------------------------------------*12600038
126100 5010-OPEN-PO-SHIPMENT-CURSOR.                                    12610038
126200                                                                  12620038
126300     PERFORM                                                      12630038
126400         WITH TEST AFTER                                          12640038
126500         VARYING PV-RETRY-COUNTER                                 12650038
126600         FROM 1 BY 1                                              12660038
126700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12670038
126800            OR (SQLCODE = +0))                                    12680038
126900                                                                  12690038
127000         EXEC SQL                                                 12700038
127100              OPEN PO-SHIPMENT                                    12710038
127200         END-EXEC                                                 12720038
127300                                                                  12730038
127400         EVALUATE TRUE                                            12740038
127500             WHEN SQLCODE = +0                                    12750038
127600                  CONTINUE                                        12760038
127700             WHEN SQLCODE = -904                                  12770038
127800             WHEN SQLCODE = -913                                  12780038
127900                  CONTINUE                                        12790038
128000             WHEN SQLWARN0 NOT = SPACE                            12800038
128100             WHEN SQLCODE  NOT = +0                               12810038
128200                  MOVE '5010-OPEN-PO-SHIPMENT-CURSOR'             12820038
128300                                   TO DP013-PARAGRAPH             12830038
128400                  MOVE 'OPEN PO SHIPMENT CURSOR'                  12840038
128500                                   TO DP013-MESSAGE-TEXT (1)      12850038
128600                  MOVE DK-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      12860038
128700                  MOVE SQLCA       TO DP013-SQLCA                 12870038
128800                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    12880038
128900                  SET DP013-DB2-ABEND                             12890038
129000                                   TO TRUE                        12900038
129100                  PERFORM DP013-0000-PROCESS-ABEND                12910038
129200         END-EVALUATE                                             12920038
129300     END-PERFORM.                                                 12930038
129400                                                                  12940038
129500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    12950038
129600         SQLCODE NOT = +0                                         12960038
129700         MOVE '5010-OPEN-PO-SHIPMENT-CURSOR'                      12970038
129800                                   TO DP013-PARAGRAPH             12980038
129900         MOVE 'MAX RETRIES EXCEEDED FOR OPEN PO SHIPMENT CURSOR'  12990038
130000                                   TO DP013-MESSAGE-TEXT (1)      13000038
130100         MOVE SQLCA                TO DP013-SQLCA                 13010038
130200         SET DP013-DB2-ABEND       TO TRUE                        13020038
130300         PERFORM DP013-0000-PROCESS-ABEND                         13030038
130400     END-IF.                                                      13040038
130500                                                                  13050038
130600*----------------------------------------------------------------*13060038
130700*  SINCE MULTIPLE SHIPMENTS CAN BE DELETED, A CURSOR IS OPENED   *13070038
130800*  SO THAT ALL THE ROWS ARE FETCHED AND AN AUDIT IS WRITTEN FOR  *13080038
130900*  EACH ROW, BEFORE THE ROWS ARE DELETED.                        *13090038
131000*----------------------------------------------------------------*13100038
131100 5020-FETCH-PO-SHIPMENT-CSR.                                      13110038
131200                                                                  13120038
131300     EXEC SQL                                                     13130038
131400       FETCH PO-SHIPMENT                                          13140038
131500        INTO :SHPTPO-SHIPT-ID                                     13150038
131600           , :SHPTPO-PO-NBR                                       13160038
131700           , :SHPTPO-REC-SEQ-NBR                                  13170038
131800           , :SHPTPO-EXPTED-CART-CNT                              13180038
131900           , :SHPTPO-ACTL-CART-CNT                                13190038
132000           , :SHPTPO-DMG-CART-CNT                                 13200038
132100           , :SHPTPO-PKSL-IND                                     13210038
132200           , :SHPTPO-VEND-NAME                                    13220038
132300           , :SHPTPO-FRGT-CHG-AMT                                 13230038
132400           , :SHPTPO-LAST-UPD-PGM-ID                              13240038
132500           , :SHPTPO-CRE-USER-ID                                  13250038
132600           , :SHPTPO-CARR-CART-CT                                 13260038
132700           , :SHPTPO-CARR-LAST-UPD-DTE                            13270038
132800           , :SHPTPO-CARR-LAST-UPD-TIME                           13280038
132900           , :SHPTPO-VEND-CART-CT                                 13290038
133000           , :SHPTPO-VEND-LAST-UPD-DTE                            13300038
133100           , :SHPTPO-VEND-LAST-UPD-TIME                           13310038
133200           , :SHPTPO-CRE-TMST                                     13320038
133300           , :SHPTPO-LAST-UPD-DTE                                 13330038
133400           , :SHPTPO-LAST-UPD-TIME                                13340038
133500           , :SHPTPO-LAST-UPD-USER-ID                             13350038
133600           , :SHPTPO-PRIM-SHIPT-IND                               13360038
133700           , :SHPTPO-SPLT-XMIT-IND                                13370038
133800           , :SHPTPO-SPLT-XMIT-DTE                                13380038
133900           , :SHPTPO-SPLT-XMIT-TM                                 13390038
134000     END-EXEC.                                                    13400038
134100                                                                  13410038
134200     EVALUATE TRUE                                                13420038
134300         WHEN SQLCODE = +0                                        13430038
134400              PERFORM 5400-UPDATE-PACK-SLIP-ROWS                  13440038
134500                                                                  13450038
134600         WHEN SQLCODE = +100                                      13460038
134700              SET PS-DONE TO TRUE                                 13470038
134800                                                                  13480038
134900         WHEN SQLWARN0 NOT = SPACE                                13490038
135000         WHEN SQLCODE < +0                                        13500038
135100         WHEN SQLCODE > +0                                        13510038
135200              MOVE '5020-FETCH-PO-SHIPMENT-CSR'                   13520038
135300                                   TO DP013-PARAGRAPH             13530038
135400              MOVE 'FETCH PO SHIPMENT CURSOR'                     13540038
135500                                   TO DP013-MESSAGE-TEXT (1)      13550038
135600              MOVE DK-SHIPT-ID     TO DP013-MESSAGE-TEXT (2)      13560038
135700              MOVE SQLCA           TO DP013-SQLCA                 13570038
135800              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (1)    13580038
135900              SET DP013-DB2-ABEND  TO TRUE                        13590038
136000              PERFORM DP013-0000-PROCESS-ABEND                    13600038
136100     END-EVALUATE.                                                13610038
136200                                                                  13620038
136300 5030-CREATE-TAUSHPO.                                             13630038
136400                                                                  13640038
136500     EXEC SQL                                                     13650038
136600         INSERT INTO TAUSHPO                                      13660038
136700               (SHIPT_ID,                                         13670038
136800                PO_NBR,                                           13680038
136900                REC_SEQ_NBR,                                      13690038
137000                EXPTED_CART_CNT,                                  13700038
137100                ACTL_CART_CNT,                                    13710038
137200                DMG_CART_CNT,                                     13720038
137300                PKSL_IND,                                         13730038
137400                VEND_NAME,                                        13740038
137500                FRGT_CHG_AMT,                                     13750038
137600                LAST_UPD_PGM_ID,                                  13760038
137700                CRE_USER_ID,                                      13770038
137800                CARR_CART_CT,                                     13780038
137900                CARR_LAST_UPD_DTE,                                13790038
138000                CARR_LAST_UPD_TIME,                               13800038
138100                VEND_CART_CT,                                     13810038
138200                VEND_LAST_UPD_DTE,                                13820038
138300                VEND_LAST_UPD_TIME,                               13830038
138400                CRE_TMST,                                         13840038
138500                LAST_UPD_DTE,                                     13850038
138600                LAST_UPD_TIME,                                    13860038
138700                LAST_UPD_USER_ID,                                 13870038
138800                PRIM_SHIPT_IND                                    13880038
138900              , SPLT_XMIT_IND                                     13890038
139000              , SPLT_XMIT_DTE                                     13900038
139100              , SPLT_XMIT_TM                                      13910038
139200              , TRN_CDE )                                         13920038
139300         VALUES                                                   13930038
139400              (:SHPTPO-SHIPT-ID,                                  13940038
139500               :SHPTPO-PO-NBR,                                    13950038
139600               :SHPTPO-REC-SEQ-NBR,                               13960038
139700               :SHPTPO-EXPTED-CART-CNT,                           13970038
139800               :SHPTPO-ACTL-CART-CNT,                             13980038
139900               :SHPTPO-DMG-CART-CNT,                              13990038
140000               :SHPTPO-PKSL-IND,                                  14000038
140100               :SHPTPO-VEND-NAME,                                 14010038
140200               :SHPTPO-FRGT-CHG-AMT,                              14020038
140300               :PC-CURRENT-PROGRAM-NAME,                          14030038
140400               :SHPTPO-CRE-USER-ID,                               14040038
140500               :SHPTPO-CARR-CART-CT,                              14050038
140600               :SHPTPO-CARR-LAST-UPD-DTE,                         14060038
140700               :SHPTPO-CARR-LAST-UPD-TIME,                        14070038
140800               :SHPTPO-VEND-CART-CT,                              14080038
140900               :SHPTPO-VEND-LAST-UPD-DTE,                         14090038
141000               :SHPTPO-VEND-LAST-UPD-TIME,                        14100038
141100               :SHPTPO-CRE-TMST,                                  14110038
141200                CURRENT DATE,                                     14120038
141300                CURRENT TIME,                                     14130038
141400               :DP020-USERID,                                     14140038
141500               :SHPTPO-PRIM-SHIPT-IND                             14150038
141600             , :SHPTPO-SPLT-XMIT-IND                              14160038
141700             , :SHPTPO-SPLT-XMIT-DTE                              14170038
141800             , :SHPTPO-SPLT-XMIT-TM                               14180038
141900             , :PC-D )                                            14190038
142000     END-EXEC.                                                    14200038
142100                                                                  14210038
142200     EVALUATE TRUE                                                14220038
142300         WHEN SQLCODE = +0                                        14230038
142400              CONTINUE                                            14240038
142500         WHEN SQLCODE = -904                                      14250038
142600         WHEN SQLCODE = -911                                      14260038
142700         WHEN SQLCODE = -913                                      14270038
142800              PERFORM 9900-SOFT-ABORT                             14280038
142900         WHEN SQLWARN0 NOT = SPACES                               14290038
143000         WHEN SQLCODE NOT = ZERO                                  14300038
143100              MOVE '5030-CREATE-TAUSHPO'                          14310038
143200                                TO DP013-PARAGRAPH                14320038
143300              MOVE 'INSERT A ROW ON TAUSHPO'                      14330038
143400                                TO DP013-MESSAGE-TEXT(1)          14340038
143500              MOVE SHPTPO-SHIPT-ID                                14350038
143600                                TO DP013-MESSAGE-TEXT(2)          14360038
143700              MOVE SQLCA        TO DP013-SQLCA                    14370038
143800              MOVE 'TAUSHPO'    TO DP013-DB2-TABLE-NAME (1)       14380038
143900              SET DP013-DB2-ABEND                                 14390038
144000                                TO TRUE                           14400038
144100              PERFORM DP013-0000-PROCESS-ABEND                    14410038
144200     END-EVALUATE.                                                14420038
144300                                                                  14430038
144400     PERFORM 5020-FETCH-PO-SHIPMENT-CSR.                          14440038
144500                                                                  14450038
144600*----------------------------------------------------------------*14460038
144700* CLOSE THE PO SHIPMENT CURSOR.                                  *14470038
144800*----------------------------------------------------------------*14480038
144900                                                                  14490038
145000 5040-CLOSE-PO-SHIPMENT-CURSOR.                                   14500038
145100                                                                  14510038
145200     EXEC SQL                                                     14520038
145300          CLOSE PO-SHIPMENT                                       14530038
145400     END-EXEC.                                                    14540038
145500                                                                  14550038
145600*----------------------------------------------------------------*14560038
145700*   DELETE ALL THE ROWS FROM THE SHIPMENT/PO TABLES (TSHPTPO)    *14570038
145800*----------------------------------------------------------------*14580038
145900 5100-DELETE-SHIPT-PO-ROWS.                                       14590038
146000                                                                  14600038
146100     PERFORM WITH TEST AFTER                                      14610038
146200         VARYING PV-RETRY-COUNTER                                 14620038
146300         FROM 1 BY 1                                              14630038
146400         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 14640038
146500                 OR SQLCODE = 0                                   14650038
146600                 OR SQLCODE = +100 )                              14660038
146700                                                                  14670038
146800         EXEC SQL                                                 14680038
146900             DELETE FROM TSHPTPO                                  14690038
147000             WHERE SHIPT_ID = :DK-SHIPT-ID                        14700038
147100         END-EXEC                                                 14710038
147200                                                                  14720038
147300         EVALUATE TRUE                                            14730038
147400             WHEN SQLCODE = +0                                    14740038
147500             WHEN SQLCODE = +100                                  14750038
147600                   CONTINUE                                       14760038
147700                                                                  14770038
147800             WHEN SQLCODE = -904                                  14780038
147900             WHEN SQLCODE = -911                                  14790038
148000             WHEN SQLCODE = -913                                  14800038
148100                  CONTINUE                                        14810038
148200                                                                  14820038
148300             WHEN OTHER                                           14830038
148400                  MOVE '5100-DELETE-SHIPT-PO-ROWS  '              14840038
148500                                  TO DP013-PARAGRAPH              14850038
148600                  MOVE 'UNSUCCESSFUL DELETE OF TSHPTPO  '         14860038
148700                                  TO DP013-MESSAGE-TEXT (1)       14870038
148800                  MOVE DK-SHIPT-ID                                14880038
148900                                  TO DP013-MESSAGE-TEXT (2)       14890038
149000                  MOVE SQLCA      TO DP013-SQLCA                  14900038
149100                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     14910038
149200                  SET DP013-DB2-ABEND                             14920038
149300                      DP013-XCTL-DISPLAY-RESTART                  14930038
149400                                  TO TRUE                         14940038
149500                  PERFORM DP013-0000-PROCESS-ABEND                14950038
149600         END-EVALUATE                                             14960038
149700     END-PERFORM.                                                 14970038
149800                                                                  14980038
149900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         14990038
150000         MOVE '5100-DELETE-SHIPT-PO-ROWS  '                       15000038
150100                                     TO DP013-PARAGRAPH           15010038
150200         MOVE 'UNSUCCESSFUL DELETE OF TSHPTPO  '                  15020038
150300                                     TO DP013-MESSAGE-TEXT (1)    15030038
150400         MOVE DK-SHIPT-ID            TO DP013-MESSAGE-TEXT (2)    15040038
150500         MOVE SQLCA                  TO DP013-SQLCA               15050038
150600         MOVE 'TSHPTPO '             TO DP013-DB2-TABLE-NAME (1)  15060038
150700         SET DP013-DB2-ABEND                                      15070038
150800             DP013-XCTL-DISPLAY-RESTART                           15080038
150900                                     TO TRUE                      15090038
151000         PERFORM DP013-0000-PROCESS-ABEND                         15100038
151100     END-IF.                                                      15110038
151200                                                                  15120038
151300*----------------------------------------------------------------*15130038
151400* IF A TRAILER IS "ATTACHED" TO THIS SHIPMENT, RELEASE IT AND    *15140038
151500* INSERT A ROW TO THE AUDIT TABLE.                               *15150038
151600*----------------------------------------------------------------*15160038
151700 5200-CHECK-OTHER-SHIPT.                                          15170038
151800                                                                  15180038
151900*    CHECK IF ANY OTHER SHIPMENTS EXISTS FOR THIS TRIP            15190038
152000                                                                  15200038
152100     PERFORM WITH TEST AFTER                                      15210038
152200         VARYING PV-RETRY-COUNTER                                 15220038
152300         FROM 1 BY 1                                              15230038
152400         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 15240038
152500                 OR SQLCODE = -811                                15250038
152600                 OR SQLCODE = 0 )                                 15260038
152700         EXEC SQL                                                 15270038
152800             SELECT                                               15280038
152900                     SHIPT_ID                                     15290038
153000             INTO                                                 15300038
153100                     :PV-TEMP-SHIPT-ID                            15310038
153200             FROM                                                 15320038
153300                   TSHIPMT                                        15330038
153400             WHERE                                                15340038
153500                   TRIP_ID = :DK-TRIP-ID                          15350038
153600         END-EXEC                                                 15360038
153700                                                                  15370038
153800                                                                  15380038
153900         EVALUATE TRUE                                            15390038
154000             WHEN SQLCODE = +0                                    15400038
154100                  SET PS-OTHER-SHIPT-DONT-EXIST TO TRUE           15410038
154200             WHEN SQLCODE = -811                                  15420038
154300                  SET PS-OTHER-SHIPT-EXIST     TO TRUE            15430038
154400                                                                  15440038
154500             WHEN SQLCODE = -904                                  15450038
154600             WHEN SQLCODE = -911                                  15460038
154700             WHEN SQLCODE = -913                                  15470038
154800                  CONTINUE                                        15480038
154900                                                                  15490038
155000             WHEN OTHER                                           15500038
155100                  MOVE '5200-CHECK-OTHER-SHIPT'                   15510038
155200                                  TO DP013-PARAGRAPH              15520038
155300                  MOVE 'UNSUCCESSFUL SELECT OF TSHIPMT  '         15530038
155400                                  TO DP013-MESSAGE-TEXT (1)       15540038
155500                  MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (2)       15550038
155600                  MOVE SQLCA      TO DP013-SQLCA                  15560038
155700                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (1)     15570038
155800                  SET DP013-DB2-ABEND                             15580038
155900                      DP013-XCTL-DISPLAY-RESTART                  15590038
156000                                  TO TRUE                         15600038
156100                  PERFORM DP013-0000-PROCESS-ABEND                15610038
156200         END-EVALUATE                                             15620038
156300     END-PERFORM.                                                 15630038
156400                                                                  15640038
156500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         15650038
156600         MOVE '5200-CHECK-OTHER-SHIPT'                            15660038
156700                                     TO DP013-PARAGRAPH           15670038
156800         MOVE 'UNSUCCESSFUL SELECT OF TSHIPMT  '                  15680038
156900                                     TO DP013-MESSAGE-TEXT (1)    15690038
157000         MOVE DK-TRIP-ID             TO DP013-MESSAGE-TEXT (2)    15700038
157100         MOVE SQLCA                  TO DP013-SQLCA               15710038
157200         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    15720038
157300         SET DP013-DB2-ABEND                                      15730038
157400             DP013-XCTL-DISPLAY-RESTART                           15740038
157500                                     TO TRUE                      15750038
157600         PERFORM DP013-0000-PROCESS-ABEND                         15760038
157700     END-IF.                                                      15770038
157800                                                                  15780038
157900*----------------------------------------------------------------*15790038
158000* IF A TRAILER IS "ATTACHED" TO THIS SHIPMENT, AND THERE IS NO   *15800038
158100* OTHER SHIPMENT WITH THIS TRIP, RELEASE THE TRAILER AND INSERT  *15810038
158200* A ROW TO THE AUDIT TABLE.                                      *15820038
158300*----------------------------------------------------------------*15830038
158400 5210-RELEASE-TRAILER.                                            15840038
158500*    SELECT VALUES TO INSERT TO AUDIT ROW                         15850038
158600                                                                  15860038
158700     PERFORM WITH TEST AFTER                                      15870038
158800         VARYING PV-RETRY-COUNTER                                 15880038
158900         FROM 1 BY 1                                              15890038
159000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 15900038
159100                 OR SQLCODE = 0 )                                 15910038
159200         EXEC SQL                                                 15920038
159300             SELECT                                               15930038
159400                     OWNER_SCAC_ID                                15940038
159500                    ,VEH_NBR                                      15950038
159600                    ,CRT_SRC_CDE                                  15960038
159700                    ,LAST_UPD_DTE                                 15970038
159800                    ,LAST_UPD_TME                                 15980038
159900                    ,LAST_UPD_UID                                 15990038
160000                    ,USAGE_CDE                                    16000038
160100                    ,VEH_TYP_CDE                                  16010038
160200                    ,CURR_STATUS_CDE                              16020038
160300                    ,CURR_STATUS_DTE                              16030038
160400                    ,CURR_STATUS_TME                              16040038
160500                    ,CURR_OPER_UNT_ID                             16050038
160600                    ,CURR_FCLTY_ID                                16060038
160700                    ,CURR_FAC_AREA_ID                             16070038
160800                    ,CURR_LOC_DTE                                 16080038
160900                    ,CURR_LOC_TME                                 16090038
161000                    ,CURR_TRIP_ID                                 16100038
161100                    ,VEH_SIZE_CDE                                 16110038
161200             INTO                                                 16120038
161300                     :VEHICL-OWNER-SCAC-ID                        16130038
161400                   , :VEHICL-VEH-NBR                              16140038
161500                   , :VEHICL-CRT-SRC-CDE                          16150038
161600                   , :VEHICL-LAST-UPD-DTE                         16160038
161700                   , :VEHICL-LAST-UPD-TME                         16170038
161800                   , :VEHICL-LAST-UPD-UID                         16180038
161900                   , :VEHICL-USAGE-CDE                            16190038
162000                   , :VEHICL-VEH-TYP-CDE                          16200038
162100                   , :VEHICL-CURR-STATUS-CDE                      16210038
162200                   , :VEHICL-CURR-STATUS-DTE                      16220038
162300                   , :VEHICL-CURR-STATUS-TME                      16230038
162400                   , :VEHICL-CURR-OPER-UNT-ID                     16240038
162500                   , :VEHICL-CURR-FCLTY-ID                        16250038
162600                   , :VEHICL-CURR-FAC-AREA-ID                     16260038
162700                   , :VEHICL-CURR-LOC-DTE                         16270038
162800                   , :VEHICL-CURR-LOC-TME                         16280038
162900                   , :VEHICL-CURR-TRIP-ID                         16290038
163000                   , :VEHICL-VEH-SIZE-CDE                         16300038
163100             FROM  TVEHICL                                        16310038
163200             WHERE CURR_TRIP_ID = :DK-TRIP-ID                     16320038
163300         END-EXEC                                                 16330038
163400                                                                  16340038
163500                                                                  16350038
163600         EVALUATE TRUE                                            16360038
163700             WHEN SQLCODE = +0                                    16370038
163800                  CONTINUE                                        16380038
163900                                                                  16390038
164000             WHEN SQLCODE = -904                                  16400038
164100             WHEN SQLCODE = -911                                  16410038
164200             WHEN SQLCODE = -913                                  16420038
164300                  CONTINUE                                        16430038
164400                                                                  16440038
164500             WHEN OTHER                                           16450038
164600                  MOVE '5210-RELEASE-TRAILER'                     16460038
164700                                  TO DP013-PARAGRAPH              16470038
164800                  MOVE 'UNSUCCESSFUL SELECT OF TVEHICL  '         16480038
164900                                  TO DP013-MESSAGE-TEXT (1)       16490038
165000                  MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (2)       16500038
165100                  MOVE SQLCA      TO DP013-SQLCA                  16510038
165200                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (1)     16520038
165300                  SET DP013-DB2-ABEND                             16530038
165400                      DP013-XCTL-DISPLAY-RESTART                  16540038
165500                                  TO TRUE                         16550038
165600                  PERFORM DP013-0000-PROCESS-ABEND                16560038
165700         END-EVALUATE                                             16570038
165800     END-PERFORM.                                                 16580038
165900                                                                  16590038
166000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16600038
166100         MOVE '5210-RELEASE-TRAILER'                              16610038
166200                                     TO DP013-PARAGRAPH           16620038
166300         MOVE 'UNSUCCESSFUL SELECT OF TVEHICL  '                  16630038
166400                                     TO DP013-MESSAGE-TEXT (1)    16640038
166500         MOVE DK-TRIP-ID             TO DP013-MESSAGE-TEXT (2)    16650038
166600         MOVE SQLCA                  TO DP013-SQLCA               16660038
166700         MOVE 'TVEHICL '           TO DP013-DB2-TABLE-NAME (1)    16670038
166800         SET DP013-DB2-ABEND                                      16680038
166900             DP013-XCTL-DISPLAY-RESTART                           16690038
167000                                     TO TRUE                      16700038
167100         PERFORM DP013-0000-PROCESS-ABEND                         16710038
167200     END-IF.                                                      16720038
167300                                                                  16730038
167400                                                                  16740038
167500*    RELEASE TRAILER BY UPDATING TVEHICL                          16750038
167600                                                                  16760038
167700     PERFORM WITH TEST AFTER                                      16770038
167800         VARYING PV-RETRY-COUNTER                                 16780038
167900         FROM 1 BY 1                                              16790038
168000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 16800038
168100                 OR SQLCODE = 0 )                                 16810038
168200                                                                  16820038
168300         MOVE -1  TO PV-NI-TRIP-ID                                16830038
168400         EXEC SQL                                                 16840038
168500             UPDATE  TVEHICL                                      16850038
168600             SET     CURR_STATUS_CDE = 'ET'                       16860038
168700               ,     LAST_UPD_DTE    = CURRENT DATE               16870038
168800               ,     LAST_UPD_TME    = CURRENT TIME               16880038
168900               ,     LAST_UPD_UID    = :DP020-USERID              16890038
169000               ,     CURR_STATUS_DTE = CURRENT DATE               16900038
169100               ,     CURR_STATUS_TME = CURRENT TIME               16910038
169200               ,     CURR_TRIP_ID    =                            16920038
169300                     :VEHICL-CURR-TRIP-ID:PV-NI-TRIP-ID           16930038
169400             WHERE                                                16940038
169500                     CURR_TRIP_ID    = :DK-TRIP-ID                16950038
169600         END-EXEC                                                 16960038
169700                                                                  16970038
169800         EVALUATE TRUE                                            16980038
169900             WHEN SQLCODE = +0                                    16990038
170000                   CONTINUE                                       17000038
170100                                                                  17010038
170200             WHEN SQLCODE = -904                                  17020038
170300             WHEN SQLCODE = -911                                  17030038
170400             WHEN SQLCODE = -913                                  17040038
170500                  CONTINUE                                        17050038
170600                                                                  17060038
170700             WHEN OTHER                                           17070038
170800                  MOVE '5210-RELEASE-TRAILER'                     17080038
170900                                  TO DP013-PARAGRAPH              17090038
171000                  MOVE 'UNSUCCESSFUL UPDATE OF TVEHICL  '         17100038
171100                                  TO DP013-MESSAGE-TEXT (1)       17110038
171200                  MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (2)       17120038
171300                  MOVE SQLCA      TO DP013-SQLCA                  17130038
171400                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (1)     17140038
171500                  SET DP013-DB2-ABEND                             17150038
171600                      DP013-XCTL-DISPLAY-RESTART                  17160038
171700                                  TO TRUE                         17170038
171800                  PERFORM DP013-0000-PROCESS-ABEND                17180038
171900         END-EVALUATE                                             17190038
172000     END-PERFORM.                                                 17200038
172100                                                                  17210038
172200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17220038
172300         MOVE '5210-RELEASE-TRAILER'                              17230038
172400                                     TO DP013-PARAGRAPH           17240038
172500         MOVE 'UNSUCCESSFUL UPDATE OF TVEHICL  '                  17250038
172600                                     TO DP013-MESSAGE-TEXT (1)    17260038
172700         MOVE DK-TRIP-ID             TO DP013-MESSAGE-TEXT (2)    17270038
172800         MOVE SQLCA                  TO DP013-SQLCA               17280038
172900         MOVE 'TVEHICL '           TO DP013-DB2-TABLE-NAME (1)    17290038
173000         SET DP013-DB2-ABEND                                      17300038
173100             DP013-XCTL-DISPLAY-RESTART                           17310038
173200                                     TO TRUE                      17320038
173300         PERFORM DP013-0000-PROCESS-ABEND                         17330038
173400     END-IF.                                                      17340038
173500                                                                  17350038
173600                                                                  17360038
173700                                                                  17370038
173800*    INSERT ROW TO AUDIT TABLE                                    17380038
173900                                                                  17390038
174000     PERFORM WITH TEST AFTER                                      17400038
174100         VARYING PV-RETRY-COUNTER                                 17410038
174200         FROM 1 BY 1                                              17420038
174300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 17430038
174400                 OR SQLCODE = 0 )                                 17440038
174500                                                                  17450038
174600         EXEC SQL                                                 17460038
174700             INSERT                                               17470038
174800             INTO   TAUVHCL                                       17480038
174900                  (  OWNER_SCAC_ID                                17490038
175000                    ,VEH_NBR                                      17500038
175100                    ,CRT_SRC_CDE                                  17510038
175200                    ,LAST_UPD_DTE                                 17520038
175300                    ,LAST_UPD_TME                                 17530038
175400                    ,LAST_UPD_UID                                 17540038
175500                    ,USAGE_CDE                                    17550038
175600                    ,VEH_TYP_CDE                                  17560038
175700                    ,CURR_STATUS_CDE                              17570038
175800                    ,CURR_STATUS_DTE                              17580038
175900                    ,CURR_STATUS_TME                              17590038
176000                    ,CURR_OPER_UNT_ID                             17600038
176100                    ,CURR_FCLTY_ID                                17610038
176200                    ,CURR_FAC_AREA_ID                             17620038
176300                    ,CURR_LOC_DTE                                 17630038
176400                    ,CURR_LOC_TME                                 17640038
176500                    ,CURR_TRIP_ID                                 17650038
176600                    ,VEH_SIZE_CDE  )                              17660038
176700             VALUES  (                                            17670038
176800                     :VEHICL-OWNER-SCAC-ID                        17680038
176900                   , :VEHICL-VEH-NBR                              17690038
177000                   , :VEHICL-CRT-SRC-CDE                          17700038
177100                   , CURRENT DATE                                 17710038
177200                   , CURRENT TIME                                 17720038
177300                   , :DP020-USERID                                17730038
177400                   , :VEHICL-USAGE-CDE                            17740038
177500                   , :VEHICL-VEH-TYP-CDE                          17750038
177600                   , 'ET'                                         17760038
177700                   , CURRENT DATE                                 17770038
177800                   , CURRENT TIME                                 17780038
177900                   , :VEHICL-CURR-OPER-UNT-ID                     17790038
178000                   , :VEHICL-CURR-FCLTY-ID                        17800038
178100                   , :VEHICL-CURR-FAC-AREA-ID                     17810038
178200                   , :VEHICL-CURR-LOC-DTE                         17820038
178300                   , :VEHICL-CURR-LOC-TME                         17830038
178400                   , :VEHICL-CURR-TRIP-ID:PV-NI-TRIP-ID           17840038
178500                   , :VEHICL-VEH-SIZE-CDE   )                     17850038
178600         END-EXEC                                                 17860038
178700                                                                  17870038
178800                                                                  17880038
178900         EVALUATE TRUE                                            17890038
179000             WHEN SQLCODE = +0                                    17900038
179100                   CONTINUE                                       17910038
179200                                                                  17920038
179300             WHEN SQLCODE = -904                                  17930038
179400             WHEN SQLCODE = -911                                  17940038
179500             WHEN SQLCODE = -913                                  17950038
179600                  CONTINUE                                        17960038
179700                                                                  17970038
179800             WHEN OTHER                                           17980038
179900                  MOVE '5210-RELEASE-TRAILER'                     17990038
180000                                  TO DP013-PARAGRAPH              18000038
180100                  MOVE 'UNSUCCESSFUL INSERT OF TAUVHCL  '         18010038
180200                                  TO DP013-MESSAGE-TEXT (1)       18020038
180300                  MOVE SQLCA      TO DP013-SQLCA                  18030038
180400                  MOVE 'TAUVHCL ' TO DP013-DB2-TABLE-NAME (1)     18040038
180500                  SET DP013-DB2-ABEND                             18050038
180600                      DP013-XCTL-DISPLAY-RESTART                  18060038
180700                                  TO TRUE                         18070038
180800                  PERFORM DP013-0000-PROCESS-ABEND                18080038
180900         END-EVALUATE                                             18090038
181000     END-PERFORM.                                                 18100038
181100                                                                  18110038
181200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18120038
181300         MOVE '5210-RELEASE-TRAILER'                              18130038
181400                                     TO DP013-PARAGRAPH           18140038
181500         MOVE 'UNSUCCESSFUL INSERT OF TAUVHCL  '                  18150038
181600                                     TO DP013-MESSAGE-TEXT (1)    18160038
181700         MOVE SQLCA                  TO DP013-SQLCA               18170038
181800         MOVE 'TAUVHCL '          TO DP013-DB2-TABLE-NAME (1)     18180038
181900         SET DP013-DB2-ABEND                                      18190038
182000             DP013-XCTL-DISPLAY-RESTART                           18200038
182100                                     TO TRUE                      18210038
182200         PERFORM DP013-0000-PROCESS-ABEND                         18220038
182300     END-IF.                                                      18230038
182400                                                                  18240038
182500*----------------------------------------------------------------*18250038
182600*   DELETE ALL THE ROWS FROM THE TVHTRIP TABLE (DELETE-CASCADE   *18260038
182700*   RI WILL DELETE ALL CORRESPONDING ROWS FROM TVHTRIP, TTRIPST, *18270038
182800*   TSHIPMT, AND TSHIPST)                                         18280038
182900*----------------------------------------------------------------*18290038
183000 5300-DELETE-TRIP.                                                18300038
183100                                                                  18310038
183200     PERFORM WITH TEST AFTER                                      18320038
183300         VARYING PV-RETRY-COUNTER                                 18330038
183400         FROM 1 BY 1                                              18340038
183500         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 18350038
183600                 OR SQLCODE = +100                                18360038
183700                 OR SQLCODE = 0 )                                 18370038
183800                                                                  18380038
183900         EXEC SQL                                                 18390038
184000             DELETE FROM TVHTRIP                                  18400038
184100             WHERE TRIP_ID = :DK-TRIP-ID                          18410038
184200         END-EXEC                                                 18420038
184300                                                                  18430038
184400         EVALUATE TRUE                                            18440038
184500             WHEN SQLCODE = +100                                  18450038
184600                   SET PS-ALREADY-DELETED TO TRUE                 18460038
184700             WHEN SQLCODE = +0                                    18470038
184800                   CONTINUE                                       18480038
184900                                                                  18490038
185000             WHEN SQLCODE = -904                                  18500038
185100             WHEN SQLCODE = -911                                  18510038
185200             WHEN SQLCODE = -913                                  18520038
185300                  CONTINUE                                        18530038
185400                                                                  18540038
185500             WHEN OTHER                                           18550038
185600                  MOVE '5300-DELETE-SHIPMENT-ROWS '               18560038
185700                                  TO DP013-PARAGRAPH              18570038
185800                  MOVE 'UNSUCCESSFUL DELETE OF TVHTRIP  '         18580038
185900                                  TO DP013-MESSAGE-TEXT (1)       18590038
186000                  MOVE DK-TRIP-ID                                 18600038
186100                                  TO DP013-MESSAGE-TEXT (2)       18610038
186200                  MOVE SQLCA      TO DP013-SQLCA                  18620038
186300                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     18630038
186400                  SET DP013-DB2-ABEND                             18640038
186500                      DP013-XCTL-DISPLAY-RESTART                  18650038
186600                                  TO TRUE                         18660038
186700                  PERFORM DP013-0000-PROCESS-ABEND                18670038
186800         END-EVALUATE                                             18680038
186900     END-PERFORM.                                                 18690038
187000                                                                  18700038
187100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18710038
187200         MOVE '5300-DELETE-SHIPMENT-ROWS '                        18720038
187300                                     TO DP013-PARAGRAPH           18730038
187400         MOVE 'UNSUCCESSFUL DELETE OF TVHTRIP  '                  18740038
187500                                     TO DP013-MESSAGE-TEXT (1)    18750038
187600         MOVE DK-TRIP-ID             TO DP013-MESSAGE-TEXT (2)    18760038
187700         MOVE SQLCA                  TO DP013-SQLCA               18770038
187800         MOVE 'TVHTRIP '             TO DP013-DB2-TABLE-NAME (1)  18780038
187900         SET DP013-DB2-ABEND                                      18790038
188000             DP013-XCTL-DISPLAY-RESTART                           18800038
188100                                     TO TRUE                      18810038
188200         PERFORM DP013-0000-PROCESS-ABEND                         18820038
188300     END-IF.                                                      18830038
188400                                                                  18840038
188500 EJECT                                                            18850038
188600                                                                  18860038
188700                                                                  18870038
188800*----------------------------------------------------------------*18880038
188900*   DELETE ALL THE SHIPMENT ROWS FROM TSHIPMT RI WILL DELETE ALL *18890038
189000*   CORRESPONDING ROWS FROM TSHIPST.                             *18900038
189100*----------------------------------------------------------------*18910038
189200 5350-DELETE-SHIPT.                                               18920038
189300                                                                  18930038
189400     PERFORM WITH TEST AFTER                                      18940038
189500         VARYING PV-RETRY-COUNTER                                 18950038
189600         FROM 1 BY 1                                              18960038
189700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 18970038
189800                 OR SQLCODE = +100                                18980038
189900                 OR SQLCODE = 0 )                                 18990038
190000                                                                  19000038
190100         EXEC SQL                                                 19010038
190200             DELETE FROM TSHIPMT                                  19020038
190300             WHERE SHIPT_ID = :DK-SHIPT-ID                        19030038
190400         END-EXEC                                                 19040038
190500                                                                  19050038
190600         EVALUATE TRUE                                            19060038
190700             WHEN SQLCODE = +0                                    19070038
190800                   CONTINUE                                       19080038
190900             WHEN SQLCODE = +100                                  19090038
191000                   SET PS-ALREADY-DELETED TO TRUE                 19100038
191100                                                                  19110038
191200             WHEN SQLCODE = -904                                  19120038
191300             WHEN SQLCODE = -911                                  19130038
191400             WHEN SQLCODE = -913                                  19140038
191500                  CONTINUE                                        19150038
191600                                                                  19160038
191700             WHEN OTHER                                           19170038
191800                  MOVE '5350-DELETE-SHIPT'                        19180038
191900                                  TO DP013-PARAGRAPH              19190038
192000                  MOVE 'UNSUCCESSFUL DELETE OF TVHTRIP  '         19200038
192100                                  TO DP013-MESSAGE-TEXT (1)       19210038
192200                  MOVE DK-TRIP-ID                                 19220038
192300                                  TO DP013-MESSAGE-TEXT (2)       19230038
192400                  MOVE SQLCA      TO DP013-SQLCA                  19240038
192500                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     19250038
192600                  SET DP013-DB2-ABEND                             19260038
192700                      DP013-XCTL-DISPLAY-RESTART                  19270038
192800                                  TO TRUE                         19280038
192900                  PERFORM DP013-0000-PROCESS-ABEND                19290038
193000         END-EVALUATE                                             19300038
193100     END-PERFORM.                                                 19310038
193200                                                                  19320038
193300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19330038
193400         MOVE '5350-DELETE-SHIPT'                                 19340038
193500                                     TO DP013-PARAGRAPH           19350038
193600         MOVE 'UNSUCCESSFUL DELETE OF TVHTRIP  '                  19360038
193700                                     TO DP013-MESSAGE-TEXT (1)    19370038
193800         MOVE DK-TRIP-ID             TO DP013-MESSAGE-TEXT (2)    19380038
193900         MOVE SQLCA                  TO DP013-SQLCA               19390038
194000         MOVE 'TVHTRIP '             TO DP013-DB2-TABLE-NAME (1)  19400038
194100         SET DP013-DB2-ABEND                                      19410038
194200             DP013-XCTL-DISPLAY-RESTART                           19420038
194300                                     TO TRUE                      19430038
194400         PERFORM DP013-0000-PROCESS-ABEND                         19440038
194500     END-IF.                                                      19450038
194600                                                                  19460038
194700 EJECT                                                            19470038
194800                                                                  19480038
194900*----------------------------------------------------------------*19490038
195000*   UPDATED THE SHIPT-ID ON TPKSLIP TO ZEROS.                     19500038
195100*----------------------------------------------------------------*19510038
195200 5400-UPDATE-PACK-SLIP-ROWS.                                      19520038
195300                                                                  19530038
195400     PERFORM WITH TEST AFTER                                      19540038
195500         VARYING PV-RETRY-COUNTER                                 19550038
195600         FROM 1 BY 1                                              19560038
195700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 19570038
195800                 OR SQLCODE = +100                                19580038
195900                 OR SQLCODE = 0 )                                 19590038
196000                                                                  19600038
196100         EXEC SQL                                                 19610038
196200             UPDATE TPKSLIP                                       19620038
196300             SET   SHIPT_ID = 0                                   19630038
196400             WHERE PO_NBR   = :SHPTPO-PO-NBR                      19640038
196500               AND SHIPT_ID = :DK-SHIPT-ID                        19650038
196600         END-EXEC                                                 19660038
196700                                                                  19670038
196800         EVALUATE TRUE                                            19680038
196900             WHEN SQLCODE = +0                                    19690038
197000             WHEN SQLCODE = +100                                  19700038
197100                   CONTINUE                                       19710038
197200                                                                  19720038
197300             WHEN SQLCODE = -904                                  19730038
197400             WHEN SQLCODE = -911                                  19740038
197500             WHEN SQLCODE = -913                                  19750038
197600                  CONTINUE                                        19760038
197700                                                                  19770038
197800             WHEN OTHER                                           19780038
197900                  MOVE '5400-UPDATE-PACK-SLIP-ROWS'               19790038
198000                                  TO DP013-PARAGRAPH              19800038
198100                  MOVE 'UNSUCCESSFUL UPDATE OF TPKSLIP  '         19810038
198200                                  TO DP013-MESSAGE-TEXT (1)       19820038
198300                  MOVE DK-SHIPT-ID                                19830038
198400                                  TO DP013-MESSAGE-TEXT (2)       19840038
198500                  MOVE SQLCA      TO DP013-SQLCA                  19850038
198600                  MOVE 'TPKSLIP ' TO DP013-DB2-TABLE-NAME (1)     19860038
198700                  SET DP013-DB2-ABEND                             19870038
198800                      DP013-XCTL-DISPLAY-RESTART                  19880038
198900                                  TO TRUE                         19890038
199000                  PERFORM DP013-0000-PROCESS-ABEND                19900038
199100         END-EVALUATE                                             19910038
199200     END-PERFORM.                                                 19920038
199300                                                                  19930038
199400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19940038
199500         MOVE '5400-UPDATE-PACK-SLIP-ROWS'                        19950038
199600                                     TO DP013-PARAGRAPH           19960038
199700         MOVE 'UNSUCCESSFUL DELETE OF TVHTRIP  '                  19970038
199800                                     TO DP013-MESSAGE-TEXT (1)    19980038
199900         MOVE DK-TRIP-ID             TO DP013-MESSAGE-TEXT (2)    19990038
200000         MOVE SQLCA                  TO DP013-SQLCA               20000038
200100         MOVE 'TVHTRIP '             TO DP013-DB2-TABLE-NAME (1)  20010038
200200         SET DP013-DB2-ABEND                                      20020038
200300             DP013-XCTL-DISPLAY-RESTART                           20030038
200400                                     TO TRUE                      20040038
200500         PERFORM DP013-0000-PROCESS-ABEND                         20050038
200600     END-IF.                                                      20060038
200700                                                                  20070038
200800*----------------------------------------------------------------*20080038
200900*  INSERT A ROW TO THE TRIP AUDIT TABLE                           20090038
201000*                                                                 20100038
201100*----------------------------------------------------------------*20110038
201200 5500-INSERT-TAUTRIP.                                             20120038
201300                                                                  20130038
201400                                                                  20140038
201500     INITIALIZE DCLTAUTRIP.                                       20150038
201600                                                                  20160038
201700     PERFORM                                                      20170038
201800         WITH TEST AFTER                                          20180038
201900         VARYING PV-RETRY-COUNTER                                 20190038
202000         FROM 1 BY 1                                              20200038
202100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20210038
202200             OR (SQLCODE = +0))                                   20220038
202300                                                                  20230038
202400         EXEC SQL                                                 20240038
202500             SELECT  OWNER_SCAC_ID                                20250038
202600                    ,VEH_NBR                                      20260038
202700                    ,TRIP_ID                                      20270038
202800                    ,TRIP_BEG_DTE                                 20280038
202900                    ,TRIP_BEG_TME                                 20290038
203000                    ,CRT_SRC_CDE                                  20300038
203100                    ,LAST_UPD_DTE                                 20310038
203200                    ,LAST_UPD_TME                                 20320038
203300                    ,LAST_UPD_UID                                 20330038
203400                    ,MANIFEST_NBR                                 20340038
203500                    ,PLND_TRIP_SEQ                                20350038
203600                    ,PLND_ACTVY_CDE                               20360038
203700                    ,OWNR_SCAC_SHIP_DTE                           20370038
203800                    ,REF_TRIP_ID                                  20380038
203900                    ,EST_AR_TMST                                  20390038
204000                    ,SPLT_XMIT_IND                                20400038
204100                    ,SPLT_XMIT_DTE                                20410038
204200                    ,SPLT_XMIT_TM                                 20420038
204300            INTO     :VHTRIP-OWNER-SCAC-ID                        20430038
204400                    ,:VHTRIP-VEH-NBR                              20440038
204500                       :PV-NI-VEH-NBR                             20450038
204600                    ,:VHTRIP-TRIP-ID                              20460038
204700                    ,:VHTRIP-TRIP-BEG-DTE                         20470038
204800                    ,:VHTRIP-TRIP-BEG-TME                         20480038
204900                    ,:VHTRIP-CRT-SRC-CDE                          20490038
205000                    ,:VHTRIP-LAST-UPD-DTE                         20500038
205100                    ,:VHTRIP-LAST-UPD-TME                         20510038
205200                    ,:VHTRIP-LAST-UPD-UID                         20520038
205300                    ,:VHTRIP-MANIFEST-NBR                         20530038
205400                    ,:VHTRIP-PLND-TRIP-SEQ                        20540038
205500                    ,:VHTRIP-PLND-ACTVY-CDE                       20550038
205600                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   20560038
205700                    ,:VHTRIP-REF-TRIP-ID                          20570038
205800                    ,:VHTRIP-EST-AR-TMST                          20580038
205900                           :PV-NI-AR-TMST                         20590038
206000                    ,:VHTRIP-SPLT-XMIT-IND                        20600038
206100                    ,:VHTRIP-SPLT-XMIT-DTE                        20610038
206200                    ,:VHTRIP-SPLT-XMIT-TM                         20620038
206300           FROM   TVHTRIP                                         20630038
206400           WHERE  TRIP_ID       = :DK-TRIP-ID                     20640038
206500         END-EXEC                                                 20650038
206600                                                                  20660038
206700         EVALUATE TRUE                                            20670038
206800             WHEN SQLCODE = +0                                    20680038
206900             WHEN SQLCODE = -904                                  20690038
207000             WHEN SQLCODE = -913                                  20700038
207100                 CONTINUE                                         20710038
207200                                                                  20720038
207300             WHEN SQLWARN0 NOT = SPACES                           20730038
207400             WHEN SQLCODE < +0                                    20740038
207500             WHEN SQLCODE > +0                                    20750038
207600                 MOVE '5500-INSERT-TAUTRIP'                       20760038
207700                                   TO DP013-PARAGRAPH             20770038
207800                 MOVE 'SELECT A ROW ON TVHTRIP'                   20780038
207900                                   TO DP013-MESSAGE-TEXT(1)       20790038
208000                 MOVE DK-SCAC-ID   TO DP013-MESSAGE-TEXT(2)       20800038
208100                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(3)       20810038
208200                 MOVE SQLCA        TO DP013-SQLCA                 20820038
208300                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    20830038
208400                 SET DP013-DB2-ABEND                              20840038
208500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20850038
208600                 PERFORM DP013-0000-PROCESS-ABEND                 20860038
208700         END-EVALUATE                                             20870038
208800     END-PERFORM.                                                 20880038
208900                                                                  20890038
209000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20900038
209100             AND (SQLCODE NOT = +0)                               20910038
209200         MOVE '5500-INSERT-TAUTRIP'                               20920038
209300                                   TO DP013-PARAGRAPH             20930038
209400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              20940038
209500                                   TO DP013-MESSAGE-TEXT (1)      20950038
209600         MOVE 'TO SELECT A TVHTRIP ROW'                           20960038
209700                                   TO DP013-MESSAGE-TEXT (2)      20970038
209800         MOVE SQLCA                TO DP013-SQLCA                 20980038
209900         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    20990038
210000         SET DP013-DB2-ABEND                                      21000038
210100             DP013-XCTL-DISPLAY-RESTART                           21010038
210200                                   TO TRUE                        21020038
210300         PERFORM DP013-0000-PROCESS-ABEND                         21030038
210400     END-IF.                                                      21040038
210500                                                                  21050038
210600     MOVE 'PA'                     TO VHTRIP-CRT-SRC-CDE.         21060038
210700                                                                  21070038
210800     EXEC SQL                                                     21080038
210900         SET :PV-DB2-CURRENT-DATE = CURRENT DATE                  21090038
211000     END-EXEC.                                                    21100038
211100                                                                  21110038
211200     EXEC SQL                                                     21120038
211300         SET :PV-DB2-CURRENT-TIME = CURRENT TIME                  21130038
211400     END-EXEC.                                                    21140038
211500                                                                  21150038
211600     MOVE PV-DB2-CURRENT-DATE  TO VHTRIP-LAST-UPD-DTE.            21160038
211700     MOVE PV-DB2-CURRENT-TIME  TO VHTRIP-LAST-UPD-TME.            21170038
211800     MOVE DP020-USERID         TO VHTRIP-LAST-UPD-UID.            21180038
211900                                                                  21190038
212000     PERFORM                                                      21200038
212100         WITH TEST AFTER                                          21210038
212200         VARYING PV-RETRY-COUNTER                                 21220038
212300         FROM 1 BY 1                                              21230038
212400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21240038
212500             OR (SQLCODE = +0))                                   21250038
212600                                                                  21260038
212700         EXEC SQL                                                 21270038
212800             INSERT  INTO TAUTRIP                                 21280038
212900                    (OWNER_SCAC_ID                                21290038
213000                    ,VEH_NBR                                      21300038
213100                    ,TRIP_ID                                      21310038
213200                    ,TRIP_BEG_DTE                                 21320038
213300                    ,TRIP_BEG_TME                                 21330038
213400                    ,CRT_SRC_CDE                                  21340038
213500                    ,LAST_UPD_DTE                                 21350038
213600                    ,LAST_UPD_TME                                 21360038
213700                    ,LAST_UPD_UID                                 21370038
213800                    ,MANIFEST_NBR                                 21380038
213900                    ,PLND_TRIP_SEQ                                21390038
214000                    ,PLND_ACTVY_CDE                               21400038
214100                    ,OWNR_SCAC_SHIP_DTE                           21410038
214200                    ,REF_TRIP_ID                                  21420038
214300                    ,EST_AR_TMST                                  21430038
214400                    ,AUD_STATUS_CDE                               21440038
214500                    ,SPLT_XMIT_IND                                21450038
214600                    ,SPLT_XMIT_DTE                                21460038
214700                    ,SPLT_XMIT_TM )                               21470038
214800            VALUES  (:VHTRIP-OWNER-SCAC-ID                        21480038
214900                    ,:VHTRIP-VEH-NBR                              21490038
215000                       :PV-NI-VEH-NBR                             21500038
215100                    ,:VHTRIP-TRIP-ID                              21510038
215200                    ,:VHTRIP-TRIP-BEG-DTE                         21520038
215300                    ,:VHTRIP-TRIP-BEG-TME                         21530038
215400                    ,:VHTRIP-CRT-SRC-CDE                          21540038
215500                    ,:VHTRIP-LAST-UPD-DTE                         21550038
215600                    ,:VHTRIP-LAST-UPD-TME                         21560038
215700                    ,:VHTRIP-LAST-UPD-UID                         21570038
215800                    ,:VHTRIP-MANIFEST-NBR                         21580038
215900                    ,:VHTRIP-PLND-TRIP-SEQ                        21590038
216000                    ,:VHTRIP-PLND-ACTVY-CDE                       21600038
216100                    ,:VHTRIP-OWNR-SCAC-SHIP-DTE                   21610038
216200                    ,:VHTRIP-REF-TRIP-ID                          21620038
216300                    ,:VHTRIP-EST-AR-TMST                          21630038
216400                           :PV-NI-AR-TMST                         21640038
216500                    ,:TRIPST-TRIP-STATUS-CDE                      21650038
216600                    ,:VHTRIP-SPLT-XMIT-IND                        21660038
216700                    ,:VHTRIP-SPLT-XMIT-DTE                        21670038
216800                    ,:VHTRIP-SPLT-XMIT-TM )                       21680038
216900         END-EXEC                                                 21690038
217000         EVALUATE TRUE                                            21700038
217100             WHEN SQLCODE = +0                                    21710038
217200             WHEN SQLCODE = -904                                  21720038
217300             WHEN SQLCODE = -913                                  21730038
217400                 CONTINUE                                         21740038
217500                                                                  21750038
217600             WHEN SQLWARN0 NOT = SPACES                           21760038
217700             WHEN SQLCODE < +0                                    21770038
217800             WHEN SQLCODE > +0                                    21780038
217900                 MOVE '5500-INSERT-TAUTRIP'                       21790038
218000                                   TO DP013-PARAGRAPH             21800038
218100                 MOVE 'INSERT A ROW ON TAUTRIP'                   21810038
218200                                   TO DP013-MESSAGE-TEXT(1)       21820038
218300                 MOVE DK-SCAC-ID   TO DP013-MESSAGE-TEXT(2)       21830038
218400                 MOVE DK-TRIP-ID   TO DP013-MESSAGE-TEXT(3)       21840038
218500                 MOVE SQLCA        TO DP013-SQLCA                 21850038
218600                 MOVE 'TAUTRIP'    TO DP013-DB2-TABLE-NAME (1)    21860038
218700                 SET DP013-DB2-ABEND                              21870038
218800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21880038
218900                 PERFORM DP013-0000-PROCESS-ABEND                 21890038
219000         END-EVALUATE                                             21900038
219100     END-PERFORM.                                                 21910038
219200                                                                  21920038
219300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21930038
219400             AND (SQLCODE NOT = +0)                               21940038
219500         MOVE '5500-INSERT-TAUTRIP'                               21950038
219600                                   TO DP013-PARAGRAPH             21960038
219700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              21970038
219800                                   TO DP013-MESSAGE-TEXT (1)      21980038
219900         MOVE 'TO INSERT A TAUTRIP ROW'                           21990038
220000                                   TO DP013-MESSAGE-TEXT (2)      22000038
220100         MOVE SQLCA                TO DP013-SQLCA                 22010038
220200         MOVE 'TAUTRIP'            TO DP013-DB2-TABLE-NAME (1)    22020038
220300         SET DP013-DB2-ABEND                                      22030038
220400             DP013-XCTL-DISPLAY-RESTART                           22040038
220500                                   TO TRUE                        22050038
220600         PERFORM DP013-0000-PROCESS-ABEND                         22060038
220700     END-IF.                                                      22070038
220800*----------------------------------------------------------------*22080038
220900*  INSERT A ROW TO THE SHIPTMENT AUDIT TABLE                      22090038
221000*----------------------------------------------------------------*22100038
221100 5600-INSERT-TAUSHIP.                                             22110038
221200                                                                  22120038
221300     INITIALIZE DCLTAUSHIP.                                       22130038
221400                                                                  22140038
221500* CLT 12/09/2011 WR40574 ADDED CARR AUTH ID BELOW                 22150038
221600     PERFORM                                                      22160038
221700         WITH TEST AFTER                                          22170038
221800         VARYING PV-RETRY-COUNTER                                 22180038
221900         FROM 1 BY 1                                              22190038
222000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22200038
222100             OR (SQLCODE = +0))                                   22210038
222200                                                                  22220038
222300         EXEC SQL                                                 22230038
222400             SELECT  A.TRIP_ID                                    22240038
222500                    ,A.SHIPT_ID                                   22250038
222600                    ,A.CRT_SRC_CDE                                22260038
222700                    ,A.LAST_UPD_DTE                               22270038
222800                    ,A.LAST_UPD_TME                               22280038
222900                    ,A.LAST_UPD_UID                               22290038
223000                    ,A.PRO_SCAC_ID                                22300038
223100                    ,A.PRO_NBR                                    22310038
223200                    ,A.BOL_NBR                                    22320038
223300                    ,A.SHIPPER_NME                                22330038
223400                    ,A.SHIPT_TYP_CDE                              22340038
223500                    ,A.EXPTED_GRO_WGHT                            22350038
223600                    ,A.PKG_TYP_CDE                                22360038
223700                    ,A.EXPTED_PKG_QTY                             22370038
223800                    ,A.FRGT_CHG_AMT                               22380038
223900                    ,A.FRGT_TERMS_CDE                             22390038
224000                    ,A.EXPTED_PLT_QTY                             22400038
224100                    ,A.VEND_SHIP_DTE                              22410038
224200                    ,A.EST_AR_TMST                                22420038
224300                    ,A.ORIG_SCAC_ID                               22430038
224400                    ,A.LAST_UPD_PGM_ID                            22440038
224500                    ,A.CRE_USER_ID                                22450038
224600                    ,A.CARR_CART_CT                               22460038
224700                    ,A.CARR_LAST_UPD_DTE                          22470038
224800                    ,A.CARR_LAST_UPD_TIME                         22480038
224900                    ,A.VEND_CART_CT                               22490038
225000                    ,A.VEND_LAST_UPD_DTE                          22500038
225100                    ,A.VEND_LAST_UPD_TIME                         22510038
225200                    ,A.VEH_NBR                                    22520038
225300                    ,A.AUTH_NBR                                   22530038
225400                    ,A.AUTH_DTE                                   22540038
225500                    ,A.CONFIRM_DTE                                22550038
225600                    ,A.CONFIRM_TIME                               22560038
225700                    ,A.COMPLETE_PRO_NBR                           22570038
225800                    ,A.COMPLETE_BOL_NBR                           22580038
225900                    ,A.PROCESSED_DTE                              22590038
226000                    ,A.INVC_NBR                                   22600038
226010                    ,A.CARR_AUTH_ID                               22601039
226100            INTO     :SHIPMT-TRIP-ID                              22610038
226200                       :PV-NI-TRIP-ID                             22620038
226300                    ,:SHIPMT-SHIPT-ID                             22630038
226400                    ,:SHIPMT-CRT-SRC-CDE                          22640038
226500                    ,:SHIPMT-LAST-UPD-DTE                         22650038
226600                    ,:SHIPMT-LAST-UPD-TME                         22660038
226700                    ,:SHIPMT-LAST-UPD-UID                         22670038
226800                    ,:SHIPMT-PRO-SCAC-ID                          22680038
226900                    ,:SHIPMT-PRO-NBR                              22690038
227000                    ,:SHIPMT-BOL-NBR                              22700038
227100                    ,:SHIPMT-SHIPPER-NME                          22710038
227200                    ,:SHIPMT-SHIPT-TYP-CDE                        22720038
227300                    ,:SHIPMT-EXPTED-GRO-WGHT                      22730038
227400                    ,:SHIPMT-PKG-TYP-CDE                          22740038
227500                    ,:SHIPMT-EXPTED-PKG-QTY                       22750038
227600                    ,:SHIPMT-FRGT-CHG-AMT                         22760038
227700                    ,:SHIPMT-FRGT-TERMS-CDE                       22770038
227800                    ,:SHIPMT-EXPTED-PLT-QTY                       22780038
227900                    ,:SHIPMT-VEND-SHIP-DTE                        22790038
228000                    ,:SHIPMT-EST-AR-TMST                          22800038
228100                       :PV-NI-AR-TMST                             22810038
228200                    ,:SHIPMT-ORIG-SCAC-ID                         22820038
228300                    ,:SHIPMT-LAST-UPD-PGM-ID                      22830038
228400                    ,:SHIPMT-CRE-USER-ID                          22840038
228500                    ,:SHIPMT-CARR-CART-CT                         22850038
228600                    ,:SHIPMT-CARR-LAST-UPD-DTE                    22860038
228700                    ,:SHIPMT-CARR-LAST-UPD-TIME                   22870038
228800                    ,:SHIPMT-VEND-CART-CT                         22880038
228900                    ,:SHIPMT-VEND-LAST-UPD-DTE                    22890038
229000                    ,:SHIPMT-VEND-LAST-UPD-TIME                   22900038
229100                    ,:SHIPMT-VEH-NBR                              22910038
229200                    ,:SHIPMT-AUTH-NBR                             22920038
229300                    ,:SHIPMT-AUTH-DTE                             22930038
229400                    ,:SHIPMT-CONFIRM-DTE                          22940038
229500                    ,:SHIPMT-CONFIRM-TIME                         22950038
229600                    ,:SHIPMT-COMPLETE-PRO-NBR                     22960038
229700                    ,:SHIPMT-COMPLETE-BOL-NBR                     22970038
229800                    ,:SHIPMT-PROCESSED-DTE                        22980038
229900                    ,:SHIPMT-INVC-NBR                             22990038
229910                    ,:SHIPMT-CARR-AUTH-ID                         22991039
230000           FROM   TSHIPMT A                                       23000038
230100           WHERE  A.SHIPT_ID         = :DK-SHIPT-ID               23010038
230200         END-EXEC                                                 23020038
230300                                                                  23030038
230400         EVALUATE TRUE                                            23040038
230500             WHEN SQLCODE = +0                                    23050038
230600             WHEN SQLCODE = -904                                  23060038
230700             WHEN SQLCODE = -913                                  23070038
230800                 CONTINUE                                         23080038
230900                                                                  23090038
231000             WHEN SQLWARN0 NOT = SPACES                           23100038
231100             WHEN SQLCODE < +0                                    23110038
231200             WHEN SQLCODE > +0                                    23120038
231300                 MOVE '5600-INSERT-TAUSHIP'                       23130038
231400                                   TO DP013-PARAGRAPH             23140038
231500                 MOVE 'SELECT A TSHIPMT ROW   '                   23150038
231600                                   TO DP013-MESSAGE-TEXT(1)       23160038
231700                 MOVE ASC-SHIPT-ID TO DP013-MESSAGE-TEXT(2)       23170038
231800                 MOVE SQLCA        TO DP013-SQLCA                 23180038
231900                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    23190038
232000                 SET DP013-DB2-ABEND                              23200038
232100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23210038
232200                 PERFORM DP013-0000-PROCESS-ABEND                 23220038
232300         END-EVALUATE                                             23230038
232400     END-PERFORM.                                                 23240038
232500                                                                  23250038
232600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23260038
232700         MOVE '5600-INSERT-TAUSHIP'                               23270038
232800                                   TO DP013-PARAGRAPH             23280038
232900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              23290038
233000                                   TO DP013-MESSAGE-TEXT (1)      23300038
233100         MOVE 'TO SELECT A TSHIPMT ROW'                           23310038
233200                                   TO DP013-MESSAGE-TEXT (2)      23320038
233300         MOVE SQLCA                TO DP013-SQLCA                 23330038
233400         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    23340038
233500         SET DP013-DB2-ABEND                                      23350038
233600             DP013-XCTL-DISPLAY-RESTART                           23360038
233700                                   TO TRUE                        23370038
233800         PERFORM DP013-0000-PROCESS-ABEND                         23380038
233900     END-IF.                                                      23390038
234000                                                                  23400038
234100     PERFORM                                                      23410038
234200         WITH TEST AFTER                                          23420038
234300         VARYING PV-RETRY-COUNTER                                 23430038
234400         FROM 1 BY 1                                              23440038
234500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23450038
234600             OR (SQLCODE = +0))                                   23460038
234700                                                                  23470038
234800         EXEC SQL                                                 23480038
234900             SELECT  A.SHIPT_STATUS_CDE                           23490038
235000             INTO    :SHIPST-SHIPT-STATUS-CDE                     23500038
235100           FROM   TSHIPST A                                       23510038
235200                 ,TSHSTYP B                                       23520038
235300           WHERE  A.SHIPT_ID = :DK-SHIPT-ID                       23530038
235400             AND  B.PRTY_CDE =                                    23540038
235500                  (SELECT MAX(D.PRTY_CDE)                         23550038
235600                     FROM TSHIPST C                               23560038
235700                         ,TSHSTYP D                               23570038
235800                    WHERE C.SHIPT_ID         = A.SHIPT_ID         23580038
235900                      AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)23590038
236000             AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE         23600038
236100         END-EXEC                                                 23610038
236200                                                                  23620038
236300         EVALUATE TRUE                                            23630038
236400             WHEN SQLCODE = +0                                    23640038
236500             WHEN SQLCODE = -904                                  23650038
236600             WHEN SQLCODE = -913                                  23660038
236700                 CONTINUE                                         23670038
236800                                                                  23680038
236900             WHEN SQLWARN0 NOT = SPACES                           23690038
237000             WHEN SQLCODE < +0                                    23700038
237100             WHEN SQLCODE > +0                                    23710038
237200                 MOVE '5600-INSERT-TAUSHIP'                       23720038
237300                                   TO DP013-PARAGRAPH             23730038
237400                 MOVE 'SELECT A TSHIPST ROW   '                   23740038
237500                                   TO DP013-MESSAGE-TEXT(1)       23750038
237600                 MOVE ASC-SHIPT-ID TO DP013-MESSAGE-TEXT(2)       23760038
237700                 MOVE SQLCA        TO DP013-SQLCA                 23770038
237800                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    23780038
237900                 SET DP013-DB2-ABEND                              23790038
238000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23800038
238100                 PERFORM DP013-0000-PROCESS-ABEND                 23810038
238200         END-EVALUATE                                             23820038
238300     END-PERFORM.                                                 23830038
238400                                                                  23840038
238500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23850038
238600         MOVE '5600-INSERT-TAUSHIP'                               23860038
238700                                   TO DP013-PARAGRAPH             23870038
238800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              23880038
238900                                   TO DP013-MESSAGE-TEXT (1)      23890038
239000         MOVE 'TO SELECT A TSHIPST ROW'                           23900038
239100                                   TO DP013-MESSAGE-TEXT (2)      23910038
239200         MOVE SQLCA                TO DP013-SQLCA                 23920038
239300         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    23930038
239400         SET DP013-DB2-ABEND                                      23940038
239500             DP013-XCTL-DISPLAY-RESTART                           23950038
239600                                   TO TRUE                        23960038
239700         PERFORM DP013-0000-PROCESS-ABEND                         23970038
239800     END-IF.                                                      23980038
239900                                                                  23990038
239901* CLT 12/09/2011 WR40574 START FIX CURRENT PROD PROBLEM           23990141
239910     EXEC SQL                                                     23991040
239920         SET :PV-DB2-CURRENT-DATE = CURRENT DATE                  23992040
239930     END-EXEC.                                                    23993040
239940                                                                  23994040
239950     EXEC SQL                                                     23995040
239960         SET :PV-DB2-CURRENT-TIME = CURRENT TIME                  23996040
239970     END-EXEC.                                                    23997040
239971* CLT 12/09/2011 WR40574 END                                      23997140
239980                                                                  23998040
240000     MOVE PV-DB2-CURRENT-DATE  TO SHIPMT-LAST-UPD-DTE.            24000038
240100     MOVE PV-DB2-CURRENT-TIME  TO SHIPMT-LAST-UPD-TME.            24010038
240200     MOVE DP020-USERID         TO SHIPMT-LAST-UPD-UID.            24020038
240300                                                                  24030038
240400* CLT 12/09/2011 WR40574 ADDED CARR AUTH ID BELOW                 24040038
240500     PERFORM                                                      24050038
240600         WITH TEST AFTER                                          24060038
240700         VARYING PV-RETRY-COUNTER                                 24070038
240800         FROM 1 BY 1                                              24080038
240900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24090038
241000             OR (SQLCODE = +0))                                   24100038
241100                                                                  24110038
241200         EXEC SQL                                                 24120038
241300             INSERT  INTO TAUSHIP                                 24130038
241400                    (TRIP_ID                                      24140038
241500                    ,SHIPT_ID                                     24150038
241600                    ,CRT_SRC_CDE                                  24160038
241700                    ,LAST_UPD_DTE                                 24170038
241800                    ,LAST_UPD_TME                                 24180038
241900                    ,LAST_UPD_UID                                 24190038
242000                    ,PRO_SCAC_ID                                  24200038
242100                    ,PRO_NBR                                      24210038
242200                    ,BOL_NBR                                      24220038
242300                    ,SHIPPER_NME                                  24230038
242400                    ,SHIPT_TYP_CDE                                24240038
242500                    ,EXPTED_GRO_WGHT                              24250038
242600                    ,PKG_TYP_CDE                                  24260038
242700                    ,EXPTED_PKG_QTY                               24270038
242800                    ,FRGT_CHG_AMT                                 24280038
242900                    ,FRGT_TERMS_CDE                               24290038
243000                    ,EST_AR_TMST                                  24300038
243100                    ,VEND_SHIP_DTE                                24310038
243200                    ,EXPTED_PLT_QTY                               24320038
243300                    ,ORIG_SCAC_ID                                 24330038
243400                    ,LAST_UPD_PGM_ID                              24340038
243500                    ,CRE_USER_ID                                  24350038
243600                    ,CARR_CART_CT                                 24360038
243700                    ,CARR_LAST_UPD_DTE                            24370038
243800                    ,CARR_LAST_UPD_TIME                           24380038
243900                    ,VEND_CART_CT                                 24390038
244000                    ,VEND_LAST_UPD_DTE                            24400038
244100                    ,VEND_LAST_UPD_TIME                           24410038
244200                    ,VEH_NBR                                      24420038
244300                    ,AUTH_NBR                                     24430038
244400                    ,AUTH_DTE                                     24440038
244500                    ,CONFIRM_DTE                                  24450038
244600                    ,CONFIRM_TIME                                 24460038
244700                    ,AUD_STATUS_CDE                               24470038
244800                    ,PROCESSED_DTE                                24480038
244900                    ,INVC_NBR                                     24490038
245000                    ,CARR_AUTH_ID)                                24500038
245100            VALUES  (:SHIPMT-TRIP-ID                              24510038
245200                       :PV-NI-TRIP-ID                             24520038
245300                    ,:SHIPMT-SHIPT-ID                             24530038
245400                    ,:SHIPMT-CRT-SRC-CDE                          24540038
245500                    ,:SHIPMT-LAST-UPD-DTE                         24550038
245600                    ,:SHIPMT-LAST-UPD-TME                         24560038
245700                    ,:SHIPMT-LAST-UPD-UID                         24570038
245800                    ,:SHIPMT-PRO-SCAC-ID                          24580038
245900                    ,:SHIPMT-COMPLETE-PRO-NBR                     24590038
246000                    ,:SHIPMT-COMPLETE-BOL-NBR                     24600038
246100                    ,:SHIPMT-SHIPPER-NME                          24610038
246200                    ,:SHIPMT-SHIPT-TYP-CDE                        24620038
246300                    ,:SHIPMT-EXPTED-GRO-WGHT                      24630038
246400                    ,:SHIPMT-PKG-TYP-CDE                          24640038
246500                    ,:SHIPMT-EXPTED-PKG-QTY                       24650038
246600                    ,:SHIPMT-FRGT-CHG-AMT                         24660038
246700                    ,:SHIPMT-FRGT-TERMS-CDE                       24670038
246800                    ,:SHIPMT-EST-AR-TMST                          24680038
246900                       :PV-NI-AR-TMST                             24690038
247000                    ,:SHIPMT-VEND-SHIP-DTE                        24700038
247100                    ,:SHIPMT-EXPTED-PLT-QTY                       24710038
247200                    ,:SHIPMT-ORIG-SCAC-ID                         24720038
247300                    ,:SHIPMT-LAST-UPD-PGM-ID                      24730038
247400                    ,:SHIPMT-CRE-USER-ID                          24740038
247500                    ,:SHIPMT-CARR-CART-CT                         24750038
247600                    ,:SHIPMT-CARR-LAST-UPD-DTE                    24760038
247700                    ,:SHIPMT-CARR-LAST-UPD-TIME                   24770038
247800                    ,:SHIPMT-VEND-CART-CT                         24780038
247900                    ,:SHIPMT-VEND-LAST-UPD-DTE                    24790038
248000                    ,:SHIPMT-VEND-LAST-UPD-TIME                   24800038
248100                    ,:SHIPMT-VEH-NBR                              24810038
248200                    ,:SHIPMT-AUTH-NBR                             24820038
248300                    ,:SHIPMT-AUTH-DTE                             24830038
248400                    ,:SHIPMT-CONFIRM-DTE                          24840038
248500                    ,:SHIPMT-CONFIRM-TIME                         24850038
248600                    ,:SHIPST-SHIPT-STATUS-CDE                     24860038
248700                    ,:SHIPMT-PROCESSED-DTE                        24870038
248800                    ,:SHIPMT-INVC-NBR                             24880038
248900                    ,:SHIPMT-CARR-AUTH-ID)                        24890039
249000         END-EXEC                                                 24900038
249100                                                                  24910038
249200                                                                  24920038
249300         EVALUATE TRUE                                            24930038
249400             WHEN SQLCODE = +0                                    24940038
249500             WHEN SQLCODE = -904                                  24950038
249600             WHEN SQLCODE = -913                                  24960038
249700                 CONTINUE                                         24970038
249800                                                                  24980038
249900             WHEN SQLWARN0 NOT = SPACES                           24990038
250000             WHEN SQLCODE < +0                                    25000038
250100             WHEN SQLCODE > +0                                    25010038
250200                 MOVE '5600-INSERT-TAUSHIP'                       25020038
250300                                   TO DP013-PARAGRAPH             25030038
250400                 MOVE 'INSERT A ROW ON TAUSHIP'                   25040038
250500                                   TO DP013-MESSAGE-TEXT(1)       25050038
250600                 MOVE ASC-SHIPT-ID TO DP013-MESSAGE-TEXT(2)       25060038
250700                 MOVE SQLCA        TO DP013-SQLCA                 25070038
250800                 MOVE 'TAUSHIP'    TO DP013-DB2-TABLE-NAME (1)    25080038
250900                 SET DP013-DB2-ABEND                              25090038
251000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25100038
251100                 PERFORM DP013-0000-PROCESS-ABEND                 25110038
251200         END-EVALUATE                                             25120038
251300     END-PERFORM.                                                 25130038
251400                                                                  25140038
251500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25150038
251600         MOVE '5600-INSERT-TAUSHIP'                               25160038
251700                                   TO DP013-PARAGRAPH             25170038
251800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              25180038
251900                                   TO DP013-MESSAGE-TEXT (1)      25190038
252000         MOVE 'TO INSERT A TAUSHIP ROW'                           25200038
252100                                   TO DP013-MESSAGE-TEXT (2)      25210038
252200         MOVE SQLCA                TO DP013-SQLCA                 25220038
252300         MOVE 'TAUSHIP'            TO DP013-DB2-TABLE-NAME (1)    25230038
252400         SET DP013-DB2-ABEND                                      25240038
252500             DP013-XCTL-DISPLAY-RESTART                           25250038
252600                                   TO TRUE                        25260038
252700         PERFORM DP013-0000-PROCESS-ABEND                         25270038
252800     END-IF.                                                      25280038
252900                                                                  25290038
253000                                                                  25300038
253100                                                                  25310038
253200*----------------------------------------------------------------*25320038
253300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *25330038
253400*    AND THE ERROR SWITCHES.                                     *25340038
253500*----------------------------------------------------------------*25350038
253600                                                                  25360038
253700 9900-SOFT-ABORT.                                                 25370038
253800     SET DP020-MSG-FATAL  TO TRUE.                                25380038
253900     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    25390038
254000     IF PS-NO-NEXT-SCREEN                                         25400038
254100        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     25410038
254200     END-IF.                                                      25420038
254300     PERFORM 9901-BACKUP.                                         25430038
254400     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          25440038
254500     PERFORM 0001-CALL-CICS-ARCH-API.                             25450038
254600                                                                  25460038
254700 9901-BACKUP.                                                     25470038
254800     EXEC CICS SYNCPOINT                                          25480038
254900          ROLLBACK                                                25490038
255000     END-EXEC.                                                    25500038
255100                                                                  25510038
255200 EJECT                                                            25520038
255300*----------------------------------------------------------------*25530038
255400*    ABEND PROCESSOR MODULE                                      *25540038
255500*----------------------------------------------------------------*25550038
255600                                                                  25560038
255700     COPY DPPD013.                                                25570038
