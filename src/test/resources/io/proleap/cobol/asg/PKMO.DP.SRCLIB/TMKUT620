000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.   TMKUT620.                                                  
000600 AUTHOR.       THERESE RAMSEYER.                                          
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                                   
000800 DATE-WRITTEN. JANUARY, 1999.                                             
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  THIS PROGRAM WILL EXTRACT PURCHASE ORDER DATA FROM 5 SPECIFIC          
001300*  DATA SOURCES USING 4 DIFFERENT CURSORS.                                
001400*                                                                         
001500*  PO'S ARE WRITTEN TO WORK TABLE TOUTTM1 WITH ONE DATA SOURCE            
001600*  ASSIGNED PER LINE. IF THE PO FALLS INTO THE RANGE OF DATES             
001700*  FOR MORE THAN ONE DATA SOURCE, IT WILL OCCUR ON THE WORK TABLE         
001800*  MORE THAN ONCE.                                                        
001900*                                                                         
002000* THERE ARE TWO DATE RANGES USED .                                        
002010* THERE IS AN XFACTORY AND AN IMPORT DATE RANGE USED TO                   
002020* EXTRACT PO 'S .  THERE WILL BE 4 DATES DETERMINED:                      
002030*  1)   PV-DATE-BEF-XFCT                                                  
002040*  2)   PV-DATE-AFT-XFCT                                                  
002050*  3)   PV-DATE-BEF-IMPRT                                                 
002060*  4)   PV-DATE-AFT-IMPRT                                                 
002070*  THE NBR OF DAYS EITHER BEFORE OR AFTER THE CURRENT DATE WILL           
002080*  BE DETERMINED BY CORRESPONDING FIELDS IN TIMCNTL                       
002090*                                                                         
002100*                        DATA SOURCE MATRIX                               
002200* ________________________________________________________________        
002300* DATE  |           | DATA  | TABLES | FIELD TO | FETCH  | COMMIT|        
002400* RANGE |  CURSOR   | SRC/  |   IN   |  ASSIGN  | PARA-  |  NBR  |        
002500* TYPE  |  NAME     | PRC GP|  FETCH | DATA SRC |  NBR   |       |        
002600* ______|___________|_______|________|__________|________|_______|        
002700* XFCT  |   XFCT    |  PO/SF| TPURCHS|STRT_FCTRY| 7100-  |   1   |        
002800*       |           |       | TPLNSHP|_DTE      |        |       |        
002900*       |           |       |        |          |        |       |        
002910* XFCT  |   XFCT    |  PO/LF| TPURCHS|LAST_FCTRY| 7100-  |   1   |        
002911*       |           |       | TPLNSHP|_DTE      |        |       |        
002912*_______|___________|_______|________|__________|________|_______|        
002913*       |           |       |        |          |        |       |        
002914* IMPRT |  EST SAIL |  RC/SD|TPURCHS | DPRTR_   | 7200-  |   2   |        
002915*       |    DTE    |       |TIMRCPO | TMST     |        |       |        
002916*_______|___________|_______|________|__________|________|_______|        
002917*       |           |       |        |          |        |       |        
002918* IMPRT |  BKG DELY |  BK/EB| TIMBKPO| PO_BKG_  | 7300-  |   3   |        
002919*       |    DTE    |       | TPURCHS|DELY_TMST |        |       |        
002920*_______|___________|_______|________|__________|________|_______|        
002930*       |           |       |        |          |        |       |        
002940* IMPRT |  ARVL DTE |  CN/AR| TPURCHS| MOM_POE_ | 7400-  |   4   |        
002950*       |           |       | TIMCNPO|DELY_TMST |        |       |        
002960*       |           |       | TIMCNTK|          |        |       |        
002970*_______|___________|_______|________|__________|________|_______|        
002971*       |           |       |        |          |        |       |        
002972* IMPRT |  PKUP DTE |  CN/CT| TPURCHS| CONTNR_  | 7500-  |   5   |        
002973*       |           |       | TIMCNPO| PU_TMST  |        |       |        
002974*       |           |       | TIMCNTK|          |        |       |        
002975*_______|___________|_______|________|__________|________|_______|        
002976*       |           |       |        |          |        |       |        
002977* IMPRT |  CUSTOMS  |  CS/CF| TPURCHS| FILD_    | 7600-  |   6   |        
002978*       |   FILE    |       | TIMCSEN| TMST     |        |       |        
002979*       |   DATE    |       | TIMCSPO|          |        |       |        
002980*_______|___________|_______|________|__________|________|_______|        
002981*                                                                         
002990*                                                                         
003000* THE BASIC MAIN PROCESSING IS AS FOLLOWS:                                
003100*        1) OPEN CSR                                                      
003200*        2) FETCH CSR UNTIL END                                           
003300*           A) INSERT INTO TOUTTM1                                        
003400*        3) CLOSE CSR                                                     
003410*        4) UPDATE CHECKPOINT RESTART TABLES                              
003420*        5) DO A COMMIT                                                   
003430*                                                                         
003440* THIS PROGRAM HAS CHECKPOINT RESTART. A COMMIT IS DONE AFTER THE         
003450* PROCESSING OF EACH CURSOR. IF AN ABEND OCCURS, THE PROGRAM CAN          
003460* BE RESTARTED TO RESUME PROCESSING WITH THE NEXT CURSOR AFTER THE        
003470* LAST COMMIT. THE DATA VALUES IN THE ACCUMULATORS WILL BE                
003480* TRANSFERRED TO THE WORK STORAGE DESCRIPTION IN TCKRSTINF BEFORE         
003490* EACH COMMIT SO THE TOTALS IN SYSOUT WILL BE ACCURATE AFTER A            
003500* RESTART.                                                                
003600******************************************************************        
003700******************************************************************        
003800 ENVIRONMENT DIVISION.                                                    
003900******************************************************************        
004000                                                                          
004100 CONFIGURATION SECTION.                                                   
004200                                                                          
004300 SOURCE-COMPUTER.        IBM-3090.                                        
004400 OBJECT-COMPUTER.        IBM-3090.                                        
004500                                                                          
004600 INPUT-OUTPUT SECTION.                                                    
004700                                                                          
004800 FILE-CONTROL.                                                            
004900                                                                          
005000******************************************************************        
005100 DATA DIVISION.                                                           
005200******************************************************************        
005300                                                                          
005400 FILE SECTION.                                                            
005500                                                                          
005600******************************************************************        
005700 WORKING-STORAGE SECTION.                                                 
005800******************************************************************        
005900                                                                          
006000******************************************************************        
006100*  DB2 FORMATTED MESSAGE AREA                                             
006200******************************************************************        
006300     COPY DPWS004.                                                        
006400                                                                          
006500******************************************************************        
006600*  AREAS USED IN EXECUTION OF DPKUT500 - VERIFY, DECREMENT,               
006700*  INCREMENT DATE ROUTINE.                                                
006800******************************************************************        
006900     COPY DPWS500.                                                        
007000                                                                          
007100******************************************************************        
007200*  COMMUNICATIONS AREA FOR DB2                                            
007300******************************************************************        
007400     EXEC SQL                                                             
007500          INCLUDE SQLCA                                                   
007600     END-EXEC.                                                            
007700                                                                          
007800******************************************************************        
007900*  DB2 TABLE DECLARATION - CHECKPOINT RESTART INFO TBL(TCKRSTINF)         
008000*  THIS TABLE IS USED TO STORE WORKING STORAGE INFORMATION FOR            
008100*  CHECKPOINT RESTARTS.                                                   
008200******************************************************************        
008300     EXEC SQL                                                             
008400         INCLUDE TCKRSTIN                                                 
008500     END-EXEC.                                                            
008600                                                                          
008700******************************************************************        
008800*  DB2 TABLE DECLARATION - CHECKPOINT RESTART CONTROL (TCKRSTCNTL)        
008900*  THIS TABLE IS USED FOR CHECKPOINT RESTARTS.                            
009000******************************************************************        
009100     EXEC SQL                                                             
009200         INCLUDE TCKRSTCN                                                 
009300     END-EXEC.                                                            
009400                                                                          
009500******************************************************************        
009600*  DB2 TABLE DECLARATION - IMPORT CONTROL TABLE.                          
009700*      (TIMCNTL)                                                          
009800******************************************************************        
009900     EXEC SQL                                                             
010000          INCLUDE TIMCNTL                                                 
010100     END-EXEC.                                                            
010200                                                                          
010300******************************************************************        
010400*  DB2 TABLE DECLARATION -  WORK TABLE FOR EXCEPTION PO EXTRACTION        
010500*      (TOUTTM1)                                                          
010600******************************************************************        
010700     EXEC SQL                                                             
010800          INCLUDE TOUTTM1                                                 
010900     END-EXEC.                                                            
011000                                                                          
011100******************************************************************        
011200*  DB2 TABLE DECLARATION -  PURCHASE ORDER PURCHASE TABLE.                
011300*      (TPURCHS)                                                          
011400******************************************************************        
011500     EXEC SQL                                                             
011600          INCLUDE TPURCHS                                                 
011700     END-EXEC.                                                            
011800                                                                          
011900******************************************************************        
012000*  DB2 TABLE DECLARATION - PURCHASE ORDER PLANNED SHIPMENT.               
012100*      (TPLNSHP)                                                          
012200******************************************************************        
012300     EXEC SQL                                                             
012400          INCLUDE TPLNSHP                                                 
012500     END-EXEC.                                                            
012600                                                                          
012700******************************************************************        
012800*  DB2 TABLE DECLARATION - IMPORT BOOKING PO TABLE.                       
012900*      (TIMBKPO)                                                          
013000******************************************************************        
013100     EXEC SQL                                                             
013200          INCLUDE TIMBKPO                                                 
013300     END-EXEC.                                                            
013400                                                                          
013500******************************************************************        
013600*  DB2 TABLE DECLARATION - IMPORT RECIEVING PO TABLE.                     
013700*      (TIMRCPO)                                                          
013800******************************************************************        
013900     EXEC SQL                                                             
014000          INCLUDE TIMRCPO                                                 
014100     END-EXEC.                                                            
014200                                                                          
014300******************************************************************        
014400*  DB2 TABLE DECLARATION - IMPORT CONTAINER PO TABLE.                     
014500*      (TIMCNPO)                                                          
014600******************************************************************        
014700     EXEC SQL                                                             
014800          INCLUDE TIMCNPO                                                 
014900     END-EXEC.                                                            
015000                                                                          
015100******************************************************************        
015200*  DB2 TABLE DECLARATION - IMPORT CONTAINER TRACKING TABLE.               
015300*      (TIMCNTK)                                                          
015400******************************************************************        
015500     EXEC SQL                                                             
015600          INCLUDE TIMCNTK                                                 
015700     END-EXEC.                                                            
015800                                                                          
015810******************************************************************        
015820*  DB2 TABLE DECLARATION - IMPORT CUSTOMS ENTRY TABLE.                    
015830*      (TIMCNTK)                                                          
015840******************************************************************        
015850     EXEC SQL                                                             
015860          INCLUDE TIMCSEN                                                 
015870     END-EXEC.                                                            
015880                                                                          
015890******************************************************************        
015891*  DB2 TABLE DECLARATION - IMPORT CUSTOMS PO TABLE.                       
015892*      (TIMCSPO)                                                          
015893******************************************************************        
015894     EXEC SQL                                                             
015895          INCLUDE TIMCSPO                                                 
015896     END-EXEC.                                                            
015897                                                                          
015900******************************************************************        
016000* COPYBOOK TO CORRESPOND TO TOUTTM1 WORK TABLE                            
016100******************************************************************        
016200     COPY TMRD606.                                                        
016300 EJECT                                                                    
016400                                                                          
016500 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
016600                                                   COMP SYNC.             
016700 01  PA-PROGRAM-ACCUMULATORS.                                             
016800     05  PA-TOTALS.                                                       
016900         10 PA-XFCT-FETCHES           PIC  S9(09)  VALUE +0               
017000                                                     COMP-3.              
017100         10 PA-XFCT-INSERTS           PIC  S9(09)  VALUE +0               
017200                                                     COMP-3.              
017210         10 PA-CNTK-FETCHES           PIC  S9(09)  VALUE +0               
017220                                                     COMP-3.              
017230         10 PA-CNTK-INSERTS           PIC  S9(09)  VALUE +0               
017240                                                     COMP-3.              
017250         10 PA-CSTM-FETCHES           PIC  S9(09)  VALUE +0               
017260                                                     COMP-3.              
017270         10 PA-CSTM-INSERTS           PIC  S9(09)  VALUE +0               
017280                                                     COMP-3.              
017300         10 PA-SF-SOURCES             PIC  S9(09)  VALUE +0               
017400                                                     COMP-3.              
017500         10 PA-LF-SOURCES             PIC  S9(09)  VALUE +0               
017600                                                     COMP-3.              
017700         10 PA-EST-SAIL-FETCHES       PIC  S9(09)  VALUE +0               
017800                                                     COMP-3.              
017900         10 PA-EST-SAIL-INSERTS       PIC  S9(09)  VALUE +0               
018000                                                     COMP-3.              
018100         10 PA-SD-SOURCES             PIC  S9(09)  VALUE +0               
018200                                                     COMP-3.              
018210         10 PA-CN-SOURCES             PIC  S9(09)  VALUE +0               
018220                                                     COMP-3.              
018230         10 PA-CS-SOURCES             PIC  S9(09)  VALUE +0               
018240                                                     COMP-3.              
018300         10 PA-BKG-DELY-FETCHES       PIC  S9(09)  VALUE +0               
018400                                                     COMP-3.              
018500         10 PA-BKG-DELY-INSERTS       PIC  S9(09)  VALUE +0               
018600                                                     COMP-3.              
018700         10 PA-BD-SOURCES             PIC  S9(09)  VALUE +0               
018800                                                     COMP-3.              
018900         10 PA-ARVL-FETCHES           PIC  S9(09)  VALUE +0               
019000                                                     COMP-3.              
019100         10 PA-ARVL-INSERTS           PIC  S9(09)  VALUE +0               
019200                                                     COMP-3.              
019300         10 PA-AR-SOURCES             PIC  S9(09)  VALUE +0               
019400                                                     COMP-3.              
019410         10 PA-CT-SOURCES             PIC  S9(09)  VALUE +0               
019420                                                     COMP-3.              
019430         10 PA-CF-SOURCES             PIC  S9(09)  VALUE +0               
019440                                                     COMP-3.              
019500         10 PA-TOTAL-TOUTTM1-INSERTS  PIC  S9(09)  VALUE +0               
019600                                                     COMP-3.              
019700                                                                          
019800                                                                          
019900 01  PS-PROGRAM-SWITCHES.                                                 
020000     05  PS-PO-ON-TOUTTM1-SW           PIC  X(01)    VALUE 'N'.           
020100         88  PS-PO-ON-TOUTTM1                        VALUE 'Y'.           
020200         88  PS-PO-ON-TOUTTM1-NO                     VALUE 'N'.           
020300     05  PS-EOC-XFCT-CSR-SW            PIC  X(01)    VALUE 'N'.           
020400         88  PS-EOC-XFCT-CSR                         VALUE 'Y'.           
020500         88  PS-EOC-XFCT-CSR-NO                      VALUE 'N'.           
020600     05  PS-EOC-EST-SAIL-DTE-CSR-SW    PIC  X(01)    VALUE 'N'.           
020700         88  PS-EOC-EST-SAIL-DTE-CSR                 VALUE 'Y'.           
020800         88  PS-EOC-EST-SAIL-DTE-CSR-NO              VALUE 'N'.           
020900     05  PS-EOC-BKG-DELY-DTE-CSR-SW    PIC  X(01)    VALUE 'N'.           
021000         88  PS-EOC-BKG-DELY-DTE-CSR                 VALUE 'Y'.           
021100         88  PS-EOC-BKG-DELY-DTE-CSR-NO              VALUE 'N'.           
021200     05  PS-EOC-ARVL-DTE-CSR-SW          PIC  X(01)  VALUE 'N'.           
021300         88  PS-EOC-ARVL-DTE-CSR                     VALUE 'Y'.           
021400         88  PS-EOC-ARVL-DTE-CSR-NO                  VALUE 'N'.           
021410     05  PS-EOC-CNPU-DTE-CSR-SW          PIC  X(01)  VALUE 'N'.           
021420         88  PS-EOC-CNPU-DTE-CSR                     VALUE 'Y'.           
021430         88  PS-EOC-CNPU-DTE-CSR-NO                  VALUE 'N'.           
021440     05  PS-EOC-CSTM-FILD-CSR-SW         PIC  X(01)  VALUE 'N'.           
021450         88  PS-EOC-CSTM-FILD-CSR                    VALUE 'Y'.           
021460         88  PS-EOC-CSTM-FILD-CSR-NO                 VALUE 'N'.           
021500     05  PS-RUN-TYPE-SW                PIC  X(01)    VALUE ' '.           
021600         88  PS-NORMAL-RUN                           VALUE '0'.           
021700         88  PS-RESTART-RUN                          VALUE '9'.           
021800     05  PS-COMMITS-TAKEN-SW           PIC  X(01)    VALUE 'N'.           
021900         88  PS-COMMITS-TAKEN                        VALUE 'Y'.           
022000         88  PS-COMMITS-TAKEN-NO                     VALUE 'N'.           
022100     05  PS-DATA-SRC-STRT-XFCT-SW      PIC  X(01)    VALUE 'N'.           
022200         88  PS-DATA-SRC-STRT-XFCT                   VALUE 'Y'.           
022300         88  PS-DATA-SRC-STRT-XFCT-NO                VALUE 'N'.           
022400     05  PS-DATA-SRC-LAST-XFCT-SW   PIC  X(01)       VALUE 'N'.           
022500         88  PS-DATA-SRC-LAST-XFCT                   VALUE 'Y'.           
022600         88  PS-DATA-SRC-LAST-XFCT-NO                VALUE 'N'.           
022700     05  PS-DATA-SRC-SAIL-DTE-SW    PIC  X(01)       VALUE 'N'.           
022800         88  PS-DATA-SRC-SAIL-DTE                    VALUE 'Y'.           
022900         88  PS-DATA-SRC-SAIL-DTE-NO                 VALUE 'N'.           
023000     05  PS-DATA-SRC-BKG-DTE-SW     PIC  X(01)       VALUE 'N'.           
023100         88  PS-DATA-SRC-BKG-DTE                     VALUE 'Y'.           
023200         88  PS-DATA-SRC-BKG-DTE-NO                  VALUE 'N'.           
023300     05  PS-DATA-SRC-ARVL-DTE-SW    PIC  X(01)       VALUE 'N'.           
023400         88  PS-DATA-SRC-ARVL-DTE                    VALUE 'Y'.           
023500         88  PS-DATA-SRC-ARVL-DTE-NO                 VALUE 'N'.           
023510     05  PS-DATA-SRC-CNPU-DTE-SW    PIC  X(01)       VALUE 'N'.           
023520         88  PS-DATA-SRC-CNPU-DTE                    VALUE 'Y'.           
023530         88  PS-DATA-SRC-CNPU-DTE-NO                 VALUE 'N'.           
023540     05  PS-DATA-SRC-CSTM-FILD-SW   PIC  X(01)       VALUE 'N'.           
023550         88  PS-DATA-SRC-CSTM-FILD                   VALUE 'Y'.           
023560         88  PS-DATA-SRC-CSTM-FILD-NO                VALUE 'N'.           
023600                                                                          
023700 01  PC-PROGRAM-CONSTANTS.                                                
023800                                                                          
023900     05  PC-MAX-RETRIES              PIC S9(03) VALUE +5 COMP-3.          
024000                                                                          
024100     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'TMKUT620'.         
024200                                                                          
024300     05  PC-RUN-IN-PROGRESS-CODE     PIC X(01)     VALUE '9'.             
024400                                                                          
024500     05  PC-RUN-COMPLETE-CODE        PIC X(01)     VALUE '0'.             
024600                                                                          
024700     05  PC-0                        PIC  X(01)    VALUE '0'.             
024800                                                                          
024900     05  PC-1                        PIC  X(01)    VALUE '1'.             
025000                                                                          
025100     05  PC-2                        PIC  X(01)    VALUE '2'.             
025200                                                                          
025300     05  PC-3                        PIC  X(01)    VALUE '3'.             
025400                                                                          
025500     05  PC-4                        PIC  X(01)    VALUE '4'.             
025600                                                                          
025610     05  PC-5                        PIC  X(01)    VALUE '5'.             
025620                                                                          
025630     05  PC-6                        PIC  X(01)    VALUE '6'.             
025640                                                                          
025700     05  PC-DASH                     PIC  X(01)    VALUE '-'.             
025800                                                                          
025902     05  PC-BK                       PIC  X(02)    VALUE 'BK'.            
025903                                                                          
025904     05  PC-CF                       PIC  X(02)    VALUE 'CF'.            
025905                                                                          
025906     05  PC-CN                       PIC  X(02)    VALUE 'CN'.            
025907                                                                          
025908     05  PC-CS                       PIC  X(02)    VALUE 'CS'.            
025909                                                                          
025910     05  PC-CP                       PIC  X(02)    VALUE 'CP'.            
025911                                                                          
025912     05  PC-EB                       PIC  X(02)    VALUE 'EB'.            
025913                                                                          
025914     05  PC-LF                       PIC  X(02)    VALUE 'LF'.            
025915                                                                          
025916     05  PC-PA                       PIC  X(02)    VALUE 'PA'.            
025917                                                                          
025918     05  PC-PO                       PIC  X(02)    VALUE 'PO'.            
025919                                                                          
026300     05  PC-RC                       PIC  X(02)    VALUE 'RC'.            
026400                                                                          
026500     05  PC-SD                       PIC  X(02)    VALUE 'SD'.            
026510                                                                          
026520     05  PC-SF                       PIC  X(02)    VALUE 'SF'.            
026600                                                                          
026900                                                                          
027000 01  PV-PROGRAM-VARIABLES.                                                
027100                                                                          
027200       05  PV-HOLD-CURRENT-PO         PIC S9(09) COMP VALUE +0.           
027300                                                                          
027400       05  PV-HOLD-CURRENT-DATA-SRC PIC  X(02)   VALUE SPACES.            
027500                                                                          
027600       05  PV-CURRENT-TMST         PIC X(26)     VALUE SPACES.            
027700                                                                          
027800       05  PV-BEGIN-CSR-TMST       PIC X(26)     VALUE SPACES.            
027900                                                                          
028000       05  PV-END-CSR-TMST         PIC X(26)     VALUE SPACES.            
028100                                                                          
028200       05  PV-IMRCPO-SAIL-DTE      PIC  X(10)    VALUE SPACES.            
028300                                                                          
028200       05  PV-IMRCPO-RCVD-DELY-DTE    PIC  X(10)    VALUE SPACES.         
028300                                                                          
028400       05  PV-IMBKPO-PO-BKG-DELY-DTE  PIC  X(10)    VALUE SPACES.         
028500                                                                          
028600       05  PV-IMCNTK-POE-DELY-DTE        PIC X(10) VALUE SPACES.          
028700                                                                          
028710       05  PV-IMCNTK-PU-DTE              PIC X(10) VALUE SPACES.          
028711                                                                          
028712       05  PV-IMCSEN-FILD-DTE            PIC X(10) VALUE SPACES.          
028720                                                                          
028800       05  PV-DATE-BEF-XFCT              PIC X(10) VALUE SPACES.          
028900                                                                          
029000       05  PV-DATE-AFT-XFCT              PIC X(10) VALUE SPACES.          
029100                                                                          
029200       05  PV-DATE-BEF-IMPRT             PIC X(10) VALUE SPACES.          
029300                                                                          
029400       05  PV-DATE-AFT-IMPRT             PIC X(10) VALUE SPACES.          
029500                                                                          
029600       05  PV-CURRENT-DATE               PIC X(10) VALUE SPACES.          
029700                                                                          
029800       05  PV-CKPT-STAT-CODE           PIC X(01)    VALUE SPACE.          
029900                                                                          
030000       05  PV-BEGIN-SECONDS              PIC  S9(04)  VALUE +0            
030100                                                      COMP SYNC.          
030200                                                                          
030300       05  PV-END-SECONDS                PIC  S9(04)  VALUE +0            
030400                                                      COMP SYNC.          
030500                                                                          
030600       05  PV-ELAPSED-SECONDS            PIC  S9(04)  VALUE +0            
030700                                                      COMP SYNC.          
030800                                                                          
030900       05  PV-RETRY-COUNTER              PIC S9(04)   VALUE +0            
031000                                                      COMP SYNC.          
031100                                                                          
031200 01  PV-CKPT-RESTART-INFO.                                                
031210                                                                          
031300     05  PV-LAST-PO-PROCESSED          PIC S9(09) COMP VALUE +0.          
031400                                                                          
031500     05  PV-LAST-CSR-PROCESSED         PIC  X(30)   VALUE SPACES.         
031600                                                                          
031700     05  PV-TOTAL-COMMITS-TAKEN        PIC   X(01)  VALUE ZEROES.         
031800                                                                          
031900     05  PV-CKPT-SF-SRC                PIC   9(09)  VALUE ZEROES.         
032000                                                                          
032100     05  PV-CKPT-LF-SRC                PIC   9(09)  VALUE ZEROES.         
032200                                                                          
032500     05  PV-CKPT-BD-SRC                PIC   9(09)  VALUE ZEROES.         
032600                                                                          
032900     05  PV-CKPT-SD-SRC                PIC   9(09)  VALUE ZEROES.         
033000                                                                          
033300     05  PV-CKPT-AR-SRC                PIC   9(09)  VALUE ZEROES.         
033400                                                                          
033401     05  PV-CKPT-CN-SRC                PIC   9(09)  VALUE ZEROES.         
033402                                                                          
033403     05  PV-CKPT-CS-SRC                PIC   9(09)  VALUE ZEROES.         
033404                                                                          
033405     05  PV-CKPT-XFCT-INSERTS          PIC   9(09)  VALUE ZEROES.         
033406                                                                          
033407     05  PV-CKPT-SAIL-INSERTS          PIC   9(09)  VALUE ZEROES.         
033408                                                                          
033410     05  PV-CKPT-BKG-INSERTS           PIC   9(09)  VALUE ZEROES.         
033420                                                                          
033500     05  PV-CKPT-ARVL-INSERTS          PIC   9(09)  VALUE ZEROES.         
033600                                                                          
033610     05  PV-CKPT-CNTK-INSERTS          PIC   9(09)  VALUE ZEROES.         
033620                                                                          
033630     05  PV-CKPT-CSTM-INSERTS          PIC   9(09)  VALUE ZEROES.         
033640                                                                          
033700     05  PV-CKPT-TOTAL-EXTRACTS        PIC   9(09)  VALUE ZEROES.         
033800                                                                          
033900 EJECT                                                                    
034000                                                                          
034100*-----------------------------------------------------------------        
034200*  CURSOR DECLARATION TO EXTRACT DATA FOR AN EVENT WHICH HAS A            
034300*  START-X-FACTORY DATE OR A LAST-X-FACTORY DATE THAT FALLS               
034400*  BETWEEN PV-DATE-BEF-XFCT AND PV-DATE-AFT-XFCT. (XFCT DTE RANGE)        
034500*  THIS PARTICULAR CURSOR USES AN "IN-LINE VIEW" (CREATES A NESTED        
034600*  TABLE). THE CSR IS RETRIEVING 2 DATES FROM THE SAME TABLE, BOTH        
034700*  DATES ARE WITHIN A RANGE - HENCE THE 'OR' IN THE 'FROM' CLAUSE.        
034800*  THE ESSENCE OF WHAT THIS IS HAPPENING IS : A SECOND SELECT IN          
034900*  THE 'FROM' CLAUSE OF THE FIRST SELECT IS CREATED DURING                
035000*  PROCESSING. THIS PROGRAM WAS 'TIMING OUT' WITH A 322 ERROR             
035100*  WITHOUT THE "IN-LINE VIEW". THIS IS A GREAT WAY TO IMPROVE             
035200*  PERFORMANCE WITHOUT HAVING TO CREATE A PERMANENT VIEW WHICH            
035300*  HAS TO BE MAINTAINED.                                                  
035400*-----------------------------------------------------------------        
035500                                                                          
035600     EXEC SQL                                                             
035700        DECLARE XFCT_CSR CURSOR FOR                                       
035800                 SELECT DISTINCT                                          
035900                        A.PO_NBR                                          
036000                       ,A.VER_NBR                                         
036100                       ,B.VER_NBR                                         
036200                       ,B.STRT_FCTRY_DTE                                  
036300                       ,B.LAST_FCTRY_DTE                                  
036400                       ,B.LAST_UPD_TMST                                   
036500                   FROM TPURCHS  A                                        
036600                       ,TPLNSHP  B,                                       
036700                  (SELECT STRT_FCTRY_DTE AS STRT_DTE                      
036800                       ,  LAST_FCTRY_DTE AS LAST_DTE                      
036900                   FROM TPLNSHP  B                                        
037000                   WHERE  ((STRT_FCTRY_DTE     BETWEEN                    
037100                       :PV-DATE-BEF-XFCT AND :PV-DATE-AFT-XFCT)           
037200                    OR                                                    
037300                        (LAST_FCTRY_DTE     BETWEEN                       
037400                        :PV-DATE-BEF-XFCT AND :PV-DATE-AFT-XFCT))         
037500                    AND VER_STATUS_CDE      = 'A') AS V                   
037600                  WHERE B.STRT_FCTRY_DTE = V.STRT_DTE                     
037700                    AND B.LAST_FCTRY_DTE = V.LAST_DTE                     
037800                    AND A.STATUS_CDE          IN ('AC','AP')              
037910                    AND A.PO_NBR              = B.PO_NBR                  
038000                    AND A.VER_STATUS_CDE      = 'A'                       
038100                    AND B.VER_STATUS_CDE      = 'A'                       
038200     END-EXEC.                                                            
038300                                                                          
038400 EJECT                                                                    
038500                                                                          
038600*-----------------------------------------------------------------        
038700*  CURSOR DECLARATION TO EXTRACT DATA FOR AN EVENT WHICH HAS AN           
038800*  ESTIMATED SAIL DATE THAT FALLS BETWEEN PV-DATE-BEF-IMPRT AND           
038900*  PV-DATE-AFT-IMPRT (IMPRT DTE RANGE).                                   
039000*-----------------------------------------------------------------        
039100                                                                          
039200     EXEC SQL                                                             
039300          DECLARE EST_SAIL_DTE_CSR CURSOR FOR                             
039400             SELECT DISTINCT                                              
039500                    B.PO_NBR                                              
039600                   ,A.PO_RCVD_SEQ_NBR                                     
039700                   ,DATE(A.DPRTR_TMST)                                    
039700                   ,DATE(A.PO_RCVD_DELY_TMST)                             
039800                   ,A.LAST_UPD_TMST                                       
039900               FROM TIMRCPO  A                                            
040000                   ,TPURCHS  B                                            
040100              WHERE (                                                     
040200                     (DATE(A.DPRTR_TMST) BETWEEN                          
040300                     :PV-DATE-BEF-IMPRT AND :PV-DATE-AFT-IMPRT)           
040400                    )                                                     
040500                AND B.STATUS_CDE          IN ('AC','AP')                  
040600                AND A.PO_NBR              = B.PO_NBR                      
040700                AND B.VER_STATUS_CDE      = 'A'                           
040800     END-EXEC.                                                            
040900                                                                          
041000 EJECT                                                                    
041100                                                                          
041200*-----------------------------------------------------------------        
041300*  CURSOR DECLARATION TO EXTRACT DATA FOR AN EVENT WHICH HAS A            
041400*  PO BKG DELY DATE THAT FALLS BETWEEN PV-DATE-BEF-IMPRT AND              
041500*  PV-DATE-AFT-IMPRT (IMPRT DTE RANGE).                                   
041600*-----------------------------------------------------------------        
041700                                                                          
041800     EXEC SQL                                                             
041900          DECLARE BKG_DELY_DTE_CSR CURSOR FOR                             
042000             SELECT DISTINCT                                              
042100                    B.PO_NBR                                              
042200                   ,A.PO_BKG_SEQ_NBR                                      
042300                   ,DATE(A.PO_BKG_DELY_TMST)                              
042400                   ,A.LAST_UPD_TMST                                       
042500               FROM TIMBKPO  A                                            
042600                   ,TPURCHS  B                                            
042700              WHERE (                                                     
042800                     (DATE(A.PO_BKG_DELY_TMST) BETWEEN                    
042900                     :PV-DATE-BEF-IMPRT AND :PV-DATE-AFT-IMPRT)           
043000                    )                                                     
043100                AND B.STATUS_CDE          IN ('AC','AP')                  
043200                AND A.PO_NBR              = B.PO_NBR                      
043300                AND B.VER_STATUS_CDE      = 'A'                           
043400     END-EXEC.                                                            
043500                                                                          
043600 EJECT                                                                    
043700                                                                          
043800*-----------------------------------------------------------------        
043900*  CURSOR DECLARATION TO EXTRACT DATA FOR AN EVENT WHICH HAS AN           
044000*  ARRIVAL DATE THAT FALLS BETWEEN PV-DATE-BEF-IMPRT                      
044100*  AND PV-DATE-AFT-IMPRT (IMPRT DTE RANGE).                               
044200*-----------------------------------------------------------------        
044300                                                                          
044400     EXEC SQL                                                             
044500          DECLARE ARVL_DTE_CSR CURSOR FOR                                 
044600             SELECT DISTINCT                                              
044700                    A.PO_NBR                                              
044800                   ,A.CONTNR_ID                                           
044900                   ,A.CONTNR_SEQ_NBR                                      
045000                   ,DATE(B.ACTL_POE_DELY_TMST)                            
045100                   ,B.LAST_UPD_TMST                                       
045200               FROM TIMCNPO  A                                            
045300                   ,TIMCNTK  B                                            
045400                   ,TPURCHS  C                                            
045500              WHERE (                                                     
045600                     (DATE(B.ACTL_POE_DELY_TMST) BETWEEN                  
045700                     :PV-DATE-BEF-IMPRT AND :PV-DATE-AFT-IMPRT)           
045800                    )                                                     
045900                AND C.STATUS_CDE          IN ('AC','AP')                  
046000                AND A.PO_NBR              = C.PO_NBR                      
046100                AND A.CONTNR_ID           = B.CONTNR_ID                   
046200                AND C.VER_STATUS_CDE      = 'A'                           
046300     END-EXEC.                                                            
046400                                                                          
046500 EJECT                                                                    
046600                                                                          
046610*-----------------------------------------------------------------        
046620*  CURSOR DECLARATION TO EXTRACT DATA FOR AN EVENT WHICH HAS A            
046630*  PICK UP DATE THAT FALLS BETWEEN PV-DATE-BEF-IMPRT                      
046640*  AND PV-DATE-AFT-IMPRT (IMPRT DTE RANGE).                               
046650*-----------------------------------------------------------------        
046660                                                                          
046670     EXEC SQL                                                             
046680          DECLARE CNPU_DTE_CSR CURSOR FOR                                 
046690             SELECT DISTINCT                                              
046691                    A.PO_NBR                                              
046692                   ,A.CONTNR_ID                                           
046693                   ,A.CONTNR_SEQ_NBR                                      
046694                   ,DATE(B.CONTNR_PU_TMST)                                
045000                   ,DATE(B.ACTL_POE_DELY_TMST)                            
046695                   ,B.LAST_UPD_TMST                                       
046696               FROM TIMCNPO  A                                            
046697                   ,TIMCNTK  B                                            
046698                   ,TPURCHS  C                                            
046699              WHERE (                                                     
046700                     (DATE(B.CONTNR_PU_TMST) BETWEEN                      
046701                     :PV-DATE-BEF-IMPRT AND :PV-DATE-AFT-IMPRT)           
046702                    )                                                     
046703                AND C.STATUS_CDE          IN ('AC','AP')                  
046704                AND A.PO_NBR              = C.PO_NBR                      
046705                AND A.CONTNR_ID           = B.CONTNR_ID                   
046706                AND C.VER_STATUS_CDE      = 'A'                           
046707     END-EXEC.                                                            
046708                                                                          
046709 EJECT                                                                    
046710                                                                          
046711*-----------------------------------------------------------------        
046712*  CURSOR DECLARATION TO EXTRACT DATA FOR AN EVENT WHICH HAS A            
046713*  CUSTOMS FILED DATE THAT FALLS BETWEEN PV-DATE-BEF-IMPRT                
046714*  AND PV-DATE-AFT-IMPRT (IMPRT DTE RANGE).                               
046715*-----------------------------------------------------------------        
046716                                                                          
046717     EXEC SQL                                                             
046718          DECLARE CSTM_FILD_CSR CURSOR FOR                                
046719             SELECT DISTINCT                                              
046720                    A.PO_NBR                                              
046722                   ,B.CSTM_ENTR_ID                                        
046723                   ,DATE(B.FILD_TMST)                                     
046724                   ,B.LAST_UPD_TMST                                       
046725               FROM TIMCNPO  A                                            
046726                   ,TIMCSEN  B                                            
046727                   ,TPURCHS  C                                            
046728              WHERE (                                                     
046729                     (DATE(B.FILD_TMST) BETWEEN                           
046730                     :PV-DATE-BEF-IMPRT AND :PV-DATE-AFT-IMPRT)           
046731                    )                                                     
046732                AND C.STATUS_CDE          IN ('AC','AP')                  
046733                AND A.PO_NBR              = C.PO_NBR                      
046734                AND A.CSTM_ENTR_ID        = B.CSTM_ENTR_ID                
046735                AND C.VER_STATUS_CDE      = 'A'                           
046736     END-EXEC.                                                            
046737                                                                          
046738 EJECT                                                                    
046739                                                                          
046740******************************************************************        
046800 LINKAGE SECTION.                                                         
046900******************************************************************        
047000                                                                          
047100******************************************************************        
047200 PROCEDURE DIVISION.                                                      
047300******************************************************************        
047400******************************************************************        
047500*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *        
047600******************************************************************        
047700 0000-PROGRAM-MAINLINE.                                                   
047800                                                                          
047900     PERFORM 1000-INITIALIZE.                                             
048000                                                                          
048100     PERFORM 2000-PROCESS-CURSORS.                                        
048200                                                                          
048300     PERFORM 8000-EOJ-ROUTINE.                                            
048400     STOP RUN.                                                            
048500                                                                          
048600******************************************************************        
048700* INITIALIZE VARIABLE FIELDS. DETERMINE THE TWO VARIABLE DATE    *        
048800* RANGES. THERE IS AN XFACTORY AND AN IMPORT DATE RANGE USED TO  *        
048900* EXTRACT PO 'S .  THERE WILL BE 4 DATES DETERMINED:             *        
049000*  1)   PV-DATE-BEF-XFCT                                         *        
049100*  2)   PV-DATE-AFT-XFCT                                         *        
049200*  3)   PV-DATE-BEF-IMPRT                                        *        
049300*  4)   PV-DATE-AFT-IMPRT                                        *        
049400*  THE NBR OF DAYS EITHER BEFORE OR AFTER THE CURRENT DATE WILL  *        
049500*  BE DETERMINED BY CORRESPONDING FIELDS IN TIMCNTL. THE TRBL ON *        
049600*  TIMCNTL REFERS TO THE XFCT DATE RANGE, IMPRT ON TIMCNTL REFERS*        
049700*  TO THE IMPRT DATE RANGE.  THESE 4 VARIABLES WILL BE USED IN   *        
049800*  THE CURSORS WHICH WILL EXTRACT PO'S IF CERTAIN DATES FALL     *        
049900*  WITHIN THE SPECIFIED RANGES.                                  *        
050000******************************************************************        
050100 1000-INITIALIZE.                                                         
050200                                                                          
050300     INITIALIZE   PV-DATE-BEF-XFCT                                        
050400                  PV-DATE-AFT-XFCT                                        
050500                  PV-DATE-BEF-IMPRT                                       
050600                  PV-DATE-AFT-IMPRT                                       
050700                  PV-CURRENT-DATE                                         
050710                  TM606-RECORD.                                           
050800                                                                          
050900     PERFORM 6000-SELECT-FOR-DTE-RANGES.                                  
051000     PERFORM 6005-CALCULATE-XFCT-BEF-DTE.                                 
051100     PERFORM 6010-CALCULATE-XFCT-AFT-DTE.                                 
051200     PERFORM 6015-CALCULATE-IMPRT-BEF-DTE.                                
051300     PERFORM 6020-CALCULATE-IMPRT-AFT-DTE.                                
051400                                                                          
051500 EJECT                                                                    
051600                                                                          
051700******************************************************************        
051800* THIS PARAGRAPH WILL PROCESS CURSORS. THE PROCESSING FOR EACH            
051900* CURSOR IS ESSENTIALLY THE SAME AND IS AS FOLLOWS:                       
052000*                                                                         
052100*  1) OPEN CURSOR                                                         
052200*  2) FETCH CURSOR                                                        
052300*     A) RETURN A ROW                                                     
052400*     B) ASSIGN THE DATA SOURCE TO THE RETURN OF EACH FETCH.              
052500*     C) LOAD COPYBOOK FIELDS OF WORK TABLE LAYOUT                        
052600*     D) DO AN INSERT TO THE WORT TABLE TOUTTM1.                          
052700*     E) FETCH THE NEXT ROW, REPEATING STEPS A) THRU D) UNTIL             
052800*        SQLCODE = +100                                                   
052900*     F) CLOSE CURSOR                                                     
053000*                                                                         
053100*      ------------------------------------                               
053200*        7100-PROCESS-XFCT-CSR                                            
053300*             DO COMMIT 1                                                 
053400*        7200-PROCESS-EST-SAIL-DTE-CSR                                    
053500*             DO COMMIT 2                                                 
053600*        7300-PROCESS-BKG-DELY-DTE-CSR                                    
053700*             DO COMMIT 3                                                 
053800*        7400-PROCESS-ARVL-DTE-CSR                                        
053900*             DO COMMIT 4                                                 
053910*        7500-PROCESS-CNPU-DTE-CSR                                        
053920*             DO COMMIT 5                                                 
053930*        7600-PROCESS-CSTM-FILD-CSR                                       
053940*             DO COMMIT 6                                                 
054000*      -----------------------------------                                
054100* NOTE: THIS PROGRAM DOES HAVE CHECKPOINT RESTART. JUST START THE         
054200*       JOB AGAIN. **********************************************         
054300*                  ** TEST-ABEND WAS LEFT IN PLACE. JUST UNCOMMENT        
054400*                  ** THE PERFORM TO TEST CHECKPOINT RESTART AFTER        
054500*                  ** A COMMIT.                                           
054600******************************************************************        
054700 2000-PROCESS-CURSORS.                                                    
054800                                                                          
054900      PERFORM 6500-GET-CHECKPOINT-CNTL.                                   
055000      MOVE PV-CKPT-STAT-CODE             TO  PS-RUN-TYPE-SW.              
055100                                                                          
055200      IF PS-RESTART-RUN                                                   
055300         PERFORM 6550-CHECKPOINT-RESTART                                  
055400         PERFORM 2010-DETERMINE-RESTART-POINT                             
055500      ELSE                                                                
055600         MOVE PC-RUN-IN-PROGRESS-CODE    TO PV-CKPT-STAT-CODE             
055700         PERFORM 6570-UPDATE-TCKRSTCNTL                                   
055800         PERFORM 2100-INITIALIZE-ACCUMULATORS                             
055900         PERFORM 2200-INITIALIZE-TCKRSTINF                                
056000         PERFORM 7100-PROCESS-XFCT-CSR                                    
056100         PERFORM 7200-PROCESS-EST-SAIL-DTE-CSR                            
056200****     PERFORM 7300-PROCESS-BKG-DELY-DTE-CSR                            
056300         PERFORM 7400-PROCESS-ARVL-DTE-CSR                                
056310         PERFORM 7500-PROCESS-CNPU-DTE-CSR                                
056320****     PERFORM 7600-PROCESS-CSTM-FILD-CSR                               
056400                                                                          
056500         MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE                  
056600         PERFORM 6570-UPDATE-TCKRSTCNTL                                   
056700      END-IF.                                                             
056800                                                                          
056900 EJECT                                                                    
057000                                                                          
057100******************************************************************        
057200* DETERMINE THE RESTART POINT. IF PV-TOTAL-COMMIT = 1, THEN      *        
057300* THE XFCT CSR FINISHED PROCESSING (PARA 7100-). THE RESTART     *        
057400* PROCESSING WOULD BEGIN WITH PARA 7200- FOR THE NEXT CURSOR.    *        
057500* THE DATE RANGES WOULD HAVE BEEN DETERMINED AGAIN BEFORE THIS   *        
057600* POINT. PROCESSING WOULD CONTINUE THROUGH THE LAST CURSOR AND   *        
057700* CONTINUE ON TO THE EOJ AND STOP RUN ETC.                       *        
057800******************************************************************        
057900 2010-DETERMINE-RESTART-POINT.                                            
058000                                                                          
058100        EVALUATE PV-TOTAL-COMMITS-TAKEN                                   
058200           WHEN PC-0                                                      
058300                PERFORM 2020-RESTART-AFTER-NO-COMMITS                     
058400           WHEN PC-1                                                      
058500                PERFORM 2030-RESTART-AFTER-1-COMMIT                       
058600           WHEN PC-2                                                      
058700                PERFORM 2040-RESTART-AFTER-2-COMMITS                      
058800           WHEN PC-3                                                      
058900                PERFORM 2050-RESTART-AFTER-3-COMMITS                      
058910           WHEN PC-4                                                      
058920                PERFORM 2060-RESTART-AFTER-4-COMMITS                      
058930           WHEN PC-5                                                      
058940                PERFORM 2070-RESTART-AFTER-5-COMMITS                      
059000           WHEN PC-6                                                      
059100                CONTINUE                                                  
059200        END-EVALUATE.                                                     
059300                                                                          
059400 EJECT                                                                    
059500                                                                          
059600******************************************************************        
059610* THIS IS ESSENTIALLY THE SAME AS PARA 2000- WITHOUT THE CODE THAT        
059620* INTERROGATES THE PS-RESTART-RUN-SW.                                     
059621******************************************************************        
059622 2020-RESTART-AFTER-NO-COMMITS.                                           
059623                                                                          
059624      DISPLAY '                                           '.              
059625      DISPLAY 'TMKUT620 RESTARTED AFTER 0 COMMITS OUT OF 4'.              
059626      DISPLAY '                                           '.              
059627      PERFORM 7100-PROCESS-XFCT-CSR.                                      
059628      PERFORM 7200-PROCESS-EST-SAIL-DTE-CSR.                              
059629****  PERFORM 7300-PROCESS-BKG-DELY-DTE-CSR.                              
059630      PERFORM 7400-PROCESS-ARVL-DTE-CSR.                                  
059631      PERFORM 7500-PROCESS-CNPU-DTE-CSR.                                  
059632*     PERFORM 7600-PROCESS-CSTM-FILD-CSR.                                 
059640                                                                          
059641      MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE.                    
059642      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
059643                                                                          
059644 EJECT                                                                    
059645                                                                          
059646******************************************************************        
059647* THIS IS ESSENTIALLY THE SAME AS PARA 2000- WITHOUT THE CODE THAT        
059648* INTERROGATES THE PS-RESTART-RUN-SW AND WITHOUT PARA 7100-               
059649******************************************************************        
059650 2030-RESTART-AFTER-1-COMMIT.                                             
059651                                                                          
059652      DISPLAY '                                           '.              
059653      DISPLAY 'TMKUT620 RESTARTED AFTER 1 COMMIT OUT OF 6 '.              
059654      DISPLAY '                                           '.              
059655      PERFORM 7200-PROCESS-EST-SAIL-DTE-CSR.                              
059656****  PERFORM 7300-PROCESS-BKG-DELY-DTE-CSR.                              
059657      PERFORM 7400-PROCESS-ARVL-DTE-CSR.                                  
059658      PERFORM 7500-PROCESS-CNPU-DTE-CSR.                                  
059659****  PERFORM 7600-PROCESS-CSTM-FILD-CSR.                                 
059660                                                                          
059661      MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE.                    
059662      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
059663                                                                          
059664 EJECT                                                                    
059665                                                                          
059666******************************************************************        
059667* THIS IS ESSENTIALLY THE SAME AS PARA 2000- WITHOUT THE CODE THAT        
059668* INTERROGATES THE PS-RESTART-RUN-SW AND WITHOUT PARA 7100-, 7200-        
059669******************************************************************        
059670 2040-RESTART-AFTER-2-COMMITS.                                            
059671                                                                          
059672      DISPLAY '                                           '.              
059680      DISPLAY 'TMKUT620 RESTARTED AFTER 2 COMMITS OUT OF 6 '.             
059690      DISPLAY '                                           '.              
059691      PERFORM 7300-PROCESS-BKG-DELY-DTE-CSR.                              
059692      PERFORM 7400-PROCESS-ARVL-DTE-CSR.                                  
059693      PERFORM 7500-PROCESS-CNPU-DTE-CSR.                                  
059694****  PERFORM 7600-PROCESS-CSTM-FILD-CSR.                                 
059695                                                                          
059696      MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE.                    
059697      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
059698                                                                          
059699 EJECT                                                                    
059700                                                                          
059701******************************************************************        
059702* THIS IS ESSENTIALLY THE SAME AS PARA 2000- WITHOUT THE CODE THAT        
059703* INTERROGATES THE PS-RESTART-RUN-SW AND WITHOUT PARA 7100-, 7200-        
059704* AND 7300-                                                               
059705******************************************************************        
059706 2050-RESTART-AFTER-3-COMMITS.                                            
059707                                                                          
059708      DISPLAY '                                           '.              
059709      DISPLAY 'TMKUT620 RESTARTED AFTER 3 COMMITS OUT OF 6 '.             
059710      DISPLAY '                                           '.              
059711      PERFORM 7400-PROCESS-ARVL-DTE-CSR.                                  
059712      PERFORM 7500-PROCESS-CNPU-DTE-CSR.                                  
059713****  PERFORM 7600-PROCESS-CSTM-FILD-CSR.                                 
059714                                                                          
059715      MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE.                    
059716      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
059717                                                                          
059718 EJECT                                                                    
059719                                                                          
059720******************************************************************        
059721* THIS IS ESSENTIALLY THE SAME AS PARA 2000- WITHOUT THE CODE THAT        
059722* INTERROGATES THE PS-RESTART-RUN-SW AND WITHOUT PARA 7100-, 7200-        
059723* AND 7300-                                                               
059724******************************************************************        
059725 2060-RESTART-AFTER-4-COMMITS.                                            
059726                                                                          
059727      DISPLAY '                                           '.              
059728      DISPLAY 'TMKUT620 RESTARTED AFTER 4 COMMITS OUT OF 5 '.             
059729      DISPLAY '                                           '.              
059731      PERFORM 7500-PROCESS-CNPU-DTE-CSR.                                  
059732****  PERFORM 7600-PROCESS-CSTM-FILD-CSR.                                 
059733                                                                          
059734      MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE.                    
059735      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
059736                                                                          
059737 EJECT                                                                    
059738                                                                          
059739******************************************************************        
059740* THIS IS ESSENTIALLY THE SAME AS PARA 2000- WITHOUT THE CODE THAT        
059741* INTERROGATES THE PS-RESTART-RUN-SW AND WITHOUT PARA 7100-, 7200-        
059742* AND 7300-                                                               
059743******************************************************************        
059744 2070-RESTART-AFTER-5-COMMITS.                                            
059745                                                                          
059746      DISPLAY '                                           '.              
059747      DISPLAY 'TMKUT620 RESTARTED AFTER 5 COMMITS OUT OF 6 '.             
059748      DISPLAY '                                           '.              
059750****  PERFORM 7600-PROCESS-CSTM-FILD-CSR.                                 
059751                                                                          
059752      MOVE PC-RUN-COMPLETE-CODE  TO PV-CKPT-STAT-CODE.                    
059753      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
059754                                                                          
059755 EJECT                                                                    
059756                                                                          
059757******************************************************************        
059758* THIS WILL INITIALIZE THE PROGRAM ACCUMULATORS WHEN THE PROGRAM          
059759* IS BEGINNING A NORMAL RUN. THIS PARAGRAPH WILL NOT BE EXECUTED          
059760* IF THE PROGRAM IS BEING RESTARTED.                                      
059761******************************************************************        
059762 2100-INITIALIZE-ACCUMULATORS.                                            
059763                                                                          
059764      INITIALIZE  PA-XFCT-INSERTS                                         
059765                  PA-SF-SOURCES                                           
059766                  PA-LF-SOURCES                                           
059767                  PA-BKG-DELY-INSERTS                                     
059768                  PA-BD-SOURCES                                           
059769                  PA-EST-SAIL-INSERTS                                     
059770                  PA-SD-SOURCES                                           
059771                  PA-ARVL-INSERTS                                         
059772                  PA-CNTK-INSERTS                                         
059773                  PA-CSTM-INSERTS                                         
059774                  PA-AR-SOURCES                                           
059775                  PA-CN-SOURCES                                           
059776                  PA-CS-SOURCES                                           
059777                  PA-TOTAL-TOUTTM1-INSERTS.                               
059778                                                                          
059779 EJECT                                                                    
059780                                                                          
059781******************************************************************        
059782* THIS WILL INITIALIZE THE WORKING STORAGE DESC TEXT THAT IS              
059783* UPDATED DURING A NORMAL PROGRAM RUN AND USED TO RESTART IN CASE         
059784* OF AN ABEND. THIS PARAGRAPH IS ONLY EXECUTED DURING A NORMAL RUN        
059785******************************************************************        
059786 2200-INITIALIZE-TCKRSTINF.                                               
059787                                                                          
059788      MOVE SPACES      TO PV-CKPT-RESTART-INFO.                           
059789      PERFORM 6580-UPDATE-TCKRSTINF.                                      
059790                                                                          
059791 EJECT                                                                    
059792                                                                          
059793******************************************************************        
059794* DETERMINE THE DATES WHICH ARE A SPECIFIC (AS PER TIMCNTL) NBR  *        
059795* OF DAYS BEFORE AND AFTER THE CURRENT DATE. REFERRED TO IN THE  *        
059796* DOCUMENTATION AS THE 'XFCT DATE RANGE'. THIS PARTICULAR        *        
059797* RANGE IS USED FOR THE XFCT_CSR.                                *        
059798******************************************************************        
059799 6000-SELECT-FOR-DTE-RANGES.                                              
059800                                                                          
059900     PERFORM                                                              
060000         WITH TEST AFTER                                                  
060100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
060200         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
060300                 SQLCODE = ZERO                     OR                    
060400                 SQLCODE = +100                                           
060500                                                                          
060600     EXEC SQL                                                             
060700         SELECT CURRENT DATE                                              
060800              , TRBL_BEF_DAY_QTY                                          
060900              , TRBL_AFT_DAY_QTY                                          
061000              , IMPRT_BEF_DAY_QTY                                         
061100              , IMPRT_AFT_DAY_QTY                                         
061200          INTO  :PV-CURRENT-DATE                                          
061300              , :IMCNTL-TRBL-BEF-DAY-QTY                                  
061400              , :IMCNTL-TRBL-AFT-DAY-QTY                                  
061500              , :IMCNTL-IMPRT-BEF-DAY-QTY                                 
061600              , :IMCNTL-IMPRT-AFT-DAY-QTY                                 
061700          FROM TIMCNTL                                                    
061800     END-EXEC                                                             
061900                                                                          
062000         EVALUATE TRUE                                                    
062100             WHEN SQLCODE = ZERO                                          
062200                 CONTINUE                                                 
062300             WHEN SQLCODE = +100                                          
062400             WHEN SQLCODE = -904                                          
062500             WHEN SQLCODE = -913                                          
062600             WHEN SQLWARN0 NOT EQUAL SPACE                                
062700             WHEN SQLCODE NOT EQUAL ZERO                                  
062800              DISPLAY '**************************************'            
062900              DISPLAY '** ABEND                            **'            
063000              DISPLAY '** PROGRAM = TMKUT620               **'            
063100              DISPLAY '* PARAGRAPH = 6000-SELECT-FOR-DATE-RANGES'         
063200              DISPLAY '** SELECT  - TIMCNTL                  '            
063300              DISPLAY '**************************************'            
063400              PERFORM 9100-SQL-ABEND                                      
063500         END-EVALUATE                                                     
063600     END-PERFORM.                                                         
063700                                                                          
063800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
063900         (SQLCODE NOT = ZERO AND SQLCODE NOT = +100)                      
064000         DISPLAY '****************************************'               
064100         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'               
064200         DISPLAY '** SELECT FROM TIMCNTL                **'               
064300         DISPLAY '** PARAGRAPH = 6000-SELECT-FOR-DATE-RANGES'             
064400         DISPLAY '****************************************'               
064500         PERFORM 9100-SQL-ABEND                                           
064600     END-IF.                                                              
064700                                                                          
064800 EJECT                                                                    
064900                                                                          
065000******************************************************************        
065100* DETERMINE THE DATES WHICH ARE A SPECIFIC (AS PER TIMCNTL) NBR  *        
065110* OF DAYS BEFORE THE CURRENT DATE. REFERRED TO IN THE            *        
065120* DOCUMENTATION AS THE 'XFCT DATE RANGE'. THIS PARTICULAR VARI-  *        
065130* IABLE IS THE BEGINING OF THE RANGE USED FOR THE XFCT_CSR.      *        
065140* KOHL'S CALENDAR ROUTINE WILL BE CALLED TO DECREMENT            *        
065150* THE SPECIFIC TIMCNTL NUMBER OF DAYS FROM DB2 CURRENT DATE      *        
065160******************************************************************        
065170 6005-CALCULATE-XFCT-BEF-DTE.                                             
065180                                                                          
065181     INITIALIZE DPG51                                                     
065182                DPG52                                                     
065183                DPG53                                                     
065184                DPG54                                                     
065185                DPG55                                                     
065186                DPG56.                                                    
065187     SET DPG51-DECREMENT-DATE       TO TRUE.                              
065188     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                              
065189     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                              
065190     MOVE PV-CURRENT-DATE           TO DPG52-LK-DATE-INPUT.               
065191     MOVE IMCNTL-TRBL-BEF-DAY-QTY   TO DPG51-INCR-DECR-DAYS-9.            
065192     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
065193                                             DPG53 DPG54                  
065194                                             DPG55 DPG56.                 
065195                                                                          
065196     EVALUATE TRUE                                                        
065197         WHEN DPG54-NO-ERROR                                              
065198             MOVE DPG55-DB2-ISO-DATE (1:4)  TO                            
065199                  PV-DATE-BEF-XFCT   (1:4)                                
065200             MOVE PC-DASH                   TO                            
065201                  PV-DATE-BEF-XFCT   (5:1)                                
065202             MOVE DPG55-DB2-ISO-DATE (5:2)  TO                            
065203                  PV-DATE-BEF-XFCT   (6:2)                                
065204             MOVE PC-DASH                   TO                            
065205                  PV-DATE-BEF-XFCT   (8:1)                                
065206             MOVE DPG55-DB2-ISO-DATE (7:2)  TO                            
065207                  PV-DATE-BEF-XFCT   (9:2)                                
065208                                                                          
065209         WHEN OTHER                                                       
065210             DISPLAY '*******************************************'        
065211             DISPLAY '** ABEND                                 **'        
065212             DISPLAY '** PROGRAM = TMKUT620 -- CALLED MODULE   **'        
065213             DISPLAY '** CALL  =  DP500-KOHLS-CALENDAR-ROUTINE **'        
065214             DISPLAY '** PARA- =  6005-CALCULATE-XFCT-BEF-DTE  **'        
065215             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:       '        
065216             DISPLAY     DPG54-ERROR-MESSAGE                              
065217             DISPLAY '*******************************************'        
065218             MOVE +4003 TO ABEND-CODE                                     
065219             CALL 'ILBOABN0' USING ABEND-CODE                             
065220                                                                          
065221     END-EVALUATE.                                                        
065222                                                                          
065223 EJECT                                                                    
065224                                                                          
065225******************************************************************        
065226* DETERMINE THE DATES WHICH ARE A SPECIFIC (AS PER TIMCNTL) NBR  *        
065227* OF DAYS AFTER THE CURRENT DATE. REFERRED TO IN THE             *        
065228* DOCUMENTATION AS THE 'XFCT DATE RANGE'. THIS PARTICULAR VARI-  *        
065229* IABLE IS THE END OF THE RANGE USED FOR THE XFCT_CSR.           *        
065230* KOHL'S CALENDAR ROUTINE WILL BE CALLED TO INCREMENT            *        
065231* THE SPECIFIC TIMCNTL NUMBER OF DAYS FROM DB2 CURRENT DATE      *        
065232******************************************************************        
065233 6010-CALCULATE-XFCT-AFT-DTE.                                             
065234                                                                          
065235     INITIALIZE DPG51                                                     
065236                DPG52                                                     
065237                DPG53                                                     
065238                DPG54                                                     
065239                DPG55                                                     
065240                DPG56.                                                    
065241     SET DPG51-INCREMENT-DATE       TO TRUE.                              
065242     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                              
065243     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                              
065244     MOVE PV-CURRENT-DATE           TO DPG52-LK-DATE-INPUT.               
065245     MOVE IMCNTL-TRBL-AFT-DAY-QTY   TO DPG51-INCR-DECR-DAYS-9.            
065246     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
065247                                             DPG53 DPG54                  
065248                                             DPG55 DPG56.                 
065249                                                                          
065250     EVALUATE TRUE                                                        
065251         WHEN DPG54-NO-ERROR                                              
065252             MOVE DPG55-DB2-ISO-DATE (1:4)  TO                            
065253                  PV-DATE-AFT-XFCT   (1:4)                                
065254             MOVE PC-DASH                   TO                            
065255                  PV-DATE-AFT-XFCT   (5:1)                                
065256             MOVE DPG55-DB2-ISO-DATE (5:2)  TO                            
065257                  PV-DATE-AFT-XFCT   (6:2)                                
065258             MOVE PC-DASH                   TO                            
065259                  PV-DATE-AFT-XFCT   (8:1)                                
065260             MOVE DPG55-DB2-ISO-DATE (7:2)  TO                            
065261                  PV-DATE-AFT-XFCT   (9:2)                                
065262                                                                          
065263         WHEN OTHER                                                       
065264             DISPLAY '*******************************************'        
065265             DISPLAY '** ABEND                                 **'        
065266             DISPLAY '** PROGRAM = TMKUT620 -- CALLED MODULE   **'        
065267             DISPLAY '** CALL  =  DP500-KOHLS-CALENDAR-ROUTINE **'        
065268             DISPLAY '** PARA- =  6010-CALCULATE-XFCT-AFT-DTE  **'        
065269             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:       '        
065270             DISPLAY     DPG54-ERROR-MESSAGE                              
065271             DISPLAY '*******************************************'        
065272             MOVE +4003 TO ABEND-CODE                                     
065273             CALL 'ILBOABN0' USING ABEND-CODE                             
065274                                                                          
065275     END-EVALUATE.                                                        
065276                                                                          
065277 EJECT                                                                    
065278                                                                          
065279******************************************************************        
065280* DETERMINE THE DATES WHICH ARE A SPECIFIC (AS PER TIMCNTL) NBR  *        
065281* OF DAYS BEFORE THE CURRENT DATE. REFERRED TO IN THE            *        
065282* DOCUMENTATION AS THE 'IMPRT DATE RANGE'. THIS PARTICULAR VARI- *        
065283* IABLE IS THE BEGINING OF THE RANGE USED FOR THE EST_SAIL_DTE,  *        
065284* BKG_DELY_DTE AND ARVL_DTE CURSORS.                             *        
065285* KOHL'S CALENDAR ROUTINE WILL BE CALLED TO DECREMENT            *        
065286* THE SPECIFIC TIMCNTL NUMBER OF DAYS FROM DB2 CURRENT DATE      *        
065287******************************************************************        
065288 6015-CALCULATE-IMPRT-BEF-DTE.                                            
065289                                                                          
065290     INITIALIZE DPG51                                                     
065300                DPG52                                                     
065400                DPG53                                                     
065500                DPG54                                                     
065600                DPG55                                                     
065700                DPG56.                                                    
065800     SET DPG51-DECREMENT-DATE       TO TRUE.                              
065900     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                              
066000     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                              
066100     MOVE PV-CURRENT-DATE           TO DPG52-LK-DATE-INPUT.               
066200     MOVE IMCNTL-IMPRT-BEF-DAY-QTY  TO DPG51-INCR-DECR-DAYS-9.            
066300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
066400                                             DPG53 DPG54                  
066500                                             DPG55 DPG56.                 
066600                                                                          
066700     EVALUATE TRUE                                                        
066800         WHEN DPG54-NO-ERROR                                              
066900             MOVE DPG55-DB2-ISO-DATE (1:4)  TO                            
067000                  PV-DATE-BEF-IMPRT  (1:4)                                
067100             MOVE PC-DASH                   TO                            
067110                  PV-DATE-BEF-IMPRT  (5:1)                                
067120             MOVE DPG55-DB2-ISO-DATE (5:2)  TO                            
067130                  PV-DATE-BEF-IMPRT  (6:2)                                
067140             MOVE PC-DASH                   TO                            
067150                  PV-DATE-BEF-IMPRT  (8:1)                                
067160             MOVE DPG55-DB2-ISO-DATE (7:2)  TO                            
067170                  PV-DATE-BEF-IMPRT  (9:2)                                
067180                                                                          
067190         WHEN OTHER                                                       
067200             DISPLAY '*******************************************'        
067300             DISPLAY '** ABEND                                 **'        
067400             DISPLAY '** PROGRAM = TMKUT620 -- CALLED MODULE   **'        
067500             DISPLAY '** CALL  =  DP500-KOHLS-CALENDAR-ROUTINE **'        
067600             DISPLAY '** PARA- =  6015-CALCULATE-IMPRT-BEF-DTE **'        
067700             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:       '        
067800             DISPLAY     DPG54-ERROR-MESSAGE                              
067900             DISPLAY '*******************************************'        
068000             MOVE +4003 TO ABEND-CODE                                     
068100             CALL 'ILBOABN0' USING ABEND-CODE                             
068200                                                                          
068300     END-EVALUATE.                                                        
068400                                                                          
068500 EJECT                                                                    
068600                                                                          
068700******************************************************************        
068800* DETERMINE THE DATES WHICH ARE A SPECIFIC (AS PER TIMCNTL) NBR  *        
068900* OF DAYS AFTER THE CURRENT DATE. REFERRED TO IN THE             *        
069000* DOCUMENTATION AS THE 'IMPRT DATE RANGE'. THIS PARTICULAR VARI- *        
069100* IABLE IS THE END OF THE RANGE USED FOR THE EST_SAIL_DTE,       *        
069200* BKG_DELY_DTE AND ARVL_DTE CURSORS.                             *        
069300* KOHL'S CALENDAR ROUTINE WILL BE CALLED TO INCREMENT            *        
069400* THE SPECIFIC TIMCNTL NUMBER OF DAYS FROM DB2 CURRENT DATE      *        
069500******************************************************************        
069600 6020-CALCULATE-IMPRT-AFT-DTE.                                            
069700                                                                          
069800     INITIALIZE DPG51                                                     
069900                DPG52                                                     
070000                DPG53                                                     
070100                DPG54                                                     
070200                DPG55                                                     
070300                DPG56.                                                    
070400     SET DPG51-INCREMENT-DATE       TO TRUE.                              
070500     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                              
070600     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                              
070700     MOVE PV-CURRENT-DATE           TO DPG52-LK-DATE-INPUT.               
070710     MOVE IMCNTL-IMPRT-AFT-DAY-QTY  TO DPG51-INCR-DECR-DAYS-9.            
070720     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
070730                                             DPG53 DPG54                  
070740                                             DPG55 DPG56.                 
070750                                                                          
070760     EVALUATE TRUE                                                        
070770         WHEN DPG54-NO-ERROR                                              
070780             MOVE DPG55-DB2-ISO-DATE (1:4)  TO                            
070790                  PV-DATE-AFT-IMPRT  (1:4)                                
070791             MOVE PC-DASH                   TO                            
070792                  PV-DATE-AFT-IMPRT  (5:1)                                
070793             MOVE DPG55-DB2-ISO-DATE (5:2)  TO                            
070794                  PV-DATE-AFT-IMPRT  (6:2)                                
070795             MOVE PC-DASH                   TO                            
070796                  PV-DATE-AFT-IMPRT  (8:1)                                
070797             MOVE DPG55-DB2-ISO-DATE (7:2)  TO                            
070798                  PV-DATE-AFT-IMPRT  (9:2)                                
070799                                                                          
070800         WHEN OTHER                                                       
070801             DISPLAY '*******************************************'        
070802             DISPLAY '** ABEND                                 **'        
070803             DISPLAY '** PROGRAM = TMKUT620 -- CALLED MODULE   **'        
070804             DISPLAY '** CALL  =  DP500-KOHLS-CALENDAR-ROUTINE **'        
070805             DISPLAY '** PARA- =  6020-CALCULATE-IMPRT-AFT-DTE **'        
070806             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:       '        
070807             DISPLAY     DPG54-ERROR-MESSAGE                              
070808             DISPLAY '*******************************************'        
070809             MOVE +4003 TO ABEND-CODE                                     
070810             CALL 'ILBOABN0' USING ABEND-CODE                             
070811                                                                          
070812     END-EVALUATE.                                                        
070813                                                                          
070814 EJECT                                                                    
070815                                                                          
070816******************************************************************        
070817* SELECT CHECKPOINT RESTART CONTROL VALUE TO SEE IF THIS RUN     *        
070818* IS NORMAL (0) OR A RESTART (9).                                *        
070819******************************************************************        
070820 6500-GET-CHECKPOINT-CNTL.                                                
070830                                                                          
070840     EXEC SQL                                                             
070850      SELECT CKPT_STAT_CODE                                               
070860       INTO :PV-CKPT-STAT-CODE                                            
070870       FROM TCKRSTCNTL                                                    
070880       WHERE PLAN_NAME = :PC-CURRENT-PROGRAM-NAME                         
070890     END-EXEC.                                                            
070900                                                                          
071000                                                                          
071100     EVALUATE TRUE                                                        
071200         WHEN SQLWARN0 NOT EQUAL SPACE                                    
071300         WHEN SQLCODE NOT EQUAL ZERO                                      
071400             DISPLAY '******************************************'         
071500             DISPLAY '** ABEND                                **'         
071600             DISPLAY '** PROGRAM = TMKUT620                   **'         
071700             DISPLAY '** PARAGRAPH = 6500-GET-CHECKPOINT-CNTL **'         
071800             DISPLAY '** CHECKING IF RUN IS NORMAL OR RESTART **'         
071900             DISPLAY '******************************************'         
072000             PERFORM 9100-SQL-ABEND                                       
072100     END-EVALUATE.                                                        
072200                                                                          
072300 EJECT                                                                    
072400                                                                          
072500******************************************************************        
072600* CHECKPOINT-RESTART                                             *        
072700* RETRIEVE THE WORKING STORAGE FIELDS FROM THE DB2 TABLE, THEN   *        
072800* MOVE THE STORED ACCUMULATOR VALUES BACK TO WORKING STORAGE     *        
072900* BEFORE THE PROCESSING FOR THE RESTART CONTINUES. THIS IS DONE  *        
073000* SO THE REPORT STATISTICS IN THE SYSOUT ARE ACCURATE AFTER A    *        
073100* RESTART IS DONE, OTHERWISE THE SYSOUT WOULD ONLY REFLECT WHAT  *        
073200* WAS PROCESSED FROM THE RESTART POINT.                          *        
073300******************************************************************        
073400 6550-CHECKPOINT-RESTART.                                                 
073500                                                                          
073600      PERFORM 6560-GET-CHECKPOINT-WK-STORG.                               
073700      MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO PV-CKPT-RESTART-INFO.         
073800      MOVE PV-CKPT-SF-SRC             TO PA-SF-SOURCES.                   
073900      MOVE PV-CKPT-LF-SRC             TO PA-LF-SOURCES.                   
074000      MOVE PV-CKPT-XFCT-INSERTS       TO PA-XFCT-INSERTS.                 
074100      MOVE PV-CKPT-BD-SRC             TO PA-BD-SOURCES.                   
074200      MOVE PV-CKPT-BKG-INSERTS        TO PA-BKG-DELY-INSERTS.             
074210      MOVE PV-CKPT-SD-SRC             TO PA-SD-SOURCES.                   
074220      MOVE PV-CKPT-SAIL-INSERTS       TO PA-EST-SAIL-INSERTS.             
074230      MOVE PV-CKPT-AR-SRC             TO PA-AR-SOURCES.                   
074240      MOVE PV-CKPT-ARVL-INSERTS       TO PA-ARVL-INSERTS.                 
074241      MOVE PV-CKPT-CN-SRC             TO PA-CN-SOURCES.                   
074242      MOVE PV-CKPT-CNTK-INSERTS       TO PA-CNTK-INSERTS.                 
074243      MOVE PV-CKPT-CS-SRC             TO PA-CS-SOURCES.                   
074244      MOVE PV-CKPT-CSTM-INSERTS       TO PA-CSTM-INSERTS.                 
074250      MOVE PV-CKPT-TOTAL-EXTRACTS     TO PA-TOTAL-TOUTTM1-INSERTS.        
074260                                                                          
074270     DISPLAY '***********************************************'.           
074280     DISPLAY '** TMKUT620 CHECKPOINT RESTART               **'.           
074290     DISPLAY '** LAST CURSOR PROCESSED :' PV-LAST-CSR-PROCESSED.          
074300     DISPLAY '** TOTAL COMMITS TAKEN   :' PV-TOTAL-COMMITS-TAKEN.         
074400     DISPLAY '***********************************************'.           
074500                                                                          
074600 EJECT                                                                    
074700                                                                          
074800******************************************************************        
074900*    SELECT CHECKPOINT RESTART WORKING STORAGE INFORMATION.      *        
075000*    THIS FIELD ON THE DC;GEN IS LVC. IT HAS A LENGTH OF 4022    *        
075100*    AND MAY BE VARIABLE. IT HOLDS CHARACTER OR NUMERIC DATA.    *        
075200******************************************************************        
075300 6560-GET-CHECKPOINT-WK-STORG.                                            
075400                                                                          
075500     EXEC SQL                                                             
075600      SELECT WORK_STRG_DESC                                               
075700       INTO :TCKRSTINF-WORK-STRG-DESC                                     
075800       FROM TCKRSTINF                                                     
075900      WHERE PLAN_NAME = :PC-CURRENT-PROGRAM-NAME                          
076000     END-EXEC.                                                            
076100                                                                          
076200     EVALUATE TRUE                                                        
076300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
076400         WHEN SQLCODE NOT EQUAL ZERO                                      
076500            DISPLAY '*******************************************'         
076600            DISPLAY '** ABEND                                 **'         
076700            DISPLAY '** PROGRAM = TMKUT620                    **'         
076800            DISPLAY '** PARAGRAPH = 6560-GET-CHECKPOINT-WK-STORG'         
076900            DISPLAY '** GETTING RESTART WORKING STORAGE INFO  **'         
077000            DISPLAY '*******************************************'         
077100            PERFORM 9100-SQL-ABEND                                        
077200     END-EVALUATE.                                                        
077300                                                                          
077400 EJECT                                                                    
077500                                                                          
077600******************************************************************        
077700*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *        
077800*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *        
077900******************************************************************        
078000 6570-UPDATE-TCKRSTCNTL.                                                  
078100                                                                          
078200     EXEC SQL                                                             
078300       UPDATE TCKRSTCNTL                                                  
078400       SET CKPT_STAT_CODE   = :PV-CKPT-STAT-CODE                          
078500       WHERE PLAN_NAME      = :PC-CURRENT-PROGRAM-NAME                    
078600     END-EXEC.                                                            
078700                                                                          
078800     EVALUATE TRUE                                                        
078900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
079000         WHEN SQLCODE NOT EQUAL ZERO                                      
079100             DISPLAY '*******************************************'        
079200             DISPLAY '** ABEND                                 **'        
079300             DISPLAY '** PROGRAM = TMKUT620                    **'        
079400             DISPLAY '** PARAGRAPH = 6570-UPDATE-TCKRSTCNTL    **'        
079500             DISPLAY '** GETTING RESTART INFORMATION AFTER ABEND*'        
079600             DISPLAY '*******************************************'        
079700             PERFORM 9100-SQL-ABEND                                       
079800     END-EVALUATE.                                                        
079900                                                                          
080000 EJECT                                                                    
080100                                                                          
080200******************************************************************        
080300*  UPDATES THE CHECKPOINT RESTART INFORMATION TABLE.  THIS       *        
080400*  INFORMATION WOULD BE USED TO RESTART JOB IN CASE OF AN ABEND  *        
080500******************************************************************        
080600 6580-UPDATE-TCKRSTINF.                                                   
080700                                                                          
080800     MOVE PV-CKPT-RESTART-INFO TO TCKRSTINF-WORK-STRG-DESC-TEXT.          
080900     MOVE 4022                 TO TCKRSTINF-WORK-STRG-DESC-LEN.           
081000                                                                          
081100     EXEC SQL                                                             
081200        UPDATE TCKRSTINF                                                  
081300         SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC                 
081400         WHERE PLAN_NAME      = :PC-CURRENT-PROGRAM-NAME                  
081500     END-EXEC.                                                            
081600                                                                          
081700     EVALUATE TRUE                                                        
081800         WHEN SQLCODE EQUAL ZERO                                          
081900            CONTINUE                                                      
082000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
082100         WHEN SQLCODE NOT EQUAL ZERO                                      
082200             DISPLAY '*****************************************'          
082300             DISPLAY '** ABEND                               **'          
082400             DISPLAY '** PROGRAM = TMKUT620                  **'          
082500             DISPLAY '** PARAGRAPH = 6580-UPDATE-TCKRSTINF   **'          
082600             DISPLAY '** UNSUCCESSFUL UPDATE TCKRSTINF       **'          
082700             DISPLAY '*****************************************'          
082800             PERFORM 9100-SQL-ABEND                                       
082900     END-EVALUATE.                                                        
083000                                                                          
083100 EJECT                                                                    
083200                                                                          
083300******************************************************************        
083400* EXECUTES AN SQL COMMIT AFTER EACH CURSOR HAS BEEN PROCESSED.            
083500******************************************************************        
083600 6600-COMMIT.                                                             
083700                                                                          
083800     EXEC SQL                                                             
083900         COMMIT                                                           
084000     END-EXEC.                                                            
084100                                                                          
084200     EVALUATE TRUE                                                        
084300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
084400         WHEN SQLCODE NOT EQUAL ZERO                                      
084500                                                                          
084600       DISPLAY '********** CHECKPOINT **************************'         
084700       DISPLAY 'LAST CURSOR PROCESSED :' PV-LAST-CSR-PROCESSED            
084800       DISPLAY 'NBR COMMITS TAKEN     :' PV-TOTAL-COMMITS-TAKEN           
084900       DISPLAY '************************************************'         
085000       DISPLAY '****************************'                             
085100       DISPLAY '** ABEND                  **'                             
085200       DISPLAY '** PROGRAM = TMKUT620     **'                             
085300       DISPLAY '** PARAGRAPH = 6600-COMMIT**'                             
085400       DISPLAY '** UNSUCCESSFUL COMMIT    **'                             
085500       DISPLAY '****************************'                             
085600       PERFORM 9100-SQL-ABEND                                             
085700     END-EVALUATE.                                                        
085800 EJECT                                                                    
085900                                                                          
086000******************************************************************        
086100* PERFORMS THE OPEN, FETCH AND CLOSE FUNCTIONS FOR THE XFCT_CSR           
086200* WHICH INCORPORATES EITHER SF OR LF DATA SOURCES.                        
086300******************************************************************        
086400 7100-PROCESS-XFCT-CSR.                                                   
086500                                                                          
086600      SET PS-EOC-XFCT-CSR-NO         TO TRUE.                             
086700                                                                          
086800****  PERFORM 7900-SET-CURRENT-TMST.                                      
086900****  MOVE PV-CURRENT-TMST            TO PV-BEGIN-CSR-TMST.               
087000****                                                                      
087100      PERFORM 7110-OPEN-XFCT-CSR.                                         
087200                                                                          
087300      PERFORM 7120-FETCH-XFCT-CSR                                         
087400        UNTIL PS-EOC-XFCT-CSR.                                            
087500                                                                          
087600      PERFORM 7130-CLOSE-XFCT-CSR.                                        
087700                                                                          
087800****  PERFORM 7900-SET-CURRENT-TMST.                                      
087900****  MOVE PV-CURRENT-TMST            TO PV-END-CSR-TMST.                 
088000****                                                                      
088100****  PERFORM 7910-CALCULATE-ELAPSED-SECONDS.                             
088200****                                                                      
088300****  DISPLAY '____________________________________'.                     
088400****  DISPLAY 'BEGIN CSR TMST : ' PV-BEGIN-CSR-TMST.                      
088500****  DISPLAY 'END   CSR TMST : ' PV-END-CSR-TMST.                        
088600****  DISPLAY 'ELAPSED SECONDS: ' PV-ELAPSED-SECONDS.                     
088700****  DISPLAY '_______ * END OF XFCT CSR * __________'.                   
088800****  DISPLAY '                                    '.                     
088900****                                                                      
089000****  INITIALIZE PV-CURRENT-TMST                                          
089100****             PV-BEGIN-CSR-TMST                                        
089200****             PV-END-CSR-TMST.                                         
089300                                                                          
089400      MOVE PC-RUN-IN-PROGRESS-CODE TO PV-CKPT-STAT-CODE.                  
089500      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
089600                                                                          
089700      MOVE '7100-PROCESS-XFCT-CSR         ' TO                            
089800                PV-LAST-CSR-PROCESSED.                                    
089900      MOVE PC-1                    TO PV-TOTAL-COMMITS-TAKEN.             
090000      MOVE PA-SF-SOURCES           TO PV-CKPT-SF-SRC.                     
090100      MOVE PA-LF-SOURCES           TO PV-CKPT-LF-SRC.                     
090200      MOVE PA-XFCT-INSERTS         TO PV-CKPT-XFCT-INSERTS.               
090300      MOVE PA-BD-SOURCES           TO PV-CKPT-BD-SRC.                     
090400      MOVE PA-BKG-DELY-INSERTS     TO PV-CKPT-BKG-INSERTS.                
090500      MOVE PA-SD-SOURCES           TO PV-CKPT-SD-SRC.                     
090600      MOVE PA-EST-SAIL-INSERTS     TO PV-CKPT-SAIL-INSERTS.               
090700      MOVE PA-AR-SOURCES           TO PV-CKPT-AR-SRC.                     
090800      MOVE PA-ARVL-INSERTS         TO PV-CKPT-ARVL-INSERTS.               
090810      MOVE PA-CN-SOURCES           TO PV-CKPT-CN-SRC.                     
090820      MOVE PA-CNTK-INSERTS         TO PV-CKPT-CNTK-INSERTS.               
090830      MOVE PA-CS-SOURCES           TO PV-CKPT-CS-SRC.                     
090840      MOVE PA-CSTM-INSERTS         TO PV-CKPT-CSTM-INSERTS.               
090900      MOVE PA-TOTAL-TOUTTM1-INSERTS TO PV-CKPT-TOTAL-EXTRACTS.            
091000      DISPLAY '                                            '.             
091100      DISPLAY 'COMMITS TAKEN SO FAR :' PV-TOTAL-COMMITS-TAKEN.            
091200      DISPLAY '                                            '.             
091300                                                                          
091400      PERFORM 6580-UPDATE-TCKRSTINF.                                      
091500      PERFORM 6600-COMMIT.                                                
091600                                                                          
091700 EJECT                                                                    
091800                                                                          
091900******************************************************************        
092000* OPEN XFCT-CSR                                                           
092100******************************************************************        
092200 7110-OPEN-XFCT-CSR.                                                      
092300                                                                          
092400     EXEC SQL                                                             
092500          OPEN XFCT_CSR                                                   
092600     END-EXEC.                                                            
092700                                                                          
092800     EVALUATE TRUE                                                        
092900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
093000         WHEN SQLCODE NOT EQUAL ZERO                                      
093100             DISPLAY '****************************************'           
093200             DISPLAY '** ABEND                              **'           
093300             DISPLAY '** PROGRAM = TMKUT620                 **'           
093400             DISPLAY '** PARAGRAPH = 7110-OPEN-XFCT-CSR     **'           
093500             DISPLAY '****************************************'           
093600             PERFORM 9100-SQL-ABEND                                       
093700     END-EVALUATE.                                                        
093800                                                                          
093900 EJECT                                                                    
094000                                                                          
094100******************************************************************        
094200* FETCH THE PO'S THAT HAVE EITHER A STRT XFCT OR LAST XFCT DATE           
094300* THAT FALLS IN THE XFCT DATE RANGE. THE DATA SOURCE WILL BE              
094400* DETERMINED IF THERE MAY BE MORE THAN ONE. THE COPYBOOK FIELDS           
094500* ARE LOADED, AND AN INSERT TO TOUTTM1 IS PERFORMED.                      
094600* THE RECORD IS ALSO WRITTEN TO A FLAT FILE.                              
094700* COUNTS ARE KEPT FOR THE NBR OF FETCHES FOR EACH CSR, NBR OF PO'S        
094800* ASSIGNED TO EACH DATA SOURCE AND TOTAL TOUTTM1 INSERTS.                 
094900******************************************************************        
095000 7120-FETCH-XFCT-CSR.                                                     
095100                                                                          
095200     EXEC SQL                                                             
095300          FETCH XFCT_CSR                                                  
095400          INTO :PURCHS-PO-NBR                                             
095500              ,:PURCHS-VER-NBR                                            
095600              ,:PLNSHP-VER-NBR                                            
095700              ,:PLNSHP-STRT-FCTRY-DTE                                     
095800              ,:PLNSHP-LAST-FCTRY-DTE                                     
095900              ,:PLNSHP-LAST-UPD-TMST                                      
096000     END-EXEC.                                                            
096100                                                                          
096500     EVALUATE TRUE                                                        
096600         WHEN SQLCODE = +100                                              
096700           IF   PA-XFCT-FETCHES = 0                                       
096800                DISPLAY ' <<< NO FETCHES FOR XFCT >>>'                    
096900                DISPLAY '                                   '             
097000           END-IF                                                         
097100                                                                          
097200           SET  PS-EOC-XFCT-CSR        TO TRUE                            
097300                                                                          
097400         WHEN SQLCODE = ZERO                                              
097500           INITIALIZE                PV-HOLD-CURRENT-PO                   
097600                                                                          
097700           ADD  +1                TO PA-XFCT-FETCHES                      
097800           PERFORM 7800-DETERMINE-DATA-SOURCE                             
097900                                                                          
098000           MOVE PURCHS-PO-NBR         TO TM606-PO-NBR                     
098100                                         PV-HOLD-CURRENT-PO               
098200                                         PV-LAST-PO-PROCESSED             
098300           MOVE PURCHS-VER-NBR        TO TM606-PURCHS-VER-NBR             
098400           MOVE PLNSHP-VER-NBR        TO TM606-PLNSHP-VER-NBR             
098500           MOVE PLNSHP-LAST-UPD-TMST                                      
098600                            TO TM606-PLNSHP-LAST-UPD-TMST                 
098610           MOVE PC-PO       TO TM606-DATA-SOURCE                          
098620                               PV-HOLD-CURRENT-DATA-SRC                   
098700                                                                          
098800           IF PS-DATA-SRC-STRT-XFCT                                       
098900             MOVE PLNSHP-STRT-FCTRY-DTE                                   
099000                               TO TM606-STRT-FCTRY-DTE                    
100100             MOVE PLNSHP-LAST-FCTRY-DTE                                   
100200                               TO TM606-LAST-FCTRY-DTE                    
099020             MOVE PC-SF        TO TM606-EXTR-PRCG-APPL-CDE                
099500             ADD  +1           TO  PA-SF-SOURCES                          
099600             PERFORM 7700-INSERT-TOUTTM1                                  
099700             ADD  +1           TO  PA-XFCT-INSERTS                        
099800           END-IF                                                         
099900                                                                          
100000           IF PS-DATA-SRC-LAST-XFCT                                       
098900             MOVE PLNSHP-STRT-FCTRY-DTE                                   
099000                               TO TM606-STRT-FCTRY-DTE                    
100100             MOVE PLNSHP-LAST-FCTRY-DTE                                   
100200                               TO TM606-LAST-FCTRY-DTE                    
100210             MOVE PC-LF        TO TM606-EXTR-PRCG-APPL-CDE                
100700             ADD  +1           TO PA-LF-SOURCES                           
100800             PERFORM 7700-INSERT-TOUTTM1                                  
100900             ADD  +1           TO PA-XFCT-INSERTS                         
101000           END-IF                                                         
101100                                                                          
101200           INITIALIZE TM606-RECORD                                        
101300                      PV-HOLD-CURRENT-PO                                  
101400                      PV-HOLD-CURRENT-DATA-SRC                            
101410                                                                          
101500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
101600         WHEN SQLCODE NOT EQUAL ZERO                                      
101700             DISPLAY '**************************************'             
101800             DISPLAY '** ABEND                            **'             
101900             DISPLAY 'PROGRAM = TMKUT620                    '             
102000             DISPLAY 'PARAGRAPH = 7120-FETCH-XFCT-CSR       '             
102100             DISPLAY 'CURRENT PO = ' PV-HOLD-CURRENT-PO                   
102200             DISPLAY '**************************************'             
102300             PERFORM 9100-SQL-ABEND                                       
102400     END-EVALUATE.                                                        
102500                                                                          
102600 EJECT                                                                    
102700                                                                          
102800******************************************************************        
102900* CLOSE THE XFCT_CSR                                                      
103000******************************************************************        
103100 7130-CLOSE-XFCT-CSR.                                                     
103200                                                                          
103300     EXEC SQL                                                             
103400         CLOSE XFCT_CSR                                                   
103500     END-EXEC.                                                            
103600                                                                          
103700     EVALUATE TRUE                                                        
103800         WHEN SQLWARN0 NOT EQUAL SPACE                                    
103900         WHEN SQLCODE NOT EQUAL ZERO                                      
104000             DISPLAY '******************************************'         
104100             DISPLAY '** ABEND                                **'         
104200             DISPLAY '** PROGRAM = TMKUT620                   **'         
104300             DISPLAY '** PARAGRAPH = 7130-CLOSE-XFCT-CSR      **'         
104400             DISPLAY '******************************************'         
104500             PERFORM 9100-SQL-ABEND                                       
104600     END-EVALUATE.                                                        
104700                                                                          
104800                                                                          
104900                                                                          
105000 EJECT                                                                    
105100                                                                          
105200******************************************************************        
105300* PERFORMS THE OPEN, FETCH AND CLOSE FUNCTIONS FOR CURSOR                 
105400******************************************************************        
105500 7200-PROCESS-EST-SAIL-DTE-CSR.                                           
105600                                                                          
105700      SET PS-EOC-EST-SAIL-DTE-CSR-NO TO TRUE.                             
105800                                                                          
105900****  PERFORM 7900-SET-CURRENT-TMST.                                      
106000****  MOVE PV-CURRENT-TMST            TO PV-BEGIN-CSR-TMST.               
106100****                                                                      
106200      PERFORM 7210-OPEN-EST-SAIL-DTE-CSR.                                 
106300                                                                          
106400      PERFORM 7220-FETCH-EST-SAIL-DTE-CSR                                 
106500        UNTIL PS-EOC-EST-SAIL-DTE-CSR.                                    
106600                                                                          
106700      PERFORM 7230-CLOSE-EST-SAIL-DTE-CSR.                                
106800                                                                          
106900****  PERFORM 7900-SET-CURRENT-TMST.                                      
107000****  MOVE PV-CURRENT-TMST            TO PV-END-CSR-TMST.                 
107100****                                                                      
107200****  PERFORM 7910-CALCULATE-ELAPSED-SECONDS.                             
107300****                                                                      
107400****  DISPLAY '____________________________________'.                     
107500****  DISPLAY 'BEGIN CSR TMST : ' PV-BEGIN-CSR-TMST.                      
107600****  DISPLAY 'END   CSR TMST : ' PV-END-CSR-TMST.                        
107700****  DISPLAY 'ELAPSED SECONDS: ' PV-ELAPSED-SECONDS.                     
107800****  DISPLAY '____ * END OF EST SAIL DTE CSR * ____'.                    
107900****  DISPLAY '                                    '.                     
108000****                                                                      
108100****  INITIALIZE PV-CURRENT-TMST                                          
108200****             PV-BEGIN-CSR-TMST                                        
108300****             PV-END-CSR-TMST.                                         
108400****                                                                      
108500      MOVE PC-RUN-IN-PROGRESS-CODE TO PV-CKPT-STAT-CODE.                  
108600      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
108700                                                                          
108800      MOVE '7200-PROCESS-EST-SAIL-DTE-CSR ' TO                            
108900               PV-LAST-CSR-PROCESSED.                                     
109000      MOVE PC-2                    TO PV-TOTAL-COMMITS-TAKEN.             
109100      MOVE PA-SF-SOURCES           TO PV-CKPT-SF-SRC.                     
109200      MOVE PA-LF-SOURCES           TO PV-CKPT-LF-SRC.                     
109300      MOVE PA-XFCT-INSERTS         TO PV-CKPT-XFCT-INSERTS.               
109400      MOVE PA-BD-SOURCES           TO PV-CKPT-BD-SRC.                     
109500      MOVE PA-BKG-DELY-INSERTS     TO PV-CKPT-BKG-INSERTS.                
109600      MOVE PA-SD-SOURCES           TO PV-CKPT-SD-SRC.                     
109700      MOVE PA-EST-SAIL-INSERTS     TO PV-CKPT-SAIL-INSERTS.               
109800      MOVE PA-AR-SOURCES           TO PV-CKPT-AR-SRC.                     
109900      MOVE PA-ARVL-INSERTS         TO PV-CKPT-ARVL-INSERTS.               
109910      MOVE PA-CN-SOURCES           TO PV-CKPT-CN-SRC.                     
109920      MOVE PA-CNTK-INSERTS         TO PV-CKPT-CNTK-INSERTS.               
109930      MOVE PA-CS-SOURCES           TO PV-CKPT-CS-SRC.                     
109940      MOVE PA-CSTM-INSERTS         TO PV-CKPT-CSTM-INSERTS.               
110000      MOVE PA-TOTAL-TOUTTM1-INSERTS TO PV-CKPT-TOTAL-EXTRACTS.            
110100      DISPLAY '                                            '.             
110200      DISPLAY 'COMMITS TAKEN SO FAR :' PV-TOTAL-COMMITS-TAKEN.            
110300      DISPLAY '                                            '.             
110400                                                                          
110500      PERFORM 6580-UPDATE-TCKRSTINF.                                      
110600      PERFORM 6600-COMMIT.                                                
110700                                                                          
110800 EJECT                                                                    
110900                                                                          
111000******************************************************************        
111100* OPEN EST_SAIL_DTE_CSR                                                   
111200******************************************************************        
111300 7210-OPEN-EST-SAIL-DTE-CSR.                                              
111400                                                                          
111500     EXEC SQL                                                             
111600          OPEN EST_SAIL_DTE_CSR                                           
111700     END-EXEC.                                                            
111800                                                                          
111900     EVALUATE TRUE                                                        
112000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
112100         WHEN SQLCODE NOT EQUAL ZERO                                      
112200             DISPLAY '****************************************'           
112300             DISPLAY '** ABEND                              **'           
112400             DISPLAY '** PROGRAM = TMKUT620                 **'           
112500             DISPLAY '** PARAGRAPH = 7210-OPEN-EST-SAIL-DTE-CSR'          
112600             DISPLAY '****************************************'           
112700             PERFORM 9100-SQL-ABEND                                       
112800     END-EVALUATE.                                                        
112900                                                                          
113000 EJECT                                                                    
113100                                                                          
113200******************************************************************        
113300* FETCH THE PO'S THAT HAVE AN ESTIMATED SAIL DTE                          
113400* THAT FALLS IN THE IMPRT DATE RANGE. THE DATA SOURCE WILL BE             
113500* DETERMINED IF THERE MAY BE MORE THAN ONE. THE COPYBOOK FIELDS           
113600* ARE LOADED, AND AN INSERT TO TOUTTM1 IS PERFORMED.                      
113700* THE RECORD IS ALSO WRITTEN TO A FLAT FILE.                              
113800* COUNTS ARE KEPT FOR THE NBR OF FETCHES FOR EACH CSR, NBR OF PO'S        
113900* ASSIGNED TO EACH DATA SOURCE AND TOTAL TOUTTM1 INSERTS.                 
114000******************************************************************        
114100 7220-FETCH-EST-SAIL-DTE-CSR.                                             
114200                                                                          
114300     SET PS-DATA-SRC-SAIL-DTE                TO TRUE.                     
114400                                                                          
114500     EXEC SQL                                                             
114600          FETCH EST_SAIL_DTE_CSR                                          
114700          INTO :IMRCPO-PO-NBR                                             
114800              ,:IMRCPO-PO-RCVD-SEQ-NBR                                    
114900              ,:PV-IMRCPO-SAIL-DTE                                        
114900              ,:PV-IMRCPO-RCVD-DELY-DTE                                   
115000              ,:IMRCPO-LAST-UPD-TMST                                      
115100     END-EXEC.                                                            
115200                                                                          
115300*TEST-ABEND                                                               
115400*           PERFORM 9100-SQL-ABEND                                        
115500                                                                          
115600         EVALUATE TRUE                                                    
115700             WHEN SQLCODE = +100                                          
115800               IF   PA-EST-SAIL-FETCHES = 0                               
115900                    DISPLAY ' <<< NO FETCHES FOR EST SAIL DTE >>>'        
116000                    DISPLAY '                                 '           
116100               END-IF                                                     
116200                                                                          
116300               SET  PS-EOC-EST-SAIL-DTE-CSR    TO TRUE                    
116400                                                                          
116500             WHEN SQLCODE = ZERO                                          
116600               INITIALIZE                    PV-HOLD-CURRENT-PO           
116700               MOVE IMRCPO-PO-NBR         TO TM606-PO-NBR                 
116800                                             PV-HOLD-CURRENT-PO           
116900                                             PV-LAST-PO-PROCESSED         
117000             MOVE IMRCPO-PO-RCVD-SEQ-NBR  TO TM606-PO-RCVD-SEQ-NBR        
117100             MOVE PV-IMRCPO-SAIL-DTE TO TM606-EST-DPRTR-DTE               
117100             MOVE PV-IMRCPO-RCVD-DELY-DTE                                 
117100                                     TO TM606-PO-RCVD-DELY-DTE            
117200               MOVE IMRCPO-LAST-UPD-TMST                                  
117300                                    TO TM606-IMRCPO-LAST-UPD-TMST         
117400               MOVE PC-RC           TO TM606-DATA-SOURCE                  
117401                                         PV-HOLD-CURRENT-DATA-SRC         
117410               MOVE PC-SD           TO TM606-EXTR-PRCG-APPL-CDE           
117600               ADD  +1              TO PA-EST-SAIL-FETCHES                
117700                                                                          
117800               PERFORM 7700-INSERT-TOUTTM1                                
117900                                                                          
118000               INITIALIZE TM606-RECORD                                    
118100                          PV-HOLD-CURRENT-PO                              
118200                          PV-HOLD-CURRENT-DATA-SRC                        
118300                                                                          
118400               ADD  +1         TO PA-EST-SAIL-INSERTS                     
118500               ADD  +1         TO PA-SD-SOURCES                           
118600                                                                          
118700             WHEN SQLWARN0 NOT EQUAL SPACE                                
118800             WHEN SQLCODE NOT EQUAL ZERO                                  
118900                 DISPLAY '**************************************'         
119000                 DISPLAY '** ABEND                            **'         
119100                 DISPLAY 'PROGRAM = TMKUT620                    '         
119200                 DISPLAY 'PARAGRAPH = 7220-FETCH-EST-SAIL-DTE-CSR'        
119300                 DISPLAY 'CURRENT PO = ' PV-HOLD-CURRENT-PO               
119400                 DISPLAY '**************************************'         
119500                 PERFORM 9100-SQL-ABEND                                   
119600         END-EVALUATE.                                                    
119700                                                                          
119800 EJECT                                                                    
119900                                                                          
120000******************************************************************        
120100* CLOSE THE EST_SAIL_DTE_CSR                                              
120200******************************************************************        
120300 7230-CLOSE-EST-SAIL-DTE-CSR.                                             
120400                                                                          
120500     EXEC SQL                                                             
120600         CLOSE EST_SAIL_DTE_CSR                                           
120700     END-EXEC.                                                            
120800                                                                          
120900     EVALUATE TRUE                                                        
121000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
121100         WHEN SQLCODE NOT EQUAL ZERO                                      
121200             DISPLAY '******************************************'         
121300             DISPLAY '** ABEND                                **'         
121400             DISPLAY '** PROGRAM = TMKUT620                   **'         
121500             DISPLAY '** PARAGRAPH = 7230-CLOSE-EST-SAIL-DTE-CSR'         
121600             DISPLAY '******************************************'         
121700             PERFORM 9100-SQL-ABEND                                       
121800     END-EVALUATE.                                                        
121900                                                                          
122000 EJECT                                                                    
122100                                                                          
122200******************************************************************        
122300* PERFORMS THE OPEN, FETCH AND CLOSE FUNCTIONS FOR THE                    
122400* BKG DELY DTE CSR                                                        
122500******************************************************************        
122600 7300-PROCESS-BKG-DELY-DTE-CSR.                                           
122700                                                                          
122800      SET PS-EOC-BKG-DELY-DTE-CSR-NO TO TRUE.                             
122900                                                                          
123000****  PERFORM 7900-SET-CURRENT-TMST.                                      
123100****  MOVE PV-CURRENT-TMST            TO PV-BEGIN-CSR-TMST.               
123200****                                                                      
123300      PERFORM 7310-OPEN-BKG-DELY-DTE-CSR.                                 
123400                                                                          
123500      PERFORM 7320-FETCH-BKG-DELY-DTE-CSR                                 
123600        UNTIL PS-EOC-BKG-DELY-DTE-CSR.                                    
123700                                                                          
123800      PERFORM 7330-CLOSE-BKG-DELY-DTE-CSR.                                
123900                                                                          
124000****  PERFORM 7900-SET-CURRENT-TMST.                                      
124100****  MOVE PV-CURRENT-TMST            TO PV-END-CSR-TMST.                 
124200****  PERFORM 7910-CALCULATE-ELAPSED-SECONDS.                             
124300****                                                                      
124400****  DISPLAY '____________________________________'.                     
124500****  DISPLAY 'BEGIN CSR TMST : ' PV-BEGIN-CSR-TMST.                      
124600****  DISPLAY 'END   CSR TMST : ' PV-END-CSR-TMST.                        
124700****  DISPLAY 'ELAPSED SECONDS: ' PV-ELAPSED-SECONDS.                     
124800****  DISPLAY '____ * END OF BKG DELY DTE CSR * ____'.                    
124900****  DISPLAY '                                    '.                     
125000****                                                                      
125100****  INITIALIZE PV-CURRENT-TMST                                          
125200****             PV-BEGIN-CSR-TMST                                        
125300****             PV-END-CSR-TMST.                                         
125400****                                                                      
125500      MOVE PC-RUN-IN-PROGRESS-CODE TO PV-CKPT-STAT-CODE.                  
125600      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
125700                                                                          
125800      MOVE '7300-PROCESS-BKG-DELY-DTE-CSR ' TO                            
125900                 PV-LAST-CSR-PROCESSED.                                   
126000      MOVE PC-3                    TO PV-TOTAL-COMMITS-TAKEN.             
126100      MOVE PA-SF-SOURCES           TO PV-CKPT-SF-SRC.                     
126200      MOVE PA-LF-SOURCES           TO PV-CKPT-LF-SRC.                     
126300      MOVE PA-XFCT-INSERTS         TO PV-CKPT-XFCT-INSERTS.               
126400      MOVE PA-BD-SOURCES           TO PV-CKPT-BD-SRC.                     
126500      MOVE PA-BKG-DELY-INSERTS     TO PV-CKPT-BKG-INSERTS.                
126600      MOVE PA-SD-SOURCES           TO PV-CKPT-SD-SRC.                     
126700      MOVE PA-EST-SAIL-INSERTS     TO PV-CKPT-SAIL-INSERTS.               
126800      MOVE PA-AR-SOURCES           TO PV-CKPT-AR-SRC.                     
126900      MOVE PA-ARVL-INSERTS         TO PV-CKPT-ARVL-INSERTS.               
126910      MOVE PA-CN-SOURCES           TO PV-CKPT-CN-SRC.                     
126920      MOVE PA-CNTK-INSERTS         TO PV-CKPT-CNTK-INSERTS.               
126930      MOVE PA-CS-SOURCES           TO PV-CKPT-CS-SRC.                     
126940      MOVE PA-CSTM-INSERTS         TO PV-CKPT-CSTM-INSERTS.               
127000      MOVE PA-TOTAL-TOUTTM1-INSERTS TO PV-CKPT-TOTAL-EXTRACTS.            
127100      DISPLAY '                                            '.             
127200      DISPLAY 'COMMITS TAKEN SO FAR :' PV-TOTAL-COMMITS-TAKEN.            
127300      DISPLAY '                                            '.             
127400                                                                          
127500      PERFORM 6580-UPDATE-TCKRSTINF.                                      
127600      PERFORM 6600-COMMIT.                                                
127700                                                                          
127800 EJECT                                                                    
127900                                                                          
128000******************************************************************        
128100* OPEN BKG_DELY_DTE_CSR                                                   
128200******************************************************************        
128300 7310-OPEN-BKG-DELY-DTE-CSR.                                              
128400                                                                          
128500     EXEC SQL                                                             
128600          OPEN BKG_DELY_DTE_CSR                                           
128700     END-EXEC.                                                            
128800                                                                          
128900     EVALUATE TRUE                                                        
129000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
129100         WHEN SQLCODE NOT EQUAL ZERO                                      
129200             DISPLAY '****************************************'           
129300             DISPLAY '** ABEND                              **'           
129400             DISPLAY '** PROGRAM = TMKUT620                 **'           
129500             DISPLAY '** PARAGRAPH = 7310-BKG-DELY-DTE-CSR    '           
129600             DISPLAY '****************************************'           
129700             PERFORM 9100-SQL-ABEND                                       
129800     END-EVALUATE.                                                        
129900                                                                          
130000 EJECT                                                                    
130100                                                                          
130200******************************************************************        
130300* FETCH THE PO'S THAT HAVE A PO BKG DELY DTE                              
130400* THAT FALLS IN THE IMPRT DATE RANGE. THE DATA SOURCE WILL BE             
130500* DETERMINED IF THERE MAY BE MORE THAN ONE. THE COPYBOOK FIELDS           
130600* ARE LOADED, AND AN INSERT TO TOUTTM1 IS PERFORMED.                      
130700* COUNTS ARE KEPT FOR THE NBR OF FETCHES FOR EACH CSR, NBR OF PO'S        
130800* ASSIGNED TO EACH DATA SOURCE AND TOTAL TOUTTM1 INSERTS.                 
130900******************************************************************        
131000 7320-FETCH-BKG-DELY-DTE-CSR.                                             
131100                                                                          
131200     SET PS-DATA-SRC-BKG-DTE                 TO TRUE.                     
131300                                                                          
131400     EXEC SQL                                                             
131500          FETCH BKG_DELY_DTE_CSR                                          
131600          INTO :PURCHS-PO-NBR                                             
131700              ,:IMBKPO-PO-BKG-SEQ-NBR                                     
131800              ,:PV-IMBKPO-PO-BKG-DELY-DTE                                 
131900              ,:IMBKPO-LAST-UPD-TMST                                      
132000     END-EXEC.                                                            
132100                                                                          
132200*TEST-ABEND                                                               
132300*           PERFORM 9100-SQL-ABEND                                        
132400                                                                          
132500         EVALUATE TRUE                                                    
132600             WHEN SQLCODE = +100                                          
132700               IF   PA-BKG-DELY-FETCHES  = 0                              
132800                 DISPLAY ' <<< NO FETCHES FOR BKG DELY DTE  >>> '         
132900                 DISPLAY '                                      '         
133000               END-IF                                                     
133100                                                                          
133200               SET  PS-EOC-BKG-DELY-DTE-CSR  TO TRUE                      
133300                                                                          
133400             WHEN SQLCODE = ZERO                                          
133500               INITIALIZE                    PV-HOLD-CURRENT-PO           
133600               MOVE PURCHS-PO-NBR         TO TM606-PO-NBR                 
133700                                             PV-HOLD-CURRENT-PO           
133800                                             PV-LAST-PO-PROCESSED         
133900               MOVE IMBKPO-PO-BKG-SEQ-NBR TO TM606-PO-BKG-SEQ-NBR         
134000               MOVE PV-IMBKPO-PO-BKG-DELY-DTE     TO                      
134100                          TM606-PO-BKG-DELY-DTE                           
134200               MOVE IMBKPO-LAST-UPD-TMST  TO                              
134300                       TM606-IMBKPO-LAST-UPD-TMST                         
134400               MOVE PC-BK             TO TM606-DATA-SOURCE                
134401                                         PV-HOLD-CURRENT-DATA-SRC         
134410               MOVE PC-EB             TO TM606-EXTR-PRCG-APPL-CDE         
134600               ADD  +1                TO PA-BKG-DELY-FETCHES              
134700                                                                          
134800          PERFORM 7700-INSERT-TOUTTM1                                     
134900                                                                          
135000          INITIALIZE TM606-RECORD                                         
135100                     PV-HOLD-CURRENT-PO                                   
135200                                                                          
135300          ADD  +1         TO PA-BKG-DELY-INSERTS                          
135400          ADD  +1         TO PA-BD-SOURCES                                
135500                                                                          
135600             WHEN SQLWARN0 NOT EQUAL SPACE                                
135700             WHEN SQLCODE NOT EQUAL ZERO                                  
135800                DISPLAY '**************************************'          
135900                DISPLAY '** ABEND                            **'          
136000                DISPLAY 'PROGRAM = TMKUT620                    '          
136100                DISPLAY 'PARAGRAPH = 7320-FETCH-BKG-DELY-DTE-CSR'         
136200                DISPLAY 'CURRENT PO = ' PV-HOLD-CURRENT-PO                
136300                DISPLAY '**************************************'          
136400                PERFORM 9100-SQL-ABEND                                    
136500         END-EVALUATE.                                                    
136600                                                                          
136700 EJECT                                                                    
136800                                                                          
136900******************************************************************        
137000* CLOSE THE BKG_DELY_DTE_CSR                                              
137100******************************************************************        
137200 7330-CLOSE-BKG-DELY-DTE-CSR.                                             
137300                                                                          
137400     EXEC SQL                                                             
137500         CLOSE BKG_DELY_DTE_CSR                                           
137600     END-EXEC.                                                            
137700                                                                          
137800     EVALUATE TRUE                                                        
137900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
138000         WHEN SQLCODE NOT EQUAL ZERO                                      
138100             DISPLAY '******************************************'         
138200             DISPLAY '** ABEND                                **'         
138300             DISPLAY '** PROGRAM = TMKUT620                   **'         
138400             DISPLAY '** PARAGRAPH = 7330-CLOSE-BKG-DELY-DTE-CSR'         
138500             DISPLAY '******************************************'         
138600             PERFORM 9100-SQL-ABEND                                       
138700     END-EVALUATE.                                                        
138800                                                                          
138900 EJECT                                                                    
139000                                                                          
139100******************************************************************        
139200* PERFORMS THE OPEN, FETCH AND CLOSE FUNCTIONS FOR THE                    
139300* ARVL DTE CSR.                                                           
139400******************************************************************        
139500 7400-PROCESS-ARVL-DTE-CSR.                                               
139600                                                                          
139700      SET PS-EOC-ARVL-DTE-CSR-NO      TO TRUE.                            
139800                                                                          
139900****  PERFORM 7900-SET-CURRENT-TMST.                                      
140000****  MOVE PV-CURRENT-TMST            TO PV-BEGIN-CSR-TMST.               
140100****                                                                      
140200      PERFORM 7410-OPEN-ARVL-DTE-CSR.                                     
140300                                                                          
140400      PERFORM 7420-FETCH-ARVL-DTE-CSR                                     
140500        UNTIL PS-EOC-ARVL-DTE-CSR.                                        
140600                                                                          
140700      PERFORM 7430-CLOSE-ARVL-DTE-CSR.                                    
140800                                                                          
140900****  PERFORM 7900-SET-CURRENT-TMST.                                      
141000****  MOVE PV-CURRENT-TMST            TO PV-END-CSR-TMST.                 
141100****  PERFORM 7910-CALCULATE-ELAPSED-SECONDS.                             
141200****                                                                      
141300****  DISPLAY '____________________________________'.                     
141400****  DISPLAY 'BEGIN CSR TMST : ' PV-BEGIN-CSR-TMST.                      
141500****  DISPLAY 'END   CSR TMST : ' PV-END-CSR-TMST.                        
141600****  DISPLAY 'ELAPSED SECONDS: ' PV-ELAPSED-SECONDS.                     
141700****  DISPLAY '_____ * END OF ARVL DTE CSR * ______'.                     
141800****  DISPLAY '                                    '.                     
141900****                                                                      
142000****  INITIALIZE PV-CURRENT-TMST                                          
142100****             PV-BEGIN-CSR-TMST                                        
142200****             PV-END-CSR-TMST.                                         
142300****                                                                      
142400      MOVE PC-RUN-IN-PROGRESS-CODE TO PV-CKPT-STAT-CODE.                  
142500      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
142600                                                                          
142700      MOVE '7400-PROCESS-ARVL-DTE-CSR     ' TO                            
142800                  PV-LAST-CSR-PROCESSED.                                  
142900      MOVE PC-4                    TO PV-TOTAL-COMMITS-TAKEN.             
143000      MOVE PA-SF-SOURCES           TO PV-CKPT-SF-SRC.                     
143100      MOVE PA-LF-SOURCES           TO PV-CKPT-LF-SRC.                     
143200      MOVE PA-XFCT-INSERTS         TO PV-CKPT-XFCT-INSERTS.               
143300      MOVE PA-BD-SOURCES           TO PV-CKPT-BD-SRC.                     
143400      MOVE PA-BKG-DELY-INSERTS     TO PV-CKPT-BKG-INSERTS.                
143500      MOVE PA-SD-SOURCES           TO PV-CKPT-SD-SRC.                     
143600      MOVE PA-EST-SAIL-INSERTS     TO PV-CKPT-SAIL-INSERTS.               
143700      MOVE PA-AR-SOURCES           TO PV-CKPT-AR-SRC.                     
143800      MOVE PA-ARVL-INSERTS         TO PV-CKPT-ARVL-INSERTS.               
143810      MOVE PA-CN-SOURCES           TO PV-CKPT-CN-SRC.                     
143820      MOVE PA-CNTK-INSERTS         TO PV-CKPT-CNTK-INSERTS.               
143830      MOVE PA-CS-SOURCES           TO PV-CKPT-CS-SRC.                     
143840      MOVE PA-CSTM-INSERTS         TO PV-CKPT-CSTM-INSERTS.               
143900      MOVE PA-TOTAL-TOUTTM1-INSERTS TO PV-CKPT-TOTAL-EXTRACTS.            
144000      DISPLAY '                                            '.             
144100      DISPLAY 'COMMITS TAKEN SO FAR :' PV-TOTAL-COMMITS-TAKEN.            
144200      DISPLAY '                                            '.             
144300                                                                          
144400      PERFORM 6580-UPDATE-TCKRSTINF.                                      
144500      PERFORM 6600-COMMIT.                                                
144600                                                                          
144700 EJECT                                                                    
144800                                                                          
144900******************************************************************        
145000* OPEN ARVL-DTE-CSR.                                                      
145100******************************************************************        
145200 7410-OPEN-ARVL-DTE-CSR.                                                  
145300                                                                          
145400     EXEC SQL                                                             
145500          OPEN ARVL_DTE_CSR                                               
145600     END-EXEC.                                                            
145700                                                                          
145800     EVALUATE TRUE                                                        
145900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
146000         WHEN SQLCODE NOT EQUAL ZERO                                      
146100             DISPLAY '****************************************'           
146200             DISPLAY '** ABEND                              **'           
146300             DISPLAY '** PROGRAM = TMKUT620                 **'           
146400             DISPLAY '** PARAGRAPH = 7410-OPEN-ARVL-DTE-CSR **'           
146500             DISPLAY '****************************************'           
146600             PERFORM 9100-SQL-ABEND                                       
146700     END-EVALUATE.                                                        
146800                                                                          
146900 EJECT                                                                    
147000                                                                          
147100******************************************************************        
147200* FETCH THE PO'S THAT HAVE A POE DELY DTE                                 
147300* THAT FALLS IN THE IMPRT DATE RANGE. THE DATA SOURCE WILL BE             
147400* DETERMINED IF THERE MAY BE MORE THAN ONE. THE COPYBOOK FIELDS           
147500* ARE LOADED, AND AN INSERT TO TOUTTM1 IS PERFORMED.                      
147600* THE RECORD IS ALSO WRITTEN TO A FLAT FILE.                              
147700* COUNTS ARE KEPT FOR THE NBR OF FETCHES FOR EACH CSR, NBR OF PO'S        
147800* ASSIGNED TO EACH DATA SOURCE AND TOTAL TOUTTM1 INSERTS.                 
147900******************************************************************        
148000 7420-FETCH-ARVL-DTE-CSR.                                                 
148100                                                                          
148200     SET PS-DATA-SRC-ARVL-DTE                TO TRUE.                     
148300                                                                          
148400     EXEC SQL                                                             
148500          FETCH ARVL_DTE_CSR                                              
148600          INTO :IMCNPO-PO-NBR                                             
148700              ,:IMCNPO-CONTNR-ID                                          
148800              ,:IMCNPO-CONTNR-SEQ-NBR                                     
148900              ,:PV-IMCNTK-POE-DELY-DTE                                    
149000              ,:IMCNPO-LAST-UPD-TMST                                      
149100     END-EXEC.                                                            
149200                                                                          
149600         EVALUATE TRUE                                                    
149700             WHEN SQLCODE = +100                                          
149800               IF   PA-ARVL-FETCHES = 0                                   
149900                 DISPLAY ' <<<  NO FETCHES FOR ARVL DTE  >>> '            
150000                 DISPLAY '                                      '         
150100               END-IF                                                     
150200                                                                          
150300               SET  PS-EOC-ARVL-DTE-CSR  TO TRUE                          
150400                                                                          
150500             WHEN SQLCODE = ZERO                                          
150600               INITIALIZE                    PV-HOLD-CURRENT-PO           
150700               MOVE IMCNPO-PO-NBR         TO TM606-PO-NBR                 
150800                                             PV-HOLD-CURRENT-PO           
150900                                             PV-LAST-PO-PROCESSED         
151000               MOVE IMCNPO-CONTNR-ID      TO TM606-CONTNR-ID              
151100               MOVE IMCNPO-CONTNR-SEQ-NBR TO TM606-CONTNR-SEQ-NBR         
151200               MOVE PV-IMCNTK-POE-DELY-DTE TO                             
151300                                    TM606-MOM-POE-DELY-DTE                
151400               MOVE IMCNPO-LAST-UPD-TMST  TO                              
151500                                      TM606-IMCNPO-LAST-UPD-TMST          
151600               MOVE PC-PA      TO TM606-EXTR-PRCG-APPL-CDE                
151610               MOVE PC-CN      TO TM606-DATA-SOURCE                       
151700                                  PV-HOLD-CURRENT-DATA-SRC                
151800               ADD  +1         TO PA-ARVL-FETCHES                         
151900                                                                          
152000          PERFORM 7700-INSERT-TOUTTM1                                     
152100          INITIALIZE TM606-RECORD                                         
152200                     PV-HOLD-CURRENT-PO                                   
152300          ADD  +1                 TO PA-ARVL-INSERTS                      
152400          ADD  +1                 TO PA-AR-SOURCES                        
152500                                                                          
152600             WHEN SQLWARN0 NOT EQUAL SPACE                                
152700             WHEN SQLCODE NOT EQUAL ZERO                                  
152800                DISPLAY '**************************************'          
152900                DISPLAY '** ABEND                            **'          
153000                DISPLAY 'PROGRAM = TMKUT620                    '          
153100                DISPLAY 'PARAGRAPH = 7420-FETCH-ARVL-DTE-CSR'             
153200                DISPLAY 'CURRENT PO = ' PV-HOLD-CURRENT-PO                
153300                DISPLAY '**************************************'          
153400                PERFORM 9100-SQL-ABEND                                    
153500         END-EVALUATE.                                                    
153600                                                                          
153700 EJECT                                                                    
153800                                                                          
153900******************************************************************        
154000* CLOSE THE ARVL_DTE_CSR                                                  
154100******************************************************************        
154200 7430-CLOSE-ARVL-DTE-CSR.                                                 
154300                                                                          
154400     EXEC SQL                                                             
154500         CLOSE ARVL_DTE_CSR                                               
154600     END-EXEC.                                                            
154700                                                                          
154800     EVALUATE TRUE                                                        
154900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
155000         WHEN SQLCODE NOT EQUAL ZERO                                      
155100             DISPLAY '******************************************'         
155200             DISPLAY '** ABEND                                **'         
155300             DISPLAY '** PROGRAM = TMKUT620                   **'         
155400             DISPLAY '** PARAGRAPH = 7430-CLOSE-ARVL-DTE-CSR'             
155500             DISPLAY '******************************************'         
155600             PERFORM 9100-SQL-ABEND                                       
155700     END-EVALUATE.                                                        
155800                                                                          
155900                                                                          
156000                                                                          
156100 EJECT                                                                    
156210******************************************************************        
156220* PERFORMS THE OPEN, FETCH AND CLOSE FUNCTIONS FOR THE                    
156230* CONTAINER PICK UP DATE CURSOR.                                          
156240******************************************************************        
156250 7500-PROCESS-CNPU-DTE-CSR.                                               
156260                                                                          
156270      SET PS-EOC-CNPU-DTE-CSR-NO      TO TRUE.                            
156280                                                                          
156293      PERFORM 7510-OPEN-CNPU-DTE-CSR.                                     
156294                                                                          
156295      PERFORM 7520-FETCH-CNPU-DTE-CSR                                     
156296        UNTIL PS-EOC-CNPU-DTE-CSR.                                        
156297                                                                          
156298      PERFORM 7530-CLOSE-CNPU-DTE-CSR.                                    
156299                                                                          
156315      MOVE PC-RUN-IN-PROGRESS-CODE TO PV-CKPT-STAT-CODE.                  
156316      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
156317                                                                          
156318      MOVE '7500-PROCESS-CNPU-DTE-CSR     ' TO                            
156319                  PV-LAST-CSR-PROCESSED.                                  
156320      MOVE PC-5                    TO PV-TOTAL-COMMITS-TAKEN.             
156321      MOVE PA-SF-SOURCES           TO PV-CKPT-SF-SRC.                     
156322      MOVE PA-LF-SOURCES           TO PV-CKPT-LF-SRC.                     
156323      MOVE PA-XFCT-INSERTS         TO PV-CKPT-XFCT-INSERTS.               
156324      MOVE PA-BD-SOURCES           TO PV-CKPT-BD-SRC.                     
156325      MOVE PA-BKG-DELY-INSERTS     TO PV-CKPT-BKG-INSERTS.                
156326      MOVE PA-SD-SOURCES           TO PV-CKPT-SD-SRC.                     
156327      MOVE PA-EST-SAIL-INSERTS     TO PV-CKPT-SAIL-INSERTS.               
156328      MOVE PA-AR-SOURCES           TO PV-CKPT-AR-SRC.                     
156329      MOVE PA-ARVL-INSERTS         TO PV-CKPT-ARVL-INSERTS.               
156330      MOVE PA-CN-SOURCES           TO PV-CKPT-CN-SRC.                     
156331      MOVE PA-CNTK-INSERTS         TO PV-CKPT-CNTK-INSERTS.               
156332      MOVE PA-CS-SOURCES           TO PV-CKPT-CS-SRC.                     
156333      MOVE PA-CSTM-INSERTS         TO PV-CKPT-CSTM-INSERTS.               
156334      MOVE PA-TOTAL-TOUTTM1-INSERTS TO PV-CKPT-TOTAL-EXTRACTS.            
156335      DISPLAY '                                            '.             
156336      DISPLAY 'COMMITS TAKEN SO FAR :' PV-TOTAL-COMMITS-TAKEN.            
156337      DISPLAY '                                            '.             
156338                                                                          
156339      PERFORM 6580-UPDATE-TCKRSTINF.                                      
156340      PERFORM 6600-COMMIT.                                                
156341                                                                          
156342 EJECT                                                                    
156343                                                                          
156344******************************************************************        
156345* OPEN CNPU-DTE-CSR.                                                      
156346******************************************************************        
156347 7510-OPEN-CNPU-DTE-CSR.                                                  
156348                                                                          
156349     EXEC SQL                                                             
156350          OPEN CNPU_DTE_CSR                                               
156351     END-EXEC.                                                            
156352                                                                          
156353     EVALUATE TRUE                                                        
156354         WHEN SQLWARN0 NOT EQUAL SPACE                                    
156355         WHEN SQLCODE NOT EQUAL ZERO                                      
156356             DISPLAY '****************************************'           
156357             DISPLAY '** ABEND                              **'           
156358             DISPLAY '** PROGRAM = TMKUT620                 **'           
156359             DISPLAY '** PARAGRAPH = 7510-OPEN-CNPU-DTE-CSR'              
156360             DISPLAY '****************************************'           
156361             PERFORM 9100-SQL-ABEND                                       
156362     END-EVALUATE.                                                        
156363                                                                          
156364 EJECT                                                                    
156365                                                                          
156366******************************************************************        
156367* FETCH THE PO'S THAT HAVE A CONTAINER PICK UP DATE                       
156368* THAT FALLS IN THE IMPRT DATE RANGE. THE DATA SOURCE WILL BE             
156369* DETERMINED IF THERE MAY BE MORE THAN ONE. THE COPYBOOK FIELDS           
156370* ARE LOADED, AND AN INSERT TO TOUTTM1 IS PERFORMED.                      
156371* THE RECORD IS ALSO WRITTEN TO A FLAT FILE.                              
156372* COUNTS ARE KEPT FOR THE NBR OF FETCHES FOR EACH CSR, NBR OF PO'S        
156373* ASSIGNED TO EACH DATA SOURCE AND TOTAL TOUTTM1 INSERTS.                 
156374******************************************************************        
156375 7520-FETCH-CNPU-DTE-CSR.                                                 
156376                                                                          
156377     SET PS-DATA-SRC-CNPU-DTE                TO TRUE.                     
156378                                                                          
156379     EXEC SQL                                                             
156380          FETCH CNPU_DTE_CSR                                              
156381          INTO :IMCNPO-PO-NBR                                             
156382              ,:IMCNPO-CONTNR-ID                                          
156383              ,:IMCNPO-CONTNR-SEQ-NBR                                     
156384              ,:PV-IMCNTK-PU-DTE                                          
156384              ,:PV-IMCNTK-POE-DELY-DTE                                    
156385              ,:IMCNTK-LAST-UPD-TMST                                      
156386     END-EXEC.                                                            
156387                                                                          
156388         EVALUATE TRUE                                                    
156389             WHEN SQLCODE = +100                                          
156390               IF   PA-CNTK-FETCHES = 0                                   
156391                 DISPLAY ' <<<  NO FETCHES FOR CNTK DTE  >>> '            
156392                 DISPLAY '                                      '         
156393               END-IF                                                     
156394                                                                          
156395               SET  PS-EOC-CNPU-DTE-CSR  TO TRUE                          
156396                                                                          
156397             WHEN SQLCODE = ZERO                                          
156398               INITIALIZE                    PV-HOLD-CURRENT-PO           
156399               MOVE IMCNPO-PO-NBR         TO TM606-PO-NBR                 
156400                                             PV-HOLD-CURRENT-PO           
156401                                             PV-LAST-PO-PROCESSED         
156402               MOVE IMCNPO-CONTNR-ID      TO TM606-CONTNR-ID              
156403               MOVE IMCNPO-CONTNR-SEQ-NBR TO TM606-CONTNR-SEQ-NBR         
156404               MOVE PV-IMCNTK-PU-DTE       TO                             
156405                                      TM606-CONTNR-PKUP-DTE               
151200               MOVE PV-IMCNTK-POE-DELY-DTE TO                             
151300                                      TM606-MOM-POE-DELY-DTE              
156406               MOVE IMCNTK-LAST-UPD-TMST  TO                              
156407                                      TM606-IMCNTK-LAST-UPD-TMST          
156408               MOVE PC-CP      TO TM606-EXTR-PRCG-APPL-CDE                
156409               MOVE PC-CN      TO TM606-DATA-SOURCE                       
156410                                  PV-HOLD-CURRENT-DATA-SRC                
156411               ADD  +1         TO PA-CNTK-FETCHES                         
156412                                                                          
156413          PERFORM 7700-INSERT-TOUTTM1                                     
156414          INITIALIZE TM606-RECORD                                         
156415                     PV-HOLD-CURRENT-PO                                   
156416          ADD  +1                 TO PA-CNTK-INSERTS                      
156417          ADD  +1                 TO PA-CT-SOURCES                        
156418                                                                          
156419             WHEN SQLWARN0 NOT EQUAL SPACE                                
156420             WHEN SQLCODE NOT EQUAL ZERO                                  
156421                DISPLAY '**************************************'          
156422                DISPLAY '** ABEND                            **'          
156423                DISPLAY 'PROGRAM = TMKUT620                    '          
156424                DISPLAY 'PARAGRAPH = 7520-FETCH-CNPU-DTE-CSR'             
156425                DISPLAY 'CURRENT PO = ' PV-HOLD-CURRENT-PO                
156426                DISPLAY '**************************************'          
156427                PERFORM 9100-SQL-ABEND                                    
156428         END-EVALUATE.                                                    
156429                                                                          
156430 EJECT                                                                    
156431                                                                          
156432******************************************************************        
156433* CLOSE THE CNPU_DTE_CSR                                                  
156434******************************************************************        
156435 7530-CLOSE-CNPU-DTE-CSR.                                                 
156436                                                                          
156437     EXEC SQL                                                             
156438         CLOSE CNPU_DTE_CSR                                               
156439     END-EXEC.                                                            
156440                                                                          
156441     EVALUATE TRUE                                                        
156442         WHEN SQLWARN0 NOT EQUAL SPACE                                    
156443         WHEN SQLCODE NOT EQUAL ZERO                                      
156444             DISPLAY '******************************************'         
156445             DISPLAY '** ABEND                                **'         
156446             DISPLAY '** PROGRAM = TMKUT620                   **'         
156447             DISPLAY '** PARAGRAPH = 7530-CLOSE-CNPU-DTE-CSR'             
156448             DISPLAY '******************************************'         
156449             PERFORM 9100-SQL-ABEND                                       
156450     END-EVALUATE.                                                        
156451                                                                          
156452 EJECT                                                                    
156453                                                                          
156454******************************************************************        
156455* PERFORMS THE OPEN, FETCH AND CLOSE FUNCTIONS FOR THE                    
156456* CUSTUMS FILED DATE CURSOR.                                              
156457******************************************************************        
156458                                                                          
156459 7600-PROCESS-CSTM-FILD-CSR.                                              
156460                                                                          
156461      SET PS-EOC-CSTM-FILD-CSR-NO     TO TRUE.                            
156462                                                                          
156463      PERFORM 7610-OPEN-CSTM-FILD-CSR.                                    
156464                                                                          
156465      PERFORM 7620-FETCH-CSTM-FILD-CSR                                    
156466        UNTIL PS-EOC-CSTM-FILD-CSR.                                       
156467                                                                          
156468      PERFORM 7630-CLOSE-CSTM-FILD-CSR.                                   
156469                                                                          
156470      MOVE PC-RUN-IN-PROGRESS-CODE TO PV-CKPT-STAT-CODE.                  
156471      PERFORM 6570-UPDATE-TCKRSTCNTL.                                     
156472                                                                          
156473      MOVE '7500-PROCESS-CSTM-FILD-CSR     ' TO                           
156474                  PV-LAST-CSR-PROCESSED.                                  
156475      MOVE PC-6                    TO PV-TOTAL-COMMITS-TAKEN.             
156476      MOVE PA-SF-SOURCES           TO PV-CKPT-SF-SRC.                     
156477      MOVE PA-LF-SOURCES           TO PV-CKPT-LF-SRC.                     
156478      MOVE PA-XFCT-INSERTS         TO PV-CKPT-XFCT-INSERTS.               
156479      MOVE PA-BD-SOURCES           TO PV-CKPT-BD-SRC.                     
156480      MOVE PA-BKG-DELY-INSERTS     TO PV-CKPT-BKG-INSERTS.                
156481      MOVE PA-SD-SOURCES           TO PV-CKPT-SD-SRC.                     
156482      MOVE PA-EST-SAIL-INSERTS     TO PV-CKPT-SAIL-INSERTS.               
156483      MOVE PA-AR-SOURCES           TO PV-CKPT-AR-SRC.                     
156484      MOVE PA-ARVL-INSERTS         TO PV-CKPT-ARVL-INSERTS.               
156485      MOVE PA-CN-SOURCES           TO PV-CKPT-CN-SRC.                     
156486      MOVE PA-CNTK-INSERTS         TO PV-CKPT-CNTK-INSERTS.               
156487      MOVE PA-CS-SOURCES           TO PV-CKPT-CS-SRC.                     
156488      MOVE PA-CSTM-INSERTS         TO PV-CKPT-CSTM-INSERTS.               
156489      MOVE PA-TOTAL-TOUTTM1-INSERTS TO PV-CKPT-TOTAL-EXTRACTS.            
156490      DISPLAY '                                            '.             
156491      DISPLAY 'COMMITS TAKEN SO FAR :' PV-TOTAL-COMMITS-TAKEN.            
156492      DISPLAY '                                            '.             
156493                                                                          
156494      PERFORM 6580-UPDATE-TCKRSTINF.                                      
156495      PERFORM 6600-COMMIT.                                                
156496                                                                          
156497 EJECT                                                                    
156498                                                                          
156499******************************************************************        
156500* OPEN CSTM-FILD-CSR.                                                     
156501******************************************************************        
156502 7610-OPEN-CSTM-FILD-CSR.                                                 
156503                                                                          
156504     EXEC SQL                                                             
156505          OPEN CSTM_FILD_CSR                                              
156506     END-EXEC.                                                            
156507                                                                          
156508     EVALUATE TRUE                                                        
156509         WHEN SQLWARN0 NOT EQUAL SPACE                                    
156510         WHEN SQLCODE NOT EQUAL ZERO                                      
156511             DISPLAY '****************************************'           
156512             DISPLAY '** ABEND                              **'           
156513             DISPLAY '** PROGRAM = TMKUT620                 **'           
156514             DISPLAY '** PARAGRAPH = 7610-OPEN-CSTM-FILD-CSR    '         
156515             DISPLAY '****************************************'           
156516             PERFORM 9100-SQL-ABEND                                       
156517     END-EVALUATE.                                                        
156518                                                                          
156519 EJECT                                                                    
156520                                                                          
156521******************************************************************        
156522* FETCH THE PO'S THAT HAVE A POE DELY DTE                                 
156523* THAT FALLS IN THE IMPRT DATE RANGE. THE DATA SOURCE WILL BE             
156524* DETERMINED IF THERE MAY BE MORE THAN ONE. THE COPYBOOK FIELDS           
156525* ARE LOADED, AND AN INSERT TO TOUTTM1 IS PERFORMED.                      
156526* THE RECORD IS ALSO WRITTEN TO A FLAT FILE.                              
156527* COUNTS ARE KEPT FOR THE NBR OF FETCHES FOR EACH CSR, NBR OF PO'S        
156528* ASSIGNED TO EACH DATA SOURCE AND TOTAL TOUTTM1 INSERTS.                 
156529******************************************************************        
156530 7620-FETCH-CSTM-FILD-CSR.                                                
156531                                                                          
156532     SET PS-DATA-SRC-CSTM-FILD               TO TRUE.                     
156533                                                                          
156534     EXEC SQL                                                             
156535          FETCH CSTM_FILD_CSR                                             
156536          INTO :IMCSPO-PO-NBR                                             
156537              ,:IMCSEN-CSTM-ENTR-ID                                       
156538              ,:PV-IMCSEN-FILD-DTE                                        
156539              ,:IMCSEN-LAST-UPD-TMST                                      
156540     END-EXEC.                                                            
156541                                                                          
156542         EVALUATE TRUE                                                    
156543             WHEN SQLCODE = +100                                          
156544               IF   PA-CSTM-FETCHES = 0                                   
156545                 DISPLAY ' <<<  NO FETCHES FOR CSTM FILD >>> '            
156546                 DISPLAY '                                      '         
156547               END-IF                                                     
156548                                                                          
156549               SET  PS-EOC-CSTM-FILD-CSR TO TRUE                          
156550                                                                          
156551             WHEN SQLCODE = ZERO                                          
156552               INITIALIZE                    PV-HOLD-CURRENT-PO           
156553               MOVE IMCSPO-PO-NBR         TO TM606-PO-NBR                 
156554                                             PV-HOLD-CURRENT-PO           
156555                                             PV-LAST-PO-PROCESSED         
156556               MOVE IMCSEN-CSTM-ENTR-ID   TO                              
156557                                      TM606-CSTM-ENTR-ID                  
156558               MOVE PV-IMCSEN-FILD-DTE    TO                              
156559                                      TM606-CUSTOMS-FILE-DTE              
156560               MOVE IMCSPO-LAST-UPD-TMST  TO                              
156561                                      TM606-IMCSEN-LAST-UPD-TMST          
156562               MOVE PC-CF      TO TM606-EXTR-PRCG-APPL-CDE                
156563               MOVE PC-CS      TO TM606-DATA-SOURCE                       
156564                                  PV-HOLD-CURRENT-DATA-SRC                
156565               ADD  +1         TO PA-CSTM-FETCHES                         
156566                                                                          
156567          PERFORM 7700-INSERT-TOUTTM1                                     
156568          INITIALIZE TM606-RECORD                                         
156569                     PV-HOLD-CURRENT-PO                                   
156570          ADD  +1                 TO PA-CSTM-INSERTS                      
156571          ADD  +1                 TO PA-CF-SOURCES                        
156572                                                                          
156573             WHEN SQLWARN0 NOT EQUAL SPACE                                
156574             WHEN SQLCODE NOT EQUAL ZERO                                  
156575                DISPLAY '**************************************'          
156576                DISPLAY '** ABEND                            **'          
156577                DISPLAY 'PROGRAM = TMKUT620                    '          
156578                DISPLAY 'PARAGRAPH = 7620-FETCH-CSTM-FILD-CSR'            
156579                DISPLAY 'CURRENT PO = ' PV-HOLD-CURRENT-PO                
156580                DISPLAY '**************************************'          
156581                PERFORM 9100-SQL-ABEND                                    
156582         END-EVALUATE.                                                    
156583                                                                          
156584 EJECT                                                                    
156585                                                                          
156586******************************************************************        
156587* CLOSE THE CSTM_FILD_CSR                                                 
156588******************************************************************        
156589 7630-CLOSE-CSTM-FILD-CSR.                                                
156590                                                                          
156591     EXEC SQL                                                             
156592         CLOSE CSTM_FILD_CSR                                              
156593     END-EXEC.                                                            
156594                                                                          
156595     EVALUATE TRUE                                                        
156596         WHEN SQLWARN0 NOT EQUAL SPACE                                    
156597         WHEN SQLCODE NOT EQUAL ZERO                                      
156598             DISPLAY '******************************************'         
156599             DISPLAY '** ABEND                                **'         
156600             DISPLAY '** PROGRAM = TMKUT620                   **'         
156601             DISPLAY '** PARAGRAPH = 7630-CLOSE-CSTM-FILD-CSR'            
156602             DISPLAY '******************************************'         
156603             PERFORM 9100-SQL-ABEND                                       
156604     END-EVALUATE.                                                        
156605                                                                          
156606                                                                          
156607                                                                          
156608 EJECT                                                                    
156609******************************************************************        
156610* DO AN INSERT ON TOUTTM1 TO LOAD EACH PO TO THE TABLE           *        
156611******************************************************************        
156620 7700-INSERT-TOUTTM1.                                                     
156700                                                                          
156800         MOVE TM606-PO-NBR    TO OUTTM1-PO-NBR.                           
156900         MOVE TM606-ODR       TO OUTTM1-TRBL-ODR.                         
157000         MOVE TM606-TMST-ODR  TO OUTTM1-TRBL-TMST-ODR.                    
157100                                                                          
157200         EXEC SQL                                                         
157300             INSERT INTO TOUTTM1                                          
157400                 (PO_NBR                                                  
157500                 ,TRBL_ODR                                                
157600                 ,TRBL_TMST_ODR                                           
157700                  )                                                       
157800                VALUES                                                    
157900                 (:OUTTM1-PO-NBR                                          
158000                 ,:OUTTM1-TRBL-ODR                                        
158100                 ,:OUTTM1-TRBL-TMST-ODR                                   
158200                 )                                                        
158300         END-EXEC.                                                        
158400                                                                          
158500         EVALUATE TRUE                                                    
158600             WHEN SQLCODE = ZERO                                          
158700                 ADD  +1            TO PA-TOTAL-TOUTTM1-INSERTS           
158800                                                                          
158900             WHEN SQLWARN0 NOT EQUAL SPACE                                
159000             WHEN SQLCODE NOT EQUAL ZERO                                  
159100                 DISPLAY '**************************************'         
159200                 DISPLAY '** ABEND                            **'         
159300                 DISPLAY '** PROGRAM = TMKUT620               **'         
159400                 DISPLAY '** PARAGRAPH = 7700-INSERT-TOUTTM1  **'         
159500                 DISPLAY '** INSERT PO ON WORK TABLE TOUTTM1  **'         
159600                 DISPLAY '** CURREN PO = ' PV-HOLD-CURRENT-PO             
159700                 DISPLAY '**************************************'         
159800                 PERFORM 9100-SQL-ABEND                                   
159900         END-EVALUATE.                                                    
160000                                                                          
160100 EJECT                                                                    
160200                                                                          
160300******************************************************************        
160400* DETERMINE WHICH DATA SOURCE IA APPROPRIATE FOR THE CURRENT              
160500* RECORD. CURRENT DATA SOURCES INCLUDE :                                  
160600*                                                                         
160700*     (SF)    STRT XFCT                                                   
160800*               -OR-    (FROM THE XFCT CSR)                               
160900*     (LF)    LAST XFCT                                                   
161000*                                                                         
161100*     (BD)    PO BKG,                                                     
161200*     (SD)  EST SAIL DTE, (ASSIGNED AUTOMATICALLY BECAUSE                 
161300*     (PA)   ARVL DTE      THERE IS ONLY ONE DATA SOURCE                  
161400*                          ASSOCIATED WITH THESE CURSORS)                 
161500******************************************************************        
161600 7800-DETERMINE-DATA-SOURCE.                                              
161700                                                                          
161800       SET PS-DATA-SRC-STRT-XFCT-NO            TO TRUE.                   
161900       SET PS-DATA-SRC-LAST-XFCT-NO            TO TRUE.                   
162000                                                                          
162100       IF ((PLNSHP-STRT-FCTRY-DTE IS GREATER THAN OR                      
162200            EQUAL TO PV-DATE-BEF-XFCT) AND                                
162300           (PLNSHP-STRT-FCTRY-DTE IS LESS THAN OR                         
162400            EQUAL TO PV-DATE-AFT-XFCT))                                   
162500              SET PS-DATA-SRC-STRT-XFCT        TO TRUE                    
162600       END-IF.                                                            
162700                                                                          
162800       IF ((PLNSHP-LAST-FCTRY-DTE IS GREATER THAN OR                      
162900            EQUAL TO PV-DATE-BEF-XFCT) AND                                
163000           (PLNSHP-LAST-FCTRY-DTE IS LESS THAN OR                         
163100            EQUAL TO PV-DATE-AFT-XFCT))                                   
163200              SET PS-DATA-SRC-LAST-XFCT        TO TRUE                    
163300       END-IF.                                                            
163400                                                                          
163500 EJECT                                                                    
163600                                                                          
163700******************************************************************        
163800* SET THE CURRENT TIMESTAMP.                                     *        
163900******************************************************************        
164000*7900-SET-CURRENT-TMST.                                                   
164100****                                                                      
164200****      EXEC SQL                                                        
164300****          SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                    
164400****      END-EXEC                                                        
164500****                                                                      
164600****     EVALUATE TRUE                                                    
164700****         WHEN SQLCODE = ZERO                                          
164800****             CONTINUE                                                 
164900****                                                                      
165000****         WHEN SQLWARN0 NOT EQUAL SPACE                                
165100****         WHEN SQLCODE NOT EQUAL ZERO                                  
165200****             DISPLAY '**************************************'         
165300****             DISPLAY '** ABEND                            **'         
165400****             DISPLAY '** PROGRAM = TMKUT620               **'         
165500****             DISPLAY '** PARAGRAPH = 7900-SET-CURRENT-TMST**'         
165600****             DISPLAY '** SET CURRENT TIMESTAMP            **'         
165700****             DISPLAY '** CURRENT TMST   = ' PV-CURRENT-TMST           
165800****             DISPLAY '**************************************'         
165900****             PERFORM 9100-SQL-ABEND                                   
166000****     END-EVALUATE.                                                    
166100****                                                                      
166300****                                                                      
166400******************************************************************        
166500* CALCULATE SECONDS ELAPSED                                      *        
166600******************************************************************        
166700*7910-CALCULATE-ELAPSED-SECONDS.                                          
166800****                                                                      
166900**** MOVE PV-BEGIN-CSR-TMST (18:2)   TO PV-BEGIN-SECONDS.                 
167000**** MOVE PV-END-CSR-TMST   (18:2)   TO PV-END-SECONDS.                   
167100****                                                                      
167200**** SUBTRACT PV-BEGIN-SECONDS                                            
167300**** FROM     PV-END-SECONDS                                              
167400**** GIVING   PV-ELAPSED-SECONDS.                                         
167500****                                                                      
167800******************************************************************        
167900* DISPLAYS THE SUMMARY STATISTICS FOR THE PROGRAM.               *        
168000* CLOSE THE FLAT FILE.                                           *        
168100******************************************************************        
168200 8000-EOJ-ROUTINE.                                                        
168300                                                                          
168400      DISPLAY ' ********************************************'.            
168500      DISPLAY '     * TMKUT620 SUMMARY STATISTICS *         '.            
168600      DISPLAY '                                             '.            
168700      DISPLAY '       ---------------------------           '.            
168800      DISPLAY '   DATE RANGES IN RELATION TO CURRENT DATE   '.            
168900      DISPLAY '                USED FOR:                    '.            
169000      DISPLAY '                                             '.            
169100      DISPLAY ' XFCT      (DATA SRC = SF OR LF)             '.            
169200      DISPLAY '                                             '.            
169300      DISPLAY ' XFACTORY BEFORE DATE:' PV-DATE-BEF-XFCT.                  
169400      DISPLAY ' XFACTORY AFTER  DATE:' PV-DATE-AFT-XFCT.                  
169500      DISPLAY '                                             '.            
169600      DISPLAY ' XFCT DTE INSERTS    :' PA-XFCT-INSERTS.                   
169700      DISPLAY '                                             '.            
169800      DISPLAY ' SF SOURCES          :' PA-SF-SOURCES.                     
169900      DISPLAY ' LF SOURCES          :' PA-LF-SOURCES.                     
170000      DISPLAY '                                             '.            
170100      DISPLAY '       ---------------------------           '.            
170200      DISPLAY '   DATE RANGES IN RELATION TO CURRENT DATE   '.            
170300      DISPLAY '                USED FOR                     '.            
170400      DISPLAY '                                             '.            
170500      DISPLAY ' BKG DTE      (DATA SRC = BD)                '.            
170600      DISPLAY ' EST SAIL DTE (DATA SRC = SD)                '.            
170700      DISPLAY ' ARVL DTE     (DATA SRC = PA)                '.            
170800      DISPLAY '                                             '.            
170900      DISPLAY ' IMPORT BEFORE DATE   :' PV-DATE-BEF-IMPRT.                
171000      DISPLAY ' IMPORT AFTER  DATE   :' PV-DATE-AFT-IMPRT.                
171100      DISPLAY '                                           '.              
171200      DISPLAY ' BKG DTE INSERTS      :' PA-BKG-DELY-INSERTS.              
171300      DISPLAY ' BD SOURCES           :' PA-BD-SOURCES.                    
171400      DISPLAY '                                            '.             
171500      DISPLAY ' EST SAIL DTE INSERTS :' PA-EST-SAIL-INSERTS.              
171600      DISPLAY ' SD SOURCES           :' PA-SD-SOURCES.                    
171700      DISPLAY '                                           '.              
171800      DISPLAY ' ARVL DTE INSERTS     :' PA-ARVL-INSERTS.                  
171900      DISPLAY ' PA SOURCES           :' PA-AR-SOURCES.                    
172000      DISPLAY '                                           '.              
172010      DISPLAY ' CNTNR PICKUP INSERTS :' PA-CNTK-INSERTS.                  
172020      DISPLAY ' CN SOURCES           :' PA-CN-SOURCES.                    
172030      DISPLAY '                                           '.              
172040      DISPLAY ' CUST ENT DTE INSERTS :' PA-CSTM-INSERTS.                  
172050      DISPLAY ' CN SOURCES           :' PA-CS-SOURCES.                    
172060      DISPLAY '                                           '.              
172100      DISPLAY ' TOTAL TOUTTM1 INSERTS:' PA-TOTAL-TOUTTM1-INSERTS.         
172200      DISPLAY '                                           '.              
172300      DISPLAY ' TOTAL COMMITS TAKEN  :'  PV-TOTAL-COMMITS-TAKEN.          
172400      DISPLAY '                                           '.              
172500      DISPLAY '********************************************'.             
172600                                                                          
172700 EJECT                                                                    
172800                                                                          
172900******************************************************************        
173000* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *        
173100* ERROR OR WARNING CODE OCCURS.                                  *        
173200******************************************************************        
173300 9100-SQL-ABEND.                                                          
173400******************************************************************        
173500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *        
173600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *        
173700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *        
173800* FORMAT.                                                        *        
173900******************************************************************        
174000                                                                          
174100     COPY DPPD004.                                                        
174200                                                                          
174300     DISPLAY '***********************************'.                       
174400     DISPLAY 'PO EXTRACT ABEND'.                                          
174500     DISPLAY '***********************************'.                       
174600     DISPLAY 'CURRENT PO AT ABEND: ' PV-LAST-PO-PROCESSED.                
174700     DISPLAY 'LAST CSR PROCESSED : ' PV-LAST-CSR-PROCESSED.               
174800     DISPLAY 'COMMITS TAKEN      : ' PV-TOTAL-COMMITS-TAKEN.              
174900     DISPLAY '--------------------------------------------'.              
175000     DISPLAY ' WORKING STORAGE DESCRIPTION OF TCKRSTINF   '.              
175100     DISPLAY '--------------------------------------------'.              
175200     DISPLAY 'CKPT SF SRC        : ' PV-CKPT-SF-SRC.                      
175300     DISPLAY 'CKPT LF SRC        : ' PV-CKPT-LF-SRC.                      
175400     DISPLAY 'CKPT XFCT INSERTS  : ' PV-CKPT-XFCT-INSERTS.                
175500     DISPLAY 'CKPT SD SRC        : ' PV-CKPT-SD-SRC.                      
175600     DISPLAY 'CKPT SAIL INSERTS  : ' PV-CKPT-SAIL-INSERTS.                
175700     DISPLAY 'CKPT BD SRC        : ' PV-CKPT-BD-SRC.                      
175800     DISPLAY 'CKPT BKG  INSERTS  : ' PV-CKPT-BKG-INSERTS.                 
175900     DISPLAY 'CKPT PA SRC        : ' PV-CKPT-AR-SRC.                      
176000     DISPLAY 'CKPT ARVL INSERTS  : ' PV-CKPT-ARVL-INSERTS.                
176100     DISPLAY 'CKPT CN SRC        : ' PV-CKPT-CN-SRC.                      
176110     DISPLAY 'CKPT CNTK INSERTS  : ' PV-CKPT-CNTK-INSERTS.                
176111     DISPLAY 'CKPT CS SRC        : ' PV-CKPT-CS-SRC.                      
176112     DISPLAY 'CKPT CSTM INSERTS  : ' PV-CKPT-CSTM-INSERTS.                
176120     DISPLAY 'CKPT TOTAL EXTRACTS: ' PV-CKPT-TOTAL-EXTRACTS.              
176200     DISPLAY '                                            '.              
176300     MOVE +4013 TO ABEND-CODE.                                            
176400     CALL 'ILBOABN0' USING ABEND-CODE.                                    
176500                                                                          
176600 EJECT                                                                    
176700                                                                          
