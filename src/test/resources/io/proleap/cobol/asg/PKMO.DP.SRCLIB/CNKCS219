000100*-----------------------*                                         00010082
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS219.                                         00040020
000500 AUTHOR.        GERMAN BANDA.                                     00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  06-09-2000.                                       00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000*---------------------------------------------------------------* 00100001
001100*    Y219 - PRINTER MAINTENANCE     - PRINTER CLUSTER LIST      * 00110020
001200*---------------------------------------------------------------* 00120001
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00121093
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00122093
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00123093
263455*----------------------------------------------------------------*00124093
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00125094
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00126094
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00127094
CICS  *-----------------------------------------------------------------00128094
001300 ENVIRONMENT DIVISION.                                            00130001
001400 DATA DIVISION.                                                   00140001
001500                                                                  00150001
001600 WORKING-STORAGE SECTION.                                         00160001
001700                                                                  00170001
001800 01  DK-DB2-KEYS.                                                 00180001
001900     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00190001
002000                                                    COMP.         00200001
002100     05  DK-FCLTY-ID                    PIC S9(04)  VALUE ZERO    00210001
002200                                                    COMP.         00220001
002300     05  DK-PRINTER-ID                  PIC  X(08)  VALUE SPACES. 00230011
002400                                                                  00240001
002500                                                                  00250001
002600 01  PC-PROGRAM-CONSTANTS.                                        00260001
002700     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK219  '.  00270023
002800     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM219 '.  00280022
002900     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS219'.  00290020
003000     05  PC-PRTR-VALIDATION-PGM    PIC  X(08)  VALUE 'DPKCS060'.  00300001
003100     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00310001
003200     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00320001
003300     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00330001
003400     05  PC-INTER-APPL-LIST-ADD    PIC  X(01)  VALUE '2'.         00340025
003500     05  PC-INTER-APPL-LIST-UPDATE PIC  X(01)  VALUE '3'.         00350025
003600     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00360001
003700                                               COMP SYNC.         00370001
003800     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00380001
003900                                               COMP SYNC.         00390001
004000     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00400001
004100                                               COMP-3.            00410001
004200     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00420001
004300                                               COMP SYNC.         00430001
004400     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00440001
004500                                               COMP-3.            00450001
004600     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00460001
004700     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00470001
004800     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00480001
004900     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00490001
005000*                                                                 00500001
005100*----------------------------------------------------------------*00510001
005200*  SYSTEM MESSAGES                                               *00520001
005300*----------------------------------------------------------------*00530001
005400*   00005 = INVALID VALUE                                        *00540001
005500*   00007 = REQUIRED ENTRY                                       *00550074
005600*   00008 = MUST BE NUMERIC                                      *00560001
005700*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00570001
005800*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00580001
005900*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00590001
006000*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00600001
006100*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00610001
006200*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00620001
006300*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00630001
006400*   00069 - TOP OF LIST                                          *00640001
006500*   00070 - BOTTOM OF LIST                                       *00650001
006600*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00660001
006700*   00279 - MORE ITEMS TO DISPLAY                                *00670001
006800*----------------------------------------------------------------*00680001
006900     05  PC-TSYMSG-NUMBERS.                                       00690001
007000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00700001
007100         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00710037
007200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00720037
007300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00730001
007400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00740001
007500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00750001
007600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00760001
007700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00770001
007800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00780001
007900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00790001
008000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00800001
008100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00810001
008200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00820001
008300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00830001
008400*                                                                 00840001
008500 01  PS-PROGRAM-SWITCHES.                                         00850001
008600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00860001
008700         88  PS-NO-ERROR                            VALUE 'Y'.    00870001
008800         88  PS-ERROR                               VALUE 'N'.    00880001
008900     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00890001
009000         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00900001
009100         88  PS-BLOCK-ERROR                         VALUE 'N'.    00910001
009200     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00920001
009300         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00930001
009400         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00940001
009500     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00950001
009600         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00960001
009700         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00970001
009800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00980001
009900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00990001
010000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01000001
010100     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    01010001
010200         88  PS-LIST-END                            VALUE 'Y'.    01020001
010300         88  PS-NO-LIST-END                         VALUE 'N'.    01030001
010400*                                                                 01040008
010500 01  DN-DB2-NULL-INDICATORS.                                      01050008
010600     05  DN-CLUSTR-NBR               PIC S9(04) COMP VALUE ZEROES.01060009
010700*                                                                 01070001
010800 01  PV-PROGRAM-VARIABLES.                                        01080001
010900     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01090001
011000                                        COMP SYNC.                01100001
011100     05  PV-SUB                         PIC S9(04)  VALUE +0      01110001
011200                                                    COMP SYNC.    01120001
011300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01130001
011400                                                    COMP SYNC.    01140001
011500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01150001
011600                                                    COMP-3.       01160001
011700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01170001
011800                                                    COMP-3.       01180001
011900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01190001
012000                                                    COMP-3.       01200001
012100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01210001
012200                                                    COMP-3.       01220001
012300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01230001
012400                                                    COMP-3.       01240001
012500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01250001
012600                                                    COMP-3.       01260001
012700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01270001
012800                                                    COMP-3.       01280001
012900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01290001
013000                                                    COMP SYNC.    01300001
013100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01310001
013200                                                    COMP SYNC.    01320001
013300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01330001
013400                                                    COMP SYNC.    01340001
013500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01350001
013600                                                    COMP SYNC.    01360001
013700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01370001
013800                                                    COMP SYNC.    01380001
013900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01390001
014000                                                    COMP SYNC.    01400001
014100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01410001
014200                                                    COMP SYNC.    01420001
014300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01430001
014400                                                    COMP SYNC.    01440001
014500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01450001
014600                                                    COMP SYNC.    01460001
014700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01470001
014800                                                    COMP SYNC.    01480001
014900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01490001
015000                                                    COMP SYNC.    01500001
015100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01510001
015200                                                    COMP SYNC.    01520001
015300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01530001
015400                                                    COMP SYNC.    01540001
015500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01550001
015600                                                    COMP SYNC.    01560001
015700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01570001
015800                                                    COMP SYNC.    01580001
015900     05  PV-SOFT-ABORT-MSG.                                       01590001
016000         10  FILLER            PIC X(12) VALUE ' CNKCS219 - '.    01600020
016100         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01610001
016200         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01620001
016300         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01630001
016400         10  PV-SOFT-PARAGRAPH PIC X(30).                         01640001
016500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01650001
016600                                                     COMP SYNC.   01660001
016700                                                                  01670001
016800                                                                  01680001
016900                                                                  01690001
017000     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01700001
017100                                                     COMP SYNC.   01710001
017200     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01720001
017300     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01730001
017400                                                                  01740037
017500     05  PV-PRINTER-CLUSTER              PIC X(04)   VALUE SPACES.01750076
017600     05  PV-PRINTER-CLUSTER-N            PIC ZZZ9    VALUE ZEROES.01760076
017700******************************************************************01770001
017800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01780001
017900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01790001
018000**  APPLICATION-SPECIFIC COMMAREA.                              **01800001
018100******************************************************************01810001
018200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01820001
018300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01830001
018400     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01840001
018500                                        INDEXED BY LQW-IDX.       01850001
018600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01860001
018700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01870001
018800         10  LQW-SELECTED-SW            PIC  X(01).               01880001
018900             88  LQW-SELECT                         VALUE 'S'.    01890001
019000             88  LQW-DESELECT                       VALUE ' '.    01900001
019100         10  LQW-ACTION                 PIC  X(03).               01910001
019200             88  LQW-DEL                            VALUE 'DEL'.  01920001
019300             88  LQW-INQ                            VALUE 'INQ'.  01930001
019400             88  LQW-UPD                            VALUE 'UPD'.  01940001
019500             88  LQW-ERR                            VALUE 'ERR'.  01950001
019600             88  LQW-PRT                            VALUE 'PRT'.  01960001
019700         10  LQW-CLUSTER-NUM            PIC  X(04).               01970075
019800         10  LQW-IP-ADDRESS             PIC  X(15).               01980002
019900         10  LQW-OS-RLSE-CDE            PIC  X(05).               01990002
020000         10  LQW-DATA-XFER-MDE          PIC  X(2).                02000002
020100         10  LQW-TRANSMIT-CDE           PIC  X(01).               02010002
020200                                                                  02020001
020300*---------------------------------------------------------------* 02030001
020400* SELECTON QUEUE LAYOUT                                         * 02040001
020500*---------------------------------------------------------------* 02050001
020600     COPY CNWS163.                                                02060020
020700                                                                  02070001
020800*---------------------------------------------------------------* 02080001
020900*    MAP LAYOUT                                                 * 02090001
021000*---------------------------------------------------------------* 02100001
021100     COPY CNKM219.                                                02110020
021200*                                                                 02120001
021300 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK219O.       02130023
021400     05  FILLER                         PIC X(95).                02140001
021500     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02150001
021600         10  MR-SELECTL                 PIC S9(04) COMP.          02160001
021700         10  MR-SELECTA                 PIC  X(01).               02170001
021800         10  MR-SELECTC                 PIC  X(01).               02180001
021900         10  MR-SELECTH                 PIC  X(01).               02190001
022000         10  MR-SELECTI                 PIC  X(01).               02200001
022100                                                                  02210001
022200         10  MR-ACTIONL                 PIC S9(04) COMP.          02220001
022300         10  MR-ACTIONA                 PIC  X(01).               02230001
022400         10  MR-ACTIONC                 PIC  X(01).               02240001
022500         10  MR-ACTIONH                 PIC  X(01).               02250001
022600         10  MR-ACTION                  PIC  X(03).               02260001
022700                                                                  02270001
022800         10  MR-CLUSTER-NUML            PIC S9(04) COMP.          02280001
022900         10  MR-CLUSTER-NUMA            PIC  X(01).               02290001
023000         10  MR-CLUSTER-NUMC            PIC  X(01).               02300001
023100         10  MR-CLUSTER-NUMH            PIC  X(01).               02310001
023200         10  MR-CLUSTER-NUM-X.                                    02320001
023300             15  MR-CLUSTER-NUM         PIC  ZZZ9.                02330080
023400                                                                  02340001
023500         10  MR-IP-ADDRESSL             PIC S9(04) COMP.          02350002
023600         10  MR-IP-ADDRESSA             PIC  X(01).               02360002
023700         10  MR-IP-ADDRESSC             PIC  X(01).               02370002
023800         10  MR-IP-ADDRESSH             PIC  X(01).               02380002
023900         10  MR-IP-ADDRESS              PIC  X(15).               02390002
024000                                                                  02400001
024100         10  MR-OS-RLSE-CDEL            PIC S9(04) COMP.          02410002
024200         10  MR-OS-RLSE-CDEA            PIC  X(01).               02420002
024300         10  MR-OS-RLSE-CDEC            PIC  X(01).               02430002
024400         10  MR-OS-RLSE-CDEH            PIC  X(01).               02440002
024500         10  MR-OS-RLSE-CDE             PIC  X(05).               02450002
024600                                                                  02460001
024700         10  MR-DATA-XFER-MDEL         PIC S9(04) COMP.           02470002
024800         10  MR-DATA-XFER-MDEA         PIC  X(01).                02480002
024900         10  MR-DATA-XFER-MDEC         PIC  X(01).                02490002
025000         10  MR-DATA-XFER-MDEH         PIC  X(01).                02500002
025100         10  MR-DATA-XFER-MDE          PIC  X(02).                02510002
025200                                                                  02520001
025300         10  MR-TRANSMIT-CDEL          PIC S9(04) COMP.           02530002
025400         10  MR-TRANSMIT-CDEA          PIC  X(01).                02540002
025500         10  MR-TRANSMIT-CDEC          PIC  X(01).                02550002
025600         10  MR-TRANSMIT-CDEH          PIC  X(01).                02560002
025700         10  MR-TRANSMIT-CDE           PIC  X(01).                02570002
025800                                                                  02580001
025900     05  FILLER                         PIC  X(12).               02590001
026000                                                                  02600001
026100*----------------------------------------------------------------*02610001
026200**  SECURITY SUBROUTINE PARAMETERS                                02620001
026300*----------------------------------------------------------------*02630001
026400     COPY DPWS008.                                                02640001
026500                                                                  02650001
026600*---------------------------------------------------------------* 02660001
026700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02670001
026800*---------------------------------------------------------------* 02680001
026900     COPY DPWS015.                                                02690001
027000                                                                  02700001
027100*---------------------------------------------------------------* 02710001
027200*    FUNCTION KEYS COPYBOOK.                                    * 02720001
027300*---------------------------------------------------------------* 02730001
027400     COPY DPWS016.                                                02740001
027500                                                                  02750001
027600*---------------------------------------------------------------* 02760001
027700*    NUMERIC EDIT LAYOUT.                                       * 02770001
027800*---------------------------------------------------------------* 02780001
027900     COPY DPWS010I.                                               02790001
028000                                                                  02800034
028100*---------------------------------------------------------------* 02810001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02820094
028300*---------------------------------------------------------------* 02830001
028400     COPY DPWS030.                                                02840001
CICS       COPY DPWS930.                                                02850094
028500                                                                  02851094
028600*---------------------------------------------------------------* 02860001
028700*    STANDARD COMMAREA.                                         * 02870001
028800*---------------------------------------------------------------* 02880001
028900     COPY DPWS020.                                                02890001
029000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02900001
029100                                                                  02910001
029200*---------------------------------------------------------------* 02920001
029300* INTER-APPLICATION COMMAREA.                                   * 02930001
029400*   CNWS161 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02940020
029500*             SPEC SCREEN.                                      * 02950001
029600*   CNWS162 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02960020
029700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02970001
029800*---------------------------------------------------------------* 02980001
029900         10  INTER-APPL-COMM-AREA       PIC X(200).               02990001
030000     COPY CNWS161.                                                03000020
030100     COPY CNWS162.                                                03010020
030200                                                                  03020037
030300*---------------------------------------------------------------* 03030001
030400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03040001
030500*---------------------------------------------------------------* 03050001
030600         10  ASC-SPECIFIC-COMMAREA.                               03060001
030700             15  ASC-OPER-UNT-ID        PIC  X(04).               03070001
030800             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      03080039
030900                                             PIC  Z(04).          03090039
031000             15  ASC-FCLTY-ID           PIC  X(04).               03100001
031100             15  ASC-FCLTY-NME          PIC  X(25).               03110001
031200             15  ASC-PRINTER-ID         PIC  X(08).               03120017
031300                                                                  03130001
031400**********   15  FILLER                      PIC  X(124).         03140001
031500*-----------------------------------------------------------------03150001
031600             15  ASC-BLK-SUB                  PIC S9(04) COMP     03160001
031700                                                         SYNC.    03170001
031800             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03180001
031900                                                         SYNC.    03190001
032000             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03200001
032100             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03210001
032200             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03220001
032300             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03230001
032400             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03240001
032500             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03250001
032600                                                         SYNC.    03260001
032700             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03270001
032800             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03280001
032900             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03290001
033000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03300001
033100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03310001
033200             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03320001
033300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03330001
033400                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03340001
033500             15  ASC-LIST-QUEUE-NAME.                             03350001
033600                 20  ASC-LIST-TERM-ID         PIC  X(04).         03360001
033700                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03370001
033800                 20  ASC-LIST-SEQ             PIC  9(01).         03380001
033900                                                                  03390001
034000             15  ASC-START-ITEM-REQUEST.                          03400001
034100                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03410001
034200                                                                  03420001
034300             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03430001
034400             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03440001
034500             15  ASC-CURSOR-SW                PIC  X(02).         03450011
034600                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03460011
034700                 88  ASC-CLUSTER-CURSOR              VALUE 'A '.  03470017
034800                 88  ASC-PRINTER-CURSOR              VALUE 'B '.  03480017
034900                                                                  03490037
035000             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03500001
035100                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03510001
035200             15  ASC-SEL-QUEUE-NAME.                              03520001
035300                 20  ASC-SEL-TERM-ID          PIC  X(04).         03530001
035400                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03540001
035500                 20  ASC-SEL-SEQ              PIC  9(01).         03550001
035600             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03560001
035700                                                                  03570001
035800*-----------------------------------------------------------------03580001
035900                                                                  03590001
036000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03600001
036100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03610001
036200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03620001
036300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03630001
036400                                                                  03640001
036500                 20  ASC-ITEM-ARRAY.                              03650001
036600                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03660001
036700                         30  ASC-LIST-ITEM-NUMBER                 03670001
036800                                                     PIC S9(09)   03680001
036900                                                     COMP-3.      03690001
037000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03700001
037100                             88  ASC-VALID-SELECT    VALUE ' '    03710001
037200                                                           'S'    03720001
037300                                                           'B'    03730001
037400                                                           'E'.   03740001
037500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03750001
037600                             88  ASC-TEMP-SELECT     VALUE 'S'.   03760001
037700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03770001
037800                             88  ASC-TEMP-END        VALUE 'E'.   03780001
037900                         30  ASC-SELECTED-SW         PIC  X(01).  03790001
038000                             88  ASC-NO-SELECT       VALUE ' '.   03800001
038100                             88  ASC-SELECT          VALUE 'S'.   03810001
038200                             88  ASC-BEGIN           VALUE 'B'.   03820001
038300                             88  ASC-END             VALUE 'E'.   03830001
038400                         30  ASC-ACTION              PIC  X(03).  03840001
038500                         30  ASC-CLUSTER-NUM         PIC  X(04).  03850075
038600                         30  ASC-IP-ADDRESS          PIC  X(15).  03860002
038700                         30  ASC-OS-RLSE-CDE         PIC  X(05).  03870002
038800                         30  ASC-DATA-XFER-MDE       PIC  X(02).  03880002
038900                         30  ASC-TRANSMIT-CDE        PIC  X(01).  03890002
039000                                                                  03900034
039100*---------------------------------------------------------------* 03910001
039200*    ABEND PROCESSING COPYBOOK.                                 * 03920001
039300*---------------------------------------------------------------* 03930001
039400     COPY DPWS013.                                                03940001
039500                                                                  03950001
039600*---------------------------------------------------------------* 03960002
039700*    TPRTRCL -  PRINTER CLUSTER                                 * 03970002
039800*---------------------------------------------------------------* 03980002
039900     EXEC SQL                                                     03990002
040000          INCLUDE TPRTRCL                                         04000002
040100     END-EXEC.                                                    04010002
040200*                                                                 04020016
040300*----------------------------------------------------------------*04030016
040400*    DB2 AREA FOR PRINTER TABLE                                  *04040016
040500*----------------------------------------------------------------*04050016
040600     EXEC SQL                                                     04060016
040700          INCLUDE TPRTRID                                         04070016
040800     END-EXEC.                                                    04080016
040900                                                                  04090016
041000*----------------------------------------------------------------*04100038
041100*    COMMAREA USED TO CALL XLKUT071                               04110088
041200*----------------------------------------------------------------*04120038
041300     COPY XLWS071.                                                04130088
041400                                                                  04140038
041500*---------------------------------------------------------------* 04150001
041600*    DB2 AREA FOR COMMUNICATIONS                                * 04160001
041700*---------------------------------------------------------------* 04170001
041800     EXEC SQL                                                     04180001
041900          INCLUDE SQLCA                                           04190001
042000     END-EXEC.                                                    04200001
042100                                                                  04210001
042200*---------------------------------------------------------------* 04220001
042300*    PRINTER LIST CURSOR                                        * 04230001
042400*---------------------------------------------------------------* 04240001
042500     EXEC SQL                                                     04250001
042600        DECLARE CLSTR-LIST-CSR CURSOR FOR                         04260002
042700           SELECT PRTR_CLUSTR_NBR                                 04270002
042800                 ,IP_ADDR                                         04280002
042900                 ,CLUSTR_OS_RLSE_CDE                              04290002
043000                 ,DAT_XFER_MODE_ID                                04300002
043100                 ,XMIT_INTFC_CDE                                  04310002
043200           FROM  TPRTRCL                                          04320004
043300             WHERE  CLUSTR_OPER_UNT_ID = :DK-OPER-UNT-ID          04330005
043400             AND    CLUSTR_FCLTY_ID    = :DK-FCLTY-ID             04340009
043500*LMM                                                              04350084
043600        ORDER BY PRTR_CLUSTR_NBR                                  04360083
043700     END-EXEC.                                                    04370001
043800                                                                  04380001
043900*---------------------------------------------------------------* 04390011
044000*    PRINTER ID CURSOR - WHEN PRINTER ID IS ENTERED IN CRIT SPEC* 04400011
044100*---------------------------------------------------------------* 04410011
044200     EXEC SQL                                                     04420011
044300        DECLARE PRTR-ID-CSR CURSOR FOR                            04430011
044400           SELECT A.PRTR_CLUSTR_NBR                               04440011
044500                 ,A.IP_ADDR                                       04450011
044600                 ,A.CLUSTR_OS_RLSE_CDE                            04460011
044700                 ,A.DAT_XFER_MODE_ID                              04470011
044800                 ,A.XMIT_INTFC_CDE                                04480011
044900                 ,B.PRTR_ID                                       04490011
045000           FROM TPRTRCL A                                         04500011
045100              , TPRTRID B                                         04510011
045200             WHERE  A.PRTR_CLUSTR_NBR    = B.PRTR_CLUSTR_NBR      04520014
045300             AND    A.CLUSTR_OPER_UNT_ID = :DK-OPER-UNT-ID        04530014
045400             AND    A.CLUSTR_FCLTY_ID    = :DK-FCLTY-ID           04540011
045500             AND    B.PRTR_ID            = :DK-PRINTER-ID         04550015
045600*LMM                                                              04560084
045700        ORDER BY A.PRTR_CLUSTR_NBR                                04570083
045800     END-EXEC.                                                    04580011
045900                                                                  04590001
046000 LINKAGE SECTION.                                                 04600001
046100                                                                  04610001
046200 01  DFHCOMMAREA.                                                 04620001
046300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04630001
046400                                        DEPENDING ON EIBCALEN.    04640001
046500         10  FILLER                     PIC X.                    04650001
046600                                                                  04660001
046700 PROCEDURE DIVISION.                                              04670001
046800******************************************************************04680001
046900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04690001
047000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04700001
047100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04710001
047200******************************************************************04720001
047300 0000-MAIN-MODULE.                                                04730001
047400     INITIALIZE DP030-CICS-API-FIELDS.                            04740001
047500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04750001
047600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04760001
047700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04770001
047800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04780001
047900     MOVE LENGTH OF CNK219I        TO DP030-MAP-LENGTH (1).       04790023
048000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04800001
048100     PERFORM 0001-CALL-CICS-ARCH-API.                             04810001
048200                                                                  04820037
048300     PERFORM 1000-CONTROL-PROCESSING                              04830001
048400                                                                  04840037
048500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04850001
048600     PERFORM 0001-CALL-CICS-ARCH-API.                             04860001
048700                                                                  04870001
048800******************************************************************04880001
048900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04890001
049000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04900001
049100******************************************************************04910001
049200 0001-CALL-CICS-ARCH-API.                                         04920001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04930094
049400                                    DFHCOMMAREA                   04940094
049500                                    DP030-CICS-API-FIELDS         04950094
049600                                    DP020-STANDARD-COMMAREA       04960094
049700                                    CNK219I.                      04970094
049800                                                                  04980037
049900     IF  DP030-RC-CALL-SUCCESSFUL                                 04990001
050000         CONTINUE                                                 05000001
050100     ELSE                                                         05010001
050200         SET DP013-NO-ROLLBACK                                    05020001
050300             DP013-XCTL-DISPLAY-RESTART                           05030001
050400             DP013-CICS-ABEND      TO TRUE                        05040001
050500         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        05050037
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05051094
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05052094
050800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05080001
050900         PERFORM DP013-0000-PROCESS-ABEND                         05090001
051000     END-IF.                                                      05100001
051100                                                                  05110037
051200*----------------------------------------------------------------*05120001
051300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05130001
051400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05140001
051500*                                                                *05150001
051600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05160001
051700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05170001
051800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05180001
051900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05190001
052000*----------------------------------------------------------------*05200001
052100 1000-CONTROL-PROCESSING.                                         05210001
052200                                                                  05220001
052300     EVALUATE TRUE                                                05230001
052400         WHEN DP020-NEXT-ACT-INITIAL                              05240001
052500             INITIALIZE ASC-SPECIFIC-COMMAREA                     05250001
052600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05260001
052700                                      ASC-SEL-TERM-ID             05270001
052800             MOVE DP020-SRC-TASK-NUMBER                           05280001
052900                                   TO ASC-LIST-TASK-NUMBER        05290001
053000                                      ASC-SEL-TASK-NUMBER         05300001
053100             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               05310037
053200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05320001
053300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05330001
053400                                                                  05340037
053500***-----$TEMPLATE NOTE$-------------------------------------------05350001
053600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05360001
053700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05370001
053800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05380001
053900***---------------------------------------------------------------05390001
054000             IF  PS-COMMAREA-NOT-VALID                            05400001
054100                 SET DP020-NEXT-ACT-APPL-ERROR                    05410001
054200                                   TO TRUE                        05420001
054300             ELSE                                                 05430001
054400                 PERFORM 4000-BUILD-INITIAL-PANEL                 05440001
054500             END-IF                                               05450001
054600                                                                  05460001
054700         WHEN DP020-NEXT-ACT-READ-MAP                             05470001
054800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05480001
054900                                   TO PV-TOP-ITEM                 05490001
055000             PERFORM 2000-PROCESS-PANEL                           05500001
055100*F3                                                               05510069
055200         WHEN DP020-NEXT-ACT-RETURN                               05520070
055300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05530001
055400                                   TO PV-TOP-ITEM                 05540001
055500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05550001
055600             IF CN162-ADD                                         05560081
055700                PERFORM 2050-DELETE-LIST-QUEUE                    05570081
055800                PERFORM 4000-BUILD-INITIAL-PANEL                  05580081
055900             ELSE                                                 05590081
056000                PERFORM 6000-REFRESH-PANEL-FROM-TEMP              05600081
056100                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              05610081
056200             END-IF                                               05620081
056300                                                                  05630081
056400         WHEN OTHER                                               05640001
056500             SET DP013-LOGIC-ABEND TO TRUE                        05650001
056600             SET DP013-NO-ROLLBACK TO TRUE                        05660001
056700             MOVE '1000-CONTROL-PROCESSING'                       05670001
056800                                   TO DP013-PARAGRAPH             05680001
056900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05690001
057000                                   TO DP013-MESSAGE-TEXT(1)       05700001
057100             PERFORM DP013-0000-PROCESS-ABEND                     05710001
057200     END-EVALUATE.                                                05720001
057300                                                                  05730001
057400*----------------------------------------------------------------*05740001
057500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05750001
057600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05760001
057700*----------------------------------------------------------------*05770001
057800 1100-PROCESS-INTER-APPL-COMM.                                    05780001
057900                                                                  05790001
058000     SET PS-COMMAREA-VALID         TO TRUE.                       05800001
058100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05810001
058200                                                                  05820001
058300     EVALUATE  DP020-INT-APPL-FORMAT-IND                          05830024
058400         WHEN PC-CRIT-SPEC-FORMAT                                 05840024
058500             MOVE CN161-OPER-UNT-ID       TO ASC-OPER-UNT-ID      05850024
058600             MOVE CN161-FCLTY-ID          TO ASC-FCLTY-ID         05860024
058700             MOVE CN161-FCLTY-NME         TO ASC-FCLTY-NME        05870024
058800                                                                  05880024
058900         WHEN PC-INTER-APPL-LIST-ADD                              05890024
059000             SET ASC-USE-SELECTION-QUEUE TO TRUE                  05900024
059100             MOVE CN162-NUMBER-OF-SELECTED-ITEMS                  05910024
059200                                   TO ASC-NUMBER-OF-SELECTED-ITEMS05920024
059300             MOVE CN162-NUMBER-OF-TS-ITEMS                        05930024
059400                                   TO ASC-NUMBER-OF-TS-ITEMS      05940024
059500             MOVE CN162-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME      05950024
059600             MOVE CN162-OPER-UNT-ID TO ASC-OPER-UNT-ID            05960024
059700             MOVE CN162-FCLTY-ID TO ASC-FCLTY-ID                  05970024
059800             MOVE CN162-FCLTY-NME TO ASC-FCLTY-NME                05980024
059900                                                                  05990024
060000         WHEN PC-INTER-APPL-LIST-UPDATE                           06000024
060100             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06010024
060200             MOVE CN162-NUMBER-OF-SELECTED-ITEMS                  06020024
060300                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06030024
060400             MOVE CN162-NUMBER-OF-TS-ITEMS                        06040024
060500                                        TO ASC-NUMBER-OF-TS-ITEMS 06050024
060600             MOVE CN162-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME      06060024
060700             MOVE CN162-OPER-UNT-ID TO ASC-OPER-UNT-ID            06070024
060800             MOVE CN162-FCLTY-ID TO ASC-FCLTY-ID                  06080024
060900             MOVE CN162-FCLTY-NME TO ASC-FCLTY-NME                06090024
061000                                                                  06100024
061100         WHEN OTHER                                               06110024
061200             MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER       06120024
061300             SET  PS-COMMAREA-NOT-VALID TO TRUE                   06130024
061400       END-EVALUATE.                                              06140024
061500                                                                  06150001
061600*----------------------------------------------------------------*06160001
061700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06170001
061800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06180001
061900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06190001
062000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06200001
062100* FUNCTION KEYS CAN GET THIS FAR.                                *06210001
062200*----------------------------------------------------------------*06220001
062300 2000-PROCESS-PANEL.                                              06230001
062400     EVALUATE TRUE                                                06240001
062500         WHEN DP020-SRC-AID = DP016-CLEAR                         06250001
062600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06260001
062700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06270001
062800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06280001
062900                                                                  06290001
063000*F5-REFRESH                                                       06300062
063100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06310001
063200             PERFORM 2050-DELETE-LIST-QUEUE                       06320001
063300             PERFORM 4000-BUILD-INITIAL-PANEL                     06330001
063400                                                                  06340001
063500*F9-DESELECT                                                      06350062
063600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06360001
063700             PERFORM 2140-DESELECT-ALL-ITEMS                      06370001
063800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06380001
063900                                                                  06390001
064000*F21-SELECT ALL                                                   06400062
064100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06410001
064200             PERFORM 2150-SELECT-ALL-ITEMS                        06420001
064300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06430001
064400                                                                  06440001
064500         WHEN OTHER                                               06450001
064600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06460001
064700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06470001
064800             IF  PS-NO-ERROR                                      06480001
064900                 SET DP030-CONTINUE-GO                            06490001
065000                                 TO TRUE                          06500001
065100                 PERFORM 2100-CHECK-FUNCTION-KEY                  06510001
065200             ELSE                                                 06520001
065300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06530001
065400                 SET DP030-OVERRIDE-GO                            06540001
065500                                 TO TRUE                          06550001
065600             END-IF                                               06560001
065700     END-EVALUATE.                                                06570001
065800                                                                  06580034
065900*----------------------------------------------------------------*06590001
066000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06600001
066100*----------------------------------------------------------------*06610001
066200 2050-DELETE-LIST-QUEUE.                                          06620001
066300                                                                  06630001
066400     EXEC CICS                                                    06640001
066500         DELETEQ TS                                               06650001
066600             QUEUE (ASC-LIST-QUEUE-NAME)                          06660001
066700             RESP  (PV-CICS-RESP)                                 06670001
066800     END-EXEC.                                                    06680001
066900                                                                  06690001
067000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06700001
067100        (PV-CICS-RESP = DFHRESP(QIDERR))                          06710001
067200         CONTINUE                                                 06720001
067300     ELSE                                                         06730001
067400         SET DP013-CICS-ABEND      TO TRUE                        06740001
067500         SET DP013-NO-ROLLBACK     TO TRUE                        06750001
067600                                                                  06760001
067700         MOVE '2050-DELETE-LIST-QUEUE'                            06770001
067800                                   TO DP013-PARAGRAPH             06780001
067900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06790001
068000                                   TO DP013-MESSAGE-TEXT (1)      06800001
068100         PERFORM DP013-0000-PROCESS-ABEND                         06810001
068200     END-IF.                                                      06820001
068300                                                                  06830001
068400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06840001
068500                                                                  06850034
068600*----------------------------------------------------------------*06860001
068700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06870001
068800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06880001
068900* CICS ARCHITECTURE API.                                         *06890001
069000*----------------------------------------------------------------*06900001
069100 2100-CHECK-FUNCTION-KEY.                                         06910001
069200                                                                  06920001
069300     EVALUATE TRUE                                                06930001
069400*                                                                 06940001
069500* F13 - PRINTER CLUSTER ADD                                       06950041
069600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06960001
069700                 INITIALIZE CN162-INTER-APPL-COMMAREA             06970020
069800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06980001
069900                                TO CN162-NUMBER-OF-SELECTED-ITEMS 06990020
070000                 MOVE ASC-OPER-UNT-ID TO CN162-OPER-UNT-ID        07000026
070100                 MOVE ASC-FCLTY-ID    TO CN162-FCLTY-ID           07010031
070200                 MOVE ASC-FCLTY-NME   TO CN162-FCLTY-NME          07020041
070300                 SET CN162-ADD        TO TRUE                     07030080
070400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07040001
070500*                                                                 07050001
070600* F15 - PRINTER CLUSTER UPDATE                                    07060041
070700         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07070001
070800              IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07080066
070900                 INITIALIZE CN162-INTER-APPL-COMMAREA             07090066
071000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07100066
071100                                 TO CN162-NUMBER-OF-SELECTED-ITEMS07110066
071200                 MOVE ASC-OPER-UNT-ID TO CN162-OPER-UNT-ID        07120026
071300                 MOVE ASC-FCLTY-ID  TO CN162-FCLTY-ID             07130026
071400                 MOVE ASC-FCLTY-NME TO CN162-FCLTY-NME            07140026
071500                 SET CN162-UPD        TO TRUE                     07150080
071600                 PERFORM 5000-PREPARE-SEL-QUEUE                   07160001
071700             ELSE                                                 07170001
071800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07180001
071900                 SET DP030-OVERRIDE-GO TO TRUE                    07190030
072000                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         07200028
072100                 SET DP020-MSG-WARNING TO TRUE                    07210028
072200             END-IF                                               07220001
072300*                                                                 07230041
072400* F17 - PRINTER CLUSTER DELETE                                    07240041
072500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07250041
072600             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07260041
072700                 INITIALIZE CN162-INTER-APPL-COMMAREA             07270041
072800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07280041
072900                                TO CN162-NUMBER-OF-SELECTED-ITEMS 07290041
073000                 MOVE ASC-OPER-UNT-ID TO CN162-OPER-UNT-ID        07300041
073100                 MOVE ASC-FCLTY-ID  TO CN162-FCLTY-ID             07310041
073200                 MOVE ASC-FCLTY-NME TO CN162-FCLTY-NME            07320041
073300                 SET CN162-DEL        TO TRUE                     07330080
073400                 PERFORM 5000-PREPARE-SEL-QUEUE                   07340041
073500             ELSE                                                 07350041
073600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07360041
073700                 SET DP030-OVERRIDE-GO TO TRUE                    07370041
073800                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         07380041
073900                 SET DP020-MSG-WARNING TO TRUE                    07390041
074000             END-IF                                               07400041
074100*                                                                 07410041
074200* F6 - FIRST PAGE                                                 07420001
074300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07430001
074400             MOVE +1               TO PV-TOP-ITEM                 07440001
074500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07450001
074600*                                                                 07460001
074700* F7 - PREVIOUS PAGE                                              07470001
074800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07480001
074900             PERFORM 2110-BROWSE-BACKWARD                         07490001
075000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07500001
075100*                                                                 07510001
075200* F8 - NEXT PAGE                                                  07520001
075300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07530001
075400             PERFORM 2120-BROWSE-FORWARD                          07540001
075500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07550001
075600*                                                                 07560001
075700* ENTER KEY                                                       07570001
075800         WHEN DP020-SRC-AID = DP016-ENTER                         07580001
075900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07590001
076000             IF  PS-ERROR                                         07600001
076100                 CONTINUE                                         07610001
076200             ELSE                                                 07620001
076300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07630001
076400             END-IF                                               07640001
076500                                                                  07650001
076600         WHEN OTHER                                               07660001
076700             SET DP013-NO-ROLLBACK                                07670001
076800                 DP013-XCTL-DISPLAY-RESTART                       07680001
076900                 DP013-CICS-ABEND  TO TRUE                        07690001
077000             MOVE '2100-CHECK-FUNCTION-KEY'                       07700001
077100                                   TO DP013-PARAGRAPH             07710001
077200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07720001
077300                                   TO DP013-MESSAGE-TEXT (1)      07730001
077400             PERFORM DP013-0000-PROCESS-ABEND                     07740001
077500     END-EVALUATE.                                                07750001
077600                                                                  07760001
077700*----------------------------------------------------------------*07770001
077800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07780001
077900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07790001
078000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07800001
078100*    MESSAGE.                                                    *07810001
078200*----------------------------------------------------------------*07820001
078300 2110-BROWSE-BACKWARD.                                            07830001
078400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07840001
078500         GIVING PV-TOP-ITEM.                                      07850001
078600*                                                                 07860001
078700     IF  ((PV-TOP-ITEM < +1)                                      07870001
078800       OR (PV-TOP-ITEM = +1))                                     07880001
078900         MOVE +1                   TO PV-TOP-ITEM                 07890001
079000*        -- TOP OF LIST --                                        07900001
079100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07910001
079200         SET DP020-MSG-INFORMATIONAL TO TRUE                      07920001
079300     END-IF.                                                      07930001
079400                                                                  07940001
079500*----------------------------------------------------------------*07950001
079600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07960001
079700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07970001
079800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07980001
079900*----------------------------------------------------------------*07990001
080000 2120-BROWSE-FORWARD.                                             08000001
080100                                                                  08010001
080200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08020001
080300         GIVING PV-TOP-ITEM.                                      08030001
080400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08040001
080500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08050001
080600                                   TO PV-TOP-ITEM                 08060001
080700*        -- BOTTOM OF LIST --                                     08070001
080800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08080001
080900         SET DP020-MSG-INFORMATIONAL                              08090001
081000                                   TO TRUE                        08100001
081100     ELSE                                                         08110001
081200         COMPUTE PV-BOTTOM-ITEM =                                 08120001
081300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08130001
081400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08140001
081500*            -- BOTTOM OF LIST --                                 08150001
081600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08160001
081700             SET DP020-MSG-INFORMATIONAL                          08170001
081800                                   TO TRUE                        08180001
081900         END-IF                                                   08190001
082000     END-IF.                                                      08200001
082100                                                                  08210034
082200*----------------------------------------------------------------*08220001
082300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08230001
082400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08240001
082500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08250001
082600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08260001
082700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08270001
082800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08280001
082900*----------------------------------------------------------------*08290001
083000 2130-CHECK-FOR-JUMP-BROWSE.                                      08300001
083100     SET PS-NO-ERROR               TO TRUE.                       08310001
083200     IF (ASC-START-ITEM-REQUEST = SPACE)                          08320001
083300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08330001
083400                                   TO PV-TOP-ITEM                 08340001
083500     ELSE                                                         08350001
083600         MOVE ASC-START-ITEM-REQUEST                              08360001
083700                                   TO DP010I-UNEDITED-FIELD       08370001
083800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08380001
083900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08390001
084000         SET DP010I-NEGATIVE-NOT-ALLOWED                          08400001
084100                                   TO TRUE                        08410001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08421093
263455              USING DP010I-NUMERIC-EDIT-AREA                      08422093
084300                                                                  08430001
084400         IF  NOT DP010I-ERROR-DETECTED                            08440001
084500             MOVE DP010I-NUMERIC-FIELD                            08450001
084600                                   TO  ASC-START-ITEM-REQUEST-N   08460001
084700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08470001
084800                 IF  ASC-START-ITEM-REQUEST-N >                   08480001
084900                                          ASC-NUMBER-OF-ITEMS-READ08490001
085000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08500001
085100                     COMPUTE PV-TOP-ITEM =                        08510001
085200                             ASC-NUMBER-OF-ITEMS-READ             08520001
085300                             - PC-ITEMS-PER-PANEL + 1             08530001
085400                     IF  PV-TOP-ITEM < +1                         08540001
085500                         MOVE +1   TO PV-TOP-ITEM                 08550001
085600                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 08560028
085700                         SET DP020-MSG-INFORMATIONAL TO TRUE      08570028
085800                     END-IF                                       08580001
085900                 ELSE                                             08590001
086000                     MOVE ASC-START-ITEM-REQUEST-N                08600001
086100                                   TO PV-TOP-ITEM                 08610001
086200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08620001
086300                     COMPUTE PV-BOTTOM-ITEM =                     08630001
086400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08640001
086500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08650001
086600*                        -- BOTTOM OF LIST --                     08660001
086700                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 08670028
086800                         SET DP020-MSG-INFORMATIONAL TO TRUE      08680028
086900                     END-IF                                       08690001
087000                 END-IF                                           08700001
087100             ELSE                                                 08710001
087200*                --- VALUE OUT OF RANGE ----                      08720001
087300                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         08730028
087400                 MOVE -1           TO ASTRTITL                    08740001
087500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08750028
087600                 MOVE DP015-REVERSE TO ASTRTITH                   08760028
087700                 MOVE DP015-RED    TO ASTRTITC                    08770001
087800                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           08780028
087900                 SET DP020-MSG-FATAL TO TRUE                      08790028
088000                 SET PS-ERROR      TO TRUE                        08800001
088100             END-IF                                               08810001
088200                                                                  08820001
088300         ELSE                                                     08830001
088400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08840001
088500             MOVE -1               TO ASTRTITL                    08850001
088600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08860001
088700             MOVE DP015-REVERSE    TO ASTRTITH                    08870001
088800             MOVE DP015-RED        TO ASTRTITC                    08880001
088900             MOVE DP015-UNP-NUM-BRT-MDT                           08890001
089000                                   TO ASTRTITA                    08900001
089100             SET DP020-MSG-FATAL   TO TRUE                        08910001
089200             SET PS-ERROR          TO TRUE                        08920001
089300         END-IF                                                   08930001
089400     END-IF.                                                      08940001
089500                                                                  08950034
089600*----------------------------------------------------------------*08960001
089700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08970001
089800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08980001
089900*----------------------------------------------------------------*08990001
090000 2140-DESELECT-ALL-ITEMS.                                         09000001
090100     MOVE +1                       TO ASC-BLK-SUB.                09010001
090200                                                                  09020001
090300     PERFORM 2141-CLEAR-SELECTED-INDS                             09030001
090400         VARYING ASC-ITEM-SUB                                     09040001
090500         FROM 1 BY 1                                              09050001
090600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09060001
090700                                                                  09070001
090800     ADD +1                        TO ASC-BLK-SUB.                09080001
090900                                                                  09090001
091000     PERFORM 2141-CLEAR-SELECTED-INDS                             09100001
091100         VARYING ASC-ITEM-SUB                                     09110001
091200         FROM 1 BY 1                                              09120001
091300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09130001
091400                                                                  09140001
091500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09150001
091600                                   TO PV-LIST-ITEM-NUMBER.        09160001
091700                                                                  09170001
091800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09180001
091900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09190001
092000                                                                  09200001
092100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09210001
092200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09220001
092300         MOVE +1                   TO ASC-BLK-SUB                 09230001
092400                                                                  09240001
092500         PERFORM 5100-WRITE-TEMP-STORAGE                          09250001
092600                                                                  09260001
092700         MOVE +1                   TO PV-BLOCK-NUMBER             09270001
092800                                                                  09280001
092900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09290001
093000             PV-FIRST-BLOCK-IN-ARRAY - 1                          09300001
093100                                                                  09310001
093200         PERFORM                                                  09320001
093300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09330001
093400                                                                  09340001
093500             PERFORM 4410-READ-TEMP-STORAGE                       09350001
093600                                                                  09360001
093700             PERFORM 2141-CLEAR-SELECTED-INDS                     09370001
093800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09380001
093900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09390001
094000                                                                  09400001
094100             PERFORM 5100-WRITE-TEMP-STORAGE                      09410001
094200                                                                  09420001
094300             ADD +1                TO PV-BLOCK-NUMBER             09430001
094400                                                                  09440001
094500         END-PERFORM                                              09450001
094600                                                                  09460001
094700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09470001
094800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09480001
094900                                                                  09490001
095000         PERFORM                                                  09500001
095100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09510001
095200                   ASC-HIGHEST-BLOCK-WRITTEN                      09520001
095300                                                                  09530001
095400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09540001
095500                                   TO PV-BLOCK-NUMBER             09550001
095600                                                                  09560001
095700             PERFORM 4410-READ-TEMP-STORAGE                       09570001
095800                                                                  09580001
095900             PERFORM 2141-CLEAR-SELECTED-INDS                     09590001
096000                 VARYING ASC-ITEM-SUB                             09600001
096100                 FROM 1 BY 1                                      09610001
096200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09620001
096300                                                                  09630001
096400             PERFORM 5100-WRITE-TEMP-STORAGE                      09640001
096500                                                                  09650001
096600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09660001
096700                                                                  09670001
096800         END-PERFORM                                              09680001
096900                                                                  09690001
097000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09700001
097100                                   TO PV-BLOCK-NUMBER             09710001
097200                                                                  09720001
097300         PERFORM 4410-READ-TEMP-STORAGE                           09730001
097400     END-IF.                                                      09740001
097500                                                                  09750001
097600                                                                  09760001
097700     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09770001
097800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09780001
097900     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09790001
098000                                                                  09800001
098100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09810001
098200                                                                  09820034
098300*----------------------------------------------------------------*09830001
098400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09840001
098500*----------------------------------------------------------------*09850001
098600 2141-CLEAR-SELECTED-INDS.                                        09860001
098700                                                                  09870001
098800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09880001
098900             NOT EQUAL ZERO                                       09890001
099000         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09900001
099100             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09910001
099200                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09920001
099300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09930001
099400                                   TO TRUE                        09940001
099500         END-IF                                                   09950001
099600     END-IF.                                                      09960001
099700                                                                  09970001
099800*----------------------------------------------------------------*09980001
099900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09990001
100000*  FOR ALL ITEMS.                                                *10000001
100100*----------------------------------------------------------------*10010001
100200 2150-SELECT-ALL-ITEMS.                                           10020001
100300                                                                  10030001
100400     MOVE +1                       TO ASC-BLK-SUB.                10040001
100500                                                                  10050001
100600     PERFORM 2151-SET-SELECTED-INDS                               10060001
100700         VARYING ASC-ITEM-SUB                                     10070001
100800         FROM 1 BY 1                                              10080001
100900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10090001
101000                                                                  10100001
101100     ADD +1                        TO ASC-BLK-SUB.                10110001
101200                                                                  10120001
101300     PERFORM 2151-SET-SELECTED-INDS                               10130001
101400         VARYING ASC-ITEM-SUB                                     10140001
101500         FROM 1 BY 1                                              10150001
101600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10160001
101700                                                                  10170001
101800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10180001
101900                                   TO PV-LIST-ITEM-NUMBER.        10190001
102000                                                                  10200001
102100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10210001
102200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10220001
102300                                                                  10230001
102400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10240001
102500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10250001
102600         MOVE +1                   TO ASC-BLK-SUB                 10260001
102700                                                                  10270001
102800         PERFORM 5100-WRITE-TEMP-STORAGE                          10280001
102900                                                                  10290001
103000         MOVE +1                   TO PV-BLOCK-NUMBER             10300001
103100                                                                  10310001
103200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10320001
103300             PV-FIRST-BLOCK-IN-ARRAY - 1                          10330001
103400                                                                  10340001
103500         PERFORM                                                  10350001
103600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10360001
103700                                                                  10370001
103800             PERFORM 4410-READ-TEMP-STORAGE                       10380001
103900                                                                  10390001
104000             PERFORM 2151-SET-SELECTED-INDS                       10400001
104100                 VARYING ASC-ITEM-SUB                             10410001
104200                 FROM 1 BY 1                                      10420001
104300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10430001
104400                                                                  10440001
104500             PERFORM 5100-WRITE-TEMP-STORAGE                      10450001
104600                                                                  10460001
104700             ADD +1                TO PV-BLOCK-NUMBER             10470001
104800                                                                  10480001
104900         END-PERFORM                                              10490001
105000                                                                  10500001
105100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10510001
105200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10520001
105300                                                                  10530001
105400         PERFORM                                                  10540001
105500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10550001
105600                   ASC-HIGHEST-BLOCK-WRITTEN                      10560001
105700                                                                  10570001
105800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10580001
105900                                   TO PV-BLOCK-NUMBER             10590001
106000                                                                  10600001
106100             PERFORM 4410-READ-TEMP-STORAGE                       10610001
106200                                                                  10620001
106300             PERFORM 2151-SET-SELECTED-INDS                       10630001
106400                 VARYING ASC-ITEM-SUB                             10640001
106500                 FROM 1 BY 1                                      10650001
106600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10660001
106700                                                                  10670001
106800             PERFORM 5100-WRITE-TEMP-STORAGE                      10680001
106900                                                                  10690001
107000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10700001
107100                                                                  10710001
107200         END-PERFORM                                              10720001
107300                                                                  10730001
107400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10740001
107500                                   TO PV-BLOCK-NUMBER             10750001
107600                                                                  10760001
107700         PERFORM 4410-READ-TEMP-STORAGE                           10770001
107800     END-IF.                                                      10780001
107900                                                                  10790001
108000                                                                  10800001
108100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10810001
108200                       ASC-NUMBER-OF-SELECTED-ITEMS.              10820001
108300                                                                  10830001
108400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10840001
108500                                                                  10850001
108600*----------------------------------------------------------------*10860001
108700*    MARK EACH ITEM AS BEING SELECTED.                           *10870001
108800*----------------------------------------------------------------*10880001
108900 2151-SET-SELECTED-INDS.                                          10890001
109000                                                                  10900001
109100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10910001
109200             NOT EQUAL ZERO                                       10920001
109300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10930001
109400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10940001
109500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10950001
109600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10960001
109700                               TO  TRUE                           10970001
109800         END-IF                                                   10980001
109900     END-IF.                                                      10990001
110000                                                                  11000037
110100******************************************************************11010001
110200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11020001
110300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11030001
110400******************************************************************11040001
110500 2200-MOVE-SCREEN-TO-COMMAREA.                                    11050001
110600                                                                  11060001
110700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11070001
110800     MOVE +1                       TO PV-SUB.                     11080001
110900                                                                  11090037
111000     PERFORM 3100-SET-SUBSCRIPTS.                                 11100001
111100     IF  ASTRTITL > ZERO                                          11110001
111200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11120001
111300     ELSE                                                         11130001
111400         IF  ASTRTITF = DP015-ERASE-EOF                           11140001
111500             INITIALIZE ASC-START-ITEM-REQUEST                    11150001
111600         END-IF                                                   11160001
111700     END-IF.                                                      11170001
111800                                                                  11180001
111900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11190001
112000         VARYING PV-SUB                                           11200001
112100         FROM 1 BY 1                                              11210001
112200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11220001
112300                                                                  11230037
112400******************************************************************11240001
112500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**11250001
112600******************************************************************11260001
112700 2210-MOVE-LINES-TO-COMMAREA.                                     11270001
112800     IF  MR-SELECTL (PV-SUB) > ZERO                               11280001
112900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11290001
113000         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        11300037
113100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11310001
113200     ELSE                                                         11320001
113300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11330001
113400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11340001
113500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11350001
113600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11360001
113700         END-IF                                                   11370001
113800     END-IF.                                                      11380001
113900                                                                  11390001
114000     ADD +1                        TO ASC-ITEM-SUB.               11400001
114100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11410001
114200         ADD +1                    TO ASC-BLK-SUB                 11420001
114300         MOVE +1                   TO ASC-ITEM-SUB                11430001
114400     END-IF.                                                      11440001
114500                                                                  11450037
114600******************************************************************11460001
114700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **11470001
114800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11480001
114900******************************************************************11490001
115000 3000-EDIT-DATA-IN-COMMAREA.                                      11500001
115100     SET PS-NO-ERROR               TO TRUE.                       11510001
115200     PERFORM 3200-RESET-ATTRIBUTES.                               11520001
115300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11530001
115400                                                                  11540001
115500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11550001
115600* EDITTING IS DONE FROM THE BOTTOM UP.                            11560001
115700**                                                                11570001
115800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11580001
115900         ASC-ITEMS-DISPLAYED - 1.                                 11590001
116000     PERFORM 3100-SET-SUBSCRIPTS.                                 11600001
116100                                                                  11610001
116200      IF  PS-NO-ERROR                                             11620001
116300          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       11630001
116400      END-IF.                                                     11640001
116500*                                                                 11650001
116600     IF  PS-NO-ERROR                                              11660001
116700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11670001
116800     END-IF.                                                      11680001
116900*                                                                 11690001
117000     IF  ((PS-NO-ERROR)                                           11700001
117100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11710001
117200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11720001
117300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11730001
117400     END-IF.                                                      11740001
117500                                                                  11750001
117600     IF ASC-OPER-UNT-ID = (SPACES OR ZEROES)                      11760036
117700         SET PS-ERROR                                             11770036
117800             DP020-MSG-FATAL         TO TRUE                      11780036
117900         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          11790036
118000         MOVE DP015-UNP-ALP-BRT-OFF  TO AOPERA                    11800036
118100         MOVE DP015-RED              TO AOPERC                    11810036
118200         MOVE DP015-REVERSE          TO AOPERH                    11820036
118300         MOVE -1                     TO AOPERL                    11830036
118400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      11840036
118500     ELSE                                                         11850036
118600         MOVE ASC-OPER-UNT-ID         TO DP010I-UNEDITED-FIELD    11860039
118700         MOVE LENGTH OF ASC-OPER-UNT-ID TO DP010I-MAXIMUM-DIGITS  11870036
118800         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   11880036
118900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  11890036
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11901093
263455              USING DP010I-NUMERIC-EDIT-AREA                      11902093
119100         IF      DP010I-ERROR-DETECTED                            11910036
119200             SET PS-ERROR                                         11920036
119300                 DP020-MSG-FATAL TO TRUE                          11930036
119400             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             11940036
119500             MOVE DP015-UNP-ALP-BRT-OFF TO AOPERA                 11950036
119600             MOVE DP015-RED          TO AOPERC                    11960036
119700             MOVE DP015-REVERSE      TO AOPERH                    11970036
119800             MOVE -1                 TO AOPERL                    11980036
119900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11990036
120000         ELSE                                                     12000036
120100             MOVE DP010I-NUMERIC-FIELD TO ASC-OPER-UNT-ID-N       12010039
120200             MOVE ASC-OPER-UNT-ID TO AOPERO                       12020036
120300             PERFORM 3010-VALIDATE-OPER-UNT-ID                    12030036
121400         END-IF                                                   12140036
121500     END-IF.                                                      12150036
121600                                                                  12160036
121700*----------------------------------------------------------------*12170001
121800* 3005-EDIT-COMMAREA-BLOCKS                                      *12180001
121900*----------------------------------------------------------------*12190001
122000 3005-EDIT-COMMAREA-BLOCKS.                                       12200001
122100     MOVE +1                       TO PV-BLOCK-NUMBER.            12210001
122200     MOVE +1                       TO ASC-BLK-SUB.                12220001
122300     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               12230001
122400                                                                  12240001
122500     COMPUTE PV-BLOCK-NUMBER  =                                   12250001
122600             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            12260001
122700             PC-ITEMS-PER-PANEL.                                  12270001
122800                                                                  12280001
122900     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          12290001
123000                                                                  12300001
123100     PERFORM                                                      12310001
123200        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         12320001
123300           OR PS-ERROR                                            12330001
123400           OR PS-BLOCK-ERROR                                      12340001
123500                                                                  12350001
123600              COMPUTE PV-ITEMS-HOLD  =                            12360001
123700                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       12370001
123800                      PC-ITEMS-PER-PANEL - 1                      12380001
123900                                                                  12390001
124000               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     12400001
124100                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             12410001
124200                       FROM  PV-ITEMS-HOLD                        12420001
124300                     GIVING  PV-ITEMS-DIFF                        12430001
124400                   SUBTRACT  PV-ITEMS-DIFF                        12440001
124500                       FROM  PC-ITEMS-PER-PANEL                   12450001
124600                     GIVING  PV-ITEMS-HOLD                        12460001
124700                       MOVE  PV-ITEMS-HOLD TO PV-SUB              12470001
124800                                              ASC-ITEM-SUB        12480001
124900                                              ASC-ITEMS-DISPLAYED 12490001
125000                                                                  12500001
125100               ELSE                                               12510001
125200                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            12520001
125300                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      12530001
125400               END-IF                                             12540001
125500                                                                  12550001
125600               PERFORM 3300-EDIT-SELECTIONS                       12560001
125700                       VARYING PV-SUB                             12570001
125800                          FROM PV-SUB BY -1                       12580001
125900                          UNTIL PV-SUB < +1                       12590001
126000                                                                  12600001
126100               MOVE +1               TO ASC-BLK-SUB               12610001
126200                                                                  12620001
126300               PERFORM 5105-REWRITE-ASC-LISTQ                     12630001
126400                                                                  12640001
126500               MOVE +1                TO ASC-BLK-SUB              12650001
126600                                                                  12660001
126700               IF  PS-BLOCK-ERROR                                 12670001
126800                   SET  PS-ERROR     TO TRUE                      12680001
126900                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      12690001
127000                                     TO PV-TOP-ITEM               12700001
127100               ELSE                                               12710001
127200                   ADD  +1           TO PV-BLOCK-NUMBER           12720001
127300                   IF  PV-BLOCK-NUMBER >                          12730001
127400                       ASC-HIGHEST-BLOCK-WRITTEN                  12740001
127500                       MOVE +2       TO ASC-BLK-SUB               12750001
127600                       PERFORM 4410-READ-TEMP-STORAGE             12760001
127700                       MOVE +1       TO ASC-BLK-SUB               12770001
127800                   ELSE                                           12780001
127900                       PERFORM 4410-READ-TEMP-STORAGE             12790001
128000                       ADD  +1        TO PV-BLOCK-NUMBER          12800001
128100                       MOVE +2        TO ASC-BLK-SUB              12810001
128200                       PERFORM 4410-READ-TEMP-STORAGE             12820001
128300                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          12830001
128400                       MOVE +1        TO ASC-BLK-SUB              12840001
128500               END-IF                                             12850001
128600           END-IF                                                 12860001
128700     END-PERFORM.                                                 12870001
128800                                                                  12880001
128900     IF  PV-ORIGINAL-BLOCK  = +1    OR                            12890001
129000         PS-ERROR                   OR                            12900001
129100         PS-BLOCK-ERROR                                           12910001
129200             CONTINUE                                             12920001
129300     ELSE                                                         12930001
129400         MOVE +1                 TO PV-BLOCK-NUMBER               12940001
129500         MOVE +1                 TO ASC-BLK-SUB                   12950001
129600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  12960001
129700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           12970001
129800         PERFORM 4410-READ-TEMP-STORAGE                           12980001
129900                                                                  12990001
130000         PERFORM                                                  13000001
130100            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             13010001
130200               OR PS-ERROR                                        13020001
130300               OR PS-BLOCK-ERROR                                  13030001
130400                                                                  13040001
130500                  COMPUTE PV-ITEMS-HOLD  =                        13050001
130600                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   13060001
130700                          PC-ITEMS-PER-PANEL - 1                  13070001
130800                                                                  13080001
130900                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    13090001
131000                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          13100001
131100                          FROM  PV-ITEMS-HOLD                     13110001
131200                        GIVING  PV-ITEMS-DIFF                     13120001
131300                      SUBTRACT  PV-ITEMS-DIFF                     13130001
131400                          FROM  PC-ITEMS-PER-PANEL                13140001
131500                        GIVING  PV-ITEMS-HOLD                     13150001
131600                          MOVE  PV-ITEMS-HOLD TO PV-SUB           13160001
131700                                                 ASC-ITEM-SUB     13170001
131800                                              ASC-ITEMS-DISPLAYED 13180001
131900                  ELSE                                            13190001
132000                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         13200001
132100                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   13210001
132200                  END-IF                                          13220001
132300                                                                  13230001
132400                  PERFORM 3300-EDIT-SELECTIONS                    13240001
132500                          VARYING PV-SUB                          13250001
132600                             FROM PV-SUB BY -1                    13260001
132700                            UNTIL PV-SUB < +1                     13270001
132800                                                                  13280001
132900                                                                  13290001
133000                  MOVE +1               TO ASC-BLK-SUB            13300001
133100                                                                  13310001
133200                  PERFORM 5105-REWRITE-ASC-LISTQ                  13320001
133300                                                                  13330001
133400                  MOVE +1                TO ASC-BLK-SUB           13340001
133500                                                                  13350001
133600                  IF  PS-BLOCK-ERROR                              13360001
133700                      SET  PS-ERROR     TO TRUE                   13370001
133800                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   13380001
133900                                        TO PV-TOP-ITEM            13390001
134000                  ELSE                                            13400001
134100                      ADD  +1            TO PV-BLOCK-NUMBER       13410001
134200                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     13420001
134300                          MOVE +2        TO ASC-BLK-SUB           13430001
134400                          PERFORM 4410-READ-TEMP-STORAGE          13440001
134500                          MOVE +1        TO ASC-BLK-SUB           13450001
134600                      ELSE                                        13460001
134700                          PERFORM 4410-READ-TEMP-STORAGE          13470001
134800                          ADD  +1        TO PV-BLOCK-NUMBER       13480001
134900                          MOVE +2        TO ASC-BLK-SUB           13490001
135000                          PERFORM 4410-READ-TEMP-STORAGE          13500001
135100                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       13510001
135200                          MOVE +1        TO ASC-BLK-SUB           13520001
135300                      END-IF                                      13530001
135400                  END-IF                                          13540001
135500     END-PERFORM.                                                 13550001
135600                                                                  13560001
138100                                                                  13810088
138200****************************************************************  13820088
138300*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  13830088
138400*                                                              *  13840088
138500****************************************************************  13850088
138600                                                                  13860088
138700 3010-VALIDATE-OPER-UNT-ID.                                       13870088
138800                                                                  13880088
138900     INITIALIZE XL071-COMMAREA.                                   13890088
139000     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                13900088
139100                                                                  13910088
139200     CALL XL071-LOCATION-MODULE USING                             13920088
139300                                DFHEIBLK                          13930088
139400                                XL071-COMMAREA                    13940088
139500                                XL071-COMMAREA-REC.               13950088
139600                                                                  13960088
139700     EVALUATE TRUE                                                13970088
139800         WHEN XL071-NO-ERRORS                                     13980088
139920         WHEN XL071-DC-ASGMT-NOT-FND                              13992089
139930              CONTINUE                                            13993089
140000                                                                  14000088
140100         WHEN XL071-LOC-NOT-FOUND                                 14010088
140120              SET PS-ERROR                                        14012088
140130                  DP020-MSG-FATAL         TO TRUE                 14013088
140140              MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER     14014088
140150              MOVE DP015-UNP-ALP-BRT-OFF  TO AOPERA               14015088
140160              MOVE DP015-RED              TO AOPERC               14016088
140170              MOVE DP015-REVERSE          TO AOPERH               14017088
140180              MOVE -1                     TO AOPERL               14018088
140190              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 14019088
140600                                                                  14060088
140700         WHEN OTHER                                               14070088
140800              MOVE 'VALIDATE-OPER-UNT-ID' TO DP013-PARAGRAPH      14080088
140810              STRING 'SELECT STORE NUMBER - '                     14081092
140820                      XL071-LOCATION-NUMBER                       14082092
140830                     ' - BAD RETURN CODE FROM XLKUT071 - '        14083092
140840                      XL071-RETURN-CODE                           14084092
140850                      DELIMITED BY SIZE                           14085092
140860                      INTO DP013-MESSAGE-TEXT (1)                 14086092
140870              STRING 'SQLCODE - '                                 14087092
140880                      XL071-SQLCODE                               14088092
140890                     ' - '                                        14089092
140891                      XL071-DB2-TABLE                             14089192
140892                      DELIMITED BY SIZE                           14089292
140893                      INTO DP013-MESSAGE-TEXT (2)                 14089392
140894              MOVE XL071-SQLCA     TO DP013-SQLCA                 14089492
140895              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    14089592
142000              MOVE XL071-SQLCODE TO SQLCODE                       14200088
142300              SET DP013-DB2-ABEND                                 14230088
142400                  DP013-XCTL-DISPLAY-RESTART TO TRUE              14240088
142500              PERFORM DP013-0000-PROCESS-ABEND                    14250088
142600                                                                  14260088
142700     END-EVALUATE.                                                14270088
142800                                                                  14280088
142900                                                                  14290001
143000*----------------------------------------------------------------*14300001
143100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14310001
143200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14320001
143300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14330001
143400*                                                                *14340001
143500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14350001
143600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14360001
143700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14370001
143800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14380001
143900*----------------------------------------------------------------*14390001
144000 3100-SET-SUBSCRIPTS.                                             14400001
144100                                                                  14410001
144200     COMPUTE ASC-ITEM-SUB =                                       14420001
144300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14430001
144400                                                                  14440001
144500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14450001
144600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14460001
144700                                                                  14470001
144800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14480001
144900     ELSE                                                         14490001
145000         MOVE +1                     TO ASC-BLK-SUB               14500001
145100     END-IF.                                                      14510001
145200                                                                  14520037
145300******************************************************************14530001
145400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14540001
145500******************************************************************14550001
145600 3200-RESET-ATTRIBUTES.                                           14560001
145700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    14570001
145800     MOVE DP015-GREEN              TO ASTRTITC                    14580001
145900     MOVE DP015-UNDERLINE          TO ASTRTITH                    14590001
146000                                                                  14600037
146100     PERFORM                                                      14610001
146200         VARYING PV-SUB                                           14620001
146300         FROM 1 BY 1                                              14630001
146400         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14640001
146500         MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)        14650037
146600         MOVE DP015-GREEN           TO MR-SELECTC (PV-SUB)        14660037
146700         MOVE DP015-UNDERLINE       TO MR-SELECTH (PV-SUB)        14670037
146800*LMM                                                              14680087
146900         MOVE DP015-UNP-ALP-NOR-OFF TO MR-CLUSTER-NUMA (PV-SUB)   14690086
147000     END-PERFORM.                                                 14700001
147100                                                                  14710037
147200******************************************************************14720001
147300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14730001
147400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14740001
147500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14750001
147600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14760001
147700******************************************************************14770001
147800 3300-EDIT-SELECTIONS.                                            14780001
147900     EVALUATE TRUE                                                14790001
148000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14800001
148100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14810001
148200                 CONTINUE                                         14820001
148300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14830001
148400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14840001
148500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14850001
148600                 MOVE ASC-TEMP-SELECTED-SW                        14860001
148700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14870001
148800                                TO ASC-SELECTED-SW                14880001
148900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14890001
149000             END-IF                                               14900001
149100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14910001
149200                 = SPACE                                          14920001
149300             EVALUATE TRUE                                        14930001
149400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14940001
149500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14950001
149600                     MOVE SPACE TO ASC-SELECTED-SW                14960001
149700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14970001
149800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14980001
149900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14990001
150000                     MOVE SPACE TO ASC-SELECTED-SW                15000001
150100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15010001
150200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15020001
150300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15030001
150400                     MOVE SPACE TO ASC-SELECTED-SW                15040001
150500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15050001
150600             END-EVALUATE                                         15060001
150700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15070001
150800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15080001
150900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15090001
151000             END-IF                                               15100001
151100             PERFORM 3310-EDIT-RANGE                              15110001
151200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15120001
151300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15130001
151400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15140001
151500             END-IF                                               15150001
151600             PERFORM 3310-EDIT-RANGE                              15160001
151700         WHEN OTHER                                               15170001
151800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15180001
151900             SET DP020-MSG-FATAL    TO TRUE                       15190001
152000             MOVE -1                TO MR-SELECTL (PV-SUB)        15200001
152100             SET DP030-SET-CURSOR-APPL-1                          15210001
152200                                    TO TRUE                       15220001
152300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15230001
152400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15240001
152500             SET PS-ERROR TO TRUE                                 15250001
152600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15260001
152700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15270001
152800                 MOVE SPACE         TO ASC-SELECTED-SW            15280001
152900                                        (ASC-BLK-SUB ASC-ITEM-SUB)15290001
153000             END-IF                                               15300001
153100     END-EVALUATE.                                                15310001
153200                                                                  15320001
153300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15330001
153400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15340001
153500     IF  ASC-ITEM-SUB < 1                                         15350001
153600         SUBTRACT +1 FROM ASC-BLK-SUB                             15360001
153700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15370001
153800     END-IF.                                                      15380001
153900                                                                  15390001
154000******************************************************************15400001
154100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15410001
154200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15420001
154300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15430001
154400** THE ENDING.                                                  **15440001
154500******************************************************************15450001
154600 3310-EDIT-RANGE.                                                 15460001
154700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15470001
154800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15480001
154900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15490001
155000                                   TO ASC-SELECTED-SW             15500001
155100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15510001
155200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15520001
155300         ELSE                                                     15530001
155400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15540001
155500                 CONTINUE                                         15550001
155600             ELSE                                                 15560001
155700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15570001
155800                 MOVE PC-TSYMSG-00054                             15580001
155900                                   TO DP020-MSG-NUMBER            15590001
156000                 SET DP020-MSG-FATAL                              15600001
156100                                   TO TRUE                        15610001
156200                 MOVE -1           TO MR-SELECTL (PV-SUB)         15620001
156300                 SET DP030-SET-CURSOR-APPL-1                      15630001
156400                                   TO TRUE                        15640001
156500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15650001
156600                 MOVE DP015-UNDERLINE                             15660001
156700                                   TO MR-SELECTH (PV-SUB)         15670001
156800                 SET PS-ERROR      TO TRUE                        15680001
156900             END-IF                                               15690001
157000         END-IF                                                   15700001
157100     ELSE                                                         15710001
157200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15720001
157300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15730001
157400                                   TO ASC-SELECTED-SW             15740001
157500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15750001
157600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15760001
157700         ELSE                                                     15770001
157800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15780001
157900                 CONTINUE                                         15790001
158000             ELSE                                                 15800001
158100*                -- ONLY ONE END-OF-RANGE ALLOWED --              15810001
158200                 MOVE PC-TSYMSG-00055                             15820001
158300                                   TO DP020-MSG-NUMBER            15830001
158400                 SET DP020-MSG-FATAL                              15840001
158500                                   TO TRUE                        15850001
158600                 MOVE -1           TO MR-SELECTL (PV-SUB)         15860001
158700                 SET DP030-SET-CURSOR-APPL-1                      15870001
158800                                   TO TRUE                        15880001
158900                 SET PS-ERROR      TO TRUE                        15890001
159000             END-IF                                               15900001
159100         END-IF                                                   15910001
159200     END-IF.                                                      15920001
159300                                                                  15930037
159400******************************************************************15940001
159500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15950001
159600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15960001
159700******************************************************************15970001
159800 3400-CHECK-RANGE-SEQUENCE.                                       15980001
159900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15990001
160000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16000001
160100       AND  ASC-START-OF-SELECTED-RANGE >                         16010001
160200                                         ASC-END-OF-SELECTED-RANGE16020001
160300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16030001
160400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16040001
160500         SET DP020-MSG-FATAL TO TRUE                              16050001
160600         SET PS-ERROR TO TRUE                                     16060001
160700         PERFORM 3410-POSITION-AT-ERROR                           16070001
160800     END-IF.                                                      16080001
160900                                                                  16090037
161000******************************************************************16100001
161100** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16110001
161200** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16120001
161300** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16130001
161400******************************************************************16140001
161500 3410-POSITION-AT-ERROR.                                          16150001
161600     SET DP030-SET-CURSOR-APPL-1                                  16160001
161700                                   TO TRUE.                       16170001
161800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16180001
161900                    - PV-TOP-ITEM + 1.                            16190001
162000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16200001
162100         CONTINUE                                                 16210001
162200     ELSE                                                         16220001
162300         MOVE -1                   TO MR-SELECTL (PV-SUB)         16230001
162400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16240001
162500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16250001
162600     END-IF.                                                      16260001
162700                                                                  16270037
162800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16280001
162900                    - PV-TOP-ITEM + 1.                            16290001
163000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16300001
163100         CONTINUE                                                 16310001
163200     ELSE                                                         16320001
163300         MOVE -1                   TO MR-SELECTL (PV-SUB)         16330001
163400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16340001
163500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16350001
163600     END-IF.                                                      16360001
163700                                                                  16370034
163800*----------------------------------------------------------------*16380001
163900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16390001
164000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16400001
164100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16410001
164200*----------------------------------------------------------------*16420001
164300 3500-MARK-RANGE-AS-SELECTED.                                     16430001
164400     MOVE +1                       TO  ASC-BLK-SUB.               16440001
164500     PERFORM 3510-MARK-SELECTED-INDS                              16450001
164600         VARYING ASC-ITEM-SUB                                     16460001
164700         FROM 1 BY 1                                              16470001
164800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16480001
164900                                                                  16490001
165000     ADD +1                        TO ASC-BLK-SUB.                16500001
165100     PERFORM 3510-MARK-SELECTED-INDS                              16510001
165200         VARYING ASC-ITEM-SUB                                     16520001
165300         FROM 1 BY 1                                              16530001
165400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16540001
165500                                                                  16550001
165600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16560001
165700                                   TO  PV-LIST-ITEM-NUMBER.       16570001
165800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16580001
165900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16590001
166000               PC-ITEMS-PER-PANEL).                               16600001
166100                                                                  16610001
166200     MOVE ASC-START-OF-SELECTED-RANGE                             16620001
166300                                   TO PV-START-OF-SELECTED-RANGE. 16630001
166400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16640001
166500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16650001
166600               PC-ITEMS-PER-PANEL).                               16660001
166700                                                                  16670001
166800     MOVE ASC-END-OF-SELECTED-RANGE                               16680001
166900                                   TO  PV-END-OF-SELECTED-RANGE.  16690001
167000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16700001
167100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16710001
167200               PC-ITEMS-PER-PANEL).                               16720001
167300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16730001
167400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16740001
167500                                                                  16750001
167600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16760001
167700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16770001
167800         MOVE +1                   TO ASC-BLK-SUB                 16780001
167900         PERFORM 5100-WRITE-TEMP-STORAGE                          16790001
168000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16800001
168100             PV-FIRST-BLOCK-IN-ARRAY - 1                          16810001
168200                                                                  16820001
168300         PERFORM                                                  16830001
168400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16840001
168500                   PV-PREV-BLOCK-IN-ARRAY                         16850001
168600             MOVE PV-FIRST-BLOCK-IN-RANGE TO PV-BLOCK-NUMBER      16860037
168700             PERFORM 4410-READ-TEMP-STORAGE                       16870001
168800             PERFORM 3510-MARK-SELECTED-INDS                      16880001
168900                 VARYING ASC-ITEM-SUB                             16890001
169000                 FROM 1 BY 1                                      16900001
169100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16910001
169200             PERFORM 5100-WRITE-TEMP-STORAGE                      16920001
169300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16930001
169400         END-PERFORM                                              16940001
169500                                                                  16950001
169600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16960001
169700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16970001
169800         PERFORM                                                  16980001
169900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16990001
170000                   PV-LAST-BLOCK-IN-RANGE                         17000001
170100             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       17010037
170200             PERFORM 4410-READ-TEMP-STORAGE                       17020001
170300             PERFORM 3510-MARK-SELECTED-INDS                      17030001
170400                 VARYING ASC-ITEM-SUB                             17040001
170500                 FROM 1 BY 1                                      17050001
170600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17060001
170700             PERFORM 5100-WRITE-TEMP-STORAGE                      17070001
170800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17080001
170900         END-PERFORM                                              17090001
171000                                                                  17100001
171100         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          17110037
171200         PERFORM 4410-READ-TEMP-STORAGE                           17120001
171300     END-IF.                                                      17130001
171400                                                                  17140001
171500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17150001
171600                                      ASC-END-OF-SELECTED-RANGE.  17160001
171700                                                                  17170001
171800*----------------------------------------------------------------*17180001
171900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17190001
172000*----------------------------------------------------------------*17200001
172100 3510-MARK-SELECTED-INDS.                                         17210001
172200                                                                  17220001
172300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17230001
172400                                ASC-ITEM-SUB) >                   17240001
172500         ASC-START-OF-SELECTED-RANGE)                             17250001
172600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17260001
172700                                ASC-ITEM-SUB) =                   17270001
172800         ASC-START-OF-SELECTED-RANGE)                             17280001
172900                                                                  17290001
173000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17300001
173100                                    ASC-ITEM-SUB) <               17310001
173200             ASC-END-OF-SELECTED-RANGE)                           17320001
173300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17330001
173400                                    ASC-ITEM-SUB) =               17340001
173500             ASC-END-OF-SELECTED-RANGE)                           17350001
173600                                                                  17360001
173700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17370001
173800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17380001
173900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17390001
174000                               TO TRUE                            17400001
174100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17410001
174200                               TO TRUE                            17420001
174300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17430001
174400             END-IF                                               17440001
174500         END-IF                                                   17450001
174600     END-IF.                                                      17460001
174700                                                                  17470001
174800*----------------------------------------------------------------*17480001
174900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17490001
175000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17500001
175100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17510001
175200*    DISPLAY THE PANEL TO USER.                                  *17520001
175300*----------------------------------------------------------------*17530001
175400 4000-BUILD-INITIAL-PANEL.                                        17540001
175500                                                                  17550001
175600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            17560001
175700                                 ASC-BLOCK-ENTRIES (2).           17570001
175800     MOVE +1                 TO ASC-BLK-SUB.                      17580001
175900     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            17590037
176000                                                                  17600001
176100     MOVE +0                 TO ASC-ITEM-SUB                      17610001
176200                                ASC-NUMBER-OF-ITEMS-READ          17620001
176300                                ASC-NUMBER-OF-SELECTED-ITEMS      17630001
176400                                ASC-HIGHEST-BLOCK-WRITTEN         17640001
176500                                ASC-START-OF-SELECTED-RANGE       17650001
176600                                ASC-END-OF-SELECTED-RANGE         17660001
176700                                ASC-ITEM-AT-TOP-OF-PANEL.         17670001
176800                                                                  17680001
176900     PERFORM 4100-PREPARE-CURSOR                                  17690001
177000     PERFORM 4010-OPEN-CURSOR.                                    17700001
177100     PERFORM 4300-READ-ITEMS-FROM-DB.                             17710001
177200     PERFORM 4020-CLOSE-CURSOR.                                   17720001
177300                                                                  17730001
177400     MOVE +1                   TO  PV-TOP-ITEM.                   17740001
177500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17750001
177600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17760001
177700         SET DP020-MSG-FATAL   TO  TRUE                           17770001
177800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17780001
177900     ELSE                                                         17790001
178000         MOVE -1               TO MR-SELECTL (1)                  17800001
178100         SET DP030-SET-CURSOR-APPL-1                              17810001
178200                               TO TRUE                            17820001
178300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17830001
178400     END-IF.                                                      17840001
178500                                                                  17850034
178600*----------------------------------------------------------------*17860001
178700* OPEN THE CURSOR.                                               *17870012
178800*----------------------------------------------------------------*17880001
178900 4010-OPEN-CURSOR.                                                17890001
179000     PERFORM                                                      17900001
179100         WITH TEST AFTER                                          17910001
179200         VARYING PV-RETRY-COUNTER                                 17920001
179300         FROM 1 BY 1                                              17930001
179400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17940001
179500                   OR (SQLCODE = ZERO))                           17950001
179600                                                                  17960001
179700         EVALUATE TRUE                                            17970012
179800             WHEN ASC-CLUSTER-CURSOR                              17980017
179900                  MOVE 'CURSOR: CLSTR-LIST-CSR'                   17990012
180000                              TO DP013-MESSAGE-TEXT (2)           18000001
180100                  EXEC SQL                                        18010012
180200                       OPEN CLSTR-LIST-CSR                        18020012
180300                  END-EXEC                                        18030012
180400                                                                  18040001
180500             WHEN ASC-PRINTER-CURSOR                              18050017
180600                  MOVE 'CURSOR:  PRTR-ID-CSR'                     18060012
180700                              TO DP013-MESSAGE-TEXT (2)           18070012
180800                  EXEC SQL                                        18080012
180900                       OPEN PRTR-ID-CSR                           18090012
181000                  END-EXEC                                        18100012
181100         END-EVALUATE                                             18110018
181200                                                                  18120001
181300         EVALUATE TRUE                                            18130001
181400             WHEN SQLCODE = ZERO                                  18140001
181500             WHEN SQLCODE = -904                                  18150001
181600             WHEN SQLCODE = -913                                  18160001
181700                 CONTINUE                                         18170001
181800             WHEN SQLWARN0 NOT = SPACES                           18180001
181900             WHEN SQLCODE < ZERO                                  18190001
182000             WHEN SQLCODE > ZERO                                  18200001
182100                 MOVE '4010-OPEN-CURSOR'                          18210001
182200                                   TO DP013-PARAGRAPH             18220001
182300                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             18230001
182400                                   TO DP013-MESSAGE-TEXT (1)      18240001
182500                 MOVE SQLCA        TO DP013-SQLCA                 18250001
182600                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    18260001
182700                 SET DP013-DB2-ABEND                              18270001
182800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18280001
182900                 PERFORM DP013-0000-PROCESS-ABEND                 18290001
183000         END-EVALUATE                                             18300001
183100     END-PERFORM.                                                 18310017
183200                                                                  18320037
183300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18330001
183400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18340001
183500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18350001
183600                                   TO DP013-MESSAGE-TEXT (1)      18360001
183700         MOVE SQLCA                TO DP013-SQLCA                 18370001
183800         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    18380001
183900         SET DP013-DB2-ABEND                                      18390001
184000             DP013-XCTL-DISPLAY-RESTART                           18400001
184100                                   TO TRUE                        18410001
184200         PERFORM DP013-0000-PROCESS-ABEND                         18420001
184300     END-IF.                                                      18430001
184400                                                                  18440001
184500*----------------------------------------------------------------*18450001
184600* CLOSE THE CURSOR                                               *18460012
184700*----------------------------------------------------------------*18470001
184800 4020-CLOSE-CURSOR.                                               18480001
184900     EVALUATE TRUE                                                18490012
185000         WHEN ASC-CLUSTER-CURSOR                                  18500017
185100              EXEC SQL                                            18510012
185200                   CLOSE CLSTR-LIST-CSR                           18520012
185300              END-EXEC                                            18530012
185400                                                                  18540012
185500         WHEN ASC-PRINTER-CURSOR                                  18550017
185600              EXEC SQL                                            18560012
185700                   CLOSE PRTR-ID-CSR                              18570012
185800              END-EXEC                                            18580012
185900     END-EVALUATE.                                                18590012
186000                                                                  18600001
186100     EVALUATE TRUE                                                18610001
186200         WHEN SQLCODE = ZERO                                      18620001
186300             CONTINUE                                             18630001
186400         WHEN SQLWARN0 NOT = SPACES                               18640001
186500         WHEN SQLCODE < ZERO                                      18650001
186600         WHEN SQLCODE > ZERO                                      18660001
186700             MOVE '4020-CLOSE-CURSOR'                             18670001
186800                               TO DP013-PARAGRAPH                 18680001
186900             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  18690001
187000                               TO DP013-MESSAGE-TEXT (1)          18700001
187100             MOVE SQLCA        TO DP013-SQLCA                     18710001
187200             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        18720001
187300             SET DP013-DB2-ABEND                                  18730001
187400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18740001
187500             PERFORM DP013-0000-PROCESS-ABEND                     18750001
187600     END-EVALUATE.                                                18760001
187700                                                                  18770001
187800*----------------------------------------------------------------*18780001
187900*    SET UP THE HOST VARIABLES.                                  *18790001
188000*----------------------------------------------------------------*18800001
188100 4100-PREPARE-CURSOR.                                             18810001
188200     SET ASC-NO-CURSOR                  TO TRUE.                  18820011
188300                                                                  18830001
188400     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 18840001
188500     MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID.                    18850001
188600     MOVE ASC-PRINTER-ID       TO DK-PRINTER-ID.                  18860011
188700                                                                  18870011
188800     IF ASC-PRINTER-ID GREATER THAN SPACES                        18880011
188900            SET ASC-PRINTER-CURSOR TO TRUE                        18890017
189000     ELSE                                                         18900011
189100        SET ASC-CLUSTER-CURSOR TO TRUE                            18910017
189200     END-IF.                                                      18920011
189300                                                                  18930009
189400*----------------------------------------------------------------*18940009
189500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18950009
189600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18960009
189700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18970009
189800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18980009
189900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18990009
190000*                                                                *19000009
190100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19010009
190200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19020009
190300*    UPON INITIALIZATION.                                        *19030009
190400*----------------------------------------------------------------*19040009
190500 4300-READ-ITEMS-FROM-DB.                                         19050009
190600                                                                  19060009
190700     PERFORM                                                      19070009
190800         VARYING PV-READ-COUNT                                    19080009
190900         FROM 1 BY 1                                              19090009
191000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19100009
191100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19110009
191200                                                                  19120009
191300         PERFORM 4310-FETCH                                       19130009
191400                                                                  19140009
191500         IF  ASC-ITEMS-LEFT-ON-DB                                 19150009
191600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19160009
191700                 ADD +1            TO ASC-ITEM-SUB                19170009
191800             ELSE                                                 19180009
191900                 ADD +1            TO ASC-BLK-SUB                 19190009
192000                 MOVE +1           TO ASC-ITEM-SUB                19200009
192100                                                                  19210009
192200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19220009
192300                     MOVE +1       TO ASC-BLK-SUB                 19230009
192400                     SET ASC-BLOCK-MODIFIED (1)                   19240009
192500                                   TO TRUE                        19250009
192600                     PERFORM 5100-WRITE-TEMP-STORAGE              19260009
192700                     MOVE ASC-BLOCK-ENTRIES                       19270009
192800                               (PC-MAX-BLOCKS-IN-ARRAY)           19280009
192900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19290009
193000                     ADD +1        TO ASC-BLK-SUB                 19300009
193100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19310009
193200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19320009
193300                                   TO TRUE                        19330009
193400                 END-IF                                           19340009
193500             END-IF                                               19350009
193600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19360009
193700             MOVE ASC-NUMBER-OF-ITEMS-READ                        19370009
193800                                   TO ASC-LIST-ITEM-NUMBER        19380009
193900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19390009
194000             MOVE SPACES           TO  ASC-ACTION                 19400009
194100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19410009
194200             MOVE PRTRCL-PRTR-CLUSTR-NBR                          19420078
194300                              TO  ASC-CLUSTER-NUM                 19430054
194400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19440054
194500             MOVE PRTRCL-IP-ADDR                                  19450009
194600                              TO  ASC-IP-ADDRESS                  19460009
194700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19470009
194800             MOVE PRTRCL-CLUSTR-OS-RLSE-CDE                       19480009
194900                              TO  ASC-OS-RLSE-CDE                 19490009
195000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19500009
195100             MOVE PRTRCL-DAT-XFER-MODE-ID                         19510009
195200                              TO  ASC-DATA-XFER-MDE               19520009
195300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19530009
195400             MOVE PRTRCL-XMIT-INTFC-CDE                           19540009
195500                              TO  ASC-TRANSMIT-CDE                19550009
195600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19560009
195700         END-IF                                                   19570009
195800     END-PERFORM.                                                 19580009
195900                                                                  19590009
196000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19600009
196100         MOVE +1               TO ASC-BLK-SUB                     19610009
196200         PERFORM 5100-WRITE-TEMP-STORAGE                          19620009
196300         ADD +1                TO ASC-BLK-SUB                     19630009
196400         PERFORM 5100-WRITE-TEMP-STORAGE                          19640009
196500                                                                  19650009
196600         MOVE 1                TO ASC-BLK-SUB                     19660009
196700                                  PV-BLOCK-NUMBER                 19670009
196800         PERFORM 4410-READ-TEMP-STORAGE                           19680009
196900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19690009
197000             MOVE 2            TO ASC-BLK-SUB                     19700009
197100                                  PV-BLOCK-NUMBER                 19710009
197200             PERFORM 4410-READ-TEMP-STORAGE                       19720009
197300         END-IF                                                   19730009
197400     END-IF.                                                      19740009
197500                                                                  19750034
197600*----------------------------------------------------------------*19760009
197700*    FETCH THE PRTR LIST ITEMS                                   *19770009
197800*----------------------------------------------------------------*19780009
197900 4310-FETCH.                                                      19790009
198000     EVALUATE TRUE                                                19800012
198100         WHEN ASC-CLUSTER-CURSOR                                  19810017
198200           EXEC SQL                                               19820012
198300                FETCH CLSTR-LIST-CSR                              19830012
198400                 INTO  :PRTRCL-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     19840012
198500                     , :PRTRCL-IP-ADDR                            19850012
198600                     , :PRTRCL-CLUSTR-OS-RLSE-CDE                 19860012
198700                     , :PRTRCL-DAT-XFER-MODE-ID                   19870012
198800                     , :PRTRCL-XMIT-INTFC-CDE                     19880012
198900           END-EXEC                                               19890012
199000                                                                  19900009
199100         WHEN ASC-PRINTER-CURSOR                                  19910017
199200           EXEC SQL                                               19920017
199300                FETCH PRTR-ID-CSR                                 19930017
199400                 INTO  :PRTRCL-PRTR-CLUSTR-NBR :DN-CLUSTR-NBR     19940012
199500                     , :PRTRCL-IP-ADDR                            19950012
199600                     , :PRTRCL-CLUSTR-OS-RLSE-CDE                 19960012
199700                     , :PRTRCL-DAT-XFER-MODE-ID                   19970012
199800                     , :PRTRCL-XMIT-INTFC-CDE                     19980012
199900                     , :PRTRID-PRTR-ID                            19990013
200000           END-EXEC                                               20000012
200100     END-EVALUATE.                                                20010012
200200                                                                  20020009
200300     EVALUATE TRUE                                                20030009
200400         WHEN SQLCODE = ZERO                                      20040009
200500         WHEN SQLCODE = +100                                      20050009
200600              CONTINUE                                            20060009
200700         WHEN SQLCODE = -305                                      20070009
200800             IF DN-CLUSTR-NBR = -1                                20080009
200900                MOVE ZEROES TO PRTRCL-PRTR-CLUSTR-NBR             20090078
201000             END-IF                                               20100055
201100         WHEN SQLWARN0 NOT = SPACE                                20110009
201200         WHEN SQLCODE NOT = ZERO                                  20120009
201300              MOVE '4310-FETCH-CURSOR'                            20130009
201400                               TO DP013-PARAGRAPH                 20140009
201500              MOVE 'FETCH MESSAGE CURSOR'                         20150009
201600                               TO DP013-MESSAGE-TEXT (1)          20160009
201700              MOVE SQLCA       TO DP013-SQLCA                     20170009
201800              SET DP013-DB2-ABEND                                 20180009
201900                               TO TRUE                            20190009
202000              PERFORM DP013-0000-PROCESS-ABEND                    20200009
202100     END-EVALUATE.                                                20210009
202200                                                                  20220009
202300     IF  SQLCODE EQUAL +100                                       20230009
202400         SET ASC-NO-ITEMS-LEFT-ON-DB                              20240009
202500                                   TO TRUE                        20250009
202600     END-IF.                                                      20260009
202700                                                                  20270009
202800*----------------------------------------------------------------*20280009
202900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20290009
203000*----------------------------------------------------------------*20300009
203100 4400-MOVE-COMMAREA-TO-SCREEN.                                    20310009
203200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20320009
203300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20330009
203400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20340009
203500             MOVE +1    TO ASC-BLK-SUB                            20350009
203600             PERFORM 5100-WRITE-TEMP-STORAGE                      20360009
203700             ADD +1     TO ASC-BLK-SUB                            20370009
203800             PERFORM 5100-WRITE-TEMP-STORAGE                      20380009
203900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20390009
204000                 GIVING PV-BLOCK-NUMBER                           20400009
204100                 REMAINDER PV-REMAINDER                           20410009
204200             IF  PV-REMAINDER > ZERO                              20420009
204300                 ADD +1 TO PV-BLOCK-NUMBER                        20430009
204400             END-IF                                               20440009
204500             MOVE +1    TO ASC-BLK-SUB                            20450009
204600             PERFORM 4410-READ-TEMP-STORAGE                       20460009
204700             ADD +1     TO ASC-BLK-SUB                            20470009
204800                           PV-BLOCK-NUMBER                        20480009
204900             PERFORM 4410-READ-TEMP-STORAGE                       20490009
205000     END-IF.                                                      20500009
205100     MOVE +1            TO ASC-BLK-SUB.                           20510009
205200     COMPUTE ASC-ITEM-SUB =                                       20520009
205300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20530009
205400         + PC-ITEMS-PER-PANEL).                                   20540009
205500                                                                  20550037
205600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20560009
205700         ADD +1         TO ASC-BLK-SUB                            20570009
205800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20580009
205900     END-IF.                                                      20590009
206000                                                                  20600037
206100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20610009
206200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20620009
206300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20630009
206400     PERFORM 4420-FORMAT-LIST-LINES                               20640009
206500         VARYING PV-SUB                                           20650009
206600         FROM PC-ITEMS-PER-PANEL BY -1                            20660009
206700         UNTIL PV-SUB < +1.                                       20670009
206800                                                                  20680037
206900     COMPUTE ASC-ITEMS-DISPLAYED =                                20690009
207000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20700009
207100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20710009
207200                                      ASTRTITO.                   20720009
207300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20730009
207400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20740009
207500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20750009
207600                                   TO ASELITO.                    20760009
207700                                                                  20770009
207800     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     20780009
207900     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    20790009
208000     MOVE ASC-FCLTY-NME            TO ANAMEO.                     20800009
208100                                                                  20810009
208200     IF  DP020-MSG-NUMBER-X = SPACE                               20820009
208300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20830009
208400*            --- MORE ITEMS TO DISPLAY ----                       20840009
208500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20850009
208600             SET DP020-MSG-INFORMATIONAL TO TRUE                  20860009
208700         END-IF                                                   20870009
208800     END-IF.                                                      20880009
208900                                                                  20890037
209000*----------------------------------------------------------------*20900009
209100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20910009
209200*----------------------------------------------------------------*20920009
209300 4410-READ-TEMP-STORAGE.                                          20930009
209400                                                                  20940009
209500     EXEC CICS                                                    20950009
209600         READQ TS                                                 20960009
209700             QUEUE (ASC-LIST-QUEUE-NAME)                          20970009
209800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20980009
209900             ITEM  (PV-BLOCK-NUMBER)                              20990009
210000             RESP  (PV-CICS-RESP)                                 21000009
210100     END-EXEC.                                                    21010009
210200                                                                  21020009
210300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21030009
210400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21040009
210500         CONTINUE                                                 21050009
210600     ELSE                                                         21060009
210700         SET DP013-CICS-ABEND     TO TRUE                         21070009
210800         SET DP013-NO-ROLLBACK    TO TRUE                         21080009
210900         MOVE '4410-READ-TEMP-STORAGE'                            21090009
211000                                  TO DP013-PARAGRAPH              21100009
211100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21110009
211200                                  TO DP013-MESSAGE-TEXT(1)        21120009
211300         PERFORM DP013-0000-PROCESS-ABEND                         21130009
211400     END-IF.                                                      21140009
211500                                                                  21150009
211600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21160009
211700                                                                  21170037
211800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         21180009
211900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21190009
212000     END-IF.                                                      21200009
212100                                                                  21210034
212200*----------------------------------------------------------------*21220009
212300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *21230009
212400*----------------------------------------------------------------*21240009
212500 4420-FORMAT-LIST-LINES.                                          21250009
212600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      21260009
212700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21270009
212800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           21280009
212900                                    MR-CLUSTER-NUMA (PV-SUB)      21290061
213000         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           21300009
213100         MOVE SPACE              TO MR-SELECTI (PV-SUB)           21310009
213200                                    MR-ACTION (PV-SUB)            21320009
213300                                    MR-IP-ADDRESS (PV-SUB)        21330009
213400                                    MR-OS-RLSE-CDE (PV-SUB)       21340009
213500                                    MR-DATA-XFER-MDE (PV-SUB)     21350009
213600                                    MR-TRANSMIT-CDE (PV-SUB)      21360009
213700                                                                  21370056
213800         MOVE ZEROES             TO MR-CLUSTER-NUM (PV-SUB)       21380056
213900     ELSE                                                         21390009
214000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21400009
214100                                                   > SPACE        21410009
214200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21420009
214300                                 TO MR-SELECTI (PV-SUB)           21430009
214400         ELSE                                                     21440009
214500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21450009
214600                                 TO MR-SELECTI (PV-SUB)           21460009
214700         END-IF                                                   21470009
214800                                                                  21480037
214900         IF  DP030-SET-CURSOR-TRAILER                             21490009
215000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21500009
215100                 > SPACE)                                         21510009
215200               OR (PV-SUB = 1))                                   21520009
215300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21530009
215400                MOVE -1          TO MR-SELECTL (PV-SUB)           21540009
215500             END-IF                                               21550009
215600         END-IF                                                   21560009
215700                                                                  21570037
215800         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               21580009
215900                                 TO MR-ACTION (PV-SUB)            21590009
216000         MOVE ASC-CLUSTER-NUM (ASC-BLK-SUB ASC-ITEM-SUB)          21600009
216100                                 TO MR-CLUSTER-NUM (PV-SUB)       21610009
216200         MOVE ASC-IP-ADDRESS  (ASC-BLK-SUB ASC-ITEM-SUB)          21620009
216300                                 TO MR-IP-ADDRESS (PV-SUB)        21630009
216400         MOVE ASC-OS-RLSE-CDE (ASC-BLK-SUB ASC-ITEM-SUB)          21640009
216500                                 TO MR-OS-RLSE-CDE (PV-SUB)       21650009
216600         MOVE ASC-DATA-XFER-MDE (ASC-BLK-SUB ASC-ITEM-SUB)        21660009
216700                                 TO MR-DATA-XFER-MDE (PV-SUB)     21670009
216800         MOVE ASC-TRANSMIT-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)        21680009
216900                                 TO MR-TRANSMIT-CDE  (PV-SUB)     21690009
217000     END-IF.                                                      21700009
217100     SUBTRACT +1 FROM ASC-ITEM-SUB                                21710009
217200     IF  ASC-ITEM-SUB < + 1                                       21720009
217300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21730009
217400         MOVE +1                 TO ASC-BLK-SUB                   21740009
217500     END-IF.                                                      21750009
217600                                                                  21760037
217700******************************************************************21770009
217800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21780009
217900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21790009
218000** ISSUE A WARNING.                                             **21800009
218100******************************************************************21810009
218200 4430-CHECK-FOR-BEGIN-AND-END.                                    21820009
218300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21830009
218400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21840009
218500*            -- NO END-OF-RANGE SPECFIED ---                      21850009
218600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21860009
218700             SET DP020-MSG-WARNING TO TRUE                        21870009
218800             PERFORM 4431-POSITION-AT-WARNING                     21880009
218900         END-IF                                                   21890009
219000     ELSE                                                         21900009
219100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21910009
219200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21920009
219300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21930009
219400             SET DP020-MSG-WARNING TO TRUE                        21940009
219500             PERFORM 4431-POSITION-AT-WARNING                     21950009
219600         END-IF                                                   21960009
219700     END-IF.                                                      21970009
219800                                                                  21980037
219900******************************************************************21990009
220000** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **22000009
220100** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **22010009
220200** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **22020009
220300** POSITION THE CURSOR THERE.                                   **22030009
220400******************************************************************22040009
220500 4431-POSITION-AT-WARNING.                                        22050009
220600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22060009
220700                    - PV-TOP-ITEM + 1.                            22070009
220800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22080009
220900         CONTINUE                                                 22090009
221000     ELSE                                                         22100009
221100         SET DP030-SET-CURSOR-APPL-1                              22110009
221200                                   TO TRUE                        22120009
221300         MOVE -1                   TO MR-SELECTL (PV-SUB)         22130009
221400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22140009
221500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22150009
221600     END-IF.                                                      22160009
221700                                                                  22170037
221800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   22180009
221900                    - PV-TOP-ITEM + 1.                            22190009
222000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22200009
222100         CONTINUE                                                 22210009
222200     ELSE                                                         22220009
222300         SET DP030-SET-CURSOR-APPL-1                              22230009
222400                                   TO TRUE                        22240009
222500         MOVE -1                   TO MR-SELECTL (PV-SUB)         22250009
222600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22260009
222700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22270009
222800     END-IF.                                                      22280009
222900                                                                  22290009
223000*----------------------------------------------------------------*22300009
223100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22310009
223200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22320009
223300* FOR THE SELECTED ITEMS QUEUE.                                  *22330009
223400*                                                                *22340009
223500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22350009
223600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22360009
223700* THE ARRAY IS FULL.                                             *22370009
223800*----------------------------------------------------------------*22380009
223900 5000-PREPARE-SEL-QUEUE.                                          22390009
224000                                                                  22400009
224100     MOVE +1                   TO  ASC-BLK-SUB.                   22410009
224200     PERFORM 5100-WRITE-TEMP-STORAGE.                             22420009
224300     ADD +1                    TO  ASC-BLK-SUB.                   22430009
224400     PERFORM 5100-WRITE-TEMP-STORAGE.                             22440009
224500                                                                  22450009
224600     MOVE ASC-SEL-QUEUE-NAME   TO  CN162-SEL-QUEUE-NAME.          22460020
224700     PERFORM 6010-DELETE-SEL-QUEUE.                               22470071
224800                                                                  22480009
224900     SET ASC-UPDATE-TSQ        TO  TRUE.                          22490009
225000                                                                  22500009
225100     SET CN163-IDX             TO  1.                             22510020
225200     MOVE ZERO                 TO CN162-NUMBER-OF-TS-ITEMS.       22520020
225300     INITIALIZE CN163-SELECTED-ITEM-ARRAY.                        22530020
225400                                                                  22540009
225500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22550009
225600             VARYING PV-ITEM                                      22560009
225700             FROM 1 BY 1                                          22570009
225800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     22580009
225900                                                                  22590009
226000     IF  CN163-IDX > 1                                            22600020
226100         PERFORM 5205-WRITE-SEL-QUEUE                             22610009
226200         ADD +1                TO CN162-NUMBER-OF-TS-ITEMS        22620020
226300     END-IF.                                                      22630009
226400                                                                  22640034
226500*----------------------------------------------------------------*22650009
226600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22660009
226700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22670009
226800*----------------------------------------------------------------*22680009
226900 5100-WRITE-TEMP-STORAGE.                                         22690009
227000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22700009
227100                                   TO PV-LIST-ITEM-NUMBER.        22710009
227200     COMPUTE PV-BLOCK-NUMBER =                                    22720009
227300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22730009
227400                                                                  22740009
227500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22750009
227600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22760009
227700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22770009
227800             PERFORM 5105-REWRITE-ASC-LISTQ                       22780009
227900         END-IF                                                   22790009
228000     ELSE                                                         22800009
228100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22810009
228200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22820009
228300         PERFORM 5110-WRITE-ASC-LISTQ                             22830009
228400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22840009
228500     END-IF.                                                      22850009
228600                                                                  22860009
228700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22870009
228800                                                                  22880037
228900******************************************************************22890009
229000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22900009
229100** SPECIFIC COMMAREA.                                           **22910009
229200******************************************************************22920009
229300 5105-REWRITE-ASC-LISTQ.                                          22930009
229400     EXEC CICS                                                    22940009
229500         WRITEQ TS                                                22950009
229600             QUEUE (ASC-LIST-QUEUE-NAME)                          22960009
229700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22970009
229800             ITEM  (PV-BLOCK-NUMBER)                              22980009
229900             REWRITE                                              22990009
230000             RESP  (PV-CICS-RESP)                                 23000009
230100     END-EXEC.                                                    23010009
230200                                                                  23020009
230300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23030009
230400         CONTINUE                                                 23040009
230500     ELSE                                                         23050009
230600         SET DP013-CICS-ABEND            TO TRUE                  23060009
230700         SET DP013-NO-ROLLBACK           TO TRUE                  23070009
230800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23080009
230900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23090009
231000                                         TO DP013-MESSAGE-TEXT(1) 23100009
231100         PERFORM DP013-0000-PROCESS-ABEND                         23110009
231200     END-IF.                                                      23120009
231300                                                                  23130009
231400******************************************************************23140009
231500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **23150009
231600** SPECIFIC COMMAREA.                                           **23160009
231700******************************************************************23170009
231800 5110-WRITE-ASC-LISTQ.                                            23180009
231900     EXEC CICS                                                    23190009
232000         WRITEQ TS                                                23200009
232100             QUEUE (ASC-LIST-QUEUE-NAME)                          23210009
232200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23220009
232300             ITEM  (PV-BLOCK-NUMBER)                              23230009
232400             RESP  (PV-CICS-RESP)                                 23240009
232500     END-EXEC.                                                    23250009
232600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23260009
232700         SET DP013-CICS-ABEND      TO TRUE                        23270009
232800         SET DP013-NO-ROLLBACK     TO TRUE                        23280009
232900         MOVE '5110-WRITE-ASC-LISTQ'                              23290009
233000                                   TO DP013-PARAGRAPH             23300009
233100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23310009
233200                                   TO DP013-MESSAGE-TEXT(1)       23320009
233300         PERFORM DP013-0000-PROCESS-ABEND                         23330009
233400     END-IF.                                                      23340009
233500                                                                  23350034
233600*----------------------------------------------------------------*23360009
233700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23370009
233800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23380009
233900*----------------------------------------------------------------*23390009
234000                                                                  23400009
234100 5200-FILL-SEL-QUEUE-RECORD.                                      23410009
234200                                                                  23420009
234300     PERFORM 6112-READ-LIST-QUEUE.                                23430009
234400                                                                  23440009
234500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23450009
234600         PERFORM                                                  23460009
234700         VARYING LQW-IDX                                          23470009
234800         FROM 1 BY 1                                              23480009
234900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23490009
235000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          23500009
235100*LMM                                                              23510068
235200             IF  LQW-SELECT (LQW-IDX)                             23520009
235300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              23530009
235400                                  TO CN163-ITEM (CN163-IDX)       23540020
235500                 MOVE SPACE       TO CN163-ACTION-SW (CN163-IDX)  23550020
235600                                                                  23560009
235700                 MOVE LQW-CLUSTER-NUM (LQW-IDX)                   23570009
235800                                  TO CN163-CLUSTR-NBR             23580020
235900                                      (CN163-IDX)                 23590020
236000                 MOVE LQW-IP-ADDRESS (LQW-IDX)                    23600009
236100                                  TO CN163-PRTR-IP-ADDR           23610020
236200                                      (CN163-IDX)                 23620020
236300                 MOVE LQW-OS-RLSE-CDE (LQW-IDX)                   23630009
236400                                  TO CN163-PRTR-OS-RLSE-CDE       23640020
236500                                      (CN163-IDX)                 23650020
236600                 MOVE LQW-DATA-XFER-MDE (LQW-IDX)                 23660009
236700                                  TO  CN163-PRTR-DAT-XFER-MODE    23670020
236800                                       (CN163-IDX)                23680020
236900                 MOVE LQW-TRANSMIT-CDE (LQW-IDX)                  23690009
237000                                  TO  CN163-PRTR-XMIT-INTFC-CDE   23700020
237100                                       (CN163-IDX)                23710020
237200                                                                  23720009
237300                 SET CN163-IDX UP BY 1                            23730020
237400                 IF  CN163-IDX > CN163-MAX-ITEMS                  23740020
237500                     PERFORM 5205-WRITE-SEL-QUEUE                 23750009
237600                     ADD +1        TO CN162-NUMBER-OF-TS-ITEMS    23760020
237700                     INITIALIZE CN163-SELECTED-ITEM-ARRAY         23770020
237800                     SET CN163-IDX TO  1                          23780020
237900                 END-IF                                           23790009
238000             END-IF                                               23800009
238100         END-PERFORM                                              23810009
238200     END-IF.                                                      23820009
238300                                                                  23830009
238400*----------------------------------------------------------------*23840009
238500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23850009
238600*----------------------------------------------------------------*23860009
238700 5205-WRITE-SEL-QUEUE.                                            23870009
238800                                                                  23880009
238900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN163-SELECTED-ITEMS.   23890037
239000                                                                  23900009
239100     EXEC CICS                                                    23910009
239200          WRITEQ TS                                               23920009
239300              QUEUE (ASC-SEL-QUEUE-NAME)                          23930009
239400              FROM  (CN163-SELECT-RECORD)                         23940020
239500              ITEM  (PV-SEL-QUEUE-ITEM)                           23950009
239600              RESP  (PV-CICS-RESP)                                23960009
239700     END-EXEC.                                                    23970009
239800                                                                  23980009
239900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23990009
240000         CONTINUE                                                 24000009
240100     ELSE                                                         24010009
240200         SET DP013-CICS-ABEND      TO TRUE                        24020009
240300         SET DP013-NO-ROLLBACK     TO TRUE                        24030009
240400         MOVE '5205-WRITE-SEL-QUEUE'                              24040009
240500                                   TO DP013-PARAGRAPH             24050009
240600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24060009
240700                                   TO DP013-MESSAGE-TEXT(1)       24070009
240800         PERFORM DP013-0000-PROCESS-ABEND                         24080009
240900     END-IF.                                                      24090009
241000                                                                  24100034
241100******************************************************************24110009
241200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **24120009
241300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **24130009
241400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **24140009
241500** THE USER.                                                    **24150009
241600******************************************************************24160009
241700 6000-REFRESH-PANEL-FROM-TEMP.                                    24170009
241800     IF  ASC-UPDATE-TSQ                                           24180009
241900         SET ASC-NO-TSQ-UPDATE TO TRUE                            24190009
242000         MOVE ZERO                 TO PV-SAVE-ITEM                24200009
242100                                      PV-SEL-QUEUE-ITEM           24210009
242200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        24220009
242300                                   TO PV-HOLD-SELECTED-ITEMS      24230009
242400         MOVE +1                   TO PV-ITEMS-PROCESSED          24240009
242500         PERFORM 6100-UPDATE-TSQ                                  24250009
242600             UNTIL PV-ITEMS-PROCESSED >                           24260009
242700                                     PV-HOLD-SELECTED-ITEMS       24270009
242800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         24280009
242900                    ASC-BLOCK-ENTRIES (2)                         24290009
243000     END-IF.                                                      24300009
243100                                                                  24310009
243200*----------------------------------------------------------------*24320009
243300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *24330009
243400*----------------------------------------------------------------*24340009
243500 6010-DELETE-SEL-QUEUE.                                           24350009
243600                                                                  24360009
243700     EXEC CICS                                                    24370009
243800         DELETEQ TS                                               24380009
243900             QUEUE (ASC-SEL-QUEUE-NAME)                           24390009
244000             RESP  (PV-CICS-RESP)                                 24400009
244100     END-EXEC.                                                    24410009
244200                                                                  24420037
244300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24430009
244400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24440009
244500         CONTINUE                                                 24450009
244600     ELSE                                                         24460009
244700         SET DP013-CICS-ABEND TO TRUE                             24470009
244800         SET DP013-NO-ROLLBACK TO TRUE                            24480009
244900         MOVE '6010-DELETE-SEL-QUEUE'                             24490009
245000                        TO DP013-PARAGRAPH                        24500009
245100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24510009
245200                        TO DP013-MESSAGE-TEXT (1)                 24520009
245300         PERFORM DP013-0000-PROCESS-ABEND                         24530009
245400     END-IF.                                                      24540009
245500                                                                  24550009
245600*----------------------------------------------------------------*24560009
245700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24570009
245800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24580009
245900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24590009
246000*    THE TEMP QUEUE.                                             *24600009
246100*----------------------------------------------------------------*24610009
246200 6100-UPDATE-TSQ.                                                 24620009
246300                                                                  24630009
246400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             24640009
246500     PERFORM 6105-READ-SEL-QUEUE.                                 24650009
246600     PERFORM                                                      24660009
246700         VARYING CN163-IDX                                        24670020
246800         FROM 1 BY 1                                              24680009
246900         UNTIL ((PV-ITEMS-PROCESSED >                             24690009
247000                              PV-HOLD-SELECTED-ITEMS)             24700009
247100         OR (CN163-IDX GREATER THAN CN163-MAX-ITEMS))             24710020
247200         IF  CN163-ACTION-SW (CN163-IDX) > SPACE                  24720020
247300             PERFORM 6110-PROCESS-ITEMS                           24730009
247400         END-IF                                                   24740009
247500         ADD +1                TO PV-ITEMS-PROCESSED              24750009
247600     END-PERFORM.                                                 24760009
247700     PERFORM 6111-WRITE-LIST-QUEUE.                               24770009
247800                                                                  24780037
247900*----------------------------------------------------------------*24790009
248000*    READ THE LIST QUEUE RECORD.                                 *24800009
248100*----------------------------------------------------------------*24810009
248200 6105-READ-SEL-QUEUE.                                             24820009
248300                                                                  24830009
248400     EXEC CICS                                                    24840009
248500          READQ TS                                                24850009
248600              QUEUE (ASC-SEL-QUEUE-NAME)                          24860009
248700              INTO  (CN163-SELECT-RECORD)                         24870020
248800              ITEM  (PV-SEL-QUEUE-ITEM)                           24880009
248900              RESP  (PV-CICS-RESP)                                24890009
249000     END-EXEC.                                                    24900009
249100                                                                  24910037
249200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24920009
249300         CONTINUE                                                 24930009
249400     ELSE                                                         24940009
249500         SET DP013-CICS-ABEND      TO  TRUE                       24950009
249600         SET DP013-NO-ROLLBACK     TO  TRUE                       24960009
249700         MOVE '6105-READ-SEL-QUEUE'                               24970009
249800                                   TO  DP013-PARAGRAPH            24980009
249900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24990009
250000                                   TO  DP013-MESSAGE-TEXT(1)      25000009
250100         PERFORM DP013-0000-PROCESS-ABEND                         25010009
250200     END-IF.                                                      25020009
250300                                                                  25030034
250400*----------------------------------------------------------------*25040009
250500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*25050009
250600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*25060009
250700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *25070009
250800*----------------------------------------------------------------*25080009
250900 6110-PROCESS-ITEMS.                                              25090009
251000                                                                  25100009
251100     COMPUTE PV-ITEM = 1 + ((CN163-ITEM (CN163-IDX) - 1)          25110020
251200                     / PC-ITEMS-PER-PANEL).                       25120009
251300                                                                  25130009
251400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25140009
251500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25150009
251600             PERFORM 6111-WRITE-LIST-QUEUE                        25160009
251700         END-IF                                                   25170009
251800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25180009
251900                                                                  25190009
252000         PERFORM 6112-READ-LIST-QUEUE                             25200009
252100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               25210009
252200             CONTINUE                                             25220009
252300         END-IF                                                   25230009
252400     END-IF.                                                      25240009
252500                                                                  25250009
252600     COMPUTE PV-SUB = (CN163-ITEM (CN163-IDX)                     25260020
252700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              25270009
252800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         25280009
252900     MOVE LQW-SELECTED-SW (PV-SUB)                                25290009
253000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  25300009
253100     EVALUATE TRUE                                                25310009
253200*LMM                                                              25320068
253300         WHEN CN163-INQ (CN163-IDX)                               25330020
253400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25340009
253500                                                                  25350009
253600*FIELDS THAT CAN BE UPDATED:  IP ADDRESS, OPERATING SYS RELEASE   25360062
253700*CODE, DATA XFER MODE ID, TRANSMIT INTERFACE CODE.                25370062
253800         WHEN CN163-UPD (CN163-IDX)                               25380020
253900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             25390009
254000              MOVE CN163-PRTR-IP-ADDR (CN163-IDX)                 25400062
254100                               TO LQW-IP-ADDRESS (PV-SUB)         25410062
254200              MOVE CN163-PRTR-OS-RLSE-CDE (CN163-IDX)             25420062
254300                               TO LQW-OS-RLSE-CDE (PV-SUB)        25430062
254400              MOVE CN163-PRTR-DAT-XFER-MODE (CN163-IDX)           25440062
254500                               TO LQW-DATA-XFER-MDE (PV-SUB)      25450062
254600              MOVE CN163-PRTR-XMIT-INTFC-CDE (CN163-IDX)          25460062
254700                               TO LQW-TRANSMIT-CDE (PV-SUB)       25470062
254800                                                                  25480062
254900         WHEN CN163-DEL (CN163-IDX)                               25490062
255000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25500062
255100                                                                  25510062
255200         WHEN CN163-ERR (CN163-IDX)                               25520062
255300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25530062
255400                                                                  25540009
255500     END-EVALUATE.                                                25550009
255600                                                                  25560009
255700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25570009
255800                                                                  25580009
255900*----------------------------------------------------------------*25590009
256000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN Y220.             *25600079
256100*----------------------------------------------------------------*25610009
256200 6111-WRITE-LIST-QUEUE.                                           25620009
256300                                                                  25630009
256400     EXEC CICS                                                    25640009
256500         WRITEQ TS                                                25650009
256600             QUEUE (ASC-LIST-QUEUE-NAME)                          25660009
256700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25670009
256800             ITEM  (PV-SAVE-ITEM)                                 25680009
256900             REWRITE                                              25690009
257000             RESP  (PV-CICS-RESP)                                 25700009
257100     END-EXEC.                                                    25710009
257200                                                                  25720037
257300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25730009
257400         CONTINUE                                                 25740009
257500     ELSE                                                         25750009
257600         SET DP013-CICS-ABEND  TO  TRUE                           25760009
257700         SET DP013-NO-ROLLBACK TO  TRUE                           25770009
257800         MOVE '6111-WRITE-LIST-QUEUE'                             25780009
257900                               TO  DP013-PARAGRAPH                25790009
258000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25800009
258100                               TO  DP013-MESSAGE-TEXT(1)          25810009
258200         PERFORM DP013-0000-PROCESS-ABEND                         25820009
258300     END-IF.                                                      25830009
258400                                                                  25840009
258500*----------------------------------------------------------------*25850009
258600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25860009
258700*----------------------------------------------------------------*25870009
258800 6112-READ-LIST-QUEUE.                                            25880009
258900                                                                  25890009
259000     EXEC CICS                                                    25900009
259100         READQ TS                                                 25910009
259200             QUEUE (ASC-LIST-QUEUE-NAME)                          25920009
259300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25930009
259400             ITEM  (PV-ITEM)                                      25940009
259500             RESP  (PV-CICS-RESP)                                 25950009
259600     END-EXEC.                                                    25960009
259700                                                                  25970037
259800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25980009
259900         CONTINUE                                                 25990009
260000     ELSE                                                         26000009
260100         SET DP013-CICS-ABEND        TO TRUE                      26010009
260200         SET DP013-NO-ROLLBACK       TO TRUE                      26020009
260300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26030009
260400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26040009
260500                                     TO DP013-MESSAGE-TEXT(1)     26050009
260600         PERFORM DP013-0000-PROCESS-ABEND                         26060009
260700     END-IF.                                                      26070009
260800                                                                  26080009
260900*----------------------------------------------------------------*26090009
261000*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *26100009
261100*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *26110009
261200*----------------------------------------------------------------*26120009
261300 9900-SOFT-ABORT.                                                 26130009
261400                                                                  26140009
261500     EXEC CICS SYNCPOINT                                          26150009
261600          ROLLBACK                                                26160009
261700     END-EXEC.                                                    26170009
261800                                                                  26180009
261900     SET  PS-ERROR                                                26190009
262000          PS-SOFT-ABORT-ERROR                                     26200009
262100          DP020-MSG-FATAL       TO  TRUE.                         26210009
262200                                                                  26220009
262300*----------------------------------------------------------------*26230009
262400*    ABEND PROCESSOR MODULE                                      *26240009
262500*----------------------------------------------------------------*26250009
262600     COPY DPPD013.                                                26260009
