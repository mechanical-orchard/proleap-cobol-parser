000100***************************************************************** 00010035
000200 IDENTIFICATION DIVISION.                                         00020035
000300***************************************************************** 00030035
000400                                                                  00040035
000500 PROGRAM-ID.             TCKUT026.                                00050035
000600 AUTHOR.                 COGNIZANT.                               00060035
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070035
000800 DATE-WRITTEN            APRIL 2015.                              00080035
000900 DATE-COMPILED.                                                   00090035
001000                                                                  00100035
001100***************************************************************** 00110035
001200*  PURPOSE:                                                       00120035
001300*  THIS PROGRAM WILL TOKENIZE THE BELOW CARD NUMBER FIELD IN      00130035
001400*  SETTLEMENT ADJUSTMENT FILE IN ORDER TO ADHERE TO THE CURRENT   00140035
001500*  PCI AND PII DATA STANDARDS.                                    00150035
001600*  1) TC004-TDTL-PRI-ACCT-NBR                                     00160035
001700*  PROTEGRITY MODULE WILL BE INVOKED TO TOKENIZE THE CARD NUMBER  00170035
001800*                                                                 00180035
001900*  INPUT:  SETTLEMENT ADJUSTMENT FILE                             00190035
002000*  OUTPUT: SETTLEMENT ADJUSTMENT FILE WITH TOKENIZED CARD NUMBER  00200035
002100*                                                                 00210035
002200***************************************************************** 00220035
002300*----------------------------------------------------------------*00230035
002400*                                                                *00240035
002500* DATE:        03/25/2015                                        *00250035
002600* WR/IR#:      CHG0104429                                        *00260035
002700* PROGRAMMER:  COGNIZANT                                         *00270035
002800* DESCRIPTION: INITIAL VERSION CREATED FOR COSA DATA SECURITY    *00280035
002900*              PROJECT                                           *00290035
003000*                                                                *00300035
003100*----------------------------------------------------------------*00310035
003200***************************************************************** 00320035
003300 ENVIRONMENT DIVISION.                                            00330035
003400***************************************************************** 00340035
003500                                                                  00350035
003600 CONFIGURATION SECTION.                                           00360035
003700                                                                  00370035
003800 SOURCE-COMPUTER.        IBM-3090.                                00380035
003900                                                                  00390035
004000 OBJECT-COMPUTER.        IBM-3090.                                00400035
004100                                                                  00410035
004200 INPUT-OUTPUT SECTION.                                            00420035
004300                                                                  00430035
004400 FILE-CONTROL.                                                    00440035
004500                                                                  00450035
004600     SELECT SAF-INPUT-FILE                                        00460035
004700         ASSIGN TO INP01.                                         00470035
004800                                                                  00480035
004900     SELECT SAF-TOKEN-FILE                                        00490035
005000         ASSIGN TO OUT01.                                         00500035
005100                                                                  00510035
005200******************************************************************00520035
005300 DATA DIVISION.                                                   00530035
005400******************************************************************00540035
005500                                                                  00550035
005600 FILE SECTION.                                                    00560035
005700                                                                  00570035
005800 FD  SAF-INPUT-FILE                                               00580035
005900     RECORDING MODE IS F                                          00590035
006000     BLOCK CONTAINS 0 RECORDS                                     00600035
006100     LABEL RECORDS ARE STANDARD                                   00610035
006200     RECORD CONTAINS 320 CHARACTERS.                              00620035
006300                                                                  00630035
006400 01  SAF-INPUT-RECORD            PIC X(320).                      00640035
006500                                                                  00650035
006600 FD  SAF-TOKEN-FILE                                               00660035
006700     RECORDING MODE IS F                                          00670035
006800     BLOCK CONTAINS 0 RECORDS                                     00680035
006900     LABEL RECORDS ARE STANDARD                                   00690035
007000     RECORD CONTAINS 320 CHARACTERS.                              00700035
007100                                                                  00710035
007200 01  SAF-TOKEN-RECORD            PIC X(320).                      00720035
007300                                                                  00730035
007400******************************************************************00740035
007500 WORKING-STORAGE SECTION.                                         00750035
007600******************************************************************00760035
007700 01  FILLER                            PIC X(50)  VALUE           00770035
007800     ' *** WORKING STORAGE STARTS HERE FOR TCKUT026 *** '.        00780035
007900                                                                  00790035
008000 01  ABEND-CODE                        PIC S9(04) VALUE +0.       00800057
008100                                                                  00810057
008200 01  PS-PROGRAM-SWITCHES.                                         00820035
008300     05  PS-END-OF-SAF-SW              PIC X(01)  VALUE 'N'.      00830035
008400         88  PS-NOT-END-OF-SAF                    VALUE 'N'.      00840035
008500         88  PS-END-OF-SAF                        VALUE 'Y'.      00850035
008600                                                                  00860035
008700 01  PC-CONSTANTS.                                                00870035
008800     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           00880035
008900                                                 'TCKUT026'.      00890035
009000 01  PV-PROGRAM-VARIABLES.                                        00900035
009100     05  PV-SAF-READ-COUNT             PIC  9(07) VALUE ZEROES.   00910035
009200     05  PV-SAF-WRITE-COUNT            PIC  9(07) VALUE ZEROES.   00920035
009300     05  PV-INPUT-LENGTH               PIC  9(09).                00930056
009400                                                                  00940035
009500******************************************************************00950035
009600* RECORD LAYOUT FOR SETTLEMENT ADJUSTMENT FILE- INPUT AND OUTPUT *00960035
009700******************************************************************00970035
009800     COPY TCWS004.                                                00980035
009900                                                                  00990035
010000******************************************************************01000035
010100* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *01010035
010200* MODULE                                                         *01020035
010300******************************************************************01030035
010400     COPY PTYCCSIP.                                               01040035
010500                                                                  01050035
010600******************************************************************01060035
010700* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *01070035
010800* MODULE                                                         *01080035
010900******************************************************************01090035
011000     COPY DPWS031.                                                01100052
011100                                                                  01110035
011200******************************************************************01120035
011300                                                                  01130035
011400 PROCEDURE DIVISION.                                              01140035
011500                                                                  01150035
011600 0000-MAINLINE-PARA.                                              01160035
011700                                                                  01170035
011800     PERFORM 1000-INITIALIZE.                                     01180035
011900                                                                  01190035
012000     PERFORM 2000-PROCESS-RECORDS                                 01200035
012100           UNTIL PS-END-OF-SAF.                                   01210035
012200                                                                  01220035
012300     PERFORM 9000-EOJ-ROUTINE.                                    01230035
012400                                                                  01240035
012500     STOP RUN.                                                    01250035
012600                                                                  01260035
012700******************************************************************01270035
012800* 1000-INITIALIZE                                                 01280035
012900*     INITIALIZE THE VARIABLES, OPEN THE INPUT AND OUTPUT FILES   01290035
013000*     AND READ THE INPUT FILE                                     01300035
013100******************************************************************01310035
013200 1000-INITIALIZE.                                                 01320035
013300                                                                  01330035
013400     DISPLAY 'PROGRAM - ' PC-PROGRAM-NAME.                        01340035
013500     INITIALIZE PV-PROGRAM-VARIABLES.                             01350035
013600     MOVE PC-PROGRAM-NAME               TO DP031-PROGRAM-NAME.    01360055
013700                                                                  01370035
013800     OPEN INPUT  SAF-INPUT-FILE                                   01380035
013900          OUTPUT SAF-TOKEN-FILE.                                  01390035
014000                                                                  01400035
014100     PERFORM 2100-READ-SAF.                                       01410035
014200                                                                  01420035
014300******************************************************************01430035
014400* 2000-PROCESS-RECORDS                                            01440035
014500*   1. VALIDATE THE ADJUSTMENT RECORD TYPE:                       01450035
014600*   -  IF ADJUSTMENT RECORD TYPE IS 'AD', THEN PROCESS THE ACCOUNT01460035
014700*      NUMBERS TO TOKENIZE                                        01470035
014800*   2. WRITE THE RECORDS TO OUTPUT AND READ THE NEXT RECORD TO    01480035
014900*      PROCESS                                                    01490035
015000******************************************************************01500035
015100 2000-PROCESS-RECORDS.                                            01510035
015200                                                                  01520035
015300     MOVE ZEROES TO PV-INPUT-LENGTH.                              01530043
015400                                                                  01540043
015500     IF TC004-TDTL-RECT                                           01550035
015600        INSPECT FUNCTION REVERSE (TC004-TDTL-PRI-ACCT-NBR)        01560040
015700             TALLYING PV-INPUT-LENGTH FOR LEADING SPACES          01570042
015800        COMPUTE PV-INPUT-LENGTH =                                 01580044
015900             LENGTH OF TC004-TDTL-PRI-ACCT-NBR - PV-INPUT-LENGTH  01590047
016000                                                                  01600044
016100        IF PV-INPUT-LENGTH < 7                                    01610050
016200           CONTINUE                                               01620035
016300        ELSE                                                      01630035
016400           PERFORM 2200-PROCESS-TDTL-PRI-ACCT                     01640035
016500        END-IF                                                    01650035
016600     END-IF.                                                      01660035
016700                                                                  01670035
016800     PERFORM 3000-WRITE-SAF.                                      01680035
016900     PERFORM 2100-READ-SAF.                                       01690035
017000                                                                  01700035
017100******************************************************************01710035
017200* 2100-READ-SAF                                                   01720035
017300*      READ THE RECORDS IN SETTLEMENT ADJUSTMENT FILE             01730035
017400******************************************************************01740035
017500 2100-READ-SAF.                                                   01750035
017600                                                                  01760035
017700     READ SAF-INPUT-FILE INTO TC004-ADJUSTMENT-DATA               01770035
017800        AT END                                                    01780035
017900           SET PS-END-OF-SAF   TO TRUE                            01790035
018000        NOT AT END                                                01800035
018100           ADD 1               TO PV-SAF-READ-COUNT               01810035
018200     END-READ.                                                    01820035
018300                                                                  01830035
018400******************************************************************01840035
018500* 2200-PROCESS-TDTL-PRI-ACCT                                      01850035
018600*      PROCESS PRIMARY ACCOUNT NUMBERS WITH ADJUSTMENT RECORD TYPE01860035
018700*      'AD'                                                       01870035
018800******************************************************************01880035
018900 2200-PROCESS-TDTL-PRI-ACCT.                                      01890035
019000                                                                  01900035
019100     INITIALIZE CSI-PARAMETERS                                    01910044
019200                DP031-PROTEG-PGM-PARAMETERS.                      01920051
019300                                                                  01930044
019400     SET CSI-ENCRYPT-FUNCTION         TO TRUE.                    01940044
019500     SET DP031-ACCTNBR                TO TRUE.                    01950051
019600     MOVE 'TDTL-PRI-ACCT'             TO DP031-FIELD.             01960051
019700     MOVE TC004-TDTL-PRI-ACCT-NBR     TO DP031-CLEAR-TEXT.        01970051
019800     MOVE PV-INPUT-LENGTH             TO DP031-INPUT-LEN.         01980051
019900     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      01990052
020000                                                                  02000044
020100     IF CSI-RETURN-CODE NOT = ZERO                                02010044
020200        DISPLAY 'ABEND IN RECORD NUMBER - ' PV-SAF-READ-COUNT     02020044
020300        DISPLAY 'INPUT-LENGTH - ' PV-INPUT-LENGTH                 02030058
020400        PERFORM DP031-9999-ABEND                                  02040052
020500     END-IF.                                                      02050044
020600     MOVE DP031-CIPHER-TEXT        TO TC004-TDTL-PRI-ACCT-NBR.    02060051
020700                                                                  02070035
020800******************************************************************02080035
020900* 3000-WRITE-SAF                                                  02090035
021000*      WRITE THE RECORDS TO OUTPUT                                02100035
021100******************************************************************02110035
021200 3000-WRITE-SAF.                                                  02120035
021300                                                                  02130035
021400     WRITE SAF-TOKEN-RECORD  FROM TC004-ADJUSTMENT-DATA.          02140035
021500     ADD 1                   TO PV-SAF-WRITE-COUNT.               02150035
021600                                                                  02160035
021700******************************************************************02170035
021800* 9000-EOJ-ROUTINE                                                02180035
021900*      CLOSE THE INPUT AND OUTPUT FILES, DISPLAY THE MESSAGES     02190035
022000*      AND TERMINATE THE PROCESS.                                 02200035
022100******************************************************************02210035
022200 9000-EOJ-ROUTINE.                                                02220035
022300                                                                  02230035
022400     CLOSE SAF-INPUT-FILE                                         02240035
022500           SAF-TOKEN-FILE.                                        02250035
022600                                                                  02260035
022700     IF PV-SAF-READ-COUNT = 0                                     02270035
022800        DISPLAY 'INPUT SETTLEMENT ADJUSTMENT FILE IS EMPTY'       02280035
022900     END-IF.                                                      02290035
023000     DISPLAY 'SAF RECORDS READ   : ' PV-SAF-READ-COUNT.           02300035
023100     DISPLAY 'SAF RECORDS WRITTEN: ' PV-SAF-WRITE-COUNT.          02310035
023200                                                                  02320035
023300******************************************************************02330035
023400*      COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE   02340052
023500*      PROTEGRITY MODULE FOR TOKENIZATION                         02350035
023600******************************************************************02360035
023700      COPY DPPD031.                                               02370052
023800                                                                  02380035
023900******************************************************************02390035
