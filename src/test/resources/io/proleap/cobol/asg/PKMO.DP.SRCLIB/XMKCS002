      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.       XMKCS002.                                      00050005
       AUTHOR.           KOHLS.                                         00060000
       INSTALLATION.     KOHLS.                                         00070000
       DATE-WRITTEN      JULY, 2004.                                    00080001
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      *  THIS SUBROUTINE WILL PASS ONHAND BACK TO THE CALLING           00120000
      *  PROGRAM.                                                       00130000
      ******************************************************************00140000
      ******************************************************************00141013
PE0032* DATE  01/24/2012  COGNIZANT                                     00142015
PE0032* PKE0032   ADDED WITH UR IN THE SELECT QUERY OF TSKST TABLE     *00143014
PE0032*           TO ENABLE ACCESS TO THE TABLE DURING FSK865 JOB'S RUN*00144014
PE0032******************************************************************00145013
                                                                        00150000
      ******************************************************************00160000
       ENVIRONMENT DIVISION.                                            00170000
      ******************************************************************00180000
                                                                        00190000
      ******************************************************************00200000
       DATA DIVISION.                                                   00210000
      ******************************************************************00220000
                                                                        00230000
       WORKING-STORAGE SECTION.                                         00240000
                                                                        00250000
                                                                        00260000
       01  PV-PROGRAM-VARIABLES.                                        00270000
           05  PV-ITEM-NBR                   PIC S9(15)  VALUE ZEROS    00280000
                                                         COMP-3.        00290000
           05  PV-STR-NBR                    PIC S9(04)  VALUE ZEROS    00300002
                                                         COMP.          00310002
           05  PV-DATE-YMD             PIC 9(6)     VALUE ZERO.         00320008
           05  FILLER                  REDEFINES PV-DATE-YMD.           00330008
               10  PV-DATE-YY          PIC 9(2).                        00340008
               10  PV-DATE-MM          PIC 9(2).                        00350008
               10  PV-DATE-DD          PIC 9(2).                        00360008
           05  PV-DATE-DB2.                                             00370009
               10  PV-DATE-CC-DB2      PIC X(2).                        00380008
               10  PV-DATE-YY-DB2      PIC X(2).                        00390008
               10  FILLER              PIC X(1)  VALUE '-'.             00400008
               10  PV-DATE-MM-DB2      PIC X(2).                        00410008
               10  FILLER              PIC X(1)  VALUE '-'.             00420008
               10  PV-DATE-DD-DB2      PIC X(2).                        00430008
                                                                        00440000
      *---------------------------------------------------------------  00450000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SKU STORE TABLE    00460000
      *---------------------------------------------------------------  00470000
           EXEC SQL                                                     00480000
               INCLUDE TSKST                                            00490000
           END-EXEC.                                                    00500000
                                                                        00510000
      *----------------------------------------------------------------*00520000
      * COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00530000
      *----------------------------------------------------------------*00540000
           COPY XMWS003.                                                00550010
                                                                        00560000
      *---------------------------------------------------------------  00570000
      *  COMMUNICATIONS AREA FOR DB2                                    00580000
      *---------------------------------------------------------------  00590000
           EXEC SQL                                                     00600000
               INCLUDE SQLCA                                            00610000
           END-EXEC.                                                    00620000
                                                                        00630000
       LINKAGE SECTION.                                                 00640000
       01  DFHCOMMAREA.                                                 00650000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   00660000
                                            DEPENDING ON EIBCALEN.      00670000
               10  FILLER                   PIC X.                      00680000
                                                                        00690000
                                                                        00700000
      ******************************************************************00710000
       PROCEDURE DIVISION.                                              00720000
      ******************************************************************00730000
                                                                        00740000
           INITIALIZE                      XM003-ITEM-COMMAREA.         00750010
           MOVE DFHCOMMAREA            TO  XM003-ITEM-COMMAREA.         00760010
           SET XM003-SUCCESSFUL        TO TRUE.                         00770010
                                                                        00780000
           PERFORM 1000-SELECT-ONHANDS.                                 00790000
                                                                        00800000
           MOVE XM003-ITEM-COMMAREA TO DFHCOMMAREA.                     00810010
                                                                        00820000
           EXEC CICS                                                    00830000
                RETURN                                                  00840000
           END-EXEC.                                                    00850000
                                                                        00860000
                                                                        00870000
      *----------------------------------------------------------------*00880007
      * SELECT ON-HAND INFORMATION FOR A SPECIFIC ITEM/STORE.           00890007
      *----------------------------------------------------------------*00900007
       1000-SELECT-ONHANDS.                                             00910000
                                                                        00920007
            MOVE XM003-ITEM-NBR     TO PV-ITEM-NBR.                     00930010
            MOVE XM003-KEY-STR-NBR  TO PV-STR-NBR.                      00940010
                                                                        00950002
            EXEC SQL                                                    00960000
               SELECT  LAST_SALE_DATE                                   00970001
                    ,  LAST_RCVD_DATE                                   00980001
                    ,  ONHAND_QTY                                       00990001
                    ,  FIRST_RCVD_DATE                                  01000001
                    ,  FIRST_SALE_DATE                                  01010001
                    ,  YTD_SALES_UNIT_QTY                               01020001
                    ,  YTD_SALES_AMT                                    01030001
                    ,  LAST_UPD_TMST                                    01040001
                 INTO  :TSKST-LAST-SALE-DATE                            01050001
                     , :TSKST-LAST-RCVD-DATE                            01060001
                     , :TSKST-ONHAND-QTY                                01070001
                     , :TSKST-FIRST-RCVD-DATE                           01080001
                     , :TSKST-FIRST-SALE-DATE                           01090001
                     , :TSKST-YTD-SALES-UNIT-QTY                        01100001
                     , :TSKST-YTD-SALES-AMT                             01110001
                     , :TSKST-LAST-UPD-TMST                             01120001
                 FROM  TSKST                                            01130001
                WHERE  ITEM_NMBR  = :PV-ITEM-NBR                        01140002
                  AND  LOC_NBR    = :PV-STR-NBR                         01150003
PE0032          WITH UR                                                 01151013
            END-EXEC.                                                   01160001
                                                                        01170001
           EVALUATE TRUE                                                01180000
               WHEN SQLCODE = ZERO                                      01190000
                   MOVE TSKST-ONHAND-QTY      TO XM003-ONHAND           01200010
                   PERFORM 2000-CONVERT-SALE-RCVD-DATES                 01210008
                   MOVE TSKST-YTD-SALES-AMT   TO XM003-YTD-SALES-AMT    01220010
                   MOVE TSKST-YTD-SALES-UNIT-QTY                        01230001
                                           TO XM003-YTD-SALES-UNIT-QTY  01240010
                   MOVE TSKST-LAST-UPD-TMST   TO XM003-LAST-UPD-TMST    01250010
               WHEN SQLCODE = +100                                      01260001
                   MOVE 0                  TO XM003-ONHAND              01270010
                                              XM003-YTD-SALES-AMT       01320010
                                              XM003-YTD-SALES-UNIT-QTY  01330010
                   MOVE SPACES             TO XM003-LAST-SALE-DATE      01331011
                                              XM003-FIRST-RCVD-DATE     01332011
                                              XM003-FIRST-SALE-DATE     01333011
                                              XM003-LAST-RCVD-DATE      01334011
                   MOVE SQLCODE TO XM003-RETURN-SQLCODE                 01340010
               WHEN SQLWARN0 NOT = SPACES                               01350001
               WHEN SQLCODE < ZERO                                      01360001
               WHEN SQLCODE > ZERO                                      01370001
                   SET XM003-ONHAND-ERROR-Y TO TRUE                     01380010
                   MOVE SQLCODE TO XM003-RETURN-SQLCODE                 01390010
           END-EVALUATE.                                                01400001
                                                                        01410000
      *----------------------------------------------------------------*01420008
      * CONVERT THE TSKST SALES AND RECEIVED DATES TO STANDARD          01430008
      * DB2 DATE FORMAT.                                                01440008
      *----------------------------------------------------------------*01450008
       2000-CONVERT-SALE-RCVD-DATES.                                    01460008
                                                                        01470008
      *- FIRST RECEIPT DATE                                             01480008
           INITIALIZE   PV-DATE-YMD                                     01490008
                        PV-DATE-DB2.                                    01500008
                                                                        01510008
           MOVE TSKST-FIRST-RCVD-DATE  TO PV-DATE-YMD.                  01520008
                                                                        01530008
           IF PV-DATE-YY > 80                                           01540008
               MOVE 19             TO PV-DATE-CC-DB2                    01550008
           ELSE                                                         01560008
               MOVE 20             TO PV-DATE-CC-DB2                    01570008
           END-IF.                                                      01580008
                                                                        01590008
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   01600008
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   01610008
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   01620008
                                                                        01630008
           MOVE PV-DATE-DB2        TO XM003-FIRST-RCVD-DATE.            01640010
                                                                        01650008
      *- FIRST SALE DATE                                                01660008
           INITIALIZE   PV-DATE-YMD                                     01670008
                        PV-DATE-DB2.                                    01680008
                                                                        01690008
           MOVE TSKST-FIRST-SALE-DATE  TO PV-DATE-YMD.                  01700008
                                                                        01710008
           IF PV-DATE-YY > 80                                           01720008
               MOVE 19             TO PV-DATE-CC-DB2                    01730008
           ELSE                                                         01740008
               MOVE 20             TO PV-DATE-CC-DB2                    01750008
           END-IF.                                                      01760008
                                                                        01770008
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   01780008
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   01790008
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   01800008
                                                                        01810008
           MOVE PV-DATE-DB2        TO XM003-FIRST-SALE-DATE.            01820010
                                                                        01830008
      *- LAST RECEIPT DATE                                              01840008
           INITIALIZE   PV-DATE-YMD                                     01850008
                        PV-DATE-DB2.                                    01860008
                                                                        01870008
           MOVE TSKST-LAST-RCVD-DATE   TO PV-DATE-YMD.                  01880008
                                                                        01890008
           IF PV-DATE-YY > 80                                           01900008
               MOVE 19             TO PV-DATE-CC-DB2                    01910008
           ELSE                                                         01920008
               MOVE 20             TO PV-DATE-CC-DB2                    01930008
           END-IF.                                                      01940008
                                                                        01950008
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   01960008
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   01970008
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   01980008
                                                                        01990008
           MOVE PV-DATE-DB2        TO XM003-LAST-RCVD-DATE.             02000010
                                                                        02010008
      *- LAST SALE DATE                                                 02020008
           INITIALIZE   PV-DATE-YMD                                     02030008
                        PV-DATE-DB2.                                    02040008
                                                                        02050008
           MOVE TSKST-LAST-SALE-DATE   TO PV-DATE-YMD.                  02060008
                                                                        02070008
           IF PV-DATE-YY > 80                                           02080008
               MOVE 19             TO PV-DATE-CC-DB2                    02090008
           ELSE                                                         02100008
               MOVE 20             TO PV-DATE-CC-DB2                    02110008
           END-IF.                                                      02120008
                                                                        02130008
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   02140008
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   02150008
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   02160008
                                                                        02170008
           MOVE PV-DATE-DB2        TO XM003-LAST-SALE-DATE.             02180010
                                                                        02190008
