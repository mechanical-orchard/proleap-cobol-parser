000100 TITLE 'MAINTAIN LEGACY TMESTDS TABLE FROM RMS PO SYSTEM'.        00010007
000200 IDENTIFICATION DIVISION.                                         00020007
000300 PROGRAM-ID.    XLKUP016.                                         00030007
000400 AUTHOR.        DENNIS STEFFEN.                                   00040007
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050007
000600 DATE-WRITTEN.  EARLY SPRING 2003.                                00060007
000700 DATE-COMPILED.                                                   00070007
000800******************************************************************00080007
000900* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00090007
001000******************************************************************00100007
001010*DATE:04/16/2014   MADE BY:PRITHIVIRAJ S (COGNIZANT)             *00101011
001020* MODIFIED TO INCORPORATE COMPLETE/FULL STORE DELETE MESSAGE. IF *00102011
001030* COMPLETE/FULL STORE DELETE MESSAGE WILL NOT HAVE STORE NUMBER  *00103011
001040* I.E. STORE NUMBER WILL BE OF ZEROES THEN WE WILL BE            *00104011
001050* DELETING ALL THE RECORDS CORRESPONDING TO THE PO/SKU/DC NUMBER.*00105011
001051* ALL CHANGES ARE TAGGED WITH 'P5207G'. CR: CHG0081355           *00105111
001052******************************************************************00105207
001100                                                                  00110007
001200 ENVIRONMENT DIVISION.                                            00120007
001300 CONFIGURATION SECTION.                                           00130007
001400 SOURCE-COMPUTER.  IBM-3090.                                      00140007
001500 OBJECT-COMPUTER.  IBM-3090.                                      00150007
001600 DATA DIVISION.                                                   00160007
001700                                                                  00170007
001800 WORKING-STORAGE SECTION.                                         00180007
001900                                                                  00190007
002000 01  PC-PROGRAM-CONSTANTS.                                        00200007
002100     05  PC-SQL-NOT-FOUND             PIC S9(3)     VALUE +100.   00210007
002200 01  PV-CRAPOLA.                                                  00220007
002300     05  PS-PROCESS-CONTINUE-SW       PIC X(01)     VALUE 'Y'.    00230007
002400         88  PS-PROCESS-CONTINUE                    VALUE 'Y'.    00240007
002500         88  PS-PROCESS-END                         VALUE 'N'.    00250007
002600     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00260007
002700         88  PS-PO-EXISTS-YES                       VALUE 1.      00270007
002800         88  PS-PO-EXISTS-NO                        VALUE ZERO.   00280007
002900     05  PS-EXISTENCE-SKU             PIC S9 COMP-3 VALUE ZERO.   00290007
003000         88  PS-PLAN-EXISTS-YES                     VALUE 1.      00300007
003100         88  PS-PLAN-EXISTS-NO                      VALUE ZERO.   00310007
003200     05  PS-EXISTENCE-PURITM          PIC S9 COMP-3 VALUE ZERO.   00320007
003300         88  PS-PURITM-EXISTS-YES                   VALUE 1.      00330007
003400         88  PS-PURITM-EXISTS-NO                    VALUE ZERO.   00340007
003500     05  PS-PLAN-SW                   PIC X(01)   VALUE 'N'.      00350007
003600         88  PS-PLAN-NOT-FOUND-OK                 VALUE 'Y'.      00360007
003700     05  PS-PACK-YES-SW               PIC X(01)   VALUE SPACE.    00370007
003800         88  PS-PACK-YES                          VALUE 'Y'.      00380007
003900     05  PV-DISP-SKU                  PIC 9(08)     VALUE ZERO.   00390007
004000     05  PV-DISP-LINE                 PIC 9(04)     VALUE ZERO.   00400007
004100     05  PV-DISP-PLAN                 PIC 9(04)     VALUE ZERO.   00410007
004200     05  PV-DISP-STR                  PIC 9(04)     VALUE ZERO.   00420007
004201     05  PV-DISP-SQLCODE              PIC S9(04)    VALUE ZERO.   00420111
004202     05  PV-LOG-MESSAGE               PIC X(100)   VALUE SPACES.  00420207
004203                                                                  00420311
004204 01  DK-KEYS.                                                     00420411
004205     05  DK-PO-NBR                    PIC S9(09) COMP.            00420511
004206     05  DK-PO-LNE-NBR                PIC S9(09) COMP.            00420611
004207     05  DK-PLAN-NBR                  PIC S9(04) COMP.            00420711
004208     05  DK-DEST-NBR                  PIC S9(04) COMP.            00420811
004209     05  DK-STR-NBR                   PIC S9(04) COMP.            00420911
004210     05  DK-SKU-NBR                   PIC S9(8)V COMP-3.          00421011
004220/                                                                 00422011
004230*    NUMERIC EDITING ROUTINE                                      00423011
004240     COPY DPWS010I.                                               00424011
004250/                                                                 00425011
004260*    LEGACY PO HEADER                                             00426011
004270     EXEC SQL                                                     00427011
004280         INCLUDE TPURCHS                                          00428011
004290     END-EXEC.                                                    00429011
004300                                                                  00430011
004400*    LEGACY PO LINES                                              00440011
004500     EXEC SQL                                                     00450011
004600         INCLUDE TPURITM                                          00460011
004700     END-EXEC.                                                    00470011
004800                                                                  00480011
004900*    LEGACY PO PREPACK                                            00490011
005000     EXEC SQL                                                     00500011
005100         INCLUDE TPOPRPK                                          00510011
005200     END-EXEC.                                                    00520011
005300                                                                  00530011
005400*    LEGACY DC ALLOCATIONS                                        00540011
005500     EXEC SQL                                                     00550011
005600         INCLUDE TALLPLN                                          00560011
005700     END-EXEC.                                                    00570011
005800                                                                  00580011
005900*    LEGACY STORE DISTRO                                          00590011
006000     EXEC SQL                                                     00600011
006100         INCLUDE TMESTDS                                          00610011
006200     END-EXEC.                                                    00620011
006300                                                                  00630011
006400*    DOMAIN SKU TABLE                                             00640011
006500     EXEC SQL                                                     00650011
006600         INCLUDE XLT00003                                         00660011
006700     END-EXEC.                                                    00670011
006800                                                                  00680011
006900                                                                  00690011
007000     EXEC SQL                                                     00700011
007100          INCLUDE SQLCA                                           00710011
007200     END-EXEC.                                                    00720011
007300     COPY SQLCA2.                                                 00730011
007400* * *                                                             00740011
007500     EXEC SQL                                                     00750011
007600          DECLARE PACK-CSR CURSOR                                 00760011
007700          FOR SELECT DISTINCT                                     00770011
007800               PO_LNE_NBR                                         00780011
007900              ,PREPK_RATO_QTY                                     00790011
008000          FROM                                                    00800011
008100               TPURITM                                            00810011
008200         WHERE                                                    00820011
008300               PO_NBR         = :DK-PO-NBR                        00830011
008400           AND PO_PREPK_ID    = :POPRPK-PO-PREPK-ID               00840011
008500           AND VER_STATUS_CDE = 'A'                               00850011
008600     END-EXEC.                                                    00860011
008700                                                                  00870011
008800 LINKAGE SECTION.                                                 00880011
008900 01  XLRD011-RECORD.                                              00890011
009000     COPY XLRD011.                                                00900011
009100/                                                                 00910011
009200 PROCEDURE DIVISION USING XLRD011-RECORD.                         00920011
009300                                                                  00930011
009400* 1- GIVEN ARE PO-NBR AND SKU-NBR.  FROM THAT YOU MUST FIND       00940011
009500*    THE LINE FOR THAT ORDER THAT USES THAT SKU                   00950011
009600* 2- PACK ADD PROCESSING IS SEPARATE FROM NON-PACK ADDS           00960011
009700* 3- TPURCHS TRECITM AND TALLPLN MUST EXIST BEFORE ADDING TMESTDS 00970011
009800* 4- WHEN XL011-MSG-ID = ORD_LOCATION_DELETE, AND                 00980011
009900*    XL011-LD-LOCATION = 899, JUST EXIT THIS MODULE               00990011
010000                                                                  01000011
010100     IF XL011-DEBUG-YES                                           01010011
010200         DISPLAY 'XLKUP016 - XL011-ORDER-NBR = '  XL011-ORDER-NBR 01020011
010300         DISPLAY 'XLKUP016 - MESSAGE ID ' XL011-MSG-ID            01030011
010400     END-IF                                                       01040011
010500     INITIALIZE XL011-RETURN-AREA                                 01050011
010600                DK-KEYS                                           01060011
010700                PV-CRAPOLA                                        01070011
010800                PS-PACK-YES-SW                                    01080011
010900     SET XL011-SUCCESSFUL                                         01090011
011000         PS-PROCESS-CONTINUE          TO TRUE                     01100011
011100     IF XL011-MSG-ID = 'ORD_LOCATION_DELETE'                      01110011
011110*** PRB0051493 START                                              01111018
011200*      AND XL011-LD-LOCATION = 899                                01120017
011210       AND (XL011-LD-LOCATION = 899 OR XL011-LD-LOCATION = 85)    01121017
011220*** PRB0051493 END                                                01122017
011300         CONTINUE                                                 01130011
011400     ELSE                                                         01140011
011500         IF PS-PROCESS-CONTINUE                                   01150011
011600             PERFORM 1000-INITIALIZATION                          01160011
011700             IF PS-PROCESS-CONTINUE                               01170011
011800                 PERFORM 2000-PROCESS-MESSAGE                     01180011
011900             END-IF                                               01190011
012000         END-IF                                                   01200011
012100     END-IF.                                                      01210011
012200     PERFORM 9999-WRAPUP.                                         01220011
012300                                                                  01230011
012400     IF XL011-DEBUG-YES                                           01240011
012500         DISPLAY 'XLKUP016 - AT GOBACK'                           01250011
012600     END-IF                                                       01260011
012700     GOBACK.                                                      01270011
012800                                                                  01280011
012900 1000-INITIALIZATION.                                             01290011
013000     IF XL011-DEBUG-YES                                           01300011
013100         DISPLAY 'XLKUP016 - 1000-INITIALIZATION'                 01310011
013200     END-IF                                                       01320011
013300                                                                  01330011
013400     MOVE 'XLKUP016'                  TO XL011-ERROR-PROGRAM.     01340011
013500     MOVE XL011-ORDER-NBR             TO DK-PO-NBR                01350011
013600                                                                  01360011
013700*    NON-PACK ADD EDITS ARE DONE IN XLKUT023 TO                   01370011
013800*    AVOID REPETITION IF POSSIBLE.                                01380011
013900*    ADDS TO PACK ARE STILL DONE HERE.                            01390011
014000                                                                  01400011
014100     IF XL011-MSG-ID NOT = 'HDR_DELETE'                           01410011
014200         IF XL011-MSG-ID = 'STORE_ADD' AND                        01420011
014300                 XL011-STRA-PK-SKU-IND NOT = 'Y'                  01430011
014400             PERFORM 1200-NONPACK-EDITS                           01440011
014500         ELSE                                                     01450011
014600             PERFORM 1300-PACK-EDITS                              01460011
014700*            STORES ATTACHED TO PACK SKUS                         01470011
014800             PERFORM 7000-SELECT-TPURCHS                          01480011
014900             IF PS-PROCESS-CONTINUE                               01490011
015000                 IF PS-PO-EXISTS-NO                               01500011
015100                 STRING 'NO TPURCHS FOR PO = ' XL011-ORDER-NBR    01510011
015200                     DELIMITED BY SIZE    INTO XL011-ERROR-TEXT   01520011
015300                 SET XL011-SYSTEM-ERROR                           01530011
015400                     PS-PROCESS-END       TO TRUE                 01540011
015500                 ELSE                                             01550011
015600                     PERFORM 1100-DOES-PURITM-EXIST               01560011
015700                 END-IF                                           01570011
015800             END-IF                                               01580011
015900         END-IF                                                   01590011
016000     END-IF.                                                      01600011
016100** GB 7/21/14                                                     01610011
016200     IF PS-PROCESS-CONTINUE AND XL011-PACK-NO                     01620016
016300        IF XL011-MSG-ID = 'STORE_DELETE' OR 'ORD_LOCATION_DELETE' 01630014
016400           PERFORM 7310-FIND-TPURITM-FOR-SKU                      01640011
016500        END-IF                                                    01650011
016600     END-IF                                                       01660011
016610** GB 7/21/14                                                     01661011
016700                                                                  01670011
016800     IF XL011-MSG-ID NOT = 'HDR_DELETE' AND NOT = 'STORE_ADD'     01680011
016900       IF PS-PROCESS-CONTINUE                                     01690011
017000         IF PS-PURITM-EXISTS-NO                                   01700011
017400            MOVE DK-SKU-NBR          TO PV-DISP-SKU               01740011
017500            STRING 'NO TPURITM FOR PO / SKU '                     01750011
017600                                           XL011-ORDER-NBR        01760011
017700                                      ' '  PV-DISP-SKU            01770011
017800                 DELIMITED BY SIZE    INTO XL011-ERROR-TEXT       01780011
017900            SET XL011-SYSTEM-ERROR                                01790011
018000                    PS-PROCESS-END    TO TRUE                     01800011
018100         ELSE                                                     01810011
018200             IF PS-PLAN-EXISTS-NO                                 01820012
018210               IF XL011-MSG-ID = 'STORE_DELETE' OR                01821014
018211                                 'ORD_LOCATION_DELETE'            01821114
018220                 CONTINUE                                         01822012
018230               ELSE                                               01823012
018300                 MOVE DK-SKU-NBR        TO PV-DISP-SKU            01830011
018400                 STRING 'NO PLAN FOR PO = ' XL011-ORDER-NBR       01840011
018500                        ' SKU = ' PV-DISP-SKU                     01850011
018600                     DELIMITED BY SIZE    INTO XL011-ERROR-TEXT   01860011
018700                 SET XL011-SYSTEM-ERROR                           01870011
018800                     PS-PROCESS-END     TO TRUE                   01880011
018900               END-IF                                             01890012
018910             END-IF                                               01891012
019000         END-IF                                                   01900011
019100       END-IF                                                     01910011
019200     END-IF.                                                      01920011
019300                                                                  01930011
019400 1100-DOES-PURITM-EXIST.                                          01940011
019500     IF XL011-DEBUG-YES                                           01950011
019600         DISPLAY 'XLKUP016 - 1100-DOES-PURITM-EXIST'              01960011
019700     END-IF                                                       01970011
019800                                                                  01980011
019900*    LOAD THE KEY FOR THE ITEM NBR LOOKUP                         01990011
020000     EVALUATE XL011-MSG-ID                                        02000011
020100       WHEN 'STORE_ADD'                                           02010011
020200             MOVE XL011-STRA-COMP-SKU-NBR  TO DK-SKU-NBR          02020011
020300             MOVE XL011-STRA-LOCATION      TO DK-DEST-NBR         02030011
020400             MOVE XL011-STRA-STORE-NBR     TO DK-STR-NBR          02040011
020500             MOVE XL011-STRA-PK-SKU-IND    TO PS-PACK-YES-SW      02050011
020600             IF XL011-DEBUG-YES                                   02060011
020700                 DISPLAY 'XLKUP016 - SKU '                        02070011
020800                          XL011-STRA-COMP-SKU-NBR                 02080011
020900             END-IF                                               02090011
021000       WHEN 'STORE_QTY_CHANGE'                                    02100011
021100             MOVE XL011-STQC-COMP-SKU-NBR  TO DK-SKU-NBR          02110011
021200             MOVE XL011-STQC-LOCATION      TO DK-DEST-NBR         02120011
021300             MOVE XL011-STQC-STORE-NBR     TO DK-STR-NBR          02130011
021400             MOVE XL011-STQC-PK-SKU-IND    TO PS-PACK-YES-SW      02140011
021500             IF XL011-DEBUG-YES                                   02150011
021600                 DISPLAY 'XLKUP016 - SKU '                        02160011
021700                          XL011-STQC-COMP-SKU-NBR                 02170011
021800             END-IF                                               02180011
021900       WHEN 'STORE_ATTR_CHANGE'                                   02190011
022000             MOVE XL011-STAC-COMP-SKU-NBR  TO DK-SKU-NBR          02200011
022100             MOVE XL011-STAC-LOCATION      TO DK-DEST-NBR         02210011
022200             MOVE XL011-STAC-STORE-NBR     TO DK-STR-NBR          02220011
022300             MOVE XL011-STAC-PK-SKU-IND    TO PS-PACK-YES-SW      02230011
022400             IF XL011-DEBUG-YES                                   02240011
022500                 DISPLAY 'XLKUP016 - SKU '                        02250011
022600                          XL011-STAC-COMP-SKU-NBR                 02260011
022700             END-IF                                               02270011
022800       WHEN 'STORE_DELETE'                                        02280011
022900             MOVE XL011-STD-COMP-SKU-NBR   TO DK-SKU-NBR          02290011
023000             MOVE XL011-STD-LOCATION       TO DK-DEST-NBR         02300011
023100             MOVE XL011-STD-STORE-NBR      TO DK-STR-NBR          02310011
023200             MOVE XL011-STD-PK-SKU-IND     TO PS-PACK-YES-SW      02320011
023300             IF XL011-DEBUG-YES                                   02330011
023400                 DISPLAY 'XLKUP016 - SKU '                        02340011
023500                          XL011-STD-COMP-SKU-NBR                  02350011
023600             END-IF                                               02360011
023700       WHEN 'ORD_LOCATION_DELETE'                                 02370011
023800             MOVE XL011-LD-COMP-SKU-NBR    TO DK-SKU-NBR          02380011
023900             MOVE XL011-LD-LOCATION        TO DK-DEST-NBR         02390011
024000             MOVE XL011-LD-PK-SKU-IND      TO PS-PACK-YES-SW      02400011
024100             IF XL011-DEBUG-YES                                   02410011
024200                 DISPLAY 'XLKUP016 - SKU '                        02420011
024300                          XL011-LD-COMP-SKU-NBR                   02430011
024400             END-IF                                               02440011
024500     END-EVALUATE.                                                02450011
024600                                                                  02460011
024700     IF XL011-PACK-YES                                            02470011
024800       OR PS-PACK-YES                                             02480011
024900         PERFORM 7500-GET-PACK-ID                                 02490011
025000         IF PS-PROCESS-CONTINUE                                   02500011
025100             PERFORM 7510-OPEN-PACK-CSR                           02510011
025200             IF PS-PROCESS-CONTINUE                               02520011
025300                 PERFORM 7520-FETCH-PACK-CSR                      02530011
025400                 IF PS-PROCESS-CONTINUE                           02540011
025500                     IF SQLCODE = PC-SQL-NOT-FOUND                02550011
025600                         SET PS-PURITM-EXISTS-NO   TO TRUE        02560011
025700                     ELSE                                         02570011
025800                         SET PS-PURITM-EXISTS-YES                 02580011
025900                             PS-PLAN-NOT-FOUND-OK  TO TRUE        02590011
026000                         PERFORM 7410-FIND-TALLPLN-FOR-LINE       02600011
026100                         INITIALIZE PS-PLAN-SW                    02610011
026200                     END-IF                                       02620011
026300                 END-IF                                           02630011
026400             END-IF                                               02640011
026500         END-IF                                                   02650011
026600                                                                  02660011
026700     ELSE                                                         02670011
026800                                                                  02680011
026900*    FIND THE TPURITM FOR THE SKU WITHIN THE GIVEN ORDER          02690011
027000*        PERFORM 7310-FIND-TPURITM-FOR-SKU                        02700011
027100         PERFORM 7300-FIND-TPURITM-TALLPLN                        02710011
027200**       IF PS-PURITM-EXISTS-YES                                  02720011
027300*    FIND THE TALLPLN FOR THE SKU WITHIN THE GIVEN ORDER          02730011
027400**           PERFORM 7400-FIND-TALLPLN-FOR-SKU                    02740011
027500**       END-IF                                                   02750011
027600     END-IF.                                                      02760011
027700                                                                  02770011
027800     IF XL011-SUCCESSFUL                                          02780011
027900         MOVE PURITM-PO-LNE-NBR       TO DK-PO-LNE-NBR            02790011
028000         MOVE ALLPLN-PLAN-NBR         TO DK-PLAN-NBR              02800011
028100     END-IF.                                                      02810011
028200                                                                  02820011
028201/                                                                 02820111
028202 1200-NONPACK-EDITS.                                              02820211
028203     CONTINUE.                                                    02820311
028204/                                                                 02820411
028205 1300-PACK-EDITS.                                                 02820511
028206     CONTINUE.                                                    02820611
028207/                                                                 02820711
028208 2000-PROCESS-MESSAGE.                                            02820811
028209     IF XL011-DEBUG-YES                                           02820911
028210         DISPLAY 'XLKUP016 - 2000-PROCESS-MESSAGE'                02821011
028220     END-IF                                                       02822011
028230                                                                  02823011
028240*    LINE NUMBER AND PLAN HAVE ALREADY BEEN DETERMINED IN         02824011
028250*    PARAGRAPH 1100-DOES-PURITM-EXIST                             02825011
028260                                                                  02826011
028270     EVALUATE XL011-MSG-ID                                        02827011
028280                                                                  02828011
028290     WHEN 'STORE_ADD'                                             02829011
028300                                                                  02830011
028400         PERFORM 2100-CREATE-TMESTDS                              02840011
028500                                                                  02850011
028600       WHEN 'STORE_QTY_CHANGE'                                    02860011
028700             PERFORM 2200-UPDATE-STR-QTY                          02870011
028800                                                                  02880011
028900       WHEN 'STORE_ATTR_CHANGE'                                   02890011
029000             PERFORM 2300-UPDATE-STR-ATT                          02900011
029100                                                                  02910011
029200       WHEN 'STORE_DELETE'                                        02920011
029300           IF PS-PLAN-EXISTS-YES                                  02930011
029400               PERFORM 2400-DELETE-STR                            02940011
029500           END-IF                                                 02950011
029600       WHEN 'ORD_LOCATION_DELETE'                                 02960011
029700           IF PS-PLAN-EXISTS-YES                                  02970011
029800               PERFORM 2500-DELETE-PLAN                           02980011
029900           END-IF                                                 02990011
030000       WHEN 'HDR_DELETE'                                          03000011
030100           PERFORM 7212-DELETE-TMESTDS-PO                         03010011
030200           IF XL011-SUCCESSFUL                                    03020011
030300               SET XL011-LOC-UPD-YES TO TRUE                      03030011
030400           END-IF                                                 03040011
030500                                                                  03050011
030600     END-EVALUATE.                                                03060011
030700                                                                  03070011
030800 2100-CREATE-TMESTDS.                                             03080011
030900     IF XL011-DEBUG-YES                                           03090011
031000         DISPLAY 'XLKUP016 - 2100-CREATE-TMESTDS'                 03100011
031100     END-IF                                                       03110011
031200                                                                  03120011
031300     INITIALIZE DCLTMESTDS.                                       03130011
031400     IF XL011-STRA-PK-SKU-IND = 'Y'                               03140011
031500         PERFORM 2110-CREATE-PACK-TMESTDS                         03150011
031600             UNTIL PS-PROCESS-END                                 03160011
031700         IF XL011-SUCCESSFUL                                      03170011
031800             PERFORM 7530-CLOSE-PACK-CSR                          03180011
031900         END-IF                                                   03190011
032000                                                                  03200011
032100     ELSE                                                         03210011
032200                                                                  03220011
035000         MOVE XL011-STRA-QTY-ALLOCATED TO DP010I-UNEDITED-FIELD   03500007
035100         MOVE 8                        TO DP010I-MAXIMUM-DIGITS   03510007
035200         MOVE 4                        TO DP010I-MAXIMUM-DECIMALS 03520007
035300         PERFORM 8100-NUMERIC-EDIT                                03530007
035400         IF PS-PROCESS-CONTINUE                                   03540007
035500             MOVE DP010I-NUMERIC-FIELD                            03550007
035600                                      TO MESTDS-STR-DISTRO-QTY    03560007
035700             MOVE XL011-ORDER-NBR     TO MESTDS-PO-NBR            03570007
035800             MOVE XL011-PO-LINE-NBR   TO MESTDS-PO-LNE-NBR        03580007
035900             MOVE XL011-PLAN-NBR      TO MESTDS-PLAN-NBR          03590007
036000             MOVE XL011-STRA-STORE-NBR TO MESTDS-STR-NBR          03600007
036100             MOVE XL011-STRA-ALLOC-SEQ-NBR                        03610007
036200                                      TO MESTDS-ALLOC-SEQ-CDE     03620007
036300             MOVE XL011-STRA-RANK-SEQ-NBR                         03630007
036400                                      TO MESTDS-RNK-SEQ-NBR       03640007
036500             MOVE XL011-STRA-CONSTRAINT-CODE                      03650007
036600                                      TO MESTDS-STR-CNSTR-CDE     03660007
036700             MOVE XL011-STRA-CONSTRAINT-QTY                       03670007
036800                                      TO MESTDS-STR-CNSTR-QTY     03680007
036900             PERFORM 7200-INSERT-TMESTDS                          03690007
037000         END-IF                                                   03700007
037100     END-IF.                                                      03710007
037200                                                                  03720007
037300 2110-CREATE-PACK-TMESTDS.                                        03730007
037400     IF XL011-DEBUG-YES                                           03740007
037500         DISPLAY 'XLKUP016 - 2110-CREATE-PACK-TMESTDS'            03750007
037600     END-IF                                                       03760007
037700                                                                  03770007
037800     MOVE XL011-STRA-QTY-ALLOCATED   TO DP010I-UNEDITED-FIELD     03780007
037900     MOVE 8                          TO DP010I-MAXIMUM-DIGITS     03790007
038000     MOVE 4                          TO DP010I-MAXIMUM-DECIMALS   03800007
038100     PERFORM 8100-NUMERIC-EDIT                                    03810007
038200     IF PS-PROCESS-CONTINUE                                       03820007
038300         COMPUTE MESTDS-STR-DISTRO-QTY =                          03830007
038400             DP010I-NUMERIC-FIELD  *                              03840007
038500             PURITM-PREPK-RATO-QTY                                03850007
038600         END-COMPUTE                                              03860007
038700         MOVE DK-PO-NBR               TO MESTDS-PO-NBR            03870007
038800         MOVE DK-PO-LNE-NBR           TO MESTDS-PO-LNE-NBR        03880007
038900         MOVE DK-PLAN-NBR             TO MESTDS-PLAN-NBR          03890007
039000         MOVE DK-STR-NBR              TO MESTDS-STR-NBR           03900007
039100         MOVE XL011-STRA-ALLOC-SEQ-NBR TO MESTDS-ALLOC-SEQ-CDE    03910007
039200         MOVE XL011-STRA-RANK-SEQ-NBR  TO MESTDS-RNK-SEQ-NBR      03920007
039300         MOVE XL011-STRA-CONSTRAINT-CODE                          03930007
039400                                       TO MESTDS-STR-CNSTR-CDE    03940007
039500         COMPUTE MESTDS-STR-CNSTR-QTY =                           03950007
039600                 XL011-STRA-CONSTRAINT-QTY *                      03960007
039700                 PURITM-PREPK-RATO-QTY                            03970007
039800                                                                  03980007
039900         PERFORM 7200-INSERT-TMESTDS                              03990007
040000                                                                  04000007
040100         IF PS-PROCESS-CONTINUE                                   04010007
040200             PERFORM 7520-FETCH-PACK-CSR                          04020007
040300             IF PS-PROCESS-CONTINUE                               04030007
040400                 PERFORM 7410-FIND-TALLPLN-FOR-LINE               04040007
040500             END-IF                                               04050007
040600         END-IF                                                   04060007
040700     END-IF.                                                      04070007
040800/                                                                 04080007
040900 2200-UPDATE-STR-QTY.                                             04090007
041000     IF XL011-DEBUG-YES                                           04100007
041100         DISPLAY 'XLKUP016 - 2200-UPDATE-STR-QTY'                 04110007
041200     END-IF                                                       04120007
041300                                                                  04130007
041400     IF XL011-STQC-PK-SKU-IND = 'Y'                               04140007
041500         PERFORM 2210-UPDATE-PACK-STR-QTY                         04150007
041600             UNTIL PS-PROCESS-END                                 04160007
041700         IF XL011-SUCCESSFUL                                      04170007
041800             PERFORM 7530-CLOSE-PACK-CSR                          04180007
041900         END-IF                                                   04190007
042000     ELSE                                                         04200007
042100         MOVE XL011-STQC-QTY-ALLOCATED TO DP010I-UNEDITED-FIELD   04210007
042200         MOVE 8                        TO DP010I-MAXIMUM-DIGITS   04220007
042300         MOVE 4                        TO DP010I-MAXIMUM-DECIMALS 04230007
042400         PERFORM 8100-NUMERIC-EDIT                                04240007
042500         IF PS-PROCESS-CONTINUE                                   04250007
042600             MOVE DP010I-NUMERIC-FIELD                            04260007
042700                                      TO MESTDS-STR-DISTRO-QTY    04270007
042800             PERFORM 7120-UPD-STR-QTY                             04280007
042900         END-IF                                                   04290007
043000     END-IF.                                                      04300007
043100                                                                  04310007
043200 2210-UPDATE-PACK-STR-QTY.                                        04320007
043300     IF XL011-DEBUG-YES                                           04330007
043400         DISPLAY 'XLKUP016 - 2110-UPDATE-PACK-STR-QTY'            04340007
043500     END-IF                                                       04350007
043600                                                                  04360007
043700     MOVE XL011-STQC-QTY-ALLOCATED   TO DP010I-UNEDITED-FIELD     04370007
043800     MOVE 8                          TO DP010I-MAXIMUM-DIGITS     04380007
043900     MOVE 4                          TO DP010I-MAXIMUM-DECIMALS   04390007
044000     PERFORM 8100-NUMERIC-EDIT                                    04400007
044100     IF PS-PROCESS-CONTINUE                                       04410007
044200         COMPUTE MESTDS-STR-DISTRO-QTY =                          04420007
044300             DP010I-NUMERIC-FIELD  *                              04430007
044400             PURITM-PREPK-RATO-QTY                                04440007
044500         END-COMPUTE                                              04450007
044600         PERFORM 7120-UPD-STR-QTY                                 04460007
044700         IF PS-PROCESS-CONTINUE                                   04470007
044800             PERFORM 7520-FETCH-PACK-CSR                          04480007
044900             IF PS-PROCESS-CONTINUE                               04490007
045000                 PERFORM 7410-FIND-TALLPLN-FOR-LINE               04500007
045100             END-IF                                               04510007
045200         END-IF                                                   04520007
045300     END-IF.                                                      04530007
045400                                                                  04540007
045500 2300-UPDATE-STR-ATT.                                             04550007
045600     IF XL011-DEBUG-YES                                           04560007
045700         DISPLAY 'XLKUP016 - 2300-UPDATE-STR-ATT'                 04570007
045800     END-IF                                                       04580007
045900                                                                  04590007
046000     IF XL011-STAC-PK-SKU-IND = 'Y'                               04600007
046100         PERFORM 2310-UPDATE-PACK-STR-ATT                         04610007
046200             UNTIL PS-PROCESS-END                                 04620007
046300         IF XL011-SUCCESSFUL                                      04630007
046400             PERFORM 7530-CLOSE-PACK-CSR                          04640007
046500         END-IF                                                   04650007
046600     ELSE                                                         04660007
046700         MOVE XL011-STAC-ALLOC-SEQ-NBR                            04670007
046800                                      TO MESTDS-ALLOC-SEQ-CDE     04680007
046900         MOVE XL011-STAC-RANK-SEQ-NBR TO MESTDS-RNK-SEQ-NBR       04690007
047000         MOVE XL011-STAC-CONSTRAINT-CODE                          04700007
047100                                      TO MESTDS-STR-CNSTR-CDE     04710007
047200         MOVE XL011-STAC-CONSTRAINT-QTY                           04720007
047300                                      TO MESTDS-STR-CNSTR-QTY     04730007
047400         PERFORM 7130-UPD-STR-ATT                                 04740007
047500     END-IF.                                                      04750007
047600                                                                  04760007
047700 2310-UPDATE-PACK-STR-ATT.                                        04770007
047800     IF XL011-DEBUG-YES                                           04780007
047900         DISPLAY 'XLKUP016 - 2310-UPDATE-PACK-STR-ATT'            04790007
048000     END-IF                                                       04800007
048100                                                                  04810007
048200     MOVE XL011-STAC-ALLOC-SEQ-NBR    TO MESTDS-ALLOC-SEQ-CDE     04820007
048300     MOVE XL011-STAC-RANK-SEQ-NBR     TO MESTDS-RNK-SEQ-NBR       04830007
048400     MOVE XL011-STAC-CONSTRAINT-CODE  TO MESTDS-STR-CNSTR-CDE     04840007
048500     COMPUTE MESTDS-STR-CNSTR-QTY =                               04850007
048600             XL011-STAC-CONSTRAINT-QTY *                          04860007
048700             PURITM-PREPK-RATO-QTY                                04870007
048800                                                                  04880007
048900     PERFORM 7130-UPD-STR-ATT.                                    04890007
049000                                                                  04900007
049100     IF PS-PROCESS-CONTINUE                                       04910007
049200         PERFORM 7520-FETCH-PACK-CSR                              04920007
049300         IF PS-PROCESS-CONTINUE                                   04930007
049400             PERFORM 7410-FIND-TALLPLN-FOR-LINE                   04940007
049500         END-IF                                                   04950007
049600     END-IF.                                                      04960007
049700                                                                  04970007
049800 2400-DELETE-STR.                                                 04980007
049900     IF XL011-DEBUG-YES                                           04990007
050000         DISPLAY 'XLKUP016 - 2400-DELETE-STR'                     05000007
050100     END-IF                                                       05010007
050200                                                                  05020007
050300     IF XL011-STD-PK-SKU-IND = 'Y'                                05030007
050400         PERFORM 2410-DELETE-PACK-STR                             05040007
050500             UNTIL PS-PROCESS-END                                 05050007
050600         IF XL011-SUCCESSFUL                                      05060007
050700             PERFORM 7530-CLOSE-PACK-CSR                          05070007
050800         END-IF                                                   05080007
050900     ELSE                                                         05090007
051000         PERFORM 7210-DELETE-TMESTDS-STR                          05100007
051100     END-IF.                                                      05110007
051200                                                                  05120007
051300 2410-DELETE-PACK-STR.                                            05130007
051400     IF XL011-DEBUG-YES                                           05140007
051500         DISPLAY 'XLKUP016 - 2410-DELETE-PACK-STR'                05150007
051600     END-IF                                                       05160007
051700                                                                  05170007
051800     PERFORM 7210-DELETE-TMESTDS-STR                              05180007
051900                                                                  05190007
052000     IF PS-PROCESS-CONTINUE                                       05200007
052100         PERFORM 7520-FETCH-PACK-CSR                              05210007
052200         IF PS-PROCESS-CONTINUE                                   05220007
052300             PERFORM 7410-FIND-TALLPLN-FOR-LINE                   05230007
052400         END-IF                                                   05240007
052500     END-IF.                                                      05250007
052600                                                                  05260007
052700 2500-DELETE-PLAN.                                                05270007
052800     IF XL011-DEBUG-YES                                           05280007
052900         DISPLAY 'XLKUP016 - 2500-DELETE-PLAN'                    05290007
053000     END-IF                                                       05300007
053100                                                                  05310007
053200     IF XL011-LD-PK-SKU-IND  = 'Y'                                05320007
053300         PERFORM 2510-DELETE-PACK-PLAN                            05330007
053400             UNTIL PS-PROCESS-END                                 05340007
053500         IF XL011-SUCCESSFUL                                      05350007
053600             PERFORM 7530-CLOSE-PACK-CSR                          05360007
053700         END-IF                                                   05370007
053800     ELSE                                                         05380007
053900         PERFORM 7214-DELETE-TMESTDS-PLAN                         05390007
054000     END-IF.                                                      05400007
054100                                                                  05410007
054200 2510-DELETE-PACK-PLAN.                                           05420007
054300     IF XL011-DEBUG-YES                                           05430007
054400         DISPLAY 'XLKUP016 - 2510-DELETE-PACK-PLAN'               05440007
054500     END-IF                                                       05450007
054600                                                                  05460007
054700     PERFORM 7214-DELETE-TMESTDS-PLAN                             05470007
054800                                                                  05480007
054900     IF PS-PROCESS-CONTINUE                                       05490007
055000         PERFORM 7520-FETCH-PACK-CSR                              05500007
055100         IF PS-PROCESS-CONTINUE                                   05510007
055200             PERFORM 7410-FIND-TALLPLN-FOR-LINE                   05520007
055300         END-IF                                                   05530007
055400     END-IF.                                                      05540007
055500/                                                                 05550007
055600 7000-SELECT-TPURCHS.                                             05560007
055700     IF XL011-DEBUG-YES                                           05570007
055800         DISPLAY 'XLKUP016 - 7000-SELECT-TPURCHS'                 05580007
055900     END-IF                                                       05590007
056000                                                                  05600007
056100     MOVE ZERO                        TO PS-EXISTENCE-PO          05610007
056200                                                                  05620007
056300     EXEC SQL                                                     05630007
056400         SELECT 1                                                 05640007
056500*        ,   PKGNG_CDE                                            05650011
056600         INTO                                                     05660007
056700             :PS-EXISTENCE-PO                                     05670007
056800*        ,   :PURCHS-PKGNG-CDE                                    05680011
056900         FROM                                                     05690007
057000             TPURCHS                                              05700007
057100         WHERE                                                    05710007
057200             PO_NBR                   = :DK-PO-NBR                05720007
057300         AND VER_STATUS_CDE           = 'A'                       05730007
057400         FETCH FIRST 1 ROWS ONLY                                  05740007
057500     END-EXEC.                                                    05750007
057600                                                                  05760007
057700     MOVE SQLCODE                     TO XL011-SQLCODE            05770007
057800     EVALUATE TRUE                                                05780007
057900         WHEN SQLCODE = ZERO                                      05790007
058000         WHEN SQLCODE = +100                                      05800007
058100             CONTINUE                                             05810007
058200         WHEN OTHER                                               05820007
058300             SET XL011-SQL-ERROR                                  05830007
058400                 PS-PROCESS-END       TO TRUE                     05840007
058500             MOVE '7000-SELECT-TPURCHS'                           05850007
058600                                      TO XL011-ERROR-PARAGRAPH    05860007
058700             MOVE 'TPURCHS'           TO XL011-DB2-TABLE-NAME(1)  05870007
058800     END-EVALUATE.                                                05880007
058900/                                                                 05890007
059000 7120-UPD-STR-QTY.                                                05900007
059100     IF XL011-DEBUG-YES                                           05910007
059200         DISPLAY 'XLKUP016 - 7120-UPD-STR-QTY'                    05920007
059300     END-IF                                                       05930007
059400                                                                  05940007
059500     MOVE '7120-UPD-STR-QTY'          TO XL011-ERROR-PARAGRAPH    05950007
059600     EXEC SQL                                                     05960007
059700         UPDATE TMESTDS                                           05970007
059800         SET STR_DISTRO_QTY           = :MESTDS-STR-DISTRO-QTY    05980007
059900         WHERE                                                    05990007
060000             PO_NBR                   = :DK-PO-NBR                06000007
060100         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            06010007
060200         AND PLAN_NBR                 = :DK-PLAN-NBR              06020007
060300         AND STR_NBR                  = :DK-STR-NBR               06030007
060400     END-EXEC.                                                    06040007
060500                                                                  06050007
060600     MOVE SQLCODE                     TO XL011-SQLCODE            06060007
060700     MOVE 'TMESTDS'                   TO XL011-DB2-TABLE-NAME(1)  06070007
060800     EVALUATE TRUE                                                06080007
060900         WHEN SQLCODE = ZERO                                      06090007
061000             CONTINUE                                             06100007
061100         WHEN SQLCODE = +100                                      06110007
061200             MOVE DK-PO-LNE-NBR       TO PV-DISP-LINE             06120007
061300             MOVE DK-PLAN-NBR         TO PV-DISP-PLAN             06130007
061400             MOVE DK-STR-NBR          TO PV-DISP-STR              06140007
061500             STRING 'DISTRO NOT FOUND FOR PO/LINE/PLAN/STR = '    06150007
061600             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    06160007
061700                 '/' PV-DISP-STR                                  06170007
061800                 DELIMITED BY SIZE    INTO XL011-ERROR-TEXT       06180007
061900             SET XL011-SYSTEM-ERROR   TO TRUE                     06190007
062000       WHEN OTHER                                                 06200007
062100                                                                  06210011
062101             MOVE SQLCODE TO PV-DISP-SQLCODE                      06210111
062102             STRING '%%SQLCODE=  ' PV-DISP-SQLCODE ' / '          06210207
062103             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    06210307
062104                 '/' PV-DISP-STR DELIMITED BY SIZE                06210407
062105             INTO PV-LOG-MESSAGE                                  06210511
062106             DISPLAY PV-LOG-MESSAGE                               06210611
062107                                                                  06210711
062108             SET XL011-SQL-ERROR      TO TRUE                     06210807
062109     END-EVALUATE.                                                06210911
062110/                                                                 06211011
062120 7130-UPD-STR-ATT.                                                06212011
062130     IF XL011-DEBUG-YES                                           06213011
062140         DISPLAY 'XLKUP016 - 7130-UPD-STR-ATT'                    06214011
062150     END-IF                                                       06215011
062160                                                                  06216011
062170     EXEC SQL                                                     06217011
062180         UPDATE TMESTDS                                           06218011
062190             SET ALLOC_SEQ_CDE        = :MESTDS-ALLOC-SEQ-CDE     06219011
062200         ,       RNK_SEQ_NBR          = :MESTDS-RNK-SEQ-NBR       06220011
062300         ,       STR_CNSTR_CDE        = :MESTDS-STR-CNSTR-CDE     06230011
062400         ,       STR_CNSTR_QTY        = :MESTDS-STR-CNSTR-QTY     06240011
062500         WHERE                                                    06250011
062600             PO_NBR                   = :DK-PO-NBR                06260011
062700         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            06270011
062800         AND PLAN_NBR                 = :DK-PLAN-NBR              06280011
062900         AND STR_NBR                  = :DK-STR-NBR               06290011
063000     END-EXEC.                                                    06300011
063100                                                                  06310011
063200     MOVE SQLCODE                     TO XL011-SQLCODE            06320011
063300     MOVE '7130-UPD-STR-ATT'          TO XL011-ERROR-PARAGRAPH    06330011
063400     MOVE 'TMESTDS'                   TO XL011-DB2-TABLE-NAME(1)  06340011
063500     EVALUATE TRUE                                                06350011
063600         WHEN SQLCODE = ZERO                                      06360011
063700             CONTINUE                                             06370011
063800         WHEN SQLCODE = +100                                      06380011
063900             MOVE DK-PO-LNE-NBR       TO PV-DISP-LINE             06390011
064000             MOVE DK-PLAN-NBR         TO PV-DISP-PLAN             06400011
064100             MOVE DK-STR-NBR          TO PV-DISP-STR              06410011
064200             STRING 'DISTRO NOT FOUND FOR PO/LINE/PLAN/STR = '    06420011
064300             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    06430011
064400                 '/' PV-DISP-STR                                  06440011
064500                 DELIMITED BY SIZE    INTO XL011-ERROR-TEXT       06450011
064600             SET XL011-SYSTEM-ERROR   TO TRUE                     06460011
064700       WHEN OTHER                                                 06470011
064800                                                                  06480011
064801             MOVE SQLCODE TO PV-DISP-SQLCODE                      06480111
064802             STRING '%%SQLCODE=  ' PV-DISP-SQLCODE ' / '          06480207
064803             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    06480307
064804                 '/' PV-DISP-STR DELIMITED BY SIZE                06480407
064805                 INTO PV-LOG-MESSAGE                              06480511
064806             DISPLAY PV-LOG-MESSAGE                               06480611
064807                                                                  06480711
064808             SET XL011-SQL-ERROR      TO TRUE                     06480811
064809     END-EVALUATE.                                                06480911
064810/                                                                 06481011
064820 7200-INSERT-TMESTDS.                                             06482011
064830     IF XL011-DEBUG-YES                                           06483011
064840         DISPLAY 'XLKUP016 - 7200-INSERT-TMESTDS'                 06484011
064850     END-IF                                                       06485011
064860                                                                  06486011
064870     EXEC SQL                                                     06487011
064880         INSERT INTO TMESTDS                                      06488011
064890             (                                                    06489011
064900             PO_NBR                                               06490011
065000            ,PO_LNE_NBR                                           06500011
065100            ,PLAN_NBR                                             06510011
065200            ,STR_NBR                                              06520011
065300            ,STR_DISTRO_QTY                                       06530011
065400            ,ALLOC_SEQ_CDE                                        06540011
065500            ,RNK_SEQ_NBR                                          06550011
065600            ,STR_CNSTR_CDE                                        06560011
065700            ,STR_CNSTR_QTY                                        06570011
065800         )                                                        06580011
065900         VALUES                                                   06590011
066000         (                                                        06600011
066100               :MESTDS-PO-NBR                                     06610011
066200           ,   :MESTDS-PO-LNE-NBR                                 06620011
066300           ,   :MESTDS-PLAN-NBR                                   06630011
066400           ,   :MESTDS-STR-NBR                                    06640011
066500           ,   :MESTDS-STR-DISTRO-QTY                             06650011
066600           ,   :MESTDS-ALLOC-SEQ-CDE                              06660011
066700           ,   :MESTDS-RNK-SEQ-NBR                                06670011
066800           ,   :MESTDS-STR-CNSTR-CDE                              06680011
066900           ,   :MESTDS-STR-CNSTR-QTY                              06690011
067000             )                                                    06700011
067100        END-EXEC                                                  06710011
067200                                                                  06720011
067300     MOVE SQLCODE                     TO XL011-SQLCODE            06730011
067400     EVALUATE TRUE                                                06740011
067500         WHEN SQLCODE = ZERO                                      06750011
067600         WHEN SQLCODE = -803                                      06760011
067700             CONTINUE                                             06770011
067800         WHEN OTHER                                               06780011
067900                                                                  06790011
067901             MOVE SQLCODE TO PV-DISP-SQLCODE                      06790111
067902             STRING '%%SQLCODE=  ' PV-DISP-SQLCODE ' / '          06790207
067903             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    06790307
067904                 '/' PV-DISP-STR DELIMITED BY SIZE                06790407
067905                 INTO PV-LOG-MESSAGE                              06790511
067906             DISPLAY PV-LOG-MESSAGE                               06790611
067907                                                                  06790711
067908             SET XL011-SQL-ERROR      TO TRUE                     06790811
067909             MOVE '7200-INSERT-TMESTDS'                           06790911
067910                                      TO XL011-ERROR-PARAGRAPH    06791011
067920             MOVE 'TMESTDS'           TO XL011-DB2-TABLE-NAME(1)  06792011
067930     END-EVALUATE.                                                06793011
067940/                                                                 06794011
067950 7210-DELETE-TMESTDS-STR.                                         06795011
067960     IF XL011-DEBUG-YES                                           06796011
067970         DISPLAY 'XLKUP016 - 7210-DELETE-TMESTDS-STR'             06797011
067980     END-IF                                                       06798011
067990                                                                  06799011
068000     IF XL011-STD-STORE-NBR = ZEROES                              06800011
068100       EXEC SQL                                                   06810011
068200          DELETE                                                  06820011
068300          FROM                                                    06830011
068400              TMESTDS                                             06840011
068500          WHERE                                                   06850011
068600              PO_NBR                   = :DK-PO-NBR               06860011
068700          AND PO_LNE_NBR               = :DK-PO-LNE-NBR           06870011
068800          AND PLAN_NBR                 = :DK-PLAN-NBR             06880011
068900       END-EXEC                                                   06890011
069000     ELSE                                                         06900011
069100       EXEC SQL                                                   06910011
069200           DELETE                                                 06920011
069300           FROM                                                   06930011
069400               TMESTDS                                            06940011
069500           WHERE                                                  06950011
069600               PO_NBR                   = :DK-PO-NBR              06960011
069700           AND PO_LNE_NBR               = :DK-PO-LNE-NBR          06970011
069800           AND PLAN_NBR                 = :DK-PLAN-NBR            06980011
069900           AND STR_NBR                  = :DK-STR-NBR             06990011
070000       END-EXEC                                                   07000011
070100     END-IF.                                                      07010011
070200                                                                  07020011
070300     MOVE SQLCODE                     TO XL011-SQLCODE            07030011
070400     EVALUATE TRUE                                                07040011
070500         WHEN SQLCODE = ZERO                                      07050011
070600         WHEN SQLCODE = +100                                      07060011
070700             CONTINUE                                             07070011
070800         WHEN OTHER                                               07080011
070900                                                                  07090011
070901             MOVE SQLCODE TO PV-DISP-SQLCODE                      07090111
070902             STRING '%%SQLCODE=  ' PV-DISP-SQLCODE ' / '          07090207
070903             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    07090307
070904                 '/' PV-DISP-STR DELIMITED BY SIZE                07090407
070905                 INTO PV-LOG-MESSAGE                              07090511
070906             DISPLAY PV-LOG-MESSAGE                               07090611
070907                                                                  07090711
070908             SET XL011-SQL-ERROR      TO TRUE                     07090811
070909             MOVE '7210-DELETE-TMESTDS-STR'                       07090911
070910                                      TO XL011-ERROR-PARAGRAPH    07091011
070920             MOVE 'TMESTDS'           TO XL011-DB2-TABLE-NAME(1)  07092011
070930     END-EVALUATE.                                                07093011
070940                                                                  07094011
070950 7212-DELETE-TMESTDS-PO.                                          07095011
070960     IF XL011-DEBUG-YES                                           07096011
070970         DISPLAY 'XLKUP016 -7212-DELETE-TMESTDS-PO'               07097011
070980     END-IF                                                       07098011
070990                                                                  07099011
071000     EXEC SQL                                                     07100011
071100         DELETE                                                   07110011
071200         FROM                                                     07120011
071300             TMESTDS                                              07130011
071400         WHERE                                                    07140011
071500             PO_NBR                   = :DK-PO-NBR                07150011
071600     END-EXEC.                                                    07160011
071700                                                                  07170011
071800     MOVE SQLCODE                     TO XL011-SQLCODE            07180011
071900     EVALUATE TRUE                                                07190011
072000         WHEN SQLCODE = ZERO                                      07200011
072100         WHEN SQLCODE = +100                                      07210011
072200             CONTINUE                                             07220011
072300         WHEN OTHER                                               07230011
072400                                                                  07240011
072401             MOVE SQLCODE TO PV-DISP-SQLCODE                      07240111
072402             STRING '%%SQLCODE=  ' PV-DISP-SQLCODE ' / '          07240207
072403             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    07240307
072404                 '/' PV-DISP-STR DELIMITED BY SIZE                07240407
072405                 INTO PV-LOG-MESSAGE                              07240511
072406             DISPLAY PV-LOG-MESSAGE                               07240611
072407                                                                  07240711
072408             SET XL011-SQL-ERROR      TO TRUE                     07240811
072409             MOVE '7212-DELETE-TMESTDS-PO'                        07240911
072410                                      TO XL011-ERROR-PARAGRAPH    07241011
072420             MOVE 'TMESTDS'           TO XL011-DB2-TABLE-NAME(1)  07242011
072430     END-EVALUATE.                                                07243011
072440                                                                  07244011
072450 7214-DELETE-TMESTDS-PLAN.                                        07245011
072460     IF XL011-DEBUG-YES                                           07246011
072470         DISPLAY 'XLKUP016 - 7214-DELETE-TMESTDS-PLAN'            07247011
072480     END-IF                                                       07248011
072490                                                                  07249011
072500     EXEC SQL                                                     07250011
072600         DELETE                                                   07260011
072700         FROM                                                     07270011
072800             TMESTDS                                              07280011
072900         WHERE                                                    07290011
073000             PO_NBR                   = :DK-PO-NBR                07300011
073100         AND PO_LNE_NBR               = :DK-PO-LNE-NBR            07310011
073200         AND PLAN_NBR                 = :DK-PLAN-NBR              07320011
073300     END-EXEC.                                                    07330011
073400                                                                  07340011
073500     MOVE SQLCODE                     TO XL011-SQLCODE            07350011
073600     EVALUATE TRUE                                                07360011
073700         WHEN SQLCODE = ZERO                                      07370011
073800         WHEN SQLCODE = +100                                      07380011
073900             CONTINUE                                             07390011
074000         WHEN OTHER                                               07400011
074100                                                                  07410011
074101             MOVE SQLCODE TO PV-DISP-SQLCODE                      07410111
074102             STRING '%%SQLCODE=  ' PV-DISP-SQLCODE ' / '          07410207
074103             XL011-ORDER-NBR '/' PV-DISP-LINE '/' PV-DISP-PLAN    07410307
074104                 '/' PV-DISP-STR DELIMITED BY SIZE                07410407
074105                 INTO PV-LOG-MESSAGE                              07410511
074106             DISPLAY PV-LOG-MESSAGE                               07410611
074107                                                                  07410711
074108             SET XL011-SQL-ERROR      TO TRUE                     07410811
074109             MOVE '7214-DELETE-TMESTDS-PLAN'                      07410911
074110                                      TO XL011-ERROR-PARAGRAPH    07411011
074120             MOVE 'TMESTDS'           TO XL011-DB2-TABLE-NAME(1)  07412011
074130     END-EVALUATE.                                                07413011
074140                                                                  07414011
074150 7300-FIND-TPURITM-TALLPLN.                                       07415011
074160     IF XL011-DEBUG-YES                                           07416011
074170         DISPLAY 'XLKUP016 - 7300-FIND-TPURITM-TALLPLN'           07417011
074180     END-IF                                                       07418011
074190                                                                  07419011
074200     EXEC SQL                                                     07420011
074300     SELECT                                                       07430011
074400            PUR.PO_LNE_NBR                                        07440011
074500     ,      PUR.PREPK_RATO_QTY                                    07450011
074600     ,      TALL.PLAN_NBR                                         07460011
074700     INTO                                                         07470011
074800         :PURITM-PO-LNE-NBR                                       07480011
074900     ,   :PURITM-PREPK-RATO-QTY                                   07490011
075000     ,   :ALLPLN-PLAN-NBR                                         07500011
075100     FROM                                                         07510011
075200         XLT_SKU      SKU                                         07520011
075300     ,   TPURITM      PUR                                         07530011
075400     ,   TALLPLN      TALL                                        07540011
075500     WHERE                                                        07550011
075600        SKU.SKU_NBR                = :DK-SKU-NBR                  07560011
075700    AND PUR.PO_NBR                 = :DK-PO-NBR                   07570011
075800    AND PUR.PO_PREPK_ID            = 0                            07580011
075900    AND PUR.VER_STATUS_CDE         = 'A'                          07590011
076000    AND PUR.ITM_NBR                = SKU.ITM_NBR                  07600011
076100    AND PUR.PO_NBR                 = TALL.PO_NBR                  07610011
076200    AND PUR.PO_LNE_NBR             = TALL.PO_LNE_NBR              07620011
076300    AND TALL.DEST_NBR              = :DK-DEST-NBR                 07630011
076400     END-EXEC.                                                    07640011
076500                                                                  07650011
076600     MOVE SQLCODE                     TO XL011-SQLCODE            07660011
076700     EVALUATE TRUE                                                07670011
076800         WHEN SQLCODE = ZERO                                      07680011
076900         WHEN SQLCODE = -811                                      07690011
077000             SET PS-PURITM-EXISTS-YES                             07700011
077100                 PS-PLAN-EXISTS-YES   TO TRUE                     07710011
077200         WHEN SQLCODE = +100                                      07720011
077300             SET PS-PURITM-EXISTS-NO                              07730011
077400                 PS-PLAN-EXISTS-NO    TO TRUE                     07740011
077410             IF XL011-DEBUG-YES                                   07741015
077420                DISPLAY 'XLKUP016 - 7300-FIND-TPURITM- +100  '    07742015
077430             END-IF                                               07743015
077500       WHEN OTHER                                                 07750011
077600             SET XL011-SQL-ERROR                                  07760011
077700                 PS-PROCESS-END       TO TRUE                     07770011
077800             MOVE '7300-FIND-TPURITM-TALLPLN'                     07780011
077900                                      TO XL011-ERROR-PARAGRAPH    07790011
078000             MOVE 'XLT_SKU'           TO XL011-DB2-TABLE-NAME(1)  07800011
078100             MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(2)  07810011
078200             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(3)  07820011
078300     END-EVALUATE.                                                07830011
078400                                                                  07840011
078500/                                                                 07850011
078600 7310-FIND-TPURITM-FOR-SKU.                                       07860011
078800     IF XL011-DEBUG-YES                                           07880011
078900         DISPLAY 'XLKUP016 - 7310-FIND-TPURITM-FOR-SKU'           07890011
079000     END-IF                                                       07900011
079100                                                                  07910011
079200     EXEC SQL                                                     07920011
079300     SELECT                                                       07930011
079400            PUR.PO_LNE_NBR                                        07940011
079500     ,      PUR.PREPK_RATO_QTY                                    07950011
079600     INTO                                                         07960011
079700         :PURITM-PO-LNE-NBR                                       07970011
079800     ,   :PURITM-PREPK-RATO-QTY                                   07980011
079900     FROM                                                         07990011
080000         XLT_SKU      SKU                                         08000011
080100     ,   TPURITM      PUR                                         08010011
080200     WHERE                                                        08020011
080300        SKU.SKU_NBR                = :DK-SKU-NBR                  08030011
080400    AND PUR.PO_NBR                 = :DK-PO-NBR                   08040011
080500    AND PUR.ITM_NBR                = SKU.ITM_NBR                  08050011
080600    AND PUR.VER_STATUS_CDE         = 'A'                          08060011
080700     END-EXEC.                                                    08070011
080800                                                                  08080011
080900     MOVE SQLCODE                     TO XL011-SQLCODE            08090011
081000     EVALUATE TRUE                                                08100011
081100         WHEN SQLCODE = ZERO                                      08110011
081200         WHEN SQLCODE = -811                                      08120011
081300             SET PS-PURITM-EXISTS-YES TO TRUE                     08130011
081400         WHEN SQLCODE = +100                                      08140011
081500             SET PS-PURITM-EXISTS-NO  TO TRUE                     08150011
081510             IF XL011-DEBUG-YES                                   08151015
081520                DISPLAY 'XLKUP016 - 7310-FIND-TPURITM- +100  '    08152015
081530             END-IF                                               08153015
081600       WHEN OTHER                                                 08160011
081700             SET XL011-SQL-ERROR                                  08170011
081800                 PS-PROCESS-END       TO TRUE                     08180011
081900             MOVE '7310-FIND-TPURITM-FOR-SKU'                     08190011
082000                                      TO XL011-ERROR-PARAGRAPH    08200011
082100             MOVE 'XLT_SKU'           TO XL011-DB2-TABLE-NAME(1)  08210011
082200             MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(2)  08220011
082300     END-EVALUATE.                                                08230011
082400                                                                  08240011
082500*7400-FIND-TALLPLN-FOR-SKU.                                       08250011
082600*    IF XL011-DEBUG-YES                                           08260011
082700*        DISPLAY 'XLKUP016 - 7400-FIND-TALLPLN-FOR-SKU'           08270011
082800*    END-IF                                                       08280011
082900*                                                                 08290011
083000*    EXEC SQL                                                     08300011
083100*    SELECT                                                       08310011
083200*           PUR.PO_LNE_NBR                                        08320011
083300*    ,      TALL.PLAN_NBR                                         08330011
083400*    ,      PUR.PREPK_RATO_QTY                                    08340011
083500*    INTO                                                         08350011
083600*        :PURITM-PO-LNE-NBR                                       08360011
083700*    ,   :ALLPLN-PLAN-NBR                                         08370011
083800*    ,   :PURITM-PREPK-RATO-QTY                                   08380011
083900*    FROM                                                         08390011
084000*        XLT_SKU      SKU                                         08400011
084100*    ,   TPURITM      PUR                                         08410011
084200*    ,   TALLPLN      TALL                                        08420011
084300*    WHERE                                                        08430011
084400*       SKU.SKU_NBR                = :DK-SKU-NBR                  08440011
084500*   AND PUR.PO_NBR                 = :DK-PO-NBR                   08450011
084600*   AND PUR.PO_PREPK_ID            = 0                            08460011
084700*   AND PUR.ITM_NBR                = SKU.ITM_NBR                  08470011
084800*   AND TALL.PO_NBR                = PUR.PO_NBR                   08480011
084900*   AND TALL.PO_LNE_NBR            = PUR.PO_LNE_NBR               08490011
085000*   AND PUR.VER_STATUS_CDE         = 'A'                          08500011
085100*   AND TALL.DEST_NBR              = :DK-DEST-NBR                 08510011
085200*    END-EXEC.                                                    08520011
085300*                                                                 08530011
085400*    MOVE SQLCODE                     TO XL011-SQLCODE            08540011
085500*    EVALUATE TRUE                                                08550011
085600*        WHEN SQLCODE = ZERO                                      08560011
085700*        WHEN SQLCODE = -811                                      08570011
085800*            SET PS-PLAN-EXISTS-YES   TO TRUE                     08580011
085900*        WHEN SQLCODE = +100                                      08590011
086000*            SET PS-PLAN-EXISTS-NO    TO TRUE                     08600011
086100*        WHEN OTHER                                               08610011
086200*            SET XL011-SQL-ERROR                                  08620011
086300*                PS-PROCESS-END       TO TRUE                     08630011
086400*            MOVE '7400-FIND-TALLPLN-FOR-SKU'                     08640011
086500*                                     TO XL011-ERROR-PARAGRAPH    08650011
086600*            MOVE 'XLT_SKU'           TO XL011-DB2-TABLE-NAME(1)  08660011
086700*            MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(2)  08670011
086800*            MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(3)  08680011
086900*    END-EVALUATE.                                                08690011
087000/                                                                 08700011
087100 7410-FIND-TALLPLN-FOR-LINE.                                      08710011
087200     IF XL011-DEBUG-YES                                           08720011
087300         DISPLAY 'XLKUP016 - 7410-FIND-TALLPLN-FOR-LINE'          08730011
087400     END-IF                                                       08740011
087500                                                                  08750011
087600     EXEC SQL                                                     08760011
087700     SELECT                                                       08770011
087800            TALL.PLAN_NBR                                         08780011
087900     INTO                                                         08790011
088000         :ALLPLN-PLAN-NBR                                         08800011
088100     FROM                                                         08810011
088200         TPURITM      PUR                                         08820011
088300     ,   TALLPLN      TALL                                        08830011
088400     WHERE                                                        08840011
088500          PUR.PO_NBR                 = :DK-PO-NBR                 08850011
088600       AND TALL.PO_NBR                = PUR.PO_NBR                08860011
088700       AND PUR.PO_LNE_NBR             = :PURITM-PO-LNE-NBR        08870011
088800       AND TALL.PO_LNE_NBR            = :PURITM-PO-LNE-NBR        08880011
088900       AND PUR.VER_STATUS_CDE         = 'A'                       08890011
089000       AND TALL.DEST_NBR              = :DK-DEST-NBR              08900011
089100     END-EXEC.                                                    08910011
089200                                                                  08920011
089300     MOVE SQLCODE                     TO XL011-SQLCODE            08930011
089400     EVALUATE TRUE                                                08940011
089500         WHEN SQLCODE = ZERO                                      08950011
089600*        WHEN SQLCODE = -811                                      08960011
089700             SET PS-PLAN-EXISTS-YES   TO TRUE                     08970011
089800             MOVE ALLPLN-PLAN-NBR     TO DK-PLAN-NBR              08980011
089900         WHEN SQLCODE = +100                                      08990011
090000             IF PS-PLAN-NOT-FOUND-OK                              09000011
090100                 SET PS-PLAN-EXISTS-NO    TO TRUE                 09010011
090200             ELSE                                                 09020011
090300                 SET XL011-SQL-ERROR                              09030011
090400                     PS-PROCESS-END   TO TRUE                     09040011
090500                 MOVE '7410-FIND-TALLPLN-FOR-LINE'                09050011
090600                                      TO XL011-ERROR-PARAGRAPH    09060011
090700                 MOVE 'TPURITM'       TO XL011-DB2-TABLE-NAME(1)  09070011
090800                 MOVE 'TALLPLN'       TO XL011-DB2-TABLE-NAME(2)  09080011
090900             END-IF                                               09090011
091000         WHEN OTHER                                               09100011
091100             SET XL011-SQL-ERROR                                  09110011
091200                 PS-PROCESS-END       TO TRUE                     09120011
091300             MOVE '7410-FIND-TALLPLN-FOR-LINE'                    09130011
091400                                      TO XL011-ERROR-PARAGRAPH    09140011
091500             MOVE 'TPURITM'           TO XL011-DB2-TABLE-NAME(1)  09150011
091600             MOVE 'TALLPLN'           TO XL011-DB2-TABLE-NAME(2)  09160011
091700     END-EVALUATE.                                                09170011
091800                                                                  09180011
091900 7500-GET-PACK-ID.                                                09190011
092000     IF XL011-DEBUG-YES                                           09200011
092100         DISPLAY 'XLKUP016 - 7500-GET-PACK-ID'                    09210011
092200     END-IF                                                       09220011
092300                                                                  09230011
092400     EXEC SQL                                                     09240011
092500     SELECT                                                       09250011
092600          PO_PREPK_ID                                             09260011
092700     INTO                                                         09270011
092800         :POPRPK-PO-PREPK-ID                                      09280011
092900     FROM                                                         09290011
093000         TPOPRPK                                                  09300011
093100     WHERE                                                        09310011
093200            PO_NBR               = :DK-PO-NBR                     09320011
093300        AND PK_SKU_NBR           = :DK-SKU-NBR                    09330011
093400     END-EXEC.                                                    09340011
093500                                                                  09350011
093600     MOVE SQLCODE                     TO XL011-SQLCODE            09360011
093700     EVALUATE TRUE                                                09370011
093800         WHEN SQLCODE = ZERO                                      09380011
093900             CONTINUE                                             09390011
094000         WHEN OTHER                                               09400011
094100             SET XL011-SQL-ERROR                                  09410011
094200                 PS-PROCESS-END      TO TRUE                      09420011
094300             MOVE '7500-GET-PACK-ID' TO XL011-ERROR-PARAGRAPH     09430011
094400             MOVE 'TPOPRPK'          TO XL011-DB2-TABLE-NAME(1)   09440011
094500     END-EVALUATE.                                                09450011
094600                                                                  09460011
094700 7510-OPEN-PACK-CSR.                                              09470011
094800     IF XL011-DEBUG-YES                                           09480011
094900         DISPLAY 'XLKUP016 - 7510-OPEN-PACK-CSR'                  09490011
095000     END-IF                                                       09500011
095100                                                                  09510011
095200     EXEC SQL                                                     09520011
095300         OPEN PACK-CSR                                            09530011
095400     END-EXEC.                                                    09540011
095500     MOVE SQLCODE                     TO XL011-SQLCODE            09550011
095600     EVALUATE TRUE                                                09560011
095700         WHEN SQLCODE = ZERO                                      09570011
095800             CONTINUE                                             09580011
095900         WHEN OTHER                                               09590011
096000             SET XL011-SQL-ERROR                                  09600011
096100                 PS-PROCESS-END        TO TRUE                    09610011
096200             MOVE '7510-OPEN-PACK-CSR' TO XL011-ERROR-PARAGRAPH   09620011
096300             MOVE 'TPURITM'            TO XL011-DB2-TABLE-NAME(1) 09630011
096400     END-EVALUATE.                                                09640011
096500                                                                  09650011
096600 7520-FETCH-PACK-CSR.                                             09660011
096700     IF XL011-DEBUG-YES                                           09670011
096800         DISPLAY 'XLKUP016 - 7520-FETCH-PACK-CSR'                 09680011
096900     END-IF                                                       09690011
097000                                                                  09700011
097100     EXEC SQL                                                     09710011
097200          FETCH PACK-CSR                                          09720011
097300       INTO :PURITM-PO-LNE-NBR                                    09730011
097400           ,:PURITM-PREPK-RATO-QTY                                09740011
097500     END-EXEC.                                                    09750011
097600                                                                  09760011
097700     MOVE SQLCODE                     TO XL011-SQLCODE            09770011
097800     EVALUATE TRUE                                                09780011
097900         WHEN SQLCODE = ZERO                                      09790011
098000             MOVE PURITM-PO-LNE-NBR   TO DK-PO-LNE-NBR            09800011
098100         WHEN SQLCODE = +100                                      09810011
098200             SET PS-PROCESS-END         TO TRUE                   09820011
098300         WHEN OTHER                                               09830011
098400             SET XL011-SQL-ERROR                                  09840011
098500                 PS-PROCESS-END         TO TRUE                   09850011
098600             MOVE '7520-FETCH-PACK-CSR' TO XL011-ERROR-PARAGRAPH  09860011
098700             MOVE 'TPURITM'             TO XL011-DB2-TABLE-NAME(1)09870011
098800     END-EVALUATE.                                                09880011
098900                                                                  09890011
099000 7530-CLOSE-PACK-CSR.                                             09900011
099100     IF XL011-DEBUG-YES                                           09910011
099200         DISPLAY 'XLKUP016 - 7530-CLOSE-PACK-CSR'                 09920011
099300     END-IF                                                       09930011
099400                                                                  09940011
099500     EXEC SQL                                                     09950011
099600         CLOSE PACK-CSR                                           09960011
099700     END-EXEC.                                                    09970011
099800     MOVE SQLCODE                     TO XL011-SQLCODE            09980011
099900     EVALUATE TRUE                                                09990011
100000         WHEN SQLCODE = ZERO                                      10000011
100100             CONTINUE                                             10010011
100200         WHEN OTHER                                               10020011
100300             SET XL011-SQL-ERROR                                  10030011
100400                 PS-PROCESS-END        TO TRUE                    10040011
100500             MOVE '7530-CLOSE-PACK-CSR' TO XL011-ERROR-PARAGRAPH  10050011
100600             MOVE 'TPURITM'            TO XL011-DB2-TABLE-NAME(1) 10060011
100700     END-EVALUATE.                                                10070011
100800                                                                  10080011
100900 8100-NUMERIC-EDIT.                                               10090011
101000     IF XL011-DEBUG-YES                                           10100011
101100         DISPLAY 'XLKUP016 - 8100-NUMERIC-EDIT'                   10110011
101200     END-IF                                                       10120011
101300                                                                  10130011
101400     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      10140011
101500     CALL DP010I-NUMERIC-EDIT-ROUTINE                             10150011
101600          USING DP010I-NUMERIC-EDIT-AREA                          10160011
101700     IF  DP010I-ERROR-DETECTED                                    10170011
101800         MOVE '8100-NUMERIC-EDIT'     TO XL011-ERROR-PARAGRAPH    10180011
101900         STRING 'INVALID NUMBER = ' DP010I-UNEDITED-FIELD         10190011
102000                 DELIMITED BY SIZE    INTO XL011-ERROR-TEXT       10200011
102100         SET XL011-SYSTEM-ERROR                                   10210011
102200             PS-PROCESS-END           TO TRUE                     10220011
102300     END-IF.                                                      10230011
102400/                                                                 10240011
102500 9999-WRAPUP.                                                     10250011
102600                                                                  10260011
102700     MOVE SQLCA                       TO XL011-SQLCA.             10270011
