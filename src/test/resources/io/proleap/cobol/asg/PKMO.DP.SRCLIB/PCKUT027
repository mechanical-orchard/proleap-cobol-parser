000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    PCKUT027.                                         00020000
000300 AUTHOR.        DEANNA BRANTNER.                                  00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  NOVEMBER, 2002.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000800*---------------------------------------------------------------* 00070000
000900*    THIS IS THE CALL MODULE TO START A WORK ORDER.               00080000
001100*                                                                 00100000
001600*    THE CALLING PROGRAM NEEDS TO PASS PO NBR, RCVR NBR, OPER     00150002
001700*    UNIT ID, AND FCLTY ID.                                       00160002
001700*                                                                 00170000
001500*---------------------------------------------------------------* 00180000
001700 ENVIRONMENT DIVISION.                                            00190000
001800 DATA DIVISION.                                                   00200000
001900                                                                  00210000
002000 WORKING-STORAGE SECTION.                                         00220000
002100                                                                  00230000
002200 01  DK-DB2-KEYS.                                                 00240000
002300     05  DK-OPER-UNT-ID               PIC S9(04) COMP.            00250000
002400     05  DK-FCLTY-ID                  PIC S9(04) COMP.            00260000
002500     05  DK-PO-NBR                    PIC S9(09) COMP.            00270002
002600     05  DK-RCVR-NBR                  PIC S9(09) COMP.            00280000
002700     05  DK-LINE-NBR                  PIC S9(09) COMP.            00290000
003200                                                                  00340000
003300 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-CURRENT-PGM-NAME          PIC X(08) VALUE 'PCKUT027'. 00360000
003700     05  PC-CASEPACK-PGM-NAME         PIC X(08) VALUE 'RCKCS816'. 00380002
004900     05  PC-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00390000
005000                                                     COMP SYNC.   00400000
005500     05  PC-SPACES                    PIC X(22)  VALUE SPACES.    00410000
005600     05  PC-01                        PIC X(02)  VALUE '01'.      00420000
015100     05  PC-DEFAULT-TMST              PIC X(26)  VALUE            00450000
015200                                  '9999-09-09-09.09.09.999999'.   00460000
015100     05  PC-DUMMY-TMST                PIC X(26)  VALUE            00470009
015200                                  '9999-09-09-09.09.09.000000'.   00480009
015500                                                                  00490000
015600 01  PS-PROGRAM-SWITCHES.                                         00500000
015700     05  PS-ERROR-SW                  PIC X(01)  VALUE 'Y'.       00510000
015800         88  PS-NO-ERROR                         VALUE 'Y'.       00520000
015900         88  PS-ERROR                            VALUE 'N'.       00530000
018600         88  PS-MORE-RECITM-NO                   VALUE 'N'.       00770000
019600                                                                  00870000
022850 01  PV-PROGRAM-VARIABLES.                                        01010000
023300     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01020000
023400                                                     COMP SYNC.   01030000
030800     05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  01150000
030900                                                     COMP SYNC.   01160000
031000     05  PV-DATE                      PIC X(10)  VALUE SPACES.    01170000
031100     05  PV-TIME                      PIC X(05)  VALUE SPACES.    01180000
031200     05  PV-TMST                      PIC X(26).                  01190000
031300     05  FILLER REDEFINES PV-TMST.                                01200000
031400         10  PV-CCYY                  PIC X(04).                  01210000
031500         10  FILLER                   PIC X(01).                  01220000
031600         10  PV-MM                    PIC X(02).                  01230000
031700         10  FILLER                   PIC X(01).                  01240000
031800         10  PV-DD                    PIC X(02).                  01250000
031900         10  FILLER                   PIC X(01).                  01260000
032000         10  PV-HH                    PIC X(02).                  01270000
032100         10  FILLER                   PIC X(01).                  01280000
032200         10  PV-MIN                   PIC X(02).                  01290000
032300         10  FILLER                   PIC X(01).                  01300000
032400         10  PV-SEC                   PIC X(02).                  01310000
032500         10  FILLER                   PIC X(01).                  01320000
032600         10  FILLER                   PIC X(06).                  01330000
033200     05  PV-CURRENT-TMST              PIC X(26).                  01380000
033300     05  PV-CURRENT-TMST-R REDEFINES PV-CURRENT-TMST.             01390000
033400         10 PV-CURRENT-DATE           PIC X(10).                  01400000
033500         10 FILLER                    PIC X(16).                  01410000
005900     05  PV-DISPLAY-PO-NBR            PIC 9(8)   VALUE ZEROS.     01420000
006000     05  PV-DISPLAY-RCVR-NBR          PIC 9(8)   VALUE ZEROS.     01430000
006100     05  PV-DISPLAY-LINE              PIC 9(8)   VALUE ZEROS.     01440000
006200     05  PV-DISPLAY-OPER              PIC 9(4)   VALUE ZEROS.     01450000
006300     05  PV-DISPLAY-SQLCODE           PIC 9999-  VALUE ZEROS.     01460000
           05  PV-SQL-RETURN-CD                PIC  999-.               01470000
034900                                                                  01480000
011800 01  PV-TRACE.                                                    01490000
011900     05  FILLER                          PIC X(03) VALUE ' T='.   01500000
012000     05  PV-EIBTASKN                     PIC Z(06)9.              01510000
012100     05  PV-PARA                         PIC X(70).               01520000
012200                                                                  01530000
041600*---------------------------------------------------------------* 01600000
041700*  RECORD LAYOUT FOR CALLED MODULE                                01610000
041800*---------------------------------------------------------------* 01620000
041900     COPY PCWS027.                                                01630002
042100                                                                  01640000
038600*---------------------------------------------------------------* 01710000
038700*    NUMERIC EDIT LAYOUT.                                       * 01720000
038800*---------------------------------------------------------------* 01730000
061100     COPY DPWS010I.                                               01740000
061200                                                                  01750000
061500*---------------------------------------------------------------* 01760000
061600*    STANDARD COMMAREA.                                         * 01770000
061700*---------------------------------------------------------------* 01780000
063000                                                                  01790000
063100 01  INTER-APPL-COMM-AREA.                                        01800000
063500*---------------------------------------------------------------* 01810000
063600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 01820000
063700*---------------------------------------------------------------* 01830000
063800         10  ASC-SPECIFIC-COMMAREA.                               01840000
063900             15  ASC-LIST-KEYS.                                   01850000
064100                 20  ASC-FCLTY-ID     PIC S9(04) COMP.            01860000
064200                 20  ASC-OPER-UNT-ID  PIC S9(04) COMP.            01870000
064400                 20  ASC-PO-NBR       PIC S9(09) COMP.            01880000
064500                 20  ASC-REC-SEQ-NBR  PIC S9(09) COMP.            01890000
064600                 20  ASC-LINE-NBR     PIC S9(09) COMP.            01900000
065900                                                                  01980000
075000                                                                  02070000
089200*---------------------------------------------------------------* 02730000
089300*    DB2 AREA FOR TWKORIN - WORK ORDER INSTRUCTION TABLE        * 02740002
089400*---------------------------------------------------------------* 02750000
089500     EXEC SQL                                                     02760000
089600          INCLUDE TWKORIN                                         02770002
089700     END-EXEC.                                                    02780000
089800                                                                  02790000
090000*---------------------------------------------------------------* 02800000
090100*    DB2 AREA FOR TWRKORD - WORK ORDER TABLE                    * 02810002
090200*---------------------------------------------------------------* 02820000
090300     EXEC SQL                                                     02830000
090400          INCLUDE TWRKORD                                         02840002
090500     END-EXEC.                                                    02850000
090600                                                                  02860000
090200*---------------------------------------------------------------* 02870000
090800     EXEC SQL                                                     02880000
090900          INCLUDE SQLCA                                           02890000
091000     END-EXEC.                                                    02900000
091100                                                                  02910000
107200                                                                  04270000
107500***************************************************************** 04280000
107600 LINKAGE SECTION.                                                 04290000
107700 01  LINK-PARMS                   PIC X(300).                     04300002
107700                                                                  04310000
108300                                                                  04320000
108400 PROCEDURE DIVISION USING LINK-PARMS.                             04330000
109000 0000-MAIN-MODULE.                                                04340000
109100                                                                  04350000
109200     INITIALIZE PC027-COMMAREA-REC.                               04360002
068700     MOVE LINK-PARMS            TO PC027-COMMAREA-REC.            04370002
069200                                                                  04380000
210000     MOVE PC027-PO-NBR          TO ASC-PO-NBR.                    04390002
210000     MOVE PC027-REC-SEQ-NBR     TO ASC-REC-SEQ-NBR.               04400002
210000     MOVE PC027-OPER-UNT-ID     TO ASC-OPER-UNT-ID.               04410002
210000     MOVE PC027-FCLTY-ID        TO ASC-FCLTY-ID.                  04420002
210700                                                                  04510000
           PERFORM 1000-START-INSTRUCTION.                              04520003
            IF PS-NO-ERROR                                              04530003
                SET PC027-SUCCESSFUL  TO  TRUE                          04540003
            END-IF.                                                     04550003
                                                                        04560003
           MOVE SQLCA              TO PC027-SQLCA.                      04580003
           MOVE PC027-COMMAREA-REC TO LINK-PARMS.                       04590003
                                                                        04600003
           GOBACK.                                                      04610003
                                                                        04620003
      *----------------------------------------------------------------*04680001
      *    UPDATE THE ROW, ASC, AND MAP.                               *04690001
      *----------------------------------------------------------------*04700003
       1000-START-INSTRUCTION.                                          04710003
           PERFORM 2000-UPDATE-TWKORIN.                                 04740003
                                                                        05070001
       2000-UPDATE-TWKORIN.                                             05080003
                                                                        05090003
           EXEC SQL                                                     05100003
                UPDATE TWKORIN                                          05110003
                SET    STRT_TMST        =   CURRENT TIMESTAMP           05120003
                WHERE                                                   05130003
                       ORD_NBR          =  :ASC-PO-NBR                  05140003
                AND    RCVR_SEQ_NBR     =  :ASC-REC-SEQ-NBR             05150004
                AND    ORD_LNE_NBR      =  0                            05160003
                AND    WORK_ORD_SEQ_NBR =  1                            05170003
                AND    OPER_UNT_ID      =  :ASC-OPER-UNT-ID             05180003
                AND    FCLTY_ID         =  :ASC-FCLTY-ID                05190003
                AND    WO_INSTR_SEQ_NBR =  1                            05200003
                AND    VER_STATUS_CDE   =  'A'                          05210003
                AND   (STRT_TMST        =  :PC-DEFAULT-TMST             05211009
                 OR    STRT_TMST        =  :PC-DUMMY-TMST )             05212010
           END-EXEC.                                                    05220003
                                                                        05230003
           EVALUATE TRUE                                                05240003
               WHEN SQLCODE = ZERO                                      05250003
               WHEN SQLCODE = +100                                      05250108
                    SET PC027-SUCCESSFUL  TO  TRUE                      05250205
               WHEN OTHER                                               05270003
                   SET PS-ERROR                                         05280003
                       PC027-SQL-ERROR      TO TRUE                     05290003
                   MOVE  ASC-PO-NBR         TO  PV-DISPLAY-PO-NBR       05300003
                   MOVE  ASC-REC-SEQ-NBR    TO  PV-DISPLAY-RCVR-NBR     05310003
                   MOVE  SQLCODE            TO  PV-DISPLAY-SQLCODE      05320003
                                                PV-SQL-RETURN-CD        05330003
                    STRING  'PCKUT027-2000-' PV-DISPLAY-PO-NBR          05340003
                            '-'               PV-DISPLAY-RCVR-NBR       05350003
                            '  CALLED BY-'    PC027-CALLING-PGM-NAME    05360003
                            '  SQLCODE='      PV-DISPLAY-SQLCODE        05370003
                            ' TASK= ' PV-EIBTASKN  DELIMITED BY SIZE    05380003
                                            INTO PC027-CRA-RET-MSG      05381003
                   PERFORM 9998-RETURN                                  05382003
           END-EVALUATE.                                                05400003
                                                                        05410003
181200*-----------------------------------------------------------------05680003
181300*  RETURN TO CALLING PROGRAM                                      05690003
181400*-----------------------------------------------------------------05700003
181500 9998-RETURN.                                                     05710003
181600                                                                  05720003
181700     MOVE SQLCA                         TO PC027-SQLCA            05730003
181800     MOVE PC027-COMMAREA-REC            TO LINK-PARMS.            05740003
181900                                                                  05750003
