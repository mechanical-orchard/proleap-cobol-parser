000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    RVKCS112.                                         00020099
000300 AUTHOR.        JEFF BOLWERK.                                     00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  DECEMBER 1992.                                    00050099
000600 DATE-COMPILED.                                                   00060099
000700******************************************************************00070099
000800*  RVKCS112 RECEIVES THE RA DOCUMENT NUMBER AND THE PRINTER      *00080099
000900*  DESTINATION.  THE PROGRAM THEN RETRIEVES ALL NECESSARY DATA   *00090099
001000*  AND FORMATS THE HEADER AND DETAIL LINES OF THE REPORT.        *00100099
001100*  THE DYNAMIC REPORT SYSTEM (DRS) IS USED TO ROUTE THE          *00110099
001200*  DOCUMENT TO THE JES QUEUE.                                    *00120099
001300*                                                                *00130099
001400* INPUT FILES:  NONE                                             *00140099
001500*                                                                *00150099
001600* OUTPUT FILES:                                                  *00160099
001700*                                                                *00170099
001800* TABLES:  TDFCTOR  -  DEFECTIVE ORDER                           *00180099
001900*          TDFMEIT  -  DEFECT MERCHANDISE ITEM                   *00190099
002000*          TSK      -  SKU TABLE                                 *00200099
002100*                                                                *00210099
002200******************************************************************00220099
002300* DATE        CHANGED BY                               WR #      *00230099
002400*----------------------------------------------------------------*00240099
002500* 04/22/2003  ABRAHAM JACOB, IBM GLOBAL SERVICES       WR 23022  *00250099
002600*      - NON-INTELLIGENT SKU PROJECT.  CALLS TO TSK TABLE IS     *00260099
002700*        REPLACED BY CALLS TO LOGISTICS DOMAIN TABLES.           *00270099
002800*                                                                *00280099
002900* 01/12/2004  DAN HINTZ                                WR 23568  *00290099
003000*      - RTV CONVERSION PROJECT.  ADD RETRIEVAL OF NEW COLUMNS   *00300099
003100*        FROM TDFMEIT.  POPULATE THE NEW INFORMATION ON THE FORM.*00310099
003200*                                                                *00320099
003300* 09/14/2004  DAN HINTZ                                WR 26853  *00330099
003400*      - STORE NUMBER EXPANSION PROJECT.  FIRST INSTALL WILL     *00340099
003500*        CORRECT THE DISPLAYED USERID OF THE PERSON WHO CLOSED   *00350099
003600*        THE LISTING.  CURRENTLY, THE USERID OF THE PERSON WHO   *00360099
003700*        CREATED THE LISTING IS SHOWN ON THE REPORT AS THE       *00370099
003800*        PERSON WHO CLOSED THE LISTING.  WE CAN USE THE NEW RTV  *00380099
003900*        TABLE RVT_DFCT_STAT TO DETERMINE THE USERID OF THE      *00390099
004000*        PERSON WHO CLOSED THE LISTING.                          *00400099
004100*                                                                *00410099
004200* 02/09/2005  DAN HINTZ                                WR 26853  *00420099
004300*      - STORE NUMBER EXPANSION PROJECT.  REPLACE USE OF TSTR000 *00430099
004400*        TABLE WITH USE OF THE XLT_LOC AND XLT_DC_LOC_ASGMT      *00440099
004500*        DOMAIN TABLES TO FETCH THE RTV LOCATION THAT IS         *00450099
004600*        ASSOCIATED THE DC LOCATION OF THE RTV LISTING.  REPLACE *00460099
004700*        USE OF TUSER TABLE WITH DOMAIN TABLE XLT_USR.           *00470099
004800*                                                                *00480099
004900* 03/09/2006  DAN HINTZ                              P000858488  *00490099
005000*      - THIS INSTALL WILL CORRECT THE CLOSE DATE THAT IS BEING  *00500099
005100*        DISPLAYED ON THE LISTING.  CURRENTLY, IF THE LISTING IS *00510099
005200*        REPRINTED AFTER IT HAS BEEN EITHER SHIPPED OR APPROVED, *00520099
005300*        THE SHIP DATE OR THE APPROVAL DATE IS BEING DISPLAYED   *00530099
005400*        AS THE CLOSED DATE.  THE NEW RTV TABLE RVT_DFCT_STAT    *00540099
005500*        IS USED TO FIND THE ACTUAL CLOSE DATE FOR THE LISTING.  *00550099
005600*                                                                 00560099
005700* 10/30/2011  STEVE ANDERSON - CODEWORKS               WR 40134  *00570099
005800*     ** PROJECT # 3219: GENCO / RTV UPGRADE                     *00580099
005900*      - ADD NEW SUB-HEADER CONTAINING RTV NUMBER AND LOCATION   *00590099
006000*        TO REPORT:                                              *00600099
006100*           "RTV LOCATION:  9999   XXXXXXXXXX"                   *00610099
006200*      - ADD CALL TO XLT_LOC TABLE USING RV102-OPER-UNT-ID AS    *00620099
006300*        KEY TO SELECT THE LOC_NBR AND LOC_10_ABBR_NM TO DISPLAY *00630099
006400*        IN THE NEW SUB-HEADER.                                  *00640099
006410*      - ADD REPORT TOTALS FOR QTY, UNIT COST, UNIT RETAIL.      *00641099
006420******************************************************************00642099
006430*                                                                 00643099
006440 ENVIRONMENT DIVISION.                                            00644099
006450*                                                                 00645099
006460 CONFIGURATION SECTION.                                           00646099
006470*                                                                 00647099
006480 SOURCE-COMPUTER.        IBM-3090.                                00648099
006490 OBJECT-COMPUTER.        IBM-3090.                                00649099
006500*                                                                 00650099
006600******************************************************************00660099
006700 DATA DIVISION.                                                   00670099
006800******************************************************************00680099
006900*                                                                 00690099
007000******************************************************************00700099
007100 WORKING-STORAGE SECTION.                                         00710099
007200******************************************************************00720099
007300                                                                  00730099
007400******************************************************************00740099
007500* PS PROGRAM SWITCHES                                            *00750099
007600******************************************************************00760099
007700 01  PS-PROGRAM-SWITCHES.                                         00770099
007800     05  PS-END-OF-DOCUMENT-SW           PIC X(01)   VALUE 'N'.   00780099
007900         88  PS-END-OF-DOCUMENT                      VALUE 'Y'.   00790099
008000         88  PS-NOT-END-OF-DOCUMENT                  VALUE 'N'.   00800099
008100                                                                  00810099
008200     05  PS-DATA-ON-DB-SW                PIC X(01)   VALUE 'Y'.   00820099
008300         88  PS-DATA-LEFT-ON-DB                      VALUE 'Y'.   00830099
008400         88  PS-NO-DATA-LEFT-ON-DB                   VALUE 'N'.   00840099
008500                                                                  00850099
008600     05  PS-FIRST-DETAIL-LINE-SW         PIC X(01)   VALUE 'Y'.   00860099
008700         88  PS-FIRST-DETAIL-LINE                    VALUE 'Y'.   00870099
008800         88  PS-NOT-FIRST-DETAIL-LINE                VALUE 'N'.   00880099
008900                                                                  00890099
009000******************************************************************00900099
009100* PV PROGRAM VARIABLES                                           *00910099
009200******************************************************************00920099
009300 01  PV-PROGRAM-VARIABLES.                                        00930099
009400     05  PV-TEMP-NBR-3                   PIC 9(3).                00940099
009500     05  PV-TEMP-NBR-4                   PIC 9(4).                00950099
009600     05  PV-LOC-NBR                      PIC S9(04) VALUE +0 COMP.00960099
009700     05  PV-DISP-DFCT-ORD-ID-X.                                   00970099
009800         10  PV-DISP-DFCT-ORD-ID         PIC 9(12) VALUE ZEROS.   00980099
009900     05  PV-DISP-OPER-UNT-ID-X.                                   00990099
010000         10  PV-DISP-OPER-UNT-ID         PIC 9(4)  VALUE ZEROS.   01000099
010100     05  PV-HOLD-UNIT-COST               PIC S9(5)V99  VALUE +1   01010099
010200                                                     COMP-3.      01020099
010300     05  PV-HOLD-UNIT-RETAIL             PIC S9(5)V99  VALUE +1   01030099
010400                                                     COMP-3.      01040099
011200     05  PV-RUN-DATE                     PIC X(10) VALUE SPACES.  01120099
011300     05  PV-RUN-TIME                     PIC X(08) VALUE SPACES.  01130099
011400     05  PV-DEPT-NBR                     PIC X(3) VALUE '000'.    01140012
011500     05  PV-HOLD-DEPARTMENT              PIC X(3) VALUE '000'.    01150012
011600     05  PV-HOLD-CLASS                   PIC X(2) VALUE '00'.     01160012
011700     05  PV-HOLD-SKU                     PIC 9(8) VALUE 0.        01170012
011800     05  PV-SUB-CLASS                    PIC 9(4) VALUE 0.        01180099
011900     05  PV-SKU                          PIC 9(8) VALUE 0.        01190099
012000     05  PV-DETAIL-ROWS-TOTAL            PIC S9(04)  VALUE +0     01200012
012100                                                     COMP.        01210012
012200     05  PV-WORK-OPER-UNT-ID             PIC S9(04)  VALUE +0     01220012
012300                                                     COMP.        01230012
012400     05  PV-LINE-COUNT                   PIC S9(04)  VALUE +0     01240012
012500                                                     COMP.        01250012
012600     05  PV-PAGE-COUNT                   PIC S9(04)  VALUE +0     01260012
012700                                                     COMP.        01270012
012800     05  PV-INDEX-CHECK                  PIC  9(04)  VALUE  0     01280012
012900                                                     COMP.        01290012
013000     05  PV-CICS-RESPONSE                PIC S9(04)  VALUE +0     01300012
013100                                                     COMP SYNC.   01310012
013200     05  PV-SQL-SUB                      PIC S9(04)  VALUE +0     01320012
013300                                                     COMP.        01330012
013400     05  PV-DOC-TOTAL-QUANTITY           PIC S9(05)V99            01340012
013500                                                     VALUE +0.    01350012
013600                                                                  01360012
013700     05  PV-COMMAREA-LENGTH            PIC S9(04)  VALUE +56      01370012
013800                                                   COMP SYNC.     01380012
013900     05  PV-CLOSED-DATE                  PIC  X(10)  VALUE SPACES.01390012
014000     05  PV-CONVERT-DATE.                                         01400012
014100         10  PV-CONVERT-YYYY             PIC  X(04)  VALUE SPACES.01410012
014200         10  FILLER                      PIC  X(01)  VALUE SPACE. 01420012
014300         10  PV-CONVERT-MM               PIC  X(02)  VALUE SPACES.01430012
014400         10  FILLER                      PIC  X(01)  VALUE SPACE. 01440012
014500         10  PV-CONVERT-DD               PIC  X(02)  VALUE SPACES.01450012
014600     05  PV-DISPLAY-DATE.                                         01460012
014700         10  PV-DISPLAY-MM               PIC  X(02)  VALUE SPACES.01470012
014800         10  PV-DISPLAY-DASH1            PIC  X(01)  VALUE SPACES.01480012
014900         10  PV-DISPLAY-DD               PIC  X(02)  VALUE SPACES.01490012
015000         10  PV-DISPLAY-DASH2            PIC  X(01)  VALUE SPACES.01500012
015100         10  PV-DISPLAY-YYYY             PIC  X(04)  VALUE SPACES.01510012
015200                                                                  01520012
015210     05  PV-GRAND-TOTALS.                                         01521099
015220         10  PV-GRAND-UNIT-QTY           PIC  S9(09).             01522099
015221         10  PV-HOLD-UNIT-COST-AMT       PIC  S9(11)V99.          01522199
015222         10  PV-GRAND-UNIT-COST-AMT      PIC  S9(11)V99.          01522299
015223         10  PV-HOLD-UNIT-RETAIL-AMT     PIC  S9(11)V99.          01522399
015224         10  PV-GRAND-UNIT-RETAIL-AMT    PIC  S9(11)V99.          01522499
015230                                                                  01523099
015300     05  PV-DRS-ABEND-DISPLAY-LINE1.                              01530012
015400         10  FILLER                      PIC  X(14)  VALUE        01540012
015500             'DRRB ID = DRRB'.                                    01550012
015600         10  FILLER                      PIC  X(02)  VALUE SPACE. 01560012
015700         10  FILLER                      PIC  X(12)  VALUE        01570012
015800             'DRRB FUNC = '.                                      01580012
015900         10  PV-DRS-DRRB-FUNC            PIC  X(04)  VALUE SPACE. 01590012
016000         10  FILLER                      PIC  X(02)  VALUE SPACE. 01600012
016100         10  FILLER                      PIC  X(11)  VALUE        01610012
016200             'DRRB RID = '.                                       01620012
016300         10  PV-DRS-DRRB-RID             PIC  X(08)  VALUE SPACE. 01630012
016400         10  FILLER                      PIC  X(02)  VALUE SPACE. 01640012
016500         10  FILLER                      PIC  X(15)  VALUE        01650012
016600             'DRRB OPTIONS = '.                                   01660012
016700         10  PV-DRS-DRRB-OPTIONS         PIC  X(08)  VALUE SPACE. 01670012
016800                                                                  01680012
016900     05  PV-DRS-ABEND-DISPLAY-LINE2.                              01690012
017000         10  FILLER                      PIC  X(10)  VALUE        01700012
017100             'DRRB RC = '.                                        01710012
017200         10  PV-DRS-DRRB-RC              PIC  9(04)  VALUE ZERO.  01720012
017300         10  FILLER                      PIC  X(02)  VALUE SPACE. 01730012
017400         10  FILLER                      PIC  X(18)  VALUE        01740012
017500             'DRRB ATTR-ERROR = '.                                01750012
017600         10  PV-DRS-ATTR-ERROR           PIC  9(02)  VALUE ZERO.  01760012
017700         10  FILLER                      PIC  X(02)  VALUE SPACE. 01770012
017800         10  FILLER                      PIC  X(12)  VALUE        01780012
017900             'DRRB DRDC = '.                                      01790012
018000         10  PV-DRS-DRRB-DRDC            PIC  9(04)  VALUE ZERO.  01800012
018100         10  FILLER                      PIC  X(02)  VALUE SPACE. 01810012
018200         10  FILLER                      PIC  X(13)  VALUE        01820012
018300             'DRRB LINES = '.                                     01830012
018400         10  PV-DRS-DRRB-LINES           PIC  9(04)  VALUE ZERO.  01840012
018500                                                                  01850012
018600     05  PV-MESSAGE-1.                                            01860012
018700         10  FILLER                      PIC X(34)   VALUE        01870012
018800             '  RVKCS112 - DOC/QUEUE NOT ENTERED'.                01880012
018900                                                                  01890012
019000     05  PV-MESSAGE-3.                                            01900012
019100         10  FILLER                      PIC X(78)   VALUE        01910012
019200             'RVKCS112 - INVALID COMMAREA'.                       01920012
019300                                                                  01930012
019400     05  PV-ITEM-STATUS.                                          01940012
019500         10  PV-18CHAR-ITEM-STATUS       PIC X(18)  VALUE SPACE.  01950012
019600         10  FILLER                      PIC X(42)  VALUE SPACE.  01960012
019700                                                                  01970012
019800******************************************************************01980012
019900* PC PROGRAM CONSTANTS                                           *01990012
020000******************************************************************02000012
020100 01  PC-PROGRAM-CONSTANTS.                                        02010012
020200     05  PC-ONE                        PIC  9      VALUE 1.       02020012
020300     05  PC-TWO                        PIC  9      VALUE 2.       02030012
020400     05  PC-ZERO                       PIC  9      VALUE 0.       02040012
020500     05  PC-MAX-LINES-ON-PAGE          PIC S9(03)  VALUE +59      02050012
020600                                                   COMP.          02060012
020700     05  PC-CURRENT-PROGRAM-NAME       PIC  X(08)  VALUE          02070012
020800         'RVKCS112'.                                              02080012
020900     05  PC-RVKCS106                   PIC  X(08)  VALUE          02090012
021000         'RVKCS106'.                                              02100012
021100     05  PC-KOHLS-OPERATING-COMPANY    PIC  X(02)  VALUE '03'.    02110012
021200     05  PC-OPER-UNT-ID-FINDLAY        PIC  9(04)  VALUE 810.     02120012
021300     05  PC-OPER-UNT-ID-TEST-CORP      PIC  9(04)  VALUE 90.      02130012
021400     05  PC-INIT                       PIC  X(04)  VALUE 'INIT'.  02140012
021500     05  PC-PUT                        PIC  X(04)  VALUE 'PUT'.   02150012
021600     05  PC-DASH                       PIC  X(01)  VALUE '-'.     02160012
021700     05  PC-LEFT-PREN                  PIC  X(01)  VALUE '('.     02170012
021800     05  PC-RIGHT-PREN                 PIC  X(01)  VALUE ')'.     02180012
021900     05  PC-TERM                       PIC  X(04)  VALUE 'TERM'.  02190012
022000     05  PC-LOCAL-DEST                 PIC  X(05)  VALUE 'LOCAL'. 02200012
022100     05  PC-CLASS-A                    PIC  X(01)  VALUE 'A'.     02210012
022200     05  PC-FORM-STD                   PIC  X(03)  VALUE 'STD'.   02220012
022300     05  PC-TOP-OF-PAGE                PIC  X(01)  VALUE '1'.     02230099
022400     05  PC-SINGLE-SPACE               PIC  X(01)  VALUE SPACE.   02240099
022500     05  PC-DOUBLE-SPACE               PIC  X(01)  VALUE ZERO.    02250099
022600     05  PC-TRIPLE-SPACE               PIC  X(01)  VALUE '-'.     02260099
022700                                                                  02270012
022800     05  PC-MAX-RETRIES                PIC S9(03)  VALUE 3.       02280012
022900     05  PC-UNAVAILABLE-RESOURCES      PIC S9(04)  VALUE -904.    02290012
023000     05  PC-DEADLOCK                   PIC S9(04)  VALUE -913.    02300012
023100     05  PC-ROW-NOT-FOUND              PIC S9(04)  VALUE +100.    02310012
023200                                                                  02320012
023300******************************************************************02330012
023400* DETAIL DATA TABLE                                              *02340012
023500******************************************************************02350012
023600 01  DT-DETAIL-TABLE.                                             02360012
023700     05  DT-DETAIL-ROW      OCCURS 2500 TIMES                     02370012
023800                            INDEXED BY DT-INDEX.                  02380012
023900         10  DT-DEPARTMENT              PIC  X(03).               02390012
024000         10  DT-CLASS                   PIC  X(02).               02400012
024100         10  DT-SKU                     PIC  X(08).               02410012
024200         10  DT-STYLE                   PIC  X(20).               02420012
024300         10  DT-DESCRIPTION             PIC  X(15).               02430012
024400         10  DT-QUANTITY                PIC  9(04).               02440012
024500         10  DT-UNIT-COST               PIC  9(05)V99.            02450012
024600         10  DT-UNIT-RETAIL             PIC  9(05)V99.            02460012
024700                                                                  02470012
024800******************************************************************02480012
024900* HL  HEADER LINES FOR DOCUMENT                                  *02490012
025000******************************************************************02500012
025100 01  HL1-HEADING-LINE-1.                                          02510099
025200     05  FILLER                         PIC X(43) VALUE SPACE.    02520099
025300     05  FILLER                         PIC X(46) VALUE           02530099
025400         'RETURN TO VENDOR - RETURN AUTHORIZATION REPORT'.        02540099
025500     05  FILLER                         PIC X(43) VALUE SPACE.    02550099
025600*                                                                 02560099
025700 01  HL1A-HEADING-LINE-1A.                                        02570099
025800     05  FILLER                    PIC  X(15)  VALUE              02580099
025900         ' RTV LOCATION: '.                                       02590099
026000     05  HL1A-RTV-LOC              PIC  X(06).                    02600099
026100     05  FILLER                    PIC  X(02)  VALUE SPACE.       02610099
026200     05  HL1A-RTV-NAME             PIC  X(10).                    02620099
026300     05  FILLER                    PIC  X(99)  VALUE SPACE.       02630099
026400*                                                                 02640099
026500 01  HL2-HEADING-LINE-2.                                          02650099
026600     05  FILLER                         PIC X(01) VALUE SPACE.    02660099
026700     05  FILLER                         PIC X(14) VALUE           02670099
026800         'DEBIT NUMBER: '.                                        02680099
026900     05  HL2-DEFECT-ORD-ID-NBR          PIC 9(12) VALUE ZERO.     02690099
027000     05  FILLER                         PIC X(21) VALUE SPACE.    02700099
027100     05  FILLER                         PIC X(12) VALUE           02710099
027200         'DEPARTMENT: '.                                          02720099
027300     05  HL2-DEPARTMENT                 PIC 9(03) VALUE ZERO.     02730099
027400     05  FILLER                         PIC X(69) VALUE SPACE.    02740099
027500*                                                                 02750099
027600 01  HL3-HEADING-LINE-3.                                          02760099
027700     05  FILLER                       PIC X(01) VALUE SPACE.      02770099
027800     05  FILLER                       PIC X(08) VALUE             02780099
027900         'VENDOR: '.                                              02790099
028000     05  HL3-VENDOR-NAME              PIC X(25) VALUE SPACE.      02800099
028100     05  FILLER                       PIC X(18) VALUE SPACE.      02810099
028200     05  FILLER                       PIC X(08) VALUE             02820099
028300         'DUNS #: '.                                              02830099
028400     05  HL3-VENDOR-DUNNS-NBR         PIC X(15) VALUE SPACE.      02840099
028500     05  FILLER                       PIC X(57) VALUE SPACE.      02850099
028600*                                                                 02860099
028700 01  HL4-HEADING-LINE-4.                                          02870099
028800     05  FILLER                       PIC X(01) VALUE SPACE.      02880099
028900     05  FILLER                       PIC X(47) VALUE SPACE.      02890099
029000     05  FILLER                       PIC X(12) VALUE             02900099
029100         'DISCOUNT %: '.                                          02910099
029200     05  HL4-DISC-PCT-X.                                          02920099
029300         10  HL4-DISC-PCT             PIC  ZZ9.99.                02930099
029400     05  FILLER                       PIC X(66) VALUE SPACE.      02940099
029500*                                                                 02950099
029600 01  HL5-HEADING-LINE-5.                                          02960099
029700     05  FILLER                       PIC X(01) VALUE SPACE.      02970099
029800     05  FILLER                       PIC X(47) VALUE SPACE.      02980099
029900     05  FILLER                       PIC X(12) VALUE             02990099
030000         'TOTAL QTY : '.                                          03000099
030100     05  HL5-TOTAL-QTY                PIC  ZZZ9 VALUE ZEROS.      03010099
030200     05  FILLER                       PIC X(67) VALUE SPACE.      03020099
030300*                                                                 03030099
030400 01  HL6-HEADING-LINE-6.                                          03040099
030500     05  FILLER                       PIC X(01) VALUE SPACE.      03050099
030600     05  FILLER                       PIC X(11) VALUE             03060099
030700         'SHIP DATE: '.                                           03070099
030800     05  HL6-SHIP-DATE                PIC X(10) VALUE SPACES.     03080099
030900     05  FILLER                       PIC X(68) VALUE SPACE.      03090099
031000*                                                                 03100099
031100 01  HL7-HEADING-LINE-7.                                          03110099
031200     05  FILLER                       PIC X(01) VALUE SPACE.      03120099
031300     05  FILLER                       PIC X(10) VALUE             03130099
031400         'SHIP VIA: '.                                            03140099
031500     05  HL7-CARR-SCAC-CDE            PIC X(04) VALUE SPACES.     03150099
031600     05  FILLER                       PIC X(10) VALUE SPACES.     03160099
031700     05  FILLER                       PIC X(13) VALUE             03170099
031800         'TRACKING #: '.                                          03180099
031900     05  HL7-CARR-TRKG-ID             PIC X(25) VALUE SPACES.     03190099
032000     05  FILLER                       PIC X(69) VALUE SPACE.      03200099
032100*                                                                 03210099
032200 01  DH1-DETAIL-HEADING-1.                                        03220099
032300     05  FILLER                       PIC X(01) VALUE SPACE.      03230099
032400     05  FILLER                       PIC X(63) VALUE SPACES.     03240099
032500     05  FILLER                       PIC X(04) VALUE             03250099
032600         'UNIT'.                                                  03260099
032700     05  FILLER                       PIC X(05) VALUE SPACE.      03270099
032800     05  FILLER                       PIC X(04) VALUE             03280099
032900         'UNIT'.                                                  03290099
033000     05  FILLER                       PIC X(55) VALUE SPACE.      03300099
033100                                                                  03310099
033200 01  DH2-DETAIL-HEADING-2.                                        03320099
033300     05  FILLER                       PIC X(01) VALUE SPACE.      03330099
033400     05  FILLER                       PIC X(02) VALUE             03340099
033500         'CL'.                                                    03350099
033600     05  FILLER                       PIC X(02) VALUE SPACE.      03360099
033700     05  FILLER                       PIC X(03) VALUE             03370099
033800         'SKU'.                                                   03380099
033900     05  FILLER                       PIC X(07) VALUE SPACE.      03390099
034000     05  FILLER                       PIC X(05) VALUE             03400099
034100         'STYLE'.                                                 03410099
034200     05  FILLER                       PIC X(17) VALUE SPACE.      03420099
034300     05  FILLER                       PIC X(11) VALUE             03430099
034400         'DESCRIPTION'.                                           03440099
034500     05  FILLER                       PIC X(07) VALUE SPACE.      03450099
034600     05  FILLER                       PIC X(03) VALUE             03460099
034700         'QTY'.                                                   03470099
034800     05  FILLER                       PIC X(06) VALUE SPACE.      03480099
034900     05  FILLER                       PIC X(04) VALUE             03490099
035000         'COST'.                                                  03500099
035100     05  FILLER                       PIC X(04) VALUE SPACE.      03510099
035200     05  FILLER                       PIC X(06) VALUE             03520099
035300         'RETAIL'.                                                03530099
035400     05  FILLER                       PIC X(54) VALUE SPACE.      03540099
035500                                                                  03550099
035600 01  DH3-DETAIL-HEADING-3.                                        03560099
035700     05  FILLER                    PIC  X(01)     VALUE SPACE.    03570012
035800     05  FILLER                    PIC  X(02)     VALUE           03580099
035900         '--'.                                                    03590099
036000     05  FILLER                    PIC  X(02)     VALUE SPACES.   03600012
036100     05  FILLER                    PIC  X(08)     VALUE           03610099
036200         '--------'.                                              03620099
036300     05  FILLER                    PIC  X(02)     VALUE SPACES.   03630012
036400     05  FILLER                    PIC  X(20)     VALUE           03640099
036500         '--------------------'.                                  03650099
036600     05  FILLER                    PIC  X(02)     VALUE SPACES.   03660012
036700     05  FILLER                    PIC  X(15)     VALUE           03670099
036800         '---------------'.                                       03680099
036900     05  FILLER                    PIC  X(02)     VALUE SPACES.   03690012
037000     05  FILLER                    PIC  X(04)     VALUE           03700099
037100         '----'.                                                  03710099
037200     05  FILLER                    PIC  X(02)     VALUE SPACES.   03720012
037300     05  FILLER                    PIC  X(08)     VALUE           03730099
037400         '--------'.                                              03740099
037500     05  FILLER                    PIC  X(02)     VALUE SPACES.   03750012
037600     05  FILLER                    PIC  X(08)     VALUE           03760099
037700         '--------'.                                              03770099
037800     05  FILLER                    PIC  X(54)     VALUE SPACES.   03780012
037900                                                                  03790012
038000 01  ERL-END-OF-REPORT-LINE.                                      03800099
038100     05  FILLER                         PIC X(57) VALUE SPACE.    03810099
038200     05  FILLER                         PIC X(19) VALUE           03820099
038300         '** END OF REPORT **'.                                   03830099
038400     05  FILLER                         PIC X(56) VALUE SPACE.    03840099
038500*                                                                 03850099
038600******************************************************************03860012
038700* DL  DETAIL LINES FOR DOCUMENT                                  *03870012
038800******************************************************************03880012
038900 01  DL-DETAIL-LINE.                                              03890099
039000     05  FILLER                    PIC  X(01)     VALUE SPACE.    03900012
039100     05  DL-CLASS                  PIC  X(02)     VALUE SPACES.   03910012
039200     05  FILLER                    PIC  X(02)     VALUE SPACES.   03920012
039300     05  DL-SKU-NBR                PIC  X(08)     VALUE SPACES.   03930012
039400     05  FILLER                    PIC  X(02)     VALUE SPACES.   03940012
039500     05  DL-STYLE                  PIC  X(20)     VALUE SPACES.   03950012
039600     05  FILLER                    PIC  X(02)     VALUE SPACES.   03960012
039700     05  DL-DESCRIPTION            PIC  X(15)     VALUE SPACES.   03970012
039800     05  FILLER                    PIC  X(02)     VALUE SPACES.   03980012
039900     05  DL-QUANTITY               PIC  ZZZ9      VALUE ZEROS.    03990012
040000     05  FILLER                    PIC  X(02)     VALUE SPACES.   04000012
040100     05  DL-UNIT-COST              PIC ZZZZ9.99   VALUE ZEROS.    04010012
040200     05  FILLER                    PIC  X(02)     VALUE SPACES.   04020012
040300     05  DL-UNIT-RETAIL            PIC ZZZZ9.99   VALUE ZEROS.    04030099
040400     05  FILLER                    PIC  X(54)     VALUE SPACES.   04040012
040410                                                                  04041099
040411******  GRAND TOTAL LINES                                         04041199
040419 01  GT-GRAND-TOTAL-QTY.                                          04041999
040421     05  FILLER                          PIC  X(40)  VALUE        04042199
040422         '     REPORT TOTALS        QUANTITY:     '.              04042299
040423     05  FILLER                          PIC  X(07)  VALUE SPACE. 04042399
040424     05  GT-QTY                          PIC  ZZZ,ZZZ,ZZ9.        04042499
040425     05  FILLER                          PIC  X(05)  VALUE SPACE. 04042599
040426                                                                  04042699
040427 01  GT-GRAND-TOTAL-UNIT-COST.                                    04042799
040428     05  FILLER                          PIC  X(10)  VALUE SPACE. 04042899
040429     05  FILLER                          PIC  X(30)  VALUE        04042999
040430         '                UNIT COST:    '.                        04043099
040431     05  FILLER                          PIC  X(04)  VALUE SPACE. 04043199
040432     05  GT-TOTAL-UNIT-COST              PIC  $$$,$$$,$$9.99.     04043299
040433     05  FILLER                          PIC  X(03)  VALUE SPACE. 04043399
040441                                                                  04044199
040442 01  GT-GRAND-TOTAL-UNIT-RETAIL.                                  04044299
040443     05  FILLER                          PIC  X(10)  VALUE SPACE. 04044399
040444     05  FILLER                          PIC  X(30)  VALUE        04044499
040445         '                UNIT RETAIL:  '.                        04044599
040446     05  FILLER                          PIC  X(04)  VALUE SPACE. 04044699
040447     05  GT-TOTAL-UNIT-RETAIL            PIC  $$$,$$$,$$9.99.     04044799
040448     05  FILLER                          PIC  X(03)  VALUE SPACE. 04044899
040449                                                                  04044999
040500                                                                  04050012
040600******************************************************************04060012
040700* COMMAREA PASSED TO THE PROGRAM                                 *04070012
040800******************************************************************04080012
040900     COPY RVWS102.                                                04090012
041000                                                                  04100012
041100*                                                                 04110012
041200*  LAYOUT FOR DRS COMMAREA                                        04120012
041300*                                                                 04130012
041400     COPY DRRD001O.                                               04140012
041500     EJECT                                                        04150012
041600*                                                                 04160012
041700*  LAYOUT FOR THE DYNAMIC REPORT DETAIL LINES                     04170012
041800*                                                                 04180012
041900     COPY DRRD002O.                                               04190012
042000     EJECT                                                        04200012
042100*                                                                 04210012
042200*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       04220012
042300*                                                                 04230012
042400     COPY DPWS013.                                                04240012
042500*                                                                 04250012
042600*  INCLUDE THIS COPYBOOK FOR TESTING AT CORPORATE                 04260099
042700*  PRINTER LINE COMMANDS FOR PRINTEX PRINTERS                     04270012
042800*                                                                 04280012
042900     COPY DSWS004.                                                04290012
043000*                                                                 04300012
043100*  LAYOUT FOR THE STANDARD 132 WIDE REPORT HEADER                 04310012
043200*                                                                 04320012
043300     COPY DPWS132.                                                04330012
043400     EJECT                                                        04340012
043500*                                                                 04350012
043600*   DB2 DEFECT ORDER TABLE                                        04360012
043700*                                                                 04370012
043800      EXEC SQL                                                    04380012
043900          INCLUDE TDFCTOR                                         04390012
044000      END-EXEC.                                                   04400012
044100 EJECT                                                            04410012
044200*                                                                 04420012
044300*   DB2 DEFECT ORDER MERCHANDISE ITEM TABLE                       04430012
044400*                                                                 04440012
044500      EXEC SQL                                                    04450012
044600          INCLUDE TDFMEIT                                         04460012
044700      END-EXEC.                                                   04470012
044800 EJECT                                                            04480012
044900*                                                                 04490012
045000*   LOGISTICS DOMAIN DB2 SKU TABLE                                04500012
045100*                                                                 04510012
045200      EXEC SQL                                                    04520012
045300          INCLUDE XLT00003                                        04530012
045400      END-EXEC.                                                   04540012
045500 EJECT                                                            04550012
045600*                                                                 04560012
045700*   LOGISTICS DOMAIN DB2 VENDOR STYLE TABLE                       04570012
045800*                                                                 04580012
045900      EXEC SQL                                                    04590012
046000          INCLUDE XLT00004                                        04600012
046100      END-EXEC.                                                   04610012
046200 EJECT                                                            04620012
046300*                                                                 04630012
046400*   RTV DEFECT SHIPPING TABLE                                     04640012
046500*                                                                 04650012
046600      EXEC SQL                                                    04660012
046700          INCLUDE RVT00000                                        04670012
046800      END-EXEC.                                                   04680012
046900 EJECT                                                            04690012
047000*                                                                 04700012
047100*   RTV DEFECTIVE ORDER STATUS TABLE                              04710012
047200*                                                                 04720012
047300      EXEC SQL                                                    04730012
047400          INCLUDE RVT00003                                        04740012
047500      END-EXEC.                                                   04750012
047600 EJECT                                                            04760012
047700*                                                                 04770012
047800*   LOGISTICS DOMAIN LOCATION TABLE                               04780012
047900*                                                                 04790012
048000      EXEC SQL                                                    04800012
048100          INCLUDE XLT00010                                        04810012
048200      END-EXEC.                                                   04820012
048300 EJECT                                                            04830012
048400*                                                                 04840012
048500*   LOGISTICS DOMAIN DC LOCATION ASSIGNMENT TABLE                 04850012
048600*                                                                 04860012
048700      EXEC SQL                                                    04870012
048800          INCLUDE XLT00014                                        04880012
048900      END-EXEC.                                                   04890012
049000*                                                                 04900012
049100 EJECT                                                            04910012
049200*                                                                 04920012
049300*   DB2 COMMUNICATIONS AREA                                       04930012
049400*                                                                 04940012
049500      EXEC SQL                                                    04950012
049600          INCLUDE SQLCA                                           04960012
049700      END-EXEC.                                                   04970012
049800*                                                                 04980012
049900*   DB2 COMMUNICATIONS AREA2                                      04990012
050000*                                                                 05000012
050100     COPY SQLCA2.                                                 05010012
050200 EJECT                                                            05020012
050300                                                                  05030012
050400***************************************************************** 05040012
050500*    DOCUMENT HEADER CURSOR                                       05050012
050600***************************************************************** 05060012
050700     EXEC SQL                                                     05070012
050800          DECLARE  DETAIL-CURSOR  CURSOR FOR                      05080012
050900                                                                  05090012
051000          SELECT                                                  05100012
051100                 D.RTL_COST_AMT                                   05110012
051200               , D.UNIT_COST_AMT                                  05120012
051300               , D.SEQ_NBR                                        05130012
051400               , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                   05140012
051500               , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                 05150012
051600               , S.SKU_NBR                                        05160012
051700               , V.VS_NBR                                         05170012
051800               , S.SKU_DESC                                       05180012
051900                                                                  05190012
052000          FROM TDFMEIT D, XLT_SKU S, XLT_VND_STYL V               05200012
052100                                                                  05210012
052200          WHERE D.DFCT_ORD_ID     = :DFMEIT-DFCT-ORD-ID           05220012
052300            AND D.DFCT_ITEM_NBR   = S.ITM_NBR                     05230012
052400            AND S.STYL_ID         = V.STYL_ID                     05240099
052500                                                                  05250012
052600       UNION ALL                                                  05260012
052700                                                                  05270012
052800          SELECT                                                  05280012
052900                 D.RTL_COST_AMT                                   05290012
053000               , D.UNIT_COST_AMT                                  05300012
053100               , D.SEQ_NBR                                        05310012
053200               , D.MDSE_DEPT_NBR                                  05320012
053300               , D.MDSE_CLASS_NBR                                 05330012
053400           , DECIMAL(D.MDSE_DEPT_NBR || D.MDSE_CLASS_NBR || '000')05340099
053500               , 'UNKNOWN'                                        05350012
053600               , 'UNKNOWN'                                        05360012
053700                                                                  05370012
053800          FROM TDFMEIT D                                          05380012
053900                                                                  05390012
054000          WHERE D.DFCT_ORD_ID     = :DFMEIT-DFCT-ORD-ID           05400012
054100            AND NOT EXISTS                                        05410012
054200            (SELECT 1                                             05420012
054300             FROM XLT_SKU S                                       05430012
054400             WHERE D.DFCT_ITEM_NBR   = S.ITM_NBR)                 05440012
054500                                                                  05450012
054600          ORDER BY 4                                              05460012
054700                 , 5                                              05470012
054800                 , 6                                              05480012
054900                 , 1                                              05490012
055000                 , 2                                              05500012
055100                                                                  05510012
055200     END-EXEC.                                                    05520012
055300                                                                  05530012
055400 EJECT                                                            05540012
055500 LINKAGE SECTION.                                                 05550012
055600                                                                  05560012
055700     EJECT                                                        05570012
055800                                                                  05580012
055900******************************************************************05590012
056000 PROCEDURE DIVISION.                                              05600012
056100******************************************************************05610012
056200*                                                                 05620012
056300******************************************************************05630012
056400* A100-MAIN-MODULE  - HIGHEST LEVEL CONTROL ROUTINE.             *05640012
056500******************************************************************05650012
056600 A100-MAIN-MODULE.                                                05660012
056700                                                                  05670012
056800     MOVE LENGTH RV102-SPECIFIC-COMMAREA TO                       05680012
056900                                    PV-COMMAREA-LENGTH.           05690012
057000                                                                  05700012
057100     EXEC CICS                                                    05710012
057200         RETRIEVE                                                 05720012
057300         INTO(RV102-SPECIFIC-COMMAREA)                            05730012
057400         LENGTH(PV-COMMAREA-LENGTH)                               05740012
057500         RESP(PV-CICS-RESPONSE)                                   05750012
057600     END-EXEC.                                                    05760012
057700                                                                  05770012
057800     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        05780012
057900         IF  RV102-DEFECT-ORDER-NBR      NOT =  ZEROS             05790012
058000             PERFORM           B100-INITIALIZE                    05800012
058100             PERFORM           B200-LOAD-DETAIL                   05810012
058200             PERFORM           B300-CREATE-HEADER                 05820012
058300             SET DT-INDEX      TO PC-ONE                          05830012
058400             PERFORM           C100-PROCESS-DOCUMENT              05840012
058500                 UNTIL PS-END-OF-DOCUMENT                         05850012
058600         ELSE                                                     05860012
058700             SET DP013-LOGIC-ABEND TO TRUE                        05870012
058800             MOVE 'A100-MAIN-MODULE'                              05880012
058900                             TO DP013-PARAGRAPH                   05890012
059000             MOVE PV-MESSAGE-1                                    05900012
059100                             TO DP013-MESSAGE-TEXT(1)             05910012
059200             PERFORM Z999-ABEND                                   05920012
059300         END-IF                                                   05930012
059400         PERFORM Z100-CLOSE-FILES                                 05940012
059500     ELSE                                                         05950012
059600         SET DP013-CICS-ABEND TO TRUE                             05960012
059700         MOVE 'A100-MAIN-MODULE' TO DP013-PARAGRAPH               05970012
059800         MOVE PV-MESSAGE-3       TO DP013-MESSAGE-TEXT(1)         05980012
059900         PERFORM Z999-ABEND                                       05990012
060000     END-IF.                                                      06000012
060100                                                                  06010012
060200     EXEC CICS                                                    06020012
060300         RETURN                                                   06030012
060400     END-EXEC.                                                    06040012
060500                                                                  06050012
060600     GOBACK.                                                      06060012
060700     EJECT                                                        06070012
060800******************************************************************06080012
060900* B100-INITIALIZE.                                                06090012
061000* ==> PROCESSES:                                                  06100012
061100*   - PROVIDE THE PRINTER FORMATTING INFORMATION TO DRS           06110012
061200*     PERFORMED BY : A100-MAIN-MODULE                             06120012
061300******************************************************************06130012
061400 B100-INITIALIZE.                                                 06140012
061500                                                                  06150012
061600     INITIALIZE  DT-DETAIL-TABLE.                                 06160012
061700                                                                  06170012
061800     MOVE PC-INIT                 TO  DRS01-DRRB-FUNC.            06180012
061900                                                                  06190012
062000     IF RV102-PRINTER-DEST  =  SPACES                             06200012
062100         MOVE PC-LOCAL-DEST       TO  DRS02-DRIB-DEST             06210012
062200     ELSE                                                         06220012
062300         MOVE RV102-PRINTER-DEST  TO  DRS02-DRIB-DEST             06230012
062400     END-IF.                                                      06240012
062500*                                                                 06250012
062600     MOVE PC-CLASS-A              TO  DRS02-DRIB-CLASS.           06260012
062700     MOVE PC-FORM-STD             TO  DRS02-DRIB-FORM.            06270012
062800     MOVE DRS02-DRIB-HEADER       TO  DRS01-COMM-DRIB-HDR.        06280012
062900     MOVE DRS02-DRIB-ATTRIB       TO  DRS01-COMM-DRIB-AT1.        06290012
063000                                                                  06300012
063100     PERFORM Z200-LINK-TO-DRS.                                    06310099
063200                                                                  06320099
063300     EJECT                                                        06330012
063400******************************************************************06340012
063500* B200-LOAD-DETAIL                                                06350012
063600* ==> PROCESSES:                                                  06360012
063700*   - OPEN THE DETAIL CURSOR                                      06370012
063800*   - READ DETAIL INFORMATION AND LOAD TO THE DETAIL TABLE UNTIL  06380012
063900*     ALL DATA IS READ FROM THE DB2 TABLE                         06390012
064000*   - CLOSE DETAIL CURSOR                                         06400012
064100*   - SUM TOTAL UNITS.                                            06410012
064200*                                                                 06420012
064300*     PERFORMED BY : A100-MAIN-MODULE                             06430012
064400******************************************************************06440012
064500 B200-LOAD-DETAIL.                                                06450012
064600                                                                  06460012
064700     PERFORM D100-OPEN-CURSOR.                                    06470012
064800                                                                  06480012
064900     PERFORM D200-FETCH-CURSOR.                                   06490012
065000     IF  PS-DATA-LEFT-ON-DB                                       06500012
065100         SET  DT-INDEX              TO  PC-ONE                    06510012
065200         MOVE DFMEIT-MDSE-CLASS-NBR TO  DT-CLASS (DT-INDEX)       06520012
065300         MOVE XLT00003-SKU-NBR      TO  PV-SKU                    06530012
065400         MOVE PV-SKU                TO  DT-SKU (DT-INDEX)         06540012
065500         MOVE XLT00004-VS-NBR       TO  DT-STYLE (DT-INDEX)       06550012
065600         MOVE XLT00003-SKU-DESC     TO  DT-DESCRIPTION (DT-INDEX) 06560012
065700         MOVE PC-ZERO               TO  DT-QUANTITY (DT-INDEX)    06570012
065800         MOVE DFMEIT-UNIT-COST-AMT  TO  DT-UNIT-COST (DT-INDEX)   06580012
065900         MOVE DFMEIT-RTL-COST-AMT   TO  DT-UNIT-RETAIL (DT-INDEX) 06590012
066000         MOVE DFMEIT-MDSE-DEPT-NBR  TO  PV-HOLD-DEPARTMENT        06600012
066100         MOVE DFMEIT-MDSE-CLASS-NBR TO  PV-HOLD-CLASS             06610012
066200         MOVE XLT00003-SKU-NBR      TO  PV-HOLD-SKU               06620012
066300         MOVE DFMEIT-UNIT-COST-AMT  TO  PV-HOLD-UNIT-COST         06630012
066400         MOVE DFMEIT-RTL-COST-AMT   TO  PV-HOLD-UNIT-RETAIL       06640012
066500                                                                  06650012
066600     PERFORM UNTIL PS-NO-DATA-LEFT-ON-DB                          06660012
066700                                                                  06670012
066800       EVALUATE TRUE                                              06680012
066900         WHEN DFMEIT-MDSE-DEPT-NBR  =   PV-HOLD-DEPARTMENT        06690012
067000          AND DFMEIT-MDSE-CLASS-NBR =   PV-HOLD-CLASS             06700012
067100          AND XLT00003-SKU-NBR      =   PV-HOLD-SKU               06710012
067200          AND DFMEIT-UNIT-COST-AMT  =   PV-HOLD-UNIT-COST         06720012
067300          AND DFMEIT-RTL-COST-AMT   =   PV-HOLD-UNIT-RETAIL       06730012
067400            ADD PC-ONE              TO  DT-QUANTITY (DT-INDEX)    06740012
067500                                        PV-DOC-TOTAL-QUANTITY     06750012
067600                                                                  06760012
067700         WHEN OTHER                                               06770012
067800            SET  DT-INDEX        UP BY  1                         06780012
067900            MOVE DFMEIT-MDSE-CLASS-NBR                            06790012
068000                                    TO  DT-CLASS (DT-INDEX)       06800012
068100            MOVE XLT00003-SKU-NBR   TO  PV-SKU                    06810012
068200            MOVE PV-SKU             TO  DT-SKU(DT-INDEX)          06820099
068300            MOVE XLT00004-VS-NBR    TO  DT-STYLE (DT-INDEX)       06830012
068400            MOVE XLT00003-SKU-DESC  TO  DT-DESCRIPTION (DT-INDEX) 06840012
068500            MOVE PC-ONE             TO  DT-QUANTITY (DT-INDEX)    06850012
068600            MOVE DFMEIT-UNIT-COST-AMT                             06860012
068700                                    TO  DT-UNIT-COST (DT-INDEX)   06870012
068800            MOVE DFMEIT-RTL-COST-AMT                              06880012
068900                                    TO  DT-UNIT-RETAIL (DT-INDEX) 06890012
069000            ADD  PC-ONE             TO  PV-DOC-TOTAL-QUANTITY     06900012
069100            ADD  PC-ONE             TO  PV-DETAIL-ROWS-TOTAL      06910012
069200            MOVE DFMEIT-MDSE-DEPT-NBR                             06920012
069300                                    TO  PV-HOLD-DEPARTMENT        06930012
069400            MOVE DFMEIT-MDSE-CLASS-NBR                            06940012
069500                                    TO  PV-HOLD-CLASS             06950012
069600            MOVE XLT00003-SKU-NBR   TO  PV-HOLD-SKU               06960012
069700            MOVE DFMEIT-UNIT-COST-AMT                             06970012
069800                                    TO  PV-HOLD-UNIT-COST         06980012
069900            MOVE DFMEIT-RTL-COST-AMT                              06990012
070000                                    TO  PV-HOLD-UNIT-RETAIL       07000012
070100                                                                  07010012
070200       END-EVALUATE                                               07020012
070300                                                                  07030012
070400       PERFORM D200-FETCH-CURSOR                                  07040012
070500                                                                  07050012
070600       IF PS-NO-DATA-LEFT-ON-DB                                   07060012
070700          ADD  PC-ONE               TO  PV-DETAIL-ROWS-TOTAL      07070012
070800       END-IF                                                     07080012
070900                                                                  07090012
071000     END-PERFORM.                                                 07100012
071100                                                                  07110012
071200     PERFORM D150-CLOSE-CURSOR.                                   07120012
071300                                                                  07130012
071400     EJECT                                                        07140012
071500******************************************************************07150012
071600* B300-CREATE-HEADER                                              07160012
071700* ==> PROCESSES:                                                  07170012
071800*   - READ THE DB2 DATABASE TABLES AND MOVE THE NECESSARY         07180012
071900*     INFORMATION INTO THE HEADING FIELDS FOR PRINTING.           07190012
072000*     PERFORMED BY : A100-MAIN-MODULE                             07200012
072100******************************************************************07210012
072200 B300-CREATE-HEADER.                                              07220012
072300*                                                                 07230012
072400* FETCH THE CURRENT DATE AND TIME FOR REPORT HEADING.             07240012
072500*                                                                 07250012
072600     EXEC SQL                                                     07260099
072700         SELECT                                                   07270099
072800         CHAR ( DATE (CURRENT TIMESTAMP),USA)                     07280099
072900     ,   CHAR ( TIME (CURRENT TIMESTAMP),JIS)                     07290099
073000     INTO                                                         07300099
073100         :PV-RUN-DATE                                             07310099
073200     ,   :PV-RUN-TIME                                             07320099
073300         FROM SYSIBM.SYSDUMMY1                                    07330099
073400     END-EXEC                                                     07340099
073500                                                                  07350099
073600     MOVE PV-RUN-DATE                TO DP132-RUN-DATE.           07360099
073700     MOVE PV-RUN-TIME                TO DP132-RUN-TIME.           07370099
073800                                                                  07380099
073900     MOVE 'RVKCS112'                 TO DP132-PROGRAM-NAME.       07390099
074000     MOVE 1                          TO DP132-REPORT-NUMBER.      07400099
074100                                                                  07410099
074200     MOVE RV102-DEFECT-ORDER-NBR     TO  HL2-DEFECT-ORD-ID-NBR.   07420012
074300                                                                  07430012
074400     PERFORM D250-GET-RTV-LOCATION.                               07440099
074500                                                                  07450099
074510     MOVE XLT00010-LOC-NBR        TO HL1A-RTV-LOC.                07451099
074520     MOVE XLT00010-LOC-10-ABBR-NM TO HL1A-RTV-NAME.               07452099
074530                                                                  07453099
074600* ADDED TO GET DEFECT ORDER ITEM STATUS  02/01/93 -AWB            07460012
074700                                                                  07470012
074800     PERFORM D300-READ-DEFECT-ORD-DATA.                           07480012
074900                                                                  07490012
075000     MOVE DFMEIT-MDSE-DEPT-NBR       TO  HL2-DEPARTMENT.          07500099
075100     MOVE DFCTOR-VEND-NAME           TO  HL3-VENDOR-NAME.         07510099
075200     MOVE DFCTOR-VENDOR-DUNS-NBR     TO  HL3-VENDOR-DUNNS-NBR.    07520099
075300     MOVE DFCTOR-DISC-PCT            TO  HL4-DISC-PCT.            07530099
075400     MOVE PV-DOC-TOTAL-QUANTITY      TO  HL5-TOTAL-QTY.           07540099
075500                                                                  07550012
075600* IF THE SHIPPING INFORMATION IS FILLED IN ON THE DEFECTIVE       07560012
075700* ORDER HEADER TABLE, THEN RETRIEVE THE SHIPPING INFORMATION      07570012
075800* AND DISPLAY IT ON THE LISTING.                                  07580012
075900     IF  DFCTOR-DFCT-SHIPT-ID > 0                                 07590012
076000         PERFORM D550-READ-SHIPPING-DATA                          07600012
076100         MOVE RVT00000-ACTL-SHIPT-DTE                             07610099
076200                                     TO  HL6-SHIP-DATE            07620099
076300         MOVE RVT00000-SCAC-CDE      TO  HL7-CARR-SCAC-CDE        07630099
076400         MOVE DFCTOR-CARR-TRKG-ID    TO  HL7-CARR-TRKG-ID         07640099
076500     ELSE                                                         07650012
076600         MOVE SPACES                 TO  HL6-SHIP-DATE            07660099
076700                                         HL7-CARR-SCAC-CDE        07670099
076800                                         HL7-CARR-TRKG-ID         07680099
076900     END-IF.                                                      07690012
077000                                                                  07700012
077100******************************************************************07710012
077200* C100-PROCESS-DOCUMENT.                                          07720012
077300* ==> PROCESSES:                                                  07730012
077400*   - PERFORMS THE PARAGRAPH THAT FORMATS THE DOCUMENT            07740012
077500*   - PERFORMS THE PARAGRAPH THAT PRINTS THE DOUCUMENT            07750012
077600*     PERFORMED BY : A100-MAIN-MODULE                             07760012
077700******************************************************************07770012
077800 C100-PROCESS-DOCUMENT.                                           07780012
077900                                                                  07790012
078000     PERFORM C200-PRINT-PAGE-HEADER.                              07800099
078100                                                                  07810012
078110     INITIALIZE PV-GRAND-UNIT-QTY                                 07811099
078111                PV-GRAND-UNIT-COST-AMT                            07811199
078112                PV-GRAND-UNIT-RETAIL-AMT.                         07811299
078120                                                                  07812099
078200     PERFORM C300-PRINT-DETAIL                                    07820099
078300         UNTIL PS-END-OF-DOCUMENT.                                07830099
078400                                                                  07840012
078500     EJECT                                                        07850012
078600******************************************************************07860012
078700* C200-PRINT-PAGE-HEADER.                                         07870012
078800* ==> PROCESSES:                                                  07880012
078900*   - MOVE THE HEADER LINES TO DRS WORKING STOREAGE AND           07890012
079000*     HAVE DRS WRITE THE LINE TO THE REPORT.                      07900012
079100*     PERFORMED BY : C100-PROCESS-DOCUMENT                        07910012
079200******************************************************************07920012
079300 C200-PRINT-PAGE-HEADER.                                          07930012
079400                                                                  07940012
079500     MOVE PC-PUT                      TO DRS01-DRRB-FUNC.         07950099
079600     ADD  PC-ONE                      TO PV-PAGE-COUNT.           07960099
079700     MOVE PV-PAGE-COUNT               TO DP132-PAGE-NUMBER        07970099
079800                                                                  07980099
079900     MOVE DP132-STANDRD-HEADER-132-COLS                           07990099
080000                                      TO DRS01-COMM-DATA.         08000099
080100     MOVE PC-TOP-OF-PAGE              TO DRS01-COMM-CTL.          08010099
080200     PERFORM Z200-LINK-TO-DRS.                                    08020099
080300                                                                  08030099
080400     MOVE HL1-HEADING-LINE-1          TO DRS01-COMM-DATA.         08040099
080500     MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          08050099
080600     PERFORM Z200-LINK-TO-DRS.                                    08060099
080700                                                                  08070099
080710     MOVE HL1A-HEADING-LINE-1A        TO DRS01-COMM-DATA.         08071099
080720     MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          08072099
080730     PERFORM Z200-LINK-TO-DRS.                                    08073099
080740                                                                  08074099
080800     MOVE HL2-HEADING-LINE-2          TO DRS01-COMM-DATA          08080099
080900     MOVE PC-DOUBLE-SPACE             TO DRS01-COMM-CTL.          08090099
081000     PERFORM Z200-LINK-TO-DRS.                                    08100099
081100                                                                  08110099
081200     MOVE HL3-HEADING-LINE-3          TO DRS01-COMM-DATA          08120099
081300     MOVE PC-DOUBLE-SPACE             TO DRS01-COMM-CTL.          08130099
081400     PERFORM Z200-LINK-TO-DRS.                                    08140099
081500                                                                  08150099
081600     MOVE HL4-HEADING-LINE-4          TO DRS01-COMM-DATA          08160099
081700     MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          08170099
081800     PERFORM Z200-LINK-TO-DRS.                                    08180099
081900                                                                  08190099
082000     MOVE HL5-HEADING-LINE-5          TO DRS01-COMM-DATA          08200099
082100     MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          08210099
082200     PERFORM Z200-LINK-TO-DRS.                                    08220099
082300                                                                  08230099
082400     MOVE HL6-HEADING-LINE-6          TO DRS01-COMM-DATA          08240099
082500     MOVE PC-DOUBLE-SPACE             TO DRS01-COMM-CTL.          08250099
082600     PERFORM Z200-LINK-TO-DRS.                                    08260099
082700                                                                  08270099
082800     MOVE HL7-HEADING-LINE-7          TO DRS01-COMM-DATA          08280099
082900     MOVE PC-DOUBLE-SPACE             TO DRS01-COMM-CTL.          08290099
083000     PERFORM Z200-LINK-TO-DRS.                                    08300099
083100                                                                  08310099
083200     MOVE DH1-DETAIL-HEADING-1        TO DRS01-COMM-DATA          08320099
083300     MOVE PC-DOUBLE-SPACE             TO DRS01-COMM-CTL.          08330099
083400     PERFORM Z200-LINK-TO-DRS.                                    08340099
083500                                                                  08350099
083600     MOVE DH2-DETAIL-HEADING-2        TO DRS01-COMM-DATA          08360099
083700     MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          08370099
083800     PERFORM Z200-LINK-TO-DRS.                                    08380099
083900                                                                  08390099
084000     MOVE DH3-DETAIL-HEADING-3        TO DRS01-COMM-DATA          08400099
084100     MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          08410099
084200     PERFORM Z200-LINK-TO-DRS.                                    08420099
084300                                                                  08430099
084400     MOVE 15                          TO PV-LINE-COUNT.           08440099
084500     SET PS-FIRST-DETAIL-LINE         TO TRUE.                    08450099
084600                                                                  08460012
084700                                                                  08470012
084800******************************************************************08480012
084900* C300-PRINT-DETAIL.                                              08490012
085000* ==> PROCESSES:                                                  08500012
085100*   - MOVE THE HEADER LINES TO DRS WORKING STOREAGE AND           08510012
085200*     HAVE DRS WRITE THE LINE TO THE REPORT.                      08520012
085300*     PERFORMED BY : C100-PROCESS-DOCUMENT                        08530012
085400******************************************************************08540012
085500 C300-PRINT-DETAIL.                                               08550012
085600                                                                  08560012
085700     IF PV-LINE-COUNT > 60                                        08570099
085800         PERFORM C200-PRINT-PAGE-HEADER                           08580099
085900         SET  PS-FIRST-DETAIL-LINE     TO TRUE                    08590099
086000     END-IF.                                                      08600099
086100                                                                  08610099
086200     MOVE  DT-CLASS (DT-INDEX)         TO  DL-CLASS.              08620012
086300     MOVE  DT-SKU (DT-INDEX)           TO  DL-SKU-NBR.            08630012
086400     MOVE  DT-STYLE (DT-INDEX)         TO  DL-STYLE.              08640012
086500     MOVE  DT-DESCRIPTION (DT-INDEX)   TO  DL-DESCRIPTION.        08650012
086600     MOVE  DT-QUANTITY (DT-INDEX)      TO  DL-QUANTITY.           08660012
086610     ADD   DT-QUANTITY (DT-INDEX)      TO  PV-GRAND-UNIT-QTY.     08661099
086701     MOVE  DT-UNIT-COST (DT-INDEX)     TO  DL-UNIT-COST.          08670199
086702     MOVE  ZEROES                      TO  PV-HOLD-UNIT-COST-AMT. 08670299
086703     COMPUTE PV-HOLD-UNIT-COST-AMT =                              08670399
086704             DT-QUANTITY (DT-INDEX) *  DT-UNIT-COST (DT-INDEX).   08670499
086710     ADD   PV-HOLD-UNIT-COST-AMT       TO                         08671099
086720                                       PV-GRAND-UNIT-COST-AMT.    08672099
086800     MOVE  DT-UNIT-RETAIL (DT-INDEX)   TO  DL-UNIT-RETAIL.        08680012
086801     MOVE  ZEROES                    TO PV-HOLD-UNIT-RETAIL-AMT.  08680199
086803     COMPUTE PV-HOLD-UNIT-RETAIL-AMT =                            08680399
086804             DT-QUANTITY (DT-INDEX) *  DT-UNIT-RETAIL (DT-INDEX). 08680499
086810     ADD   PV-HOLD-UNIT-RETAIL-AMT   TO                           08681099
086820                                       PV-GRAND-UNIT-RETAIL-AMT.  08682099
086900                                                                  08690012
087000* IF THIS IS THE FIRST DETAIL LINE ON THE PAGE, WE WANT SINGLE    08700099
087100* SPACE THIS LINE, OTHERWISE WE WANT TO DOUBLE SPACE THE LINE.    08710099
087200     IF  PS-FIRST-DETAIL-LINE                                     08720012
087300         MOVE PC-SINGLE-SPACE          TO  DRS01-COMM-CTL         08730099
087400         SET  PS-NOT-FIRST-DETAIL-LINE TO TRUE                    08740099
087500         ADD  PC-ONE                   TO  PV-LINE-COUNT          08750099
087600     ELSE                                                         08760099
087700         MOVE PC-DOUBLE-SPACE          TO  DRS01-COMM-CTL         08770099
087800         ADD  PC-TWO                   TO  PV-LINE-COUNT          08780099
087900     END-IF.                                                      08790099
088000                                                                  08800012
088100     MOVE  DL-DETAIL-LINE              TO  DRS01-COMM-DATA.       08810099
088200     PERFORM Z200-LINK-TO-DRS.                                    08820012
088300                                                                  08830012
088400     SET   DT-INDEX                 UP BY  PC-ONE.                08840012
088500     SET   PV-INDEX-CHECK              TO  DT-INDEX.              08850012
088600                                                                  08860012
088700     IF  PV-INDEX-CHECK > PV-DETAIL-ROWS-TOTAL                    08870012
088800         SET  PS-END-OF-DOCUMENT       TO  TRUE                   08880012
088900     END-IF.                                                      08890012
089000                                                                  08900012
089100******************************************************************08910012
089200* D100-OPEN-CURSOR.                                              *08920012
089300*                                                                *08930012
089400*    PERFORMED BY B200-LOAD-DETAIL                               *08940012
089500*                                                                *08950012
089600******************************************************************08960012
089700 D100-OPEN-CURSOR.                                                08970012
089800                                                                  08980012
089900     MOVE RV102-DEFECT-ORDER-NBR      TO  DFMEIT-DFCT-ORD-ID.     08990012
090000                                                                  09000012
090100     EXEC SQL                                                     09010012
090200          OPEN DETAIL-CURSOR                                      09020012
090300     END-EXEC.                                                    09030012
090400                                                                  09040012
090500     EVALUATE TRUE                                                09050012
090600         WHEN SQLWARN0 NOT EQUAL SPACE                            09060012
090700         WHEN SQLCODE NOT EQUAL ZERO                              09070012
090800              MOVE 'D100-OPEN-CURSOR'                             09080012
090900                               TO  DP013-PARAGRAPH                09090012
091000              MOVE 'OPEN DETAIL-CURSOR'                           09100012
091100                               TO  DP013-MESSAGE-TEXT (1)         09110012
091200              MOVE 'TDFMEIT'   TO  DP013-DB2-TABLE-NAME (1)       09120099
091300              MOVE 'XLT_SKU'   TO  DP013-DB2-TABLE-NAME (2)       09130099
091400              MOVE 'XLT_VND_STYL'                                 09140099
091500                               TO  DP013-DB2-TABLE-NAME (3)       09150099
091600              MOVE SQLCA       TO  DP013-SQLCA                    09160012
091700              SET DP013-DB2-ABEND                                 09170012
091800                               TO  TRUE                           09180012
091900              PERFORM Z999-ABEND                                  09190012
092000     END-EVALUATE.                                                09200012
092100                                                                  09210012
092200******************************************************************09220012
092300* D150-CLOSE-CURSOR.                                             *09230012
092400*                                                                *09240012
092500*    PERFORMED BY A100-MAIN-MODULE.                              *09250012
092600*                                                                *09260012
092700******************************************************************09270012
092800 D150-CLOSE-CURSOR.                                               09280012
092900                                                                  09290012
093000     EXEC SQL                                                     09300012
093100         CLOSE DETAIL-CURSOR                                      09310012
093200     END-EXEC.                                                    09320012
093300                                                                  09330012
093400     EVALUATE TRUE                                                09340012
093500         WHEN SQLWARN0 NOT EQUAL SPACE                            09350012
093600         WHEN SQLCODE NOT EQUAL ZERO                              09360012
093700              MOVE 'D150-CLOSE-CURSOR'                            09370012
093800                               TO  DP013-PARAGRAPH                09380012
093900              MOVE 'CLOSE DETAIL CURSOR'                          09390012
094000                               TO  DP013-MESSAGE-TEXT (1)         09400012
094100              MOVE 'TDFMEIT'   TO  DP013-DB2-TABLE-NAME (1)       09410099
094200              MOVE 'XLT_SKU'   TO  DP013-DB2-TABLE-NAME (2)       09420099
094300              MOVE 'XLT_VND_STYL'                                 09430099
094400                               TO  DP013-DB2-TABLE-NAME (3)       09440099
094500              MOVE SQLCA   TO  DP013-SQLCA                        09450012
094600              SET DP013-DB2-ABEND                                 09460012
094700                               TO  TRUE                           09470012
094800              PERFORM Z999-ABEND                                  09480012
094900     END-EVALUATE.                                                09490012
095000                                                                  09500012
095100                                                                  09510012
095200******************************************************************09520012
095300* D200-FETCH-CURSOR.                                             *09530012
095400*                                                                *09540012
095500*    PERFORMED BY B200-LOAD-DETAIL                               *09550012
095600******************************************************************09560012
095700 D200-FETCH-CURSOR.                                               09570012
095800                                                                  09580012
095900     EXEC SQL                                                     09590012
096000          FETCH DETAIL-CURSOR                                     09600012
096100                                                                  09610012
096200          INTO                                                    09620012
096300                :DFMEIT-RTL-COST-AMT                              09630012
096400              , :DFMEIT-UNIT-COST-AMT                             09640012
096500              , :DFMEIT-SEQ-NBR                                   09650012
096600              , :DFMEIT-MDSE-DEPT-NBR                             09660012
096700              , :DFMEIT-MDSE-CLASS-NBR                            09670012
096800              , :XLT00003-SKU-NBR                                 09680012
096900              , :XLT00004-VS-NBR                                  09690012
097000              , :XLT00003-SKU-DESC                                09700012
097100     END-EXEC.                                                    09710012
097200                                                                  09720012
097300     EVALUATE TRUE                                                09730012
097400         WHEN SQLCODE = ZERO                                      09740012
097500              CONTINUE                                            09750012
097600                                                                  09760012
097700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09770012
097800              SET PS-NO-DATA-LEFT-ON-DB                           09780012
097900                               TO  TRUE                           09790012
098000                                                                  09800012
098100         WHEN SQLWARN0 NOT EQUAL SPACE                            09810012
098200         WHEN SQLCODE NOT EQUAL ZERO                              09820012
098300              MOVE 'D200-FETCH-CURSOR'                            09830012
098400                               TO  DP013-PARAGRAPH                09840012
098500              MOVE 'FETCH DETAIL CURSOR'                          09850012
098600                               TO  DP013-MESSAGE-TEXT (1)         09860012
098700              MOVE 'TDFMEIT'   TO  DP013-DB2-TABLE-NAME (1)       09870099
098800              MOVE 'XLT_SKU'   TO  DP013-DB2-TABLE-NAME (2)       09880099
098900              MOVE 'XLT_VND_STYL'                                 09890099
099000                               TO  DP013-DB2-TABLE-NAME (3)       09900099
099100              MOVE SQLCA       TO  DP013-SQLCA                    09910012
099200              SET DP013-DB2-ABEND                                 09920012
099300                               TO  TRUE                           09930012
099400              PERFORM Z999-ABEND                                  09940012
099500     END-EVALUATE.                                                09950012
099600                                                                  09960012
099700 EJECT                                                            09970012
099800******************************************************************09980012
099900* D250-GET-RTV-LOCATION.                                          09990012
100000* ==> PROCESSES:                                                  10000012
100100*   - READS THE LOCATION DATA FROM XLT_LOC TABLE                  10010012
100200*                                                                 10020012
100300*     PERFORMED BY : B300-CREATE-HEADER.                          10030012
100400******************************************************************10040012
100500 D250-GET-RTV-LOCATION.                                           10050012
100600                                                                  10060099
100700     INITIALIZE DCLXLT00010.                                      10070099
100800     MOVE RV102-OPER-UNT-ID TO PV-LOC-NBR.                        10080099
100900                                                                  10090012
101000     EXEC SQL                                                     10100099
101100         SELECT  LOC_NBR                                          10110099
101200                ,LOC_10_ABBR_NM                                   10120099
101300           INTO  :XLT00010-LOC-NBR                                10130099
101400                ,:XLT00010-LOC-10-ABBR-NM                         10140099
101500           FROM XLT_LOC                                           10150099
101600         WHERE LOC_NBR = :PV-LOC-NBR                              10160099
101700     END-EXEC.                                                    10170099
101800                                                                  10180012
101900     EVALUATE TRUE                                                10190012
102000         WHEN SQLCODE = ZERO                                      10200012
102100              CONTINUE                                            10210099
102300         WHEN SQLCODE = +100                                      10230099
102400         WHEN SQLWARN0 NOT EQUAL SPACE                            10240012
102500         WHEN SQLCODE NOT EQUAL ZERO                              10250012
102600              MOVE 'D250-READ-LOCATION-DATA'                      10260012
102700                           TO  DP013-PARAGRAPH                    10270012
102800              MOVE 'SELECT LOCATION INFORMATION'                  10280012
102900                           TO  DP013-MESSAGE-TEXT (1)             10290012
103000              MOVE 'XLT_LOC       '                               10300099
103100                           TO  DP013-DB2-TABLE-NAME (1)           10310099
103200              MOVE SQLCA   TO  DP013-SQLCA                        10320012
103300              SET DP013-DB2-ABEND                                 10330012
103400                           TO  TRUE                               10340099
103500              PERFORM Z999-ABEND                                  10350012
103600     END-EVALUATE.                                                10360099
103700                                                                  10370012
103800******************************************************************10380012
103900* D300-READ-DEFECT-ORD-DATA.                                      10390012
104000* ==> PROCESSES:                                                  10400012
104100*   - READS THE DEFECT ORDER HEADER DATA.                         10410012
104200*     IN THE COALESCE STATEMENTS, IF THE VALUE COMING BACK FROM   10420012
104300*     THE TABLE IS NULL, THE VALUE SPECIFIED TO THE RIGHT OF THE  10430012
104400*     COMMA WILL BE PLACED IN THE ASSIGNED HOST VARIABLE.  IF THE 10440012
104500*     VALUE IS NOT NULL, THE VALUE FROM THE TABLE WILL BE MOVED TO10450012
104600*     THE ASSIGNED HOST VARIABLE AS USUAL.                        10460012
104700*                                                                 10470012
104800*     PERFORMED BY : B100-INITIALIZE.                             10480012
104900******************************************************************10490012
105000 D300-READ-DEFECT-ORD-DATA.                                       10500012
105100                                                                  10510012
105200     MOVE RV102-DEFECT-ORDER-NBR  TO  DFCTOR-DFCT-ORD-ID.         10520012
105300                                                                  10530012
105400     PERFORM                                                      10540012
105500         WITH TEST AFTER                                          10550012
105600         VARYING PV-SQL-SUB                                       10560012
105700         FROM 1 BY 1                                              10570012
105800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             10580012
105900            OR SQLCODE = 0                                        10590012
106000                                                                  10600012
106100         EXEC SQL                                                 10610012
106200             SELECT  COALESCE(DFCT_SHIPT_ID, 0)                   10620012
106300                    ,VENDOR_DUNS_NBR                              10630012
106400                    ,VEND_NAME                                    10640012
106500                    ,COALESCE(DISC_PCT, 0)                        10650012
106600                    ,COALESCE(CARR_TRKG_ID,                       10660099
106700                              '                         ')        10670099
106800             INTO    :DFCTOR-DFCT-SHIPT-ID                        10680012
106900                    ,:DFCTOR-VENDOR-DUNS-NBR                      10690012
107000                    ,:DFCTOR-VEND-NAME                            10700012
107100                    ,:DFCTOR-DISC-PCT                             10710012
107200                    ,:DFCTOR-CARR-TRKG-ID                         10720012
107300                                                                  10730012
107400             FROM    TDFCTOR                                      10740012
107500                                                                  10750012
107600             WHERE   DFCT_ORD_ID  =  :DFCTOR-DFCT-ORD-ID          10760012
107700                                                                  10770012
107800         END-EXEC                                                 10780012
107900                                                                  10790012
108000         EVALUATE TRUE                                            10800012
108100             WHEN SQLCODE = ZERO                                  10810012
108200                  CONTINUE                                        10820012
108300                                                                  10830012
108400             WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              10840012
108500             WHEN SQLCODE = PC-DEADLOCK                           10850012
108600                  CONTINUE                                        10860012
108700                                                                  10870012
108800             WHEN SQLWARN0 NOT EQUAL SPACE                        10880012
108900             WHEN SQLCODE NOT EQUAL ZERO                          10890012
109000                  MOVE 'D300-READ-DEFECT-ORD-DATA'                10900012
109100                               TO  DP013-PARAGRAPH                10910012
109200                  MOVE 'RETRIEVE ORDER HEADER INFORMATION'        10920012
109300                               TO  DP013-MESSAGE-TEXT (1)         10930012
109400                  MOVE DFCTOR-DFCT-ORD-ID                         10940012
109500                               TO  PV-DISP-DFCT-ORD-ID            10950012
109600                  STRING 'DEFECTIVE ORDER ID: ' DELIMITED BY SIZE 10960012
109700                         PV-DISP-DFCT-ORD-ID    DELIMITED BY SIZE 10970012
109800                             INTO  DP013-MESSAGE-TEXT (2)         10980012
109900                  MOVE 'TDFCTOR'                                  10990099
110000                               TO  DP013-DB2-TABLE-NAME (1)       11000099
110100                  MOVE SQLCA   TO  DP013-SQLCA                    11010012
110200                  SET DP013-DB2-ABEND                             11020012
110300                               TO  TRUE                           11030012
110400                  PERFORM Z999-ABEND                              11040012
110500         END-EVALUATE                                             11050012
110600     END-PERFORM.                                                 11060012
110700                                                                  11070012
110800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   11080012
110900         MOVE 'L600-RETRIEVE-DOC-TIMEFRAME'                       11090012
111000                               TO  DP013-PARAGRAPH                11100012
111100         MOVE 'MAX RETRIES EXCEEDED FOR SELECT DOCUMENT'          11110012
111200                               TO  DP013-MESSAGE-TEXT (1)         11120012
111300         MOVE DFCTOR-DFCT-ORD-ID                                  11130012
111400                               TO  PV-DISP-DFCT-ORD-ID            11140012
111500         STRING 'DEFECTIVE ORDER ID: ' DELIMITED BY SIZE          11150012
111600                PV-DISP-DFCT-ORD-ID    DELIMITED BY SIZE          11160012
111700                             INTO  DP013-MESSAGE-TEXT (2)         11170012
111800         MOVE 'TDFCTOR'        TO  DP013-DB2-TABLE-NAME (1)       11180099
111900         MOVE SQLCA            TO  DP013-SQLCA                    11190012
112000         SET DP013-DB2-ABEND   TO  TRUE                           11200012
112100         PERFORM Z999-ABEND                                       11210012
112200     END-IF.                                                      11220012
112300                                                                  11230012
112400******************************************************************11240012
112500* D550-READ-SHIPPING-DATA.                                        11250012
112600* ==> PROCESSES:                                                  11260012
112700*   - READS THE SHIPPING DATA FROM RVT_DFCT_SHIPT AND             11270012
112800*     RVT_SHIPT_STAT TABLES.                                      11280012
112900*                                                                 11290012
113000*     PERFORMED BY : B300-CREATE-HEADER.                          11300012
113100******************************************************************11310012
113200 D550-READ-SHIPPING-DATA.                                         11320012
113300                                                                  11330012
113400     INITIALIZE DCLRVT00000.                                      11340012
113500                                                                  11350012
113600     PERFORM                                                      11360012
113700         WITH TEST AFTER                                          11370012
113800         VARYING PV-SQL-SUB                                       11380012
113900         FROM 1 BY 1                                              11390012
114000         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             11400012
114100            OR SQLCODE = 0                                        11410012
114200                                                                  11420012
114300         EXEC SQL                                                 11430012
114400             SELECT  SCAC_CDE                                     11440012
114500                    ,CHAR(ACTL_SHIPT_DTE,USA)                     11450099
114600               INTO  :RVT00000-SCAC-CDE                           11460012
114700                    ,:RVT00000-ACTL-SHIPT-DTE                     11470012
114800               FROM  RVT_DFCT_SHIPT                               11480012
114900              WHERE DFCT_SHIPT_ID   = :DFCTOR-DFCT-SHIPT-ID       11490012
115000         END-EXEC                                                 11500012
115100                                                                  11510012
115200         EVALUATE TRUE                                            11520012
115300             WHEN SQLCODE = ZERO                                  11530012
115400             WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              11540012
115500             WHEN SQLCODE = PC-DEADLOCK                           11550012
115600                  CONTINUE                                        11560012
115700                                                                  11570012
115800             WHEN SQLWARN0 NOT EQUAL SPACE                        11580012
115900             WHEN SQLCODE NOT EQUAL ZERO                          11590012
116000                  MOVE 'D550-READ-SHIPPING-DATA'                  11600012
116100                               TO  DP013-PARAGRAPH                11610012
116200                  MOVE 'SELECT SHIPPING INFORMATION'              11620012
116300                               TO  DP013-MESSAGE-TEXT (1)         11630012
116400                                                                  11640099
116500                  MOVE 'RVT_DFCT_SHIPT'                           11650099
116600                               TO  DP013-DB2-TABLE-NAME (1)       11660099
116700                  MOVE SQLCA   TO  DP013-SQLCA                    11670012
116800                  SET DP013-DB2-ABEND                             11680012
116900                               TO  TRUE                           11690012
117000                  PERFORM Z999-ABEND                              11700012
117100         END-EVALUATE                                             11710012
117200     END-PERFORM.                                                 11720012
117300                                                                  11730012
117400     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   11740012
117500         MOVE 'D550-READ-SHIPPING-DATA  '                         11750012
117600                               TO  DP013-PARAGRAPH                11760012
117700         MOVE 'MAX RETRIES EXCEEDED FOR SELECT SHIP DATA'         11770012
117800                               TO  DP013-MESSAGE-TEXT (1)         11780012
117900         MOVE 'RVT_DFCT_SHIPT' TO  DP013-DB2-TABLE-NAME (1)       11790099
118000         MOVE SQLCA            TO  DP013-SQLCA                    11800012
118100         SET DP013-DB2-ABEND   TO  TRUE                           11810012
118200         PERFORM Z999-ABEND                                       11820012
118300     END-IF.                                                      11830012
118400                                                                  11840012
118500 EJECT                                                            11850012
118600******************************************************************11860012
118700*Z100-CLOSE-FILES.                                                11870012
118800* ==> PROCESSES:                                                  11880012
118900*   - ISSUES A CALL TO DRS TO CLOSE THE OPEN REPORT FILE.         11890012
119000*     PERFORMED BY:  A100-MAIN-MODULE                             11900012
119100******************************************************************11910012
119200 Z100-CLOSE-FILES.                                                11920012
119300                                                                  11930012
119400     IF PV-LINE-COUNT > 51                                        11940099
119500         PERFORM C200-PRINT-PAGE-HEADER                           11950099
119600     END-IF.                                                      11960099
119700                                                                  11970099
119800     MOVE PV-GRAND-UNIT-QTY          TO GT-QTY.                   11980099
119810     MOVE GT-GRAND-TOTAL-QTY         TO DRS01-COMM-DATA.          11981099
119900     MOVE PC-TRIPLE-SPACE            TO DRS01-COMM-CTL.           11990099
120000     PERFORM Z200-LINK-TO-DRS.                                    12000099
120100                                                                  12010099
120101     MOVE PV-GRAND-UNIT-COST-AMT     TO GT-TOTAL-UNIT-COST.       12010199
120102     MOVE GT-GRAND-TOTAL-UNIT-COST   TO DRS01-COMM-DATA           12010299
120103     MOVE PC-DOUBLE-SPACE            TO DRS01-COMM-CTL.           12010399
120104     PERFORM Z200-LINK-TO-DRS.                                    12010499
120105                                                                  12010599
120106     MOVE PV-GRAND-UNIT-RETAIL-AMT   TO                           12010699
120107                                      GT-TOTAL-UNIT-RETAIL.       12010799
120108     MOVE GT-GRAND-TOTAL-UNIT-RETAIL TO DRS01-COMM-DATA.          12010899
120109     MOVE PC-DOUBLE-SPACE            TO DRS01-COMM-CTL.           12010999
120110     PERFORM Z200-LINK-TO-DRS.                                    12011099
120111                                                                  12011199
120112     MOVE ERL-END-OF-REPORT-LINE      TO DRS01-COMM-DATA          12011299
120120     MOVE PC-DOUBLE-SPACE             TO DRS01-COMM-CTL.          12012099
120130     PERFORM Z200-LINK-TO-DRS.                                    12013099
120140                                                                  12014099
120200     MOVE PC-TERM                     TO DRS01-DRRB-FUNC.         12020099
120300     PERFORM Z200-LINK-TO-DRS.                                    12030012
120400 EJECT                                                            12040012
120500******************************************************************12050012
120600*Z200-LINK-TO-DRS.                                                12060012
120700* ==> PROCESSES:                                                  12070012
120800*   - ISSUES THE LINK TO DRS.                                     12080012
120900*     PERFORMED BY:  B100-INITIALIZE                              12090012
121000*                    C200-PRINT-PAGE-HEADER                       12100012
121100*                    C201-PRINT-REPORT                            12110012
121200*                    Z100-CLOSE-FILES                             12120012
121300******************************************************************12130012
121400 Z200-LINK-TO-DRS.                                                12140012
121500                                                                  12150012
121600     EXEC CICS                                                    12160012
121700         LINK                                                     12170012
121800             PROGRAM  ('DRS1INTC')                                12180012
121900             COMMAREA (DRS01-COMMAREA)                            12190012
122000     END-EXEC.                                                    12200012
122100                                                                  12210012
122200     EVALUATE TRUE                                                12220012
122300         WHEN DRS01-DRRB-RC      = 0                              12230012
122400             CONTINUE                                             12240012
122500         WHEN OTHER                                               12250012
122600             MOVE 'Z200-LINK-TO-DRS'                              12260012
122700                                 TO DP013-PARAGRAPH               12270012
122800             SET DP013-OTHER-ABEND                                12280012
122900                                 TO TRUE                          12290012
123000             MOVE DRS01-DRRB-FUNC                                 12300012
123100                                 TO PV-DRS-DRRB-FUNC              12310012
123200             MOVE DRS01-DRRB-RID TO PV-DRS-DRRB-RID               12320012
123300             MOVE DRS01-DRRD-OPTIONS                              12330012
123400                                 TO PV-DRS-DRRB-OPTIONS           12340012
123500             MOVE DRS01-DRRB-RC  TO PV-DRS-DRRB-RC                12350012
123600             MOVE DRS01-DRRB-ATTR-ERROR                           12360012
123700                                 TO PV-DRS-ATTR-ERROR             12370012
123800             MOVE DRS01-DRRB-DRDC                                 12380012
123900                                 TO PV-DRS-DRRB-DRDC              12390012
124000             MOVE DRS01-DRRB01-LINES                              12400012
124100                                 TO PV-DRS-DRRB-LINES             12410012
124200             MOVE PV-DRS-ABEND-DISPLAY-LINE1                      12420012
124300                                 TO DP013-MESSAGE-TEXT (1)        12430012
124400             MOVE PV-DRS-ABEND-DISPLAY-LINE2                      12440012
124500                                 TO DP013-MESSAGE-TEXT (2)        12450012
124600             PERFORM             Z999-ABEND                       12460012
124700     END-EVALUATE.                                                12470012
124800     EJECT                                                        12480012
124900******************************************************************12490012
125000*   STANDARD ABEND ROUTINE                                        12500012
125100* ==> PROCESSES:                                                  12510012
125200*   - ISSUES THE ABEND.                                           12520012
125300*     PERFORMED BY:  D100-GET-CONTROL-NUMBER                      12530012
125400*                    D200-GET-STORE-NAME                          12540012
125500*                    Z200-LINK-TO-DRS                             12550012
125600*                    Z300-READ-TSQ                                12560012
125700******************************************************************12570012
125800 Z999-ABEND.                                                      12580012
125900     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           12590012
126000     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          12600012
126100     INITIALIZE DP013-SRC-TASK-NUMBER                             12610012
126200                DP013-STACK.                                      12620012
126300     SET DP013-LINK-RETURN TO TRUE.                               12630012
126400     SET DP013-NO-ROLLBACK TO TRUE.                               12640012
126500                                                                  12650012
126600     EXEC CICS                                                    12660012
126700         LINK                                                     12670012
126800             PROGRAM  (DP013-NAME)                                12680012
126900             COMMAREA (DP013-PARAMETERS)                          12690012
127000             LENGTH   (DP013-LENGTH)                              12700012
127100     END-EXEC.                                                    12710012
127200                                                                  12720012
127300                                                                  12730012
127400     EXEC CICS                                                    12740012
127500         RETURN                                                   12750012
127600     END-EXEC.                                                    12760012
127700                                                                  12770012
