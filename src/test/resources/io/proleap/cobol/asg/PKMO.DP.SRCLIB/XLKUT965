000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XLKUT965.                                         00020000
000300 AUTHOR.        RON KRIER.                                        00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   FEBRUARY, 2019.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* ************************************************************** *00080000
000900* * XLKUT965 - READS IN A FILE OF PO NUMBERS AND FOR EACH      * *00090000
001000* *            RECORD, OPENS A CURSOR WITH THE PO LINE, DC     * *00100000
001100* *            SPLIT AND STORE ALLOCATION TABLES JOINED TO     * *00110000
001200* *            GET DATA FOR SPECIFIC STORES TO PASS TO A TEAM  * *00120000
001210* *            TO USE FOR SOME FREIGHT FORECASTING.            * *00121000
001300* *                                                            * *00130000
002200* ************************************************************** *00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400 CONFIGURATION SECTION.                                           00240000
002500 SOURCE-COMPUTER.        IBM-3090.                                00250000
002600 OBJECT-COMPUTER.        IBM-3090.                                00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT INPUT-FILE                    ASSIGN TO IN01.         00310000
003200     SELECT OUTPUT-FILE                   ASSIGN TO OUT01.        00320000
003300                                                                  00330000
003400******************************************************************00340000
003500 DATA DIVISION.                                                   00350000
003600 FILE SECTION.                                                    00360000
003700                                                                  00370000
003800 FD  INPUT-FILE                                                   00380000
003900     RECORDING MODE IS F                                          00390000
004000     LABEL RECORDS ARE STANDARD                                   00400000
004100     BLOCK CONTAINS 0 RECORDS.                                    00410000
004200 01  INPUT-RECORD                    PIC  X(150).                 00420009
004300                                                                  00430000
004400 FD  OUTPUT-FILE                                                  00440000
004500     RECORDING MODE IS F                                          00450000
004600     LABEL RECORDS ARE STANDARD                                   00460000
004700     BLOCK CONTAINS 0 RECORDS.                                    00470000
004800 01  OUTPUT-RECORD                   PIC  X(300).                 00480009
004900                                                                  00490000
005000                                                                  00500000
005100                                                                  00510000
005200 WORKING-STORAGE SECTION.                                         00520000
005300                                                                  00530000
005400 01  PC-PROGRAM-CONSTANTS.                                        00540000
005410     05  PC-SPACE                    PIC X(01) VALUE ' '.         00541014
005500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'XLKUT965'.  00550000
005900     05  PC-ABEND-INFO.                                           00590000
006000         10  PC-ABEND                PIC X(11) VALUE              00600000
006100                                               '** ABEND **'.     00610000
006200         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00620000
006300                                               '- PARA       : '. 00630000
006400         10  PC-ABEND-MSG-DISPLAY-PARA                            00640000
006500                                     PIC X(15) VALUE              00650000
006600                                               '  CALLED PARA: '. 00660000
006700         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00670000
006800                                               '  FOR ABEND# : '. 00680000
006900         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00690000
007000                                               '- ERROR IS   : '. 00700000
007100         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00710000
007200         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00720000
007300                                               '- ACTION     : '. 00730000
007400     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00740000
007500     05  PC-1                        PIC 9(04) VALUE 0001.        00750000
007600     05  PC-2                        PIC 9(04) VALUE 0002.        00760000
007700     05  PC-3                        PIC 9(04) VALUE 0003.        00770000
007800     05  PC-4                        PIC 9(04) VALUE 0004.        00780000
007900     05  PC-5                        PIC 9(04) VALUE 0005.        00790000
008000     05  PC-6                        PIC 9(04) VALUE 0006.        00800000
008100     05  PC-7                        PIC 9(04) VALUE 0007.        00810000
008200     05  PC-8                        PIC 9(04) VALUE 0008.        00820000
008300                                                                  00830000
008400 01  PS-PROGRAM-SWITCHES.                                         00840000
008500     05  PS-INPUT-EOF-SW             PIC X(01) VALUE 'N'.         00850000
008600         88  PS-INPUT-EOF                      VALUE 'Y'.         00860000
008700         88  PS-INPUT-NOT-EOF                  VALUE 'N'.         00870000
009400     05  PS-WRITE-FROM-SW            PIC X(01) VALUE 'N'.         00940000
009500         88  PS-WRITE-FROM-INPUT               VALUE 'I'.         00950000
009600         88  PS-WRITE-FROM-CURSOR              VALUE 'C'.         00960000
009700     05  PS-END-OF-PO-CSR-SW         PIC X(01) VALUE 'N'.         00970000
009800         88  PS-END-OF-PO-CSR                  VALUE 'Y'.         00980000
013000                                                                  01300000
013100 01  PV-PROGRAM-VARIABLES.                                        01310000
013200     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01320000
013300     05  PV-PO-NBR-NUM               PIC  9(8) VALUE 0.           01330000
013400     05  PV-PREV-PO-NBR              PIC  9(8) VALUE 0.           01340000
013500     05  PV-PREV-SKU-NBR             PIC  9(8) VALUE 0.           01350000
013600     05  PV-PREV-STR-NBR             PIC  9(4) VALUE 0.           01360000
013700     05  PV-PREV-DISP-PO-NBR         PIC  9(8) VALUE 0.           01370000
013800     05  PV-PREV-DISP-SKU-NBR        PIC  9(8) VALUE 0.           01380000
013900     05  PV-INPUT-READ               PIC  9(9) VALUE 0.           01390000
014000     05  PV-INPUT-CHECK-CNT          PIC  9(9) VALUE 0.           01400000
014100     05  PV-OUTPUT-WRITTEN           PIC  9(9) VALUE 0.           01410000
014900     05  PV-DISPLAY-FIELD            PIC  9(9) VALUE 0.           01490000
015000     05  PV-DISPLAY-FIELD2           PIC  9(9) VALUE 0.           01500000
015100     05  PV-DISPLAY-FIELD3           PIC  9(4) VALUE 0.           01510000
015200     05  PV-DISPLAY-FIELD4           PIC  9(5) VALUE 0.           01520000
015500     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01550000
015600                                                                  01560000
015700     05  PV-SPACE-CNTR               PIC 9(04) VALUE 0.           01570000
015800     05  PV-CHAR-CNTR                PIC 9(04) VALUE 0.           01580000
015900     05  PV-CONVERSION-FIELD-9       PIC 9(08) VALUE 0.           01590000
016000                                                                  01600000
016100     05  PV-CC-TIMESTAMP             PIC X(26) VALUE SPACES.      01610000
016200     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01620000
016300     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01630000
016400     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01640000
016500     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01650000
016600     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01660000
016700     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01670000
016800                                                                  01680000
016900     05  PV-TMST                     PIC X(26) VALUE SPACES.      01690000
017000     05  PV-TIMESTAMP-DETAIL                                      01700000
017100         REDEFINES                                                01710000
017200         PV-TMST.                                                 01720000
017300         10  PV-TIMESTAMP-19.                                     01730000
017400             15  PV-TMS-DATE.                                     01740000
017500                 20  PV-TMS-YEAR.                                 01750000
017600                     25  PV-TMS-CC   PIC X(02).                   01760000
017700                     25  PV-TMS-YY   PIC X(02).                   01770000
017800                 20  FILLER          PIC X(01).                   01780000
017900                 20  PV-TMS-MONTH    PIC X(02).                   01790000
018000                 20  FILLER          PIC X(01).                   01800000
018100                 20  PV-TMS-DAY      PIC X(02).                   01810000
018200             15  FILLER              PIC X(01).                   01820000
018300             15  PV-TMS-HOUR         PIC X(02).                   01830000
018400             15  FILLER              PIC X(01).                   01840000
018500             15  PV-TMS-MINUTE       PIC X(02).                   01850000
018600             15  FILLER              PIC X(01).                   01860000
018700             15  PV-TMS-SECOND       PIC X(02).                   01870000
018800         10  FILLER                  PIC X(01).                   01880000
018900         10  PV-TMS-MSECOND          PIC X(06).                   01890000
019000                                                                  01900000
019100 01  IR-INPUT-RECORD.                                             01910000
019300     05  IR-PO-NBR                   PIC  S9(9) COMP VALUE ZERO.  01930001
019500     05  IR-PO-TYP-CDE               PIC  X(02)      VALUE SPACE. 01950001
019600     05  IR-TOT-UNT-QTY              PIC  S9(9) COMP VALUE ZERO.  01960005
019610     05  IR-TOT-SKUS-QTY             PIC  S9(4) COMP VALUE ZERO.  01961005
019620     05  IR-IMPRT-VEND-NAME          PIC  X(35)      VALUE SPACE. 01962005
019630     05  IR-IMPRT-FCTRY-NAME         PIC  X(35)      VALUE SPACE. 01963005
019640     05  IR-IMPRT-PO-IND             PIC  X(01)      VALUE SPACE. 01964005
019641     05  IR-OTB-PER-NBR              PIC  X(06)      VALUE ZERO.  01964105
019642     05  IR-STATUS-CDE               PIC  X(02)      VALUE SPACE. 01964205
019643     05  IR-ORD-DTE                  PIC  X(10)      VALUE SPACE. 01964305
019644     05  IR-PLCMNT-CNTRY-CDE         PIC  X(03)      VALUE SPACE. 01964405
019645     05  IR-PROD-CNTRY-CDE           PIC  X(03)      VALUE SPACE. 01964505
019646     05  IR-PKGNG-CDE                PIC  X(01)      VALUE SPACE. 01964605
019647     05  IR-SEASET-YR                PIC  X(04)      VALUE SPACE. 01964705
019648     05  IR-SEASET-SHRT-NM           PIC  X(05)      VALUE SPACE. 01964805
019649     05  IR-DEPT-NBR                 PIC  X(03)      VALUE SPACE. 01964905
019650     05  IR-DERVD-LBL-TYP-CDE        PIC  X(01)      VALUE SPACE. 01965005
020200     05  FILLER                      PIC  X(29)      VALUE SPACE. 02020005
020300                                                                  02030000
021700 01  OR-OUTPUT-HEADER-RECORD.                                     02170012
021701     05  FILLER                      PIC  X(50)      VALUE        02170112
021702         'PO NBR,SKU NBR,PLAN NBR,STORE NBR,ALLOC QTY,OTB PE'.    02170212
021703     05  FILLER                      PIC  X(50)      VALUE        02170312
021704         'RIOD,ORD DATE,PO TYPE,PO UNT QTY,NBR SKUS,IM VENDO'.    02170412
021705     05  FILLER                      PIC  X(50)      VALUE        02170512
021706         'R,IM FACTORY,IM PO IND,PO STATUS,PLCMNT CNTRY,PROD'.    02170612
021707     05  FILLER                      PIC  X(50)      VALUE        02170712
021708         ' CNTRY,PKGNG CDE,SEASET YR,SEASET NM,DEPT,DERVD LB'.    02170812
021709     05  FILLER                      PIC  X(50)      VALUE        02170912
021710         'L,PO LINE,STAT TMST,CL NBR,LNE UNT QTY,LNE STATUS,'.    02171012
021711     05  FILLER                      PIC  X(50)      VALUE        02171112
021712         'LNE CNCLD QTY,DC SPLIT QTY,DC NBR,SPLIT CRE DATE, '.    02171213
021713                                                                  02171312
021720 01  OR-OUTPUT-RECORD.                                            02172012
021800     05  OR-PO-NBR                   PIC  9(08)      VALUE ZERO.  02180000
021900     05  FILLER                      PIC  X(01)      VALUE ','.   02190001
022000     05  OR-SKU-NBR                  PIC  9(08)      VALUE ZERO.  02200000
022100     05  FILLER                      PIC  X(01)      VALUE ','.   02210001
022120     05  OR-PLAN-NBR                 PIC  9(04)      VALUE ZERO.  02212005
022130     05  FILLER                      PIC  X(01)      VALUE ','.   02213005
022200     05  OR-STORE-NBR                PIC  9(04)      VALUE ZERO.  02220000
022300     05  FILLER                      PIC  X(01)      VALUE ','.   02230001
022400     05  OR-STORE-ALLOC-QTY          PIC  9(09)      VALUE ZERO.  02240001
022520     05  FILLER                      PIC  X(01)      VALUE ','.   02252002
022600     05  OR-OTB-PER-NBR              PIC  X(06)      VALUE SPACE. 02260001
022700     05  FILLER                      PIC  X(01)      VALUE ','.   02270001
022800     05  OR-ORD-DTE                  PIC  X(10)      VALUE ZERO.  02280001
022900     05  FILLER                      PIC  X(01)      VALUE ','.   02290001
023000     05  OR-PO-TYP-CDE               PIC  X(02)      VALUE SPACE. 02300001
023010     05  FILLER                      PIC  X(01)      VALUE ','.   02301005
023100     05  OR-PO-TOT-UNT-QTY           PIC  9(08)      VALUE ZERO.  02310005
023110     05  FILLER                      PIC  X(01)      VALUE ','.   02311005
023200     05  OR-PO-TOT-SKUS-QTY          PIC  9(04)      VALUE ZERO.  02320005
023201     05  FILLER                      PIC  X(01)      VALUE ','.   02320105
023210     05  OR-IMPRT-VEND-NAME          PIC  X(35)      VALUE SPACE. 02321005
023211     05  FILLER                      PIC  X(01)      VALUE ','.   02321105
023220     05  OR-IMPRT-FCTRY-NAME         PIC  X(35)      VALUE SPACE. 02322005
023221     05  FILLER                      PIC  X(01)      VALUE ','.   02322105
023230     05  OR-IMPRT-PO-IND             PIC  X(01)      VALUE SPACE. 02323005
023240     05  FILLER                      PIC  X(01)      VALUE ','.   02324005
023250     05  OR-PO-STATUS-CDE            PIC  X(02)      VALUE SPACE. 02325005
023260     05  FILLER                      PIC  X(01)      VALUE ','.   02326005
023270     05  OR-PLCMNT-CNTRY-CDE         PIC  X(03)      VALUE SPACE. 02327005
023271     05  FILLER                      PIC  X(01)      VALUE ','.   02327105
023280     05  OR-PROD-CNTRY-CDE           PIC  X(03)      VALUE SPACE. 02328005
023281     05  FILLER                      PIC  X(01)      VALUE ','.   02328105
023290     05  OR-PKGNG-CDE                PIC  X(01)      VALUE SPACE. 02329005
023291     05  FILLER                      PIC  X(01)      VALUE ','.   02329105
023292     05  OR-SEASET-YR                PIC  X(04)      VALUE SPACE. 02329205
023293     05  FILLER                      PIC  X(01)      VALUE ','.   02329305
023294     05  OR-SEASET-SHRT-NM           PIC  X(05)      VALUE SPACE. 02329405
023295     05  FILLER                      PIC  X(01)      VALUE ','.   02329505
023296     05  OR-DEPT-NBR                 PIC  X(03)      VALUE SPACE. 02329605
023297     05  FILLER                      PIC  X(01)      VALUE ','.   02329705
023298     05  OR-DERVD-LBL-TYP-CDE        PIC  X(01)      VALUE SPACE. 02329805
023299     05  FILLER                      PIC  X(01)      VALUE ','.   02329905
023300     05  OR-PO-LNE-NBR               PIC  9(04)      VALUE ZERO.  02330005
023301     05  FILLER                      PIC  X(01)      VALUE ','.   02330105
023302     05  OR-STAT-TMST                PIC  X(26)      VALUE SPACE. 02330207
023303     05  FILLER                      PIC  X(01)      VALUE ','.   02330305
023304     05  OR-CL-NBR                   PIC  X(02)      VALUE SPACE. 02330405
023305     05  FILLER                      PIC  X(01)      VALUE ','.   02330505
023306     05  OR-LNE-UNT-QTY              PIC  9(08)      VALUE ZERO.  02330605
023307     05  FILLER                      PIC  X(01)      VALUE ','.   02330705
023308     05  OR-LNE-STATUS-CDE           PIC  X(02)      VALUE SPACE. 02330805
023309     05  FILLER                      PIC  X(01)      VALUE ','.   02330905
023310     05  OR-LNE-CNCLD-UNT-QTY        PIC  9(08)      VALUE ZERO.  02331005
023311     05  FILLER                      PIC  X(01)      VALUE ','.   02331105
023312     05  OR-DC-SPLIT-QTY             PIC  9(08)      VALUE ZERO.  02331205
023313     05  FILLER                      PIC  X(01)      VALUE ','.   02331305
023314     05  OR-DC-NBR                   PIC  9(04)      VALUE ZERO.  02331405
023315     05  FILLER                      PIC  X(01)      VALUE ','.   02331505
023316     05  OR-SPLIT-CRE-DATE           PIC  X(10)      VALUE SPACE. 02331605
023317     05  FILLER                      PIC  X(01)      VALUE ','.   02331710
023340     05  FILLER                      PIC  X(42)      VALUE SPACE. 02334010
023400                                                                  02340000
023500 01  DK-DATA-KEY-FIELDS.                                          02350000
023600     05  DK-PO-NBR                   PIC  S9(9) COMP    VALUE 0.  02360000
023900                                                                  02390000
024000 01  DM-DISPLAY-MESSAGE.                                          02400000
024100     05  DM-01-10.                                                02410000
024200         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       02420000
024300         10  FILLER                  PIC X(02) VALUE ': '.        02430000
024400     05  DM-11-80.                                                02440000
024500         10  FILLER                  PIC X(37) VALUE              02450000
024600                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  02460000
024700         10  FILLER                  PIC X(30) VALUE              02470000
024800                        'CREATING TRECDIS EXTRACT FILE.'.         02480000
024900         10  FILLER                  PIC X(01) VALUE SPACE.       02490000
025000         10  FILLER                  PIC X(01) VALUE ALL '*'.     02500000
025100     05  DM-81-120.                                               02510000
025200         10  FILLER                  PIC X(40) VALUE ALL '*'.     02520000
025300                                                                  02530000
025400 01  DP-DISPLAY-PROGRESS-MSG.                                     02540000
025500     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       02550000
025600     05  FILLER                      PIC X(02) VALUE SPACE.       02560000
025700     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       02570000
025800     05  FILLER                      PIC X(04) VALUE ' AT '.      02580000
025900     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       02590000
026000     05  FILLER                      PIC X(03) VALUE '.  '.       02600000
026100     05  FILLER                      PIC X(03) VALUE              02610000
026200                                         'IN:'.                   02620000
026300     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              02630000
026400                                               VALUE ZERO.        02640000
026500     05  FILLER                      PIC X(02) VALUE ', '.        02650000
026600     05  FILLER                      PIC X(14) VALUE              02660000
026700                                         'ROWS SELECTED:'.        02670000
026800     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              02680000
026900                                               VALUE ZERO.        02690000
027000     05  FILLER                      PIC X(02) VALUE ', '.        02700000
027100     05  FILLER                      PIC X(04) VALUE              02710000
027200                                         'OUT:'.                  02720000
027300     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              02730000
027400                                               VALUE ZERO.        02740000
027500     05  FILLER                      PIC X(01) VALUE '.'.         02750000
027600                                                                  02760000
027700 01  ABEND-CODE                      PIC S9(04)                   02770000
027800                                               VALUE ZEROES       02780000
027900                                               COMP SYNC.         02790000
028000                                                                  02800000
028100*---------------------------------------------------------------* 02810000
028200*  DB2 FORMATTED MESSAGE AREA                                     02820000
028300*---------------------------------------------------------------* 02830000
028400     COPY DPWS004.                                                02840000
028500                                                                  02850000
029400*---------------------------------------------------------------* 02940000
029500*    DB2 AREA FOR TPURITM                                       * 02950000
029600*---------------------------------------------------------------* 02960000
029700     EXEC SQL                                                     02970000
029800          INCLUDE TPURITM                                         02980000
029900     END-EXEC.                                                    02990000
030000                                                                  03000000
030100*---------------------------------------------------------------* 03010000
030200*    DB2 AREA FOR TMESTDS                                       * 03020000
030300*---------------------------------------------------------------* 03030000
030400     EXEC SQL                                                     03040000
030500          INCLUDE TMESTDS                                         03050000
030600     END-EXEC.                                                    03060000
030700                                                                  03070000
030800*---------------------------------------------------------------* 03080000
030810*    DB2 AREA FOR TALLPLN                                       * 03081000
030820*---------------------------------------------------------------* 03082000
030830     EXEC SQL                                                     03083000
030840          INCLUDE TALLPLN                                         03084000
030850     END-EXEC.                                                    03085000
030860                                                                  03086000
030870*---------------------------------------------------------------* 03087000
030880*    DB2 AREA FOR COMMUNICATIONS                                * 03088000
030890*---------------------------------------------------------------* 03089000
030900     EXEC SQL                                                     03090000
031000          INCLUDE SQLCA                                           03100000
031100     END-EXEC.                                                    03110000
031200                                                                  03120000
031300*---------------------------------------------------------------* 03130000
031400*  DRIVING CURSOR                                                 03140000
031500*---------------------------------------------------------------* 03150000
031600     EXEC SQL                                                     03160000
031700          DECLARE PO-CSR CURSOR FOR                               03170000
031710          SELECT B.PO_NBR , B.PO_LNE_NBR , B.RMS_PO_SKU_NBR       03171002
031720               , C.DEST_NBR , D.STR_NBR , D.STR_DISTRO_QTY        03172002
031730               , B.STAT_TMST, B.CL_NBR, B.UNT_QTY, B.STATUS_CDE   03173005
031740               , B.CNCLD_UNT_QTY, C.CURR_SPLIT_QTY                03174005
031750               , C.SPLIT_CRE_DATE, D.PLAN_NBR                     03175005
032200            FROM TPURITM B                                        03220002
032300               , TALLPLN C                                        03230002
032310               , TMESTDS D                                        03231002
032400           WHERE B.PO_NBR         = :DK-PO-NBR                    03240002
032500             AND B.VER_STATUS_CDE = 'A'                           03250002
032600             AND C.PO_NBR         = B.PO_NBR                      03260002
032900             AND C.PO_LNE_NBR     = B.PO_LNE_NBR                  03290000
033000             AND D.PO_NBR = C.PO_NBR                              03300002
033100             AND D.PO_LNE_NBR = C.PO_LNE_NBR                      03310002
033110             AND D.PLAN_NBR = C.PLAN_NBR                          03311002
033120             AND D.STR_NBR IN (82,139,438,477,590                 03312002
033130                 ,638,652,675,739,982,992,997,1011,1018           03313002
033140                 ,1138,1217,1288,1396,1410,1455)                  03314002
033150             AND D.STR_DISTRO_QTY > 0                             03315003
033200           ORDER BY B.PO_NBR, B.PO_LNE_NBR, D.STR_NBR             03320002
033300     END-EXEC.                                                    03330000
033400                                                                  03340000
033813                                                                  03381300
033814 PROCEDURE DIVISION.                                              03381400
033815                                                                  03381500
033816 0000-PROGRAM-MAINLINE.                                           03381600
033817                                                                  03381700
033818     PERFORM 1000-INITIALIZE.                                     03381800
033819                                                                  03381900
033820     PERFORM 2000-PROCESS-INPUT-FILE                              03382000
033830         UNTIL PS-INPUT-EOF.                                      03383000
033840                                                                  03384000
033850     CLOSE INPUT-FILE.                                            03385000
033860     CLOSE OUTPUT-FILE.                                           03386000
033870                                                                  03387000
033880     MOVE PV-INPUT-READ TO PV-DISPLAY-FIELD.                      03388000
033890     DISPLAY 'INPUT RECORDS READ      :  ' PV-DISPLAY-FIELD.      03389000
033900                                                                  03390000
034000     MOVE PV-OUTPUT-WRITTEN TO PV-DISPLAY-FIELD.                  03400000
034100     DISPLAY 'OUTPUT RECORDS WRITTEN  :  ' PV-DISPLAY-FIELD.      03410000
034200                                                                  03420000
035300     STOP RUN.                                                    03530000
035400                                                                  03540000
035500                                                                  03550000
035600* ************************************************************** *03560000
035700* * INITIALIZATIONS                                            * *03570000
035800* ************************************************************** *03580000
035900 1000-INITIALIZE.                                                 03590000
036000                                                                  03600000
036100     OPEN  INPUT  INPUT-FILE.                                     03610000
036200     OPEN  OUTPUT OUTPUT-FILE.                                    03620000
036300                                                                  03630000
036302     WRITE OUTPUT-RECORD FROM                                     03630212
036303           OR-OUTPUT-HEADER-RECORD.                               03630312
036304                                                                  03630412
036305     ADD +1 TO PV-OUTPUT-WRITTEN.                                 03630512
036307                                                                  03630712
036310     DISPLAY 'READY TO DO FIRST READ OF INPUT FILE'.              03631011
036320                                                                  03632011
036400     PERFORM 9050-READ-INPUT-FILE.                                03640000
036700                                                                  03670000
036800 2000-PROCESS-INPUT-FILE.                                         03680000
036900                                                                  03690000
036910     PERFORM 3200-PROCESS-PO-CURSOR.                              03691002
037100                                                                  03710000
037200     PERFORM 9050-READ-INPUT-FILE.                                03720000
039500                                                                  03950002
039800*            PERFORM 4000-FORMAT-WRITE-FROM-INPUT                 03980002
042340                                                                  04234000
042350 3200-PROCESS-PO-CURSOR.                                          04235000
042360                                                                  04236000
042370     MOVE IR-PO-NBR TO DK-PO-NBR.                                 04237000
042380                                                                  04238000
042390     PERFORM 3300-OPEN-PO-CSR.                                    04239000
042400                                                                  04240000
042500     MOVE 'N' TO PS-END-OF-PO-CSR-SW.                             04250000
042600     PERFORM 3400-PROCESS-CSR                                     04260000
042700       UNTIL  PS-END-OF-PO-CSR.                                   04270000
042800                                                                  04280000
042900     PERFORM 3600-CLOSE-PO-CSR.                                   04290000
043620                                                                  04362000
043630 3300-OPEN-PO-CSR.                                                04363000
043640                                                                  04364000
043650     EXEC SQL                                                     04365000
043660         OPEN PO-CSR                                              04366000
043670     END-EXEC.                                                    04367000
043680                                                                  04368000
043690     EVALUATE TRUE                                                04369000
043700         WHEN SQLCODE = ZERO                                      04370000
043800             CONTINUE                                             04380000
043900         WHEN SQLWARN0 NOT = SPACE                                04390000
044000         WHEN SQLCODE < ZERO                                      04400000
044100         WHEN SQLCODE > ZERO                                      04410000
044200          DISPLAY 'PO NUMBER:  ' IR-PO-NBR                        04420000
044300          MOVE '3300-OPEN-PO-CSR'                                 04430000
044400                             TO PV-PARAGRAPH-NAME                 04440000
044500          MOVE 'OPEN PO-CSR'                                      04450000
044600                             TO PV-DB2-OPERATION-MSG-1            04460000
044700          MOVE 'TPURITM+'    TO PV-DB2-TABLE-NAME                 04470016
044800          PERFORM 9999-DB2-ABEND                                  04480000
044900     END-EVALUATE.                                                04490000
045000                                                                  04500000
045100 3400-PROCESS-CSR.                                                04510000
045200                                                                  04520000
045300     PERFORM 3500-FETCH-PO-CSR.                                   04530000
045400                                                                  04540000
045500     IF  PS-END-OF-PO-CSR                                         04550000
045600         CONTINUE                                                 04560000
045700     ELSE                                                         04570000
045800         PERFORM 4400-FORMAT-WRITE-FROM-CURSOR                    04580000
045900     END-IF.                                                      04590000
046000                                                                  04600000
046100 3500-FETCH-PO-CSR.                                               04610000
046200                                                                  04620000
046300     EXEC SQL                                                     04630000
046400         FETCH  PO-CSR                                            04640000
046500          INTO  :PURITM-PO-NBR                                    04650002
046600             ,  :PURITM-PO-LNE-NBR                                04660002
046700             ,  :PURITM-RMS-PO-SKU-NBR                            04670000
046710             ,  :ALLPLN-DEST-NBR                                  04671002
046800             ,  :MESTDS-STR-NBR                                   04680000
046900             ,  :MESTDS-STR-DISTRO-QTY                            04690000
047000             ,  :PURITM-STAT-TMST                                 04700005
047010             ,  :PURITM-CL-NBR                                    04701005
047020             ,  :PURITM-UNT-QTY                                   04702005
047030             ,  :PURITM-STATUS-CDE                                04703005
047040             ,  :PURITM-CNCLD-UNT-QTY                             04704005
047050             ,  :ALLPLN-CURR-SPLIT-QTY                            04705005
047060             ,  :ALLPLN-SPLIT-CRE-DATE                            04706006
047070             ,  :MESTDS-PLAN-NBR                                  04707005
047100     END-EXEC.                                                    04710000
047200                                                                  04720000
047300     EVALUATE TRUE                                                04730000
047400         WHEN SQLCODE = ZERO                                      04740000
047500             CONTINUE                                             04750000
047600         WHEN SQLCODE = +100                                      04760000
047700             SET PS-END-OF-PO-CSR    TO  TRUE                     04770000
047800         WHEN SQLWARN0 NOT = SPACE                                04780000
047900         WHEN SQLCODE < ZERO                                      04790000
048000         WHEN SQLCODE > ZERO                                      04800000
048100          DISPLAY 'PO NUMBER:  ' IR-PO-NBR                        04810000
048200          MOVE '3500-FETCH-PO-CSR'                                04820000
048300                             TO PV-PARAGRAPH-NAME                 04830000
048400          MOVE 'FETCH PO-CSR'                                     04840000
048500                             TO PV-DB2-OPERATION-MSG-1            04850000
048600          MOVE 'TPURITM+'    TO PV-DB2-TABLE-NAME                 04860016
048700          PERFORM 9999-DB2-ABEND                                  04870000
048800     END-EVALUATE.                                                04880000
048900                                                                  04890000
049000 3600-CLOSE-PO-CSR.                                               04900000
049100                                                                  04910000
049200     EXEC SQL                                                     04920000
049300         CLOSE PO-CSR                                             04930000
049400     END-EXEC.                                                    04940000
049500                                                                  04950000
049600     EVALUATE TRUE                                                04960000
049700         WHEN SQLCODE = ZERO                                      04970000
049800             CONTINUE                                             04980000
049900         WHEN SQLWARN0 NOT = SPACE                                04990000
050000         WHEN SQLCODE < ZERO                                      05000000
050100         WHEN SQLCODE > ZERO                                      05010000
050200          DISPLAY 'PO NUMBER:  ' IR-PO-NBR                        05020000
050300          MOVE '3600-CLOSE-PO-CSR'                                05030000
050400                             TO PV-PARAGRAPH-NAME                 05040000
050500          MOVE 'CLOSE PO-CSR'                                     05050000
050600                             TO PV-DB2-OPERATION-MSG-1            05060000
050700          MOVE 'TPURITM+'    TO PV-DB2-TABLE-NAME                 05070016
050800          PERFORM 9999-DB2-ABEND                                  05080000
050900     END-EVALUATE.                                                05090000
052600                                                                  05260000
052700 4400-FORMAT-WRITE-FROM-CURSOR.                                   05270000
052800                                                                  05280000
052900     MOVE IR-PO-NBR TO OR-PO-NBR.                                 05290002
052910     MOVE IR-PO-TYP-CDE TO OR-PO-TYP-CDE.                         05291002
052920     MOVE IR-OTB-PER-NBR TO OR-OTB-PER-NBR.                       05292002
052930     MOVE IR-ORD-DTE TO OR-ORD-DTE.                               05293002
052934     MOVE IR-TOT-UNT-QTY TO OR-PO-TOT-UNT-QTY.                    05293405
052935     MOVE IR-TOT-SKUS-QTY TO OR-PO-TOT-SKUS-QTY.                  05293505
052936     MOVE IR-IMPRT-VEND-NAME TO OR-IMPRT-VEND-NAME.               05293605
052937     INSPECT OR-IMPRT-VEND-NAME REPLACING ALL                     05293714
052938         ',' BY PC-SPACE.                                         05293814
052939     MOVE IR-IMPRT-FCTRY-NAME TO OR-IMPRT-FCTRY-NAME.             05293905
052940     INSPECT OR-IMPRT-FCTRY-NAME REPLACING ALL                    05294014
052941         ',' BY PC-SPACE.                                         05294114
052942     MOVE IR-IMPRT-PO-IND TO OR-IMPRT-PO-IND.                     05294205
052943     MOVE IR-STATUS-CDE TO OR-PO-STATUS-CDE.                      05294305
052944     MOVE IR-PLCMNT-CNTRY-CDE TO OR-PLCMNT-CNTRY-CDE.             05294405
052945     MOVE IR-PROD-CNTRY-CDE TO OR-PROD-CNTRY-CDE.                 05294505
052946     MOVE IR-PKGNG-CDE TO OR-PKGNG-CDE.                           05294605
052947     MOVE IR-SEASET-YR TO OR-SEASET-YR.                           05294705
052948     MOVE IR-SEASET-SHRT-NM TO OR-SEASET-SHRT-NM.                 05294805
052949     MOVE IR-DEPT-NBR TO OR-DEPT-NBR.                             05294905
052950     MOVE IR-DERVD-LBL-TYP-CDE TO OR-DERVD-LBL-TYP-CDE.           05295005
052951                                                                  05295102
052960     MOVE PURITM-RMS-PO-SKU-NBR TO OR-SKU-NBR.                    05296002
052970     MOVE ALLPLN-DEST-NBR TO OR-DC-NBR.                           05297002
052980     MOVE MESTDS-STR-NBR TO OR-STORE-NBR.                         05298002
052990     MOVE MESTDS-STR-DISTRO-QTY TO OR-STORE-ALLOC-QTY.            05299002
052992     MOVE PURITM-PO-LNE-NBR TO OR-PO-LNE-NBR.                     05299205
052993     MOVE PURITM-STAT-TMST TO OR-STAT-TMST.                       05299305
052994     MOVE PURITM-CL-NBR TO OR-CL-NBR.                             05299405
052995     MOVE PURITM-UNT-QTY TO OR-LNE-UNT-QTY.                       05299505
052996     MOVE PURITM-STATUS-CDE TO OR-LNE-STATUS-CDE.                 05299605
052997     MOVE PURITM-CNCLD-UNT-QTY TO OR-LNE-CNCLD-UNT-QTY.           05299705
052998     MOVE ALLPLN-CURR-SPLIT-QTY TO OR-DC-SPLIT-QTY.               05299805
052999     MOVE ALLPLN-SPLIT-CRE-DATE TO OR-SPLIT-CRE-DATE.             05299907
053000     MOVE MESTDS-PLAN-NBR TO OR-PLAN-NBR.                         05300005
053100                                                                  05310002
053800     WRITE OUTPUT-RECORD FROM OR-OUTPUT-RECORD.                   05380000
053810                                                                  05381002
054100     ADD +1 TO PV-OUTPUT-WRITTEN.                                 05410000
054200                                                                  05420000
054300                                                                  05430000
055172 9050-READ-INPUT-FILE.                                            05517200
055173                                                                  05517300
055174     READ INPUT-FILE                                              05517400
055175          INTO IR-INPUT-RECORD                                    05517500
055176          AT END                                                  05517600
055177              SET PS-INPUT-EOF TO TRUE.                           05517700
055178                                                                  05517800
055179     IF PS-INPUT-EOF                                              05517900
055180         CONTINUE                                                 05518000
055190     ELSE                                                         05519000
055300         ADD +1 TO PV-INPUT-READ                                  05530000
055400                   PV-INPUT-CHECK-CNT                             05540000
055500         IF  PV-INPUT-CHECK-CNT = 10000                           05550015
055600             MOVE PV-INPUT-READ TO                                05560000
055700                  DP-OUT-CNT                                      05570000
055800             DISPLAY 'PROGRAM PROGRESS READS: '                   05580000
055900                     DP-OUT-CNT                                   05590000
055902             MOVE PV-OUTPUT-WRITTEN TO PV-DISPLAY-FIELD           05590208
055903             DISPLAY 'OUTPUT RECORDS WRITTEN SO FAR:  '           05590308
055904                     PV-DISPLAY-FIELD                             05590408
056000             MOVE +0 TO PV-INPUT-CHECK-CNT                        05600000
056100         END-IF                                                   05610000
056200     END-IF.                                                      05620000
056300                                                                  05630000
061300                                                                  06130000
061400* ************************************************************** *06140000
061500* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *06150000
061600* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *06160000
061700* * SQL ERROR OR WARNING CODE OCCURS.                          * *06170000
061800* ************************************************************** *06180000
061900 9999-DB2-ABEND.                                                  06190000
062000                                                                  06200000
062100     DISPLAY PC-CURRENT-PROGRAM-NAME                              06210000
062200             ' 9999-DB2-ABEND'.                                   06220000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              06230000
062400             ' ** ABEND           **'.                            06240000
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              06250000
062600             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       06260000
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              06270000
062800             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       06280000
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              06290000
063000             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  06300000
063100                                                                  06310000
063200     DISPLAY PC-CURRENT-PROGRAM-NAME                              06320000
063300             ' ** SQLCODE         ** = ' SQLCODE.                 06330000
063400     MOVE SQLCODE TO PV-SQLCODE.                                  06340000
063500     DISPLAY PC-CURRENT-PROGRAM-NAME                              06350000
063600             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          06360000
063700                                                                  06370000
063800     DISPLAY PC-CURRENT-PROGRAM-NAME                              06380000
063900             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            06390000
064000                                                                  06400000
064100                                                                  06410000
064200*----------------------------------------------------------------*06420000
064300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *06430000
064400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *06440000
064500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *06450000
064600* FORMAT.                                                        *06460000
064700*----------------------------------------------------------------*06470000
064800     COPY DPPD004.                                                06480000
064900                                                                  06490000
065000                                                                  06500000
065100*----------------------------------------------------------------*06510000
065200* CALL ABEND                                                     *06520000
065300*----------------------------------------------------------------*06530000
065400     MOVE +4013                  TO ABEND-CODE.                   06540000
065500     CALL 'ILBOABN0' USING ABEND-CODE.                            06550000
065600*                                                                 06560000
