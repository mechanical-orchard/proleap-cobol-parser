       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.             DAKRP103.                                00030075
       AUTHOR.                 JON FIEDLER.                             00040025
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
       DATE-WRITTEN.           JULY 2000.                               00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ***************************************************************** 00090000
      *  PROGRAM NARRATIVE:                                           * 00100000
      *  THIS PROGRAM READS AN EXTRACT FROM THE PROGRAM DAKUT303        00110073
      *  AND CREATES A REPORT OF FUTURE DEBIT ALLOWANCES THAT IS BROKEN 00120066
      *  UP INTO FOUR CATEGORIES.                                       00130066
      *  1) DA'S THAT ARE DUE 0  - 30 DAYS FROM THE CURRENT DATE        00131066
      *  2) DA'S THAT ARE DUE 31 - 60 DAYS FROM THE CURRENT DATE        00132066
      *  3) DA'S THAT ARE DUE 61 - 90 DAYS FROM THE CURRENT DATE        00133066
      *  4) DA'S THAT ARE DUE 91 DAYS OR GREATER FROM THE CURRENT DATE  00134066
      *                                                                 00135066
      *  THIS REPORT ALSO KEEPS TRACK OF TOTAL COST AND RETAIL FOR      00136066
      *  EACH OF THE FOUR CATEGORIES.                                   00137066
      ***************************************************************** 00140000
      *                                                                 00150000
                                                                        00160002
       ENVIRONMENT DIVISION.                                            00170000
                                                                        00180000
       CONFIGURATION SECTION.                                           00190000
                                                                        00200000
       SOURCE-COMPUTER.                        IBM-3090.                00210000
       OBJECT-COMPUTER.                        IBM-3090.                00220000
                                                                        00230000
       INPUT-OUTPUT SECTION.                                            00240000
                                                                        00250000
       FILE-CONTROL.                                                    00260000
                                                                        00270000
           SELECT  DEBIT-ALLOWANCE                                      00280000
               ASSIGN TO INP01.                                         00290000
                                                                        00300000
           SELECT  REPORT-FILE                                          00310000
               ASSIGN RPT01.                                            00320000
                                                                        00330000
       DATA DIVISION.                                                   00350000
                                                                        00370000
       FILE SECTION.                                                    00380000
                                                                        00390069
       FD  DEBIT-ALLOWANCE                                              00400000
           LABEL RECORDS ARE STANDARD                                   00410000
           RECORDING MODE IS F                                          00420000
           BLOCK CONTAINS 0 RECORDS.                                    00430000
       01  DEBIT-ALLOW-REC                PIC X(175).                   00440099
                                                                        00450000
       FD  REPORT-FILE                                                  00460000
           RECORDING MODE F                                             00470000
           LABEL RECORDS OMITTED                                        00480000
           BLOCK CONTAINS  0 RECORDS.                                   00490000
       01  REPORT-RECORD.                                               00500000
           05  REPORT-LINE                PIC X(200).                   00510099
                                                                        00520067
       WORKING-STORAGE SECTION.                                         00550000
                                                                        00560000
       01  ABEND-CODE                     PIC S9(04) VALUE ZERO         00561070
                                                       COMP SYNC.       00562000
                                                                        00563000
       01  PA-PROGRAM-ACCUMULATORS.                                     00564000
           05  PA-LINE-COUNT              PIC S9(03) COMP-3 VALUE 0.    00565070
           05  PA-LINE-NO                 PIC S9(03) COMP-3 VALUE 0.    00566070
           05  PA-PAGE-COUNT              PIC S9(05) COMP-3 VALUE 0.    00567070
           05  PA-TOTAL-READ              PIC S9(09) COMP-3 VALUE 0.    00569070
                                                                        00650000
       01  PC-CONSTANTS.                                                00660000
           05  PC-CALENDAR-ROUTINE        PIC  X(8)  VALUE 'DPKUT500'.  00661095
           05  PC-OPERCO-NBR              PIC  X(02) VALUE '03'.        00670070
           05  PC-MDSELV-DPT              PIC  X(03) VALUE 'DPT'.       00680070
           05  PC-DAKRP103-PGM            PIC  X(08) VALUE 'DAKRP103'.  00700075
           05  PC-NO-INPUT-MSG            PIC  X(80) VALUE              00730070
               '          =====> NO INPUT <====                      '. 00740000
           05  PC-MAX-LINES               PIC S9(03) VALUE 79.          00770070
                                                                        00780000
       01  PS-SWITCHES.                                                 00790000
           05  PS-EOF-EXTRACT-SWITCH      PIC  X(01) VALUE 'N'.         00800070
               88  PS-EOF-EXTRACT                    VALUE 'Y'.         00810070
                                                                        00820000
       01  PV-VARIABLES.                                                00830000
           05  PV-PREV-DEPT-NBR           PIC X(03)  VALUE SPACES.      00840070
           05  PV-PARAGRAPH               PIC X(30)  VALUE SPACES.      00880070
           05  PV-OPERATION-ATTEMPTED     PIC X(40)  VALUE SPACES.      00890070
           05  PV-ABEND-MESSAGE           PIC X(75)  VALUE SPACES.      00900070
           05  PV-DISP-NUMBER             PIC Z,ZZZ,ZZ9.                00950029
           05  PV-DAYS-TILL-DUE           PIC S9(5).                    00990041
               88 DAYS-00-30              VALUES 0  THRU 30.            00990141
               88 DAYS-31-60              VALUES 31 THRU 60.            00990241
               88 DAYS-61-90              VALUES 61 THRU 91.            00990341
               88 DAYS-91                 VALUES 91 THRU 99999.         00990441
      ** PV-D REPRESENTS DETAIL LINE DATA PV-T REPRESENTS TOTALS DATA   00990574
           05  PV-D-COST-AMT-00-30-NUM    PIC S9(9)V99 VALUE ZEROES.    00991084
           05  PV-D-COST-AMT-31-60-NUM    PIC S9(9)V99 VALUE ZEROES.    00992084
           05  PV-D-COST-AMT-61-90-NUM    PIC S9(9)V99 VALUE ZEROES.    00993084
           05  PV-D-COST-AMT-91-NUM       PIC S9(9)V99 VALUE ZEROES.    00994084
           05  PV-D-RETAIL-AMT-00-30-NUM  PIC S9(9)V99 VALUE ZEROES.    00995084
           05  PV-D-RETAIL-AMT-31-60-NUM  PIC S9(9)V99 VALUE ZEROES.    00996084
           05  PV-D-RETAIL-AMT-61-90-NUM  PIC S9(9)V99 VALUE ZEROES.    00997084
           05  PV-D-RETAIL-AMT-91-NUM     PIC S9(9)V99 VALUE ZEROES.    00998084
           05  PV-T-COST-AMT-00-30-NUM    PIC S9(9)V99 VALUE ZEROES.    00999084
           05  PV-T-COST-AMT-31-60-NUM    PIC S9(9)V99 VALUE ZEROES.    00999184
           05  PV-T-COST-AMT-61-90-NUM    PIC S9(9)V99 VALUE ZEROES.    00999284
           05  PV-T-COST-AMT-91-NUM       PIC S9(9)V99 VALUE ZEROES.    00999384
           05  PV-T-RETAIL-AMT-00-30-NUM  PIC S9(9)V99 VALUE ZEROES.    00999484
           05  PV-T-RETAIL-AMT-31-60-NUM  PIC S9(9)V99 VALUE ZEROES.    00999584
           05  PV-T-RETAIL-AMT-61-90-NUM  PIC S9(9)V99 VALUE ZEROES.    00999684
           05  PV-T-RETAIL-AMT-91-NUM     PIC S9(9)V99 VALUE ZEROES.    00999784
           05  PV-TODAYS-DATE.                                          00999874
                10 PV-CURRENT-YEAR        PIC 99.                       00999929
                10 PV-CURRENT-MONTH       PIC 99.                       01000029
                10 PV-CURRENT-DAY         PIC 99.                       01000129
           05  PV-TODAYS-DATE-FORMATTED.                                01000274
                10 PV-CENTURY             PIC 99      VALUE 20.         01000370
                10 PV-YEAR                PIC 99.                       01000429
                10 FILLER                 PIC X       VALUE '-'.        01000570
                10 PV-MONTH               PIC 99.                       01000629
                10 FILLER                 PIC X       VALUE '-'.        01000770
                10 PV-DAY                 PIC 99.                       01000829
           05  PV-SPACE-LINE.                                           01001074
                10 FILLER                 PIC X(80).                    01001174
                                                                        01040000
      ***************************************************************** 01060000
      *  KOHL'S STANDARD FIRST HEADING LINE                             01070000
      ***************************************************************** 01080000
           COPY DPWS200O.                                               01090099
                                                                        01100069
       01  H2-HEADING2.                                                 01110000
           05  FILLER                PIC X(83) VALUE SPACES.            01120099
           05  FILLER                PIC X(40) VALUE                    01130000
           'FUTURE DEBIT ALLOWANCES BY DEPARTMENT'.                     01140060
                                                                        01180000
                                                                        01240000
       01  H4-HEADING4.                                                 01250000
           05  FILLER                PIC X(07) VALUE SPACES.            01260003
           05  FILLER                PIC X(22) VALUE SPACES.            01280070
           05  FILLER                PIC X(32) VALUE                    01290003
           '<---------0 - 30 DAYS--------->'.                           01291003
           05  FILLER                PIC X(32) VALUE                    01292003
           '<--------31 - 60 DAYS--------->'.                           01293003
           05  FILLER                PIC X(32) VALUE                    01294003
           '<--------61 - 90 DAYS--------->'.                           01295003
           05  FILLER                PIC X(32) VALUE                    01296003
           '<----GREATER THAN 91 DAYS----->'.                           01297003
                                                                        01320000
       01  H5-HEADING5.                                                 01330000
           05  FILLER                PIC X(07) VALUE 'DEPT'.            01340003
           05  FILLER                PIC X(05) VALUE 'DEPT '.           01341071
           05  FILLER                PIC X(04) VALUE 'NAME'.            01350003
           05  FILLER                PIC X(21) VALUE SPACES.            01360099
           05  FILLER                PIC X(04) VALUE 'COST'.            01370012
           05  FILLER                PIC X(10) VALUE SPACES.            01390003
           05  FILLER                PIC X(06) VALUE 'RETAIL'.          01400003
           05  FILLER                PIC X(12) VALUE SPACES.            01410003
           05  FILLER                PIC X(04) VALUE 'COST'.            01411012
           05  FILLER                PIC X(10) VALUE SPACES.            01412003
           05  FILLER                PIC X(06) VALUE 'RETAIL'.          01413003
           05  FILLER                PIC X(12) VALUE SPACES.            01414003
           05  FILLER                PIC X(04) VALUE 'COST'.            01415012
           05  FILLER                PIC X(10) VALUE SPACES.            01416003
           05  FILLER                PIC X(06) VALUE 'RETAIL'.          01417003
           05  FILLER                PIC X(12) VALUE SPACES.            01418003
           05  FILLER                PIC X(04) VALUE 'COST'.            01419012
           05  FILLER                PIC X(10) VALUE SPACES.            01420003
           05  FILLER                PIC X(06) VALUE 'RETAIL'.          01430003
           05  FILLER                PIC X(12) VALUE SPACES.            01431003
                                                                        01440000
       01  DL1-DETAIL-LINE-1.                                           01450000
           05  H4-DEPT-NBR           PIC X(3).                          01460004
           05  FILLER                PIC X(4)      VALUE SPACES.        01470004
           05  H4-DEPT-NAME          PIC X(21).                         01480004
           05  DL1-COST-AMT-00-30    PIC ----,---,--9.99                01510093
                                                   VALUE ZERO.          01511008
           05  FILLER                PIC X(01)     VALUE SPACES.        01520004
           05  DL1-RETAIL-AMT-00-30  PIC ----,---,--9.99                01530093
                                                   VALUE ZERO.          01531021
           05  FILLER                PIC X(01)     VALUE SPACES.        01540000
           05  DL1-COST-AMT-31-60    PIC ----,---,--9.99                01541093
                                                   VALUE ZERO.          01541108
           05  FILLER                PIC X(01)     VALUE SPACES.        01542004
           05  DL1-RETAIL-AMT-31-60  PIC ----,---,--9.99                01543093
                                                   VALUE ZERO.          01543108
           05  FILLER                PIC X(01)     VALUE SPACES.        01544004
           05  DL1-COST-AMT-61-90    PIC ----,---,--9.99                01545093
                                                   VALUE ZERO.          01545108
           05  FILLER                PIC X(01)     VALUE SPACES.        01546004
           05  DL1-RETAIL-AMT-61-90  PIC ----,---,--9.99                01547093
                                                   VALUE ZERO.          01547108
           05  FILLER                PIC X(01)     VALUE SPACES.        01548004
           05  DL1-COST-AMT-91       PIC ----,---,--9.99                01549093
                                                   VALUE ZERO.          01549108
           05  FILLER                PIC X(01)     VALUE SPACES.        01549204
           05  DL1-RETAIL-AMT-91     PIC ----,---,--9.99                01549393
                                                   VALUE ZERO.          01549408
           05  FILLER                PIC X(01)     VALUE SPACES.        01549504
                                                                        01550000
       01 TOTAL-DIVIDER.                                                01551004
           05  FILLER                PIC X(28)     VALUE SPACES.        01552004
           05  FILLER                PIC X(50)     VALUE                01553004
           '--------------------------------------------------'.        01554004
           05  FILLER                PIC X(50)     VALUE                01555004
           '--------------------------------------------------'.        01556004
           05  FILLER                PIC X(27)     VALUE                01557004
           '---------------------------'.                               01558094
                                                                        01559004
       01  TL1-TOTAL-LINE-1.                                            01560000
           05  FILLER                PIC X(5)      VALUE 'TOTAL'.       01561004
           05  FILLER                PIC X(23)     VALUE SPACES.        01570004
           05  TL1-COST-AMT-00-30    PIC ----,---,--9.99                01600093
                                                   VALUE ZERO.          01601008
           05  FILLER                PIC X(01)     VALUE SPACES.        01610004
           05  TL1-RETAIL-AMT-00-30  PIC ----,---,--9.99                01620093
                                                   VALUE ZERO.          01621008
           05  FILLER                PIC X(01)     VALUE SPACES.        01630000
           05  TL1-COST-AMT-31-60    PIC ----,---,--9.99                01631093
                                                   VALUE ZERO.          01631108
           05  FILLER                PIC X(01)     VALUE SPACES.        01632004
           05  TL1-RETAIL-AMT-31-60  PIC ----,---,--9.99                01633093
                                                   VALUE ZERO.          01633108
           05  FILLER                PIC X(01)     VALUE SPACES.        01634004
           05  TL1-COST-AMT-61-90    PIC ----,---,--9.99                01635092
                                                   VALUE ZERO.          01635108
           05  FILLER                PIC X(01)     VALUE SPACES.        01636004
           05  TL1-RETAIL-AMT-61-90  PIC ----,---,---.99                01637092
                                                   VALUE ZERO.          01637108
           05  FILLER                PIC X(01)     VALUE SPACES.        01638004
           05  TL1-COST-AMT-91       PIC ----,---,--9.99                01639092
                                                   VALUE ZERO.          01639108
           05  FILLER                PIC X(01)     VALUE SPACES.        01639204
           05  TL1-RETAIL-AMT-91     PIC ----,---,--9.99                01639392
                                                   VALUE ZERO.          01639408
           05  FILLER                PIC X(01)     VALUE SPACES.        01639504
                                                                        01640000
      ***************************************************************** 01650000
      *  INPUT DEBIT ALLOWANCE RECORD LAYOUT                          * 01660000
      ***************************************************************** 01670000
           COPY DARD102.                                                01680073
                                                                        01690000
      ***************************************************************   01691033
      *    CALENDAR ROUTINE WORK AREA.                                  01692033
      ***************************************************************   01693033
           COPY DPWS500.                                                01694033
                                                                        01695013
015300****************************************************************  01700000
015400*  DCLGEN FOR THE MERCHANDISE AREA TABLE                          01710068
015500****************************************************************  01720000
015600     EXEC SQL                                                     01730000
015700         INCLUDE TMDSEAR                                          01740009
015800     END-EXEC.                                                    01750000
015900                                                                  01760000
018800****************************************************************  01770000
018900*  COMMUNICATION AREAS FOR DB2                                    01780000
019000****************************************************************  01790000
019100     EXEC SQL                                                     01800000
019200         INCLUDE SQLCA                                            01810000
019300     END-EXEC.                                                    01820000
019400                                                                  01830000
046800****************************************************              01840000
046900*  ERROR MESSAGE AREA FOR DB2                      *              01850000
047000****************************************************              01860000
047100     COPY DPWS004.                                                01870000
047200                                                                  01871000
                                                                        01872069
       PROCEDURE DIVISION.                                              01873000
      ******************************************************************01874068
      *  MAIN PROCEDURE                                                 01874168
      ******************************************************************01874268
       0000-DAKRP103.                                                   01875075
                                                                        01876000
           PERFORM 1000-INITIALIZE                                      01877000
                                                                        01878000
           PERFORM 2000-PROCESS-EXTRACT                                 01879000
               UNTIL PS-EOF-EXTRACT.                                    01880000
                                                                        01890000
           PERFORM 9000-EOJ.                                            01900000
                                                                        01910000
           GOBACK.                                                      01920000
                                                                        01930000
      ***************************************************************** 01940068
      * FILL REPORT HEADING & PERFORM INITIAL READS                     01941068
      ***************************************************************** 01942068
       1000-INITIALIZE.                                                 01950000
                                                                        01960000
           OPEN INPUT  DEBIT-ALLOWANCE                                  01970000
           OPEN OUTPUT REPORT-FILE.                                     01980000
                                                                        01990000
           PERFORM 8000-READ-EXTRACT.                                   02000000
                                                                        02010000
           ACCEPT PV-TODAYS-DATE FROM DATE.                             02011029
           MOVE PV-CURRENT-YEAR          TO PV-YEAR.                    02012029
           MOVE PV-CURRENT-MONTH         TO PV-MONTH.                   02013029
           MOVE PV-CURRENT-DAY           TO PV-DAY.                     02014029
                                                                        02015029
           MOVE FUNCTION CURRENT-DATE (3:2)  TO DP200O-RUN-YEAR.        02020099
           MOVE FUNCTION CURRENT-DATE (5:2)  TO DP200O-RUN-MONTH.       02030099
           MOVE FUNCTION CURRENT-DATE (7:2)  TO DP200O-RUN-DAY.         02040099
           MOVE FUNCTION CURRENT-DATE (9:2)  TO DP200O-RUN-HOUR.        02050099
           MOVE FUNCTION CURRENT-DATE (11:2) TO DP200O-RUN-MINUTE.      02060099
           MOVE PC-DAKRP103-PGM              TO DP200O-PROGRAM-NAME.    02070099
           MOVE 1                            TO DP200O-REPORT-NUMBER.   02080099
                                                                        02090000
           PERFORM 4000-WRITE-REPORT-HEADING.                           02100000
           IF PS-EOF-EXTRACT                                            02110000
               DISPLAY 'NO DA INPUT -- REPORT WILL BE EMPTY'            02120000
           ELSE                                                         02130000
               PERFORM 4200-NEW-DEPARTMENT                              02140008
           END-IF.                                                      02150000
                                                                        02160000
      ****************************************************************  02161068
      * THIS PROCEDURE DOES THE MAIN PROCESSING OF THE REPORT. IT       02162068
      * FIRST CHECKS IF THERE IS A NEW DEPARTMENT, IF IT IS A NEW       02163068
      * DEPARTMENT IT WRITES A REPORT LINE AND PROCESSES THE NEW        02164068
      * DEPARTMENTS INFORMATION. IF IT IS THE SAME DEPARTMENT IT        02164168
      * PROCESSES THE DEBIT ALLOWANCE DETAIL INFORMATION.               02165068
      ****************************************************************  02167068
       2000-PROCESS-EXTRACT.                                            02170000
                                                                        02180000
           IF DA102-DEPT-NBR =  PV-PREV-DEPT-NBR                        02190073
               CONTINUE                                                 02200000
           ELSE                                                         02210000
               PERFORM 5000-WRITE-REPORT-LINE                           02220008
               PERFORM 4200-NEW-DEPARTMENT                              02230008
           END-IF.                                                      02240000
                                                                        02250000
           PERFORM 5500-FIND-DAYS-TILL-DUE.                             02261008
                                                                        02262044
           IF DAYS-00-30                                                02263045
               ADD DA102-CST-AMT TO PV-D-COST-AMT-00-30-NUM             02264073
               ADD DA102-RTL-AMT TO PV-D-RETAIL-AMT-00-30-NUM           02265073
               ADD DA102-CST-AMT TO PV-T-COST-AMT-00-30-NUM             02266073
               ADD DA102-RTL-AMT TO PV-T-RETAIL-AMT-00-30-NUM           02267073
           END-IF.                                                      02268045
                                                                        02268141
           IF DAYS-31-60                                                02269046
               ADD DA102-CST-AMT TO PV-D-COST-AMT-31-60-NUM             02269173
               ADD DA102-RTL-AMT TO PV-D-RETAIL-AMT-31-60-NUM           02269273
               ADD DA102-CST-AMT TO PV-T-COST-AMT-31-60-NUM             02269373
               ADD DA102-RTL-AMT TO PV-T-RETAIL-AMT-31-60-NUM           02269473
           END-IF.                                                      02270045
                                                                        02271041
           IF DAYS-61-90                                                02280041
               ADD DA102-CST-AMT TO PV-D-COST-AMT-61-90-NUM             02290073
               ADD DA102-RTL-AMT TO PV-D-RETAIL-AMT-61-90-NUM           02300073
               ADD DA102-CST-AMT TO PV-T-COST-AMT-61-90-NUM             02310073
               ADD DA102-RTL-AMT TO PV-T-RETAIL-AMT-61-90-NUM           02320073
           END-IF.                                                      02321041
                                                                        02321141
           IF DAYS-91                                                   02321241
               ADD DA102-CST-AMT TO PV-D-COST-AMT-91-NUM                02321373
               ADD DA102-RTL-AMT TO PV-D-RETAIL-AMT-91-NUM              02321473
               ADD DA102-CST-AMT TO PV-T-COST-AMT-91-NUM                02321573
               ADD DA102-RTL-AMT TO PV-T-RETAIL-AMT-91-NUM              02321673
           END-IF.                                                      02324008
                                                                        02325008
           PERFORM 8000-READ-EXTRACT.                                   02390000
                                                                        02400000
      ******************************************************************02410068
      *  THIS PROCEDURE PRINTS THE HEADING LINES.                       02412068
      ******************************************************************02413068
       4000-WRITE-REPORT-HEADING.                                       02420000
                                                                        02470000
           MOVE 0                               TO PA-LINE-COUNT        02490014
           ADD 1                                TO PA-PAGE-COUNT.       02500014
           MOVE PA-PAGE-COUNT                   TO DP200O-PAGE-NUMBER.  02510099
           MOVE DP200O-STANDRD-HEADER-200-COLS TO REPORT-RECORD.        02520099
           WRITE REPORT-RECORD                                          02530000
                   AFTER ADVANCING PAGE.                                02540000
                                                                        02540158
           MOVE H2-HEADING2  TO REPORT-RECORD.                          02541058
           WRITE REPORT-RECORD                                          02542058
               AFTER ADVANCING 1 LINE.                                  02543058
                                                                        02550000
           MOVE PV-SPACE-LINE TO REPORT-RECORD.                         02550161
           WRITE REPORT-RECORD                                          02550261
               AFTER ADVANCING 1 LINE.                                  02550361
                                                                        02550461
           MOVE H4-HEADING4    TO REPORT-RECORD.                        02551008
           WRITE REPORT-RECORD                                          02552008
               AFTER ADVANCING 3 LINES.                                 02553058
                                                                        02553161
           MOVE H5-HEADING5    TO REPORT-RECORD.                        02554008
           WRITE REPORT-RECORD                                          02555008
               AFTER ADVANCING 1 LINES.                                 02556008
                                                                        02650000
           MOVE 5                              TO PA-LINE-NO.           02660008
                                                                        02661076
      ******************************************************************02662068
      * THIS PROCEDURE PROCESSES A NEW DEPARTMENT.                      02663068
      ******************************************************************02664068
       4200-NEW-DEPARTMENT.                                             02670008
                                                                        02680000
           IF PA-LINE-NO > PC-MAX-LINES                                 02690000
               PERFORM 4000-WRITE-REPORT-HEADING                        02700000
           END-IF.                                                      02710000
                                                                        02720000
           MOVE DA102-DEPT-NBR  TO H4-DEPT-NBR.                         02730073
           PERFORM 7000-RETRIEVE-DEPT-NAME.                             02740008
           MOVE MDSEAR-DESC    TO H4-DEPT-NAME.                         02750000
           MOVE DA102-DEPT-NBR TO PV-PREV-DEPT-NBR.                     02820073
                                                                        02850000
      ******************************************************************02851068
      * THIS PROCEDURE WRITES A DEBIT ALLOWANCE DETAIL LINE TO THE      02852068
      * REPORT OUTPUT AND RESETS VARIABLES FOR A NEW DEPARTMENT.        02853068
      ******************************************************************02854068
       5000-WRITE-REPORT-LINE.                                          02860000
                                                                        02870000
           IF PA-LINE-NO > PC-MAX-LINES                                 02880000
               PERFORM 4000-WRITE-REPORT-HEADING                        02890000
           END-IF.                                                      02910000
                                                                        02910127
           MOVE PV-D-COST-AMT-00-30-NUM   TO DL1-COST-AMT-00-30.        02911029
           MOVE PV-D-RETAIL-AMT-00-30-NUM TO DL1-RETAIL-AMT-00-30.      02912029
           MOVE PV-T-COST-AMT-00-30-NUM   TO TL1-COST-AMT-00-30.        02913049
           MOVE PV-T-RETAIL-AMT-00-30-NUM TO TL1-RETAIL-AMT-00-30.      02914049
                                                                        02920000
           MOVE PV-D-COST-AMT-31-60-NUM   TO DL1-COST-AMT-31-60.        02921029
           MOVE PV-D-RETAIL-AMT-31-60-NUM TO DL1-RETAIL-AMT-31-60.      02922029
           MOVE PV-T-COST-AMT-31-60-NUM   TO TL1-COST-AMT-31-60.        02923049
           MOVE PV-T-RETAIL-AMT-31-60-NUM TO TL1-RETAIL-AMT-31-60.      02924049
                                                                        02925027
           MOVE PV-D-COST-AMT-61-90-NUM   TO DL1-COST-AMT-61-90.        02926029
           MOVE PV-D-RETAIL-AMT-61-90-NUM TO DL1-RETAIL-AMT-61-90.      02927029
           MOVE PV-T-COST-AMT-61-90-NUM   TO TL1-COST-AMT-61-90.        02928049
           MOVE PV-T-RETAIL-AMT-61-90-NUM TO TL1-RETAIL-AMT-61-90.      02929049
                                                                        02929127
           MOVE PV-D-COST-AMT-91-NUM      TO DL1-COST-AMT-91.           02929229
           MOVE PV-D-RETAIL-AMT-91-NUM    TO DL1-RETAIL-AMT-91.         02929329
           MOVE PV-T-COST-AMT-91-NUM      TO TL1-COST-AMT-91.           02929472
           MOVE PV-T-RETAIL-AMT-91-NUM    TO TL1-RETAIL-AMT-91.         02929572
                                                                        02929627
           WRITE REPORT-RECORD FROM DL1-DETAIL-LINE-1                   02930000
                  AFTER ADVANCING 1 LINES.                              02940000
           ADD 1 TO PA-LINE-NO.                                         02950000
                                                                        02960000
           MOVE 0 TO PV-D-COST-AMT-00-30-NUM.                           02970048
           MOVE 0 TO PV-D-RETAIL-AMT-00-30-NUM.                         02980048
           MOVE 0 TO PV-D-COST-AMT-31-60-NUM.                           02981048
           MOVE 0 TO PV-D-RETAIL-AMT-31-60-NUM.                         02982048
           MOVE 0 TO PV-D-COST-AMT-61-90-NUM.                           02990048
           MOVE 0 TO PV-D-RETAIL-AMT-61-90-NUM.                         03000048
           MOVE 0 TO PV-D-COST-AMT-91-NUM.                              03010048
           MOVE 0 TO PV-D-RETAIL-AMT-91-NUM.                            03020048
                                                                        03110000
      ******************************************************************03111068
      * THIS PROCEDURE FINDS THE TOTAL DAYS BETWEEN THE DUE DATE AND    03112068
      * THE CURRENT DATE BY CALLING THE CALENDAR ROUTINE.               03113068
      ******************************************************************03114068
       5500-FIND-DAYS-TILL-DUE.                                         03120008
                                                                        03121017
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03122034
                                                                        03123031
           ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          03124031
                                                                        03125031
           SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      03126031
           SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     03127031
           MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9                        03128031
                          DPG51-INCR-DECR-BUS-DAYS-9.                   03129031
           SET DPG52-LK-DTE-ISO TO TRUE.                                03129131
           MOVE DA102-DUE-DTE TO DPG52-LK-DATE-INPUT.                   03129273
           SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            03129355
           MOVE PV-TODAYS-DATE-FORMATTED TO DPG53-LK-CMPR-DATE-INPUT.   03129457
           SET DPG53-LK-CMPR-DTE-ISO-FMT TO TRUE.                       03129556
                                                                        03129657
           CALL PC-CALENDAR-ROUTINE                                     03129747
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               03129847
                                                                        03129947
            EVALUATE TRUE                                               03130032
                WHEN DPG54-SEVERE-ERROR                                 03130132
                    DISPLAY '** ABEND **'                               03130232
                    DISPLAY '** PGM = DAKUT303'                         03130373
                    DISPLAY '** 5500-SUBTRACT-DAYS'                     03130450
                    DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'  03131032
                    DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'  03132032
                    DISPLAY '** ERROR MESSAGE = '                       03133032
                              DPG54-ERROR-MESSAGE                       03134032
                    DISPLAY '** DPG51 = ' DPG51                         03135032
                    DISPLAY '** DPG52 = ' DPG52                         03136032
                    DISPLAY '** DPG53 = ' DPG53                         03137032
                    DISPLAY '** DPG54 = ' DPG54                         03138032
                    MOVE +4003 TO ABEND-CODE                            03139034
                    CALL 'ILBOABN0' USING ABEND-CODE                    03139134
                WHEN OTHER                                              03139232
                     CONTINUE                                           03139332
            END-EVALUATE.                                               03139432
                                                                        03139532
           MOVE DPG55-DAYS-DIFFERENCE TO PV-DAYS-TILL-DUE.              03139632
           DISPLAY 'DAYS DIFFERENCE= ' PV-DAYS-TILL-DUE.                03139732
                                                                        03139832
      ******************************************************************03139968
      * THIS PROCEDURE WRITES THE REPORT TOTALS TO THE REPORT OUTPUT.   03140068
      ******************************************************************03140168
       5600-WRITE-RPT-TOTALS.                                           03141017
           WRITE REPORT-RECORD FROM TL1-TOTAL-LINE-1                    03144000
                  AFTER ADVANCING 1 LINE.                               03145008
                                                                        03146000
046500                                                                  03147000
038000***************************************************************** 03148000
038100* THIS PROCEDURE GETS THE DEPARTMENT NAME.                        03149068
038200***************************************************************** 03150000
038300 7000-RETRIEVE-DEPT-NAME.                                         03160008
038400                                                                  03170000
038500     EXEC SQL                                                     03200000
039200        SELECT MDSEAR_DESC                                        03210000
040300        INTO  :MDSEAR-DESC                                        03220000
040800         FROM TMDSEAR                                             03230000
041500        WHERE OPERCO_NBR = :PC-OPERCO-NBR                         03240000
041800          AND MDSELV_CDE = :PC-MDSELV-DPT                         03250000
042300          AND DEPT_NBR   = :DA102-DEPT-NBR                        03260073
                AND CURRENT DATE >= STRT_DTE                            03270051
                AND CURRENT DATE <= END_DTE                             03280051
044400     END-EXEC.                                                    03290000
044500                                                                  03300000
044600     EVALUATE TRUE                                                03310000
044700         WHEN SQLCODE = ZERO                                      03320000
044800             CONTINUE                                             03330000
044900         WHEN SQLCODE = +100                                      03340000
045100             DISPLAY ' '                                          03350000
045200             DISPLAY 'MBS INFO NOT FOUND FOR '                    03360000
 45300                    'DEPT ' MDSEAR-DEPT-NBR                       03370000
                   MOVE 'MISSING DEPT DESC' TO MDSEAR-DESC              03380000
045800         WHEN OTHER                                               03390000
045900             MOVE '7000-RETRIEVE-DEPT-NAME'                       03400082
046000                                    TO PV-PARAGRAPH               03410000
046100             MOVE 'SELECT ROW FROM TMDSEAR'                       03420082
046200                                    TO PV-OPERATION-ATTEMPTED     03430000
046300             PERFORM 9999-ABEND                                   03440000
046400     END-EVALUATE.                                                03450000
046500******************************************************************03460069
      * THIS PROCEDURE READS A LINE FROM THE EXTRACT FILE.              03461069
      ******************************************************************03462069
       8000-READ-EXTRACT.                                               03470000
           READ DEBIT-ALLOWANCE INTO DA102-REC                          03480073
             AT END                                                     03490077
               SET PS-EOF-EXTRACT           TO TRUE                     03500000
             NOT AT END                                                 03510077
               ADD 1                        TO PA-TOTAL-READ            03520000
           END-READ.                                                    03530000
                                                                        03540000
      *************************************************************     03550000
      * THIS PROCEDURE PERFORMS THE END OF JOB TASKS, WHICH INCLUDE     03560069
      * PROCESSING THE LAST DEPARTMENTS INFORMATION AND WRITING         03570069
      * THE TOTALS FOR THE FOUR DEBIT ALLOWANCE CATEGORIES IN THE       03580069
      * REPORT.                                                         03590069
      *************************************************************     03610000
       9000-EOJ.                                                        03620000
                                                                        03630000
           IF PA-TOTAL-READ = ZERO                                      03640000
              WRITE REPORT-RECORD FROM PC-NO-INPUT-MSG                  03650000
                    AFTER ADVANCING 5 LINES                             03660000
           ELSE                                                         03670000
               PERFORM  5000-WRITE-REPORT-LINE                          03671063
               WRITE REPORT-RECORD FROM TOTAL-DIVIDER                   03680008
                    AFTER ADVANCING 1 LINE                              03681008
               PERFORM 5600-WRITE-RPT-TOTALS                            03690000
           END-IF.                                                      03700000
                                                                        03710000
           CLOSE DEBIT-ALLOWANCE                                        03750000
                 REPORT-FILE.                                           03760000
                                                                        03770000
           DISPLAY SPACES.                                              03780000
           MOVE PA-TOTAL-READ        TO PV-DISP-NUMBER.                 03790000
           DISPLAY 'RECS READ    =    ' PV-DISP-NUMBER.                 03800000
                                                                        03810000
       9999-ABEND.                                                      03820000
      ******************************************************************03830000
      *   9999-ABEND.                                                  *03840000
      *      ERROR ABEND ROUTINE                                       *03850000
      ******************************************************************03860000
                                                                        03870000
           MOVE +4013                 TO ABEND-CODE.                    03880000
           DISPLAY '**  ABEND     **'.                                  03890000
           DISPLAY '**  PROGRAM   ** => ' PC-DAKRP103-PGM.              03900075
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH.                 03910000
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.       03920000
                                                                        03930000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         03940000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        03950000
                                                                        03960000
           COPY DPPD004.                                                03970000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03980000
