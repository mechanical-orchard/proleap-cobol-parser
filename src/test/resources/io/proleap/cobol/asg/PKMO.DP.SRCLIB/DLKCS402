000010 TITLE 'TEMP ASSOCIATE UPDATE'.                                   00001000
000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    DLKCS402.                                         00020000
000300 AUTHOR.        THERESE RAMSEYER.                                 00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  JANUARY 2004.                                     00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*----------------------------------------------------------------*00080000
000900*                                                                *00090000
001000*    TRANID      - D402                                          *00100000
001100*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2               *00110000
001200*    DESCRIPTION - TEMP ASSOC UPDATE PROGRAM                     *00120000
001300*    MAPSET      - DLKM402                                       *00130000
001400*                                                                *00140000
001500*    ALLOWS FOR UPDATE OF TEMP ASSOCIATE INFORMATION             *00150000
001600*                                                                *00160000
001610*    NAVIGATION: THIS SCREEN IS ENTERED FROM THE TEMP ASSOC LIST *00161000
001620*                                                                *00162000
001700*----------------------------------------------------------------*00170000
009461* CHANGED 10/24/2022    BY BOB MCASEY      WR: CHG0279137         00170102
009491* ADD COPYBOOK DPWS930 CHANGE CICS ARCHITECTURE CALL TO           00170202
009491* TO USE CICS ARCHITECTURE CA                                     00170302
001700*----------------------------------------------------------------*00171002
001800                                                                  00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 DATA DIVISION.                                                   00200000
002100/                                                                 00210000
002200 WORKING-STORAGE SECTION.                                         00220000
002300                                                                  00230000
002400 01  DK-DB2-KEYS.                                                 00240000
002500     05  DK-USER-CODE                 PIC  X(08) VALUE SPACE.     00250000
002600     05  DK-ADDED-BY-DC-NBR           PIC  9(04) VALUE 0.         00260000
002700                                                                  00270000
002800                                                                  00280000
002900 01  PA-PROGRAM-ACCUMULATORS.                                     00290000
003000     05  PA-INVOICED-COUNT            PIC S9(09) VALUE +0         00300000
003100                                                 COMP-3.          00310000
003200     05  PA-AP-VERIFIED-COUNT         PIC S9(09) VALUE +0         00320000
003300                                                 COMP-3.          00330000
003400                                                                  00340000
003500 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-TRANS-ID                  PIC X(04)  VALUE 'D402'.    00360000
003700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'DLKCS402'.00370000
003800     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'DLK402  '.00380000
003900     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'DLKM402 '.00390000
004000     05  PC-CURRENT-DATE          PIC X(10) VALUE SPACE.          00400000
004100     05  PC-N                         PIC X(01)  VALUE 'N'.       00410000
004200     05  PC-Y                         PIC X(01)  VALUE 'Y'.       00420000
004300     05  PC-APPL-MAP                  PIC S9(04) VALUE  +1        00430000
004400                                                 COMP.            00440000
004500     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00450000
004600                                                 COMP.            00460000
004700     05  PC-INTER-APPL-CODES.                                     00470000
004800         10  PC-INTER-APPL-CRIT-DETAIL PIC X(01) VALUE '1'.       00480000
004900         10  PC-INTER-APPL-LIST        PIC X(01) VALUE '2'.       00490000
005000         10  PC-INTER-APPL-ADD-TEMP    PIC X(01) VALUE '3'.       00500000
005100                                                                  00510000
005200*---------------------------------------------------------------* 00520000
005300* SYSTEM MESSAGES                                               * 00530000
005400*---------------------------------------------------------------* 00540000
005500     05  PC-TSYMSG-NUMBERS.                                       00550000
005600         10  PC-TSYMSG-00005          PIC 9(05)  VALUE 00005.     00560000
005700         10  PC-TSYMSG-00057          PIC 9(05)  VALUE 00057.     00570000
005800         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00580000
005900         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     00590000
006000         10  PC-TSYMSG-00083          PIC 9(05)  VALUE 00083.     00600000
006100         10  PC-TSYMSG-00148          PIC 9(05)  VALUE 00148.     00610000
006200         10  PC-TSYMSG-00330          PIC 9(05)  VALUE 00330.     00620000
006300         10  PC-TSYMSG-00737          PIC 9(05)  VALUE 00737.     00630000
006400         10  PC-TSYMSG-00789          PIC 9(05)  VALUE 00789.     00640000
006500         10  PC-TSYMSG-00984          PIC 9(05)  VALUE 00984.     00650000
006600         10  PC-TSYMSG-01090          PIC 9(05)  VALUE 01090.     00660000
006601*                                                                 00660100
006610         10  PC-TSYMSG-03133          PIC 9(05)  VALUE 03133.     00661000
006700* HIGHLIGHTED FIELDS ARE IN ERROR - CORRECT AND RESUBMIT UPDATE   00670000
006800*                                                         FUNCTION00680000
006900         10  PC-TSYMSG-03178          PIC 9(05)  VALUE 03178.     00690000
007000                                                                  00700000
007100 01  PS-PROGRAM-SWITCHES.                                         00710000
007200     05  PS-ERROR-SW                  PIC X(01)   VALUE 'N'.      00720000
007300         88  PS-ERROR                             VALUE 'Y'.      00730000
007400         88  PS-NO-ERROR                          VALUE 'N'.      00740000
007500     05  PS-LIST-END-SW               PIC X(01)   VALUE 'N'.      00750000
007600         88  PS-LIST-END                          VALUE 'Y'.      00760000
007700         88  PS-NO-LIST-END                       VALUE 'N'.      00770000
007800     05  PS-SOFT-ABORT-ERROR-SW       PIC  X(01)  VALUE 'N'.      00780000
007900         88  PS-SOFT-ABORT-ERROR                  VALUE 'Y'.      00790000
008000         88  PS-NO-SOFT-ABORT-ERROR               VALUE 'N'.      00800000
008010     05  PS-UPDATE-SW                 PIC  X(01)  VALUE 'N'.      00801000
008020         88  PS-UPDATE-PERFORMED-YES              VALUE 'Y'.      00802000
008030         88  PS-UPDATE-PERFORMED-NO               VALUE 'N'.      00803000
008100                                                                  00810000
008200 01  PV-PROGRAM-VARIABLES.                                        00820000
008300     05  PV-DPKUT038                  PIC X(08)  VALUE 'DPKUT038'.00830000
008400     05  PV-DPKUT038-CA-LENGTH        PIC S9(04) VALUE +1237      00840000
008500                                                 COMP.            00850000
008600     05  PV-CICS-RESP                 PIC S9(04) VALUE +0         00860000
008700                                                 COMP SYNC.       00870000
008800     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00880000
008900                                                 COMP SYNC.       00890000
009000     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         00900000
009100                                                 COMP-3.          00910000
009200     05  PV-CURRENT-DATE              PIC X(06)  VALUE SPACE.     00920000
009300     05  PV-DATE-USA                  PIC X(10)  VALUE SPACE.     00930000
009400     05  PV-TIME-ISO                  PIC X(08)  VALUE SPACE.     00940000
009500     05  PV-DB2-TIMESTAMP             PIC  X(26).                 00950000
009600     05  PV-ADDED-BY-NAME             PIC  X(30).                 00960000
009700     05  PV-ADDED-BY-DC-NAME          PIC  X(30).                 00970000
009800     05  PV-OPER-UNT-ID               PIC 9(04).                  00980000
009900     05  PV-OPER-UNT-ID-X REDEFINES                               00990000
010000         PV-OPER-UNT-ID               PIC X(04).                  01000000
010100     05  PV-NULL-IND                  PIC S9(04)  VALUE +0        01010000
010200                                                  COMP SYNC.      01020000
010300                                                                  01030000
010400     05  PV-SOFT-ABORT-MSG.                                       01040000
010500         10  FILLER            PIC X(12) VALUE ' DLKCS402 - '.    01050000
010600         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01060000
010700         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01070000
010800         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01080000
010900         10  PV-SOFT-PARAGRAPH PIC X(30).                         01090000
011000     05  PV-CICS-MSG-AREA2            PIC  X(100) VALUE SPACE.    01100000
011100     05  PV-COMMAREA-LENGTH           PIC S9(04) COMP VALUE ZERO. 01110000
011200                                                                  01120000
011300/                                                                 01130000
011400*----------------------------------------------------------------*01140000
011500*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *01150000
011600*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *01160000
011700*----------------------------------------------------------------*01170000
011800                                                                  01180000
011900     COPY DLWS008.                                                01190000
012000/                                                                 01200000
012100                                                                  01210000
012200*----------------------------------------------------------------*01220000
012300*    MAP LAYOUT                                                  *01230000
012400*----------------------------------------------------------------*01240000
012500                                                                  01250000
012600     COPY DLKM402.                                                01260000
012700                                                                  01270000
012800/                                                                 01280000
012900*----------------------------------------------------------------*01290000
013000**  ASSOCIATE INFO SUBROUTINE PARAMETERS                          01300000
013100*----------------------------------------------------------------*01310000
013200     COPY XLWS067.                                                01320000
013300                                                                  01330000
013400/                                                                 01340000
013500*----------------------------------------------------------------*01350000
013600*    ATTRIBUTE SETTINGS COPYBOOK.                                *01360000
013700*----------------------------------------------------------------*01370000
013800                                                                  01380000
013900     COPY DPWS015.                                                01390000
014000                                                                  01400000
014100/                                                                 01410000
014200*----------------------------------------------------------------*01420000
014300*    FUNCTION KEYS COPYBOOK                                      *01430000
014400*----------------------------------------------------------------*01440000
014500                                                                  01450000
014600     COPY DPWS016.                                                01460000
014700                                                                  01470000
014800/                                                                 01480000
014900*----------------------------------------------------------------*01490000
015000*    THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHIT.   *01500000
015100*    APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.       *01510000
015200*----------------------------------------------------------------*01520000
015300     COPY DPWS030.                                                01530000
1022RM     COPY DPWS930.                                                01531001
015400                                                                  01540000
015500/                                                                 01550000
015600*----------------------------------------------------------------*01560000
015700*    STANDARD COMMAREA.                                          *01570000
015800*----------------------------------------------------------------*01580000
015900                                                                  01590000
016000     COPY DPWS020.                                                01600000
016100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01610000
016200                                                                  01620000
016300*----------------------------------------------------------------*01630000
016400*    INTER-APPLICATION COMMAREA.                                 *01640000
016500*----------------------------------------------------------------*01650000
016600                                                                  01660000
016700         10  INTER-APPL-COMM-AREA PIC X(200).                     01670000
016800     COPY DLWS002.                                                01680000
016900                                                                  01690000
017000*----------------------------------------------------------------*01700000
017100*    SPECIFIC COMMMAREA FOR RCKCS223.                            *01710000
017200*----------------------------------------------------------------*01720000
017300         10  ASC-SPECIFIC-COMMAREA.                               01730000
017400             15  ASC-INT-APPL-FORMAT-IND   PIC X(01).             01740000
017500             15  ASC-USE-SELECTION-QUEUE-IND                      01750000
017600                                           PIC X(01).             01760000
017700                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        01770000
017800             15  ASC-SEL-QUEUE-NAME        PIC X(08).             01780000
017900             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     01790000
018000             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01800000
018100                                           PIC S9(09) COMP-3.     01810000
018200             15  ASC-SEL-SUB               PIC S9(04) COMP.       01820000
018300             15  ASC-SEL-ITEM              PIC S9(04) COMP.       01830000
018400             15  ASC-MULT-SHIP-SW          PIC X(01).             01840000
018500                 88  ASC-MULT-SHIP               VALUE 'Y'.       01850000
018600                                                                  01860000
018700             15  ASC-KEY-FIELDS.                                  01870000
018800                 20  ASC-KEY-USER-CODE       PIC  X(08).          01880000
018900                 20  ASC-KEY-ADDED-BY-DC-NBR PIC  9(04).          01890000
019000                                                                  01900000
019100             15  ASC-SCREEN-FIELDS.                               01910000
019200                 20  ASC-FIRST-NAME          PIC X(20).           01920000
019300                 20  ASC-LAST-NAME           PIC X(30).           01930000
019400                 20  ASC-SIGNON-USERID       PIC X(08).           01940000
019500                 20  ASC-USERID              PIC X(08).           01950000
019510                 20  ASC-ADDED-BY-ID         PIC X(08).           01951000
019600                 20  ASC-ADDED-BY-DC-NAME    PIC X(30).           01960000
019700                 20  ASC-ADDED-BY-NAME       PIC X(30).           01970000
019800                 20  ASC-DATE-ADDED          PIC X(10).           01980000
019900                 20  ASC-TIME-ADDED          PIC X(08).           01990000
020000                 20  ASC-ACTIVE-USER         PIC X(01).           02000000
020100                                                                  02010000
020200/                                                                 02020000
020300*----------------------------------------------------------------*02030000
020400*    ABEND PROCESSING COPYBOOK.                                  *02040000
020500*----------------------------------------------------------------*02050000
020600                                                                  02060000
020700     COPY DPWS013.                                                02070000
020800                                                                  02080000
020900/                                                                 02090000
021000*---------------------------------------------------------------* 02100000
021100*    DB2 AREA FOR COMMUNICATIONS                                * 02110000
021200*---------------------------------------------------------------* 02120000
021300     EXEC SQL                                                     02130000
021400          INCLUDE SQLCA                                           02140000
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700/                                                                 02170000
021800*---------------------------------------------------------------* 02180000
021900*    DB2 AREA FOR THE TEMP ASSOCIATE TABLE                      * 02190000
022000*---------------------------------------------------------------* 02200000
022100     EXEC SQL                                                     02210000
022200          INCLUDE DLT00002                                        02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500/                                                                 02250000
022600*---------------------------------------------------------------* 02260000
022700*    DB2 AREA FOR THE LOCATION TABLE                            * 02270000
022800*---------------------------------------------------------------* 02280000
022900     EXEC SQL                                                     02290000
023000          INCLUDE XLT00010                                        02300000
023100     END-EXEC.                                                    02310000
023200/                                                                 02320000
023300                                                                  02330000
023400 LINKAGE SECTION.                                                 02340000
023500                                                                  02350000
023600 01  DFHCOMMAREA.                                                 02360000
023700     05  FILLER                       OCCURS  1 TO 4072 TIMES     02370000
023800                                      DEPENDING ON EIBCALEN.      02380000
023900         10  FILLER                   PIC X.                      02390000
024000                                                                  02400000
024100/                                                                 02410000
024200 PROCEDURE DIVISION.                                              02420000
024300                                                                  02430000
024400*----------------------------------------------------------------*02440000
024500*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *02450000
024600*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *02460000
024700*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *02470000
024800*                                                                *02480000
024900*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *02490000
025000*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *02500000
025100*----------------------------------------------------------------*02510000
025200 0000-MAIN-MODULE.                                                02520000
025300     INITIALIZE DP030-CICS-API-FIELDS.                            02530000
025400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02540000
025500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02550000
025600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02560000
025700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02570000
025800     MOVE LENGTH OF DLK402I        TO DP030-MAP-LENGTH (1).       02580000
025900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02590000
026000     PERFORM 0001-CALL-CICS-ARCH-API.                             02600000
026100                                                                  02610000
026200     PERFORM 1000-CONTROL-PROCESSING.                             02620000
026300                                                                  02630000
026400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02640000
026500     PERFORM 0001-CALL-CICS-ARCH-API.                             02650000
026600                                                                  02660000
026700/                                                                 02670000
026800 0001-CALL-CICS-ARCH-API.                                         02680000
026900                                                                  02690000
027000     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     02700001
027100                                     DFHCOMMAREA                  02710001
027200                                     DP030-CICS-API-FIELDS        02720001
027300                                     DP020-STANDARD-COMMAREA      02730001
027400                                     DLK402I.                     02740001
027500                                                                  02750000
027600     IF  DP030-RC-CALL-SUCCESSFUL                                 02760000
027700         CONTINUE                                                 02770000
027800     ELSE                                                         02780000
027900         SET DP013-NO-ROLLBACK                                    02790000
028000             DP013-XCTL-DISPLAY-RESTART                           02800000
028100             DP013-CICS-ABEND      TO TRUE                        02810000
028200         MOVE 'BEFORE 0000-MAIN-MODULE'                           02820000
028300                                   TO DP013-PARAGRAPH             02830000
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02851001
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02852001
028600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02860000
028700         PERFORM DP013-0000-PROCESS-ABEND                         02870000
028800     END-IF.                                                      02880000
028900                                                                  02890000
029000/                                                                 02900000
029100*----------------------------------------------------------------*02910000
029200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02920000
029300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02930000
029400*----------------------------------------------------------------*02940000
029500                                                                  02950000
029600 1000-CONTROL-PROCESSING.                                         02960000
029700                                                                  02970000
029800     EVALUATE TRUE                                                02980000
029900         WHEN DP020-NEXT-ACT-INITIAL                              02990000
030000              PERFORM 1100-FIND-OBJECT-KEYS                       03000000
030100              IF  PS-ERROR                                        03010000
030200                  CONTINUE                                        03020000
030300              ELSE                                                03030000
030400                  PERFORM 4000-BUILD-INITIAL-PANEL                03040000
030500                  PERFORM 3200-RESET-ATTRIBUTES                   03050000
030600              END-IF                                              03060000
030700                                                                  03070000
030800         WHEN DP020-NEXT-ACT-READ-MAP                             03080000
030900              PERFORM 2000-PROCESS-PANEL                          03090000
031000                                                                  03100000
031100         WHEN DP020-NEXT-ACT-RETURN                               03110000
031200              MOVE ASC-KEY-USER-CODE      TO                      03120000
031300                                      DK-USER-CODE                03130000
031400              MOVE ASC-KEY-ADDED-BY-DC-NBR TO                     03140000
031500                                      DK-ADDED-BY-DC-NBR          03150000
031600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03160000
031700              PERFORM 3200-RESET-ATTRIBUTES                       03170000
031800                                                                  03180000
031900         WHEN OTHER                                               03190000
032000              SET DP013-LOGIC-ABEND                               03200000
032100                  DP013-NO-ROLLBACK TO TRUE                       03210000
032200              MOVE '1000-CONTROL-PROCESSING'                      03220000
032300                                    TO DP013-PARAGRAPH            03230000
032400              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  03240000
032500                                    TO DP013-MESSAGE-TEXT(1)      03250000
032600              MOVE DP020-NEXT-APPL-ACTIVITY                       03260000
032700                                    TO DP013-MESSAGE-TEXT(2)      03270000
032800              PERFORM DP013-0000-PROCESS-ABEND                    03280000
032900     END-EVALUATE.                                                03290000
033000                                                                  03300000
033100/                                                                 03310000
033200*----------------------------------------------------------------*03320000
033300*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *03330000
033400*    INTER-APPLICATION FORMAT CODE.                              *03340000
033500*----------------------------------------------------------------*03350000
033600 1100-FIND-OBJECT-KEYS.                                           03360000
033700                                                                  03370000
033800     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03380000
033900                                                                  03390000
034000     MOVE DP020-INT-APPL-FORMAT-IND                               03400000
034100                                   TO ASC-INT-APPL-FORMAT-IND.    03410000
034200                                                                  03420000
034300     EVALUATE DP020-INT-APPL-FORMAT-IND                           03430000
034400         WHEN PC-INTER-APPL-CRIT-DETAIL                           03440000
034500         WHEN PC-INTER-APPL-LIST                                  03450000
034600         WHEN PC-INTER-APPL-ADD-TEMP                              03460000
034700             IF  DL002-NUMBER-OF-SELECTED-ITEMS > ZERO            03470000
034800                 SET ASC-USE-SELECTION-QUEUE                      03480000
034900                                   TO TRUE                        03490000
035000                 MOVE DL002-NUMBER-OF-SELECTED-ITEMS              03500000
035100                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03510000
035200                 MOVE DL002-NUMBER-OF-TS-ITEMS                    03520000
035300                                   TO ASC-NUMBER-OF-TS-ITEMS      03530000
035400                 MOVE DL002-SEL-QUEUE-NAME                        03540000
035500                                   TO ASC-SEL-QUEUE-NAME          03550000
035600                 PERFORM 1120-PREPARE-LIST-ENTRY                  03560000
036100             ELSE                                                 03610000
036200                 SET DP030-OVERRIDE-GO                            03620000
036300                                   TO TRUE                        03630000
036400                 MOVE PC-TSYMSG-00057                             03640000
036500                                   TO DP020-MSG-NUMBER            03650000
036600                 SET DP020-MSG-WARNING                            03660000
036700                     DP020-NEXT-ACT-APPL-ERROR                    03670000
036800                                   TO TRUE                        03680000
036900             END-IF                                               03690000
037000                                                                  03700000
037100         WHEN OTHER                                               03710000
037200             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            03720000
037300             SET DP020-MSG-FATAL                                  03730000
037400                 DP020-NEXT-ACT-APPL-ERROR                        03740000
037500                                   TO TRUE                        03750000
037600     END-EVALUATE.                                                03760000
037700                                                                  03770000
037800/                                                                 03780000
037900*----------------------------------------------------------------*03790000
038000*    ENTRY IS FROM A LIST.  GET THE RECEIVER NUMBER FROM THE     *03800000
038100*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *03810000
038200*----------------------------------------------------------------*03820000
038300 1120-PREPARE-LIST-ENTRY.                                         03830000
038400                                                                  03840000
038500     MOVE DL008-MAX-ITEMS          TO ASC-SEL-SUB.                03850000
038600     MOVE ZERO                     TO ASC-SEL-ITEM.               03860000
038700     PERFORM 2110-GET-NEXT-RECORD.                                03870000
038800                                                                  03880000
038900/                                                                 03890000
039000*----------------------------------------------------------------*03900000
039100*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*03910000
039200*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*03920000
039300*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *03930000
039400*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *03940000
039500*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *03950000
039600*----------------------------------------------------------------*03960000
039700                                                                  03970000
039800 2000-PROCESS-PANEL.                                              03980000
039900                                                                  03990000
040000     EVALUATE TRUE                                                04000000
040100                                                                  04010000
040200         WHEN DP020-SRC-AID = DP016-CLEAR                         04020000
040300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04030000
040400                                                                  04040000
040500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04050000
040600             PERFORM 4000-BUILD-INITIAL-PANEL                     04060000
040700             PERFORM 3200-RESET-ATTRIBUTES                        04070000
040800                                                                  04080000
040900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04090000
041000             IF  ASC-USE-SELECTION-QUEUE                          04100000
041100                 PERFORM 2110-GET-NEXT-RECORD                     04110000
041200                 IF PS-LIST-END                                   04120000
041300                    SET PS-NO-LIST-END                            04130000
041400                                   TO TRUE                        04140000
041500                 ELSE                                             04150000
041600                    PERFORM 4000-BUILD-INITIAL-PANEL              04160000
041700                    PERFORM 3200-RESET-ATTRIBUTES                 04170000
041800                 END-IF                                           04180000
041900             ELSE                                                 04190000
042000*                --- BOTTOM OF LIST ---                           04200000
042100                 MOVE PC-TSYMSG-00070                             04210000
042200                                   TO DP020-MSG-NUMBER            04220000
042300                 SET DP020-MSG-INFORMATIONAL                      04230000
042400                     PS-LIST-END   TO TRUE                        04240000
042500             END-IF                                               04250000
042600                                                                  04260000
042700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04270000
042800             IF  ASC-USE-SELECTION-QUEUE                          04280000
042900                 PERFORM 2120-GET-PREV-RECORD                     04290000
043000                 IF PS-LIST-END                                   04300000
043100                    SET PS-NO-LIST-END                            04310000
043200                                   TO TRUE                        04320000
043300                 ELSE                                             04330000
043400                    PERFORM 4000-BUILD-INITIAL-PANEL              04340000
043500                    PERFORM 3200-RESET-ATTRIBUTES                 04350000
043600                 END-IF                                           04360000
043700             ELSE                                                 04370000
043800*                --- TOP OF LIST ---                              04380000
043900                 MOVE PC-TSYMSG-00069                             04390000
044000                                   TO DP020-MSG-NUMBER            04400000
044100                 SET DP020-MSG-INFORMATIONAL                      04410000
044200                     PS-LIST-END   TO TRUE                        04420000
044300             END-IF                                               04430000
044400                                                                  04440000
044500         WHEN OTHER                                               04450000
044600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04460000
044610             PERFORM 3200-RESET-ATTRIBUTES                        04461000
044700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04470000
044800             IF  PS-NO-ERROR                                      04480000
044900                 SET DP030-CONTINUE-GO                            04490000
045000                                   TO TRUE                        04500000
045100                 PERFORM 2100-CHECK-FUNCTION-KEY                  04510000
045200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04520000
045300             ELSE                                                 04530000
045400                 SET DP030-OVERRIDE-GO                            04540000
045500                                   TO TRUE                        04550000
045600             END-IF                                               04560000
045700     END-EVALUATE.                                                04570000
045800                                                                  04580000
045900/                                                                 04590000
046000*----------------------------------------------------------------*04600000
046100*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *04610000
046200*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*04620000
046300*    FROM THE CICS ARCHITECTURE API.                             *04630000
046400*----------------------------------------------------------------*04640000
046500                                                                  04650000
046600 2100-CHECK-FUNCTION-KEY.                                         04660000
046700                                                                  04670000
046800     EVALUATE TRUE                                                04680000
046900         WHEN DP020-SRC-AID = DP016-ENTER                         04690000
047000             CONTINUE                                             04700000
047100                                                                  04710000
047200****     UPDATE THE TEMP ASSOC INFO (EITHER NAME OR ACTIVE-IND)   04720000
047300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04730000
047320             SET PS-UPDATE-PERFORMED-NO  TO TRUE                  04732000
047400             PERFORM 7000-UPDATE                                  04740000
047410             PERFORM 3200-RESET-ATTRIBUTES                        04741000
047420             PERFORM 9100-READ-SEL-QUEUE                          04742000
047421             IF PS-UPDATE-PERFORMED-YES                           04742100
047430                SET DL008-UPD (ASC-SEL-SUB) TO TRUE               04743000
047431             ELSE                                                 04743100
047432                SET DL008-INQ (ASC-SEL-SUB) TO TRUE               04743200
047433             END-IF                                               04743300
047440             MOVE ASC-FIRST-NAME TO DL008-FIRST-NAME              04744000
047450                                      (ASC-SEL-SUB)               04745000
047460             MOVE ASC-LAST-NAME TO DL008-LAST-NAME                04746000
047470                                      (ASC-SEL-SUB)               04747000
047480             MOVE ASC-ACTIVE-USER TO DL008-ACTIVE                 04748000
047490                                      (ASC-SEL-SUB)               04749000
047491             PERFORM 9200-REWRITE-LIST-QUEUE                      04749100
047500                                                                  04750000
047600         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               04760000
047620              PERFORM 9100-READ-SEL-QUEUE                         04762000
047630              SET DL008-INQ (ASC-SEL-SUB) TO TRUE                 04763000
047640              PERFORM 9200-REWRITE-LIST-QUEUE                     04764000
047800                                                                  04780000
047900         WHEN OTHER                                               04790000
048000             SET DP013-NO-ROLLBACK                                04800000
048100                 DP013-XCTL-DISPLAY-RESTART                       04810000
048200                 DP013-CICS-ABEND  TO TRUE                        04820000
048300             MOVE '2100-CHECK-FUNCTION-KEY'                       04830000
048400                                   TO DP013-PARAGRAPH             04840000
048500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04850000
048600                                   TO DP013-MESSAGE-TEXT (1)      04860000
048700             PERFORM DP013-0000-PROCESS-ABEND                     04870000
048800     END-EVALUATE.                                                04880000
048900                                                                  04890000
049000/                                                                 04900000
049100*----------------------------------------------------------------*04910000
049200*    GET THE USER CODE (KEY) OF THE NEXT SELECTED OBJECT         *04920000
049300*    FROM THE SELECTED-ITEMS TEMP STORAGE QUEUE.                 *04930000
049400*----------------------------------------------------------------*04940000
049500 2110-GET-NEXT-RECORD.                                            04950000
049600                                                                  04960000
049700     ADD +1                        TO ASC-SEL-SUB.                04970000
049800     IF  ASC-SEL-SUB > DL008-MAX-ITEMS                            04980000
049900         ADD +1                    TO ASC-SEL-ITEM                04990000
050000         MOVE +1                   TO ASC-SEL-SUB                 05000000
050100     END-IF.                                                      05010000
050200                                                                  05020000
050300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05030000
050400         PERFORM 9100-READ-SEL-QUEUE                              05040000
050500         IF  DL008-ITEM (ASC-SEL-SUB) > ZERO                      05050000
050600             MOVE DL008-USER-CODE (ASC-SEL-SUB)                   05060000
050700                                   TO ASC-KEY-USER-CODE           05070000
050800             MOVE DL008-ADDED-BY-DC-NBR (ASC-SEL-SUB)             05080000
050900                                   TO ASC-KEY-ADDED-BY-DC-NBR     05090000
051000             SET DL008-INQ (ASC-SEL-SUB)                          05100000
051100                                   TO TRUE                        05110000
051200             PERFORM 9200-REWRITE-LIST-QUEUE                      05120000
051300             INITIALIZE ASC-SCREEN-FIELDS                         05130000
051400         ELSE                                                     05140000
051500             SUBTRACT +1 FROM ASC-SEL-SUB                         05150000
051600*            --- BOTTOM OF LIST ---                               05160000
051700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05170000
051800             SET DP020-MSG-INFORMATIONAL                          05180000
051900                 PS-LIST-END                                      05190000
052000                                   TO TRUE                        05200000
052100         END-IF                                                   05210000
052200     ELSE                                                         05220000
052300         SUBTRACT +1 FROM ASC-SEL-ITEM                            05230000
052400         MOVE DL008-MAX-ITEMS      TO ASC-SEL-SUB                 05240000
052500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05250000
052600         SET DP020-MSG-INFORMATIONAL                              05260000
052700             PS-LIST-END                                          05270000
052800                                   TO TRUE                        05280000
052900     END-IF.                                                      05290000
053000                                                                  05300000
053100/                                                                 05310000
053200*----------------------------------------------------------------*05320000
053300*    GET THE USER CODE (KEY) FROM THE PREVIOUS SELECTED          *05330000
053400*    OBJECT FROM THE SELECTED-ITEMS TEMP STORAGE QUEUE.          *05340000
053500*----------------------------------------------------------------*05350000
053600 2120-GET-PREV-RECORD.                                            05360000
053700                                                                  05370000
053800     SUBTRACT +1 FROM ASC-SEL-SUB.                                05380000
053900     IF  ASC-SEL-SUB < +1                                         05390000
054000         SUBTRACT +1 FROM ASC-SEL-ITEM                            05400000
054100         MOVE DL008-MAX-ITEMS      TO ASC-SEL-SUB                 05410000
054200     END-IF.                                                      05420000
054300                                                                  05430000
054400     IF  ASC-SEL-ITEM > ZERO                                      05440000
054500         PERFORM 9100-READ-SEL-QUEUE                              05450000
054600         MOVE DL008-USER-CODE (ASC-SEL-SUB)                       05460000
054700                                   TO ASC-KEY-USER-CODE           05470000
054800                                                                  05480000
054900         INITIALIZE ASC-SCREEN-FIELDS                             05490000
055000     ELSE                                                         05500000
055100         MOVE +1                   TO ASC-SEL-ITEM                05510000
055200                                      ASC-SEL-SUB                 05520000
055300*        --- TOP OF LIST ---                                      05530000
055400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05540000
055500         SET DP020-MSG-INFORMATIONAL                              05550000
055600             PS-LIST-END           TO TRUE                        05560000
055700     END-IF.                                                      05570000
055800                                                                  05580000
055900*----------------------------------------------------------------*05590000
056000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *05600000
056100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *05610000
056200*----------------------------------------------------------------*05620000
056300 2200-MOVE-SCREEN-TO-COMMAREA.                                    05630000
056400                                                                  05640000
056500     IF  AFNMEL > ZERO                                            05650000
056600         MOVE AFNMEI               TO ASC-FIRST-NAME              05660000
056700     ELSE                                                         05670000
056800        IF  AFNMEF  = DP015-ERASE-EOF                             05680000
056900            MOVE SPACES            TO ASC-FIRST-NAME              05690000
057000        END-IF                                                    05700000
057100     END-IF.                                                      05710000
057200                                                                  05720000
057300     IF  ALNMEL > ZERO                                            05730000
057400         MOVE ALNMEI               TO ASC-LAST-NAME               05740000
057500     ELSE                                                         05750000
057600        IF  ALNMEF  = DP015-ERASE-EOF                             05760000
057700            MOVE SPACES            TO ASC-LAST-NAME               05770000
057800        END-IF                                                    05780000
057900     END-IF.                                                      05790000
058000                                                                  05800000
058100     IF  AACTUSRL > ZERO                                          05810000
058200         MOVE AACTUSRI             TO ASC-ACTIVE-USER             05820000
058300     ELSE                                                         05830000
058400        IF  AACTUSRF  = DP015-ERASE-EOF                           05840000
058500            MOVE SPACES            TO ASC-ACTIVE-USER             05850000
058600        END-IF                                                    05860000
058700     END-IF.                                                      05870000
058800                                                                  05880000
058900/                                                                 05890000
059000*----------------------------------------------------------------*05900000
059100* EDIT THE ENTERABLE FIELDS - BOTH NAMES ARE REQUIRED AND        *05910000
059200* THE ACTIVE INDICATOR MUST BE EITHER A 'Y' OR 'N'.              *05920000
059300*----------------------------------------------------------------*05930000
059400 3000-EDIT-DATA-IN-COMMAREA.                                      05940000
059500                                                                  05950000
059600     SET PS-NO-ERROR  TO TRUE.                                    05960000
059700                                                                  05970000
059800     IF ASC-ACTIVE-USER = (PC-Y OR PC-N)                          05980000
059900        CONTINUE                                                  05990000
060000     ELSE                                                         06000000
060100        SET PS-ERROR                                              06010000
060200            DP020-MSG-FATAL                                       06020000
060300            DP030-SET-CURSOR-APPL-1                               06030000
060400            DP030-OVERRIDE-GO       TO TRUE                       06040000
060500        MOVE DP015-UNP-ALP-BRT-OFF  TO AACTUSRA                   06050000
060600        MOVE DP015-RED              TO AACTUSRC                   06060000
060700        MOVE DP015-REVERSE          TO AACTUSRH                   06070000
060800        MOVE -1                     TO AACTUSRL                   06080000
060900        MOVE PC-TSYMSG-03178        TO DP020-MSG-NUMBER           06090000
061000     END-IF.                                                      06100000
061100                                                                  06110000
061200     IF ASC-LAST-NAME = SPACES OR LOW-VALUES                      06120000
061300         SET PS-ERROR                                             06130000
061400             DP020-MSG-FATAL                                      06140000
061500             DP030-SET-CURSOR-APPL-1                              06150000
061600             DP030-OVERRIDE-GO       TO TRUE                      06160000
061610         MOVE DP015-UNP-ALP-BRT-OFF  TO ALNMEA                    06161000
061620         MOVE DP015-RED              TO ALNMEC                    06162000
061630         MOVE DP015-REVERSE          TO ALNMEH                    06163000
061700         MOVE -1                     TO ALNMEL                    06170000
061800         MOVE PC-TSYMSG-03178        TO DP020-MSG-NUMBER          06180000
061900     END-IF.                                                      06190000
062000                                                                  06200000
062100     IF ASC-FIRST-NAME = SPACES OR LOW-VALUES                     06210000
062200         SET PS-ERROR                                             06220000
062300             DP020-MSG-FATAL                                      06230000
062400             DP030-SET-CURSOR-APPL-1                              06240000
062500             DP030-OVERRIDE-GO       TO TRUE                      06250000
062510         MOVE DP015-UNP-ALP-BRT-OFF  TO AFNMEA                    06251000
062520         MOVE DP015-RED              TO AFNMEC                    06252000
062530         MOVE DP015-REVERSE          TO AFNMEH                    06253000
062600         MOVE -1                     TO AFNMEL                    06260000
062700         MOVE PC-TSYMSG-03178        TO DP020-MSG-NUMBER          06270000
062800     END-IF.                                                      06280000
062900                                                                  06290000
063000**?? PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        06300000
063100                                                                  06310000
063200/                                                                 06320000
063300*----------------------------------------------------------------*06330000
063400*    RESET THE ATTRIBUTES OF CERTAIN FIELDS ON THE MAP.          *06340000
063500*----------------------------------------------------------------*06350000
063600                                                                  06360000
063700 3200-RESET-ATTRIBUTES.                                           06370000
063800                                                                  06380000
063900     MOVE -1 TO AFNMEL.                                           06390000
063901     SET DP030-SET-CURSOR-APPL-1  TO TRUE.                        06390100
063902                                                                  06390200
063910     MOVE DP015-UNP-ALP-NOR-OFF  TO AFNMEA                        06391000
063920                                    ALNMEA                        06392000
063930                                    AACTUSRA.                     06393000
063940                                                                  06394000
063950     MOVE DP015-GREEN            TO AFNMEC                        06395000
063960                                    ALNMEC                        06396000
063970                                    AACTUSRC.                     06397000
063980                                                                  06398000
063990     MOVE DP015-UNDERLINE        TO AFNMEH                        06399000
063991                                    ALNMEH                        06399100
063992                                    AACTUSRH.                     06399200
063993                                                                  06399300
064300/                                                                 06430000
064400*----------------------------------------------------------------*06440000
064500*   - GET THE INFO FROM THE USER CODE THAT WAS PASSED            *06450000
064600*----------------------------------------------------------------*06460000
064700 4000-BUILD-INITIAL-PANEL.                                        06470000
064800                                                                  06480000
064900     SET DP030-SET-CURSOR-TRAILER                                 06490000
065000         PS-NO-ERROR             TO TRUE.                         06500000
065100                                                                  06510000
065200     MOVE -1 TO AFNMEL.                                           06520000
065300     SET DP030-SET-CURSOR-APPL-1  TO TRUE.                        06530000
065400     MOVE ASC-KEY-USER-CODE       TO DK-USER-CODE.                06540000
065500     MOVE ASC-KEY-ADDED-BY-DC-NBR TO DK-ADDED-BY-DC-NBR.          06550000
065600     PERFORM 4100-GET-TEMP-ASSOC-INFO.                            06560000
065700     PERFORM 4105-GET-ADDED-BY-NAME.                              06570000
065800     PERFORM 4110-GET-ADDED-BY-DC-NAME.                           06580000
065900     IF  SQLCODE = +0                                             06590000
066000         PERFORM 4115-LOAD-TEMP-FIELDS                            06600000
066100     END-IF                                                       06610000
066200                                                                  06620000
066300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        06630000
066400                                                                  06640000
066500/                                                                 06650000
066600*----------------------------------------------------------------*06660000
066700*    GET TEMP ASSOC INFO                                         *06670000
066800*----------------------------------------------------------------*06680000
066900 4100-GET-TEMP-ASSOC-INFO.                                        06690000
067000                                                                  06700000
067100     PERFORM                                                      06710000
067200         WITH TEST AFTER                                          06720000
067300         VARYING PV-RETRY-COUNTER                                 06730000
067400         FROM 1 BY 1                                              06740000
067500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06750000
067600            OR (SQLCODE = +0)                                     06760000
067700            OR (SQLCODE = +100))                                  06770000
067800                                                                  06780000
067900         EXEC SQL                                                 06790000
068000            SELECT  DC_NBR                                        06800000
068100                   ,FRST_NM                                       06810000
068200                   ,LAST_NM                                       06820000
068300                   ,CRE_BY_USR_ID                                 06830000
068400                   ,CHAR(DATE(CRE_TMST),USA)                      06840000
068500                   ,CHAR(TIME(CRE_TMST),ISO)                      06850000
068600                   ,ACTV_IND                                      06860000
068700              INTO :DLT00002-DC-NBR                               06870000
068800                  ,:DLT00002-FRST-NM                              06880000
068900                  ,:DLT00002-LAST-NM                              06890000
069000                  ,:DLT00002-CRE-BY-USR-ID                        06900000
069100                  ,:PV-DATE-USA                                   06910000
069200                  ,:PV-TIME-ISO                                   06920000
069300                  ,:DLT00002-ACTV-IND                             06930000
069400              FROM  DLT_TMP_EMP  TMP                              06940000
069500          WHERE TMP.TMP_USR_ID   = :DK-USER-CODE                  06950000
069600         END-EXEC                                                 06960000
069700                                                                  06970000
069800         EVALUATE TRUE                                            06980000
069900             WHEN SQLCODE = +0                                    06990000
070000             WHEN SQLCODE = +100                                  07000000
070100             WHEN SQLCODE = -904                                  07010000
070200             WHEN SQLCODE = -913                                  07020000
070300                 CONTINUE                                         07030000
070400                                                                  07040000
070500             WHEN SQLWARN0 NOT = SPACE                            07050000
070600             WHEN SQLCODE < +0                                    07060000
070700             WHEN SQLCODE > +0                                    07070000
070800                 MOVE '4100-GET-TEMP-ASSOC-INFO'                  07080000
070900                                     TO DP013-PARAGRAPH           07090000
071000                 MOVE 'SELECT ON TEMP USER TABLE'                 07100000
071100                                     TO DP013-MESSAGE-TEXT (1)    07110000
071200                 MOVE SQLCA          TO DP013-SQLCA               07120000
071300                 MOVE 'DLT_TMP_EMP'  TO DP013-DB2-TABLE-NAME (1)  07130000
071400                     SET DP013-DB2-ABEND                          07140000
071500                         DP013-XCTL-DISPLAY-RESTART               07150000
071600                                     TO TRUE                      07160000
071700                 PERFORM DP013-0000-PROCESS-ABEND                 07170000
071800         END-EVALUATE                                             07180000
071900     END-PERFORM.                                                 07190000
072000                                                                  07200000
072100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07210000
072200             AND (SQLCODE = -904 OR -913)                         07220000
072300         MOVE '4100-GET-TEMP-ASSOC-INFO'                          07230000
072400                                  TO DP013-PARAGRAPH              07240000
072500         MOVE 'MAX RETRIES EXCEEDED - SELECT DLT_TMP_EMP'         07250000
072600                                  TO DP013-MESSAGE-TEXT (1)       07260000
072700         MOVE SQLCA               TO DP013-SQLCA                  07270000
072800         MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1)     07280000
072900         SET DP013-DB2-ABEND                                      07290000
073000             DP013-XCTL-DISPLAY-RESTART                           07300000
073100                                  TO TRUE                         07310000
073200         PERFORM DP013-0000-PROCESS-ABEND                         07320000
073300     END-IF.                                                      07330000
073400                                                                  07340000
073500/                                                                 07350000
073600*----------------------------------------------------------------*07360000
073700*  CALL XLKUT067 TO RETRIEVE THE NAME USERID THAT ADDED ASSOC    *07370000
073800*----------------------------------------------------------------*07380000
073900 4105-GET-ADDED-BY-NAME.                                          07390000
074000                                                                  07400000
074100     MOVE DLT00002-CRE-BY-USR-ID      TO XL067-KEY-USER-ID.       07410000
074200                                                                  07420000
074300     SET XL067-BY-USER-ID                                         07430000
074400         XL067-SELECT-BOTH-USERS      TO TRUE.                    07440000
074500                                                                  07450000
074600     CALL XL067-USER-PGM USING DFHEIBLK                           07460000
074700                               XL067-COMMAREA                     07470000
074800                               XL067-USER-COMMAREA.               07480000
074900                                                                  07490000
075000     EVALUATE TRUE                                                07500000
075100         WHEN XL067-SUCCESSFUL                                    07510000
075200             MOVE XL067-COMBINED-NAME-4    TO AADDNMEO            07520000
075300                                              PV-ADDED-BY-NAME    07530000
075400                                                                  07540000
075500         WHEN XL067-SQL-ERROR                                     07550000
075600             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    07560000
075700             MOVE '4105-GET-ADDED-BY-NAME'  TO PV-SOFT-PARAGRAPH  07570000
075800             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  07580000
075900             MOVE LENGTH OF PV-CICS-MSG-AREA2                     07590000
076000               TO PV-COMMAREA-LENGTH                              07600000
076100             EXEC CICS                                            07610000
076200                  WRITEQ TD                                       07620000
076300                   QUEUE  ('CSSL')                                07630000
076400                    FROM  (PV-CICS-MSG-AREA2)                     07640000
076500                  LENGTH  (PV-COMMAREA-LENGTH)                    07650000
076600                    RESP  (PV-CICS-RESP)                          07660000
076700             END-EXEC                                             07670000
076800             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              07680000
076900             PERFORM 9900-SOFT-ABORT                              07690000
077000     END-EVALUATE.                                                07700000
077100                                                                  07710000
077200/                                                                 07720000
077300 4110-GET-ADDED-BY-DC-NAME.                                       07730000
077400                                                                  07740000
077500     MOVE DK-ADDED-BY-DC-NBR          TO XLT00010-LOC-NBR         07750000
077600                                                                  07760000
077700     EXEC SQL                                                     07770000
077800         SELECT  LOC_NM                                           07780000
077900           INTO  :XLT00010-LOC-NM                                 07790000
078000           FROM  XLT_LOC                                          07800000
078100         WHERE LOC_NBR        = :XLT00010-LOC-NBR                 07810000
078200     END-EXEC                                                     07820000
078300                                                                  07830000
078400     EVALUATE TRUE                                                07840000
078500         WHEN SQLCODE = ZERO                                      07850000
078600             MOVE XLT00010-LOC-NM     TO PV-ADDED-BY-DC-NAME      07860000
078700                                                                  07870000
078800         WHEN SQLCODE = +100                                      07880000
078900             MOVE ALL '?'             TO PV-ADDED-BY-DC-NAME      07890000
079000         WHEN SQLCODE = -904                                      07900000
079100         WHEN SQLCODE = -911                                      07910000
079200         WHEN SQLCODE = -913                                      07920000
079300             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    07930000
079400             MOVE '4110-GET-ADDED-BY-DC-NAME' TO PV-SOFT-PARAGRAPH07940000
079500             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  07950000
079600             MOVE LENGTH OF PV-CICS-MSG-AREA2                     07960000
079700               TO PV-COMMAREA-LENGTH                              07970000
079800             EXEC CICS                                            07980000
079900                  WRITEQ TD                                       07990000
080000                   QUEUE  ('CSSL')                                08000000
080100                    FROM  (PV-CICS-MSG-AREA2)                     08010000
080200                  LENGTH  (PV-COMMAREA-LENGTH)                    08020000
080300                    RESP  (PV-CICS-RESP)                          08030000
080400             END-EXEC                                             08040000
080500             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          08050000
080600             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              08060000
080700             PERFORM 9900-SOFT-ABORT                              08070000
080800         WHEN OTHER                                               08080000
080900              MOVE '4110-GET-ADDED-BY-DC-NAME'                    08090000
081000                               TO DP013-PARAGRAPH                 08100000
081100              MOVE 'GET LOCATION DESCRIPTION'                     08110000
081200                               TO DP013-MESSAGE-TEXT (1)          08120000
081300              MOVE SQLCA       TO DP013-SQLCA                     08130000
081400              MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)        08140000
081500              SET DP013-DB2-ABEND                                 08150000
081600                  DP013-XCTL-DISPLAY-RESTART                      08160000
081700                                   TO TRUE                        08170000
081800                  PERFORM DP013-0000-PROCESS-ABEND                08180000
081900     END-EVALUATE.                                                08190000
082000                                                                  08200000
082100*----------------------------------------------------------------*08210000
082200*    MOVE THE TEMP FIELDS INTO THE COMMAREA                      *08220000
082300*----------------------------------------------------------------*08230000
082400 4115-LOAD-TEMP-FIELDS.                                           08240000
082500                                                                  08250000
082600                                                                  08260000
082700     MOVE DLT00002-DC-NBR          TO ASC-KEY-ADDED-BY-DC-NBR.    08270000
082800     MOVE DLT00002-FRST-NM         TO ASC-FIRST-NAME.             08280000
082900     MOVE DLT00002-LAST-NM         TO ASC-LAST-NAME.              08290000
083000     MOVE DP020-USERID             TO ASC-SIGNON-USERID.          08300000
083010     MOVE DK-USER-CODE             TO ASC-USERID.                 08301000
083100     MOVE DLT00002-CRE-BY-USR-ID   TO ASC-ADDED-BY-ID.            08310000
083200     MOVE PV-ADDED-BY-DC-NAME      TO ASC-ADDED-BY-DC-NAME.       08320000
083300     MOVE PV-ADDED-BY-NAME         TO ASC-ADDED-BY-NAME.          08330000
083400     MOVE PV-DATE-USA              TO ASC-DATE-ADDED.             08340000
083500     MOVE PV-TIME-ISO              TO ASC-TIME-ADDED.             08350000
083600     MOVE DLT00002-ACTV-IND        TO ASC-ACTIVE-USER.            08360000
083700                                                                  08370000
083800/                                                                 08380000
083900*----------------------------------------------------------------*08390000
084000*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *08400000
084100*----------------------------------------------------------------*08410000
084200 4400-MOVE-COMMAREA-TO-SCREEN.                                    08420000
084300                                                                  08430000
084400     MOVE DL002-OPER-UNT-ID        TO ADCO.                       08440000
084500     MOVE DL002-OPER-DESC          TO ADCNMEO.                    08450000
084600     MOVE ASC-KEY-ADDED-BY-DC-NBR  TO ABYDCO.                     08460000
084700     MOVE ASC-FIRST-NAME           TO AFNMEO.                     08470000
084800     MOVE ASC-LAST-NAME            TO ALNMEO.                     08480000
084900     MOVE ASC-ADDED-BY-ID          TO AADDBYO.                    08490000
085000     MOVE ASC-USERID               TO AUSRCDO.                    08500000
085100     MOVE ASC-ADDED-BY-DC-NAME     TO ABYDCNMO.                   08510000
085200     MOVE ASC-ADDED-BY-NAME        TO AADDNMEO.                   08520000
085300     MOVE ASC-DATE-ADDED           TO ADATEO.                     08530000
085400     MOVE ASC-TIME-ADDED           TO ATIMEO.                     08540000
085500     MOVE ASC-ACTIVE-USER          TO AACTUSRO.                   08550000
085600/                                                                 08560000
085700 7000-UPDATE.                                                     08570000
085800                                                                  08580000
085900     MOVE ASC-FIRST-NAME    TO DLT00002-FRST-NM.                  08590000
086000     MOVE ASC-LAST-NAME     TO DLT00002-LAST-NM.                  08600000
086100     MOVE ASC-ACTIVE-USER   TO DLT00002-ACTV-IND.                 08610000
086200     MOVE ASC-KEY-USER-CODE TO DLT00002-TMP-USR-ID.               08620000
086300                                                                  08630000
086400**** UPDATE DLT_TMP_EMP                                           08640000
086500     EXEC SQL                                                     08650000
086600         UPDATE DLT_TMP_EMP                                       08660000
086700         SET ACTV_IND  = :DLT00002-ACTV-IND                       08670000
086800            ,FRST_NM   = :DLT00002-FRST-NM                        08680000
086900            ,LAST_NM   = :DLT00002-LAST-NM                        08690000
087000         WHERE                                                    08700000
087100             TMP_USR_ID   = :DLT00002-TMP-USR-ID                  08710000
087200     END-EXEC                                                     08720000
087300                                                                  08730000
087400     EVALUATE TRUE                                                08740000
087500         WHEN SQLCODE = ZERO                                      08750000
087510             MOVE PC-TSYMSG-03133  TO DP020-MSG-NUMBER            08751000
087520             SET DP020-MSG-INFORMATIONAL TO TRUE                  08752000
087521             SET PS-UPDATE-PERFORMED-YES TO TRUE                  08752100
087530*?           SET DL002-UPD TO TRUE                                08753000
087600         WHEN SQLCODE = +100                                      08760000
087620*?           MOVE PC-TSYMSG-03133  TO DP020-MSG-NUMBER            08762000
087630*?           SET DP020-MSG-INFORMATIONAL TO TRUE                  08763000
087800         WHEN SQLCODE = -904                                      08780000
087900         WHEN SQLCODE = -911                                      08790000
088000         WHEN SQLCODE = -913                                      08800000
088100             MOVE '2300-UPDATE'       TO DP013-PARAGRAPH          08810000
088200             MOVE 'DB2 TIMEOUT ATTEMPTING TO UPDATE TEMP USR'     08820000
088300                                      TO DP013-MESSAGE-TEXT (1)   08830000
088400             MOVE SQLCA               TO DP013-SQLCA              08840000
088500             MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1) 08850000
088600             SET DP013-DB2-ABEND                                  08860000
088700                 DP013-XCTL-DISPLAY-RESTART                       08870000
088800                                      TO TRUE                     08880000
088900             PERFORM DP013-0000-PROCESS-ABEND                     08890000
089000         WHEN SQLWARN0 NOT = SPACES                               08900000
089100         WHEN SQLCODE < ZERO                                      08910000
089200         WHEN SQLCODE > ZERO                                      08920000
089300             MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1) 08930000
089400             MOVE '2300-UPDATE'       TO DP013-PARAGRAPH          08940000
089500             MOVE 'UPDATE TEMP USR'   TO DP013-MESSAGE-TEXT (1)   08950000
089600             MOVE SQLCA               TO DP013-SQLCA              08960000
089700             SET DP013-DB2-ABEND                                  08970000
089800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08980000
089900             PERFORM DP013-0000-PROCESS-ABEND                     08990000
090000     END-EVALUATE.                                                09000000
090100                                                                  09010000
090300/                                                                 09030000
090400*----------------------------------------------------------------*09040000
090500*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *09050000
090600*----------------------------------------------------------------*09060000
090700                                                                  09070000
090800 9100-READ-SEL-QUEUE.                                             09080000
090900     EXEC CICS                                                    09090000
091000         READQ TS                                                 09100000
091100             QUEUE (ASC-SEL-QUEUE-NAME)                           09110000
091200             INTO  (DL008-TEMP-ASSOC-SELECT-RECORD)               09120000
091300             ITEM  (ASC-SEL-ITEM)                                 09130000
091400             RESP  (PV-CICS-RESP)                                 09140000
091500     END-EXEC.                                                    09150000
091600                                                                  09160000
091700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       09170000
091800         CONTINUE                                                 09180000
091900     ELSE                                                         09190000
092000         SET DP013-LOGIC-ABEND                                    09200000
092100             DP013-NO-ROLLBACK     TO TRUE                        09210000
092200         MOVE '9100-READ-SEL-QUEUE'                               09220000
092300                                   TO DP013-PARAGRAPH             09230000
092400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   09240000
092500                                   TO DP013-MESSAGE-TEXT (1)      09250000
092600         PERFORM DP013-0000-PROCESS-ABEND                         09260000
092700     END-IF.                                                      09270000
092800                                                                  09280000
092900/                                                                 09290000
093000*----------------------------------------------------------------*09300000
093100*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *09310000
093200*----------------------------------------------------------------*09320000
093300 9200-REWRITE-LIST-QUEUE.                                         09330000
093400     EXEC CICS                                                    09340000
093500          WRITEQ TS                                               09350000
093600              QUEUE  (ASC-SEL-QUEUE-NAME)                         09360000
093700              FROM   (DL008-TEMP-ASSOC-SELECT-RECORD)             09370000
093800              ITEM   (ASC-SEL-ITEM)                               09380000
093900              RESP   (PV-CICS-RESP)                               09390000
094000              REWRITE                                             09400000
094100     END-EXEC.                                                    09410000
094200                                                                  09420000
094300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   09430000
094400         SET DP013-CICS-ABEND                                     09440000
094500             DP013-NO-ROLLBACK     TO TRUE                        09450000
094600         MOVE '9200-REWRITE-LIST-QUEUE'                           09460000
094700                                   TO DP013-PARAGRAPH             09470000
094800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   09480000
094900                                   TO DP013-MESSAGE-TEXT (1)      09490000
095000         PERFORM DP013-0000-PROCESS-ABEND                         09500000
095100     END-IF.                                                      09510000
095200                                                                  09520000
095300/                                                                 09530000
095400 9900-SOFT-ABORT.                                                 09540000
095500                                                                  09550000
095600     EXEC CICS SYNCPOINT                                          09560000
095700          ROLLBACK                                                09570000
095800     END-EXEC.                                                    09580000
095900                                                                  09590000
096000     SET  PS-ERROR                                                09600000
096100          PS-SOFT-ABORT-ERROR                                     09610000
096200          DP020-MSG-FATAL       TO  TRUE.                         09620000
096300/                                                                 09630000
096400/                                                                 09640000
096500*----------------------------------------------------------------*09650000
096600*    ABEND PROCESSOR MODULE                                      *09660000
096700*----------------------------------------------------------------*09670000
096800                                                                  09680000
096900     COPY DPPD013.                                                09690000
