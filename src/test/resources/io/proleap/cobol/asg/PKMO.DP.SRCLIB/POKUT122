000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.     POKUT122.                                        00050000
000600 AUTHOR.         COGNIZANT.                                       00060000
000700 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00070000
000800 DATE-WRITTEN.   04/10.                                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* CALCULATE EXTENDED COST & RETAIL AMOUNTS                       *00120000
001300******************************************************************00130000
001400*     CHANGE LOG                                                 *00140000
001500******************************************************************00150000
001600*  DATE  03/22/10                    WR# 2344                    *00160000
001700*  CHANGE MADE:                                                  *00170000
001800*  THIS PROGRAM TAKE THE ACTIVE PO AND RECEIPT FILE CREATED      *00180000
001900*  FROM POKUT118 AND FORMAT THE DATA FOR LOADING INTO            *00190000
002000*  TAGING TABLES WHICH WILL BE SEND TO EP.                       *00200000
002100*                                                                *00210000
002200* 1.ACTIVE PO DATA WILL ALSO HAVE A NEW CATEGORIZATION FOR       *00220000
002300*   THE PAST DUE & REGULAR CATEGORY.                             *00230000
002400*   IE.BY FAST TRACK, REPLENISHMENT &  REGULAR CATEGORY.         *00240000
002500*                                                                *00250000
002600*   -IF THE PURCHASE ORDER TYPE CODE = 'IN' OR CODE IS 'EC' AND  *00260000
002700*     CRE-BY-UID IS 'INFOREM' WILL COME UNDER REPLENISHMENTS.    *00270000
002800*   -IF THE PURCHASE ORDER SHORT CYCLE INDICATOR IS 'Y', WILL    *00280000
002900*   -OTHERS TYPES WILL COME UNDER REGULAR CATEGORY.              *00290000
003000*                                                                *00300000
003100* 2.RECEIPT DATA   WILL ALSO HAVE A NEW CATEGORIZATION FOR       *00310000
003200*   THE EARLY AND THE REGULAR RECEIPT CATEGORY.                  *00320000
003300*   IE.BY FAST TRACK, REPLENISHMENT &  REGULAR CATEGORY.         *00330000
003400*                                                                *00340000
003500*   -IF THE PURCHASE ORDER TYPE CODE = 'IN' OR CODE IS 'EC' AND  *00350000
003600*     CRE-BY-UID IS 'INFOREM' WILL COME UNDER REPLENISHMENTS.    *00360000
003700*   -IF THE PURCHASE ORDER SHORT CYCLE INDICATOR IS 'Y', WILL    *00370000
003800*   -OTHERS TYPES WILL COME UNDER REGULAR CATEGORY.              *00380000
003900*                                                                *00390000
004000* 3.BOTH ACTIVE PO DATA AND RECEIPT DATA WILL BE BROKEN OUT BY   *00400000
004100*   BY VIRTUAL / PHYSICAL CHANNEL, BASED ON THE E_BUS_IND.       *00410000
004200******************************************************************00420000
004300* 04/12/12 MADE BY: COGNIZANT               WR/IR #: CRQ 23538    00430000
004400* CHANGES: CHANGED RECORD LAYOUT FOR PO RECORDS AND PO RECEIPT    00440000
004500* RECORDS. ADDED LOGIC TO CHECK FOR PO TYPE CODE OF 'EC' AND      00450000
004600* CREATED BY UID OF 'INFOREM' FOR PO REPLENISHMENT.               00460000
004700******************************************************************00470000
004800* 07/18/12 MADE BY: COGNIZANT               WR/IR #: CRQ 29188    00480000
004900* CHANGES: CHANGED RECORD LAYOUT FOR PO RECORDS. CHANGED LOGIC    00490000
005000* TO COMPARE PERIOD TO DETERMINE PAST DUE BUCKET.                 00500000
005100******************************************************************00510000
004800* 01/25/13 MADE BY: COGNIZANT               WR/IR #: CRQ 39703    00520000
004900* CHANGES: CHANGES DONE TO INCLUDE WEEK FIELD IN VALIDATION       00530000
005000* FOR RECEIPTS PROCESSING.                                        00540000
P41268******************************************************************00550000
P41268* 07/26/13 MADE BY: COGNIZANT               WR/IR #:CHG0058433    00560000
P41268* CHANGES: CHANGED THE LOGIC TO GET THE SEASON VALUE FOR          00570000
P41268* PO091-CALENDAR-NAME FIELD FROM PO016-VERIFIED-COUNT-DATE        00580000
P41268* INSTEAD OF CURRENT DATE FOR RECEIPTS PROCESSING.                00590000
      ******************************************************************00651000
C98147* 11/04/14 MADE BY: LINDA FRIESS            CHG0098147            00652000
C98147* CHANGES: RECOMPILED TO BRING IN POWS015 & POWS016 COPYBOOKS     00653000
C98147*          WITH EXPANDED PO NUMBER & REPLACED HARD-CODED          00654000
C98147*          REFERENCES TO POWS015 E-BUS-IND                        00655000
C98147***************************************************************** 00656000
      ******************************************************************00657000
C31343* 01/15/16 MADE BY: COGNIZANT               CHG0131343            00658000
C31343* CHANGES: MODIFIED THE PROGRAM POKUT119 TO INCLUDE WEEK          00659000
C31343*          WISE GROUP BY ALONG WITH MONTH AND YEAR TO PREVENT     00659100
C31343*          MISMATCH IN WEEK WISE DATA                             00659200
C31343***************************************************************** 00659300
11752A* 04/13/17 MADE BY: J. JAKSE                                      00660000
11752A* CHANGES: MODIFIED THE PROGRAM POKUT119 TO INCLUDE               00660100
11752A*          DIRECT SHIP, AS WELL AS PULL DATA WEEKLY RATHER        00660200
11752A*          THAN MONTH TO DATE                                     00660300
11752A******************************************************************00660400
11752A* 06/23/17 MADE BY: J SELWITSCHKA                                 00660500
11752A* CHANGES: NEW VERSION POKUT122 IS A COPY OF POKUT119 WITH EP     00660600
11752A*          UPGRADE CHANGES. CREATED BECAUSE EP UPGRADE VERSION    00660700
11752A*          WILL BE RUNNING IN PARALLEL WITH OLD VERSION.          00660800
11752A* 09/07/17 MADE BY: COGNIZANT                                     00660900
11752A* CHANGES: NEW CODES 'RE' 'LE' 'EC' 'VE' 'CD' 'IE' ADDED FOR      00661000
11752A*          VIRTUAL STORES JIRA SOTRY 1002                         00661100
91976A******************************************************************00661299
91976A* 03/06/18 MADE BY: J SELWITSCHKA                                 00661399
91976A* CHANGES: ASSIGN PO TYPE 'RE' TO REPLENISHMENT.                  00661499
005100******************************************************************00661600
005100******************************************************************00662000
005200 ENVIRONMENT DIVISION.                                            00670000
005300******************************************************************00680000
005400                                                                  00690000
005500******************************************************************00700000
005600 CONFIGURATION SECTION.                                           00710000
005700******************************************************************00720000
005800                                                                  00730000
005900 SOURCE-COMPUTER.        IBM-3090.                                00740000
006000 OBJECT-COMPUTER.        IBM-3090.                                00750000
006100                                                                  00760000
006200******************************************************************00770000
006300 INPUT-OUTPUT SECTION.                                            00780000
006400******************************************************************00790000
006500                                                                  00800000
006600 FILE-CONTROL.                                                    00810000
006700                                                                  00820000
006800     SELECT PO-EXTRACT-FILE                                       00830000
006900         ASSIGN TO INP01.                                         00840000
007000                                                                  00850000
007100     SELECT PO-RECEIPTS-FILE                                      00860000
007200         ASSIGN TO INP02.                                         00870000
007300                                                                  00880000
007400     SELECT OTB-PO-FILE                                           00890000
007500         ASSIGN TO OUT01.                                         00900000
007600                                                                  00910000
007700     SELECT OTB-RECPT-FILE                                        00920000
007800         ASSIGN TO OUT02.                                         00930000
007900                                                                  00940000
008000******************************************************************00950000
008100 DATA DIVISION.                                                   00960000
008200******************************************************************00970000
008300                                                                  00980000
008400******************************************************************00990000
008500 FILE SECTION.                                                    01000000
008600******************************************************************01010000
008700                                                                  01020000
008800 FD  PO-EXTRACT-FILE                                              01030000
008900     RECORDING MODE IS F                                          01040000
009000     LABEL RECORDS ARE OMITTED                                    01050000
009100     BLOCK CONTAINS 0 RECORDS.                                    01060000
009200                                                                  01070000
009300 01  PO-EXTRACT-RECORD                   PIC X(210).              01080000
009400                                                                  01090000
009500 FD  PO-RECEIPTS-FILE                                             01100000
009600     RECORDING MODE IS F                                          01110000
009700     LABEL RECORDS ARE OMITTED                                    01120000
009800     BLOCK CONTAINS 0 RECORDS.                                    01130000
009900                                                                  01140000
010000 01  PO-RECEIPTS-REC                     PIC X(108).              01150000
010100                                                                  01160000
010200 FD  OTB-PO-FILE                                                  01170000
010300     RECORDING MODE IS F                                          01180000
010400     LABEL RECORDS ARE STANDARD                                   01190000
010500     BLOCK CONTAINS 0 RECORDS.                                    01200000
010600                                                                  01210000
010700 01  OTB-PO-RECORD                       PIC X(300).              01220000
010800                                                                  01230000
010900 FD  OTB-RECPT-FILE                                               01240000
011000     RECORDING MODE IS F                                          01250000
011100     LABEL RECORDS ARE STANDARD                                   01260000
011200     BLOCK CONTAINS 0 RECORDS.                                    01270000
011300                                                                  01280000
011400 01  OTB-RECP-RECORD                     PIC X(300).              01290000
011500                                                                  01300000
011600******************************************************************01310000
011700 WORKING-STORAGE SECTION.                                         01320000
011800******************************************************************01330000
011900                                                                  01340000
012000 01  PS-PROGRAM-SWITCHES.                                         01350000
012100     05  PS-END-OF-PO-EXTRACT-SW   PIC X(01)  VALUE 'N'.          01360000
012200         88  PS-END-OF-PO-EXTRACT             VALUE 'Y'.          01370000
012300     05  PS-END-OF-PO-RECEIPTS-SW  PIC X(01)  VALUE 'N'.          01380000
012400         88  PS-END-OF-PO-RECEIPTS            VALUE 'Y'.          01390000
012500     05  PS-END-OF-DEPT-CURSOR-SW  PIC X(01)  VALUE 'N'.          01400000
012600         88  PS-END-OF-DEPT-CURSOR            VALUE 'Y'.          01410000
012700     05  PS-VALID-DEPT-CL-SW       PIC X(01)  VALUE 'N'.          01420000
012800         88  PS-VALID-DEPT-CL                 VALUE 'Y'.          01430000
012900                                                                  01440000
013000 01  PV-PROGRAM-VARIABLES.                                        01450000
013100     05  PV-RTL-VALUE              PIC S9(06)V9(05) VALUE ZERO.   01460000
013200     05  PV-CST-VALUE              PIC S9(06)V9(05) VALUE ZERO.   01470000
013300     05  PV-RTL-PAST-FASHION       PIC S9(06)V9(05) VALUE ZERO.   01480000
013400     05  PV-CST-PAST-FASHION       PIC S9(06)V9(05) VALUE ZERO.   01490000
013500     05  PV-RTL-PAST-FASTTRK       PIC S9(06)V9(05) VALUE ZERO.   01500000
013600     05  PV-CST-PAST-FASTTRK       PIC S9(06)V9(05) VALUE ZERO.   01510000
013700     05  PV-RTL-PAST-REPLEN        PIC S9(06)V9(05) VALUE ZERO.   01520000
013800     05  PV-CST-PAST-REPLEN        PIC S9(06)V9(05) VALUE ZERO.   01530000
013900     05  PV-RTL-CURR-FASHION       PIC S9(06)V9(05) VALUE ZERO.   01540000
014000     05  PV-CST-CURR-FASHION       PIC S9(06)V9(05) VALUE ZERO.   01550000
014100     05  PV-RTL-CURR-FASTTRK       PIC S9(06)V9(05) VALUE ZERO.   01560000
014200     05  PV-CST-CURR-FASTTRK       PIC S9(06)V9(05) VALUE ZERO.   01570000
014300     05  PV-RTL-CURR-REPLEN        PIC S9(06)V9(05) VALUE ZERO.   01580000
014400     05  PV-CST-CURR-REPLEN        PIC S9(06)V9(05) VALUE ZERO.   01590000
014500     05  PV-RTL-EARLY-RECREG       PIC S9(06)V9(05) VALUE ZERO.   01600000
014600     05  PV-CST-EARLY-RECREG       PIC S9(06)V9(05) VALUE ZERO.   01610000
014700     05  PV-RTL-EARLY-RECRPLN      PIC S9(06)V9(05) VALUE ZERO.   01620000
014800     05  PV-CST-EARLY-RECRPLN      PIC S9(06)V9(05) VALUE ZERO.   01630000
014900     05  PV-RTL-EARLY-RECFT        PIC S9(06)V9(05) VALUE ZERO.   01640000
015000     05  PV-CST-EARLY-RECFT        PIC S9(06)V9(05) VALUE ZERO.   01650000
015100     05  PV-RTL-REG-RECREG         PIC S9(06)V9(05) VALUE ZERO.   01660000
015200     05  PV-CST-REG-RECREG         PIC S9(06)V9(05) VALUE ZERO.   01670000
015300     05  PV-RTL-REG-RECRPLN        PIC S9(06)V9(05) VALUE ZERO.   01680000
015400     05  PV-CST-REG-RECRPLN        PIC S9(06)V9(05) VALUE ZERO.   01690000
015500     05  PV-RTL-REG-RECFT          PIC S9(06)V9(05) VALUE ZERO.   01700000
015600     05  PV-CST-REG-RECFT          PIC S9(06)V9(05) VALUE ZERO.   01710000
11752A     05  PV-RTL-REG-RECDS          PIC S9(06)V9(05) VALUE ZERO.   01711000
11752A     05  PV-CST-REG-RECDS          PIC S9(06)V9(05) VALUE ZERO.   01712000
015700     05  PV-EXT-DEPT-NBR           PIC X(03)        VALUE SPACE.  01720000
015800     05  PV-EXT-MAJOR-CLASS-NBR    PIC X(02)        VALUE SPACE.  01730000
015900     05  PV-RCP-DEPT-NBR           PIC X(03)        VALUE SPACE.  01740000
016000     05  PV-RCP-MAJOR-CLASS-NBR    PIC X(02)        VALUE SPACE.  01750000
016100     05  WS-RECP-REC-READ          PIC 9(09)        VALUE ZERO.   01760000
016200     05  WS-PO-REC-READ            PIC 9(09)        VALUE ZERO.   01770000
016300     05  WS-REC-WRITE              PIC 9(09)        VALUE ZERO.   01780000
016400     05  PV-E-BUS-IND              PIC X(01)        VALUE SPACES. 01790000
016500     05  PV-PO-TYP-CDE             PIC X(02)        VALUE SPACES. 01800000
016600     05  PV-CRE-BY-UID             PIC X(08)        VALUE SPACES. 01810000
016700     05  PV-EAR-REC-IND            PIC X(01)        VALUE SPACES. 01820000
C39703     05  PV-REC-WW                 PIC X(02)        VALUE SPACES. 01830000
016800                                                                  01840000
016900     05  PV-YEAR-PERIOD.                                          01850000
017000         10  PV-YEAR               PIC X(04)        VALUE SPACE.  01860000
017100         10  PV-PERIOD-NBR         PIC X(02)        VALUE SPACE.  01870000
017200         10  FILLER                PIC X(04)        VALUE SPACE.  01880000
017300                                                                  01890000
017400     05  PV-SEASON.                                               01900000
017500         10  PV-CURR-SEA1          PIC X            VALUE SPACE.  01910000
017600         10  PV-CURR-SEA2-6        PIC X(5)         VALUE SPACE.  01920000
017700                                                                  01930000
017800     05  PV-CURR-SEAS.                                            01940000
017900         15  PV-CURR-SEAS-SSN      PIC X(01).                     01950000
018000         15  PV-CURR-SEAS-YY       PIC 9(04).                     01960000
018100         10  FILLER                PIC X(01)        VALUE 'W'.    01970000
018200         10  PV-CURR-SEAS-PP       PIC 9(02).                     01980000
018300                                                                  01990000
           05  PV-CURR-WEEK.                                            02000000
               15  PV-CURR-WEEK-SSN      PIC X(01).                     02010000
               15  PV-CURR-WEEK-CC       PIC 9(02).                     02020000
               15  PV-CURR-WEEK-YY       PIC 9(02).                     02030000
               10  FILLER                PIC X(01)        VALUE 'W'.    02040000
               10  PV-CURR-WEEK-WW       PIC 9(02).                     02050000
                                                                        02060000
018400*** DATE DEFINITIONS                                              02070000
018500     05  PV-CURRENT-DATE.                                         02080000
018600         10 PV-CURRENT-YEAR        PIC X(04).                     02090000
018700         10 FILLER                 PIC X(01)        VALUE '-'.    02100000
018800         10 PV-CURRENT-MONTH       PIC X(02).                     02110000
018900         10 FILLER                 PIC X(01)        VALUE '-'.    02120000
019000         10 PV-CURRENT-DAY         PIC X(02).                     02130000
019100                                                                  02140000
019200     05  PV-DATE-COMPARE           REDEFINES                      02150000
019300         PV-CURRENT-DATE           PIC X(10).                     02160000
019400                                                                  02170000
019500     05  PV-YEAR-PERIOD1.                                         02180000
019600         10  PV-YEAR1              PIC X(04)        VALUE SPACE.  02190000
019700         10  FILLER                PIC X            VALUE '-'.    02200000
019800         10  PV-PERIOD-NBR1        PIC X(02)        VALUE SPACE.  02210000
019900                                                                  02220000
020000     05  PV-YEAR-PERIOD1-LONG      REDEFINES                      02230000
020100         PV-YEAR-PERIOD1           PIC X(07).                     02240000
020200                                                                  02250000
020300     05  PV-YEAR-PERIOD-WW1.                                      02260000
020400         10  PV-YEAR-PERIOD-CYM1   PIC X(07).                     02270000
020500         10  PV-YEAR-WW1           PIC X(02).                     02280000
020600                                                                  02290000
020700     05  PV-DIST-DATE.                                            02300000
020800         10  PV-DIST-CC            PIC X(02).                     02310000
020900         10  PV-DIST-YY            PIC X(02).                     02320000
021000         10  FILLER                PIC X(01)        VALUE '-'.    02330000
021100         10  PV-DIST-MM            PIC X(02).                     02340000
021200                                                                  02350000
021300     05  PV-DIST-DATE-LONG         REDEFINES                      02360000
021400         PV-DIST-DATE              PIC X(07).                     02370000
021500                                                                  02380000
021600     05  PV-DIST-DATE-WW.                                         02390000
021700         10  PV-DIST-DATE-CYM      PIC X(07).                     02400000
021800         10  PV-DIST-WW            PIC X(02).                     02410000
021900                                                                  02420000
022000     05  PO-DIST-DATE.                                            02430000
022100         10  PO-DIST-CC            PIC X(02).                     02440000
022200         10  PO-DIST-YY            PIC X(02).                     02450000
022300         10  FILLER                PIC X(01)        VALUE '-'.    02460000
022400         10  PO-DIST-MM            PIC X(02).                     02470000
022500                                                                  02480000
022600     05  PO-DIST-DATE-LONG         REDEFINES                      02490000
022700         PO-DIST-DATE              PIC X(07).                     02500000
022800                                                                  02510000
022900     05  PO-DIST-WW                PIC X(02).                     02520000
023000                                                                  02530000
023100******************************************************************02540000
023200*  COPYBOOK FOR THE CALENDAR ROUTINE                              02550000
023300******************************************************************02560000
023400     COPY DPWS500.                                                02570000
023500                                                                  02580000
023600******************************************************************02590000
023700* DB2 ERROR DEFINITIONS                                           02600000
023800******************************************************************02610000
023900     05  PV-DB2-OPER-ATTEMPTED     PIC X(30).                     02620000
024000     05  PV-PARAGRAPH-NAME         PIC X(30).                     02630000
024100     05  PV-ABEND-CODE             PIC S9(04) COMP                02640000
024200                                              VALUE ZERO.         02650000
024300                                                                  02660000
024400******************************************************************02670000
024500* INPUT CONTROL CARD DEFINITION                                   02680000
024600******************************************************************02690000
024700 01  CC-CONTROL-CARD.                                             02700000
024800     05  CC-PGMNAME                PIC X(08)      VALUE SPACES.   02710000
024900     05  FILLER                    PIC X(01)      VALUE SPACE.    02720000
025000     05  CC-RUNDATE                PIC X(08).                     02730000
025100     05  FILLER                    PIC X(63)      VALUE SPACES.   02740000
025200                                                                  02750000
025300******************************************************************02760000
025400* ML "VALID" DEPT/CLASSES TABLE.                                  02770000
025500******************************************************************02780000
025600 01  PV-VALID-DPT-ML-TABLE.                                       02790000
025700     05  PV-VALID-ENTRY            OCCURS 5000 TIMES              02800000
025800                                   INDEXED BY NDX.                02810000
025900        10 PV-VALID-DEPT           PIC X(03).                     02820000
026000        10 PV-VALID-CLASS          PIC X(02).                     02830000
026100                                                                  02840000
026200******************************************************************02850000
026300* FORMATTED OUTPUT RECORD LAYOUT FOR PO DATA.                     02860000
026400******************************************************************02870000
026500     COPY POWS090.                                                02880000
026600                                                                  02890000
026700******************************************************************02900000
026800* FORMATTED OUTPUT RECORD LAYOUT FOR RECEIPT DATA.                02910000
026900******************************************************************02920000
11752A*    COPY POWS091.                                                02930000
11752A     COPY POWS092.                                                02931000
027100                                                                  02940000
027200******************************************************************02950000
027300* INPUT PO EXTRACT FILE LAYOUT                                    02960000
027400******************************************************************02970000
027500     COPY POWS015.                                                02980000
027600                                                                  02990000
027700******************************************************************03000000
027800* INPUT RECEIPTS EXTRACT FILE LAYOUT                              03010000
027900******************************************************************03020000
028000     COPY POWS016.                                                03030000
028100                                                                  03040000
028200******************************************************************03050000
028300* APPLICATION AVAILABILITY TABLE                                  03060000
028400******************************************************************03070000
028500                                                                  03080000
028600     EXEC SQL                                                     03090000
028700         INCLUDE TAPLAVL                                          03100000
028800     END-EXEC.                                                    03110000
028900                                                                  03120000
029000******************************************************************03130000
029100* DATE ATTRIBUTE TABLE                                            03140000
029200******************************************************************03150000
029300                                                                  03160000
029400     EXEC SQL                                                     03170000
029500         INCLUDE TDTATTR                                          03180000
029600     END-EXEC.                                                    03190000
029700                                                                  03200000
029800******************************************************************03210000
029900*  MERCHANDISE AREA TABLE                                         03220000
030000******************************************************************03230000
030100                                                                  03240000
030200     EXEC SQL                                                     03250000
030300         INCLUDE TMDSEAR                                          03260000
030400     END-EXEC.                                                    03270000
030500                                                                  03280000
030600******************************************************************03290000
030700*  MERCHANDISE LEDGER DATE CONTROL TABLE                          03300000
030800******************************************************************03310000
030900                                                                  03320000
031000     EXEC SQL                                                     03330000
031100         INCLUDE TMLCNTL                                          03340000
031200     END-EXEC.                                                    03350000
031300                                                                  03360000
031400******************************************************************03370000
031500*  COMMUNICATION AREAS FOR DB2                                    03380000
031600******************************************************************03390000
031700                                                                  03400000
031800     EXEC SQL                                                     03410000
031900         INCLUDE SQLCA                                            03420000
032000     END-EXEC.                                                    03430000
032100                                                                  03440000
032200******************************************************************03450000
032300*  DB2 COMMUNICATION AREA 2                                       03460000
032400******************************************************************03470000
032500                                                                  03480000
032600     COPY SQLCA2.                                                 03490000
032700                                                                  03500000
032800******************************************************************03510000
032900*  ML VALID DEPT/CLASS CURSOR                                     03520000
033000******************************************************************03530000
033100                                                                  03540000
033200     EXEC SQL                                                     03550000
033300          DECLARE VALID-DEPT-CSR CURSOR FOR                       03560000
033400          SELECT  A.DEPT_NBR                                      03570000
033500                 ,A.MAJ_CL_NBR                                    03580000
033600            FROM  TMDSEAR A                                       03590000
033700                 ,TAPLAVL B                                       03600000
033800           WHERE  A.OPERCO_NBR      = '03'                        03610000
033900             AND  A.MDSELV_CDE      = 'MCL'                       03620000
034000             AND  :MLCNTL-PSTG-FSCL-WK-DTE                        03630000
034100                                     BETWEEN A.STRT_DTE           03640000
034200                                         AND A.END_DTE            03650000
034300             AND  A.MDSEAR_DKEY     = B.MDSEAR_DKEY               03660000
034400             AND  :MLCNTL-PSTG-FSCL-WK-DTE                        03670000
034500                                     BETWEEN B.MDSEAR_STRT_DTE    03680000
034600                                         AND B.MDSEAR_END_DTE     03690000
034700             AND  B.APLSYS_CDE      = 'ML'                        03700000
034800        ORDER BY  A.DEPT_NBR, A.MAJ_CL_NBR                        03710000
034900        WITH UR                                                   03720000
035000     END-EXEC.                                                    03730000
035100                                                                  03740000
035200 PROCEDURE DIVISION.                                              03750000
035300***************************************************************** 03760000
035400*   - MAINLINE PROCESSING                                       * 03770000
035500***************************************************************** 03780000
035600 0000-MAINLINE.                                                   03790000
035700                                                                  03800000
035800     PERFORM 1000-INITIALIZE.                                     03810000
035900                                                                  03820000
036000     PERFORM 2000-PROCESS-PO-EXTRACT-DATA                         03830000
036100             UNTIL PS-END-OF-PO-EXTRACT.                          03840000
036200                                                                  03850000
036300     PERFORM 2200-WRITE-EXT-OUTPUT-RECORD.                        03860000
036400                                                                  03870000
036500     PERFORM 3000-PROCESS-PO-RECEIPTS-DATA                        03880000
036600             UNTIL PS-END-OF-PO-RECEIPTS.                         03890000
036700                                                                  03900000
036800     PERFORM 3200-WRITE-RCP-OUTPUT-RECORD.                        03910000
036900                                                                  03920000
037000     PERFORM 8400-END-OF-JOB.                                     03930000
037100                                                                  03940000
037200     GOBACK.                                                      03950000
037300                                                                  03960000
037400******************************************************************03970000
037500*  OPEN INPUT AND OUTPUT FILES AND PERFORM THE INITIAL READS     *03980000
037600******************************************************************03990000
037700 1000-INITIALIZE.                                                 04000000
037800                                                                  04010000
037900     INITIALIZE  POWS090-RECORD                                   04020000
038000                 POWS091-RECORD                                   04030000
038100     OPEN INPUT  PO-EXTRACT-FILE                                  04040000
038200                 PO-RECEIPTS-FILE                                 04050000
038300          OUTPUT OTB-PO-FILE                                      04060000
038400                 OTB-RECPT-FILE.                                  04070000
038500                                                                  04080000
038600     PERFORM 1100-DATE-PROCESSING.                                04090000
038700                                                                  04100000
038800     PERFORM 1200-OPEN-VALID-DEPT-CURSOR.                         04110000
038900                                                                  04120000
039000     PERFORM 8000-READ-PO-EXTRACT-RECORD.                         04130000
039100                                                                  04140000
039200     PERFORM 8200-CHECK-FOR-VALID-DEPT.                           04150000
039300                                                                  04160000
039400     MOVE PO015-DEPT         TO PV-EXT-DEPT-NBR.                  04170000
039500     MOVE PO015-MAJOR-CLASS  TO PV-EXT-MAJOR-CLASS-NBR.           04180000
C98147     MOVE PO015-E-BUS-IND    TO PV-E-BUS-IND.                     04190000
039700     MOVE PO015-PO-TYP-CDE   TO PV-PO-TYP-CDE.                    04200000
039800     MOVE PO015-CRE-BY-UID   TO PV-CRE-BY-UID.                    04210000
039900     MOVE PO015-DIST-YY      TO PV-DIST-YY.                       04220000
040000     MOVE PO015-DIST-MM      TO PV-DIST-MM.                       04230000
040100     MOVE PO015-DIST-WW      TO PV-DIST-WW.                       04240000
040200     IF PV-DIST-YY  > 80                                          04250000
040300        MOVE '19'            TO PV-DIST-CC                        04260000
040400     ELSE                                                         04270000
040500        MOVE '20'            TO PV-DIST-CC                        04280000
040600     END-IF                                                       04290000
040700                                                                  04300000
040800     PERFORM 8100-READ-PO-RECEIPTS-RECORD.                        04310000
040900                                                                  04320000
041000******************************************************************04330000
041100*  DATE PROCESSING.                                               04340000
041200******************************************************************04350000
041300 1100-DATE-PROCESSING.                                            04360000
041400                                                                  04370000
041500     ACCEPT CC-CONTROL-CARD.                                      04380000
041600                                                                  04390000
041700     DISPLAY 'INPUT CONTROL CARD = ', CC-CONTROL-CARD.            04400000
041800                                                                  04410000
041900     IF CC-PGMNAME = 'POKUT122'                                   04420000
042000       CONTINUE                                                   04430000
042100     ELSE                                                         04440000
042200       MOVE '1100-DATE-PROCESSING' TO PV-PARAGRAPH-NAME           04450000
042300       MOVE 'INVALID CONTROL CARD'                                04460000
042400                                   TO PV-DB2-OPER-ATTEMPTED       04470000
042500       PERFORM 9999-SQL-ABEND                                     04480000
042600     END-IF.                                                      04490000
042700                                                                  04500000
042800     MOVE CC-RUNDATE (1:4)         TO PV-CURRENT-YEAR.            04510000
042900     MOVE CC-RUNDATE (5:2)         TO PV-CURRENT-MONTH.           04520000
043000     MOVE CC-RUNDATE (7:2)         TO PV-CURRENT-DAY.             04530000
043100*                                                                 04540000
043200     EXEC SQL                                                     04550000
043300          SELECT                                                  04560000
043400              FSCL_YR_NBR                                         04570000
043500             ,FSCL_MN_NBR                                         04580000
043600          INTO                                                    04590000
043700              :DTATTR-FSCL-YR-NBR                                 04600000
043800             ,:DTATTR-FSCL-MN-NBR                                 04610000
043900          FROM                                                    04620000
044000              TDTATTR                                             04630000
044100          WHERE                                                   04640000
044200              KY_DTE = :PV-DATE-COMPARE                           04650000
044300        WITH UR                                                   04660000
044400     END-EXEC.                                                    04670000
044500                                                                  04680000
044600     EVALUATE TRUE                                                04690000
044700         WHEN SQLCODE = ZERO                                      04700000
044800             MOVE DTATTR-FSCL-YR-NBR      TO PV-YEAR              04710000
044900             MOVE DTATTR-FSCL-MN-NBR      TO PV-PERIOD-NBR        04720000
045000             DISPLAY ' '                                          04730000
045100             DISPLAY 'PROCESSING FISCAL YEAR ' PV-YEAR            04740000
045200                     ',FISCAL MONTH '          PV-PERIOD-NBR      04750000
045300             DISPLAY ' '                                          04760000
045400         WHEN OTHER                                               04770000
045500             MOVE    '1100-DATE-PROCESSING'                       04780000
045600                                          TO PV-PARAGRAPH-NAME    04790000
045700             MOVE    'SELECT ROW FROM TDTATTR'                    04800000
045800                                          TO PV-DB2-OPER-ATTEMPTED04810000
045900             PERFORM 9999-SQL-ABEND                               04820000
046000     END-EVALUATE.                                                04830000
046100                                                                  04840000
046200     PERFORM 1105-LOOKUP-DATES.                                   04850000
046300                                                                  04860000
046400     PERFORM 1150-GET-PROCESSING-DATE.                            04870000
046500                                                                  04880000
046600******************************************************************04890000
046700*  GET CURRENT FISCAL PERIOD AND YEAR USING TODAY'S DATE          04900000
046800******************************************************************04910000
046900 1105-LOOKUP-DATES.                                               04920000
047000                                                                  04930000
047100     INITIALIZE DPG51                                             04940000
047200                DPG52                                             04950000
047300                DPG53                                             04960000
047400                DPG54                                             04970000
047500                DPG55                                             04980000
047600                DPG56.                                            04990000
047700                                                                  05000000
047800     MOVE PV-DATE-COMPARE                 TO DPG52-LK-DATE-INPUT. 05010000
047900     SET DPG51-FISCAL-454-CALENDAR        TO TRUE.                05020000
048000     SET DPG52-LK-DTE-ISO-FMT             TO TRUE.                05030000
048100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                05040000
048200                                             DPG52                05050000
048300                                             DPG53                05060000
048400                                             DPG54                05070000
048500                                             DPG55                05080000
048600                                             DPG56.               05090000
048700*                                                                 05100000
048800     EVALUATE TRUE                                                05110000
048900         WHEN DPG54-NO-ERROR                                      05120000
049000            MOVE DPG56-FISCAL-PERIOD-NBR  TO PV-PERIOD-NBR1       05130000
049100            MOVE DPG56-FISCAL-WEEK-NBR    TO PV-YEAR-WW1          05140000
049200            MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-YEAR1             05150000
049300            MOVE DPG56-CURR-FISCAL-SEASON TO PV-SEASON            05160000
049400            DISPLAY 'CURRENT MONTH = ',                           05170000
049500             PV-YEAR-PERIOD1 ', ' PV-SEASON                       05180000
049600         WHEN (DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID)          05190000
049700             DISPLAY '** ABEND ** IN POKUT122'                    05200000
049800             DISPLAY '1105-LOOKUP-DATES'                          05210000
049900             DISPLAY 'DATE USED AS INPUT ' DPG52-LK-DATE-INPUT    05220000
050000             DISPLAY 'ERROR CALLING THE CALENDAR ROUTINE'         05230000
050100             DISPLAY 'DATE TODAY = ' DPG52-DB2-ISO-DATE           05240000
050200             CALL 'ILBOABN0' USING PV-ABEND-CODE                  05250000
050300         END-EVALUATE.                                            05260000
050400******************************************************************05270000
050500*  SET UP OUTPUT FOR CURRENT SEASON.                              05280000
050600******************************************************************05290000
050700     MOVE PV-CURR-SEA1          TO PV-CURR-SEAS-SSN.              05300000
           MOVE PV-CURR-SEA1          TO PV-CURR-WEEK-SSN.              05310000
050800     MOVE PV-YEAR1              TO PV-CURR-SEAS-YY.               05320000
050900     MOVE DPG56-FISCAL-WEEK-NBR TO PV-CURR-SEAS-PP.               05330000
051000                                                                  05340000
051100******************************************************************05350000
051200*  GET PROCESSING DATE                                           *05360000
051300******************************************************************05370000
051400 1150-GET-PROCESSING-DATE.                                        05380000
051500                                                                  05390000
051600     EXEC SQL                                                     05400000
051700          SELECT                                                  05410000
051800                 PSTG_FSCL_WK_DTE                                 05420000
051900            INTO                                                  05430000
052000                 :MLCNTL-PSTG-FSCL-WK-DTE                         05440000
052100            FROM                                                  05450000
052200                 TMLCNTL                                          05460000
052300        WITH UR                                                   05470000
052400     END-EXEC.                                                    05480000
052500                                                                  05490000
052600     EVALUATE TRUE                                                05500000
052700         WHEN SQLCODE = ZERO                                      05510000
052800             CONTINUE                                             05520000
052900         WHEN OTHER                                               05530000
053000             MOVE '1150-GET-PROCESSING-DATE' TO PV-PARAGRAPH-NAME 05540000
053100             MOVE 'SELECT ROW FROM TMLCNTL'  TO                   05550000
053200                                             PV-DB2-OPER-ATTEMPTED05560000
053300             PERFORM 9999-SQL-ABEND                               05570000
053400     END-EVALUATE.                                                05580000
053500                                                                  05590000
053600******************************************************************05600000
053700*  OPEN VALID DEPT CURSOR                                        *05610000
053800******************************************************************05620000
053900 1200-OPEN-VALID-DEPT-CURSOR.                                     05630000
054000                                                                  05640000
054100     EXEC SQL                                                     05650000
054200         OPEN VALID-DEPT-CSR                                      05660000
054300     END-EXEC.                                                    05670000
054400                                                                  05680000
054500     PERFORM 1210-LOAD-VALID-DEPT-TABLE                           05690000
054600             UNTIL PS-END-OF-DEPT-CURSOR.                         05700000
054700                                                                  05710000
054800******************************************************************05720000
054900*  FETCH AND LOAD THE VALID DEPT INTO THE INTERNAL TABLE         *05730000
055000******************************************************************05740000
055100 1210-LOAD-VALID-DEPT-TABLE.                                      05750000
055200                                                                  05760000
055300     EXEC SQL                                                     05770000
055400         FETCH VALID-DEPT-CSR                                     05780000
055500         INTO  :MDSEAR-DEPT-NBR                                   05790000
055600              ,:MDSEAR-MAJ-CL-NBR                                 05800000
055700     END-EXEC.                                                    05810000
055800                                                                  05820000
055900     EVALUATE SQLCODE                                             05830000
056000         WHEN ZERO                                                05840000
056100             MOVE MDSEAR-DEPT-NBR           TO PV-VALID-DEPT(NDX) 05850000
056200             MOVE MDSEAR-MAJ-CL-NBR         TO PV-VALID-CLASS(NDX)05860000
056300             SET NDX UP BY 1                                      05870000
056400         WHEN +100                                                05880000
056500             SET PS-END-OF-DEPT-CURSOR      TO TRUE               05890000
056600         WHEN OTHER                                               05900000
056700             MOVE '1210-LOAD-VALID-DEPT-TABLE'                    05910000
056800                                            TO PV-PARAGRAPH-NAME  05920000
056900             PERFORM 9999-SQL-ABEND                               05930000
057000     END-EVALUATE.                                                05940000
057100                                                                  05950000
057200******************************************************************05960000
057300*  PROCESS ALL PO EXTRACT DATA                                   *05970000
057400******************************************************************05980000
057500 2000-PROCESS-PO-EXTRACT-DATA.                                    05990000
057600                                                                  06000000
057700     MOVE PO015-DIST-YY          TO PO-DIST-YY.                   06010000
057800     MOVE PO015-DIST-MM          TO PO-DIST-MM.                   06020000
057900     MOVE PO015-DIST-WW          TO PO-DIST-WW.                   06030000
058000                                                                  06040000
058100     IF PO-DIST-YY  > 80                                          06050000
058200        MOVE '19'                TO PO-DIST-CC                    06060000
058300     ELSE                                                         06070000
058400        MOVE '20'                TO PO-DIST-CC                    06080000
058500     END-IF.                                                      06090000
058600                                                                  06100000
058700     IF  PO015-DEPT           = PV-EXT-DEPT-NBR                   06110000
058800     AND PO015-MAJOR-CLASS    = PV-EXT-MAJOR-CLASS-NBR            06120000
C98147     AND PO015-E-BUS-IND      = PV-E-BUS-IND                      06130000
059000     AND PO015-PO-TYP-CDE     = PV-PO-TYP-CDE                     06140000
059100     AND (((PO015-DIST-YY     = PV-DIST-YY )                      06150000
           AND  (PO015-DIST-WW      = PV-DIST-WW )                      06151000
059200     AND  (PO015-DIST-MM      = PV-DIST-MM ))                     06160000
059300     OR   ((PV-DIST-DATE-LONG <= PV-YEAR-PERIOD1 )                06170000
059400     AND   (PO-DIST-DATE-LONG <= PV-YEAR-PERIOD1 )))              06180000
059500            IF  PS-VALID-DEPT-CL                                  06190000
059600                PERFORM 2100-ADD-EXT-TOTALS                       06200000
059700            END-IF                                                06210000
059800     ELSE                                                         06220000
059900         IF  PS-VALID-DEPT-CL                                     06230000
060000             PERFORM 2200-WRITE-EXT-OUTPUT-RECORD                 06240000
060100         END-IF                                                   06250000
060200         MOVE PO015-DEPT         TO PV-EXT-DEPT-NBR               06260000
060300         MOVE PO015-MAJOR-CLASS  TO PV-EXT-MAJOR-CLASS-NBR        06270000
C98147         MOVE PO015-E-BUS-IND    TO PV-E-BUS-IND                  06280000
060500         MOVE PO015-PO-TYP-CDE   TO PV-PO-TYP-CDE                 06290000
060600         MOVE PO015-DIST-YY      TO PV-DIST-YY                    06300000
060700         MOVE PO015-DIST-MM      TO PV-DIST-MM                    06310000
060800         MOVE PO015-DIST-WW      TO PV-DIST-WW                    06320000
060900         IF PV-DIST-YY  > 80                                      06330000
061000            MOVE '19'            TO PV-DIST-CC                    06340000
061100         ELSE                                                     06350000
061200            MOVE '20'            TO PV-DIST-CC                    06360000
061300         END-IF                                                   06370000
061400         PERFORM 8200-CHECK-FOR-VALID-DEPT                        06380000
061500         IF  PS-VALID-DEPT-CL                                     06390000
061600             PERFORM 2100-ADD-EXT-TOTALS                          06400000
061700         END-IF                                                   06410000
061800     END-IF.                                                      06420000
061900                                                                  06430000
062000     PERFORM 8000-READ-PO-EXTRACT-RECORD.                         06440000
062100                                                                  06450000
062200******************************************************************06460000
062300*  ADD PO RECORD TO PROPER TOTAL BUCKET                          *06470000
062400******************************************************************06480000
062500 2100-ADD-EXT-TOTALS.                                             06490000
062600                                                                  06500000
062700     MOVE PO015-DIST-YY          TO PV-DIST-YY.                   06510000
062800     MOVE PO015-DIST-MM          TO PV-DIST-MM.                   06520000
062900     MOVE PO015-DIST-WW          TO PV-DIST-WW.                   06530000
063000                                                                  06540000
063100******************************************************************06550000
063200*  USE Y2K LOGIC TO DETERMINE THE CENTURY                        *06560000
063300******************************************************************06570000
063400     IF PV-DIST-YY  > 80                                          06580000
063500        MOVE '19' TO PV-DIST-CC                                   06590000
063600     ELSE                                                         06600000
063700        MOVE '20' TO PV-DIST-CC                                   06610000
063800     END-IF.                                                      06620000
063900                                                                  06630000
064000******************************************************************06640000
064100*  PROCESS EACH RECORD AND ADD TOTALS TO APPROPRIATE BUCKETS:    *06650000
064200******************************************************************06660000
064300                                                                  06670000
064400     DIVIDE PO015-OPEN-RTL  BY 1000 GIVING PV-RTL-VALUE           06680000
064500     DIVIDE PO015-OPEN-COST BY 1000 GIVING PV-CST-VALUE           06690000
064600                                                                  06700000
064700******************************************************************06710000
064800*  - DISTRIBUTION DATE <  CURRENT FISCAL WEEK                     06720000
064900*      CARRY OVER DATA FOR CURRENT MONTH                          06730000
065000*                                                                 06740000
065100*  - DISTRIBUTION DATE  >= CURRENT FISCAL WEEK                    06750000
065200*      CURRENTLY WRITTEN DATA FOR CURRENT MONTH                   06760000
065300******************************************************************06770000
065400     IF (PO015-PO-TYP-CDE = 'IN') OR                              06780000
91976A        (PO015-PO-TYP-CDE = 'RE') OR                              06781099
065500        (PO015-PO-TYP-CDE = 'EC' AND PO015-CRE-BY-UID = 'INFOREM')06790000
065600        IF PV-DIST-DATE-LONG <  PV-YEAR-PERIOD1                   06800000
065700           ADD PV-RTL-VALUE    TO PV-RTL-PAST-REPLEN              06810000
065800           ADD PV-CST-VALUE    TO PV-CST-PAST-REPLEN              06820000
065900        ELSE                                                      06830000
066000           ADD PV-RTL-VALUE    TO PV-RTL-CURR-REPLEN              06840000
066100           ADD PV-CST-VALUE    TO PV-CST-CURR-REPLEN              06850000
066200        END-IF                                                    06860000
066300     ELSE                                                         06870000
066400        IF PO015-PO-SHRT-CYC-IND = 'Y'                            06880000
066500         IF PV-DIST-DATE-LONG <  PV-YEAR-PERIOD1                  06890000
066600           ADD PV-RTL-VALUE    TO PV-RTL-PAST-FASTTRK             06900000
066700           ADD PV-CST-VALUE    TO PV-CST-PAST-FASTTRK             06910000
066800         ELSE                                                     06920000
066900           ADD PV-RTL-VALUE    TO PV-RTL-CURR-FASTTRK             06930000
067000           ADD PV-CST-VALUE    TO PV-CST-CURR-FASTTRK             06940000
067100         END-IF                                                   06950000
067200        ELSE                                                      06960000
067300         IF PV-DIST-DATE-LONG <  PV-YEAR-PERIOD1                  06970000
067400           ADD PV-RTL-VALUE    TO PV-RTL-PAST-FASHION             06980000
067500           ADD PV-CST-VALUE    TO PV-CST-PAST-FASHION             06990000
067600         ELSE                                                     07000000
067700           ADD PV-RTL-VALUE    TO PV-RTL-CURR-FASHION             07010000
067800           ADD PV-CST-VALUE    TO PV-CST-CURR-FASHION             07020000
067900         END-IF                                                   07030000
068000        END-IF                                                    07040000
068100     END-IF.                                                      07050000
068200******************************************************************07060000
068300*  WRITE POWS090 EXTRACT OUTPUT RECORD                            07070000
068400***************************************************************** 07080000
068500 2200-WRITE-EXT-OUTPUT-RECORD.                                    07090000
068600                                                                  07100000
068700     STRING  'C'   PV-EXT-DEPT-NBR  '_'                           07110000
068800             PV-EXT-MAJOR-CLASS-NBR DELIMITED BY SPACE            07120000
068900             INTO PO090-PRODUCT-NAME                              07130000
069000                                                                  07140000
069100     MOVE PV-DIST-CC               TO DTATTR-FSCL-YR-NBR(1:2)     07150000
069200     MOVE PV-DIST-YY               TO DTATTR-FSCL-YR-NBR(3:2)     07160000
069300     MOVE PV-DIST-WW               TO DTATTR-FSCL-WK-NBR          07170000
069400                                                                  07180000
069500******************************************************************07190000
069600*  BASED ON THE E BUSINESS INDICATOR POPULATE THE PHYSICAL AND    07200000
069700*  VIRTUAL STORE.                                                 07210000
069800******************************************************************07220000
069900     IF (PV-E-BUS-IND = 'Y') OR                                   07230000
070010       (PV-PO-TYP-CDE = 'EC' OR 'IE' OR 'LE' OR 'RE' OR 'VE' OR   07231000
070020                        'CD')                                     07232000
070030         MOVE  'VIRTSTR'           TO  PO090-ORGANIZATION-NAME    07239100
070100     ELSE                                                         07239200
070200         MOVE  'PHYSSTR'           TO  PO090-ORGANIZATION-NAME    07239800
070300     END-IF.                                                      07239900
070400                                                                  07280000
070500     IF ( PV-RTL-PAST-FASTTRK  = 0 ) AND                          07290000
070600        ( PV-CST-PAST-FASTTRK  = 0 ) AND                          07300000
070700        ( PV-RTL-PAST-FASHION  = 0 ) AND                          07310000
070800        ( PV-CST-PAST-FASHION  = 0 ) AND                          07320000
070900        ( PV-RTL-PAST-REPLEN   = 0 ) AND                          07330000
071000        ( PV-CST-PAST-REPLEN   = 0 ) AND                          07340000
071100        ( PV-RTL-CURR-FASHION  = 0 ) AND                          07350000
071200        ( PV-CST-CURR-FASHION  = 0 ) AND                          07360000
071300        ( PV-RTL-CURR-FASTTRK  = 0 ) AND                          07370000
071400        ( PV-CST-CURR-FASTTRK  = 0 ) AND                          07380000
071500        ( PV-RTL-CURR-REPLEN   = 0 ) AND                          07390000
071600        ( PV-CST-CURR-REPLEN   = 0 )                              07400000
071700         CONTINUE                                                 07410000
071800      ELSE                                                        07420000
071900           MOVE PV-RTL-PAST-FASTTRK TO PO090-PASTDUEFT-DLR        07430000
072000           MOVE PV-CST-PAST-FASTTRK TO PO090-PASTDUEFT-CST        07440000
072100           MOVE PV-RTL-PAST-FASHION TO PO090-PASTDUEREG-DLR       07450000
072200           MOVE PV-CST-PAST-FASHION TO PO090-PASTDUEREG-CST       07460000
072300           MOVE PV-RTL-PAST-REPLEN  TO PO090-PASTDUERPLN-DLR      07470000
072400           MOVE PV-CST-PAST-REPLEN  TO PO090-PASTDUERPLN-CST      07480000
072500           MOVE PV-RTL-CURR-FASHION TO PO090-CURWREG-DLR          07490000
072600           MOVE PV-CST-CURR-FASHION TO PO090-CURWREG-CST          07500000
072700           MOVE PV-RTL-CURR-FASTTRK TO PO090-CURWFT-DLR           07510000
072800           MOVE PV-CST-CURR-FASTTRK TO PO090-CURWFT-CST           07520000
072900           MOVE PV-RTL-CURR-REPLEN  TO PO090-CURWRPLN-DLR         07530000
073000           MOVE PV-CST-CURR-REPLEN  TO PO090-CURWRPLN-CST         07540000
073100                                                                  07550000
073200           MOVE PV-DIST-DATE-LONG TO PV-DIST-DATE-CYM             07560000
073300           MOVE PV-YEAR-PERIOD1   TO PV-YEAR-PERIOD-CYM1          07570000
073400                                                                  07580000
073500         IF PV-DIST-DATE-WW < PV-YEAR-PERIOD-WW1                  07590000
073600              MOVE PV-CURR-SEAS     TO PO090-CALENDAR-NAME        07600000
073700         ELSE                                                     07610000
073800              PERFORM 2210-GET-OTB-SEASON                         07620000
073900              STRING  DTATTR-SEA-DESC(1:1) PV-DIST-CC             07630000
074000                      PV-DIST-YY  'W' PV-DIST-WW                  07640000
074100                      DELIMITED BY SPACE                          07650000
074200                      INTO PO090-CALENDAR-NAME                    07660000
074300                                                                  07670000
074400         END-IF                                                   07680000
074500         PERFORM 8300-WRITE-OTB-PO                                07690000
074600      END-IF.                                                     07700000
074700      MOVE ZEROES                   TO PV-RTL-PAST-FASTTRK        07710000
074800                                       PV-CST-PAST-FASTTRK        07720000
074900                                       PV-RTL-PAST-FASHION        07730000
075000                                       PV-CST-PAST-FASHION        07740000
075100                                       PV-RTL-PAST-REPLEN         07750000
075200                                       PV-CST-PAST-REPLEN         07760000
075300                                       PV-RTL-CURR-FASHION        07770000
075400                                       PV-CST-CURR-FASHION        07780000
075500                                       PV-RTL-CURR-FASTTRK        07790000
075600                                       PV-CST-CURR-FASTTRK        07800000
075700                                       PV-RTL-CURR-REPLEN         07810000
075800                                       PV-CST-CURR-REPLEN .       07820000
075900                                                                  07830000
076000******************************************************************07840000
076100*  GET THE OTB FISCAL SEASON.                                     07850000
076200******************************************************************07860000
076300 2210-GET-OTB-SEASON.                                             07870000
076400                                                                  07880000
076500     INITIALIZE DTATTR-SEA-DESC                                   07890000
076600     EXEC SQL                                                     07900000
076700          SELECT  DISTINCT                                        07910000
076800              SEA_DESC                                            07920000
076900          INTO                                                    07930000
077000              :DTATTR-SEA-DESC                                    07940000
077100          FROM                                                    07950000
077200              TDTATTR                                             07960000
077300          WHERE                                                   07970000
077400              FSCL_WK_NBR = :DTATTR-FSCL-WK-NBR   AND             07980000
077500              FSCL_YR_NBR = :DTATTR-FSCL-YR-NBR                   07990000
077600          WITH UR                                                 08000000
077700     END-EXEC.                                                    08010000
077800                                                                  08020000
077900     IF SQLCODE NOT = 0                                           08030000
078000          MOVE       '2210-GET-OTB-SEASON'                        08040000
078100                                       TO PV-PARAGRAPH-NAME       08050000
078200          MOVE       'SELECT ROW FROM TDTATTR'                    08060000
078300                                       TO PV-DB2-OPER-ATTEMPTED   08070000
                DISPLAY 'PO NUMBER:'       PO015-PO-NUMBER              08071000
078400          DISPLAY 'FISCAL WEEK NO:'  DTATTR-FSCL-WK-NBR           08080000
078500          DISPLAY 'FISCAL YEAR:'     DTATTR-FSCL-YR-NBR           08090000
078600          PERFORM  9999-SQL-ABEND                                 08100000
078700     END-IF.                                                      08110000
078800******************************************************************08120000
078900*  PROCESS ALL PO RECEIPTS DATA                                  *08130000
079000******************************************************************08140000
079100 3000-PROCESS-PO-RECEIPTS-DATA.                                   08150000
079200                                                                  08160000
079300     IF  PO016-DEPT       = PV-RCP-DEPT-NBR                       08170000
079400     AND PO016-CLASS      = PV-RCP-MAJOR-CLASS-NBR                08180000
079500     AND PO016-E-BUS-IND  = PV-E-BUS-IND                          08190000
079600     AND PO016-PO-TYP-CDE = PV-PO-TYP-CDE                         08200000
C39703     AND PO016-WW         = PV-REC-WW                             08210000
079700         PERFORM 3100-ADD-RCP-TOTALS                              08220000
079800     ELSE                                                         08230000
079900         IF  PV-RCP-DEPT-NBR NOT = SPACES                         08240000
080000             PERFORM 3200-WRITE-RCP-OUTPUT-RECORD                 08250000
080100         END-IF                                                   08260000
080200         MOVE PO016-DEPT         TO PV-RCP-DEPT-NBR               08270000
080300         MOVE PO016-CLASS        TO PV-RCP-MAJOR-CLASS-NBR        08280000
080400         MOVE PO016-E-BUS-IND    TO PV-E-BUS-IND                  08290000
080500         MOVE PO016-PO-TYP-CDE   TO PV-PO-TYP-CDE                 08300000
080600         MOVE PO016-EAR-REC-IND  TO PV-EAR-REC-IND                08310000
C39703         MOVE PO016-WW           TO PV-REC-WW                     08320000
080700         PERFORM 3100-ADD-RCP-TOTALS                              08330000
080800     END-IF.                                                      08340000
080900                                                                  08350000
081000     PERFORM 8100-READ-PO-RECEIPTS-RECORD.                        08360000
081100                                                                  08370000
081200******************************************************************08380000
081300*  ADD RECEIPT RECORD TO PROPER TOTAL BUCKET                     *08390000
081400******************************************************************08400000
081500 3100-ADD-RCP-TOTALS.                                             08410000
081600                                                                  08420000
           MOVE PO016-YY          TO PV-CURR-WEEK-YY.                   08430000
           MOVE PO016-WW          TO PV-CURR-WEEK-WW.                   08440000
                                                                        08450000
      ******************************************************************08460000
      *  USE Y2K LOGIC TO DETERMINE THE CENTURY                        *08470000
      ******************************************************************08480000
           IF PV-CURR-WEEK-YY > 80                                      08490000
              MOVE '19' TO PV-CURR-WEEK-CC                              08500000
           ELSE                                                         08510000
              MOVE '20' TO PV-CURR-WEEK-CC                              08520000
           END-IF.                                                      08530000
                                                                        08540000
081700     DIVIDE PO016-RETAIL    BY 1000 GIVING PV-RTL-VALUE.          08550000
081800     DIVIDE PO016-COST      BY 1000 GIVING PV-CST-VALUE.          08560000
081900                                                                  08570000
11752A*ADD DIRECT SHIP BUCKET                                           08570100
11752A     IF PO016-PO-TYP-CDE = 'CD'                                   08571000
11752A        ADD PV-RTL-VALUE     TO PV-RTL-REG-RECDS                  08572000
11752A        ADD PV-CST-VALUE     TO PV-CST-REG-RECDS                  08573000
11752A     END-IF                                                       08574000
11752A                                                                  08576000
082000     IF (PO016-PO-TYP-CDE = 'IN') OR                              08580000
91976A        (PO016-PO-TYP-CDE = 'RE') OR                              08581099
082100        (PO016-PO-TYP-CDE = 'EC' AND PO016-CRE-BY-UID = 'INFOREM')08590000
082200        IF  PO016-EAR-REC-IND   = 'Y'                             08600000
082300           ADD PV-RTL-VALUE     TO PV-RTL-EARLY-RECRPLN           08610000
082400           ADD PV-CST-VALUE     TO PV-CST-EARLY-RECRPLN           08620000
082500        ELSE                                                      08630000
082600           ADD PV-RTL-VALUE     TO PV-RTL-REG-RECRPLN             08640000
082700           ADD PV-CST-VALUE     TO PV-CST-REG-RECRPLN             08650000
082800        END-IF                                                    08660000
082900     ELSE                                                         08670000
083000        IF PO016-PO-SHRT-CYC-IND   = 'Y'                          08680000
083100           IF  PO016-EAR-REC-IND   = 'Y'                          08690000
083200               ADD PV-RTL-VALUE TO PV-RTL-EARLY-RECFT             08700000
083300               ADD PV-CST-VALUE TO PV-CST-EARLY-RECFT             08710000
083400           ELSE                                                   08720000
083500               ADD PV-RTL-VALUE TO PV-RTL-REG-RECFT               08730000
083600               ADD PV-CST-VALUE TO PV-CST-REG-RECFT               08740000
083700           END-IF                                                 08750000
083800        ELSE                                                      08760000
083900           IF  PO016-EAR-REC-IND   = 'Y'                          08770000
084000              ADD PV-RTL-VALUE  TO PV-RTL-EARLY-RECREG            08780000
084100              ADD PV-CST-VALUE  TO PV-CST-EARLY-RECREG            08790000
084200           ELSE                                                   08800000
084300              ADD PV-RTL-VALUE  TO PV-RTL-REG-RECREG              08810000
084400              ADD PV-CST-VALUE  TO PV-CST-REG-RECREG              08820000
084500           END-IF                                                 08830000
084600        END-IF                                                    08840000
084700     END-IF.                                                      08850000
084800                                                                  08860000
084900******************************************************************08870000
085000*  WRITE OUTPUT RECEIPT RECORD                                   *08880000
085100******************************************************************08890000
085200 3200-WRITE-RCP-OUTPUT-RECORD.                                    08900000
085300                                                                  08910000
085400     STRING  'C'   PV-RCP-DEPT-NBR  '_'                           08920000
085500             PV-RCP-MAJOR-CLASS-NBR DELIMITED BY SPACE            08930000
085600             INTO PO091-PRODUCT-NAME                              08940000
085700                                                                  08950000
P41268*    MOVE   PV-CURR-WEEK           TO PO091-CALENDAR-NAME         08960000
P41268     MOVE PV-CURR-WEEK-CC          TO DTATTR-FSCL-YR-NBR(1:2)     08970000
P41268     MOVE PV-CURR-WEEK-YY          TO DTATTR-FSCL-YR-NBR(3:2)     08980000
P41268     MOVE PV-CURR-WEEK-WW          TO DTATTR-FSCL-WK-NBR          08990000
P41268     PERFORM 2210-GET-OTB-SEASON                                  09000000
P41268     STRING  DTATTR-SEA-DESC(1:1) PV-CURR-WEEK-CC                 09010000
P41268             PV-CURR-WEEK-YY 'W' PV-CURR-WEEK-WW                  09020000
P41268             DELIMITED BY SPACE                                   09030000
P41268             INTO PO091-CALENDAR-NAME                             09040000
085900                                                                  09050000
086000******************************************************************09060000
086100*  BASED ON THE E BUSINESS INDICATOR POPULATE THE PHYSICAL AND    09070000
086200*  VIRTUAL STORE.                                                 09080000
086300******************************************************************09090000
086400                                                                  09100000
086410     IF (PV-E-BUS-IND = 'Y') OR                                   09111000
086420      (PV-PO-TYP-CDE = 'EC' OR 'IE' OR 'LE' OR 'RE' OR 'VE' OR    09112000
086500                       'CD')                                      09113000
086600         MOVE  'VIRTSTR'           TO  PO091-ORGANIZATION-NAME    09116500
086700     ELSE                                                         09116600
086800         MOVE  'PHYSSTR'           TO  PO091-ORGANIZATION-NAME    09116700
086900     END-IF.                                                      09116900
087000                                                                  09160000
087100******************************************************************09170000
087200*  CATEGORIZE THE EARLY RECEIPT DATA AND REGULAR RECEIPT DATA     09180000
087300*  BASED ON THE EARLY RECEIPT INDICATOR.                          09190000
087400******************************************************************09200000
087500                                                                  09210000
087600     IF (PV-RTL-EARLY-RECRPLN   = 0 )  AND                        09220000
087700        (PV-CST-EARLY-RECRPLN   = 0 )  AND                        09230000
087800        (PV-RTL-REG-RECRPLN     = 0 )  AND                        09240000
087900        (PV-CST-REG-RECRPLN     = 0 )  AND                        09250000
088000        (PV-RTL-EARLY-RECFT     = 0 )  AND                        09260000
088100        (PV-CST-EARLY-RECFT     = 0 )  AND                        09270000
088200        (PV-RTL-REG-RECFT       = 0 )  AND                        09280000
088300        (PV-CST-REG-RECFT       = 0 )  AND                        09290000
088400        (PV-RTL-EARLY-RECREG    = 0 )  AND                        09300000
088500        (PV-CST-EARLY-RECREG    = 0 )  AND                        09310000
088600        (PV-RTL-REG-RECREG      = 0 )  AND                        09320000
088700        (PV-CST-REG-RECREG      = 0 )  AND                        09330000
11752A        (PV-RTL-REG-RECDS       = 0 )  AND                        09331000
11752A        (PV-CST-REG-RECDS       = 0 )                             09332000
088800        CONTINUE                                                  09340000
088900     ELSE                                                         09350000
089000        MOVE PV-RTL-EARLY-RECREG  TO   PO091-EARLYRECREG-DLR      09360000
089100        MOVE PV-CST-EARLY-RECREG  TO   PO091-EARLYRECREG-CST      09370000
089200        MOVE PV-RTL-EARLY-RECRPLN TO   PO091-EARLYRECRPLN-DLR     09380000
089300        MOVE PV-CST-EARLY-RECRPLN TO   PO091-EARLYRECRPLN-CST     09390000
089400        MOVE PV-RTL-EARLY-RECFT   TO   PO091-EARLYRECFT-DLR       09400000
089500        MOVE PV-CST-EARLY-RECFT   TO   PO091-EARLYRECFT-CST       09410000
089600        MOVE PV-RTL-REG-RECREG    TO   PO091-CURRECREG-DLR        09420000
089700        MOVE PV-CST-REG-RECREG    TO   PO091-CURRECREG-CST        09430000
089800        MOVE PV-RTL-REG-RECRPLN   TO   PO091-CURRECRPLN-DLR       09440000
089900        MOVE PV-CST-REG-RECRPLN   TO   PO091-CURRECRPLN-CST       09450000
090000        MOVE PV-RTL-REG-RECFT     TO   PO091-CURRECFT-DLR         09460000
090100        MOVE PV-CST-REG-RECFT     TO   PO091-CURRECFT-CST         09470000
11752A        MOVE PV-RTL-REG-RECDS     TO   PO091-CURRECDS-DLR         09471000
11752A        MOVE PV-CST-REG-RECDS     TO   PO091-CURRECDS-CST         09472000
090200        PERFORM 8300-WRITE-OTB-RECPT                              09488000
090300     END-IF.                                                      09490000
090400     MOVE ZEROES                  TO  PV-RTL-EARLY-RECREG         09500000
090500                                      PV-CST-EARLY-RECREG         09510000
090600                                      PV-RTL-EARLY-RECRPLN        09520000
090700                                      PV-CST-EARLY-RECRPLN        09530000
090800                                      PV-RTL-EARLY-RECFT          09540000
090900                                      PV-CST-EARLY-RECFT          09550000
091000                                      PV-RTL-REG-RECREG           09560000
091100                                      PV-CST-REG-RECREG           09570000
091200                                      PV-RTL-REG-RECRPLN          09580000
091300                                      PV-CST-REG-RECRPLN          09590000
091400                                      PV-RTL-REG-RECFT            09600000
091500                                      PV-CST-REG-RECFT            09610000
11752A                                      PV-RTL-REG-RECDS            09611000
11752A                                      PV-CST-REG-RECDS.           09612000
091600******************************************************************09620000
091700*  READ A RECORD FROM THE PO EXTRACT FILE.                       *09630000
091800******************************************************************09640000
091900 8000-READ-PO-EXTRACT-RECORD.                                     09650000
092000                                                                  09660000
092100     READ PO-EXTRACT-FILE INTO PO015-RECORD                       09670000
092200       AT END SET PS-END-OF-PO-EXTRACT TO TRUE                    09680000
092300       NOT AT END                                                 09690000
092400           ADD  01                     TO WS-PO-REC-READ.         09700000
092500                                                                  09710000
092600******************************************************************09720000
092700*  READ A RECORD FROM THE PO RECEIPTS FILE.                      *09730000
092800******************************************************************09740000
092900 8100-READ-PO-RECEIPTS-RECORD.                                    09750000
093000                                                                  09760000
093100     READ PO-RECEIPTS-FILE INTO PO016-RECORD                      09770000
093200       AT END SET PS-END-OF-PO-RECEIPTS TO TRUE                   09780000
093300       NOT AT END                                                 09790000
093400           ADD  01                      TO WS-RECP-REC-READ.      09800000
093500                                                                  09810000
093600******************************************************************09820000
093700*  IF THE DEPT/MCL IS VALID, WRITE THE RECORD ELSE SKIP IT.      *09830000
093800******************************************************************09840000
093900 8200-CHECK-FOR-VALID-DEPT.                                       09850000
094000                                                                  09860000
094100     MOVE 'N' TO PS-VALID-DEPT-CL-SW.                             09870000
094200                                                                  09880000
094300     SET NDX TO 1                                                 09890000
094400     SEARCH PV-VALID-ENTRY                                        09900000
094500         AT END                                                   09910000
094600              CONTINUE                                            09920000
094700         WHEN PO015-DEPT        = PV-VALID-DEPT(NDX) AND          09930000
094800              PO015-MAJOR-CLASS = PV-VALID-CLASS(NDX)             09940000
094900              SET PS-VALID-DEPT-CL TO TRUE                        09950000
095000     END-SEARCH.                                                  09960000
095100                                                                  09970000
095200     IF PS-VALID-DEPT-CL                                          09980000
095300        NEXT SENTENCE                                             09990000
095400     ELSE                                                         10000000
095500        DISPLAY 'CLASS SKIPPED: C' PO015-DEPT '_'                 10010000
095600                PO015-MAJOR-CLASS                                 10020000
095700     END-IF.                                                      10030000
095800                                                                  10040000
095900******************************************************************10050000
096000*  WRITE THE PURCHASE ORDER RECORD.                              *10060000
096100******************************************************************10070000
096200 8300-WRITE-OTB-PO.                                               10080000
096300                                                                  10090000
096400     ADD  01                  TO WS-REC-WRITE                     10100000
096500     WRITE OTB-PO-RECORD      FROM POWS090-RECORD                 10110000
096600     INITIALIZE POWS090-RECORD.                                   10120000
096700                                                                  10130000
096800******************************************************************10140000
096900*  WRITE THE RECEIPT RECORD.                                     *10150000
097000******************************************************************10160000
097100 8300-WRITE-OTB-RECPT.                                            10170000
097200                                                                  10180000
097300     ADD  01                  TO WS-REC-WRITE                     10190000
097400     WRITE OTB-RECP-RECORD    FROM POWS091-RECORD                 10200000
097500     INITIALIZE POWS091-RECORD.                                   10210000
097600                                                                  10220000
097700******************************************************************10230000
097800*  CLOSE ALL OPEN FILES                                          *10240000
097900******************************************************************10250000
098000 8400-END-OF-JOB.                                                 10260000
11752A                                                                  10270000
11752A                                                                  10271000
098200     DISPLAY ' '.                                                 10280000
098300     DISPLAY '**************************************'.            10290000
098400     DISPLAY ' '.                                                 10300000
098500     DISPLAY 'OUTPUT RECORDS WRITTEN'.                            10310000
098600     DISPLAY 'PO RECORDS READ      :'  WS-PO-REC-READ             10320000
098700     DISPLAY 'RECEIPT RECORDS READ :'  WS-RECP-REC-READ           10330000
098800     DISPLAY 'RECORDS WRITTEN      :'  WS-REC-WRITE               10340000
098900     DISPLAY '**************************************'.            10350000
099000     DISPLAY ' '.                                                 10360000
099100                                                                  10370000
099200     CLOSE PO-EXTRACT-FILE                                        10380000
099300           PO-RECEIPTS-FILE                                       10390000
099400           OTB-PO-FILE                                            10400000
099500           OTB-RECPT-FILE.                                        10410000
099600                                                                  10420000
099700******************************************************************10430000
099800*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL   *10440000
099900*                 ERROR OR WARNING CODE OCCURS.                  *10450000
100000******************************************************************10460000
100100 9999-SQL-ABEND.                                                  10470000
100200                                                                  10480000
100300     MOVE SQLCODE        TO  SQLCODE2.                            10490000
100400     MOVE SQLERRD(3)     TO  SQLERRD3.                            10500000
100500                                                                  10510000
100600     DISPLAY '***************************'                        10520000
100700     DISPLAY '**       ABEND           **'                        10530000
100800     DISPLAY '**  IN PROGRAM POKUT122  **'                        10540000
100900     DISPLAY '***************************'                        10550000
101000     DISPLAY '** PARAGRAPH **      = ' PV-PARAGRAPH-NAME          10560000
101100     DISPLAY '** OPERATION **      = ' PV-DB2-OPER-ATTEMPTED      10570000
101200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  10580000
101300     DISPLAY '** SQLCODE **        = ' SQLCODE2.                  10590000
101400                                                                  10600000
101500     MOVE +4013         TO PV-ABEND-CODE                          10610000
101600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         10620000
