000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    RCKCS814.                                         00040000
000500 AUTHOR.        PATRICK BURKE                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JULY 2002.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    E814 - RECIEVING SIMPLIFICATION CRITERIA SPECIFICATION      *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00120000
001300*    SUBSEQUENT PROGRAMS TO CREATE A LIST.                       *00130000
001400*----------------------------------------------------------------*00140000
001410* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00141038
001420* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142039
001430* MAKING THE CALL DYNAMIC VS STATIC.                              00143039
001440*---------------------------------------------------------------* 00144039
001500 ENVIRONMENT DIVISION.                                            00150000
001600 DATA DIVISION.                                                   00160000
001700                                                                  00170000
001800 WORKING-STORAGE SECTION.                                         00180000
001900                                                                  00190000
002000 01  DK-DB2-KEYS.                                                 00200000
002100     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00210000
002200     05  DK-FCLTY-ID               PIC S9(04) COMP VALUE +0.      00220000
002300     05  DK-SCAC-ID                PIC  X(04)  VALUE SPACE.       00230000
002400     05  DK-TRIP-ID                PIC S9(09)  VALUE +0 COMP.     00240000
002500     05  DK-TRIP-STATUS            PIC  X(02)  VALUE SPACES.      00250000
002600     05  DK-TRLR-NBR               PIC  X(10)  VALUE SPACE.       00260000
002700     05  DK-PO-NBR                 PIC S9(09)  VALUE +0 COMP.     00270000
002800     05  DK-REC-SEQ-NBR            PIC S9(09)  VALUE +0 COMP.     00280000
002900     05  DK-SERIAL-SHIP-CDE        PIC S9(18)V COMP-3.            00290000
003000                                                                  00300000
003100 01  PV-PROGRAM-VARIABLES.                                        00310000
003200     05  PV-LOCATION.                                             00320000
003300         10  PV-DP020-LOCATION           PIC  X(04) VALUE '0000'. 00330000
003400     05  PV-LOCATION-N REDEFINES PV-LOCATION                      00340001
003500                                         PIC  9(04).              00350001
003600     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     00360001
003700                                                    COMP SYNC.    00370001
003800     05  PV-SUB1                         PIC S9(4) COMP SYNC.     00380001
003900     05  PV-SUB2                         PIC S9(4) COMP SYNC.     00390001
004000                                                                  00400001
004100     05  PV-INPUT-FIELD                  PIC X(18).               00410001
004200     05  FILLER REDEFINES PV-INPUT-FIELD.                         00420001
004300         10  PV-INPUT-BYTES OCCURS 18 TIMES.                      00430001
004400             15  PV-IN-BYTE              PIC X(01).               00440001
004500                                                                  00450001
004600     05  PV-OUTPUT-FIELD                 PIC X(18).               00460001
004700     05  FILLER REDEFINES PV-OUTPUT-FIELD.                        00470001
004800         10  PV-OUTPUT-BYTE OCCURS 18 TIMES.                      00480001
004900             15  PV-OUT-BYTE             PIC X(01).               00490001
004901                                                                  00490113
004910     05  PV-DISP-OPER                    PIC Z(04).               00491008
004920     05  PV-TRIP-OPER-UNT                PIC S9(4) COMP.          00492011
004921     05  PV-TRIP-OPER                    PIC X(04).               00492111
004930     05  PV-TRIP-OPER-N   REDEFINES PV-TRIP-OPER                  00493013
004940                                         PIC  Z(04).              00494011
004950     05  PV-TRIP-LOC-NM                  PIC X(25).               00495010
004960     05  PV-CURR-TRIP-ID                 PIC S9(9) COMP.          00496019
004970     05  PV-CURR-OPER-UNT-ID             PIC S9(4) COMP.          00497019
004980     05  PV-CURR-STATUS-DATE             PIC X(10).               00498019
004990     05  PV-CURR-STATUS-TIME             PIC X(08).               00499037
005000                                                                  00500001
005001     05  PV-KEYED-PO                          PIC S9(09) COMP.    00500122
005002     05  PV-KEYED-RCVR                        PIC S9(04) COMP.    00500222
005003     05  PV-RCVR-CRE-OPER-UNT-ID              PIC S9(04) COMP.    00500322
005004     05  PV-RCVR-CURR-OPER-UNT-ID             PIC S9(04) COMP.    00500422
005005     05  PV-PO-RCVR-DISP.                                         00500522
005006         10  PV-OPER-TYPE                PIC X(12).               00500622
005010             88 PV-CRE-DISP                  VALUE 'CREATE OPER:'.00501021
005011             88 PV-CURR-DISP                 VALUE 'CURRNT OPER:'.00501121
005020         10  PV-OPER-DISP                PIC 9(04).               00502021
005080                                                                  00508021
005100 01  DN-DB2-NULL-INDICATORS.                                      00510001
005200     05  DN-VEH-NBR                 PIC S9(04) COMP VALUE ZEROES. 00520001
005300*                                                                 00530001
005400                                                                  00540001
005500 01  PC-PROGRAM-CONSTANTS.                                        00550001
005600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RC814A'.   00560001
005700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RCKM814 '. 00570001
005800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RCKCS814'. 00580001
005900     05  PC-03                     PIC  X(02)  VALUE  '03'.       00590001
006000     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00600001
006100     05  PC-TSYMSG-NUMBERS.                                       00610001
006200         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00620001
006300         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00630001
006400         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00640001
006500         10  PC-TSYMSG-00083       PIC  9(05)  VALUE  00083.      00650001
006600         10  PC-TSYMSG-00330       PIC  9(05)  VALUE  00330.      00660001
006700         10  PC-TSYMSG-00726       PIC  9(05)  VALUE  00726.      00670001
006800         10  PC-TSYMSG-00743       PIC  9(05)  VALUE  00743.      00680001
006900         10  PC-TSYMSG-00954       PIC  9(05)  VALUE  00954.      00690001
007000         10  PC-TSYMSG-00955       PIC  9(05)  VALUE  00955.      00700001
007100         10  PC-TSYMSG-01245       PIC  9(05)  VALUE  01245.      00710001
007200         10  PC-TSYMSG-01551       PIC  9(05)  VALUE  01551.      00720001
007300         10  PC-TSYMSG-02609       PIC  9(05)  VALUE  02609.      00730001
007400         10  PC-TSYMSG-02613       PIC  9(05)  VALUE  02613.      00740001
007500         10  PC-TSYMSG-02962       PIC  9(05)  VALUE  02962.      00750001
007600         10  PC-TSYMSG-02998       PIC  9(05)  VALUE  02998.      00760001
007700         10  PC-TSYMSG-02999       PIC  9(05)  VALUE  02999.      00770001
007800         10  PC-TSYMSG-03001       PIC  9(05)  VALUE  03001.      00780001
007900         10  PC-TSYMSG-03003       PIC  9(05)  VALUE  03003.      00790001
008000         10  PC-TSYMSG-03004       PIC  9(05)  VALUE  03004.      00800001
008100         10  PC-TSYMSG-03005       PIC  9(05)  VALUE  03005.      00810001
008200         10  PC-TSYMSG-03009       PIC  9(05)  VALUE  03009.      00820001
008300         10  PC-TSYMSG-03015       PIC  9(05)  VALUE  03015.      00830001
008400         10  PC-TSYMSG-03016       PIC  9(05)  VALUE  03016.      00840001
008410         10  PC-TSYMSG-03813       PIC  9(05)  VALUE  03813.      00841033
008500*                                                                 00850001
008600     05  PC-UNLDG                  PIC  X(02)  VALUE 'UG'.        00860001
008700     05  PC-UNLDD                  PIC  X(02)  VALUE 'UN'.        00870001
008800     05  PC-ARRVD                  PIC  X(02)  VALUE 'AR'.        00880001
008900     05  PC-ENROUTE                PIC  X(02)  VALUE 'EN'.        00890001
009000     05  PC-DEPARTED               PIC  X(02)  VALUE 'DP'.        00900001
009100     05  PC-X                      PIC  X(01)  VALUE  'X'.        00910001
009200     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00920001
009300                                               COMP-3.            00930001
009400                                                                  00940001
009500 01  PS-PROGRAM-SWITCHES.                                         00950001
009600     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00960001
009700         88  PS-ERROR                          VALUE  'Y'.        00970001
009800         88  PS-NO-ERROR                       VALUE  'N'.        00980001
009900     05  PS-VALID-LOCATION-SW      PIC  X(01)  VALUE  'N'.        00990001
010000         88  PS-VALID-LOCATION                 VALUE  'Y'.        01000001
010100         88  PS-VALID-LOCATION-NO              VALUE  'N'.        01010001
010200     05  PS-TRAILER-EXISTS-SW      PIC  X(01)  VALUE  'N'.        01020001
010300         88  PS-TRAILER-EXISTS                 VALUE  'Y'.        01030001
010400         88  PS-TRAILER-EXISTS-NO              VALUE  'N'.        01040001
010500     05  PS-TRIP-EXISTS-SW         PIC  X(01)  VALUE  'N'.        01050001
010600         88  PS-TRIP-EXISTS                    VALUE  'Y'.        01060001
010700         88  PS-TRIP-DOESNT-EXIST              VALUE  'N'.        01070001
010800     05  PS-SCAC-EXISTS-SW         PIC  X(01)  VALUE  'N'.        01080001
010900         88  PS-SCAC-EXISTS                    VALUE  'Y'.        01090001
011000         88  PS-SCAC-DOESNT-EXIST              VALUE  'N'.        01100001
011100     05  PS-TRIP-STATUS-EXISTS-SW  PIC  X(01)  VALUE  'N'.        01110001
011200         88  PS-TRIP-STATUS-EXISTS             VALUE  'Y'.        01120001
011300         88  PS-NO-TRIP-STATUS                 VALUE  'N'.        01130001
011400     05  PS-PO-EXISTS-SW           PIC  X(01)  VALUE  'N'.        01140001
011500         88  PS-PO-EXISTS                      VALUE  'Y'.        01150001
011600         88  PS-PO-DOESNT-EXIST                VALUE  'N'.        01160001
011700     05  PS-RECEIVER-EXISTS-SW     PIC  X(01)  VALUE  'N'.        01170001
011800         88  PS-RECEIVER-EXISTS                VALUE  'Y'.        01180001
011900         88  PS-RECEIVER-DOESNT-EXIST          VALUE  'N'.        01190001
012000     05  PS-SHIP-CDE-EXISTS-SW     PIC  X(01)  VALUE  'N'.        01200001
012100         88  PS-SHIP-CDE-EXISTS                VALUE  'Y'.        01210001
012200         88  PS-SHIP-CDE-DOESNT-EXIST          VALUE  'N'.        01220001
012300     05  PS-DEPARTED-CHKD-SW       PIC  X(01)  VALUE  'N'.        01230001
012400         88  PS-DEPARTED-CHKD                  VALUE  'Y'.        01240001
012500         88  PS-DEPARTED-NOT-CHKD              VALUE  'N'.        01250001
012600     05  PS-ENTRY-SW               PIC  X(01)  VALUE  'N'.        01260001
012700         88  PS-ENTRY-YES                      VALUE  'Y'.        01270001
012800         88  PS-ENTRY-NO                       VALUE  'N'.        01280001
012900     05  PS-PO-OPER-EXISTS-SW      PIC  X(01)  VALUE  'N'.        01290001
013000         88  PS-PO-OPER-EXISTS                 VALUE  'Y'.        01300001
013100         88  PS-PO-OPER-EXISTS-NO              VALUE  'N'.        01310001
013200                                                                  01320001
013300 01  PM-PROGRAM-MESSAGES.                                         01330001
013400     05  PM-ABEND-INFO-A.                                         01340001
013500         10  FILLER                PIC X(15)   VALUE              01350001
013600                                   'DP020-SRC-AID: '.             01360001
013700         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01370001
013800         10  FILLER                PIC X(19)   VALUE              01380001
013900                                   '. DP020-FK-ACTION: '.         01390001
014000         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01400001
014100         10  FILLER                PIC X(22)   VALUE              01410001
014200                                   '. DP020-FK-DISPN-IND: '.      01420001
014300         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01430001
014400         10  FILLER                PIC X(01)   VALUE '.'.         01440001
014500         10  FILLER                PIC X(19)   VALUE SPACE.       01450001
014600                                                                  01460001
014700                                                                  01470001
014800*----------------------------------------------------------------*01480001
014900*    MAP LAYOUT                                                  *01490001
015000*----------------------------------------------------------------*01500001
015100                                                                  01510001
015200     COPY RCKM814.                                                01520001
015300     EJECT                                                        01530001
015400*----------------------------------------------------------------*01540001
015500*    ATTRIBUTE SETTINGS COPYBOOK.                                *01550001
015600*----------------------------------------------------------------*01560001
015700                                                                  01570001
015800     COPY DPWS015.                                                01580001
015900                                                                  01590001
016000*----------------------------------------------------------------*01600001
016100*    FUNCTION KEYS COPYBOOK                                      *01610001
016200*----------------------------------------------------------------*01620001
016300                                                                  01630001
016400     COPY DPWS016.                                                01640001
016500 EJECT                                                            01650001
016600******************************************************************01660001
016700** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01670001
016800** SUB-ROUTINE (DPKUT100).                                      **01680001
016900******************************************************************01690001
017000     COPY DPWS010I.                                               01700001
017100 EJECT                                                            01710001
017200******************************************************************01720001
017300** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **01730039
017400** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01740001
017500******************************************************************01750001
017600     COPY DPWS030.                                                01760001
017610     COPY DPWS930.                                                01761039
017700 EJECT                                                            01770001
017800***************************************************************** 01780001
017900*    STANDARD COMMAREA.                                           01790001
018000***************************************************************** 01800001
018100                                                                  01810001
018200     COPY DPWS020.                                                01820001
018300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01830001
018400                                                                  01840001
018500***************************************************************** 01850001
018600*    INTER-APPLICATION COMMAREA.                                  01860001
018700***************************************************************** 01870001
018800*   SUWS002 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 01880001
018900*             SPEC SCREEN.                                      * 01890001
019000*   RCWS814 - IS THE INPUT  LAYOUT THAT WILL BE PASSED TO       * 01900001
019100*             THE RECEIVER LIST SCREEN.                         * 01910001
019200***************************************************************** 01920001
019300                                                                  01930001
019400         10  INTER-APPL-COMM-AREA PIC X(200).                     01940001
019500     COPY SUWS002.                                                01950001
019600     COPY RCWS814.                                                01960001
019700     COPY RCWS015.                                                01970001
019800*                                                                 01980001
019900***************************************************************** 01990001
020000*    SPECIFIC COMMMAREA FOR RCKCS814.                             02000001
020100***************************************************************** 02010001
020200         10  ASC-SPECIFIC-COMMAREA.                               02020001
020300             15  ASC-LIST-KEYS.                                   02030001
020400                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   02040001
020500                                                     COMP.        02050001
020600                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   02060001
020700                                                     COMP.        02070001
020800                 20  ASC-KEY-TRIP-ID                 PIC S9(09)   02080001
020900                                                     COMP-3.      02090001
021000             15  ASC-OPER-UNT-ID             PIC  X(04).          02100001
021100             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      02110001
021200                                             PIC  9(04).          02120031
021300             15  ASC-FCLTY-NME               PIC  X(25).          02130001
021400             15  ASC-FCLTY-ID                PIC  X(04).          02140001
021500             15  ASC-FCLTY-ID-N REDEFINES ASC-FCLTY-ID            02150001
021600                                             PIC  Z(04).          02160001
021700             15  ASC-SCAC                    PIC  X(04).          02170001
021800             15  ASC-TRAILER                 PIC  X(10).          02180001
021900             15  ASC-TRIP-ID                 PIC  X(09).          02190001
022000             15  ASC-TRIP-ID-N REDEFINES ASC-TRIP-ID              02200001
022100                                             PIC  Z(09).          02210030
022200             15  ASC-STATUS-UG               PIC  X(02).          02220001
022300             15  ASC-STATUS-UN               PIC  X(02).          02230001
022400             15  ASC-STATUS-AR               PIC  X(02).          02240001
022500             15  ASC-STATUS-EN               PIC  X(02).          02250001
022600             15  ASC-STATUS-DP               PIC  X(02).          02260001
022700             15  ASC-PO-NBR                  PIC  X(08).          02270001
022800             15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                02280001
022900                                             PIC  Z(08).          02290001
023000             15  ASC-REC-SEQ-NBR             PIC  X(4).           02300001
023100             15  ASC-REC-SEQ-NBR-N REDEFINES                      02310001
023200                         ASC-REC-SEQ-NBR     PIC  Z(04).          02320001
023300             15  ASC-SERIAL-SHIP-CDE         PIC  X(18).          02330001
023400             15  ASC-SERIAL-SHIP-CDE-N REDEFINES                  02340001
023500                 ASC-SERIAL-SHIP-CDE         PIC  9(18).          02350001
023600             15  ASC-TRLR-OPER-UNT-ID        PIC S9(04)  COMP.    02360001
023700             15  ASC-PO-OPER-UNT-ID          PIC S9(04)  COMP.    02370001
023800             15  ASC-CONFIRM-PROCESSING-SW   PIC  X(1).           02380001
023900                 88  ASC-CONFIRM-FUNC-01     VALUE '1'.           02390001
023910             15  ASC-TRIP-OPER               PIC  X(04).          02391005
023920             15  ASC-TRIP-OPER-N   REDEFINES ASC-TRIP-OPER        02392005
023930                                             PIC  9(04).          02393030
023940             15  ASC-TRIP-OPER-NME           PIC  X(25).          02394005
023950             15  ASC-CURR-TRIP-ID            PIC  9(09).          02395017
024020             15  FILLER                      PIC  X(05).          02402017
024100     EJECT                                                        02410001
024200*----------------------------------------------------------------*02420001
024300*    ABEND PROCESSING COPYBOOK.                                  *02430001
024400*----------------------------------------------------------------*02440001
024500                                                                  02450001
024600     COPY DPWS013.                                                02460001
024700                                                                  02470001
024800*----------------------------------------------------------------*02480001
024900*    DB2 AREA FOR EXTERNAL ENTITY TABLE                          *02490001
025000*----------------------------------------------------------------*02500001
025100                                                                  02510001
025200     EXEC SQL                                                     02520001
025300          INCLUDE TEXTENT                                         02530001
025400     END-EXEC.                                                    02540001
025500                                                                  02550001
025600*----------------------------------------------------------------*02560001
025700*    DB2 AREA FOR TRIP TABLE                                     *02570001
025800*----------------------------------------------------------------*02580001
025900                                                                  02590001
026000     EXEC SQL                                                     02600001
026100          INCLUDE TVHTRIP                                         02610001
026200     END-EXEC.                                                    02620001
026300                                                                  02630001
026400*----------------------------------------------------------------*02640001
026500*    DB2 AREA FOR TRIP STATUS TABLE                              *02650001
026600*----------------------------------------------------------------*02660001
026700                                                                  02670001
026800     EXEC SQL                                                     02680001
026900          INCLUDE TTRIPST                                         02690001
027000     END-EXEC.                                                    02700001
027100                                                                  02710001
027110*----------------------------------------------------------------*02711010
027120*    DB2 AREA FOR TRIP STATUS TYPE                               *02712010
027130*----------------------------------------------------------------*02713010
027150     EXEC SQL                                                     02715010
027160          INCLUDE TTRSTYP                                         02716010
027170     END-EXEC.                                                    02717010
027180                                                                  02718010
027200*----------------------------------------------------------------*02720001
027300*    DB2 AREA FOR SHIP UNIT TABLE                                *02730001
027400*----------------------------------------------------------------*02740001
027500                                                                  02750001
027600     EXEC SQL                                                     02760001
027700          INCLUDE TSHPUNT                                         02770001
027800     END-EXEC.                                                    02780001
027900                                                                  02790001
028000*----------------------------------------------------------------*02800001
028100*    DB2 AREA FOR VEHICLE TABLE                                  *02810001
028200*----------------------------------------------------------------*02820001
028300                                                                  02830001
028400     EXEC SQL                                                     02840001
028500          INCLUDE TVEHICL                                         02850001
028600     END-EXEC.                                                    02860001
028700*----------------------------------------------------------------*02870001
028800*    DB2 AREA FOR SHIPMENT PO TABLE                               02880001
028900*----------------------------------------------------------------*02890001
029000                                                                  02900001
029100     EXEC SQL                                                     02910001
029200          INCLUDE TSHPTPO                                         02920001
029300     END-EXEC.                                                    02930001
029400*----------------------------------------------------------------*02940001
029500*    DB2 AREA FOR RECEIV   TABLE                                  02950001
029600*----------------------------------------------------------------*02960001
029700                                                                  02970001
029800     EXEC SQL                                                     02980001
029900          INCLUDE TRECEIV                                         02990001
030000     END-EXEC.                                                    03000001
030100*----------------------------------------------------------------*03010001
030200*    DB2 AREA FOR PARM TABLE                                      03020001
030300*----------------------------------------------------------------*03030001
030400                                                                  03040001
030500     EXEC SQL                                                     03050001
030600          INCLUDE TKRPRPM                                         03060001
030700     END-EXEC.                                                    03070001
030800*----------------------------------------------------------------*03080001
030900*    DB2 AREA FOR TINPKSU TABLE                                   03090001
031000*----------------------------------------------------------------*03100001
031100                                                                  03110001
031200     EXEC SQL                                                     03120001
031300          INCLUDE TINPKSU                                         03130001
031400     END-EXEC.                                                    03140001
031500*----------------------------------------------------------------*03150001
031600*    DB2 AREA FOR TPKSLIP TABLE                                   03160001
031700*----------------------------------------------------------------*03170001
031800                                                                  03180001
031900     EXEC SQL                                                     03190001
032000          INCLUDE TPKSLIP                                         03200001
032100     END-EXEC.                                                    03210001
032200                                                                  03220001
032210*----------------------------------------------------------------*03221007
032220*    DB2 AREA FOR XLT_LOC                                         03222007
032230*----------------------------------------------------------------*03223007
032250     EXEC SQL                                                     03225007
032260          INCLUDE XLT00010                                        03226007
032270     END-EXEC.                                                    03227007
032280                                                                  03228007
032300*  COMMUNICATION AREAS FOR DB2                                    03230001
032400*                                                                 03240001
032500     EXEC SQL                                                     03250001
032600         INCLUDE SQLCA                                            03260001
032700     END-EXEC.                                                    03270001
032800*----------------------------------------------------------------*03280001
032900                                                                  03290001
033000 EJECT                                                            03300001
033100 LINKAGE SECTION.                                                 03310001
033200                                                                  03320001
033300 01  DFHCOMMAREA.                                                 03330001
033400     05  FILLER                         OCCURS  1 TO 4072 TIMES   03340001
033500                                        DEPENDING ON EIBCALEN.    03350001
033600         10  FILLER                     PIC X.                    03360001
033700                                                                  03370001
033800                                                                  03380001
033900 PROCEDURE DIVISION.                                              03390001
034000***************************************************************** 03400001
034100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03410001
034200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03420001
034300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03430001
034400**                                                             ** 03440001
034500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03450001
034600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03460001
034700***************************************************************** 03470001
034800 0000-MAIN-MODULE.                                                03480001
034900     INITIALIZE DP030-CICS-API-FIELDS.                            03490001
035000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03500001
035100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03510001
035200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03520001
035300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03530001
035400     MOVE LENGTH OF RC814AI        TO DP030-MAP-LENGTH (1).       03540001
035500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03550001
035600     PERFORM 0001-CALL-CICS-ARCH-API.                             03560001
035700*                                                                 03570001
035800     MOVE DP020-LOCATION-NBR TO PV-DP020-LOCATION                 03580001
035900     MOVE PV-LOCATION    TO ASC-OPER-UNT-ID                       03590001
036000     MOVE PV-LOCATION-N  TO ASC-KEY-OPER-UNT-ID                   03600001
036100     PERFORM 1100-SELECT-TKRPRPM                                  03610001
036200     IF PS-VALID-LOCATION                                         03620001
036300        PERFORM 1000-CONTROL-PROCESSING                           03630001
036400     ELSE                                                         03640001
036500        SET PS-ERROR                                              03650001
036600            DP020-MSG-FATAL  TO TRUE                              03660001
036700        MOVE PC-TSYMSG-03015  TO DP020-MSG-NUMBER                 03670001
036800        SET DP030-OVERRIDE-GO TO TRUE                             03680001
036900     END-IF                                                       03690001
037000*                                                                 03700001
037100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03710001
037200     PERFORM 0001-CALL-CICS-ARCH-API.                             03720001
037300                                                                  03730001
037400 0001-CALL-CICS-ARCH-API.                                         03740001
037510     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03751039
037600                                    DFHCOMMAREA                   03760039
037700                                    DP030-CICS-API-FIELDS         03770039
037800                                    DP020-STANDARD-COMMAREA       03780039
037900                                    RC814AI.                      03790039
038000*                                                                 03800001
038100     IF  DP030-RC-CALL-SUCCESSFUL                                 03810001
038200         CONTINUE                                                 03820001
038300     ELSE                                                         03830001
038400         SET DP013-NO-ROLLBACK                                    03840001
038500             DP013-XCTL-DISPLAY-RESTART                           03850001
038600             DP013-CICS-ABEND      TO TRUE                        03860001
038700         MOVE 'BEFORE 0000-MAIN-MODULE'                           03870001
038800                                   TO DP013-PARAGRAPH             03880001
038820         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O03882039
038830-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03883039
039100         MOVE DP030-RETURN-CODE                                   03910001
039200                                   TO DP013-MESSAGE-TEXT (3)      03920001
039300         PERFORM DP013-0000-PROCESS-ABEND                         03930001
039400     END-IF.                                                      03940001
039500 EJECT                                                            03950001
039600*----------------------------------------------------------------*03960001
039700*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03970001
039800*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03980001
039900*----------------------------------------------------------------*03990001
040000                                                                  04000001
040100 1000-CONTROL-PROCESSING.                                         04010001
040200                                                                  04020001
040300     EVALUATE TRUE                                                04030001
040400         WHEN DP020-NEXT-ACT-INITIAL                              04040001
040500         WHEN DP020-NEXT-ACT-RETURN                               04050001
040600             INITIALIZE ASC-SPECIFIC-COMMAREA                     04060001
040700             MOVE DP020-LOCATION-NBR TO PV-DP020-LOCATION         04070001
040800             MOVE PV-LOCATION    TO ASC-OPER-UNT-ID               04080001
040900             MOVE PV-LOCATION-N  TO ASC-KEY-OPER-UNT-ID           04090001
041000                                    DK-OPER-UNT-ID                04100001
041100             MOVE 1              TO ASC-FCLTY-ID-N                04110001
041200                                    ASC-KEY-FCLTY-ID              04120001
041300                                    DK-FCLTY-ID                   04130001
041310                                                                  04131009
041360             MOVE ASC-KEY-OPER-UNT-ID  TO  XLT00010-LOC-NBR       04136009
041370             PERFORM 3085-GET-LOC-NAME                            04137009
041380             MOVE XLT00010-LOC-NM      TO  ASC-FCLTY-NME          04138009
041390                                                                  04139009
041400             PERFORM 4000-BUILD-INITIAL-PANEL                     04140001
041500                                                                  04150001
041600         WHEN DP020-NEXT-ACT-READ-MAP                             04160001
041700             PERFORM 2000-FKEY-PROCESSING                         04170001
041800                                                                  04180001
041900         WHEN OTHER                                               04190001
042000             SET DP013-LOGIC-ABEND                                04200001
042100                 DP013-NO-ROLLBACK TO TRUE                        04210001
042200             MOVE '1000-CONTROL-PROCESSING'                       04220001
042300                                   TO  DP013-PARAGRAPH            04230001
042400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04240001
042500                                   TO  DP013-MESSAGE-TEXT(1)      04250001
042600             MOVE DP020-NEXT-APPL-ACTIVITY                        04260001
042700                                   TO DP013-MESSAGE-TEXT(2)       04270001
042800             PERFORM DP013-0000-PROCESS-ABEND                     04280001
042900     END-EVALUATE.                                                04290001
043000                                                                  04300001
043100*----------------------------------------------------------------*04310001
043200* CHECK PARM TABLE TO SEE IF CURRENT LOCATION HAS ACCESS TO      *04320001
043300* RECEIVING SIMPLIFICATION SCREENS.                              *04330001
043400*----------------------------------------------------------------*04340001
043500                                                                  04350001
043600 1100-SELECT-TKRPRPM.                                             04360001
043700                                                                  04370001
043800     EXEC SQL                                                     04380001
043900          SELECT FUNC_TXT                                         04390001
044000            INTO :KRPRPM-FUNC-TXT                                 04400001
044100            FROM TKRPRPM                                          04410001
044200           WHERE LOC_ID            = :ASC-KEY-OPER-UNT-ID         04420001
044300             AND INTFC_SYS_CDE    = 'KHL'                         04430001
044400             AND SYS_PRC_FUNC_CDE = 'RSSACC'                      04440001
044500             AND FUNC_PRC_STAT_CDE = 'AC'                         04450001
044600             AND  FUNC_TXT          = 'Y'                         04460001
044700     END-EXEC.                                                    04470001
044800                                                                  04480001
044900     EVALUATE TRUE                                                04490001
045000         WHEN SQLCODE = ZERO                                      04500001
045100              SET PS-VALID-LOCATION       TO TRUE                 04510001
045200         WHEN SQLCODE = +100                                      04520001
045300              SET PS-VALID-LOCATION-NO    TO TRUE                 04530001
045400         WHEN SQLWARN0 NOT = SPACE                                04540001
045500         WHEN SQLCODE < ZERO                                      04550001
045600         WHEN SQLCODE > ZERO                                      04560001
045700             MOVE '1100-SELECT-TKRPRPM'                           04570001
045800                             TO DP013-PARAGRAPH                   04580001
045900             MOVE 'SELECT PARM VALUE'                             04590001
046000                             TO DP013-MESSAGE-TEXT (1)            04600001
046100             MOVE PV-LOCATION TO DP013-MESSAGE-TEXT (2)           04610001
046200             MOVE SQLCA      TO DP013-SQLCA                       04620001
046300             MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME (1)          04630001
046400             SET DP013-DB2-ABEND                                  04640001
046500                             TO TRUE                              04650001
046600             SET DP013-XCTL-DISPLAY-RESTART                       04660001
046700                             TO TRUE                              04670001
046800             PERFORM DP013-0000-PROCESS-ABEND                     04680001
046900     END-EVALUATE.                                                04690001
047000                                                                  04700001
047100*----------------------------------------------------------------*04710001
047200* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04720001
047300* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04730001
047400* EDITS.                                                         *04740001
047500*----------------------------------------------------------------*04750001
047600                                                                  04760001
047700 2000-FKEY-PROCESSING.                                            04770001
047800                                                                  04780001
047900     EVALUATE TRUE                                                04790001
048000                                                                  04800001
048100         WHEN DP020-SRC-AID = DP016-CLEAR                         04810001
048200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04820001
048300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04830001
048400                                                                  04840001
048500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04850001
048600             INITIALIZE ASC-SPECIFIC-COMMAREA                     04860001
048700             MOVE DP020-LOCATION-NBR TO PV-DP020-LOCATION         04870001
048800             MOVE PV-LOCATION    TO ASC-OPER-UNT-ID               04880001
048900             MOVE PV-LOCATION-N  TO ASC-KEY-OPER-UNT-ID           04890001
049000                                    DK-OPER-UNT-ID                04900001
049100             MOVE 1              TO ASC-FCLTY-ID-N                04910001
049200                                    ASC-KEY-FCLTY-ID              04920001
049300                                    DK-FCLTY-ID                   04930001
049310                                                                  04931016
049320             MOVE ASC-KEY-OPER-UNT-ID  TO  XLT00010-LOC-NBR       04932016
049330             PERFORM 3085-GET-LOC-NAME                            04933016
049340             MOVE XLT00010-LOC-NM      TO  ASC-FCLTY-NME          04934016
049350                                                                  04935016
049400             PERFORM 4000-BUILD-INITIAL-PANEL                     04940001
049500             PERFORM 3200-RESET-ATTRIBUTES                        04950001
049600                                                                  04960001
049700         WHEN OTHER                                               04970001
049800             MOVE DP020-LOCATION-NBR TO PV-DP020-LOCATION         04980001
049900             MOVE PV-LOCATION    TO ASC-OPER-UNT-ID               04990001
050000             MOVE PV-LOCATION-N  TO ASC-KEY-OPER-UNT-ID           05000001
050100                                    DK-OPER-UNT-ID                05010001
050200             MOVE 1              TO ASC-FCLTY-ID-N                05020001
050300                                    ASC-KEY-FCLTY-ID              05030001
050400                                    DK-FCLTY-ID                   05040001
050500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05050001
050600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05060001
050601                                                                  05060114
050603             MOVE ASC-KEY-OPER-UNT-ID  TO  XLT00010-LOC-NBR       05060316
050604             PERFORM 3085-GET-LOC-NAME                            05060416
050605             MOVE XLT00010-LOC-NM      TO  ASC-FCLTY-NME          05060516
050606                                                                  05060616
050610             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05061014
050620                                                                  05062014
050700             IF  PS-NO-ERROR                                      05070001
050800                 SET DP030-CONTINUE-GO TO TRUE                    05080001
050900                 PERFORM 2100-CHECK-FUNCTION-KEY                  05090001
051000             ELSE                                                 05100001
051100                 SET DP030-OVERRIDE-GO TO TRUE                    05110001
051200             END-IF                                               05120001
051300     END-EVALUATE.                                                05130001
051400******************************************************************05140001
051500** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **05150001
051600** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **05160001
051700** FROM THE CICS ARCHITECTURE API.                              **05170001
051800******************************************************************05180001
051900 2100-CHECK-FUNCTION-KEY.                                         05190001
052000     EVALUATE TRUE                                                05200001
052100*************                                                     05210001
052200*F18 TRLRLIST                                                     05220001
052300*************                                                     05230001
052400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05240001
052500             IF PS-DEPARTED-CHKD                                  05250001
052600                 IF PS-TRAILER-EXISTS OR PS-TRIP-EXISTS           05260001
052700                      OR PS-SHIP-CDE-EXISTS                       05270001
052800                      OR PS-PO-OPER-EXISTS                        05280001
052900                    SET PS-DEPARTED-NOT-CHKD TO TRUE              05290001
053000                    PERFORM 2115-PREPARE-INTER-APPL-COMM          05300001
053100                 ELSE                                             05310001
053200                    INITIALIZE SU002-INTER-APPL-COMMAREA          05320001
053300                        SET PS-ERROR                              05330001
053400                            DP020-MSG-FATAL  TO TRUE              05340001
053500                        MOVE PC-TSYMSG-01551 TO DP020-MSG-NUMBER  05350001
053600                        MOVE DP015-UNP-ALP-BRT-OFF                05360001
053700                                             TO ATRIPA            05370001
053800                                                ASCACA            05380001
053900                                                ATRLRA            05390001
054000                        MOVE DP015-RED       TO ATRIPC            05400001
054100                                                ASCACC            05410001
054200                                                ATRLRC            05420001
054300                        MOVE DP015-REVERSE   TO ATRIPH            05430001
054400                                                ASCACH            05440001
054500                                                ATRLRH            05450001
054600                        MOVE -1              TO ASCACL            05460001
054700                        SET DP030-SET-CURSOR-APPL-1               05470001
054800                                             TO TRUE              05480001
054900                        SET DP030-OVERRIDE-GO TO TRUE             05490001
055000                 END-IF                                           05500001
055100             ELSE                                                 05510001
055200                    PERFORM 2115-PREPARE-INTER-APPL-COMM          05520001
055300             END-IF                                               05530001
055400*************                                                     05540001
055500*F23 RCVRLIST                                                     05550001
055600*************                                                     05560001
055700                                                                  05570001
055800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05580001
055900             IF PS-TRAILER-EXISTS OR PS-TRIP-EXISTS OR            05590001
056000                (PS-PO-EXISTS AND PS-RECEIVER-EXISTS)             05600001
056100                PERFORM 2110-PREPARE-INTER-APPL-COMM              05610001
056200             ELSE                                                 05620001
056300                IF PS-PO-EXISTS OR                                05630001
056400                   PS-RECEIVER-EXISTS                             05640001
056500                     INITIALIZE RC814-INTER-APPL-COMMAREA         05650001
056600                     SET PS-ERROR                                 05660001
056700                         DP020-MSG-FATAL  TO TRUE                 05670001
056800                     MOVE PC-TSYMSG-01245 TO DP020-MSG-NUMBER     05680001
056900                     MOVE DP015-UNP-ALP-BRT-OFF                   05690001
057000                                          TO APOA                 05700001
057100                                             ARCVRA               05710001
057200                     MOVE DP015-RED       TO APOC                 05720001
057300                                             ARCVRC               05730001
057400                     MOVE DP015-REVERSE   TO APOH                 05740001
057500                                             ARCVRH               05750001
057600                     MOVE -1              TO APOL                 05760001
057700                     SET DP030-SET-CURSOR-APPL-1                  05770001
057800                                          TO TRUE                 05780001
057900                     SET DP030-OVERRIDE-GO TO TRUE                05790001
058000                ELSE                                              05800001
058100                     IF PS-SCAC-EXISTS OR                         05810001
058200                        ASC-TRAILER > SPACES                      05820001
058300                        INITIALIZE RC814-INTER-APPL-COMMAREA      05830001
058400                        SET PS-ERROR                              05840001
058500                            DP020-MSG-FATAL  TO TRUE              05850001
058600                        MOVE PC-TSYMSG-01551 TO DP020-MSG-NUMBER  05860001
058700                        MOVE DP015-UNP-ALP-BRT-OFF                05870001
058800                                             TO ATRIPA            05880001
058900                                                ASCACA            05890001
059000                                                ATRLRA            05900001
059100                        MOVE DP015-RED       TO ATRIPC            05910001
059200                                                ASCACC            05920001
059300                                                ATRLRC            05930001
059400                        MOVE DP015-REVERSE   TO ATRIPH            05940001
059500                                                ASCACH            05950001
059600                                                ATRLRH            05960001
059700                        MOVE -1              TO ASCACL            05970001
059800                        SET DP030-SET-CURSOR-APPL-1               05980001
059900                                             TO TRUE              05990001
060000                        SET DP030-OVERRIDE-GO TO TRUE             06000001
060100                     ELSE                                         06010001
060200                        INITIALIZE RC814-INTER-APPL-COMMAREA      06020001
060300                        SET PS-ERROR                              06030001
060400                            DP020-MSG-FATAL  TO TRUE              06040001
060500                        MOVE PC-TSYMSG-03001 TO DP020-MSG-NUMBER  06050001
060600                        MOVE DP015-UNP-ALP-BRT-OFF                06060001
060700                                             TO ATRIPA            06070001
060800                                                ASCACA            06080001
060900                                                ATRLRA            06090001
061000                                                APOA              06100001
061100                                                ARCVRA            06110001
061200                        MOVE DP015-RED       TO ATRIPC            06120001
061300                                                ASCACC            06130001
061400                                                ATRLRC            06140001
061500                                                APOC              06150001
061600                                                ARCVRC            06160001
061700                        MOVE DP015-REVERSE   TO ATRIPH            06170001
061800                                                ASCACH            06180001
061900                                                ATRLRH            06190001
062000                                                APOH              06200001
062100                                                ARCVRH            06210001
062200                        MOVE -1              TO ASCACL            06220001
062300                        SET DP030-SET-CURSOR-APPL-1               06230001
062400                                             TO TRUE              06240001
062500                        SET DP030-OVERRIDE-GO TO TRUE             06250001
062600                     END-IF                                       06260001
062700                END-IF                                            06270001
062800             END-IF                                               06280001
062900*************                                                     06290001
063000*F24 CRTNLIST                                                     06300001
063100*************                                                     06310001
063200         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06320001
063300             IF ASC-PO-NBR  = SPACES OR ZEROS AND                 06330001
063400                ASC-REC-SEQ-NBR = SPACES OR ZEROS                 06340001
063500                 INITIALIZE SU002-INTER-APPL-COMMAREA             06350001
063600                 SET PS-ERROR                                     06360001
063700                     DP020-MSG-FATAL  TO TRUE                     06370001
063800                 MOVE PC-TSYMSG-03005 TO DP020-MSG-NUMBER         06380001
063900                 MOVE DP015-UNP-ALP-BRT-OFF TO APOA               06390001
064000                                               ARCVRA             06400001
064100                 MOVE DP015-RED             TO APOC               06410001
064200                                               ARCVRC             06420001
064300                 MOVE DP015-REVERSE         TO APOH               06430001
064400                                               ARCVRH             06440001
064500                 MOVE -1                    TO APOL               06450001
064600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06460001
064700                 SET DP030-OVERRIDE-GO TO TRUE                    06470001
064800             ELSE                                                 06480001
064900                 IF ASC-PO-NBR  = SPACES OR ZEROS                 06490001
065000                     INITIALIZE SU002-INTER-APPL-COMMAREA         06500001
065100                     SET PS-ERROR                                 06510001
065200                         DP020-MSG-FATAL TO TRUE                  06520001
065300                     MOVE PC-TSYMSG-03005 TO DP020-MSG-NUMBER     06530001
065400                     MOVE DP015-UNP-ALP-BRT-OFF TO APOA           06540001
065500                     MOVE DP015-RED       TO APOC                 06550001
065600                     MOVE DP015-REVERSE   TO APOH                 06560001
065700                     MOVE -1              TO APOL                 06570001
065800                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          06580001
065900                     SET DP030-OVERRIDE-GO TO TRUE                06590001
066000                 ELSE                                             06600001
066100                     IF ASC-REC-SEQ-NBR = SPACES OR ZEROS         06610001
066200                         INITIALIZE SU002-INTER-APPL-COMMAREA     06620001
066300                         SET PS-ERROR                             06630001
066400                             DP020-MSG-FATAL TO TRUE              06640001
066500                         MOVE PC-TSYMSG-03005 TO DP020-MSG-NUMBER 06650001
066600                         MOVE DP015-UNP-ALP-BRT-OFF TO ARCVRA     06660001
066700                         MOVE DP015-RED       TO ARCVRC           06670001
066800                         MOVE DP015-REVERSE   TO ARCVRH           06680001
066900                         MOVE -1              TO ARCVRL           06690001
067000                         SET DP030-SET-CURSOR-APPL-1  TO TRUE     06700001
067100                         SET DP030-OVERRIDE-GO TO TRUE            06710001
067200                     ELSE                                         06720001
067300                         PERFORM 2115-PREPARE-INTER-APPL-COMM     06730001
067400                     END-IF                                       06740001
067500                 END-IF                                           06750001
067600             END-IF                                               06760001
067700                                                                  06770001
067800*************                                                     06780001
067900*F22 CTNDTLST -SERIAL-SHIP CDE REQUIRED                           06790001
068000*************                                                     06800001
068100         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              06810001
068200             PERFORM 2120-PREPARE-INTER-APPL-COMM                 06820001
068300                                                                  06830001
068400         WHEN DP020-SRC-AID = DP016-ENTER                         06840001
068500             MOVE -1                      TO ASCACL               06850001
068600             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 06860001
068700                                                                  06870001
068800         WHEN OTHER                                               06880001
068900             SET DP013-NO-ROLLBACK                                06890001
069000                 DP013-XCTL-DISPLAY-RESTART                       06900001
069100                 DP013-CICS-ABEND  TO TRUE                        06910001
069200             MOVE '2100-CHECK-FUNCTION-KEY'                       06920001
069300                                   TO DP013-PARAGRAPH             06930001
069400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06940001
069500                                   TO DP013-MESSAGE-TEXT (1)      06950001
069600             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 06960001
069700                                   TO DP013-MESSAGE-TEXT (2)      06970001
069800             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                06980001
069900             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 06990001
070000                                   TO PM-A-FK-ACTION              07000001
070100             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              07010001
070200                                   TO PM-A-FK-DISPN               07020001
070300             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      07030001
070400             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        07040001
070500                                   TO DP013-MESSAGE-TEXT (4)      07050001
070600             PERFORM DP013-0000-PROCESS-ABEND                     07060001
070700     END-EVALUATE.                                                07070001
070800******************************************************************07080001
070900** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **07090001
071000** INTER-APPLICATION COMMAREA.                                  **07100001
071100******************************************************************07110001
071200 2110-PREPARE-INTER-APPL-COMM.                                    07120001
071300     INITIALIZE RC814-INTER-APPL-COMMAREA.                        07130001
071400     MOVE ASC-KEY-OPER-UNT-ID          TO RC814-OPER-UNT-ID.      07140001
071500     MOVE ASC-KEY-FCLTY-ID             TO RC814-FCLTY-ID.         07150001
071600     MOVE ASC-FCLTY-NME                TO RC814-FCLTY-NME.        07160001
071700     MOVE ASC-SCAC                     TO RC814-SCAC.             07170001
071800     MOVE ASC-TRAILER                  TO RC814-TRLR-NBR.         07180001
071900                                                                  07190001
072000     PERFORM 3150-TRIP-STATUS                                     07200001
072100     MOVE ASC-STATUS-UG                TO SU002-STATUS-UG.        07210001
072200     MOVE ASC-STATUS-UN                TO SU002-STATUS-UN.        07220001
072300     MOVE ASC-STATUS-AR                TO SU002-STATUS-AR.        07230001
072400     MOVE ASC-STATUS-EN                TO SU002-STATUS-EN.        07240001
072500     MOVE ASC-STATUS-DP                TO SU002-STATUS-DP.        07250001
072600     MOVE DK-TRIP-STATUS               TO RC814-TRLR-STATUS.      07260001
072700     MOVE ASC-TRIP-ID                  TO RC814-TRIP-ID.          07270001
072800     MOVE ASC-PO-NBR                   TO RC814-PO-NBR.           07280001
072900     MOVE ASC-REC-SEQ-NBR              TO RC814-REC-SEQ-NBR.      07290001
073000     MOVE ASC-SERIAL-SHIP-CDE-N        TO RC814-SHIPT-UNT-ID.     07300001
073100                                                                  07310001
073200/                                                                 07320001
073300******************************************************************07330001
073400 2115-PREPARE-INTER-APPL-COMM.                                    07340001
073500     INITIALIZE SU002-INTER-APPL-COMMAREA                         07350001
073600     MOVE ASC-KEY-OPER-UNT-ID          TO SU002-OPER-UNT-ID       07360001
073700     MOVE ASC-KEY-FCLTY-ID             TO SU002-FCLTY-ID          07370001
073800     MOVE ASC-FCLTY-NME                TO SU002-FCLTY-NME         07380001
073900     MOVE ASC-SCAC                     TO SU002-SCAC              07390001
074000     MOVE ASC-TRAILER                  TO SU002-TRLR-NBR          07400001
074100     IF PS-ENTRY-NO                                               07410001
074200        MOVE 'AR' TO SU002-STATUS-AR                              07420001
074300        MOVE 'UG' TO SU002-STATUS-UG                              07430001
074400     ELSE                                                         07440001
074500        PERFORM 3150-TRIP-STATUS                                  07450001
074600        MOVE ASC-STATUS-UG             TO SU002-STATUS-UG         07460001
074700        MOVE ASC-STATUS-AR             TO SU002-STATUS-AR         07470001
074800     END-IF.                                                      07480001
074900     MOVE ASC-STATUS-UN                TO SU002-STATUS-UN.        07490001
075000     MOVE ASC-STATUS-EN                TO SU002-STATUS-EN.        07500001
075100     MOVE ASC-STATUS-DP                TO SU002-STATUS-DP.        07510001
075200     MOVE ASC-TRIP-ID                  TO SU002-TRIP-ID.          07520001
075300     MOVE ASC-PO-NBR                   TO SU002-PO-NBR.           07530001
075400     MOVE ASC-REC-SEQ-NBR              TO SU002-REC-SEQ-NBR.      07540001
075500     MOVE ASC-SERIAL-SHIP-CDE-N       TO SU002-SHIPT-UNT-ID.      07550001
075600                                                                  07560001
075700 2120-PREPARE-INTER-APPL-COMM.                                    07570001
075800     INITIALIZE RC015-INTER-APPL-COMMAREA                         07580001
075900     MOVE ASC-KEY-OPER-UNT-ID          TO RC015-OPER-UNT-ID       07590001
076000     MOVE ASC-KEY-FCLTY-ID             TO RC015-FCLTY-ID          07600001
076100     MOVE ASC-PO-NBR                   TO RC015-PO-NBR.           07610001
076200     MOVE ASC-REC-SEQ-NBR              TO RC015-REC-SEQ-NBR.      07620001
076300     MOVE ASC-TRIP-ID                  TO RC015-TRIP-ID.          07630001
076400/                                                                 07640001
076500*----------------------------------------------------------------*07650001
076600* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*07660001
076700* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *07670001
076800* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *07680001
076900*----------------------------------------------------------------*07690001
077000                                                                  07700001
077100 2200-MOVE-SCREEN-TO-COMMAREA.                                    07710001
077200                                                                  07720001
077300     IF  ASCACL > ZERO                                            07730001
077400         MOVE ASCACI               TO ASC-SCAC                    07740001
077500     ELSE                                                         07750001
077600         IF  ASCACF = DP015-ERASE-EOF                             07760001
077700             MOVE SPACES           TO ASC-SCAC                    07770001
077800         END-IF                                                   07780001
077900     END-IF.                                                      07790001
078000                                                                  07800001
078100     IF  ATRLRL > ZERO                                            07810001
078200         MOVE ATRLRI               TO ASC-TRAILER                 07820001
078300     ELSE                                                         07830001
078400         IF  ATRLRF = DP015-ERASE-EOF                             07840001
078500             MOVE SPACES           TO ASC-TRAILER                 07850001
078600         END-IF                                                   07860001
078700     END-IF.                                                      07870001
078800                                                                  07880001
078900                                                                  07890001
079000************************************************************      07900001
079100     IF  ATRIPL > ZERO                                            07910001
079200         MOVE ATRIPI               TO ASC-TRIP-ID                 07920001
079300     ELSE                                                         07930001
079400         IF  ATRIPF = DP015-ERASE-EOF                             07940001
079500             MOVE ZERO             TO ASC-TRIP-ID-N               07950001
079600                                      ASC-KEY-TRIP-ID             07960001
079700         END-IF                                                   07970001
079800     END-IF.                                                      07980001
079900                                                                  07990001
080000     IF  APOL   > ZERO                                            08000001
080100         MOVE APOI                 TO ASC-PO-NBR                  08010001
080200     ELSE                                                         08020001
080300         IF  APOF = DP015-ERASE-EOF                               08030001
080400             MOVE ZERO             TO ASC-PO-NBR-N                08040001
080500         END-IF                                                   08050001
080600     END-IF.                                                      08060001
080700                                                                  08070001
080800     IF  ARCVRL   > ZERO                                          08080001
080900         MOVE ARCVRI             TO ASC-REC-SEQ-NBR               08090001
081000     ELSE                                                         08100001
081100         IF  ARCVRF = DP015-ERASE-EOF                             08110001
081200             MOVE ZERO             TO ASC-REC-SEQ-NBR-N           08120001
081300         END-IF                                                   08130001
081400     END-IF.                                                      08140001
081500                                                                  08150001
081600     IF  ASERSHPL   > ZERO                                        08160001
081700         MOVE ASERSHPI             TO ASC-SERIAL-SHIP-CDE         08170001
081800     ELSE                                                         08180001
081900         IF  ASERSHPF = DP015-ERASE-EOF                           08190001
082000             MOVE SPACES           TO ASC-SERIAL-SHIP-CDE         08200001
082100         END-IF                                                   08210001
082200     END-IF.                                                      08220001
082300*----------------------------------------------------------------*08230001
082400* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *08240001
082500* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *08250001
082600* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*08260001
082700* IN THE DESTINATION PROGRAM, NOT HERE.                          *08270001
082800*----------------------------------------------------------------*08280001
082900 3000-EDIT-DATA-IN-COMMAREA.                                      08290001
083000                                                                  08300001
083100     PERFORM 3200-RESET-ATTRIBUTES.                               08310001
083200                                                                  08320001
083210     MOVE ZEROES  TO ASC-CURR-TRIP-ID.                            08321020
083220                                                                  08322020
083300     IF ASC-SCAC > SPACES                                         08330001
083400         MOVE ASC-SCAC         TO DK-SCAC-ID                      08340001
083500         PERFORM 3100-VALIDATE-SCAC-CDE                           08350001
083600         IF PS-SCAC-EXISTS                                        08360001
083700             SET PS-ENTRY-YES      TO TRUE                        08370001
083800             IF ASC-TRAILER > SPACES                              08380001
083900                 MOVE ASC-TRAILER      TO DK-TRLR-NBR             08390001
084000                 PERFORM 3050-VALIDATE-TRAILER                    08400001
084100                 IF PS-TRAILER-EXISTS                             08410001
084200                     MOVE -1              TO ATRLRL               08420001
084300                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          08430001
084400                     PERFORM 3010-GET-TRIP-ID                     08440001
084410                     PERFORM 3055-GET-CURR-TRIP                   08441026
084411                     IF  ASC-OPER-UNT-ID-N = ASC-TRIP-OPER-N      08441132
084412                         MOVE ZEROES  TO  ASC-CURR-TRIP-ID        08441232
084413                     ELSE                                         08441332
084414                         SET PS-ERROR                             08441432
084415                             DP020-MSG-FATAL  TO TRUE             08441532
084417                         MOVE PC-TSYMSG-03813 TO DP020-MSG-NUMBER 08441734
084418                         MOVE ASC-OPER-UNT-ID TO DP020-MSG-TEXT   08441834
084419                         MOVE DP015-UNP-ALP-BRT-OFF TO ATRLRA     08441934
084420                         MOVE DP015-RED       TO ATRLRC           08442032
084421                         MOVE DP015-REVERSE   TO ATRLRH           08442132
084422                         MOVE -1              TO ATRLRL           08442232
084423                         SET DP030-SET-CURSOR-APPL-1  TO TRUE     08442332
084430                     END-IF                                       08443032
084500                 ELSE                                             08450001
084510                     PERFORM 3055-GET-CURR-TRIP                   08451019
084600                     SET PS-ERROR                                 08460001
084700                         DP020-MSG-FATAL  TO TRUE                 08470001
084710                     MOVE PC-TSYMSG-03813 TO DP020-MSG-NUMBER     08471035
084720                     MOVE ASC-OPER-UNT-ID TO DP020-MSG-TEXT       08472035
084900                     MOVE DP015-UNP-ALP-BRT-OFF TO ATRLRA         08490001
085000                     MOVE DP015-RED       TO ATRLRC               08500001
085100                     MOVE DP015-REVERSE   TO ATRLRH               08510001
085200                     MOVE -1              TO ATRLRL               08520001
085300                     SET DP030-SET-CURSOR-APPL-1  TO TRUE         08530001
085400                 END-IF                                           08540001
085500             END-IF                                               08550001
085600         ELSE                                                     08560001
085700             SET PS-ERROR                                         08570001
085800                 DP020-MSG-FATAL  TO TRUE                         08580001
085900             MOVE PC-TSYMSG-02609 TO DP020-MSG-NUMBER             08590001
086000             MOVE DP015-UNP-ALP-BRT-OFF TO ASCACA                 08600001
086100             MOVE DP015-RED       TO ASCACC                       08610001
086200             MOVE DP015-REVERSE   TO ASCACH                       08620001
086300             MOVE -1              TO ASCACL                       08630001
086400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08640001
086500         END-IF                                                   08650001
086600     ELSE                                                         08660001
086700         IF ASC-TRAILER > SPACES                                  08670001
086800             SET PS-ERROR                                         08680001
086900                 DP020-MSG-FATAL  TO TRUE                         08690001
087000             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             08700001
087100             MOVE DP015-UNP-ALP-BRT-OFF TO ASCACA                 08710001
087200             MOVE DP015-RED       TO ASCACC                       08720001
087300             MOVE DP015-REVERSE   TO ASCACH                       08730001
087400             MOVE -1              TO ASCACL                       08740001
087500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08750001
087600         END-IF                                                   08760001
087700     END-IF.                                                      08770001
087800                                                                  08780001
087900     IF PS-NO-ERROR                                               08790001
088000       IF  ASC-TRIP-ID NOT = SPACES                               08800001
088100         MOVE ASC-TRIP-ID        TO DP010I-UNEDITED-FIELD         08810001
088200         MOVE LENGTH OF ASC-TRIP-ID                               08820001
088300                                 TO DP010I-MAXIMUM-DIGITS         08830001
088400         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       08840001
088500         SET DP010I-NEGATIVE-NOT-ALLOWED                          08850001
088600                                 TO TRUE                          08860001
088700         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08870039
088710              USING DP010I-NUMERIC-EDIT-AREA                      08871039
088800         IF  DP010I-ERROR-DETECTED                                08880001
088900             SET PS-ERROR                                         08890001
089000                 DP020-MSG-FATAL TO TRUE                          08900001
089100             MOVE PC-TSYMSG-00008                                 08910001
089200                                 TO DP020-MSG-NUMBER              08920001
089300             MOVE DP015-UNP-ALP-BRT-OFF                           08930001
089400                                 TO ATRIPA                        08940001
089500             MOVE DP015-RED      TO ATRIPC                        08950001
089600             MOVE DP015-REVERSE  TO ATRIPH                        08960001
089700             MOVE +1             TO ASCACL                        08970001
089800             MOVE -1             TO ATRIPL                        08980001
089900             SET DP030-SET-CURSOR-APPL-1                          08990001
090000                                 TO TRUE                          09000001
090100         ELSE                                                     09010001
090200             MOVE DP010I-NUMERIC-FIELD                            09020001
090300                                 TO ASC-TRIP-ID-N                 09030001
090400                                    ASC-KEY-TRIP-ID               09040001
090500                                    DK-TRIP-ID                    09050001
090600             MOVE ASC-TRIP-ID    TO ATRIPO                        09060001
090700                                                                  09070001
090800             PERFORM 3040-VALIDATE-TRIP                           09080001
090900             IF PS-TRIP-EXISTS                                    09090001
091000                SET PS-ENTRY-YES     TO TRUE                      09100001
091100                PERFORM 3011-GET-TRIP                             09110001
091200                IF PS-TRIP-EXISTS                                 09120001
091300                    MOVE -1                     TO ATRIPL         09130001
091400                    SET DP030-SET-CURSOR-APPL-1 TO TRUE           09140001
091500                 ELSE                                             09150001
091600                     SET PS-ERROR                                 09160001
091700                         DP020-MSG-FATAL         TO TRUE          09170001
091800                     MOVE PC-TSYMSG-03813      TO DP020-MSG-NUMBER09180033
091810                     MOVE ASC-OPER-UNT-ID      TO  DP020-MSG-TEXT 09181033
091900                     MOVE DP015-UNP-ALP-BRT-OFF  TO ATRIPA        09190001
092000                     MOVE DP015-RED              TO ATRIPC        09200001
092100                     MOVE DP015-REVERSE          TO ATRIPH        09210001
092200                     MOVE -1                     TO ATRIPL        09220001
092300                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09230001
092400*DMH 8/4/20          MOVE ZERO                   TO ASC-TRIP-ID-N 09240015
092500*DMH 8/4/20                                        ASC-KEY-TRIP-ID09250015
092600                 END-IF                                           09260001
092700             ELSE                                                 09270001
092800                 SET PS-ERROR                                     09280001
092900                     DP020-MSG-FATAL         TO TRUE              09290001
093010                 MOVE PC-TSYMSG-03813        TO DP020-MSG-NUMBER  09301033
093020                 MOVE ASC-OPER-UNT-ID        TO  DP020-MSG-TEXT   09302033
093100                 MOVE DP015-UNP-ALP-BRT-OFF  TO ATRIPA            09310001
093200                 MOVE DP015-RED              TO ATRIPC            09320001
093300                 MOVE DP015-REVERSE          TO ATRIPH            09330001
093400                 MOVE -1                     TO ATRIPL            09340001
093500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09350001
093600*DMH 8/4/20      MOVE ZERO                   TO ASC-TRIP-ID-N     09360015
093700*DMH 8/4/20                                     ASC-KEY-TRIP-ID   09370015
093800             END-IF                                               09380001
093900         END-IF                                                   09390001
094000       END-IF                                                     09400001
094100     END-IF.                                                      09410001
094200                                                                  09420001
094300     IF DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)                    09430001
094400         CONTINUE                                                 09440001
094500     ELSE                                                         09450001
094600         PERFORM 3005-EDIT-SERIAL-SHIP-CODE                       09460001
094700     END-IF.                                                      09470003
094800                                                                  09480001
094810     IF DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)                    09481003
094820         CONTINUE                                                 09482003
094830     ELSE                                                         09483003
094900         IF  PS-NO-ERROR                                          09490003
095000             IF  ASC-SERIAL-SHIP-CDE NOT = ZEROS                  09500003
095100                 MOVE ASC-SERIAL-SHIP-CDE TO DK-SERIAL-SHIP-CDE   09510003
095200                 PERFORM 3006-GET-PO-RCVR                         09520003
095300             END-IF                                               09530003
095310         END-IF                                                   09531003
095400     END-IF.                                                      09540001
095500                                                                  09550001
095600     IF  PS-NO-ERROR                                              09560001
095700         IF  ASC-PO-NBR > SPACES OR ZEROES                        09570001
095800             SET PS-ENTRY-YES          TO TRUE                    09580001
095900             MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD   09590001
096000             MOVE LENGTH OF ASC-PO-NBR TO DP010I-MAXIMUM-DIGITS   09600001
096100             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 09610001
096200             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              09620001
096300             CALL DP010I-NUMERIC-EDIT-ROUTINE                     09630039
096310                  USING DP010I-NUMERIC-EDIT-AREA                  09631039
096400             IF  DP010I-ERROR-DETECTED                            09640001
096500                 SET PS-ERROR                                     09650001
096600                     DP020-MSG-FATAL TO TRUE                      09660001
096700                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        09670001
096800                 MOVE DP015-UNP-ALP-BRT-OFF   TO APOA             09680001
096900                 MOVE DP015-RED               TO APOC             09690001
097000                 MOVE DP015-REVERSE           TO APOH             09700001
097100                 MOVE -1                      TO APOL             09710001
097200                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             09720001
097300             ELSE                                                 09730001
097400                 MOVE DP010I-NUMERIC-FIELD TO ASC-PO-NBR-N        09740001
097500                                              DK-PO-NBR           09750001
097600             END-IF                                               09760001
097700         END-IF                                                   09770001
097800     END-IF.                                                      09780001
097900     IF PS-NO-ERROR                                               09790001
098000         IF ASC-REC-SEQ-NBR > SPACES OR ZEROES                    09800001
098100             SET PS-ENTRY-YES     TO TRUE                         09810001
098200             MOVE ASC-REC-SEQ-NBR  TO DP010I-UNEDITED-FIELD       09820001
098300             MOVE LENGTH OF ASC-REC-SEQ-NBR                       09830001
098400                                 TO DP010I-MAXIMUM-DIGITS         09840001
098500             MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS   09850001
098600             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              09860001
098700             CALL DP010I-NUMERIC-EDIT-ROUTINE                     09870039
098710                  USING DP010I-NUMERIC-EDIT-AREA                  09871039
098800             IF  DP010I-ERROR-DETECTED                            09880001
098900                 SET PS-ERROR                                     09890001
099000                     DP020-MSG-FATAL        TO TRUE               09900001
099100                 MOVE PC-TSYMSG-00008       TO DP020-MSG-NUMBER   09910001
099200                 MOVE DP015-UNP-ALP-BRT-OFF   TO ARCVRA           09920001
099300                 MOVE DP015-RED               TO ARCVRC           09930001
099400                 MOVE DP015-REVERSE           TO ARCVRH           09940001
099500                 MOVE -1                      TO ARCVRL           09950001
099600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09960001
099700             ELSE                                                 09970001
099800                 MOVE DP010I-NUMERIC-FIELD TO ASC-REC-SEQ-NBR-N   09980001
099900                                              DK-REC-SEQ-NBR      09990001
100000             END-IF                                               10000001
100100         END-IF                                                   10010001
100200     END-IF.                                                      10020001
100300     IF PS-NO-ERROR                                               10030001
100400       IF ((ASC-PO-NBR > SPACES OR ZEROES)    AND                 10040001
100500         (ASC-REC-SEQ-NBR = SPACES OR ZEROES) AND                 10050001
100600          DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID))                 10060001
100700          PERFORM 3080-VALIDATE-PO-AND-OPER                       10070001
100800          IF PS-PO-OPER-EXISTS-NO                                 10080001
100900             SET PS-ERROR                                         10090001
101000                  DP020-MSG-FATAL TO TRUE                         10100001
101100             MOVE PC-TSYMSG-00083  TO DP020-MSG-NUMBER            10110001
101200             MOVE DP015-UNP-ALP-BRT-OFF   TO APOA                 10120001
101300             MOVE DP015-RED               TO APOC                 10130001
101400             MOVE DP015-REVERSE           TO APOH                 10140001
101500             MOVE -1                      TO APOL                 10150001
101600             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 10160001
101700          END-IF                                                  10170001
101800       ELSE                                                       10180001
101900         IF ASC-PO-NBR > SPACES OR ZEROES AND                     10190001
102000            ASC-REC-SEQ-NBR > SPACES OR ZEROES                    10200001
102100             IF DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)            10210001
102200                 PERFORM 3071-VALIDATE-PO-NBR                     10220001
102300             ELSE                                                 10230001
102400                 PERFORM 3070-VALIDATE-PO-NBR                     10240001
102500             END-IF                                               10250001
102600             MOVE ASC-PO-NBR          TO APOO                     10260001
102700             MOVE ASC-REC-SEQ-NBR     TO ARCVRO                   10270001
102800             IF SQLCODE = +100                                    10280001
102810                 PERFORM 3072-GET-PO-RCVR-OPERS                   10281021
102900                 SET PS-ERROR                                     10290001
103000                     DP020-MSG-FATAL TO TRUE                      10300001
103100                 MOVE PC-TSYMSG-03009  TO DP020-MSG-NUMBER        10310001
103200                 MOVE DP015-UNP-ALP-BRT-OFF   TO APOA             10320001
103300                                                 ARCVRA           10330001
103400                 MOVE DP015-RED               TO APOC             10340001
103500                                                 ARCVRC           10350001
103600                 MOVE DP015-REVERSE           TO APOH             10360001
103700                                                 ARCVRH           10370001
103800                 MOVE -1                      TO APOL             10380001
103900                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             10390001
104000             ELSE                                                 10400001
104010                 PERFORM 3072-GET-PO-RCVR-OPERS                   10401023
104100                 IF DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)        10410001
104200                     CONTINUE                                     10420001
104300                 ELSE                                             10430001
104400                 IF ASC-KEY-OPER-UNT-ID = RECEIV-CURR-OPER-UNT-ID 10440001
104500                     CONTINUE                                     10450001
104600                 ELSE                                             10460001
104700                     SET PS-ERROR                                 10470001
104800                         DP020-MSG-FATAL          TO TRUE         10480001
104900                     MOVE PC-TSYMSG-00955 TO DP020-MSG-NUMBER     10490001
105000                     MOVE DP015-UNP-ALP-BRT-OFF   TO APOA         10500001
105100                                                     ARCVRA       10510001
105200                     MOVE DP015-RED               TO APOC         10520001
105300                                                     ARCVRC       10530001
105400                     MOVE DP015-REVERSE           TO APOH         10540001
105500                                                     ARCVRH       10550001
105600                     MOVE -1                      TO APOL         10560001
105700                     SET DP030-SET-CURSOR-APPL-1  TO TRUE         10570001
105800                   END-IF                                         10580001
105900                 END-IF                                           10590001
106000             END-IF                                               10600001
106100         END-IF                                                   10610001
106200       END-IF                                                     10620001
106300     END-IF.                                                      10630001
106400                                                                  10640001
106500*----------------------------------------------------------------*10650001
106600 3005-EDIT-SERIAL-SHIP-CODE.                                      10660001
106700                                                                  10670001
106800     MOVE ASC-SERIAL-SHIP-CDE TO PV-INPUT-FIELD.                  10680001
106900     MOVE SPACES              TO PV-OUTPUT-FIELD.                 10690001
107000     MOVE +18                 TO PV-SUB2.                         10700001
107100                                                                  10710001
107200     PERFORM                                                      10720001
107300       VARYING PV-SUB1 FROM 18 BY -1                              10730001
107400         UNTIL PV-SUB1 = ZERO OR PS-ERROR                         10740001
107500                                                                  10750001
107600         IF PV-IN-BYTE (PV-SUB1) > SPACES                         10760001
107700             IF PV-IN-BYTE (PV-SUB1) NUMERIC                      10770001
107800                 MOVE PV-IN-BYTE (PV-SUB1)                        10780001
107900                   TO PV-OUT-BYTE (PV-SUB2)                       10790001
108000                 SUBTRACT 1 FROM PV-SUB2                          10800001
108100             ELSE                                                 10810001
108200                 SET PS-ERROR                                     10820001
108300                     DP020-MSG-FATAL         TO TRUE              10830001
108400                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  10840001
108500                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASERSHPA          10850001
108600                 MOVE DP015-RED              TO ASERSHPC          10860001
108700                 MOVE DP015-REVERSE          TO ASERSHPH          10870001
108800                 MOVE -1                     TO ASERSHPL          10880001
108900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              10890001
109000              END-IF                                              10900001
109100         END-IF                                                   10910001
109200                                                                  10920001
109300     END-PERFORM.                                                 10930001
109400                                                                  10940001
109500     IF PS-NO-ERROR                                               10950001
109600         INSPECT PV-OUTPUT-FIELD                                  10960001
109700           REPLACING ALL SPACES BY ZEROES                         10970001
109800                                                                  10980001
109900         MOVE PV-OUTPUT-FIELD TO ASC-SERIAL-SHIP-CDE-N            10990001
110000         MOVE -1                     TO ASERSHPL                  11000001
110100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      11010001
110200     END-IF.                                                      11020001
110300                                                                  11030001
110400******************************************************************11040001
110500* USE SSCC TO GET PO/RCVR TO PASS TO TRAILER LIST SCREEN.         11050001
110600******************************************************************11060001
110700 3006-GET-PO-RCVR.                                                11070001
110800                                                                  11080001
110900     PERFORM                                                      11090001
111000         WITH TEST AFTER                                          11100001
111100         VARYING PV-RETRY-COUNTER                                 11110001
111200         FROM 1 BY 1                                              11120001
111300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11130001
111400             OR (SQLCODE = +0)                                    11140001
111500             OR (SQLCODE = +100)                                  11150001
111600             OR (SQLCODE = -305))                                 11160001
111700                                                                  11170001
111800         EXEC SQL                                                 11180001
111900              SELECT DISTINCT                                     11190001
112000                     A.SHIPT_UNT_ID                               11200001
112100                   , A.PO_NBR                                     11210001
112200                   , A.SEQ_NBR                                    11220001
112300                   , C.REC_SEQ_NBR                                11230001
112400                INTO :INPKSU-SHIPT-UNT-ID                         11240001
112500                   , :INPKSU-PO-NBR                               11250001
112600                   , :INPKSU-SEQ-NBR                              11260001
112700                   , :PKSLIP-REC-SEQ-NBR                          11270001
112800              FROM   TINPKSU A                                    11280001
112900                    ,TPKSLIP C                                    11290001
113000              WHERE A.SHIPT_UNT_ID  = :DK-SERIAL-SHIP-CDE         11300001
113100                AND C.PO_NBR        = A.PO_NBR                    11310001
113200                AND C.SEQ_NBR       = A.SEQ_NBR                   11320001
113300                AND C.VER_STAT_CDE  = 'A'                         11330001
113400                AND C.PKSL_STAT_CDE = 'AC'                        11340001
113500         END-EXEC                                                 11350001
113600                                                                  11360001
113700         EVALUATE TRUE                                            11370001
113800             WHEN SQLCODE = +0                                    11380001
113900                  SET PS-SHIP-CDE-EXISTS TO TRUE                  11390001
114000                  MOVE INPKSU-PO-NBR     TO DK-PO-NBR             11400001
114100                                            ASC-PO-NBR-N          11410001
114200                  MOVE PKSLIP-REC-SEQ-NBR TO DK-REC-SEQ-NBR       11420001
114300                                            ASC-REC-SEQ-NBR-N     11430001
114400                                                                  11440001
114500             WHEN SQLCODE = +100                                  11450001
114600                 SET PS-ERROR                                     11460001
114700                     DP020-MSG-WARNING        TO TRUE             11470001
114800                 MOVE PC-TSYMSG-00954         TO DP020-MSG-NUMBER 11480001
114900                 MOVE DP015-UNP-ALP-BRT-OFF   TO APOA             11490001
115000                                                 ARCVRA           11500001
115100                 MOVE DP015-RED               TO APOC             11510001
115200                                                 ARCVRC           11520001
115300                 MOVE DP015-REVERSE           TO APOH             11530001
115400                                                 ARCVRH           11540001
115500                 MOVE -1                      TO APOL             11550001
115600                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             11560001
115700                                                                  11570001
115800             WHEN SQLCODE = -811                                  11580001
115900                 SET PS-ERROR                                     11590001
116000                     DP020-MSG-WARNING        TO TRUE             11600001
116100                 MOVE PC-TSYMSG-03016         TO DP020-MSG-NUMBER 11610001
116200                 MOVE DP015-UNP-ALP-BRT-OFF   TO APOA             11620001
116300                                                 ARCVRA           11630001
116400                 MOVE DP015-RED               TO APOC             11640001
116500                                                 ARCVRC           11650001
116600                 MOVE DP015-REVERSE           TO APOH             11660001
116700                                                 ARCVRH           11670001
116800                 MOVE -1                      TO APOL             11680001
116900                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             11690001
117000                                                                  11700001
117100             WHEN SQLCODE = -305                                  11710001
117200             WHEN SQLCODE = -904                                  11720001
117300             WHEN SQLCODE = -913                                  11730001
117400                  CONTINUE                                        11740001
117500                                                                  11750001
117600             WHEN SQLWARN0 NOT = SPACES                           11760001
117700             WHEN SQLCODE < +0                                    11770001
117800             WHEN SQLCODE > +0                                    11780001
117900                  MOVE '3006-GET-PO-RCVR'                         11790001
118000                                  TO DP013-PARAGRAPH              11800001
118100                  MOVE 'UNSUCCESSFUL SELECT ON TPKSLIP'           11810001
118200                                  TO DP013-MESSAGE-TEXT (1)       11820001
118300                  MOVE SQLCA      TO DP013-SQLCA                  11830001
118400                  MOVE 'TPKSLIP ' TO DP013-DB2-TABLE-NAME (1)     11840001
118500                  MOVE 'TINPKSU ' TO DP013-DB2-TABLE-NAME (2)     11850001
118600                  SET DP013-DB2-ABEND                             11860001
118700                      DP013-XCTL-DISPLAY-RESTART                  11870001
118800                                  TO TRUE                         11880001
118900                  PERFORM DP013-0000-PROCESS-ABEND                11890001
119000         END-EVALUATE                                             11900001
119100     END-PERFORM.                                                 11910001
119200                                                                  11920001
119300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    11930001
119400         SQLCODE NOT = +0                                         11940001
119500         MOVE '3006-GET-PO-RCVR'                                  11950001
119600                                  TO DP013-PARAGRAPH              11960001
119700         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPKSLIP'            11970001
119800                                  TO DP013-MESSAGE-TEXT (1)       11980001
119900         MOVE SQLCA               TO DP013-SQLCA                  11990001
120000         MOVE 'TPKSLIP '          TO DP013-DB2-TABLE-NAME (1)     12000001
120100         MOVE 'TINPKSU '          TO DP013-DB2-TABLE-NAME (2)     12010001
120200         SET DP013-DB2-ABEND                                      12020001
120300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   12030001
120400         PERFORM DP013-0000-PROCESS-ABEND                         12040001
120500     END-IF.                                                      12050001
120600                                                                  12060001
120700                                                                  12070001
120800******************************************************************12080001
120900 3010-GET-TRIP-ID.                                                12090001
121000                                                                  12100001
121100     PERFORM                                                      12110001
121200         WITH TEST AFTER                                          12120001
121300         VARYING PV-RETRY-COUNTER                                 12130001
121400         FROM 1 BY 1                                              12140001
121500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12150001
121600             OR (SQLCODE = +0)                                    12160001
121700             OR (SQLCODE = +100)                                  12170001
121800             OR (SQLCODE = -305))                                 12180001
121900                                                                  12190001
122000         EXEC SQL                                                 12200001
122100              SELECT DISTINCT                                     12210001
122200                     B.TRIP_STATUS_CDE                            12220001
122300                   , B.STATUS_DTE                                 12230001
122400                   , B.TRIP_ID                                    12240001
122500                INTO :TRIPST-TRIP-STATUS-CDE                      12250001
122600                   , :TRIPST-STATUS-DTE                           12260001
122700                   , :TRIPST-TRIP-ID                              12270001
122800              FROM   TVHTRIP A                                    12280001
122900                    ,TTRIPST B                                    12290001
123000                    ,TVEHICL C                                    12300001
123100              WHERE A.OWNER_SCAC_ID = :DK-SCAC-ID                 12310001
123200                AND A.VEH_NBR       = :DK-TRLR-NBR                12320001
123300                AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID             12330001
123400                AND B.FCLTY_ID      = :DK-FCLTY-ID                12340001
123500                AND A.TRIP_ID = B.TRIP_ID                         12350001
123600                AND B.TRIP_ID = C.CURR_TRIP_ID                    12360001
123700                AND B.STATUS_DTE =                                12370001
123800                      (SELECT MAX(D.STATUS_DTE)                   12380001
123900                         FROM TTRIPST D                           12390001
124000                        WHERE D.TRIP_ID       = A.TRIP_ID)        12400001
124100         END-EXEC                                                 12410001
124200                                                                  12420001
124300         EVALUATE TRUE                                            12430001
124400             WHEN SQLCODE = +0                                    12440001
124500                  MOVE TRIPST-TRIP-ID TO ASC-TRIP-ID              12450001
124600                  MOVE TRIPST-TRIP-STATUS-CDE TO DK-TRIP-STATUS   12460001
124700                                                                  12470001
124800             WHEN SQLCODE = -305                                  12480001
124900*            WHEN SQLCODE = +100                                  12490001
125000             WHEN SQLCODE = -904                                  12500001
125100             WHEN SQLCODE = -913                                  12510001
125200                  CONTINUE                                        12520001
125300                                                                  12530001
125400             WHEN SQLCODE = +100                                  12540001
125500             WHEN SQLCODE = -811                                  12550001
125600                  PERFORM 3011-GET-TRIP                           12560001
125700                                                                  12570001
125800             WHEN SQLWARN0 NOT = SPACES                           12580001
125900             WHEN SQLCODE < +0                                    12590001
126000             WHEN SQLCODE > +0                                    12600001
126100                  MOVE '3010-GET-TRIP-ID'                         12610001
126200                                  TO DP013-PARAGRAPH              12620001
126300                  MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'           12630001
126400                                  TO DP013-MESSAGE-TEXT (1)       12640001
126500                  STRING '  SCAC-' DK-SCAC-ID                     12650001
126600                         '  TRLR-' DK-TRLR-NBR                    12660001
126700                                     DELIMITED BY SIZE            12670001
126800                                INTO DP013-MESSAGE-TEXT (2)       12680001
126900                  MOVE SQLCA      TO DP013-SQLCA                  12690001
127000                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     12700001
127100                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)     12710001
127200                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3)     12720001
127300                  SET DP013-DB2-ABEND                             12730001
127400                      DP013-XCTL-DISPLAY-RESTART                  12740001
127500                                  TO TRUE                         12750001
127600                  PERFORM DP013-0000-PROCESS-ABEND                12760001
127700         END-EVALUATE                                             12770001
127800     END-PERFORM.                                                 12780001
127900                                                                  12790001
128000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    12800001
128100         SQLCODE NOT = +0                                         12810001
128200         MOVE '3010-GET-TRIP-ID'                                  12820001
128300                                  TO DP013-PARAGRAPH              12830001
128400         MOVE 'MAX RETRIES EXCEEDED ON SELECT TVHTRIP'            12840001
128500                                  TO DP013-MESSAGE-TEXT (1)       12850001
128600                  STRING '  SCAC-' DK-SCAC-ID                     12860001
128700                         '  TRLR-' DK-TRLR-NBR                    12870001
128800                                     DELIMITED BY SIZE            12880001
128900                                INTO DP013-MESSAGE-TEXT (2)       12890001
129000         MOVE SQLCA               TO DP013-SQLCA                  12900001
129100         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     12910001
129200         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2)     12920001
129300         MOVE 'TVEHICL '          TO DP013-DB2-TABLE-NAME (3)     12930001
129400         SET DP013-DB2-ABEND                                      12940001
129500             DP013-XCTL-DISPLAY-RESTART                           12950001
129600                                  TO TRUE                         12960001
129700         PERFORM DP013-0000-PROCESS-ABEND                         12970001
129800     END-IF.                                                      12980001
129900                                                                  12990001
130000     IF  SQLCODE = -305                                           13000001
130100*     OR SQLCODE = +100                                           13010001
130200         PERFORM                                                  13020001
130300             WITH TEST AFTER                                      13030001
130400             VARYING PV-RETRY-COUNTER                             13040001
130500             FROM 1 BY 1                                          13050001
130600             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           13060001
130700                 OR (SQLCODE = +0)                                13070001
130800                 OR (SQLCODE = -305))                             13080001
130900                                                                  13090001
131000             EXEC SQL                                             13100001
131100                  SELECT MAX(B.STATUS_DTE)                        13110001
131200                    INTO :TRIPST-STATUS-DTE                       13120001
131300                  FROM   TVHTRIP A                                13130001
131400                        ,TTRIPST B                                13140001
131500                  WHERE A.OWNER_SCAC_ID = :DK-SCAC-ID             13150001
131600                    AND A.VEH_NBR       = :DK-TRLR-NBR            13160001
131700                    AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID         13170001
131800                    AND B.FCLTY_ID      = :DK-FCLTY-ID            13180001
131900                    AND A.TRIP_ID       = B.TRIP_ID               13190001
132000             END-EXEC                                             13200001
132100                                                                  13210001
132200             EVALUATE TRUE                                        13220001
132300                 WHEN SQLCODE = -305                              13230001
132400                 WHEN SQLCODE = +100                              13240001
132500                     SET PS-TRIP-DOESNT-EXIST                     13250001
132600                                     TO TRUE                      13260001
132700                 WHEN SQLCODE = +0                                13270001
132800                      CONTINUE                                    13280001
132900                 WHEN SQLWARN0 NOT = SPACES                       13290001
133000                 WHEN SQLCODE < +0                                13300001
133100                 WHEN SQLCODE > +0                                13310001
133200                      MOVE '3010-GET-TRIP-ID'                     13320001
133300                                      TO DP013-PARAGRAPH          13330001
133400                      MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'       13340001
133500                                      TO DP013-MESSAGE-TEXT (1)   13350001
133600                      STRING '  SCAC-' DK-SCAC-ID                 13360001
133700                             '  TRLR-' DK-TRLR-NBR                13370001
133800                                         DELIMITED BY SIZE        13380001
133900                                    INTO DP013-MESSAGE-TEXT (2)   13390001
134000                      MOVE SQLCA      TO DP013-SQLCA              13400001
134100                      MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1) 13410001
134200                      MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2) 13420001
134300                      SET DP013-DB2-ABEND                         13430001
134400                          DP013-XCTL-DISPLAY-RESTART              13440001
134500                                      TO TRUE                     13450001
134600                      PERFORM DP013-0000-PROCESS-ABEND            13460001
134700             END-EVALUATE                                         13470001
134800         END-PERFORM                                              13480001
134900                                                                  13490001
135000         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                13500001
135100             SQLCODE NOT = +0                                     13510001
135200             MOVE '3010-GET-TRIP-ID'                              13520001
135300                                      TO DP013-PARAGRAPH          13530001
135400             MOVE 'MAX RETRIES EXCEEDED ON SELECT TVHTRIP'        13540001
135500                                      TO DP013-MESSAGE-TEXT (1)   13550001
135600                      STRING '  SCAC-' DK-SCAC-ID                 13560001
135700                             '  TRLR-' DK-TRLR-NBR                13570001
135800                                         DELIMITED BY SIZE        13580001
135900                                    INTO DP013-MESSAGE-TEXT (2)   13590001
136000             MOVE SQLCA               TO DP013-SQLCA              13600001
136100             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1) 13610001
136200             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2) 13620001
136300             SET DP013-DB2-ABEND                                  13630001
136400                 DP013-XCTL-DISPLAY-RESTART                       13640001
136500                                      TO TRUE                     13650001
136600             PERFORM DP013-0000-PROCESS-ABEND                     13660001
136700         END-IF                                                   13670001
136800     END-IF.                                                      13680001
136900                                                                  13690001
137000*----------------------------------------------------------------*13700001
137100*  GET MOST RECENT TRIP STATUS.                                  *13710001
137200*----------------------------------------------------------------*13720001
137300 3011-GET-TRIP.                                                   13730001
137400                                                                  13740024
141702     EXEC SQL                                                     14170224
141703          SELECT                                                  14170324
141704                 B.STATUS_DTE                                     14170424
141705               , B.TRIP_ID                                        14170524
141706               , B.TRIP_STATUS_CDE                                14170624
141707            INTO :TRIPST-STATUS-DTE                               14170725
141708               , :TRIPST-TRIP-ID                                  14170825
141709               , :TRIPST-TRIP-STATUS-CDE                          14170925
141710            FROM TVHTRIP A                                        14171024
141711                ,TTRIPST B                                        14171124
141712                ,TTRSTYP C                                        14171224
141713            WHERE A.OWNER_SCAC_ID   = :DK-SCAC-ID                 14171324
141714              AND A.VEH_NBR         = :DK-TRLR-NBR                14171424
141715              AND B.OPER_UNT_ID     = :DK-OPER-UNT-ID             14171524
141716              AND B.FCLTY_ID        = :DK-FCLTY-ID                14171624
141717              AND A.TRIP_ID         = B.TRIP_ID                   14171724
141718              AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE           14171824
141719              AND C.PRTY_CDE  IN                                  14171924
141720                  (SELECT MAX(E.PRTY_CDE)                         14172024
141721                     FROM TTRIPST D                               14172124
141722                        , TTRSTYP E                               14172224
141723                    WHERE B.TRIP_ID         = D.TRIP_ID           14172324
141724                      AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE   14172424
141725                  )                                               14172524
141726              AND B.STATUS_DTE IN                                 14172624
141727                 (SELECT (MAX(G.STATUS_DTE))                      14172724
141728                    FROM TVHTRIP F                                14172824
141729                       , TTRIPST G                                14172924
141730                       , TTRSTYP H                                14173024
141731                   WHERE F.OWNER_SCAC_ID    = :DK-SCAC-ID         14173124
141732                     AND F.VEH_NBR          = :DK-TRLR-NBR        14173224
141733                     AND F.TRIP_ID          = G.TRIP_ID           14173324
141734                     AND G.TRIP_STATUS_CDE  = H.TRIP_STATUS_CDE   14173426
141735                     AND H.PRTY_CDE  IN                           14173524
141736                         (SELECT MAX(J.PRTY_CDE)                  14173624
141737                            FROM TTRIPST I                        14173724
141738                               , TTRSTYP J                        14173824
141739                           WHERE G.TRIP_ID  =  I.TRIP_ID          14173924
141740                             AND I.TRIP_STATUS_CDE                14174024
141741                                            =  J.TRIP_STATUS_CDE  14174124
141742                          )                                       14174224
141743                 )                                                14174324
141744              AND B.STATUS_TME IN                                 14174436
141745                 (SELECT (MAX(GG.STATUS_TME))                     14174536
141746                    FROM TVHTRIP FF                               14174636
141747                       , TTRIPST GG                               14174736
141748                       , TTRSTYP HH                               14174836
141749                   WHERE FF.OWNER_SCAC_ID    = :DK-SCAC-ID        14174936
141750                     AND FF.VEH_NBR          = :DK-TRLR-NBR       14175036
141751                     AND FF.TRIP_ID          = GG.TRIP_ID         14175136
141752                     AND GG.TRIP_STATUS_CDE  = HH.TRIP_STATUS_CDE 14175236
141753                     AND HH.PRTY_CDE  IN                          14175336
141754                        (SELECT MAX(JJ.PRTY_CDE)                  14175436
141755                           FROM TTRIPST II                        14175536
141756                              , TTRSTYP JJ                        14175636
141757                          WHERE GG.TRIP_ID  =  II.TRIP_ID         14175736
141758                            AND II.TRIP_STATUS_CDE                14175836
141759                                           =  JJ.TRIP_STATUS_CDE  14175936
141760                        )                                         14176036
141761                     AND GG.STATUS_DTE IN                         14176136
141762                        (SELECT (MAX(GGG.STATUS_DTE))             14176236
141763                           FROM TVHTRIP FFF                       14176336
141764                              , TTRIPST GGG                       14176436
141765                              , TTRSTYP HHH                       14176536
141766                          WHERE FFF.OWNER_SCAC_ID  = :DK-SCAC-ID  14176636
141767                            AND FFF.VEH_NBR        = :DK-TRLR-NBR 14176736
141768                            AND FFF.TRIP_ID        = GGG.TRIP_ID  14176836
141769                            AND GGG.TRIP_STATUS_CDE               14176936
141770                                           = HHH.TRIP_STATUS_CDE  14177036
141771                            AND HHH.PRTY_CDE  IN                  14177136
141772                               (SELECT MAX(JJJ.PRTY_CDE)          14177236
141773                                  FROM TTRIPST III                14177336
141774                                     , TTRSTYP JJJ                14177436
141775                                 WHERE GGG.TRIP_ID = III.TRIP_ID  14177536
141776                                   AND III.TRIP_STATUS_CDE        14177636
141777                                         =  JJJ.TRIP_STATUS_CDE   14177736
141778                               )                                  14177836
141779                        )                                         14177936
141780                 )                                                14178036
141790     END-EXEC.                                                    14179036
141800                                                                  14180001
141900     EVALUATE TRUE                                                14190024
142000         WHEN SQLCODE = -305                                      14200024
142100         WHEN SQLCODE = +100                                      14210024
142200             SET PS-TRIP-DOESNT-EXIST                             14220024
142300                             TO TRUE                              14230024
142400         WHEN SQLCODE = +0                                        14240024
142500           MOVE TRIPST-TRIP-ID         TO ASC-TRIP-ID             14250024
142600           MOVE TRIPST-TRIP-STATUS-CDE TO DK-TRIP-STATUS          14260024
142700         WHEN SQLWARN0 NOT = SPACES                               14270024
142800         WHEN SQLCODE < +0                                        14280024
142900         WHEN SQLCODE > +0                                        14290024
143000              MOVE '3011-GET-TRIP'                                14300024
143100                              TO DP013-PARAGRAPH                  14310024
143200              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               14320024
143300                              TO DP013-MESSAGE-TEXT (1)           14330024
143400              STRING '  SCAC-' DK-SCAC-ID                         14340024
143500                     '  TRLR-' DK-TRLR-NBR                        14350024
143600                                 DELIMITED BY SIZE                14360024
143700                            INTO DP013-MESSAGE-TEXT (2)           14370024
143800              MOVE SQLCA      TO DP013-SQLCA                      14380024
143900              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         14390024
144000              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         14400024
144100              SET DP013-DB2-ABEND                                 14410024
144200                  DP013-XCTL-DISPLAY-RESTART                      14420024
144300                              TO TRUE                             14430024
144400              PERFORM DP013-0000-PROCESS-ABEND                    14440024
144500     END-EVALUATE.                                                14450024
144600                                                                  14460001
144610                                                                  14461024
144700*----------------------------------------------------------------*14470001
144800*  COMPARE THE OPER UNIT OF THE USER TO THE OPER UNIT OF THE     *14480001
144900*  CRITERIA ENTERED. IF THEY ARE NOT THE SAME REQUEST CONFIRM    *14490001
145000*  DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID) = F2.                   *14500001
145100*----------------------------------------------------------------*14510001
145200 3025-COMPARE-OPER-UNT-ID.                                        14520001
145300                                                                  14530001
145400     IF  PS-NO-ERROR                                              14540001
145500       IF DK-OPER-UNT-ID  = DP020-LOCATION-NBR                    14550001
145600           CONTINUE                                               14560001
145700       ELSE                                                       14570001
145800           SET PS-ERROR                                           14580001
145900              DP020-MSG-WARNING                                   14590001
146000              ASC-CONFIRM-FUNC-01       TO TRUE                   14600001
146100              MOVE DK-OPER-UNT-ID       TO DP020-MSG-TEXT         14610001
146200              MOVE PC-TSYMSG-02962      TO DP020-MSG-NUMBER       14620001
146300       END-IF                                                     14630001
146400     END-IF.                                                      14640001
146500*                                                                 14650001
146600******************************************************************14660001
146700*CHECK THE TRIP TABLE TO VERIFY THE TRIP ENTERED ON THE MAP IS ***14670001
146800*VALID                                                         ***14680001
146900******************************************************************14690001
147000 3040-VALIDATE-TRIP.                                              14700001
147100                                                                  14710001
147200     EXEC SQL                                                     14720001
147300          SELECT  TRIP_ID                                         14730001
147400               ,  OWNER_SCAC_ID                                   14740001
147500               ,  VEH_NBR                                         14750001
147600            INTO :TRIPST-TRIP-ID                                  14760001
147700               , :VHTRIP-OWNER-SCAC-ID                            14770001
147800               , :VHTRIP-VEH-NBR :DN-VEH-NBR                      14780001
147900          FROM   TVHTRIP                                          14790001
148000          WHERE  TRIP_ID        = :DK-TRIP-ID                     14800001
148100     END-EXEC.                                                    14810001
148200                                                                  14820001
148300     EVALUATE TRUE                                                14830001
148400         WHEN SQLCODE = +0                                        14840001
148500             SET PS-TRIP-EXISTS TO TRUE                           14850001
148600             MOVE VHTRIP-OWNER-SCAC-ID TO ASC-SCAC                14860001
148700             MOVE ASC-SCAC             TO ASCACO                  14870001
148800                                          DK-SCAC-ID              14880001
148900             IF DN-VEH-NBR = -1                                   14890001
149000                MOVE SPACES            TO ASC-TRAILER             14900001
149100             ELSE                                                 14910001
149200                MOVE VHTRIP-VEH-NBR    TO ASC-TRAILER             14920001
149300             END-IF                                               14930001
149400             MOVE ASC-TRAILER          TO ATRLRO                  14940001
149500                                          DK-TRLR-NBR             14950001
149510                                                                  14951010
149520             PERFORM 3045-GET-TRIP-OPER                           14952010
149530                                                                  14953010
149600         WHEN SQLCODE = +100                                      14960001
149700             SET PS-TRIP-DOESNT-EXIST TO TRUE                     14970001
149800             MOVE SPACES               TO ASCACO                  14980001
149900                                          ATRLRO                  14990001
150000                                          DK-SCAC-ID              15000001
150100                                          DK-TRLR-NBR             15010001
150200                                                                  15020001
150300         WHEN SQLWARN0 NOT = SPACES                               15030001
150400         WHEN SQLCODE < +0                                        15040001
150500         WHEN SQLCODE > +0                                        15050001
150600              MOVE '3040-VALIDATE-TRIP'                           15060001
150700                              TO DP013-PARAGRAPH                  15070001
150800              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               15080001
150900                              TO DP013-MESSAGE-TEXT (1)           15090001
151000              MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (2)           15100001
151100              MOVE SQLCA      TO DP013-SQLCA                      15110001
151200              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         15120001
151300              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         15130001
151400              SET DP013-DB2-ABEND                                 15140001
151500                  DP013-XCTL-DISPLAY-RESTART                      15150001
151600                              TO TRUE                             15160001
151700              PERFORM DP013-0000-PROCESS-ABEND                    15170001
151800     END-EVALUATE.                                                15180001
151900                                                                  15190001
151901                                                                  15190110
151902*----------------------------------------------------------------*15190210
151903*  GET THE CURRENT OPER FOR THE TRIP                             *15190310
151905*----------------------------------------------------------------*15190510
151910 3045-GET-TRIP-OPER.                                              15191010
151911     EXEC SQL                                                     15191110
151912          SELECT B.OPER_UNT_ID                                    15191210
151913               , D.LOC_NM                                         15191310
151916            INTO :PV-TRIP-OPER-UNT                                15191611
151917               , :PV-TRIP-LOC-NM                                  15191710
151919          FROM   TVHTRIP A                                        15191910
151920                ,TTRIPST B                                        15192010
151921                ,TTRSTYP C                                        15192110
151922                ,XLT_LOC D                                        15192210
151923          WHERE A.TRIP_ID         = :DK-TRIP-ID                   15192310
151927            AND A.TRIP_ID         = B.TRIP_ID                     15192710
151928            AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE             15192810
151929            AND C.PRTY_CDE IN                                     15192910
151930                (SELECT MAX(CC.PRTY_CDE)                          15193010
151931                   FROM TTRIPST CB                                15193110
151932                      , TTRSTYP CC                                15193210
151933                  WHERE B.TRIP_ID  = CB.TRIP_ID                   15193310
151934                    AND CB.TRIP_STATUS_CDE = CC.TRIP_STATUS_CDE   15193410
151935                )                                                 15193510
151936            AND B.OPER_UNT_ID     = D.LOC_NBR                     15193612
151937           WITH UR                                                15193710
151962     END-EXEC                                                     15196210
151963                                                                  15196310
151964     EVALUATE TRUE                                                15196410
151965         WHEN SQLCODE = -305                                      15196510
151966         WHEN SQLCODE = +100                                      15196610
151971              MOVE SPACES              TO ASC-TRIP-OPER           15197110
151972                                          ASC-TRIP-OPER-NME       15197210
151973         WHEN SQLCODE = +0                                        15197310
151974           MOVE PV-TRIP-OPER-UNT       TO ASC-TRIP-OPER-N         15197411
151975           MOVE PV-TRIP-LOC-NM         TO ASC-TRIP-OPER-NME       15197510
151976         WHEN SQLWARN0 NOT = SPACES                               15197610
151977         WHEN SQLCODE < +0                                        15197710
151978         WHEN SQLCODE > +0                                        15197810
151979              MOVE '3045-GET-TRIP-OPER'                           15197910
151980                              TO DP013-PARAGRAPH                  15198010
151981              MOVE 'UNSUCCESSFUL SELECT ON CURR TRIP LOC'         15198110
151982                              TO DP013-MESSAGE-TEXT (1)           15198210
151983              STRING '  SCAC-' DK-SCAC-ID                         15198310
151984                     '  TRLR-' DK-TRLR-NBR                        15198410
151985                                 DELIMITED BY SIZE                15198510
151986                            INTO DP013-MESSAGE-TEXT (2)           15198610
151987              MOVE SQLCA      TO DP013-SQLCA                      15198710
151988              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         15198810
151989              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         15198910
151990              MOVE 'TTRSTYP ' TO DP013-DB2-TABLE-NAME (3)         15199010
151991              SET DP013-DB2-ABEND                                 15199110
151992                  DP013-XCTL-DISPLAY-RESTART                      15199210
151993                              TO TRUE                             15199310
151994              PERFORM DP013-0000-PROCESS-ABEND                    15199410
151995     END-EVALUATE.                                                15199510
151996                                                                  15199610
151997                                                                  15199710
151998                                                                  15199810
152000*----------------------------------------------------------------*15200001
152100*  CHECK THE VEHICLE TRIP TABEL AND TRIP STATUS TABLE TO VERIFY  *15210001
152200*  THE TRAILER ENTERED ON THE MAP IS VALID                       *15220001
152300*----------------------------------------------------------------*15230001
152400 3050-VALIDATE-TRAILER.                                           15240001
152500                                                                  15250001
152600     EXEC SQL                                                     15260001
152700          SELECT B.TRIP_ID                                        15270001
152800                ,B.OPER_UNT_ID                                    15280001
152900            INTO :TRIPST-TRIP-ID                                  15290001
153000                ,:TRIPST-OPER-UNT-ID                              15300001
153100          FROM   TVHTRIP A                                        15310001
153200                ,TTRIPST B                                        15320001
153300          WHERE A.OWNER_SCAC_ID = :DK-SCAC-ID                     15330001
153400            AND A.VEH_NBR       = :DK-TRLR-NBR                    15340001
153500            AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID                 15350001
153600            AND B.FCLTY_ID      = :DK-FCLTY-ID                    15360001
153700            AND A.TRIP_ID = B.TRIP_ID                             15370001
153800     END-EXEC.                                                    15380001
153900                                                                  15390001
154000     EVALUATE TRUE                                                15400001
154100         WHEN SQLCODE = +0                                        15410001
154200         WHEN SQLCODE = -811                                      15420001
154300             SET PS-TRAILER-EXISTS   TO TRUE                      15430001
154400             MOVE TRIPST-OPER-UNT-ID TO ASC-TRLR-OPER-UNT-ID      15440001
154500                                                                  15450001
154600         WHEN SQLCODE = +100                                      15460001
154700             SET PS-TRAILER-EXISTS-NO TO TRUE                     15470001
154800             MOVE ZEROES              TO ASC-TRLR-OPER-UNT-ID     15480001
154900                                                                  15490001
155000         WHEN SQLWARN0 NOT = SPACES                               15500001
155100         WHEN SQLCODE < +0                                        15510001
155200         WHEN SQLCODE > +0                                        15520001
155300              MOVE '3050-VALIDATE-TRAILER'                        15530001
155400                              TO DP013-PARAGRAPH                  15540001
155500              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               15550001
155600                              TO DP013-MESSAGE-TEXT (1)           15560001
155700              MOVE SQLCA      TO DP013-SQLCA                      15570001
155800              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         15580001
155900              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         15590001
156000              MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3)         15600001
156100              SET DP013-DB2-ABEND                                 15610001
156200                  DP013-XCTL-DISPLAY-RESTART                      15620001
156300                              TO TRUE                             15630001
156400              PERFORM DP013-0000-PROCESS-ABEND                    15640001
156500     END-EVALUATE.                                                15650001
156600                                                                  15660001
156601                                                                  15660117
156610*----------------------------------------------------------------*15661017
156620*  GET THE CURRENT TRIP FOR THE SCAC/TRLR                        *15662017
156640*----------------------------------------------------------------*15664017
156650 3055-GET-CURR-TRIP.                                              15665017
156660                                                                  15666017
156670     EXEC SQL                                                     15667017
156680          SELECT B.TRIP_ID                                        15668017
156690               , B.OPER_UNT_ID                                    15669017
156691               , D.LOC_NM                                         15669117
156692               , B.STATUS_DTE                                     15669217
156693               , B.STATUS_TME                                     15669337
156694            INTO :PV-CURR-TRIP-ID                                 15669437
156695                ,:PV-CURR-OPER-UNT-ID                             15669537
156696                ,:PV-TRIP-LOC-NM                                  15669637
156697                ,:PV-CURR-STATUS-DATE                             15669737
156698                ,:PV-CURR-STATUS-TIME                             15669837
156699          FROM   TVHTRIP A                                        15669937
156700                ,TTRIPST B                                        15670037
156701                ,TTRSTYP C                                        15670137
156702                ,XLT_LOC D                                        15670237
156703          WHERE A.OWNER_SCAC_ID   = :DK-SCAC-ID                   15670337
156704            AND A.VEH_NBR         = :DK-TRLR-NBR                  15670437
156705            AND A.TRIP_ID         = B.TRIP_ID                     15670537
156706            AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE             15670637
156707            AND C.PRTY_CDE IN                                     15670737
156708                (SELECT MAX(CC.PRTY_CDE)                          15670837
156709                   FROM TTRIPST CB                                15670937
156710                      , TTRSTYP CC                                15671037
156711                  WHERE B.TRIP_ID  = CB.TRIP_ID                   15671137
156712                    AND CB.TRIP_STATUS_CDE = CC.TRIP_STATUS_CDE   15671237
156713                )                                                 15671337
156714             AND B.OPER_UNT_ID  =  D.LOC_NBR                      15671437
156715           ORDER BY B.STATUS_DTE DESC                             15671537
156716                  , B.STATUS_TME DESC                             15671637
156717           FETCH FIRST 1 ROW ONLY                                 15671737
156718     END-EXEC.                                                    15671837
156719                                                                  15671937
156720     EVALUATE TRUE                                                15672037
156721         WHEN SQLCODE = +0                                        15672137
156722         WHEN SQLCODE = -811                                      15672237
156724              MOVE PV-CURR-OPER-UNT-ID TO ASC-TRIP-OPER-N         15672417
156725              MOVE PV-TRIP-LOC-NM      TO ASC-TRIP-OPER-NME       15672517
156726              MOVE PV-CURR-TRIP-ID     TO ASC-CURR-TRIP-ID        15672617
156727                                                                  15672717
156728         WHEN SQLCODE = +100                                      15672817
156729             MOVE ZEROES               TO ASC-CURR-TRIP-ID        15672917
156730                                                                  15673017
156731         WHEN SQLWARN0 NOT = SPACES                               15673117
156732         WHEN SQLCODE < +0                                        15673217
156733         WHEN SQLCODE > +0                                        15673317
156734              MOVE '3055-GET-CURR-TRIP   '                        15673417
156735                              TO DP013-PARAGRAPH                  15673517
156736              MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'               15673617
156737                              TO DP013-MESSAGE-TEXT (1)           15673717
156738              MOVE SQLCA      TO DP013-SQLCA                      15673817
156739              MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)         15673917
156740              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)         15674017
156741              MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3)         15674117
156742              SET DP013-DB2-ABEND                                 15674217
156743                  DP013-XCTL-DISPLAY-RESTART                      15674317
156744                              TO TRUE                             15674417
156745              PERFORM DP013-0000-PROCESS-ABEND                    15674517
156746     END-EVALUATE.                                                15674617
156747                                                                  15674717
156750*----------------------------------------------------------------*15675001
156800*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *15680001
156900*  ENTERED IS VALID.                                             *15690001
157000*----------------------------------------------------------------*15700001
157100                                                                  15710001
157200 3060-VALIDATE-SHIP-CDE.                                          15720001
157300                                                                  15730001
157400     EXEC SQL                                                     15740001
157500            SELECT  DISTINCT                                      15750001
157600                    SHIPT_UNT_ID                                  15760001
157700             INTO  :SHPUNT-SHIPT-UNT-ID                           15770001
157800             FROM  TSHPUNT                                        15780001
157900             WHERE  SHIPT_UNT_ID = :DK-SERIAL-SHIP-CDE            15790001
158000               AND  ACTV_IND     = 'A'                            15800001
158100     END-EXEC.                                                    15810001
158200                                                                  15820001
158300     EVALUATE TRUE                                                15830001
158400         WHEN SQLCODE = +0                                        15840001
158500         WHEN SQLCODE = -811                                      15850001
158600             SET PS-SHIP-CDE-EXISTS       TO TRUE                 15860001
158700                                                                  15870001
158800         WHEN SQLCODE = +100                                      15880001
158900             SET PS-SHIP-CDE-DOESNT-EXIST TO TRUE                 15890001
159000                                                                  15900001
159100         WHEN SQLWARN0 NOT = SPACES                               15910001
159200         WHEN SQLCODE < +0                                        15920001
159300         WHEN SQLCODE > +0                                        15930001
159400             MOVE '3060-VALIDATE-SHIP-CDE'                        15940001
159500                             TO DP013-PARAGRAPH                   15950001
159600             MOVE 'SELECT SHIP CODE'                              15960001
159700                             TO DP013-MESSAGE-TEXT (1)            15970001
159800             MOVE DK-SERIAL-SHIP-CDE  TO DP013-MESSAGE-TEXT (2)   15980001
159900             MOVE SQLCA      TO DP013-SQLCA                       15990001
160000             MOVE 'TSHPUNT'  TO DP013-DB2-TABLE-NAME (1)          16000001
160100             SET DP013-DB2-ABEND                                  16010001
160200                             TO TRUE                              16020001
160300             SET DP013-XCTL-DISPLAY-RESTART                       16030001
160400                             TO TRUE                              16040001
160500             PERFORM DP013-0000-PROCESS-ABEND                     16050001
160600     END-EVALUATE.                                                16060001
160700                                                                  16070001
160800******************************************************************16080001
160900* VALIDATE PO NUMBER FROM TSHPTPO                                 16090001
161000******************************************************************16100001
161100 3070-VALIDATE-PO-NBR.                                            16110001
161200                                                                  16120001
161300         EXEC SQL                                                 16130001
161400            SELECT  DISTINCT                                      16140001
161500                    ORD_NBR                                       16150001
161600                   ,REC_SEQ_NBR                                   16160001
161700                   ,CURR_OPER_UNT_ID                              16170001
161800              INTO  :RECEIV-ORD-NBR                               16180001
161900                   ,:RECEIV-REC-SEQ-NBR                           16190001
162000                   ,:RECEIV-CURR-OPER-UNT-ID                      16200001
162100              FROM  TRECEIV                                       16210001
162200             WHERE  ORD_NBR     = :DK-PO-NBR                      16220001
162300             AND    REC_SEQ_NBR = :DK-REC-SEQ-NBR                 16230001
162400         END-EXEC                                                 16240001
162500                                                                  16250001
162600         EVALUATE TRUE                                            16260001
162700             WHEN SQLCODE = +0                                    16270001
162800             WHEN SQLCODE = -811                                  16280001
162900                 SET PS-PO-EXISTS                                 16290001
163000                     PS-RECEIVER-EXISTS  TO TRUE                  16300001
163100             WHEN SQLCODE = +100                                  16310001
163200             WHEN SQLCODE = -904                                  16320001
163300             WHEN SQLCODE = -913                                  16330001
163400                 CONTINUE                                         16340001
163500                                                                  16350001
163600             WHEN SQLWARN0 NOT = SPACES                           16360001
163700             WHEN SQLCODE < +0                                    16370001
163800             WHEN SQLCODE > +0                                    16380001
163900                 MOVE '3070-VALIDATE-PO-NBR'                      16390001
164000                                 TO DP013-PARAGRAPH               16400001
164100                 MOVE 'SELECT PO NUMBER   '                       16410001
164200                                 TO DP013-MESSAGE-TEXT (1)        16420001
164300                 MOVE SQLCA      TO DP013-SQLCA                   16430001
164400                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      16440001
164500                 SET DP013-DB2-ABEND  TO TRUE                     16450001
164600                 SET DP013-XCTL-DISPLAY-RESTART  TO TRUE          16460001
164700                 PERFORM DP013-0000-PROCESS-ABEND                 16470001
164800         END-EVALUATE.                                            16480001
164900                                                                  16490001
165000******************************************************************16500001
165100* VALIDATE PO NUMBER AS NEEDED BY RCKCS299                        16510001
165200******************************************************************16520001
165300 3071-VALIDATE-PO-NBR.                                            16530001
165400                                                                  16540001
165500         EXEC SQL                                                 16550001
165600            SELECT  DISTINCT                                      16560001
165700                    CURR_OPER_UNT_ID                              16570001
165800              INTO                                                16580001
165900                    :RECEIV-CURR-OPER-UNT-ID                      16590001
166000              FROM  TRECEIV                                       16600001
166100             WHERE  ORD_NBR     = :DK-PO-NBR                      16610001
166200         END-EXEC                                                 16620001
166300                                                                  16630001
166400         EVALUATE TRUE                                            16640001
166500             WHEN SQLCODE = +0                                    16650001
166600             WHEN SQLCODE = -811                                  16660001
166700                 SET PS-PO-EXISTS                                 16670001
166800                     PS-RECEIVER-EXISTS  TO TRUE                  16680001
166900             WHEN SQLCODE = +100                                  16690001
167000             WHEN SQLCODE = -904                                  16700001
167100             WHEN SQLCODE = -913                                  16710001
167200                 CONTINUE                                         16720001
167300                                                                  16730001
167400             WHEN SQLWARN0 NOT = SPACES                           16740001
167500             WHEN SQLCODE < +0                                    16750001
167600             WHEN SQLCODE > +0                                    16760001
167700                 MOVE '3071-VALIDATE-PO-NBR'                      16770001
167800                                 TO DP013-PARAGRAPH               16780001
167900                 MOVE 'SELECT PO NUMBER   '                       16790001
168000                                 TO DP013-MESSAGE-TEXT (1)        16800001
168100                 MOVE SQLCA      TO DP013-SQLCA                   16810001
168200                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      16820001
168300                 SET DP013-DB2-ABEND  TO TRUE                     16830001
168400                 SET DP013-XCTL-DISPLAY-RESTART  TO TRUE          16840001
168500                 PERFORM DP013-0000-PROCESS-ABEND                 16850001
168600         END-EVALUATE.                                            16860001
168700                                                                  16870001
168701******************************************************************16870121
168702* GET THE CREATE & CURRENT OPER FOR THE RECEIVER                  16870221
168703******************************************************************16870321
168710 3072-GET-PO-RCVR-OPERS.                                          16871021
168720     MOVE  ASC-PO-NBR       TO  PV-KEYED-PO.                      16872021
168730     MOVE  ASC-REC-SEQ-NBR  TO  PV-KEYED-RCVR.                    16873021
168740                                                                  16874021
168750         EXEC SQL                                                 16875021
168760            SELECT  CRE_OPER_UNT_ID                               16876021
168770                 ,  CURR_OPER_UNT_ID                              16877021
168780              INTO :PV-RCVR-CRE-OPER-UNT-ID                       16878022
168790                 , :PV-RCVR-CURR-OPER-UNT-ID                      16879022
168791              FROM  TRECEIV                                       16879121
168792             WHERE  ORD_NBR        = :PV-KEYED-PO                 16879221
168793               AND  REC_SEQ_NBR    = :PV-KEYED-RCVR               16879321
168794               AND  VER_STATUS_CDE = 'A'                          16879421
168795         END-EXEC                                                 16879521
168796                                                                  16879621
168797         EVALUATE TRUE                                            16879721
168798             WHEN SQLCODE = +0                                    16879821
168799             WHEN SQLCODE = -811                                  16879921
168800                  CONTINUE                                        16880021
168802             WHEN SQLCODE = +100                                  16880221
168803             WHEN SQLCODE = -904                                  16880321
168804             WHEN SQLCODE = -913                                  16880421
168805                  MOVE ZEROES TO PV-RCVR-CRE-OPER-UNT-ID          16880522
168806                                 PV-RCVR-CURR-OPER-UNT-ID         16880622
168808                                                                  16880821
168809             WHEN SQLWARN0 NOT = SPACES                           16880921
168810             WHEN SQLCODE < +0                                    16881021
168811             WHEN SQLCODE > +0                                    16881121
168812                 MOVE '3072-GET-PO-RCVR-OPERS'                    16881221
168813                                 TO DP013-PARAGRAPH               16881321
168814                 MOVE 'SELECT PO NUMBER   '                       16881421
168815                                 TO DP013-MESSAGE-TEXT (1)        16881521
168816                 MOVE SQLCA      TO DP013-SQLCA                   16881621
168817                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      16881721
168818                 SET DP013-DB2-ABEND  TO TRUE                     16881821
168819                 SET DP013-XCTL-DISPLAY-RESTART  TO TRUE          16881921
168820                 PERFORM DP013-0000-PROCESS-ABEND                 16882021
168821         END-EVALUATE.                                            16882121
168822                                                                  16882221
168830******************************************************************16883021
168900* VALIDATE PO NUMBER AND OPER FROM TRECEIV                        16890001
169000******************************************************************16900001
169100 3080-VALIDATE-PO-AND-OPER.                                       16910001
169200                                                                  16920001
169300         EXEC SQL                                                 16930001
169400            SELECT  DISTINCT                                      16940001
169500                    ORD_NBR                                       16950001
169600                   ,CURR_OPER_UNT_ID                              16960001
169700              INTO  :RECEIV-ORD-NBR                               16970001
169800                   ,:RECEIV-CURR-OPER-UNT-ID                      16980001
169900              FROM  TRECEIV                                       16990001
170000             WHERE  ORD_NBR           = :DK-PO-NBR                17000001
170100             AND    CURR_OPER_UNT_ID  = :DK-OPER-UNT-ID           17010001
170200         END-EXEC                                                 17020001
170300                                                                  17030001
170400         EVALUATE TRUE                                            17040001
170500             WHEN SQLCODE = +0                                    17050001
170600             WHEN SQLCODE = -811                                  17060001
170700                 SET PS-PO-OPER-EXISTS TO TRUE                    17070001
170800             WHEN SQLCODE = +100                                  17080001
170900             WHEN SQLCODE = -904                                  17090001
171000             WHEN SQLCODE = -913                                  17100001
171100                 SET PS-PO-OPER-EXISTS-NO TO TRUE                 17110001
171200                                                                  17120001
171300             WHEN SQLWARN0 NOT = SPACES                           17130001
171400             WHEN SQLCODE < +0                                    17140001
171500             WHEN SQLCODE > +0                                    17150001
171600                 MOVE '3080-VALIDATE-PO-AND OPER'                 17160001
171700                                 TO DP013-PARAGRAPH               17170001
171800                 MOVE 'SELECT PO NUMBER   '                       17180001
171900                                 TO DP013-MESSAGE-TEXT (1)        17190001
172000                 MOVE SQLCA      TO DP013-SQLCA                   17200001
172100                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      17210001
172200                 SET DP013-DB2-ABEND  TO TRUE                     17220001
172300                 SET DP013-XCTL-DISPLAY-RESTART  TO TRUE          17230001
172400                 PERFORM DP013-0000-PROCESS-ABEND                 17240001
172500         END-EVALUATE.                                            17250001
172600                                                                  17260001
172610*----------------------------------------------------------------*17261007
172620*  GET LOCATION NAME                                             *17262007
172630*----------------------------------------------------------------*17263007
172640 3085-GET-LOC-NAME.                                               17264007
172650                                                                  17265007
172660             EXEC SQL                                             17266007
172670                  SELECT LOC_NM                                   17267007
172692                    INTO :XLT00010-LOC-NM                         17269207
172695                    FROM XLT_LOC                                  17269507
172697                   WHERE LOC_NBR  =  :XLT00010-LOC-NBR            17269707
172728                    WITH UR                                       17272807
172729             END-EXEC                                             17272907
172730                                                                  17273007
172731             EVALUATE TRUE                                        17273107
172732                 WHEN SQLCODE = +0                                17273207
172733                      CONTINUE                                    17273307
172734                 WHEN SQLCODE = -305                              17273407
172735                 WHEN SQLCODE = +100                              17273507
172736                      MOVE SPACES TO XLT00010-LOC-NM              17273607
172739                 WHEN SQLWARN0 NOT = SPACES                       17273907
172740                 WHEN SQLCODE < +0                                17274007
172741                 WHEN SQLCODE > +0                                17274107
172742                      MOVE '3085-GET-LOC-NAME'                    17274207
172743                                      TO DP013-PARAGRAPH          17274307
172744                      MOVE 'UNSUCCESSFUL SELECT ON XLT_LOC'       17274407
172745                                      TO DP013-MESSAGE-TEXT (1)   17274507
172746                      MOVE XLT00010-LOC-NBR TO PV-DISP-OPER       17274607
172747                      STRING '  OPER-' PV-DISP-OPER               17274707
172749                                         DELIMITED BY SIZE        17274907
172750                                    INTO DP013-MESSAGE-TEXT (2)   17275007
172751                      MOVE SQLCA      TO DP013-SQLCA              17275107
172752                      MOVE 'XLT_LOC ' TO DP013-DB2-TABLE-NAME (1) 17275207
172754                      SET DP013-DB2-ABEND                         17275407
172755                          DP013-XCTL-DISPLAY-RESTART              17275507
172756                                      TO TRUE                     17275607
172757                      PERFORM DP013-0000-PROCESS-ABEND            17275707
172758             END-EVALUATE.                                        17275807
172759                                                                  17275907
172760                                                                  17276007
172770*----------------------------------------------------------------*17277007
172800*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *17280001
172900*  ENTERED IS VALID.                                             *17290001
173000*----------------------------------------------------------------*17300001
173100 3100-VALIDATE-SCAC-CDE.                                          17310001
173200                                                                  17320001
173300     EXEC SQL                                                     17330001
173400        SELECT  A.SCAC_CDE                                        17340001
173500          INTO :EXTENT-SCAC-CDE                                   17350001
173600          FROM  TEXTENT A                                         17360001
173700         WHERE  A.SCAC_CDE    = :DK-SCAC-ID                       17370001
173800           AND  A.CARRIER_IND = 'Y'                               17380001
173810         WITH UR                                                  17381004
173900     END-EXEC.                                                    17390001
174000                                                                  17400001
174100     EVALUATE TRUE                                                17410001
174200         WHEN SQLCODE = +0                                        17420001
174300         WHEN SQLCODE = -811                                      17430001
174400             SET PS-SCAC-EXISTS       TO TRUE                     17440001
174500                                                                  17450001
174600         WHEN SQLCODE = +100                                      17460001
174700             SET PS-SCAC-DOESNT-EXIST TO TRUE                     17470001
174800                                                                  17480001
174900         WHEN SQLWARN0 NOT = SPACES                               17490001
175000         WHEN SQLCODE < +0                                        17500001
175100         WHEN SQLCODE > +0                                        17510001
175200             MOVE '3100-VALIDATE-SCAC-CDE'  TO DP013-PARAGRAPH    17520001
175300             MOVE 'SELECT SCAC CODE'  TO DP013-MESSAGE-TEXT (1)   17530001
175400             MOVE DK-SCAC-ID TO DP013-MESSAGE-TEXT (2)            17540001
175500             MOVE SQLCA      TO DP013-SQLCA                       17550001
175600             MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)          17560001
175700             SET DP013-DB2-ABEND TO TRUE                          17570001
175800             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               17580001
175900             PERFORM DP013-0000-PROCESS-ABEND                     17590001
176000     END-EVALUATE.                                                17600001
176100                                                                  17610001
176200*----------------------------------------------------------------*17620001
176300* PUT TRIP STATUS INTO APPROPIATE ASC FIELD TO PASS TO TRAILER   *17630001
176400* LIST SCREEN.                                                   *17640001
176500*----------------------------------------------------------------*17650001
176600 3150-TRIP-STATUS.                                                17660001
176700                                                                  17670001
176800     EVALUATE TRUE                                                17680001
176900         WHEN DK-TRIP-STATUS  = 'AR'                              17690001
177000              MOVE DK-TRIP-STATUS  TO ASC-STATUS-AR               17700001
177100         WHEN DK-TRIP-STATUS  = 'UN'                              17710001
177200              MOVE DK-TRIP-STATUS  TO ASC-STATUS-UN               17720001
177300         WHEN DK-TRIP-STATUS  = 'UG'                              17730001
177400              MOVE DK-TRIP-STATUS  TO ASC-STATUS-UG               17740001
177500         WHEN DK-TRIP-STATUS  = 'EN'                              17750001
177600              MOVE DK-TRIP-STATUS  TO ASC-STATUS-EN               17760001
177700         WHEN DK-TRIP-STATUS  = 'DP'                              17770001
177800              MOVE DK-TRIP-STATUS  TO ASC-STATUS-DP               17780001
177900         WHEN OTHER                                               17790001
178000              MOVE 'AR'            TO ASC-STATUS-AR               17800001
178100              MOVE 'UN'            TO ASC-STATUS-UN               17810001
178200                                                                  17820001
178300     END-EVALUATE.                                                17830001
178400                                                                  17840001
178500/                                                                 17850001
178600******************************************************************17860001
178700** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **17870001
178800** MAP.                                                         **17880001
178900******************************************************************17890001
179000 3200-RESET-ATTRIBUTES.                                           17900001
179100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASCACA                      17910001
179200                                      ATRLRA                      17920001
179300                                      ATRIPA                      17930001
179400                                      APOA                        17940001
179500                                      ARCVRA                      17950001
179600                                      ASERSHPA.                   17960001
179700     MOVE DP015-GREEN              TO ASCACC                      17970001
179800                                      ATRLRC                      17980001
179900                                      ATRIPC                      17990001
180000                                      APOC                        18000001
180100                                      ARCVRC                      18010001
180200                                      ASERSHPC.                   18020001
180300     MOVE DP015-UNDERLINE          TO ASCACH                      18030001
180400                                      ATRLRH                      18040001
180500                                      ATRIPH                      18050001
180600                                      APOH                        18060001
180700                                      ARCVRH                      18070001
180800                                      ASERSHPH.                   18080001
180900     MOVE SPACES                   TO AMSGLNO.                    18090001
181000                                                                  18100001
181100*----------------------------------------------------------------*18110001
181200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *18120001
181300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *18130001
181400*  IT HERE.                                                      *18140001
181500*----------------------------------------------------------------*18150001
181600 4000-BUILD-INITIAL-PANEL.                                        18160001
181700     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        18170001
181800     MOVE -1                       TO ASCACL.                     18180001
181900                                                                  18190001
182000     MOVE SPACE                    TO ASCACO                      18200001
182100                                      ATRLRO                      18210001
182200                                      ARCVRO                      18220006
182210                                      ATROPO                      18221006
182220                                      ATROPDSO.                   18222006
182230                                                                  18223006
182300     MOVE ZEROES                   TO ATRIPO                      18230001
182400                                      APOO                        18240001
182500                                      ASERSHPO.                   18250001
182501                                                                  18250106
182510     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     18251006
182520     MOVE ASC-FCLTY-NME            TO AOPDESCO.                   18252006
182600                                                                  18260001
182700*                                                                 18270001
182800*----------------------------------------------------------------*18280001
182900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *18290001
183000*----------------------------------------------------------------*18300001
183100 4400-MOVE-COMMAREA-TO-SCREEN.                                    18310001
183200     MOVE ASC-SCAC                 TO ASCACO.                     18320001
183300     MOVE ASC-TRAILER              TO ATRLRO.                     18330001
183400     MOVE ASC-TRIP-ID              TO ATRIPO.                     18340001
183500     MOVE ASC-PO-NBR               TO APOO.                       18350001
183600     MOVE ASC-SERIAL-SHIP-CDE-N    TO ASERSHPO.                   18360001
183601*                                                                 18360105
183610     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     18361005
183620     MOVE ASC-FCLTY-NME            TO AOPDESCO.                   18362005
183640     MOVE ASC-TRIP-OPER            TO ATROPO.                     18364005
183650     MOVE ASC-TRIP-OPER-NME        TO ATROPDSO.                   18365005
183651     IF  ASC-CURR-TRIP-ID  > 0                                    18365133
183660         MOVE 'CURR TRIP ID:'      TO ACURRHDO                    18366033
183661         MOVE ASC-CURR-TRIP-ID     TO ACURTRPO                    18366133
183662     END-IF.                                                      18366233
183670                                                                  18367021
183680     IF  PV-RCVR-CRE-OPER-UNT-ID  > 0  AND                        18368022
183681         PV-RCVR-CURR-OPER-UNT-ID > 0                             18368122
183682                                                                  18368221
183683         SET PV-CRE-DISP  TO  TRUE                                18368321
183684         MOVE PV-RCVR-CRE-OPER-UNT-ID  TO PV-OPER-DISP            18368422
183685         MOVE PV-PO-RCVR-DISP          TO APOCRETO                18368522
183686                                                                  18368621
183687         SET PV-CURR-DISP TO  TRUE                                18368721
183688         MOVE PV-RCVR-CURR-OPER-UNT-ID TO PV-OPER-DISP            18368822
183689         MOVE PV-PO-RCVR-DISP          TO APOCURRO                18368922
183692                                                                  18369221
183693     ELSE                                                         18369321
183694         MOVE SPACES                   TO APOCRETO                18369422
183695                                          APOCURRO                18369522
183696     END-IF.                                                      18369621
183697                                                                  18369721
183698                                                                  18369821
183700 EJECT                                                            18370001
183800*----------------------------------------------------------------*18380001
183900*    ABEND PROCESSOR MODULE                                      *18390001
184000*----------------------------------------------------------------*18400001
184100                                                                  18410001
184200     COPY DPPD013.                                                18420001
