000100                                                                  00010000
000300*-----------------------*                                         00030001
000400 IDENTIFICATION DIVISION.                                         00040001
000500*-----------------------*                                         00050001
000600 PROGRAM-ID.    TRKCS169.                                         00060004
000700 AUTHOR.        RICHARD MOORE.                                    00070001
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080001
000900 DATE-WRITTEN.  11/98.                                            00090001
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001200*---------------------------------------------------------------* 00120001
001300*    Y169 - TRAILER SHIPMENT STATUS LIST                        * 00130004
001400*                                                               * 00140001
001500*    THIS PROGRAM GENERATES A LIST OF SHIPMENT STATUSES FOR     * 00150001
001600*    A GIVEN PO AND TRAILER.                                    * 00160001
001700*                                                               * 00170001
006600*                                                               * 00660001
006700*---------------------------------------------------------------* 00670001
006710*****************************************************************         
006720* DATE  05/16/2011                                                        
006730*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL          
006740*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR                 
006750*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC           
006760*  AND TSKXREF.                                                           
006770*  MADE BY: GERMAN BANDA                                                  
006780*****************************************************************         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
006800                                                                  00680001
006900 ENVIRONMENT DIVISION.                                            00690001
007000                                                                  00700001
007100 DATA DIVISION.                                                   00710001
007200                                                                  00720001
007300 WORKING-STORAGE SECTION.                                         00730001
007400                                                                  00740001
007500 01  DK-DB2-KEYS.                                                 00750001
007600     15  DK-PO-NBR                      PIC S9(09)  COMP.         00760001
007800     15  DK-VEH-NBR                     PIC  X(10).               00780004
007810     15  DK-OWNER-SCAC-ID               PIC  X(04).               00781004
007900     05  DK-TRIP-ID                     PIC S9(09)  COMP.         00790001
007910     05  DK-OPER-UNT-ID                 PIC S9(04)  COMP.         00791004
007920     05  DK-FCLTY-ID                    PIC S9(04)  COMP.         00792004
008000                                                                  00800001
008100 01  PC-PROGRAM-CONSTANTS.                                        00810001
008200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00820001
008300                                                    'TR169A  '.   00830004
008400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00840001
008500                                                    'TRKM169 '.   00850004
008600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00860001
008700                                                    'TRKCS169'.   00870004
008800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00880001
008900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00890001
009000     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '1'.    00900001
009100     05  PC-PO-CRIT-SUMM-FORMAT         PIC  X(01)  VALUE '2'.    00910001
009200     05  PC-PO-SAILING-FORMAT           PIC  X(01)  VALUE '3'.    00920001
009300     05  PC-0001                        PIC  X(04)  VALUE '0001'. 00930001
009400     05  PC-N                           PIC  X(01)  VALUE 'N'.    00940001
009500     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00950001
009600     05  PC-NEG-1                       PIC S9(03)  VALUE -1      00960001
009700                                                    COMP-3.       00970001
009800     05  PC-MULTI                       PIC  X(05)  VALUE 'MULTI'.00980001
009900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +09     00990004
010000                                                    COMP SYNC.    01000001
010100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01010001
010200                                                    COMP SYNC.    01020001
010300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01030001
010400                                                    +1000000      01040001
010500                                                    COMP-3.       01050001
010600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01060001
010700                                                    COMP SYNC.    01070001
010800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01080001
010900                                                    COMP-3.       01090001
011000     05  PC-INIT-DATE                   PIC  X(10)  VALUE         01100001
011100                                                    '0001-01-01'. 01110001
011900     05  PC-TSYMSG-NUMBERS.                                       01190001
012000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01200001
012100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01210001
012200         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01220001
012300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01230001
012400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01240001
012500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01250001
012600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01260001
012700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01270001
012800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01280001
012900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01290001
013000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01300001
013100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01310001
013200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01320001
013300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01330001
013400         10  PC-TSYMSG-01021            PIC  9(05)  VALUE 01021.  01340001
013500                                                                  01350001
013600 01  PS-PROGRAM-SWITCHES.                                         01360001
013700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01370001
013800         88  PS-NO-ERROR                            VALUE 'Y'.    01380001
013900         88  PS-ERROR                               VALUE 'N'.    01390001
014000     05  PS-LIST-SW                     PIC  X(01)  VALUE 'N'.    01400001
014100         88  PS-LIST-END                            VALUE 'Y'.    01410001
014200         88  PS-NO-LIST-END                         VALUE 'N'.    01420001
014300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01430001
014400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01440001
014500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01450001
014600                                                                  01460001
014700 01  PV-PROGRAM-VARIABLES.                                        01470001
014800     05  PV-DEPT-NBR                    PIC  X(04).                       
014900     05  PV-DEPT-NBR-N REDEFINES                                          
014901         PV-DEPT-NBR                    PIC S9(04).                       
014902     05  PV-SUB                         PIC S9(04)  VALUE +0      01480001
014903                                                    COMP SYNC.    01490001
015000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01500001
015100                                                    COMP SYNC.    01510001
015200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01520001
015300                                                    COMP-3.       01530001
015400     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      01540001
015500                                                    COMP-3.       01550001
015600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01560001
015700                                                    COMP-3.       01570001
015800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01580001
015900                                                    COMP-3.       01590001
016000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01600001
016100                                                    COMP-3.       01610001
016200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01620001
016300                                                    COMP-3.       01630001
016400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01640001
016500                                                    COMP-3.       01650001
016600     05  PV-LO-TRIP-NO-N PIC S9(9) COMP VALUE +0.                 01660001
016700     05  PV-HI-TRIP-NO-N PIC S9(9) COMP VALUE +0.                 01670001
016800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01680001
016900                                                    COMP-3.       01690001
017000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01700001
017100                                                    COMP SYNC.    01710001
017200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01720001
017300                                                    COMP SYNC.    01730001
017400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01740001
017500                                                    COMP SYNC.    01750001
017600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01760001
017700                                                    COMP SYNC.    01770001
017800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01780001
017900                                                    COMP SYNC.    01790001
018000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01800001
018100                                                    COMP SYNC.    01810001
018200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01820001
018300                                                    COMP SYNC.    01830001
018400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01840001
018500                                                    COMP SYNC.    01850001
018600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01860001
018700                                                    COMP SYNC.    01870001
018800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01880001
018900                                                    COMP SYNC.    01890001
019000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01900001
019100                                                    COMP SYNC.    01910001
019200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01920001
019300                                                    COMP SYNC.    01930001
019400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01940001
019500                                                    COMP SYNC.    01950001
019600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01960001
019700                                                    COMP SYNC.    01970001
019800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01980001
019900                                                    COMP SYNC.    01990001
020000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02000001
020100                                                    COMP SYNC.    02010001
020200     05  PV-CONTNR-NBR                  PIC  X(12)  VALUE SPACE.  02020001
020300     05  PV-CONTNR-SEQ-NBR              PIC S9(04)  COMP.         02030001
020400     05  PV-SHIPT-ID                    PIC S9(09)  COMP.         02040001
020500     05  PV-PO-NBR                      PIC S9(09)  COMP.         02050001
020600     05  PV-OPER-UNT-ID                 PIC S9(04)  COMP.         02060001
020700     05  PV-VEH-NBR                     PIC X(10)   VALUE SPACES. 02070001
020800     05  PV-FDR-POL-CDE                 PIC X(05)   VALUE SPACES. 02080001
020900     05  PV-MOM-POL-CDE                 PIC X(05)   VALUE SPACES. 02090001
021000     05  PV-MOM-TRIP-TYP-CDE            PIC X       VALUE SPACE.  02100001
021100     05  PV-FDR-TRIP-TYP-CDE            PIC X       VALUE SPACE.  02110001
021200     05  PV-MOM-DEST-POE-CDE            PIC X(04)   VALUE SPACES. 02120001
021300     05  PV-ACTL-POE-DELY-TMST          PIC X(26)   VALUE SPACES. 02130001
021400     05  PV-MOM-POE-DELY-TMST           PIC X(26)   VALUE SPACES. 02140001
021500     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      02150001
021600                                                    COMP.         02160001
021700     05  PV-SHIP-CNT                    PIC S9(04)  VALUE +0      02170001
021800                                                    COMP.         02180001
021810                                                                  02181004
021820     05  PV-TRLR-CART-CNT               PIC S9(04)  VALUE +0      02182004
021830                                                    COMP.         02183004
021840                                                                  02184004
021900     05  PV-DATE                        PIC X(5).                 02190001
022000     05  FILLER REDEFINES PV-DATE.                                02200001
022100         10  PV-DATE-MONTH              PIC XX.                   02210001
022200         10  PV-DATE-SLASH              PIC X.                    02220001
022300         10  PV-DATE-DAY                PIC XX.                   02230001
022310     05  PV-TIME                        PIC X(5).                 02231004
022320     05  FILLER REDEFINES PV-TIME.                                02232004
022330         10  PV-TIME-HOUR               PIC XX.                   02233004
022340         10  PV-TIME-COLON              PIC X.                    02234005
022350         10  PV-TIME-MIN                PIC XX.                   02235004
022360                                                                  02236004
022400     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      02240001
022500                                                    COMP.         02250001
022510     05  PV-TR-CART-CNT                 PIC S9(04)  VALUE +0      02251004
022520                                                    COMP.         02252004
022600     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      02260001
022700                                                    COMP.         02270001
022800     05  PV-SHPMT-TYPE.                                           02280001
022900         10 PV-SHPMT-FROM-CDE           PIC  X(03).               02290001
023000         10 FILLER                      PIC  X(01)  VALUE '/'.    02300001
023100         10 PV-SHPMT-TO-CDE             PIC  X(03).               02310001
023200                                                                  02320001
023300     05  PV-DATE-BREAK.                                           02330001
023400         10 FILLER                      PIC  X(02).               02340001
023500         10 PV-DB-YY                    PIC  X(02).               02350001
023600         10 FILLER                      PIC  X(01).               02360001
023700         10 PV-DB-MM                    PIC  X(02).               02370001
023800         10 FILLER                      PIC  X(01).               02380001
023900         10 PV-DB-DD                    PIC  X(02).               02390001
024000                                                                  02400001
024100     05 PV-DATE-DISPLAY.                                          02410001
024200         10 PV-DD-MM                    PIC  X(02).               02420001
024300         10 FILLER                      PIC  X(01)  VALUE '/'.    02430001
024400         10 PV-DD-DD                    PIC  X(02).               02440001
024500         10 FILLER                      PIC  X(01)  VALUE '/'.    02450001
024600         10 PV-DD-YY                    PIC  X(02).               02460001
024700                                                                  02470001
024710     05 PV-CREATE-DATE                  PIC X(10)   VALUE SPACES.         
024720     05 PV-CREATE-TIME                  PIC X(08)   VALUE SPACES.         
024721     05 PV-CREATE-UID                   PIC X(08)   VALUE SPACES.         
024730                                                                          
024800 01  PV-NULLS.                                                    02480001
024900     05  PV-SHIP-CNT-NULL               PIC S9(04)   VALUE +0     02490001
025000                                                    COMP SYNC.    02500001
025100     05  PV-STATUS-DTE-NULL             PIC S9(04)   VALUE +0     02510001
025200                                                    COMP SYNC.    02520001
025201                                                                  02520121
025202 01  PV-DUMMY-SELECT-VARIABLES.                                   02520221
025210     05  MR-DUMMY-AREA                  OCCURS 09 TIMES.          02521021
025220         10  MR-SELECTL                 PIC S9(04) COMP.          02522021
025230         10  MR-SELECTA                 PIC  X(01).               02523021
025240         10  MR-SELECTC                 PIC  X(01).               02524021
025250         10  MR-SELECTH                 PIC  X(01).               02525021
025260         10  MR-SELECTI                 PIC  X(01).               02526021
025280                                                                  02528021
025300*----------------------------------------------------------------*02530001
025400*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *02540001
025500*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *02550001
025600*   APPLICATION-SPECIFIC COMMAREA.                               *02560001
025700*----------------------------------------------------------------*02570001
025800 01  LQW-LIST-QUEUE-WORK-AREA.                                    02580001
025900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02590001
026000     05  LQW-ITEM-ENTRIES               OCCURS 09   TIMES         02600001
026100                                        INDEXED BY  LQW-IDX.      02610001
026200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02620001
026300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02630001
026400         10  LQW-SELECTED-SW            PIC  X(01).               02640001
026500             88  LQW-SELECT                         VALUE 'S'.    02650001
026600             88  LQW-DESELECT                       VALUE ' '.    02660001
026700         10  LQW-ACTION                 PIC  X(03).               02670001
026800         10  LQW-BL                     PIC  X(25).               02680004
026900         10  LQW-PRO                    PIC  X(20).               02690004
027000         10  LQW-STAT                   PIC  X(2).                02700004
027010         10  LQW-UID                    PIC  X(8).                02701005
027100         10  LQW-CRDT                   PIC  X(5).                02710005
027200         10  LQW-CRTM                   PIC  X(5).                02720005
028100                                                                  02810001
028200 EJECT                                                            02820001
028238*---------------------------------------------------------------* 02823808
028239*  RECORD LAYOUT FOR THE PO SELECTION TEMP STORAGE QUEUE.       * 02823908
028240*---------------------------------------------------------------* 02824008
028241                                                                  02824108
028242     COPY TRWS108.                                                02824208
028250                                                                  02825008
028300 EJECT                                                            02830008
029000*---------------------------------------------------------------* 02900001
029100*    MAP LAYOUT                                                 * 02910001
029200*---------------------------------------------------------------* 02920001
029300                                                                  02930001
029400     COPY TRKM169.                                                02940004
029500                                                                  02950001
029600 01  MR-OCCURS-LAYOUT                   REDEFINES  TR169AO.       02960004
029700** CHG0094517  CHANGED FILLER TO 341 FROM 340                     02970036
029700     05  FILLER                         PIC X(341).               02970036
029800                                                                  02980001
029900     05  MR-SCROLL-AREA                 OCCURS 09 TIMES.          02990001
030600         10  MR-ACTIONL                 PIC S9(04) COMP.          03060001
030700         10  MR-ACTIONA                 PIC  X(01).               03070001
030800         10  MR-ACTIONC                 PIC  X(01).               03080001
030900         10  MR-ACTIONH                 PIC  X(01).               03090001
031000         10  MR-ACTION                  PIC  X(03).               03100001
031100                                                                  03110001
031200         10  MR-BLL                     PIC S9(04) COMP.          03120004
031300         10  MR-BLA                     PIC  X(01).               03130004
031400         10  MR-BLC                     PIC  X(01).               03140004
031500         10  MR-BLH                     PIC  X(01).               03150004
031600         10  MR-BL                      PIC  X(25).               03160004
031700                                                                  03170001
031800         10  MR-PROL                    PIC S9(04) COMP.          03180004
031900         10  MR-PROA                    PIC  X(01).               03190004
032000         10  MR-PROC                    PIC  X(01).               03200004
032100         10  MR-PROH                    PIC  X(01).               03210004
032200         10  MR-PRO                     PIC  X(20).               03220004
032300                                                                  03230001
032302         10  MR-STATL                   PIC S9(04) COMP.          03230210
032303         10  MR-STATA                   PIC  X(01).               03230310
032304         10  MR-STATC                   PIC  X(01).               03230410
032305         10  MR-STATH                   PIC  X(01).               03230510
032306         10  MR-STAT                    PIC  X(02).               03230610
032307                                                                  03230710
032310         10  MR-UIDL                    PIC S9(04) COMP.          03231004
032320         10  MR-UIDA                    PIC  X(01).               03232004
032330         10  MR-UIDC                    PIC  X(01).               03233004
032340         10  MR-UIDH                    PIC  X(01).               03234004
032350         10  MR-UID                     PIC  X(08).               03235004
034200                                                                  03420004
034210         10  MR-CRDTL                   PIC S9(04) COMP.          03421038
034220         10  MR-CRDTA                   PIC  X(01).               03422038
034230         10  MR-CRDTC                   PIC  X(01).               03423038
034240         10  MR-CRDTH                   PIC  X(01).               03424038
034250         10  MR-CRDT                    PIC  X(05).               03425038
034260                                                                  03426038
034270         10  MR-CRTML                   PIC S9(04) COMP.          03427038
034280         10  MR-CRTMA                   PIC  X(01).               03428038
034290         10  MR-CRTMC                   PIC  X(01).               03429038
034291         10  MR-CRTMH                   PIC  X(01).               03429138
034292         10  MR-CRTM                    PIC  X(05).               03429238
035400                                                                  03540038
038400 EJECT                                                            03840001
038500*---------------------------------------------------------------* 03850001
038600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03860001
038700*---------------------------------------------------------------* 03870001
038800                                                                  03880001
038900     COPY DPWS015.                                                03890001
039000                                                                  03900001
039100 EJECT                                                            03910001
039200*---------------------------------------------------------------* 03920001
039300*    FUNCTION KEYS COPYBOOK.                                    * 03930001
039400*---------------------------------------------------------------* 03940001
039500                                                                  03950001
039600     COPY DPWS016.                                                03960001
039700                                                                  03970001
039800 EJECT                                                            03980001
039900*---------------------------------------------------------------* 03990001
040000*    NUMERIC EDIT LAYOUT.                                       * 04000001
040100*---------------------------------------------------------------* 04010001
040200                                                                  04020001
040300     COPY DPWS010I.                                               04030001
040400                                                                  04040001
040500 EJECT                                                            04050001
040600*---------------------------------------------------------------* 04060001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04070001
040800*---------------------------------------------------------------* 04080001
040900                                                                  04090001
041000     COPY DPWS030.                                                04100001
CICS       COPY DPWS930.                                                04110001
041200 EJECT                                                            04120001
041300*---------------------------------------------------------------* 04130001
041400*    STANDARD COMMAREA.                                         * 04140001
041500*---------------------------------------------------------------* 04150001
041600                                                                  04160001
041700     COPY DPWS020.                                                04170001
041800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04180001
041900                                                                  04190001
042000*---------------------------------------------------------------* 04200001
042100* INTER-APPLICATION COMMAREA.                                   * 04210001
042300*   TRWS109   FROM PO CRIT SPEC, SUMMARY OR SAILING LIST PGMS.  * 04230001
042400*---------------------------------------------------------------* 04240001
042500                                                                  04250001
042600         10  INTER-APPL-COMM-AREA       PIC X(200).               04260001
042900     COPY TRWS109.                                                04290001
043000                                                                  04300001
043100*---------------------------------------------------------------* 04310001
043200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04320001
043300*---------------------------------------------------------------* 04330001
043400         10  ASC-SPECIFIC-COMMAREA.                               04340001
043500             15  ASC-LIST-KEYS.                                   04350001
043600                 20  ASC-KEY-PO-NBR                  PIC S9(09)   04360001
043700                                                          COMP.   04370001
043800                 20  ASC-LO-TRIP-NO-N                PIC S9(09)   04380001
043900                                                          COMP.   04390001
044000                 20  ASC-HI-TRIP-NO-N                PIC S9(09)   04400001
044100                                                          COMP.   04410001
044200                 20  ASC-TUID                        PIC  X(08).  04420023
044210                 20  ASC-TDTE                        PIC  X(10).  04421023
044220                 20  ASC-TTME                        PIC  X(08).  04422023
044300                 20  ASC-KEY-OWNER-SCAC-ID           PIC  X(4).   04430005
044310                 20  ASC-KEY-VEH-NBR                 PIC  X(10).  04431005
044320                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   04432008
044321                                                          COMP.   04432105
044330                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   04433008
044340                                                          COMP.   04434005
044400                 20  ASC-OUTR-PACK-X                 PIC  X(05).  04440001
044500                 20  ASC-OUTR-PACK                   PIC  9(5).   04450001
044600                 20  ASC-OUTR-PACK-N REDEFINES ASC-OUTR-PACK      04460001
044700                                                     PIC ZZZZZ.   04470001
044800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04480001
044900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04490001
045000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04500001
045100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04510001
045200                                                                  04520001
045300                 20  ASC-ITEM-ARRAY.                              04530001
045400                     25  ASC-ITEM-ENTRIES OCCURS 09 TIMES.        04540001
045500                         30  ASC-LIST-ITEM-NUMBER                 04550001
045600                                                     PIC S9(09)   04560001
045700                                                     COMP-3.      04570001
045800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04580001
045900                             88  ASC-VALID-SELECT    VALUE ' '    04590001
046000                                                           'S'    04600001
046100                                                           'B'    04610001
046200                                                           'E'.   04620001
046300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04630001
046400                             88  ASC-TEMP-SELECT     VALUE 'S'.   04640001
046500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04650001
046600                             88  ASC-TEMP-END        VALUE 'E'.   04660001
046700                         30  ASC-SELECTED-SW         PIC  X(01).  04670001
046800                             88  ASC-NO-SELECT       VALUE ' '.   04680001
046900                             88  ASC-SELECT          VALUE 'S'.   04690001
047000                             88  ASC-BEGIN           VALUE 'B'.   04700001
047100                             88  ASC-END             VALUE 'E'.   04710001
047200                         30  ASC-ACTION              PIC  X(03).  04720001
047300                         30  ASC-SCAC                PIC  X(04).  04730001
047400                         30  ASC-BL                  PIC  X(25).  04740004
047410                         30  ASC-PRO                 PIC  X(20).  04741004
047430                         30  ASC-STAT                PIC  X(02).  04743004
047440                         30  ASC-UID                 PIC  X(08).  04744005
047600                         30  ASC-CRDT                PIC  X(05).  04760004
047700                         30  ASC-CRTM                PIC  X(05).  04770004
048900                                                                  04890001
049000             15  ASC-BLK-SUB                         PIC S9(04)   04900001
049100                                                          COMP    04910001
049200                                                          SYNC.   04920001
049300             15  ASC-ITEM-SUB                        PIC S9(04)   04930001
049400                                                          COMP    04940001
049500                                                          SYNC.   04950001
049600             15  ASC-SEL-ITEM                        PIC S9(04)   04960001
049700                                                          COMP    04970001
049800                                                          SYNC.   04980001
049900             15  ASC-SEL-SUB                         PIC S9(04)   04990001
050000                                                          COMP    05000001
050100                                                          SYNC.   05010001
050200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05020001
050300                                                          COMP-3. 05030001
050400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05040001
050500                                                          COMP-3. 05050001
050600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05060001
050700                                                          COMP-3. 05070001
050800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05080001
050900                                                          COMP-3. 05090001
051000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05100001
051100                                                          COMP-3. 05110001
051200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05120001
051300                                                          COMP    05130001
051400                                                          SYNC.   05140001
051500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05150001
051600                                                          COMP-3. 05160001
051700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05170001
051800                                                          COMP-3. 05180001
051900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05190001
052000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05200001
052100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05210001
052200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05220001
052300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05230001
052400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05240001
052500             15  ASC-LIST-QUEUE-NAME.                             05250001
052600                 20  ASC-LIST-TERM-ID                PIC  X(04).  05260001
052700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05270001
052800                                                          COMP-3. 05280001
052900                 20  ASC-LIST-SEQ                    PIC  9(01).  05290001
053000             15  ASC-SEL-QUEUE-NAME.                              05300001
053100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05310001
053200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05320001
053300                                                          COMP-3. 05330001
053400                 20  ASC-SEL-SEQ                     PIC  9(01).  05340001
053500             15  ASC-USE-SEL-QUEUE-SW    PIC  X(01).              05350001
053600                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   05360001
053700                 88  ASC-NO-USE-SELECTION-QUEUE      VALUE 'N'.   05370001
054000             15  ASC-CURSOR-SW                       PIC  X(01).  05400001
054100                 88  ASC-CONTNR-CURSOR               VALUE 'C'.   05410001
054200             15  ASC-START-ITEM-REQUEST.                          05420001
054300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05430001
054400                                                                  05440001
054500 EJECT                                                            05450001
054600*---------------------------------------------------------------* 05460001
054700*    ABEND PROCESSING COPYBOOK.                                 * 05470001
054800*---------------------------------------------------------------* 05480001
054900                                                                  05490001
055000     COPY DPWS013.                                                05500001
055100                                                                  05510001
055200 EJECT                                                            05520001
055300*---------------------------------------------------------------* 05530001
055400*    DB2 AREA FOR TIMCNTK                                       * 05540001
055500*---------------------------------------------------------------* 05550001
055600     EXEC SQL                                                     05560001
055700          INCLUDE TIMCNTK                                         05570001
055800     END-EXEC.                                                    05580001
055900*---------------------------------------------------------------* 05590001
056000*    DB2 AREA FOR TSHIPMT                                       * 05600001
056100*---------------------------------------------------------------* 05610001
056200     EXEC SQL                                                     05620001
056300          INCLUDE TSHIPMT                                         05630001
056400     END-EXEC.                                                    05640001
056410*---------------------------------------------------------------* 05641015
056420*    DB2 AREA FOR TSHSTYP                                       * 05642015
056430*---------------------------------------------------------------* 05643015
056440     EXEC SQL                                                     05644015
056450          INCLUDE TSHSTYP                                         05645015
056460     END-EXEC.                                                    05646015
056500*---------------------------------------------------------------* 05650001
056600*    DB2 AREA FOR TSHIPST                                       * 05660001
056700*---------------------------------------------------------------* 05670001
056800     EXEC SQL                                                     05680001
056900          INCLUDE TSHIPST                                         05690001
057000     END-EXEC.                                                    05700001
057100*---------------------------------------------------------------* 05710001
057200*    DB2 AREA FOR TSHPTPO                                       * 05720001
057300*---------------------------------------------------------------* 05730001
057400     EXEC SQL                                                     05740001
057500          INCLUDE TSHPTPO                                         05750001
057600     END-EXEC.                                                    05760001
057610*---------------------------------------------------------------* 05710001
057620*    DB2 AREA FOR TAUSHPO                                       * 05720001
057630*---------------------------------------------------------------* 05730001
057640     EXEC SQL                                                     05740001
057650          INCLUDE TAUSHPO                                         05750001
057660     END-EXEC.                                                    05760001
057670*---------------------------------------------------------------* 05710001
057680*    DB2 AREA FOR TAUSHIP                                       * 05720001
057690*---------------------------------------------------------------* 05730001
057691     EXEC SQL                                                     05740001
057692          INCLUDE TAUSHIP                                         05750001
057693     END-EXEC.                                                    05760001
057700*---------------------------------------------------------------* 05770001
057800*    DB2 AREA FOR TPKSLIP                                       * 05780001
057900*---------------------------------------------------------------* 05790001
058000     EXEC SQL                                                     05800001
058100          INCLUDE TPKSLIP                                         05810001
058200     END-EXEC.                                                    05820001
058300*---------------------------------------------------------------* 05830001
058400*    DB2 AREA FOR TVEHICL                                       * 05840001
058500*---------------------------------------------------------------* 05850001
058600     EXEC SQL                                                     05860001
058700          INCLUDE TVEHICL                                         05870001
058800     END-EXEC.                                                    05880001
058810*---------------------------------------------------------------* 05830001
058820*    DB2 AREA FOR TAUVHCL                                       * 05840001
058830*---------------------------------------------------------------* 05850001
058840     EXEC SQL                                                     05860001
058850          INCLUDE TAUVHCL                                         05870001
058860     END-EXEC.                                                    05880001
058900*---------------------------------------------------------------* 05890001
059000*    DB2 AREA FOR TVHTRIP                                       * 05900001
059100*---------------------------------------------------------------* 05910001
059200     EXEC SQL                                                     05920001
059300          INCLUDE TVHTRIP                                         05930001
059400     END-EXEC.                                                    05940001
059500*---------------------------------------------------------------* 05950001
059600*    DB2 AREA FOR TIMCNPO                                       * 05960001
059700*---------------------------------------------------------------* 05970001
059800     EXEC SQL                                                     05980001
059900          INCLUDE TIMCNPO                                         05990001
060000     END-EXEC.                                                    06000001
060100*---------------------------------------------------------------* 06010001
060200*    DB2 AREA FOR TPURCHS                                       * 06020001
060300*---------------------------------------------------------------* 06030001
060400     EXEC SQL                                                     06040001
060500          INCLUDE TPURCHS                                         06050001
060600     END-EXEC.                                                    06060001
060700*---------------------------------------------------------------* 06070001
060800*    DB2 AREA FOR TPURITM                                       * 06080001
060900*---------------------------------------------------------------* 06090001
061000     EXEC SQL                                                     06100001
061100          INCLUDE TPURITM                                         06110001
061200     END-EXEC.                                                    06120001
061300*---------------------------------------------------------------* 06130001
061400*    DB2 AREA FOR TPLNSHP                                       * 06140001
061500*---------------------------------------------------------------* 06150001
061600     EXEC SQL                                                     06160001
061700          INCLUDE TPLNSHP                                         06170001
061800     END-EXEC.                                                    06180001
061900*---------------------------------------------------------------* 06190001
062000*    DB2 AREA FOR TENTNME                                       * 06200001
062100*---------------------------------------------------------------* 06210001
062200     EXEC SQL                                                     06220001
062300          INCLUDE TENTNME                                         06230001
062400     END-EXEC.                                                    06240001
062401*----------------------------------------------------------------*        
062402*    DB2 AREA FOR THE TSKXREF TABLE                              *        
062403*----------------------------------------------------------------*        
062404     EXEC SQL                                                             
062405          INCLUDE TSKXREF                                                 
062406     END-EXEC.                                                            
062407*----------------------------------------------------------------*        
062408*    DB2 AREA FOR THE TUPC TABLE                                 *        
062409*----------------------------------------------------------------*        
062410     EXEC SQL                                                             
062411          INCLUDE TUPC                                                    
062412     END-EXEC.                                                            
063100*---------------------------------------------------------------* 06310001
063200*    DB2 AREA FOR TIMFOB                                        * 06320001
063300*---------------------------------------------------------------* 06330001
063400     EXEC SQL                                                     06340001
063500          INCLUDE TIMFOB                                          06350001
063600     END-EXEC.                                                    06360001
063700*---------------------------------------------------------------* 06370001
063800*    DB2 AREA FOR TIMPOE                                        * 06380001
063900*---------------------------------------------------------------* 06390001
064000     EXEC SQL                                                     06400001
064100          INCLUDE TIMPOE                                          06410001
064200     END-EXEC.                                                    06420001
064210*---------------------------------------------------------------* 06421025
064220*    DB2 AREA FOR TAUTRIP                                       * 06422025
064230*---------------------------------------------------------------* 06423025
064240     EXEC SQL                                                     06424025
064250          INCLUDE TAUTRIP                                         06425025
064260     END-EXEC.                                                    06426025
064270*---------------------------------------------------------------*         
064280*    DB2 AREA FOR XLT_SKU                                       *         
064290*---------------------------------------------------------------*         
064291     EXEC SQL                                                             
064292          INCLUDE XLT00003                                                
064293     END-EXEC.                                                            
064294*---------------------------------------------------------------*         
064295*    DB2 AREA FOR XLT_VND_STYL                                  *         
064296*---------------------------------------------------------------*         
064297     EXEC SQL                                                             
064298          INCLUDE XLT00004                                                
064299     END-EXEC.                                                            
064300*---------------------------------------------------------------* 06430001
064400*    DB2 AREA FOR COMMUNICATIONS                                * 06440001
064500*---------------------------------------------------------------* 06450001
064600     EXEC SQL                                                     06460001
064700          INCLUDE SQLCA                                           06470001
064800     END-EXEC.                                                    06480001
087701*---------------------------------------------------------------* 08770104
087702*  REFER TO THE TOP OF THE PROGRAM FOR DOCUMENTATION ON         * 08770204
087703*  THE FOLLOWING CURSOR                                         * 08770304
087704*---------------------------------------------------------------* 08770404
087710     EXEC SQL                                                     08771004
087720          DECLARE STAT-CSR CURSOR                                 08772004
087730            FOR SELECT                                            08773004
087740                    B.BOL_NBR                                     08774004
087750                   ,B.PRO_NBR                                     08775004
087760                   ,G.SHIPT_STATUS_CDE                            08776004
087761                   ,G.STATUS_DTE                                          
087762                   ,G.STATUS_TME                                          
087763                   ,G.STATUS_UID                                          
087764                   ,H.PRTY_CDE                                    08776113
087790                   ,E.LAST_UPD_UID                                08779022
087791                   ,E.LAST_UPD_DTE                                08779122
087792                   ,E.LAST_UPD_TME                                08779222
087794            FROM TSHPTPO A                                        08779304
087795                ,TSHIPMT B                                        08779404
087796                ,TVHTRIP E                                        08779504
087797                ,TSHIPST G                                        08779704
087798                ,TSHSTYP H                                        08779813
087800            WHERE A.PO_NBR         = :DK-PO-NBR                   08780022
087801            AND  (B.TRIP_ID       >= :PV-LO-TRIP-NO-N             08780122
087802            AND   B.TRIP_ID       <= :PV-HI-TRIP-NO-N)            08780222
087803            AND   E.VEH_NBR        = :DK-VEH-NBR                  08780322
087804            AND   E.OWNER_SCAC_ID  = :DK-OWNER-SCAC-ID            08780422
087805            AND   A.SHIPT_ID       = B.SHIPT_ID                   08780522
087806            AND   B.TRIP_ID        = E.TRIP_ID                    08780622
087809            AND   A.SHIPT_ID       = G.SHIPT_ID                   08780904
087810            AND   G.SHIPT_STATUS_CDE = H.SHIPT_STATUS_CDE         08781013
087820            ORDER BY B.BOL_NBR, H.PRTY_CDE                        08782014
088006     END-EXEC.                                                    08800604
088007*----------------------------------------------------------------*08800701
088008*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *08800801
088010*----------------------------------------------------------------*08801001
088100                                                                  08810001
088200     EXEC SQL                                                             
088300          DECLARE  OUTR-PCK-CSR CURSOR                            02970099
088400             FOR   SELECT                                         02980099
088500                   A.UNT_QTY                                      03000099
088600                ,  A.OUTR_PK_QTY                                  02990099
088700             FROM  TPURITM  A                                     03010099
089000             WHERE A.PO_NBR         = :DK-PO-NBR                          
089400             AND   A.VER_STATUS_CDE = 'A'                         03050099
089401             FOR   FETCH ONLY                                     03060099
089402     END-EXEC.                                                            
089403                                                                  08940001
089500 EJECT                                                            08950001
089501*----------------------------------------------------------------*08950117
089502*    CURSOR DECLARATION FOR SELECTING TRLR CTN QUANTITY          *08950217
089503*----------------------------------------------------------------*08950317
089504     EXEC SQL                                                     08950417
089505          DECLARE  TRLR-CTN-CSR CURSOR                            08950517
089520            FOR SELECT                                            08952018
089530                   A.PO_NBR                                       08953017
089540                  ,C.OPER_UNT_ID                                  08954017
089550                  ,C.FCLTY_ID                                     08955017
089560                  ,SUM(DISTINCT C.EXPTED_PKG_QTY)                 08956017
089570            FROM TSHPTPO A                                        08957017
089580                ,TSHIPMT B                                        08958017
089590                ,TPKSLIP C                                        08959017
089591                ,TVHTRIP D                                        08959117
089592            WHERE A.PO_NBR         = :DK-PO-NBR                   08959217
089593            AND   C.OPER_UNT_ID    = :DK-OPER-UNT-ID              08959317
089594            AND   C.FCLTY_ID       = :DK-FCLTY-ID                 08959417
089595            AND   D.OWNER_SCAC_ID  = :DK-OWNER-SCAC-ID            08959517
089596            AND   D.VEH_NBR        = :DK-VEH-NBR                  08959617
089597            AND  (B.TRIP_ID       >= :PV-LO-TRIP-NO-N             08959717
089598            AND   B.TRIP_ID       <= :PV-HI-TRIP-NO-N)            08959817
089599            AND   A.PO_NBR         = C.PO_NBR                     08959917
089600            AND   A.SHIPT_ID       = B.SHIPT_ID                   08960017
089601            AND   A.REC_SEQ_NBR    = C.REC_SEQ_NBR                08960117
089602            AND   A.REC_SEQ_NBR   <> 0                            08960217
089603            AND  (B.BOL_NBR        = C.BOL_NBR                    08960317
089604            OR    B.PRO_NBR        = C.PRO_NBR)                   08960417
089605            AND   B.TRIP_ID        = D.TRIP_ID                    08960517
089606            AND   C.VER_STAT_CDE   = 'A'                          08960617
089607            GROUP BY A.PO_NBR, C.OPER_UNT_ID, C.FCLTY_ID          08960717
089608     END-EXEC.                                                    08960817
089609 EJECT                                                            08960917
089610*----------------------------------------------------------------*08950117
089611*    CURSOR DECLARATION FOR SELECTING CREATE USER ID, DATE, AND  *08950217
089612*    TIME OF SHIPMENT STATUS.                                    *        
089613*----------------------------------------------------------------*08950317
089614     EXEC SQL                                                     08950417
089615          DECLARE  CREATE-CSR CURSOR                              08950517
089616            FOR SELECT                                            08952018
089617                   A.PO_NBR                                       08953017
089618                  ,B.LAST_UPD_UID                                         
089621                  ,B.LAST_UPD_DTE  AS CRE_DATE                            
089622                  ,B.LAST_UPD_TME  AS CRE_TIME                            
089623            FROM   TAUSHPO A                                              
089624                  ,TAUSHIP B                                              
089625                  ,TSHIPST C                                              
089626                  ,TSHSTYP F                                              
089627          WHERE  A.PO_NBR           IN (:DK-PO-NBR)                       
089628            AND  B.BOL_NBR          =  :SHIPMT-BOL-NBR                    
089629            AND  B.PRO_NBR          =  :SHIPMT-PRO-NBR                    
089631            AND  C.SHIPT_STATUS_CDE =  :SHIPST-SHIPT-STATUS-CDE           
089632            AND  A.SHIPT_ID         =  B.SHIPT_ID                         
089633            AND  A.SHIPT_ID         =  C.SHIPT_ID                         
089634            AND  C.SHIPT_STATUS_CDE =  F.SHIPT_STATUS_CDE                 
089635            AND ((B.LAST_UPD_UID    =  C.STATUS_UID                       
089636            AND  ('TRKUP004'        =  C.STATUS_UID                       
089637             OR   'RCKUP006'        =  C.STATUS_UID))                     
089638             OR  (B.AUD_STATUS_CDE  =  C.SHIPT_STATUS_CDE                 
089639            AND   'TRKUP004'        <> B.LAST_UPD_UID                     
089640            AND   'RCKUP006'        <> B.LAST_UPD_UID))                   
089643       GROUP BY A.PO_NBR                                                  
089644               ,B.LAST_UPD_UID                                            
089645               ,B.LAST_UPD_DTE                                            
089646               ,B.LAST_UPD_TME                                            
089647    UNION                                                                 
089648         SELECT                                                           
089649                A.PO_NBR                                                  
089650               ,C.LAST_UPD_UID                                            
089651               ,C.LAST_UPD_DTE  AS CRE_DATE                               
089652               ,C.LAST_UPD_TME  AS CRE_TIME                               
089653           FROM  TAUSHPO A                                                
089654                ,TAUSHIP B                                                
089655                ,TAUTRIP C                                                
089656                ,TSHIPST D                                                
089657                ,TSHSTYP F                                                
089658          WHERE A.PO_NBR          IN (:DK-PO-NBR)                         
089659            AND B.BOL_NBR         =  :SHIPMT-BOL-NBR                      
089660            AND B.PRO_NBR         =  :SHIPMT-PRO-NBR                      
089661            AND D.SHIPT_STATUS_CDE = :SHIPST-SHIPT-STATUS-CDE             
089662            AND A.SHIPT_ID        =  B.SHIPT_ID                           
089663            AND B.TRIP_ID         =  C.TRIP_ID                            
089664            AND A.SHIPT_ID        =  D.SHIPT_ID                           
089665            AND D.SHIPT_STATUS_CDE = F.SHIPT_STATUS_CDE                   
089666            AND ((C.LAST_UPD_UID  =  D.STATUS_UID                         
089667            AND ('TRKUP004'       =  D.STATUS_UID                         
089668             OR  'RCKUP006'       =  D.STATUS_UID))                       
089669             OR (C.AUD_STATUS_CDE =  D.SHIPT_STATUS_CDE                   
089670            AND  'TRKUP004'       <> C.LAST_UPD_UID                       
089671            AND  'RCKUP006'       <> C.LAST_UPD_UID))                     
089672       GROUP BY A.PO_NBR                                                  
089673              , C.LAST_UPD_UID                                            
089674              , C.LAST_UPD_DTE                                            
089675              , C.LAST_UPD_TME                                            
089676    UNION                                                                 
089677         SELECT                                                           
089678               A.PO_NBR                                                   
089679              ,D.LAST_UPD_UID                                             
089680              ,D.LAST_UPD_DTE  AS CRE_DATE                                
089681              ,D.LAST_UPD_TME  AS CRE_TIME                                
089682           FROM  TAUSHPO A                                                
089683                ,TAUSHIP B                                                
089684                ,TAUTRIP C                                                
089685                ,TAUVHCL D                                                
089686                ,TSHIPST E                                                
089687                ,TSHSTYP F                                                
089688          WHERE A.PO_NBR             IN (:DK-PO-NBR)                      
089689            AND B.BOL_NBR            =  :SHIPMT-BOL-NBR                   
089690            AND B.PRO_NBR            =  :SHIPMT-PRO-NBR                   
089691            AND E.SHIPT_STATUS_CDE   =  :SHIPST-SHIPT-STATUS-CDE          
089692            AND A.SHIPT_ID           =  B.SHIPT_ID                        
089693            AND B.TRIP_ID            =  C.TRIP_ID                         
089694            AND A.SHIPT_ID           =  E.SHIPT_ID                        
089695            AND E.SHIPT_STATUS_CDE   =  F.SHIPT_STATUS_CDE                
089696            AND ((D.LAST_UPD_UID     =  E.STATUS_UID                      
089697            AND  ('TRKUP004'         =  E.STATUS_UID                      
089698             OR   'RCKUP006'         =  E.STATUS_UID))                    
089699             OR  (D.CURR_STATUS_CDE  =  E.SHIPT_STATUS_CDE                
089700            AND 'TRKUP004'           <> D.LAST_UPD_UID                    
089701            AND 'RCKUP006'           <> D.LAST_UPD_UID))                  
089702            AND C.TRIP_ID            =  D.CURR_TRIP_ID                    
089703            AND C.OWNER_SCAC_ID      =  D.OWNER_SCAC_ID                   
089704            AND C.VEH_NBR            =  D.VEH_NBR                         
089705            AND D.VEH_TYP_CDE        =  'TR'                              
089706       GROUP BY A.PO_NBR                                                  
089707              , D.LAST_UPD_UID                                            
089708              , D.LAST_UPD_DTE                                            
089709              , D.LAST_UPD_TME                                            
089710       ORDER BY CRE_DATE                                                  
089711               ,CRE_TIME                                                  
089712                                                                          
089713     END-EXEC.                                                    08960817
089714 EJECT                                                            08960917
089715*----------------------------------------------------------------*08961001
089720 LINKAGE SECTION.                                                 08970001
089800                                                                  08980001
089900 01  DFHCOMMAREA.                                                 08990001
090000     05  FILLER                         OCCURS  1 TO 4072 TIMES   09000001
090100                                        DEPENDING ON EIBCALEN.    09010001
090200         10  FILLER                     PIC X.                    09020001
090300                                                                  09030001
090400 EJECT                                                            09040001
090500*----------------------------------------------------------------*09050001
090600 PROCEDURE DIVISION.                                              09060001
090700*----------------------------------------------------------------*09070001
090800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *09080001
090900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *09090001
091000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *09100001
091100*----------------------------------------------------------------*09110001
091200 0000-MAIN-MODULE.                                                09120001
091300                                                                  09130001
091400     INITIALIZE DP030-CICS-API-FIELDS.                            09140001
091500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09150001
091600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09160001
091700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09170001
091800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09180001
091900     MOVE LENGTH OF TR169AI        TO DP030-MAP-LENGTH (1).       09190008
092000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09200001
092100     PERFORM 0001-CALL-CICS-ARCH-API.                             09210001
092200*                                                                 09220001
092300     PERFORM 1000-CONTROL-PROCESSING.                             09230001
092400*                                                                 09240001
092500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09250001
092600     PERFORM 0001-CALL-CICS-ARCH-API.                             09260001
092700                                                                  09270001
092800*----------------------------------------------------------------*09280001
092900*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *09290001
093000*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *09300001
093100*----------------------------------------------------------------*09310001
093200 0001-CALL-CICS-ARCH-API.                                         09320001
093300                                                                  09330001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09340001
093500                                    DFHCOMMAREA                           
093600                                    DP030-CICS-API-FIELDS                 
093700                                    DP020-STANDARD-COMMAREA               
093800                                    TR169AI.                              
093900*                                                                 09390001
094000     IF  DP030-RC-CALL-SUCCESSFUL                                 09400001
094100         CONTINUE                                                 09410001
094200     ELSE                                                         09420001
094300         SET DP013-NO-ROLLBACK                                    09430001
094400             DP013-XCTL-DISPLAY-RESTART                           09440001
094500             DP013-CICS-ABEND      TO TRUE                        09450001
094600         MOVE '0001-CALL-CICS-ARCH-API'                           09460001
094700                                   TO DP013-PARAGRAPH             09470001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09480001
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09490001
095000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09500001
095100         PERFORM DP013-0000-PROCESS-ABEND                         09510001
095200     END-IF.                                                      09520001
095300                                                                  09530001
095400 EJECT                                                            09540001
095500*----------------------------------------------------------------*09550001
095600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09560001
095700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09570001
095800*                                                                *09580001
095900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09590001
096000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09600001
096100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09610001
096200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09620001
096300*----------------------------------------------------------------*09630001
096400 1000-CONTROL-PROCESSING.                                         09640001
096500                                                                  09650001
096600     EVALUATE TRUE                                                09660001
096700         WHEN DP020-NEXT-ACT-INITIAL                              09670001
096800             INITIALIZE ASC-SPECIFIC-COMMAREA                     09680001
096900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09690001
097000                                      ASC-SEL-TERM-ID             09700001
097100             MOVE DP020-SRC-TASK-NUMBER                           09710001
097200                                   TO ASC-LIST-TASK-NUMBER        09720001
097300                                      ASC-SEL-TASK-NUMBER         09730001
097400             MOVE PC-LIST-QUEUE-SEQ                               09740001
097500                                   TO ASC-LIST-SEQ                09750001
097600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 09760001
097700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09770001
097800*-------$TEMPLATE NOTE$------------------------------------------*09780001
097900* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *09790001
098000* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *09800001
098100* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *09810001
098200*----------------------------------------------------------------*09820001
098300             IF  PS-COMMAREA-NOT-VALID                            09830001
098400                 SET DP020-NEXT-ACT-APPL-ERROR                    09840001
098500                                   TO TRUE                        09850001
098600             ELSE                                                 09860001
098700                 PERFORM 4000-BUILD-INITIAL-PANEL                 09870001
098800             END-IF                                               09880001
098900                                                                  09890001
099000         WHEN DP020-NEXT-ACT-READ-MAP                             09900001
099100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09910001
099200                                   TO PV-TOP-ITEM                 09920001
099300             PERFORM 2000-PROCESS-PANEL                           09930001
099400                                                                  09940001
099500         WHEN DP020-NEXT-ACT-RETURN                               09950001
099600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09960001
099700                                   TO PV-TOP-ITEM                 09970001
099800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09980001
099900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 09990001
100000             MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR             10000005
100100             MOVE ASC-HI-TRIP-NO-N       TO PV-HI-TRIP-NO-N       10010005
100200             MOVE ASC-LO-TRIP-NO-N       TO PV-LO-TRIP-NO-N       10020005
100270             MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID      10027005
100280             MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR            10028005
100290             MOVE ASC-KEY-OPER-UNT-ID    TO DK-OPER-UNT-ID        10029005
100292             MOVE ASC-KEY-FCLTY-ID       TO DK-FCLTY-ID           10029205
100300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10030001
100400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10040001
100500                                                                  10050001
100600         WHEN OTHER                                               10060001
100700             SET DP013-LOGIC-ABEND TO TRUE                        10070001
100800             SET DP013-NO-ROLLBACK TO TRUE                        10080001
100900             MOVE '1000-CONTROL-PROCESSING'                       10090001
101000                                   TO DP013-PARAGRAPH             10100001
101100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10110001
101200                                   TO DP013-MESSAGE-TEXT(1)       10120001
101300             PERFORM DP013-0000-PROCESS-ABEND                     10130001
101400     END-EVALUATE.                                                10140001
101500                                                                  10150001
101600 EJECT                                                            10160001
101700*----------------------------------------------------------------*10170001
101800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *10180001
101900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *10190001
102000*----------------------------------------------------------------*10200001
102100 1100-PROCESS-INTER-APPL-COMM.                                    10210001
102200                                                                  10220001
102300     SET PS-COMMAREA-VALID         TO TRUE.                       10230001
102400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     10240001
102500     IF DP020-INT-APPL-FORMAT-IND = PC-LIST-FORMAT                10250009
102600      IF  DP020-NAV-KEY-DATA > SPACE                              10260005
102700          MOVE DP020-NAV-KEY-DATA                                 10270005
102800                              TO ASC-KEY-PO-NBR                   10280005
102900                                 DK-PO-NBR                        10290005
103000      ELSE                                                        10300005
103100         MOVE TR109-PO-NBR     TO ASC-KEY-PO-NBR                  10310005
103200                                      DK-PO-NBR                   10320001
103300      END-IF                                                      10330005
103400      MOVE TR109-TRIP-ID  TO PV-HI-TRIP-NO-N                      10340005
103500                             ASC-HI-TRIP-NO-N                     10350005
103600      MOVE TR109-TRIP-ID  TO PV-LO-TRIP-NO-N                      10360005
103700                             ASC-LO-TRIP-NO-N                     10370005
103710      MOVE TR109-OWNER-SCAC-ID TO ASC-KEY-OWNER-SCAC-ID           10371005
103711                                  DK-OWNER-SCAC-ID                10371105
103720      MOVE TR109-VEH-NBR       TO ASC-KEY-VEH-NBR                 10372005
103721                                  DK-VEH-NBR                      10372108
103730      MOVE TR109-OPER-UNT-ID   TO ASC-KEY-OPER-UNT-ID             10373005
103731                                  DK-OPER-UNT-ID                  10373105
103740      MOVE TR109-FCLTY-ID      TO ASC-KEY-FCLTY-ID                10374005
103750                                  DK-FCLTY-ID                     10375005
104600     END-IF.                                                      10460001
104700                                                                  10470001
104800 EJECT                                                            10480001
112900*----------------------------------------------------------------*11290001
113000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *11300001
113100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11310001
113200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11320001
113300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11330001
113400* FUNCTION KEYS CAN GET THIS FAR.                                *11340001
113500*----------------------------------------------------------------*11350001
113600 2000-PROCESS-PANEL.                                              11360001
113700                                                                  11370001
113800     EVALUATE TRUE                                                11380001
113900         WHEN DP020-SRC-AID = DP016-CLEAR                         11390001
114000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11400001
114100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11410001
114200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11420001
114300                                                                  11430001
118200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11820001
118300             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   11830001
118400             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             11840001
118500             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             11850001
118510             MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID      11851005
118520             MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR            11852005
118530             MOVE ASC-KEY-OPER-UNT-ID    TO DK-OPER-UNT-ID        11853005
118540             MOVE ASC-KEY-FCLTY-ID       TO DK-FCLTY-ID           11854005
118600             PERFORM 2050-DELETE-LIST-QUEUE                       11860001
118700             PERFORM 4000-BUILD-INITIAL-PANEL                     11870001
118800                                                                  11880001
118900         WHEN OTHER                                               11890001
119000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11900001
119100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11910001
119200             IF  PS-NO-ERROR                                      11920001
119300                 SET DP030-CONTINUE-GO                            11930001
119400                                 TO TRUE                          11940001
119500                 PERFORM 2100-CHECK-FUNCTION-KEY                  11950001
119600             ELSE                                                 11960001
119700                 SET DP030-OVERRIDE-GO                            11970001
119800                                 TO TRUE                          11980001
119900             END-IF                                               11990001
120000     END-EVALUATE.                                                12000001
120100                                                                  12010001
120200 EJECT                                                            12020001
120300*----------------------------------------------------------------*12030001
120400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *12040001
120500*----------------------------------------------------------------*12050001
120600 2050-DELETE-LIST-QUEUE.                                          12060001
120700                                                                  12070001
120800     EXEC CICS                                                    12080001
120900         DELETEQ TS                                               12090001
121000             QUEUE (ASC-LIST-QUEUE-NAME)                          12100001
121100             RESP  (PV-CICS-RESP)                                 12110001
121200     END-EXEC.                                                    12120001
121300                                                                  12130001
121400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       12140001
121500        (PV-CICS-RESP = DFHRESP(QIDERR))                          12150001
121600         CONTINUE                                                 12160001
121700     ELSE                                                         12170001
121800         SET DP013-CICS-ABEND      TO TRUE                        12180001
121900         SET DP013-NO-ROLLBACK     TO TRUE                        12190001
122000                                                                  12200001
122100         MOVE '2050-DELETE-LIST-QUEUE'                            12210001
122200                                   TO DP013-PARAGRAPH             12220001
122300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    12230001
122400                                   TO DP013-MESSAGE-TEXT (1)      12240001
122500         PERFORM DP013-0000-PROCESS-ABEND                         12250001
122600     END-IF.                                                      12260001
122700                                                                  12270001
122800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  12280001
122900                                                                  12290001
123000 EJECT                                                            12300001
123100*----------------------------------------------------------------*12310001
123200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*12320001
123300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *12330001
123400* CICS ARCHITECTURE API.                                         *12340001
123500*----------------------------------------------------------------*12350001
123600 2100-CHECK-FUNCTION-KEY.                                         12360001
123700                                                                  12370001
123800     EVALUATE TRUE                                                12380001
123900                                                                  12390001
125900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12590001
126000             MOVE +1               TO PV-TOP-ITEM                 12600001
126100             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   12610001
126200             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             12620001
126300             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             12630001
126310             MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID      12631005
126320             MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR            12632005
126330             MOVE ASC-KEY-OPER-UNT-ID    TO DK-OPER-UNT-ID        12633005
126340             MOVE ASC-KEY-FCLTY-ID       TO DK-FCLTY-ID           12634005
126400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12640001
126500             PERFORM 3200-RESET-ATTRIBUTES                        12650001
126600                                                                  12660001
126700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   12670001
126800             PERFORM 2110-BROWSE-BACKWARD                         12680001
126900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   12690001
127000             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             12700001
127100             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             12710001
127110             MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID      12711005
127120             MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR            12712005
127130             MOVE ASC-KEY-OPER-UNT-ID    TO DK-OPER-UNT-ID        12713005
127140             MOVE ASC-KEY-FCLTY-ID       TO DK-FCLTY-ID           12714005
127200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12720001
127300             PERFORM 3200-RESET-ATTRIBUTES                        12730001
127400                                                                  12740001
127500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12750001
127600             PERFORM 2120-BROWSE-FORWARD                          12760001
127700             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   12770001
127800             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             12780001
127900             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             12790001
127910             MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID      12791005
127920             MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR            12792005
127930             MOVE ASC-KEY-OPER-UNT-ID    TO DK-OPER-UNT-ID        12793005
127940             MOVE ASC-KEY-FCLTY-ID       TO DK-FCLTY-ID           12794005
128000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12800001
128100                                                                  12810001
128200         WHEN DP020-SRC-AID = DP016-ENTER                         12820001
128300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   12830001
128400             IF  PS-ERROR                                         12840001
128500                 CONTINUE                                         12850001
128600             ELSE                                                 12860001
128700                 MOVE ASC-KEY-PO-NBR                              12870001
128800                                   TO DK-PO-NBR                   12880001
128900                 MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N         12890001
129000                 MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N         12900001
129010                 MOVE ASC-KEY-OWNER-SCAC-ID                       12901005
129011                                    TO DK-OWNER-SCAC-ID           12901105
129020                 MOVE ASC-KEY-VEH-NBR                             12902005
129021                                    TO DK-VEH-NBR                 12902105
129030                 MOVE ASC-KEY-OPER-UNT-ID                         12903005
129031                                    TO DK-OPER-UNT-ID             12903105
129040                 MOVE ASC-KEY-FCLTY-ID                            12904005
129050                                    TO DK-FCLTY-ID                12905005
129100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12910001
129200                 PERFORM 3200-RESET-ATTRIBUTES                    12920001
129300             END-IF                                               12930001
129400                                                                  12940001
129500         WHEN OTHER                                               12950001
129600             SET DP013-NO-ROLLBACK                                12960001
129700                 DP013-XCTL-DISPLAY-RESTART                       12970001
129800                 DP013-CICS-ABEND  TO TRUE                        12980001
129900             MOVE '2100-CHECK-FUNCTION-KEY'                       12990001
130000                                   TO DP013-PARAGRAPH             13000001
130100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      13010001
130200                                   TO DP013-MESSAGE-TEXT (1)      13020001
130300             PERFORM DP013-0000-PROCESS-ABEND                     13030001
130400     END-EVALUATE.                                                13040001
130500                                                                  13050001
130600 EJECT                                                            13060001
130700*----------------------------------------------------------------*13070001
130800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *13080001
130900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *13090001
131000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13100001
131100*    MESSAGE.                                                    *13110001
131200*----------------------------------------------------------------*13120001
131300 2110-BROWSE-BACKWARD.                                            13130001
131400                                                                  13140001
131500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13150001
131600         GIVING PV-TOP-ITEM.                                      13160001
131700*                                                                 13170001
131800     IF  ((PV-TOP-ITEM < +1)                                      13180001
131900       OR (PV-TOP-ITEM = +1))                                     13190001
132000         MOVE +1                   TO PV-TOP-ITEM                 13200001
132100*------- TOP OF LIST -----                                        13210001
132200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13220001
132300         SET DP020-MSG-INFORMATIONAL TO TRUE                      13230001
132400     END-IF.                                                      13240001
132500                                                                  13250001
132600 EJECT                                                            13260001
132700*----------------------------------------------------------------*13270001
132800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *13280001
132900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *13290001
133000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *13300001
133100*----------------------------------------------------------------*13310001
133200 2120-BROWSE-FORWARD.                                             13320001
133300                                                                  13330001
133400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              13340001
133500         GIVING PV-TOP-ITEM.                                      13350001
133600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   13360001
133700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13370001
133800                                   TO PV-TOP-ITEM                 13380001
133900*------- BOTTOM OF LIST -----------                               13390001
134000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13400001
134100         SET DP020-MSG-INFORMATIONAL                              13410001
134200                                   TO TRUE                        13420001
134300     ELSE                                                         13430001
134400         COMPUTE PV-BOTTOM-ITEM =                                 13440001
134500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 13450001
134600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            13460001
134700*----------- BOTTOM OF LIST ---------                             13470001
134800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13480001
134900             SET DP020-MSG-INFORMATIONAL                          13490001
135000                                   TO TRUE                        13500001
135100         END-IF                                                   13510001
135200     END-IF.                                                      13520001
135300                                                                  13530001
135400 EJECT                                                            13540001
135500*----------------------------------------------------------------*13550001
135600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *13560001
135700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *13570001
135800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *13580001
135900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *13590001
136000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *13600001
136100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *13610001
136200*----------------------------------------------------------------*13620001
136300 2130-CHECK-FOR-JUMP-BROWSE.                                      13630001
136400                                                                  13640001
136500     SET PS-NO-ERROR               TO TRUE.                       13650001
136600     IF  (ASC-START-ITEM-REQUEST = SPACE)                         13660001
136700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13670001
136800                                   TO PV-TOP-ITEM                 13680001
136900     ELSE                                                         13690001
137000         MOVE ASC-START-ITEM-REQUEST                              13700001
137100                                   TO DP010I-UNEDITED-FIELD       13710001
137200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       13720001
137300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     13730001
137400         SET DP010I-NEGATIVE-NOT-ALLOWED                          13740001
137500                                   TO TRUE                        13750001
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
137700                                                                  13770001
137800         IF  NOT DP010I-ERROR-DETECTED                            13780001
137900             MOVE DP010I-NUMERIC-FIELD                            13790001
138000                                   TO  ASC-START-ITEM-REQUEST-N   13800001
138100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  13810001
138200                 IF  ASC-START-ITEM-REQUEST-N >                   13820001
138300                                          ASC-NUMBER-OF-ITEMS-READ13830001
138400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         13840001
138500                     COMPUTE PV-TOP-ITEM =                        13850001
138600                             ASC-NUMBER-OF-ITEMS-READ             13860001
138700                             - PC-ITEMS-PER-PANEL + 1             13870001
138800                     IF  PV-TOP-ITEM < +1                         13880001
138900                         MOVE +1   TO PV-TOP-ITEM                 13890001
139000                         MOVE PC-TSYMSG-00070                     13900001
139100                                   TO DP020-MSG-NUMBER            13910001
139200                         SET DP020-MSG-INFORMATIONAL              13920001
139300                                   TO TRUE                        13930001
139400                     END-IF                                       13940001
139500                 ELSE                                             13950001
139600                     MOVE ASC-START-ITEM-REQUEST-N                13960001
139700                                   TO PV-TOP-ITEM                 13970001
139800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      13980001
139900                     COMPUTE PV-BOTTOM-ITEM =                     13990001
140000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     14000001
140100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ14010001
140200*----------------------- BOTTOM OF LIST --------------            14020001
140300                         MOVE PC-TSYMSG-00070                     14030001
140400                                   TO DP020-MSG-NUMBER            14040001
140500                         SET DP020-MSG-INFORMATIONAL              14050001
140600                                   TO TRUE                        14060001
140700                     END-IF                                       14070001
140800                 END-IF                                           14080001
140900             ELSE                                                 14090001
141000*--------------- VALUE OUT OF RANGE ------------------            14100001
141100                 MOVE PC-TSYMSG-00101                             14110001
141200                                   TO DP020-MSG-NUMBER            14120001
141300                 MOVE -1           TO ASTRTITL                    14130001
141400                 SET DP030-SET-CURSOR-APPL-1                      14140001
141500                                   TO TRUE                        14150001
141600                 MOVE DP015-REVERSE                               14160001
141700                                   TO ASTRTITH                    14170001
141800                 MOVE DP015-RED    TO ASTRTITC                    14180001
141900                 MOVE DP015-UNP-NUM-BRT-MDT                       14190001
142000                                   TO ASTRTITA                    14200001
142100                 SET DP020-MSG-FATAL                              14210001
142200                                   TO TRUE                        14220001
142300                 SET PS-ERROR      TO TRUE                        14230001
142400             END-IF                                               14240001
142500                                                                  14250001
142600         ELSE                                                     14260001
142700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14270001
142800             MOVE -1               TO ASTRTITL                    14280001
142900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14290001
143000             MOVE DP015-REVERSE    TO ASTRTITH                    14300001
143100             MOVE DP015-RED        TO ASTRTITC                    14310001
143200             MOVE DP015-UNP-NUM-BRT-MDT                           14320001
143300                                   TO ASTRTITA                    14330001
143400             SET DP020-MSG-FATAL   TO TRUE                        14340001
143500             SET PS-ERROR          TO TRUE                        14350001
143600         END-IF                                                   14360001
143700     END-IF.                                                      14370001
143800                                                                  14380001
143900 EJECT                                                            14390001
144000*----------------------------------------------------------------*14400001
144100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14410001
144200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14420001
144300*----------------------------------------------------------------*14430001
144400 2140-DESELECT-ALL-ITEMS.                                         14440001
144500                                                                  14450001
144600     MOVE +1                       TO ASC-BLK-SUB.                14460001
144700                                                                  14470001
144800     PERFORM 2141-CLEAR-SELECTED-INDS                             14480001
144900         VARYING ASC-ITEM-SUB                                     14490001
145000         FROM 1 BY 1                                              14500001
145100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14510001
145200                                                                  14520001
145300     ADD +1                        TO ASC-BLK-SUB.                14530001
145400                                                                  14540001
145500     PERFORM 2141-CLEAR-SELECTED-INDS                             14550001
145600         VARYING ASC-ITEM-SUB                                     14560001
145700         FROM 1 BY 1                                              14570001
145800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14580001
145900                                                                  14590001
146000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14600001
146100                                   TO PV-LIST-ITEM-NUMBER.        14610001
146200                                                                  14620001
146300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14630001
146400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14640001
146500                                                                  14650001
146600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14660001
146700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      14670001
146800         MOVE +1                   TO ASC-BLK-SUB                 14680001
146900                                                                  14690001
147000         PERFORM 5100-WRITE-TEMP-STORAGE                          14700001
147100                                                                  14710001
147200         MOVE +1                   TO PV-BLOCK-NUMBER             14720001
147300                                                                  14730001
147400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14740001
147500             PV-FIRST-BLOCK-IN-ARRAY - 1                          14750001
147600                                                                  14760001
147700         PERFORM                                                  14770001
147800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14780001
147900                                                                  14790001
148000             PERFORM 4410-READ-TEMP-STORAGE                       14800001
148100                                                                  14810001
148200             PERFORM 2141-CLEAR-SELECTED-INDS                     14820001
148300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 14830001
148400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14840001
148500                                                                  14850001
148600             PERFORM 5100-WRITE-TEMP-STORAGE                      14860001
148700                                                                  14870001
148800             ADD +1                TO PV-BLOCK-NUMBER             14880001
148900                                                                  14890001
149000         END-PERFORM                                              14900001
149100                                                                  14910001
149200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14920001
149300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14930001
149400                                                                  14940001
149500         PERFORM                                                  14950001
149600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14960001
149700                   ASC-HIGHEST-BLOCK-WRITTEN                      14970001
149800                                                                  14980001
149900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14990001
150000                                   TO PV-BLOCK-NUMBER             15000001
150100                                                                  15010001
150200             PERFORM 4410-READ-TEMP-STORAGE                       15020001
150300                                                                  15030001
150400             PERFORM 2141-CLEAR-SELECTED-INDS                     15040001
150500                 VARYING ASC-ITEM-SUB                             15050001
150600                 FROM 1 BY 1                                      15060001
150700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15070001
150800                                                                  15080001
150900             PERFORM 5100-WRITE-TEMP-STORAGE                      15090001
151000                                                                  15100001
151100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15110001
151200                                                                  15120001
151300         END-PERFORM                                              15130001
151400                                                                  15140001
151500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15150001
151600                                   TO PV-BLOCK-NUMBER             15160001
151700                                                                  15170001
151800         PERFORM 4410-READ-TEMP-STORAGE                           15180001
151900     END-IF.                                                      15190001
152000                                                                  15200001
152100     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS15210001
152200                                      ASC-START-OF-SELECTED-RANGE 15220001
152300                                      ASC-END-OF-SELECTED-RANGE.  15230001
152400                                                                  15240001
152500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15250001
152600                                                                  15260001
152700 EJECT                                                            15270001
152800*----------------------------------------------------------------*15280001
152900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15290001
153000*----------------------------------------------------------------*15300001
153100 2141-CLEAR-SELECTED-INDS.                                        15310001
153200                                                                  15320001
153300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15330001
153400             NOT EQUAL ZERO                                       15340001
153500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15350001
153600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15360001
153700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15370001
153800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15380001
153900                                   TO TRUE                        15390001
154000         END-IF                                                   15400001
154100     END-IF.                                                      15410001
154200                                                                  15420001
154300 EJECT                                                            15430001
154400*----------------------------------------------------------------*15440001
154500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15450001
154600*  FOR ALL ITEMS.                                                *15460001
154700*----------------------------------------------------------------*15470001
154800 2150-SELECT-ALL-ITEMS.                                           15480001
154900                                                                  15490001
155000     MOVE +1                       TO ASC-BLK-SUB.                15500001
155100                                                                  15510001
155200     PERFORM 2151-SET-SELECTED-INDS                               15520001
155300         VARYING ASC-ITEM-SUB                                     15530001
155400         FROM 1 BY 1                                              15540001
155500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15550001
155600                                                                  15560001
155700     ADD +1                        TO ASC-BLK-SUB.                15570001
155800                                                                  15580001
155900     PERFORM 2151-SET-SELECTED-INDS                               15590001
156000         VARYING ASC-ITEM-SUB                                     15600001
156100         FROM 1 BY 1                                              15610001
156200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15620001
156300                                                                  15630001
156400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15640001
156500                                   TO PV-LIST-ITEM-NUMBER.        15650001
156600                                                                  15660001
156700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15670001
156800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15680001
156900                                                                  15690001
157000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15700001
157100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15710001
157200         MOVE +1                   TO ASC-BLK-SUB                 15720001
157300                                                                  15730001
157400         PERFORM 5100-WRITE-TEMP-STORAGE                          15740001
157500                                                                  15750001
157600         MOVE +1                   TO PV-BLOCK-NUMBER             15760001
157700                                                                  15770001
157800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15780001
157900             PV-FIRST-BLOCK-IN-ARRAY - 1                          15790001
158000                                                                  15800001
158100         PERFORM                                                  15810001
158200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15820001
158300                                                                  15830001
158400             PERFORM 4410-READ-TEMP-STORAGE                       15840001
158500                                                                  15850001
158600             PERFORM 2151-SET-SELECTED-INDS                       15860001
158700                 VARYING ASC-ITEM-SUB                             15870001
158800                 FROM 1 BY 1                                      15880001
158900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15890001
159000                                                                  15900001
159100             PERFORM 5100-WRITE-TEMP-STORAGE                      15910001
159200                                                                  15920001
159300             ADD +1                TO PV-BLOCK-NUMBER             15930001
159400                                                                  15940001
159500         END-PERFORM                                              15950001
159600                                                                  15960001
159700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15970001
159800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15980001
159900                                                                  15990001
160000         PERFORM                                                  16000001
160100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16010001
160200                   ASC-HIGHEST-BLOCK-WRITTEN                      16020001
160300                                                                  16030001
160400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16040001
160500                                   TO PV-BLOCK-NUMBER             16050001
160600                                                                  16060001
160700             PERFORM 4410-READ-TEMP-STORAGE                       16070001
160800                                                                  16080001
160900             PERFORM 2151-SET-SELECTED-INDS                       16090001
161000                 VARYING ASC-ITEM-SUB                             16100001
161100                 FROM 1 BY 1                                      16110001
161200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16120001
161300                                                                  16130001
161400             PERFORM 5100-WRITE-TEMP-STORAGE                      16140001
161500                                                                  16150001
161600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16160001
161700                                                                  16170001
161800         END-PERFORM                                              16180001
161900                                                                  16190001
162000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16200001
162100                                   TO PV-BLOCK-NUMBER             16210001
162200                                                                  16220001
162300         PERFORM 4410-READ-TEMP-STORAGE                           16230001
162400     END-IF.                                                      16240001
162500                                                                  16250001
162600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16260001
162700                       ASC-NUMBER-OF-SELECTED-ITEMS.              16270001
162800                                                                  16280001
162900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16290001
163000                                                                  16300001
163100 EJECT                                                            16310001
163200*----------------------------------------------------------------*16320001
163300*    MARK EACH ITEM AS BEING SELECTED.                           *16330001
163400*----------------------------------------------------------------*16340001
163500 2151-SET-SELECTED-INDS.                                          16350001
163600                                                                  16360001
163700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16370001
163800             NOT EQUAL ZERO                                       16380001
163900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16390001
164000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16400001
164100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16410001
164200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16420001
164300                               TO  TRUE                           16430001
164400         END-IF                                                   16440001
164500     END-IF.                                                      16450001
164600                                                                  16460001
164700 EJECT                                                            16470001
164800*----------------------------------------------------------------*16480001
164900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *16490001
165000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *16500001
165100*----------------------------------------------------------------*16510001
165200 2200-MOVE-SCREEN-TO-COMMAREA.                                    16520001
165300                                                                  16530001
165400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16540001
165500     MOVE +1                       TO PV-SUB.                     16550001
165600*                                                                 16560001
165700     PERFORM 3100-SET-SUBSCRIPTS.                                 16570001
165800     IF  ASTRTITL > ZERO                                          16580001
165900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          16590001
166000     ELSE                                                         16600001
166100         IF  ASTRTITF = DP015-ERASE-EOF                           16610001
166200             INITIALIZE ASC-START-ITEM-REQUEST                    16620001
166300         END-IF                                                   16630001
166400     END-IF.                                                      16640001
166500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          16650001
166600         VARYING PV-SUB                                           16660001
166700         FROM 1 BY 1                                              16670001
166800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      16680001
166900                                                                  16690001
167000 EJECT                                                            16700001
167100*----------------------------------------------------------------*16710001
167200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *16720001
167300*----------------------------------------------------------------*16730001
167400 2210-MOVE-LINES-TO-COMMAREA.                                     16740001
167500                                                                  16750001
167600     IF  MR-SELECTL (PV-SUB) > ZERO                               16760001
167700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             16770001
167800         MOVE MR-SELECTI (PV-SUB)                                 16780001
167900                                   TO ASC-TEMP-SELECTED-SW        16790001
168000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16800001
168100     ELSE                                                         16810001
168200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                16820001
168300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     16830001
168400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        16840001
168500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16850001
168600         END-IF                                                   16860001
168700     END-IF.                                                      16870001
168800     ADD +1                        TO ASC-ITEM-SUB.               16880001
168900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16890001
169000         ADD  +1                   TO ASC-BLK-SUB                 16900001
169100         MOVE +1                   TO ASC-ITEM-SUB                16910001
169200     END-IF.                                                      16920001
169300                                                                  16930001
169400 EJECT                                                            16940001
169500*----------------------------------------------------------------*16950001
169600*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *16960001
169700*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *16970001
169800*----------------------------------------------------------------*16980001
169900 3000-EDIT-DATA-IN-COMMAREA.                                      16990001
170000                                                                  17000001
170100     SET PS-NO-ERROR               TO TRUE.                       17010001
170200     PERFORM 3200-RESET-ATTRIBUTES.                               17020001
170300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     17030001
170400*----------------------------------------------------------------*17040001
170500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *17050001
170600* EDITTING IS DONE FROM THE BOTTOM UP.                           *17060001
170700*----------------------------------------------------------------*17070001
170800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17080001
170900         ASC-ITEMS-DISPLAYED - 1.                                 17090001
171000     PERFORM 3100-SET-SUBSCRIPTS.                                 17100001
171100     PERFORM 3300-EDIT-SELECTIONS                                 17110001
171200         VARYING PV-SUB                                           17120001
171300         FROM PV-SUB BY -1                                        17130001
171400         UNTIL PV-SUB < +1.                                       17140001
171500*                                                                 17150001
171600     IF  PS-NO-ERROR                                              17160001
171700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        17170001
171800     END-IF.                                                      17180001
171900*                                                                 17190001
172000     IF  ((PS-NO-ERROR)                                           17200001
172100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17210001
172200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17220001
172300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  17230001
172400     END-IF.                                                      17240001
172500                                                                  17250001
172600 EJECT                                                            17260001
172700*----------------------------------------------------------------*17270001
172800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17280001
172900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *17290001
173000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17300001
173100*                                                                *17310001
173200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17320001
173300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17330001
173400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17340001
173500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17350001
173600*----------------------------------------------------------------*17360001
173700 3100-SET-SUBSCRIPTS.                                             17370001
173800                                                                  17380001
173900     COMPUTE ASC-ITEM-SUB =                                       17390001
174000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17400001
174100                                                                  17410001
174200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17420001
174300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17430001
174400                                                                  17440001
174500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               17450001
174600     ELSE                                                         17460001
174700         MOVE +1                     TO ASC-BLK-SUB               17470001
174800     END-IF.                                                      17480001
174900                                                                  17490001
175000 EJECT                                                            17500001
175100*----------------------------------------------------------------*17510001
175200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *17520001
175300*----------------------------------------------------------------*17530001
175400 3200-RESET-ATTRIBUTES.                                           17540001
175500                                                                  17550001
175600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   17560001
175700     MOVE DP015-GREEN              TO ASTRTITC.                   17570001
175800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   17580001
175900                                                                  17590001
176000     PERFORM                                                      17600001
176100         VARYING PV-SUB                                           17610001
176200         FROM 1 BY 1                                              17620001
176300         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   17630001
176400                         ASC-ITEMS-DISPLAYED)                     17640001
176500         MOVE DP015-UNP-ALP-NOR-OFF                               17650001
176600                                   TO MR-SELECTA (PV-SUB)         17660001
176700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         17670001
176800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         17680001
176900     END-PERFORM.                                                 17690001
177000                                                                  17700001
177100 EJECT                                                            17710001
177200*----------------------------------------------------------------*17720001
177300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *17730001
177400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *17740001
177500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *17750001
177600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *17760001
177700*----------------------------------------------------------------*17770001
177800 3300-EDIT-SELECTIONS.                                            17780001
177900                                                                  17790001
178000     EVALUATE TRUE                                                17800001
178100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17810001
178200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17820001
178300                 CONTINUE                                         17830001
178400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17840001
178500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17850001
178600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   17860001
178700                 MOVE ASC-TEMP-SELECTED-SW                        17870001
178800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17880001
178900                                TO ASC-SELECTED-SW                17890001
179000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17900001
179100             END-IF                                               17910001
179200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17920001
179300                                = SPACE                           17930001
179400             EVALUATE TRUE                                        17940001
179500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17950001
179600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS17960001
179700                     MOVE SPACE TO ASC-SELECTED-SW                17970001
179800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17980001
179900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        17990001
180000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18000001
180100                     MOVE SPACE TO ASC-SELECTED-SW                18010001
180200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18020001
180300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18030001
180400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18040001
180500                     MOVE SPACE TO ASC-SELECTED-SW                18050001
180600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18060001
180700             END-EVALUATE                                         18070001
180800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18080001
180900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18090001
181000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18100001
181100             END-IF                                               18110001
181200             PERFORM 3310-EDIT-RANGE                              18120001
181300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18130001
181400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18140001
181500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18150001
181600             END-IF                                               18160001
181700             PERFORM 3310-EDIT-RANGE                              18170001
181800         WHEN OTHER                                               18180001
181900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18190001
182000             SET DP020-MSG-FATAL    TO TRUE                       18200001
182100             MOVE -1                TO MR-SELECTL (PV-SUB)        18210001
182200             SET DP030-SET-CURSOR-APPL-1                          18220001
182300                                    TO TRUE                       18230001
182400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        18240001
182500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        18250001
182600             SET PS-ERROR TO TRUE                                 18260001
182700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18270001
182800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18280001
182900                 MOVE SPACE         TO ASC-SELECTED-SW            18290001
183000                                        (ASC-BLK-SUB ASC-ITEM-SUB)18300001
183100             END-IF                                               18310001
183200     END-EVALUATE.                                                18320001
183300                                                                  18330001
183400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 18340001
183500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18350001
183600     IF  ASC-ITEM-SUB < 1                                         18360001
183700         SUBTRACT +1 FROM ASC-BLK-SUB                             18370001
183800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18380001
183900     END-IF.                                                      18390001
184000                                                                  18400001
184100 EJECT                                                            18410001
184200*----------------------------------------------------------------*18420001
184300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *18430001
184400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *18440001
184500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *18450001
184600*  THE ENDING.                                                   *18460001
184700*----------------------------------------------------------------*18470001
184800 3310-EDIT-RANGE.                                                 18480001
184900                                                                  18490001
185000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                18500001
185100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   18510001
185200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)18520001
185300                                   TO ASC-SELECTED-SW             18530001
185400                                        (ASC-BLK-SUB ASC-ITEM-SUB)18540001
185500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18550001
185600         ELSE                                                     18560001
185700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18570001
185800                 CONTINUE                                         18580001
185900             ELSE                                                 18590001
186000*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          18600001
186100                 MOVE PC-TSYMSG-00054                             18610001
186200                                   TO DP020-MSG-NUMBER            18620001
186300                 SET DP020-MSG-FATAL                              18630001
186400                                   TO TRUE                        18640001
186500                 MOVE -1           TO MR-SELECTL (PV-SUB)         18650001
186600                 SET DP030-SET-CURSOR-APPL-1                      18660001
186700                                   TO TRUE                        18670001
186800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         18680001
186900                 MOVE DP015-UNDERLINE                             18690001
187000                                   TO MR-SELECTH (PV-SUB)         18700001
187100                 SET PS-ERROR      TO TRUE                        18710001
187200             END-IF                                               18720001
187300         END-IF                                                   18730001
187400     ELSE                                                         18740001
187500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18750001
187600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18760001
187700                                   TO ASC-SELECTED-SW             18770001
187800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18780001
187900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18790001
188000         ELSE                                                     18800001
188100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18810001
188200                 CONTINUE                                         18820001
188300             ELSE                                                 18830001
188400*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            18840001
188500                 MOVE PC-TSYMSG-00055                             18850001
188600                                   TO DP020-MSG-NUMBER            18860001
188700                 SET DP020-MSG-FATAL                              18870001
188800                                   TO TRUE                        18880001
188900                 MOVE -1           TO MR-SELECTL (PV-SUB)         18890001
189000                 SET DP030-SET-CURSOR-APPL-1                      18900001
189100                                   TO TRUE                        18910001
189200                 SET PS-ERROR      TO TRUE                        18920001
189300             END-IF                                               18930001
189400         END-IF                                                   18940001
189500     END-IF.                                                      18950001
189600                                                                  18960001
189700 EJECT                                                            18970001
189800*----------------------------------------------------------------*18980001
189900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *18990001
190000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *19000001
190100*----------------------------------------------------------------*19010001
190200 3400-CHECK-RANGE-SEQUENCE.                                       19020001
190300                                                                  19030001
190400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19040001
190500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19050001
190600       AND  ASC-START-OF-SELECTED-RANGE >                         19060001
190700                                         ASC-END-OF-SELECTED-RANGE19070001
190800*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                19080001
190900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 19090001
191000         SET DP020-MSG-FATAL TO TRUE                              19100001
191100         SET PS-ERROR TO TRUE                                     19110001
191200         PERFORM 3410-POSITION-AT-ERROR                           19120001
191300     END-IF.                                                      19130001
191400                                                                  19140001
191500 EJECT                                                            19150001
191600*----------------------------------------------------------------*19160001
191700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *19170001
191800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *19180001
191900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *19190001
192000*----------------------------------------------------------------*19200001
192100 3410-POSITION-AT-ERROR.                                          19210001
192200                                                                  19220001
192300     SET DP030-SET-CURSOR-APPL-1                                  19230001
192400                                   TO TRUE.                       19240001
192500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19250001
192600                    - PV-TOP-ITEM + 1.                            19260001
192700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19270001
192800         CONTINUE                                                 19280001
192900     ELSE                                                         19290001
193000         MOVE -1                   TO MR-SELECTL (PV-SUB)         19300001
193100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19310001
193200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19320001
193300     END-IF.                                                      19330001
193400*                                                                 19340001
193500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19350001
193600                    - PV-TOP-ITEM + 1.                            19360001
193700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19370001
193800         CONTINUE                                                 19380001
193900     ELSE                                                         19390001
194000         MOVE -1                   TO MR-SELECTL (PV-SUB)         19400001
194100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19410001
194200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19420001
194300     END-IF.                                                      19430001
194400                                                                  19440001
194500 EJECT                                                            19450001
194600*----------------------------------------------------------------*19460001
194700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *19470001
194800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *19480001
194900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *19490001
195000*----------------------------------------------------------------*19500001
195100 3500-MARK-RANGE-AS-SELECTED.                                     19510001
195200                                                                  19520001
195300     MOVE +1                       TO  ASC-BLK-SUB.               19530001
195400     PERFORM 3510-MARK-SELECTED-INDS                              19540001
195500         VARYING ASC-ITEM-SUB                                     19550001
195600         FROM 1 BY 1                                              19560001
195700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19570001
195800                                                                  19580001
195900     ADD +1                        TO ASC-BLK-SUB.                19590001
196000     PERFORM 3510-MARK-SELECTED-INDS                              19600001
196100         VARYING ASC-ITEM-SUB                                     19610001
196200         FROM 1 BY 1                                              19620001
196300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19630001
196400                                                                  19640001
196500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19650001
196600                                   TO  PV-LIST-ITEM-NUMBER.       19660001
196700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19670001
196800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19680001
196900               PC-ITEMS-PER-PANEL).                               19690001
197000                                                                  19700001
197100     MOVE ASC-START-OF-SELECTED-RANGE                             19710001
197200                                   TO PV-START-OF-SELECTED-RANGE. 19720001
197300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19730001
197400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19740001
197500               PC-ITEMS-PER-PANEL).                               19750001
197600                                                                  19760001
197700     MOVE ASC-END-OF-SELECTED-RANGE                               19770001
197800                                   TO  PV-END-OF-SELECTED-RANGE.  19780001
197900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19790001
198000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19800001
198100               PC-ITEMS-PER-PANEL).                               19810001
198200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19820001
198300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19830001
198400                                                                  19840001
198500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19850001
198600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19860001
198700         MOVE +1                   TO ASC-BLK-SUB                 19870001
198800         PERFORM 5100-WRITE-TEMP-STORAGE                          19880001
198900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19890001
199000             PV-FIRST-BLOCK-IN-ARRAY - 1                          19900001
199100                                                                  19910001
199200         PERFORM                                                  19920001
199300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19930001
199400                   PV-PREV-BLOCK-IN-ARRAY                         19940001
199500             MOVE PV-FIRST-BLOCK-IN-RANGE                         19950001
199600                                   TO PV-BLOCK-NUMBER             19960001
199700             PERFORM 4410-READ-TEMP-STORAGE                       19970001
199800             PERFORM 3510-MARK-SELECTED-INDS                      19980001
199900                 VARYING ASC-ITEM-SUB                             19990001
200000                 FROM 1 BY 1                                      20000001
200100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20010001
200200             PERFORM 5100-WRITE-TEMP-STORAGE                      20020001
200300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     20030001
200400         END-PERFORM                                              20040001
200500                                                                  20050001
200600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20060001
200700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20070001
200800         PERFORM                                                  20080001
200900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20090001
201000                   PV-LAST-BLOCK-IN-RANGE                         20100001
201100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20110001
201200                                   TO PV-BLOCK-NUMBER             20120001
201300             PERFORM 4410-READ-TEMP-STORAGE                       20130001
201400             PERFORM 3510-MARK-SELECTED-INDS                      20140001
201500                 VARYING ASC-ITEM-SUB                             20150001
201600                 FROM 1 BY 1                                      20160001
201700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20170001
201800             PERFORM 5100-WRITE-TEMP-STORAGE                      20180001
201900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20190001
202000         END-PERFORM                                              20200001
202100                                                                  20210001
202200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20220001
202300                                   TO PV-BLOCK-NUMBER             20230001
202400         PERFORM 4410-READ-TEMP-STORAGE                           20240001
202500     END-IF.                                                      20250001
202600                                                                  20260001
202700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 20270001
202800                                      ASC-END-OF-SELECTED-RANGE.  20280001
202900                                                                  20290001
203000 EJECT                                                            20300001
203100*----------------------------------------------------------------*20310001
203200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *20320001
203300*----------------------------------------------------------------*20330001
203400 3510-MARK-SELECTED-INDS.                                         20340001
203500                                                                  20350001
203600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20360001
203700                                ASC-ITEM-SUB) >                   20370001
203800         ASC-START-OF-SELECTED-RANGE)                             20380001
203900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20390001
204000                                ASC-ITEM-SUB) =                   20400001
204100         ASC-START-OF-SELECTED-RANGE)                             20410001
204200                                                                  20420001
204300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20430001
204400                                    ASC-ITEM-SUB) <               20440001
204500             ASC-END-OF-SELECTED-RANGE)                           20450001
204600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20460001
204700                                    ASC-ITEM-SUB) =               20470001
204800             ASC-END-OF-SELECTED-RANGE)                           20480001
204900                                                                  20490001
205000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20500001
205100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20510001
205200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20520001
205300                               TO TRUE                            20530001
205400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20540001
205500                               TO TRUE                            20550001
205600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    20560001
205700             END-IF                                               20570001
205800         END-IF                                                   20580001
205900     END-IF.                                                      20590001
206000                                                                  20600001
206100 EJECT                                                            20610001
206200*----------------------------------------------------------------*20620001
206300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20630001
206400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20640001
206500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20650001
206600*    DISPLAY THE PANEL TO USER.                                  *20660001
206700*----------------------------------------------------------------*20670001
206800 4000-BUILD-INITIAL-PANEL.                                        20680001
206900                                                                  20690001
207000     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             20700001
207100                                ASC-BLOCK-ENTRIES (2).            20710001
207200     MOVE +1                 TO ASC-BLK-SUB.                      20720001
207300     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        20730001
207400     SET ASC-ITEMS-LEFT-ON-DB                                     20740001
207500                             TO TRUE.                             20750001
207600                                                                  20760001
207700     MOVE +0                 TO ASC-ITEM-SUB                      20770001
207800                                ASC-NUMBER-OF-ITEMS-READ          20780001
207900                                ASC-NUMBER-OF-SELECTED-ITEMS      20790001
208000                                ASC-HIGHEST-BLOCK-WRITTEN         20800001
208100                                ASC-START-OF-SELECTED-RANGE       20810001
208200                                ASC-END-OF-SELECTED-RANGE         20820001
208300                                ASC-ITEM-AT-TOP-OF-PANEL.         20830001
208400     PERFORM 4010-OPEN-CURSOR.                                    20840001
208500                                                                  20850001
208600     PERFORM 4300-READ-ITEMS-FROM-DB.                             20860001
208700                                                                  20870001
208800     PERFORM 4020-CLOSE-CURSOR.                                   20880001
208900                                                                  20890001
209000     MOVE +1                   TO  PV-TOP-ITEM.                   20900001
209100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20910001
209200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    20920001
209300         SET DP020-MSG-FATAL   TO  TRUE                           20930001
209400*------- PURCHASE ORDER DOES NOT EXIST -----                      20940001
209500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20950001
209600     ELSE                                                         20960001
209700*        MOVE -1               TO MR-SELECTL (1)                  20970001
209800*        SET DP030-SET-CURSOR-APPL-1                              20980001
209900*                              TO TRUE                            20990001
210000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     21000001
210100     END-IF.                                                      21010001
210200                                                                  21020001
210300 EJECT                                                            21030001
210400*----------------------------------------------------------------*21040001
210500*   OPEN THE STAT    CURSOR                                      *21050005
210600*----------------------------------------------------------------*21060001
210700 4010-OPEN-CURSOR.                                                21070001
210800                                                                  21080001
210900     PERFORM                                                      21090001
211000         WITH TEST AFTER                                          21100001
211100         VARYING PV-RETRY-COUNTER                                 21110001
211200         FROM 1 BY 1                                              21120001
211300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21130001
211400             OR (SQLCODE = ZERO))                                 21140001
211500                                                                  21150001
211600         MOVE 'CURSOR:  STAT-CSR'                                 21160005
211700                        TO DP013-MESSAGE-TEXT (2)                 21170001
211800         EXEC SQL                                                 21180001
211900                  OPEN STAT-CSR                                   21190005
212000         END-EXEC                                                 21200001
212100                                                                  21210001
212200*                                                                 21220001
212300         EVALUATE TRUE                                            21230001
212400             WHEN SQLCODE = ZERO                                  21240001
212500             WHEN SQLCODE = -904                                  21250001
212600             WHEN SQLCODE = -913                                  21260001
212700                 CONTINUE                                         21270001
212800             WHEN SQLWARN0 NOT = SPACES                           21280001
212900             WHEN SQLCODE < ZERO                                  21290001
213000             WHEN SQLCODE > ZERO                                  21300001
213100                 MOVE '4010-OPEN-CURSOR'                          21310001
213200                                   TO DP013-PARAGRAPH             21320001
213300                 MOVE 'OPEN TRAILER CURSOR - '                    21330001
213400                                   TO DP013-MESSAGE-TEXT (1)      21340001
213500                 MOVE SQLCA        TO DP013-SQLCA                 21350001
213600                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    21360001
213700                 SET DP013-DB2-ABEND                              21370001
213800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21380001
213900                 PERFORM DP013-0000-PROCESS-ABEND                 21390001
214000         END-EVALUATE                                             21400001
214100     END-PERFORM.                                                 21410001
214200*                                                                 21420001
214300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21430001
214400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             21440001
214500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   21450001
214600                                   TO DP013-MESSAGE-TEXT (1)      21460001
214700         MOVE SQLCA                TO DP013-SQLCA                 21470001
214800         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)    21480001
214900         SET DP013-DB2-ABEND                                      21490001
215000             DP013-XCTL-DISPLAY-RESTART                           21500001
215100                                   TO TRUE                        21510001
215200         PERFORM DP013-0000-PROCESS-ABEND                         21520001
215300     END-IF.                                                      21530001
215400                                                                  21540001
215500 EJECT                                                            21550001
215600*----------------------------------------------------------------*21560001
215700*   CLOSE THE STAT    CURSOR                                     *21570005
215800*----------------------------------------------------------------*21580001
215900 4020-CLOSE-CURSOR.                                               21590001
216000                                                                  21600001
216100     EXEC SQL                                                     21610001
216200          CLOSE STAT-CSR                                          21620005
216300     END-EXEC                                                     21630001
216400                                                                  21640001
216500*                                                                 21650001
216600     EVALUATE TRUE                                                21660001
216700         WHEN SQLCODE = ZERO                                      21670001
216800             CONTINUE                                             21680001
216900         WHEN SQLWARN0 NOT = SPACES                               21690001
217000         WHEN SQLCODE < ZERO                                      21700001
217100         WHEN SQLCODE > ZERO                                      21710001
217200             MOVE '4020-CLOSE-CURSOR'                             21720001
217300                               TO DP013-PARAGRAPH                 21730001
217400             MOVE 'CLOSE STAT CURSOR '                            21740005
217500                               TO DP013-MESSAGE-TEXT (1)          21750001
217600             MOVE SQLCA        TO DP013-SQLCA                     21760001
217700             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)        21770001
217800             SET DP013-DB2-ABEND                                  21780001
217900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21790001
218000             PERFORM DP013-0000-PROCESS-ABEND                     21800001
218100     END-EVALUATE.                                                21810001
218200                                                                  21820001
218300 EJECT                                                            21830001
218400*----------------------------------------------------------------*21840001
218500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *21850001
218600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *21860001
218700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *21870001
218800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21880001
218900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21890001
219000*                                                                *21900001
219100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21910001
219200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21920001
219300*    UPON INITIALIZATION.                                        *21930001
219400*----------------------------------------------------------------*21940001
219500 4300-READ-ITEMS-FROM-DB.                                         21950001
219600                                                                  21960001
219700     PERFORM                                                      21970001
219800         VARYING PV-READ-COUNT                                    21980001
219900         FROM 1 BY 1                                              21990001
220000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    22000001
220100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         22010001
220200                                                                  22020001
220300         PERFORM 4310-FETCH                                       22030001
220400                                                                  22040001
220500         IF  ASC-ITEMS-LEFT-ON-DB                                 22050001
220600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                22060001
220700                 ADD +1            TO ASC-ITEM-SUB                22070001
220800             ELSE                                                 22080001
220900                 ADD +1            TO ASC-BLK-SUB                 22090001
221000                 MOVE +1           TO ASC-ITEM-SUB                22100001
221100                                                                  22110001
221200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         22120001
221300                     MOVE +1       TO ASC-BLK-SUB                 22130001
221400                     SET ASC-BLOCK-MODIFIED (1)                   22140001
221500                                   TO TRUE                        22150001
221600                     PERFORM 5100-WRITE-TEMP-STORAGE              22160001
221700                     MOVE ASC-BLOCK-ENTRIES                       22170001
221800                               (PC-MAX-BLOCKS-IN-ARRAY)           22180001
221900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22190001
222000                     ADD +1        TO ASC-BLK-SUB                 22200001
222100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   22210001
222200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      22220001
222300                                   TO  TRUE                       22230001
222400                 END-IF                                           22240001
222500             END-IF                                               22250001
222600             ADD +1                  TO  ASC-NUMBER-OF-ITEMS-READ 22260001
222700             MOVE ASC-NUMBER-OF-ITEMS-READ                        22270001
222800                                     TO  ASC-LIST-ITEM-NUMBER     22280001
222900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22290001
222910             MOVE SHIPMT-BOL-NBR           TO ASC-BL              22291008
222911                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22291105
222920             MOVE SHIPMT-PRO-NBR           TO ASC-PRO             22292005
222921                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22292105
222930             MOVE SHIPST-SHIPT-STATUS-CDE  TO ASC-STAT            22293005
222931                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22293105
222942                                                                          
222943             MOVE PV-CREATE-UID            TO ASC-UID             22294005
222944                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22294105
222945                                                                          
222946             IF PV-CREATE-DATE > SPACES                                   
223910                 MOVE PV-CREATE-DATE(9:2) TO PV-DATE-DAY                  
223911                 MOVE PV-CREATE-DATE(6:2) TO PV-DATE-MONTH                
223912                 MOVE '/'                 TO PV-DATE-SLASH                
223931             ELSE                                                         
223932                 MOVE SPACES TO PV-DATE                                   
223933             END-IF                                                       
223940             MOVE PV-DATE                TO ASC-CRDT                      
223950                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
223951                                                                          
223952             IF PV-CREATE-TIME > SPACES                                   
223953                 MOVE PV-CREATE-TIME(1:2) TO PV-TIME-HOUR                 
223954                 MOVE PV-CREATE-TIME(4:2) TO PV-TIME-MIN                  
223955                 MOVE ':'                 TO PV-TIME-COLON                
223956             ELSE                                                         
223957                 MOVE SPACES TO PV-TIME                                   
223958             END-IF                                                       
223990             MOVE PV-TIME                TO ASC-CRTM                      
223991                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
225600       END-IF                                                             
225700     END-PERFORM.                                                         
225800                                                                          
225900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22590001
226000         MOVE +1               TO ASC-BLK-SUB                     22600001
226100         PERFORM 5100-WRITE-TEMP-STORAGE                          22610001
226200         ADD +1                TO ASC-BLK-SUB                     22620001
226300         PERFORM 5100-WRITE-TEMP-STORAGE                          22630001
226400                                                                  22640001
226500         MOVE 1                TO ASC-BLK-SUB                     22650001
226600                                  PV-BLOCK-NUMBER                 22660001
226700         PERFORM 4410-READ-TEMP-STORAGE                           22670001
226800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22680001
226900             MOVE 2            TO ASC-BLK-SUB                     22690001
227000                                  PV-BLOCK-NUMBER                 22700001
227100             PERFORM 4410-READ-TEMP-STORAGE                       22710001
227200         END-IF                                                   22720001
227300     END-IF.                                                      22730001
227400                                                                  22740001
227500 EJECT                                                            22750001
227600*----------------------------------------------------------------*22760001
227700*    FETCH THE CONTAINER CURSOR                                  *22770001
227800*----------------------------------------------------------------*22780001
227900 4310-FETCH.                                                      22790001
228000                                                                  22800001
228100        EXEC SQL                                                  22810001
228200        FETCH STAT-CSR                                            22820005
228300        INTO                                                      22830001
228310          :SHIPMT-BOL-NBR                                         22831005
228320         ,:SHIPMT-PRO-NBR                                         22832005
228330         ,:SHIPST-SHIPT-STATUS-CDE                                22833005
228331         ,:SHIPST-STATUS-DTE                                              
228332         ,:SHIPST-STATUS-TME                                              
228333         ,:SHIPST-STATUS-UID                                              
228334         ,:SHSTYP-PRTY-CDE                                        22833113
229200        END-EXEC                                                  22920001
229400*                                                                 22940001
229500     EVALUATE TRUE                                                22950001
229600         WHEN SQLCODE = ZERO                                      22960001
229910              PERFORM 4330-OPEN-CREATE-CSR                                
229920              PERFORM 4340-FETCH-CREATE-CSR                               
229930              PERFORM 4335-CLOSE-CREATE-CSR                               
229940         WHEN SQLCODE = +100                                      22970001
229950              CONTINUE                                            22990001
230000         WHEN SQLWARN0 NOT = SPACE                                23000001
230100         WHEN SQLCODE NOT = ZERO                                  23010001
230200              MOVE '4310-FETCH-CURSOR'                            23020001
230300                               TO DP013-PARAGRAPH                 23030001
230400              MOVE 'FETCH STAT CURSOR'                            23040005
230500                               TO DP013-MESSAGE-TEXT (1)          23050001
230600              MOVE SQLCA       TO DP013-SQLCA                     23060001
230700              SET DP013-DB2-ABEND                                 23070001
230800                               TO TRUE                            23080001
230900              PERFORM DP013-0000-PROCESS-ABEND                    23090001
231000             MOVE SQLCA        TO DP013-SQLCA                     23100001
231100             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)        23110001
231200             SET DP013-DB2-ABEND                                  23120001
231300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23130001
231400             PERFORM DP013-0000-PROCESS-ABEND                     23140001
231500     END-EVALUATE.                                                23150001
231600*                                                                 23160001
231700     IF  SQLCODE EQUAL +100                                       23170001
231800         SET ASC-NO-ITEMS-LEFT-ON-DB                              23180001
231900                                   TO TRUE                        23190001
232000     END-IF.                                                      23200001
232100                                                                  23210001
232200 EJECT                                                            23220001
232300*----------------------------------------------------------------*23230001
232400*    FORMAT THE DB2 DATE TO MM/DD/YY.                            *23240001
232500*----------------------------------------------------------------*23250001
232600 4320-FORMAT-DATE.                                                23260001
232700                                                                  23270001
232800     MOVE PV-DB-MM          TO  PV-DD-MM.                         23280001
232900     MOVE PV-DB-DD          TO  PV-DD-DD.                         23290001
233000     MOVE PV-DB-YY          TO  PV-DD-YY.                         23300001
233100                                                                  23310001
233200 EJECT                                                            23320001
233300*----------------------------------------------------------------*21040001
233400*   OPEN THE CREATE CURSOR                                       *21050005
233500*----------------------------------------------------------------*21060001
233600 4330-OPEN-CREATE-CSR.                                            21070001
233700                                                                  21080001
233800     PERFORM                                                      21090001
233900         WITH TEST AFTER                                          21100001
234000         VARYING PV-RETRY-COUNTER                                 21110001
234100         FROM 1 BY 1                                              21120001
234200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21130001
234300             OR (SQLCODE = ZERO))                                 21140001
234400                                                                  21150001
234500         MOVE 'CURSOR: CREATE-CSR'                                21160005
234600                        TO DP013-MESSAGE-TEXT (2)                 21170001
234700         EXEC SQL                                                 21180001
234800                  OPEN CREATE-CSR                                 21190005
234900         END-EXEC                                                 21200001
235000                                                                  21210001
235100*                                                                 21220001
235200         EVALUATE TRUE                                            21230001
235300             WHEN SQLCODE = ZERO                                  21240001
235400             WHEN SQLCODE = -904                                  21250001
235500             WHEN SQLCODE = -913                                  21260001
235600                 CONTINUE                                         21270001
235700             WHEN SQLWARN0 NOT = SPACES                           21280001
235800             WHEN SQLCODE < ZERO                                  21290001
235900             WHEN SQLCODE > ZERO                                  21300001
236000                 MOVE '4330-OPEN-CREATE-CSR'                      21310001
236100                                   TO DP013-PARAGRAPH             21320001
236200                 MOVE 'OPEN CREATE CURSOR - '                     21330001
236300                                   TO DP013-MESSAGE-TEXT (1)      21340001
236400                 MOVE SQLCA        TO DP013-SQLCA                 21350001
236500                 MOVE 'TAUSHPO '   TO DP013-DB2-TABLE-NAME (1)    21360001
236600                 SET DP013-DB2-ABEND                              21370001
236700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21380001
236800                 PERFORM DP013-0000-PROCESS-ABEND                 21390001
236900         END-EVALUATE                                             21400001
237000     END-PERFORM.                                                 21410001
237100*                                                                 21420001
237200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21430001
237300         MOVE '4330-OPEN-CREATE-CSR' TO DP013-PARAGRAPH           21440001
237400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   21450001
237500                                   TO DP013-MESSAGE-TEXT (1)      21460001
237600         MOVE SQLCA                TO DP013-SQLCA                 21470001
237700         MOVE 'TAUSHPO '           TO DP013-DB2-TABLE-NAME (1)    21480001
237800         SET DP013-DB2-ABEND                                      21490001
237900             DP013-XCTL-DISPLAY-RESTART                           21500001
238000                                   TO TRUE                        21510001
238100         PERFORM DP013-0000-PROCESS-ABEND                         21520001
238200     END-IF.                                                      21530001
238300                                                                  21540001
238400 EJECT                                                            21550001
238500*----------------------------------------------------------------*21560001
238600*   CLOSE THE CREATE CURSOR                                      *21570005
238700*----------------------------------------------------------------*21580001
238800 4335-CLOSE-CREATE-CSR.                                           21590001
238900                                                                  21600001
239000     EXEC SQL                                                     21610001
239100          CLOSE CREATE-CSR                                        21620005
239200     END-EXEC                                                     21630001
239300                                                                  21640001
239400*                                                                 21650001
239500     EVALUATE TRUE                                                21660001
239600         WHEN SQLCODE = ZERO                                      21670001
239700             CONTINUE                                             21680001
239800         WHEN SQLWARN0 NOT = SPACES                               21690001
239900         WHEN SQLCODE < ZERO                                      21700001
240000         WHEN SQLCODE > ZERO                                      21710001
240100             MOVE '4335-CLOSE-CREATE-CSR'                         21720001
240200                               TO DP013-PARAGRAPH                 21730001
240300             MOVE 'CLOSE CREATE CURSOR'                           21740005
240400                               TO DP013-MESSAGE-TEXT (1)          21750001
240500             MOVE SQLCA        TO DP013-SQLCA                     21760001
240600             MOVE 'TAUSHPO '   TO DP013-DB2-TABLE-NAME (1)        21770001
240700             SET DP013-DB2-ABEND                                  21780001
240800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21790001
240900             PERFORM DP013-0000-PROCESS-ABEND                     21800001
241000     END-EVALUATE.                                                21810001
241100                                                                  21820001
241200 EJECT                                                            21830001
241300*----------------------------------------------------------------*22760001
241400*    FETCH THE CREATE CURSOR                                     *22770001
241500*----------------------------------------------------------------*22780001
241600 4340-FETCH-CREATE-CSR.                                           22790001
241700                                                                  22800001
241800        EXEC SQL                                                  22810001
241900        FETCH CREATE-CSR                                          22820005
242000        INTO                                                      22830001
242100          :AUSHPO-PO-NBR                                          22831005
242110         ,:PV-CREATE-UID                                                  
242200         ,:PV-CREATE-DATE                                         22832005
242300         ,:PV-CREATE-TIME                                         22833005
242600        END-EXEC                                                  22920001
242700*                                                                 22940001
242800     EVALUATE TRUE                                                22950001
242900         WHEN SQLCODE = ZERO                                      22960001
243000              CONTINUE                                            22990001
243300         WHEN SQLCODE = +100                                      22970001
243400              MOVE SHIPST-STATUS-DTE TO PV-CREATE-DATE                    
243410              MOVE SHIPST-STATUS-TME TO PV-CREATE-TIME                    
243420              MOVE SHIPST-STATUS-UID TO PV-CREATE-UID                     
243500         WHEN SQLWARN0 NOT = SPACE                                23000001
243600         WHEN SQLCODE NOT = ZERO                                  23010001
243700              MOVE '4340-FETCH-CREATE-CSR'                        23020001
243800                               TO DP013-PARAGRAPH                 23030001
243900              MOVE 'FETCH CREATE CURSOR'                          23040005
244000                               TO DP013-MESSAGE-TEXT (1)          23050001
244100              MOVE SQLCA       TO DP013-SQLCA                     23060001
244200              SET DP013-DB2-ABEND                                 23070001
244300                               TO TRUE                            23080001
244400              PERFORM DP013-0000-PROCESS-ABEND                    23090001
244500             MOVE SQLCA        TO DP013-SQLCA                     23100001
244600             MOVE 'TAUSHPO '   TO DP013-DB2-TABLE-NAME (1)        23110001
244700             SET DP013-DB2-ABEND                                  23120001
244800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23130001
244900             PERFORM DP013-0000-PROCESS-ABEND                     23140001
245000     END-EVALUATE.                                                23150001
245600                                                                  23210001
245700 EJECT                                                            23220001
255800*----------------------------------------------------------------*25580001
255900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *25590001
256000*----------------------------------------------------------------*25600001
256100 4400-MOVE-COMMAREA-TO-SCREEN.                                    25610001
256200                                                                  25620001
256300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             25630001
256400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          25640001
256500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          25650001
256600             MOVE +1    TO ASC-BLK-SUB                            25660001
256700             PERFORM 5100-WRITE-TEMP-STORAGE                      25670001
256800             ADD +1     TO ASC-BLK-SUB                            25680001
256900             PERFORM 5100-WRITE-TEMP-STORAGE                      25690001
257000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             25700001
257100                 GIVING PV-BLOCK-NUMBER                           25710001
257200                 REMAINDER PV-REMAINDER                           25720001
257300             IF  PV-REMAINDER > ZERO                              25730001
257400                 ADD +1 TO PV-BLOCK-NUMBER                        25740001
257500             END-IF                                               25750001
257600             MOVE +1    TO ASC-BLK-SUB                            25760001
257700             PERFORM 4410-READ-TEMP-STORAGE                       25770001
257800             ADD +1     TO ASC-BLK-SUB                            25780001
257900                           PV-BLOCK-NUMBER                        25790001
258000             PERFORM 4410-READ-TEMP-STORAGE                       25800001
258100     END-IF.                                                      25810001
258200     MOVE +1            TO ASC-BLK-SUB.                           25820001
258300     COMPUTE ASC-ITEM-SUB =                                       25830001
258400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              25840001
258500         + PC-ITEMS-PER-PANEL).                                   25850001
258600*                                                                 25860001
258700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        25870001
258800         ADD +1         TO ASC-BLK-SUB                            25880001
258900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25890001
259000     END-IF.                                                      25900001
259100*                                                                 25910001
259200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           25920001
259300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                25930001
259400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        25940001
259500     PERFORM 4420-FORMAT-LIST-LINES                               25950001
259600         VARYING PV-SUB                                           25960001
259700         FROM PC-ITEMS-PER-PANEL BY -1                            25970001
259800         UNTIL PV-SUB < +1.                                       25980001
259900*                                                                 25990001
260000     COMPUTE ASC-ITEMS-DISPLAYED =                                26000001
260100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          26010001
260200     PERFORM 4401-SELECT-PO-DETAILS.                              26020001
260300     PERFORM 4402-SELECT-AD-DTE.                                  26030001
260400     PERFORM 4403-SELECT-VND-STYL.                                26040001
260500     MOVE SPACES TO ASC-OUTR-PACK-X.                              26050001
260600     MOVE 0 TO ASC-OUTR-PACK.                                     26060001
260700     PERFORM 4404-OPEN-OUTR-PCK-CSR.                              26070001
260800     PERFORM 4405-FETCH-OUTR-PCK.                                 26080001
260900     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                             26090001
261000     PERFORM 4407-OPEN-TRLR-CTN-CSR.                              26100019
261001     PERFORM 4407-FETCH-TRLR-CTN.                                 26100117
261002     PERFORM 4407-CLOSE-TRLR-CTN-CSR.                             26100219
261003     PERFORM 4408-SELECT-TR-CREATE-DT.                            26100324
261010     PERFORM 4409-MOVE-PO-DTLS-TO-SCR.                            26101024
261100*                                                                 26110001
261200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    26120001
261300                                      ASTRTITO.                   26130001
261400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    26140001
261500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    26150001
261600*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26160001
261700*                                  TO ASELITO.                    26170001
261800*                                                                 26180001
261900     IF  DP020-MSG-NUMBER-X = SPACE                               26190001
262000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  26200001
262100*----------- MORE ITEMS TO DISPLAY --------                       26210001
262200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            26220001
262300             SET DP020-MSG-INFORMATIONAL TO TRUE                  26230001
262400         END-IF                                                   26240001
262500     END-IF.                                                      26250001
262600                                                                  26260001
262700 EJECT                                                            26270001
262800*----------------------------------------------------------------*26280001
262900*    SELECT PO DETAILS.                                          *26290001
263000*----------------------------------------------------------------*26300001
263100 4401-SELECT-PO-DETAILS.                                          26310001
263200                                                                  26320001
263300     PERFORM                                                      26330001
263400         WITH TEST AFTER                                          26340001
263500         VARYING PV-RETRY-COUNTER                                 26350001
263600         FROM 1 BY 1                                              26360001
263700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26370001
263800            OR  (SQLCODE = ZERO)                                  26380001
263900            OR  (SQLCODE = +100))                                 26390001
264000                                                                  26400001
264100         EXEC SQL                                                 26410001
264200              SELECT A.DEPT_NBR,                                  26420001
264300                     A.OTB_PER_NBR,                               26430001
264400                     A.TOT_UNT_QTY,                               26440001
264500                     A.PROD_CNTRY_CDE,                            26450001
264600                     B.ENT_NAME_DESC,                             26460001
264700                     C.CAN_IFNOT_SHIP_DTE,                        26470001
264800                     C.EXT_CAN_DTE,                               26480001
264900                     C.STRT_FCTRY_DTE,                            26490001
265000                     C.LAST_FCTRY_DTE,                            26500001
265100                     C.DONT_SHIP_BEF_DTE,                         26510001
265200                     C.FOB_CDE,                                   26520001
265300                     C.POE_CDE                                    26530001
265400              INTO  :PURCHS-DEPT-NBR,                             26540001
265500                    :PURCHS-OTB-PER-NBR,                          26550001
265600                    :PURCHS-TOT-UNT-QTY,                          26560001
265700                    :PURCHS-PROD-CNTRY-CDE,                       26570001
265800                    :ENTNME-ENT-NAME-DESC,                        26580001
265900                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                   26590001
266000                    :PLNSHP-EXT-CAN-DTE,                          26600001
266100                    :PLNSHP-STRT-FCTRY-DTE,                       26610001
266200                    :PLNSHP-LAST-FCTRY-DTE,                       26620001
266300                    :PLNSHP-DONT-SHIP-BEF-DTE,                    26630001
266400                    :PLNSHP-FOB-CDE,                              26640001
266500                    :PLNSHP-POE-CDE                               26650001
266600              FROM   TPURCHS A,                                   26660001
266700                     TENTNME B,                                   26670001
266800                     TPLNSHP C                                    26680001
266900              WHERE  A.PO_NBR         = :DK-PO-NBR                26690001
267000                AND  A.VER_STATUS_CDE = 'A'                       26700001
267100                AND  B.ENT_ID         =  A.ENT_ID                 26710001
267200                AND  B.TYPE_CDE       = '01'                      26720001
267300                AND  C.PO_NBR         =  A.PO_NBR                 26730001
267400                AND  C.VER_STATUS_CDE =  A.VER_STATUS_CDE         26740001
267500         END-EXEC                                                 26750001
267600*                                                                 26760001
267700         EVALUATE TRUE                                            26770001
267800             WHEN SQLCODE = ZERO                                  26780001
267900             WHEN SQLCODE = +100                                  26790001
268000             WHEN SQLCODE = -904                                  26800001
268100             WHEN SQLCODE = -913                                  26810001
268200                 CONTINUE                                         26820001
268300             WHEN SQLWARN0 NOT = SPACES                           26830001
268400             WHEN SQLCODE < ZERO                                  26840001
268500             WHEN SQLCODE > ZERO                                  26850001
268600                 MOVE '4401-SELECT-PO-DETAILS'                    26860001
268700                                   TO DP013-PARAGRAPH             26870001
268800                 MOVE 'SQL ERROR SELECTING PO DETAILS'            26880001
268900                                   TO DP013-MESSAGE-TEXT (1)      26890001
269000                 MOVE SQLCA        TO DP013-SQLCA                 26900001
269100                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    26910001
269200                 SET DP013-DB2-ABEND                              26920001
269300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26930001
269400                 PERFORM DP013-0000-PROCESS-ABEND                 26940001
269500         END-EVALUATE                                             26950001
269600     END-PERFORM.                                                 26960001
269700*                                                                 26970001
269800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26980001
269900         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH      26990001
270000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  27000001
270100                                   TO DP013-MESSAGE-TEXT (1)      27010001
270200         MOVE SQLCA                TO DP013-SQLCA                 27020001
270300         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    27030001
270400         SET DP013-DB2-ABEND                                      27040001
270500             DP013-XCTL-DISPLAY-RESTART                           27050001
270600                                   TO TRUE                        27060001
270700         PERFORM DP013-0000-PROCESS-ABEND                         27070001
270800     END-IF.                                                      27080001
270900                                                                  27090001
271000 EJECT                                                            27100001
271100*----------------------------------------------------------------*27110001
271200*     SELECT AD-DTE FROM TPURITM                                 *27120001
271300*----------------------------------------------------------------*27130001
271400 4402-SELECT-AD-DTE.                                              27140001
271500                                                                  27150001
271600     PERFORM                                                      27160001
271700         WITH TEST AFTER                                          27170001
271800         VARYING PV-RETRY-COUNTER                                 27180001
271900         FROM 1 BY 1                                              27190001
272000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27200001
272100         OR     (SQLCODE = ZERO)                                  27210001
272200         OR     (SQLCODE = +100))                                 27220001
272300                                                                  27230001
272400         EXEC SQL                                                 27240001
272500              SELECT                                              27250001
272600                     MIN(AD_EVNT_DTE)                             27260001
272700              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND            27270001
272800              FROM   TPURITM                                      27280001
272900              WHERE  PO_NBR         = :DK-PO-NBR                  27290001
273000              AND    VER_STATUS_CDE = 'A'                         27300001
273100              AND    AD_EVNT_DTE   ^= '0001-01-01'                27310001
273200         END-EXEC                                                 27320001
273300*                                                                 27330001
273400         EVALUATE TRUE                                            27340001
273500             WHEN SQLCODE = ZERO                                  27350001
273600             WHEN SQLCODE = +100                                  27360001
273700             WHEN SQLCODE = -904                                  27370001
273800             WHEN SQLCODE = -913                                  27380001
273900                  CONTINUE                                        27390001
274000             WHEN SQLWARN0 NOT = SPACE                            27400001
274100             WHEN SQLCODE NOT = ZERO                              27410001
274200                  MOVE '4402-SELECT-AD-DTE'                       27420001
274300                                   TO DP013-PARAGRAPH             27430001
274400                  MOVE 'SQL ERROR SELECTING AD DATE'              27440001
274500                                   TO DP013-MESSAGE-TEXT (1)      27450001
274600                  MOVE SQLCA       TO DP013-SQLCA                 27460001
274700                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    27470001
274800                  SET DP013-DB2-ABEND                             27480001
274900                      DP013-XCTL-DISPLAY-RESTART TO TRUE          27490001
275000                  PERFORM DP013-0000-PROCESS-ABEND                27500001
275100         END-EVALUATE                                             27510001
275200     END-PERFORM.                                                 27520001
275300*                                                                 27530001
275400     IF SQLCODE EQUAL + 0                                         27540001
275500        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK               27550001
275600        PERFORM 4320-FORMAT-DATE                                  27560001
275700        MOVE PV-DATE-DISPLAY       TO AADDTO                      27570001
275800     ELSE                                                         27580001
275900        MOVE SPACES                TO AADDTO                      27590001
276000     END-IF.                                                      27600001
276100*                                                                 27610001
276200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27620001
276300         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH             27630001
276400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA27640001
276500-             'TE'                 TO DP013-MESSAGE-TEXT (1)      27650001
276600         MOVE SQLCA                TO DP013-SQLCA                 27660001
276700         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    27670001
276800         SET DP013-DB2-ABEND                                      27680001
276900             DP013-XCTL-DISPLAY-RESTART                           27690001
277000                                   TO TRUE                        27700001
277100         PERFORM DP013-0000-PROCESS-ABEND                         27710001
277200     END-IF.                                                      27720001
277300                                                                  27730001
277400 EJECT                                                            27740001
277410*----------------------------------------------------------------*        
277420*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *        
277430*----------------------------------------------------------------*        
277440 4403-SELECT-VND-STYL.                                                    
277450                                                                          
277460     PERFORM                                                              
277470         WITH TEST AFTER                                                  
277480         VARYING PV-RETRY-COUNTER                                         
277490         FROM 1 BY 1                                                      
277491         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
277492            OR  (SQLCODE = ZERO)                                          
277493            OR  (SQLCODE = +100)                                          
277494            OR  (SQLCODE = -811))                                         
277495                                                                          
277496         EXEC SQL                                                         
277497              SELECT   DISTINCT                                           
277498                       VS_NBR                                             
277499                INTO   :XLT00004-VS-NBR                                   
277500                FROM   TPURITM A                                          
277501                   ,   XLT_SKU B                                          
277502                   ,   XLT_VND_STYL C                                     
277503               WHERE   A.PO_NBR       = :DK-PO-NBR                        
277504                 AND   A.VER_STATUS_CDE = 'A'                             
277505                 AND   A.ITM_NBR = B.ITM_NBR                              
277506                 AND   B.STYL_ID = C.STYL_ID                              
277507         END-EXEC                                                         
277508                                                                          
277509         EVALUATE TRUE                                                    
277510             WHEN SQLCODE = ZERO                                          
277511             WHEN SQLCODE = +100                                          
277512             WHEN SQLCODE = -811                                          
277513             WHEN SQLCODE = -904                                          
277514             WHEN SQLCODE = -913                                          
277515                 CONTINUE                                                 
277516             WHEN SQLWARN0 NOT = SPACES                                   
277517             WHEN SQLCODE < ZERO                                          
277518             WHEN SQLCODE > ZERO                                          
277519                 MOVE '4403-SELECT-VND-STYL'                              
277520                                     TO DP013-PARAGRAPH                   
277521                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'                  
277522                                     TO DP013-MESSAGE-TEXT (1)            
277523                 MOVE SQLCA          TO DP013-SQLCA                       
277524                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)          
277525                 SET DP013-DB2-ABEND                                      
277526                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
277527                 PERFORM DP013-0000-PROCESS-ABEND                         
277528         END-EVALUATE                                                     
277529     END-PERFORM.                                                         
277530*                                                                         
277531     IF  SQLCODE EQUAL +0                                                 
277532         MOVE XLT00004-VS-NBR       TO AVNDSTYO                           
277533     ELSE                                                                 
277534         IF  SQLCODE EQUAL -811                                           
277535             MOVE '*MULTIPLES*'     TO AVNDSTYO                           
277536         END-IF                                                           
277537     END-IF.                                                              
277538*                                                                         
277539     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
277540         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH                
277541         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO        
277542-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)              
277543         MOVE SQLCA                TO DP013-SQLCA                         
277544         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)            
277545         SET DP013-DB2-ABEND                                              
277546             DP013-XCTL-DISPLAY-RESTART                                   
277547                                   TO TRUE                                
277548         PERFORM DP013-0000-PROCESS-ABEND                                 
277549     END-IF.                                                              
277550                                                                          
277551 EJECT                                                                    
284000*----------------------------------------------------------------*28400001
284100*     OPEN THE OUTER PACK CURSOR                                 *28410001
284200*----------------------------------------------------------------*28420001
284300 4404-OPEN-OUTR-PCK-CSR.                                          28430001
284400                                                                  28440001
284500     PERFORM                                                      28450001
284600         WITH TEST AFTER                                          28460001
284700         VARYING PV-RETRY-COUNTER                                 28470001
284800         FROM 1 BY 1                                              28480001
284900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28490001
285000            OR  (SQLCODE = ZERO))                                 28500001
285100                                                                  28510001
285200         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)   28520001
285300                                                                  28530001
285400         EXEC SQL                                                 28540001
285500              OPEN OUTR-PCK-CSR                                   28550001
285600         END-EXEC                                                 28560001
285700*                                                                 28570001
285800         EVALUATE TRUE                                            28580001
285900             WHEN SQLCODE = ZERO                                  28590001
286000             WHEN SQLCODE = -904                                  28600001
286100             WHEN SQLCODE = -913                                  28610001
286200                 CONTINUE                                         28620001
286300             WHEN SQLWARN0 NOT = SPACES                           28630001
286400             WHEN SQLCODE < ZERO                                  28640001
286500             WHEN SQLCODE > ZERO                                  28650001
286600                 MOVE '4404-OPEN-OUTR-PCK-CSR'                    28660001
286700                                   TO DP013-PARAGRAPH             28670001
286800                 MOVE 'OPEN OUTER-PACK CURSOR - '                 28680001
286900                                   TO DP013-MESSAGE-TEXT (1)      28690001
287000                 MOVE SQLCA        TO DP013-SQLCA                 28700001
287100                 MOVE 'TUPC   '   TO DP013-DB2-TABLE-NAME (1)     28710001
287200                 SET DP013-DB2-ABEND                              28720001
287300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28730001
287400                 PERFORM DP013-0000-PROCESS-ABEND                 28740001
287500         END-EVALUATE                                             28750001
287600     END-PERFORM.                                                 28760001
287700*                                                                 28770001
287800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28780001
287900         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH       28790001
288000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   28800001
288100                                   TO DP013-MESSAGE-TEXT (1)      28810001
288200         MOVE SQLCA                TO DP013-SQLCA                 28820001
288300         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)    28830001
288400         SET DP013-DB2-ABEND                                      28840001
288500             DP013-XCTL-DISPLAY-RESTART                           28850001
288600                                   TO TRUE                        28860001
288700         PERFORM DP013-0000-PROCESS-ABEND                         28870001
288800     END-IF.                                                      28880001
288900                                                                  28890001
289000 EJECT                                                            28900001
289100*----------------------------------------------------------------*28910001
289200*     FETCH THE OUTER PACK QUANTITY                              *28920001
289300*----------------------------------------------------------------*28930001
289400 4405-FETCH-OUTR-PCK.                                             28940001
289500                                                                  28950001
289600     PERFORM                                                      28960001
289700         WITH TEST AFTER                                          28970001
289800         VARYING PV-RETRY-COUNTER                                 28980001
289900         FROM 1 BY 1                                              28990001
290000         UNTIL (SQLCODE = +100)                                   29000001
290100                                                                  29010001
290101         EXEC SQL                                                         
290102              FETCH OUTR-PCK-CSR                                          
290103              INTO  :PURITM-UNT-QTY                                       
290104                 ,  :PURITM-OUTR-PK-QTY                                   
290105         END-EXEC                                                         
290700*                                                                 29070001
290800         EVALUATE TRUE                                            29080001
290900             WHEN SQLCODE = ZERO                                  29090001
291000             WHEN SQLCODE = +100                                  29100001
291100                  CONTINUE                                        29110001
291200             WHEN SQLWARN0 NOT = SPACE                            29120001
291300             WHEN SQLCODE NOT = ZERO                              29130001
291400                  MOVE '4405-FETCH-OUTR-PCK'                      29140001
291500                                   TO DP013-PARAGRAPH             29150001
291600                  MOVE 'FETCH OUTER-PACK CURSOR'                  29160001
291700                                   TO DP013-MESSAGE-TEXT (1)      29170001
291800                  MOVE SQLCA       TO DP013-SQLCA                 29180001
291900                  SET DP013-DB2-ABEND                             29190001
292000                                   TO TRUE                        29200001
292100                  PERFORM DP013-0000-PROCESS-ABEND                29210001
292200         END-EVALUATE                                             29220001
292300*                                                                 29230001
292400         IF  SQLCODE EQUAL +0                                     29240001
292500             IF PURITM-OUTR-PK-QTY NOT = ASC-OUTR-PACK            29250001
292600                IF ASC-OUTR-PACK = 0                              29260001
292700                   MOVE PURITM-OUTR-PK-QTY TO ASC-OUTR-PACK       29270001
292800                ELSE                                              29280001
292900                   MOVE PC-MULTI TO ASC-OUTR-PACK-X               29290001
293000                END-IF                                            29300001
293100             END-IF                                               29310001
293200             IF PURITM-OUTR-PK-QTY = 0                            29320001
293300                DIVIDE 1 INTO PURITM-UNT-QTY                      29330001
293400                GIVING PV-ITEM-CART-CNT ROUNDED                   29340001
293500             ELSE                                                 29350001
293600                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY     29360001
293700                GIVING PV-ITEM-CART-CNT ROUNDED                   29370001
293800             END-IF                                               29380001
293900             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT               29390001
294000         END-IF                                                   29400001
294100     END-PERFORM.                                                 29410001
294200                                                                  29420001
294300 EJECT                                                            29430001
294400*----------------------------------------------------------------*29440001
294500*     CLOSE THE OUTER PACK CURSOR                                *29450001
294600*----------------------------------------------------------------*29460001
294700 4406-CLOSE-OUTR-PCK-CSR.                                         29470001
294800                                                                  29480001
294900     EXEC SQL                                                     29490001
295000          CLOSE OUTR-PCK-CSR                                      29500001
295100     END-EXEC.                                                    29510001
295200*                                                                 29520001
295300     EVALUATE TRUE                                                29530001
295400         WHEN SQLCODE = ZERO                                      29540001
295500             CONTINUE                                             29550001
295600         WHEN SQLWARN0 NOT = SPACES                               29560001
295700         WHEN SQLCODE < ZERO                                      29570001
295800         WHEN SQLCODE > ZERO                                      29580001
295900             MOVE '4406-CLOSE-OUTR-PCK-CSR'                       29590001
296000                               TO DP013-PARAGRAPH                 29600001
296100             MOVE 'CLOSE OUTER-PACK CURSOR '                      29610001
296200                               TO DP013-MESSAGE-TEXT (1)          29620001
296300             MOVE SQLCA        TO DP013-SQLCA                     29630001
296400             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)        29640001
296500             SET DP013-DB2-ABEND                                  29650001
296600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29660001
296700             PERFORM DP013-0000-PROCESS-ABEND                     29670001
296800     END-EVALUATE.                                                29680001
296900                                                                  29690001
297000 EJECT                                                            29700001
297001*----------------------------------------------------------------*29700117
297002*     OPEN THE OUTER PACK CURSOR                                 *29700217
297003*----------------------------------------------------------------*29700317
297004 4407-OPEN-TRLR-CTN-CSR.                                          29700417
297005                                                                  29700517
297006     PERFORM                                                      29700617
297007         WITH TEST AFTER                                          29700717
297008         VARYING PV-RETRY-COUNTER                                 29700817
297009         FROM 1 BY 1                                              29700917
297010         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29701017
297011            OR  (SQLCODE = ZERO))                                 29701117
297012                                                                  29701217
297013         MOVE 'CURSOR:  TRLR-CTN-CSR' TO DP013-MESSAGE-TEXT (2)   29701317
297014                                                                  29701417
297015         EXEC SQL                                                 29701517
297016              OPEN TRLR-CTN-CSR                                   29701617
297017         END-EXEC                                                 29701717
297018*                                                                 29701817
297019         EVALUATE TRUE                                            29701917
297020             WHEN SQLCODE = ZERO                                  29702017
297021             WHEN SQLCODE = -904                                  29702117
297022             WHEN SQLCODE = -913                                  29702217
297023                 CONTINUE                                         29702317
297024             WHEN SQLWARN0 NOT = SPACES                           29702417
297025             WHEN SQLCODE < ZERO                                  29702517
297026             WHEN SQLCODE > ZERO                                  29702617
297027                 MOVE '4407-OPEN-TRLR-CTN-CSR'                    29702717
297028                                   TO DP013-PARAGRAPH             29702817
297029                 MOVE 'OPEN TRLR-CTN CURSOR - '                   29702917
297030                                   TO DP013-MESSAGE-TEXT (1)      29703017
297031                 MOVE '        '   TO DP013-DB2-TABLE-NAME (1)    29703117
297032                 MOVE SQLCA        TO DP013-SQLCA                 29703217
297034                 SET DP013-DB2-ABEND                              29703417
297035                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29703517
297036                 PERFORM DP013-0000-PROCESS-ABEND                 29703617
297037         END-EVALUATE                                             29703717
297038     END-PERFORM.                                                 29703817
297039*                                                                 29703917
297040     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29704017
297041         MOVE '4407-OPEN-TRLR-CTN-CSR'   TO DP013-PARAGRAPH       29704117
297042         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   29704217
297043                                   TO DP013-MESSAGE-TEXT (1)      29704317
297044         MOVE SQLCA                TO DP013-SQLCA                 29704417
297045         MOVE '        '           TO DP013-DB2-TABLE-NAME (1)    29704517
297046         SET DP013-DB2-ABEND                                      29704617
297047             DP013-XCTL-DISPLAY-RESTART                           29704717
297048                                   TO TRUE                        29704817
297049         PERFORM DP013-0000-PROCESS-ABEND                         29704917
297050     END-IF.                                                      29705017
297051                                                                  29705117
297052 EJECT                                                            29705217
297053*----------------------------------------------------------------*29705317
297054*     FETCH THE OUTER PACK QUANTITY                              *29705417
297055*----------------------------------------------------------------*29705517
297056 4407-FETCH-TRLR-CTN.                                             29705617
297057                                                                  29705717
297058     MOVE +0          TO PV-TR-CART-CNT                           29705820
297059     PERFORM                                                      29705917
297060         WITH TEST AFTER                                          29706017
297061         VARYING PV-RETRY-COUNTER                                 29706117
297062         FROM 1 BY 1                                              29706217
297063         UNTIL (SQLCODE = +100)                                   29706317
297064                                                                  29706417
297065         EXEC SQL                                                 29706517
297066            FETCH  TRLR-CTN-CSR                                   29706617
297067            INTO                                                  29706717
297068                :SHPTPO-PO-NBR                                    29706817
297069               ,:PKSLIP-OPER-UNT-ID                               29706917
297070               ,:PKSLIP-FCLTY-ID                                  29707017
297071               ,:PKSLIP-EXPTED-PKG-QTY                            29707117
297072         END-EXEC                                                 29707217
297073*                                                                 29707317
297074         EVALUATE TRUE                                            29707417
297075             WHEN SQLCODE = ZERO                                  29707517
297076             WHEN SQLCODE = +100 OR +305                          29707617
297077                  CONTINUE                                        29707717
297078             WHEN SQLWARN0 NOT = SPACE                            29707817
297079             WHEN SQLCODE NOT = ZERO                              29707917
297080                  MOVE '4407-FETCH-TRLR-CTN'                      29708017
297081                                   TO DP013-PARAGRAPH             29708117
297082                  MOVE 'FETCH TRLR-CTN CURSOR'                    29708217
297083                                   TO DP013-MESSAGE-TEXT (1)      29708317
297084                  MOVE SQLCA       TO DP013-SQLCA                 29708417
297085                  SET DP013-DB2-ABEND                             29708517
297086                                   TO TRUE                        29708617
297087                  PERFORM DP013-0000-PROCESS-ABEND                29708717
297088         END-EVALUATE                                             29708817
297089*                                                                 29708917
297090         IF  SQLCODE EQUAL +0 AND PV-TR-CART-CNT = +0             29709020
297091             MOVE PKSLIP-EXPTED-PKG-QTY TO PV-TR-CART-CNT         29709117
297102         END-IF                                                   29710217
297103     END-PERFORM.                                                 29710317
297104                                                                  29710417
297105 EJECT                                                            29710517
297106*----------------------------------------------------------------*29710617
297107*     CLOSE THE TRLR CTN CURSOR                                  *29710717
297108*----------------------------------------------------------------*29710817
297109 4407-CLOSE-TRLR-CTN-CSR.                                         29710917
297110                                                                  29711017
297111     EXEC SQL                                                     29711117
297112          CLOSE TRLR-CTN-CSR                                      29711217
297113     END-EXEC.                                                    29711317
297114*                                                                 29711417
297115     EVALUATE TRUE                                                29711517
297116         WHEN SQLCODE = ZERO                                      29711617
297117             CONTINUE                                             29711717
297118         WHEN SQLWARN0 NOT = SPACES                               29711817
297119         WHEN SQLCODE < ZERO                                      29711917
297120         WHEN SQLCODE > ZERO                                      29712017
297121             MOVE '4407-CLOSE-TRLR-CTN-CSR'                       29712117
297122                               TO DP013-PARAGRAPH                 29712217
297123             MOVE 'CLOSE TRLR-CTN CURSOR '                        29712317
297124                               TO DP013-MESSAGE-TEXT (1)          29712417
297125             MOVE SQLCA        TO DP013-SQLCA                     29712517
297126             MOVE '        '   TO DP013-DB2-TABLE-NAME (1)        29712617
297127             SET DP013-DB2-ABEND                                  29712717
297128                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29712817
297129             PERFORM DP013-0000-PROCESS-ABEND                     29712917
297130     END-EVALUATE.                                                29713017
297131                                                                  29713117
297132 EJECT                                                            29713217
297178*                                                                 29717804
297179*----------------------------------------------------------------*29717924
297180*     SELECT TRLR CREATE DATE FROM TAUTRIP                       *29718024
297190*----------------------------------------------------------------*29719024
297191 4408-SELECT-TR-CREATE-DT.                                        29719124
297192                                                                  29719224
297193     PERFORM                                                      29719324
297194         WITH TEST AFTER                                          29719424
297195         VARYING PV-RETRY-COUNTER                                 29719524
297196         FROM 1 BY 1                                              29719624
297197         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29719724
297198         OR     (SQLCODE = ZERO OR -811)                          29719833
297199         OR     (SQLCODE = +100))                                 29719924
297200                                                                  29720024
297201         EXEC SQL                                                 29720124
297202              SELECT                                              29720224
297203                     LAST_UPD_UID                                 29720324
297204                    ,LAST_UPD_DTE                                 29720424
297205                    ,LAST_UPD_TME                                 29720524
297207              INTO                                                29720724
297208                  :AUTRIP-LAST-UPD-UID                            29720824
297209                 ,:AUTRIP-LAST-UPD-DTE                            29720924
297210                 ,:AUTRIP-LAST-UPD-TME                            29721024
297211              FROM  TAUTRIP A                                     29721124
297213              WHERE A.TRIP_ID       >= :PV-LO-TRIP-NO-N           29721324
297214              AND   A.TRIP_ID       <= :PV-HI-TRIP-NO-N           29721426
297215              AND   A.OWNER_SCAC_ID  = :DK-OWNER-SCAC-ID          29721531
297216              AND   A.VEH_NBR        = :DK-VEH-NBR                29721631
297217              AND   A.LAST_UPD_DTE    =                           29721729
297218                 (SELECT MIN(B.LAST_UPD_DTE)                      29721829
297219                   FROM  TAUTRIP B                                29721930
297220                   WHERE A.TRIP_ID       = B.TRIP_ID              29722032
297221                   AND A.OWNER_SCAC_ID = B.OWNER_SCAC_ID          29722132
297222                   AND A.VEH_NBR  = B.VEH_NBR)                    29722232
297223              AND A.LAST_UPD_TME    =                             29722329
297224                 (SELECT MIN(C.LAST_UPD_TME)                      29722429
297225                   FROM  TAUTRIP C                                29722530
297226                   WHERE A.TRIP_ID       = C.TRIP_ID              29722629
297227                   AND A.LAST_UPD_DTE    = C.LAST_UPD_DTE         29722732
297228                   AND A.OWNER_SCAC_ID = C.OWNER_SCAC_ID          29722832
297229                   AND A.VEH_NBR  = C.VEH_NBR)                    29722932
297233         END-EXEC                                                 29723324
297234*                                                                 29723424
297235         EVALUATE TRUE                                            29723524
297236             WHEN SQLCODE = ZERO                                  29723624
297237             WHEN SQLCODE = +100                                  29723724
297238             WHEN SQLCODE = -811                                  29723833
297239             WHEN SQLCODE = -904                                  29723933
297240             WHEN SQLCODE = -913                                  29724033
297241                  CONTINUE                                        29724133
297242             WHEN SQLWARN0 NOT = SPACE                            29724233
297243             WHEN SQLCODE NOT = ZERO                              29724333
297244                  MOVE '4408-SELECT-TR-CREATE-DT'                 29724433
297245                                   TO DP013-PARAGRAPH             29724533
297246                  MOVE 'SQL ERROR SELECTING TRL CRT DTE'          29724633
297247                                   TO DP013-MESSAGE-TEXT (1)      29724733
297248                  MOVE SQLCA       TO DP013-SQLCA                 29724833
297249                  MOVE 'TAUTRIP '  TO DP013-DB2-TABLE-NAME (1)    29724933
297250                  SET DP013-DB2-ABEND                             29725033
297251                      DP013-XCTL-DISPLAY-RESTART TO TRUE          29725133
297252                  PERFORM DP013-0000-PROCESS-ABEND                29725233
297253         END-EVALUATE                                             29725333
297254     END-PERFORM.                                                 29725433
297255*                                                                 29725533
297256     IF SQLCODE EQUAL + 0 OR -811                                 29725633
297257        MOVE AUTRIP-LAST-UPD-UID  TO ASC-TUID                     29725733
297258        MOVE AUTRIP-LAST-UPD-DTE  TO ASC-TDTE                     29725833
297259        MOVE AUTRIP-LAST-UPD-TME  TO ASC-TTME                     29725933
297260     END-IF.                                                      29726033
297261*                                                                 29726133
297262     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29726233
297263         MOVE '4408-SELECT-TR-CREATE-DT' TO DP013-PARAGRAPH       29726333
297264         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA29726433
297265-             'TE'                 TO DP013-MESSAGE-TEXT (1)      29726533
297266         MOVE SQLCA                TO DP013-SQLCA                 29726633
297267         MOVE 'TAUTRIP '           TO DP013-DB2-TABLE-NAME (1)    29726733
297268         SET DP013-DB2-ABEND                                      29726833
297269             DP013-XCTL-DISPLAY-RESTART                           29726933
297270                                   TO TRUE                        29727033
297271         PERFORM DP013-0000-PROCESS-ABEND                         29727133
297272     END-IF.                                                      29727233
297273                                                                  29727333
297274 EJECT                                                            29727433
297275*----------------------------------------------------------------*29727533
297280*    MOVE PO DETAILS TO SCREEN.                                  *29728001
297300*----------------------------------------------------------------*29730001
297400 4409-MOVE-PO-DTLS-TO-SCR.                                        29740024
297500                                                                  29750001
297600     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   29760001
297601     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.                     
297602     MOVE PV-DEPT-NBR-N             TO ADEPTO.                            
297800     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     29780001
297900     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    29790001
298000     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                   29800001
298100     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  29810001
298200     MOVE PLNSHP-FOB-CDE            TO AFOBO.                     29820001
298300     MOVE PLNSHP-POE-CDE            TO APOEO.                     29830001
298400     MOVE PV-PO-CART-CNT            TO ACTNSO.                    29840001
298420     MOVE ASC-KEY-VEH-NBR           TO ATRLRO.                    29842008
298430     MOVE ASC-KEY-OWNER-SCAC-ID     TO ASCACO.                    29843010
298440     MOVE ASC-KEY-OPER-UNT-ID       TO ADCO.                      29844008
298450     MOVE PV-TR-CART-CNT            TO ATCTNSO.                   29845005
298460     MOVE ASC-TUID                  TO ATRUIDO.                   29846023
298480     MOVE ASC-TDTE (9:2)            TO PV-DATE-DAY.               29848023
298490     MOVE ASC-TDTE (6:2)            TO PV-DATE-MONTH.             29849023
298491     MOVE '/'                       TO PV-DATE-SLASH.             29849122
298492     MOVE PV-DATE                   TO ATRDTEO.                   29849222
298494     MOVE ASC-TTME (1:2)            TO PV-TIME-HOUR.              29849423
298495     MOVE ASC-TTME (4:2)            TO PV-TIME-MIN.               29849523
298496     MOVE ':'                       TO PV-TIME-COLON.             29849622
298497     MOVE PV-TIME                   TO ATRTMEO.                   29849722
298500*                                                                 29850001
298600     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE               29860001
298700        MOVE SPACES                 TO ACANDTO                    29870001
298800     ELSE                                                         29880001
298900        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                            29890001
299000                                    TO PV-DATE-BREAK              29900001
299100        PERFORM 4320-FORMAT-DATE                                  29910001
299200        MOVE PV-DATE-DISPLAY        TO ACANDTO                    29920001
299300     END-IF.                                                      29930001
299400*                                                                 29940001
299500     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE               29950001
299600        MOVE SPACES                 TO AXCANDTO                   29960001
299700     ELSE                                                         29970001
299800        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK              29980001
299900        PERFORM 4320-FORMAT-DATE                                  29990001
300000        MOVE PV-DATE-DISPLAY        TO AXCANDTO                   30000001
300100     END-IF.                                                      30010001
300200*                                                                 30020001
300300     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE               30030001
300400        MOVE SPACES                 TO ASTXFDTO                   30040001
300500     ELSE                                                         30050001
300600        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK              30060001
300700        PERFORM 4320-FORMAT-DATE                                  30070001
300800        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                   30080001
300900     END-IF.                                                      30090001
301000*                                                                 30100001
301100     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE               30110001
301200        MOVE SPACES                 TO ALTXFDTO                   30120001
301300     ELSE                                                         30130001
301400        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK              30140001
301500        PERFORM 4320-FORMAT-DATE                                  30150001
301600        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                   30160001
301700     END-IF.                                                      30170001
301800*                                                                 30180001
301900     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE               30190001
302000        MOVE SPACES                 TO ADSHBEFO                   30200001
302100     ELSE                                                         30210001
302200        MOVE PLNSHP-DONT-SHIP-BEF-DTE                             30220001
302300                                    TO PV-DATE-BREAK              30230001
302400        PERFORM 4320-FORMAT-DATE                                  30240001
302500        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                   30250001
302600     END-IF.                                                      30260001
302700                                                                  30270001
303400 EJECT                                                            30340001
303500*----------------------------------------------------------------*30350001
303600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *30360001
303700*----------------------------------------------------------------*30370001
303800 4410-READ-TEMP-STORAGE.                                          30380001
303900                                                                  30390001
304000     EXEC CICS                                                    30400001
304100         READQ TS                                                 30410001
304200             QUEUE (ASC-LIST-QUEUE-NAME)                          30420001
304300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30430001
304400             ITEM  (PV-BLOCK-NUMBER)                              30440001
304500             RESP  (PV-CICS-RESP)                                 30450001
304600     END-EXEC.                                                    30460001
304700*                                                                 30470001
304800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       30480001
304900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     30490001
305000         CONTINUE                                                 30500001
305100     ELSE                                                         30510001
305200         SET DP013-CICS-ABEND     TO TRUE                         30520001
305300         SET DP013-NO-ROLLBACK    TO TRUE                         30530001
305400         MOVE '4410-READ-TEMP-STORAGE'                            30540001
305500                                  TO DP013-PARAGRAPH              30550001
305600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      30560001
305700                                  TO DP013-MESSAGE-TEXT(1)        30570001
305800         PERFORM DP013-0000-PROCESS-ABEND                         30580001
305900     END-IF.                                                      30590001
306000*                                                                 30600001
306100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             30610001
306200*                                                                 30620001
306300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         30630001
306400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               30640001
306500     END-IF.                                                      30650001
306600                                                                  30660001
306700 EJECT                                                            30670001
306800*----------------------------------------------------------------*30680001
306900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *30690001
307000*----------------------------------------------------------------*30700001
307100 4420-FORMAT-LIST-LINES.                                          30710001
307200                                                                  30720001
307300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      30730001
307400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                30740001
307500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        30750001
307600         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        30760001
307700         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        30770001
307800                                    MR-ACTION     (PV-SUB)        30780001
307900                                    MR-BL         (PV-SUB)        30790005
308000                                    MR-PRO        (PV-SUB)        30800005
308100                                    MR-STAT       (PV-SUB)        30810005
308200                                    MR-UID        (PV-SUB)        30820005
308300                                    MR-CRDT       (PV-SUB)        30830005
308400                                    MR-CRTM       (PV-SUB)        30840005
309000     ELSE                                                         30900001
309100         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      30910001
309200                                                   > SPACE        30920001
309300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 30930001
309400                                 TO MR-SELECTI (PV-SUB)           30940001
309500         ELSE                                                     30950001
309600             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      30960001
309700                                 TO MR-SELECTI (PV-SUB)           30970001
309800         END-IF                                                   30980001
309900                                                                  30990001
310000*---     IF  DP030-SET-CURSOR-TRAILER                             31000005
310100*---         IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)31010005
310200*---             > SPACE)                                         31020005
310300*---           OR (PV-SUB = 1))                                   31030005
310400*---            SET DP030-SET-CURSOR-APPL-1 TO TRUE               31040005
310500*---            MOVE -1          TO MR-SELECTL (PV-SUB)           31050005
310600*---         END-IF                                               31060005
310700*---     END-IF                                                   31070005
310800                                                                  31080001
310900         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           31090001
311000             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         31100001
311100                               TO MR-ACTION (PV-SUB)              31110001
311200             MOVE ASC-BL       (ASC-BLK-SUB ASC-ITEM-SUB)         31120005
311300                               TO MR-BL     (PV-SUB)              31130005
311400             MOVE ASC-PRO      (ASC-BLK-SUB ASC-ITEM-SUB)         31140005
311500                               TO MR-PRO    (PV-SUB)              31150005
311600             MOVE ASC-STAT     (ASC-BLK-SUB ASC-ITEM-SUB)         31160005
311700                               TO MR-STAT   (PV-SUB)              31170005
311800             MOVE ASC-UID      (ASC-BLK-SUB ASC-ITEM-SUB)         31180005
311900                               TO MR-UID    (PV-SUB)              31190005
312000             MOVE ASC-CRDT     (ASC-BLK-SUB ASC-ITEM-SUB)         31200038
312100                               TO MR-CRDT   (PV-SUB)              31210038
312200             MOVE ASC-CRTM     (ASC-BLK-SUB ASC-ITEM-SUB)         31220038
312300                               TO MR-CRTM   (PV-SUB)              31230038
313400         END-IF                                                   31340001
313500     END-IF.                                                      31350001
313600     SUBTRACT +1 FROM ASC-ITEM-SUB                                31360001
313700     IF  ASC-ITEM-SUB < + 1                                       31370001
313800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  31380001
313900         MOVE +1                 TO ASC-BLK-SUB                   31390001
314000     END-IF.                                                      31400001
314100                                                                  31410001
314200 EJECT                                                            31420001
314300*----------------------------------------------------------------*31430001
314400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *31440001
314500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *31450001
314600*  ISSUE A WARNING.                                              *31460001
314700*----------------------------------------------------------------*31470001
314800 4430-CHECK-FOR-BEGIN-AND-END.                                    31480001
314900                                                                  31490001
315000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       31500001
315100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     31510001
315200*----------- NO END-OF-RANGE SPECFIED ---                         31520001
315300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            31530001
315400             SET DP020-MSG-WARNING TO TRUE                        31540001
315500             PERFORM 4431-POSITION-AT-WARNING                     31550001
315600         END-IF                                                   31560001
315700     ELSE                                                         31570001
315800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     31580001
315900*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   31590001
316000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            31600001
316100             SET DP020-MSG-WARNING TO TRUE                        31610001
316200             PERFORM 4431-POSITION-AT-WARNING                     31620001
316300         END-IF                                                   31630001
316400     END-IF.                                                      31640001
316500                                                                  31650001
316600 EJECT                                                            31660001
316700*----------------------------------------------------------------*31670001
316800*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *31680001
316900*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *31690001
317000*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *31700001
317100*  POSITION THE CURSOR THERE.                                    *31710001
317200*----------------------------------------------------------------*31720001
317300 4431-POSITION-AT-WARNING.                                        31730001
317400                                                                  31740001
317500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 31750001
317600                    - PV-TOP-ITEM + 1.                            31760001
317700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      31770001
317800         CONTINUE                                                 31780001
317900     ELSE                                                         31790001
318000         SET DP030-SET-CURSOR-APPL-1                              31800001
318100                                   TO TRUE                        31810001
318200         MOVE -1                   TO MR-SELECTL (PV-SUB)         31820001
318300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         31830001
318400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         31840001
318500     END-IF.                                                      31850001
318600*                                                                 31860001
318700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   31870001
318800                    - PV-TOP-ITEM + 1.                            31880001
318900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      31890001
319000         CONTINUE                                                 31900001
319100     ELSE                                                         31910001
319200         SET DP030-SET-CURSOR-APPL-1                              31920001
319300                                   TO TRUE                        31930001
319400         MOVE -1                   TO MR-SELECTL (PV-SUB)         31940001
319500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         31950001
319600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         31960001
319700     END-IF.                                                      31970001
319800                                                                  31980001
319900 EJECT                                                            31990001
320000*----------------------------------------------------------------*32000001
320100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *32010001
320200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *32020001
320300* FOR THE SELECTED ITEMS QUEUE.                                  *32030001
320400*                                                                *32040001
320500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *32050001
320600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *32060001
320700* THE ARRAY IS FULL.                                             *32070001
320800*----------------------------------------------------------------*32080001
320900 5000-PREPARE-SEL-QUEUE.                                          32090001
321000                                                                  32100001
321100     MOVE +1                   TO  ASC-BLK-SUB.                   32110001
321200     PERFORM 5100-WRITE-TEMP-STORAGE.                             32120001
321300     ADD +1                    TO  ASC-BLK-SUB.                   32130001
321400     PERFORM 5100-WRITE-TEMP-STORAGE.                             32140001
321500     PERFORM 6010-DELETE-SEL-QUEUE.                               32150001
321600                                                                  32160001
321700     SET ASC-UPDATE-TSQ        TO  TRUE.                          32170001
321800                                                                  32180001
321900     SET TR108-IDX             TO  1.                             32190001
322000     MOVE ZERO                 TO PV-SEL-QUEUE-ITEM.              32200001
322100     INITIALIZE TR108-SELECTED-ITEM-ARRAY.                        32210001
322200                                                                  32220001
322300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           32230001
322400             VARYING PV-ITEM                                      32240001
322500             FROM 1 BY 1                                          32250001
322600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     32260001
322700                                                                  32270001
322800     IF  TR108-IDX > 1                                            32280001
322900         ADD +1        TO PV-SEL-QUEUE-ITEM                       32290001
323000         PERFORM 5205-WRITE-SEL-QUEUE                             32300001
323100     END-IF.                                                      32310001
323200*                                                                 32320001
323300 EJECT                                                            32330001
323400*----------------------------------------------------------------*32340001
323500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *32350001
323600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *32360001
323700*----------------------------------------------------------------*32370001
323800 5100-WRITE-TEMP-STORAGE.                                         32380001
323900                                                                  32390001
324000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     32400001
324100                                   TO PV-LIST-ITEM-NUMBER.        32410001
324200     COMPUTE PV-BLOCK-NUMBER =                                    32420001
324300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    32430001
324400                                                                  32440001
324500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             32450001
324600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             32460001
324700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      32470001
324800             PERFORM 5105-REWRITE-ASC-LISTQ                       32480001
324900         END-IF                                                   32490001
325000     ELSE                                                         32500001
325100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       32510001
325200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            32520001
325300         PERFORM 5110-WRITE-ASC-LISTQ                             32530001
325400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   32540001
325500     END-IF.                                                      32550001
325600                                                                  32560001
325700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             32570001
325800                                                                  32580001
325900 EJECT                                                            32590001
326000*----------------------------------------------------------------*32600001
326100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *32610001
326200*  SPECIFIC COMMAREA.                                            *32620001
326300*----------------------------------------------------------------*32630001
326400 5105-REWRITE-ASC-LISTQ.                                          32640001
326500                                                                  32650001
326600     EXEC CICS                                                    32660001
326700         WRITEQ TS                                                32670001
326800             QUEUE (ASC-LIST-QUEUE-NAME)                          32680001
326900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32690001
327000             ITEM  (PV-BLOCK-NUMBER)                              32700001
327100             REWRITE                                              32710001
327200             RESP  (PV-CICS-RESP)                                 32720001
327300     END-EXEC.                                                    32730001
327400                                                                  32740001
327500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           32750001
327600         CONTINUE                                                 32760001
327700     ELSE                                                         32770001
327800         SET DP013-CICS-ABEND            TO TRUE                  32780001
327900         SET DP013-NO-ROLLBACK           TO TRUE                  32790001
328000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       32800001
328100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     32810001
328200                                         TO DP013-MESSAGE-TEXT(1) 32820001
328300         PERFORM DP013-0000-PROCESS-ABEND                         32830001
328400     END-IF.                                                      32840001
328500                                                                  32850001
328600 EJECT                                                            32860001
328700*----------------------------------------------------------------*32870001
328800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *32880001
328900*  SPECIFIC COMMAREA.                                            *32890001
329000*----------------------------------------------------------------*32900001
329100 5110-WRITE-ASC-LISTQ.                                            32910001
329200                                                                  32920001
329300     EXEC CICS                                                    32930001
329400         WRITEQ TS                                                32940001
329500             QUEUE (ASC-LIST-QUEUE-NAME)                          32950001
329600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32960001
329700             ITEM  (PV-BLOCK-NUMBER)                              32970001
329800             RESP  (PV-CICS-RESP)                                 32980001
329900     END-EXEC.                                                    32990001
330000                                                                  33000001
330100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      33010001
330200         SET DP013-CICS-ABEND      TO TRUE                        33020001
330300         SET DP013-NO-ROLLBACK     TO TRUE                        33030001
330400         MOVE '5110-WRITE-ASC-LISTQ'                              33040001
330500                                   TO DP013-PARAGRAPH             33050001
330600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           33060001
330700                                   TO DP013-MESSAGE-TEXT(1)       33070001
330800         PERFORM DP013-0000-PROCESS-ABEND                         33080001
330900     END-IF.                                                      33090001
331000                                                                  33100001
331100 EJECT                                                            33110001
331200*----------------------------------------------------------------*33120001
331300* READ A LIST QUEUE RECORD AND MOVE THE KEY OF SELECTED OBJECTS  *33130001
331400* THE FIRST SELECTED ITEM IS PASSED TO RC012 RECORD.             *33140001
331500* THIS PARAGRAPH IS ONLY CALLED WHEN THERE IS ONE SELECTED       *33150001
331600* RECORD.                                                        *33160001
331700*----------------------------------------------------------------*33170001
331800 5200-FILL-SEL-QUEUE-RECORD.                                      33180001
331900                                                                  33190001
332000     PERFORM 6112-READ-LIST-QUEUE.                                33200001
332100                                                                  33210001
332200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       33220001
332300         PERFORM                                                  33230001
332400         VARYING LQW-IDX                                          33240001
332500         FROM 1 BY 1                                              33250001
332600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            33260001
332700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          33270001
332800                                                                  33280001
332900             IF  LQW-SELECT (LQW-IDX)                             33290001
333500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              33350001
333600                                   TO TR108-ITEM (TR108-IDX)      33360001
334300                 MOVE TR109-PO-NBR TO TR108-PO-NBR (TR108-IDX)    33430001
334400                 MOVE 'I'          TO TR108-ACTION-SW (TR108-IDX) 33440001
334500                 SET TR108-IDX UP BY 1                            33450001
334600                 IF  TR108-IDX > TR108-MAX-ITEMS                  33460001
334700                     ADD +1        TO PV-SEL-QUEUE-ITEM           33470001
334800                     PERFORM 5205-WRITE-SEL-QUEUE                 33480001
334900                     INITIALIZE TR108-SELECTED-ITEM-ARRAY         33490001
335000                     SET TR108-IDX TO  1                          33500001
335100                 END-IF                                           33510001
335300             END-IF                                               33530001
335400         END-PERFORM                                              33540001
335500     END-IF.                                                      33550001
335600                                                                  33560001
335700 EJECT                                                            33570001
335800*----------------------------------------------------------------*33580001
335900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *33590001
336000*----------------------------------------------------------------*33600001
336100 5205-WRITE-SEL-QUEUE.                                            33610001
336200                                                                  33620001
336300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33630001
336400                                   TO TR108-SELECTED-ITEMS.       33640001
336500                                                                  33650001
336600     EXEC CICS                                                    33660001
336700          WRITEQ TS                                               33670001
336800             QUEUE (ASC-SEL-QUEUE-NAME)                           33680001
336900             FROM  (TR108-PO-SEL-REC)                             33690001
337000             ITEM  (PV-SEL-QUEUE-ITEM)                            33700001
337100             RESP  (PV-CICS-RESP)                                 33710001
337200     END-EXEC.                                                    33720001
337300                                                                  33730001
337400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33740001
337500         CONTINUE                                                 33750001
337600     ELSE                                                         33760001
337700         SET DP013-CICS-ABEND      TO TRUE                        33770001
337800         SET DP013-NO-ROLLBACK     TO TRUE                        33780001
337900         MOVE '5205-WRITE-SEL-QUEUE'                              33790001
338000                                   TO DP013-PARAGRAPH             33800001
338100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          33810001
338200                                   TO DP013-MESSAGE-TEXT(1)       33820001
338300         PERFORM DP013-0000-PROCESS-ABEND                         33830001
338400     END-IF.                                                      33840001
338500                                                                  33850001
338600 EJECT                                                            33860001
338700*----------------------------------------------------------------*33870001
338800*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *33880001
338900*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *33890001
339000*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *33900001
339100*  THE USER.                                                     *33910001
339200*----------------------------------------------------------------*33920001
339300 6000-REFRESH-PANEL-FROM-TEMP.                                    33930001
339400                                                                  33940001
339500     IF  ASC-UPDATE-TSQ                                           33950001
339600         SET ASC-NO-TSQ-UPDATE TO TRUE                            33960001
339700         MOVE ZERO                 TO PV-SAVE-ITEM                33970001
339800                                      PV-SEL-QUEUE-ITEM           33980001
339900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        33990001
340000                                   TO PV-HOLD-SELECTED-ITEMS      34000001
340100         MOVE +1                   TO PV-ITEMS-PROCESSED          34010001
340200         PERFORM 6100-UPDATE-TSQ                                  34020001
340300             UNTIL PV-ITEMS-PROCESSED >                           34030001
340400                                     PV-HOLD-SELECTED-ITEMS       34040001
340500         PERFORM 6010-DELETE-SEL-QUEUE                            34050001
340600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         34060001
340700                    ASC-BLOCK-ENTRIES (2)                         34070001
340800     END-IF.                                                      34080001
340900                                                                  34090001
341000 EJECT                                                            34100001
341100*----------------------------------------------------------------*34110001
341200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *34120001
341300*----------------------------------------------------------------*34130001
341400 6010-DELETE-SEL-QUEUE.                                           34140001
341500                                                                  34150001
341600     EXEC CICS                                                    34160001
341700         DELETEQ TS                                               34170001
341800             QUEUE (ASC-SEL-QUEUE-NAME)                           34180001
341900             RESP  (PV-CICS-RESP)                                 34190001
342000     END-EXEC.                                                    34200001
342100                                                                  34210001
342200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      34220001
342300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         34230001
342400         CONTINUE                                                 34240001
342500     ELSE                                                         34250001
342600         SET DP013-CICS-ABEND TO TRUE                             34260001
342700         SET DP013-NO-ROLLBACK TO TRUE                            34270001
342800         MOVE '6010-DELETE-SEL-QUEUE'                             34280001
342900                        TO DP013-PARAGRAPH                        34290001
343000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         34300001
343100                        TO DP013-MESSAGE-TEXT (1)                 34310001
343200         PERFORM DP013-0000-PROCESS-ABEND                         34320001
343300     END-IF.                                                      34330001
343400                                                                  34340001
343500 EJECT                                                            34350001
343600*----------------------------------------------------------------*34360001
343700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *34370001
343800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *34380001
343900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *34390001
344000*    THE TEMP QUEUE.                                             *34400001
344100*----------------------------------------------------------------*34410001
344200 6100-UPDATE-TSQ.                                                 34420001
344300                                                                  34430001
344400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             34440001
344500     PERFORM 6105-READ-SEL-QUEUE.                                 34450001
344600     PERFORM                                                      34460001
344700         VARYING TR108-IDX                                        34470001
344800         FROM 1 BY 1                                              34480001
344900         UNTIL ((PV-ITEMS-PROCESSED >                             34490001
345000                              PV-HOLD-SELECTED-ITEMS)             34500001
345100         OR (TR108-IDX GREATER THAN TR108-MAX-ITEMS))             34510001
345200         IF  TR108-ACTION-SW (TR108-IDX) > SPACE                  34520001
345300             PERFORM 6110-PROCESS-ITEMS                           34530001
345400         END-IF                                                   34540001
345500         ADD +1                TO PV-ITEMS-PROCESSED              34550001
345600     END-PERFORM.                                                 34560001
345700     PERFORM 6111-WRITE-LIST-QUEUE.                               34570001
345800                                                                  34580001
345900 EJECT                                                            34590001
346000*----------------------------------------------------------------*34600001
346100*    READ THE LIST QUEUE RECORD.                                 *34610001
346200*----------------------------------------------------------------*34620001
346300 6105-READ-SEL-QUEUE.                                             34630001
346400                                                                  34640001
346500     EXEC CICS                                                    34650001
346600          READQ TS                                                34660001
346700             QUEUE (ASC-SEL-QUEUE-NAME)                           34670001
346800             INTO  (TR108-PO-SEL-REC)                             34680001
346900             ITEM  (PV-SEL-QUEUE-ITEM)                            34690001
347000             RESP  (PV-CICS-RESP)                                 34700001
347100     END-EXEC.                                                    34710001
347200                                                                  34720001
347300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34730001
347400         CONTINUE                                                 34740001
347500     ELSE                                                         34750001
347600         SET DP013-CICS-ABEND      TO  TRUE                       34760001
347700         SET DP013-NO-ROLLBACK     TO  TRUE                       34770001
347800         MOVE '6105-READ-SEL-QUEUE'                               34780001
347900                                   TO  DP013-PARAGRAPH            34790001
348000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           34800001
348100                                   TO  DP013-MESSAGE-TEXT(1)      34810001
348200         PERFORM DP013-0000-PROCESS-ABEND                         34820001
348300     END-IF.                                                      34830001
348400                                                                  34840001
348500 EJECT                                                            34850001
348600*----------------------------------------------------------------*34860001
348700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*34870001
348800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*34880001
348900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *34890001
349000*----------------------------------------------------------------*34900001
349100 6110-PROCESS-ITEMS.                                              34910001
349200                                                                  34920001
349300     COMPUTE PV-ITEM = 1 + ((TR108-ITEM (TR108-IDX) - 1)          34930001
349400                     / PC-ITEMS-PER-PANEL).                       34940001
349500                                                                  34950001
349600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           34960001
349700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          34970001
349800             PERFORM 6111-WRITE-LIST-QUEUE                        34980001
349900         END-IF                                                   34990001
350000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    35000001
350100                                                                  35010001
350200         PERFORM 6112-READ-LIST-QUEUE                             35020001
350300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               35030001
350400             CONTINUE                                             35040001
350500         END-IF                                                   35050001
350600     END-IF.                                                      35060001
350700                                                                  35070001
350800     COMPUTE PV-SUB = (TR108-ITEM (TR108-IDX)                     35080001
350900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              35090001
351000     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        35100001
351100     MOVE LQW-SELECTED-SW (PV-SUB)                                35110001
351200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  35120001
351300                                                                  35130001
351400*    IF TR108-INQ (TR108-IDX)                                     35140008
351500*       MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             35150008
351600*    END-IF.                                                      35160008
351700                                                                  35170001
351800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                35180001
351900                                                                  35190001
352000 EJECT                                                            35200001
352100*----------------------------------------------------------------*35210001
352200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *35220001
352300*----------------------------------------------------------------*35230001
352400 6111-WRITE-LIST-QUEUE.                                           35240001
352500                                                                  35250001
352600     EXEC CICS                                                    35260001
352700         WRITEQ TS                                                35270001
352800             QUEUE (ASC-LIST-QUEUE-NAME)                          35280001
352900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     35290001
353000             ITEM  (PV-SAVE-ITEM)                                 35300001
353100             REWRITE                                              35310001
353200             RESP  (PV-CICS-RESP)                                 35320001
353300     END-EXEC.                                                    35330001
353400                                                                  35340001
353500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          35350001
353600         CONTINUE                                                 35360001
353700     ELSE                                                         35370001
353800         SET DP013-CICS-ABEND  TO  TRUE                           35380001
353900         SET DP013-NO-ROLLBACK TO  TRUE                           35390001
354000         MOVE '6111-WRITE-LIST-QUEUE'                             35400001
354100                               TO  DP013-PARAGRAPH                35410001
354200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  35420001
354300                               TO  DP013-MESSAGE-TEXT(1)          35430001
354400         PERFORM DP013-0000-PROCESS-ABEND                         35440001
354500     END-IF.                                                      35450001
354600                                                                  35460001
354700 EJECT                                                            35470001
354800*----------------------------------------------------------------*35480001
354900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*35490001
355000*----------------------------------------------------------------*35500001
355100 6112-READ-LIST-QUEUE.                                            35510001
355200                                                                  35520001
355300     EXEC CICS                                                    35530001
355400         READQ TS                                                 35540001
355500             QUEUE (ASC-LIST-QUEUE-NAME)                          35550001
355600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     35560001
355700             ITEM  (PV-ITEM)                                      35570001
355800             RESP  (PV-CICS-RESP)                                 35580001
355900     END-EXEC.                                                    35590001
356000                                                                  35600001
356100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          35610001
356200         CONTINUE                                                 35620001
356300     ELSE                                                         35630001
356400         SET DP013-CICS-ABEND        TO TRUE                      35640001
356500         SET DP013-NO-ROLLBACK       TO TRUE                      35650001
356600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           35660001
356700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    35670001
356800                                     TO DP013-MESSAGE-TEXT(1)     35680001
356900         PERFORM DP013-0000-PROCESS-ABEND                         35690001
357000     END-IF.                                                      35700001
357100                                                                  35710001
357200 EJECT                                                            35720001
357300*----------------------------------------------------------------*35730001
357400*    READ THE LIST QUEUE RECORD.                                 *35740001
357500*----------------------------------------------------------------*35750001
357600 9100-READ-SEL-QUEUE.                                             35760001
357700                                                                  35770001
357800     EXEC CICS                                                    35780001
357900          READQ TS                                                35790001
358000             QUEUE (TR109-SEL-QUEUE-NAME)                         35800001
358100             INTO  (TR108-PO-SEL-REC)                             35810001
358200             ITEM  (ASC-SEL-ITEM)                                 35820001
358300             RESP  (PV-CICS-RESP)                                 35830001
358400     END-EXEC.                                                    35840001
358500                                                                  35850001
358600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          35860001
358700         CONTINUE                                                 35870001
358800     ELSE                                                         35880001
358900         SET DP013-CICS-ABEND      TO  TRUE                       35890001
359000         SET DP013-NO-ROLLBACK     TO  TRUE                       35900001
359100         MOVE '9100-READ-SEL-QUEUE'                               35910001
359200                                   TO  DP013-PARAGRAPH            35920001
359300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           35930001
359400                                   TO  DP013-MESSAGE-TEXT(1)      35940001
359500         PERFORM DP013-0000-PROCESS-ABEND                         35950001
359600     END-IF.                                                      35960001
359700                                                                  35970001
359800 EJECT                                                            35980001
359900*----------------------------------------------------------------*35990001
360000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *36000001
360100*  SPECIFIC COMMAREA.                                            *36010001
360200*----------------------------------------------------------------*36020001
360300 9200-REWRITE-SEL-QUEUE.                                          36030001
360400                                                                  36040001
360500     EXEC CICS                                                    36050001
360600         WRITEQ TS                                                36060001
360700             QUEUE (TR109-SEL-QUEUE-NAME)                         36070001
360800             FROM  (TR108-PO-SEL-REC)                             36080001
360900             ITEM  (ASC-SEL-ITEM)                                 36090001
361000             REWRITE                                              36100001
361100             RESP  (PV-CICS-RESP)                                 36110001
361200     END-EXEC.                                                    36120001
361300                                                                  36130001
361400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           36140001
361500         CONTINUE                                                 36150001
361600     ELSE                                                         36160001
361700         SET DP013-CICS-ABEND            TO TRUE                  36170001
361800         SET DP013-NO-ROLLBACK           TO TRUE                  36180001
361900         MOVE '9200-REWRITE-SEL-QUEUE'   TO DP013-PARAGRAPH       36190001
362000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     36200001
362100                                         TO DP013-MESSAGE-TEXT(1) 36210001
362200         PERFORM DP013-0000-PROCESS-ABEND                         36220001
362300     END-IF.                                                      36230001
362400                                                                  36240001
362500 EJECT                                                            36250001
362600*----------------------------------------------------------------*36260001
362700*    ABEND PROCESSOR MODULE                                      *36270001
362800*----------------------------------------------------------------*36280001
362900                                                                  36290001
363000     COPY DPPD013.                                                36300001
