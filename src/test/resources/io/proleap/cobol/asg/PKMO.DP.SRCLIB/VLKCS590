000100******************************************************************09/01/94
000200 IDENTIFICATION DIVISION.                                         VLKCS590
000300******************************************************************   LV042
000400                                                                     CL**3
000500 PROGRAM-ID.             VLKCS590.                                   CL**3
000600 AUTHOR.                 MARY SARDINA.                               CL**3
000700 INSTALLATION.           KOHLS.                                      CL**3
000800 DATE-WRITTEN            NOVEMBER  1996.                             CL**3
000900 DATE-COMPILED.                                                      CL**3
001700                                                                     CL**3
002400*---------------------------------------------------------------* VLKCS590
002500*    V590 - VENDOR/DEPARTMENT LIST PROGRAM                      * VLKCS590
002600*                                                               * VLKCS590
002700*    THIS PROGRAM GENERATES A LIST OF TICKET TYPE CODES         * VLKCS590
002800*    AND THEIR DESCRIPTIONS.                                    * VLKCS590
002900*                                                               * VLKCS590
003000*---------------------------------------------------------------* VLKCS590
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
003100 ENVIRONMENT DIVISION.                                            VLKCS590
003200 DATA DIVISION.                                                   VLKCS590
003300                                                                  VLKCS590
003400 WORKING-STORAGE SECTION.                                         VLKCS590
003500                                                                  VLKCS590
003600 01  DK-DB2-KEY.                                                  VLKCS590
003700     05  DK-STATUS-CODE                 PIC  X(01)  VALUE SPACES. VLKCS590
003800     05  DK-VEND-NAME                   PIC  X(30)  VALUE SPACE.  VLKCS590
003900     05  DK-VEND-NAME-BYTE              REDEFINES DK-VEND-NAME    VLKCS590
004000                                        OCCURS 30 TIMES           VLKCS590
004100                                        PIC  X(01).               VLKCS590
004200     05  DK-PRIM-NAME                   PIC  X(30).               VLKCS590
004300                                                                  VLKCS590
004400 01  PC-PROGRAM-CONSTANTS.                                        VLKCS590
004500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         VLKCS590
004600                                                    'VL590A  '.   VLKCS590
004700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         VLKCS590
004800                                                    'VLKM590 '.   VLKCS590
004900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         VLKCS590
005000                                                    'VLKCS590'.   VLKCS590
005100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      VLKCS590
005200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      VLKCS590
005300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    VLKCS590
005400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     VLKCS590
005500                                                    COMP SYNC.    VLKCS590
005600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      VLKCS590
005700                                                    COMP SYNC.    VLKCS590
005800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         VLKCS590
005900                                                    +1000000      VLKCS590
006000                                                    COMP-3.       VLKCS590
006100     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      VLKCS590
006200                                                    COMP SYNC.    VLKCS590
006300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       VLKCS590
006400                                                    COMP-3.       VLKCS590
006500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  VLKCS590
006600     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  VLKCS590
006700     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  VLKCS590
006800     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  VLKCS590
006900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    VLKCS590
007000     05  PC-TYPE-CODES.                                           VLKCS590
007100         10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   VLKCS590
007200         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   VLKCS590
007300         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   VLKCS590
007400         10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   VLKCS590
007500                                                                  VLKCS590
007600     05  PC-TSYMSG-NUMBERS.                                       VLKCS590
007700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  VLKCS590
007800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  VLKCS590
007900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  VLKCS590
008000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  VLKCS590
008100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  VLKCS590
008200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  VLKCS590
008300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  VLKCS590
008400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  VLKCS590
008500         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  VLKCS590
008600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  VLKCS590
008700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  VLKCS590
008800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  VLKCS590
008900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  VLKCS590
009000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  VLKCS590
009100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  VLKCS590
009200                                                                  VLKCS590
009300 01  PS-PROGRAM-SWITCHES.                                         VLKCS590
009400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    VLKCS590
009500         88  PS-NO-ERROR                            VALUE 'Y'.    VLKCS590
009600         88  PS-ERROR                               VALUE 'N'.    VLKCS590
009700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    VLKCS590
009800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    VLKCS590
009900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    VLKCS590
010000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    VLKCS590
010100         88  PS-DONE                                VALUE 'Y'.    VLKCS590
010200         88  PS-NOT-DONE                            VALUE 'N'.    VLKCS590
010300                                                                  VLKCS590
010400 01  PL-PROGRAM-LITERALS.                                         VLKCS590
010500     05  PL-PRIMARY                     PIC  X(10)  VALUE         VLKCS590
010600                                                    'PRIMARY   '. VLKCS590
010700     05  PL-ALIAS                       PIC  X(10)  VALUE         VLKCS590
010800                                                    'ALIAS     '. VLKCS590
010900     05  PL-LABEL                       PIC  X(10)  VALUE         VLKCS590
011000                                                    'LABEL     '. VLKCS590
011100     05  PL-SHORTNAME                   PIC  X(10)  VALUE         VLKCS590
011200                                                    'SHORT NAME'. VLKCS590
011300                                                                  VLKCS590
011400 01  PV-PROGRAM-VARIABLES.                                        VLKCS590
011500     05  PV-SUB                         PIC S9(04)  VALUE +0      VLKCS590
011600                                                    COMP SYNC.    VLKCS590
011700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      VLKCS590
011800                                                    COMP SYNC.    VLKCS590
011900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      VLKCS590
012000                                                    COMP-3.       VLKCS590
012100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      VLKCS590
012200                                                    COMP-3.       VLKCS590
012300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      VLKCS590
012400                                                    COMP-3.       VLKCS590
012500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      VLKCS590
012600                                                    COMP-3.       VLKCS590
012700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      VLKCS590
012800                                                    COMP-3.       VLKCS590
012900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      VLKCS590
013000                                                    COMP-3.       VLKCS590
013100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      VLKCS590
013200                                                    COMP-3.       VLKCS590
013300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      VLKCS590
013400                                                    COMP SYNC.    VLKCS590
013500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      VLKCS590
013600                                                    COMP SYNC.    VLKCS590
013700     05  PV-ITEM                        PIC S9(04)  VALUE +0      VLKCS590
013800                                                    COMP SYNC.    VLKCS590
013900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      VLKCS590
014000                                                    COMP SYNC.    VLKCS590
014100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      VLKCS590
014200                                                    COMP SYNC.    VLKCS590
014300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      VLKCS590
014400                                                    COMP SYNC.    VLKCS590
014500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      VLKCS590
014600                                                    COMP SYNC.    VLKCS590
014700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      VLKCS590
014800                                                    COMP SYNC.    VLKCS590
014900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VLKCS590
015000                                                    COMP SYNC.    VLKCS590
015100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VLKCS590
015200                                                    COMP SYNC.    VLKCS590
015300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      VLKCS590
015400                                                    COMP SYNC.    VLKCS590
015500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      VLKCS590
015600                                                    COMP SYNC.    VLKCS590
015700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      VLKCS590
015800                                                    COMP SYNC.    VLKCS590
015900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      VLKCS590
016000                                                    COMP SYNC.    VLKCS590
016100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      VLKCS590
016200                                                    COMP SYNC.    VLKCS590
016300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      VLKCS590
016400                                                    COMP SYNC.    VLKCS590
016500******************************************************************VLKCS590
016600**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **VLKCS590
016700**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **VLKCS590
016800**  APPLICATION-SPECIFIC COMMAREA.                              **VLKCS590
016900******************************************************************VLKCS590
017000 01  LQW-LIST-QUEUE-WORK-AREA.                                    VLKCS590
017100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  VLKCS590
017200     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           VLKCS590
017300                                        INDEXED BY LQW-IDX.       VLKCS590
017400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       VLKCS590
017500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               VLKCS590
017600         10  LQW-SELECTED-SW            PIC  X(01).               VLKCS590
017700             88  LQW-SELECT                         VALUE 'S'.    VLKCS590
017800             88  LQW-DESELECT                       VALUE ' '.    VLKCS590
017900         10  LQW-ACTION                 PIC  X(03).               VLKCS590
018000         10  LQW-CODE-TYPE              PIC  X(06).                  CL**2
018100         10  LQW-CODE-DESC              PIC  X(50).                  CL**2
018200                                                                  VLKCS590
018300*---------------------------------------------------------------* VLKCS590
018400*  RECORD LAYOUT FOR THE PRETICKET SELECTION TEMP STORAGE QUEUE.* VLKCS590
018500*---------------------------------------------------------------* VLKCS590
018600     COPY VLWS006.                                                   CL*13
018700                                                                  VLKCS590
018800*---------------------------------------------------------------* VLKCS590
018900*    MAP LAYOUT                                                 * VLKCS590
019000*---------------------------------------------------------------* VLKCS590
019100     COPY VLKM590.                                                VLKCS590
019200                                                                  VLKCS590
019300 01  MR-OCCURS-LAYOUT                   REDEFINES  VL590AO.       VLKCS590
019400     05  FILLER                         PIC X(12).                VLKCS590
019500     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          VLKCS590
019600         10  MR-SELECTL                 PIC S9(04) COMP.          VLKCS590
019700         10  MR-SELECTA                 PIC  X(01).               VLKCS590
019800         10  MR-SELECTC                 PIC  X(01).               VLKCS590
019900         10  MR-SELECTH                 PIC  X(01).               VLKCS590
020000         10  MR-SELECTI                 PIC  X(01).               VLKCS590
020100                                                                  VLKCS590
020200         10  MR-ACTIONL                 PIC S9(04) COMP.          VLKCS590
020300         10  MR-ACTIONA                 PIC  X(01).               VLKCS590
020400         10  MR-ACTIONC                 PIC  X(01).               VLKCS590
020500         10  MR-ACTIONH                 PIC  X(01).               VLKCS590
020600         10  MR-ACTION                  PIC  X(03).               VLKCS590
020700                                                                  VLKCS590
020800         10  MR-CODE-TYPEL              PIC S9(04) COMP.             CL**2
020900         10  MR-CODE-TYPEA              PIC  X(01).                  CL**2
021000         10  MR-CODE-TYPEC              PIC  X(01).                  CL**2
021100         10  MR-CODE-TYPEH              PIC  X(01).                  CL**2
021200         10  MR-CODE-TYPE               PIC  X(06).                  CL**2
021300                                                                     CL**2
021400         10  MR-CODE-DESCL              PIC S9(04) COMP.          VLKCS590
021500         10  MR-CODE-DESCA              PIC  X(01).               VLKCS590
021600         10  MR-CODE-DESCC              PIC  X(01).               VLKCS590
021700         10  MR-CODE-DESCH              PIC  X(01).               VLKCS590
021800         10  MR-CODE-DESC               PIC  X(50).                  CL**2
021900                                                                  VLKCS590
022000                                                                  VLKCS590
022100*---------------------------------------------------------------* VLKCS590
022200*    ATTRIBUTE SETTINGS COPYBOOK.                               * VLKCS590
022300*---------------------------------------------------------------* VLKCS590
022400     COPY DPWS015.                                                VLKCS590
022500                                                                  VLKCS590
022600*---------------------------------------------------------------* VLKCS590
022700*    FUNCTION KEYS COPYBOOK.                                    * VLKCS590
022800*---------------------------------------------------------------* VLKCS590
022900     COPY DPWS016.                                                VLKCS590
023000                                                                  VLKCS590
023100*---------------------------------------------------------------* VLKCS590
023200*    NUMERIC EDIT LAYOUT.                                       * VLKCS590
023300*---------------------------------------------------------------* VLKCS590
023400     COPY DPWS010I.                                               VLKCS590
023500                                                                  VLKCS590
023600*---------------------------------------------------------------* VLKCS590
023700*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * VLKCS590
023800*---------------------------------------------------------------* VLKCS590
023900     COPY DPWS030.                                                VLKCS590
CICS       COPY DPWS930.                                                VLKCS590
024000                                                                  VLKCS590
024100*---------------------------------------------------------------* VLKCS590
024200*    STANDARD COMMAREA.                                         * VLKCS590
024300*---------------------------------------------------------------* VLKCS590
024400     COPY DPWS020.                                                VLKCS590
024500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                VLKCS590
024600*---------------------------------------------------------------* VLKCS590
024700* INTER-APPLICATION COMMAREA.                                   * VLKCS590
024800*   VLWS005 - INPUT FROM PO PRETICKET REQUEST                   * VLKCS590
024900**  VNWS002 - OUTPUT TO LOCAL-GO-FUNCTION                               84
025000*---------------------------------------------------------------* VLKCS590
025100         10  INTER-APPL-COMM-AREA       PIC X(200).               VLKCS590
025200     COPY VLWS005.                                                   CL*13
025300**   COPY VNWS002.                                                VLKCS590
025400*---------------------------------------------------------------* VLKCS590
025500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * VLKCS590
025600*---------------------------------------------------------------* VLKCS590
025700         10  ASC-SPECIFIC-COMMAREA.                               VLKCS590
025800             15  ASC-LIST-KEYS.                                   VLKCS590
025900                 20  ASC-KEY-VEND-NAME               PIC  X(30).  VLKCS590
026000                 20  ASC-KEY-VEND-TYPE               PIC  X(01).     CL**3
026100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                VLKCS590
026200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  VLKCS590
026300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   VLKCS590
026400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   VLKCS590
026500                                                                  VLKCS590
026600                 20  ASC-ITEM-ARRAY.                              VLKCS590
026700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        VLKCS590
026800                         30  ASC-LIST-ITEM-NUMBER                 VLKCS590
026900                                                     PIC S9(09)   VLKCS590
027000                                                     COMP-3.      VLKCS590
027100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  VLKCS590
027200                             88  ASC-VALID-SELECT    VALUE ' '    VLKCS590
027300                                                           'S'    VLKCS590
027400                                                           'B'    VLKCS590
027500                                                           'E'.   VLKCS590
027600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   VLKCS590
027700                             88  ASC-TEMP-SELECT     VALUE 'S'.   VLKCS590
027800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   VLKCS590
027900                             88  ASC-TEMP-END        VALUE 'E'.   VLKCS590
028000                         30  ASC-SELECTED-SW         PIC  X(01).  VLKCS590
028100                             88  ASC-NO-SELECT       VALUE ' '.   VLKCS590
028200                             88  ASC-SELECT          VALUE 'S'.   VLKCS590
028300                             88  ASC-BEGIN           VALUE 'B'.   VLKCS590
028400                             88  ASC-END             VALUE 'E'.   VLKCS590
028500                         30  ASC-ACTION              PIC  X(03).  VLKCS590
028600                         30  ASC-CODE-TYPE           PIC  X(06).     CL**2
028700                         30  ASC-CODE-DESC           PIC  X(50).     CL**2
028800                                                                        84
028900             15  ASC-BLK-SUB                         PIC S9(04)   VLKCS590
029000                                                          COMP    VLKCS590
029100                                                          SYNC.   VLKCS590
029200             15  ASC-ITEM-SUB                        PIC S9(04)   VLKCS590
029300                                                          COMP    VLKCS590
029400                                                          SYNC.   VLKCS590
029500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   VLKCS590
029600                                                          COMP-3. VLKCS590
029700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   VLKCS590
029800                                                          COMP-3. VLKCS590
029900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   VLKCS590
030000                                                          COMP-3. VLKCS590
030100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   VLKCS590
030200                                                          COMP-3. VLKCS590
030300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   VLKCS590
030400                                                          COMP-3. VLKCS590
030500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   VLKCS590
030600                                                          COMP    VLKCS590
030700                                                          SYNC.   VLKCS590
030800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   VLKCS590
030900                                                          COMP-3. VLKCS590
031000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   VLKCS590
031100                                                          COMP-3. VLKCS590
031200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  VLKCS590
031300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   VLKCS590
031400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   VLKCS590
031500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  VLKCS590
031600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   VLKCS590
031700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   VLKCS590
031800             15  ASC-LIST-QUEUE-NAME.                             VLKCS590
031900                 20  ASC-LIST-TERM-ID                PIC  X(04).  VLKCS590
032000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   VLKCS590
032100                                                          COMP-3. VLKCS590
032200                 20  ASC-LIST-SEQ                    PIC  9(01).  VLKCS590
032300             15  ASC-SEL-QUEUE-NAME.                              VLKCS590
032400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  VLKCS590
032500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   VLKCS590
032600                                                          COMP-3. VLKCS590
032700                 20  ASC-SEL-SEQ                     PIC  9(01).  VLKCS590
032800                                                                  VLKCS590
032900             15  ASC-START-ITEM-REQUEST.                          VLKCS590
033000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  VLKCS590
033100             15  ASC-HOLD-INTER-APPL                 PIC X(200).          
033200                                                                  VLKCS590
033300*---------------------------------------------------------------* VLKCS590
033400*    ABEND PROCESSING COPYBOOK.                                 * VLKCS590
033500*---------------------------------------------------------------* VLKCS590
033600     COPY DPWS013.                                                VLKCS590
033700                                                                  VLKCS590
033800 EJECT                                                                    
034500                                                                  VLKCS590
034600*---------------------------------------------------------------* VLKCS590
034700*    DB2 AREA TICKET FORMAT TABLE                               * VLKCS590
034800*---------------------------------------------------------------* VLKCS590
034900     EXEC SQL                                                     VLKCS590
035000          INCLUDE TTKTFMT                                         VLKCS590
035100     END-EXEC.                                                    VLKCS590
035110                                                                  VLKCS590
035111                                                                  VLKCS590
035112*---------------------------------------------------------------* VLKCS590
035113*    DB2 AREA FOR VENDOR STYLE CHARACTERISTIC VALUE TABLE       * VLKCS590
035114*---------------------------------------------------------------* VLKCS590
035115     EXEC SQL                                                     VLKCS590
035116          INCLUDE TVSCHVL                                         VLKCS590
035117     END-EXEC.                                                    VLKCS590
035118                                                                  VLKCS590
035120*---------------------------------------------------------------* VLKCS590
035130*    DB2 AREA FOR COMMUNICATIONS                                * VLKCS590
035140*---------------------------------------------------------------* VLKCS590
035150     EXEC SQL                                                     VLKCS590
035160          INCLUDE SQLCA                                           VLKCS590
035170     END-EXEC.                                                    VLKCS590
035200                                                                  VLKCS590
035201***************************************************************** VLKRP007
035202*    PRETICKET TICKET TYPE CURSOR                                 VLKRP007
035203***************************************************************** VLKRP007
035204     EXEC SQL                                                     VLKRP007
035205          DECLARE  TICKET-TYPE-CURSOR CURSOR FOR                        *2
035206              SELECT DISTINCT                                             
035207                A.TKT_FMT_ID                                              
035208              , A.TKT_FMT_DESC                                            
035209          FROM                                                            
035210               TTKTFMT A                                                  
035211             , TVSCHVL B                                                  
035212          WHERE                                                           
035215                A.TYP_CDE = 'I'                                           
035216            AND B.CHARTC_VAL_DESC = A.TKT_FMT_DESC                        
035217            AND B.CHARTC_CDE = 2                                          
035218            AND B.STAT_CDE   = 'A'                                        
035219           WITH UR                                                        
035220     END-EXEC.                                                    VLKRP007
036300                                                                  VLKCS590
036400 LINKAGE SECTION.                                                 VLKCS590
036500                                                                  VLKCS590
036600 01  DFHCOMMAREA.                                                 VLKCS590
036700     05  FILLER                         OCCURS  1 TO 4072 TIMES   VLKCS590
036800                                        DEPENDING ON EIBCALEN.    VLKCS590
036900         10  FILLER                     PIC X.                    VLKCS590
037000                                                                  VLKCS590
037100 PROCEDURE DIVISION.                                              VLKCS590
037200                                                                     CL**6
037300     INITIALIZE DP030-CICS-API-FIELDS.                            VLKCS590
037400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       VLKCS590
037500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          VLKCS590
037600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         VLKCS590
037700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       VLKCS590
037800     MOVE LENGTH OF VL590AI        TO DP030-MAP-LENGTH (1).       VLKCS590
037900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     VLKCS590
038000                                                                     CL**6
038100     PERFORM 0001-CALL-CICS-ARCH-API.                             VLKCS590
038200                                                                  VLKCS590
038300     PERFORM 1000-CONTROL-PROCESSING                              VLKCS590
038400                                                                  VLKCS590
038500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     VLKCS590
038600                                                                     CL**6
038700     PERFORM 0001-CALL-CICS-ARCH-API.                             VLKCS590
038800                                                                  VLKCS590
038900******************************************************************VLKCS590
039000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **VLKCS590
039100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **VLKCS590
039200******************************************************************VLKCS590
039300 0001-CALL-CICS-ARCH-API.                                         VLKCS590
039400                                                                  VLKCS590
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
039600                                    DFHCOMMAREA                           
039700                                    DP030-CICS-API-FIELDS                 
039800                                    DP020-STANDARD-COMMAREA               
039900                                    VL590AI.                              
040000                                                                  VLKCS590
040100     IF DP030-RC-CALL-SUCCESSFUL                                     CL**6
040200         CONTINUE                                                 VLKCS590
040300     ELSE                                                         VLKCS590
040400         SET DP013-NO-ROLLBACK                                    VLKCS590
040500             DP013-XCTL-DISPLAY-RESTART                           VLKCS590
040600             DP013-CICS-ABEND      TO TRUE                        VLKCS590
040700         MOVE '0001-CALL-CICS-ARCH-API'                           VLKCS590
040800                                   TO DP013-PARAGRAPH             VLKCS590
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
041100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      VLKCS590
041200         PERFORM DP013-0000-PROCESS-ABEND.                        VLKCS590
041300                                                                  VLKCS590
041400*----------------------------------------------------------------*VLKCS590
041500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *VLKCS590
041600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *VLKCS590
041700*----------------------------------------------------------------*VLKCS590
041800 1000-CONTROL-PROCESSING.                                         VLKCS590
041900                                                                  VLKCS590
042000     EVALUATE TRUE                                                VLKCS590
042100         WHEN DP020-NEXT-ACT-INITIAL                              VLKCS590
042200             INITIALIZE ASC-SPECIFIC-COMMAREA                     VLKCS590
042300             MOVE EIBTRMID              TO ASC-LIST-TERM-ID          CL**6
042400                                           ASC-SEL-TERM-ID           CL**6
042500             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER      CL**6
042600                                           ASC-SEL-TASK-NUMBER       CL**6
042700             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ              CL**6
042800             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ               CL**6
042900                                                                     CL**6
043000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 VLKCS590
043100                                                                     CL**6
043200             PERFORM 4000-BUILD-INITIAL-PANEL                     VLKCS590
043300                                                                  VLKCS590
043400         WHEN DP020-NEXT-ACT-READ-MAP                             VLKCS590
043500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM            CL**6
043600                                                                     CL**6
043700             PERFORM 2000-PROCESS-PANEL                           VLKCS590
043800                                                                  VLKCS590
043900         WHEN DP020-NEXT-ACT-RETURN                                       
044000            IF (VL005-DEL OR                                              
044100                 VL005-ADD)                                               
044200                MOVE ASC-ITEM-AT-TOP-OF-PANEL                       RCK000
044300                                     TO PV-TOP-ITEM                 RCK000
044400                MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL            
044500                PERFORM 2050-DELETE-LIST-QUEUE                      RCK000
044600                PERFORM 4000-BUILD-INITIAL-PANEL                    RCK000
044700            ELSE                                                          
044800                MOVE VL005-NUMBER-OF-TS-ITEMS                             
044900                                   TO PV-HOLD-SELECTED-ITEMS      RCK00050
045000                MOVE ASC-HOLD-INTER-APPL                                  
045100                                 TO INTER-APPL-COMM-AREA                  
045200                PERFORM 2050-DELETE-LIST-QUEUE                      RCK000
045300                PERFORM 4000-BUILD-INITIAL-PANEL                    RCK000
045400                PERFORM 3200-RESET-ATTRIBUTES                       RCK000
045500                MOVE ASC-ITEM-AT-TOP-OF-PANEL                       RCK000
045600                                     TO PV-TOP-ITEM                 RCK000
045700                MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL            
045800                PERFORM 6000-REFRESH-PANEL-FROM-TEMP                RCK000
045900                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                RCK000
046000          END-IF                                                          
047800                                                                  VLKCS590
047900         WHEN OTHER                                               VLKCS590
048000             SET DP013-LOGIC-ABEND                                   CL**6
048100                 DP013-NO-ROLLBACK TO TRUE                           CL**6
048200             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH       CL**6
048300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    VLKCS590
048400                                          TO DP013-MESSAGE-TEXT(1)   CL**6
048500             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS590
048600     END-EVALUATE.                                                VLKCS590
048700                                                                  VLKCS590
048800*----------------------------------------------------------------*VLKCS590
048900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *VLKCS590
049000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *VLKCS590
049100*----------------------------------------------------------------*VLKCS590
049200 1100-PROCESS-INTER-APPL-COMM.                                    VLKCS590
049300                                                                  VLKCS590
049400     SET PS-COMMAREA-VALID TO TRUE.                                  CL**3
049500     MOVE SPACE TO ASC-START-ITEM-REQUEST.                           CL**3
049600                                                                     CL**3
049700     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT              CL**3
049800         CONTINUE                                                         
050300     ELSE                                                         VLKCS590
050400         CONTINUE                                                         
050900     END-IF.                                                         CL**3
051000                                                                  VLKCS590
051100*----------------------------------------------------------------*VLKCS590
051200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *VLKCS590
051300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *VLKCS590
051400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *VLKCS590
051500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *VLKCS590
051600* FUNCTION KEYS CAN GET THIS FAR.                                *VLKCS590
051700*----------------------------------------------------------------*VLKCS590
051800 2000-PROCESS-PANEL.                                              VLKCS590
051900                                                                  VLKCS590
052000     EVALUATE TRUE                                                VLKCS590
052100         WHEN DP020-SRC-AID = DP016-CLEAR                         VLKCS590
052200              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                  CL**6
052300                                                                     CL**6
052400              PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
052500                                                                     CL**6
052600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
052700                                                                  VLKCS590
052800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    VLKCS590
052900              PERFORM 2050-DELETE-LIST-QUEUE                         CL**6
053000                                                                     CL**6
053100              PERFORM 4000-BUILD-INITIAL-PANEL                       CL**6
053200                                                                  VLKCS590
053300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    VLKCS590
053400              PERFORM 2140-DESELECT-ALL-ITEMS                        CL**6
053500                                                                     CL**6
053600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
053700                                                                  VLKCS590
053800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  VLKCS590
053900              PERFORM 2150-SELECT-ALL-ITEMS                          CL**6
054000                                                                     CL**6
054100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
054200                                                                  VLKCS590
054300         WHEN OTHER                                               VLKCS590
054400              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                   CL**6
054500                                                                     CL**6
054600              PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
054700                                                                     CL**6
054800              IF PS-NO-ERROR                                         CL**6
054900                  SET DP030-CONTINUE-GO TO TRUE                      CL**6
055000                                                                     CL**6
055100                  PERFORM 2100-CHECK-FUNCTION-KEY                    CL**6
055200              ELSE                                                   CL**6
055300                  SET DP030-OVERRIDE-GO TO TRUE                      CL**6
055400              END-IF                                                 CL**6
055500     END-EVALUATE.                                                VLKCS590
055600                                                                  VLKCS590
055700*----------------------------------------------------------------*VLKCS590
055800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *VLKCS590
055900*----------------------------------------------------------------*VLKCS590
056000 2050-DELETE-LIST-QUEUE.                                          VLKCS590
056100                                                                  VLKCS590
056200     EXEC CICS                                                    VLKCS590
056300         DELETEQ TS                                               VLKCS590
056400             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS590
056500             RESP  (PV-CICS-RESP)                                 VLKCS590
056600     END-EXEC.                                                    VLKCS590
056700                                                                  VLKCS590
056800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       VLKCS590
056900        (PV-CICS-RESP = DFHRESP(QIDERR))                          VLKCS590
057000         CONTINUE                                                 VLKCS590
057100     ELSE                                                         VLKCS590
057200         SET DP013-CICS-ABEND                                        CL**6
057300             DP013-NO-ROLLBACK TO TRUE                               CL**6
057400                                                                  VLKCS590
057500         MOVE '2050-DELETE-LIST-QUEUE'                            VLKCS590
057600                                   TO DP013-PARAGRAPH             VLKCS590
057700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    VLKCS590
057800                                   TO DP013-MESSAGE-TEXT (1)      VLKCS590
057900         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
058000     END-IF.                                                      VLKCS590
058100                                                                  VLKCS590
058200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  VLKCS590
058300                                                                  VLKCS590
058400*----------------------------------------------------------------*VLKCS590
058500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*VLKCS590
058600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *VLKCS590
058700* CICS ARCHITECTURE API.                                         *VLKCS590
058800*----------------------------------------------------------------*VLKCS590
058900 2100-CHECK-FUNCTION-KEY.                                         VLKCS590
059000                                                                  VLKCS590
059100     EVALUATE TRUE                                                VLKCS590
059200* REQUEST ADD KEY WAS PRESSED                                             
059300*        WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                       
059400*             MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS                   
059500*             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
059600*                 INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
059700*                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                     *6
059800*                               TO VL005-NUMBER-OF-SELECTED-ITEMS VLKCS590
059900*                 PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
060000*                 SET VL005-ADD TO TRUE                                   
060100* REQUEST INCLUDE KEY WAS PRESSED                                         
060200*        WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)                       
060300*             MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS                   
060400*             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
060500*                 INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
060600*                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                     *6
060700*                               TO VL005-NUMBER-OF-SELECTED-ITEMS VLKCS590
060800*                 PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
060900* REQUEST UPDATE KEY WAS PRESSED                                          
061000* REQUEST DELETE KEY WAS PRESSED                                          
061100         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)                     84
061200         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)                     84
061300              IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
061400                  INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
061500                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                  CL**6
061600                                TO VL005-NUMBER-OF-SELECTED-ITEMS VLKCS590
061700                  PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
061800              ELSE                                                   CL**6
061900                  SET DP030-OVERRIDE-GO                              CL**6
062000                      DP020-MSG-WARNING TO TRUE                      CL**6
062100                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER          CL**6
062200             END-IF                                               VLKCS590
062300                                                                  VLKCS590
062400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  VLKCS590
062500             MOVE +1               TO PV-TOP-ITEM                 VLKCS590
062600                                                                     CL**6
062700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS590
062800                                                                     CL**6
062900             PERFORM 3200-RESET-ATTRIBUTES                        VLKCS590
063000                                                                  VLKCS590
063100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   VLKCS590
063200             PERFORM 2110-BROWSE-BACKWARD                         VLKCS590
063300                                                                     CL**6
063400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS590
063500                                                                     CL**6
063600             PERFORM 3200-RESET-ATTRIBUTES                        VLKCS590
063700                                                                  VLKCS590
063800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   VLKCS590
063900             PERFORM 2120-BROWSE-FORWARD                          VLKCS590
064000                                                                     CL**6
064100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS590
064200                                                                     CL**6
064300             PERFORM 3200-RESET-ATTRIBUTES                        VLKCS590
064400                                                                  POKCS015
064500         WHEN DP020-FK-DISPN-RETURN(DP020-SRC-AID)                POKCS015
064600             IF  ASC-NUMBER-OF-SELECTED-ITEMS = +1                POKCS015
064700                 PERFORM 5000-PREPARE-SEL-QUEUE                   POKCS015
064800             ELSE                                                 POKCS015
064900                 SET DP030-OVERRIDE-GO                            POKCS015
065000                                   TO TRUE                        POKCS015
065100                 MOVE PC-TSYMSG-00047                             POKCS015
065200                                   TO DP020-MSG-NUMBER            POKCS015
065300                 SET DP020-MSG-FATAL                              POKCS015
065400                                   TO TRUE                        POKCS015
065500             END-IF                                               POKCS015
065600                                                                  POKCS015
065700                                                                  VLKCS590
065800         WHEN DP020-SRC-AID = DP016-ENTER                         VLKCS590
065900*            PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   VLKCS590
066000                                                                     CL**6
066100             IF PS-ERROR                                             CL**6
066200                 CONTINUE                                         VLKCS590
066300             ELSE                                                 VLKCS590
066400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             VLKCS590
066500             END-IF                                               VLKCS590
066600                                                                  VLKCS590
066700         WHEN OTHER                                               VLKCS590
066800             SET DP013-NO-ROLLBACK                                VLKCS590
066900                 DP013-XCTL-DISPLAY-RESTART                       VLKCS590
067000                 DP013-CICS-ABEND  TO TRUE                        VLKCS590
067100             MOVE '2100-CHECK-FUNCTION-KEY'                       VLKCS590
067200                                   TO DP013-PARAGRAPH             VLKCS590
067300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      VLKCS590
067400                                   TO DP013-MESSAGE-TEXT (1)      VLKCS590
067500             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS590
067600     END-EVALUATE.                                                VLKCS590
067700                                                                  VLKCS590
067800*----------------------------------------------------------------*VLKCS590
067900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *VLKCS590
068000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *VLKCS590
068100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *VLKCS590
068200*    MESSAGE.                                                    *VLKCS590
068300*----------------------------------------------------------------*VLKCS590
068400 2110-BROWSE-BACKWARD.                                            VLKCS590
068500                                                                  VLKCS590
068600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    VLKCS590
068700         GIVING PV-TOP-ITEM.                                      VLKCS590
068800                                                                  VLKCS590
068900     IF  ((PV-TOP-ITEM < +1)                                      VLKCS590
069000       OR (PV-TOP-ITEM = +1))                                     VLKCS590
069100         MOVE +1                   TO PV-TOP-ITEM                 VLKCS590
069200*        -- TOP OF LIST --                                        VLKCS590
069300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VLKCS590
069400         SET DP020-MSG-INFORMATIONAL TO TRUE                      VLKCS590
069500     END-IF.                                                      VLKCS590
069600                                                                  VLKCS590
069700*----------------------------------------------------------------*VLKCS590
069800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *VLKCS590
069900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *VLKCS590
070000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *VLKCS590
070100*----------------------------------------------------------------*VLKCS590
070200 2120-BROWSE-FORWARD.                                             VLKCS590
070300                                                                  VLKCS590
070400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              VLKCS590
070500         GIVING PV-TOP-ITEM.                                      VLKCS590
070600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   VLKCS590
070700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VLKCS590
070800                                   TO PV-TOP-ITEM                 VLKCS590
070900*        -- BOTTOM OF LIST --                                     VLKCS590
071000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VLKCS590
071100         SET DP020-MSG-INFORMATIONAL                              VLKCS590
071200                                   TO TRUE                        VLKCS590
071300     ELSE                                                         VLKCS590
071400         COMPUTE PV-BOTTOM-ITEM =                                 VLKCS590
071500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 VLKCS590
071600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            VLKCS590
071700*            -- BOTTOM OF LIST --                                 VLKCS590
071800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VLKCS590
071900             SET DP020-MSG-INFORMATIONAL                          VLKCS590
072000                                   TO TRUE                        VLKCS590
072100         END-IF                                                   VLKCS590
072200     END-IF.                                                      VLKCS590
072300                                                                  VLKCS590
072400*----------------------------------------------------------------*VLKCS590
072500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *VLKCS590
072600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *VLKCS590
072700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *VLKCS590
072800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *VLKCS590
072900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *VLKCS590
073000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *VLKCS590
073100*----------------------------------------------------------------*VLKCS590
073200 2130-CHECK-FOR-JUMP-BROWSE.                                      VLKCS590
073300                                                                  VLKCS590
073400     SET PS-NO-ERROR               TO TRUE.                       VLKCS590
073500     IF (ASC-START-ITEM-REQUEST = SPACE)                          VLKCS590
073600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VLKCS590
073700                                   TO PV-TOP-ITEM                 VLKCS590
073800     ELSE                                                         VLKCS590
073900         MOVE ASC-START-ITEM-REQUEST                              VLKCS590
074000                                   TO DP010I-UNEDITED-FIELD       VLKCS590
074100         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       VLKCS590
074200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     VLKCS590
074300         SET DP010I-NEGATIVE-NOT-ALLOWED                          VLKCS590
074400                                   TO TRUE                        VLKCS590
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
074600                                                                  VLKCS590
074700         IF  NOT DP010I-ERROR-DETECTED                            VLKCS590
074800             MOVE DP010I-NUMERIC-FIELD                            VLKCS590
074900                                   TO  ASC-START-ITEM-REQUEST-N   VLKCS590
075000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  VLKCS590
075100                 IF  ASC-START-ITEM-REQUEST-N >                   VLKCS590
075200                                          ASC-NUMBER-OF-ITEMS-READVLKCS590
075300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         VLKCS590
075400                     COMPUTE PV-TOP-ITEM =                        VLKCS590
075500                             ASC-NUMBER-OF-ITEMS-READ             VLKCS590
075600                             - PC-ITEMS-PER-PANEL + 1             VLKCS590
075700                     IF  PV-TOP-ITEM < +1                         VLKCS590
075800                         MOVE +1   TO PV-TOP-ITEM                 VLKCS590
075900                         MOVE PC-TSYMSG-00070                     VLKCS590
076000                                   TO DP020-MSG-NUMBER            VLKCS590
076100                         SET DP020-MSG-INFORMATIONAL              VLKCS590
076200                                   TO TRUE                        VLKCS590
076300                     END-IF                                       VLKCS590
076400                 ELSE                                             VLKCS590
076500                     MOVE ASC-START-ITEM-REQUEST-N                VLKCS590
076600                                   TO PV-TOP-ITEM                 VLKCS590
076700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      VLKCS590
076800                     COMPUTE PV-BOTTOM-ITEM =                     VLKCS590
076900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     VLKCS590
077000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READVLKCS590
077100*                        -- BOTTOM OF LIST --                     VLKCS590
077200                         MOVE PC-TSYMSG-00070                     VLKCS590
077300                                   TO DP020-MSG-NUMBER            VLKCS590
077400                         SET DP020-MSG-INFORMATIONAL              VLKCS590
077500                                   TO TRUE                        VLKCS590
077600                     END-IF                                       VLKCS590
077700                 END-IF                                           VLKCS590
077800             ELSE                                                 VLKCS590
077900                CONTINUE                                                  
078000*                --- VALUE OUT OF RANGE ----                      VLKCS590
078100*                MOVE PC-TSYMSG-00101                             VLKCS590
078200*                                  TO DP020-MSG-NUMBER            VLKCS590
078300*                MOVE -1           TO ASTRTITL                    VLKCS590
078400*                SET DP030-SET-CURSOR-APPL-1                      VLKCS590
078500*                                  TO TRUE                        VLKCS590
078600*                MOVE DP015-REVERSE                               VLKCS590
078700*                                  TO ASTRTITH                    VLKCS590
078800*                MOVE DP015-RED    TO ASTRTITC                    VLKCS590
078900*                MOVE DP015-UNP-NUM-BRT-MDT                       VLKCS590
079000*                                  TO ASTRTITA                    VLKCS590
079100*                SET DP020-MSG-FATAL                              VLKCS590
079200*                                  TO TRUE                        VLKCS590
079300*                SET PS-ERROR      TO TRUE                        VLKCS590
079400             END-IF                                               VLKCS590
079500                                                                  VLKCS590
079600         ELSE                                                     VLKCS590
079700             CONTINUE                                                     
079800*            MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            VLKCS590
079900*            MOVE -1               TO ASTRTITL                    VLKCS590
080000*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                  VLKCS590
080100*            MOVE DP015-REVERSE    TO ASTRTITH                    VLKCS590
080200*            MOVE DP015-RED        TO ASTRTITC                    VLKCS590
080300*            MOVE DP015-UNP-NUM-BRT-MDT                           VLKCS590
080400*                                  TO ASTRTITA                    VLKCS590
080500*            SET DP020-MSG-FATAL   TO TRUE                        VLKCS590
080600*            SET PS-ERROR          TO TRUE                        VLKCS590
080700         END-IF                                                   VLKCS590
080800     END-IF.                                                      VLKCS590
080900                                                                  VLKCS590
081000*----------------------------------------------------------------*VLKCS590
081100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *VLKCS590
081200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *VLKCS590
081300*----------------------------------------------------------------*VLKCS590
081400 2140-DESELECT-ALL-ITEMS.                                         VLKCS590
081500                                                                  VLKCS590
081600     MOVE +1                       TO ASC-BLK-SUB.                VLKCS590
081700                                                                  VLKCS590
081800     PERFORM 2141-CLEAR-SELECTED-INDS                             VLKCS590
081900         VARYING ASC-ITEM-SUB                                     VLKCS590
082000         FROM 1 BY 1                                              VLKCS590
082100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS590
082200                                                                  VLKCS590
082300     ADD +1                        TO ASC-BLK-SUB.                VLKCS590
082400                                                                  VLKCS590
082500     PERFORM 2141-CLEAR-SELECTED-INDS                             VLKCS590
082600         VARYING ASC-ITEM-SUB                                     VLKCS590
082700         FROM 1 BY 1                                              VLKCS590
082800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS590
082900                                                                  VLKCS590
083000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS590
083100                                   TO PV-LIST-ITEM-NUMBER.        VLKCS590
083200                                                                  VLKCS590
083300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS590
083400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS590
083500                                                                  VLKCS590
083600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VLKCS590
083700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      VLKCS590
083800         MOVE +1                   TO ASC-BLK-SUB                 VLKCS590
083900                                                                  VLKCS590
084000         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS590
084100                                                                  VLKCS590
084200         MOVE +1                   TO PV-BLOCK-NUMBER             VLKCS590
084300                                                                  VLKCS590
084400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS590
084500             PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS590
084600                                                                  VLKCS590
084700         PERFORM                                                  VLKCS590
084800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VLKCS590
084900                                                                  VLKCS590
085000             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
085100                                                                  VLKCS590
085200             PERFORM 2141-CLEAR-SELECTED-INDS                     VLKCS590
085300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 VLKCS590
085400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS590
085500                                                                  VLKCS590
085600             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
085700                                                                  VLKCS590
085800             ADD +1                TO PV-BLOCK-NUMBER             VLKCS590
085900                                                                  VLKCS590
086000         END-PERFORM                                              VLKCS590
086100                                                                  VLKCS590
086200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS590
086300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS590
086400                                                                  VLKCS590
086500         PERFORM                                                  VLKCS590
086600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS590
086700                   ASC-HIGHEST-BLOCK-WRITTEN                      VLKCS590
086800                                                                  VLKCS590
086900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS590
087000                                   TO PV-BLOCK-NUMBER             VLKCS590
087100                                                                  VLKCS590
087200             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
087300                                                                  VLKCS590
087400             PERFORM 2141-CLEAR-SELECTED-INDS                     VLKCS590
087500                 VARYING ASC-ITEM-SUB                             VLKCS590
087600                 FROM 1 BY 1                                      VLKCS590
087700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS590
087800                                                                  VLKCS590
087900             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
088000                                                                  VLKCS590
088100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS590
088200                                                                  VLKCS590
088300         END-PERFORM                                              VLKCS590
088400                                                                  VLKCS590
088500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS590
088600                                   TO PV-BLOCK-NUMBER             VLKCS590
088700                                                                  VLKCS590
088800         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS590
088900     END-IF.                                                      VLKCS590
089000                                                                  VLKCS590
089100                                                                  VLKCS590
089200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. VLKCS590
089300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.VLKCS590
089400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  VLKCS590
089500                                                                  VLKCS590
089600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VLKCS590
089700                                                                  VLKCS590
089800*----------------------------------------------------------------*VLKCS590
089900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *VLKCS590
090000*----------------------------------------------------------------*VLKCS590
090100 2141-CLEAR-SELECTED-INDS.                                        VLKCS590
090200                                                                  VLKCS590
090300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS590
090400             NOT EQUAL ZERO                                       VLKCS590
090500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS590
090600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS590
090700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    VLKCS590
090800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VLKCS590
090900                                   TO TRUE                        VLKCS590
091000         END-IF                                                   VLKCS590
091100     END-IF.                                                      VLKCS590
091200                                                                  VLKCS590
091300*----------------------------------------------------------------*VLKCS590
091400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *VLKCS590
091500*  FOR ALL ITEMS.                                                *VLKCS590
091600*----------------------------------------------------------------*VLKCS590
091700 2150-SELECT-ALL-ITEMS.                                           VLKCS590
091800                                                                  VLKCS590
091900     MOVE +1                       TO ASC-BLK-SUB.                VLKCS590
092000                                                                  VLKCS590
092100     PERFORM 2151-SET-SELECTED-INDS                               VLKCS590
092200         VARYING ASC-ITEM-SUB                                     VLKCS590
092300         FROM 1 BY 1                                              VLKCS590
092400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS590
092500                                                                  VLKCS590
092600     ADD +1                        TO ASC-BLK-SUB.                VLKCS590
092700                                                                  VLKCS590
092800     PERFORM 2151-SET-SELECTED-INDS                               VLKCS590
092900         VARYING ASC-ITEM-SUB                                     VLKCS590
093000         FROM 1 BY 1                                              VLKCS590
093100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS590
093200                                                                  VLKCS590
093300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS590
093400                                   TO PV-LIST-ITEM-NUMBER.        VLKCS590
093500                                                                  VLKCS590
093600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS590
093700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS590
093800                                                                  VLKCS590
093900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VLKCS590
094000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    VLKCS590
094100         MOVE +1                   TO ASC-BLK-SUB                 VLKCS590
094200                                                                  VLKCS590
094300         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS590
094400                                                                  VLKCS590
094500         MOVE +1                   TO PV-BLOCK-NUMBER             VLKCS590
094600                                                                  VLKCS590
094700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS590
094800             PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS590
094900                                                                  VLKCS590
095000         PERFORM                                                  VLKCS590
095100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VLKCS590
095200                                                                  VLKCS590
095300             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
095400                                                                  VLKCS590
095500             PERFORM 2151-SET-SELECTED-INDS                       VLKCS590
095600                 VARYING ASC-ITEM-SUB                             VLKCS590
095700                 FROM 1 BY 1                                      VLKCS590
095800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS590
095900                                                                  VLKCS590
096000             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
096100                                                                  VLKCS590
096200             ADD +1                TO PV-BLOCK-NUMBER             VLKCS590
096300                                                                  VLKCS590
096400         END-PERFORM                                              VLKCS590
096500                                                                  VLKCS590
096600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS590
096700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS590
096800                                                                  VLKCS590
096900         PERFORM                                                  VLKCS590
097000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS590
097100                   ASC-HIGHEST-BLOCK-WRITTEN                      VLKCS590
097200                                                                  VLKCS590
097300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS590
097400                                   TO PV-BLOCK-NUMBER             VLKCS590
097500                                                                  VLKCS590
097600             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
097700                                                                  VLKCS590
097800             PERFORM 2151-SET-SELECTED-INDS                       VLKCS590
097900                 VARYING ASC-ITEM-SUB                             VLKCS590
098000                 FROM 1 BY 1                                      VLKCS590
098100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS590
098200                                                                  VLKCS590
098300             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
098400                                                                  VLKCS590
098500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS590
098600                                                                  VLKCS590
098700         END-PERFORM                                              VLKCS590
098800                                                                  VLKCS590
098900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS590
099000                                   TO PV-BLOCK-NUMBER             VLKCS590
099100                                                                  VLKCS590
099200         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS590
099300     END-IF.                                                      VLKCS590
099400                                                                  VLKCS590
099500                                                                  VLKCS590
099600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             VLKCS590
099700                       ASC-NUMBER-OF-SELECTED-ITEMS.              VLKCS590
099800                                                                  VLKCS590
099900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VLKCS590
100000                                                                  VLKCS590
100100*----------------------------------------------------------------*VLKCS590
100200*    MARK EACH ITEM AS BEING SELECTED.                           *VLKCS590
100300*----------------------------------------------------------------*VLKCS590
100400 2151-SET-SELECTED-INDS.                                          VLKCS590
100500                                                                  VLKCS590
100600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS590
100700             NOT EQUAL ZERO                                       VLKCS590
100800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS590
100900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS590
101000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS590
101100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VLKCS590
101200                               TO  TRUE                           VLKCS590
101300         END-IF                                                   VLKCS590
101400     END-IF.                                                      VLKCS590
101500                                                                  VLKCS590
101600******************************************************************VLKCS590
101700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **VLKCS590
101800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **VLKCS590
101900******************************************************************VLKCS590
102000 2200-MOVE-SCREEN-TO-COMMAREA.                                    VLKCS590
102100                                                                  VLKCS590
102200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             VLKCS590
102300     MOVE +1                       TO PV-SUB.                     VLKCS590
102400                                                                  VLKCS590
102500     PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS590
102600*    IF  ASTRTITL > ZERO                                          VLKCS590
102700*        MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          VLKCS590
102800*    ELSE                                                         VLKCS590
102900*        IF  ASTRTITF = DP015-ERASE-EOF                           VLKCS590
103000*            INITIALIZE ASC-START-ITEM-REQUEST                    VLKCS590
103100*        END-IF                                                   VLKCS590
103200*    END-IF.                                                      VLKCS590
103300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          VLKCS590
103400         VARYING PV-SUB                                           VLKCS590
103500         FROM 1 BY 1                                              VLKCS590
103600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      VLKCS590
103700                                                                  VLKCS590
103800******************************************************************VLKCS590
103900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**VLKCS590
104000******************************************************************VLKCS590
104100 2210-MOVE-LINES-TO-COMMAREA.                                     VLKCS590
104200                                                                  VLKCS590
104300     IF  MR-SELECTL (PV-SUB) > ZERO                               VLKCS590
104400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             VLKCS590
104500         MOVE MR-SELECTI (PV-SUB)                                 VLKCS590
104600                                   TO ASC-TEMP-SELECTED-SW        VLKCS590
104700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS590
104800     ELSE                                                         VLKCS590
104900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                VLKCS590
105000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     VLKCS590
105100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        VLKCS590
105200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS590
105300         END-IF                                                   VLKCS590
105400     END-IF.                                                      VLKCS590
105500     ADD +1                        TO ASC-ITEM-SUB.               VLKCS590
105600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS590
105700         ADD +1                    TO ASC-BLK-SUB                 VLKCS590
105800         MOVE +1                   TO ASC-ITEM-SUB                VLKCS590
105900     END-IF.                                                      VLKCS590
106000                                                                  VLKCS590
106100******************************************************************VLKCS590
106200** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **VLKCS590
106300** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **VLKCS590
106400******************************************************************VLKCS590
106500 3000-EDIT-DATA-IN-COMMAREA.                                      VLKCS590
106600                                                                  VLKCS590
106700     SET PS-NO-ERROR               TO TRUE.                       VLKCS590
106800     PERFORM 3200-RESET-ATTRIBUTES.                               VLKCS590
106900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     VLKCS590
107000**                                                                VLKCS590
107100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              VLKCS590
107200* EDITTING IS DONE FROM THE BOTTOM UP.                            VLKCS590
107300**                                                                VLKCS590
107400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       VLKCS590
107500         ASC-ITEMS-DISPLAYED - 1.                                 VLKCS590
107600     PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS590
107700     PERFORM 3300-EDIT-SELECTIONS                                 VLKCS590
107800         VARYING PV-SUB                                           VLKCS590
107900         FROM PV-SUB BY -1                                        VLKCS590
108000         UNTIL PV-SUB < +1                                        VLKCS590
108100                                                                  VLKCS590
108200     IF  PS-NO-ERROR                                              VLKCS590
108300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        VLKCS590
108400     END-IF.                                                      VLKCS590
108500                                                                  VLKCS590
108600     IF  ((PS-NO-ERROR)                                           VLKCS590
108700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   VLKCS590
108800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    VLKCS590
108900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  VLKCS590
109000     END-IF.                                                      VLKCS590
109100                                                                  VLKCS590
109200*----------------------------------------------------------------*VLKCS590
109300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *VLKCS590
109400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*VLKCS590
109500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *VLKCS590
109600*                                                                *VLKCS590
109700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *VLKCS590
109800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *VLKCS590
109900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *VLKCS590
110000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *VLKCS590
110100*----------------------------------------------------------------*VLKCS590
110200 3100-SET-SUBSCRIPTS.                                             VLKCS590
110300                                                                  VLKCS590
110400     COMPUTE ASC-ITEM-SUB =                                       VLKCS590
110500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        VLKCS590
110600                                                                  VLKCS590
110700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         VLKCS590
110800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS590
110900                                                                  VLKCS590
111000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               VLKCS590
111100     ELSE                                                         VLKCS590
111200         MOVE +1                     TO ASC-BLK-SUB               VLKCS590
111300     END-IF.                                                      VLKCS590
111400                                                                  VLKCS590
111500******************************************************************VLKCS590
111600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **VLKCS590
111700******************************************************************VLKCS590
111800 3200-RESET-ATTRIBUTES.                                           VLKCS590
111900                                                                  VLKCS590
112000*    MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      VLKCS590
112100*    MOVE DP015-GREEN           TO ASTRTITC.                      VLKCS590
112200*    MOVE DP015-UNDERLINE       TO ASTRTITH.                      VLKCS590
112300                                                                  VLKCS590
112400     IF DP020-NEXT-ACT-RETURN OR                                  VLKCS590
112500        DP020-NEXT-ACT-READ-MAP                                   VLKCS590
112600         PERFORM VARYING PV-SUB  FROM 1 BY 1                      VLKCS590
112700                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             VLKCS590
112800                  MOVE DP015-UNP-ALP-NOR-OFF                      VLKCS590
112900                                       TO MR-SELECTA (PV-SUB)     VLKCS590
113000                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     VLKCS590
113100                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     VLKCS590
113200         END-PERFORM                                              VLKCS590
113300     ELSE                                                         VLKCS590
113400         PERFORM VARYING PV-SUB  FROM 1 BY 1                      VLKCS590
113500                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              VLKCS590
113600                  MOVE DP015-UNP-ALP-NOR-OFF                      VLKCS590
113700                                       TO MR-SELECTA (PV-SUB)     VLKCS590
113800                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     VLKCS590
113900                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     VLKCS590
114000         END-PERFORM.                                             VLKCS590
114100                                                                  VLKCS590
114200******************************************************************VLKCS590
114300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **VLKCS590
114400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **VLKCS590
114500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **VLKCS590
114600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **VLKCS590
114700******************************************************************VLKCS590
114800 3300-EDIT-SELECTIONS.                                            VLKCS590
114900                                                                  VLKCS590
115000     EVALUATE TRUE                                                VLKCS590
115100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VLKCS590
115200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS590
115300                 CONTINUE                                         VLKCS590
115400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS590
115500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS590
115600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   VLKCS590
115700                 MOVE ASC-TEMP-SELECTED-SW                        VLKCS590
115800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS590
115900                                TO ASC-SELECTED-SW                VLKCS590
116000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS590
116100             END-IF                                               VLKCS590
116200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VLKCS590
116300                 = SPACE                                          VLKCS590
116400             EVALUATE TRUE                                        VLKCS590
116500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       VLKCS590
116600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSVLKCS590
116700                     MOVE SPACE TO ASC-SELECTED-SW                VLKCS590
116800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS590
116900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS590
117000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    VLKCS590
117100                     MOVE SPACE TO ASC-SELECTED-SW                VLKCS590
117200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS590
117300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS590
117400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      VLKCS590
117500                     MOVE SPACE TO ASC-SELECTED-SW                VLKCS590
117600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS590
117700             END-EVALUATE                                         VLKCS590
117800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS590
117900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS590
118000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS590
118100             END-IF                                               VLKCS590
118200             PERFORM 3310-EDIT-RANGE                              VLKCS590
118300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS590
118400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS590
118500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS590
118600             END-IF                                               VLKCS590
118700             PERFORM 3310-EDIT-RANGE                              VLKCS590
118800         WHEN OTHER                                               VLKCS590
118900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           VLKCS590
119000             SET DP020-MSG-FATAL    TO TRUE                       VLKCS590
119100             MOVE -1                TO MR-SELECTL (PV-SUB)        VLKCS590
119200             SET DP030-SET-CURSOR-APPL-1                          VLKCS590
119300                                    TO TRUE                       VLKCS590
119400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        VLKCS590
119500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        VLKCS590
119600             SET PS-ERROR TO TRUE                                 VLKCS590
119700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS590
119800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     VLKCS590
119900                 MOVE SPACE         TO ASC-SELECTED-SW            VLKCS590
120000                                        (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS590
120100             END-IF                                               VLKCS590
120200     END-EVALUATE.                                                VLKCS590
120300                                                                  VLKCS590
120400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 VLKCS590
120500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               VLKCS590
120600     IF  ASC-ITEM-SUB < 1                                         VLKCS590
120700         SUBTRACT +1 FROM ASC-BLK-SUB                             VLKCS590
120800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                VLKCS590
120900     END-IF.                                                      VLKCS590
121000                                                                  VLKCS590
121100******************************************************************VLKCS590
121200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **VLKCS590
121300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **VLKCS590
121400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**VLKCS590
121500** THE ENDING.                                                  **VLKCS590
121600******************************************************************VLKCS590
121700 3310-EDIT-RANGE.                                                 VLKCS590
121800                                                                  VLKCS590
121900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                VLKCS590
122000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   VLKCS590
122100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS590
122200                                   TO ASC-SELECTED-SW             VLKCS590
122300                                        (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS590
122400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE VLKCS590
122500         ELSE                                                     VLKCS590
122600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     VLKCS590
122700                 CONTINUE                                         VLKCS590
122800             ELSE                                                 VLKCS590
122900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        VLKCS590
123000                 MOVE PC-TSYMSG-00054                             VLKCS590
123100                                   TO DP020-MSG-NUMBER            VLKCS590
123200                 SET DP020-MSG-FATAL                              VLKCS590
123300                                   TO TRUE                        VLKCS590
123400                 MOVE -1           TO MR-SELECTL (PV-SUB)         VLKCS590
123500                 SET DP030-SET-CURSOR-APPL-1                      VLKCS590
123600                                   TO TRUE                        VLKCS590
123700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         VLKCS590
123800                 MOVE DP015-UNDERLINE                             VLKCS590
123900                                   TO MR-SELECTH (PV-SUB)         VLKCS590
124000                 SET PS-ERROR      TO TRUE                        VLKCS590
124100             END-IF                                               VLKCS590
124200         END-IF                                                   VLKCS590
124300     ELSE                                                         VLKCS590
124400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VLKCS590
124500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS590
124600                                   TO ASC-SELECTED-SW             VLKCS590
124700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   VLKCS590
124800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   VLKCS590
124900         ELSE                                                     VLKCS590
125000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       VLKCS590
125100                 CONTINUE                                         VLKCS590
125200             ELSE                                                 VLKCS590
125300*                -- ONLY ONE END-OF-RANGE ALLOWED --              VLKCS590
125400                 MOVE PC-TSYMSG-00055                             VLKCS590
125500                                   TO DP020-MSG-NUMBER            VLKCS590
125600                 SET DP020-MSG-FATAL                              VLKCS590
125700                                   TO TRUE                        VLKCS590
125800                 MOVE -1           TO MR-SELECTL (PV-SUB)         VLKCS590
125900                 SET DP030-SET-CURSOR-APPL-1                      VLKCS590
126000                                   TO TRUE                        VLKCS590
126100                 SET PS-ERROR      TO TRUE                        VLKCS590
126200             END-IF                                               VLKCS590
126300         END-IF                                                   VLKCS590
126400     END-IF.                                                      VLKCS590
126500                                                                  VLKCS590
126600******************************************************************VLKCS590
126700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **VLKCS590
126800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **VLKCS590
126900******************************************************************VLKCS590
127000 3400-CHECK-RANGE-SEQUENCE.                                       VLKCS590
127100                                                                  VLKCS590
127200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VLKCS590
127300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      VLKCS590
127400       AND  ASC-START-OF-SELECTED-RANGE >                         VLKCS590
127500                                         ASC-END-OF-SELECTED-RANGEVLKCS590
127600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                VLKCS590
127700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 VLKCS590
127800         SET DP020-MSG-FATAL TO TRUE                              VLKCS590
127900         SET PS-ERROR TO TRUE                                     VLKCS590
128000         PERFORM 3410-POSITION-AT-ERROR                           VLKCS590
128100     END-IF.                                                      VLKCS590
128200                                                                  VLKCS590
128300******************************************************************VLKCS590
128400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **VLKCS590
128500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **VLKCS590
128600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **VLKCS590
128700******************************************************************VLKCS590
128800 3410-POSITION-AT-ERROR.                                          VLKCS590
128900                                                                  VLKCS590
129000     SET DP030-SET-CURSOR-APPL-1                                  VLKCS590
129100                                   TO TRUE.                       VLKCS590
129200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VLKCS590
129300                    - PV-TOP-ITEM + 1.                            VLKCS590
129400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS590
129500         CONTINUE                                                 VLKCS590
129600     ELSE                                                         VLKCS590
129700         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS590
129800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS590
129900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VLKCS590
130000     END-IF.                                                      VLKCS590
130100                                                                  VLKCS590
130200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VLKCS590
130300                    - PV-TOP-ITEM + 1.                            VLKCS590
130400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS590
130500         CONTINUE                                                 VLKCS590
130600     ELSE                                                         VLKCS590
130700         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS590
130800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS590
130900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VLKCS590
131000     END-IF.                                                      VLKCS590
131100                                                                  VLKCS590
131200*----------------------------------------------------------------*VLKCS590
131300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *VLKCS590
131400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *VLKCS590
131500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *VLKCS590
131600*----------------------------------------------------------------*VLKCS590
131700 3500-MARK-RANGE-AS-SELECTED.                                     VLKCS590
131800                                                                  VLKCS590
131900     MOVE +1                       TO  ASC-BLK-SUB.               VLKCS590
132000     PERFORM 3510-MARK-SELECTED-INDS                              VLKCS590
132100         VARYING ASC-ITEM-SUB                                     VLKCS590
132200         FROM 1 BY 1                                              VLKCS590
132300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS590
132400                                                                  VLKCS590
132500     ADD +1                        TO ASC-BLK-SUB.                VLKCS590
132600     PERFORM 3510-MARK-SELECTED-INDS                              VLKCS590
132700         VARYING ASC-ITEM-SUB                                     VLKCS590
132800         FROM 1 BY 1                                              VLKCS590
132900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS590
133000                                                                  VLKCS590
133100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS590
133200                                   TO  PV-LIST-ITEM-NUMBER.       VLKCS590
133300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS590
133400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         VLKCS590
133500               PC-ITEMS-PER-PANEL).                               VLKCS590
133600                                                                  VLKCS590
133700     MOVE ASC-START-OF-SELECTED-RANGE                             VLKCS590
133800                                   TO PV-START-OF-SELECTED-RANGE. VLKCS590
133900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            VLKCS590
134000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  VLKCS590
134100               PC-ITEMS-PER-PANEL).                               VLKCS590
134200                                                                  VLKCS590
134300     MOVE ASC-END-OF-SELECTED-RANGE                               VLKCS590
134400                                   TO  PV-END-OF-SELECTED-RANGE.  VLKCS590
134500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             VLKCS590
134600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    VLKCS590
134700               PC-ITEMS-PER-PANEL).                               VLKCS590
134800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             VLKCS590
134900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             VLKCS590
135000                                                                  VLKCS590
135100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    VLKCS590
135200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        VLKCS590
135300         MOVE +1                   TO ASC-BLK-SUB                 VLKCS590
135400         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS590
135500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS590
135600             PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS590
135700                                                                  VLKCS590
135800         PERFORM                                                  VLKCS590
135900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      VLKCS590
136000                   PV-PREV-BLOCK-IN-ARRAY                         VLKCS590
136100             MOVE PV-FIRST-BLOCK-IN-RANGE                         VLKCS590
136200                                   TO PV-BLOCK-NUMBER             VLKCS590
136300             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
136400             PERFORM 3510-MARK-SELECTED-INDS                      VLKCS590
136500                 VARYING ASC-ITEM-SUB                             VLKCS590
136600                 FROM 1 BY 1                                      VLKCS590
136700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS590
136800             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
136900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     VLKCS590
137000         END-PERFORM                                              VLKCS590
137100                                                                  VLKCS590
137200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS590
137300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS590
137400         PERFORM                                                  VLKCS590
137500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS590
137600                   PV-LAST-BLOCK-IN-RANGE                         VLKCS590
137700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS590
137800                                   TO PV-BLOCK-NUMBER             VLKCS590
137900             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
138000             PERFORM 3510-MARK-SELECTED-INDS                      VLKCS590
138100                 VARYING ASC-ITEM-SUB                             VLKCS590
138200                 FROM 1 BY 1                                      VLKCS590
138300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS590
138400             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
138500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS590
138600         END-PERFORM                                              VLKCS590
138700                                                                  VLKCS590
138800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS590
138900                                   TO PV-BLOCK-NUMBER             VLKCS590
139000         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS590
139100     END-IF.                                                      VLKCS590
139200                                                                  VLKCS590
139300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE VLKCS590
139400                                      ASC-END-OF-SELECTED-RANGE.  VLKCS590
139500                                                                  VLKCS590
139600*----------------------------------------------------------------*VLKCS590
139700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *VLKCS590
139800*----------------------------------------------------------------*VLKCS590
139900 3510-MARK-SELECTED-INDS.                                         VLKCS590
140000                                                                  VLKCS590
140100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VLKCS590
140200                                ASC-ITEM-SUB) >                   VLKCS590
140300         ASC-START-OF-SELECTED-RANGE)                             VLKCS590
140400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VLKCS590
140500                                ASC-ITEM-SUB) =                   VLKCS590
140600         ASC-START-OF-SELECTED-RANGE)                             VLKCS590
140700                                                                  VLKCS590
140800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VLKCS590
140900                                    ASC-ITEM-SUB) <               VLKCS590
141000             ASC-END-OF-SELECTED-RANGE)                           VLKCS590
141100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VLKCS590
141200                                    ASC-ITEM-SUB) =               VLKCS590
141300             ASC-END-OF-SELECTED-RANGE)                           VLKCS590
141400                                                                  VLKCS590
141500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS590
141600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   VLKCS590
141700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   VLKCS590
141800                               TO TRUE                            VLKCS590
141900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              VLKCS590
142000                               TO TRUE                            VLKCS590
142100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS590
142200             END-IF                                               VLKCS590
142300         END-IF                                                   VLKCS590
142400     END-IF.                                                      VLKCS590
142500                                                                  VLKCS590
142600*----------------------------------------------------------------*VLKCS590
142700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *VLKCS590
142800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *VLKCS590
142900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *VLKCS590
143000*    DISPLAY THE PANEL TO USER.                                  *VLKCS590
143100*----------------------------------------------------------------*VLKCS590
143200 4000-BUILD-INITIAL-PANEL.                                        VLKCS590
143300                                                                  VLKCS590
143400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            VLKCS590
143500                                 ASC-BLOCK-ENTRIES (2).           VLKCS590
143600     MOVE +1                 TO ASC-BLK-SUB.                      VLKCS590
143700     SET ASC-ITEMS-LEFT-ON-DB                                     VLKCS590
143800                             TO TRUE.                             VLKCS590
143900                                                                  VLKCS590
144000     MOVE +0                 TO ASC-ITEM-SUB                      VLKCS590
144100                                ASC-NUMBER-OF-ITEMS-READ          VLKCS590
144200*                               ASC-NUMBER-OF-SELECTED-ITEMS      VLKCS590
144300                                ASC-HIGHEST-BLOCK-WRITTEN         VLKCS590
144400                                ASC-START-OF-SELECTED-RANGE       VLKCS590
144500                                ASC-END-OF-SELECTED-RANGE         VLKCS590
144600                                ASC-ITEM-AT-TOP-OF-PANEL.         VLKCS590
144700                                                                  VLKCS590
144800*    PERFORM 4050-PREPARE-CURSOR-KEY                              VLKCS590
144900                                                                  VLKCS590
145000     PERFORM 4010-OPEN-CURSOR.                                    VLKCS590
145100                                                                  VLKCS590
145200     PERFORM 4200-READ-ITEMS-FROM-DB.                             VLKCS590
145300                                                                  VLKCS590
145400     PERFORM 4020-CLOSE-CURSOR.                                   VLKCS590
145500                                                                  VLKCS590
145600     MOVE +1                   TO  PV-TOP-ITEM.                   VLKCS590
145700*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          VLKCS590
145800*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    VLKCS590
145900*        SET DP020-MSG-FATAL   TO  TRUE                           VLKCS590
146000*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               VLKCS590
146100*    ELSE                                                         VLKCS590
146200         MOVE -1               TO MR-SELECTL (1).                 VLKCS590
146300         SET DP030-SET-CURSOR-APPL-1                              VLKCS590
146400                               TO TRUE.                           VLKCS590
146500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    VLKCS590
146600*    END-IF.                                                      VLKCS590
146700                                                                  VLKCS590
146800*----------------------------------------------------------------*VLKCS590
146900* PREPARE THE DB KEY BY REPLACING * WITH %                       *VLKCS590
147000*----------------------------------------------------------------*VLKCS590
147100*4050-PREPARE-CURSOR-KEY.                                         VLKCS590
147200*                                                                 VLKCS590
147300*    MOVE ASC-KEY-VEND-NAME    TO DK-VEND-NAME.                   VLKCS590
147400*    MOVE ASC-KEY-STATUS-CODE  TO DK-STATUS-CODE.                 VLKCS590
147500*    IF DK-VEND-NAME > SPACES                                     VLKCS590
147600*        IF DK-VEND-NAME-BYTE (1) = '*'                           VLKCS590
147700*            MOVE PC-PERCENT   TO DK-VEND-NAME-BYTE (1)           VLKCS590
147800*            INSPECT DK-VEND-NAME                                 VLKCS590
147900*                REPLACING FIRST '*' BY PC-PERCENT                VLKCS590
148000*        END-IF                                                   VLKCS590
148100*        SET PS-NOT-DONE TO TRUE                                  VLKCS590
148200*        PERFORM VARYING PV-SUB                                   VLKCS590
148300*            FROM LENGTH OF DK-VEND-NAME BY -1                    VLKCS590
148400*            UNTIL PV-SUB = 1                                     VLKCS590
148500*               OR PS-DONE                                        VLKCS590
148600*                IF DK-VEND-NAME-BYTE (PV-SUB) = '*'              VLKCS590
148700*                    MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)VLKCS590
148800*                    SET PS-DONE TO TRUE                          VLKCS590
148900*                END-IF                                           VLKCS590
149000**               IF DK-VEND-NAME-BYTE (PV-SUB) > SPACES           VLKCS590
149100*                    SET PS-DONE TO TRUE                          VLKCS590
149200*                ELSE                                             VLKCS590
149300*                    MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)VLKCS590
149400*                END-IF                                           VLKCS590
149500*        END-PERFORM                                              VLKCS590
149600*    ELSE                                                         VLKCS590
149700*        MOVE ALL '%' TO DK-VEND-NAME.                            VLKCS590
149800                                                                  VLKCS590
149900*----------------------------------------------------------------*VLKCS590
150000* OPEN  THE VENDOR   CURSOR.                                     *VLKCS590
150100*----------------------------------------------------------------*VLKCS590
150200 4010-OPEN-CURSOR.                                                VLKCS590
150300                                                                  VLKCS590
150400     PERFORM                                                      VLKCS590
150500         WITH TEST AFTER                                          VLKCS590
150600         VARYING PV-RETRY-COUNTER                                 VLKCS590
150700         FROM 1 BY 1                                              VLKCS590
150800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VLKCS590
150900                   OR (SQLCODE = ZERO))                           VLKCS590
151000             MOVE 'CURSOR: TICKET-TYPE-CURSOR '                         90
151100                               TO DP013-MESSAGE-TEXT (2)          VLKCS590
151200             EXEC SQL                                             VLKCS590
151300                  OPEN TICKET-TYPE-CURSOR                         VLKCS590
151400             END-EXEC                                             VLKCS590
151500                                                                  VLKCS590
151600         EVALUATE TRUE                                            VLKCS590
151700             WHEN SQLCODE = ZERO                                  VLKCS590
151800             WHEN SQLCODE = -904                                  VLKCS590
151900             WHEN SQLCODE = -913                                  VLKCS590
152000                 CONTINUE                                         VLKCS590
152100             WHEN SQLWARN0 NOT = SPACES                           VLKCS590
152200             WHEN SQLCODE < ZERO                                  VLKCS590
152300             WHEN SQLCODE > ZERO                                  VLKCS590
152400                 MOVE '4010-OPEN-CURSOR'                          VLKCS590
152500                                   TO DP013-PARAGRAPH             VLKCS590
152600                 MOVE 'OPEN VENDOR CURSOR - '                     VLKCS590
152700                                   TO DP013-MESSAGE-TEXT (1)      VLKCS590
152800                 MOVE SQLCA        TO DP013-SQLCA                 VLKCS590
152900                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    VLKCS590
153000                 SET DP013-DB2-ABEND                              VLKCS590
153100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           VLKCS590
153200                 PERFORM DP013-0000-PROCESS-ABEND                 VLKCS590
153300         END-EVALUATE                                             VLKCS590
153400     END-PERFORM.                                                 VLKCS590
153500                                                                  VLKCS590
153600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VLKCS590
153700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             VLKCS590
153800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   VLKCS590
153900                                   TO DP013-MESSAGE-TEXT (1)      VLKCS590
154000         MOVE SQLCA                TO DP013-SQLCA                 VLKCS590
154100         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    VLKCS590
154200         SET DP013-DB2-ABEND                                      VLKCS590
154300             DP013-XCTL-DISPLAY-RESTART                           VLKCS590
154400                                   TO TRUE                        VLKCS590
154500         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
154600     END-IF.                                                      VLKCS590
154700                                                                  VLKCS590
154800*----------------------------------------------------------------*VLKCS590
154900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *VLKCS590
155000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *VLKCS590
155100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *VLKCS590
155200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *VLKCS590
155300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *VLKCS590
155400*----------------------------------------------------------------*VLKCS590
155500 4200-READ-ITEMS-FROM-DB.                                         VLKCS590
155600                                                                  VLKCS590
155700     PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                      CL**3
155800             UNTIL   PV-READ-COUNT > PC-MAX-ITEMS OR                 CL**3
155900                     ASC-NO-ITEMS-LEFT-ON-DB                         CL**3
156000                                                                  VLKCS590
156100             PERFORM 4210-FETCH                                      CL**3
156200                                                                  VLKCS590
156300             IF ASC-ITEMS-LEFT-ON-DB                                 CL**3
156400                IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 CL**3
156500                    CONTINUE                                         CL*10
156600                ELSE                                                 CL**3
156700                    ADD  +1 TO ASC-BLK-SUB                           CL**3
156800                    MOVE +0 TO ASC-ITEM-SUB                          CL**9
156900                    IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          CL**3
157000                        MOVE +1 TO ASC-BLK-SUB                       CL**3
157100                        SET ASC-BLOCK-MODIFIED (1) TO TRUE           CL**3
157200                                                                     CL**3
157300                        PERFORM 5100-WRITE-TEMP-STORAGE              CL**3
157400                                                                     CL**3
157500                        MOVE ASC-BLOCK-ENTRIES                       CL**3
157600                                          (PC-MAX-BLOCKS-IN-ARRAY)   CL**3
157700                                TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
157800                        ADD +1 TO ASC-BLK-SUB                        CL**3
157900                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
158000                        SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)   CL**3
158100                                                           TO TRUE   CL**3
158200                    END-IF                                           CL**3
158300                END-IF                                               CL**3
158400                PERFORM 4220-MOVE-DB-ITEMS THRU 4220-EXIT               10
158500             END-IF                                                  CL**3
158600     END-PERFORM.                                                 VLKCS590
158700                                                                  VLKCS590
158800     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                              CL**3
158900         MOVE +1 TO ASC-BLK-SUB                                      CL**3
159000                                                                     CL**3
159100         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS590
159200                                                                     CL**3
159300         ADD  +1 TO ASC-BLK-SUB                                      CL**3
159400                                                                     CL**8
159500         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS590
159600                                                                  VLKCS590
159700         MOVE 1  TO ASC-BLK-SUB                                      CL**3
159800                    PV-BLOCK-NUMBER                                  CL**3
159900                                                                     CL**3
160000         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS590
160100                                                                     CL**3
160200         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                            CL**3
160300             MOVE 2 TO ASC-BLK-SUB                                   CL**3
160400                       PV-BLOCK-NUMBER                               CL**3
160500                                                                     CL**3
160600             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
160700         END-IF                                                   VLKCS590
160800     END-IF.                                                      VLKCS590
160900                                                                  VLKCS590
161000 4210-FETCH.                                                      VLKCS590
161100                                                                  VLKCS590
161200     EXEC SQL                                                     VLKCS590
161300          FETCH TICKET-TYPE-CURSOR                                VLKCS590
161400          INTO  :TKTFMT-TKT-FMT-ID                                      *3
161410               ,:TKTFMT-TKT-FMT-DESC                                    *3
161600     END-EXEC                                                     VLKCS590
161700                                                                  VLKCS590
161800     EVALUATE TRUE                                                VLKCS590
161900         WHEN SQLCODE = ZERO                                      VLKCS590
162000         WHEN SQLCODE = +100                                      VLKCS590
162100              CONTINUE                                            VLKCS590
162200         WHEN SQLWARN0 NOT = SPACE                                VLKCS590
162300         WHEN SQLCODE NOT = ZERO                                  VLKCS590
162400              MOVE '4210-FETCH       '                            VLKCS590
162500                               TO DP013-PARAGRAPH                 VLKCS590
162600              MOVE 'FETCH TICKET TYPE CURSOR '                    VLKCS590
162700                               TO DP013-MESSAGE-TEXT (1)          VLKCS590
162800              MOVE SQLCA       TO DP013-SQLCA                     VLKCS590
162900              SET DP013-DB2-ABEND                                 VLKCS590
163000                               TO TRUE                            VLKCS590
163100              PERFORM DP013-0000-PROCESS-ABEND                    VLKCS590
163200     END-EVALUATE.                                                VLKCS590
163300                                                                  VLKCS590
163400     IF  SQLCODE EQUAL +100                                       VLKCS590
163500         SET ASC-NO-ITEMS-LEFT-ON-DB                              VLKCS590
163600                                   TO TRUE                        VLKCS590
163700     END-IF.                                                      VLKCS590
163800                                                                  VLKCS590
163900 4220-MOVE-DB-ITEMS.                                                    10
164000                                                                     CL**3
164100     ADD +1 TO ASC-ITEM-SUB                                          CL**7
164200               ASC-NUMBER-OF-ITEMS-READ.                             CL**7
164300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL**3
164400                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
164500     MOVE TKTFMT-TKT-FMT-ID      TO  ASC-CODE-TYPE                      *3
164600                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
164700     MOVE TKTFMT-TKT-FMT-DESC    TO ASC-CODE-DESC                       *2
164800                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
164900 4220-EXIT.                                                          CL**3
165000     EXIT.                                                           CL**3
165100                                                                  VLKCS590
165200*----------------------------------------------------------------*VLKCS590
165300* CLOSE THE VENDOR   CURSOR.                                     *VLKCS590
165400*----------------------------------------------------------------*VLKCS590
165500 4020-CLOSE-CURSOR.                                               VLKCS590
165600                                                                  VLKCS590
165700     EXEC SQL                                                     VLKCS590
165800         CLOSE TICKET-TYPE-CURSOR                                 VLKCS590
165900     END-EXEC                                                     VLKCS590
166000                                                                  VLKCS590
166100     EVALUATE TRUE                                                VLKCS590
166200         WHEN SQLCODE = ZERO                                      VLKCS590
166300             CONTINUE                                             VLKCS590
166400         WHEN SQLWARN0 NOT = SPACES                               VLKCS590
166500         WHEN SQLCODE < ZERO                                      VLKCS590
166600         WHEN SQLCODE > ZERO                                      VLKCS590
166700             MOVE '4020-CLOSE-CURSOR'                             VLKCS590
166800                               TO DP013-PARAGRAPH                 VLKCS590
166900             MOVE 'CLOSE VENDOR CURSOR '                          VLKCS590
167000                               TO DP013-MESSAGE-TEXT (1)          VLKCS590
167100             MOVE SQLCA        TO DP013-SQLCA                     VLKCS590
167200             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        VLKCS590
167300             SET DP013-DB2-ABEND                                  VLKCS590
167400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               VLKCS590
167500             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS590
167600     END-EVALUATE.                                                VLKCS590
167700                                                                  VLKCS590
167800*----------------------------------------------------------------*VLKCS590
167900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *VLKCS590
168000*----------------------------------------------------------------*VLKCS590
168100 4400-MOVE-COMMAREA-TO-SCREEN.                                    VLKCS590
168200                                                                  VLKCS590
168300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             VLKCS590
168400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          VLKCS590
168500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          VLKCS590
168600             MOVE +1    TO ASC-BLK-SUB                            VLKCS590
168700             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
168800             ADD +1     TO ASC-BLK-SUB                            VLKCS590
168900             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS590
169000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             VLKCS590
169100                 GIVING PV-BLOCK-NUMBER                           VLKCS590
169200                 REMAINDER PV-REMAINDER                           VLKCS590
169300             IF  PV-REMAINDER > ZERO                              VLKCS590
169400                 ADD +1 TO PV-BLOCK-NUMBER                        VLKCS590
169500             END-IF                                               VLKCS590
169600             MOVE +1    TO ASC-BLK-SUB                            VLKCS590
169700             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
169800             ADD +1     TO ASC-BLK-SUB                            VLKCS590
169900                           PV-BLOCK-NUMBER                        VLKCS590
170000             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS590
170100     END-IF.                                                      VLKCS590
170200     MOVE +1            TO ASC-BLK-SUB.                           VLKCS590
170300     COMPUTE ASC-ITEM-SUB =                                       VLKCS590
170400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              VLKCS590
170500         + PC-ITEMS-PER-PANEL).                                   VLKCS590
170600                                                                  VLKCS590
170700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS590
170800         ADD +1         TO ASC-BLK-SUB                            VLKCS590
170900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS590
171000     END-IF.                                                      VLKCS590
171100                                                                  VLKCS590
171200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           VLKCS590
171300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                VLKCS590
171400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        VLKCS590
171500     PERFORM 4420-FORMAT-LIST-LINES                               VLKCS590
171600         VARYING PV-SUB                                           VLKCS590
171700         FROM PC-ITEMS-PER-PANEL BY -1                            VLKCS590
171800         UNTIL PV-SUB < +1.                                       VLKCS590
171900                                                                  VLKCS590
172000     COMPUTE ASC-ITEMS-DISPLAYED =                                VLKCS590
172100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          VLKCS590
172200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   VLKCS590
172300*                                     ASTRTITO.                   VLKCS590
172400*    MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    VLKCS590
172500*    MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    VLKCS590
172600*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VLKCS590
172700*                                  TO ASELITO.                    VLKCS590
172800                                                                  VLKCS590
172900     IF  DP020-MSG-NUMBER-X = SPACE                               VLKCS590
173000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  VLKCS590
173100*            --- MORE ITEMS TO DISPLAY ----                       VLKCS590
173200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            VLKCS590
173300             SET DP020-MSG-INFORMATIONAL TO TRUE                  VLKCS590
173400         END-IF                                                   VLKCS590
173500     END-IF.                                                      VLKCS590
173600                                                                  VLKCS590
173700*----------------------------------------------------------------*VLKCS590
173800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *VLKCS590
173900*----------------------------------------------------------------*VLKCS590
174000 4410-READ-TEMP-STORAGE.                                          VLKCS590
174100                                                                  VLKCS590
174200     EXEC CICS                                                    VLKCS590
174300         READQ TS                                                 VLKCS590
174400             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS590
174500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS590
174600             ITEM  (PV-BLOCK-NUMBER)                              VLKCS590
174700             RESP  (PV-CICS-RESP)                                 VLKCS590
174800     END-EXEC.                                                    VLKCS590
174900                                                                  VLKCS590
175000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       VLKCS590
175100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     VLKCS590
175200         CONTINUE                                                 VLKCS590
175300     ELSE                                                         VLKCS590
175400         SET DP013-CICS-ABEND     TO TRUE                         VLKCS590
175500         SET DP013-NO-ROLLBACK    TO TRUE                         VLKCS590
175600         MOVE '4410-READ-TEMP-STORAGE'                            VLKCS590
175700                                  TO DP013-PARAGRAPH              VLKCS590
175800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      VLKCS590
175900                                  TO DP013-MESSAGE-TEXT(1)        VLKCS590
176000         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
176100     END-IF.                                                      VLKCS590
176200                                                                  VLKCS590
176300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS590
176400                                                                  VLKCS590
176500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         VLKCS590
176600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               VLKCS590
176700     END-IF.                                                      VLKCS590
176800                                                                  VLKCS590
176900*----------------------------------------------------------------*VLKCS590
177000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *VLKCS590
177100*----------------------------------------------------------------*VLKCS590
177200 4420-FORMAT-LIST-LINES.                                          VLKCS590
177300                                                                  VLKCS590
177400     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ          CL**6
177500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                VLKCS590
177600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA   (PV-SUB)            CL**6
177700         MOVE SPACES             TO MR-SELECTI   (PV-SUB)            CL**6
177800                                    MR-ACTION    (PV-SUB)            CL**6
177900                                    MR-CODE-TYPE (PV-SUB)            CL**6
178000                                    MR-CODE-DESC (PV-SUB)         VLKCS590
178100     ELSE                                                         VLKCS590
178200         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          CL**6
178300                                                           > SPACE   CL**6
178400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS590
178500                                           TO MR-SELECTI (PV-SUB)    CL**6
178600         ELSE                                                     VLKCS590
178700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VLKCS590
178800                                           TO MR-SELECTI (PV-SUB)    CL**6
178900         END-IF                                                   VLKCS590
179000                                                                  VLKCS590
179100         IF DP030-SET-CURSOR-TRAILER                                 CL**6
179200             IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CL**6
179300                                                           > SPACE   CL**6
179400                OR PV-SUB = 1                                        CL**6
179500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE                 CL**6
179600                 MOVE -1 TO MR-SELECTL (PV-SUB)                      CL**6
179700             END-IF                                               VLKCS590
179800         END-IF                                                   VLKCS590
179900                                                                  VLKCS590
180000         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL               CL**6
180100             IF ASC-CODE-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) =              *5
180200                 VL005-TKT-FMT-ID                                         
180300                     MOVE 'ADD' TO MR-ACTION (PV-SUB)                     
180400             ELSE                                                         
180500                 MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)          *6
180600                                             TO MR-ACTION (PV-SUB)   CL**6
180700             END-IF                                                       
180800             MOVE ASC-CODE-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)           CL**5
180900                                          TO MR-CODE-TYPE (PV-SUB)   CL**6
181000             MOVE ASC-CODE-DESC (ASC-BLK-SUB ASC-ITEM-SUB)           CL**5
181100                                          TO MR-CODE-DESC (PV-SUB)   CL**6
181200                                                                        84
181300     END-IF.                                                      VLKCS590
181400                                                                     CL**6
181500     SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**6
181600                                                                     CL**6
181700     IF ASC-ITEM-SUB < + 1                                           CL**6
181800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  VLKCS590
181900         MOVE +1                 TO ASC-BLK-SUB                   VLKCS590
182000     END-IF.                                                      VLKCS590
182100                                                                  VLKCS590
182200******************************************************************VLKCS590
182300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **VLKCS590
182400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **VLKCS590
182500** ISSUE A WARNING.                                             **VLKCS590
182600******************************************************************VLKCS590
182700 4430-CHECK-FOR-BEGIN-AND-END.                                    VLKCS590
182800                                                                  VLKCS590
182900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VLKCS590
183000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VLKCS590
183100*            -- NO END-OF-RANGE SPECFIED ---                      VLKCS590
183200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            VLKCS590
183300             SET DP020-MSG-WARNING TO TRUE                        VLKCS590
183400             PERFORM 4431-POSITION-AT-WARNING                     VLKCS590
183500         END-IF                                                   VLKCS590
183600     ELSE                                                         VLKCS590
183700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     VLKCS590
183800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                VLKCS590
183900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            VLKCS590
184000             SET DP020-MSG-WARNING TO TRUE                        VLKCS590
184100             PERFORM 4431-POSITION-AT-WARNING                     VLKCS590
184200         END-IF                                                   VLKCS590
184300     END-IF.                                                      VLKCS590
184400                                                                  VLKCS590
184500******************************************************************VLKCS590
184600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **VLKCS590
184700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **VLKCS590
184800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **VLKCS590
184900** POSITION THE CURSOR THERE.                                   **VLKCS590
185000******************************************************************VLKCS590
185100 4431-POSITION-AT-WARNING.                                        VLKCS590
185200                                                                  VLKCS590
185300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VLKCS590
185400                    - PV-TOP-ITEM + 1.                            VLKCS590
185500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS590
185600         CONTINUE                                                 VLKCS590
185700     ELSE                                                         VLKCS590
185800         SET DP030-SET-CURSOR-APPL-1                              VLKCS590
185900                                   TO TRUE                        VLKCS590
186000         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS590
186100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS590
186200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VLKCS590
186300     END-IF.                                                      VLKCS590
186400                                                                  VLKCS590
186500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VLKCS590
186600                    - PV-TOP-ITEM + 1.                            VLKCS590
186700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS590
186800         CONTINUE                                                 VLKCS590
186900     ELSE                                                         VLKCS590
187000         SET DP030-SET-CURSOR-APPL-1                              VLKCS590
187100                                   TO TRUE                        VLKCS590
187200         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS590
187300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS590
187400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VLKCS590
187500     END-IF.                                                      VLKCS590
187600                                                                  VLKCS590
187700*----------------------------------------------------------------*VLKCS590
187800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *VLKCS590
187900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *VLKCS590
188000* FOR THE SELECTED ITEMS QUEUE.                                  *VLKCS590
188100*                                                                *VLKCS590
188200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *VLKCS590
188300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *VLKCS590
188400* THE ARRAY IS FULL.                                             *VLKCS590
188500*----------------------------------------------------------------*VLKCS590
188600 5000-PREPARE-SEL-QUEUE.                                          VLKCS590
188700                                                                  VLKCS590
188800     MOVE +1                   TO  ASC-BLK-SUB.                   VLKCS590
188900     PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS590
189000     ADD +1                    TO  ASC-BLK-SUB.                   VLKCS590
189100     PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS590
189200                                                                  VLKCS590
189300     MOVE ASC-SEL-QUEUE-NAME   TO  VL005-SEL-QUEUE-NAME.          VLKCS590
189400     PERFORM 6010-DELETE-SEL-QUEUE.                               VLKCS590
189500                                                                  VLKCS590
189600     SET ASC-UPDATE-TSQ        TO  TRUE.                          VLKCS590
189700                                                                  VLKCS590
189800     SET VL006-IDX             TO  1.                             VLKCS590
189900     MOVE ZERO                 TO VL005-NUMBER-OF-TS-ITEMS.       VLKCS590
190000     INITIALIZE VL006-SELECTED-ITEM-ARRAY.                        VLKCS590
190100                                                                  VLKCS590
190200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           VLKCS590
190300             VARYING PV-ITEM                                      VLKCS590
190400             FROM 1 BY 1                                          VLKCS590
190500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     VLKCS590
190600                                                                  VLKCS590
190700     IF  VL006-IDX > 1                                            VLKCS590
190800         PERFORM 5205-WRITE-SEL-QUEUE                             VLKCS590
190900         ADD +1                TO VL005-NUMBER-OF-TS-ITEMS        VLKCS590
191000     END-IF.                                                      VLKCS590
191100                                                                  VLKCS590
191200*----------------------------------------------------------------*VLKCS590
191300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *VLKCS590
191400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *VLKCS590
191500*----------------------------------------------------------------*VLKCS590
191600 5100-WRITE-TEMP-STORAGE.                                         VLKCS590
191700                                                                  VLKCS590
191800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     VLKCS590
191900                                   TO PV-LIST-ITEM-NUMBER.        VLKCS590
192000     COMPUTE PV-BLOCK-NUMBER =                                    VLKCS590
192100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS590
192200                                                                  VLKCS590
192300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS590
192400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS590
192500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      VLKCS590
192600             PERFORM 5105-REWRITE-ASC-LISTQ                       VLKCS590
192700         END-IF                                                   VLKCS590
192800     ELSE                                                         VLKCS590
192900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       VLKCS590
193000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            VLKCS590
193100         PERFORM 5110-WRITE-ASC-LISTQ                             VLKCS590
193200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   VLKCS590
193300     END-IF.                                                      VLKCS590
193400                                                                  VLKCS590
193500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS590
193600******************************************************************VLKCS590
193700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **VLKCS590
193800** SPECIFIC COMMAREA.                                           **VLKCS590
193900******************************************************************VLKCS590
194000 5105-REWRITE-ASC-LISTQ.                                          VLKCS590
194100                                                                  VLKCS590
194200     EXEC CICS                                                    VLKCS590
194300         WRITEQ TS                                                VLKCS590
194400             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS590
194500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS590
194600             ITEM  (PV-BLOCK-NUMBER)                              VLKCS590
194700             REWRITE                                              VLKCS590
194800             RESP  (PV-CICS-RESP)                                 VLKCS590
194900     END-EXEC.                                                    VLKCS590
195000                                                                  VLKCS590
195100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           VLKCS590
195200         CONTINUE                                                 VLKCS590
195300     ELSE                                                         VLKCS590
195400         SET DP013-CICS-ABEND            TO TRUE                  VLKCS590
195500         SET DP013-NO-ROLLBACK           TO TRUE                  VLKCS590
195600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       VLKCS590
195700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     VLKCS590
195800                                         TO DP013-MESSAGE-TEXT(1) VLKCS590
195900         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
196000     END-IF.                                                      VLKCS590
196100                                                                  VLKCS590
196200******************************************************************VLKCS590
196300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **VLKCS590
196400** SPECIFIC COMMAREA.                                           **VLKCS590
196500******************************************************************VLKCS590
196600 5110-WRITE-ASC-LISTQ.                                            VLKCS590
196700                                                                  VLKCS590
196800     EXEC CICS                                                    VLKCS590
196900         WRITEQ TS                                                VLKCS590
197000             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS590
197100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS590
197200             ITEM  (PV-BLOCK-NUMBER)                              VLKCS590
197300             RESP  (PV-CICS-RESP)                                 VLKCS590
197400     END-EXEC.                                                    VLKCS590
197500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      VLKCS590
197600         SET DP013-CICS-ABEND      TO TRUE                        VLKCS590
197700         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS590
197800         MOVE '5110-WRITE-ASC-LISTQ'                              VLKCS590
197900                                   TO DP013-PARAGRAPH             VLKCS590
198000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VLKCS590
198100                                   TO DP013-MESSAGE-TEXT(1)       VLKCS590
198200         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
198300     END-IF.                                                      VLKCS590
198400                                                                  VLKCS590
198500*----------------------------------------------------------------*VLKCS590
198600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *VLKCS590
198700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *VLKCS590
198800*----------------------------------------------------------------*VLKCS590
198900 5200-FILL-SEL-QUEUE-RECORD.                                      VLKCS590
199000                                                                  VLKCS590
199100     PERFORM 6112-READ-LIST-QUEUE.                                VLKCS590
199200                                                                  VLKCS590
199300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       VLKCS590
199400         PERFORM                                                  VLKCS590
199500         VARYING LQW-IDX                                          VLKCS590
199600         FROM 1 BY 1                                              VLKCS590
199700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            VLKCS590
199800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          VLKCS590
199900                                                                  VLKCS590
200000             IF  LQW-SELECT (LQW-IDX)                             VLKCS590
200100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              VLKCS590
200200                                   TO VL006-ITEM (VL006-IDX)      VLKCS590
200400                 MOVE LQW-CODE-DESC (LQW-IDX)                           84
200500*                          TO VL006-TKT-FMT-DESC   (VL006-IDX)          84
200600                           TO VL005-TKT-FMT-DESC                        84
200700                 MOVE SPACE        TO VL006-ACTION-SW (VL006-IDX) VLKCS590
200800                 SET VL006-IDX UP BY 1                            VLKCS590
200900                 IF  VL006-IDX > VL006-MAX-ITEMS                  VLKCS590
201000                     PERFORM 5205-WRITE-SEL-QUEUE                 VLKCS590
201100                     ADD +1        TO VL005-NUMBER-OF-TS-ITEMS    VLKCS590
201200                     INITIALIZE VL006-SELECTED-ITEM-ARRAY         VLKCS590
201300                     SET VL006-IDX TO  1                          VLKCS590
201400                 END-IF                                           VLKCS590
201500             END-IF                                               VLKCS590
201600         END-PERFORM                                              VLKCS590
201700     END-IF.                                                      VLKCS590
201800                                                                  VLKCS590
201900*----------------------------------------------------------------*VLKCS590
202000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *VLKCS590
202100*----------------------------------------------------------------*VLKCS590
202200 5205-WRITE-SEL-QUEUE.                                            VLKCS590
202300                                                                  VLKCS590
202400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VLKCS590
202500                                   TO VL006-SELECTED-ITEMS.       VLKCS590
202600                                                                  VLKCS590
202700     EXEC CICS                                                    VLKCS590
202800          WRITEQ TS                                               VLKCS590
202900              QUEUE (ASC-SEL-QUEUE-NAME)                          VLKCS590
203000              FROM  (VL006-LINE-SEL-REC)                                84
203100              ITEM  (PV-SEL-QUEUE-ITEM)                           VLKCS590
203200              RESP  (PV-CICS-RESP)                                VLKCS590
203300     END-EXEC.                                                    VLKCS590
203400                                                                  VLKCS590
203500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS590
203600         CONTINUE                                                 VLKCS590
203700     ELSE                                                         VLKCS590
203800         SET DP013-CICS-ABEND      TO TRUE                        VLKCS590
203900         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS590
204000         MOVE '5205-WRITE-SEL-QUEUE'                              VLKCS590
204100                                   TO DP013-PARAGRAPH             VLKCS590
204200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          VLKCS590
204300                                   TO DP013-MESSAGE-TEXT(1)       VLKCS590
204400         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
204500     END-IF.                                                      VLKCS590
204600                                                                  VLKCS590
204700******************************************************************VLKCS590
204800** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **VLKCS590
204900** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **VLKCS590
205000** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **VLKCS590
205100** THE USER.                                                    **VLKCS590
205200******************************************************************VLKCS590
205300 6000-REFRESH-PANEL-FROM-TEMP.                                    VLKCS590
205400                                                                  VLKCS590
205500     IF  ASC-UPDATE-TSQ                                           VLKCS590
205600         SET ASC-NO-TSQ-UPDATE TO TRUE                            VLKCS590
205700         MOVE ZERO                 TO PV-SAVE-ITEM                VLKCS590
205800                                      PV-SEL-QUEUE-ITEM           VLKCS590
205900*        MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        VLKCS590
206000*                                  TO PV-HOLD-SELECTED-ITEMS      VLKCS590
206100         PERFORM 6100-UPDATE-TSQ                                  VLKCS590
206200             UNTIL PV-ITEMS-PROCESSED >                           VLKCS590
206300                                     ASC-NUMBER-OF-SELECTED-ITEMS VLKCS590
206400         PERFORM 6010-DELETE-SEL-QUEUE                            VLKCS590
206500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         VLKCS590
206600                    ASC-BLOCK-ENTRIES (2)                         VLKCS590
206700******ADDED                                                               
206800         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 RCK00050
206900                GIVING PV-BLOCK-NUMBER                            RCK00050
207000                REMAINDER PV-REMAINDER                            RCK00050
207100         IF  PV-REMAINDER > ZERO                                  RCK00050
207200             ADD +1     TO PV-BLOCK-NUMBER                        RCK00050
207300         END-IF                                                   RCK00050
207400         MOVE +1        TO ASC-BLK-SUB                            RCK00050
207500         PERFORM 4410-READ-TEMP-STORAGE                           RCK00050
207600         ADD +1         TO ASC-BLK-SUB                            RCK00050
207700                           PV-BLOCK-NUMBER                        RCK00050
207800         PERFORM 4410-READ-TEMP-STORAGE                           RCK00050
207900                                                                  RCK00050
208000     END-IF.                                                      RCK00050
208100                                                                        84
208200******ADDED                                                               
208300                                                                  VLKCS590
208400*----------------------------------------------------------------*VLKCS590
208500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *VLKCS590
208600*----------------------------------------------------------------*VLKCS590
208700 6010-DELETE-SEL-QUEUE.                                           VLKCS590
208800                                                                  VLKCS590
208900     EXEC CICS                                                    VLKCS590
209000         DELETEQ TS                                               VLKCS590
209100             QUEUE (ASC-SEL-QUEUE-NAME)                           VLKCS590
209200             RESP  (PV-CICS-RESP)                                 VLKCS590
209300     END-EXEC.                                                    VLKCS590
209400                                                                  VLKCS590
209500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      VLKCS590
209600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         VLKCS590
209700         CONTINUE                                                 VLKCS590
209800     ELSE                                                         VLKCS590
209900         SET DP013-CICS-ABEND TO TRUE                             VLKCS590
210000         SET DP013-NO-ROLLBACK TO TRUE                            VLKCS590
210100         MOVE '6010-DELETE-SEL-QUEUE'                             VLKCS590
210200                        TO DP013-PARAGRAPH                        VLKCS590
210300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         VLKCS590
210400                        TO DP013-MESSAGE-TEXT (1)                 VLKCS590
210500         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
210600     END-IF.                                                      VLKCS590
210700                                                                  VLKCS590
210800*----------------------------------------------------------------*VLKCS590
210900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *VLKCS590
211000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *VLKCS590
211100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *VLKCS590
211200*    THE TEMP QUEUE.                                             *VLKCS590
211300*----------------------------------------------------------------*VLKCS590
211400 6100-UPDATE-TSQ.                                                 VLKCS590
211500                                                                  VLKCS590
211600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             VLKCS590
211700     PERFORM 6105-READ-SEL-QUEUE.                                 VLKCS590
211800     PERFORM                                                      VLKCS590
211900         VARYING VL006-IDX                                        VLKCS590
212000         FROM 1 BY 1                                              VLKCS590
212100         UNTIL ((PV-ITEMS-PROCESSED >                             VLKCS590
212200                              PV-HOLD-SELECTED-ITEMS)             VLKCS590
212300         OR (VL006-IDX GREATER THAN VL006-MAX-ITEMS))             VLKCS590
212400         IF  VL006-ACTION-SW (VL006-IDX) > SPACE                  VLKCS590
212500             PERFORM 6110-PROCESS-ITEMS                           VLKCS590
212600         END-IF                                                   VLKCS590
212700         ADD +1                TO PV-ITEMS-PROCESSED              VLKCS590
212800     END-PERFORM.                                                 VLKCS590
212900                                                                  VLKCS590
213000     PERFORM 6111-WRITE-LIST-QUEUE.                               VLKCS590
213100                                                                  VLKCS590
213200*----------------------------------------------------------------*VLKCS590
213300*    READ THE LIST QUEUE RECORD.                                 *VLKCS590
213400*----------------------------------------------------------------*VLKCS590
213500 6105-READ-SEL-QUEUE.                                             VLKCS590
213600                                                                  VLKCS590
213700     EXEC CICS                                                    VLKCS590
213800          READQ TS                                                VLKCS590
213900              QUEUE (ASC-SEL-QUEUE-NAME)                          VLKCS590
214000              INTO  (VL006-LINE-SEL-REC)                                84
214100              ITEM  (PV-SEL-QUEUE-ITEM)                           VLKCS590
214200              RESP  (PV-CICS-RESP)                                VLKCS590
214300     END-EXEC.                                                    VLKCS590
214400                                                                  VLKCS590
214500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS590
214600         CONTINUE                                                 VLKCS590
214700     ELSE                                                         VLKCS590
214800         SET DP013-CICS-ABEND      TO  TRUE                       VLKCS590
214900         SET DP013-NO-ROLLBACK     TO  TRUE                       VLKCS590
215000         MOVE '6105-READ-SEL-QUEUE'                               VLKCS590
215100                                   TO  DP013-PARAGRAPH            VLKCS590
215200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           VLKCS590
215300                                   TO  DP013-MESSAGE-TEXT(1)      VLKCS590
215400         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
215500     END-IF.                                                      VLKCS590
215600                                                                  VLKCS590
215700*----------------------------------------------------------------*VLKCS590
215800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*VLKCS590
215900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*VLKCS590
216000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *VLKCS590
216100*----------------------------------------------------------------*VLKCS590
216200 6110-PROCESS-ITEMS.                                              VLKCS590
216300                                                                  VLKCS590
216400     COMPUTE PV-ITEM = 1 + ((VL006-ITEM (VL006-IDX) - 1)          VLKCS590
216500                     / PC-ITEMS-PER-PANEL).                       VLKCS590
216600                                                                  VLKCS590
216700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           VLKCS590
216800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          VLKCS590
216900             PERFORM 6111-WRITE-LIST-QUEUE                        VLKCS590
217000         END-IF                                                   VLKCS590
217100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    VLKCS590
217200                                                                  VLKCS590
217300         PERFORM 6112-READ-LIST-QUEUE                             VLKCS590
217400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               VLKCS590
217500             CONTINUE                                             VLKCS590
217600         END-IF                                                   VLKCS590
217700     END-IF.                                                      VLKCS590
217800                                                                  VLKCS590
217900     COMPUTE PV-SUB = (VL006-ITEM (VL006-IDX)                     VLKCS590
218000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              VLKCS590
218100     SET LQW-DESELECT (PV-SUB) TO    TRUE                         VLKCS590
218200     MOVE LQW-SELECTED-SW (PV-SUB)                                VLKCS590
218300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  VLKCS590
218400     EVALUATE TRUE                                                VLKCS590
218500         WHEN VL006-INQ (VL006-IDX)                               VLKCS590
218600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             VLKCS590
218700                                                                  VLKCS590
218800         WHEN VL006-UPD (VL006-IDX)                               VLKCS590
218900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             VLKCS590
219000                                                                  VLKCS590
219100         WHEN VL006-DEL (VL006-IDX)                               VLKCS590
219200              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             VLKCS590
219300                                                                  VLKCS590
219400         WHEN VL006-ERR (VL006-IDX)                               VLKCS590
219500              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             VLKCS590
219600     END-EVALUATE.                                                VLKCS590
219700                                                                  VLKCS590
219800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                VLKCS590
219900                                                                  VLKCS590
220000*----------------------------------------------------------------*VLKCS590
220100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *VLKCS590
220200*----------------------------------------------------------------*VLKCS590
220300 6111-WRITE-LIST-QUEUE.                                           VLKCS590
220400                                                                  VLKCS590
220500     EXEC CICS                                                    VLKCS590
220600         WRITEQ TS                                                VLKCS590
220700             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS590
220800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     VLKCS590
220900             ITEM  (PV-SAVE-ITEM)                                 VLKCS590
221000             REWRITE                                              VLKCS590
221100             RESP  (PV-CICS-RESP)                                 VLKCS590
221200     END-EXEC.                                                    VLKCS590
221300                                                                  VLKCS590
221400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS590
221500         CONTINUE                                                 VLKCS590
221600     ELSE                                                         VLKCS590
221700         SET DP013-CICS-ABEND  TO  TRUE                           VLKCS590
221800         SET DP013-NO-ROLLBACK TO  TRUE                           VLKCS590
221900         MOVE '6111-WRITE-LIST-QUEUE'                             VLKCS590
222000                               TO  DP013-PARAGRAPH                VLKCS590
222100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  VLKCS590
222200                               TO  DP013-MESSAGE-TEXT(1)          VLKCS590
222300         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
222400     END-IF.                                                      VLKCS590
222500                                                                  VLKCS590
222600*----------------------------------------------------------------*VLKCS590
222700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*VLKCS590
222800*----------------------------------------------------------------*VLKCS590
222900 6112-READ-LIST-QUEUE.                                            VLKCS590
223000                                                                  VLKCS590
223100     EXEC CICS                                                    VLKCS590
223200         READQ TS                                                 VLKCS590
223300             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS590
223400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     VLKCS590
223500             ITEM  (PV-ITEM)                                      VLKCS590
223600             RESP  (PV-CICS-RESP)                                 VLKCS590
223700     END-EXEC.                                                    VLKCS590
223800                                                                  VLKCS590
223900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS590
224000         CONTINUE                                                 VLKCS590
224100     ELSE                                                         VLKCS590
224200         SET DP013-CICS-ABEND        TO TRUE                      VLKCS590
224300         SET DP013-NO-ROLLBACK       TO TRUE                      VLKCS590
224400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           VLKCS590
224500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    VLKCS590
224600                                     TO DP013-MESSAGE-TEXT(1)     VLKCS590
224700         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS590
224800     END-IF.                                                      VLKCS590
224900                                                                  VLKCS590
225000*----------------------------------------------------------------*VLKCS590
225100*    ABEND PROCESSOR MODULE                                      *VLKCS590
225200*----------------------------------------------------------------*VLKCS590
225300     COPY DPPD013.                                                VLKCS590
