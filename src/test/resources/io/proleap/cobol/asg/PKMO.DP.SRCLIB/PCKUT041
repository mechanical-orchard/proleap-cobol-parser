000100 IDENTIFICATION DIVISION.                                         00010018
000200 TITLE 'SEPARATE STORE EXPECTED DETAILS BY DATE'.                 00020018
000300                                                                  00030018
000400 PROGRAM-ID.             PCKUT041.                                00040018
000500 AUTHOR.                 DENNIS STEFFEN.                          00050018
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060018
000700 DATE-WRITTEN            APRIL 2005.                              00070018
000800 DATE-COMPILED.                                                   00080018
000900                                                                  00090018
001000 ENVIRONMENT DIVISION.                                            00100018
001100 CONFIGURATION SECTION.                                           00110018
001200                                                                  00120018
001300 SOURCE-COMPUTER.        IBM-3090.                                00130018
001400 OBJECT-COMPUTER.        IBM-3090.                                00140018
001500                                                                  00150018
001600 INPUT-OUTPUT SECTION.                                            00160018
001700                                                                  00170018
001800 FILE-CONTROL.                                                    00180018
001900                                                                  00190018
002000     SELECT UNBALANCED-SUMMARY-FILE                               00200018
002100         ASSIGN TO INP01.                                         00210018
002200                                                                  00220018
002300     SELECT PO-SUMMARY-FILE                                       00230018
002400         ASSIGN TO INP02.                                         00240018
002500                                                                  00250018
002600     SELECT STORE-EXPECTED-GT-90                                  00260018
002700         ASSIGN TO OUT01.                                         00270018
002800                                                                  00280018
002900     SELECT STORE-EXPECTED-BETWEEN-DATES                          00290018
003000         ASSIGN TO OUT02.                                         00300018
003100                                                                  00310018
003200     SELECT STORE-SKIPPED-FILE                                    00320018
003300         ASSIGN TO OUT03.                                         00330018
003400                                                                  00340018
003500 DATA DIVISION.                                                   00350018
003600 FILE SECTION.                                                    00360018
003700                                                                  00370018
003800 FD  UNBALANCED-SUMMARY-FILE                                      00380018
003900     RECORDING MODE IS F                                          00390018
004000     LABEL RECORDS ARE STANDARD                                   00400018
004100     BLOCK CONTAINS 0 RECORDS.                                    00410018
004200                                                                  00420018
004300 01  UNBALANCED-SUMMARY-REC           PIC X(035).                 00430018
004400                                                                  00440018
004500 FD  PO-SUMMARY-FILE                                              00450018
004600     RECORDING MODE IS F                                          00460018
004700     LABEL RECORDS ARE STANDARD                                   00470018
004800     BLOCK CONTAINS 0 RECORDS.                                    00480018
004900                                                                  00490018
005000 01  ALL-TYPE-SE-RECORD               PIC  X(070).                00500018
005100                                                                  00510018
005200 FD  STORE-EXPECTED-GT-90                                         00520018
005300     RECORDING MODE IS F                                          00530018
005400     LABEL RECORDS ARE STANDARD                                   00540018
005500     BLOCK CONTAINS 0 RECORDS.                                    00550018
005600                                                                  00560018
005700 01  STORE-EXPECTED-GT-90-REC         PIC X(035).                 00570018
005800                                                                  00580018
005900 FD  STORE-EXPECTED-BETWEEN-DATES                                 00590018
006000     RECORDING MODE IS F                                          00600018
006100     LABEL RECORDS ARE STANDARD                                   00610018
006200     BLOCK CONTAINS 0 RECORDS.                                    00620018
006300                                                                  00630018
006400 01  STORE-EXPECT-BETWEEN-DATES-REC   PIC X(035).                 00640018
006500                                                                  00650018
006600 FD  STORE-SKIPPED-FILE                                           00660018
006700     RECORDING MODE IS F                                          00670018
006800     LABEL RECORDS ARE STANDARD                                   00680018
006900     BLOCK CONTAINS 0 RECORDS.                                    00690018
007000                                                                  00700018
007100 01  STORE-SKIPPED-REC                PIC X(035).                 00710018
007200                                                                  00720018
007300 WORKING-STORAGE SECTION.                                         00730018
007400                                                                  00740018
007500 01  FILLER.                                                      00750018
007600     05  FILLER                      PIC  X(36)    VALUE          00760018
007700         ' ***** WORKING STORAGE PGM=PCKUT041 '.                  00770018
007800     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00780018
007900                                                                  00790018
008000 01  PS-SWITCHES.                                                 00800018
008100     05  PS-EOF-UNBAL-SW              PIC X(01) VALUE 'N'.        00810018
008200         88  PS-EOF-UNBAL-YES                   VALUE 'Y'.        00820018
008300         88  PS-EOF-UNBAL-NO                    VALUE 'N'.        00830018
008400     05  PS-EOF-SUMMRY-SW             PIC X(01) VALUE 'N'.        00840018
008500         88  PS-EOF-SUMMRY-YES                  VALUE 'Y'.        00850018
008600         88  PS-EOF-SUMMRY-NO                   VALUE 'N'.        00860018
008700     05  PS-DETAIL-CATCHUP-SW         PIC X(01) VALUE 'N'.        00870018
008800         88  PS-DETAIL-CATCHUP-YES              VALUE 'Y'.        00880018
008900         88  PS-DETAIL-CATCHUP-NO               VALUE 'N'.        00890018
009000                                                                  00900018
009100 01  PV-SYSIN-CARD.                                               00910018
009200     05  PV-SYSIN-DATE                PIC X(10).                  00920018
009300     05  FILLER                       PIC X(01).                  00930018
009400     05  PV-SYSIN-OUT02-SW            PIC X(01).                  00940018
009500         88  PV-SYSIN-WRITE-OUT02-YES     VALUES 'Y', SPACE,      00950018
009600                                               LOW-VALUES.        00960018
009700         88  PV-SYSIN-WRITE-OUT02-NO      VALUE 'N'.              00970018
009800                                                                  00980018
009900                                                                  00990018
010000*        THESE KEYS CONTROL THE INNER LOOP OF PO/RCVR/UPC/LOC     01000018
010100 01  PV-INNER-KEYS.                                               01010018
010200     05  PV-SUMMRY-KEY.                                           01020018
010300         10  PV-SUMMRY-PO             PIC 9(10) VALUE ZERO.       01030018
010400         10  PV-SUMMRY-RCVR           PIC S9(10) VALUE ZERO.      01040018
010500                                                                  01050018
010600     05  PV-UNBAL-KEY.                                            01060018
010700         10  PV-UNBAL-PO              PIC 9(10) VALUE ZERO.       01070018
010800         10  PV-UNBAL-RCVR            PIC S9(10) VALUE ZERO.      01080018
010900                                                                  01090018
011000/                                                                 01100018
011100 01  PC-CONSTANTS.                                                01110018
011200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01120018
011300                                                   'PCKUT041'.    01130018
011400     05  PC-ILBOABN0                 PIC  X(08)    VALUE          01140018
011500                                                   'ILBOABN0'.    01150018
011600     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3      01160018
011700                                                   COMP.          01170018
011800                                                                  01180018
011900 01  PV-MISC-STUFF.                                               01190018
012000     05  PV-NEAR-DATE                 PIC  X(10).                 01200018
012100     05  PV-FAR-DATE                  PIC  X(10).                 01210018
012200     05  PV-BOSS-FAR-DATE             PIC  X(10).                 01220018
012300     05  PV-BOSS-NEAR-DATE            PIC  X(10).                 01230018
012400     05  PV-BOSS-PARM-RECV            PIC S9(09)  COMP.           01240018
012500     05  PV-BOSS-PARM-DISP            PIC -9(04).                 01250018
012501                                                                  01250119
012502* SEPHORA CLEAN DATES                                             01250220
012503*         SEPH-SUPP - WHEN RECEIVER WORKED AT SUPPORTING DC       01250320
012504*         SEPH-DIFF - WHEN RECEIVER WORKED AT A DIFFERENT DC      01250420
012505*                     THE THE SUPPORTING DC                       01250520
012510     05  PV-SEPH-SUPP-FAR-DATE        PIC  X(10).                 01251019
012520     05  PV-SEPH-SUPP-NEAR-DATE       PIC  X(10).                 01252019
012530     05  PV-SEPH-SUPP-PARM-RECV       PIC S9(09)  COMP.           01253019
012540     05  PV-SEPH-SUPP-PARM-DISP       PIC -9(04).                 01254019
012541     05  PV-SEPH-DIFF-FAR-DATE        PIC  X(10).                 01254119
012542     05  PV-SEPH-DIFF-NEAR-DATE       PIC  X(10).                 01254219
012543     05  PV-SEPH-DIFF-PARM-RECV       PIC S9(09)  COMP.           01254319
012544     05  PV-SEPH-DIFF-PARM-DISP       PIC -9(04).                 01254419
012550                                                                  01255019
012600     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    01260018
012700     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     01270018
012800     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      01280018
012900     05  PV-COMP-10                   PIC S9(10) VALUE ZERO       01290018
013000                                                   COMP SYNC.     01300018
013100     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01310018
013200                                                   COMP SYNC.     01320018
013300     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01330018
013400                                                   COMP SYNC.     01340018
013500     05  PV-READ-COUNTER-DTL          PIC S9(09) COMP-3           01350018
013600                                              VALUE ZERO.         01360018
013700     05  PV-READ-COUNTER-SUM          PIC S9(09) COMP-3           01370018
013800                                              VALUE ZERO.         01380018
013900     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3           01390018
014000                                              VALUE ZERO.         01400018
014100     05  PV-WRITE-1B-COUNTER          PIC S9(09) COMP-3           01410018
014200                                              VALUE ZERO.         01420018
014201                                                                  01420119
014202* COUNTERS SEPH-SUPP - WHEN RECEIVER WORKED AT SUPPORTING DC      01420220
014210     05  PV-WRITE-1C-COUNTER          PIC S9(09) COMP-3           01421019
014220                                              VALUE ZERO.         01422019
014230     05  PV-WRITE-1D-COUNTER          PIC S9(09) COMP-3           01423019
014240                                              VALUE ZERO.         01424019
014250                                                                  01425019
014300     05  PV-WRITE-2-COUNTER           PIC S9(09) COMP-3           01430018
014400                                              VALUE ZERO.         01440018
014500     05  PV-WRITE-2B-COUNTER          PIC S9(09) COMP-3           01450018
014600                                              VALUE ZERO.         01460018
014601                                                                  01460119
014602* COUNTERS SEPH-DIFF - WHEN RECEIVER WORKED AT A DIFFERENT DC     01460220
014610     05  PV-WRITE-2C-COUNTER          PIC S9(09) COMP-3           01461019
014620                                              VALUE ZERO.         01462019
014630     05  PV-WRITE-2D-COUNTER          PIC S9(09) COMP-3           01463019
014640                                              VALUE ZERO.         01464019
014650                                                                  01465019
014700     05  PV-WRITE-6-COUNTER           PIC S9(09) COMP-3           01470018
014800                                              VALUE ZERO.         01480018
014900     05  PV-SKIP-COUNT                PIC S9(09) COMP-3           01490018
015000                                              VALUE ZERO.         01500018
015010     05  PV-SKIP-COUNT-B              PIC S9(09) COMP-3           01501040
015020                                              VALUE ZERO.         01502040
015030     05  PV-SKIP-COUNT-C              PIC S9(09) COMP-3           01503040
015040                                              VALUE ZERO.         01504040
015050     05  PV-SKIP-COUNT-D              PIC S9(09) COMP-3           01505040
015060                                              VALUE ZERO.         01506040
015100     05  PV-BYPASS-COUNT              PIC S9(09) COMP-3           01510018
015200                                              VALUE ZERO.         01520018
015300     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            01530018
015400     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     01540018
015500     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     01550018
015600                                                                  01560018
015700 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01570018
015800                                                     COMP SYNC.   01580018
015900     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01590018
016000     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01600018
016100     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01610018
016200     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01620018
016300     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01630018
016400     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01640018
016500     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01650018
016600     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01660018
016700     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01670018
016800     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01680018
016900                                                                  01690018
017000 01  PV-COUNT-MSG-1.                                              01700018
017100     05  FILLER                       PIC X(39) VALUE             01710018
017200         ' RECORDS WRITTEN TO OUT01 (OLDER THAN '.                01720018
017300     05  PV-MSG-1-LIT                 PIC X(10).                  01730018
017400     05  FILLER                       PIC X(20) VALUE             01740018
017500         ')  = '.                                                 01750018
017600     05  PV-MSG-1-COUNT               PIC ZZZ,ZZZ,ZZ9.            01760018
017700                                                                  01770018
017800 01  PV-COUNT-MSG-1B.                                             01780018
017900     05  FILLER                      PIC X(39) VALUE              01790018
018000         'BOSS RECS WRITTEN TO OUT01 (OLDER THAN '.               01800018
018100     05  PV-MSG-1B-LIT                PIC X(10).                  01810018
018200     05  FILLER                       PIC X(20) VALUE             01820018
018300         ')  = '.                                                 01830018
018400     05  PV-MSG-1B-COUNT              PIC ZZZ,ZZZ,ZZ9.            01840018
018500                                                                  01850018
018510                                                                  01851019
018520 01  PV-COUNT-MSG-1C.                                             01852019
018530     05  FILLER                      PIC X(39) VALUE              01853019
018540         'SEPHORA-SUPPRT DC TO OUT01 (OLDER THAN '.               01854019
018550     05  PV-MSG-1C-LIT                PIC X(10).                  01855019
018560     05  FILLER                       PIC X(20) VALUE             01856019
018570         ')  = '.                                                 01857019
018580     05  PV-MSG-1C-COUNT              PIC ZZZ,ZZZ,ZZ9.            01858019
018590                                                                  01859019
018591                                                                  01859119
018592 01  PV-COUNT-MSG-1D.                                             01859219
018593     05  FILLER                      PIC X(39) VALUE              01859319
018594         'SEPHORA-OTHER DC  TO OUT01 (OLDER THAN '.               01859419
018595     05  PV-MSG-1D-LIT                PIC X(10).                  01859519
018596     05  FILLER                       PIC X(20) VALUE             01859619
018597         ')  = '.                                                 01859719
018598     05  PV-MSG-1D-COUNT              PIC ZZZ,ZZZ,ZZ9.            01859819
018599                                                                  01859919
018600 01  PV-COUNT-MSG-2.                                              01860018
018700     05  FILLER                       PIC X(36) VALUE             01870018
018800         '  RECORDS WRITTEN TO OUT02 (BETWEEN '.                  01880018
018900     05  PV-MSG-2-LIT1                PIC X(10).                  01890018
019000     05  FILLER                       PIC X(05) VALUE             01900018
019100         ' AND '.                                                 01910018
019200     05  PV-MSG-2-LIT2                PIC X(10).                  01920018
019300     05  FILLER                       PIC X(08) VALUE             01930018
019400         ' ) = '.                                                 01940018
019500     05  PV-MSG-2-COUNT2              PIC ZZZ,ZZZ,ZZ9.            01950018
019600                                                                  01960018
019700 01  PV-COUNT-MSG-2B.                                             01970018
019800     05  FILLER                       PIC X(36) VALUE             01980018
019900         'BOSS RECS WRITTEN TO OUT02 (BETWEEN '.                  01990018
020000     05  PV-MSG-2B-LIT1               PIC X(10).                  02000018
020100     05  FILLER                       PIC X(05) VALUE             02010018
020200         ' AND '.                                                 02020018
020300     05  PV-MSG-2B-LIT2               PIC X(10).                  02030018
020400     05  FILLER                       PIC X(08) VALUE             02040018
020500         ' ) = '.                                                 02050018
020600     05  PV-MSG-2B-COUNT2             PIC ZZZ,ZZZ,ZZ9.            02060018
020700                                                                  02070018
020710                                                                  02071019
020720 01  PV-COUNT-MSG-2C.                                             02072019
020730     05  FILLER                       PIC X(36) VALUE             02073019
020740         'SEPHORA-SUPPRT DC TO OUT02 (BETWEEN '.                  02074019
020750     05  PV-MSG-2C-LIT1               PIC X(10).                  02075019
020760     05  FILLER                       PIC X(05) VALUE             02076019
020770         ' AND '.                                                 02077019
020780     05  PV-MSG-2C-LIT2               PIC X(10).                  02078019
020790     05  FILLER                       PIC X(08) VALUE             02079019
020791         ' ) = '.                                                 02079119
020792     05  PV-MSG-2C-COUNT2             PIC ZZZ,ZZZ,ZZ9.            02079219
020793                                                                  02079319
020794 01  PV-COUNT-MSG-2D.                                             02079419
020795     05  FILLER                       PIC X(36) VALUE             02079519
020796         'SEPHORA-OTHER DC  TO OUT02 (BETWEEN '.                  02079619
020797     05  PV-MSG-2D-LIT1               PIC X(10).                  02079719
020798     05  FILLER                       PIC X(05) VALUE             02079819
020799         ' AND '.                                                 02079919
020800     05  PV-MSG-2D-LIT2               PIC X(10).                  02080019
020801     05  FILLER                       PIC X(08) VALUE             02080119
020802         ' ) = '.                                                 02080219
020803     05  PV-MSG-2D-COUNT2             PIC ZZZ,ZZZ,ZZ9.            02080319
020804                                                                  02080419
020810 01  PV-COUNT-MSG-3.                                              02081018
020900     05  FILLER                       PIC X(24) VALUE             02090040
021000         'RECORDS LATER THAN '.                                   02100018
021100     05  PV-MIN-DATE-PARM             PIC X(10) VALUE SPACES.     02110018
021200     05  FILLER                       PIC X(09) VALUE ' (OUT03) '.02120018
021300     05  FILLER                       PIC X(26) VALUE SPACES.     02130040
021400     05  PV-MSG-SKIP-COUNT            PIC ZZZ,ZZZ,ZZ9.            02140018
021500                                                                  02150018
021510 01  PV-COUNT-MSG-3B.                                             02151040
021520     05  FILLER                       PIC X(24) VALUE             02152040
021530         'BOSS RECORDS LATER THAN '.                              02153040
021540     05  PV-MIN-DATE-PARM-3B          PIC X(10) VALUE SPACES.     02154040
021550     05  FILLER                       PIC X(09) VALUE ' (OUT03) '.02155040
021560     05  FILLER                       PIC X(26) VALUE SPACES.     02156040
021570     05  PV-MSG-SKIP-COUNT-3B         PIC ZZZ,ZZZ,ZZ9.            02157040
021580                                                                  02158040
021590 01  PV-COUNT-MSG-3C.                                             02159040
021591     05  FILLER                       PIC X(24) VALUE             02159140
021592         'SEPH-SUPP DC LATER THAN '.                              02159240
021593     05  PV-MIN-DATE-PARM-3C          PIC X(10) VALUE SPACES.     02159340
021594     05  FILLER                       PIC X(09) VALUE ' (OUT03) '.02159440
021595     05  FILLER                       PIC X(26) VALUE SPACES.     02159540
021596     05  PV-MSG-SKIP-COUNT-3C         PIC ZZZ,ZZZ,ZZ9.            02159640
021597                                                                  02159740
021598 01  PV-COUNT-MSG-3D.                                             02159840
021599     05  FILLER                       PIC X(24) VALUE             02159940
021600         'SEPH-OTHR DC LATER THAN '.                              02160040
021601     05  PV-MIN-DATE-PARM-3D          PIC X(10) VALUE SPACES.     02160140
021602     05  FILLER                       PIC X(09) VALUE ' (OUT03) '.02160240
021603     05  FILLER                       PIC X(26) VALUE SPACES.     02160340
021604     05  PV-MSG-SKIP-COUNT-3D         PIC ZZZ,ZZZ,ZZ9.            02160440
021605                                                                  02160540
021610 01  PV-COUNT-MSG-4.                                              02161018
021700     05  FILLER                       PIC X(35) VALUE             02170018
021800         'SUMMRY RECORDS READ (INP02) =     '.                    02180018
021900     05  FILLER                       PIC X(34) VALUE             02190018
022000         SPACES.                                                  02200018
022100     05  PV-MSG-READ-COUNT            PIC ZZZ,ZZZ,ZZ9.            02210018
022200                                                                  02220018
022300 01  PV-COUNT-MSG-5.                                              02230018
022400     05  FILLER                       PIC X(35) VALUE             02240018
022500         'OUT OF BALANCE RECS READ (INP01) ='.                    02250018
022600     05  FILLER                       PIC X(34) VALUE             02260018
022700         SPACES.                                                  02270018
022800     05  PV-MSG-READ-COUNT5           PIC ZZZ,ZZZ,ZZ9.            02280018
022900                                                                  02290018
023000                                                                  02300018
023100*    SE UNBALANCED FILE                                           02310018
023200     COPY PCRD037.                                                02320018
023300                                                                  02330018
023400*    GREATER-90-FILE                                              02340018
023500     COPY PCRD041.                                                02350018
023600                                                                  02360018
023700*    PO/RCVR SUMMARY                                              02370018
023800     COPY PCRD042.                                                02380018
023900/                                                                 02390018
024000*  PARAMETER TABLE                                                02400018
024100     EXEC SQL                                                     02410018
024200         INCLUDE TKRPRPM                                          02420018
024300     END-EXEC.                                                    02430018
024400                                                                  02440018
024500     EXEC SQL                                                     02450018
024600         INCLUDE TCOCNTL                                          02460018
024700     END-EXEC.                                                    02470018
024800                                                                  02480018
024900     EXEC SQL                                                     02490018
025000         INCLUDE SQLCA                                            02500018
025100     END-EXEC.                                                    02510018
025200                                                                  02520018
025300     COPY SQLCA2.                                                 02530018
025400                                                                  02540018
025500     COPY DPWS004.                                                02550018
025600/                                                                 02560018
025700 PROCEDURE DIVISION.                                              02570018
025800                                                                  02580018
025900     PERFORM 1000-INITIALIZATION.                                 02590018
026000                                                                  02600018
026100     PERFORM 2000-PROCESS UNTIL PS-EOF-SUMMRY-YES                 02610018
026200                             OR PS-EOF-UNBAL-YES                  02620018
026300                                                                  02630018
026400     PERFORM 9000-QUIT.                                           02640018
026500                                                                  02650018
026600     GOBACK.                                                      02660018
026700/                                                                 02670018
026800 1000-INITIALIZATION.                                             02680018
026900     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02690018
027000*    DISPLAY PV-ABEND-PARAGRAPH                                   02700018
027100                                                                  02710018
027200*    OPEN THE EXTRACT FILES                                       02720018
027300     OPEN INPUT PO-SUMMARY-FILE                                   02730018
027400                UNBALANCED-SUMMARY-FILE                           02740018
027500     OPEN OUTPUT STORE-EXPECTED-GT-90                             02750018
027600                 STORE-EXPECTED-BETWEEN-DATES                     02760018
027700                 STORE-SKIPPED-FILE                               02770018
027800                                                                  02780018
027900     PERFORM 8000-READ-SUMMRY-EXTRACT.                            02790018
028000                                                                  02800018
028100     PERFORM 8050-READ-UNBAL-EXTRACT.                             02810018
028200                                                                  02820018
028300     IF PS-EOF-UNBAL-YES                                          02830018
028400         DISPLAY SPACES                                           02840018
028500         DISPLAY ALL '*'                                          02850018
028600         DISPLAY '  INP01 UNBALANCED INPUT FILE IS EMPTY '        02860018
028700         DISPLAY ALL '*'                                          02870018
028800         DISPLAY SPACES                                           02880018
028900     END-IF                                                       02890018
029000                                                                  02900018
029100     IF PS-EOF-SUMMRY-YES                                         02910018
029200         DISPLAY SPACES                                           02920018
029300         DISPLAY ALL '*'                                          02930018
029400         DISPLAY '  INP02 SUMMARY INPUT FILE IS EMPTY '           02940018
029500         DISPLAY ALL '*'                                          02950018
029600         DISPLAY SPACES                                           02960018
029700     END-IF                                                       02970018
029800                                                                  02980018
029900     IF PS-EOF-SUMMRY-YES OR PS-EOF-UNBAL-YES                     02990018
030000         CONTINUE                                                 03000018
030100     ELSE                                                         03010018
030200         IF PV-SUMMRY-KEY < PV-UNBAL-KEY                          03020018
030300             PERFORM 8000-READ-SUMMRY-EXTRACT                     03030018
030400                 UNTIL PV-SUMMRY-KEY = PV-UNBAL-KEY               03040018
030500                       OR PS-EOF-SUMMRY-YES                       03050018
030600         END-IF                                                   03060018
030700     END-IF                                                       03070018
030800                                                                  03080018
030900*    PRELOAD THE DETAIL SEQUENCE KEYS THAT CONTROL PO/RCVR        03090018
031000*    BREAKS                                                       03100018
031100     IF PS-EOF-SUMMRY-YES AND PS-EOF-UNBAL-YES                    03110018
031200         CONTINUE                                                 03120018
031300     ELSE                                                         03130018
031400         ACCEPT PV-SYSIN-CARD FROM SYSIN                          03140018
031500         IF PV-SYSIN-CARD = LOW-VALUES                            03150018
031600             DISPLAY ' PCKUT041 ERROR - DATE IS MISSING'          03160018
031700             SET ABEND-4003-CTRL-CARD-ERROR                       03170018
031800                                      TO TRUE                     03180018
031900             CALL 'ILBOABN0' USING ABEND-CODE                     03190018
032000         ELSE                                                     03200018
032100             DISPLAY ' '                                          03210018
032200             DISPLAY ' PCKUT041 - START'                          03220027
032210             DISPLAY ' BATCH PROCESS DATE IS: ' PV-SYSIN-DATE     03221027
032300             PERFORM 1001-NEAR-DATE                               03230018
032400             PERFORM 1002-FAR-DATE                                03240018
032500             PERFORM 1003-GET-BOSS-PARM-RCVR                      03250018
032600             PERFORM 1004-WRITE-SWITCH                            03260018
032700         END-IF                                                   03270018
032800     END-IF.                                                      03280018
032900                                                                  03290018
033000                                                                  03300018
033100     DISPLAY SPACES.                                              03310018
033200     DISPLAY '                                      '             03320037
033300          ' FAR DATE       NEAR DATE'.                            03330039
033302     DISPLAY '      DATE RANGE IS:                  '             03330237
033303          PV-FAR-DATE ' THRU '  PV-NEAR-DATE                      03330337
033304          '     CLEAN2 - CLEAN1'.                                 03330437
033310     DISPLAY ' '                                                  03331019
033400     DISPLAY ' BOSS DATE RANGE IS:                  '             03340019
033500          PV-BOSS-FAR-DATE ' THRU '  PV-BOSS-NEAR-DATE            03350029
033510          '     CLEAN6 - CLEAN5'.                                 03351030
033600     MOVE PV-BOSS-PARM-RECV TO PV-BOSS-PARM-DISP.                 03360018
033700     DISPLAY ' BOSS PARM = ' PV-BOSS-PARM-DISP.                   03370018
033710     DISPLAY ' '                                                  03371019
033720     DISPLAY ' SEPHORA-SUPPORTING DC DATE RANGE IS :'             03372019
033730          PV-SEPH-SUPP-FAR-DATE ' THRU '  PV-SEPH-SUPP-NEAR-DATE  03373029
033731          '     CLEANB - CLEANA'.                                 03373130
033740     DISPLAY ' SEPHORA-DIFFERENT  DC DATE RANGE IS: '             03374028
033750          PV-SEPH-DIFF-FAR-DATE ' THRU '  PV-SEPH-DIFF-NEAR-DATE  03375029
033760          '     CLEANF - CLEANE'.                                 03376030
033800     DISPLAY SPACES.                                              03380018
033900                                                                  03390018
033910                                                                  03391019
034000 1001-NEAR-DATE.                                                  03400018
034100     PERFORM 7000-GET-NEAR-DATE.                                  03410018
034200     MOVE PV-NEAR-DATE                TO PV-MIN-DATE-PARM.        03420018
034300                                                                  03430018
034400     PERFORM 7050-GET-BOSS-NEAR-DATE.                             03440018
034401     MOVE PV-BOSS-NEAR-DATE           TO PV-MIN-DATE-PARM-3B.     03440140
034402                                                                  03440219
034410     PERFORM 7060-GET-SEPH-SUPP-NEAR-DATE.                        03441019
034411     MOVE PV-SEPH-SUPP-NEAR-DATE      TO PV-MIN-DATE-PARM-3C.     03441140
034420     PERFORM 7070-GET-SEPH-DIFF-NEAR-DATE.                        03442019
034430     MOVE PV-SEPH-DIFF-NEAR-DATE      TO PV-MIN-DATE-PARM-3D.     03443040
034500                                                                  03450018
034510                                                                  03451040
034600 1002-FAR-DATE.                                                   03460018
034700                                                                  03470018
034800     PERFORM 7100-GET-FAR-DATE.                                   03480018
034900                                                                  03490018
035000     PERFORM 7150-GET-BOSS-FAR-DATE.                              03500018
035001                                                                  03500119
035010     PERFORM 7160-GET-SEPH-SUPP-FAR-DATE.                         03501022
035020     PERFORM 7170-GET-SEPH-DIFF-FAR-DATE.                         03502019
035100                                                                  03510018
035200******************************************************************03520018
035300*- RETRIEVE THE PARAMETER FROM TKRPRPM TO DETERMINE IF THIS IS    03530018
035400*- A BOSS RECEIVER.                                               03540018
035500******************************************************************03550018
035600 1003-GET-BOSS-PARM-RCVR.                                         03560018
035700                                                                  03570018
035800     MOVE '1003-GET-BOSS-PARM-RCVR'   TO PV-ABEND-PARAGRAPH.      03580018
035900                                                                  03590018
036000     PERFORM                                                      03600018
036100         WITH TEST AFTER                                          03610018
036200         VARYING PV-RETRY-COUNTER                                 03620018
036300         FROM 1 BY 1                                              03630018
036400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03640018
036500            OR  (SQLCODE = +100)                                  03650018
036600            OR  (SQLCODE = +0))                                   03660018
036700                                                                  03670018
036800         EXEC SQL                                                 03680018
036900             SELECT FUNC_QTY                                      03690018
037000               INTO :PV-BOSS-PARM-RECV                            03700018
037100               FROM TKRPRPM P                                     03710018
037200              WHERE LOC_ID            = 90                        03720018
037300                AND INTFC_SYS_CDE     = 'GIV'                     03730018
037400                AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                  03740018
037500                AND FUNC_PRC_STAT_CDE = 'AC'                      03750018
037600             WITH UR                                              03760018
037700         END-EXEC                                                 03770018
037800                                                                  03780018
037900         EVALUATE TRUE                                            03790018
038000             WHEN SQLCODE = ZERO                                  03800018
038100             WHEN SQLCODE = +100                                  03810018
038200                 CONTINUE                                         03820018
038300             WHEN SQLCODE = -904                                  03830018
038400             WHEN SQLCODE = -911                                  03840018
038500             WHEN SQLCODE = -913                                  03850018
038600                  CONTINUE                                        03860018
038700                                                                  03870018
038800             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              03880018
038900                 DISPLAY '**************************************' 03890018
039000                 DISPLAY 'WARNING ISSUED '                        03900018
039100                 DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        ' 03910018
039200                 DISPLAY '**************************************' 03920018
039300                 PERFORM 9800-SQL-WARNING                         03930018
039400                                                                  03940018
039500             WHEN SQLCODE < ZERO                                  03950018
039600                 DISPLAY '**************************************' 03960018
039700                 DISPLAY 'ERROR ISSUED ON                       ' 03970018
039800                 DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        ' 03980018
039900                 DISPLAY '**************************************' 03990018
040000                 PERFORM 9900-SQL-ERROR                           04000018
040100                                                                  04010018
040200         END-EVALUATE                                             04020018
040300     END-PERFORM.                                                 04030018
040400                                                                  04040018
040500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04050018
040600         SQLCODE NOT = ZERO                                       04060018
040700         DISPLAY '**************************************'         04070018
040800         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04080018
040900         DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER'                 04090018
041000         DISPLAY '**************************************'         04100018
041100         PERFORM 9900-SQL-ERROR                                   04110018
041200     END-IF.                                                      04120018
041300                                                                  04130018
041400 1004-WRITE-SWITCH.                                               04140018
041500                                                                  04150018
041600     IF PV-SYSIN-CARD = SPACES OR LOW-VALUES                      04160018
041700             DISPLAY ' OUT02 AND OUT03 WILL BE WRITTEN'           04170018
041800     ELSE                                                         04180018
041900         IF PV-SYSIN-WRITE-OUT02-YES                              04190018
042000             DISPLAY ' OUT02 AND OUT03 WILL BE WRITTEN'           04200018
042100         ELSE                                                     04210018
042200             DISPLAY ' OUT02 AND OUT03 WILL EMPTY'                04220018
042300         END-IF                                                   04230018
042400     END-IF.                                                      04240018
042500/                                                                 04250018
042600 2000-PROCESS.                                                    04260018
042700                                                                  04270018
042800     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.  04280018
042900     EVALUATE TRUE                                                04290018
043000                                                                  04300018
043010***      NOTE:  PV-SUMMRY-KEY = PO-RCVR                           04301019
043020                                                                  04302019
043100         WHEN PV-SUMMRY-KEY = PV-UNBAL-KEY                        04310018
043200             IF PV-UNBAL-RCVR = PV-BOSS-PARM-RECV                 04320018
043300                PERFORM 2200-WRITE                                04330018
043400             ELSE                                                 04340018
043401                IF  PC041-SEPHORA                                 04340124
043402                    PERFORM 2300-SEPHORA-WRITE                    04340219
043410                ELSE                                              04341019
043500                    PERFORM 2100-WRITE-EM-OUT                     04350019
043600                END-IF                                            04360019
043610             END-IF                                               04361019
043700             PERFORM 8050-READ-UNBAL-EXTRACT                      04370018
043800                                                                  04380018
043900         WHEN PV-SUMMRY-KEY > PV-UNBAL-KEY                        04390018
044000             PERFORM 8050-READ-UNBAL-EXTRACT                      04400018
044100                                                                  04410018
044200         WHEN PV-SUMMRY-KEY < PV-UNBAL-KEY                        04420018
044300             PERFORM 8000-READ-SUMMRY-EXTRACT                     04430018
044400                                                                  04440018
044500     END-EVALUATE.                                                04450018
044600/                                                                 04460018
044700 2100-WRITE-EM-OUT.                                               04470018
044800                                                                  04480018
044900*    A 'CLEAN RECORD' MUST REVERSE THE ORIGINAL QUANTITY          04490018
045000     MULTIPLY PC041-TRN-CLSN-QTY BY -1 GIVING PC041-TRN-CLSN-QTY  04500018
045100                                                                  04510018
045200     MOVE PC042-PO-RCVR-END-DTE       TO PC041-INTRNST-TRN-DTE    04520018
045300                                                                  04530018
045400     EVALUATE TRUE                                                04540018
045500         WHEN PC042-PO-RCVR-END-DTE <= PV-FAR-DATE                04550018
045600                                                                  04560018
045700*            90 DAYS OLD OR OLDER                                 04570018
045800             PERFORM 8100-WRITE-OVERS                             04580018
045900                                                                  04590018
046000         WHEN PC042-PO-RCVR-END-DTE < PV-NEAR-DATE                04600018
046100                   AND > PV-FAR-DATE                              04610018
046200                                                                  04620018
046300*            BETWEEN 7 AND 90 DAYS OLD                            04630018
046400                 IF PV-SYSIN-WRITE-OUT02-YES                      04640018
046500                     PERFORM 8200-WRITE-DTERANGE                  04650018
046600                 END-IF                                           04660018
046700                                                                  04670018
046800         WHEN OTHER                                               04680018
046900                                                                  04690018
047000*            7 DAYS OLD OR LESS                                   04700018
047100             ADD 1                    TO PV-SKIP-COUNT            04710018
047200             PERFORM 8400-WRITE-SKIPPED                           04720018
047300     END-EVALUATE.                                                04730018
047400/                                                                 04740018
047500 2200-WRITE.                                                      04750018
047600                                                                  04760018
047700*    A 'CLEAN RECORD' MUST REVERSE THE ORIGINAL QUANTITY          04770018
047800     MULTIPLY PC041-TRN-CLSN-QTY BY -1 GIVING PC041-TRN-CLSN-QTY  04780018
047900                                                                  04790018
048000     MOVE PC042-PO-RCVR-END-DTE       TO PC041-INTRNST-TRN-DTE    04800018
048100                                                                  04810018
048200     EVALUATE TRUE                                                04820018
048300         WHEN PC042-PO-RCVR-END-DTE <= PV-BOSS-FAR-DATE           04830018
048400                                                                  04840018
048500*            90 DAYS OLD OR OLDER                                 04850018
048600             PERFORM 8150-WRITE-OVERS                             04860018
048610             ADD 1               TO PV-WRITE-1B-COUNTER           04861040
048700                                                                  04870018
048800         WHEN PC042-PO-RCVR-END-DTE < PV-BOSS-NEAR-DATE           04880018
048900                                AND > PV-BOSS-FAR-DATE            04890018
049000                                                                  04900018
049100*            BETWEEN 7 AND 90 DAYS OLD                            04910018
049200                 IF PV-SYSIN-WRITE-OUT02-YES                      04920018
049300                     PERFORM 8250-WRITE-DTERANGE                  04930018
049310                     ADD 1       TO PV-WRITE-2B-COUNTER           04931038
049400                 END-IF                                           04940018
049500                                                                  04950018
049600         WHEN OTHER                                               04960018
049700                                                                  04970018
049800*            7 DAYS OLD OR LESS                                   04980018
049900             ADD 1                    TO PV-SKIP-COUNT-B          04990040
050000             PERFORM 8400-WRITE-SKIPPED                           05000018
050100     END-EVALUATE.                                                05010018
050200                                                                  05020018
050201                                                                  05020119
050202*----------------------------------------------------------------*05020219
050203* GENERATE CLEAN RECORD FOR SEPHORA DEPARTMENT                   *05020319
050204*----------------------------------------------------------------*05020419
050210 2300-SEPHORA-WRITE.                                              05021019
050211                                                                  05021119
050217*    A 'CLEAN RECORD' MUST REVERSE THE ORIGINAL QUANTITY          05021719
050218     MULTIPLY PC041-TRN-CLSN-QTY BY -1 GIVING PC041-TRN-CLSN-QTY. 05021834
050219                                                                  05021919
050220     MOVE PC042-PO-RCVR-END-DTE       TO PC041-INTRNST-TRN-DTE.   05022034
050221                                                                  05022119
050222     IF  PC041-SEPHORA-SUPPORT-DC                                 05022233
050228         EVALUATE TRUE                                            05022819
050229             WHEN PC042-PO-RCVR-END-DTE <= PV-SEPH-SUPP-FAR-DATE  05022919
050230                                                                  05023019
050231*                 90 DAYS OLD OR OLDER (SUPPORTING DC)            05023119
050237                  PERFORM 8150-WRITE-OVERS                        05023719
050238                  ADD 1          TO PV-WRITE-1C-COUNTER           05023840
050239                                                                  05023919
050240             WHEN PC042-PO-RCVR-END-DTE < PV-SEPH-SUPP-NEAR-DATE  05024019
050241                                    AND > PV-SEPH-SUPP-FAR-DATE   05024119
050242                                                                  05024219
050247*                   BETWEEN 7 AND 90 DAYS OLD (SUPPORTING DC)     05024719
050248                  IF  PV-SYSIN-WRITE-OUT02-YES                    05024819
050254                      PERFORM 8250-WRITE-DTERANGE                 05025419
050255                     ADD 1       TO PV-WRITE-2C-COUNTER           05025538
050256                  END-IF                                          05025619
050257                                                                  05025719
050258             WHEN OTHER                                           05025819
050259                                                                  05025919
050265*                 7 DAYS OLD OR LESS                              05026519
050266                  ADD 1                    TO PV-SKIP-COUNT-C     05026640
050267                  PERFORM 8400-WRITE-SKIPPED                      05026731
050268         END-EVALUATE                                             05026819
050269     ELSE                                                         05026919
050270         EVALUATE TRUE                                            05027019
050271             WHEN PC042-PO-RCVR-END-DTE <= PV-SEPH-DIFF-FAR-DATE  05027119
050272                                                                  05027219
050273*                 90 DAYS OLD OR OLDER (DIFFERENT DC)             05027319
050279                  PERFORM 8150-WRITE-OVERS                        05027919
050280                  ADD 1          TO PV-WRITE-1D-COUNTER           05028040
050281                                                                  05028119
050282             WHEN PC042-PO-RCVR-END-DTE < PV-SEPH-DIFF-NEAR-DATE  05028219
050283                                    AND > PV-SEPH-DIFF-FAR-DATE   05028319
050284                                                                  05028419
050289*                   BETWEEN 7 AND 90 DAYS OLD (DIFFERENT DC)      05028919
050290                  IF  PV-SYSIN-WRITE-OUT02-YES                    05029019
050296                      PERFORM 8250-WRITE-DTERANGE                 05029619
050297                     ADD 1       TO PV-WRITE-2D-COUNTER           05029738
050298                  END-IF                                          05029819
050299                                                                  05029919
050300             WHEN OTHER                                           05030019
050301                                                                  05030119
050307*                 7 DAYS OLD OR LESS                              05030719
050308                  ADD 1                    TO PV-SKIP-COUNT-D     05030840
050309*                                                                 05030931
050312                  PERFORM 8400-WRITE-SKIPPED                      05031219
050313         END-EVALUATE                                             05031319
050314     END-IF.                                                      05031419
050315                                                                  05031519
050316                                                                  05031619
050317*----------------------------------------------------------------*05031719
050318*                                                                *05031819
050319*----------------------------------------------------------------*05031919
050320 7000-GET-NEAR-DATE.                                              05032018
050400                                                                  05040018
050500     MOVE '7000-GET-NEAR-DATE'        TO PV-ABEND-PARAGRAPH.      05050018
050600                                                                  05060018
050700     PERFORM                                                      05070018
050800         WITH TEST AFTER                                          05080018
050900         VARYING PV-RETRY-COUNTER                                 05090018
051000         FROM 1 BY 1                                              05100018
051100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05110018
051200            OR  (SQLCODE = +100)                                  05120018
051300            OR  (SQLCODE = +0))                                   05130018
051400                                                                  05140018
051500         EXEC SQL                                                 05150018
051600             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         05160018
051700             INTO :PV-NEAR-DATE                                   05170018
051800              FROM  TKRPRPM P                                     05180018
051900             WHERE                                                05190018
052000                   P.LOC_ID            = 90                       05200018
052100               AND P.INTFC_SYS_CDE     = 'KHL'                    05210018
052200               AND P.SYS_PRC_FUNC_CDE  = 'CLEAN1'                 05220018
052300               AND P.FUNC_PRC_STAT_CDE = 'AC'                     05230018
052400         WITH UR                                                  05240018
052500         END-EXEC                                                 05250018
052600                                                                  05260018
052700         EVALUATE TRUE                                            05270018
052800             WHEN SQLCODE = ZERO                                  05280018
052900             WHEN SQLCODE = +100                                  05290018
053000                 CONTINUE                                         05300018
053100             WHEN SQLCODE = -904                                  05310018
053200             WHEN SQLCODE = -911                                  05320018
053300             WHEN SQLCODE = -913                                  05330018
053400                  CONTINUE                                        05340018
053500                                                                  05350018
053600             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05360018
053700                 DISPLAY '**************************************' 05370018
053800                 DISPLAY 'WARNING ISSUED '                        05380018
053900                 DISPLAY 'SELECT TKRPRPM                        ' 05390018
054000                 DISPLAY '**************************************' 05400018
054100                 PERFORM 9800-SQL-WARNING                         05410018
054200                                                                  05420018
054300             WHEN SQLCODE < ZERO                                  05430018
054400                 DISPLAY '**************************************' 05440018
054500                 DISPLAY 'ERROR ISSUED ON                       ' 05450018
054600                 DISPLAY 'SELECT TKRPRPM                        ' 05460018
054700                 DISPLAY '**************************************' 05470018
054800                 PERFORM 9900-SQL-ERROR                           05480018
054900                                                                  05490018
055000         END-EVALUATE                                             05500018
055100     END-PERFORM.                                                 05510018
055200                                                                  05520018
055300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05530018
055400         SQLCODE NOT = ZERO                                       05540018
055500         DISPLAY '**************************************'         05550018
055600         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05560018
055700         DISPLAY 'SELECT TKRPRPM         '                        05570018
055800         DISPLAY '**************************************'         05580018
055900         PERFORM 9900-SQL-ERROR                                   05590018
056000     END-IF.                                                      05600018
056100                                                                  05610018
056200******************************************************************05620018
056300*- READ TKRPRPM TO RETRIEVE THE BOSS NEAR DATE                    05630018
056400******************************************************************05640018
056500 7050-GET-BOSS-NEAR-DATE.                                         05650018
056600                                                                  05660018
056700     MOVE '7050-GET-BOSS-NEAR-DATE'   TO PV-ABEND-PARAGRAPH.      05670018
056800                                                                  05680018
056900     PERFORM                                                      05690018
057000         WITH TEST AFTER                                          05700018
057100         VARYING PV-RETRY-COUNTER                                 05710018
057200         FROM 1 BY 1                                              05720018
057300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05730018
057400            OR  (SQLCODE = +100)                                  05740018
057500            OR  (SQLCODE = +0))                                   05750018
057600                                                                  05760018
057700         EXEC SQL                                                 05770018
057800             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         05780018
057900               INTO :PV-BOSS-NEAR-DATE                            05790018
058000               FROM TKRPRPM                                       05800018
058100              WHERE LOC_ID            = 90                        05810018
058200                AND INTFC_SYS_CDE     = 'KHL'                     05820018
058300                AND SYS_PRC_FUNC_CDE  = 'CLEAN5'                  05830018
058400                AND FUNC_PRC_STAT_CDE = 'AC'                      05840018
058500             WITH UR                                              05850018
058600         END-EXEC                                                 05860018
058700                                                                  05870018
058800         EVALUATE TRUE                                            05880018
058900             WHEN SQLCODE = ZERO                                  05890018
059000             WHEN SQLCODE = +100                                  05900018
059100                 CONTINUE                                         05910018
059200             WHEN SQLCODE = -904                                  05920018
059300             WHEN SQLCODE = -911                                  05930018
059400             WHEN SQLCODE = -913                                  05940018
059500                  CONTINUE                                        05950018
059600                                                                  05960018
059700             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05970018
059800                 DISPLAY '**************************************' 05980018
059900                 DISPLAY 'WARNING ISSUED '                        05990018
060000                 DISPLAY 'SELECT TKRPRPM - NEAR DATE            ' 06000018
060100                 DISPLAY '**************************************' 06010018
060200                 PERFORM 9800-SQL-WARNING                         06020018
060300                                                                  06030018
060400             WHEN SQLCODE < ZERO                                  06040018
060500                 DISPLAY '**************************************' 06050018
060600                 DISPLAY 'ERROR ISSUED ON                       ' 06060018
060700                 DISPLAY 'SELECT TKRPRPM - NEAR DATE            ' 06070018
060800                 DISPLAY '**************************************' 06080018
060900                 PERFORM 9900-SQL-ERROR                           06090018
061000                                                                  06100018
061100         END-EVALUATE                                             06110018
061200     END-PERFORM.                                                 06120018
061300                                                                  06130018
061400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06140018
061500         SQLCODE NOT = ZERO                                       06150018
061600         DISPLAY '**************************************'         06160018
061700         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06170018
061800         DISPLAY 'SELECT TKRPRPM - NEAR DATE'                     06180018
061900         DISPLAY '**************************************'         06190018
062000         PERFORM 9900-SQL-ERROR                                   06200018
062100     END-IF.                                                      06210018
062200                                                                  06220018
062201*----------------------------------------------------------------*06220119
062202*  READ TKRPRPM TO RETRIEVE THE NEAR DATE -  FOR SEPHORA THAT IS  06220219
062203*  WORKED AT THEIR SUPPORING DC - PARM CLEANA                     06220319
062204*  DMH 4/20/2021                                                  06220419
062205*----------------------------------------------------------------*06220519
062210 7060-GET-SEPH-SUPP-NEAR-DATE.                                    06221019
062215                                                                  06221519
062216     MOVE '7060-GET-SEPH-SUPP-NEAR-DATE'   TO PV-ABEND-PARAGRAPH. 06221619
062217                                                                  06221719
062218     PERFORM                                                      06221819
062219         WITH TEST AFTER                                          06221919
062220         VARYING PV-RETRY-COUNTER                                 06222019
062221         FROM 1 BY 1                                              06222119
062222         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06222219
062223            OR  (SQLCODE = +100)                                  06222319
062224            OR  (SQLCODE = +0))                                   06222419
062225                                                                  06222519
062226         EXEC SQL                                                 06222619
062227             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06222719
062228               INTO :PV-SEPH-SUPP-NEAR-DATE                       06222819
062229               FROM TKRPRPM                                       06222919
062230              WHERE LOC_ID            = 90                        06223019
062231                AND INTFC_SYS_CDE     = 'KHL'                     06223119
062232                AND SYS_PRC_FUNC_CDE  = 'CLEANA'                  06223219
062233                AND FUNC_PRC_STAT_CDE = 'AC'                      06223319
062234             WITH UR                                              06223419
062235         END-EXEC                                                 06223519
062236                                                                  06223619
062237         EVALUATE TRUE                                            06223719
062238             WHEN SQLCODE = ZERO                                  06223819
062239             WHEN SQLCODE = +100                                  06223919
062240                 CONTINUE                                         06224019
062241             WHEN SQLCODE = -904                                  06224119
062242             WHEN SQLCODE = -911                                  06224219
062243             WHEN SQLCODE = -913                                  06224319
062244                  CONTINUE                                        06224419
062245                                                                  06224519
062246             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06224619
062247                 DISPLAY '**************************************' 06224719
062248                 DISPLAY 'WARNING ISSUED '                        06224819
062249                 DISPLAY 'SELECT TKRPRPM - SEPHORA SUPP NEAR DTE' 06224919
062250                 DISPLAY '**************************************' 06225019
062251                 PERFORM 9800-SQL-WARNING                         06225119
062252                                                                  06225219
062253             WHEN SQLCODE < ZERO                                  06225319
062254                 DISPLAY '**************************************' 06225419
062255                 DISPLAY 'ERROR ISSUED ON                       ' 06225519
062256                 DISPLAY 'SELECT TKRPRPM - SEPHORA SUPP NEAR DTE' 06225619
062257                 DISPLAY '**************************************' 06225719
062258                 PERFORM 9900-SQL-ERROR                           06225819
062259                                                                  06225919
062260         END-EVALUATE                                             06226019
062261     END-PERFORM.                                                 06226119
062262                                                                  06226219
062263     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06226319
062264         SQLCODE NOT = ZERO                                       06226419
062265         DISPLAY '**************************************'         06226519
062266         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06226619
062267         DISPLAY 'SELECT TKRPRPM - SEPHORA SUPP NEAR DTE'         06226719
062268         DISPLAY '**************************************'         06226819
062269         PERFORM 9900-SQL-ERROR                                   06226919
062270     END-IF.                                                      06227019
062271                                                                  06227119
062272*----------------------------------------------------------------*06227219
062273*  READ TKRPRPM TO RETRIEVE THE NEAR DATE -  FOR SEPHORA THAT IS  06227319
062274*  WORKED AT DC THAT DOES NOT SUPPORT THE STORE - CLEANE          06227419
062275*  DMH 4/20/2021                                                  06227519
062276*----------------------------------------------------------------*06227619
062277 7070-GET-SEPH-DIFF-NEAR-DATE.                                    06227719
062279                                                                  06227919
062280     MOVE '7070-GET-SEPH-DIFF-NEAR-DATE'   TO PV-ABEND-PARAGRAPH. 06228019
062281                                                                  06228119
062282     PERFORM                                                      06228219
062283         WITH TEST AFTER                                          06228319
062284         VARYING PV-RETRY-COUNTER                                 06228419
062285         FROM 1 BY 1                                              06228519
062286         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06228619
062287            OR  (SQLCODE = +100)                                  06228719
062288            OR  (SQLCODE = +0))                                   06228819
062289                                                                  06228919
062290         EXEC SQL                                                 06229019
062291             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06229119
062292               INTO :PV-SEPH-DIFF-NEAR-DATE                       06229219
062293               FROM TKRPRPM                                       06229319
062294              WHERE LOC_ID            = 90                        06229419
062295                AND INTFC_SYS_CDE     = 'KHL'                     06229519
062296                AND SYS_PRC_FUNC_CDE  = 'CLEANE'                  06229619
062297                AND FUNC_PRC_STAT_CDE = 'AC'                      06229719
062298             WITH UR                                              06229819
062299         END-EXEC                                                 06229919
062300                                                                  06230019
062301         EVALUATE TRUE                                            06230119
062302             WHEN SQLCODE = ZERO                                  06230219
062303             WHEN SQLCODE = +100                                  06230319
062304                 CONTINUE                                         06230419
062305             WHEN SQLCODE = -904                                  06230519
062306             WHEN SQLCODE = -911                                  06230619
062307             WHEN SQLCODE = -913                                  06230719
062308                  CONTINUE                                        06230819
062309                                                                  06230919
062310             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06231019
062311                 DISPLAY '**************************************' 06231119
062312                 DISPLAY 'WARNING ISSUED '                        06231219
062313                 DISPLAY 'SELECT TKRPRPM - SEPHORA DIFF NEAR DTE' 06231319
062314                 DISPLAY '**************************************' 06231419
062315                 PERFORM 9800-SQL-WARNING                         06231519
062316                                                                  06231619
062317             WHEN SQLCODE < ZERO                                  06231719
062318                 DISPLAY '**************************************' 06231819
062319                 DISPLAY 'ERROR ISSUED ON                       ' 06231919
062320                 DISPLAY 'SELECT TKRPRPM - SEPHORA DIFF NEAR DTE' 06232019
062321                 DISPLAY '**************************************' 06232119
062322                 PERFORM 9900-SQL-ERROR                           06232219
062323                                                                  06232319
062324         END-EVALUATE                                             06232419
062325     END-PERFORM.                                                 06232519
062326                                                                  06232619
062327     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06232719
062328         SQLCODE NOT = ZERO                                       06232819
062329         DISPLAY '**************************************'         06232919
062330         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06233019
062331         DISPLAY 'SELECT TKRPRPM - SEPHORA DIFF NEAR DTE'         06233119
062332         DISPLAY '**************************************'         06233219
062333         PERFORM 9900-SQL-ERROR                                   06233319
062334     END-IF.                                                      06233419
062335                                                                  06233519
062337                                                                  06233719
062338                                                                  06233819
062340 7100-GET-FAR-DATE.                                               06234018
062400                                                                  06240018
062500     MOVE '7100-GET-FAR-DATE'         TO PV-ABEND-PARAGRAPH.      06250018
062600                                                                  06260018
062700     PERFORM                                                      06270018
062800         WITH TEST AFTER                                          06280018
062900         VARYING PV-RETRY-COUNTER                                 06290018
063000         FROM 1 BY 1                                              06300018
063100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06310018
063200            OR  (SQLCODE = +100)                                  06320018
063300            OR  (SQLCODE = +0))                                   06330018
063400                                                                  06340018
063500         EXEC SQL                                                 06350018
063600             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06360018
063700             INTO :PV-FAR-DATE                                    06370018
063800              FROM  TKRPRPM P                                     06380018
063900             WHERE                                                06390018
064000                   P.LOC_ID            = 90                       06400018
064100               AND P.INTFC_SYS_CDE     = 'KHL'                    06410018
064200               AND P.SYS_PRC_FUNC_CDE  = 'CLEAN2'                 06420018
064300               AND P.FUNC_PRC_STAT_CDE = 'AC'                     06430018
064400         WITH UR                                                  06440018
064500         END-EXEC                                                 06450018
064600                                                                  06460018
064700         EVALUATE TRUE                                            06470018
064800             WHEN SQLCODE = ZERO                                  06480018
064900             WHEN SQLCODE = +100                                  06490018
065000                 CONTINUE                                         06500018
065100             WHEN SQLCODE = -904                                  06510018
065200             WHEN SQLCODE = -911                                  06520018
065300             WHEN SQLCODE = -913                                  06530018
065400                  CONTINUE                                        06540018
065500                                                                  06550018
065600             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06560018
065700                 DISPLAY '**************************************' 06570018
065800                 DISPLAY 'WARNING ISSUED '                        06580018
065900                 DISPLAY 'SELECT TKRPRPM                        ' 06590018
066000                 DISPLAY '**************************************' 06600018
066100                 PERFORM 9800-SQL-WARNING                         06610018
066200                                                                  06620018
066300             WHEN SQLCODE < ZERO                                  06630018
066400                 DISPLAY '**************************************' 06640018
066500                 DISPLAY 'ERROR ISSUED ON                       ' 06650018
066600                 DISPLAY 'SELECT TKRPRPM                        ' 06660018
066700                 DISPLAY '**************************************' 06670018
066800                 PERFORM 9900-SQL-ERROR                           06680018
066900                                                                  06690018
067000         END-EVALUATE                                             06700018
067100     END-PERFORM.                                                 06710018
067200                                                                  06720018
067300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06730018
067400         SQLCODE NOT = ZERO                                       06740018
067500         DISPLAY '**************************************'         06750018
067600         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06760018
067700         DISPLAY 'SELECT TKRPRPM         '                        06770018
067800         DISPLAY '**************************************'         06780018
067900         PERFORM 9900-SQL-ERROR                                   06790018
068000     END-IF.                                                      06800018
068100/                                                                 06810018
068200******************************************************************06820018
068300*- READ TKRPRPM TO RETRIEVE THE BOSS FAR DATE                     06830018
068400******************************************************************06840018
068500 7150-GET-BOSS-FAR-DATE.                                          06850018
068600                                                                  06860018
068700     MOVE '7150-GET-BOSS-FAR-DATE'   TO PV-ABEND-PARAGRAPH.       06870018
068800                                                                  06880018
068900     PERFORM                                                      06890018
069000         WITH TEST AFTER                                          06900018
069100         VARYING PV-RETRY-COUNTER                                 06910018
069200         FROM 1 BY 1                                              06920018
069300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06930018
069400            OR  (SQLCODE = +100)                                  06940018
069500            OR  (SQLCODE = +0))                                   06950018
069600                                                                  06960018
069700         EXEC SQL                                                 06970018
069800             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06980018
069900              INTO :PV-BOSS-FAR-DATE                              06990018
070000              FROM TKRPRPM                                        07000018
070100             WHERE LOC_ID            = 90                         07010018
070200               AND INTFC_SYS_CDE     = 'KHL'                      07020018
070300               AND SYS_PRC_FUNC_CDE  = 'CLEAN6'                   07030018
070400               AND FUNC_PRC_STAT_CDE = 'AC'                       07040018
070500             WITH UR                                              07050018
070600         END-EXEC                                                 07060018
070700                                                                  07070018
070800         EVALUATE TRUE                                            07080018
070900             WHEN SQLCODE = ZERO                                  07090018
071000             WHEN SQLCODE = +100                                  07100018
071100                 CONTINUE                                         07110018
071200                                                                  07120018
071300             WHEN SQLCODE = -904                                  07130018
071400             WHEN SQLCODE = -911                                  07140018
071500             WHEN SQLCODE = -913                                  07150018
071600                  CONTINUE                                        07160018
071700                                                                  07170018
071800             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              07180018
071900                 DISPLAY '**************************************' 07190018
072000                 DISPLAY 'WARNING ISSUED '                        07200018
072100                 DISPLAY 'SELECT TKRPRPM - FAR DATE             ' 07210018
072200                 DISPLAY '**************************************' 07220018
072300                 PERFORM 9800-SQL-WARNING                         07230018
072400                                                                  07240018
072500             WHEN SQLCODE < ZERO                                  07250018
072600                 DISPLAY '**************************************' 07260018
072700                 DISPLAY 'ERROR ISSUED ON                       ' 07270018
072800                 DISPLAY 'SELECT TKRPRPM - FAR DATE             ' 07280018
072900                 DISPLAY '**************************************' 07290018
073000                 PERFORM 9900-SQL-ERROR                           07300018
073100                                                                  07310018
073200         END-EVALUATE                                             07320018
073300     END-PERFORM.                                                 07330018
073400                                                                  07340018
073500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07350018
073600         SQLCODE NOT = ZERO                                       07360018
073700         DISPLAY '**************************************'         07370018
073800         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         07380018
073900         DISPLAY 'SELECT TKRPRPM - FAR DATE'                      07390018
074000         DISPLAY '**************************************'         07400018
074100         PERFORM 9900-SQL-ERROR                                   07410018
074200     END-IF.                                                      07420018
074300                                                                  07430022
074310*----------------------------------------------------------------*07431019
074311*  READ TKRPRPM TO RETRIEVE THE FAR DATE -  FOR SEPHORA THAT IS   07431119
074312*  WORKED AT THEIR SUPPORING DC - PARM CLEANB                     07431219
074313*  DMH 4/20/2021                                                  07431319
074330*----------------------------------------------------------------*07433019
074340 7160-GET-SEPH-SUPP-FAR-DATE.                                     07434019
074350                                                                  07435019
074360     MOVE '7160-GET-SEPH-SUPP-FAR-DATE'   TO PV-ABEND-PARAGRAPH.  07436019
074370                                                                  07437019
074380     PERFORM                                                      07438019
074390         WITH TEST AFTER                                          07439019
074391         VARYING PV-RETRY-COUNTER                                 07439119
074392         FROM 1 BY 1                                              07439219
074393         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07439319
074394            OR  (SQLCODE = +100)                                  07439419
074395            OR  (SQLCODE = +0))                                   07439519
074396                                                                  07439619
074397         EXEC SQL                                                 07439719
074398             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         07439819
074399              INTO :PV-SEPH-SUPP-FAR-DATE                         07439919
074400              FROM TKRPRPM                                        07440019
074401             WHERE LOC_ID            = 90                         07440119
074402               AND INTFC_SYS_CDE     = 'KHL'                      07440219
074403               AND SYS_PRC_FUNC_CDE  = 'CLEANB'                   07440319
074404               AND FUNC_PRC_STAT_CDE = 'AC'                       07440419
074405             WITH UR                                              07440519
074406         END-EXEC                                                 07440619
074407                                                                  07440719
074408         EVALUATE TRUE                                            07440819
074409             WHEN SQLCODE = ZERO                                  07440919
074410             WHEN SQLCODE = +100                                  07441019
074411                 CONTINUE                                         07441119
074412                                                                  07441219
074413             WHEN SQLCODE = -904                                  07441319
074414             WHEN SQLCODE = -911                                  07441419
074415             WHEN SQLCODE = -913                                  07441519
074416                  CONTINUE                                        07441619
074417                                                                  07441719
074418             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              07441819
074419                 DISPLAY '**************************************' 07441919
074420                 DISPLAY 'WARNING ISSUED '                        07442019
074421                 DISPLAY 'SELECT TKRPRPM-SEPHORA SUPP DC FAR DTE' 07442119
074422                 DISPLAY '**************************************' 07442219
074423                 PERFORM 9800-SQL-WARNING                         07442319
074424                                                                  07442419
074425             WHEN SQLCODE < ZERO                                  07442519
074426                 DISPLAY '**************************************' 07442619
074427                 DISPLAY 'ERROR ISSUED ON                       ' 07442719
074428                 DISPLAY 'SELECT TKRPRPM-SEPHORA SUPP DC FAR DTE' 07442819
074429                 DISPLAY '**************************************' 07442919
074430                 PERFORM 9900-SQL-ERROR                           07443019
074431                                                                  07443119
074432         END-EVALUATE                                             07443219
074433     END-PERFORM.                                                 07443319
074434                                                                  07443419
074435     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07443519
074436         SQLCODE NOT = ZERO                                       07443619
074437         DISPLAY '**************************************'         07443719
074438         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         07443819
074439         DISPLAY 'SELECT TKRPRPM-SEPHORA SUPP DC FAR DTE'         07443919
074440         DISPLAY '**************************************'         07444019
074441         PERFORM 9900-SQL-ERROR                                   07444119
074442     END-IF.                                                      07444219
074443                                                                  07444319
074444                                                                  07444419
074445*----------------------------------------------------------------*07444519
074446*  READ TKRPRPM TO RETRIEVE THE FAR DATE -  FOR SEPHORA THAT IS   07444619
074447*  WORKED AT DC THAT DOES NOT SUPPORT THE STORE - CLEANF          07444719
074448*  DMH 4/20/2021                                                  07444819
074449*----------------------------------------------------------------*07444919
074450 7170-GET-SEPH-DIFF-FAR-DATE.                                     07445019
074451                                                                  07445119
074452     MOVE '7170-GET-SEPH-SUPP-FAR-DATE'   TO PV-ABEND-PARAGRAPH.  07445219
074453                                                                  07445319
074454     PERFORM                                                      07445419
074455         WITH TEST AFTER                                          07445519
074456         VARYING PV-RETRY-COUNTER                                 07445619
074457         FROM 1 BY 1                                              07445719
074458         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07445819
074459            OR  (SQLCODE = +100)                                  07445919
074460            OR  (SQLCODE = +0))                                   07446019
074461                                                                  07446119
074462         EXEC SQL                                                 07446219
074463             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         07446319
074464              INTO :PV-SEPH-DIFF-FAR-DATE                         07446419
074465              FROM TKRPRPM                                        07446519
074466             WHERE LOC_ID            = 90                         07446619
074467               AND INTFC_SYS_CDE     = 'KHL'                      07446719
074468               AND SYS_PRC_FUNC_CDE  = 'CLEANF'                   07446819
074469               AND FUNC_PRC_STAT_CDE = 'AC'                       07446919
074470             WITH UR                                              07447019
074471         END-EXEC                                                 07447119
074472                                                                  07447219
074473         EVALUATE TRUE                                            07447319
074474             WHEN SQLCODE = ZERO                                  07447419
074475             WHEN SQLCODE = +100                                  07447519
074476                 CONTINUE                                         07447619
074477                                                                  07447719
074478             WHEN SQLCODE = -904                                  07447819
074479             WHEN SQLCODE = -911                                  07447919
074480             WHEN SQLCODE = -913                                  07448019
074481                  CONTINUE                                        07448119
074482                                                                  07448219
074483             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              07448319
074484                 DISPLAY '**************************************' 07448419
074485                 DISPLAY 'WARNING ISSUED '                        07448519
074486                 DISPLAY 'SELECT TKRPRPM-SEPHORA DIFF DC FAR DTE' 07448619
074487                 DISPLAY '**************************************' 07448719
074488                 PERFORM 9800-SQL-WARNING                         07448819
074489                                                                  07448919
074490             WHEN SQLCODE < ZERO                                  07449019
074491                 DISPLAY '**************************************' 07449119
074492                 DISPLAY 'ERROR ISSUED ON                       ' 07449219
074493                 DISPLAY 'SELECT TKRPRPM-SEPHORA DIFF DC FAR DTE' 07449319
074494                 DISPLAY '**************************************' 07449419
074495                 PERFORM 9900-SQL-ERROR                           07449519
074496                                                                  07449619
074497         END-EVALUATE                                             07449719
074498     END-PERFORM.                                                 07449819
074499                                                                  07449919
074500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07450019
074501         SQLCODE NOT = ZERO                                       07450119
074502         DISPLAY '**************************************'         07450219
074503         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         07450319
074504         DISPLAY 'SELECT TKRPRPM-SEPHORA DIFF DC FAR DTE'         07450419
074505         DISPLAY '**************************************'         07450519
074506         PERFORM 9900-SQL-ERROR                                   07450619
074507     END-IF.                                                      07450721
074508                                                                  07450819
074509                                                                  07450919
074510*----------------------------------------------------------------*07451019
074511*                                                                *07451119
074512*----------------------------------------------------------------*07451219
074513 8000-READ-SUMMRY-EXTRACT.                                        07451319
074520                                                                  07452019
074600     MOVE '8000-READ-SUMMRY-EXTRACT   '  TO PV-ABEND-PARAGRAPH.   07460018
074700*                                                                 07470018
074800     READ PO-SUMMARY-FILE                                         07480018
074900         INTO                                                     07490018
075000             PC042-PO-RCVR-SUMMARY-REC                            07500018
075100         AT END                                                   07510018
075200             SET PS-EOF-SUMMRY-YES    TO TRUE                     07520018
075300         NOT AT END                                               07530018
075400                                                                  07540018
075500             ADD 1                    TO PV-READ-COUNTER-DTL      07550018
075600             MOVE PC042-PO-NBR        TO PV-COMP-10               07560018
075700             MOVE PV-COMP-10          TO PV-SUMMRY-PO             07570018
075800                                                                  07580018
075900             MOVE PC042-RCVR-SEQ-NBR  TO PV-COMP-10               07590018
076000             MOVE PV-COMP-10          TO PV-SUMMRY-RCVR           07600018
076100                                                                  07610018
076200     END-READ.                                                    07620018
076300                                                                  07630018
076400 8050-READ-UNBAL-EXTRACT.                                         07640018
076500                                                                  07650018
076600     MOVE '8050-READ-UNBAL-EXTRACT   '   TO PV-ABEND-PARAGRAPH.   07660018
076700*                                                                 07670018
076800     READ UNBALANCED-SUMMARY-FILE                                 07680018
076900         INTO                                                     07690018
077000             PC041-UNBAL-SUMMARY-REC                              07700018
077100         AT END                                                   07710018
077200             SET PS-EOF-UNBAL-YES     TO TRUE                     07720018
077300         NOT AT END                                               07730018
077400             ADD 1                    TO PV-READ-COUNTER-SUM      07740018
077500             MOVE PC041-PO-NBR        TO PV-COMP-10               07750018
077600             MOVE PV-COMP-10          TO PV-UNBAL-PO              07760018
077700             MOVE PC041-RCVR-SEQ-NBR  TO PV-COMP-10               07770018
077800             MOVE PV-COMP-10          TO PV-UNBAL-RCVR            07780018
077900                                                                  07790018
078000     END-READ.                                                    07800018
078100                                                                  07810018
078200 8100-WRITE-OVERS.                                                07820018
078300                                                                  07830018
078400     MOVE '8100-WRITE-OVERS          ' TO PV-ABEND-PARAGRAPH.     07840018
078500     SET PC041-GT-90                  TO TRUE                     07850018
078600     WRITE                                                        07860018
078700         STORE-EXPECTED-GT-90-REC FROM PC041-UNBAL-SUMMARY-REC    07870018
078800     END-WRITE.                                                   07880018
078900     ADD 1                            TO PV-WRITE-1-COUNTER.      07890018
079000                                                                  07900018
079100 8150-WRITE-OVERS.                                                07910018
079200                                                                  07920018
079300     MOVE '8150-WRITE-OVERS          ' TO PV-ABEND-PARAGRAPH.     07930018
079400     SET PC041-GT-90                  TO TRUE                     07940018
079500     WRITE                                                        07950018
079600         STORE-EXPECTED-GT-90-REC FROM PC041-UNBAL-SUMMARY-REC    07960018
079700     END-WRITE.                                                   07970018
079800***  ADD 1                            TO PV-WRITE-1B-COUNTER.     07980040
079900                                                                  07990018
080000 8200-WRITE-DTERANGE.                                             08000018
080100                                                                  08010018
080200     MOVE '8200-WRITE-DTERANGE          ' TO PV-ABEND-PARAGRAPH.  08020018
080300                                                                  08030018
080400     SET PC041-GT-7-LT-90             TO TRUE                     08040018
080500     WRITE                                                        08050018
080600         STORE-EXPECT-BETWEEN-DATES-REC                           08060018
080700                 FROM PC041-UNBAL-SUMMARY-REC                     08070018
080800     END-WRITE.                                                   08080018
080900     ADD 1                            TO PV-WRITE-2-COUNTER.      08090018
081000                                                                  08100018
081100 8250-WRITE-DTERANGE.                                             08110018
081200                                                                  08120018
081300     MOVE '8250-WRITE-DTERANGE          ' TO PV-ABEND-PARAGRAPH.  08130018
081400                                                                  08140018
081500     SET PC041-GT-7-LT-90             TO TRUE                     08150018
081600     WRITE                                                        08160018
081700         STORE-EXPECT-BETWEEN-DATES-REC                           08170018
081800                 FROM PC041-UNBAL-SUMMARY-REC                     08180018
081900     END-WRITE.                                                   08190018
082100                                                                  08210018
082200 8400-WRITE-SKIPPED.                                              08220018
082300                                                                  08230018
082400     MOVE '8400-WRITE-SKIPPED           ' TO PV-ABEND-PARAGRAPH.  08240018
082500                                                                  08250018
082600     WRITE                                                        08260018
082700         STORE-SKIPPED-REC                                        08270018
082800                 FROM PC041-UNBAL-SUMMARY-REC                     08280018
082900     END-WRITE.                                                   08290018
083000                                                                  08300018
083100/                                                                 08310018
083200 9000-QUIT.                                                       08320018
083300*    DISPLAY '9000-QUIT'.                                         08330018
083400                                                                  08340018
083500*    PERFORM 2100-WRITE-EM-OUT                                    08350018
083600                                                                  08360018
083700     CLOSE PO-SUMMARY-FILE                                        08370018
083800           UNBALANCED-SUMMARY-FILE                                08380018
083900           STORE-EXPECTED-GT-90                                   08390018
084000           CLOSE STORE-EXPECTED-BETWEEN-DATES                     08400018
084100           STORE-SKIPPED-FILE                                     08410018
084200                                                                  08420018
084500     MOVE PV-READ-COUNTER-DTL         TO PV-MSG-READ-COUNT        08450018
084600     DISPLAY PV-COUNT-MSG-4.                                      08460018
084700                                                                  08470018
084800     DISPLAY SPACES.                                              08480040
084900                                                                  08490018
085000     MOVE PV-READ-COUNTER-SUM         TO PV-MSG-READ-COUNT5       08500018
085100     DISPLAY PV-COUNT-MSG-5.                                      08510018
085110                                                                  08511040
085120     DISPLAY SPACES.                                              08512040
085130                                                                  08513040
085300     MOVE PV-FAR-DATE                 TO PV-MSG-1-LIT             08530018
085400     MOVE PV-WRITE-1-COUNTER          TO PV-MSG-1-COUNT           08540018
085500     DISPLAY PV-COUNT-MSG-1.                                      08550018
085600                                                                  08560018
085700     MOVE PV-BOSS-FAR-DATE            TO PV-MSG-1B-LIT            08570018
085800     MOVE PV-WRITE-1B-COUNTER         TO PV-MSG-1B-COUNT          08580018
085900     DISPLAY PV-COUNT-MSG-1B.                                     08590018
086000                                                                  08600018
086005     MOVE PV-SEPH-SUPP-FAR-DATE       TO PV-MSG-1C-LIT            08600528
086006     MOVE PV-WRITE-1C-COUNTER         TO PV-MSG-1C-COUNT          08600628
086007     DISPLAY PV-COUNT-MSG-1C.                                     08600728
086008                                                                  08600828
086009     MOVE PV-SEPH-DIFF-FAR-DATE       TO PV-MSG-1D-LIT            08600928
086010     MOVE PV-WRITE-1D-COUNTER         TO PV-MSG-1D-COUNT          08601028
086011     DISPLAY PV-COUNT-MSG-1D.                                     08601128
086020                                                                  08602028
086100     DISPLAY SPACES                                               08610018
086200                                                                  08620018
086300     MOVE PV-FAR-DATE                 TO PV-MSG-2-LIT1            08630018
086400     MOVE PV-NEAR-DATE                TO PV-MSG-2-LIT2            08640018
086500     MOVE PV-WRITE-2-COUNTER          TO PV-MSG-2-COUNT2          08650018
086600     DISPLAY PV-COUNT-MSG-2.                                      08660018
086700                                                                  08670018
086800     MOVE PV-BOSS-FAR-DATE            TO PV-MSG-2B-LIT1           08680018
086900     MOVE PV-BOSS-NEAR-DATE           TO PV-MSG-2B-LIT2           08690018
087000     MOVE PV-WRITE-2B-COUNTER         TO PV-MSG-2B-COUNT2         08700018
087100     DISPLAY PV-COUNT-MSG-2B.                                     08710018
087110                                                                  08711028
087120     MOVE PV-SEPH-SUPP-FAR-DATE       TO PV-MSG-2C-LIT1           08712028
087130     MOVE PV-SEPH-SUPP-NEAR-DATE      TO PV-MSG-2C-LIT2           08713028
087140     MOVE PV-WRITE-2C-COUNTER         TO PV-MSG-2C-COUNT2         08714028
087150     DISPLAY PV-COUNT-MSG-2C.                                     08715028
087160                                                                  08716028
087170     MOVE PV-SEPH-DIFF-FAR-DATE       TO PV-MSG-2D-LIT1           08717028
087180     MOVE PV-SEPH-DIFF-NEAR-DATE      TO PV-MSG-2D-LIT2           08718028
087190     MOVE PV-WRITE-2D-COUNTER         TO PV-MSG-2D-COUNT2         08719028
087191     DISPLAY PV-COUNT-MSG-2D.                                     08719128
087200                                                                  08720018
087210     DISPLAY SPACES                                               08721028
087220                                                                  08722028
087300     MOVE PV-SKIP-COUNT               TO PV-MSG-SKIP-COUNT        08730018
087400     DISPLAY PV-COUNT-MSG-3.                                      08740018
087401                                                                  08740140
087402     MOVE PV-SKIP-COUNT-B             TO PV-MSG-SKIP-COUNT-3B     08740240
087403     DISPLAY PV-COUNT-MSG-3B.                                     08740340
087404                                                                  08740440
087405     MOVE PV-SKIP-COUNT-C             TO PV-MSG-SKIP-COUNT-3C     08740540
087406     DISPLAY PV-COUNT-MSG-3C.                                     08740640
087407                                                                  08740740
087408     MOVE PV-SKIP-COUNT-D             TO PV-MSG-SKIP-COUNT-3D     08740840
087409     DISPLAY PV-COUNT-MSG-3D.                                     08740940
087410                                                                  08741040
087411                                                                  08741140
087500/                                                                 08750018
087600 9100-SQL-ABEND.                                                  08760018
087700******************************************************************08770018
087800*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    08780018
087900*  ERROR OR WARNING CODE OCCURS.                                  08790018
088000******************************************************************08800018
088100     DISPLAY '9100-SQL-ABEND'.                                    08810018
088200     DISPLAY '** ABEND     **'.                                   08820018
088300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08830018
088400     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             08840018
088500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     08850018
088600     DISPLAY '**              ** = '                              08860018
088700     MOVE SQLCODE TO PV-SQL-CODE.                                 08870018
088800     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    08880018
088900     MOVE +4013 TO PV-ABEND-CODE.                                 08890018
089000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08900018
089100                                                                  08910018
089200******************************************************************08920018
089300*  THIS MODULE PERFORMS THE SQL WARNING.                         *08930018
089400******************************************************************08940018
089500                                                                  08950018
089600 9800-SQL-WARNING.                                                08960018
089700                                                                  08970018
089800     MOVE SQLCODE               TO SQLCODE2.                      08980018
089900     MOVE SQLERRD(3)            TO SQLERRD3.                      08990018
090000     DISPLAY '** ABEND **       ** = SQLWARNING'.                 09000018
090100     DISPLAY '** PROGRAM        ** = PCKUT041'.                   09010018
090200     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        09020018
090300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  09030018
090400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  09040018
090500                                                                  09050018
090600     COPY DPPD004.                                                09060018
090700     SET ABEND-4013-DB2-ERROR   TO TRUE                           09070018
090800     CALL 'ILBOABN0' USING ABEND-CODE.                            09080018
090900/                                                                 09090018
091000******************************************************************09100018
091100* THIS MODULE PERFORMS THE SQL ERROR.                            *09110018
091200******************************************************************09120018
091300                                                                  09130018
091400 9900-SQL-ERROR.                                                  09140018
091500                                                                  09150018
091600     MOVE SQLCODE               TO SQLCODE2.                      09160018
091700     MOVE SQLERRD(3)            TO SQLERRD3.                      09170018
091800     DISPLAY '** ABEND **       ** = SQLERROR'.                   09180018
091900     DISPLAY '** PROGRAM        ** = PCKUT041'.                   09190018
092000     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        09200018
092100     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         09210018
092200     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       09220018
092300     DISPLAY SPACES                                               09230018
092400                                                                  09240018
092500     COPY DPPD004.                                                09250018
092600     SET ABEND-4013-DB2-ERROR   TO TRUE                           09260018
092700     CALL 'ILBOABN0' USING ABEND-CODE.                            09270018
