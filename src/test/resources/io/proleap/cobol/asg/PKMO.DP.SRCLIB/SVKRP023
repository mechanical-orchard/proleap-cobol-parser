000100******************************************************************00010084
000200 IDENTIFICATION DIVISION.                                         00020085
000300******************************************************************00030085
000400                                                                  00040085
000500 PROGRAM-ID.             SVKRP023.                                00050085
000600 AUTHOR.                 DOUGLAS W ROUSAR.                        00060085
000700 INSTALLATION.           KOHLS.                                   00070085
000800 DATE-WRITTEN            JANUARY, 1998.                           00080085
000900 DATE-COMPILED.                                                   00090085
001000                                                                  00100085
001100******************************************************************00110085
001200* THIS PROGRAM WAS COPIED FROM RDKRP016                           00120085
001300******************************************************************00130085
001400 ENVIRONMENT DIVISION.                                            00140085
001500******************************************************************00150085
001600                                                                  00160085
001700 CONFIGURATION SECTION.                                           00170085
001800                                                                  00180085
001900 SOURCE-COMPUTER.        IBM-3090.                                00190085
002000 OBJECT-COMPUTER.        IBM-3090.                                00200085
002100                                                                  00210085
002200 INPUT-OUTPUT SECTION.                                            00220085
002300                                                                  00230085
002400 FILE-CONTROL.                                                    00240085
002500                                                                  00250085
002600     SELECT BALANCE-EXTRACT           ASSIGN TO INP01.            00260085
002700     SELECT CONTROL-DATE-FILE         ASSIGN TO INP02.            00270085
002800     SELECT TENDERED-REPORT           ASSIGN TO RPT01.            00280085
002900     SELECT NOT-TEND-REPORT           ASSIGN TO RPT02.            00290085
003000     SELECT OVR-TEND-REPORT           ASSIGN TO RPT03.            00300085
003100                                                                  00310085
003200******************************************************************00320085
003300 DATA DIVISION.                                                   00330085
003400******************************************************************00340085
003500                                                                  00350085
003600 FILE SECTION.                                                    00360085
003700                                                                  00370085
003800 FD  BALANCE-EXTRACT                                              00380085
003900     RECORDING MODE IS F                                          00390085
004000     BLOCK CONTAINS 0 RECORDS                                     00400085
004100     LABEL RECORDS ARE OMITTED.                                   00410085
004200 01  BALANCE-EXTRACT-RECORD           PIC X(58).                  00420085
004300                                                                  00430085
004400 FD  CONTROL-DATE-FILE                                            00440085
004500     RECORDING MODE IS F                                          00450085
004600     BLOCK CONTAINS 0 RECORDS                                     00460085
004700     LABEL RECORDS ARE OMITTED.                                   00470085
004800 01  CONTROL-DATE-RECORD              PIC X(80).                  00480085
004900                                                                  00490085
005000 FD  TENDERED-REPORT                                              00500085
005100     RECORDING MODE IS F                                          00510085
005200     BLOCK CONTAINS 0 RECORDS                                     00520085
005300     LABEL RECORDS ARE OMITTED.                                   00530085
005400 01  REPORT1-OUT                      PIC X(75).                  00540085
005500                                                                  00550085
005600 FD  NOT-TEND-REPORT                                              00560085
005700     RECORDING MODE IS F                                          00570085
005800     BLOCK CONTAINS 0 RECORDS                                     00580085
005900     LABEL RECORDS ARE OMITTED.                                   00590085
006000 01  REPORT2-OUT                      PIC X(75).                  00600085
006100                                                                  00610085
006200 FD  OVR-TEND-REPORT                                              00620085
006300     RECORDING MODE IS F                                          00630085
006400     BLOCK CONTAINS 0 RECORDS                                     00640085
006500     LABEL RECORDS ARE OMITTED.                                   00650085
006600 01  REPORT3-OUT                      PIC X(75).                  00660085
006700                                                                  00670085
006800******************************************************************00680085
006900 WORKING-STORAGE SECTION.                                         00690085
007000******************************************************************00700085
007100                                                                  00710085
007200*                                                                 00720085
007300* CR-CONTROL-RECORD                                               00730085
007400*                                                                 00740085
007500                                                                  00750085
007600 01  CR-CONTROL-RECORD.                                           00760085
007700     05  CR-CONTROL-BEG-DATE.                                     00770085
007800         10  CR-BEG-CCYY              PIC  X(04)    VALUE SPACES. 00780085
007900         10  FILLER                   PIC  X(01)    VALUE '-'.    00790085
008000         10  CR-BEG-MM                PIC  X(02)    VALUE SPACES. 00800085
008100         10  FILLER                   PIC  X(01)    VALUE '-'.    00810085
008200         10  CR-BEG-DD                PIC  X(02)    VALUE SPACES. 00820085
008300     05  CR-CONTROL-END-DATE.                                     00830085
008400         10  CR-END-CCYY              PIC  X(04)    VALUE SPACES. 00840085
008500         10  FILLER                   PIC  X(01)    VALUE '-'.    00850085
008600         10  CR-END-MM                PIC  X(02)    VALUE SPACES. 00860085
008700         10  FILLER                   PIC  X(01)    VALUE '-'.    00870085
008800         10  CR-END-DD                PIC  X(02)    VALUE SPACES. 00880085
008900     05  FILLER                       PIC  X(68)    VALUE SPACES. 00890085
009000                                                                  00900085
009100*                                                                 00910085
009200* PROGRAM ACCUMULATORS                                            00920085
009300*                                                                 00930085
009400                                                                  00940085
009500 01  PROGRAM-ACCUMULATORS.                                        00950085
009600     05  PA-LINE-COUNT                   PIC 9(03) VALUE 1.       00960085
009700     05  PA-PAGE-COUNT                   PIC 9(05) VALUE 1.       00970085
009800     05  PA-STORE-BALANCE                PIC S9(07)V99 VALUE 0.   00980085
009900     05  PA-DISTRICT-BALANCE             PIC S9(07)V99 VALUE 0.   00990085
010000     05  PA-COMP-BALANCE                 PIC S9(07)V99 VALUE 0.   01000085
010100                                                                  01010085
010200*                                                                 01020085
010300* PROGRAM SWITCHES                                                01030085
010400*                                                                 01040085
010500                                                                  01050085
010600 01  PROGRAM-SWITCHES.                                            01060085
010700     05  PS-END-OF-FILE-SW            PIC  X(01)     VALUE 'N'.   01070085
010800         88  PS-END-OF-FILE                          VALUE 'Y'.   01080085
010900     05  PS-FIRST-TIME-THRU-SW        PIC  X(01)     VALUE 'Y'.   01090085
011000         88  PS-NOT-FIRST-TIME-THRU                  VALUE 'N'.   01100085
011100         88  PS-FIRST-TIME-THRU                      VALUE 'Y'.   01110085
011200     05  PS-STORES-FIRST-DATE-SW      PIC  X(01)     VALUE 'Y'.   01120085
011300         88  PS-STORES-FIRST-DATE                    VALUE 'Y'.   01130085
011400         88  PS-NOT-STORES-FIRST-DATE                VALUE 'N'.   01140085
011500     05  PS-STORES-HEADER-SW          PIC  X(01)     VALUE 'O'.   01150085
011600         88  PS-STORE-HEADER-WRITTEN                 VALUE 'Y'.   01160085
011700         88  PS-NOT-STORE-HEADER-WRITTEN             VALUE 'N'.   01170085
011800     05  PS-NEW-REPORT-SW             PIC  X(01)     VALUE 'Y'.   01180085
011900         88  PS-SAME-REPORT                          VALUE 'N'.   01190085
012000         88  PS-NEW-REPORT                           VALUE 'Y'.   01200085
012100     05  PS-END-OF-CONTROL-FILE-SW     PIC  X(01)     VALUE 'N'.  01210085
012200         88  PS-END-OF-CONTROL-FILE                   VALUE 'Y'.  01220085
012300                                                                  01230085
012400                                                                  01240085
012500*                                                                 01250085
012600* PROGRAM VARIABLES                                               01260085
012700*                                                                 01270085
012800                                                                  01280085
012900 01  PROGRAM-VAIABLES.                                            01290085
013000     05  PV-SPACE-CONTROL             PIC 9(01)   VALUE 1.        01300085
013100     05  PV-STR-NMBR                  PIC X(04).                  01310086
013200     05  PV-STR-NMBR-9 REDEFINES PV-STR-NMBR   PIC 9(04).         01320087
013300     05  PV-STR                       PIC S9(04) COMP VALUE 0.    01330089
013400     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01340085
013500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01350085
013600     05  PV-CURRENT-DATE.                                         01360085
013700         10  PV-CURRENT-YEAR          PIC  9(02)     VALUE ZERO.  01370085
013800         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  01380085
013900         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  01390085
014000     05  PV-CURRENT-TIME.                                         01400085
014100         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  01410085
014200         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  01420085
014300         10  FILLER                   PIC  9(04)     VALUE ZERO.  01430085
014400     05  PV-PREV-REPORT               PIC  X(01)     VALUE SPACES.01440085
014500     05  PV-PREV-CRD-TYP              PIC  X(08)     VALUE SPACES.01450085
014600     05  PV-PREV-AUTH-DATE            PIC  X(10)     VALUE SPACES.01460085
014700     05  PV-PREV-STORE-NMBR           PIC  X(04)     VALUE SPACES.01470085
014801     05  PV-PREV-DIST-NMBR            PIC S9(04) COMP-3           01480194
014802                                                      VALUE ZERO. 01480294
014830     05  PV-DIST-NMBR                 PIC S9(04) COMP-3           01483094
014831                                                      VALUE ZERO. 01483194
014840     05  PV-DIST-NUMERIC              PIC  9(04)      VALUE ZERO. 01484094
014900                                                                  01490085
015000*                                                                 01500085
015100* PROGRAM CONSTANTS                                               01510085
015200*                                                                 01520085
015300                                                                  01530085
015400 01  PROGRAM-CONSTANTS.                                           01540085
015500     05  PC-PROGRAM-NAME                 PIC X(08)  VALUE         01550085
015600                                               'SVKRP023'.        01560085
015700     05  PC-REPORT-ONE                   PIC X(01)  VALUE         01570085
015800                                               '1'.               01580085
015900     05  PC-REPORT-TWO                  PIC X(01)  VALUE          01590085
016000                                               '2'.               01600085
016100     05  PC-REPORT-THREE                PIC X(01)  VALUE          01610085
016200                                               '3'.               01620085
016300     05  PC-MAX-NUM-OF-LINES            PIC X(03)  VALUE          01630085
016400                                               '053'.             01640085
016500     05  PC-CORP-DESC                   PIC X(25)  VALUE          01650085
016600                                     'CORP                     '. 01660085
016700     05  PC-UNKNOWN-DESC                PIC X(25)  VALUE          01670085
016800                                     'DISTRICT UNKNOWN         '. 01680085
016900                                                                  01690085
017000                                                                  01700085
017100 01  HEADER-LINE1-1.                                              01710085
017200     05  FILLER                          PIC X(17)  VALUE SPACES. 01720085
017300     05                                  PIC X(46)  VALUE         01730085
017400         'CARDS RECEIVED AT CORP WITH A TENDERED BALANCE'.        01740085
017500     05  FILLER                          PIC X(12)  VALUE SPACES. 01750085
017600                                                                  01760085
017700 01  HEADER-LINE1-2.                                              01770085
017800     05  FILLER                          PIC X(15)  VALUE SPACES. 01780085
017900     05                                  PIC X(49)  VALUE         01790085
018000         'CARDS RECEIVED AT CORP WITH AN ISSUE ONLY BALANCE'.     01800085
018100     05  FILLER                          PIC X(11)  VALUE SPACES. 01810085
018200                                                                  01820085
018300 01  HEADER-LINE1-3.                                              01830085
018400     05  FILLER                          PIC X(17)  VALUE SPACES. 01840085
018500     05                                  PIC X(46)  VALUE         01850085
018600         'CARDS RECEIVED AT CORP WITH A NEGATIVE BALANCE'.        01860085
018700     05  FILLER                          PIC X(12)  VALUE SPACES. 01870085
018800                                                                  01880085
018900 01  HEADER-LINE2.                                                01890085
019000     05  FILLER                          PIC X(22)  VALUE SPACES. 01900085
019100     05  HL2-CARD-DESC                   PIC X(08)  VALUE SPACES. 01910085
019200     05  FILLER                          PIC X(02)  VALUE SPACES. 01920085
019300     05  HL2-START-MM                    PIC X(02)  VALUE SPACES. 01930085
019400     05  FILLER                          PIC X(01)  VALUE '/'.    01940085
019500     05  HL2-START-DD                    PIC X(02)  VALUE SPACES. 01950085
019600     05  FILLER                          PIC X(01)  VALUE '/'.    01960085
019700     05  HL2-START-CCYY                  PIC X(04)  VALUE SPACES. 01970085
019800     05  FILLER                          PIC X(06)  VALUE         01980085
019900         ' THRU '.                                                01990085
020000     05  HL2-END-MM                      PIC X(02)  VALUE SPACES. 02000085
020100     05  FILLER                          PIC X(01)  VALUE '/'.    02010085
020200     05  HL2-END-DD                      PIC X(02)  VALUE SPACES. 02020085
020300     05  FILLER                          PIC X(01)  VALUE '/'.    02030085
020400     05  HL2-END-CCYY                    PIC X(04)  VALUE SPACES. 02040085
020500     05  FILLER                          PIC X(17)  VALUE SPACES. 02050085
020600                                                                  02060085
020700 01  HEADER-LINE3.                                                02070085
020800*    05  HL3-DISTRICT-NMBR              PIC X(02)  VALUE SPACES.  02080091
020810     05  HL3-DISTRICT-NMBR              PIC X(04)  VALUE SPACES.  02081091
020900     05                                 PIC X(03)  VALUE          02090085
021000         ' - '.                                                   02100085
021100     05  HL3-DISTRICT-DESC              PIC X(25)  VALUE SPACES.  02110085
021200     05  FILLER                         PIC X(53)  VALUE SPACES.  02120091
021300                                                                  02130085
021400 01  HEADER-LINE4.                                                02140085
021500     05  FILLER                         PIC X(02)  VALUE SPACES.  02150085
021600     05  HL4-STORE-NMBR                 PIC X(04)  VALUE SPACES.  02160085
021700     05                                 PIC X(03)  VALUE          02170085
021800         ' - '.                                                   02180085
021900     05  HL4-STORE-DESC                 PIC X(25)  VALUE SPACES.  02190085
022000     05  FILLER                         PIC X(41)  VALUE SPACES.  02200085
022100                                                                  02210085
022200 01  HEADER-LINE5.                                                02220085
022311     05  FILLER                         PIC X(02)  VALUE SPACES.  02231196
022400     05                                 PIC X(13)  VALUE          02240085
022500         'LAST TNDR DTE'.                                         02250085
022600     05  FILLER                         PIC X(02)  VALUE SPACES.  02260099
022700     05                                 PIC X(04)  VALUE          02270085
022800         'TERM'.                                                  02280085
022910     05  FILLER                         PIC X(01)  VALUE SPACES.  02291097
023000     05                                 PIC X(04)  VALUE          02300085
023100         'TRAN'.                                                  02310085
023201     05  FILLER                         PIC X(03)  VALUE SPACES.  02320198
023300     05                                 PIC X(07)  VALUE          02330085
023400         'CARD ID'.                                               02340085
023500     05  FILLER                         PIC X(05)  VALUE SPACES.  02350099
023600     05                                 PIC X(07)  VALUE          02360085
023700         'OPER ID'.                                               02370085
023811     05  FILLER                         PIC X(07)  VALUE SPACES.  02381199
023900     05                                 PIC X(09)  VALUE          02390085
024000         'ISSUE AMT'.                                             02400085
024100     05  FILLER                         PIC X(03)  VALUE SPACES.  02410085
024200     05                                 PIC X(07)  VALUE          02420085
024300         'BALANCE'.                                               02430085
024400     05  FILLER                         PIC X(01)  VALUE SPACES.  02440085
024500                                                                  02450085
024600 01  DETAIL-LINE.                                                 02460085
024711     05  FILLER                         PIC X(03)  VALUE SPACES.  02471196
024800     05  DL-TENDER-DATE                 PIC X(10)  VALUE SPACES.  02480085
024900     05  FILLER                         PIC X(04)  VALUE SPACES.  02490099
025000     05  DL-TERM-NMBR                   PIC X(04)  VALUE SPACES.  02500085
025101     05  FILLER                         PIC X(01)  VALUE SPACES.  02510197
025200     05  DL-TRAN-NMBR                   PIC X(04)  VALUE SPACES.  02520085
025301     05  FILLER                         PIC X(01)  VALUE SPACES.  02530198
025400     05  DL-CARD-ID                     PIC ZZ9(10) VALUE ZEROES. 02540085
025500     05  FILLER                         PIC X(02)  VALUE SPACES.  02550099
025600     05  DL-OPER-ID                     PIC X(11)  VALUE SPACES.  02560085
025621     05  FILLER                         PIC X(04)  VALUE SPACES.  02562199
025700     05  DL-ISSUE-AMT                   PIC ZZZ9.99-              02570085
025800                                                   VALUE ZEROES.  02580085
025900     05  FILLER                         PIC X(02)  VALUE SPACES.  02590085
026000     05  DL-CARD-BALANCE                PIC ZZZ9.99-              02600085
026100                                                   VALUE ZEROES.  02610085
026200     05  FILLER                         PIC X(01)  VALUE SPACES.  02620085
026300                                                                  02630085
026400 01  SUMMARY-LINE2.                                               02640085
026500     05  FILLER                         PIC X(20)  VALUE SPACES.  02650085
026600     05                                 PIC X(19)  VALUE          02660085
026700         '   TOTAL FOR STORE '.                                   02670085
026800     05  SL2-STORE-NMBR                 PIC X(04)  VALUE SPACES.  02680085
026900     05  FILLER                         PIC X(18)  VALUE SPACES.  02690085
027000     05  SL2-STORE-BALANCE              PIC Z,ZZZ,ZZ9.99-         02700085
027100                                                   VALUE ZEROES.  02710085
027200                                                                  02720085
027300 01  SUMMARY-LINE3.                                               02730085
027400     05  FILLER                         PIC X(19)  VALUE SPACES.  02740085
027500     05                                 PIC X(23)  VALUE          02750085
027600         '    TOTAL FOR DISTRICT '.                               02760085
027700     05  SL3-DISTRICT-NMBR              PIC X(04)  VALUE SPACES.  02770085
027800     05  FILLER                         PIC X(15)  VALUE SPACES.  02780085
027900     05  SL3-DIST-BALANCE               PIC Z,ZZZ,ZZ9.99-         02790085
028000                                                   VALUE ZEROES.  02800085
028100     05  FILLER                         PIC X(01)  VALUE SPACES.  02810085
028200                                                                  02820085
028300 01  SUMMARY-LINE4.                                               02830085
028400     05  FILLER                         PIC X(18)  VALUE SPACES.  02840085
028500     05                                 PIC X(23)  VALUE          02850085
028600         '     TOTAL COMPANY FOR '.                               02860085
028700     05  SL4-CARD-DESC                  PIC X(08)  VALUE SPACES.  02870085
028800     05  FILLER                         PIC X(12)  VALUE SPACES.  02880085
028900     05  SL4-COMP-BALANCE               PIC Z,ZZZ,ZZ9.99-         02890085
029000                                                   VALUE ZEROES.  02900085
029100     05  FILLER                         PIC X(01)  VALUE SPACES.  02910085
029200                                                                  02920085
029300 01  SUMMARY-LINE5.                                               02930085
029400     05  FILLER                         PIC X(66)  VALUE SPACES.  02940085
029500     05  SL5-DIVIDER                    PIC X(08)  VALUE ALL '-'. 02950085
029600     05  FILLER                         PIC X(01)  VALUE SPACES.  02960085
029700                                                                  02970085
029800*                                                                 02980085
029900* ABEND CODES                                                     02990085
030000*                                                                 03000085
030100                                                                  03010085
030200 01  ABEND-CODE                          PIC S9(04) VALUE +0.     03020085
030300     88  ABEND-4002-READ-ERROR                      VALUE +4002.  03030085
030400     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  03040085
030500                                                                  03050085
030600*                                                                 03060085
030700* WORKING STORAGE MEMBER USED TO CREATE FILE                      03070085
030800*                                                                 03080085
030900                                                                  03090085
031000     COPY SVRD017.                                                03100085
031100                                                                  03110085
031200*                                                                 03120085
031300* PAGE HEADER FOR AN 75 COLUMN REPORT                             03130085
031400*                                                                 03140085
031500                                                                  03150085
031600     COPY DPWS075O.                                               03160085
031700                                                                  03170085
031800*                                                                 03180085
031900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03190085
032000*                                                                 03200085
032100     COPY DPWS004.                                                03210085
032200                                                                  03220085
033010*                                                                 03301085
033020* DOMAIN LOCATION TABLE                                           03302085
033030*                                                                 03303085
033040                                                                  03304085
033050     EXEC SQL                                                     03305085
033060         INCLUDE XST00001                                         03306085
033070     END-EXEC.                                                    03307085
033080                                                                  03308085
033098*                                                                 03309885
033099* DOMAIN DISTRICT TABLE                                           03309985
033100*                                                                 03310085
033101                                                                  03310185
033102     EXEC SQL                                                     03310285
033103         INCLUDE XST00003                                         03310385
033104     END-EXEC.                                                    03310485
033105                                                                  03310585
034000*                                                                 03400085
034100*  COMMUNICATION AREAS FOR DB2                                    03410085
034200*                                                                 03420085
034300     EXEC SQL                                                     03430085
034400         INCLUDE SQLCA                                            03440085
034500     END-EXEC.                                                    03450085
034600                                                                  03460085
034700*                                                                 03470085
034800*  DB2 COMMUNICATION AREA 2                                       03480085
034900*                                                                 03490085
035000                                                                  03500085
035100     COPY SQLCA2.                                                 03510085
035200                                                                  03520085
035300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03530085
035400 PROCEDURE DIVISION.                                              03540085
035500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03550085
035600                                                                  03560085
035700******************************************************************03570085
035800*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03580085
035900*                                                                 03590085
036000                                                                  03600085
036100 0000-PROGRAM-MAINLINE.                                           03610085
036200*---------------------                                            03620085
036300                                                                  03630085
036400     PERFORM 1000-INITIALIZE.                                     03640085
036500     PERFORM 2000-CREATE-REPORT UNTIL PS-END-OF-FILE.             03650085
036600     PERFORM 6100-STORE-TTL                                       03660085
036700     PERFORM 6200-DISTRICT-TTL                                    03670085
036800     PERFORM 6300-CARD-TYP-TTL                                    03680085
036900     PERFORM 9000-EOJ-ROUTINE.                                    03690085
037000     STOP RUN.                                                    03700085
037100                                                                  03710085
037200******************************************************************03720085
037300*  1000-INITIALIZE OPENS ALL THE FILES ASSOCIATED WITH THE JOB.   03730085
037400*  ACCEPTS THE SYSTEM DATE AND TIME, FILLING THE APPROPRIATE RE-  03740085
037500*  PORT HEADERS. ACCEPTS CONTROL CARD FOR ACTIVITY DATE.          03750085
037600*                                                                 03760085
037700                                                                  03770085
037800 1000-INITIALIZE.                                                 03780085
037900*---------------                                                  03790085
038000                                                                  03800085
038100     OPEN INPUT  CONTROL-DATE-FILE                                03810085
038200                 BALANCE-EXTRACT.                                 03820085
038300     OPEN OUTPUT TENDERED-REPORT                                  03830085
038400                 OVR-TEND-REPORT                                  03840085
038500                 NOT-TEND-REPORT.                                 03850085
038600                                                                  03860085
038700     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                03870085
038800       AT END                                                     03880085
038900         SET PS-END-OF-CONTROL-FILE TO TRUE.                      03890085
039000                                                                  03900085
039100     IF PS-END-OF-CONTROL-FILE                                    03910085
039200       DISPLAY ' '                                                03920085
039300       DISPLAY '** ABEND     **'                                  03930085
039400       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              03940085
039500       DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '         03950085
039600       DISPLAY '** CONTROL DATE FILE IS EMPTY  '                  03960085
039700       SET  ABEND-4002-READ-ERROR TO TRUE                         03970085
039800       CALL 'ILBOABN0' USING ABEND-CODE                           03980085
039900     ELSE                                                         03990085
040000       MOVE CR-BEG-CCYY TO HL2-START-CCYY                         04000085
040100       MOVE CR-BEG-MM   TO HL2-START-MM                           04010085
040200       MOVE CR-BEG-DD   TO HL2-START-DD                           04020085
040300       MOVE CR-END-CCYY TO HL2-END-CCYY                           04030085
040400       MOVE CR-END-MM   TO HL2-END-MM                             04040085
040500       MOVE CR-END-DD   TO HL2-END-DD                             04050085
040600     END-IF.                                                      04060085
040700                                                                  04070085
040800     ACCEPT PV-CURRENT-DATE FROM DATE.                            04080085
040900     ACCEPT PV-CURRENT-TIME FROM TIME.                            04090085
041000                                                                  04100085
041100     MOVE PV-CURRENT-YEAR TO DP075O-RUN-YEAR.                     04110085
041200     MOVE PV-CURRENT-MONTH TO DP075O-RUN-MONTH.                   04120085
041300     MOVE PV-CURRENT-DAY TO DP075O-RUN-DAY.                       04130085
041400                                                                  04140085
041500     MOVE PV-CURRENT-HOUR TO DP075O-RUN-HOUR.                     04150085
041600     MOVE PV-CURRENT-MINUTE TO DP075O-RUN-MINUTE.                 04160085
041700                                                                  04170085
041800     MOVE PC-PROGRAM-NAME  TO  DP075O-PROGRAM-NAME.               04180085
041900                                                                  04190085
042000     SET PS-FIRST-TIME-THRU TO TRUE.                              04200085
042100     PERFORM 8000-READ-BALANCE-EXTRACT.                           04210085
042200                                                                  04220085
042300******************************************************************04230085
042400* 2000-CREATE-REPORT                                              04240085
042500*                                                                 04250085
042600                                                                  04260085
042700 2000-CREATE-REPORT.                                              04270085
042800*------------------                                               04280085
042900                                                                  04290085
043000     IF SV017-REPORT-IND = PV-PREV-REPORT                         04300085
043100        IF SV017-CRD-STK-TYP-ID = PV-PREV-CRD-TYP                 04310085
043200           CONTINUE                                               04320085
043300        ELSE                                                      04330085
043400           PERFORM 6100-STORE-TTL                                 04340085
043500           PERFORM 6200-DISTRICT-TTL                              04350085
043600           PERFORM 6300-CARD-TYP-TTL                              04360085
043700           MOVE SV017-REPORT-IND TO PV-PREV-REPORT                04370085
043800                                    DP075O-REPORT-NUMBER          04380085
043900           MOVE SV017-CRD-STK-TYP-ID TO PV-PREV-CRD-TYP           04390085
044000                                     HL2-CARD-DESC                04400085
044100           MOVE 1 TO PA-PAGE-COUNT                                04410085
044200           PERFORM 7000-WRITE-PAGE-HEADINGS                       04420085
044300           SET PS-NEW-REPORT TO TRUE                              04430085
044400        END-IF                                                    04440085
044500     ELSE                                                         04450085
044600        IF PS-FIRST-TIME-THRU                                     04460085
044700           CONTINUE                                               04470085
044800        ELSE                                                      04480085
044900           PERFORM 6100-STORE-TTL                                 04490085
045000           PERFORM 6200-DISTRICT-TTL                              04500085
045100           PERFORM 6300-CARD-TYP-TTL                              04510085
045200        END-IF                                                    04520085
045300        MOVE SV017-REPORT-IND TO PV-PREV-REPORT                   04530085
045400                             DP075O-REPORT-NUMBER                 04540085
045500        MOVE SV017-CRD-STK-TYP-ID TO PV-PREV-CRD-TYP              04550085
045600                                  HL2-CARD-DESC                   04560085
045700        MOVE 1 TO PA-PAGE-COUNT                                   04570085
045800        PERFORM 7000-WRITE-PAGE-HEADINGS                          04580085
045900        SET PS-NEW-REPORT TO TRUE                                 04590085
046000     END-IF.                                                      04600085
046100                                                                  04610085
046200     IF SV017-DISTRICT-NMBR = PV-PREV-DIST-NMBR                   04620085
046300        IF SV017-STR-NMBR = PV-PREV-STORE-NMBR                    04630085
046400           IF PS-NEW-REPORT                                       04640085
046500              MOVE SV017-STR-NMBR TO HL4-STORE-NMBR               04650085
046600              MOVE SV017-DISTRICT-NMBR TO PV-DIST-NUMERIC         04660092
046610              MOVE PV-DIST-NUMERIC     TO HL3-DISTRICT-NMBR       04661092
046700              PERFORM 7100-WRITE-DISTRICT-HEADING                 04670085
046800           ELSE                                                   04680085
046900              CONTINUE                                            04690085
047000           END-IF                                                 04700085
047100        ELSE                                                      04710085
047200           IF PS-NEW-REPORT                                       04720085
047300              MOVE SV017-STR-NMBR TO HL4-STORE-NMBR               04730085
047400              MOVE SV017-DISTRICT-NMBR TO PV-DIST-NUMERIC         04740092
047410              MOVE PV-DIST-NUMERIC     TO HL3-DISTRICT-NMBR       04741092
047500              PERFORM 7100-WRITE-DISTRICT-HEADING                 04750085
047600           ELSE                                                   04760085
047700              PERFORM 6100-STORE-TTL                              04770085
047800              MOVE SV017-STR-NMBR TO HL4-STORE-NMBR               04780085
047900              MOVE SV017-DISTRICT-NMBR TO PV-DIST-NUMERIC         04790092
047910              MOVE PV-DIST-NUMERIC     TO HL3-DISTRICT-NMBR       04791092
048000              IF PA-LINE-COUNT > PC-MAX-NUM-OF-LINES              04800085
048100                 PERFORM 7000-WRITE-PAGE-HEADINGS                 04810085
048200                 PERFORM 7100-WRITE-DISTRICT-HEADING              04820085
048300              ELSE                                                04830085
048400                 PERFORM 7200-WRITE-STORE-HEADING                 04840085
048500              END-IF                                              04850085
048600           END-IF                                                 04860085
048700        END-IF                                                    04870085
048800     ELSE                                                         04880085
048900        IF PS-NEW-REPORT                                          04890085
049000           MOVE SV017-STR-NMBR TO HL4-STORE-NMBR                  04900085
049100           MOVE SV017-DISTRICT-NMBR TO PV-DIST-NUMERIC            04910092
049110           MOVE PV-DIST-NUMERIC     TO HL3-DISTRICT-NMBR          04911092
049200           PERFORM 7100-WRITE-DISTRICT-HEADING                    04920085
049300        ELSE                                                      04930085
049400           PERFORM 6100-STORE-TTL                                 04940085
049500           PERFORM 6200-DISTRICT-TTL                              04950085
049600           MOVE SV017-DISTRICT-NMBR TO PV-DIST-NUMERIC            04960092
049610           MOVE PV-DIST-NUMERIC     TO HL3-DISTRICT-NMBR          04961092
049700           MOVE SV017-STR-NMBR TO HL4-STORE-NMBR                  04970085
049800           PERFORM 7000-WRITE-PAGE-HEADINGS                       04980085
049900           PERFORM 7100-WRITE-DISTRICT-HEADING                    04990085
050000        END-IF                                                    05000085
050100     END-IF.                                                      05010085
050200                                                                  05020085
050300     PERFORM 3000-MOVE-DETAIL.                                    05030085
050400                                                                  05040085
050500     PERFORM 8000-READ-BALANCE-EXTRACT.                           05050085
050600                                                                  05060085
050700******************************************************************05070085
050800* 3000-MOVE-DETAIL                                                05080085
050900*                                                                 05090085
051000                                                                  05100085
051100 3000-MOVE-DETAIL.                                                05110085
051200*----------------                                                 05120085
051300                                                                  05130085
051400     IF PA-LINE-COUNT > PC-MAX-NUM-OF-LINES                       05140085
051500        IF PS-STORE-HEADER-WRITTEN                                05150085
051600           CONTINUE                                               05160085
051700        ELSE                                                      05170085
051800           PERFORM 7000-WRITE-PAGE-HEADINGS                       05180085
051900           PERFORM 7100-WRITE-DISTRICT-HEADING                    05190085
052000        END-IF                                                    05200085
052100     ELSE                                                         05210085
052200        CONTINUE                                                  05220085
052300     END-IF.                                                      05230085
052400                                                                  05240085
052500     IF SV017-TRN-AUTH-DATE = PV-PREV-AUTH-DATE                   05250085
052600        MOVE 1 TO PV-SPACE-CONTROL                                05260085
052700        IF PS-FIRST-TIME-THRU                                     05270085
052800           MOVE SV017-TRN-AUTH-DATE TO DL-TENDER-DATE             05280085
052900        ELSE                                                      05290085
053000           IF PS-STORES-FIRST-DATE                                05300085
053100              MOVE 2 TO PV-SPACE-CONTROL                          05310085
053200              MOVE SV017-TRN-AUTH-DATE TO DL-TENDER-DATE          05320085
053300           ELSE                                                   05330085
053400              MOVE SPACES TO DL-TENDER-DATE                       05340085
053500           END-IF                                                 05350085
053600        END-IF                                                    05360085
053700     ELSE                                                         05370085
053800        MOVE 2 TO PV-SPACE-CONTROL                                05380085
053900        MOVE SV017-TRN-AUTH-DATE       TO DL-TENDER-DATE          05390085
054000                                       PV-PREV-AUTH-DATE          05400085
054100     END-IF.                                                      05410085
054200                                                                  05420085
054300     MOVE SV017-STR-NMBR            TO PV-PREV-STORE-NMBR.        05430085
054400     MOVE SV017-DISTRICT-NMBR       TO PV-PREV-DIST-NMBR.         05440085
054500     MOVE SV017-POS-TRMNL-NMBR      TO DL-TERM-NMBR.              05450085
054600     MOVE SV017-POS-TRN-NMBR        TO DL-TRAN-NMBR.              05460085
054700     MOVE SV017-CARD-NMBR           TO DL-CARD-ID.                05470085
054800     MOVE SV017-USR-OR-OPRT-ID      TO DL-OPER-ID.                05480085
054900     MOVE SV017-BALANCE             TO DL-CARD-BALANCE.           05490085
055000     MOVE SV017-APP-AUTH-AMT        TO DL-ISSUE-AMT.              05500085
055100                                                                  05510085
055200     ADD SV017-BALANCE TO PA-STORE-BALANCE.                       05520085
055300                                                                  05530085
055400     PERFORM 5000-WRITE-DETAIL.                                   05540085
055500                                                                  05550085
055600     SET PS-NOT-FIRST-TIME-THRU TO TRUE.                          05560085
055700     SET PS-NOT-STORE-HEADER-WRITTEN TO TRUE.                     05570085
055800     SET PS-SAME-REPORT TO TRUE.                                  05580085
055900                                                                  05590085
056000******************************************************************05600085
056100* 5000-WRITE-DETAIL                                               05610085
056200*                                                                 05620085
056300                                                                  05630085
056400 5000-WRITE-DETAIL.                                               05640085
056500*-----------------                                                05650085
056600                                                                  05660085
056700     EVALUATE TRUE                                                05670085
056800        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 05680085
056900           MOVE DETAIL-LINE TO REPORT1-OUT                        05690085
057000           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               05700085
057100                                                                  05710085
057200        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 05720085
057300           MOVE DETAIL-LINE TO REPORT2-OUT                        05730085
057400           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               05740085
057500                                                                  05750085
057600        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               05760085
057700           MOVE DETAIL-LINE TO REPORT3-OUT                        05770085
057800           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               05780085
057900                                                                  05790085
058000     END-EVALUATE.                                                05800085
058100                                                                  05810085
058200     ADD PV-SPACE-CONTROL TO PA-LINE-COUNT.                       05820085
058300     MOVE 1 TO PV-SPACE-CONTROL.                                  05830085
058400     SET PS-NOT-STORES-FIRST-DATE TO TRUE.                        05840085
058500                                                                  05850085
058600******************************************************************05860085
058700* 6100-STORE-TTL                                                  05870085
058800*                                                                 05880085
058900                                                                  05890085
059000 6100-STORE-TTL.                                                  05900085
059100*--------------                                                   05910085
059200                                                                  05920085
059300     MOVE 1 TO PV-SPACE-CONTROL.                                  05930085
059400     MOVE PA-STORE-BALANCE TO SL2-STORE-BALANCE.                  05940085
059500     MOVE PV-PREV-STORE-NMBR TO SL2-STORE-NMBR.                   05950085
059600     ADD PA-STORE-BALANCE TO PA-DISTRICT-BALANCE                  05960085
059700     MOVE 0 TO PA-STORE-BALANCE.                                  05970085
059800                                                                  05980085
059900     EVALUATE TRUE                                                05990085
060000        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 06000085
060100           MOVE SUMMARY-LINE5 TO REPORT1-OUT                      06010085
060200           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               06020085
060300           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06030085
060400           MOVE SUMMARY-LINE2 TO REPORT1-OUT                      06040085
060500           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               06050085
060600           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06060085
060700                                                                  06070085
060800        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 06080085
060900           MOVE SUMMARY-LINE5 TO REPORT2-OUT                      06090085
061000           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               06100085
061100           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06110085
061200           MOVE SUMMARY-LINE2 TO REPORT2-OUT                      06120085
061300           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               06130085
061400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06140085
061500                                                                  06150085
061600        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               06160085
061700           MOVE SUMMARY-LINE5 TO REPORT3-OUT                      06170085
061800           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               06180085
061900           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06190085
062000           MOVE SUMMARY-LINE2 TO REPORT3-OUT                      06200085
062100           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               06210085
062200           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06220085
062300                                                                  06230085
062400     END-EVALUATE.                                                06240085
062500                                                                  06250085
062600******************************************************************06260085
062700* 6200-DISTRICT-TTL                                               06270085
062800*                                                                 06280085
062900                                                                  06290085
063000 6200-DISTRICT-TTL.                                               06300085
063100*-----------------                                                06310085
063200                                                                  06320085
063300     MOVE 1 TO PV-SPACE-CONTROL.                                  06330085
063400     MOVE PA-DISTRICT-BALANCE TO SL3-DIST-BALANCE.                06340085
063500     MOVE PV-PREV-DIST-NMBR TO PV-DIST-NUMERIC.                   06350092
063510     MOVE PV-DIST-NUMERIC   TO SL3-DISTRICT-NMBR.                 06351092
063600     ADD PA-DISTRICT-BALANCE TO PA-COMP-BALANCE.                  06360085
063700     MOVE 0 TO PA-DISTRICT-BALANCE.                               06370085
063800                                                                  06380085
063900     EVALUATE TRUE                                                06390085
064000        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 06400085
064100           MOVE SUMMARY-LINE5 TO REPORT1-OUT                      06410085
064200           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               06420085
064300           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06430085
064400           MOVE SUMMARY-LINE3 TO REPORT1-OUT                      06440085
064500           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               06450085
064600           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06460085
064700                                                                  06470085
064800        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 06480085
064900           MOVE SUMMARY-LINE5 TO REPORT2-OUT                      06490085
065000           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               06500085
065100           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06510085
065200           MOVE SUMMARY-LINE3 TO REPORT2-OUT                      06520085
065300           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               06530085
065400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06540085
065500                                                                  06550085
065600        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               06560085
065700           MOVE SUMMARY-LINE5 TO REPORT3-OUT                      06570085
065800           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               06580085
065900           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06590085
066000           MOVE SUMMARY-LINE3 TO REPORT3-OUT                      06600085
066100           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               06610085
066200           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06620085
066300                                                                  06630085
066400     END-EVALUATE.                                                06640085
066500                                                                  06650085
066600     MOVE 2 TO PV-SPACE-CONTROL.                                  06660085
066700                                                                  06670085
066800******************************************************************06680085
066900* 6300-CRD-TYP-TTL                                                06690085
067000*                                                                 06700085
067100                                                                  06710085
067200 6300-CARD-TYP-TTL.                                               06720085
067300*-----------------                                                06730085
067400                                                                  06740085
067500     MOVE PA-COMP-BALANCE TO SL4-COMP-BALANCE.                    06750085
067600     MOVE PV-PREV-CRD-TYP TO SL4-CARD-DESC.                       06760085
067700     MOVE 0 TO PA-COMP-BALANCE.                                   06770085
067800     MOVE 1 TO PV-SPACE-CONTROL.                                  06780085
067900                                                                  06790085
068000     EVALUATE TRUE                                                06800085
068100        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 06810085
068200           MOVE SUMMARY-LINE5 TO REPORT1-OUT                      06820085
068300           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               06830085
068400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06840085
068500           MOVE SUMMARY-LINE4 TO REPORT1-OUT                      06850085
068600           WRITE REPORT1-OUT AFTER PV-SPACE-CONTROL               06860085
068700           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06870085
068800                                                                  06880085
068900        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 06890085
069000           MOVE SUMMARY-LINE5 TO REPORT2-OUT                      06900085
069100           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               06910085
069200           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06920085
069300           MOVE SUMMARY-LINE4 TO REPORT2-OUT                      06930085
069400           WRITE REPORT2-OUT AFTER PV-SPACE-CONTROL               06940085
069500           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  06950085
069600                                                                  06960085
069700        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               06970085
069800           MOVE SUMMARY-LINE5 TO REPORT3-OUT                      06980085
069900           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               06990085
070000           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07000085
070100           MOVE SUMMARY-LINE4 TO REPORT3-OUT                      07010085
070200           WRITE REPORT3-OUT AFTER PV-SPACE-CONTROL               07020085
070300           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07030085
070400                                                                  07040085
070500     END-EVALUATE.                                                07050085
070600                                                                  07060085
070700******************************************************************07070085
070800* 7000-WRITE-PAGE-HEADINGS                                        07080085
070900*                                                                 07090085
071000                                                                  07100085
071100 7000-WRITE-PAGE-HEADINGS.                                        07110085
071200*------------------------                                         07120085
071300                                                                  07130085
071400     MOVE 1 TO PV-SPACE-CONTROL.                                  07140085
071500     MOVE 1 TO PA-LINE-COUNT.                                     07150085
071600     MOVE PA-PAGE-COUNT TO DP075O-PAGE-NUMBER.                    07160085
071700                                                                  07170085
071800     EVALUATE TRUE                                                07180085
071900        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 07190085
072000           MOVE DP075O-STANDARD-HEADER-75-COLS TO REPORT1-OUT     07200085
072100           WRITE REPORT1-OUT AFTER ADVANCING PAGE                 07210085
072200           MOVE HEADER-LINE1-1 TO REPORT1-OUT                     07220085
072300           WRITE REPORT1-OUT AFTER ADVANCING PV-SPACE-CONTROL     07230085
072400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07240085
072500           MOVE HEADER-LINE2 TO REPORT1-OUT                       07250085
072600           WRITE REPORT1-OUT AFTER ADVANCING PV-SPACE-CONTROL     07260085
072700           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07270085
072800                                                                  07280085
072900        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 07290085
073000           MOVE DP075O-STANDARD-HEADER-75-COLS TO REPORT2-OUT     07300085
073100           WRITE REPORT2-OUT AFTER ADVANCING PAGE                 07310085
073200           MOVE HEADER-LINE1-2 TO REPORT2-OUT                     07320085
073300           WRITE REPORT2-OUT AFTER ADVANCING PV-SPACE-CONTROL     07330085
073400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07340085
073500           MOVE HEADER-LINE2 TO REPORT2-OUT                       07350085
073600           WRITE REPORT2-OUT AFTER ADVANCING PV-SPACE-CONTROL     07360085
073700           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07370085
073800                                                                  07380085
073900        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               07390085
074000           MOVE DP075O-STANDARD-HEADER-75-COLS TO REPORT3-OUT     07400085
074100           WRITE REPORT3-OUT AFTER ADVANCING PAGE                 07410085
074200           MOVE HEADER-LINE1-3 TO REPORT3-OUT                     07420085
074300           WRITE REPORT3-OUT AFTER ADVANCING PV-SPACE-CONTROL     07430085
074400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07440085
074500           MOVE HEADER-LINE2 TO REPORT3-OUT                       07450085
074600           WRITE REPORT3-OUT AFTER ADVANCING PV-SPACE-CONTROL     07460085
074700           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07470085
074800                                                                  07480085
074900     END-EVALUATE.                                                07490085
075000                                                                  07500085
075100     ADD 1 TO PA-PAGE-COUNT.                                      07510085
075200                                                                  07520085
075300******************************************************************07530085
075400* 7100-WRITE-DISTRICT-HEADING                                     07540085
075500*                                                                 07550085
075600                                                                  07560085
075700 7100-WRITE-DISTRICT-HEADING.                                     07570085
075800*---------------------------                                      07580085
075900                                                                  07590085
076000     PERFORM 7500-GET-DESC.                                       07600085
076100                                                                  07610085
076200     MOVE 2 TO PV-SPACE-CONTROL.                                  07620085
076300                                                                  07630085
076400     EVALUATE TRUE                                                07640085
076500        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 07650085
076600           MOVE HEADER-LINE3 TO REPORT1-OUT                       07660085
076700           WRITE REPORT1-OUT AFTER ADVANCING PV-SPACE-CONTROL     07670085
076800           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07680085
076900           MOVE 1 TO PV-SPACE-CONTROL                             07690085
077000           MOVE HEADER-LINE4 TO REPORT1-OUT                       07700085
077100           WRITE REPORT1-OUT AFTER ADVANCING PV-SPACE-CONTROL     07710085
077200           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07720085
077300           MOVE HEADER-LINE5 TO REPORT1-OUT                       07730085
077400           WRITE REPORT1-OUT AFTER ADVANCING PV-SPACE-CONTROL     07740085
077500           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07750085
077600                                                                  07760085
077700        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 07770085
077800           MOVE HEADER-LINE3 TO REPORT2-OUT                       07780085
077900           WRITE REPORT2-OUT AFTER ADVANCING PV-SPACE-CONTROL     07790085
078000           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07800085
078100           MOVE 1 TO PV-SPACE-CONTROL                             07810085
078200           MOVE HEADER-LINE4 TO REPORT2-OUT                       07820085
078300           WRITE REPORT2-OUT AFTER ADVANCING PV-SPACE-CONTROL     07830085
078400           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07840085
078500           MOVE HEADER-LINE5 TO REPORT2-OUT                       07850085
078600           WRITE REPORT2-OUT AFTER ADVANCING PV-SPACE-CONTROL     07860085
078700           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07870085
078800                                                                  07880085
078900        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               07890085
079000           MOVE HEADER-LINE3 TO REPORT3-OUT                       07900085
079100           WRITE REPORT3-OUT AFTER ADVANCING PV-SPACE-CONTROL     07910085
079200           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07920085
079300           MOVE 1 TO PV-SPACE-CONTROL                             07930085
079400           MOVE HEADER-LINE4 TO REPORT3-OUT                       07940085
079500           WRITE REPORT3-OUT AFTER ADVANCING PV-SPACE-CONTROL     07950085
079600           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07960085
079700           MOVE HEADER-LINE5 TO REPORT3-OUT                       07970085
079800           WRITE REPORT3-OUT AFTER ADVANCING PV-SPACE-CONTROL     07980085
079900           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  07990085
080000                                                                  08000085
080100     END-EVALUATE.                                                08010085
080200                                                                  08020085
080300     SET PS-STORES-FIRST-DATE TO TRUE.                            08030085
080400                                                                  08040085
080500******************************************************************08050085
080600* 7200-WRITE-STORE-HEADING                                        08060085
080700*                                                                 08070085
080800                                                                  08080085
080900 7200-WRITE-STORE-HEADING.                                        08090085
081000*------------------------                                         08100085
081100                                                                  08110085
081200     PERFORM 7500-GET-DESC.                                       08120085
081300     MOVE SV017-STR-NMBR TO HL4-STORE-NMBR                        08130085
081400     MOVE 2 TO PV-SPACE-CONTROL.                                  08140085
081500                                                                  08150085
081600     EVALUATE TRUE                                                08160085
081700        WHEN DP075O-REPORT-NUMBER = PC-REPORT-ONE                 08170085
081800           MOVE HEADER-LINE4 TO REPORT1-OUT                       08180085
081900           WRITE REPORT1-OUT AFTER ADVANCING PV-SPACE-CONTROL     08190085
082000           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  08200085
082100                                                                  08210085
082200        WHEN DP075O-REPORT-NUMBER = PC-REPORT-TWO                 08220085
082300           MOVE HEADER-LINE4 TO REPORT2-OUT                       08230085
082400           WRITE REPORT2-OUT AFTER ADVANCING PV-SPACE-CONTROL     08240085
082500           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  08250085
082600                                                                  08260085
082700        WHEN DP075O-REPORT-NUMBER = PC-REPORT-THREE               08270085
082800           MOVE HEADER-LINE4 TO REPORT3-OUT                       08280085
082900           WRITE REPORT3-OUT AFTER ADVANCING PV-SPACE-CONTROL     08290085
083000           ADD PV-SPACE-CONTROL TO PA-LINE-COUNT                  08300085
083100                                                                  08310085
083200     END-EVALUATE.                                                08320085
083300                                                                  08330085
083400     SET PS-STORES-FIRST-DATE TO TRUE.                            08340085
083500     SET PS-STORE-HEADER-WRITTEN TO TRUE.                         08350085
083600                                                                  08360085
083700******************************************************************08370085
083800* 7500-GET-DESC                                                   08380085
083900*                                                                 08390085
084000                                                                  08400085
084100 7500-GET-DESC.                                                   08410085
084200*-------------                                                    08420085
084300                                                                  08430085
084400     MOVE SV017-STR-NMBR TO PV-STR-NMBR.                          08440085
084410     MOVE PV-STR-NMBR-9  TO PV-STR                                08441087
084500                                                                  08450085
084600     EXEC SQL                                                     08460085
084700        SELECT LOC_NM                                             08470085
084800          INTO :HL4-STORE-DESC                                    08480085
084900          FROM XST_LOC                                            08490085
085000          WHERE LOC_NBR = :PV-STR                                 08500087
085100     END-EXEC.                                                    08510085
085200                                                                  08520085
085270                                                                  08527085
085300     EVALUATE SQLCODE                                             08530085
085400        WHEN 0                                                    08540085
085500          CONTINUE                                                08550085
085600        WHEN OTHER                                                08560085
085700          MOVE '7500-GET-DESC     ' TO                            08570085
085800          PV-PARAGRAPH-NAME                                       08580085
085900          MOVE 'SELECT STORE DESC    ' TO                         08590085
086000          PV-DB2-OPERATION-ATTEMPTED                              08600085
086100          PERFORM 9100-SQL-ABEND                                  08610085
086200     END-EVALUATE.                                                08620085
086300                                                                  08630085
086400     IF SV017-DISTRICT-NMBR = 0                                   08640091
086500        MOVE PC-CORP-DESC TO HL3-DISTRICT-DESC                    08650085
086600     ELSE                                                         08660085
086610        MOVE SV017-DISTRICT-NMBR TO PV-DIST-NMBR                  08661092
086700        EXEC SQL                                                  08670085
086800           SELECT DIST_NM                                         08680090
086900             INTO :HL3-DISTRICT-DESC                              08690085
087000             FROM XST_DIST                                        08700085
087100             WHERE DIST_NBR = :PV-DIST-NMBR                       08710092
087200        END-EXEC                                                  08720085
087300                                                                  08730085
087400        EVALUATE SQLCODE                                          08740085
087500           WHEN 0                                                 08750085
087600             CONTINUE                                             08760085
087700           WHEN +100                                              08770085
087800             MOVE PC-UNKNOWN-DESC TO HL3-DISTRICT-DESC            08780085
087900           WHEN OTHER                                             08790085
088000             MOVE '7500-GET-DESC     ' TO                         08800085
088100             PV-PARAGRAPH-NAME                                    08810085
088200             MOVE 'SELECT DISTRICT DESC ' TO                      08820085
088300             PV-DB2-OPERATION-ATTEMPTED                           08830085
088400             PERFORM 9100-SQL-ABEND                               08840085
088500        END-EVALUATE                                              08850085
088600     END-IF.                                                      08860085
088700                                                                  08870085
088800******************************************************************08880085
088900* 8000-READ-BALANCE-EXTRACT                                       08890085
089000*                                                                 08900085
089100                                                                  08910085
089200 8000-READ-BALANCE-EXTRACT.                                       08920085
089300*-------------------------                                        08930085
089400                                                                  08940085
089500     READ BALANCE-EXTRACT INTO SV017-KMC-GFTCRD-BALANCE           08950085
089600        AT END                                                    08960085
089700           MOVE 'Y' TO PS-END-OF-FILE-SW.                         08970085
089800                                                                  08980085
089900******************************************************************08990085
090000* 9000-EOJ-ROUTINE - CLOSES ALL FILES ASSOCIATED WITH THE JOB     09000085
090100*                                                                 09010085
090200                                                                  09020085
090300 9000-EOJ-ROUTINE.                                                09030085
090400*----------------                                                 09040085
090500                                                                  09050085
090600     CLOSE BALANCE-EXTRACT.                                       09060085
090700                                                                  09070085
090800*                                                                 09080085
090900* 9100-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      09090085
091000* EVENT THAT AN SQL ERROR CODE OCCURS.                            09100085
091100*                                                                 09110085
091200                                                                  09120085
091300 9100-SQL-ABEND.                                                  09130085
091400                                                                  09140085
091500     DISPLAY ' '.                                                 09150085
091600     DISPLAY '9100-SQL-ABEND'.                                    09160085
091700     DISPLAY '**  ABEND     **'.                                  09170085
091800     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               09180085
091900     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             09190085
092000     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    09200085
092100                                                                  09210085
092200*                                                                 09220085
092300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09230085
092400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09240085
092500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09250085
092600* FORMAT.                                                         09260085
092700*                                                                 09270085
092800     COPY DPPD004.                                                09280085
092900                                                                  09290085
093000     SET ABEND-4013-DB2-ERROR TO TRUE                             09300085
093100     CALL 'ILB0ABNO' USING ABEND-CODE.                            09310085
