000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TRKCS156.                                         00040003
000500 AUTHOR.        THERESE RAMSEYER.                                 00050003
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JUNE, 1999.                                       00070003
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y156 - CARRIER NAME BY SCAC CODE LIST                      * 00110003
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF CARRIER NAMES AND SCAC    * 00130003
001400*    CODES. A SELECTABLE CICS ARCHITECTURE TEMPLATE WAS USED.   * 00140003
001500*    EVEN THOUGH THE PROGRAM IS NOT CURRENTLY SELECTABLE, IT    * 00150003
001600*    COULD BE CHANGED TO BE SO RELATIVELY QUICKLY SHOULD THE    * 00160003
001700*    NEED ARISE. ENTRY TO THIS PROGRAM IS FROM RCKCS224 WHICH   * 00170003
001800*    IS MNEMONIC - RCSTRLR.                                     * 00180003
001900*                                                               * 00190000
001910*    NOTE: TO CHANGE BACK TO SELECTABLE LIST:                   * 00191043
001920*    1) UNCOMMENT THE SELECT AND ACTION PART OF MR-OCCURS       * 00192043
001930*    2) DELETE THE WORKING STORAGE "PV-SCROLL-AREA WHICH        * 00193043
001940*       WAS CREATED TO ALLOW ANY "SELECTABLE" CODE TO           * 00194043
001950*       CONTINUE TO EXECUTE IN THE PROGRAM WITHOUT TAKING IT    * 00195043
001960*       OUT. IT NEVER DISPLAYS ANYTHING.                        * 00196043
001970*    3) GO THROUGH EACH PARA IN PGM AND UNCOMMENT ANY CODE      * 00197043
001980*       THAT IS ASSOCIATED WITH SELECTION OR ACTION.            * 00198043
001990*    4) ADJUST THE FILLER OF MR-OCCURS TO REALIGN THE MAP       * 00199043
001991*       THAT NOW INCLUDES A SELECT FIELD AND ACTION FIELD.      * 00199143
001992*    5) THE 'SEL' AND 'ACT' FIELDS OF THE MAP WILL NEED TO      * 00199243
001993*       BE UNCOMMENTED. MAKE SURE THE 'X' CONTINUATION CHAR     * 00199343
001994*       IS IN COLUMN 72.                                        * 00199443
002000*---------------------------------------------------------------* 00200000
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00202047
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00203047
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00204047
263697*---------------------------------------------------------------* 00205047
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00206048
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00207048
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00208048
CICS  *-----------------------------------------------------------------00209048
002100 EJECT                                                            00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500                                                                  00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700                                                                  00270000
002800 01  DK-DB2-KEYS.                                                 00280000
002900     15  DK-MESSAGE-TEXT                PIC  X(70)  VALUE SPACE.  00290000
003000     15  DK-MESSAGE-BYTE                REDEFINES DK-MESSAGE-TEXT 00300000
003100                                        OCCURS 70 TIMES           00310000
003200                                        PIC  X(01).               00320000
003300     15  DK-MESSAGE-NUMBER              PIC S9(05)  VALUE ZERO    00330000
003400                                                    COMP-3.       00340000
003500     15  DK-SYSTEM-ID                   PIC  X(02)  VALUE SPACE.  00350000
003600     15  DK-REVIEW-IND                  PIC  X(01)  VALUE SPACE.  00360000
003700                                                                  00370000
003800 01  PC-PROGRAM-CONSTANTS.                                        00380000
003900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00390000
004000                                                    'TR156A  '.   00400003
004100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00410000
004200                                                    'TRKM156 '.   00420003
004300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00430000
004400                                                    'TRKCS156'.   00440003
004500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00450000
004600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00460000
004700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00470000
004800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00480000
004900                                                    COMP SYNC.    00490000
005000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00500000
005100                                                    COMP SYNC.    00510000
005200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00520000
005300                                                    +1000000      00530000
005400                                                    COMP-3.       00540000
005500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00550000
005600                                                    COMP SYNC.    00560000
005700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00570000
005800                                                    COMP-3.       00580000
005900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00590000
006000     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00600000
006100     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00610000
006200     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00620000
006300     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00630000
006400*                                                                 00640000
006500     05  PC-TSYMSG-NUMBERS.                                       00650000
006600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00660000
006700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670000
006800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00680000
006900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00690000
007000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00700000
007100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00710000
007200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00720000
007300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00730000
007400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00740000
007500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00750000
007600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00760000
007700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00770000
007800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00780000
007900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00790000
008000*                                                                 00800000
008100 01  PS-PROGRAM-SWITCHES.                                         00810000
008200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00820000
008300         88  PS-NO-ERROR                            VALUE 'Y'.    00830000
008400         88  PS-ERROR                               VALUE 'N'.    00840000
008500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00850000
008600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00860000
008700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00870000
008800     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00880000
008900         88  PS-DONE                                VALUE 'Y'.    00890000
009000         88  PS-NOT-DONE                            VALUE 'N'.    00900000
009100*                                                                 00910000
009200 01  PV-PROGRAM-VARIABLES.                                        00920000
009300     05  PV-SUB                         PIC S9(04)  VALUE +0      00930000
009400                                                    COMP SYNC.    00940000
009500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00950000
009600                                                    COMP SYNC.    00960000
009700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00970000
009800                                                    COMP-3.       00980000
009900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00990000
010000                                                    COMP-3.       01000000
010100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01010000
010200                                                    COMP-3.       01020000
010300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01030000
010400                                                    COMP-3.       01040000
010500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01050000
010600                                                    COMP-3.       01060000
010700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01070000
010800                                                    COMP-3.       01080000
010900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01090000
011000                                                    COMP-3.       01100000
011100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01130000
011400                                                    COMP SYNC.    01140000
011500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01170000
011800                                                    COMP SYNC.    01180000
011900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01190000
012000                                                    COMP SYNC.    01200000
012100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01210000
012200                                                    COMP SYNC.    01220000
012300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01230000
012400                                                    COMP SYNC.    01240000
012500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01370000
013800                                                    COMP SYNC.    01380000
013900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01390000
014000                                                    COMP SYNC.    01400000
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410000
014200                                                    COMP SYNC.    01420000
014210     05  PV-SCROLL-AREA                 OCCURS 14 TIMES.          01421002
014220         10  MR-SELECTL                 PIC S9(04) COMP.          01422002
014230         10  MR-SELECTA                 PIC  X(01).               01423002
014240         10  MR-SELECTC                 PIC  X(01).               01424002
014250         10  MR-SELECTH                 PIC  X(01).               01425002
014260         10  MR-SELECTI                 PIC  X(01).               01426002
014270                                                                  01427002
014280         10  MR-ACTIONL                 PIC S9(04) COMP.          01428002
014290         10  MR-ACTIONA                 PIC  X(01).               01429002
014291         10  MR-ACTIONC                 PIC  X(01).               01429102
014292         10  MR-ACTIONH                 PIC  X(01).               01429202
014293         10  MR-ACTION                  PIC  X(03).               01429302
014300******************************************************************01430000
014400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01440000
014500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01450000
014600**  APPLICATION-SPECIFIC COMMAREA.                              **01460000
014700******************************************************************01470000
014800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01480000
014900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01490000
015000     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01500000
015100                                        INDEXED BY LQW-IDX.       01510000
015200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01520000
015300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01530000
015400         10  LQW-SELECTED-SW            PIC  X(01).               01540000
015500             88  LQW-SELECT                         VALUE 'S'.    01550000
015600             88  LQW-DESELECT                       VALUE ' '.    01560000
015700*        10  LQW-ACTION                 PIC  X(03).               01570012
015800         10  LQW-CARRIER-NAME           PIC  X(30).               01580011
015900         10  LQW-SCAC                   PIC  X(04).               01590011
016200                                                                  01620000
016300     EJECT                                                        01630000
016400*---------------------------------------------------------------* 01640000
016500*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01650000
016600*---------------------------------------------------------------* 01660000
016700                                                                  01670000
016800     COPY DPWS057.                                                01680000
016900                                                                  01690000
017000     EJECT                                                        01700000
017100*---------------------------------------------------------------* 01710000
017200*    MAP LAYOUT                                                 * 01720000
017300*---------------------------------------------------------------* 01730000
017400                                                                  01740000
017500     COPY TRKM156.                                                01750003
017600*                                                                 01760000
017700 01  MR-OCCURS-LAYOUT                   REDEFINES  TR156AO.       01770003
017800     05  FILLER                         PIC X(127).               01780039
017900     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01790002
018000*        10  MR-SELECTL                 PIC S9(04) COMP.          01800002
018100*        10  MR-SELECTA                 PIC  X(01).               01810002
018200*        10  MR-SELECTC                 PIC  X(01).               01820002
018300*        10  MR-SELECTH                 PIC  X(01).               01830002
018400*        10  MR-SELECTI                 PIC  X(01).               01840002
018500*                                                                 01850002
018600*        10  MR-ACTIONL                 PIC S9(04) COMP.          01860002
018700*        10  MR-ACTIONA                 PIC  X(01).               01870002
018800*        10  MR-ACTIONC                 PIC  X(01).               01880002
018900*        10  MR-ACTIONH                 PIC  X(01).               01890002
019000*        10  MR-ACTION                  PIC  X(03).               01900002
019100                                                                  01910000
019200         10  MR-CARRIER-NAMEL           PIC S9(04) COMP.          01920002
019300         10  MR-CARRIER-NAMEA           PIC  X(01).               01930002
019310         10  MR-CARRIER-NAMEC           PIC  X(01).               01931002
019320         10  MR-CARRIER-NAMEH           PIC  X(01).               01932002
019330         10  MR-CARRIER-NAME            PIC  X(30).               01933002
019800                                                                  01980000
019900         10  MR-SCACL                   PIC S9(04) COMP.          01990002
020000         10  MR-SCACA                   PIC  X(01).               02000002
020010         10  MR-SCACC                   PIC  X(01).               02001002
020020         10  MR-SCACH                   PIC  X(01).               02002002
020030         10  MR-SCAC                    PIC  X(04).               02003002
020400                                                                  02040000
021600     EJECT                                                        02160000
021700*---------------------------------------------------------------* 02170000
021800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02180000
021900*---------------------------------------------------------------* 02190000
022000                                                                  02200000
022100     COPY DPWS015.                                                02210000
022200                                                                  02220000
022300*---------------------------------------------------------------* 02230000
022400*    FUNCTION KEYS COPYBOOK.                                    * 02240000
022500*---------------------------------------------------------------* 02250000
022600                                                                  02260000
022700     COPY DPWS016.                                                02270000
022800                                                                  02280000
022900*---------------------------------------------------------------* 02290000
023000*    NUMERIC EDIT LAYOUT.                                       * 02300000
023100*---------------------------------------------------------------* 02310000
023200                                                                  02320000
023300     COPY DPWS010I.                                               02330000
023400 EJECT                                                            02340000
023500*---------------------------------------------------------------* 02350000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02361048
023700*---------------------------------------------------------------* 02370000
023800                                                                  02380000
023900     COPY DPWS030.                                                02390000
CICS       COPY DPWS930.                                                02391048
024000 EJECT                                                            02400000
024100*---------------------------------------------------------------* 02410000
024200*    STANDARD COMMAREA.                                         * 02420000
024300*---------------------------------------------------------------* 02430000
024400                                                                  02440000
024500     COPY DPWS020.                                                02450000
024600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02460000
024700                                                                  02470000
024800*---------------------------------------------------------------* 02480000
024900* INTER-APPLICATION COMMAREA.                                   * 02490000
025000*   DPWS054 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02500000
025100*             SPEC SCREEN.                                      * 02510000
025200*   DPWS056 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02520000
025300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02530000
025400*---------------------------------------------------------------* 02540000
025500                                                                  02550000
025600         10  INTER-APPL-COMM-AREA       PIC X(200).               02560000
025700     COPY DPWS054.                                                02570000
025800     COPY DPWS056.                                                02580000
025900*---------------------------------------------------------------* 02590000
026000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02600000
026100*---------------------------------------------------------------* 02610000
026200         10  ASC-SPECIFIC-COMMAREA.                               02620000
026900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02690000
027000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02700000
027100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02710000
027200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02720000
027300                                                                  02730000
027400                 20  ASC-ITEM-ARRAY.                              02740000
027500                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02750000
027600                         30  ASC-LIST-ITEM-NUMBER                 02760000
027700                                                     PIC S9(09)   02770000
027800                                                     COMP-3.      02780000
027900                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02790000
028000                             88  ASC-VALID-SELECT    VALUE ' '    02800000
028100                                                           'S'    02810000
028200                                                           'B'    02820000
028300                                                           'E'.   02830000
028400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02840000
028500                             88  ASC-TEMP-SELECT     VALUE 'S'.   02850000
028600                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02860000
028700                             88  ASC-TEMP-END        VALUE 'E'.   02870000
028800                         30  ASC-SELECTED-SW         PIC  X(01).  02880000
028900                             88  ASC-NO-SELECT       VALUE ' '.   02890000
029000                             88  ASC-SELECT          VALUE 'S'.   02900000
029100                             88  ASC-BEGIN           VALUE 'B'.   02910000
029200                             88  ASC-END             VALUE 'E'.   02920000
029300*                        30  ASC-ACTION              PIC  X(03).  02930012
029400                         30  ASC-CARRIER-NAME        PIC  X(30).  02940002
029600                         30  ASC-SCAC                PIC  X(04).  02960002
029900                                                                  02990000
030000             15  ASC-BLK-SUB                         PIC S9(04)   03000000
030100                                                          COMP    03010000
030200                                                          SYNC.   03020000
030300             15  ASC-ITEM-SUB                        PIC S9(04)   03030000
030400                                                          COMP    03040000
030500                                                          SYNC.   03050000
030600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03060000
030700                                                          COMP-3. 03070000
030800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03080000
030900                                                          COMP-3. 03090000
031000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03100000
031100                                                          COMP-3. 03110000
031200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03120000
031300                                                          COMP-3. 03130000
031400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03140000
031500                                                          COMP-3. 03150000
031600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03160000
031700                                                          COMP    03170000
031800                                                          SYNC.   03180000
031900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03190000
032000                                                          COMP-3. 03200000
032100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03210000
032200                                                          COMP-3. 03220000
032300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03230000
032400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03240000
032500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03250000
032600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03260000
032700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03270000
032800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03280000
032900             15  ASC-LIST-QUEUE-NAME.                             03290000
033000                 20  ASC-LIST-TERM-ID                PIC  X(04).  03300000
033100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03310000
033200                                                          COMP-3. 03320000
033300                 20  ASC-LIST-SEQ                    PIC  9(01).  03330000
033400             15  ASC-SEL-QUEUE-NAME.                              03340000
033500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03350000
033600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03360000
033700                                                          COMP-3. 03370000
033800                 20  ASC-SEL-SEQ                     PIC  9(01).  03380000
033900                                                                  03390000
034500             15  ASC-START-ITEM-REQUEST.                          03450000
034600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03460000
034700     EJECT                                                        03470000
034800*---------------------------------------------------------------* 03480000
034900*    ABEND PROCESSING COPYBOOK.                                 * 03490000
035000*---------------------------------------------------------------* 03500000
035100                                                                  03510000
035200     COPY DPWS013.                                                03520000
035300                                                                  03530000
035400 EJECT                                                            03540000
035500*---------------------------------------------------------------* 03550000
035600*    DB2 AREA FOR TMESSAGE                                      * 03560000
035700*---------------------------------------------------------------* 03570000
035800     EXEC SQL                                                     03580000
035900          INCLUDE TSYMSG                                          03590000
036000     END-EXEC.                                                    03600000
036010*---------------------------------------------------------------* 03601008
036020*    DB2 AREA FOR TEXTENT                                       * 03602008
036030*---------------------------------------------------------------* 03603008
036040     EXEC SQL                                                     03604008
036050          INCLUDE TEXTENT                                         03605008
036060     END-EXEC.                                                    03606008
036070*---------------------------------------------------------------* 03607008
036080*    DB2 AREA FOR TENTNME                                       * 03608008
036090*---------------------------------------------------------------* 03609008
036091     EXEC SQL                                                     03609108
036092          INCLUDE TENTNME                                         03609208
036093     END-EXEC.                                                    03609308
036100*---------------------------------------------------------------* 03610000
036200*    DB2 AREA FOR COMMUNICATIONS                                * 03620000
036300*---------------------------------------------------------------* 03630000
036400     EXEC SQL                                                     03640000
036500          INCLUDE SQLCA                                           03650000
036600     END-EXEC.                                                    03660000
036700                                                                  03670000
036800*---------------------------------------------------------------* 03680000
036900*    CARRIER NAME CURSOR                                        * 03690004
037000*---------------------------------------------------------------* 03700000
037100                                                                  03710000
037200     EXEC SQL                                                     03720000
037202          DECLARE  CARRIER_CSR CURSOR FOR                         03720205
037203           SELECT  DISTINCT SCAC_CDE                              03720305
037204                           ,ENT_NAME_DESC                         03720405
037205             FROM  TEXTENT A,                                     03720505
037206                   TENTNME B                                      03720605
037207            WHERE  CARRIER_IND = 'Y'                              03720705
037208              AND  A.ENT_ID = B.ENT_ID                            03720805
037209              AND  A.STATUS_CDE = 'A'                             03720905
037210              AND  B.TYPE_CDE = '01'                              03721005
037211            ORDER  BY ENT_NAME_DESC                               03721105
                  WITH UR                                               03721246
037220     END-EXEC.                                                    03722005
038600                                                                  03860000
038700*---------------------------------------------------------------* 03870000
038800*    TMESSAGE CURSOR WHEN SYSTEM ID IS REQUESTED                * 03880000
038900*---------------------------------------------------------------* 03890000
039000                                                                  03900000
039100     EXEC SQL                                                     03910000
039200          DECLARE SYSTEM-ID-CSR CURSOR                            03920000
039300          FOR SELECT                                              03930000
039400                SYMSG_NBR                                         03940000
039500              , APLSYS_CDE                                        03950000
039600              , REV_IND                                           03960000
039700              , SHT_TXT                                           03970000
039800          FROM                                                    03980000
039900                TSYMSG                                            03990000
040000          WHERE                                                   04000000
040100                APLSYS_CDE     = :DK-SYSTEM-ID                    04010000
040200            AND                                                   04020000
040300                SHT_TXT     LIKE :DK-MESSAGE-TEXT                 04030000
040400            AND                                                   04040000
040500                REV_IND     LIKE :DK-REVIEW-IND                   04050000
040600          ORDER BY                                                04060000
040700                SYMSG_NBR                                         04070000
040800     END-EXEC.                                                    04080000
040900                                                                  04090000
041000*---------------------------------------------------------------* 04100000
041100*    TMESSAGE CURSOR WHEN MESSAGE TEXT IS REQUESTED AND         * 04110000
041200*    SYSTEM ID IS NOT.                                          * 04120000
041300*---------------------------------------------------------------* 04130000
041400                                                                  04140000
041500     EXEC SQL                                                     04150000
041600          DECLARE MESSAGE-TEXT-CSR CURSOR                         04160000
041700          FOR SELECT                                              04170000
041800                SYMSG_NBR                                         04180000
041900              , APLSYS_CDE                                        04190000
042000              , REV_IND                                           04200000
042100              , SHT_TXT                                           04210000
042200          FROM                                                    04220000
042300                TSYMSG                                            04230000
042400          WHERE                                                   04240000
042500                SHT_TXT     LIKE :DK-MESSAGE-TEXT                 04250000
042600            AND                                                   04260000
042700                REV_IND     LIKE :DK-REVIEW-IND                   04270000
042800          ORDER BY                                                04280000
042900                SYMSG_NBR                                         04290000
043000     END-EXEC.                                                    04300000
043100                                                                  04310000
043200 EJECT                                                            04320000
043300 LINKAGE SECTION.                                                 04330000
043400                                                                  04340000
043500 01  DFHCOMMAREA.                                                 04350000
043600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04360000
043700                                        DEPENDING ON EIBCALEN.    04370000
043800         10  FILLER                     PIC X.                    04380000
043900                                                                  04390000
044000 EJECT                                                            04400000
044100 PROCEDURE DIVISION.                                              04410000
044200******************************************************************04420000
044300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04430000
044400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04440000
044500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04450000
044600******************************************************************04460000
044700 0000-MAIN-MODULE.                                                04470000
044800     INITIALIZE DP030-CICS-API-FIELDS.                            04480000
044900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04490000
045000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04500000
045100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04510000
045200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04520000
045300     MOVE LENGTH OF TR156AI        TO DP030-MAP-LENGTH (1).       04530003
045400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04540000
045500     PERFORM 0001-CALL-CICS-ARCH-API.                             04550000
045600*                                                                 04560000
045700     PERFORM 1000-CONTROL-PROCESSING                              04570000
045800*                                                                 04580000
045900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04590000
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600000
046100                                                                  04610000
046200******************************************************************04620000
046300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04630000
046400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04640000
046500******************************************************************04650000
046600 0001-CALL-CICS-ARCH-API.                                         04660000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04671048
046800                                    DFHCOMMAREA                   04680048
046900                                    DP030-CICS-API-FIELDS         04690048
047000                                    DP020-STANDARD-COMMAREA       04700048
047100                                    TR156AI.                      04710048
047200*                                                                 04720000
047300     IF  DP030-RC-CALL-SUCCESSFUL                                 04730000
047400         CONTINUE                                                 04740000
047500     ELSE                                                         04750000
047600         SET DP013-NO-ROLLBACK                                    04760000
047700             DP013-XCTL-DISPLAY-RESTART                           04770000
047800             DP013-CICS-ABEND      TO TRUE                        04780000
047900         MOVE '0001-CALL-CICS-ARCH-API'                           04790000
048000                                   TO DP013-PARAGRAPH             04800000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04821048
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04822048
048300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04830000
048400         PERFORM DP013-0000-PROCESS-ABEND                         04840000
048500     END-IF.                                                      04850000
048600*----------------------------------------------------------------*04860000
048700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04870000
048800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04880000
048900*                                                                *04890000
049000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04900000
049100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04910000
049200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04920000
049300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04930000
049400*----------------------------------------------------------------*04940000
049500                                                                  04950000
049600 1000-CONTROL-PROCESSING.                                         04960000
049700                                                                  04970000
049800     EVALUATE TRUE                                                04980000
049900         WHEN DP020-NEXT-ACT-INITIAL                              04990000
050000             INITIALIZE ASC-SPECIFIC-COMMAREA                     05000000
050100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05010000
050200                                      ASC-SEL-TERM-ID             05020000
050300             MOVE DP020-SRC-TASK-NUMBER                           05030000
050400                                   TO ASC-LIST-TASK-NUMBER        05040000
050500                                      ASC-SEL-TASK-NUMBER         05050000
050600             MOVE PC-LIST-QUEUE-SEQ                               05060000
050700                                   TO ASC-LIST-SEQ                05070000
050800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05080000
050900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05090000
051000***-----$TEMPLATE NOTE$-------------------------------------------05100000
051100*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05110000
051200*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05120000
051300*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05130000
051400***---------------------------------------------------------------05140000
051500             IF  PS-COMMAREA-NOT-VALID                            05150000
051600***              MOVE PC-TSYMSG-99901                             05160000
051700***                                TO DP020-MSG-NUMBER            05170000
051800***              SET DP020-MSG-FATAL                              05180000
051900***                                TO TRUE                        05190000
052000                 SET DP020-NEXT-ACT-APPL-ERROR                    05200000
052100                                   TO TRUE                        05210000
052200             ELSE                                                 05220000
052300                 PERFORM 4000-BUILD-INITIAL-PANEL                 05230000
052400             END-IF                                               05240000
052500                                                                  05250000
052600         WHEN DP020-NEXT-ACT-READ-MAP                             05260000
052700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05270000
052800                                   TO PV-TOP-ITEM                 05280000
052900             PERFORM 2000-PROCESS-PANEL                           05290000
053000                                                                  05300000
053100         WHEN DP020-NEXT-ACT-RETURN                               05310000
053200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05320000
053300                                   TO PV-TOP-ITEM                 05330000
053400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05340000
053500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05350000
053600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05360000
053700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05370000
053800                                                                  05380000
053900         WHEN OTHER                                               05390000
054000             SET DP013-LOGIC-ABEND TO TRUE                        05400000
054100             SET DP013-NO-ROLLBACK TO TRUE                        05410000
054200             MOVE '1000-CONTROL-PROCESSING'                       05420000
054300                                   TO DP013-PARAGRAPH             05430000
054400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05440000
054500                                   TO DP013-MESSAGE-TEXT(1)       05450000
054600             PERFORM DP013-0000-PROCESS-ABEND                     05460000
054700     END-EVALUATE.                                                05470000
054800                                                                  05480000
054900 EJECT                                                            05490000
055000*----------------------------------------------------------------*05500000
055100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05510000
055200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05520000
055300*----------------------------------------------------------------*05530000
055400                                                                  05540000
055500 1100-PROCESS-INTER-APPL-COMM.                                    05550000
055600                                                                  05560000
055700     SET PS-COMMAREA-VALID         TO TRUE.                       05570000
055800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05580000
057700                                                                  05770000
057800 EJECT                                                            05780000
057900*----------------------------------------------------------------*05790000
058000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05800000
058100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05810000
058200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05820000
058300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05830000
058400* FUNCTION KEYS CAN GET THIS FAR.                                *05840000
058500*----------------------------------------------------------------*05850000
058600                                                                  05860000
058700 2000-PROCESS-PANEL.                                              05870000
058800     EVALUATE TRUE                                                05880000
058900         WHEN DP020-SRC-AID = DP016-CLEAR                         05890000
059000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05900000
059100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05910000
059200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05920000
059300                                                                  05930000
059400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05940000
060300             PERFORM 2050-DELETE-LIST-QUEUE                       06030000
060400             PERFORM 4000-BUILD-INITIAL-PANEL                     06040000
060500                                                                  06050000
060600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06060000
060700             PERFORM 2140-DESELECT-ALL-ITEMS                      06070000
060800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06080000
060900                                                                  06090000
061000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06100000
061100             PERFORM 2150-SELECT-ALL-ITEMS                        06110000
061200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06120000
061300                                                                  06130000
061400         WHEN OTHER                                               06140000
061500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06150000
061600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06160000
061700             IF  PS-NO-ERROR                                      06170000
061800                 SET DP030-CONTINUE-GO                            06180000
061900                                 TO TRUE                          06190000
062000                 PERFORM 2100-CHECK-FUNCTION-KEY                  06200000
062100             ELSE                                                 06210000
062200                 SET DP030-OVERRIDE-GO                            06220000
062300                                 TO TRUE                          06230000
062400             END-IF                                               06240000
062500     END-EVALUATE.                                                06250000
062600 EJECT                                                            06260000
062700*----------------------------------------------------------------*06270000
062800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06280000
062900*----------------------------------------------------------------*06290000
063000 2050-DELETE-LIST-QUEUE.                                          06300000
063100                                                                  06310000
063200     EXEC CICS                                                    06320000
063300         DELETEQ TS                                               06330000
063400             QUEUE (ASC-LIST-QUEUE-NAME)                          06340000
063500             RESP  (PV-CICS-RESP)                                 06350000
063600     END-EXEC.                                                    06360000
063700                                                                  06370000
063800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06380000
063900        (PV-CICS-RESP = DFHRESP(QIDERR))                          06390000
064000         CONTINUE                                                 06400000
064100     ELSE                                                         06410000
064200         SET DP013-CICS-ABEND      TO TRUE                        06420000
064300         SET DP013-NO-ROLLBACK     TO TRUE                        06430000
064400                                                                  06440000
064500         MOVE '2050-DELETE-LIST-QUEUE'                            06450000
064600                                   TO DP013-PARAGRAPH             06460000
064700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06470000
064800                                   TO DP013-MESSAGE-TEXT (1)      06480000
064900         PERFORM DP013-0000-PROCESS-ABEND                         06490000
065000     END-IF.                                                      06500000
065100                                                                  06510000
065200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06520000
065300 EJECT                                                            06530000
065400*----------------------------------------------------------------*06540000
065500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06550000
065600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06560000
065700* CICS ARCHITECTURE API.                                         *06570000
065800*----------------------------------------------------------------*06580000
065900 2100-CHECK-FUNCTION-KEY.                                         06590000
066000     EVALUATE TRUE                                                06600000
066100         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  06610000
066200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              06620000
066300                 INITIALIZE DP056-INTER-APPL-COMMAREA             06630000
066400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                06640000
066500                                TO DP056-NUMBER-OF-SELECTED-ITEMS 06650000
066600                 PERFORM 5000-PREPARE-SEL-QUEUE                   06660000
066700             ELSE                                                 06670000
066800                 SET DP030-OVERRIDE-GO                            06680000
066900                                   TO TRUE                        06690000
067000                 MOVE PC-TSYMSG-00057                             06700000
067100                                   TO DP020-MSG-NUMBER            06710000
067200                 SET DP020-MSG-WARNING                            06720000
067300                                   TO TRUE                        06730000
067400             END-IF                                               06740000
067500                                                                  06750000
067600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06760000
067610             MOVE -1               TO ASTRTITL                    06761045
067620             SET DP030-SET-CURSOR-APPL-1                          06762045
067630                               TO TRUE                            06763045
067700             MOVE +1               TO PV-TOP-ITEM                 06770000
067800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06780000
067900                                                                  06790000
068000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06800000
068010             MOVE -1               TO ASTRTITL                    06801045
068020             SET DP030-SET-CURSOR-APPL-1                          06802045
068030                               TO TRUE                            06803045
068100             PERFORM 2110-BROWSE-BACKWARD                         06810000
068200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06820000
068300                                                                  06830000
068400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06840000
068410             MOVE -1               TO ASTRTITL                    06841045
068420             SET DP030-SET-CURSOR-APPL-1                          06842045
068430                               TO TRUE                            06843045
068500             PERFORM 2120-BROWSE-FORWARD                          06850000
068600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06860000
068700                                                                  06870000
068800         WHEN DP020-SRC-AID = DP016-ENTER                         06880000
068810             MOVE -1               TO ASTRTITL                    06881045
068820             SET DP030-SET-CURSOR-APPL-1                          06882045
068830                               TO TRUE                            06883045
068900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06890000
069000             IF  PS-ERROR                                         06900000
069100                 CONTINUE                                         06910000
069200             ELSE                                                 06920000
069300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06930000
069400             END-IF                                               06940000
069500                                                                  06950000
069600         WHEN OTHER                                               06960000
069700             SET DP013-NO-ROLLBACK                                06970000
069800                 DP013-XCTL-DISPLAY-RESTART                       06980000
069900                 DP013-CICS-ABEND  TO TRUE                        06990000
070000             MOVE '2100-CHECK-FUNCTION-KEY'                       07000000
070100                                   TO DP013-PARAGRAPH             07010000
070200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07020000
070300                                   TO DP013-MESSAGE-TEXT (1)      07030000
070400             PERFORM DP013-0000-PROCESS-ABEND                     07040000
070500     END-EVALUATE.                                                07050000
070600*                                                                 07060000
070700*----------------------------------------------------------------*07070000
070800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07080000
070900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07090000
071000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07100000
071100*    MESSAGE.                                                    *07110000
071200*----------------------------------------------------------------*07120000
071300                                                                  07130000
071400 2110-BROWSE-BACKWARD.                                            07140000
071500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07150000
071600         GIVING PV-TOP-ITEM.                                      07160000
071700*                                                                 07170000
071800     IF  ((PV-TOP-ITEM < +1)                                      07180000
071900       OR (PV-TOP-ITEM = +1))                                     07190000
072000         MOVE +1                   TO PV-TOP-ITEM                 07200000
072100*        -- TOP OF LIST --                                        07210000
072200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07220000
072300         SET DP020-MSG-INFORMATIONAL TO TRUE                      07230000
072400     END-IF.                                                      07240000
072500                                                                  07250000
072600 EJECT                                                            07260000
072700*----------------------------------------------------------------*07270000
072800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07280000
072900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07290000
073000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07300000
073100*----------------------------------------------------------------*07310000
073200                                                                  07320000
073300 2120-BROWSE-FORWARD.                                             07330000
073400                                                                  07340000
073500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07350000
073600         GIVING PV-TOP-ITEM.                                      07360000
073700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07370000
073800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07380000
073900                                   TO PV-TOP-ITEM                 07390000
074000*        -- BOTTOM OF LIST --                                     07400000
074100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07410000
074200         SET DP020-MSG-INFORMATIONAL                              07420000
074300                                   TO TRUE                        07430000
074400     ELSE                                                         07440000
074500         COMPUTE PV-BOTTOM-ITEM =                                 07450000
074600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07460000
074700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07470000
074800*            -- BOTTOM OF LIST --                                 07480000
074900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07490000
075000             SET DP020-MSG-INFORMATIONAL                          07500000
075100                                   TO TRUE                        07510000
075200         END-IF                                                   07520000
075300     END-IF.                                                      07530000
075400 EJECT                                                            07540000
075500*----------------------------------------------------------------*07550000
075600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07560000
075700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07570000
075800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07580000
075900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07590000
076000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07600000
076100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07610000
076200*----------------------------------------------------------------*07620000
076300                                                                  07630000
076400 2130-CHECK-FOR-JUMP-BROWSE.                                      07640000
076500     SET PS-NO-ERROR               TO TRUE.                       07650000
076600     IF (ASC-START-ITEM-REQUEST = SPACE)                          07660000
076700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07670000
076800                                   TO PV-TOP-ITEM                 07680000
076900     ELSE                                                         07690000
077000         MOVE ASC-START-ITEM-REQUEST                              07700000
077100                                   TO DP010I-UNEDITED-FIELD       07710000
077200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07720000
077300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07730000
077400         SET DP010I-NEGATIVE-NOT-ALLOWED                          07740000
077500                                   TO TRUE                        07750000
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07761047
263697              USING DP010I-NUMERIC-EDIT-AREA                      07762047
077700                                                                  07770000
077800         IF  NOT DP010I-ERROR-DETECTED                            07780000
077900             MOVE DP010I-NUMERIC-FIELD                            07790000
078000                                   TO  ASC-START-ITEM-REQUEST-N   07800000
078100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07810000
078200                 IF  ASC-START-ITEM-REQUEST-N >                   07820000
078300                                          ASC-NUMBER-OF-ITEMS-READ07830000
078400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07840000
078500                     COMPUTE PV-TOP-ITEM =                        07850000
078600                             ASC-NUMBER-OF-ITEMS-READ             07860000
078700                             - PC-ITEMS-PER-PANEL + 1             07870000
078800                     IF  PV-TOP-ITEM < +1                         07880000
078900                         MOVE +1   TO PV-TOP-ITEM                 07890000
079000                         MOVE PC-TSYMSG-00070                     07900000
079100                                   TO DP020-MSG-NUMBER            07910000
079200                         SET DP020-MSG-INFORMATIONAL              07920000
079300                                   TO TRUE                        07930000
079400                     END-IF                                       07940000
079500                 ELSE                                             07950000
079600                     MOVE ASC-START-ITEM-REQUEST-N                07960000
079700                                   TO PV-TOP-ITEM                 07970000
079800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07980000
079900                     COMPUTE PV-BOTTOM-ITEM =                     07990000
080000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08000000
080100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08010000
080200*                        -- BOTTOM OF LIST --                     08020000
080300                         MOVE PC-TSYMSG-00070                     08030000
080400                                   TO DP020-MSG-NUMBER            08040000
080500                         SET DP020-MSG-INFORMATIONAL              08050000
080600                                   TO TRUE                        08060000
080700                     END-IF                                       08070000
080800                 END-IF                                           08080000
080900             ELSE                                                 08090000
081000*                --- VALUE OUT OF RANGE ----                      08100000
081100                 MOVE PC-TSYMSG-00101                             08110000
081200                                   TO DP020-MSG-NUMBER            08120000
081300                 MOVE -1           TO ASTRTITL                    08130000
081400                 SET DP030-SET-CURSOR-APPL-1                      08140000
081500                                   TO TRUE                        08150000
081600                 MOVE DP015-REVERSE                               08160000
081700                                   TO ASTRTITH                    08170000
081800                 MOVE DP015-RED    TO ASTRTITC                    08180000
081900                 MOVE DP015-UNP-NUM-BRT-MDT                       08190000
082000                                   TO ASTRTITA                    08200000
082100                 SET DP020-MSG-FATAL                              08210000
082200                                   TO TRUE                        08220000
082300                 SET PS-ERROR      TO TRUE                        08230000
082400             END-IF                                               08240000
082500                                                                  08250000
082600         ELSE                                                     08260000
082700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08270000
082800             MOVE -1               TO ASTRTITL                    08280000
082900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08290000
083000             MOVE DP015-REVERSE    TO ASTRTITH                    08300000
083100             MOVE DP015-RED        TO ASTRTITC                    08310000
083200             MOVE DP015-UNP-NUM-BRT-MDT                           08320000
083300                                   TO ASTRTITA                    08330000
083400             SET DP020-MSG-FATAL   TO TRUE                        08340000
083500             SET PS-ERROR          TO TRUE                        08350000
083600         END-IF                                                   08360000
083700     END-IF.                                                      08370000
083800 EJECT                                                            08380000
083900*----------------------------------------------------------------*08390000
084000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08400000
084100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08410000
084200*----------------------------------------------------------------*08420000
084300 2140-DESELECT-ALL-ITEMS.                                         08430000
084400     MOVE +1                       TO ASC-BLK-SUB.                08440000
084500                                                                  08450000
084600     PERFORM 2141-CLEAR-SELECTED-INDS                             08460000
084700         VARYING ASC-ITEM-SUB                                     08470000
084800         FROM 1 BY 1                                              08480000
084900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08490000
085000                                                                  08500000
085100     ADD +1                        TO ASC-BLK-SUB.                08510000
085200                                                                  08520000
085300     PERFORM 2141-CLEAR-SELECTED-INDS                             08530000
085400         VARYING ASC-ITEM-SUB                                     08540000
085500         FROM 1 BY 1                                              08550000
085600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08560000
085700                                                                  08570000
085800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08580000
085900                                   TO PV-LIST-ITEM-NUMBER.        08590000
086000                                                                  08600000
086100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08610000
086200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08620000
086300                                                                  08630000
086400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08640000
086500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08650000
086600         MOVE +1                   TO ASC-BLK-SUB                 08660000
086700                                                                  08670000
086800         PERFORM 5100-WRITE-TEMP-STORAGE                          08680000
086900                                                                  08690000
087000         MOVE +1                   TO PV-BLOCK-NUMBER             08700000
087100                                                                  08710000
087200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08720000
087300             PV-FIRST-BLOCK-IN-ARRAY - 1                          08730000
087400                                                                  08740000
087500         PERFORM                                                  08750000
087600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08760000
087700                                                                  08770000
087800             PERFORM 4410-READ-TEMP-STORAGE                       08780000
087900                                                                  08790000
088000             PERFORM 2141-CLEAR-SELECTED-INDS                     08800000
088100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08810000
088200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08820000
088300                                                                  08830000
088400             PERFORM 5100-WRITE-TEMP-STORAGE                      08840000
088500                                                                  08850000
088600             ADD +1                TO PV-BLOCK-NUMBER             08860000
088700                                                                  08870000
088800         END-PERFORM                                              08880000
088900                                                                  08890000
089000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08900000
089100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08910000
089200                                                                  08920000
089300         PERFORM                                                  08930000
089400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08940000
089500                   ASC-HIGHEST-BLOCK-WRITTEN                      08950000
089600                                                                  08960000
089700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08970000
089800                                   TO PV-BLOCK-NUMBER             08980000
089900                                                                  08990000
090000             PERFORM 4410-READ-TEMP-STORAGE                       09000000
090100                                                                  09010000
090200             PERFORM 2141-CLEAR-SELECTED-INDS                     09020000
090300                 VARYING ASC-ITEM-SUB                             09030000
090400                 FROM 1 BY 1                                      09040000
090500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09050000
090600                                                                  09060000
090700             PERFORM 5100-WRITE-TEMP-STORAGE                      09070000
090800                                                                  09080000
090900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09090000
091000                                                                  09100000
091100         END-PERFORM                                              09110000
091200                                                                  09120000
091300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09130000
091400                                   TO PV-BLOCK-NUMBER             09140000
091500                                                                  09150000
091600         PERFORM 4410-READ-TEMP-STORAGE                           09160000
091700     END-IF.                                                      09170000
091800                                                                  09180000
091900                                                                  09190000
092000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09200000
092100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09210000
092200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09220000
092300                                                                  09230000
092400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09240000
092500                                                                  09250000
092600 EJECT                                                            09260000
092700*----------------------------------------------------------------*09270000
092800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09280000
092900*----------------------------------------------------------------*09290000
093000                                                                  09300000
093100 2141-CLEAR-SELECTED-INDS.                                        09310000
093200                                                                  09320000
093300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09330000
093400             NOT EQUAL ZERO                                       09340000
093500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09350000
093600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09360000
093700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09370000
093800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09380000
093900                                   TO TRUE                        09390000
094000         END-IF                                                   09400000
094100     END-IF.                                                      09410000
094200                                                                  09420000
094300 EJECT                                                            09430000
094400*----------------------------------------------------------------*09440000
094500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09450000
094600*  FOR ALL ITEMS.                                                *09460000
094700*----------------------------------------------------------------*09470000
094800                                                                  09480000
094900 2150-SELECT-ALL-ITEMS.                                           09490000
095000                                                                  09500000
095100     MOVE +1                       TO ASC-BLK-SUB.                09510000
095200                                                                  09520000
095300     PERFORM 2151-SET-SELECTED-INDS                               09530000
095400         VARYING ASC-ITEM-SUB                                     09540000
095500         FROM 1 BY 1                                              09550000
095600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09560000
095700                                                                  09570000
095800     ADD +1                        TO ASC-BLK-SUB.                09580000
095900                                                                  09590000
096000     PERFORM 2151-SET-SELECTED-INDS                               09600000
096100         VARYING ASC-ITEM-SUB                                     09610000
096200         FROM 1 BY 1                                              09620000
096300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09630000
096400                                                                  09640000
096500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09650000
096600                                   TO PV-LIST-ITEM-NUMBER.        09660000
096700                                                                  09670000
096800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09680000
096900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09690000
097000                                                                  09700000
097100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09710000
097200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09720000
097300         MOVE +1                   TO ASC-BLK-SUB                 09730000
097400                                                                  09740000
097500         PERFORM 5100-WRITE-TEMP-STORAGE                          09750000
097600                                                                  09760000
097700         MOVE +1                   TO PV-BLOCK-NUMBER             09770000
097800                                                                  09780000
097900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09790000
098000             PV-FIRST-BLOCK-IN-ARRAY - 1                          09800000
098100                                                                  09810000
098200         PERFORM                                                  09820000
098300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09830000
098400                                                                  09840000
098500             PERFORM 4410-READ-TEMP-STORAGE                       09850000
098600                                                                  09860000
098700             PERFORM 2151-SET-SELECTED-INDS                       09870000
098800                 VARYING ASC-ITEM-SUB                             09880000
098900                 FROM 1 BY 1                                      09890000
099000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09900000
099100                                                                  09910000
099200             PERFORM 5100-WRITE-TEMP-STORAGE                      09920000
099300                                                                  09930000
099400             ADD +1                TO PV-BLOCK-NUMBER             09940000
099500                                                                  09950000
099600         END-PERFORM                                              09960000
099700                                                                  09970000
099800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09980000
099900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09990000
100000                                                                  10000000
100100         PERFORM                                                  10010000
100200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10020000
100300                   ASC-HIGHEST-BLOCK-WRITTEN                      10030000
100400                                                                  10040000
100500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10050000
100600                                   TO PV-BLOCK-NUMBER             10060000
100700                                                                  10070000
100800             PERFORM 4410-READ-TEMP-STORAGE                       10080000
100900                                                                  10090000
101000             PERFORM 2151-SET-SELECTED-INDS                       10100000
101100                 VARYING ASC-ITEM-SUB                             10110000
101200                 FROM 1 BY 1                                      10120000
101300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10130000
101400                                                                  10140000
101500             PERFORM 5100-WRITE-TEMP-STORAGE                      10150000
101600                                                                  10160000
101700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10170000
101800                                                                  10180000
101900         END-PERFORM                                              10190000
102000                                                                  10200000
102100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10210000
102200                                   TO PV-BLOCK-NUMBER             10220000
102300                                                                  10230000
102400         PERFORM 4410-READ-TEMP-STORAGE                           10240000
102500     END-IF.                                                      10250000
102600                                                                  10260000
102700                                                                  10270000
102800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10280000
102900                       ASC-NUMBER-OF-SELECTED-ITEMS.              10290000
103000                                                                  10300000
103100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10310000
103200                                                                  10320000
103300 EJECT                                                            10330000
103400*----------------------------------------------------------------*10340000
103500*    MARK EACH ITEM AS BEING SELECTED.                           *10350000
103600*----------------------------------------------------------------*10360000
103700                                                                  10370000
103800 2151-SET-SELECTED-INDS.                                          10380000
103900                                                                  10390000
104000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10400000
104100             NOT EQUAL ZERO                                       10410000
104200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10420000
104300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10430000
104400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10440000
104500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10450000
104600                               TO  TRUE                           10460000
104700         END-IF                                                   10470000
104800     END-IF.                                                      10480000
104900******************************************************************10490000
105000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10500000
105100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10510000
105200******************************************************************10520000
105300 2200-MOVE-SCREEN-TO-COMMAREA.                                    10530000
105400                                                                  10540000
105500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10550000
105600     MOVE +1                       TO PV-SUB.                     10560000
105700*                                                                 10570000
105800     PERFORM 3100-SET-SUBSCRIPTS.                                 10580000
105900     IF  ASTRTITL > ZERO                                          10590000
106000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10600000
106100     ELSE                                                         10610000
106200         IF  ASTRTITF = DP015-ERASE-EOF                           10620000
106300             INITIALIZE ASC-START-ITEM-REQUEST                    10630000
106400         END-IF                                                   10640000
106500     END-IF.                                                      10650000
106600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10660000
106700         VARYING PV-SUB                                           10670000
106800         FROM 1 BY 1                                              10680000
106900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10690000
107000******************************************************************10700000
107100** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10710000
107200******************************************************************10720000
107300 2210-MOVE-LINES-TO-COMMAREA.                                     10730000
107400     IF  MR-SELECTL (PV-SUB) > ZERO                               10740000
107500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10750000
107600         MOVE MR-SELECTI (PV-SUB)                                 10760000
107700                                   TO ASC-TEMP-SELECTED-SW        10770000
107800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10780000
107900     ELSE                                                         10790000
108000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10800000
108100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10810000
108200                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10820000
108300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10830000
108400         END-IF                                                   10840000
108500     END-IF.                                                      10850000
108600     ADD +1                        TO ASC-ITEM-SUB.               10860000
108700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10870000
108800         ADD +1                    TO ASC-BLK-SUB                 10880000
108900         MOVE +1                   TO ASC-ITEM-SUB                10890000
109000     END-IF.                                                      10900000
109100******************************************************************10910000
109200** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10920000
109300** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10930000
109400******************************************************************10940000
109500 3000-EDIT-DATA-IN-COMMAREA.                                      10950000
109600     SET PS-NO-ERROR               TO TRUE.                       10960000
109700     PERFORM 3200-RESET-ATTRIBUTES.                               10970000
109800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10980000
109900**                                                                10990000
110000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11000000
110100* EDITTING IS DONE FROM THE BOTTOM UP.                            11010000
110200**                                                                11020000
110300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11030000
110400         ASC-ITEMS-DISPLAYED - 1.                                 11040000
110500     PERFORM 3100-SET-SUBSCRIPTS.                                 11050000
110600     PERFORM 3300-EDIT-SELECTIONS                                 11060000
110700         VARYING PV-SUB                                           11070000
110800         FROM PV-SUB BY -1                                        11080000
110900         UNTIL PV-SUB < +1                                        11090000
111000*                                                                 11100000
111100     IF  PS-NO-ERROR                                              11110000
111200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11120000
111300     END-IF.                                                      11130000
111400*                                                                 11140000
111500     IF  ((PS-NO-ERROR)                                           11150000
111600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11160000
111700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11170000
111800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11180000
111900     END-IF.                                                      11190000
112000 EJECT                                                            11200000
112100*----------------------------------------------------------------*11210000
112200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11220000
112300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11230000
112400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11240000
112500*                                                                *11250000
112600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11260000
112700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11270000
112800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11280000
112900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11290000
113000*----------------------------------------------------------------*11300000
113100                                                                  11310000
113200 3100-SET-SUBSCRIPTS.                                             11320000
113300                                                                  11330000
113400     COMPUTE ASC-ITEM-SUB =                                       11340000
113500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11350000
113600                                                                  11360000
113700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11370000
113800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11380000
113900                                                                  11390000
114000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11400000
114100     ELSE                                                         11410000
114200         MOVE +1                     TO ASC-BLK-SUB               11420000
114300     END-IF.                                                      11430000
114400******************************************************************11440000
114500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11450000
114600******************************************************************11460000
114700                                                                  11470000
114800 3200-RESET-ATTRIBUTES.                                           11480000
114900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11490000
115000     MOVE DP015-GREEN              TO ASTRTITC.                   11500000
115100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11510000
115200*                                                                 11520000
115300     PERFORM                                                      11530000
115400         VARYING PV-SUB                                           11540000
115500         FROM 1 BY 1                                              11550000
115600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11560000
115700         MOVE DP015-UNP-ALP-NOR-OFF                               11570000
115800                                   TO MR-SELECTA (PV-SUB)         11580000
115900         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11590000
116000         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11600000
116100     END-PERFORM.                                                 11610000
116200******************************************************************11620000
116300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11630000
116400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11640000
116500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11650000
116600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11660000
116700******************************************************************11670000
116800 3300-EDIT-SELECTIONS.                                            11680000
116900     EVALUATE TRUE                                                11690000
117000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11700000
117100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11710000
117200                 CONTINUE                                         11720000
117300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11730000
117400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11740000
117500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11750000
117600                 MOVE ASC-TEMP-SELECTED-SW                        11760000
117700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11770000
117800                                TO ASC-SELECTED-SW                11780000
117900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11790000
118000             END-IF                                               11800000
118100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11810000
118200                 = SPACE                                          11820000
118300             EVALUATE TRUE                                        11830000
118400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11840000
118500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11850000
118600                     MOVE SPACE TO ASC-SELECTED-SW                11860000
118700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11870000
118800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11880000
118900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11890000
119000                     MOVE SPACE TO ASC-SELECTED-SW                11900000
119100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11910000
119200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11920000
119300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11930000
119400                     MOVE SPACE TO ASC-SELECTED-SW                11940000
119500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11950000
119600             END-EVALUATE                                         11960000
119700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11970000
119800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11980000
119900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11990000
120000             END-IF                                               12000000
120100             PERFORM 3310-EDIT-RANGE                              12010000
120200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12020000
120300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12030000
120400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12040000
120500             END-IF                                               12050000
120600             PERFORM 3310-EDIT-RANGE                              12060000
120700         WHEN OTHER                                               12070000
120800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12080000
120900             SET DP020-MSG-FATAL    TO TRUE                       12090000
121000             MOVE -1                TO MR-SELECTL (PV-SUB)        12100000
121100             SET DP030-SET-CURSOR-APPL-1                          12110000
121200                                    TO TRUE                       12120000
121300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12130000
121400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12140000
121500             SET PS-ERROR TO TRUE                                 12150000
121600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12160000
121700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12170000
121800                 MOVE SPACE         TO ASC-SELECTED-SW            12180000
121900                                        (ASC-BLK-SUB ASC-ITEM-SUB)12190000
122000             END-IF                                               12200000
122100     END-EVALUATE.                                                12210000
122200                                                                  12220000
122300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12230000
122400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12240000
122500     IF  ASC-ITEM-SUB < 1                                         12250000
122600         SUBTRACT +1 FROM ASC-BLK-SUB                             12260000
122700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12270000
122800     END-IF.                                                      12280000
122900******************************************************************12290000
123000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12300000
123100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12310000
123200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12320000
123300** THE ENDING.                                                  **12330000
123400******************************************************************12340000
123500 3310-EDIT-RANGE.                                                 12350000
123600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12360000
123700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12370000
123800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12380000
123900                                   TO ASC-SELECTED-SW             12390000
124000                                        (ASC-BLK-SUB ASC-ITEM-SUB)12400000
124100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12410000
124200         ELSE                                                     12420000
124300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12430000
124400                 CONTINUE                                         12440000
124500             ELSE                                                 12450000
124600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12460000
124700                 MOVE PC-TSYMSG-00054                             12470000
124800                                   TO DP020-MSG-NUMBER            12480000
124900                 SET DP020-MSG-FATAL                              12490000
125000                                   TO TRUE                        12500000
125100                 MOVE -1           TO MR-SELECTL (PV-SUB)         12510000
125200                 SET DP030-SET-CURSOR-APPL-1                      12520000
125300                                   TO TRUE                        12530000
125400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12540000
125500                 MOVE DP015-UNDERLINE                             12550000
125600                                   TO MR-SELECTH (PV-SUB)         12560000
125700                 SET PS-ERROR      TO TRUE                        12570000
125800             END-IF                                               12580000
125900         END-IF                                                   12590000
126000     ELSE                                                         12600000
126100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12610000
126200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12620000
126300                                   TO ASC-SELECTED-SW             12630000
126400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12640000
126500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12650000
126600         ELSE                                                     12660000
126700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12670000
126800                 CONTINUE                                         12680000
126900             ELSE                                                 12690000
127000*                -- ONLY ONE END-OF-RANGE ALLOWED --              12700000
127100                 MOVE PC-TSYMSG-00055                             12710000
127200                                   TO DP020-MSG-NUMBER            12720000
127300                 SET DP020-MSG-FATAL                              12730000
127400                                   TO TRUE                        12740000
127500                 MOVE -1           TO MR-SELECTL (PV-SUB)         12750000
127600                 SET DP030-SET-CURSOR-APPL-1                      12760000
127700                                   TO TRUE                        12770000
127800                 SET PS-ERROR      TO TRUE                        12780000
127900             END-IF                                               12790000
128000         END-IF                                                   12800000
128100     END-IF.                                                      12810000
128200*                                                                 12820000
128300******************************************************************12830000
128400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12840000
128500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12850000
128600******************************************************************12860000
128700 3400-CHECK-RANGE-SEQUENCE.                                       12870000
128800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12880000
128900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12890000
129000       AND  ASC-START-OF-SELECTED-RANGE >                         12900000
129100                                         ASC-END-OF-SELECTED-RANGE12910000
129200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12920000
129300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12930000
129400         SET DP020-MSG-FATAL TO TRUE                              12940000
129500         SET PS-ERROR TO TRUE                                     12950000
129600         PERFORM 3410-POSITION-AT-ERROR                           12960000
129700     END-IF.                                                      12970000
129800******************************************************************12980000
129900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **12990000
130000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13000000
130100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13010000
130200******************************************************************13020000
130300 3410-POSITION-AT-ERROR.                                          13030000
130400     SET DP030-SET-CURSOR-APPL-1                                  13040000
130500                                   TO TRUE.                       13050000
130600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13060000
130700                    - PV-TOP-ITEM + 1.                            13070000
130800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13080000
130900         CONTINUE                                                 13090000
131000     ELSE                                                         13100000
131100         MOVE -1                   TO MR-SELECTL (PV-SUB)         13110000
131200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13120000
131300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13130000
131400     END-IF.                                                      13140000
131500*                                                                 13150000
131600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13160000
131700                    - PV-TOP-ITEM + 1.                            13170000
131800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13180000
131900         CONTINUE                                                 13190000
132000     ELSE                                                         13200000
132100         MOVE -1                   TO MR-SELECTL (PV-SUB)         13210000
132200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13220000
132300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13230000
132400     END-IF.                                                      13240000
132500 EJECT                                                            13250000
132600*----------------------------------------------------------------*13260000
132700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13270000
132800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13280000
132900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13290000
133000*----------------------------------------------------------------*13300000
133100                                                                  13310000
133200 3500-MARK-RANGE-AS-SELECTED.                                     13320000
133300     MOVE +1                       TO  ASC-BLK-SUB.               13330000
133400     PERFORM 3510-MARK-SELECTED-INDS                              13340000
133500         VARYING ASC-ITEM-SUB                                     13350000
133600         FROM 1 BY 1                                              13360000
133700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13370000
133800                                                                  13380000
133900     ADD +1                        TO ASC-BLK-SUB.                13390000
134000     PERFORM 3510-MARK-SELECTED-INDS                              13400000
134100         VARYING ASC-ITEM-SUB                                     13410000
134200         FROM 1 BY 1                                              13420000
134300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13430000
134400                                                                  13440000
134500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13450000
134600                                   TO  PV-LIST-ITEM-NUMBER.       13460000
134700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13470000
134800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13480000
134900               PC-ITEMS-PER-PANEL).                               13490000
135000                                                                  13500000
135100     MOVE ASC-START-OF-SELECTED-RANGE                             13510000
135200                                   TO PV-START-OF-SELECTED-RANGE. 13520000
135300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13530000
135400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13540000
135500               PC-ITEMS-PER-PANEL).                               13550000
135600                                                                  13560000
135700     MOVE ASC-END-OF-SELECTED-RANGE                               13570000
135800                                   TO  PV-END-OF-SELECTED-RANGE.  13580000
135900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13590000
136000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13600000
136100               PC-ITEMS-PER-PANEL).                               13610000
136200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13620000
136300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13630000
136400                                                                  13640000
136500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13650000
136600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13660000
136700         MOVE +1                   TO ASC-BLK-SUB                 13670000
136800         PERFORM 5100-WRITE-TEMP-STORAGE                          13680000
136900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13690000
137000             PV-FIRST-BLOCK-IN-ARRAY - 1                          13700000
137100                                                                  13710000
137200         PERFORM                                                  13720000
137300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13730000
137400                   PV-PREV-BLOCK-IN-ARRAY                         13740000
137500             MOVE PV-FIRST-BLOCK-IN-RANGE                         13750000
137600                                   TO PV-BLOCK-NUMBER             13760000
137700             PERFORM 4410-READ-TEMP-STORAGE                       13770000
137800             PERFORM 3510-MARK-SELECTED-INDS                      13780000
137900                 VARYING ASC-ITEM-SUB                             13790000
138000                 FROM 1 BY 1                                      13800000
138100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13810000
138200             PERFORM 5100-WRITE-TEMP-STORAGE                      13820000
138300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13830000
138400         END-PERFORM                                              13840000
138500                                                                  13850000
138600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13860000
138700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13870000
138800         PERFORM                                                  13880000
138900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13890000
139000                   PV-LAST-BLOCK-IN-RANGE                         13900000
139100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13910000
139200                                   TO PV-BLOCK-NUMBER             13920000
139300             PERFORM 4410-READ-TEMP-STORAGE                       13930000
139400             PERFORM 3510-MARK-SELECTED-INDS                      13940000
139500                 VARYING ASC-ITEM-SUB                             13950000
139600                 FROM 1 BY 1                                      13960000
139700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13970000
139800             PERFORM 5100-WRITE-TEMP-STORAGE                      13980000
139900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13990000
140000         END-PERFORM                                              14000000
140100                                                                  14010000
140200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14020000
140300                                   TO PV-BLOCK-NUMBER             14030000
140400         PERFORM 4410-READ-TEMP-STORAGE                           14040000
140500     END-IF.                                                      14050000
140600                                                                  14060000
140700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14070000
140800                                      ASC-END-OF-SELECTED-RANGE.  14080000
140900                                                                  14090000
141000 EJECT                                                            14100000
141100*----------------------------------------------------------------*14110000
141200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14120000
141300*----------------------------------------------------------------*14130000
141400                                                                  14140000
141500 3510-MARK-SELECTED-INDS.                                         14150000
141600                                                                  14160000
141700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14170000
141800                                ASC-ITEM-SUB) >                   14180000
141900         ASC-START-OF-SELECTED-RANGE)                             14190000
142000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14200000
142100                                ASC-ITEM-SUB) =                   14210000
142200         ASC-START-OF-SELECTED-RANGE)                             14220000
142300                                                                  14230000
142400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14240000
142500                                    ASC-ITEM-SUB) <               14250000
142600             ASC-END-OF-SELECTED-RANGE)                           14260000
142700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14270000
142800                                    ASC-ITEM-SUB) =               14280000
142900             ASC-END-OF-SELECTED-RANGE)                           14290000
143000                                                                  14300000
143100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14310000
143200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14320000
143300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14330000
143400                               TO TRUE                            14340000
143500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14350000
143600                               TO TRUE                            14360000
143700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14370000
143800             END-IF                                               14380000
143900         END-IF                                                   14390000
144000     END-IF.                                                      14400000
144100                                                                  14410000
144200 EJECT                                                            14420000
144300*----------------------------------------------------------------*14430000
144400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14440000
144500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14450000
144600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14460000
144700*    DISPLAY THE PANEL TO USER.                                  *14470000
144800*----------------------------------------------------------------*14480000
144900                                                                  14490000
145000 4000-BUILD-INITIAL-PANEL.                                        14500000
145100                                                                  14510000
145200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14520000
145300                                 ASC-BLOCK-ENTRIES (2).           14530000
145400     MOVE +1                 TO ASC-BLK-SUB.                      14540000
145500     SET ASC-ITEMS-LEFT-ON-DB                                     14550000
145600                             TO TRUE.                             14560000
145700                                                                  14570000
145800     MOVE +0                 TO ASC-ITEM-SUB                      14580000
145900                                ASC-NUMBER-OF-ITEMS-READ          14590000
146000                                ASC-NUMBER-OF-SELECTED-ITEMS      14600000
146100                                ASC-HIGHEST-BLOCK-WRITTEN         14610000
146200                                ASC-START-OF-SELECTED-RANGE       14620000
146300                                ASC-END-OF-SELECTED-RANGE         14630000
146400                                ASC-ITEM-AT-TOP-OF-PANEL.         14640000
146700     PERFORM 4010-OPEN-CURSOR.                                    14670000
146800                                                                  14680000
146900     PERFORM 4300-READ-ITEMS-FROM-DB.                             14690000
147000                                                                  14700000
147100     PERFORM 4020-CLOSE-CURSOR.                                   14710000
147200                                                                  14720000
147300     MOVE +1                   TO  PV-TOP-ITEM.                   14730000
147400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14740000
147500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14750000
147600         SET DP020-MSG-FATAL   TO  TRUE                           14760000
147700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14770000
147800     ELSE                                                         14780000
147900*        MOVE -1               TO MR-SELECTL (1)                  14790044
147910         MOVE -1               TO ASTRTITL                        14791044
148000         SET DP030-SET-CURSOR-APPL-1                              14800000
148100                               TO TRUE                            14810000
148200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14820000
148300     END-IF.                                                      14830000
148400 EJECT                                                            14840000
148500*----------------------------------------------------------------*14850000
148600* OPEN THE CARRIER NAME CURSOR.                                  *14860010
149000*----------------------------------------------------------------*14900000
149100                                                                  14910000
149200 4010-OPEN-CURSOR.                                                14920000
149300     PERFORM                                                      14930000
149400         WITH TEST AFTER                                          14940000
149500         VARYING PV-RETRY-COUNTER                                 14950000
149600         FROM 1 BY 1                                              14960000
149700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14970000
149800                   OR (SQLCODE = ZERO))                           14980000
149900                                                                  14990010
150300                 EXEC SQL                                         15030000
150400                      OPEN CARRIER_CSR                            15040007
150500                 END-EXEC                                         15050000
152100                                                                  15210000
152200         EVALUATE TRUE                                            15220000
152300             WHEN SQLCODE = ZERO                                  15230000
152400             WHEN SQLCODE = -904                                  15240000
152500             WHEN SQLCODE = -913                                  15250000
152600                 CONTINUE                                         15260000
152700             WHEN SQLWARN0 NOT = SPACES                           15270000
152800             WHEN SQLCODE < ZERO                                  15280000
152900             WHEN SQLCODE > ZERO                                  15290000
153000                 MOVE '4010-OPEN-CURSOR'                          15300000
153100                                   TO DP013-PARAGRAPH             15310000
153200                 MOVE 'OPEN CARRIER NAME CURSOR - '               15320007
153300                                   TO DP013-MESSAGE-TEXT (1)      15330000
153400                 MOVE SQLCA        TO DP013-SQLCA                 15340000
153500                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    15350000
153600                 SET DP013-DB2-ABEND                              15360000
153700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15370000
153800                 PERFORM DP013-0000-PROCESS-ABEND                 15380000
153900         END-EVALUATE                                             15390000
154000     END-PERFORM.                                                 15400000
154100*                                                                 15410000
154200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15420000
154300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15430000
154400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15440000
154500                                   TO DP013-MESSAGE-TEXT (1)      15450000
154600         MOVE SQLCA                TO DP013-SQLCA                 15460000
154700         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    15470000
154800         SET DP013-DB2-ABEND                                      15480000
154900             DP013-XCTL-DISPLAY-RESTART                           15490000
155000                                   TO TRUE                        15500000
155100         PERFORM DP013-0000-PROCESS-ABEND                         15510000
155200     END-IF.                                                      15520000
155300                                                                  15530000
155400 EJECT                                                            15540000
155500*----------------------------------------------------------------*15550000
155600* CLOSE THE CARRIER NAME CURSOR.                                 *15560007
156000*----------------------------------------------------------------*15600000
156100                                                                  15610000
156200 4020-CLOSE-CURSOR.                                               15620000
156300                                                                  15630010
156500             EXEC SQL                                             15650000
156600                 CLOSE CARRIER_CSR                                15660007
156700             END-EXEC                                             15670000
156800                                                                  15680000
158000     EVALUATE TRUE                                                15800000
158100         WHEN SQLCODE = ZERO                                      15810000
158200             CONTINUE                                             15820000
158300         WHEN SQLWARN0 NOT = SPACES                               15830000
158400         WHEN SQLCODE < ZERO                                      15840000
158500         WHEN SQLCODE > ZERO                                      15850000
158600             MOVE '4020-CLOSE-CURSOR'                             15860000
158700                               TO DP013-PARAGRAPH                 15870000
158800             MOVE 'CLOSE CARRIER NAME CURSOR '                    15880007
158900                               TO DP013-MESSAGE-TEXT (1)          15890000
159000             MOVE SQLCA        TO DP013-SQLCA                     15900000
159100             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        15910000
159200             SET DP013-DB2-ABEND                                  15920000
159300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15930000
159400             PERFORM DP013-0000-PROCESS-ABEND                     15940000
159500     END-EVALUATE.                                                15950000
159600                                                                  15960000
159700 EJECT                                                            15970000
166700*----------------------------------------------------------------*16670000
166800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16680000
166900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16690000
167000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16700000
167100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16710000
167200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16720000
167300*                                                                *16730000
167400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16740000
167500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16750000
167600*    UPON INITIALIZATION.                                        *16760000
167700*----------------------------------------------------------------*16770000
167800                                                                  16780000
167900 4300-READ-ITEMS-FROM-DB.                                         16790000
168000                                                                  16800000
168100     PERFORM                                                      16810000
168200         VARYING PV-READ-COUNT                                    16820000
168300         FROM 1 BY 1                                              16830000
168400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16840000
168500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16850000
168600                                                                  16860000
168700         PERFORM 4310-FETCH                                       16870000
168800                                                                  16880000
168900         IF  ASC-ITEMS-LEFT-ON-DB                                 16890000
169000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16900000
169100                 ADD +1            TO ASC-ITEM-SUB                16910000
169200             ELSE                                                 16920000
169300                 ADD +1            TO ASC-BLK-SUB                 16930000
169400                 MOVE +1           TO ASC-ITEM-SUB                16940000
169500                                                                  16950000
169600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16960000
169700                     MOVE +1       TO ASC-BLK-SUB                 16970000
169800                     SET ASC-BLOCK-MODIFIED (1)                   16980000
169900                                   TO TRUE                        16990000
170000                     PERFORM 5100-WRITE-TEMP-STORAGE              17000000
170100                     MOVE ASC-BLOCK-ENTRIES                       17010000
170200                               (PC-MAX-BLOCKS-IN-ARRAY)           17020000
170300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17030000
170400                     ADD +1        TO ASC-BLK-SUB                 17040000
170500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17050000
170600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17060000
170700                                   TO TRUE                        17070000
170800                 END-IF                                           17080000
170900             END-IF                                               17090000
171000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17100000
171100             MOVE ASC-NUMBER-OF-ITEMS-READ                        17110000
171200                                   TO ASC-LIST-ITEM-NUMBER        17120000
171300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17130007
171400             MOVE ENTNME-ENT-NAME-DESC                            17140009
171500                                   TO ASC-CARRIER-NAME            17150002
171600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17160002
171700             MOVE EXTENT-SCAC-CDE                                 17170009
171800                                   TO ASC-SCAC                    17180002
171900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17190002
172500         END-IF                                                   17250000
172600     END-PERFORM.                                                 17260000
172700                                                                  17270000
172800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17280000
172900         MOVE +1               TO ASC-BLK-SUB                     17290000
173000         PERFORM 5100-WRITE-TEMP-STORAGE                          17300000
173100         ADD +1                TO ASC-BLK-SUB                     17310000
173200         PERFORM 5100-WRITE-TEMP-STORAGE                          17320000
173300                                                                  17330000
173400         MOVE 1                TO ASC-BLK-SUB                     17340000
173500                                  PV-BLOCK-NUMBER                 17350000
173600         PERFORM 4410-READ-TEMP-STORAGE                           17360000
173700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17370000
173800             MOVE 2            TO ASC-BLK-SUB                     17380000
173900                                  PV-BLOCK-NUMBER                 17390000
174000             PERFORM 4410-READ-TEMP-STORAGE                       17400000
174100         END-IF                                                   17410000
174200     END-IF.                                                      17420000
174300 EJECT                                                            17430000
174400*----------------------------------------------------------------*17440000
174500*    FETCH THE MESSAGE CURSOR.                                   *17450000
174600*----------------------------------------------------------------*17460000
174700                                                                  17470000
174800 4310-FETCH.                                                      17480000
174900                                                                  17490000
174901        EXEC SQL                                                  17490105
174902             FETCH CARRIER_CSR                                    17490205
174903              INTO :EXTENT-SCAC-CDE                               17490305
174910                  ,:ENTNME-ENT-NAME-DESC                          17491005
175000        END-EXEC.                                                 17500005
178000                                                                  17800000
178100     EVALUATE TRUE                                                17810000
178200         WHEN SQLCODE = ZERO                                      17820000
178300         WHEN SQLCODE = +100                                      17830000
178400              CONTINUE                                            17840000
178500         WHEN SQLWARN0 NOT = SPACE                                17850000
178600         WHEN SQLCODE NOT = ZERO                                  17860000
178700              MOVE '4310-FETCH-CURSOR'                            17870000
178800                               TO DP013-PARAGRAPH                 17880000
178900              MOVE 'FETCH CARRIER CURSOR'                         17890006
179000                               TO DP013-MESSAGE-TEXT (1)          17900000
179100              MOVE SQLCA       TO DP013-SQLCA                     17910000
179200              SET DP013-DB2-ABEND                                 17920000
179300                               TO TRUE                            17930000
179400              PERFORM DP013-0000-PROCESS-ABEND                    17940000
179500     END-EVALUATE.                                                17950000
179600                                                                  17960000
179700     IF  SQLCODE EQUAL +100                                       17970000
179800         SET ASC-NO-ITEMS-LEFT-ON-DB                              17980000
179900                                   TO TRUE                        17990000
180000     END-IF.                                                      18000000
180100                                                                  18010000
180200 EJECT                                                            18020000
180300*----------------------------------------------------------------*18030000
180400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18040000
180500*----------------------------------------------------------------*18050000
180600                                                                  18060000
180700 4400-MOVE-COMMAREA-TO-SCREEN.                                    18070000
180800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18080000
180900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18090000
181000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18100000
181100             MOVE +1    TO ASC-BLK-SUB                            18110000
181200             PERFORM 5100-WRITE-TEMP-STORAGE                      18120000
181300             ADD +1     TO ASC-BLK-SUB                            18130000
181400             PERFORM 5100-WRITE-TEMP-STORAGE                      18140000
181500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18150000
181600                 GIVING PV-BLOCK-NUMBER                           18160000
181700                 REMAINDER PV-REMAINDER                           18170000
181800             IF  PV-REMAINDER > ZERO                              18180000
181900                 ADD +1 TO PV-BLOCK-NUMBER                        18190000
182000             END-IF                                               18200000
182100             MOVE +1    TO ASC-BLK-SUB                            18210000
182200             PERFORM 4410-READ-TEMP-STORAGE                       18220000
182300             ADD +1     TO ASC-BLK-SUB                            18230000
182400                           PV-BLOCK-NUMBER                        18240000
182500             PERFORM 4410-READ-TEMP-STORAGE                       18250000
182600     END-IF.                                                      18260000
182700     MOVE +1            TO ASC-BLK-SUB.                           18270000
182800     COMPUTE ASC-ITEM-SUB =                                       18280000
182900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18290000
183000         + PC-ITEMS-PER-PANEL).                                   18300000
183100*                                                                 18310000
183200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18320000
183300         ADD +1         TO ASC-BLK-SUB                            18330000
183400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18340000
183500     END-IF.                                                      18350000
183600*                                                                 18360000
183700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18370000
183800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18380000
183900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18390000
184000     PERFORM 4420-FORMAT-LIST-LINES                               18400000
184100         VARYING PV-SUB                                           18410000
184200         FROM PC-ITEMS-PER-PANEL BY -1                            18420000
184300         UNTIL PV-SUB < +1.                                       18430000
184400*                                                                 18440000
184500     COMPUTE ASC-ITEMS-DISPLAYED =                                18450000
184600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18460000
184700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18470000
184800                                      ASTRTITO.                   18480000
184900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18490000
185000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18500000
185100*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18510009
185200*                                  TO ASELITO.                    18520009
185300*                                                                 18530000
185400     IF  DP020-MSG-NUMBER-X = SPACE                               18540000
185500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18550000
185600*            --- MORE ITEMS TO DISPLAY ----                       18560000
185700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18570000
185800             SET DP020-MSG-INFORMATIONAL TO TRUE                  18580000
185900         END-IF                                                   18590000
186000     END-IF.                                                      18600000
186100*----------------------------------------------------------------*18610000
186200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18620000
186300*----------------------------------------------------------------*18630000
186400                                                                  18640000
186500 4410-READ-TEMP-STORAGE.                                          18650000
186600                                                                  18660000
186700     EXEC CICS                                                    18670000
186800         READQ TS                                                 18680000
186900             QUEUE (ASC-LIST-QUEUE-NAME)                          18690000
187000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18700000
187100             ITEM  (PV-BLOCK-NUMBER)                              18710000
187200             RESP  (PV-CICS-RESP)                                 18720000
187300     END-EXEC.                                                    18730000
187400                                                                  18740000
187500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18750000
187600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18760000
187700         CONTINUE                                                 18770000
187800     ELSE                                                         18780000
187900         SET DP013-CICS-ABEND     TO TRUE                         18790000
188000         SET DP013-NO-ROLLBACK    TO TRUE                         18800000
188100         MOVE '4410-READ-TEMP-STORAGE'                            18810000
188200                                  TO DP013-PARAGRAPH              18820000
188300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18830000
188400                                  TO DP013-MESSAGE-TEXT(1)        18840000
188500         PERFORM DP013-0000-PROCESS-ABEND                         18850000
188600     END-IF.                                                      18860000
188700                                                                  18870000
188800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18880000
188900*                                                                 18890000
189000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18900000
189100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18910000
189200     END-IF.                                                      18920000
189300 EJECT                                                            18930000
189400*----------------------------------------------------------------*18940000
189500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18950000
189600*----------------------------------------------------------------*18960000
189700                                                                  18970000
189800 4420-FORMAT-LIST-LINES.                                          18980000
189900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18990000
190000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19000000
190100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19010002
190200         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           19020002
190300         MOVE SPACE              TO MR-SELECTI (PV-SUB)           19030002
190310         MOVE SPACE              TO MR-SELECTI (PV-SUB)           19031002
190400         MOVE SPACE              TO MR-ACTION (PV-SUB)            19040041
190500         MOVE SPACE              TO MR-CARRIER-NAME (PV-SUB)      19050042
190600                                    MR-SCAC (PV-SUB)              19060042
190900     ELSE                                                         19090002
191000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19100002
191100                                                   > SPACE        19110002
191200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19120002
191300                                 TO MR-SELECTI (PV-SUB)           19130002
191400         ELSE                                                     19140002
191500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19150002
191600                                 TO MR-SELECTI (PV-SUB)           19160002
191700         END-IF                                                   19170002
191800                                                                  19180002
191900         IF  DP030-SET-CURSOR-TRAILER                             19190002
192000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19200002
192100                 > SPACE)                                         19210002
192200               OR (PV-SUB = 1))                                   19220002
192300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19230002
192400                MOVE -1          TO MR-SELECTL (PV-SUB)           19240002
192500             END-IF                                               19250002
192600         END-IF                                                   19260002
192700                                                                  19270002
192800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19280000
192900*            MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           19290013
193000*                                TO MR-ACTION (PV-SUB)            19300013
193100             MOVE ASC-CARRIER-NAME (ASC-BLK-SUB ASC-ITEM-SUB)     19310002
193200                                 TO MR-CARRIER-NAME (PV-SUB)      19320002
193300             MOVE ASC-SCAC     (ASC-BLK-SUB ASC-ITEM-SUB)         19330002
193400                                 TO MR-SCAC (PV-SUB)              19340002
193900         END-IF                                                   19390000
194000     END-IF.                                                      19400000
194100     SUBTRACT +1 FROM ASC-ITEM-SUB                                19410000
194200     IF  ASC-ITEM-SUB < + 1                                       19420000
194300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19430000
194400         MOVE +1                 TO ASC-BLK-SUB                   19440000
194500     END-IF.                                                      19450000
194600******************************************************************19460000
194700** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19470000
194800** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **19480000
194900** ISSUE A WARNING.                                             **19490000
195000******************************************************************19500000
195100 4430-CHECK-FOR-BEGIN-AND-END.                                    19510000
195200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19520000
195300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19530000
195400*            -- NO END-OF-RANGE SPECFIED ---                      19540000
195500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19550000
195600             SET DP020-MSG-WARNING TO TRUE                        19560000
195700             PERFORM 4431-POSITION-AT-WARNING                     19570000
195800         END-IF                                                   19580000
195900     ELSE                                                         19590000
196000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19600000
196100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19610000
196200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19620000
196300             SET DP020-MSG-WARNING TO TRUE                        19630000
196400             PERFORM 4431-POSITION-AT-WARNING                     19640000
196500         END-IF                                                   19650000
196600     END-IF.                                                      19660000
196700******************************************************************19670000
196800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **19680000
196900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **19690000
197000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **19700000
197100** POSITION THE CURSOR THERE.                                   **19710000
197200******************************************************************19720000
197300 4431-POSITION-AT-WARNING.                                        19730000
197400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19740000
197500                    - PV-TOP-ITEM + 1.                            19750000
197600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19760000
197700         CONTINUE                                                 19770000
197800     ELSE                                                         19780000
197900         SET DP030-SET-CURSOR-APPL-1                              19790000
198000                                   TO TRUE                        19800000
198100         MOVE -1                   TO MR-SELECTL (PV-SUB)         19810000
198200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19820000
198300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19830000
198400     END-IF.                                                      19840000
198500*                                                                 19850000
198600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19860000
198700                    - PV-TOP-ITEM + 1.                            19870000
198800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19880000
198900         CONTINUE                                                 19890000
199000     ELSE                                                         19900000
199100         SET DP030-SET-CURSOR-APPL-1                              19910000
199200                                   TO TRUE                        19920000
199300         MOVE -1                   TO MR-SELECTL (PV-SUB)         19930000
199400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19940000
199500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19950000
199600     END-IF.                                                      19960000
199700 EJECT                                                            19970000
199800*----------------------------------------------------------------*19980000
199900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19990000
200000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20000000
200100* FOR THE SELECTED ITEMS QUEUE.                                  *20010000
200200*                                                                *20020000
200300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20030000
200400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20040000
200500* THE ARRAY IS FULL.                                             *20050000
200600*----------------------------------------------------------------*20060000
200700                                                                  20070000
200800 5000-PREPARE-SEL-QUEUE.                                          20080000
200900                                                                  20090000
201000     MOVE +1                   TO  ASC-BLK-SUB.                   20100000
201100     PERFORM 5100-WRITE-TEMP-STORAGE.                             20110000
201200     ADD +1                    TO  ASC-BLK-SUB.                   20120000
201300     PERFORM 5100-WRITE-TEMP-STORAGE.                             20130000
201400                                                                  20140000
201500     MOVE ASC-SEL-QUEUE-NAME   TO  DP056-SEL-QUEUE-NAME.          20150000
201600     PERFORM 6010-DELETE-SEL-QUEUE.                               20160000
201700                                                                  20170000
201800     SET ASC-UPDATE-TSQ        TO  TRUE.                          20180000
201900                                                                  20190000
202000     SET DP057-IDX             TO  1.                             20200000
202100     MOVE ZERO                 TO DP056-NUMBER-OF-TS-ITEMS.       20210000
202200     INITIALIZE DP057-SELECTED-ITEM-ARRAY.                        20220000
202300                                                                  20230000
202400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20240000
202500             VARYING PV-ITEM                                      20250000
202600             FROM 1 BY 1                                          20260000
202700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20270000
202800                                                                  20280000
202900     IF  DP057-IDX > 1                                            20290000
203000         PERFORM 5205-WRITE-SEL-QUEUE                             20300000
203100         ADD +1                TO DP056-NUMBER-OF-TS-ITEMS        20310000
203200     END-IF.                                                      20320000
203300 EJECT                                                            20330000
203400*----------------------------------------------------------------*20340000
203500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20350000
203600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20360000
203700*----------------------------------------------------------------*20370000
203800                                                                  20380000
203900 5100-WRITE-TEMP-STORAGE.                                         20390000
204000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20400000
204100                                   TO PV-LIST-ITEM-NUMBER.        20410000
204200     COMPUTE PV-BLOCK-NUMBER =                                    20420000
204300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20430000
204400                                                                  20440000
204500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20450000
204600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20460000
204700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20470000
204800             PERFORM 5105-REWRITE-ASC-LISTQ                       20480000
204900         END-IF                                                   20490000
205000     ELSE                                                         20500000
205100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20510000
205200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20520000
205300         PERFORM 5110-WRITE-ASC-LISTQ                             20530000
205400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20540000
205500     END-IF.                                                      20550000
205600                                                                  20560000
205700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20570000
205800******************************************************************20580000
205900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20590000
206000** SPECIFIC COMMAREA.                                           **20600000
206100******************************************************************20610000
206200 5105-REWRITE-ASC-LISTQ.                                          20620000
206300     EXEC CICS                                                    20630000
206400         WRITEQ TS                                                20640000
206500             QUEUE (ASC-LIST-QUEUE-NAME)                          20650000
206600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20660000
206700             ITEM  (PV-BLOCK-NUMBER)                              20670000
206800             REWRITE                                              20680000
206900             RESP  (PV-CICS-RESP)                                 20690000
207000     END-EXEC.                                                    20700000
207100                                                                  20710000
207200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20720000
207300         CONTINUE                                                 20730000
207400     ELSE                                                         20740000
207500         SET DP013-CICS-ABEND            TO TRUE                  20750000
207600         SET DP013-NO-ROLLBACK           TO TRUE                  20760000
207700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20770000
207800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20780000
207900                                         TO DP013-MESSAGE-TEXT(1) 20790000
208000         PERFORM DP013-0000-PROCESS-ABEND                         20800000
208100     END-IF.                                                      20810000
208200                                                                  20820000
208300******************************************************************20830000
208400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20840000
208500** SPECIFIC COMMAREA.                                           **20850000
208600******************************************************************20860000
208700 5110-WRITE-ASC-LISTQ.                                            20870000
208800     EXEC CICS                                                    20880000
208900         WRITEQ TS                                                20890000
209000             QUEUE (ASC-LIST-QUEUE-NAME)                          20900000
209100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20910000
209200             ITEM  (PV-BLOCK-NUMBER)                              20920000
209300             RESP  (PV-CICS-RESP)                                 20930000
209400     END-EXEC.                                                    20940000
209500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20950000
209600         SET DP013-CICS-ABEND      TO TRUE                        20960000
209700         SET DP013-NO-ROLLBACK     TO TRUE                        20970000
209800         MOVE '5110-WRITE-ASC-LISTQ'                              20980000
209900                                   TO DP013-PARAGRAPH             20990000
210000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21000000
210100                                   TO DP013-MESSAGE-TEXT(1)       21010000
210200         PERFORM DP013-0000-PROCESS-ABEND                         21020000
210300     END-IF.                                                      21030000
210400 EJECT                                                            21040000
210500*----------------------------------------------------------------*21050000
210600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21060000
210700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21070000
210800*----------------------------------------------------------------*21080000
210900                                                                  21090000
211000 5200-FILL-SEL-QUEUE-RECORD.                                      21100000
211100                                                                  21110000
211200     PERFORM 6112-READ-LIST-QUEUE.                                21120000
211300                                                                  21130000
211400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21140000
211500         PERFORM                                                  21150000
211600         VARYING LQW-IDX                                          21160000
211700         FROM 1 BY 1                                              21170000
211800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21180000
211900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21190000
212000                                                                  21200000
212100             IF  LQW-SELECT (LQW-IDX)                             21210000
212200                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21220000
212300                                   TO DP057-ITEM (DP057-IDX)      21230000
212400*                MOVE LQW-MESSAGE-NUMBER (LQW-IDX)                21240013
212500*                                  TO DP057-MESSAGE-NUMBER        21250013
212600*                                       (DP057-IDX)               21260013
212700                 MOVE SPACE        TO DP057-ACTION-SW (DP057-IDX) 21270000
212800                 SET DP057-IDX UP BY 1                            21280000
212900                 IF  DP057-IDX > DP057-MAX-ITEMS                  21290000
213000                     PERFORM 5205-WRITE-SEL-QUEUE                 21300000
213100                     ADD +1        TO DP056-NUMBER-OF-TS-ITEMS    21310000
213200                     INITIALIZE DP057-SELECTED-ITEM-ARRAY         21320000
213300                     SET DP057-IDX TO  1                          21330000
213400                 END-IF                                           21340000
213500             END-IF                                               21350000
213600         END-PERFORM                                              21360000
213700     END-IF.                                                      21370000
213800                                                                  21380000
213900*----------------------------------------------------------------*21390000
214000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21400000
214100*----------------------------------------------------------------*21410000
214200                                                                  21420000
214300 5205-WRITE-SEL-QUEUE.                                            21430000
214400                                                                  21440000
214500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21450000
214600                                   TO DP057-SELECTED-ITEMS.       21460000
214700                                                                  21470000
214800     EXEC CICS                                                    21480000
214900          WRITEQ TS                                               21490000
215000              QUEUE (ASC-SEL-QUEUE-NAME)                          21500000
215100              FROM  (DP057-MESSAGE-SEL-REC)                       21510000
215200              ITEM  (PV-SEL-QUEUE-ITEM)                           21520000
215300              RESP  (PV-CICS-RESP)                                21530000
215400     END-EXEC.                                                    21540000
215500                                                                  21550000
215600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21560000
215700         CONTINUE                                                 21570000
215800     ELSE                                                         21580000
215900         SET DP013-CICS-ABEND      TO TRUE                        21590000
216000         SET DP013-NO-ROLLBACK     TO TRUE                        21600000
216100         MOVE '5205-WRITE-SEL-QUEUE'                              21610000
216200                                   TO DP013-PARAGRAPH             21620000
216300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21630000
216400                                   TO DP013-MESSAGE-TEXT(1)       21640000
216500         PERFORM DP013-0000-PROCESS-ABEND                         21650000
216600     END-IF.                                                      21660000
216700 EJECT                                                            21670000
216800******************************************************************21680000
216900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21690000
217000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21700000
217100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21710000
217200** THE USER.                                                    **21720000
217300******************************************************************21730000
217400 6000-REFRESH-PANEL-FROM-TEMP.                                    21740000
217500     IF  ASC-UPDATE-TSQ                                           21750000
217600         SET ASC-NO-TSQ-UPDATE TO TRUE                            21760000
217700         MOVE ZERO                 TO PV-SAVE-ITEM                21770000
217800                                      PV-SEL-QUEUE-ITEM           21780000
217900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21790000
218000                                   TO PV-HOLD-SELECTED-ITEMS      21800000
218100         MOVE +1                   TO PV-ITEMS-PROCESSED          21810000
218200         PERFORM 6100-UPDATE-TSQ                                  21820000
218300             UNTIL PV-ITEMS-PROCESSED >                           21830000
218400                                     PV-HOLD-SELECTED-ITEMS       21840000
218500         PERFORM 6010-DELETE-SEL-QUEUE                            21850000
218600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21860000
218700                    ASC-BLOCK-ENTRIES (2)                         21870000
218800     END-IF.                                                      21880000
218900                                                                  21890000
219000*----------------------------------------------------------------*21900000
219100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21910000
219200*----------------------------------------------------------------*21920000
219300 6010-DELETE-SEL-QUEUE.                                           21930000
219400                                                                  21940000
219500     EXEC CICS                                                    21950000
219600         DELETEQ TS                                               21960000
219700             QUEUE (ASC-SEL-QUEUE-NAME)                           21970000
219800             RESP  (PV-CICS-RESP)                                 21980000
219900     END-EXEC.                                                    21990000
220000*                                                                 22000000
220100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22010000
220200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22020000
220300         CONTINUE                                                 22030000
220400     ELSE                                                         22040000
220500         SET DP013-CICS-ABEND TO TRUE                             22050000
220600         SET DP013-NO-ROLLBACK TO TRUE                            22060000
220700         MOVE '6010-DELETE-SEL-QUEUE'                             22070000
220800                        TO DP013-PARAGRAPH                        22080000
220900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22090000
221000                        TO DP013-MESSAGE-TEXT (1)                 22100000
221100         PERFORM DP013-0000-PROCESS-ABEND                         22110000
221200     END-IF.                                                      22120000
221300                                                                  22130000
221400*----------------------------------------------------------------*22140000
221500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22150000
221600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22160000
221700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22170000
221800*    THE TEMP QUEUE.                                             *22180000
221900*----------------------------------------------------------------*22190000
222000                                                                  22200000
222100 6100-UPDATE-TSQ.                                                 22210000
222200                                                                  22220000
222300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             22230000
222400     PERFORM 6105-READ-SEL-QUEUE.                                 22240000
222500     PERFORM                                                      22250000
222600         VARYING DP057-IDX                                        22260000
222700         FROM 1 BY 1                                              22270000
222800         UNTIL ((PV-ITEMS-PROCESSED >                             22280000
222900                              PV-HOLD-SELECTED-ITEMS)             22290000
223000         OR (DP057-IDX GREATER THAN DP057-MAX-ITEMS))             22300000
223100         IF  DP057-ACTION-SW (DP057-IDX) > SPACE                  22310000
223200             PERFORM 6110-PROCESS-ITEMS                           22320000
223300         END-IF                                                   22330000
223400         ADD +1                TO PV-ITEMS-PROCESSED              22340000
223500     END-PERFORM.                                                 22350000
223600     PERFORM 6111-WRITE-LIST-QUEUE.                               22360000
223700*----------------------------------------------------------------*22370000
223800*    READ THE LIST QUEUE RECORD.                                 *22380000
223900*----------------------------------------------------------------*22390000
224000                                                                  22400000
224100 6105-READ-SEL-QUEUE.                                             22410000
224200                                                                  22420000
224300     EXEC CICS                                                    22430000
224400          READQ TS                                                22440000
224500              QUEUE (ASC-SEL-QUEUE-NAME)                          22450000
224600              INTO  (DP057-MESSAGE-SEL-REC)                       22460000
224700              ITEM  (PV-SEL-QUEUE-ITEM)                           22470000
224800              RESP  (PV-CICS-RESP)                                22480000
224900     END-EXEC.                                                    22490000
225000*                                                                 22500000
225100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22510000
225200         CONTINUE                                                 22520000
225300     ELSE                                                         22530000
225400         SET DP013-CICS-ABEND      TO  TRUE                       22540000
225500         SET DP013-NO-ROLLBACK     TO  TRUE                       22550000
225600         MOVE '6105-READ-SEL-QUEUE'                               22560000
225700                                   TO  DP013-PARAGRAPH            22570000
225800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22580000
225900                                   TO  DP013-MESSAGE-TEXT(1)      22590000
226000         PERFORM DP013-0000-PROCESS-ABEND                         22600000
226100     END-IF.                                                      22610000
226200 EJECT                                                            22620000
226300*----------------------------------------------------------------*22630000
226400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22640000
226500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22650000
226600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22660000
226700*----------------------------------------------------------------*22670000
226800                                                                  22680000
226900 6110-PROCESS-ITEMS.                                              22690000
227000                                                                  22700000
227100     COMPUTE PV-ITEM = 1 + ((DP057-ITEM (DP057-IDX) - 1)          22710000
227200                     / PC-ITEMS-PER-PANEL).                       22720000
227300                                                                  22730000
227400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22740000
227500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22750000
227600             PERFORM 6111-WRITE-LIST-QUEUE                        22760000
227700         END-IF                                                   22770000
227800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22780000
227900                                                                  22790000
228000         PERFORM 6112-READ-LIST-QUEUE                             22800000
228100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22810000
228200             CONTINUE                                             22820000
228300         END-IF                                                   22830000
228400     END-IF.                                                      22840000
228500                                                                  22850000
228600     COMPUTE PV-SUB = (DP057-ITEM (DP057-IDX)                     22860000
228700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22870000
228800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         22880000
228900     MOVE LQW-SELECTED-SW (PV-SUB)                                22890000
229000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22900000
229100*    EVALUATE TRUE                                                22910013
229200*        WHEN DP057-INQ (DP057-IDX)                               22920013
229300*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             22930013
229400*                                                                 22940013
229500*        WHEN DP057-UPD (DP057-IDX)                               22950013
229600*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             22960013
229700*                                                                 22970013
229800*        WHEN DP057-DEL (DP057-IDX)                               22980013
229900*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             22990013
230000*                                                                 23000013
230100*        WHEN DP057-ERR (DP057-IDX)                               23010013
230200*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23020013
230300*    END-EVALUATE.                                                23030013
230400                                                                  23040000
230500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23050000
230600                                                                  23060000
230700*----------------------------------------------------------------*23070000
230800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23080000
230900*----------------------------------------------------------------*23090000
231000                                                                  23100000
231100 6111-WRITE-LIST-QUEUE.                                           23110000
231200                                                                  23120000
231300     EXEC CICS                                                    23130000
231400         WRITEQ TS                                                23140000
231500             QUEUE (ASC-LIST-QUEUE-NAME)                          23150000
231600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23160000
231700             ITEM  (PV-SAVE-ITEM)                                 23170000
231800             REWRITE                                              23180000
231900             RESP  (PV-CICS-RESP)                                 23190000
232000     END-EXEC.                                                    23200000
232100*                                                                 23210000
232200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23220000
232300         CONTINUE                                                 23230000
232400     ELSE                                                         23240000
232500         SET DP013-CICS-ABEND  TO  TRUE                           23250000
232600         SET DP013-NO-ROLLBACK TO  TRUE                           23260000
232700         MOVE '6111-WRITE-LIST-QUEUE'                             23270000
232800                               TO  DP013-PARAGRAPH                23280000
232900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23290000
233000                               TO  DP013-MESSAGE-TEXT(1)          23300000
233100         PERFORM DP013-0000-PROCESS-ABEND                         23310000
233200     END-IF.                                                      23320000
233300                                                                  23330000
233400 EJECT                                                            23340000
233500*----------------------------------------------------------------*23350000
233600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23360000
233700*----------------------------------------------------------------*23370000
233800                                                                  23380000
233900 6112-READ-LIST-QUEUE.                                            23390000
234000                                                                  23400000
234100     EXEC CICS                                                    23410000
234200         READQ TS                                                 23420000
234300             QUEUE (ASC-LIST-QUEUE-NAME)                          23430000
234400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23440000
234500             ITEM  (PV-ITEM)                                      23450000
234600             RESP  (PV-CICS-RESP)                                 23460000
234700     END-EXEC.                                                    23470000
234800*                                                                 23480000
234900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23490000
235000         CONTINUE                                                 23500000
235100     ELSE                                                         23510000
235200         SET DP013-CICS-ABEND        TO TRUE                      23520000
235300         SET DP013-NO-ROLLBACK       TO TRUE                      23530000
235400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23540000
235500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23550000
235600                                     TO DP013-MESSAGE-TEXT(1)     23560000
235700         PERFORM DP013-0000-PROCESS-ABEND                         23570000
235800     END-IF.                                                      23580000
235900                                                                  23590000
236000 EJECT                                                            23600000
236100*----------------------------------------------------------------*23610000
236200*    ABEND PROCESSOR MODULE                                      *23620000
236300*----------------------------------------------------------------*23630000
236400                                                                  23640000
236500     COPY DPPD013.                                                23650000
