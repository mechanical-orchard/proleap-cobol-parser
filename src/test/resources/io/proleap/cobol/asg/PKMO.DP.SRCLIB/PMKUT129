      *----------------------------------------------------------               
       IDENTIFICATION DIVISION.                                                 
      *----------------------------------------------------------               
       PROGRAM-ID.             PMKUT129.                                        
       AUTHOR.                 COLLEEN CUMMINGS.                                
       INSTALLATION.           KOHLS DEPARTMENT STORES.                         
       DATE-WRITTEN.           JULY 2004.                                       
       DATE-COMPILED.                                                           
      *----------------------------------------------------------               
      *          PMKUT129 - PRICING EXCEPTION REPORT EXTRACT                    
      *----------------------------------------------------------               
      *  THIS PROGRAM WAS COPIED FROM PMKUT102 FOR A FILE NEEDED                
      *  FOR MARKETING.                                                         
      *  THIS PROGRAM EXTRACTS PRICING INFORMATION FOR AN                       
      *  AD EVENT AND WRITES IT OUT TO A FILE.  THIS PROGRAM                    
      *  TAKES IN A DATE RANGE FILE AND USES A CURSOR TO FETCH                  
      *  ALL THE PROMO ITEMS ASSOCIATED WITH THIS DATE RANGE.                   
      *  IT THEN LOADS THE PROMO ITEM ID'S TO A TEMPORARY                       
      *  WORKING STORAGE TABLE WITH AN INDICATOR TELLING IF IT                  
      *  BELONGS TO AN ADVERTISED OR UNADVERTISED PROMOTION.                    
      *  AFTER THIS IS DONE IT USES THIS TEMPORARY WORKING                      
      *  STORAGE CURSOR TO FETCH ONE PROMO ITEM ID AND ALL IT'S                 
      *  PRICING INFORMATION.  IT WILL THEN WRITE OUT EACH RECORD               
      *  TO A FILE BASED ON WHAT STORES ARE CONTAINED IN THE                    
      *  CONTROL CARD.  IT WILL ALSO GET ALL THE EXCLUSIONS FOR                 
      *  THE PRICING INVOLVED AND WRITE THAT OUT TO THE FILE ALSO.              
      *----------------------------------------------------------               
      * HISTORY LOG:                                                            
      *----------------------------------------------------------               
      * DATE:         10/20/2004                                                
      * WR/IR#:       P000703871                                                
      * PROGRAMMER:   COLLEEN CUMMINGS                                          
      * DESCRIPTION:  PERFORMANCE TUNING - ADDED ORDERED CLAUSE                 
      *               AND REMOVED ORDERED BY CLAUSE.                            
      *----------------------------------------------------------               
      * DATE:         10/22/2004                                                
      * WR/IR#:       P000704312                                                
      * PROGRAMMER:   COLLEEN CUMMINGS                                          
      * DESCRIPTION:  ADDED DISPLAYS TO BETTER IDENTIFY HOW FAR                 
      *               ALONG THE PROGRAM IS AND KEY INFO ON ABEND.               
      *----------------------------------------------------------               
      * DATE:         10/22/2004                                                
      * WR/IR#:       P000704312                                                
      * PROGRAMMER:   COLLEEN CUMMINGS                                          
      * DESCRIPTION:  INITIALIZE WAS CLEARING OUT:                              
      *               PV-STRT-TMST-FORMAT, PV-END-TMST-FORMAT                   
      *               TIME PIECE OF THE FIELDS - CHANGED TO BE FILLER           
      *               INSTEAD.                                                  
      *----------------------------------------------------------               
      * DATE:         10/25/2004                                                
      * WR/IR#:       P000704312                                                
      * PROGRAMMER:   COLLEEN CUMMINGS                                          
      * DESCRIPTION:  ERROR ON INVALID NUMBER.  CHANGED FETCH INTO              
      *               OF UNADPRICGCSR (4320-) TO MATCH SELECTED FIELDS.         
      *----------------------------------------------------------               
      * DATE:         10/26/2004                                                
      * WR/IR#:       P000704312                                                
      * PROGRAMMER:   COLLEEN CUMMINGS                                          
      * DESCRIPTION:  INITIALIZE OF AD SPACE ASSIGNMENT FIELDS WERE             
      *               BEING DONE ON EACH FETCH - SO THEY WERE BEING             
      *               CLEARED OUT WHEN THEY SHOULDN'T BE:                       
      *               PV-AD-PG-NBR                                              
      *               PV-AD-PG-SEQ-NBR                                          
      *               PV-AD-SP-CDE                                              
      *               JUST MOVED THEM OUT OF PV-SELECT-VARIABLES.               
      *----------------------------------------------------------               
      * DATE:         11/04/2004                                                
      * WR/IR#:       P000708187                                                
      * PROGRAMMER:   COLLEEN CUMMINGS                                          
      * DESCRIPTION:  ALLOW NULL FOR "PV-AD-SP-CDE" FIELD (7200-).              
      *----------------------------------------------------------               
      * DATE:        07/28/2006                                                 
      * WR/IR#:      P000905005                                                 
      * PROGRAMMER:  COLLEEN CUMMINGS                                           
      * DESCRIPTION: ADDED 59 SECONDS ONTO PROMO END TIME.                      
      *----------------------------------------------------------               
      * DATE:        10/20/2016                                                 
154307* WR/IR#:      CHG0154307                                                 
154307* PROGRAMMER:  COGNIZANT                                                  
154307* DESCRIPTION: MODIFIED CODE TO DETECT CORRECT HIER CODE                  
154307*              WHICH IN TURN HELPS TO REDUCE DUPLICATE                    
154307*              ROWS FROM PROCESSING THEREBY REDUCING CPU                  
154307*              CONSUMPTION.                                               
      *----------------------------------------------------------               
      * DATE:        07/30/2018                                                 
      * WR/IR#:      CHG0204126                                                 
      * PROGRAMMER:  COGNIZANT                                                  
      * DESCRIPTION: ORACLE LOGON STANDARDS PROGRAM CHANGE                      
      *----------------------------------------------------------               
       ENVIRONMENT DIVISION.                                                    
      *----------------------------------------------------------               
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
                                                                                
           SELECT CONTROL-CARD-FILE-STR                                         
                  ASSIGN TO INP01.                                              
                                                                                
           SELECT RUN-DATE-FILE                                                 
                  ASSIGN TO INP02.                                              
                                                                                
070941     SELECT ORACLE-LOGON-FILE                                             
070941            ASSIGN TO ORALOGON.                                           
                                                                                
           SELECT EXCPT-PRICG-EXT-FILE                                          
                  ASSIGN TO OUT01.                                              
                                                                                
                                                                                
      *----------------------------------------------------------               
       DATA DIVISION.                                                           
      *----------------------------------------------------------               
       FILE SECTION.                                                            
                                                                                
       FD  CONTROL-CARD-FILE-STR                                                
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS CONTROL-CARD-REC-STR.                                 
       01  CONTROL-CARD-REC-STR             PIC X(80).                          
                                                                                
       FD  RUN-DATE-FILE                                                        
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS RUN-DATE-RECORD.                                      
       01  RUN-DATE-RECORD                  PIC X(80).                          
                                                                                
070941 FD  ORACLE-LOGON-FILE                                                    
070941     RECORDING MODE IS F                                                  
070941     LABEL RECORDS ARE STANDARD                                           
070941     BLOCK CONTAINS 0 RECORDS                                             
070941     RECORD CONTAINS 80 CHARACTERS                                        
070941     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                              
070941 01  OL-ORACLE-LOGON-RECORD           PIC X(80).                          
                                                                                
       FD  EXCPT-PRICG-EXT-FILE                                                 
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS EXCPT-PRICG-EXT-REC.                                  
       01  EXCPT-PRICG-EXT-REC              PIC X(400).                         
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *----------------------------------------------------------               
      * ABEND- ABEND VARIABLES                                                  
      *----------------------------------------------------------               
       01  ABEND-CODE                       PIC S9(04) COMP VALUE +0.           
           88  ABEND-4001-WRITE-ERROR                  VALUE +4001.             
           88  ABEND-4002-READ-ERROR                   VALUE +4002.             
           88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.             
           88  ABEND-4004-TABLE-ERROR                  VALUE +4004.             
           88  ABEND-4005-OPEN-ERROR                   VALUE +4005.             
           88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.             
           88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.             
           88  ABEND-4008-DATA-ERROR                   VALUE +4008.             
           88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.             
           88  ABEND-4013-SQL-ERROR                    VALUE +4013.             
           88  ABEND-4014-ORACLE-LOGON-ERROR           VALUE +4014.             
           88  ABEND-4019-DATE-ROUTINE-ERROR           VALUE +4019.             
           88  ABEND-4444-FORCED-ABEND                 VALUE +4444.             
                                                                                
      *----------------------------------------------------------               
      * CC- CONTROL CARD                                                        
      *----------------------------------------------------------               
       01  CC-RUN-DATE-REC.                                                     
           05  CC-STRT-DTE                    PIC X(08) VALUE SPACES.           
           05  FILLER                         PIC X(01) VALUE SPACES.           
           05  CC-END-DTE                     PIC X(08) VALUE SPACES.           
           05  FILLER                         PIC X(63) VALUE SPACES.           
       01  CC-CONTROL-CARD-REC-STR.                                             
           05  CC-STR-NBR                     PIC 9(04) VALUE 0.                
           05  FILLER                         PIC X(76) VALUE SPACES.           
                                                                                
      *----------------------------------------------------------               
      * PS- PROGRAM SWITCHES                                                    
      *----------------------------------------------------------               
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-CONTROL-CARD-STR-SW       PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-CC-FILE-STR               VALUE 'Y'.               
               88  PS-NOT-END-OF-CC-FILE-STR           VALUE 'N'.               
           05  PS-END-OF-RUN-DATE-FILE-SW   PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-RUN-DATE-FILE             VALUE 'Y'.               
               88  PS-NOT-END-OF-RUN-DATE-FILE         VALUE 'N'.               
           05  PS-END-OF-ADPMITM-CSR-SW     PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-ADPMITM-CSR               VALUE 'Y'.               
               88  PS-NOT-END-OF-ADPMITM-CSR           VALUE 'N'.               
           05  PS-END-OF-ADPRCG-CSR-SW      PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-ADPRCG-CSR                VALUE 'Y'.               
               88  PS-NOT-END-OF-ADPRCG-CSR            VALUE 'N'.               
           05  PS-END-OF-UNADPRCG-CSR-SW    PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-UNADPRCG-CSR              VALUE 'Y'.               
               88  PS-NOT-END-OF-UNADPRCG-CSR          VALUE 'N'.               
           05  PS-END-OF-UNADPMITM-CSR-SW   PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-UNADPMITM-CSR             VALUE 'Y'.               
               88  PS-NOT-END-OF-UNADPMITM-CSR         VALUE 'N'.               
           05  PS-END-OF-EXCL-CSR-SW        PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-EXCL-CSR                  VALUE 'Y'.               
               88  PS-NOT-END-OF-EXCL-CSR              VALUE 'N'.               
           05  PS-END-OF-STRSEL-CSR-SW      PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-STRSEL-CSR                VALUE 'Y'.               
               88  PS-NOT-END-OF-STRSEL-CSR            VALUE 'N'.               
           05  PS-END-OF-STRGP-CSR-SW       PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-STRGP-CSR                 VALUE 'Y'.               
               88  PS-NOT-END-OF-STRGP-CSR             VALUE 'N'.               
           05  PS-END-OF-READHC-CSR-SW      PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-READHC-CSR                VALUE 'Y'.               
               88  PS-NOT-END-OF-READHC-CSR            VALUE 'N'.               
           05  PS-END-OF-ADHCSTR-CSR-SW     PIC X(01)  VALUE 'N'.               
               88  PS-END-OF-ADHCSTR-CSR               VALUE 'Y'.               
               88  PS-NOT-END-OF-ADHCSTR-CSR           VALUE 'N'.               
           05  PS-KIND-OF-GP-PRC-SW         PIC X(01)  VALUE 'S'.               
               88  PS-JUST-GP-PRC                      VALUE 'G'.               
               88  PS-SMP-GP-PRC                       VALUE 'A'.               
               88  PS-JUST-SMP-PRC                     VALUE 'S'.               
           05  PS-GP-PRC-AVAIL-SW           PIC X(01)  VALUE 'N'.               
               88  PS-NO-GP-PRC-AVAIL                  VALUE 'N'.               
               88  PS-GP-PRC-AVAIL                     VALUE 'Y'.               
070941     05  PS-END-OF-LOGON-FILE-SW      PIC X(1)   VALUE 'N'.               
070941         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.               
070941     05  PS-ORA-SRC-CTL-DONE-SW       PIC X(1)   VALUE 'N'.               
070941         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.               
070941                                                                          
070941 01  CC-ORACLE-CONNECTION.                                                
070941     05  CC-ORACLE-USERID             PIC X(40).                          
070941         88 CC-AUTO-LOGON                        VALUE '/'.               
070941     05  CC-ORACLE-PASSWORD           PIC X(40).                          
                                                                                
                                                                                
      *----------------------------------------------------------               
      * PC- PROGRAM CONSTANTS                                                   
      *----------------------------------------------------------               
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE                    
                                                      'PMKUT129'.               
                                                                                
      *----------------------------------------------------------               
      * PV- PROGRAM VARIABLES                                                   
      *----------------------------------------------------------               
       01  PV-PROGRAM-VARIABLES.                                                
070941     05  PV-ORACLE-USERID-LEN         PIC S9(4) VALUE ZEROS               
070941                                                COMP SYNC.                
070941     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4) VALUE ZEROS               
070941                                                COMP SYNC.                
           05  PV-TABLE-NAME                PIC X(30)  VALUE SPACES.            
           05  PV-SQL-CODE                  PIC 9(09)  VALUE 0.                 
           05  PV-OPERATION-MSG             PIC X(60)  VALUE SPACES.            
           05  PV-OPERATION-MSG-1           PIC X(40)  VALUE SPACES.            
           05  PV-PARAGRAPH-NAME            PIC X(30)  VALUE SPACES.            
           05  PV-SAVE-VAR                  PIC X(10)  VALUE SPACES.            
           05  PV-AD-PG-NBR                 PIC 9(03)  VALUE ZEROES.            
           05  PV-AD-PG-SEQ-NBR             PIC 9(03)  VALUE ZEROES.            
           05  PV-AD-SP-CDE                 PIC X(04)  VALUE SPACES.            
           05  PV-SYS-DATE                  PIC X(21)  VALUE SPACES.            
           05  PV-SAVE-NUM                  PIC 9(02)  VALUE 0.                 
           05  PV-COL-TXT                   PIC X(50)  VALUE SPACES.            
           05  PV-COL-3                     PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-COL-4                     PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-COL-5                     PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-COL-6                     PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-PROMO-ID-1                PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-ADV-IND                   PIC S9(02) VALUE +0                 
                                            COMP-3.                             
           05  PV-SAVE-MDSE-SELN-ID         PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-SAVE-MDSE-PRICG-ID        PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-PROMO-ITM-ID              PIC S9(10) VALUE +0                 
                                            COMP-3.                             
KBLFIX     05  PV-PROMO-ITM-ID-SAVED        PIC S9(10) VALUE +0                 
KBLFIX                                      COMP-3.                             
           05  PV-GP-PROMO-INTFC-ID         PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-GP-PRICG-TYP-CDE          PIC X(03)  VALUE SPACES.            
           05  PV-GROUP-QTY                 PIC S9(05) VALUE +0                 
                                            COMP-3.                             
           05  PV-GROUP-AMT                 PIC S9(07)V9(02) COMP-3             
                                                       VALUE +0.                
           05  PV-GROUP-PCT                 PIC S9(03)V9(03) COMP-3             
                                                       VALUE +0.                
           05  PV-HOST-STRS.                                                    
               10  PV-HOST-STR-1            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-2            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-3            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-4            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-5            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-6            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-7            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-8            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-9            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
               10  PV-HOST-STR-10           PIC S9(04) VALUE +0                 
                                            COMP-3.                             
                                                                                
           05  PV-NULL-IND.                                                     
               10  PV-AD-PG-SEQ-NBR-NULL    PIC S9(4) VALUE +0 COMP.            
               10  PV-AD-SP-CDE-NULL        PIC S9(4) VALUE +0 COMP.            
               10  PV-INTFC-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-GP-INTFC-NULL         PIC S9(4) VALUE +0 COMP.            
               10  PV-ITM-DESC-NULL         PIC S9(4) VALUE +0 COMP.            
               10  PV-DEPT-NULL             PIC S9(4) VALUE +0 COMP.            
               10  PV-MAJ-CL-NULL           PIC S9(4) VALUE +0 COMP.            
               10  PV-SUB-CL-NULL           PIC S9(4) VALUE +0 COMP.            
               10  PV-STYLE-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-SKU-NBR-NULL          PIC S9(4) VALUE +0 COMP.            
               10  PV-PRICG-TYP-NULL        PIC S9(4) VALUE +0 COMP.            
               10  PV-PRICG-AMT-NULL        PIC S9(4) VALUE +0 COMP.            
               10  PV-ADHC-STR-GP-NULL      PIC S9(4) VALUE +0 COMP.            
               10  PV-RUSBL-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-GP-QTY-NULL           PIC S9(4) VALUE +0 COMP.            
               10  PV-GP-AMT-NULL           PIC S9(4) VALUE +0 COMP.            
               10  PV-GP-PCT-NULL           PIC S9(4) VALUE +0 COMP.            
               10  PV-MDSE-HIER-NULL        PIC S9(4) VALUE +0 COMP.            
               10  PV-ADHC-STR-NULL         PIC S9(4) VALUE +0 COMP.            
               10  PV-EFF-STR-NULL          PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP1-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP2-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP3-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP4-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP5-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP6-NULL            PIC S9(4) VALUE +0 COMP.            
               10  PV-TEMP-TXT-NULL         PIC S9(4) VALUE +0 COMP.            
                                                                                
       01  PV-SELECT-VARIABLES.                                                 
           05  PV-AD-EVNT-ID                PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-PROMO-ID                  PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-REG-PROMO-TYP-CDE         PIC X(02)  VALUE SPACES.            
           05  PV-PROMO-DEPT-NBR            PIC S9(04) VALUE +0                 
                                            COMP-3.                             
           05  PV-STRT-TMST-FORMAT.                                             
               10 PV-STRT-DTE-FORMAT        PIC X(08)  VALUE SPACES.            
               10 FILLER                    PIC X(01)  VALUE '-'.               
               10 FILLER                    PIC X(08)  VALUE '00.00.00'.        
           05  PV-END-TMST-FORMAT.                                              
               10 PV-END-DTE-FORMAT         PIC X(08)  VALUE SPACES.            
               10 FILLER                    PIC X(01)  VALUE '-'.               
               10 FILLER                    PIC X(08)  VALUE '23.59.59'.        
           05  PV-STRT-TMST                 PIC X(17)  VALUE SPACES.            
           05  PV-END-TMST                  PIC X(17)  VALUE SPACES.            
           05  PV-PROMO-STRT-TMST           PIC X(19)  VALUE SPACES.            
           05  PV-PROMO-END-TMST            PIC X(19)  VALUE SPACES.            
           05  PV-PRCG-STRT-TMST            PIC X(19)  VALUE SPACES.            
           05  PV-PRCG-END-TMST             PIC X(19)  VALUE SPACES.            
           05  PV-MDSE-SELN-ID              PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-PROMO-INTFC-ID            PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-AD-EVNT-NM                PIC X(40)  VALUE SPACES.            
           05  PV-PROMO-NM                  PIC X(40)  VALUE SPACES.            
           05  PV-PROMO-ABBR-NM             PIC X(05)  VALUE SPACES.            
           05  PV-PROMO-ITM-DESC            PIC X(20)  VALUE SPACES.            
           05  PV-MDSE-SELN-DESC            PIC X(100) VALUE SPACES.            
           05  PV-DEPT-NBR                  PIC S9(04) VALUE +0                 
                                            COMP-3.                             
           05  PV-PROMO-ITM-ADV-IND         PIC X(01)  VALUE SPACES.            
           05  PV-MDSE-HIER-CDE             PIC X(03)  VALUE SPACES.            
           05  PV-MDSE-SELN-LNE-ID          PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-MAJ-CL-NBR                PIC S9(04) VALUE +0                 
                                            COMP-3.                             
           05  PV-SUB-CL-NBR                PIC S9(04) VALUE +0                 
                                            COMP-3.                             
           05  PV-VS-ID                     PIC S9(09) VALUE +0                 
                                            COMP-3.                             
           05  PV-SKU-NBR                   PIC S9(08) VALUE +0                 
                                            COMP-3.                             
           05  PV-MDSE-LNE-PRICG-ID         PIC S9(10) VALUE +0                 
                                            COMP-3.                             
           05  PV-PRICG-TYP-CDE             PIC X(03)  VALUE SPACES.            
           05  PV-PRICG-AMT                 PIC S9(07)V9(03) COMP-3             
                                                       VALUE +0.                
           05  PV-STR-SELN-ID               PIC S9(10)  VALUE +0                
                                            COMP-3.                             
           05  PV-EFF-STR-GP-ID             PIC S9(10)  VALUE +0                
                                            COMP-3.                             
           05  PV-STR-SELN-TYP-CDE          PIC X(01)  VALUE SPACES.            
           05  PV-ADHC-STR-GP-ID            PIC S9(10)  VALUE +0                
                                            COMP-3.                             
           05  PV-STR-GP-ID                 PIC S9(04)  VALUE +0                
                                            COMP-3.                             
           05  PV-STR-GP-TYP-CDE            PIC S9(04)  VALUE +0                
                                            COMP-3.                             
           05  PV-STR-GP-NM                 PIC X(30)  VALUE SPACES.            
           05  PV-RMS-STR-NBR               PIC S9(04)  VALUE +0                
                                            COMP-3.                             
           05  PV-READHC-STR-NBR            PIC S9(04)  VALUE +0                
                                            COMP-3.                             
           05  PV-ADHC-STR-NBR              PIC S9(04)  VALUE +0                
                                            COMP-3.                             
           05  PV-RUSBL-IND                 PIC X(01)  VALUE SPACES.            
           05  PV-MDSE-LNE-EXCLN-ID         PIC S9(10) VALUE +0                 
                                            COMP-3.                             
                                                                                
      *----------------------------------------------------------               
      * PA- PROGRAM ACCUMULATORS                                                
      *----------------------------------------------------------               
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-RECS-WRITTEN              PIC 9(09) VALUE ZEROES.             
           05  PA-PMITM-CNT                 PIC 9(09) VALUE ZEROES.             
           05  PA-MERCH-CNT                 PIC 9(09) VALUE ZEROES.             
           05  PA-EXCL-CNT                  PIC 9(09) VALUE ZEROES.             
           05  PA-KEEP-TRACK                PIC 9(09) VALUE ZEROES.             
           05  PA-INSERT-CNT                PIC 9(09) VALUE ZEROES.             
           05  PA-CNT-STRS                  PIC 9(09) VALUE ZEROES.             
                                                                                
      *----------------------------------------------------------               
      * COPYBOOK FOR THE PRICING RECORD EXTRACT - OUTPUT                        
      *----------------------------------------------------------               
           COPY PMRD124.                                                        
                                                                                
      *----------------------------------------------------------               
      *                      O  R  A  C  L  E                                   
      *==========================================================               
      *                                                                         
      * ORACLE DECLARE SECTION                                                  
      * ORACLE USED AND RETURNED VARIABLES                                      
      *                                                                         
      *----------------------------------------------------------               
070941*    COPY PMWS800.                                                        
                                                                                
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                             
                                                                                
      *----------------------------------------------------------               
      * ORACLE LOGON WORKING STORAGE COPYBOOK                                   
      *----------------------------------------------------------               
                                                                                
       01  PC-ENT01-TYPE-CDE                PIC X(02)  VALUE '01'.              
       01  PV-ORACLE-ID                     PIC X(1)   VALUE '/'.               
                                                                                
       01  USERNAME                         PIC X(10)  VARYING.                 
       01  PASSWD                           PIC X(10)  VARYING.                 
                                                                                
       01  ORACLE-RETURN                    PIC X(200) VALUE SPACES.            
                                                                                
           EXEC SQL END DECLARE SECTION END-EXEC.                               
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                               
                                                                                
       EJECT                                                                    
                                                                                
      *----------------------------------------------------------               
       PROCEDURE DIVISION.                                                      
      *----------------------------------------------------------               
       0000-MAINLINE.                                                           
                                                                                
           PERFORM 1000-INITIALIZATION.                                         
                                                                                
           IF NOT PS-END-OF-RUN-DATE-FILE                                       
              PERFORM 2000-PROCESS-AD-EVENT                                     
              PERFORM 3000-PROCESS-PRICING-CSRS                                 
           END-IF.                                                              
                                                                                
           PERFORM 9999-WRAPUP.                                                 
                                                                                
           GOBACK.                                                              
                                                                                
      *0000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 1000-INITIALIZATION.                                                    
      *     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS              
      *     FILES, READS CONTROL CARD, AND PROCESSES ANY CONTROL                
      *     CARD PARAMETERS IT MAY NEED TO USE TO FETCH PROMO ITEMS             
      *     ITEMS FROM THE CURSOR.                                              
      *----------------------------------------------------------               
       1000-INITIALIZATION.                                                     
                                                                                
           INITIALIZE PM124-EXCPT-PRCG-EXT                                      
                      PV-SELECT-VARIABLES.                                      
                                                                                
           OPEN INPUT  CONTROL-CARD-FILE-STR                                    
                       RUN-DATE-FILE                                            
                OUTPUT EXCPT-PRICG-EXT-FILE.                                    
                                                                                
070941     PERFORM 1150-ORACLE-SETUP.                                           
                                                                                
           PERFORM 1100-READ-RUN-DATE-FILE.                                     
                                                                                
           IF PS-END-OF-RUN-DATE-FILE                                           
              DISPLAY 'NO RUN DATES TO PROCESS'                                 
           ELSE                                                                 
                                                                                
              INITIALIZE PV-HOST-STRS                                           
              PERFORM 1200-READ-CONTROL-FILE-STR                                
                      UNTIL PS-END-OF-CC-FILE-STR                               
              PERFORM 1310-DECLARE-AD-PMITM-CSR                                 
              PERFORM 1320-DECLARE-ADPMITM-TEMP-CSR                             
              PERFORM 1330-DECLARE-AD-PRICG-CSR                                 
              PERFORM 1340-DECLARE-UNAD-PMITM-CSR                               
              PERFORM 1350-DECLARE-UNADITM-TEMP-CSR                             
              PERFORM 1360-DECLARE-UNAD-PRICG-CSR                               
              PERFORM 1370-DECLARE-RMS-STRGP-CSR                                
              PERFORM 1380-DECLARE-READHC-STR-CSR                               
              PERFORM 1390-DECLARE-ADHC-STR-CSR                                 
              PERFORM 1400-DECLARE-EXCL-CSR                                     
           END-IF.                                                              
                                                                                
      *1000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1100-READ-RUN-DATE-FILE.                                                
      *     READS THE CONTROL CARD THAT CONTAINS THE RUN DATES.                 
      *---------------------------------------------------------------          
       1100-READ-RUN-DATE-FILE.                                                 
                                                                                
           READ RUN-DATE-FILE INTO CC-RUN-DATE-REC                              
                AT END SET PS-END-OF-RUN-DATE-FILE TO TRUE.                     
                                                                                
           MOVE CC-STRT-DTE         TO PV-STRT-DTE-FORMAT.                      
           MOVE CC-END-DTE          TO PV-END-DTE-FORMAT.                       
           MOVE PV-STRT-TMST-FORMAT TO PV-STRT-TMST.                            
           MOVE PV-END-TMST-FORMAT  TO PV-END-TMST.                             
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '*********************************************'.             
           DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.                    
           DISPLAY '*********************************************'.             
           DISPLAY 'CC-STRT-DTE : ' CC-STRT-DTE.                                
           DISPLAY 'CC-END-DTE  : ' CC-END-DTE.                                 
           DISPLAY 'PV-STRT-TMST: ' PV-STRT-TMST.                               
           DISPLAY 'PV-END-TMST : ' PV-END-TMST.                                
                                                                                
      *1100-EXIT.                                                               
       EJECT.                                                                   
                                                                                
070941 1150-ORACLE-SETUP.                                                       
070941                                                                          
070941     OPEN INPUT ORACLE-LOGON-FILE.                                        
070941                                                                          
070941     PERFORM 1160-READ-ORACLE-LOGON.                                      
070941                                                                          
070941     CLOSE ORACLE-LOGON-FILE.                                             
070941                                                                          
070941     IF ((PS-END-OF-LOGON-FILE)                                           
070941             OR (CC-ORACLE-CONNECTION = SPACES))                          
070941         DISPLAY '** ABEND **'                                            
070941         DISPLAY PC-CURRENT-PROGRAM-NAME                                  
070941                 ' - ORACLE LOGON CONTROL CARD NOT PROVIDED'              
070941         SET PS-ORA-SRC-EMPTY TO TRUE                                     
070941         CALL 'ILBOABN0' USING ABEND-CODE                                 
070941     END-IF.                                                              
070941                                                                          
070941     IF CC-AUTO-LOGON                                                     
070941         DISPLAY PC-CURRENT-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        
070941         EXEC SQL                                                         
070941              CONNECT :USERNAME                                           
070941         END-EXEC                                                         
070941     ELSE                                                                 
070941         INITIALIZE PV-ORACLE-USERID-LEN                                  
070941                    PV-ORACLE-PASSWORD-LEN                                
070941         INSPECT CC-ORACLE-USERID                                         
070941             TALLYING PV-ORACLE-USERID-LEN                                
070941          FOR CHARACTERS BEFORE INITIAL SPACE                             
070941      INSPECT CC-ORACLE-PASSWORD                                          
070941          TALLYING PV-ORACLE-PASSWORD-LEN                                 
070941          FOR CHARACTERS BEFORE INITIAL SPACE                             
070941      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO                   
070941                USERNAME-ARR                                              
070941      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                           
070941      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO               
070941                PASSWD-ARR                                                
070941      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                           
070941      DISPLAY PC-CURRENT-PROGRAM-NAME ' -LOGON TO ORACLE AS USER '        
070941                USERNAME-ARR                                              
070941      EXEC SQL                                                            
070941        CONNECT :USERNAME IDENTIFIED BY :PASSWD                           
070941      END-EXEC                                                            
070941      INITIALIZE CC-ORACLE-PASSWORD                                       
070941                 PASSWD                                                   
070941      END-IF.                                                             
070941                                                                          
070941     IF (SQLCODE NOT = 0)                                                 
070941         DISPLAY PV-PARAGRAPH-NAME                                        
070941         DISPLAY PC-CURRENT-PROGRAM-NAME                                  
070941         ' - ERROR LOGGING ON TO ORACLE'                                  
070941         PERFORM Z100-ABEND                                               
070941     END-IF.                                                              
070941                                                                          
070941******************************************************************        
070941* NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG                
070941* OTHERWISE GET AN ORACLE ERROR (IE: 3113).                               
070941******************************************************************        
070941     EXEC SQL                                                             
070941      ALTER SESSION                                                       
070941            SET CURSOR_SHARING = 'EXACT'                                  
070941     END-EXEC.                                                            
070941                                                                          
070941                                                                          
070941*****************************************************************         
070941*  1160-READ-ORACLE-LOGON.                                      *         
070941* ==> PROCESSES:                                                *         
070941*   - READ ORCALE CONTROL CARD                                  *         
070941*****************************************************************         
070941 1160-READ-ORACLE-LOGON.                                                  
070941                                                                          
070941     READ ORACLE-LOGON-FILE                                               
070941         INTO CC-ORACLE-CONNECTION                                        
070941         AT END                                                           
070941             SET PS-END-OF-LOGON-FILE TO TRUE                             
070941     END-READ.                                                            
                                                                                
      *---------------------------------------------------------------          
      * 1200-READ-CONTROL-FILE-STR.                                             
      *     READS THE CONTROL CARD THAT CONTAINS SAMPLE STORES FOR              
      *     THE PRICING RECORDS.                                                
      *---------------------------------------------------------------          
       1200-READ-CONTROL-FILE-STR.                                              
                                                                                
           READ CONTROL-CARD-FILE-STR INTO CC-CONTROL-CARD-REC-STR              
                AT END SET PS-END-OF-CC-FILE-STR TO TRUE.                       
                                                                                
           ADD 1                TO PA-CNT-STRS.                                 
                                                                                
           EVALUATE TRUE                                                        
             WHEN PA-CNT-STRS = 1                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     MOVE '1200-READ-CONTROL-FILE-STR'                          
                                                 TO PV-PARAGRAPH-NAME           
                     MOVE 'CONTROL CARD IS EMPTY'                               
                                                 TO PV-OPERATION-MSG-1          
                     SET ABEND-4003-CTRL-CARD-ERROR  TO TRUE                    
                     PERFORM 9800-ABEND                                         
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-1               
                     DISPLAY 'SAMPLE STORE 1: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 2                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-2               
                     DISPLAY 'SAMPLE STORE 2: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 3                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-3               
                     DISPLAY 'SAMPLE STORE 3: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 4                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-4               
                     DISPLAY 'SAMPLE STORE 4: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 5                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-5               
                     DISPLAY 'SAMPLE STORE 5: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 6                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-6               
                     DISPLAY 'SAMPLE STORE 6: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 7                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-7               
                     DISPLAY 'SAMPLE STORE 7: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 8                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-8               
                     DISPLAY 'SAMPLE STORE 8: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 9                                               
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-9               
                     DISPLAY 'SAMPLE STORE 9: ' CC-STR-NBR                      
                  END-IF                                                        
             WHEN PA-CNT-STRS = 10                                              
                  IF PS-END-OF-CC-FILE-STR                                      
                     CONTINUE                                                   
                  ELSE                                                          
                     MOVE CC-STR-NBR             TO PV-HOST-STR-10              
                     DISPLAY 'SAMPLE STORE 10: ' CC-STR-NBR                     
                  END-IF                                                        
           END-EVALUATE.                                                        
                                                                                
      *1200-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      ******************************************************************        
      * NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG                
      * OTHERWISE I GET A ORA-3113 ERROR                                        
      ******************************************************************        
           EXEC SQL                                                             
            ALTER SESSION                                                       
                  SET CURSOR_SHARING = 'EXACT'                                  
            ALTER SESSION                                                       
                  SET OPTIMIZER_INDEX_COST_ADJ =  5                             
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------          
      * 1310-DECLARE-AD-PMITM-CSR.                                              
      *     DECLARE THE ADVERTISED PROMOTION PROMO ITEM CURSOR.                 
      *---------------------------------------------------------------          
       1310-DECLARE-AD-PMITM-CSR.                                               
                                                                                
           EXEC SQL                                                             
                DECLARE ADPMITMCSR CURSOR FOR                                   
                  SELECT  B.PROMO_ITM_ID                                        
                    FROM  PMV_PROMO_DIM A                                       
                         ,PMT_PROMO_ITM B                                       
                   WHERE  A.PROMO_ID          = B.PROMO_ID                      
                     AND  A.PROMO_DFLT_STRT_TMST    >=                          
                          TO_DATE(:PV-STRT-TMST,'YYYYMMDD-HH24.MI.SS')          
                     AND  A.PROMO_DFLT_END_TMST     <=                          
                          TO_DATE(:PV-END-TMST,'YYYYMMDD-HH24.MI.SS')           
                     AND  A.REG_PROMO_TYP_CDE = 'A'                             
                     AND  A.PROMO_STAT_CDE    = 'S'                             
                     AND  B.STAT_CDE          = 'S'                             
           END-EXEC.                                                            
                                                                                
      *1310-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1320-DECLARE-ADPMITM-TEMP-CSR.                                          
      *     DECLARE THE ADVERTISED PROMOTION PROMO ITEM TEMP CURSOR.            
      *---------------------------------------------------------------          
       1320-DECLARE-ADPMITM-TEMP-CSR.                                           
                                                                                
           EXEC SQL                                                             
                DECLARE ADPMTMPCSR CURSOR FOR                                   
                  SELECT  COL1_NBR                                              
                    FROM  PMTT_CRSR_WRK_TBL                                     
                   WHERE  COL2_NBR          = 01                                
           END-EXEC.                                                            
                                                                                
      *1320-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1330-DECLARE-AD-PRICG-CSR.                                              
      *     DECLARE THE ADVERTISED PROMOTION PRICING CURSOR.                    
      *---------------------------------------------------------------          
       1330-DECLARE-AD-PRICG-CSR.                                               
                                                                                
           EXEC SQL                                                             
                DECLARE ADPRICGCSR CURSOR FOR                                   
                  SELECT /*+ ORDERED(B,C,D,E,F,I,J,M,N,L,K) */                  
                          B.PROMO_ID                                            
                         ,N.AD_EVNT_ID                                          
                         ,M.DFLT_STRT_TMST                                      
                         ,B.DEPT_NBR                                            
                         ,C.MDSE_SELN_ID                                        
                         ,C.MDSE_HIER_CDE                                       
                         ,D.MDSE_SELN_LNE_ID                                    
                         ,D.DEPT_NBR                                            
                         ,D.MAJ_CL_NBR                                          
                         ,D.SUB_CL_NBR                                          
                         ,D.VS_ID                                               
                         ,D.SKU_NBR                                             
                         ,E.MDSE_LNE_PRICG_ID                                   
                         ,E.PRICG_TYP_CDE                                       
                         ,E.PRICG_AMT                                           
                         ,E.SIMP_PROMO_INTFC_ID                                 
                         ,TO_CHAR(I.PROMO_ITM_STRT_TMST,                        
                                  'YYYY-MM-DD HH24:MI:SS')                      
                         ,TO_CHAR(I.PROMO_ITM_END_TMST,                         
                                   'YYYY-MM-DD HH24:MI:SS')                     
                         ,J.EFF_STR_GP_ID                                       
                         ,J.STR_SELN_TYP_CDE                                    
                         ,J.ADHC_STR_GP_ID                                      
                         ,K.CPLT_NM AD_EVNT_NM                                  
                         ,L.CPLT_NM PROMO_NM                                    
                         ,L.ABBR_NM PROMO_ABBR_NM                               
                         ,B.PROMO_ITM_DESC                                      
                         ,C.MDSE_SELN_DESC                                      
                    FROM  PMT_PROMO_ITM B                                       
                         ,PMT_MDSE_SELN C                                       
                         ,PMT_MDSE_SELN_LNE D                                   
                         ,PMT_MDSE_LNE_PRICG E                                  
                         ,PMT_MDSE_LNE_PRICG_ASSN F                             
                         ,PMT_PROMO_ITM_ASSN I                                  
                         ,PMT_STR_SELN J                                        
                         ,PMT_PROMO M                                           
                         ,PMT_AD_EVNT N                                         
                         ,PMT_NM L                                              
                         ,PMT_NM K                                              
                   WHERE  B.PROMO_ITM_ID      = C.PROMO_ITM_ID                  
                     AND  C.MDSE_SELN_ID      = D.MDSE_SELN_ID                  
                     AND  D.MDSE_SELN_LNE_ID  = E.MDSE_SELN_LNE_ID              
                     AND  E.MDSE_LNE_PRICG_ID = F.MDSE_LNE_PRICG_ID             
                     AND  B.PROMO_ITM_ID      = I.PROMO_ITM_ID                  
                     AND  F.STR_SELN_ID       = I.STR_SELN_ID                   
                     AND  I.STR_SELN_ID       = J.STR_SELN_ID                   
                     AND  B.PROMO_ITM_ID      =  :PV-PROMO-ITM-ID               
                     AND  B.PROMO_ID          = M.PROMO_ID                      
                     AND  M.AD_EVNT_ID        = N.AD_EVNT_ID                    
                     AND  M.NM_ID             = L.NM_ID                         
                     AND  N.NM_ID             = K.NM_ID                         
                     AND  C.STAT_CDE          = 'S'                             
                     AND  D.STAT_CDE          = 'S'                             
                     AND  E.STAT_CDE          = 'S'                             
                     AND  F.STAT_CDE          = 'S'                             
                     AND  I.STAT_CDE          = 'S'                             
      *CGC     ORDER BY C.MDSE_SELN_ID, D.MDSE_SELN_LNE_ID,                     
      *CGC              E.MDSE_LNE_PRICG_ID                                     
           END-EXEC.                                                            
                                                                                
      *1330-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1340-DECLARE-UNAD-PMITM-CSR.                                            
      *     DECLARE THE UNADVERTISED PROMOTION PROMO ITEM CURSOR.               
      *---------------------------------------------------------------          
       1340-DECLARE-UNAD-PMITM-CSR.                                             
                                                                                
           EXEC SQL                                                             
                DECLARE UNADPMITMCSR CURSOR FOR                                 
                  SELECT  B.PROMO_ITM_ID                                        
                    FROM  PMV_PROMO_DIM A                                       
                         ,PMT_PROMO_ITM B                                       
                   WHERE  A.PROMO_ID          = B.PROMO_ID                      
                     AND  A.PROMO_DFLT_STRT_TMST    >=                          
                          TO_DATE(:PV-STRT-TMST,'YYYYMMDD-HH24.MI.SS')          
                     AND  A.PROMO_DFLT_END_TMST     <=                          
                          TO_DATE(:PV-END-TMST,'YYYYMMDD-HH24.MI.SS')           
                     AND  A.REG_PROMO_TYP_CDE = 'U'                             
                     AND  A.PROMO_STAT_CDE    = 'S'                             
                     AND  B.STAT_CDE          = 'S'                             
           END-EXEC.                                                            
                                                                                
      *1340-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1350-DECLARE-UNADITM-TEMP-CSR.                                          
      *     DECLARE THE UNADVERTISED PROMOTION PROMO ITEM TEMP CURSOR.          
      *---------------------------------------------------------------          
       1350-DECLARE-UNADITM-TEMP-CSR.                                           
                                                                                
           EXEC SQL                                                             
                DECLARE UNADPMTMPCSR CURSOR FOR                                 
                  SELECT  COL1_NBR                                              
                    FROM  PMTT_CRSR_WRK_TBL                                     
                   WHERE  COL2_NBR          = 00                                
           END-EXEC.                                                            
                                                                                
      *1350-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1360-DECLARE-UNAD-PRICG-CSR.                                            
      *     DECLARE THE UNADVERTISED PROMOTION PRICING CURSOR.                  
      *---------------------------------------------------------------          
       1360-DECLARE-UNAD-PRICG-CSR.                                             
                                                                                
           EXEC SQL                                                             
                DECLARE UNADPRICGCSR CURSOR FOR                                 
                  SELECT /*+ ORDERED(B,C,D,E,F,I,J,M,N,L,K) */                  
                          B.PROMO_ID                                            
                         ,N.AD_EVNT_ID                                          
                         ,M.DFLT_STRT_TMST                                      
                         ,B.DEPT_NBR                                            
                         ,C.MDSE_SELN_ID                                        
                         ,C.MDSE_HIER_CDE                                       
                         ,D.MDSE_SELN_LNE_ID                                    
                         ,D.DEPT_NBR                                            
                         ,D.MAJ_CL_NBR                                          
                         ,D.SUB_CL_NBR                                          
                         ,D.VS_ID                                               
                         ,D.SKU_NBR                                             
                         ,E.MDSE_LNE_PRICG_ID                                   
                         ,E.PRICG_TYP_CDE                                       
                         ,E.PRICG_AMT                                           
                         ,E.SIMP_PROMO_INTFC_ID                                 
                         ,TO_CHAR(I.PROMO_ITM_STRT_TMST,                        
                                  'YYYY-MM-DD HH24:MI:SS')                      
                         ,TO_CHAR(I.PROMO_ITM_END_TMST,                         
                                   'YYYY-MM-DD HH24:MI:SS')                     
                         ,J.EFF_STR_GP_ID                                       
                         ,J.STR_SELN_TYP_CDE                                    
                         ,J.ADHC_STR_GP_ID                                      
                         ,K.CPLT_NM AD_EVNT_NM                                  
                         ,L.CPLT_NM PROMO_NM                                    
                         ,L.ABBR_NM PROMO_ABBR_NM                               
                         ,B.PROMO_ITM_DESC                                      
                         ,C.MDSE_SELN_DESC                                      
                    FROM  PMT_PROMO_ITM B                                       
                         ,PMT_MDSE_SELN C                                       
                         ,PMT_MDSE_SELN_LNE D                                   
                         ,PMT_MDSE_LNE_PRICG E                                  
                         ,PMT_MDSE_LNE_PRICG_ASSN F                             
                         ,PMT_PROMO_ITM_ASSN I                                  
                         ,PMT_STR_SELN J                                        
                         ,PMT_PROMO M                                           
                         ,PMT_AD_EVNT N                                         
                         ,PMT_NM L                                              
                         ,PMT_NM K                                              
                   WHERE  B.PROMO_ITM_ID      = C.PROMO_ITM_ID                  
                     AND  C.MDSE_SELN_ID      = D.MDSE_SELN_ID                  
                     AND  D.MDSE_SELN_LNE_ID  = E.MDSE_SELN_LNE_ID              
                     AND  E.MDSE_LNE_PRICG_ID = F.MDSE_LNE_PRICG_ID             
                     AND  B.PROMO_ITM_ID      = I.PROMO_ITM_ID                  
                     AND  F.STR_SELN_ID       = I.STR_SELN_ID                   
                     AND  I.STR_SELN_ID       = J.STR_SELN_ID                   
                     AND  B.PROMO_ITM_ID      =  :PV-PROMO-ITM-ID               
                     AND  B.PROMO_ID          = M.PROMO_ID                      
                     AND  M.AD_EVNT_ID        = N.AD_EVNT_ID                    
                     AND  M.NM_ID             = L.NM_ID                         
                     AND  N.NM_ID             = K.NM_ID                         
                     AND  C.STAT_CDE          = 'S'                             
                     AND  D.STAT_CDE          = 'S'                             
                     AND  E.STAT_CDE          = 'S'                             
                     AND  F.STAT_CDE          = 'S'                             
                     AND  I.STAT_CDE          = 'S'                             
      *CGC     ORDER BY C.MDSE_SELN_ID, D.MDSE_SELN_LNE_ID,                     
      *CGC              E.MDSE_LNE_PRICG_ID                                     
           END-EXEC.                                                            
                                                                                
      *1360-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1370-DECLARE-RMS-STRGP-CSR.                                             
      *     DECLARE THE RMS STORE CURSOR.                                       
      *---------------------------------------------------------------          
       1370-DECLARE-RMS-STRGP-CSR.                                              
                                                                                
           EXEC SQL                                                             
                DECLARE RMSSTRGPCSR CURSOR FOR                                  
                  SELECT  C.STR_NBR                                             
                    FROM  XKT_STR_GP_DTE A                                      
                         ,XKT_STR_GP B                                          
                         ,XKT_STR_GP_MBSHP C                                    
                   WHERE  A.EFF_STR_GP_ID  = :PV-EFF-STR-GP-ID                  
                     AND  A.STR_GP_ID      = B.STR_GP_ID                        
                     AND  A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE                   
                     AND  B.STR_GP_ID      = C.STR_GP_ID                        
                     AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE                   
                     AND  A.EFF_BEG_DTE   <= :PV-PROMO-STRT-TMST                
                     AND (A.EFF_END_DTE   >= :PV-PROMO-STRT-TMST                
                            OR A.EFF_END_DTE IS NULL)                           
                     AND  C.EFF_BEG_DTE   <= :PV-PROMO-STRT-TMST                
                     AND (C.EFF_END_DTE   >= :PV-PROMO-STRT-TMST                
                            OR C.EFF_END_DTE IS NULL)                           
                     AND  C.STR_NBR       IN (:PV-HOST-STR-1,                   
                                              :PV-HOST-STR-2,                   
                                              :PV-HOST-STR-3,                   
                                              :PV-HOST-STR-4,                   
                                              :PV-HOST-STR-5,                   
                                              :PV-HOST-STR-6,                   
                                              :PV-HOST-STR-7,                   
                                              :PV-HOST-STR-8,                   
                                              :PV-HOST-STR-9,                   
                                              :PV-HOST-STR-10)                  
           END-EXEC.                                                            
                                                                                
      *1370-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1380-DECLARE-READHC-STR-CSR.                                            
      *     DECLARE THE REUSABLE ADHOC STORE CURSOR.                            
      *---------------------------------------------------------------          
       1380-DECLARE-READHC-STR-CSR.                                             
                                                                                
           EXEC SQL                                                             
                DECLARE READHCSTRCSR CURSOR FOR                                 
                  SELECT  D.STR_NBR                                             
                    FROM  PMT_ADHC_STR_GP_XREF A                                
                         ,XKT_STR_GP_DTE B                                      
                         ,XKT_STR_GP C                                          
                         ,XKT_STR_GP_MBSHP D                                    
                   WHERE  A.ADHC_STR_GP_ID = :PV-ADHC-STR-GP-ID                 
                     AND  A.EFF_STR_GP_ID  = B.EFF_STR_GP_ID                    
                     AND  B.STR_GP_ID      = C.STR_GP_ID                        
                     AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE                   
                     AND  C.STR_GP_ID      = D.STR_GP_ID                        
                     AND  C.STR_GP_TYP_CDE = D.STR_GP_TYP_CDE                   
                     AND  B.EFF_BEG_DTE   <= :PV-PROMO-STRT-TMST                
                     AND  D.EFF_BEG_DTE   <= :PV-PROMO-STRT-TMST                
                     AND (B.EFF_END_DTE   >= :PV-PROMO-STRT-TMST                
                               OR B.EFF_END_DTE IS NULL)                        
                     AND (D.EFF_END_DTE   >= :PV-PROMO-STRT-TMST                
                               OR D.EFF_END_DTE IS NULL)                        
                     AND  A.STAT_CDE       = 'S'                                
                     AND  D.STR_NBR       IN (:PV-HOST-STR-1,                   
                                              :PV-HOST-STR-2,                   
                                              :PV-HOST-STR-3,                   
                                              :PV-HOST-STR-4,                   
                                              :PV-HOST-STR-5,                   
                                              :PV-HOST-STR-6,                   
                                              :PV-HOST-STR-7,                   
                                              :PV-HOST-STR-8,                   
                                              :PV-HOST-STR-9,                   
                                              :PV-HOST-STR-10)                  
           END-EXEC.                                                            
                                                                                
      *1380-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1390-DECLARE-ADHC-STR-CSR.                                              
      *     DECLARE THE ADHOC STORE CURSOR.                                     
      *---------------------------------------------------------------          
       1390-DECLARE-ADHC-STR-CSR.                                               
                                                                                
           EXEC SQL                                                             
                DECLARE ADHCSTRCSR CURSOR FOR                                   
                  SELECT DISTINCT STR_NBR                                       
                    FROM  PMT_PROMO_INTFC_ADHC_STR                              
                   WHERE  ADHC_STR_GP_ID = :PV-ADHC-STR-GP-ID                   
                     AND  EFF_STRT_TMST <= :PV-PROMO-STRT-TMST                  
                     AND (EFF_END_TMST  >= :PV-PROMO-STRT-TMST                  
                               OR EFF_END_TMST IS NULL)                         
                     AND  STAT_CDE       = 'S'                                  
                     AND  STR_NBR       IN (:PV-HOST-STR-1,                     
                                            :PV-HOST-STR-2,                     
                                            :PV-HOST-STR-3,                     
                                            :PV-HOST-STR-4,                     
                                            :PV-HOST-STR-5,                     
                                            :PV-HOST-STR-6,                     
                                            :PV-HOST-STR-7,                     
                                            :PV-HOST-STR-8,                     
                                            :PV-HOST-STR-9,                     
                                            :PV-HOST-STR-10)                    
           END-EXEC.                                                            
                                                                                
      *1390-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *---------------------------------------------------------------          
      * 1400-DECLARE-EXCL-CSR.                                                  
      *     DECLARE THE EXCLUSION CURSOR.                                       
      *---------------------------------------------------------------          
       1400-DECLARE-EXCL-CSR.                                                   
                                                                                
           EXEC SQL                                                             
                DECLARE EXCLCSR CURSOR FOR                                      
                  SELECT  MDSE_SELN_LNE_EXCLN_ID                                
                         ,MAJ_CL_NBR                                            
                         ,MDSE_HIER_CDE                                         
                         ,SUB_CL_NBR                                            
                         ,VS_ID                                                 
                         ,SKU_NBR                                               
                    FROM  PMT_MDSE_SELN_LNE_EXCLN                               
                   WHERE  MDSE_SELN_LNE_ID = :PV-MDSE-SELN-LNE-ID               
                     AND  STAT_CDE         = 'S'                                
           END-EXEC.                                                            
                                                                                
      *1400-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2000-PROCESS-AD-EVENT.                                                  
      *     FETCHES ALL PROMO ITEMS ASSOCIATED WITH THE INPUT AD EVENT          
      *     AND WRITES OUT TO A TEMPORARY WORKING STORAGE TABLE.                
      *----------------------------------------------------------               
       2000-PROCESS-AD-EVENT.                                                   
                                                                                
           PERFORM 2110-OPEN-AD-PMITM-CSR.                                      
           PERFORM 2120-FETCH-AD-PMITM-CSR.                                     
           PERFORM 2100-PROCESS-AD-PMITM-CSR                                    
                   UNTIL PS-END-OF-ADPMITM-CSR.                                 
           PERFORM 2130-CLOSE-AD-PMITM-CSR.                                     
                                                                                
           PERFORM 2210-OPEN-UNAD-PMITM-CSR.                                    
           PERFORM 2220-FETCH-UNAD-PMITM-CSR.                                   
           PERFORM 2200-PROCESS-UNAD-PMITM-CSR                                  
                   UNTIL PS-END-OF-UNADPMITM-CSR.                               
           PERFORM 2230-CLOSE-UNAD-PMITM-CSR.                                   
                                                                                
      *2000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2100-PROCESS-AD-PMITM-CSR.                                              
      *     FETCHES THE PROMO ITEM CURSOR AND WRITES OUT ANY RECORDS            
      *     BASED ON THE INFORMATION FOUND.  WRITES OUT THE PROMO               
      *     ITEMS TO A TEMPORARY WORK STORAGE TABLE FOR PROCESSING              
      *     LATER.                                                              
      *----------------------------------------------------------               
       2100-PROCESS-AD-PMITM-CSR.                                               
                                                                                
           MOVE 01       TO PV-ADV-IND.                                         
           MOVE ZEROES   TO PV-TEMP1-NULL                                       
                            PV-TEMP2-NULL                                       
                            PV-COL-3                                            
                            PV-COL-4                                            
                            PV-COL-5                                            
                            PV-COL-6.                                           
           MOVE -1       TO PV-TEMP3-NULL                                       
                            PV-TEMP4-NULL                                       
                            PV-TEMP5-NULL                                       
                            PV-TEMP6-NULL                                       
                            PV-TEMP-TXT-NULL.                                   
           MOVE SPACES   TO PV-COL-TXT.                                         
           PERFORM 2300-INSERT-INTO-TABLE.                                      
                                                                                
           MOVE ZEROES TO PV-PROMO-ITM-ID.                                      
KBLFIX     MOVE ZEROES TO PV-PROMO-ITM-ID-SAVED.                                
           PERFORM 2120-FETCH-AD-PMITM-CSR.                                     
                                                                                
      *2100-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2110-OPEN-AD-PMITM-CSR.                                                 
      *     OPENS THE ADVERTISED PROMO ITEM CURSOR.                             
      *----------------------------------------------------------               
       2110-OPEN-AD-PMITM-CSR.                                                  
                                                                                
           EXEC SQL                                                             
                 OPEN ADPMITMCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-ADPMITM-CSR    TO TRUE                    
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '2110-OPEN-AD-PMITM-CSR '                              
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON ADPMITMCSR'                             
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2110-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2120-FETCH-AD-PMITM-CSR.                                                
      *     FETCHES THE ADVERTISED PROMO ITEM CURSOR.                           
      *----------------------------------------------------------               
       2120-FETCH-AD-PMITM-CSR.                                                 
                                                                                
           EXEC SQL                                                             
               FETCH ADPMITMCSR                                                 
                INTO  :PV-PROMO-ITM-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-ADPMITM-CSR TO TRUE                           
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '2120-FETCH-AD-PMITM-CSR'                              
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON ADPMITMCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2120-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2130-CLOSE-AD-PMITM-CSR.                                                
      *     CLOSES THE ADVERTISED PROMO ITEM CURSOR.                            
      *----------------------------------------------------------               
       2130-CLOSE-AD-PMITM-CSR.                                                 
                                                                                
           EXEC SQL                                                             
                CLOSE ADPMITMCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '2130-CLOSE-AD-PMITM-CSR'                              
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON ADPMITMCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2130-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2200-PROCESS-UNAD-PMITM-CSR.                                            
      *     FETCHES THE PROMO ITEM CURSOR AND WRITES OUT ANY RECORDS            
      *     BASED ON THE INFORMATION FOUND.  WRITES OUT THE PROMO               
      *     ITEMS TO A TEMPORARY WORK STORAGE TABLE FOR PROCESSING              
      *     LATER.                                                              
      *----------------------------------------------------------               
       2200-PROCESS-UNAD-PMITM-CSR.                                             
                                                                                
           MOVE 00       TO PV-ADV-IND.                                         
           MOVE ZEROES   TO PV-TEMP1-NULL                                       
                            PV-TEMP2-NULL                                       
                            PV-COL-3                                            
                            PV-COL-4                                            
                            PV-COL-5                                            
                            PV-COL-6.                                           
           MOVE -1       TO PV-TEMP3-NULL                                       
                            PV-TEMP4-NULL                                       
                            PV-TEMP5-NULL                                       
                            PV-TEMP6-NULL                                       
                            PV-TEMP-TXT-NULL.                                   
           MOVE SPACES   TO PV-COL-TXT.                                         
                                                                                
           PERFORM 2300-INSERT-INTO-TABLE.                                      
                                                                                
           MOVE ZEROES TO PV-PROMO-ITM-ID.                                      
           PERFORM 2220-FETCH-UNAD-PMITM-CSR.                                   
                                                                                
      *2200-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2210-OPEN-UNAD-PMITM-CSR.                                               
      *     OPENS THE UADVERTISED PROMO ITEM CURSOR.                            
      *----------------------------------------------------------               
       2210-OPEN-UNAD-PMITM-CSR.                                                
                                                                                
           EXEC SQL                                                             
                 OPEN UNADPMITMCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-UNADPMITM-CSR TO TRUE                     
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '2210-OPEN-UNAD-PMITM-CSR '                            
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON UNADPMITMCSR'                           
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2210-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2220-FETCH-UNAD-PMITM-CSR.                                              
      *     FETCHES THE UNADVERTISED PROMO ITEM CURSOR.                         
      *----------------------------------------------------------               
       2220-FETCH-UNAD-PMITM-CSR.                                               
                                                                                
           EXEC SQL                                                             
               FETCH UNADPMITMCSR                                               
                INTO  :PV-PROMO-ITM-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-UNADPMITM-CSR TO TRUE                         
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '2220-FETCH-UNAD-PMITM-CSR'                            
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON UNADPMITMCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2220-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 2230-CLOSE-UNAD-PMITM-CSR.                                              
      *     CLOSE THE UNADVERTISED PROMO ITEM CURSOR.                           
      *----------------------------------------------------------               
       2230-CLOSE-UNAD-PMITM-CSR.                                               
                                                                                
           EXEC SQL                                                             
                CLOSE UNADPMITMCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '2230-CLOSE-UNAD-PMITM-CSR'                            
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON UNADPMITMCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2230-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *-----------------------------------------------------------              
      * 2300-INSERT-INTO-TABLE.                                                 
      *     INSERTS THE PROMO ITEM ID INTO A TEMPORARY WORK                     
      *     STORAGE TABLE.                                                      
      *     ALSO INSERTS AN ADVERTISED INDICATOR.                               
      *  - 0 = SUCCESSFUL                                                       
      *  - 0001 = UNIQUE CONSTRAINT VIOLATED. ROW ALREADY EXISTS.               
      *-----------------------------------------------------------              
       2300-INSERT-INTO-TABLE.                                                  
                                                                                
           EXEC SQL                                                             
               INSERT INTO PMTT_CRSR_WRK_TBL                                    
                   (COL1_NBR                                                    
                   ,COL2_NBR                                                    
                   ,COL3_NBR                                                    
                   ,COL4_NBR                                                    
                   ,COL5_NBR                                                    
                   ,COL6_NBR                                                    
                   ,COL_VAR_TXT)                                                
               VALUES                                                           
                   (:PV-PROMO-ITM-ID :PV-TEMP1-NULL                             
                   ,:PV-ADV-IND      :PV-TEMP2-NULL                             
                   ,:PV-COL-3        :PV-TEMP3-NULL                             
                   ,:PV-COL-4        :PV-TEMP4-NULL                             
                   ,:PV-COL-5        :PV-TEMP5-NULL                             
                   ,:PV-COL-6        :PV-TEMP6-NULL                             
                   ,:PV-COL-TXT      :PV-TEMP-TXT-NULL)                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    ADD +1     TO PA-INSERT-CNT                                 
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '2300-INSERT-INTO-TABLE'                               
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'INSERT ERROR ON PROMO ITEM ID'                        
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *2300-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 3000-PROCESS-PRICING-CSRS.                                              
      *     FETCHES THE PROMO ITEM TEMP CURSORS AND WRITES OUT ANY              
      *     RECORDS BASED ON THE INFORMATION FOUND.  SELECTS ANY                
      *     ADDITIONAL INFORMATION NEEDED TO WRITE OUT THE RECORDS.             
      *----------------------------------------------------------               
       3000-PROCESS-PRICING-CSRS.                                               
                                                                                
           PERFORM 4010-OPEN-AD-PMITM-TEMP-CSR.                                 
           PERFORM 4020-FETCH-AD-PMITM-TEMP-CSR.                                
           PERFORM 4000-PROCESS-AD-PMITM-TEMP-CSR                               
                   UNTIL PS-END-OF-ADPMITM-CSR.                                 
           PERFORM 4030-CLOSE-AD-PMITM-TEMP-CSR.                                
                                                                                
           MOVE ZEROES           TO PV-SAVE-MDSE-PRICG-ID                       
                                    PV-SAVE-MDSE-SELN-ID.                       
                                                                                
           PERFORM 4210-OPEN-UNADITM-TEMP-CSR.                                  
           PERFORM 4220-FETCH-UNADITM-TEMP-CSR.                                 
           PERFORM 4200-PROCESS-UNADITM-TEMP-CSR                                
                   UNTIL PS-END-OF-UNADPMITM-CSR.                               
           PERFORM 4230-CLOSE-UNADITM-TEMP-CSR.                                 
                                                                                
      *3000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4000-PROCESS-AD-PMITM-TEMP-CSR.                                         
      *     FETCHES THE ADVERTISED PRICING CURSOR. SELECTS ANY                  
      *     ADDITIONAL INFORMATION NEEDED TO WRITE OUT THE RECORDS.             
      *----------------------------------------------------------               
       4000-PROCESS-AD-PMITM-TEMP-CSR.                                          
                                                                                
           PERFORM 4110-OPEN-AD-PRICG-CSR.                                      
           PERFORM 4120-FETCH-AD-PRICG-CSR.                                     
           PERFORM 4100-PROCESS-AD-PRICG-CSR                                    
                   UNTIL PS-END-OF-ADPRCG-CSR.                                  
           PERFORM 4130-CLOSE-AD-PRICG-CSR.                                     
                                                                                
           PERFORM 4020-FETCH-AD-PMITM-TEMP-CSR.                                
                                                                                
      *4000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4010-OPEN-AD-PMITM-TEMP-CSR.                                            
      *     OPENS THE ADVERTISED PROMO ITEM TEMP CURSOR.                        
      *----------------------------------------------------------               
       4010-OPEN-AD-PMITM-TEMP-CSR.                                             
                                                                                
           EXEC SQL                                                             
                 OPEN ADPMTMPCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-ADPMITM-CSR TO TRUE                       
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '4010-OPEN-AD-PMITM-TEMP-CSR'                          
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON ADPMTMPCSR'                             
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4010-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4020-FETCH-AD-PMITM-TEMP-CSR.                                           
      *     FETCHES THE ADVERTISED PROMO ITEM TEMP CURSOR.                      
      *----------------------------------------------------------               
       4020-FETCH-AD-PMITM-TEMP-CSR.                                            
                                                                                
           EXEC SQL                                                             
               FETCH ADPMTMPCSR                                                 
                INTO  :PV-PROMO-ITM-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    ADD 1 TO PA-PMITM-CNT                                       
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-ADPMITM-CSR TO TRUE                           
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4020-FETCH-AD-PMITM-TEMP-CSR'                         
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON ADPMTMPCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4020-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4030-CLOSE-AD-PMITM-TEMP-CSR.                                           
      *     CLOSE THE ADVERTISED PROMO ITEM TEMP CURSOR.                        
      *----------------------------------------------------------               
       4030-CLOSE-AD-PMITM-TEMP-CSR.                                            
                                                                                
           EXEC SQL                                                             
                CLOSE ADPMTMPCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4030-CLOSE-AD-PMITM-TEMP-CSR'                         
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON ADPMTMPCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4030-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4100-PROCESS-AD-PRICG-CSR.                                              
      *     FETCHES THE PRICING INFORMATION AND WRITES OUT ANY RECORDS          
      *     BASED ON THE INFORMATION FOUND.  SELECTS ANY ADDITIONAL             
      *     INFORMATION NEEDED TO WRITE OUT THE RECORDS.                        
      *----------------------------------------------------------               
       4100-PROCESS-AD-PRICG-CSR.                                               
                                                                                
           IF PV-MDSE-LNE-PRICG-ID NOT = PV-SAVE-MDSE-PRICG-ID                  
              MOVE SPACES               TO PV-GP-PRICG-TYP-CDE                  
              MOVE ZEROES               TO PV-GROUP-QTY                         
                                           PV-GROUP-AMT                         
                                           PV-GROUP-PCT                         
                                           PV-GP-PROMO-INTFC-ID                 
              PERFORM 4400-SELECT-GROUP-PRICG                                   
              MOVE PV-MDSE-LNE-PRICG-ID TO PV-SAVE-MDSE-PRICG-ID                
           END-IF.                                                              
                                                                                
           IF PV-PRICG-TYP-NULL < 0                                             
              MOVE PV-GP-PRICG-TYP-CDE   TO PV-PRICG-TYP-CDE                    
              MOVE PV-GP-PROMO-INTFC-ID  TO PV-PROMO-INTFC-ID                   
              SET PS-JUST-GP-PRC         TO TRUE                                
           ELSE                                                                 
              IF PS-GP-PRC-AVAIL                                                
                 SET PS-SMP-GP-PRC       TO TRUE                                
              ELSE                                                              
                 SET PS-JUST-SMP-PRC     TO TRUE                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 7000-POPULATE-PROMO-ITM-REC.                                 
           PERFORM 5000-PROCESS-STORE-INFO.                                     
                                                                                
           IF PV-MDSE-SELN-LNE-ID NOT = PV-SAVE-MDSE-SELN-ID                    
              PERFORM 6010-OPEN-EXCL-CSR                                        
              PERFORM 6020-FETCH-EXCL-CSR                                       
              PERFORM 6000-PROCESS-EXCL-CSR                                     
                      UNTIL PS-END-OF-EXCL-CSR                                  
              PERFORM 6030-CLOSE-EXCL-CSR                                       
              MOVE PV-MDSE-SELN-LNE-ID TO PV-SAVE-MDSE-SELN-ID                  
           END-IF.                                                              
                                                                                
           INITIALIZE PV-SELECT-VARIABLES.                                      
           PERFORM 4120-FETCH-AD-PRICG-CSR.                                     
                                                                                
      *4100-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4110-OPEN-AD-PRICG-CSR.                                                 
      *     OPENS THE ADVERTISED PRICING CURSOR.                                
      *----------------------------------------------------------               
       4110-OPEN-AD-PRICG-CSR.                                                  
                                                                                
           EXEC SQL                                                             
                 OPEN ADPRICGCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-ADPRCG-CSR    TO TRUE                     
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '4110-OPEN-AD-PRICG-CSR'                               
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON ADPRICGCSR'                             
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4110-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4120-FETCH-AD-PRICG-CSR.                                                
      *     FETCHES THE ADVERTISED PRICING CURSOR.                              
      *----------------------------------------------------------               
       4120-FETCH-AD-PRICG-CSR.                                                 
                                                                                
           EXEC SQL                                                             
               FETCH ADPRICGCSR                                                 
                 INTO :PV-PROMO-ID                                              
                     ,:PV-AD-EVNT-ID                                            
                     ,:PV-PROMO-STRT-TMST                                       
                     ,:PV-PROMO-DEPT-NBR                                        
                     ,:PV-MDSE-SELN-ID                                          
                     ,:PV-MDSE-HIER-CDE                                         
                     ,:PV-MDSE-SELN-LNE-ID                                      
                     ,:PV-DEPT-NBR   :PV-DEPT-NULL                              
                     ,:PV-MAJ-CL-NBR :PV-MAJ-CL-NULL                            
                     ,:PV-SUB-CL-NBR :PV-SUB-CL-NULL                            
                     ,:PV-VS-ID      :PV-STYLE-NULL                             
                     ,:PV-SKU-NBR    :PV-SKU-NBR-NULL                           
                     ,:PV-MDSE-LNE-PRICG-ID                                     
                     ,:PV-PRICG-TYP-CDE :PV-PRICG-TYP-NULL                      
                     ,:PV-PRICG-AMT     :PV-PRICG-AMT-NULL                      
                     ,:PV-PROMO-INTFC-ID :PV-INTFC-NULL                         
                     ,:PV-PRCG-STRT-TMST                                        
                     ,:PV-PRCG-END-TMST                                         
                     ,:PV-EFF-STR-GP-ID  :PV-EFF-STR-NULL                       
                     ,:PV-STR-SELN-TYP-CDE                                      
                     ,:PV-ADHC-STR-GP-ID :PV-ADHC-STR-NULL                      
                     ,:PV-AD-EVNT-NM                                            
                     ,:PV-PROMO-NM                                              
                     ,:PV-PROMO-ABBR-NM                                         
                     ,:PV-PROMO-ITM-DESC                                        
                     ,:PV-MDSE-SELN-DESC                                        
           END-EXEC.                                                            
                                                                                
                                                                                
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    ADD 1 TO PA-MERCH-CNT                                       
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-ADPRCG-CSR TO TRUE                            
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID = ' PV-PROMO-ITM-ID                
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4120-FETCH-AD-PRICG-CSR'                              
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON ADPRICGCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4120-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4130-CLOSE-AD-PRICG-CSR.                                                
      *     CLOSE THE ADVERTISED PRICING CURSOR.                                
      *----------------------------------------------------------               
       4130-CLOSE-AD-PRICG-CSR.                                                 
                                                                                
           EXEC SQL                                                             
                CLOSE ADPRICGCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4130-CLOSE-AD-PRICG-CSR'                              
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON ADPRICGCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4130-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4200-PROCESS-UNADITM-TEMP-CSR.                                          
      *     FETCHES THE UNADVERTISED PROMO ITEM TEMP CURSOR.                    
      *----------------------------------------------------------               
       4200-PROCESS-UNADITM-TEMP-CSR.                                           
                                                                                
           PERFORM 4310-OPEN-UNAD-PRICG-CSR.                                    
           PERFORM 4320-FETCH-UNAD-PRICG-CSR.                                   
           PERFORM 4300-PROCESS-UNAD-PRICG-CSR                                  
                   UNTIL PS-END-OF-UNADPRCG-CSR.                                
           PERFORM 4330-CLOSE-UNAD-PRICG-CSR.                                   
                                                                                
           PERFORM 4220-FETCH-UNADITM-TEMP-CSR.                                 
                                                                                
      *4200-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4210-OPEN-UNADITM-TEMP-CSR.                                             
      *     OPENS THE UADVERTISED PROMO ITEM TEMP CURSOR.                       
      *----------------------------------------------------------               
       4210-OPEN-UNADITM-TEMP-CSR.                                              
                                                                                
           EXEC SQL                                                             
                 OPEN UNADPMTMPCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-UNADPMITM-CSR TO TRUE                     
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '4210-OPEN-UNADITM-TEMP-CSR'                           
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON UNADPMTMPCSR'                           
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4210-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4220-FETCH-UNADITM-TEMP-CSR.                                            
      *     FETCHES THE UNADVERTISED PROMO ITEM TEMP CURSOR.                    
      *----------------------------------------------------------               
       4220-FETCH-UNADITM-TEMP-CSR.                                             
                                                                                
           EXEC SQL                                                             
               FETCH UNADPMTMPCSR                                               
                INTO  :PV-PROMO-ITM-ID                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    ADD 1 TO PA-PMITM-CNT                                       
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-UNADPMITM-CSR TO TRUE                         
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID = ' PV-PROMO-ITM-ID                
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4220-FETCH-UNADITM-TEMP-CSR'                          
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON UNADPMTMPCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4220-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4230-CLOSE-UNADITM-TEMP-CSR.                                            
      *     CLOSE THE UNADVERTISED PROMO ITEM TEMP CURSOR.                      
      *----------------------------------------------------------               
       4230-CLOSE-UNADITM-TEMP-CSR.                                             
                                                                                
           EXEC SQL                                                             
                CLOSE UNADPMTMPCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4230-CLOSE-UNADITM-TEMP-CSR'                          
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON UNADPMTMPCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4230-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4300-PROCESS-UNAD-PRICG-CSR.                                            
      *     FETCHES THE UNADVERTISED PRICING CURSOR AND WRITES OUT              
      *     RECORDS BASED ON THE INFORMATION FOUND.  SELECTS ANY                
      *     ADDITIONAL INFORMATION NEEDED TO WRITE OUT THE RECORDS.             
      *----------------------------------------------------------               
       4300-PROCESS-UNAD-PRICG-CSR.                                             
                                                                                
           IF PV-MDSE-LNE-PRICG-ID NOT = PV-SAVE-MDSE-PRICG-ID                  
              MOVE SPACES                TO PV-GP-PRICG-TYP-CDE                 
              MOVE ZEROES                TO PV-GROUP-QTY                        
                                            PV-GROUP-AMT                        
                                            PV-GROUP-PCT                        
                                            PV-GP-PROMO-INTFC-ID                
              PERFORM 4400-SELECT-GROUP-PRICG                                   
              MOVE PV-MDSE-LNE-PRICG-ID TO PV-SAVE-MDSE-PRICG-ID                
           END-IF.                                                              
                                                                                
           IF PV-PRICG-TYP-NULL < 0                                             
              MOVE PV-GP-PRICG-TYP-CDE   TO PV-PRICG-TYP-CDE                    
              MOVE PV-GP-PROMO-INTFC-ID  TO PV-PROMO-INTFC-ID                   
              SET PS-JUST-GP-PRC         TO TRUE                                
           ELSE                                                                 
              IF PS-GP-PRC-AVAIL                                                
                 SET PS-SMP-GP-PRC       TO TRUE                                
              ELSE                                                              
                 SET PS-JUST-SMP-PRC     TO TRUE                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 7000-POPULATE-PROMO-ITM-REC.                                 
           PERFORM 5000-PROCESS-STORE-INFO.                                     
                                                                                
           IF PV-MDSE-SELN-LNE-ID NOT = PV-SAVE-MDSE-SELN-ID                    
              PERFORM 6010-OPEN-EXCL-CSR                                        
              PERFORM 6020-FETCH-EXCL-CSR                                       
              PERFORM 6000-PROCESS-EXCL-CSR                                     
                      UNTIL PS-END-OF-EXCL-CSR                                  
              PERFORM 6030-CLOSE-EXCL-CSR                                       
              MOVE PV-MDSE-SELN-LNE-ID TO PV-SAVE-MDSE-SELN-ID                  
           END-IF.                                                              
                                                                                
           INITIALIZE PV-SELECT-VARIABLES.                                      
           PERFORM 4320-FETCH-UNAD-PRICG-CSR.                                   
                                                                                
      *4300-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4310-OPEN-UNAD-PRICG-CSR.                                               
      *     OPENS THE UADVERTISED PRICING CURSOR.                               
      *----------------------------------------------------------               
       4310-OPEN-UNAD-PRICG-CSR.                                                
                                                                                
           EXEC SQL                                                             
                 OPEN UNADPRICGCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-UNADPRCG-CSR TO TRUE                      
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '4310-OPEN-UNAD-PRICING-CSR '                          
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON UNADPRICGCSR'                           
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4310-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4320-FETCH-UNAD-PRICG-CSR.                                              
      *     FETCHES THE UNADVERTISED PRICING CURSOR.                            
      *----------------------------------------------------------               
       4320-FETCH-UNAD-PRICG-CSR.                                               
                                                                                
           EXEC SQL                                                             
               FETCH UNADPRICGCSR                                               
                 INTO :PV-PROMO-ID                                              
                     ,:PV-AD-EVNT-ID                                            
                     ,:PV-PROMO-STRT-TMST                                       
                     ,:PV-PROMO-DEPT-NBR                                        
                     ,:PV-MDSE-SELN-ID                                          
                     ,:PV-MDSE-HIER-CDE                                         
                     ,:PV-MDSE-SELN-LNE-ID                                      
                     ,:PV-DEPT-NBR   :PV-DEPT-NULL                              
                     ,:PV-MAJ-CL-NBR :PV-MAJ-CL-NULL                            
                     ,:PV-SUB-CL-NBR :PV-SUB-CL-NULL                            
                     ,:PV-VS-ID      :PV-STYLE-NULL                             
                     ,:PV-SKU-NBR    :PV-SKU-NBR-NULL                           
                     ,:PV-MDSE-LNE-PRICG-ID                                     
                     ,:PV-PRICG-TYP-CDE :PV-PRICG-TYP-NULL                      
                     ,:PV-PRICG-AMT     :PV-PRICG-AMT-NULL                      
                     ,:PV-PROMO-INTFC-ID :PV-INTFC-NULL                         
                     ,:PV-PRCG-STRT-TMST                                        
                     ,:PV-PRCG-END-TMST                                         
                     ,:PV-EFF-STR-GP-ID  :PV-EFF-STR-NULL                       
                     ,:PV-STR-SELN-TYP-CDE                                      
                     ,:PV-ADHC-STR-GP-ID :PV-ADHC-STR-NULL                      
                     ,:PV-AD-EVNT-NM                                            
                     ,:PV-PROMO-NM                                              
                     ,:PV-PROMO-ABBR-NM                                         
                     ,:PV-PROMO-ITM-DESC                                        
                     ,:PV-MDSE-SELN-DESC                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    ADD 1 TO PA-MERCH-CNT                                       
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-UNADPRCG-CSR TO TRUE                          
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID = ' PV-PROMO-ITM-ID                
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4320-FETCH-UNAD-PRICG-CSR'                            
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON UNADPRICGCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4320-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 4330-CLOSE-UNAD-PRICG-CSR.                                              
      *     CLOSE THE UNADVERTISED PRICING CURSOR.                              
      *----------------------------------------------------------               
       4330-CLOSE-UNAD-PRICG-CSR.                                               
                                                                                
           EXEC SQL                                                             
                CLOSE UNADPRICGCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '4330-CLOSE-UNAD-PRICG-CSR'                            
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON UNADPRICGCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *4330-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *-----------------------------------------------------------              
      * 4400-SELECT-GROUP-PRICG.                                                
      *     SELECTS THE GROUP PRICING INFORMATION FOR THIS                      
      *     ITEM.                                                               
      *-----------------------------------------------------------              
       4400-SELECT-GROUP-PRICG.                                                 
                                                                                
           EXEC SQL                                                             
                SELECT  B.PRICG_TYP_CDE                                         
                       ,B.GP_QTY                                                
                       ,B.GP_AMT                                                
                       ,B.GP_PCT                                                
                       ,B.GP_PROMO_INTFC_ID                                     
                  INTO  :PV-GP-PRICG-TYP-CDE                                    
                       ,:PV-GROUP-QTY :PV-GP-QTY-NULL                           
                       ,:PV-GROUP-AMT :PV-GP-AMT-NULL                           
                       ,:PV-GROUP-PCT :PV-GP-PCT-NULL                           
                       ,:PV-GP-PROMO-INTFC-ID :PV-GP-INTFC-NULL                 
                  FROM  PMT_MDSE_LNE_GP_PRIC A                                  
                       ,PMT_GP_PRIC B                                           
                 WHERE  A.MDSE_LNE_PRICG_ID = :PV-MDSE-LNE-PRICG-ID             
                   AND  A.GP_PRIC_ID        = B.GP_PRIC_ID                      
                   AND  A.STAT_CDE          = 'S'                               
                   AND  B.STAT_CDE          = 'S'                               
           END-EXEC.                                                            
                                                                                
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROES                                              
                  SET PS-GP-PRC-AVAIL TO TRUE                                   
             WHEN SQLCODE = 1403                                                
                  SET PS-NO-GP-PRC-AVAIL TO TRUE                                
                  MOVE ZEROES TO PV-GROUP-QTY                                   
                                 PV-GROUP-AMT                                   
                                 PV-GROUP-PCT                                   
                                 PV-GP-PROMO-INTFC-ID                           
                  MOVE SPACES TO PV-GP-PRICG-TYP-CDE                            
             WHEN OTHER                                                         
                  MOVE SQLCODE     TO PV-SQL-CODE                               
                  DISPLAY 'PV-PROMO-ITM-ID      = ' PV-PROMO-ITM-ID             
                  DISPLAY 'PV-MDSE-LNE-PRICG-ID = ' PV-MDSE-LNE-PRICG-ID        
                  SET ABEND-4013-SQL-ERROR TO TRUE                              
                  MOVE 'PMT_MDSE_LNE_GP_PRC' TO PV-TABLE-NAME                   
                  MOVE '4400-SELECT-GROUP-PRICG'                                
                                             TO PV-PARAGRAPH-NAME               
                  MOVE 'ERROR ON SELECT GROUP PRCG'                             
                                             TO PV-OPERATION-MSG                
                  PERFORM 9900-ORACLE-ABEND                                     
           END-EVALUATE.                                                        
                                                                                
      *4400-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5000-PROCESS-STORE-INFO.                                                
      *     PROCESS ALL THE RECORDS NEEDED FOR STORE GROUPS OR                  
      *     CERTAIN STORES.                                                     
      *----------------------------------------------------------               
       5000-PROCESS-STORE-INFO.                                                 
                                                                                
           IF PV-STR-SELN-TYP-CDE = 'P'                                         
              PERFORM 5110-OPEN-RMS-STRGP-CSR                                   
              PERFORM 5120-FETCH-RMS-STRGP-CSR                                  
              PERFORM 5100-PROCESS-RMS-STR-PRCG                                 
                      UNTIL PS-END-OF-STRGP-CSR                                 
              PERFORM 5130-CLOSE-RMS-STRGP-CSR                                  
           ELSE                                                                 
              IF PV-STR-SELN-TYP-CDE = 'A'                                      
                 PERFORM 5200-SELECT-REUSABLE-IND                               
                 IF PV-RUSBL-IND = 'Y'                                          
                    PERFORM 5310-OPEN-READHC-STR-CSR                            
                    PERFORM 5320-FETCH-READHC-STR-CSR                           
                    PERFORM 5300-PROCESS-READHC-STR-CSR                         
                            UNTIL PS-END-OF-READHC-CSR                          
                    PERFORM 5330-CLOSE-READHC-STR-CSR                           
                 ELSE                                                           
                    IF PV-RUSBL-IND = 'N'                                       
                       PERFORM 5410-OPEN-ADHC-STR-CSR                           
                       PERFORM 5420-FETCH-ADHC-STR-CSR                          
                       PERFORM 5400-PROCESS-ADHC-STR-CSR                        
                               UNTIL PS-END-OF-ADHCSTR-CSR                      
                       PERFORM 5430-CLOSE-ADHC-STR-CSR                          
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *5000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5100-PROCESS-RMS-STR-PRCG.                                              
      *     GETS ALL THE STORES INVOLVED IN RMS PRICING.                        
      *----------------------------------------------------------               
       5100-PROCESS-RMS-STR-PRCG.                                               
                                                                                
           MOVE PV-RMS-STR-NBR            TO PM124-STR-NBR.                     
           IF PS-SMP-GP-PRC                                                     
              MOVE ZEROES                 TO PM124-GROUP-QTY                    
              MOVE PV-PRICG-TYP-CDE       TO PM124-PRICG-TYP-CDE                
              MOVE PV-PRICG-AMT           TO PM124-PRICG-AMT                    
              MOVE PV-PROMO-INTFC-ID      TO PM124-PROMO-INTFC-ID               
           END-IF.                                                              
           PERFORM 9000-WRITE-PROMO-ITM-REC.                                    
                                                                                
           IF PS-SMP-GP-PRC                                                     
              IF PV-GP-PRICG-TYP-CDE = 'GBP'                                    
                  MOVE PV-GROUP-PCT        TO PM124-PRICG-AMT                   
              ELSE                                                              
                  MOVE PV-GROUP-AMT        TO PM124-PRICG-AMT                   
              END-IF                                                            
              MOVE PV-GROUP-QTY            TO PM124-GROUP-QTY                   
              MOVE PV-GP-PRICG-TYP-CDE     TO PM124-PRICG-TYP-CDE               
              MOVE PV-GP-PROMO-INTFC-ID    TO PM124-PROMO-INTFC-ID              
              PERFORM 9000-WRITE-PROMO-ITM-REC                                  
           END-IF.                                                              
                                                                                
           PERFORM 5120-FETCH-RMS-STRGP-CSR.                                    
                                                                                
      *5100-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5110-OPEN-RMS-STRGP-CSR.                                                
      *     OPENS THE RMS STORE CURSOR.                                         
      *----------------------------------------------------------               
       5110-OPEN-RMS-STRGP-CSR.                                                 
                                                                                
           EXEC SQL                                                             
                 OPEN RMSSTRGPCSR                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-STRGP-CSR TO TRUE                         
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '5110-OPEN-RMS-STRGP-CSR'                              
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON RMSSTRGPCSR'                            
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5110-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5120-FETCH-RMS-STRGP-CSR.                                               
      *     FETCHES THE RMS STORE CURSOR.                                       
      *----------------------------------------------------------               
       5120-FETCH-RMS-STRGP-CSR.                                                
                                                                                
           EXEC SQL                                                             
               FETCH RMSSTRGPCSR                                                
                INTO  :PV-RMS-STR-NBR                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-STRGP-CSR TO TRUE                             
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID  = ' PV-PROMO-ITM-ID               
                    DISPLAY 'PV-EFF-STR-GP-ID = ' PV-EFF-STR-GP-ID              
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '5120-FETCH-RMS-STRGP-CSR'                             
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON RMSSTRGPCSR'                           
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5120-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5130-CLOSE-RMS-STRGP-CSR.                                               
      *     CLOSE THE RMS STORE CURSOR.                                         
      *----------------------------------------------------------               
       5130-CLOSE-RMS-STRGP-CSR.                                                
                                                                                
           EXEC SQL                                                             
                CLOSE RMSSTRGPCSR                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '5130-CLOSE-RMS-STRGP-CSR'                             
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON RMSSTRGPCSR'                           
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5130-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *-----------------------------------------------------------              
      * 5200-SELECT-REUSABLE-IND.                                               
      *     SELECTS THE REUSABLE INDICATOR.                                     
      *-----------------------------------------------------------              
       5200-SELECT-REUSABLE-IND.                                                
                                                                                
           EXEC SQL                                                             
                SELECT  RUSBL_IND                                               
                  INTO  :PV-RUSBL-IND :PV-RUSBL-NULL                            
                  FROM  PMT_ADHC_STR_GP                                         
                 WHERE  ADHC_STR_GP_ID = :PV-ADHC-STR-GP-ID                     
                   AND  STAT_CDE       = 'S'                                    
           END-EXEC.                                                            
                                                                                
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROES                                              
                  IF PV-RUSBL-NULL < 0                                          
                     MOVE SPACES TO PV-RUSBL-IND                                
                  END-IF                                                        
             WHEN OTHER                                                         
                  DISPLAY 'PV-ADHC-STR-GP-ID   = ' PV-ADHC-STR-GP-ID            
                  DISPLAY 'PV-PROMO-ITM-ID     = ' PV-PROMO-ITM-ID              
                  DISPLAY 'PV-MDSE-SELN-LNE-ID = ' PV-MDSE-SELN-LNE-ID          
                  DISPLAY 'PV-PROMO-INTFC-ID   = ' PV-PROMO-INTFC-ID            
                  MOVE SQLCODE     TO PV-SQL-CODE                               
                  SET ABEND-4013-SQL-ERROR TO TRUE                              
                  MOVE 'PMT_ADHC_STR_GP' TO PV-TABLE-NAME                       
                  MOVE '5200-SELECT-REUSABLE-IND'                               
                                             TO PV-PARAGRAPH-NAME               
                  MOVE 'ERROR ON SELECT REUSE IND'                              
                                             TO PV-OPERATION-MSG                
                  PERFORM 9900-ORACLE-ABEND                                     
           END-EVALUATE.                                                        
                                                                                
      *5200-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5300-PROCESS-READHC-STR-CSR.                                            
      *     GETS ALL THE STORES INVOLVED IN REUSEABLE ADHOC STORE               
      *     PRICING.                                                            
      *----------------------------------------------------------               
       5300-PROCESS-READHC-STR-CSR.                                             
                                                                                
           MOVE PV-READHC-STR-NBR         TO PM124-STR-NBR.                     
           IF PS-SMP-GP-PRC                                                     
              MOVE ZEROES                 TO PM124-GROUP-QTY                    
              MOVE PV-PRICG-TYP-CDE       TO PM124-PRICG-TYP-CDE                
              MOVE PV-PRICG-AMT           TO PM124-PRICG-AMT                    
              MOVE PV-PROMO-INTFC-ID      TO PM124-PROMO-INTFC-ID               
           END-IF.                                                              
           PERFORM 9000-WRITE-PROMO-ITM-REC.                                    
                                                                                
           IF PS-SMP-GP-PRC                                                     
              IF PV-GP-PRICG-TYP-CDE = 'GBP'                                    
                  MOVE PV-GROUP-PCT        TO PM124-PRICG-AMT                   
              ELSE                                                              
                  MOVE PV-GROUP-AMT        TO PM124-PRICG-AMT                   
              END-IF                                                            
              MOVE PV-GROUP-QTY            TO PM124-GROUP-QTY                   
              MOVE PV-GP-PRICG-TYP-CDE     TO PM124-PRICG-TYP-CDE               
              MOVE PV-GP-PROMO-INTFC-ID    TO PM124-PROMO-INTFC-ID              
              PERFORM 9000-WRITE-PROMO-ITM-REC                                  
           END-IF.                                                              
           PERFORM 5320-FETCH-READHC-STR-CSR.                                   
                                                                                
      *5300-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5310-OPEN-READHC-STR-CSR.                                               
      *     OPENS THE REUSEABLE ADHOC STORE CURSOR.                             
      *----------------------------------------------------------               
       5310-OPEN-READHC-STR-CSR.                                                
                                                                                
           EXEC SQL                                                             
                 OPEN READHCSTRCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-READHC-CSR TO TRUE                        
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '5310-OPEN-READHC-STR-CSR'                             
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON READHCSTRCSR'                           
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5310-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5320-FETCH-READHC-STR-CSR.                                              
      *     FETCHES THE REUSEABLE ADHOC STORE CURSOR.                           
      *----------------------------------------------------------               
       5320-FETCH-READHC-STR-CSR.                                               
                                                                                
           EXEC SQL                                                             
               FETCH READHCSTRCSR                                               
                INTO  :PV-READHC-STR-NBR                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-READHC-CSR TO TRUE                            
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID   = ' PV-PROMO-ITM-ID              
                    DISPLAY 'PV-ADHC-STR-GP-ID = ' PV-ADHC-STR-GP-ID            
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '5320-FETCH-READHC-STR-CSR'                            
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON READHCSTRCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5320-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5330-CLOSE-READHC-STR-CSR.                                              
      *     CLOSE THE REUSEABLE ADHOC STORE CURSOR.                             
      *----------------------------------------------------------               
       5330-CLOSE-READHC-STR-CSR.                                               
                                                                                
           EXEC SQL                                                             
                CLOSE READHCSTRCSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '5330-CLOSE-READHC-STR-CSR'                            
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON READHCSTRCSR'                          
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5330-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5400-PROCESS-ADHC-STR-CSR.                                              
      *     GETS ALL THE STORES INVOLVED IN ADHOC STORE PRICING.                
      *----------------------------------------------------------               
       5400-PROCESS-ADHC-STR-CSR.                                               
                                                                                
           MOVE PV-ADHC-STR-NBR           TO PM124-STR-NBR.                     
           IF PS-SMP-GP-PRC                                                     
              MOVE ZEROES                 TO PM124-GROUP-QTY                    
              MOVE PV-PRICG-TYP-CDE       TO PM124-PRICG-TYP-CDE                
              MOVE PV-PRICG-AMT           TO PM124-PRICG-AMT                    
              MOVE PV-PROMO-INTFC-ID      TO PM124-PROMO-INTFC-ID               
           END-IF.                                                              
           PERFORM 9000-WRITE-PROMO-ITM-REC.                                    
                                                                                
           IF PS-SMP-GP-PRC                                                     
              IF PV-GP-PRICG-TYP-CDE = 'GBP'                                    
                  MOVE PV-GROUP-PCT        TO PM124-PRICG-AMT                   
              ELSE                                                              
                  MOVE PV-GROUP-AMT        TO PM124-PRICG-AMT                   
              END-IF                                                            
              MOVE PV-GROUP-QTY            TO PM124-GROUP-QTY                   
              MOVE PV-GP-PRICG-TYP-CDE     TO PM124-PRICG-TYP-CDE               
              MOVE PV-GP-PROMO-INTFC-ID    TO PM124-PROMO-INTFC-ID              
              PERFORM 9000-WRITE-PROMO-ITM-REC                                  
           END-IF.                                                              
                                                                                
           PERFORM 5420-FETCH-ADHC-STR-CSR.                                     
                                                                                
      *5400-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5410-OPEN-ADHC-STR-CSR.                                                 
      *     OPENS THE ADHOC STORE CURSOR.                                       
      *----------------------------------------------------------               
       5410-OPEN-ADHC-STR-CSR.                                                  
                                                                                
           EXEC SQL                                                             
                 OPEN ADHCSTRCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-ADHCSTR-CSR TO TRUE                       
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '5410-OPEN-ADHC-STR-CSR'                               
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON ADHCSTRCSR'                             
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5410-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5420-FETCH-ADHC-STR-CSR.                                                
      *     FETCHES THE ADHOC STORE CURSOR.                                     
      *----------------------------------------------------------               
       5420-FETCH-ADHC-STR-CSR.                                                 
                                                                                
           EXEC SQL                                                             
               FETCH ADHCSTRCSR                                                 
                INTO  :PV-ADHC-STR-NBR                                          
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-ADHCSTR-CSR TO TRUE                           
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID = ' PV-PROMO-ITM-ID                
                    DISPLAY 'PV-ADHC-STR-GP-ID = ' PV-ADHC-STR-GP-ID            
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '5420-FETCH-ADHC-STR-CSR'                              
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON ADHCSTRCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5420-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 5430-CLOSE-ADHC-STR-CSR.                                                
      *     CLOSE THE ADHOC STORE CURSOR.                                       
      *----------------------------------------------------------               
       5430-CLOSE-ADHC-STR-CSR.                                                 
                                                                                
           EXEC SQL                                                             
                CLOSE ADHCSTRCSR                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '5430-CLOSE-ADHC-STR-CSR'                              
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON ADHCSTRCSR'                            
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *5430-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 6000-PROCESS-EXCL-CSR.                                                  
      *     FETCHES THE EXCLUSION CURSOR AND WRITES OUT ANY RECORDS             
      *     BASED ON THE INFORMATION FOUND.                                     
      *----------------------------------------------------------               
       6000-PROCESS-EXCL-CSR.                                                   
                                                                                
           PERFORM 7100-POPULATE-EXCLUSION-REC.                                 
           IF PS-SMP-GP-PRC                                                     
              MOVE PV-PROMO-INTFC-ID       TO PM124-PROMO-INTFC-ID              
           END-IF.                                                              
           PERFORM 9000-WRITE-PROMO-ITM-REC.                                    
                                                                                
           IF PS-SMP-GP-PRC                                                     
              MOVE PV-GP-PROMO-INTFC-ID    TO PM124-PROMO-INTFC-ID              
              PERFORM 9000-WRITE-PROMO-ITM-REC                                  
           END-IF.                                                              
                                                                                
           MOVE ZEROES                  TO PV-MAJ-CL-NBR                        
                                           PV-SUB-CL-NBR                        
                                           PV-VS-ID                             
                                           PV-SKU-NBR.                          
           MOVE SPACES                  TO PV-MDSE-HIER-CDE.                    
                                                                                
           PERFORM 6020-FETCH-EXCL-CSR.                                         
                                                                                
      *6000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 6010-OPEN-EXCL-CSR.                                                     
      *     OPENS THE EXCLUSION CURSOR.                                         
      *----------------------------------------------------------               
       6010-OPEN-EXCL-CSR.                                                      
                                                                                
           EXEC SQL                                                             
                 OPEN EXCLCSR                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZEROES                                            
                    SET PS-NOT-END-OF-EXCL-CSR TO TRUE                          
               WHEN OTHER                                                       
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE SQLCODE             TO PV-SQL-CODE                     
                    MOVE '6010-OPEN-EXCL-CSR'                                   
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'OPEN ERROR ON EXCLCSR'                                
                                      TO PV-OPERATION-MSG                       
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *6010-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 6020-FETCH-EXCL-CSR.                                                    
      *     FETCHES THE EXCLUSION CURSOR.                                       
      *----------------------------------------------------------               
       6020-FETCH-EXCL-CSR.                                                     
                                                                                
           EXEC SQL                                                             
               FETCH EXCLCSR                                                    
                INTO  :PV-MDSE-LNE-EXCLN-ID                                     
                     ,:PV-MAJ-CL-NBR :PV-MAJ-CL-NULL                            
                     ,:PV-MDSE-HIER-CDE :PV-MDSE-HIER-NULL                      
                     ,:PV-SUB-CL-NBR :PV-SUB-CL-NULL                            
                     ,:PV-VS-ID :PV-STYLE-NULL                                  
                     ,:PV-SKU-NBR :PV-SKU-NBR-NULL                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    ADD 1 TO PA-EXCL-CNT                                        
               WHEN SQLCODE = 1403                                              
                    SET PS-END-OF-EXCL-CSR TO TRUE                              
               WHEN OTHER                                                       
                    MOVE SQLCODE      TO PV-SQL-CODE                            
                    DISPLAY 'PV-PROMO-ITM-ID     = ' PV-PROMO-ITM-ID            
                    DISPLAY 'PV-MDSE-SELN-LNE-ID = ' PV-MDSE-SELN-LNE-ID        
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '3020-FETCH-EXCL-CSR'                                  
                                      TO PV-PARAGRAPH-NAME                      
                    MOVE 'FETCH ERROR ON EXCLCSR'                               
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *6020-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 6030-CLOSE-EXCL-CSR.                                                    
      *     CLOSE THE EXCLUSION CURSOR.                                         
      *----------------------------------------------------------               
       6030-CLOSE-EXCL-CSR.                                                     
                                                                                
           EXEC SQL                                                             
                CLOSE EXCLCSR                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SQLCODE     TO PV-SQL-CODE                             
                    SET ABEND-4013-SQL-ERROR TO TRUE                            
                    MOVE '6030-CLOSE-EXCL-CSR'                                  
                                     TO PV-PARAGRAPH-NAME                       
                    MOVE 'CLOSE ERROR ON EXCLCSR'                               
                                     TO PV-OPERATION-MSG                        
                    PERFORM 9900-ORACLE-ABEND                                   
           END-EVALUATE.                                                        
                                                                                
      *6030-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 7000-POPULATE-PROMO-ITM-REC.                                            
      *     POPULATES THE PRICING RECORD.                                       
      *----------------------------------------------------------               
       7000-POPULATE-PROMO-ITM-REC.                                             
                                                                                
KBLFIX     IF PV-PROMO-ITM-ID NOT EQUAL PV-PROMO-ITM-ID-SAVED                   
              PERFORM 7200-SELECT-PAGE-NBR                                      
              DISPLAY 'PV-PROMO-ITM-ID   = ' PV-PROMO-ITM-ID                    
              DISPLAY 'PV-PROMO-ID       = ' PV-PROMO-ID                        
              DISPLAY 'PV-PRCG-STRT-TMST = ' PV-PRCG-STRT-TMST                  
              DISPLAY 'PV-PRCG-END-TMST  = ' PV-PRCG-END-TMST                   
              DISPLAY '*****************************************'               
KBLFIX     END-IF.                                                              
                                                                                
           INITIALIZE PM124-EXCPT-PRCG-EXT.                                     
           MOVE 1                        TO PM124-REC-TYP-CDE.                  
           MOVE PV-AD-EVNT-ID            TO PM124-AD-EVNT-ID.                   
           MOVE PV-MDSE-HIER-CDE         TO PM124-MDSE-HIER-CDE.                
           MOVE PV-PROMO-ID              TO PM124-PROMO-ID.                     
           MOVE PV-PROMO-ITM-ID          TO PM124-PROMO-ITM-ID                  
KBLFIX                                      PV-PROMO-ITM-ID-SAVED.              
           MOVE PV-MDSE-SELN-ID          TO PM124-MDSE-SELN-ID.                 
           MOVE PV-MDSE-SELN-LNE-ID      TO PM124-MDSE-SELN-LNE-ID.             
           MOVE PV-PROMO-DEPT-NBR        TO PM124-DEPT-NBR.                     
           MOVE PV-MAJ-CL-NBR            TO PM124-MAJ-CL-NBR.                   
           MOVE PV-SUB-CL-NBR            TO PM124-SUB-CL-NBR.                   
           MOVE PV-VS-ID                 TO PM124-VS-ID.                        
           MOVE PV-SKU-NBR               TO PM124-SKU-NBR.                      
           MOVE PV-PRICG-TYP-CDE         TO PM124-PRICG-TYP-CDE.                
           MOVE PV-PRCG-STRT-TMST        TO PM124-STRT-TMST.                    
           MOVE PV-PRCG-END-TMST         TO PM124-END-TMST.                     
           MOVE PV-PROMO-INTFC-ID        TO PM124-PROMO-INTFC-ID.               
           MOVE PV-AD-EVNT-NM            TO PM124-AD-EVNT-NM.                   
           MOVE PV-PROMO-NM              TO PM124-PROMO-NM.                     
           MOVE PV-PROMO-ABBR-NM         TO PM124-PROMO-ABBR-NM.                
           MOVE PV-PROMO-ITM-DESC        TO PM124-PROMO-ITM-DESC.               
           MOVE PV-MDSE-SELN-DESC        TO PM124-MDSE-SELN-DESC.               
           MOVE PV-AD-PG-NBR             TO PM124-AD-PG-NBR.                    
           MOVE PV-AD-PG-SEQ-NBR         TO PM124-AD-PG-SEQ-NBR.                
           MOVE PV-AD-SP-CDE             TO PM124-AD-SP-CDE.                    
                                                                                
           IF PV-PRICG-TYP-CDE = 'SPO' OR 'CPO' OR 'SRP' OR 'SPP'               
              MOVE PV-PRICG-AMT          TO PM124-PRICG-AMT                     
              MOVE ZEROES                TO PM124-GROUP-QTY                     
           ELSE                                                                 
              IF PV-PRICG-TYP-CDE = 'GAO' OR 'GBL' OR 'GBD' OR 'GBP'            
                 IF PV-PRICG-TYP-CDE = 'GBP'                                    
                     MOVE PV-GROUP-PCT        TO PM124-PRICG-AMT                
                 ELSE                                                           
                     MOVE PV-GROUP-AMT        TO PM124-PRICG-AMT                
                 END-IF                                                         
                 MOVE PV-GROUP-QTY       TO PM124-GROUP-QTY                     
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *7000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 7100-POPULATE-EXCLUSION-REC.                                            
      *     POPULATES THE EXCLUSION PRICING RECORD.                             
      *----------------------------------------------------------               
       7100-POPULATE-EXCLUSION-REC.                                             
                                                                                
           MOVE 0                        TO PM124-REC-TYP-CDE.                  
           MOVE PV-MDSE-HIER-CDE         TO PM124-MDSE-HIER-CDE.                
           MOVE PV-PROMO-DEPT-NBR        TO PM124-DEPT-NBR.                     
           MOVE PV-MAJ-CL-NBR            TO PM124-MAJ-CL-NBR.                   
           MOVE PV-SUB-CL-NBR            TO PM124-SUB-CL-NBR.                   
           MOVE PV-VS-ID                 TO PM124-VS-ID.                        
           MOVE PV-SKU-NBR               TO PM124-SKU-NBR.                      
                                                                                
           MOVE ZEROES                   TO PM124-PRICG-AMT                     
                                            PM124-GROUP-QTY                     
                                            PM124-STR-NBR.                      
                                                                                
           MOVE SPACES                   TO PM124-PRICG-TYP-CDE.                
                                                                                
      *7100-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *-----------------------------------------------------------              
      * 7200-SELECT-PAGE-NBR.                                                   
      *     SELECTS THE VA PAGE NUMBER.                                         
      *-----------------------------------------------------------              
       7200-SELECT-PAGE-NBR.                                                    
                                                                                
           EXEC SQL                                                             
                SELECT  A.AD_PG_NBR                                             
                       ,A.AD_PG_SEQ_NBR                                         
                       ,A.AD_SP_CDE                                             
                  INTO  :PV-AD-PG-NBR                                           
                       ,:PV-AD-PG-SEQ-NBR :PV-AD-PG-SEQ-NBR-NULL                
                       ,:PV-AD-SP-CDE :PV-AD-SP-CDE-NULL                        
                  FROM  PMT_AD_SP_ASGMT A                                       
                 WHERE  A.PROMO_ITM_ID      = :PV-PROMO-ITM-ID                  
                   AND  A.PRIM_PRT_VER_IND  = 'Y'                               
                   AND  A.STAT_CDE          = 'S'                               
           END-EXEC.                                                            
                                                                                
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROES                                              
                  CONTINUE                                                      
             WHEN SQLCODE = 1403                                                
                  MOVE ZEROES TO PV-AD-PG-NBR                                   
                                 PV-AD-PG-SEQ-NBR                               
                  MOVE SPACES TO PV-AD-SP-CDE                                   
             WHEN OTHER                                                         
                  MOVE SQLCODE     TO PV-SQL-CODE                               
                  DISPLAY 'PV-PROMO-ITM-ID = ' PV-PROMO-ITM-ID                  
                  SET ABEND-4013-SQL-ERROR TO TRUE                              
                  MOVE 'PMT_AD_SP_ASGMT' TO PV-TABLE-NAME                       
                  MOVE '7200-SELECT-PAGE-NBR'                                   
                                             TO PV-PARAGRAPH-NAME               
                  MOVE 'ERROR ON SELECT PAGE NBR'                               
                                             TO PV-OPERATION-MSG                
                  PERFORM 9900-ORACLE-ABEND                                     
           END-EVALUATE.                                                        
                                                                                
      *7200-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 9000-WRITE-PROMO-ITM-REC.                                               
      *     WRITES THE PRICING RECORD TO THE SUMMARY FILE.                      
      *----------------------------------------------------------               
       9000-WRITE-PROMO-ITM-REC.                                                
                                                                                
154307     IF PM124-SKU-NBR NOT EQUAL TO ZEROS                                  
154307        MOVE 'SKU' TO PM124-MDSE-HIER-CDE                                 
154307     ELSE                                                                 
154307        IF PM124-VS-ID NOT EQUAL TO ZEROS                                 
154307           MOVE 'STY' TO PM124-MDSE-HIER-CDE                              
154307        ELSE                                                              
154307           IF PM124-SUB-CL-NBR NOT EQUAL TO ZEROS                         
154307              MOVE 'SCL' TO PM124-MDSE-HIER-CDE                           
154307           ELSE                                                           
154307              IF PM124-MAJ-CL-NBR NOT EQUAL TO ZEROS                      
154307                 MOVE 'MCL' TO PM124-MDSE-HIER-CDE                        
154307              ELSE                                                        
154307                 MOVE 'DPT' TO PM124-MDSE-HIER-CDE                        
154307              END-IF                                                      
154307            END-IF                                                        
154307          END-IF                                                          
154307        END-IF.                                                           
                                                                                
           WRITE EXCPT-PRICG-EXT-REC                                            
               FROM PM124-EXCPT-PRCG-EXT.                                       
                                                                                
           ADD 1 TO PA-RECS-WRITTEN                                             
                    PA-KEEP-TRACK.                                              
           IF PA-KEEP-TRACK = 10000                                             
              MOVE 0 TO PA-KEEP-TRACK                                           
              DISPLAY 'RECS WRITTEN: ' PA-RECS-WRITTEN                          
              PERFORM 9100-FIND-SYSDATE                                         
              DISPLAY 'TIMESTAMP: ' PV-SYS-DATE                                 
           END-IF.                                                              
                                                                                
      *9000-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *-----------------------------------------------------------              
      * 9100-FIND-SYSDATE:                                                      
      * ==> PROCESSES:                                                          
      *  - SINCE NO TABLE IS ACTUALLY USED WE USE THE DUAL TABLE                
      *  - FIND THE CURRENT DATE AND TIME                                       
      * ==> SQLCODE:                                                            
      *  - 0 = A ROW WAS FOUND.                                                 
      * ==> PERFORMED FROM: A100-MAINLINE                                       
      *-----------------------------------------------------------              
       9100-FIND-SYSDATE.                                                       
           EXEC SQL                                                             
               SELECT                                                           
                   SYSDATE                                                      
               INTO :PV-SYS-DATE                                                
               FROM                                                             
                   DUAL                                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZERO                                                
                 CONTINUE                                                       
             WHEN OTHER                                                         
               MOVE SQLCODE               TO PV-SQL-CODE                        
               MOVE 'DUAL'                TO PV-TABLE-NAME                      
               MOVE 'C100-FIND-SYSDATE'   TO PV-PARAGRAPH-NAME                  
               PERFORM 9900-ORACLE-ABEND                                        
           END-EVALUATE.                                                        
                                                                                
      *9100-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 9800-ABEND.                                                             
      *     PERFORMS A NON-SQL-ABEND.                                           
      *----------------------------------------------------------               
       9800-ABEND.                                                              
                                                                                
           DISPLAY '** ABEND           **'.                                     
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.          
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.                
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.                 
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.               
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      *9800-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *----------------------------------------------------------               
      * 9900-ORACLE-ABEND.                                                      
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.                    
      *----------------------------------------------------------               
       9900-ORACLE-ABEND.                                                       
                                                                                
           DISPLAY '                       '.                                   
           DISPLAY '** ABEND **       ** = SQLERROR'.                           
           DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.           
           DISPLAY '** SQLCODE        ** = ' PV-SQL-CODE.                       
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                        
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                        
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.                 
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.                     
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.                  
           DISPLAY '                       '.                                   
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      *9900-EXIT.                                                               
       EJECT.                                                                   
                                                                                
      *--------------------------------------------------------------           
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT              
      * LOGS ON TO ORACLE.                                                      
      *---------------------------------------------------------------          
070941*    COPY PMPD800.                                                        
                                                                                
      *-----------------------------------------------------------              
      * Z100-ABEND                                                              
      *  - PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE                      
      *  - CALLED BY PMPD800!                                                   
      *-----------------------------------------------------------              
       Z100-ABEND.                                                              
                                                                                
           DISPLAY '                       '.                                   
           DISPLAY '** ABEND **       ** = SQLERROR'.                           
           DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.           
           DISPLAY '** SQLCODE        ** = ' SQLCODE.                           
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                        
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                        
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.                 
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.                     
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.                  
           DISPLAY '                       '.                                   
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      *----------------------------------------------------------               
      * 9999-WRAPUP.                                                            
      *     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS              
      *     ANY DATA FROM THE PROGRAM.                                          
      *----------------------------------------------------------               
       9999-WRAPUP.                                                             
                                                                                
           CLOSE CONTROL-CARD-FILE-STR                                          
                 RUN-DATE-FILE                                                  
                 EXCPT-PRICG-EXT-FILE.                                          
                                                                                
           DISPLAY 'NUMBER OF PROMO ITEMS INSERTED: ' PA-INSERT-CNT.            
           DISPLAY 'NUMBER OF PROMO ITEMS RECS FETCHED: '                       
                                                     PA-PMITM-CNT.              
           DISPLAY 'NUMBER OF PRICING RECS FETCHED: ' PA-MERCH-CNT.             
           DISPLAY 'NUMBER OF EXCLUSION RECS FETCHED: ' PA-EXCL-CNT.            
           DISPLAY 'NUMBER OF RECS WRITTEN: ' PA-RECS-WRITTEN.                  
           DISPLAY '*********************************************'.             
                                                                                
      *9999-EXIT.                                                               
       EJECT.                                                                   
                                                                                
