000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.    SUKUP005.                                         00040010
000500 AUTHOR.        DEANNA BRANTNER.                                  00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   OCTOBER, 2000.                                    00070001
000800 DATE-COMPILED.                                                   00080001
000900******************************************************************00090001
001000*  THIS PROGRAM DELETES ROWS FROM THE CROSS REFERENCE TABLE       00100001
001100*  TSULBXF USING INPUT CREATED FROM PROGRAM SUKUT042.             00110001
001200******************************************************************00120001
001210******************************************************************00121012
001300* 7/31/03 GB ADDED LOGIC TO UPDATE THE ORIG_CART_ID TO ZERO ON    00130012
001310* THE OUTBOUND CARTON TABLE (SUT_OTBND_CART)                      00131012
001400******************************************************************00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600 CONFIGURATION SECTION.                                           00160001
001700 SOURCE-COMPUTER.        IBM-3090.                                00170001
001800 OBJECT-COMPUTER.        IBM-3090.                                00180001
001900******************************************************************00190001
002000 INPUT-OUTPUT SECTION.                                            00200001
002100 FILE-CONTROL.                                                    00210001
002200                                                                  00220001
002300     SELECT CROSS-REF-FILE                                        00230001
002400         ASSIGN TO INP01.                                         00240001
002500******************************************************************00250001
002600 DATA DIVISION.                                                   00260001
002700 FILE SECTION.                                                    00270001
002800******************************************************************00280001
002900                                                                  00290001
003000 FD  CROSS-REF-FILE                                               00300001
003100     RECORDING MODE IS F                                          00310001
003200     LABEL RECORDS ARE STANDARD                                   00320001
003300     BLOCK CONTAINS 0 RECORDS.                                    00330001
003400                                                                  00340001
003500 01  CROSS-REF-RECORD        PIC  X(088).                         00350004
003600                                                                  00360001
003700******************************************************************00370001
003800 WORKING-STORAGE SECTION.                                         00380001
003900******************************************************************00390001
004000*                                                                 00400001
004100************************************                              00410001
004200*  DB2 FORMATTED MESSAGE AREA                                     00420001
004300************************************                              00430001
004400     COPY DPWS004.                                                00440015
004500                                                                  00450001
004600************************************                              00460001
004700*  COMMUNICATIONS AREA FOR DB2                                    00470001
004800************************************                              00480001
004900     EXEC SQL                                                     00490001
005000          INCLUDE SQLCA                                           00500001
005100     END-EXEC.                                                    00510001
005200                                                                  00520001
005300******************************************************************00530001
005400*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE CROSS REFERENCE    00540001
005500*  TABLE                                                          00550001
005600******************************************************************00560001
005700     EXEC SQL                                                     00570001
005800          INCLUDE TSULBXF                                         00580001
005900     END-EXEC.                                                    00590001
006000                                                                  00600015
006010******************************************************************00601015
006020*  COBOL DECLARATION AND DCLGEN MEMBER FOR SUT_OTBND_CART         00602015
006040******************************************************************00604015
006050     EXEC SQL                                                     00605015
006060          INCLUDE SUT00024                                        00606015
006070     END-EXEC.                                                    00607015
006080                                                                  00608015
006090******************************************************************00609015
006100 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00610001
006200                                                   COMP SYNC.     00620001
006300                                                                  00630001
006400 01  PS-PROGRAM-SWITCHES.                                         00640001
006500     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00650001
006600         88  PS-END-OF-FILE                        VALUE 'Y'.     00660001
006700         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00670001
006800                                                                  00680001
006900 01  PC-PROGRAM-CONSTANTS.                                        00690001
007000     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00700001
007100                                                   COMP SYNC.     00710001
007200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00720001
007300         'SUKUP005'.                                              00730010
007400     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 020.     00740001
007500                                                                  00750001
007600 01  PV-PROGRAM-VARIABLES.                                        00760001
007710     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00771011
007800     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00780001
007900     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00790001
008000     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     00800001
008100                                                   COMP SYNC.     00810001
008200     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     00820001
008300                                                   COMP SYNC.     00830001
008400     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     00840001
008500                                                   COMP SYNC.     00850001
008600     05  PV-DELETE-COUNT             PIC S9(09)    VALUE ZERO     00860001
008700                                                   COMP SYNC.     00870001
008800     05  PV-NOT-FOUND-COUNT          PIC S9(09)    VALUE ZERO     00880001
008900                                                   COMP SYNC.     00890001
008910     05  PV-OB-CART-UPDATE-CNT       PIC S9(09)    VALUE ZERO     00891013
008920                                                   COMP SYNC.     00892013
008930     05  PV-OB-CART-NOT-FND-CNT      PIC S9(09)    VALUE ZERO     00893013
008940                                                   COMP SYNC.     00894013
009000     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00900001
009100     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       00910001
009200                                                   COMP SYNC.     00920001
009300     05  PV-COMMIT-COUNTER           PIC 9(03)     VALUE ZERO.    00930001
009400                                                                  00940001
009500     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00950002
009600                                                   COMP-3.        00960002
009700                                                                  00970001
009800******************************************************************00980001
009900 PROCEDURE DIVISION.                                              00990001
010000     DISPLAY '**** START OF SUKUP005 ****'.                       01000010
010100******************************************************************01010001
010200                                                                  01020001
010300******************************************************************01030001
010400 0000-PROGRAM-MAINLINE.                                           01040001
010500******************************************************************01050001
010530                                                                  01053016
010600     PERFORM 1000-INITIALIZE THRU 1000-EXIT.                      01060001
010700     IF PS-NOT-END-OF-FILE                                        01070001
010800         PERFORM 2000-PROCESS-CROSS-REF-RECS THRU 2000-EXIT       01080001
010900            UNTIL PS-END-OF-FILE                                  01090001
011000     END-IF.                                                      01100001
011100     PERFORM 9000-EOJ-ROUTINE THRU 9000-EXIT.                     01110001
011200                                                                  01120001
011300     STOP RUN.                                                    01130001
011400                                                                  01140001
011500******************************************************************01150001
011600 1000-INITIALIZE.                                                 01160001
011700******************************************************************01170001
011740                                                                  01174016
011800     OPEN INPUT  CROSS-REF-FILE.                                  01180001
011900     PERFORM 3000-READ-CROSS-REF-FILE THRU 3000-EXIT.             01190003
012000                                                                  01200001
012100 1000-EXIT.  EXIT.                                                01210001
012200******************************************************************01220001
012300 2000-PROCESS-CROSS-REF-RECS.                                     01230001
012400******************************************************************01240001
012440                                                                  01244016
012500     PERFORM 4000-DELETE-CROSS-REF-RECS THRU 4000-EXIT.           01250003
012600     ADD +1 TO PV-COMMIT-COUNTER.                                 01260001
012700                                                                  01270001
012800     IF PV-COMMIT-COUNTER > PC-COMMIT-HOLD                        01280001
012900         EXEC SQL                                                 01290001
013000            COMMIT                                                01300001
013100         END-EXEC                                                 01310001
013200                                                                  01320001
013300         IF SQLCODE NOT = +0                                      01330001
013400             DISPLAY '### COMMIT FAILED ! ###'                    01340001
013500             PERFORM 9999-SQL-ABEND THRU 9999-EXIT                01350003
013600         END-IF                                                   01360001
013700                                                                  01370001
013800         ADD +1                          TO PV-COMMIT-COUNT       01380001
013900         MOVE +0 TO PV-COMMIT-COUNTER                             01390001
014000     END-IF.                                                      01400001
014100                                                                  01410001
014200     PERFORM 3000-READ-CROSS-REF-FILE THRU 3000-EXIT.             01420003
014300                                                                  01430001
014400 2000-EXIT.  EXIT.                                                01440001
014500******************************************************************01450001
014600 3000-READ-CROSS-REF-FILE.                                        01460001
014700******************************************************************01470001
014740                                                                  01474016
014800      READ CROSS-REF-FILE INTO DCLTSULBXF                         01480001
014900          AT END SET PS-END-OF-FILE TO TRUE.                      01490001
015000                                                                  01500001
015100 3000-EXIT.  EXIT.                                                01510001
015200******************************************************************01520001
015300 4000-DELETE-CROSS-REF-RECS.                                      01530001
015400******************************************************************01540001
015440                                                                  01544016
015500     EXEC SQL                                                     01550001
015600         DELETE                                                   01560009
015700             FROM  TSULBXF                                        01570001
015800             WHERE SHIPT_UNT_ID = :SULBXF-SHIPT-UNT-ID            01580001
015900     END-EXEC.                                                    01590001
016000                                                                  01600001
016100     EVALUATE TRUE                                                01610001
016200         WHEN SQLCODE = 0                                         01620001
016300             ADD +1           TO PV-DELETE-COUNT                  01630009
016310             PERFORM 4200-UPDATE-OTBND-RECORDS                    01631013
016400         WHEN SQLCODE = +100                                      01640001
016410             ADD +1           TO PV-NOT-FOUND-COUNT               01641014
016600         WHEN SQLCODE < 0                                         01660001
016700         WHEN SQLCODE > 0                                         01670001
016800         WHEN SQLWARN0 = 'W'                                      01680001
016900             MOVE '4000-DELETE-CROSS-REF-RECS'                    01690001
017000                         TO PV-PARAGRAPH-NAME                     01700001
017100             MOVE 'DELETE OF TSULBXF'                             01710001
017200                         TO PV-DB2-OPERATION-ATTEMPTED            01720001
017300             PERFORM 9999-SQL-ABEND THRU 9999-EXIT                01730003
017400     END-EVALUATE.                                                01740001
017500                                                                  01750001
017600 4000-EXIT.  EXIT.                                                01760001
017707******************************************************************01770712
017708 4200-UPDATE-OTBND-RECORDS.                                       01770812
017709******************************************************************01770912
017715                                                                  01771517
017716     EXEC SQL                                                     01771617
017717          UPDATE SUT_OTBND_CART                                   01771717
017718             SET ORIG_CART_ID        = 0                          01771817
017719           WHERE ORIG_CART_ID        = :SULBXF-SHIPT-UNT-ID       01771917
017720     END-EXEC.                                                    01772017
017722                                                                  01772212
017723     EVALUATE TRUE                                                01772312
017724         WHEN SQLCODE = 0                                         01772412
017725             ADD +1           TO PV-OB-CART-UPDATE-CNT            01772513
017730         WHEN SQLCODE = +100                                      01773012
017731             ADD +1           TO PV-OB-CART-NOT-FND-CNT           01773113
017732         WHEN SQLCODE < 0                                         01773212
017733         WHEN SQLCODE > 0                                         01773312
017734         WHEN SQLWARN0 = 'W'                                      01773412
017735             MOVE '4200-UPDATE-OTBND-RECORDS '                    01773513
017736                         TO PV-PARAGRAPH-NAME                     01773612
017737             MOVE 'UPDATE OF SUT00024'                            01773713
017738                         TO PV-DB2-OPERATION-ATTEMPTED            01773812
017739             PERFORM 9999-SQL-ABEND THRU 9999-EXIT                01773912
017740     END-EVALUATE.                                                01774012
017741                                                                  01774112
017742                                                                  01774212
017750******************************************************************01775012
017800 9000-EOJ-ROUTINE.                                                01780001
017900******************************************************************01790001
017940                                                                  01794016
018000     CLOSE CROSS-REF-FILE.                                        01800001
018100                                                                  01810001
018200     MOVE PV-DELETE-COUNT  TO PV-DISPLAY-COUNT.                   01820001
018300     DISPLAY 'TOTAL CROSS REF RECORDS DELETED  ' PV-DISPLAY-COUNT.01830001
018400     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 01840001
018500     DISPLAY 'TOTAL CROSS REF RECORDS NOT FOUND' PV-DISPLAY-COUNT.01850001
018504                                                                  01850413
018505     MOVE PV-OB-CART-UPDATE-CNT   TO PV-DISPLAY-COUNT.            01850513
018506     DISPLAY 'TOTAL OTBND CRTN RECORDS UPDATED' PV-DISPLAY-COUNT. 01850613
018507     MOVE PV-OB-CART-NOT-FND-CNT TO PV-DISPLAY-COUNT.             01850713
018508     DISPLAY 'TOTAL OTBND CRT RECORDS NOT FOUND' PV-DISPLAY-COUNT.01850813
018540                                                                  01854013
018600     MOVE PV-COMMIT-COUNT  TO PV-DISPLAY-COUNT.                   01860001
018700     DISPLAY 'TOTAL COMMITS TAKEN              ' PV-DISPLAY-COUNT.01870001
018800                                                                  01880001
018900 9000-EXIT.  EXIT.                                                01890001
019000******************************************************************01900001
019100 9999-SQL-ABEND.                                                  01910001
019200******************************************************************01920001
019300     DISPLAY '9999-SQL-ABEND'.                                    01930001
019400     DISPLAY '** ABEND     **'.                                   01940001
019500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01950001
019600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01960001
019700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     01970001
019800                                                                  01980001
019900******************************************************************01990001
020000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02000001
020100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02010001
020200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02020001
020300* FORMAT.                                                         02030001
020400******************************************************************02040001
020500     COPY DPPD004.                                                02050001
020600                                                                  02060001
020700     MOVE +4013                  TO ABEND-CODE.                   02070001
020800     CALL 'ILBOABN0' USING ABEND-CODE.                            02080001
020900 9999-EXIT.  EXIT.                                                02090001
