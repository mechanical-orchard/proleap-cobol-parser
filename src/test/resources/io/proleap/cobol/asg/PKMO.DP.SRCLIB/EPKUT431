000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.      EPKUT431.                                       00020099
000300 AUTHOR.          COGNIZANT.                                      00030099
000400 DATE-WRITTEN.    JUNE 2012.                                      00040099
000500                                                                  00050099
000600*-----------------------------------------------------------      00060099
000700*              FULL FILE EXTRACT - PROMO RESEND                   00070099
000800*-----------------------------------------------------------      00080099
000900* THIS PROGRAM WILL RESEND PROMOTION DATA TO STORES THAT DID NOT *00081099
001000* RECEIVE THEIR PROMOTION DATA DUE TO SOME ERROR IN THE SERVER.  *00082099
001100* SERVICE DELIVERY WILL INPUT THE FOLLOWING INTO THE INPUT FILE: *00083099
001200*   1) THE SOURCE STORE FROM WHICH TO PULL THE PROMO DATA FROM   *00084099
001300*   2) THE PROMO ID THAT NEEDED FOR THE MISSING STORES           *00085099
001400*   3) THE TARGET STORE(S) TO WHICH THE PROMO DATA WILL BE       *00086099
001500*      SENT TO.                                                  *00087099
001600* EDITTING WILL TAKE PLACE TO ENSURE THAT:                       *00088099
001700*   1) THE 'FROM' AND 'TO' STORES ARE ALL NUMERIC                *00089099
001800*   2) ALL STORES ARE VALID PER THE STORE LOCATION TABLE.        *00089299
001900*   3) ALLOWED IF SAME SOURCE STORE AND TARGET STORE.            *00089399
002000* IF ANY ERRORS ARE FOUND, DISPLAYS WILL BE WRITTEN TO SYSOUT    *00089499
002100* AND PROCESSING WILL STOP - NO OUTPUT RECORDS WILL BE WRITTEN.  *00089599
002200* IF NO ERRORS ARE FOUND, PROMOTIONS FOR THE SPECIFIED STORE     *00089699
002300* WILL BE FETCHED AND WILL BE WRITTEN ONCE FOR EACH DESTINATION  *00089799
002301* STORE.                                                         *00089899
002302*-----------------------------------------------------------      00089999
002303* HISTORY LOG:                                                    00100099
002304*-----------------------------------------------------------      00110099
002305* DATE: 06/04/2012                                                00120099
002306* WR/IR#: CRQ000000032161                                         00130099
002307* PROGRAMMER: COGNIZANT.                                          00140099
002308* DESCRIPTION: THIS PROGRAM HAS BEEN CLONED FROM EPKUT431.        00150099
002309*  IT IS FOR PROMO RESEND.                                        00151099
002310*                                                                 00160099
002311* DATE:                                                           00161099
002312* WR/IR#:                                                         00162099
002313* PROGRAMMER:                                                     00163099
002314* DESCRIPTION:                                                    00164099
002315*                                                                 00165099
002316*----------------------------------------------------------       00170099
002317 ENVIRONMENT DIVISION.                                            00180099
002318*----------------------------------------------------------       00190099
002319 CONFIGURATION SECTION.                                           00200099
002320 SOURCE-COMPUTER.        IBM-3090.                                00210099
002321 OBJECT-COMPUTER.        IBM-3090.                                00220099
002322                                                                  00221099
002323 INPUT-OUTPUT SECTION.                                            00222099
002324                                                                  00223099
002325 FILE-CONTROL.                                                    00224099
002326                                                                  00225099
002327     SELECT STORE-INPUT-FILE                                      00225199
002328       ASSIGN TO INP01.                                           00225299
002329     SELECT CONTROL-CARD-CURR-BATCH-DTE                           00225399
002330       ASSIGN TO INP02.                                           00225499
002331     SELECT CONTROL-CARD-BATCH-FUTURE-DTE                         00225599
002332       ASSIGN TO INP03.                                           00225699
002333     SELECT DAYS-FILE                                             00225799
002334       ASSIGN TO INP04.                                           00225899
002335     SELECT PROMO-INTFC-FILE                                      00225999
002336       ASSIGN TO OUT01.                                           00226099
002337                                                                  00227099
002338 DATA DIVISION.                                                   00228099
002339 FILE SECTION.                                                    00229099
002340                                                                  00230099
002350 FD  STORE-INPUT-FILE                                             00240099
002360     LABEL RECORDS ARE STANDARD                                   00250099
002370     RECORDING MODE IS F                                          00260099
002380     BLOCK CONTAINS 0 RECORDS                                     00270099
002390     RECORD CONTAINS 80 CHARACTERS                                00280099
002400     DATA RECORD IS STORE-INPUT-RECORD-IN.                        00290099
002500                                                                  00300099
002600 01  STORE-INPUT-RECORD                        PIC X(80).         00300199
003007                                                                  00300799
003008 FD  CONTROL-CARD-CURR-BATCH-DTE                                  00300899
003009     RECORDING MODE F                                             00300999
003010     BLOCK CONTAINS 0 RECORDS                                     00301099
003011     LABEL RECORDS ARE OMITTED                                    00301199
003012     DATA RECORD IS CNTRL-CARD-CURR-BATCH-DTE-REC.                00301299
003013 01  CNTRL-CARD-CURR-BATCH-DTE-REC             PIC  X(080).       00301399
003014                                                                  00301499
003015 FD  CONTROL-CARD-BATCH-FUTURE-DTE                                00301599
003016     RECORDING MODE F                                             00301699
003017     BLOCK CONTAINS 0 RECORDS                                     00301799
003020     LABEL RECORDS ARE OMITTED                                    00302099
003030     DATA RECORD IS CONTROL-CARD-BATCH-FUTURE-REC.                00303099
003040 01  CONTROL-CARD-BATCH-FUTURE-REC             PIC  X(080).       00304099
003050                                                                  00305099
003060 FD  PROMO-INTFC-FILE                                             00306099
003070     RECORDING MODE F                                             00307099
003080     BLOCK CONTAINS 0 RECORDS                                     00308099
003090     LABEL RECORDS ARE OMITTED                                    00309099
003100     DATA RECORD IS PROMO-INTFC-ID-RECORD.                        00310099
003200 01  PROMO-INTFC-RECORD                        PIC  X(200).       00320099
003300                                                                  00330099
003400 FD  DAYS-FILE                                                    00340099
003500     RECORDING MODE F                                             00350099
003600     BLOCK CONTAINS 0 RECORDS                                     00360099
003700     LABEL RECORDS ARE STANDARD.                                  00370099
003800                                                                  00380099
003900 01  DAYS-REC                                  PIC  X(080).       00390099
004000                                                                  00400099
004100 WORKING-STORAGE SECTION.                                         00410099
004200*-----------------------------------------------------------      00420099
004300* PS-PROGRAM SWITCHES                                             00430099
004400*-----------------------------------------------------------      00440099
004500 01  PS-PROGRAM-SWITCHES.                                         00450099
004600     05  PS-STOREGP-RMS-CSR-EOF-SW             PIC  X(001).       00460099
004700       88  PS-STOREGP-RMS-CSR-EOF                VALUE 'Y'.       00470099
004800       88  PS-STOREGP-RMS-CSR-NOT-EOF            VALUE 'N'.       00480099
004900     05  PS-STOREGP-ADHOC-CSR-EOF-SW           PIC  X(001).       00490099
005000       88  PS-STOREGP-ADHOC-CSR-EOF              VALUE 'Y'.       00500099
005100       88  PS-STOREGP-ADHOC-CSR-NOT-EOF          VALUE 'N'.       00510099
005800     05 PS-FILE-STATUS                         PIC  X(002).       00580099
005900       88  PS-SUCCESSFUL-COMPLETION              VALUE '00'.      00590099
006000       88  PS-END-OF-FILE                        VALUE '10'.      00600099
006100       88  PS-SUCCESSFUL-OPEN                    VALUE '97'.      00610099
006200     05  PS-END-OF-CNTL-CRD-SW                 PIC  X(001).       00620099
006300       88  PS-END-OF-CNTL-CRD-FILE               VALUE 'Y'.       00630099
006400       88  PS-NOT-END-OF-CNTL-CRD-FILE           VALUE 'N'.       00640099
006500     05  PS-END-OF-RESTART-CD-SW               PIC  X(001).       00650099
006600       88  PS-END-OF-RESTART-CARD                VALUE 'N'.       00660099
006700       88  PS-NOT-END-OF-RESTART-CARD            VALUE 'Y'.       00670099
006800     05  PS-ERROR-SW                            PIC X(001).       00671099
006900         88  PS-ERROR-FOUND                       VALUE 'Y'.      00672099
007000         88  PS-NO-ERROR-FOUND                    VALUE 'N'.      00673099
007100     05  PS-END-OF-INPUT-SW                     PIC X(001)        00674099
007110                                                  VALUE 'N'.      00674199
007200         88  PS-END-OF-INPUT                      VALUE 'Y'.      00675099
007300         88  PS-NOT-END-OF-INPUT                  VALUE 'N'.      00676099
007400     05  PS-END-OF-TARGET-SW                    PIC X(001).       00677099
007500         88  PS-END-OF-TARGET                     VALUE 'Y'.      00678099
007600         88  PS-NOT-END-OF-TARGET                 VALUE 'N'.      00679099
007700     05  PS-RECORD-SW                           PIC X(001).       00679199
007800         88  PS-SOURCE-STORE                      VALUE 'S'.      00679299
007900         88  PS-TARGET-STORE                      VALUE 'T'.      00679399
008000     05  PS-PROCESSED-SW                        PIC X(001).       00679499
008001         88  PS-PROCESSED-ALL                     VALUE 'Y'.      00679599
008002                                                                  00680099
008003*-----------------------------------------------------------      00681199
008004* PA PROGRAM ACCUMULATORS                                        *00682099
008005*-----------------------------------------------------------      00682199
008006 01  PA-PROGRAM-ACCUMULATORS.                                     00684099
008007     05  PA-INPUT-RECS-READ      PIC S9(7)  COMP-3   VALUE ZEROES.00685099
008008     05  PA-TARGET-STORE-COUNT   PIC S9(7)  COMP-3   VALUE ZEROES.00686099
008009     05  PA-ERROR-COUNT          PIC S9(7)  COMP-3   VALUE ZEROES.00687099
008010     05  PA-RECORDS-FETCHED1     PIC S9(7)  COMP-3   VALUE ZEROES.00688099
008011     05  PA-RECORDS-FETCHED2     PIC S9(7)  COMP-3   VALUE ZEROES.00689099
008012*-----------------------------------------------------------      00690099
008013* PROGRAM CONSTANTS                                               00700099
008014*-----------------------------------------------------------      00710099
008015 01  PC-PROGRAM-CONSTANTS.                                        00720099
008016     05  PC-CURRENT-PROGRAM-NAME               PIC  X(008)        00721099
008017       VALUE 'EPKUT431'.                                          00722099
008018     05  PC-STORE-NBR                          PIC  X(004).       00723099
008019     05  PC-STR-GRP-AD-IND                     PIC  X(001).       00724099
008020       88  PC-RMS-STR-GRP                        VALUE 'S'.       00725099
008021       88  PC-ADHOC-STR-GRP                      VALUE 'A'.       00726099
008022     05  PC-PRICING-BUS-EVENT                  PIC  X(003)        00727099
008023       VALUE '090'.                                               00728099
008024     05  PC-RMS-PRC-SETUP-IND                  PIC  X(001)        00729099
008025       VALUE 'R'.                                                 00730099
008026     05  PC-ADHOC-PRC-SETUP-IND                PIC  X(001)        00740099
008027       VALUE 'A'.                                                 00750099
008028     05  PC-ADHOC-STR-GRP-TYP-CDE              PIC  X(005)        00760099
008029       VALUE '99999'.                                             00770099
008030     05  PC-STORE-LEVEL-CDE                    PIC  X(004)        00780099
008031       VALUE '5000'.                                              00790099
008032     05  PC-FILE-ACT-TYPE                      PIC  X(003)        00800099
008100       VALUE 'CHG'.                                               00810099
008200     05  PC-APPLY-NIGHTLY                      PIC  X(001)        00820099
008300       VALUE 'N'.                                                 00830099
008400     05  PC-UPD-STAT-CDE                       PIC  X(001)        00840099
008500       VALUE 'A'.                                                 00850099
008600     05  PC-DELETE-STAT-CDE                    PIC  X(001)        00860099
008700       VALUE 'D'.                                                 00870099
008800     05  PC-MDSE-INCL-IND                      PIC  X(001)        00880099
008900       VALUE 'B'.                                                 00890099
009000                                                                  00900099
009100*-----------------------------------------------------------      00910099
009200* PV- PROGRAM VARIABLES                                           00920099
009300*-----------------------------------------------------------      00930099
009400 01  PV-PROGRAM-VARAIBLES.                                        00940099
009500     05  PV-SQL-SUB                            PIC S9(004)        00950099
009600                                                 VALUE +0         00960099
009700                                                 COMP.            00970099
009800     05  PV-STR-NBR                            PIC S9(004)        00980099
009900                                                 VALUE +0         00990099
010000                                                 COMP.            01000099
010100     05  PV-PROMO-INTFC-ID                     PIC S9(009)        01010099
010110                                                 COMP.            01011099
010120     05  PV-MDSE-LNE-ID                        PIC S9(009)        01012099
010121                                                 COMP.            01012199
010122     05  PV-STR-GRP-TYP-CDE                    PIC S9(004)        01012299
010123                                                 COMP.            01012399
010124     05  PV-STR-GRP-ID                         PIC S9(010)V       01012499
010125                                                 COMP-3.          01012599
010126     05  PV-PRICG-TYP-CDE                      PIC  X(003)        01012699
010127                                                 VALUE SPACES.    01012799
010128     05  PV-SOURCE-STORE                       PIC  X(004)        01012899
010129                                                 VALUE SPACES.    01012999
010130     05  PV-PROMO-ID                           PIC  9(010)        01013099
010131                                                 VALUE ZEROES.    01013199
010132     05  PV-INCLUDE-QUERY                      PIC  X(001)        01013299
010133                                                 VALUE SPACES.    01013399
010134     05  PV-ACTL-STRT-TMST                     PIC  X(026)        01013499
010135                                                 VALUE SPACES.    01013599
010136     05  PV-ACTL-END-TMST                      PIC  X(026)        01013699
010137                                                 VALUE SPACES.    01013799
010138     05  PV-SOR-LAST-UPD-TMST                  PIC  X(026)        01013899
010139                                                 VALUE SPACES.    01013999
010140     05  PV-EFF-STRT-TMST                      PIC  X(026)        01014099
010141                                                 VALUE SPACES.    01014199
010142     05  PV-EFF-END-TMST                       PIC  X(026)        01014299
010143                                                 VALUE SPACES.    01014399
010144     05  PV-EFF-END-NULL                       PIC S9(004)        01014499
010145                                                 VALUE ZEROS      01014599
010146                                                 COMP.            01014699
010147     05  PV-ABEND-CODE                         PIC  9(004)        01014799
010148                                                 VALUE ZEROS      01014899
010149                                                 COMP.            01014999
010150     05  PV-FUL-FILE-STR                       PIC  9(005)        01015099
010160                                                 VALUE ZEROS.     01015199
010161     05  PV-RECORDS-READ                       PIC S9(7)  COMP-3  01015299
010162                                                 VALUE ZEROS.     01015399
010163     05  PV-ARRAY-COUNT                        PIC S9(7)  COMP-3  01015499
010164                                                 VALUE 1.         01015599
010165     05  PV-TARGET-STORE-TABLE OCCURS 1000 TIMES.                 01015699
010166         10  PV-TARGET-STORE                   PIC X(4)           01015799
010167                                                 VALUE ZEROS.     01015899
010168     05  PV-TARGET-STORE-SUB                   PIC 9(5)           01015999
010169                                                 VALUE ZEROS.     01016099
010170     05  PV-SUB                                PIC 9(5)           01016199
010180                                                 VALUE ZEROS.     01016299
010181     05  PV-SYSOUT-SUB                         PIC 9(5)           01016399
010182                                                 VALUE ZEROS.     01016499
010183     05  PV-STORE-10.                                             01016599
010184         10  PV-STORE-10-1                     PIC X(6)           01016699
010185                                                 VALUE '000000'.  01016799
010186         10  PV-STORE-4                        PIC X(4).          01016899
010187     05  PV-DISPLAY-SQLCODE                    PIC 9(4)           01016999
010188                                                 VALUE ZEROES.    01017099
010189     05  DATE-STORE-WILL-OPEN                  PIC X(010)         01017199
010190                                                 VALUE SPACES.    01017299
010191     05  EP811-CC-CRNT-DTE-MINUS1              PIC X(010)         01017399
010192                                                 VALUE SPACES.    01017499
010193     05  EP810-CC-DATE-PLUS1                   PIC X(010)         01017599
010194                                                 VALUE SPACES.    01017699
010195******************************************************************01017799
010196*    INPUT CONTROL CARD RECORD                                   *01017899
010197*    FIRST RECORD SHOULD CONTAIN THE SOURCE STORE AND PROMO ID   *01017999
010198*    FOR THE PROMOTION RECORDS TO BE COPIED.                     *01018099
010199*    THE REST OF THE RECORDS SHOULD CONTAIN ONLY THE STORES      *01018199
010200*    THAT THE DATA WILL BE SENT TO - 1 STORE PER RECORD.         *01018299
010300******************************************************************01018399
010400                                                                  01018499
010500 01  INPUT-RECORD.                                                01018599
010600     05  INPUT-STORE                 PIC  X(04)  VALUE ZEROES.    01018699
010700     05  FILLER                      PIC  X(01)  VALUE SPACES.    01018799
010800     05  INPUT-PROMO-ID              PIC  X(10)  VALUE ZEROES.    01018899
010900     05  FILLER                      PIC  X(65)  VALUE SPACES.    01018999
011000                                                                  01019099
011100                                                                  01019199
011200 01  SYSOUT-PRINT-REQUEST-RECORD.                                 01019299
011300     05  FILLER                      PIC  X(15)                   01019399
011400                                     VALUE 'PROMOTION ID  '.      01019499
011500     05  SYSOUT-PROMO-ID             PIC  X(10)  VALUE ZEROES.    01019599
011600     05  FILLER                      PIC  X(09)  VALUE SPACES.    01019699
011700     05  SYSOUT-PRMO-ID-ERROR-MSG    PIC  X(46)  VALUE SPACES.    01019799
011800*        NON-NUMERIC                                              01019899
011900                                                                  01019999
012000 01  SYSOUT-HEADER-1.                                             01020099
012100     05  SYSOUT-HDR1-STORE-TYPE  PIC  X(14)  VALUE 'STORE TYPE'.  01020199
012200     05  SYSOUT-HDR1-STORE-NBR   PIC  X(05)  VALUE 'STORE'.       01020299
012300     05  FILLER                  PIC  X(02)  VALUE SPACES.        01020399
012400     05  SYSOUT-HDR1-ERROR-MSG   PIC  X(52)  VALUE 'ERROR'.       01020499
012500                                                                  01020599
012600 01  SYSOUT-HEADER-2.                                             01020699
012700     05  SYSOUT-HDR2-STORE-TYPE  PIC  X(14)  VALUE '------------'.01020799
012800     05  SYSOUT-HDR2-STORE-NBR   PIC  X(05)  VALUE '-----'.       01020899
012900     05  FILLER                  PIC  X(02)  VALUE SPACES.        01020999
013000     05  SYSOUT-HDR2-MEDIA-TYPE  PIC  X(07)  VALUE '-----'.       01021099
013100                                                                  01021199
013200 01  SYSOUT-RECORD-TABLE.                                         01021299
013300     05  SYSOUT-STORE-RECORDS OCCURS 1000 TIMES.                  01021399
013400         10  SYSOUT-FIELD-NAME       PIC  X(15)  VALUE SPACES.    01021499
013500         10  SYSOUT-STORE            PIC  X(04)  VALUE ZEROES.    01021599
013600         10  FILLER                  PIC  X(02)  VALUE SPACES.    01021699
013601         10  SYSOUT-STORE-ERROR-MSG  PIC  X(52)  VALUE SPACES.    01021799
013602*----------------------------------------------------------       01021899
013603* ADVANCE DAYS INPUT FILE.                                        01021999
013604*----------------------------------------------------------       01022099
013605     COPY EPRD045.                                                01022199
013606                                                                  01022299
013607*----------------------------------------------------------       01022399
013608* FULL FILE EXTRACT OUTPUT FILE.                                  01022499
013609*----------------------------------------------------------       01022599
013610     COPY EPRD072.                                                01022699
013611                                                                  01022799
013612*----------------------------------------------------------       01070099
013613* EPCC811 CONTROL CARD LAYOUT - CURRENT BATCH FUTURE DATE         01080099
013614*----------------------------------------------------------       01090099
013615     COPY EPRD107 REPLACING 'EP107-' BY 'EP811-'.                 01100099
013616                                                                  01110099
013617*----------------------------------------------------------       01120099
013618* EPCC810 CONTROL CARD LAYOUT - CURRENT BATCH DATE                01130099
013619*----------------------------------------------------------       01140099
013620     COPY EPRD111 REPLACING 'EP111-' BY 'EP810-'.                 01150099
013621                                                                  01160099
013622*----------------------------------------------------------       01170099
013623* DATE ROUTINE COPY MEMBERS                                       01180099
013624*----------------------------------------------------------       01190099
013625     COPY DPWS500.                                                01200099
013626                                                                  01210099
013627*-----------------------------------------------------------      01220099
013628* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01230099
013629*-----------------------------------------------------------      01240099
013630     COPY DPWS004.                                                01250099
013631                                                                  01260099
013632*-----------------------------------------------------------      01270099
013633* DB2 ABEND COPYBOOK                                              01280099
013634*-----------------------------------------------------------      01290099
013635     COPY DPWS900.                                                01300099
013636                                                                  01310099
013637*-----------------------------------------------------------      01320099
013638* DB2 MESSAGE AREA                                                01330099
013639*-----------------------------------------------------------      01340099
013640     COPY SQLCA2.                                                 01350099
013650                                                                  01360099
013700*-----------------------------------------------------------      01370099
013800* PROGRAM COUNTERS                                                01380099
013900*-----------------------------------------------------------      01390099
014000 01  PC-PROGRAM-COUNTERS.                                         01400099
014300     05  PC-CNT-PROMO-RECS                     PIC  9(009)        01430099
014400                                                 VALUE 0.         01440099
014700     05  PC-CNT-ERROR-RECS                     PIC  9(009)        01470099
014710                                                 VALUE 0.         01471099
014720     05  PC-CNT-ALL-RECS                       PIC  9(009)        01472099
014730                                                 VALUE 0.         01473099
014740     05  PC-CNT-SPACES                         PIC  9(009)        01474099
014750                                                 VALUE 0.         01475099
014760     05  PC-CNT-EXCL-CHECK                     PIC  9(009)        01476099
014770                                                 VALUE 0.         01477099
014780     05  PC-MAX-RETRIES                        PIC S9(004)        01478099
014790                                                 VALUE +5         01479099
014800                                                 COMP.            01480099
014900                                                                  01490099
015000*-----------------------------------------------------------      01500099
015100* ERROR HANDLING                                                  01510099
015200*-----------------------------------------------------------      01520099
015300 01  PV-MISC-ABEND-FIELDS.                                        01530099
015400     05  PV-PARAGRAPH-NAME                     PIC  X(030)        01540099
015500                                                 VALUE SPACE.     01550099
015600     05  PV-OPERATION-MSG-1                    PIC  X(040)        01560099
015700                                                 VALUE SPACE.     01570099
015800     05  PV-OPERATION-MSG-2                    PIC  X(040)        01580099
015900                                                 VALUE SPACE.     01590099
016000     05  PV-DB2-OPERATION                      PIC  X(030)        01600099
016100                                                 VALUE SPACE.     01610099
016200 01  ABEND-CODE                                PIC S9(004)        01620099
016210                                                 VALUE ZEROS      01621099
016220                                                 COMP             01622099
016230                                                 SYNC.            01623099
016240   88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.     01624099
016250   88  ABEND-4013-DB2-ERROR                      VALUE +4013.     01625099
016260   88  ABEND-4019-CAL-SUB-ERROR                  VALUE +4019.     01626099
016270   88  ABEND-4020-MQ-ERROR                       VALUE +4020.     01627099
016280   88  ABEND-4444-FORCED-ABEND                   VALUE +4444.     01628099
016290   88  ABEND-4008                                VALUE +4008.     01629099
016300                                                                  01630099
016400*-----------------------------------------------------------      01640099
016500* DB2 COMMUNICATIONS AREA                                         01650099
016600*-----------------------------------------------------------      01660099
016700     EXEC SQL                                                     01670099
016800       INCLUDE SQLCA                                              01680099
016900     END-EXEC.                                                    01690099
017000                                                                  01700099
017800*-----------------------------------------------------------      01780099
017900* DB2 TABLE XST00001(XST_LOC) - LOCATION TABLE                    01790099
018000*-----------------------------------------------------------      01800099
018100     EXEC SQL                                                     01810099
018200       INCLUDE XST00001                                           01820099
018201     END-EXEC.                                                    01820199
018202                                                                  01820299
018203*-----------------------------------------------------------      01820399
018204* DB2 TABLE XST00023(XST_STR_GP_MBSHP) STORE GROUP MEMBERSHIP     01820499
018205*-----------------------------------------------------------      01820599
018206     EXEC SQL                                                     01820699
018207       INCLUDE XST00023                                           01820799
018208     END-EXEC.                                                    01820899
018209                                                                  01820999
018210*-----------------------------------------------------------      01821099
018220* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       01822099
018230*-----------------------------------------------------------      01823099
018240     EXEC SQL                                                     01824099
018250       INCLUDE XST00028                                           01825099
018260     END-EXEC.                                                    01826099
018270                                                                  01827099
018280*-----------------------------------------------------------      01828099
018290* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       01829099
018300*                                               TABLE             01830099
018400*-----------------------------------------------------------      01840099
018500     EXEC SQL                                                     01850099
018600       INCLUDE XST00029                                           01860099
018700     END-EXEC.                                                    01870099
018800                                                                  01880099
018900*-----------------------------------------------------------      01890099
019000* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           01900099
019100*-----------------------------------------------------------      01910099
019200     EXEC SQL                                                     01920099
019300       INCLUDE XST00031                                           01930099
019400     END-EXEC.                                                    01940099
019500                                                                  01950099
019600*-----------------------------------------------------------      01960099
019700* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) ADHOC STR RELATION       01970099
019800*-----------------------------------------------------------      01980099
019900     EXEC SQL                                                     01990099
020000       INCLUDE XST00033                                           02000099
020100     END-EXEC.                                                    02010099
020200                                                                  02020099
020300*-----------------------------------------------------------      02030099
020400* STORE GROUP INTERFACE ID INCLUDE CURSOR. (RMS)                  02040099
020500*-----------------------------------------------------------      02050099
020600     EXEC SQL                                                     02060099
020700       DECLARE STOREGP-ID-RMS CURSOR FOR                          02070099
020800         SELECT LOC.LOC_NBR                                       02080099
020900               ,STRGP.PROMO_INTFC_ID                              02090099
021000               ,STRGP.MDSE_LNE_ID                                 02100099
021100               ,STRGP.STR_GP_TYP_CDE                              02110099
021200               ,STRGP.STR_GP_ID                                   02120099
021300               ,STRGP.STR_SELN_HIER_CDE                           02130099
021400               ,STRGP.ACTL_STRT_TMST                              02140099
021500               ,STRGP.ACTL_END_TMST                               02150099
021600               ,STRGP.SOR_LAST_UPD_TMST                           02160099
021700               ,MDSSEL.PRICG_TYP_CDE                              02170099
021720         FROM XST_LOC            LOC                              02172099
021730             ,XST_STR_GP_MBSHP   STRMB                            02173099
021740             ,XST_PROMO_STR_GP   STRGP                            02174099
021750             ,XST_MDSE_LNE_SELN  MDSSEL                           02175099
021752         WHERE LOC.LOC_NBR          = :XST00001-LOC-NBR           02175299
021752           AND LOC.LOC_NBR          = STRMB.STR_NBR               02175399
021753           AND STRMB.STR_GP_TYP_CDE = STRGP.STR_GP_TYP_CDE        02175499
021754           AND STRMB.STR_GP_ID      = STRGP.STR_GP_ID             02175599
021755           AND STRGP.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       02175699
021756           AND STRGP.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          02175799
021757           AND STRGP.STAT_CDE  IN ('S')                           02175899
021758           AND MDSSEL.STAT_CDE IN ('S')                           02175999
021759           AND MDSSEL.PROMO_ID      = :XST00028-PROMO-ID          02176199
021763                                                                  02176399
021764           AND ((:EP810-CC-DATE-PLUS1                             02176499
021765               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE)               02176599
021766           OR  (:DATE-STORE-WILL-OPEN                             02176699
021767               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE))              02176799
021768                                                                  02176899
021769           AND ((DATE(STRGP.ACTL_STRT_TMST)                       02176999
021770               BETWEEN STRMB.EFF_BEG_DTE                          02177099
021771                   AND STRMB.EFF_END_DTE)                         02177199
021772           OR  (DATE(STRGP.ACTL_STRT_TMST) >= STRMB.EFF_BEG_DTE   02177299
021773           AND STRMB.EFF_END_DTE IS NULL)                         02177399
021774           OR  (LOC.OPN_DTE > DATE(STRGP.ACTL_STRT_TMST)))        02177499
021775                                                                  02177599
021776           AND ((:EP810-CC-CRNT-DTE                               02177699
021777               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 02177799
021778                   AND DATE(STRGP.ACTL_END_TMST))                 02177899
021779           OR  (DATE(STRGP.ACTL_STRT_TMST)                        02177999
021780               BETWEEN :EP810-CC-DATE-PLUS1                       02178099
021781                   AND :EP811-CC-CRNT-DTE-MINUS1))                02178199
021800           AND :EP810-CC-CRNT-DTE < DATE(STRGP.ACTL_END_TMST)     02180099
021801                                                                  02180199
021802         ORDER BY STRGP.PROMO_INTFC_ID,                           02180299
021803                  STRGP.MDSE_LNE_ID                               02180399
021804         FOR FETCH ONLY                                           02180499
021805         WITH UR                                                  02180599
021806     END-EXEC.                                                    02180699
021807                                                                  02180799
021808*-----------------------------------------------------------      02180899
021809* STORE GROUP INTERFACE ID ADHOC CURSOR.                          02180999
021810*-----------------------------------------------------------      02181099
021811     EXEC SQL                                                     02181199
021820       DECLARE STOREGP-ADHOC CURSOR FOR                           02182099
021830         SELECT LOC.LOC_NBR                                       02183099
021840               ,ADHOC.PROMO_INTFC_ID                              02184099
021850               ,ADHOC.MDSE_LNE_ID                                 02185099
021860               ,ADHOC.ADHC_STR_GP_ID                              02186099
021870               ,ADHOC.STR_SELN_HIER_CDE                           02187099
021871               ,ADHOC.ACTL_STRT_TMST                              02187199
021872               ,ADHOC.ACTL_END_TMST                               02187299
021873               ,ADHOC.SOR_LAST_UPD_TMST                           02187399
021874               ,ADHCS.EFF_STRT_TMST                               02187499
021875               ,ADHCS.EFF_END_TMST                                02187599
021876               ,MDSSEL.PRICG_TYP_CDE                              02187699
021877               ,STRMB.STR_GP_ID                                   02187799
021879         FROM XST_LOC            LOC                              02187999
021880             ,XST_PROMO_ADHC_RLT ADHOC                            02188099
021881             ,XST_PROMO_ADHC_STR ADHCS                            02188199
021882             ,XST_MDSE_LNE_SELN  MDSSEL                           02188299
021883             ,XST_STR_GP_MBSHP   STRMB                            02188399
021885         WHERE LOC.LOC_NBR          = :XST00001-LOC-NBR           02188599
021752           AND LOC.LOC_NBR          = STRMB.STR_NBR               02188699
021886           AND STRMB.STR_NBR        = ADHCS.STR_NBR               02188799
021887           AND ADHOC.ADHC_STR_GP_ID = ADHCS.ADHC_STR_GP_ID        02188899
021888           AND ADHOC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       02188999
021889           AND ADHOC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          02189099
021890           AND ADHOC.STAT_CDE  IN ('S')                           02189199
021891           AND MDSSEL.STAT_CDE IN ('S')                           02189299
021892           AND MDSSEL.PROMO_ID      = :XST00028-PROMO-ID          02189399
021893           AND ADHCS.STAT_CDE  IN ('S')                           02189499
021895           AND STRMB.STR_GP_TYP_CDE = 5000                        02189599
021898                                                                  02189899
021899           AND ((:EP810-CC-DATE-PLUS1                             02189999
021900               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE)               02190099
021901           OR  (:DATE-STORE-WILL-OPEN                             02190199
021902               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE))              02190299
021903                                                                  02190399
021904           AND ((DATE(ADHOC.ACTL_STRT_TMST)                       02190499
021905               BETWEEN DATE(ADHCS.EFF_STRT_TMST)                  02190599
021906                   AND DATE(ADHCS.EFF_END_TMST))                  02190699
021907           OR  (DATE(ADHOC.ACTL_STRT_TMST) >=                     02190799
021908               DATE(ADHCS.EFF_STRT_TMST)                          02190899
021909           AND DATE(ADHCS.EFF_END_TMST)IS NULL)                   02190999
021910           OR  (LOC.OPN_DTE > DATE(ADHOC.ACTL_STRT_TMST)))        02191099
021911                                                                  02191199
021912           AND ((:EP810-CC-CRNT-DTE                               02191299
021913               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 02191399
021914                   AND DATE(ADHOC.ACTL_END_TMST))                 02191499
021915           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        02191599
021920               BETWEEN :EP810-CC-DATE-PLUS1                       02192099
021921                   AND :EP811-CC-CRNT-DTE-MINUS1))                02192199
021922                                                                  02192299
021923         ORDER BY ADHOC.PROMO_INTFC_ID,                           02192399
021924                  ADHOC.MDSE_LNE_ID                               02192499
021925         FOR FETCH ONLY                                           02192599
021926         WITH UR                                                  02192699
021927     END-EXEC.                                                    02192799
021928                                                                  02192899
021929 LINKAGE SECTION.                                                 02192999
021930                                                                  02193099
021931*----------------------------------------------------------       02193199
021940 PROCEDURE DIVISION.                                              02194099
021950*----------------------------------------------------------       02195099
021951 0000-MAINLINE.                                                   02195199
021952                                                                  02195299
021953     PERFORM 1000-INITIALIZATION.                                 02195399
021954                                                                  02195499
021959     PERFORM 2000-PROCESS-STORES                                  02195999
021960         UNTIL PS-PROCESSED-ALL.                                  02196099
021961                                                                  02196199
021962     PERFORM 9999-WRAPUP.                                         02196299
021963                                                                  02196399
021964     GOBACK.                                                      02196499
021965                                                                  02196599
021970*0000-EXIT.                                                       02197099
021980 EJECT.                                                           02198099
021990                                                                  02199099
022000*----------------------------------------------------------       02200099
022100* 1000-INITIALIZATION.                                            02210099
022200*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02220099
022300*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02230099
022400*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             02240099
022500*     INTERFACE ID FILE.                                          02250099
022600*----------------------------------------------------------       02260099
022700 1000-INITIALIZATION.                                             02270099
022800                                                                  02280099
022900     OPEN INPUT  STORE-INPUT-FILE                                 02290099
023000                 CONTROL-CARD-CURR-BATCH-DTE                      02300099
023100                 CONTROL-CARD-BATCH-FUTURE-DTE                    02310099
023200                 DAYS-FILE.                                       02320099
023300     OPEN OUTPUT PROMO-INTFC-FILE.                                02330099
023400                                                                  02340099
023500     INITIALIZE  PS-PROCESSED-SW                                  02350099
023600                 PS-RECORD-SW.                                    02360099
023610                                                                  02362099
023700     PERFORM 1010-READ-CURR-BATCH-DTE-CARD.                       02370099
023800     PERFORM 1020-READ-CURR-BTCH-FUTRE-CARD.                      02380099
023900     PERFORM 1030-READ-DAYS-FILE.                                 02390099
024000     PERFORM 6100-DATE-ROUTINE.                                   02400099
024001     PERFORM 1040-READ-STORE-INPUT.                               02410099
021955     PERFORM 1500-VALIDATE-INPUT-RECORDS                          02420099
021956         UNTIL PS-END-OF-TARGET OR                                02421099
021957               PS-END-OF-INPUT.                                   02422099
024300                                                                  02430099
024400*1000-EXIT.                                                       02440099
024500 EJECT.                                                           02450099
024600                                                                  02460099
028100                                                                  02810099
028200*----------------------------------------------------------       02820099
028210* 1010-READ-CURR-BATCH-DTE-CARD.                                  02821099
028220*     READ CONTROL CARD.  THIS GETS THE PROMO INTERFACE           02822099
028230*     ID'S IT NEEDS TO PROCESS.                                   02823099
028240*----------------------------------------------------------       02824099
028250 1010-READ-CURR-BATCH-DTE-CARD.                                   02825099
028260                                                                  02826099
028270     READ CONTROL-CARD-CURR-BATCH-DTE                             02827099
028280                                  INTO EP810-CC-CONTROL-CARD      02828099
028290       AT END                                                     02829099
028300         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      02830099
028301     END-READ.                                                    02830199
028302                                                                  02830299
028303     IF PS-END-OF-CNTL-CRD-FILE                                   02830399
028304       DISPLAY ' '                                                02830499
028305       DISPLAY '** ABEND     **'                                  02830599
028306       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02830699
028307       DISPLAY '** PARAGRAPH **  = 1010-READ-CURR-BATCH-DTE-CARD' 02830799
028308       DISPLAY '** CURR BATCH DATE CRD IS EMPTY  '                02830899
028309       DISPLAY ' '                                                02830999
028310       MOVE +4002 TO ABEND-CODE                                   02831099
028311       CALL 'ILBOABN0' USING ABEND-CODE                           02831199
028312     ELSE                                                         02831299
028313       DISPLAY '** CURRENT BTCH DTE CONTROL CARD  **'             02831399
028314       DISPLAY '** EPCC810   *  = ' EP810-CC-CRNT-DTE             02831499
028315       DISPLAY ' '                                                02831599
028316     END-IF.                                                      02831699
028317                                                                  02831799
028318*1010-EXIT.                                                       02831899
028319 EJECT.                                                           02831999
028320                                                                  02832099
028321*----------------------------------------------------------       02832199
028322* 1020-READ-CURR-BTCH-FUTRE-CARD.                                 02832299
028323*     READ CONTROL CARD.  THIS GETS THE PROMO INTERFACE           02832399
028324*     ID'S IT NEEDS TO PROCESS.                                   02832499
028325*----------------------------------------------------------       02832599
028326 1020-READ-CURR-BTCH-FUTRE-CARD.                                  02832699
028327                                                                  02832799
028328     READ CONTROL-CARD-BATCH-FUTURE-DTE                           02832899
028329                                  INTO EP811-CC-CONTROL-CARD      02832999
028330       AT END                                                     02833099
028331         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      02833199
028332     END-READ.                                                    02833299
028333                                                                  02833399
028334     IF PS-END-OF-CNTL-CRD-FILE                                   02833499
028335       DISPLAY ' '                                                02833599
028336       DISPLAY '** ABEND     **'                                  02833699
028337       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02833799
028338       DISPLAY '** PARAGRAPH **  = 1020-READ-CURR-BTCH-FUTRE-CARD'02833899
028339       DISPLAY '** BTCH FUTURE DTE CRD IS EMPTY  '                02833999
028340       DISPLAY ' '                                                02834099
028341       MOVE +4002 TO ABEND-CODE                                   02834199
028342       CALL 'ILBOABN0' USING ABEND-CODE                           02834299
028343     ELSE                                                         02834399
028344       DISPLAY '** BATCH FUTURE DTE CONTROL CARD  **'             02834499
028345       DISPLAY '** EPCC811   *  = ' EP811-CC-CRNT-DTE             02834599
028346       DISPLAY ' '                                                02834699
028347     END-IF.                                                      02834799
028348                                                                  02834899
028349*1020-EXIT.                                                       02834999
028350 EJECT.                                                           02835099
028351                                                                  02835199
028352*----------------------------------------------------------       02835299
028353* 1030-READ-DAYS-FILE                                             02835399
028354*     READ DAYS FILE.                                             02835499
028355*----------------------------------------------------------       02835599
028356 1030-READ-DAYS-FILE.                                             02835699
028357                                                                  02835799
028358     READ DAYS-FILE INTO EP045-ADVDAYS-TO-SND-RECORD              02835899
028359       AT END                                                     02835999
028360         DISPLAY '** ABEND **'                                    02836099
028361         DISPLAY '** EPKUT431**'                                  02836199
028362         DISPLAY '** 1030-READ-DAYS-FILE **'                      02836299
028363         DISPLAY '** NUMBER OF DAYS RECORD IS MISSING **'         02836399
028364         SET ABEND-4008 TO TRUE                                   02836499
028365         CALL 'ILBOABN0' USING ABEND-CODE.                        02836599
028366                                                                  02836699
028367*1030-EXIT.                                                       02836799
028368 EJECT.                                                           02836899
028369                                                                  02836999
028370*----------------------------------------------------------       02837099
028371* 1040-READ-STORE-INPUT.                                          02837199
028372*     READ INPUT STORE FILE WITH STORES TO PROCESS                02837299
028373*----------------------------------------------------------       02837899
028374 1040-READ-STORE-INPUT.                                           02837999
028375                                                                  02838099
028376     READ STORE-INPUT-FILE   INTO INPUT-RECORD                    02838199
028377        AT END                                                    02838299
028378           SET PS-END-OF-INPUT       TO TRUE                      02838399
028379     END-READ.                                                    02838499
028380                                                                  02838599
028390     IF PS-NOT-END-OF-INPUT                                       02838699
028400         ADD +1     TO PA-INPUT-RECS-READ                         02838799
028600         IF INPUT-PROMO-ID NOT EQUAL TO SPACES                    02838999
028700            SET PS-SOURCE-STORE     TO TRUE                       02839099
028800            IF PA-TARGET-STORE-COUNT > 0                          02839199
028900                SET PS-END-OF-TARGET    TO TRUE                   02839299
028901            END-IF                                                02839399
028902         ELSE                                                     02839499
028903            SET PS-TARGET-STORE     TO TRUE                       02839599
029000         END-IF                                                   02839699
029400         IF PA-INPUT-RECS-READ > 1000                             02840099
029500             DISPLAY 'LIMIT OF 1,000 INPUT RECORDS EXCEEDED'      02840199
029600             DISPLAY 'PROGRAM IS ENDING.'                         02840299
029700             SET PS-ERROR-FOUND     TO TRUE                       02840399
029800             SET PS-END-OF-INPUT    TO TRUE                       02840499
029900             ADD +1                 TO PA-ERROR-COUNT             02840599
030000         END-IF                                                   02840699
030001     END-IF.                                                      02840799
030002                                                                  02840899
030003*1040-EXIT.                                                       02840999
030004 EJECT.                                                           02841099
030005*                                                                 02841199
030006******************************************************************02841299
030007* - EDIT INPUT RECORDS FOR ERRORS                                *02841399
030008******************************************************************02841499
030009 1500-VALIDATE-INPUT-RECORDS.                                     02841599
030010                                                                  02841699
030020     IF PS-SOURCE-STORE                                           02841799
030030         MOVE INPUT-PROMO-ID      TO PV-PROMO-ID                  02841899
030040                                     SYSOUT-PROMO-ID              02841999
030050         IF INPUT-PROMO-ID        NOT NUMERIC                     02842099
030060             MOVE 'PROMO ID IS NOT NUMERIC'                       02842199
030070                                  TO SYSOUT-PRMO-ID-ERROR-MSG     02842299
030080             SET PS-ERROR-FOUND   TO TRUE                         02842399
030090             ADD +1               TO PA-ERROR-COUNT               02842499
030100         END-IF                                                   02843099
030200         MOVE 'SOURCE STORE  '    TO SYSOUT-FIELD-NAME (1)        02843399
030300                                                                  02843499
030400         MOVE INPUT-STORE         TO PV-SOURCE-STORE              02843599
030500                                     SYSOUT-STORE (1)             02843699
030600     ELSE                                                         02844199
030700         ADD +1                   TO PV-ARRAY-COUNT               02844299
030710         ADD +1                   TO PA-TARGET-STORE-COUNT        02844399
030800         MOVE 'TARGET STORE  '                                    02844499
030900           TO SYSOUT-FIELD-NAME (PV-ARRAY-COUNT)                  02844599
031000         MOVE INPUT-STORE TO SYSOUT-STORE (PV-ARRAY-COUNT)        02844699
031100                          PV-TARGET-STORE (PA-TARGET-STORE-COUNT) 02844799
031200         PERFORM VARYING PV-SUB FROM 1 BY 1                       02844899
031300           UNTIL PV-SUB >= PA-TARGET-STORE-COUNT                  02844999
031400             IF PV-TARGET-STORE (PA-TARGET-STORE-COUNT) =         02845099
031500                PV-TARGET-STORE (PV-SUB)                          02845199
031600                DISPLAY 'MORE THAN ONCE'                          02845299
031700                MOVE 'TARGET STORE LISTED MORE THAN ONCE'         02845399
031800                  TO SYSOUT-STORE-ERROR-MSG (PV-ARRAY-COUNT)      02845499
031900                SET PS-ERROR-FOUND   TO TRUE                      02845599
032000**              STOP LOOKING WHEN FIRST DUP IS FOUND              02845699
032100                MOVE PA-TARGET-STORE-COUNT TO PV-SUB              02845799
032200                ADD +1               TO PA-ERROR-COUNT            02845899
032300             END-IF                                               02845999
032400         END-PERFORM                                              02846099
032500     END-IF.                                                      02846199
032600                                                                  02846299
032700     IF INPUT-STORE NOT NUMERIC                                   02846399
032800         MOVE 'STORE NUMBER IS NOT NUMERIC'                       02846499
032900           TO SYSOUT-STORE-ERROR-MSG (PV-ARRAY-COUNT)             02846599
033000         SET PS-ERROR-FOUND       TO TRUE                         02846699
033100         ADD +1                   TO PA-ERROR-COUNT               02846799
033200     ELSE                                                         02846899
033300         PERFORM 1600-CHECK-FOR-VALID-STORE                       02846999
033400     END-IF.                                                      02847099
033500                                                                  02847199
033600     PERFORM 1040-READ-STORE-INPUT.                               02847299
033700                                                                  02847399
033701                                                                  02847499
033702*1500-EXIT.                                                       02847599
033703 EJECT.                                                           02847699
033704******************************************************************02847799
033705*1600-CHECK-FOR-VALID-STORE.                                    * 02847899
033706* - VALIDATE THE STORE FROM THE INPUT FILE                      * 02847999
033707* - INVALID STORE WILL NOT BE PROCESSED                         * 02848099
033708******************************************************************02848199
033709 1600-CHECK-FOR-VALID-STORE.                                      02848299
033710                                                                  02848399
033720     MOVE INPUT-STORE   TO XST00001-LOC-NBR.                      02848499
033730                                                                  02848599
033740     EXEC SQL                                                     02848699
033750         SELECT LOC_NBR                                           02848799
033760           INTO :XST00001-LOC-NBR                                 02848899
033770           FROM XST_LOC            LOC                            02848999
033780          WHERE LOC.LOC_NBR   = :XST00001-LOC-NBR                 02849099
033790            AND ((:EP810-CC-CRNT-DTE                              02849199
033800               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE)               02849299
033900             OR  (:DATE-STORE-WILL-OPEN                           02849399
034000               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE))              02849499
034100       WITH UR                                                    02849599
034200     END-EXEC.                                                    02849699
034300     EVALUATE TRUE                                                02849799
034400         WHEN SQLCODE = +0                                        02849899
034500             CONTINUE                                             02849999
034600         WHEN SQLCODE = +100                                      02850099
034700             MOVE 'INVALID STORE NUMBER'                          02850199
034800               TO SYSOUT-STORE-ERROR-MSG (PV-ARRAY-COUNT)         02850299
034900             SET PS-ERROR-FOUND TO TRUE                           02850399
035000             ADD +1             TO PA-ERROR-COUNT                 02850499
035100         WHEN OTHER                                               02850599
035200             MOVE SQLCODE       TO PV-DISPLAY-SQLCODE             02850699
035300             STRING 'ERROR IN 1600-CHECK-FOR-VALID-STORE'         02850799
035400                                            DELIMITED BY SIZE     02850899
035500                    ' SQLCODE = '           DELIMITED BY SIZE     02850999
035600                     PV-DISPLAY-SQLCODE     DELIMITED BY SIZE     02851099
035700               INTO SYSOUT-STORE-ERROR-MSG (PV-ARRAY-COUNT)       02851199
035800             SET PS-ERROR-FOUND TO TRUE                           02851299
035900             ADD +1             TO PA-ERROR-COUNT                 02851399
036000     END-EVALUATE.                                                02851499
036001                                                                  02851599
036002*1600-EXIT.                                                       02851699
036003 EJECT.                                                           02851799
036004*----------------------------------------------------------       02851899
036005* 2000-PROCESS-STORES.                                            02851999
036006*     TWO QUERYS (RMS AND ADHOC) ARE EXECUTED WITH THE STORE      02852299
036007*     NUMBER AS THE INPUT.                                        02852399
036008*----------------------------------------------------------       02852599
036009 2000-PROCESS-STORES.                                             02852699
036011      IF PA-ERROR-COUNT = 0                                       02852899
036012         MOVE PV-SOURCE-STORE  TO XST00001-LOC-NBR                02852999
036013         MOVE PV-PROMO-ID      TO XST00028-PROMO-ID               02853099
036014         PERFORM 2100-PROCESS-RMS-CURSOR UNTIL                    02853399
036015           PS-STOREGP-RMS-CSR-EOF                                 02853499
036016                                                                  02853599
036017         PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                   02853899
036018           PS-STOREGP-ADHOC-CSR-EOF                               02853999
036019      END-IF                                                      02854099
036020                                                                  02854199
036030      PERFORM 5000-DISPLAY-STATS                                  02854299
036040                                                                  02854399
036050      IF PS-END-OF-INPUT                                          02854499
036060         SET PS-PROCESSED-ALL   TO TRUE                           02854599
036070      ELSE                                                        02854699
036080         PERFORM 5100-INITIALIZE                                  02854799
036090      END-IF                                                      02854899
036100                                                                  02854999
036200      PERFORM 1500-VALIDATE-INPUT-RECORDS                         02855099
036300          UNTIL PS-END-OF-TARGET OR                               02855199
036301                PS-END-OF-INPUT.                                  02855299
036302                                                                  02855399
036303*2000-EXIT.                                                       02855499
036304 EJECT.                                                           02855599
036305                                                                  02855699
036306*----------------------------------------------------------       02855799
036307* 2100-PROCESS-RMS-CURSOR.                                        02855899
036308*     READS THE FOLLOWING TABLES: XST_LOC                         02855999
036309*                                 XST_STR_GP_MBSHP                02856099
036310*                                 XST_PROMO_STR_GP                02856199
036311*                                 XST_MDSE_LNE_SELN               02856299
036312*     TO DETERMINE IF THE STORE NEEDS TO RECIEVE A FULL           02856399
036313*     FILE. IF SO, A RECORD IS CREATED TO BE SENT TO THE STORE.   02856499
036314*----------------------------------------------------------       02856599
036315 2100-PROCESS-RMS-CURSOR.                                         02856699
036316                                                                  02856799
036317     PERFORM 2110-OPEN-STOREGP-ID-RMS.                            02856899
036318     PERFORM 2120-FETCH-STOREGP-ID-RMS                            02857099
036319       UNTIL PS-STOREGP-RMS-CSR-EOF.                              02860099
036320     PERFORM 2130-CLOSE-STOREGP-ID-RMS.                           02870099
036321                                                                  02880099
036322*2100-EXIT.                                                       02890099
036323 EJECT.                                                           02900099
036324                                                                  02910099
036325*----------------------------------------------------------       02920099
036326* 2110-OPEN-STOREGP-ID-RMS.                                       02930099
036327*     OPEN THE FULL FILE PROMO AND PMAP CURSOR.                   02940099
036328*----------------------------------------------------------       02950099
036329 2110-OPEN-STOREGP-ID-RMS.                                        02960099
036330                                                                  02970099
036331     PERFORM                                                      02980099
036332         WITH TEST AFTER                                          02990099
036333         VARYING PV-SQL-SUB                                       03000099
036334         FROM 1 BY 1                                              03010099
036335         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03020099
036336                   OR  SQLCODE = 0)                               03030099
036337                                                                  03040099
036338         EXEC SQL                                                 03050099
036339           OPEN STOREGP-ID-RMS                                    03060099
036340         END-EXEC                                                 03070099
036341                                                                  03080099
036342         EVALUATE TRUE                                            03090099
036343           WHEN SQLCODE = -904                                    03100099
036344           WHEN SQLCODE = -911                                    03110099
036345           WHEN SQLCODE = -913                                    03120099
036346             CONTINUE                                             03130099
036347           WHEN SQLCODE = 0                                       03140099
036348             SET PC-RMS-STR-GRP TO TRUE                           03150099
036349             SET PS-STOREGP-RMS-CSR-NOT-EOF TO TRUE               03160099
036350           WHEN SQLWARN0 NOT EQUAL SPACE                          03170099
036351           WHEN SQLCODE NOT EQUAL ZERO                            03180099
036352             MOVE '2110-OPEN-STOREGP-ID-RMS'                      03190099
036353                                     TO PV-PARAGRAPH-NAME         03200099
036354             MOVE 'ERROR ON OPEN OF STOREGP-ID-RMS CURSOR'        03210099
036355                                     TO PV-DB2-OPERATION          03220099
036356             PERFORM 9900-SQL-ABEND-ROUTINE                       03230099
036357         END-EVALUATE                                             03240099
036358     END-PERFORM.                                                 03250099
036359                                                                  03260099
036360     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03270099
036361       MOVE '2110-OPEN-STOREGP-ID-RMS'                            03280099
036362                             TO  PV-PARAGRAPH-NAME                03290099
036363       MOVE 'OPEN RETRIES EXCEEDED'                               03300099
036364                              TO  PV-DB2-OPERATION                03310099
036365       PERFORM 9900-SQL-ABEND-ROUTINE                             03320099
036366     END-IF.                                                      03330099
036367                                                                  03340099
036368*2110-EXIT.                                                       03350099
036369 EJECT.                                                           03360099
036370                                                                  03370099
036371*----------------------------------------------------------       03380099
036372* 2120-FETCH-STOREGP-ID-RMS.                                      03390099
036373*     FETCH THE FULL FILE RMS STORE CURSOR.                       03400099
036374*----------------------------------------------------------       03410099
036375 2120-FETCH-STOREGP-ID-RMS.                                       03420099
036376                                                                  03430099
036377     PERFORM                                                      03440099
036378         WITH TEST AFTER                                          03450099
036379         VARYING PV-SQL-SUB                                       03460099
036380         FROM 1 BY 1                                              03470099
036381         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03480099
036382                   OR  SQLCODE = 0                                03490099
036383                   OR  SQLCODE = +100)                            03500099
036384                                                                  03510099
036385         EXEC SQL                                                 03520099
036386           FETCH STOREGP-ID-RMS                                   03530099
036387           INTO  :XST00001-LOC-NBR                                03540099
036388                ,:XST00029-PROMO-INTFC-ID                         03550099
036389                ,:XST00029-MDSE-LNE-ID                            03560099
036390                ,:XST00029-STR-GP-TYP-CDE                         03570099
036391                ,:XST00029-STR-GP-ID                              03580099
036392                ,:XST00029-STR-SELN-HIER-CDE                      03590099
036393                ,:XST00029-ACTL-STRT-TMST                         03600099
036394                ,:XST00029-ACTL-END-TMST                          03610099
036395                ,:XST00029-SOR-LAST-UPD-TMST                      03620099
036396                ,:XST00028-PRICG-TYP-CDE                          03630099
036400         END-EXEC                                                 03640099
036500                                                                  03650099
036600         EVALUATE TRUE                                            03660099
036700           WHEN SQLCODE = -904                                    03670099
036800           WHEN SQLCODE = -911                                    03680099
036900           WHEN SQLCODE = -913                                    03690099
037000             CONTINUE                                             03700099
037100           WHEN SQLCODE = ZERO                                    03710099
                   ADD 1 TO PA-RECORDS-FETCHED1                         03720099
037300             PERFORM 3000-FORMAT-RMS-OUTPUT                       03730099
037400           WHEN SQLCODE = +100                                    03740099
037500             SET PS-STOREGP-RMS-CSR-EOF TO TRUE                   03750099
037600           WHEN SQLWARN0 NOT EQUAL SPACE                          03760099
037700           WHEN SQLCODE NOT EQUAL ZERO                            03770099
037800             MOVE '2120-FETCH-STOREGP-ID-RMS'                     03780099
037900                                     TO PV-PARAGRAPH-NAME         03790099
038000             MOVE 'ERROR ON FETCHING RMS CURSOR'                  03800099
038100                                     TO PV-DB2-OPERATION          03810099
038200             PERFORM 9900-SQL-ABEND-ROUTINE                       03820099
038300         END-EVALUATE                                             03830099
038400     END-PERFORM.                                                 03840099
038500                                                                  03850099
038600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03860099
038700       MOVE '2120-FETCH-STOREGP-ID-RMS'                           03870099
038800                               TO  PV-PARAGRAPH-NAME              03880099
038900       MOVE 'FETCH RETRIES EXCEEDED'                              03890099
039000                               TO  PV-DB2-OPERATION               03900099
039100       PERFORM 9900-SQL-ABEND-ROUTINE                             03910099
039200     END-IF.                                                      03920099
039300                                                                  03930099
039400*2120-EXIT.                                                       03940099
039500 EJECT.                                                           03950099
039600                                                                  03960099
039700*-----------------------------------------------------------      03970099
039800* 2130-CLOSE-STOREGP-ID-RMS.                                      03980099
039900*-----------------------------------------------------------      03990099
040000 2130-CLOSE-STOREGP-ID-RMS.                                       04000099
040100                                                                  04010099
040200     MOVE ZEROS TO PV-FUL-FILE-STR.                               04020099
040300                                                                  04030099
040400     PERFORM                                                      04040099
040500         WITH TEST AFTER                                          04050099
040600         VARYING PV-SQL-SUB                                       04060099
040700         FROM 1 BY 1                                              04070099
040800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04080099
040900                   OR  SQLCODE = 0)                               04090099
041000                                                                  04100099
041100         EXEC SQL                                                 04110099
041200           CLOSE STOREGP-ID-RMS                                   04120099
041300         END-EXEC                                                 04130099
041400                                                                  04140099
041500         EVALUATE TRUE                                            04150099
041600           WHEN SQLCODE = -904                                    04160099
041700           WHEN SQLCODE = -911                                    04170099
041800           WHEN SQLCODE = -913                                    04180099
041900           WHEN SQLCODE = 0                                       04190099
042000             CONTINUE                                             04200099
042100           WHEN SQLWARN0 NOT EQUAL SPACE                          04210099
042200           WHEN SQLCODE NOT EQUAL ZERO                            04220099
042300             MOVE '2130-CLOSE-STOREGP-ID-RMS'                     04230099
042400                                     TO PV-PARAGRAPH-NAME         04240099
042500             MOVE 'ERROR ON CLOSE OF STOREGP-ID-RMS'              04250099
042600                                     TO PV-DB2-OPERATION          04260099
042700             PERFORM 9900-SQL-ABEND-ROUTINE                       04270099
042800         END-EVALUATE                                             04280099
042900     END-PERFORM.                                                 04290099
043000                                                                  04300099
043100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04310099
043200       MOVE '2130-CLOSE-STOREGP-ID-RMS'                           04320099
043300                               TO  PV-PARAGRAPH-NAME              04330099
043400       MOVE 'CLOSE RETRIES EXCEEDED'                              04340099
043500                               TO  PV-DB2-OPERATION               04350099
043600       PERFORM 9900-SQL-ABEND-ROUTINE                             04360099
043700     END-IF.                                                      04370099
043800                                                                  04380099
043900*2130-EXIT.                                                       04390099
044000 EJECT.                                                           04400099
044100                                                                  04410099
044200*----------------------------------------------------------       04420099
044300* 2200-PROCESS-ADHC-CURSOR.                                       04430099
044400*     READS THE FOLLOWING TABLES: XST_LOC                         04440099
044600*                                 XST_STR_GP_MBSHP                04460099
044700*                                 XST_PROMO_ADHC_RLT              04470099
044800*                                 XST_MDSE_LNE_SELN               04480099
045500*     TO DETERMINE IF THE STORE NEEDS TO RECIEVE A FULL           04550099
045600*     FILE. IF SO, A RECORD IS CREATED TO BE SENT TO THE STORE.   04560099
045700*----------------------------------------------------------       04570099
045800 2200-PROCESS-ADHC-CURSOR.                                        04580099
045900                                                                  04590099
046000     PERFORM 2210-OPEN-STOREGP-ADHOC.                             04600099
046100     PERFORM 2220-FETCH-STOREGP-ADHOC                             04610099
046200       UNTIL PS-STOREGP-ADHOC-CSR-EOF                             04620099
046300     PERFORM 2230-CLOSE-STOREGP-ADHOC.                            04630099
046400                                                                  04640099
046500*2200-EXIT.                                                       04650099
046600 EJECT.                                                           04660099
046700                                                                  04670099
046800*----------------------------------------------------------       04680099
046900* 2210-OPEN-STOREGP-ADHOC.                                        04690099
047000*     OPEN THE BWP BUY PROMO AND PMAP CURSOR.                     04700099
047100*----------------------------------------------------------       04710099
047200 2210-OPEN-STOREGP-ADHOC.                                         04720099
047300                                                                  04730099
047400     PERFORM                                                      04740099
047500         WITH TEST AFTER                                          04750099
047600         VARYING PV-SQL-SUB                                       04760099
047700         FROM 1 BY 1                                              04770099
047800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04780099
047900                   OR  SQLCODE = 0)                               04790099
048000                                                                  04800099
048100         EXEC SQL                                                 04810099
048200           OPEN STOREGP-ADHOC                                     04820099
048300         END-EXEC                                                 04830099
048400                                                                  04840099
048500                                                                  04850099
048600         EVALUATE TRUE                                            04860099
048700           WHEN SQLCODE = -904                                    04870099
048800           WHEN SQLCODE = -911                                    04880099
048900           WHEN SQLCODE = -913                                    04890099
049000             CONTINUE                                             04900099
049100           WHEN SQLCODE = 0                                       04910099
049200             SET PC-ADHOC-STR-GRP TO TRUE                         04920099
049300             SET PS-STOREGP-ADHOC-CSR-NOT-EOF  TO TRUE            04930099
049400           WHEN SQLWARN0 NOT EQUAL SPACE                          04940099
049500           WHEN SQLCODE NOT EQUAL ZERO                            04950099
049600           MOVE '2210-OPEN-STOREGP-ADHOC'                         04960099
049700                                     TO PV-PARAGRAPH-NAME         04970099
049800           MOVE 'ERROR ON OPEN OF BWP BUY CURSOR'                 04980099
049900                                     TO PV-DB2-OPERATION          04990099
050000           PERFORM 9900-SQL-ABEND-ROUTINE                         05000099
050100         END-EVALUATE                                             05010099
050200     END-PERFORM.                                                 05020099
050300                                                                  05030099
050400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05040099
050500       MOVE '2210-OPEN-STOREGP-ADHOC'                             05050099
050600                             TO  PV-PARAGRAPH-NAME                05060099
050700       MOVE 'OPEN RETRIES EXCEEDED'                               05070099
050800                              TO  PV-DB2-OPERATION                05080099
050900       PERFORM 9900-SQL-ABEND-ROUTINE                             05090099
051000     END-IF.                                                      05100099
051100                                                                  05110099
051200*2210-EXIT.                                                       05120099
051300 EJECT.                                                           05130099
051400                                                                  05140099
051500*----------------------------------------------------------       05150099
051600* 2220-FETCH-STOREGP-ADHOC.                                       05160099
051700*     FETCH THE BWP BUY PROMO AND PMAP CURSOR.                    05170099
051800*----------------------------------------------------------       05180099
051810 2220-FETCH-STOREGP-ADHOC.                                        05181099
051820                                                                  05182099
051830     PERFORM                                                      05183099
051831         WITH TEST AFTER                                          05183199
051832         VARYING PV-SQL-SUB                                       05183299
051833         FROM 1 BY 1                                              05183399
051834         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05183499
051835                   OR  SQLCODE = 0                                05183599
051836                   OR  SQLCODE = +100)                            05183699
051837                                                                  05183799
051838         EXEC SQL                                                 05183899
051839           FETCH STOREGP-ADHOC                                    05183999
051840           INTO  :XST00001-LOC-NBR                                05184099
051841                ,:XST00031-PROMO-INTFC-ID                         05184199
051842                ,:XST00031-MDSE-LNE-ID                            05184299
051843                ,:XST00031-ADHC-STR-GP-ID                         05184399
051844                ,:XST00031-STR-SELN-HIER-CDE                      05184499
051845                ,:XST00031-ACTL-STRT-TMST                         05184599
051846                ,:XST00031-ACTL-END-TMST                          05184699
051847                ,:XST00031-SOR-LAST-UPD-TMST                      05184799
051848                ,:XST00033-EFF-STRT-TMST                          05184899
051849                ,:XST00033-EFF-END-TMST:PV-EFF-END-NULL           05184999
051850                ,:XST00028-PRICG-TYP-CDE                          05185099
051860                ,:XST00023-STR-GP-ID                              05186099
051861         END-EXEC                                                 05186199
051862                                                                  05186299
051863         EVALUATE TRUE                                            05186399
051864           WHEN SQLCODE = -904                                    05186499
051865           WHEN SQLCODE = -911                                    05186599
051866           WHEN SQLCODE = -913                                    05186699
051867             CONTINUE                                             05186799
051868           WHEN SQLCODE = ZERO                                    05186899
                   ADD 1 TO PA-RECORDS-FETCHED2                         05186999
051870             PERFORM 3100-FORMAT-ADHOC-OUTPUT                     05187099
051871           WHEN SQLCODE = +100                                    05187199
051872             SET PS-STOREGP-ADHOC-CSR-EOF TO TRUE                 05187299
051873           WHEN SQLWARN0 NOT EQUAL SPACE                          05187399
051874           WHEN SQLCODE NOT EQUAL ZERO                            05187499
051875           MOVE '2220-FETCH-STOREGP-ADHOC'                        05187599
051876                                     TO PV-PARAGRAPH-NAME         05187699
051877           MOVE 'ERROR ON FETCHING BWP BUY CURSOR'                05187799
051878                                     TO PV-DB2-OPERATION          05187899
051879           DISPLAY 'SQLCODE= ' SQLCODE                            05187999
051880           PERFORM 9900-SQL-ABEND-ROUTINE                         05188099
051881         END-EVALUATE                                             05188199
051882     END-PERFORM.                                                 05188299
051883                                                                  05188399
051884     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05188499
051885       MOVE '2220-FETCH-STOREGP-ADHOC'                            05188599
051886                               TO  PV-PARAGRAPH-NAME              05188699
051887       MOVE 'FETCH RETRIES EXCEEDED'                              05188799
051888                               TO  PV-DB2-OPERATION               05188899
051889       PERFORM 9900-SQL-ABEND-ROUTINE                             05188999
051890     END-IF.                                                      05189099
051891                                                                  05189199
051892*2220-EXIT.                                                       05189299
051893 EJECT.                                                           05189399
051894                                                                  05189499
051895*-----------------------------------------------------------      05189599
051896* 2230-CLOSE-STOREGP-ADHOC.                                       05189699
051897*     CLOSE THE BWP BUY PROMO AND PMAP CURSOR.                    05189799
051898*-----------------------------------------------------------      05189899
051899 2230-CLOSE-STOREGP-ADHOC.                                        05189999
051900                                                                  05190099
051901     PERFORM                                                      05190199
051902         WITH TEST AFTER                                          05190299
051903         VARYING PV-SQL-SUB                                       05190399
051904         FROM 1 BY 1                                              05190499
051905         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05190599
051906                   OR  SQLCODE = 0)                               05190699
051907                                                                  05190799
051908         EXEC SQL                                                 05190899
051909           CLOSE STOREGP-ADHOC                                    05190999
051910         END-EXEC                                                 05191099
051911                                                                  05191199
051912         EVALUATE TRUE                                            05191299
051913           WHEN SQLCODE = -904                                    05191399
051914           WHEN SQLCODE = -911                                    05191499
051915           WHEN SQLCODE = -913                                    05191599
051916           WHEN SQLCODE = 0                                       05191699
051917             CONTINUE                                             05191799
051918           WHEN SQLWARN0 NOT EQUAL SPACE                          05191899
051919           WHEN SQLCODE NOT EQUAL ZERO                            05191999
051920             MOVE '2230-CLOSE-STOREGP-ADHOC'                      05192099
051921                                     TO PV-PARAGRAPH-NAME         05192199
051922             MOVE 'ERROR ON CLOSE OF STOREGP ADHOC'               05192299
051923                                     TO PV-DB2-OPERATION          05192399
051924             PERFORM 9900-SQL-ABEND-ROUTINE                       05192499
051925         END-EVALUATE                                             05192599
051926     END-PERFORM.                                                 05192699
051927                                                                  05192799
051928     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05192899
051929       MOVE '2230-CLOSE-STOREGP-ADHOC'                            05192999
051930                               TO  PV-PARAGRAPH-NAME              05193099
051931       MOVE 'CLOSE RETRIES EXCEEDED'                              05193199
051932                               TO  PV-DB2-OPERATION               05193299
051933       PERFORM 9900-SQL-ABEND-ROUTINE                             05193399
051934     END-IF.                                                      05193499
051935                                                                  05193599
051936*2230-EXIT.                                                       05193699
051937 EJECT.                                                           05193799
051938                                                                  05193899
051939*-----------------------------------------------------------      05193999
051940* 3000-FORMAT-RMS-OUTPUT.                                         05194099
051941*     POPULATE COPYBOOK EPRD072.                                  05194199
051942*-----------------------------------------------------------      05194299
051943 3000-FORMAT-RMS-OUTPUT.                                          05194399
051944                                                                  05194499
051945     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05194599
051946     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      05194699
051947     MOVE PC-RMS-PRC-SETUP-IND   TO EP072-PRC-SETUP-IND.          05194799
051948     MOVE XST00029-STR-GP-TYP-CDE                                 05194899
051949                                 TO EP072-SETUP-STR-GRP-TYP-CDE.  05194999
051951     MOVE XST00029-STR-GP-ID     TO EP072-SETUP-STR-GRP-ID.       05195099
051952     MOVE PC-STORE-LEVEL-CDE     TO EP072-DIST-STR-GRP-TYP-CDE.   05195299
051954     MOVE XST00029-STR-SELN-HIER-CDE                              05195499
051955                                 TO EP072-STR-SELN-HIER-CDE.      05195599
051956     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           05195699
051957     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              05195799
051958     MOVE PC-UPD-STAT-CDE        TO EP072-RECORD-ACTION.          05195899
051959     MOVE XST00029-PROMO-INTFC-ID                                 05195999
051960                                 TO EP072-PROMO-INTFC-ID.         05196099
051980     MOVE XST00029-MDSE-LNE-ID   TO EP072-MERCH-LNE-ID.           05198099
051990     MOVE XST00028-PRICG-TYP-CDE                                  05199099
052000                                 TO EP072-PRICG-TYP-CDE.          05200099
052010     MOVE PC-MDSE-INCL-IND       TO EP072-MDSE-INC-EXC-IND.       05201099
052011     MOVE XST00029-ACTL-STRT-TMST                                 05201199
052012                                 TO EP072-STR-GRP-PROMO-STRT-TMST.05201299
052013     MOVE XST00029-ACTL-END-TMST                                  05201399
052014                                 TO EP072-STR-GRP-PROMO-END-TMST. 05201499
052015     MOVE XST00029-SOR-LAST-UPD-TMST                              05201599
052016                                 TO EP072-SOR-LAST-UPD-TMST.      05201699
052017                                                                  05201799
052018     PERFORM 3050-BUILD-TARGET-STORE-RECS.                        05201999
052019                                                                  05202099
052020*3000-EXIT.                                                       05202199
052030 EJECT.                                                           05203099
052040                                                                  05204099
052050***************************************************************** 05204199
052060* - BUILD 1 TARGET STORE RECORD FOR EACH TARGET STORE READ        05204299
052070*   FROM THE INPUT FILE, BY OVERLAYING THE SOURCE STORE NUMBER    05204399
052080*   WITH THE TARGET STORE NUMBER.                                 05204499
052090***************************************************************** 05204599
052100 3050-BUILD-TARGET-STORE-RECS.                                    05204699
052200     PERFORM                                                      05204799
052300       VARYING PV-TARGET-STORE-SUB                                05204899
052400         FROM 1 BY 1 UNTIL                                        05204999
052500           PV-TARGET-STORE-SUB > PA-TARGET-STORE-COUNT            05205099
052600             MOVE PV-TARGET-STORE (PV-TARGET-STORE-SUB)           05205199
052700               TO PV-STORE-4                                      05205299
052800             MOVE PV-STORE-10 TO EP072-DIST-STR-GRP-ID            05205399
052802             PERFORM 4000-WRITE-FULL-FILE-RECORD                  05206099
052803     END-PERFORM.                                                 05206199
052804                                                                  05206299
052805*3050-EXIT.                                                       05206399
052806 EJECT.                                                           05206499
052807*-----------------------------------------------------------      05206599
052808* 3100-FORMAT-ADHOC-OUTPUT.                                       05206699
052809*     POPULATE COPYBOOK EPRD072.                                  05207099
052810*-----------------------------------------------------------      05208099
052811 3100-FORMAT-ADHOC-OUTPUT.                                        05209099
052812                                                                  05210099
052813     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05220099
052814     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      05230099
052815     MOVE PC-ADHOC-PRC-SETUP-IND TO EP072-PRC-SETUP-IND.          05240099
052816     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05250099
052817                                 TO EP072-SETUP-STR-GRP-TYP-CDE.  05260099
052818     MOVE XST00031-ADHC-STR-GP-ID                                 05261099
052819                                 TO EP072-SETUP-STR-GRP-ID.       05262099
052610     MOVE XST00031-ADHC-STR-GP-ID                                 05262199
052620                                 TO EP072-SETUP-STR-GRP-ID.       05262299
052820     MOVE XST00023-STR-GP-ID     TO EP072-DIST-STR-GRP-ID.        05263099
052821     MOVE PC-STORE-LEVEL-CDE     TO EP072-DIST-STR-GRP-TYP-CDE.   05264099
052822     MOVE XST00031-STR-SELN-HIER-CDE                              05265099
052823                                 TO EP072-STR-SELN-HIER-CDE.      05265199
052824     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           05265299
052825     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              05265399
052826     MOVE PC-UPD-STAT-CDE        TO EP072-RECORD-ACTION.          05265499
052827     MOVE XST00031-PROMO-INTFC-ID                                 05265599
052828                                 TO EP072-PROMO-INTFC-ID.         05265699
052829     MOVE XST00031-MDSE-LNE-ID                                    05265799
052830                                 TO EP072-MERCH-LNE-ID.           05265899
052831     MOVE XST00028-PRICG-TYP-CDE                                  05265999
052832                                 TO EP072-PRICG-TYP-CDE.          05266099
052833     MOVE PC-MDSE-INCL-IND       TO EP072-MDSE-INC-EXC-IND.       05266199
052834     MOVE XST00031-ACTL-STRT-TMST                                 05266299
052835                                 TO EP072-STR-GRP-PROMO-STRT-TMST.05266399
052836     MOVE XST00031-ACTL-END-TMST                                  05266499
052837                                 TO EP072-STR-GRP-PROMO-END-TMST. 05266599
052838     MOVE XST00031-SOR-LAST-UPD-TMST                              05266699
052839                                 TO EP072-SOR-LAST-UPD-TMST.      05266799
052840                                                                  05266899
052841     PERFORM 3050-BUILD-TARGET-STORE-RECS.                        05266999
052842                                                                  05267199
052843*3100-EXIT.                                                       05267299
052844                                                                  05270799
052845                                                                  05275099
052846*----------------------------------------------------------       05277099
052847* 4000-WRITE-FULL-FILE-RECORD                                     05277199
052848*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05277299
052849*----------------------------------------------------------       05277399
052850 4000-WRITE-FULL-FILE-RECORD.                                     05277499
052851                                                                  05277599
052852     WRITE PROMO-INTFC-RECORD FROM EP072-PROMO-INTFC-RECORD.      05277699
052853                                                                  05277799
052854     ADD 1           TO PC-CNT-PROMO-RECS.                        05277899
052855                                                                  05277999
052856*4000-EXIT.                                                       05278099
052857 EJECT.                                                           05278199
052858                                                                  05278299
052859*----------------------------------------------------------       05278399
052860* - DISPLAY THE NUMBER OF RECORDS READ, WRITTEN AND IN ERROR.    *05278499
052861* - DISPLAY SYSOUT LINE FOR EACH INPUT RECORD READ.              *05278599
052862*----------------------------------------------------------       05278699
052863 5000-DISPLAY-STATS.                                              05278799
052864                                                                  05278899
052865     DISPLAY ' '.                                                 05278999
052866     DISPLAY 'JOB TOTALS'                                         05279099
052867     DISPLAY '----------'                                         05279199
052868     DISPLAY 'INPUT RECORD COUNT       = ' PA-INPUT-RECS-READ.    05279299
052869     DISPLAY 'TARGET STORE COUNT       = ' PA-TARGET-STORE-COUNT. 05279399
052870     DISPLAY 'ERROR COUNT              = ' PA-ERROR-COUNT.        05279499
052880     DISPLAY ' '.                                                 05279599
052890     DISPLAY 'DETAILS'                                            05279699
052900     DISPLAY '-------'                                            05279799
053000     DISPLAY SYSOUT-PRINT-REQUEST-RECORD.                         05279899
053100     DISPLAY ' '.                                                 05279999
053200     DISPLAY SYSOUT-HEADER-1.                                     05280099
053300     DISPLAY SYSOUT-HEADER-2.                                     05280199
053400     PERFORM                                                      05280299
053500       VARYING PV-SYSOUT-SUB FROM 1 BY 1                          05280399
053600         UNTIL PV-SYSOUT-SUB > PV-ARRAY-COUNT                     05280499
053700            OR PV-SYSOUT-SUB > 1000                               05280599
053800           DISPLAY SYSOUT-STORE-RECORDS (PV-SYSOUT-SUB)           05280699
053900     END-PERFORM.                                                 05280799
054000                                                                  05280899
054100     DISPLAY ' '.                                                 05280999
057500     DISPLAY 'STOREGP-ID-RMS CSR   FETCHED: ' PA-RECORDS-FETCHED1.05281099
057500     DISPLAY 'STOREGP-ADHOC  CSR   FETCHED: ' PA-RECORDS-FETCHED2.05281199
057500     DISPLAY 'NUMBER OF PROMO RECS WRITTEN: ' PC-CNT-PROMO-RECS.  05281299
054101                                                                  05281399
054102*5000-EXIT.                                                       05281499
054103 EJECT.                                                           05281599
054104                                                                  05281699
054105*----------------------------------------------------------       05281799
054106* - INITIALIZE THE VARIABLE FOR PROCESSING THE NEXT SET OF        05281899
054107*   SOURCE STORE AND TARGET STORES IN THE INPUT FILE              05281999
054108*----------------------------------------------------------       05282099
054109 5100-INITIALIZE.                                                 05282199
054110                                                                  05282299
054120     PERFORM                                                      05283699
054130       VARYING PV-SYSOUT-SUB FROM 1 BY 1                          05283799
054140         UNTIL PV-SYSOUT-SUB > PV-ARRAY-COUNT                     05283899
054150            OR PV-SYSOUT-SUB > 1000                               05283999
054160           INITIALIZE SYSOUT-STORE-RECORDS (PV-SYSOUT-SUB)        05284099
054170           INITIALIZE PV-TARGET-STORE (PV-SYSOUT-SUB)             05284199
054180     END-PERFORM.                                                 05284299
054190                                                                  05284399
054200     INITIALIZE PV-PROMO-ID                                       05284499
054300                PA-TARGET-STORE-COUNT                             05284599
054400                PA-ERROR-COUNT                                    05284699
054500                PV-ARRAY-COUNT                                    05284799
054600                PS-ERROR-SW                                       05284899
054700                PS-END-OF-TARGET-SW                               05285199
                      PA-RECORDS-FETCHED1                               05285299
                      PA-RECORDS-FETCHED2.                              05285399
054800     SET PS-SOURCE-STORE                TO TRUE.                  05285699
054800     SET PS-STOREGP-RMS-CSR-NOT-EOF     TO TRUE.                  05285799
054800     SET PS-STOREGP-ADHOC-CSR-NOT-EOF   TO TRUE.                  05285899
054801     MOVE 1 TO PV-ARRAY-COUNT.                                    05285999
054802                                                                  05286099
054803*5100-EXIT.                                                       05286199
054804 EJECT.                                                           05286299
054805                                                                  05286399
054806****************************************************              05286499
054807* DATE ROUTINE TO SET UP THE PROCESS DATE IN       *              05286599
054808* CCYYMMDD FORMAT.                                 *              05286699
054809****************************************************              05286799
054810 6100-DATE-ROUTINE.                                               05286899
054811                                                                  05286999
054812     INITIALIZE DPG51 DPG52 DPG53                                 05287099
054813                DPG54 DPG55 DPG56.                                05287199
054814                                                                  05287299
054815     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05287399
054816     SET DPG51-INCREMENT-DATE       TO TRUE.                      05287499
054817     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05287599
054818     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05287699
054819     MOVE EP810-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05287799
054820                                                                  05287899
054821     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05287999
054822                                             DPG54 DPG55 DPG56.   05288099
054823                                                                  05288199
054824     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05288299
054825       DISPLAY '** ABEND **'                                      05288399
054826       DISPLAY '** PROGRAM = EPKUT431'                            05288499
054827       DISPLAY 'DATE = ' EP810-CC-CRNT-DTE                        05288599
054828       DISPLAY DPG54-ERROR-MESSAGE                                05288699
054829       MOVE 4019 TO PV-ABEND-CODE                                 05288799
054830       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05288899
054831     END-IF.                                                      05288999
054832                                                                  05289099
054833     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP810-CC-DATE-PLUS1.      05289199
054834                                                                  05289299
054835                                                                  05289399
054836     INITIALIZE DPG51 DPG52 DPG53                                 05289499
054837                DPG54 DPG55 DPG56.                                05289599
054838                                                                  05289699
054839     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05289799
054840     SET DPG51-INCREMENT-DATE       TO TRUE.                      05289899
054841     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05289999
054842     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    05290099
054843     MOVE EP810-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05290199
054844                                                                  05290299
054845     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05290399
054846                                             DPG54 DPG55 DPG56.   05290499
054847                                                                  05290599
054848     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05290699
054849       DISPLAY '** ABEND **'                                      05290799
054850       DISPLAY '** PROGRAM = EPKUT431'                            05290899
054851       DISPLAY 'DATE = ' EP810-CC-CRNT-DTE                        05290999
054852       DISPLAY DPG54-ERROR-MESSAGE                                05291099
054853       MOVE 4019 TO PV-ABEND-CODE                                 05291199
054854       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05291299
054855     END-IF.                                                      05291399
054856                                                                  05291499
054857     MOVE DPG55-DB2-ISO-DATE-FMT                                  05291599
054858                                 TO DATE-STORE-WILL-OPEN.         05291699
054859                                                                  05291799
054860                                                                  05291899
054861     INITIALIZE DPG51 DPG52 DPG53                                 05291999
054862                DPG54 DPG55 DPG56.                                05292099
054863                                                                  05292199
054864     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05292299
054865     SET DPG51-DECREMENT-DATE       TO TRUE.                      05292399
054866     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05292499
054867     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05292599
054868     MOVE EP811-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05292699
054869                                                                  05292799
054870     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05292899
054871                                             DPG54 DPG55 DPG56.   05292999
054872                                                                  05293099
054873     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05293199
054874       DISPLAY '** ABEND **'                                      05293299
054875       DISPLAY '** PROGRAM = EPKUT431'                            05293399
054876       DISPLAY 'DATE = ' EP810-CC-CRNT-DTE                        05293499
054877       DISPLAY DPG54-ERROR-MESSAGE                                05293599
054878       MOVE 4019 TO PV-ABEND-CODE                                 05293699
054879       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05293799
054880     END-IF.                                                      05293899
054881                                                                  05293999
054882     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP811-CC-CRNT-DTE-MINUS1. 05294099
054883                                                                  05294199
054884*6100-EXIT.                                                       05294299
054885 EJECT.                                                           05294399
054886                                                                  05294499
054887*----------------------------------------------------------       05294599
054888* 9800-ABEND.                                                     05294699
054889*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  05294799
054890*----------------------------------------------------------       05294899
054891 9800-ABEND.                                                      05294999
054892                                                                  05295099
054893     DISPLAY '** ABEND           **'.                             05300099
054894     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  05310099
054895     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05320099
054896     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05330099
054897     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05340099
054898     CALL 'ILBOABN0' USING ABEND-CODE.                            05350099
054899                                                                  05360099
054900*9800-EXIT.                                                       05370099
054901 EJECT.                                                           05380099
054902                                                                  05390099
054903*----------------------------------------------------------       05400099
054904* 9900-SQL-ABEND-ROUTINE.                                         05410099
054905*     SQL ABEND ROUTINE.                                          05420099
054906*----------------------------------------------------------       05430099
054907 9900-SQL-ABEND-ROUTINE.                                          05440099
054908                                                                  05450099
054909     DISPLAY '** ABEND     **'.                                   05460099
054910     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05470099
054911     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05480099
054912     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05490099
055000                                                                  05500099
055100     COPY DPPD004.                                                05510099
055200     SET ABEND-4013-DB2-ERROR TO TRUE.                            05520099
055300     CALL 'ILBOABN0' USING ABEND-CODE.                            05530099
055400                                                                  05540099
055500*9900-EXIT.                                                       05550099
055600 EJECT.                                                           05560099
055700                                                                  05570099
055800*----------------------------------------------------------       05580099
055900* 9999-WRAPUP.                                                    05590099
056000*     END OF PROGRAM ROUTINE. CLOSES ALL FILES AND DISPLAYS       05600099
056100*     ANY DATA FROM THE PROGRAM.                                  05610099
056200*----------------------------------------------------------       05620099
056300 9999-WRAPUP.                                                     05630099
056400                                                                  05640099
056600     CLOSE STORE-INPUT-FILE                                       05660099
056610           CONTROL-CARD-CURR-BATCH-DTE                            05661099
056700           CONTROL-CARD-BATCH-FUTURE-DTE                          05670099
056800           PROMO-INTFC-FILE.                                      05680099
056900                                                                  05690099
057000     DISPLAY ' '.                                                 05700099
057100     DISPLAY '*********************************************'.     05710099
057200     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            05720099
057300     DISPLAY '*********************************************'.     05730099
057500     DISPLAY 'NUMBER OF PROMO RECS WRITTEN: ' PC-CNT-PROMO-RECS.  05750099
057900     DISPLAY '*********************************************'.     05790099
058000                                                                  05800099
058100*9999-EXIT.                                                       05810099
058200 EJECT.                                                           05820099
058300                                                                  05830099
