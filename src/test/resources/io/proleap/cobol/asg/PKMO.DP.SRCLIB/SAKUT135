       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.      SAKUT135.                                       00030000
       AUTHOR.          JIM HUNTER.                                     00040000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
       DATE-WRITTEN.    03/16/2023.                                     00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ******************************************************************00092001
      *    BUILD GL DATA WITH QUERIES OF LATE TRANSACTIONS              00100000
      *=================================================================00110000
      *                                                                 00120000
      *  CURRENTLY, SAKUT134 SENDS SOME TOTALS VIA EMAIL FOR            00130000
      *  TRANSACTIONS THAT ARRIVED IN COSA ON THE PREVIOUS DAY THAT     00131000
      *  WERE OVER 3 DAYS LATE.                                         00132000
      *  ROB NEEDS IT TO CALCULATE THE REQUIRED GL ADJUSTMENT NUMBERS   00133000
      *  THAT SHOULD RESULT FROM THESE TRANSACTIONS THAT CAME IN AFTER  00134000
      *  THE WEEK WAS PROCESSED (SAK131 WAS RUN).                       00135000
      *  ROB PREFERS TO SEE EVERYTHING 3 DAYS LATE FOR VISIBILITY.      00136000
      *  HE WILL REMOVE/IGNORE RECORDS THAT WEREN'T RECEIVED AFTER      00137000
      *  SAK131 WAS RUN OR WERE ENTERED MANUALLY AS MISSING             00138000
      *  TRNSACTIONS.                                                   00139000
      *                                                                 00140000
      *  THE FINAL STM AND TMR VALUES, WHICH ARE ADJUSTED BY SOME OF    00150000
      *  THE OTHER QUERY VALUES, WILL ALSO BE CALCULATED.               00160000
      *                                                                 00170000
      *  MARKETPLACE NUMBERS WILL BE WRITTEN, BUT SINCE COMMISSIONS     00180000
      *  AND SELLER AMOUNTS AREN'T INCLUDED IN COSA, THEY CAN NOT       00190000
      *  BE DETERMINED BY THIS PROGRAM.                                 00200000
      *                                                                 00210000
      *  SEPHORA GIFT CARD TENDERS ARE IDENTIFIED BY A COMBINATION OF   00220000
      *  TNDR_TYP_CDE = '13' AND TNDR_ID_SRC_CDE = '14'.                00230000
      *  THEY NEED TO BE EXCLUDED FROM KOHLS GC TENDERS (GDT).          00240000
      *  SEPHORA GIFT CARD SALES ARE IDENTIFIED BY DEPT NUMBER '712'.   00250000
      *                                                                 00260000
      *  FOR VISIBILITY, ROB INITIALLY WANTS ALL TRANSACTIONS MORE      00270000
      *  THAN 3 DAYS OLD TO BE INCLUDED.  THERE COULD BE OOB'S ON THE   00280000
      *  OUTPUT FILE.                                                   00290000
      *  KKT FIELDS WERE INCLUDED IN THE RECORD LAYOUTS, HOWEVER,       00300000
      *  THERE IS NO SELECT OR LOGIC FOR THEM.  KKT REQUIRES CALLS      00301000
      *  TO PROTEGRITY AND THE SV TABLES TO DETERMINE THE GIFT CARD     00301100
      *  TYPE MEANING THIS PROGRAM COULD NO LONGER BE RUN IN TEST       00301200
      *  AGAINST THE PROD TABLES AND ROB SAID THE KKT CATEGORY          00301300
      *  WASN'T NEEDED.                                                 00301400
      *                                                                 00302000
      *  INPUT: INP01 - CONTAINS DATE USED BY QUERIES.                  00310000
      *                 PREVIOUS DAY'S BUSINESS DATE.                   00320000
      *========================== CHANGE LOG ===========================00330000
      * CHANGE NBR   DATE          NAME            DESCRIPTION          00340000
      *=================================================================00350000
      * CHG0286506   03/16/2023    JIM HUNTER      CREATE PROGRAM.      00360003
      *                                                                 00370000
PAYVEN* CHG0288509   05/10/2023    JIM HUNTER      ADD PAYPAL AND VENMO.00371014
      *                                                                 00372003
COBTRL* CHG0297418   01/04/2024    JIM HUNTER      ADD COBRAND TRAILING 00373026
COBTRL*              TRANSACTION LOGIC.  THIS WILL CONVERT KCN AMOUNTS  00374024
COBTRL*              TO CVN AMOUNTS AND KCP AMOUNTS TO CVP AMOUNTS.     00375024
      ******************************************************************00380000
                                                                        00390000
       ENVIRONMENT DIVISION.                                            00400000
       CONFIGURATION SECTION.                                           00410000
                                                                        00420000
       SOURCE-COMPUTER.        IBM-3090.                                00430000
       OBJECT-COMPUTER.        IBM-3090.                                00440000
                                                                        00450000
       INPUT-OUTPUT SECTION.                                            00460000
       FILE-CONTROL.                                                    00470000
                                                                        00480000
           SELECT DATE-FILE-IN              ASSIGN TO INP01.            00490000
           SELECT LATE-GL-CSV-FILE-OUT      ASSIGN TO OUT01.            00500000
                                                                        00510000
       DATA DIVISION.                                                   00520000
       FILE SECTION.                                                    00530000
                                                                        00540000
       FD  DATE-FILE-IN                                                 00550000
           RECORDING MODE IS F                                          00560000
           BLOCK CONTAINS 0 RECORDS                                     00570000
           LABEL RECORDS ARE STANDARD.                                  00580000
       01  DATE-RECORD-IN                   PIC  X(80).                 00590000
                                                                        00600000
       FD  LATE-GL-CSV-FILE-OUT                                         00610000
           RECORDING MODE IS F                                          00620000
           BLOCK CONTAINS 0 RECORDS                                     00630000
           LABEL RECORDS ARE STANDARD.                                  00640000
       01  LATE-GL-CSV-RECORD-OUT           PIC  X(700).                00650006
                                                                        00660000
                                                                        00670000
      ******************************************************************00680000
      *                       WORKING STORAGE                           00690000
      ******************************************************************00700000
       WORKING-STORAGE SECTION.                                         00710000
                                                                        00720000
       01  WS-START                         PIC  X(50)    VALUE         00730000
           ' *** WORKING STORAGE STARTS HERE FOR SAKUT135 *** '.        00740000
                                                                        00750000
      ******************************************************************00760000
      *                          SWITCHES                               00770000
      ******************************************************************00780000
       01  PS-PROGRAM-SWITCHES.                                         00790000
                                                                        00800000
           05  PS-END-OF-CURSOR-SW          PIC  X(01)    VALUE 'N'.    00810000
               88  PS-NOT-END-OF-CURSOR                   VALUE 'N'.    00820000
               88  PS-END-OF-CURSOR                       VALUE 'Y'.    00830000
                                                                        00840000
           05  PS-END-OF-DATE-FILE-SW       PIC  X(01)    VALUE 'N'.    00850000
               88  PS-END-OF-DATE-FILE                    VALUE 'Y'.    00860000
                                                                        00870000
      ******************************************************************00880000
      *                         CONSTANTS                               00890000
      ******************************************************************00900000
       01  PC-CONSTANTS.                                                00910000
           05  PC-PGM-NAME              PIC X(08)  VALUE 'SAKUT135'.    00920000
           05  PC-ROW-NOT-FOUND         PIC S9(04) VALUE +100 COMP.     00930000
           05  PC-NULL                  PIC S9(04) VALUE -305 COMP.     00940000
                                                                        00950000
      ******************************************************************00960000
      *                      ACCUMULATORS                               00970000
      ******************************************************************00980000
       01  PA-ACCUMULATORS.                                             00990000
                                                                        01000000
           05  PA-LATE-CURSOR-CNT           PIC  9(07)    VALUE ZEROS.  01010000
           05  PA-GDS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01020000
           05  PA-TPC-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01030000
           05  PA-TCC-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01040000
           05  PA-BOS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01050000
           05  PA-BSR-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01060000
           05  PA-BPS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01070000
           05  PA-BPR-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01080000
           05  PA-SFS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01090000
           05  PA-KKB-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01100000
           05  PA-KKH-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01110000
           05  PA-KKS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01120000
           05  PA-KKU-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01130000
           05  PA-SHS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01140000
           05  PA-ECR-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01150000
           05  PA-SHR-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01160000
           05  PA-FEE-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01170000
           05  PA-AEN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01180000
           05  PA-BCN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01190000
           05  PA-DBN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01200000
           05  PA-KCN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01210000
           05  PA-NCN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01220000
           05  PA-GDT-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01230000
           05  PA-KMT-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01240000
           05  PA-KMI-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01250000
           05  PA-CASH-SELECT-CNT           PIC  9(07)    VALUE ZEROS.  01260000
           05  PA-CHECK-SELECT-CNT          PIC  9(07)    VALUE ZEROS.  01270000
           05  PA-KCP-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01280000
           05  PA-CRI-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01290000
           05  PA-EMPDISC-SELECT-CNT        PIC  9(07)    VALUE ZEROS.  01300000
           05  PA-KKT-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01310000
           05  PA-SGS-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01320000
           05  PA-SGT-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01330000
           05  PA-MKTPLC-SELECT-CNT         PIC  9(07)    VALUE ZEROS.  01340000
           05  PA-CVN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01350000
           05  PA-CVP-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01360000
PAYVEN     05  PA-PPN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01361004
PAYVEN     05  PA-VMN-SELECT-CNT            PIC  9(07)    VALUE ZEROS.  01362004
           05  PA-GL-FILE-OUT-WRITTEN       PIC  9(07)    VALUE ZEROS.  01370000
                                                                        01380000
       01  DK-DB2-KEYS.                                                 01390000
           05  DK-PROCESS-DATE              PIC X(10)     VALUE SPACES. 01400000
           05  DK-SALES-DATE                PIC X(10)     VALUE SPACES. 01410000
                                                                        01420000
      ******************************************************************01430000
      *                       VARIABLES                                 01440000
      ******************************************************************01450000
       01  PV-VARIABLES.                                                01460000
           05  PV-SQL                       PIC S9(04)    VALUE ZEROS.  01470000
           05  PV-PARAGRAPH-NAME            PIC  X(30)    VALUE SPACES. 01480000
           05  PV-DB2-TABLE-NAME            PIC  X(12)    VALUE SPACES. 01490000
           05  PV-DB2-OPERATION-MSG         PIC  X(60)    VALUE SPACES. 01500000
           05  PV-OPERATION-MSG-1           PIC  X(40)    VALUE SPACES. 01510000
           05  PV-OPERATION-MSG-2           PIC  X(40)    VALUE SPACES. 01520000
           05  PV-DISPLAY-CURSOR-COUNT      PIC ZZZZ9.                  01530000
           05  PV-DISPLAY-SELECT-COUNT      PIC ZZZZ9.                  01540000
           05  PV-DPG52-LK-DATE-INPUT       PIC X(10)     VALUE SPACES. 01550000
           05  PV-STR-NBR                   PIC S9(04) COMP VALUE ZERO. 01560000
           05  PV-DB2-SUM              PIC S9(09)V99 COMP-3 VALUE ZERO. 01570000
                                                                        01580000
      ******************************************************************01590000
      *                        ERROR HANDLING                           01600000
      ******************************************************************01610000
       01  ABEND-CODE                       PIC S9(04)    VALUE ZEROS   01620000
                                                          COMP SYNC.    01630000
           88  ABEND-4001-WRITE-ERROR                     VALUE +4001.  01640000
           88  ABEND-4002-READ-ERROR                      VALUE +4002.  01650000
           88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  01660000
           88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  01670000
           88  ABEND-4005-OPEN-ERROR                      VALUE +4005.  01680000
           88  ABEND-4006-CLOSE-ERROR                     VALUE +4006.  01690000
           88  ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.  01700000
           88  ABEND-4008-DATA-ERROR                      VALUE +4008.  01710000
           88  ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.  01720000
           88  ABEND-4010-CALENDAR-ERROR                  VALUE +4010.  01730000
           88  ABEND-4013-DB2-ERROR                       VALUE +4013.  01740000
           88  ABEND-4019-CAL-SUB-ERROR                   VALUE +4019.  01750000
           88  ABEND-4444-FORCED-ABEND                    VALUE +4444.  01760000
                                                                        01770000
      ******************************************************************01780000
      * RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01790000
      ******************************************************************01800000
       01  CC-CONTROL-CARD.                                             01810000
           05  CC-CONTROL-CARD-DISPLAY.                                 01820000
               10  CC-CONTROL-NAME     PIC  X(14) VALUE SPACE.          01830000
               10  CC-POS-DATE-MMDDYY  PIC  9(06) VALUE ZERO.           01840000
               10  FILLER REDEFINES CC-POS-DATE-MMDDYY.                 01850000
                   15  CC-POS-DATE-MM  PIC  99.                         01860000
                   15  CC-POS-DATE-DD  PIC  99.                         01870000
                   15  CC-POS-DATE-YY  PIC  99.                         01880000
           05 FILLER                   PIC  X(60) VALUE SPACE.          01890000
                                                                        01900000
                                                                        01910000
      ******************************************************************01920000
      * RECORD LAYOUT FOR OUTPUT GL CSV FILE                            01930000
      ******************************************************************01940000
       01  GL-HEADER-RECORD.                                            01950000
           05  GL-HDR-PROCESS-DATE      PIC X(12) VALUE 'PROCESS DATE'. 01960002
           05  FILLER                   PIC X     VALUE ','.            01970002
           05  GL-HDR-SALES-DATE        PIC X(10) VALUE 'SALES DATE'.   01980002
           05  FILLER                   PIC X     VALUE ','.            01990002
           05  GL-HDR-STORE             PIC X(5)  VALUE 'STORE'.        02000000
           05  FILLER                   PIC X     VALUE ','.            02010000
           05  GL-HDR-REGISTER          PIC X(8)  VALUE 'REGISTER'.     02020002
           05  FILLER                   PIC X     VALUE ','.            02030002
           05  GL-HDR-TRAN              PIC X(4)  VALUE 'TRAN'.         02040002
           05  FILLER                   PIC X     VALUE ','.            02050002
           05  GL-HDR-START-TIME        PIC X(10) VALUE 'START TIME'.   02060002
           05  FILLER                   PIC X     VALUE ','.            02070002
           05  GL-HDR-CORR-SEQ-NBR      PIC X(12) VALUE 'CORR SEQ NBR'. 02080002
           05  FILLER                   PIC X     VALUE ','.            02090002
           05  GL-HDR-PARTN-NBR         PIC X(5)  VALUE 'PARTN'.        02100002
           05  FILLER                   PIC X     VALUE ','.            02110002
           05  GL-HDR-STATUS            PIC X(6)  VALUE 'STATUS'.       02120002
           05  FILLER                   PIC X     VALUE ','.            02130002
           05  GL-HDR-TYPE-CODE         PIC X(9)  VALUE 'SALE TYPE'.    02140002
           05  FILLER                   PIC X     VALUE ','.            02150002
           05  GL-HDR-TRAN-AMT          PIC X(9)  VALUE 'TRAN AMT'.     02160002
           05  FILLER                   PIC X     VALUE ','.            02170002
           05  GL-HDR-SALES             PIC X(5)  VALUE 'SALES'.        02180000
           05  FILLER                   PIC X     VALUE ','.            02190000
           05  GL-HDR-GDS               PIC X(3)  VALUE 'GDS'.          02200000
           05  FILLER                   PIC X     VALUE ','.            02210000
           05  GL-HDR-TPC               PIC X(3)  VALUE 'TPC'.          02220000
           05  FILLER                   PIC X     VALUE ','.            02230000
           05  GL-HDR-TCC               PIC X(3)  VALUE 'TCC'.          02240000
           05  FILLER                   PIC X     VALUE ','.            02250000
           05  GL-HDR-SGS               PIC X(3)  VALUE 'SGS'.          02260002
           05  FILLER                   PIC X     VALUE ','.            02270002
           05  GL-HDR-BOS               PIC X(3)  VALUE 'BOS'.          02280000
           05  FILLER                   PIC X     VALUE ','.            02290000
           05  GL-HDR-BPS               PIC X(3)  VALUE 'BPS'.          02300000
           05  FILLER                   PIC X     VALUE ','.            02310000
           05  GL-HDR-SFS               PIC X(3)  VALUE 'SFS'.          02320000
           05  FILLER                   PIC X     VALUE ','.            02330000
           05  GL-HDR-MKTPLC            PIC X(6)  VALUE 'MKTPLC'.       02340002
           05  FILLER                   PIC X     VALUE ','.            02350002
           05  GL-HDR-KKB               PIC X(3)  VALUE 'KKB'.          02360000
           05  FILLER                   PIC X     VALUE ','.            02370000
           05  GL-HDR-KKH               PIC X(3)  VALUE 'KKH'.          02380000
           05  FILLER                   PIC X     VALUE ','.            02390000
           05  GL-HDR-KKS               PIC X(3)  VALUE 'KKS'.          02400000
           05  FILLER                   PIC X     VALUE ','.            02410000
           05  GL-HDR-KKU               PIC X(3)  VALUE 'KKU'.          02420000
           05  FILLER                   PIC X     VALUE ','.            02430000
           05  GL-HDR-SHS               PIC X(3)  VALUE 'SHS'.          02440000
           05  FILLER                   PIC X     VALUE ','.            02450000
           05  GL-HDR-STM               PIC X(3)  VALUE 'STM'.          02460000
           05  FILLER                   PIC X     VALUE ','.            02470000
           05  GL-HDR-RETURNS           PIC X(7)  VALUE 'RETURNS'.      02480000
           05  FILLER                   PIC X     VALUE ','.            02490000
           05  GL-HDR-BSR               PIC X(3)  VALUE 'BSR'.          02500000
           05  FILLER                   PIC X     VALUE ','.            02510000
           05  GL-HDR-BPR               PIC X(3)  VALUE 'BPR'.          02520000
           05  FILLER                   PIC X     VALUE ','.            02530000
           05  GL-HDR-ECR               PIC X(3)  VALUE 'ECR'.          02540000
           05  FILLER                   PIC X     VALUE ','.            02550000
           05  GL-HDR-SHR               PIC X(3)  VALUE 'SHR'.          02560000
           05  FILLER                   PIC X     VALUE ','.            02570000
           05  GL-HDR-TMR               PIC X(3)  VALUE 'TMR'.          02580000
           05  FILLER                   PIC X     VALUE ','.            02590000
           05  GL-HDR-TAX               PIC X(3)  VALUE 'TAX'.          02600000
           05  FILLER                   PIC X     VALUE ','.            02610000
           05  GL-HDR-FEE               PIC X(3)  VALUE 'FEE'.          02620000
           05  FILLER                   PIC X     VALUE ','.            02630000
           05  GL-HDR-AEN               PIC X(3)  VALUE 'AEN'.          02640000
           05  FILLER                   PIC X     VALUE ','.            02650000
           05  GL-HDR-BCN               PIC X(3)  VALUE 'BCN'.          02660000
           05  FILLER                   PIC X     VALUE ','.            02670000
           05  GL-HDR-DBN               PIC X(3)  VALUE 'DBN'.          02680000
           05  FILLER                   PIC X     VALUE ','.            02690000
           05  GL-HDR-KCN               PIC X(3)  VALUE 'KCN'.          02700000
           05  FILLER                   PIC X     VALUE ','.            02710000
           05  GL-HDR-CVN               PIC X(3)  VALUE 'CVN'.          02720002
           05  FILLER                   PIC X     VALUE ','.            02730002
           05  GL-HDR-NCN               PIC X(3)  VALUE 'NCN'.          02740000
           05  FILLER                   PIC X     VALUE ','.            02750000
PAYVEN     05  GL-HDR-PPN               PIC X(3)  VALUE 'PPN'.          02751004
PAYVEN     05  FILLER                   PIC X     VALUE ','.            02752004
PAYVEN     05  GL-HDR-VMN               PIC X(3)  VALUE 'VMN'.          02753004
PAYVEN     05  FILLER                   PIC X     VALUE ','.            02754004
           05  GL-HDR-GDT               PIC X(3)  VALUE 'GDT'.          02760000
           05  FILLER                   PIC X     VALUE ','.            02770000
           05  GL-HDR-SGT               PIC X(3)  VALUE 'SGT'.          02780002
           05  FILLER                   PIC X     VALUE ','.            02790002
           05  GL-HDR-KKT               PIC X(3)  VALUE 'KKT'.          02800000
           05  FILLER                   PIC X     VALUE ','.            02810000
           05  GL-HDR-GDTT              PIC X(4)  VALUE 'GDTT'.         02820000
           05  FILLER                   PIC X     VALUE ','.            02830000
           05  GL-HDR-KMT               PIC X(3)  VALUE 'KMT'.          02840000
           05  FILLER                   PIC X     VALUE ','.            02850000
           05  GL-HDR-KMI               PIC X(3)  VALUE 'KMI'.          02860000
           05  FILLER                   PIC X     VALUE ','.            02870000
           05  GL-HDR-CASH              PIC X(4)  VALUE 'CASH'.         02880000
           05  FILLER                   PIC X     VALUE ','.            02890000
           05  GL-HDR-CHECK             PIC X(5)  VALUE 'CHECK'.        02900000
           05  FILLER                   PIC X     VALUE ','.            02910000
           05  GL-HDR-KCP               PIC X(3)  VALUE 'KCP'.          02920000
           05  FILLER                   PIC X     VALUE ','.            02930000
           05  GL-HDR-CVP               PIC X(3)  VALUE 'CVP'.          02940002
           05  FILLER                   PIC X     VALUE ','.            02950002
           05  GL-HDR-CRI               PIC X(3)  VALUE 'CRI'.          02960000
           05  FILLER                   PIC X     VALUE ','.            02970000
           05  GL-HDR-EMPDISC           PIC X(8)  VALUE 'EMP DISC'.     02980000
           05  FILLER                   PIC X     VALUE ','.            02990000
                                                                        03000000
       01  GL-WS-RECORD.                                                03010000
           05  GL-WS-PROCESS-DATE       PIC X(10).                      03020002
           05  GL-WS-SALES-DATE         PIC X(10).                      03021002
           05  GL-WS-STORE              PIC 9(4).                       03022000
           05  GL-WS-REGISTER           PIC 9(4).                       03023002
           05  GL-WS-TRAN               PIC 9(4).                       03024002
           05  GL-WS-START-TIME         PIC X(8).                       03025002
           05  GL-WS-CORR-SEQ-NBR       PIC S9(2).                      03026002
           05  GL-WS-PARTN-NBR          PIC 9(4).                       03027002
           05  GL-WS-STATUS             PIC X(2).                       03028002
           05  GL-WS-TYPE-CODE          PIC X(2).                       03029002
           05  GL-WS-TRAN-AMT           PIC S9(9)V99.                   03030000
           05  GL-WS-SALES              PIC S9(9)V99.                   03040000
           05  GL-WS-GDS                PIC S9(9)V99.                   03050000
           05  GL-WS-TPC                PIC S9(9)V99.                   03060000
           05  GL-WS-TCC                PIC S9(9)V99.                   03070000
           05  GL-WS-SGS                PIC S9(9)V99.                   03071002
           05  GL-WS-BOS                PIC S9(9)V99.                   03072000
           05  GL-WS-BPS                PIC S9(9)V99.                   03073000
           05  GL-WS-SFS                PIC S9(9)V99.                   03074000
           05  GL-WS-MKTPLC             PIC S9(9)V99.                   03075002
           05  GL-WS-KKB                PIC S9(9)V99.                   03076000
           05  GL-WS-KKH                PIC S9(9)V99.                   03077000
           05  GL-WS-KKS                PIC S9(9)V99.                   03078000
           05  GL-WS-KKU                PIC S9(9)V99.                   03079000
           05  GL-WS-SHS                PIC S9(9)V99.                   03080000
           05  GL-WS-STM                PIC S9(9)V99.                   03090000
           05  GL-WS-RETURNS            PIC S9(9)V99.                   03100000
           05  GL-WS-BSR                PIC S9(9)V99.                   03110000
           05  GL-WS-BPR                PIC S9(9)V99.                   03120000
           05  GL-WS-ECR                PIC S9(9)V99.                   03130000
           05  GL-WS-SHR                PIC S9(9)V99.                   03140000
           05  GL-WS-TMR                PIC S9(9)V99.                   03150000
           05  GL-WS-TAX                PIC S9(9)V99.                   03160000
           05  GL-WS-FEE                PIC S9(9)V99.                   03170000
           05  GL-WS-AEN                PIC S9(9)V99.                   03180000
           05  GL-WS-BCN                PIC S9(9)V99.                   03190000
           05  GL-WS-DBN                PIC S9(9)V99.                   03200000
           05  GL-WS-KCN                PIC S9(9)V99.                   03210000
           05  GL-WS-CVN                PIC S9(9)V99.                   03220002
           05  GL-WS-NCN                PIC S9(9)V99.                   03230000
PAYVEN     05  GL-WS-PPN                PIC S9(9)V99.                   03231004
PAYVEN     05  GL-WS-VMN                PIC S9(9)V99.                   03232004
           05  GL-WS-GDT                PIC S9(9)V99.                   03240000
           05  GL-WS-SGT                PIC S9(9)V99.                   03250002
           05  GL-WS-KKT                PIC S9(9)V99.                   03260000
           05  GL-WS-GDTT               PIC S9(9)V99.                   03270000
           05  GL-WS-KMT                PIC S9(9)V99.                   03280000
           05  GL-WS-KMI                PIC S9(9)V99.                   03290000
           05  GL-WS-CASH               PIC S9(9)V99.                   03300000
           05  GL-WS-CHECK              PIC S9(9)V99.                   03310000
           05  GL-WS-KCP                PIC S9(9)V99.                   03320000
           05  GL-WS-CVP                PIC S9(9)V99.                   03330002
           05  GL-WS-CRI                PIC S9(9)V99.                   03340000
           05  GL-WS-EMPDISC            PIC S9(9)V99.                   03350000
                                                                        03360000
       01  GL-RECORD-OUT.                                               03370000
           05  GL-PROCESS-DATE      PIC X(10).                          03380002
           05  FILLER               PIC X           VALUE ','.          03390002
           05  GL-SALES-DATE        PIC X(10).                          03400002
           05  FILLER               PIC X           VALUE ','.          03410002
           05  GL-STORE             PIC 9(4).                           03420000
           05  FILLER               PIC X           VALUE ','.          03430000
           05  GL-REGISTER          PIC 9(4).                           03431002
           05  FILLER               PIC X           VALUE ','.          03431102
           05  GL-TRAN              PIC 9(4).                           03431202
           05  FILLER               PIC X           VALUE ','.          03431302
           05  GL-START-TIME        PIC X(8).                           03431402
           05  FILLER               PIC X           VALUE ','.          03431502
           05  GL-CORR-SEQ-NBR      PIC -9(2).                          03431602
           05  FILLER               PIC X           VALUE ','.          03431702
           05  GL-PARTN-NBR         PIC 9(4).                           03431802
           05  FILLER               PIC X           VALUE ','.          03431902
           05  GL-STATUS            PIC X(2).                           03432002
           05  FILLER               PIC X           VALUE ','.          03433002
           05  GL-TYPE-CODE         PIC X(2).                           03434002
           05  FILLER               PIC X           VALUE ','.          03435002
           05  GL-TRAN-AMT          PIC -9(9).99.                       03436002
           05  FILLER               PIC X           VALUE ','.          03437002
           05  GL-SALES             PIC -9(9).99.                       03438000
           05  FILLER               PIC X           VALUE ','.          03439000
           05  GL-GDS               PIC -9(9).99.                       03440000
           05  FILLER               PIC X           VALUE ','.          03450000
           05  GL-TPC               PIC -9(9).99.                       03460000
           05  FILLER               PIC X           VALUE ','.          03470000
           05  GL-TCC               PIC -9(9).99.                       03480000
           05  FILLER               PIC X           VALUE ','.          03490000
           05  GL-SGS               PIC -9(9).99.                       03500002
           05  FILLER               PIC X           VALUE ','.          03510002
           05  GL-BOS               PIC -9(9).99.                       03520000
           05  FILLER               PIC X           VALUE ','.          03530000
           05  GL-BPS               PIC -9(9).99.                       03540000
           05  FILLER               PIC X           VALUE ','.          03550000
           05  GL-SFS               PIC -9(9).99.                       03560000
           05  FILLER               PIC X           VALUE ','.          03560100
           05  GL-MKTPLC            PIC -9(9).99.                       03560202
           05  FILLER               PIC X           VALUE ','.          03560302
           05  GL-KKB               PIC -9(9).99.                       03560400
           05  FILLER               PIC X           VALUE ','.          03560500
           05  GL-KKH               PIC -9(9).99.                       03560600
           05  FILLER               PIC X           VALUE ','.          03560700
           05  GL-KKS               PIC -9(9).99.                       03560800
           05  FILLER               PIC X           VALUE ','.          03560900
           05  GL-KKU               PIC -9(9).99.                       03561000
           05  FILLER               PIC X           VALUE ','.          03562000
           05  GL-SHS               PIC -9(9).99.                       03563000
           05  FILLER               PIC X           VALUE ','.          03564000
           05  GL-STM               PIC -9(9).99.                       03565000
           05  FILLER               PIC X           VALUE ','.          03566000
           05  GL-RETURNS           PIC -9(9).99.                       03567000
           05  FILLER               PIC X           VALUE ','.          03568000
           05  GL-BSR               PIC -9(9).99.                       03569000
           05  FILLER               PIC X           VALUE ','.          03570000
           05  GL-BPR               PIC -9(9).99.                       03580000
           05  FILLER               PIC X           VALUE ','.          03590000
           05  GL-ECR               PIC -9(9).99.                       03600000
           05  FILLER               PIC X           VALUE ','.          03610000
           05  GL-SHR               PIC -9(9).99.                       03620000
           05  FILLER               PIC X           VALUE ','.          03630000
           05  GL-TMR               PIC -9(9).99.                       03640000
           05  FILLER               PIC X           VALUE ','.          03650000
           05  GL-TAX               PIC -9(9).99.                       03660000
           05  FILLER               PIC X           VALUE ','.          03670000
           05  GL-FEE               PIC -9(9).99.                       03680000
           05  FILLER               PIC X           VALUE ','.          03690000
           05  GL-AEN               PIC -9(9).99.                       03700000
           05  FILLER               PIC X           VALUE ','.          03710000
           05  GL-BCN               PIC -9(9).99.                       03720000
           05  FILLER               PIC X           VALUE ','.          03730000
           05  GL-DBN               PIC -9(9).99.                       03740000
           05  FILLER               PIC X           VALUE ','.          03750000
           05  GL-KCN               PIC -9(9).99.                       03760000
           05  FILLER               PIC X           VALUE ','.          03770000
           05  GL-CVN               PIC -9(9).99.                       03780002
           05  FILLER               PIC X           VALUE ','.          03790002
           05  GL-NCN               PIC -9(9).99.                       03800000
           05  FILLER               PIC X           VALUE ','.          03810000
PAYVEN     05  GL-PPN               PIC -9(9).99.                       03811004
PAYVEN     05  FILLER               PIC X           VALUE ','.          03812004
PAYVEN     05  GL-VMN               PIC -9(9).99.                       03813004
PAYVEN     05  FILLER               PIC X           VALUE ','.          03814004
           05  GL-GDT               PIC -9(9).99.                       03820000
           05  FILLER               PIC X           VALUE ','.          03830000
           05  GL-SGT               PIC -9(9).99.                       03840002
           05  FILLER               PIC X           VALUE ','.          03850002
           05  GL-KKT               PIC -9(9).99.                       03860000
           05  FILLER               PIC X           VALUE ','.          03870000
           05  GL-GDTT              PIC -9(9).99.                       03880000
           05  FILLER               PIC X           VALUE ','.          03890000
           05  GL-KMT               PIC -9(9).99.                       03900000
           05  FILLER               PIC X           VALUE ','.          03910000
           05  GL-KMI               PIC -9(9).99.                       03920000
           05  FILLER               PIC X           VALUE ','.          03930000
           05  GL-CASH              PIC -9(9).99.                       03940000
           05  FILLER               PIC X           VALUE ','.          03950000
           05  GL-CHECK             PIC -9(9).99.                       03960000
           05  FILLER               PIC X           VALUE ','.          03970000
           05  GL-KCP               PIC -9(9).99.                       03980000
           05  FILLER               PIC X           VALUE ','.          03990000
           05  GL-CVP               PIC -9(9).99.                       04000002
           05  FILLER               PIC X           VALUE ','.          04010002
           05  GL-CRI               PIC -9(9).99.                       04020000
           05  FILLER               PIC X           VALUE ','.          04030000
           05  GL-EMPDISC           PIC -9(9).99.                       04040000
           05  FILLER               PIC X           VALUE ','.          04050000
                                                                        04060000
                                                                        04070000
      ******************************************************************04080000
      *  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             04090000
      ******************************************************************04100000
           COPY DPWS500.                                                04110000
                                                                        04120000
      ******************************************************************04130000
      *  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            04140000
      ******************************************************************04150000
           COPY DPWS004.                                                04160000
                                                                        04170000
      ******************************************************************04180000
      *  DB2 MESSAGE AREA                                               04190000
      ******************************************************************04200000
           COPY SQLCA2.                                                 04210000
                                                                        04220000
      ******************************************************************04230000
      *  DB2 COMMUNICATION AREA.                                        04240000
      ******************************************************************04250000
           EXEC SQL                                                     04260000
                INCLUDE SQLCA                                           04270000
           END-EXEC.                                                    04280000
                                                                        04290000
      ******************************************************************04300000
      *    DB2 TABLE TEPDKEY - COSA-PROCESSING DAY KEY TABLE            04310000
      ******************************************************************04320000
           EXEC SQL                                                     04330000
                INCLUDE TEPDKEY                                         04340002
           END-EXEC.                                                    04350000
                                                                        04360000
      ******************************************************************04370000
      *  DB2 TABLE XST_LOC - STORE LOCATION TABLE                       04380000
      ******************************************************************04390000
           EXEC SQL                                                     04400000
                INCLUDE XST00001                                        04410000
           END-EXEC.                                                    04420000
                                                                        04430000
      ******************************************************************04440000
      *  DB2 TABLE TEPPART - PARTITION TABLE                            04450000
      ******************************************************************04460000
           EXEC SQL                                                     04470000
                INCLUDE TEPPART                                         04480000
           END-EXEC.                                                    04490000
                                                                        04500000
      ******************************************************************04510000
      *  DB2 TABLE TEPTRN - TRANSACTION TABLE                           04520000
      ******************************************************************04530000
           EXEC SQL                                                     04540000
                INCLUDE TEPTRN                                          04550000
           END-EXEC.                                                    04560000
                                                                        04570000
      ******************************************************************04580000
      *  DB2 TABLE TEPITM - ITEM TABLE                                  04590000
      ******************************************************************04600000
           EXEC SQL                                                     04610000
                INCLUDE TEPITM                                          04620000
           END-EXEC.                                                    04630000
                                                                        04640000
      ******************************************************************04650000
      *  DB2 TABLE TEPTND - TENDER TABLE                                04660000
      ******************************************************************04670000
           EXEC SQL                                                     04680000
                INCLUDE TEPTND                                          04690000
           END-EXEC.                                                    04700000
                                                                        04710000
COBTRL******************************************************************04711017
COBTRL*  DB2 TABLE TEPCRD - CREDIT TENDER TABLE                         04712017
COBTRL******************************************************************04713017
COBTRL     EXEC SQL                                                     04714017
COBTRL          INCLUDE TEPCRD                                          04715017
COBTRL     END-EXEC.                                                    04716017
COBTRL                                                                  04717017
      ******************************************************************04720000
      *  DB2 TABLE TEPIRT - ITEM RETURN INFO TABLE                      04730000
      ******************************************************************04740000
           EXEC SQL                                                     04750000
                INCLUDE TEPIRT                                          04760000
           END-EXEC.                                                    04770000
                                                                        04780000
      ******************************************************************04790000
      *  DB2 TABLE TEPSHP - SHIPPING TABLE                              04800000
      ******************************************************************04810000
           EXEC SQL                                                     04820000
                INCLUDE TEPSHP                                          04830000
           END-EXEC.                                                    04840000
                                                                        04850000
      ******************************************************************04860000
      *  DB2 TABLE TEPLIS - LINE ITEM SPECIAL SERVICES TABLE            04870000
      ******************************************************************04880000
           EXEC SQL                                                     04890000
                INCLUDE TEPLIS                                          04900000
           END-EXEC.                                                    04910000
                                                                        04920000
      ******************************************************************04930000
      *  DB2 TABLE TEPPAY - KOHLS CHARGE PAYMENT TABLE                  04940000
      ******************************************************************04950000
           EXEC SQL                                                     04960000
                INCLUDE TEPPAY                                          04970000
           END-EXEC.                                                    04980000
                                                                        04990000
      ******************************************************************05000000
      *  DB2 TABLE TEPRFN - CORP REFUND TABLE                           05010000
      ******************************************************************05020000
           EXEC SQL                                                     05030000
                INCLUDE TEPRFN                                          05040000
           END-EXEC.                                                    05050000
                                                                        05060000
      ******************************************************************05070000
      *  DB2 TABLE TEPEID - EMPLOYEE ITEM DISCOUNT TABLE                05080000
      ******************************************************************05090000
           EXEC SQL                                                     05100000
                INCLUDE TEPEID                                          05110000
           END-EXEC.                                                    05120000
                                                                        05130000
      ******************************************************************05140000
      *  DB2 TABLE TSASUM - SALES AUDIT SUMMARY TOTALS TABLE            05150000
      ******************************************************************05160000
           EXEC SQL                                                     05170000
                INCLUDE TSASUM                                          05180000
           END-EXEC.                                                    05190000
                                                                        05200000
      ******************************************************************05210000
      *  DB2 TABLE GCT00005 - GCT_VND_COMMS TABLE                       05220000
      ******************************************************************05230000
           EXEC SQL                                                     05240000
                INCLUDE GCT00005                                        05250000
           END-EXEC.                                                    05260000
                                                                        05270000
      ******************************************************************05280000
      *  LATE-CURSOR -- CURSOR TO GET TRANS > 3 DAYS LATE               05290000
      ******************************************************************05300000
           EXEC SQL                                                     05312100
             DECLARE LATE-CURSOR  CURSOR FOR                            05312224
               SELECT  D.PRCG_DTE                                       05312422
                      ,D.SLS_DTE                                        05312522
                      ,D.STR_NBR                                        05312622
                      ,D.RGST_ID                                        05312722
                      ,D.TRN_NBR                                        05312822
                      ,D.STRT_TM                                        05312922
                      ,D.SLS_CORR_SEQ_NBR                               05313022
                      ,T.PARTN_NBR                                      05313122
                      ,T.TRN_STAT_CDE                                   05313222
                      ,T.TRN_TYP_CDE                                    05313322
                      ,T.TRN_TOT_AMT                                    05313422
                      ,T.SLS_TX_AMT                                     05313522
                 FROM  TEPDKEY D                                        05313622
                      ,TEPTRN  T                                        05313722
                      ,TEPPART P                                        05313822
                WHERE P.PARTN_NBR        = T.PARTN_NBR                  05313922
                  AND D.SLS_DTE          = P.SLS_DTE                    05314022
                  AND D.STR_NBR          = T.STR_NBR                    05314122
                  AND D.RGST_ID          = T.RGST_ID                    05314222
                  AND D.TRN_NBR          = T.TRN_NBR                    05314322
                  AND D.STRT_TM          = T.STRT_TM                    05314422
                  AND D.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR           05314522
                  AND D.PRCG_DTE         = :DK-PROCESS-DATE             05314608
                  AND D.SLS_DTE          < D.PRCG_DTE - 3 DAYS          05314708
                  AND D.SLS_CORR_SEQ_NBR < 1                            05315007
                  AND T.TRN_TOT_AMT       <> 0                          05315107
                  AND T.VOID_ABRT_CDE    = 'N'                          05315207
      ***         AND T.TRN_STAT_CDE    IN ('Z', 'L', 'V')              05315308
                  AND T.TRN_TYP_CDE     IN ('01','02','11','12','24',   05315407
                                        '25','30')                      05315507
                  AND T.TRN_STAT_CDE    <> 'U'                          05315607
             WITH UR                                                    05315707
           END-EXEC.                                                    05315807
                                                                        05315907
                                                                        05326022
       PROCEDURE DIVISION.                                              05330000
      ******************************************************************05340000
      * MAINLINE                                                        05350000
      ******************************************************************05360000
       0000-MAINLINE-PARAGRAPH.                                         05370000
                                                                        05380000
           PERFORM 1000-INITIALIZE-PROGRAM.                             05390000
                                                                        05400000
           PERFORM 2000-PROCESS-LATE-QUERY.                             05410000
                                                                        05420000
           PERFORM 9900-END-PROC.                                       05430000
                                                                        05440000
           STOP RUN.                                                    05450000
                                                                        05460000
                                                                        05470000
      ******************************************************************05480000
      * OPEN FILES, PROCESS CONTROL CARD, INITIALIZE WS TABLE.          05490000
      ******************************************************************05500000
       1000-INITIALIZE-PROGRAM.                                         05510000
                                                                        05520000
           OPEN INPUT  DATE-FILE-IN.                                    05530000
           OPEN OUTPUT LATE-GL-CSV-FILE-OUT.                            05540000
                                                                        05550000
           PERFORM 1100-PROCESS-DATE-CONTROL-CARD.                      05560000
                                                                        05570000
           INITIALIZE GL-WS-RECORD.                                     05580000
                                                                        05590000
      ******************************************************************05600000
      * READ CONTROL CARD TO GET START AND END DATES.                   05610000
      * CALL DATE ROUTINE TO VALIDATE BOTH DATES.                       05620000
      ******************************************************************05630000
       1100-PROCESS-DATE-CONTROL-CARD.                                  05640000
                                                                        05650000
           PERFORM 1110-READ-DATE-FILE.                                 05660000
                                                                        05670000
           IF PS-END-OF-DATE-FILE                                       05680000
               MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   05690000
               MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  05700000
                                                                        05710000
               SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   05720000
               PERFORM 9200-ABEND                                       05730000
           END-IF.                                                      05740000
                                                                        05750000
           CLOSE DATE-FILE-IN.                                          05760000
                                                                        05770000
                                                                        05780000
      ******************************************************************05790000
      * READ DATE CONTROL CARD.                                         05800000
      ******************************************************************05810000
       1110-READ-DATE-FILE.                                             05820000
                                                                        05830000
           READ DATE-FILE-IN INTO CC-CONTROL-CARD                       05840000
              AT END                                                    05850000
                  SET PS-END-OF-DATE-FILE TO TRUE                       05860000
              NOT AT END                                                05870000
                  PERFORM 1115-CONVERT-INPUT-DATE                       05880000
                                                                        05890000
                  DISPLAY '** CONTROL CARD = ' CC-CONTROL-CARD.         05900000
                                                                        05910000
                                                                        05920000
      ******************************************************************05930000
      * CALL KOHLS CALENDAR ROUTINE:                                    05940000
      *     PASS: CONTROL CARD DATE (MM-DD-YY FORMAT).                  05950000
      *   RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT).     05960000
      ******************************************************************05970000
      ******************************************************************05980000
       1115-CONVERT-INPUT-DATE.                                         05990000
                                                                        06000000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06010000
                                                                        06020000
           SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     06030000
           SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     06040000
           SET DPG52-LK-DTE-GREG           TO TRUE.                     06050000
                                                                        06060000
           MOVE CC-POS-DATE-MMDDYY         TO DPG52-LK-DATE-INPUT.      06070000
                                                                        06080000
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06090000
                                                   DPG54 DPG55 DPG56.   06100000
                                                                        06110000
           EVALUATE TRUE                                                06120000
              WHEN DPG54-SEVERE-ERROR                                   06130000
              WHEN DPG54-DATE-INVALID                                   06140000
                 MOVE '1115-CONVERT-INPUT-DATE' TO PV-PARAGRAPH-NAME    06150000
                 MOVE 'INPUT DATE ERROR'        TO PV-OPERATION-MSG-1   06160000
                 SET ABEND-4010-CALENDAR-ERROR  TO TRUE                 06170000
                 MOVE DPG54-ERROR-MESSAGE       TO PV-OPERATION-MSG-2   06180000
                 PERFORM 9200-ABEND                                     06190000
           END-EVALUATE.                                                06200000
                                                                        06210000
           MOVE DPG55-DB2-ISO-DATE-FMT     TO DK-PROCESS-DATE.          06220000
                                                                        06230000
                                                                        06240000
      ******************************************************************06250000
      * 2000-PROCESS-LATE-QUERY.                                        06260000
      *     - OPEN, FETCH & CLOSE LATE CURSOR                           06270000
      *     - MOVE THE RESULTS TO THE GL WS TABLE.                      06280000
      *     - FOR EACH LATE TRAN, PROCESS THE CATEGORY QUERIES (4000-)  06290000
      ******************************************************************06300000
       2000-PROCESS-LATE-QUERY.                                         06310000
           SET PS-NOT-END-OF-CURSOR  TO TRUE.                           06320000
           PERFORM 2005-OPEN-LATE-CURSOR.                               06330000
           PERFORM 2010-FETCH-LATE-CURSOR                               06340000
              UNTIL PS-END-OF-CURSOR.                                   06350000
           PERFORM 2015-CLOSE-LATE-CURSOR.                              06360000
                                                                        06370000
                                                                        06380000
      ******************************************************************06390000
      *  OPEN THE LATE-CURSOR                                           06400000
      ******************************************************************06410000
       2005-OPEN-LATE-CURSOR.                                           06420000
                                                                        06430000
           EXEC SQL                                                     06440000
                OPEN LATE-CURSOR                                        06450000
           END-EXEC.                                                    06460000
                                                                        06470000
           EVALUATE TRUE                                                06480000
               WHEN SQLCODE = ZERO                                      06490000
                   CONTINUE                                             06500000
               WHEN SQLWARN0 NOT EQUAL SPACE                            06510000
               WHEN SQLCODE NOT EQUAL ZERO                              06520000
                   MOVE SQLCODE TO PV-SQL                               06530000
                   MOVE '2005-OPEN-LATE-CURSOR' TO PV-PARAGRAPH-NAME    06540000
                   STRING 'ERROR OPENING LATE-CURSOR - SQLCODE = '      06550000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG06560000
                   END-STRING                                           06570000
                   SET ABEND-4005-OPEN-ERROR TO TRUE                    06580000
                   PERFORM 9100-SQL-ABEND                               06590000
           END-EVALUATE.                                                06600000
                                                                        06610000
      ******************************************************************06620000
      *  FETCH THE LATE CURSOR.                                         06630000
      ******************************************************************06640000
       2010-FETCH-LATE-CURSOR.                                          06650000
                                                                        06660000
           EXEC SQL                                                     06670000
                FETCH LATE-CURSOR                                       06680000
                 INTO :EPTRN-PRCG-DTE                                   06690000
                     ,:EPTRN-SLS-DTE                                    06700000
                     ,:EPTRN-STR-NBR                                    06710000
                     ,:EPTRN-RGST-ID                                    06720000
                     ,:EPTRN-TRN-NBR                                    06730000
                     ,:EPTRN-STRT-TM                                    06740000
                     ,:EPTRN-SLS-CORR-SEQ-NBR                           06750000
                     ,:EPTRN-PARTN-NBR                                  06760000
                     ,:EPTRN-TRN-STAT-CDE                               06770000
                     ,:EPTRN-TRN-TYP-CDE                                06780000
                     ,:EPTRN-TRN-TOT-AMT                                06790000
                     ,:EPTRN-SLS-TX-AMT                                 06800000
           END-EXEC.                                                    06810000
                                                                        06820000
           EVALUATE TRUE                                                06830000
               WHEN SQLCODE = ZERO                                      06840000
                   ADD 1 TO PA-LATE-CURSOR-CNT                          06850000
                   PERFORM 2020-PROCESS-LATE-TRANS                      06860000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          06870000
                   SET PS-END-OF-CURSOR TO TRUE                         06880000
               WHEN SQLWARN0 NOT EQUAL SPACE                            06890000
               WHEN SQLCODE NOT EQUAL ZERO                              06900000
                   MOVE SQLCODE TO PV-SQL                               06910000
                   MOVE '2010-FETCH-LATE-CURSOR' TO PV-PARAGRAPH-NAME   06920000
                   STRING 'ERROR FETCHING LATE-CURSOR - SQLCODE = '     06930000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG06940000
                   END-STRING                                           06950000
                   SET ABEND-4002-READ-ERROR TO TRUE                    06960000
                   PERFORM 9100-SQL-ABEND                               06970000
           END-EVALUATE.                                                06980000
                                                                        06990000
      ******************************************************************07000000
      *  CLOSE THE LATE CURSOR.                                         07010000
      ******************************************************************07020000
       2015-CLOSE-LATE-CURSOR.                                          07030000
                                                                        07040000
           EXEC SQL                                                     07050000
                CLOSE LATE-CURSOR                                       07060000
           END-EXEC.                                                    07070000
                                                                        07080000
           EVALUATE TRUE                                                07090000
               WHEN SQLCODE = ZERO                                      07100000
                    CONTINUE                                            07110000
               WHEN SQLWARN0 NOT EQUAL SPACE                            07120000
               WHEN SQLCODE NOT EQUAL ZERO                              07130000
                   MOVE SQLCODE TO PV-SQL                               07140000
                   MOVE '2015-CLOSE-LATE-CURSOR' TO PV-PARAGRAPH-NAME   07150000
                   STRING 'ERROR CLOSING LATE-CURSOR - SQLCODE = '      07160000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG07170000
                   END-STRING                                           07180000
                   SET ABEND-4006-CLOSE-ERROR TO TRUE                   07190000
                   PERFORM 9100-SQL-ABEND                               07200000
           END-EVALUATE.                                                07210000
                                                                        07220000
                                                                        07230000
      ******************************************************************07240000
      *  PROCESS THE LATE TRANSACTION.                                  07250000
      ******************************************************************07260000
       2020-PROCESS-LATE-TRANS.                                         07270000
           MOVE EPTRN-PRCG-DTE          TO GL-WS-PROCESS-DATE.          07280000
           MOVE EPTRN-SLS-DTE           TO GL-WS-SALES-DATE             07290000
                                           DK-SALES-DATE.               07300000
           MOVE EPTRN-STR-NBR           TO GL-WS-STORE.                 07310000
           MOVE EPTRN-RGST-ID           TO GL-WS-REGISTER.              07320000
           MOVE EPTRN-TRN-NBR           TO GL-WS-TRAN.                  07330000
           MOVE EPTRN-STRT-TM           TO GL-WS-START-TIME.            07340000
           MOVE EPTRN-SLS-CORR-SEQ-NBR  TO GL-WS-CORR-SEQ-NBR.          07350000
           MOVE EPTRN-PARTN-NBR         TO GL-WS-PARTN-NBR.             07360000
           MOVE EPTRN-TRN-STAT-CDE      TO GL-WS-STATUS.                07370000
           MOVE EPTRN-TRN-TYP-CDE       TO GL-WS-TYPE-CODE.             07380000
           MOVE EPTRN-TRN-TOT-AMT       TO GL-WS-TRAN-AMT.              07390000
           IF  EPTRN-TRN-TYP-CDE = '01' OR '02'                         07400000
               SUBTRACT EPTRN-SLS-TX-AMT FROM EPTRN-TRN-TOT-AMT         07410000
                                                 GIVING GL-WS-SALES     07420000
           ELSE                                                         07430000
               IF  EPTRN-TRN-TYP-CDE = '11' OR '12' OR '24' OR '25'     07440000
                   SUBTRACT EPTRN-SLS-TX-AMT FROM EPTRN-TRN-TOT-AMT     07450000
                                                 GIVING GL-WS-RETURNS   07460000
               ELSE                                                     07470000
      **           '30' = PAYMENTS                                      07480000
                   CONTINUE                                             07490000
           END-IF.                                                      07500000
           MOVE EPTRN-SLS-TX-AMT        TO GL-WS-TAX.                   07510000
           PERFORM 2100-PROCESS-QUERIES.                                07520000
           PERFORM 5000-WRITE-GL-RECORD.                                07530000
           INITIALIZE GL-WS-RECORD.                                     07540000
                                                                        07550000
                                                                        07560000
      ******************************************************************07570000
      * 2100-PROCESS-QUERIES.                                           07580000
      *     - SOME QUERIES ARE ONLY NEEDED FOR SALES, SOME FOR RETURNS  07590000
      *       AND SOME FOR BOTH.                                        07600000
      ******************************************************************07610000
       2100-PROCESS-QUERIES.                                            07620000
           IF  EPTRN-TRN-TYP-CDE  = '01' OR '02'                        07630000
               PERFORM 3100-SALE-QUERIES                                07640000
           ELSE                                                         07650000
               IF  EPTRN-TRN-TYP-CDE = '11' OR '12' OR '24' OR '25'     07660000
                   PERFORM 3200-RETURN-QUERIES                          07670000
               ELSE                                                     07680000
      **           '30' = PAYMENTS                                      07690000
                   CONTINUE                                             07700000
           END-IF.                                                      07710000
                                                                        07720000
           PERFORM 3300-SALE-AND-RETURN-QUERIES.                        07730000
                                                                        07740000
                                                                        07750000
      ******************************************************************07760000
      * 3100-SALE-QUERIES.                                              07770000
      *     - PERFORM THE SELECTS.                                      07780000
      *     - MOVE THE RESULTS TO THE GL WS TABLE.                      07790000
      ******************************************************************07800000
       3100-SALE-QUERIES.                                               07810000
                                                                        07820000
           PERFORM 4000-SELECT-GDS.                                     07830000
                                                                        07840000
           PERFORM 4010-SELECT-TPC.                                     07850000
                                                                        07860000
           PERFORM 4020-SELECT-TCC.                                     07870000
                                                                        07880000
           PERFORM 4030-SELECT-SGS.                                     07890000
                                                                        07900000
           PERFORM 4040-SELECT-BOS.                                     07910000
                                                                        07920000
           PERFORM 4050-SELECT-BPS.                                     07930000
                                                                        07940000
           PERFORM 4060-SELECT-SFS.                                     07950000
                                                                        07960000
           PERFORM 4070-SELECT-SHS.                                     07970000
                                                                        07980000
           PERFORM 4080-SELECT-KMT.                                     07990000
                                                                        08000000
                                                                        08010000
      ******************************************************************08020000
      * 3200-RETURN-QUERIES.                                            08030000
      *     - PERFORM THE SELECTS.                                      08040000
      *     - MOVE THE RESULTS TO THE GL WS TABLE.                      08050000
      ******************************************************************08060000
       3200-RETURN-QUERIES.                                             08070000
                                                                        08080000
           PERFORM 4100-SELECT-BSR.                                     08090000
                                                                        08100000
           PERFORM 4110-SELECT-BPR.                                     08110000
                                                                        08120000
           PERFORM 4120-SELECT-ECR.                                     08130000
                                                                        08140000
           PERFORM 4130-SELECT-SHR.                                     08150000
                                                                        08160000
           PERFORM 4140-SELECT-KMI.                                     08170000
                                                                        08180000
                                                                        08190000
      ******************************************************************08200000
      * 3300-SALE-AND-RETURN-QUERIES.                                   08210000
      *     - PERFORM THE SELECTS.                                      08220000
      *     - MOVE THE RESULTS TO THE GL WS TABLE.                      08230000
      ******************************************************************08240000
       3300-SALE-AND-RETURN-QUERIES.                                    08250000
                                                                        08260000
           PERFORM 4200-SELECT-KKB.                                     08270000
                                                                        08280000
           PERFORM 4210-SELECT-KKH.                                     08290000
                                                                        08300000
           PERFORM 4220-SELECT-KKS.                                     08310000
                                                                        08320000
           PERFORM 4230-SELECT-KKU.                                     08330000
                                                                        08340000
           PERFORM 4240-SELECT-FEE.                                     08350000
                                                                        08360000
           PERFORM 4250-SELECT-AEN.                                     08370000
                                                                        08380000
           PERFORM 4260-SELECT-BCN.                                     08390000
                                                                        08400000
           PERFORM 4270-SELECT-DBN.                                     08410000
                                                                        08420000
           PERFORM 4280-SELECT-KCN.                                     08430020
                                                                        08440000
           PERFORM 4290-SELECT-NCN.                                     08450000
                                                                        08460000
           PERFORM 4300-SELECT-GDT.                                     08470000
                                                                        08480000
           PERFORM 4310-SELECT-CASH.                                    08490000
                                                                        08500000
           PERFORM 4320-SELECT-CHECK.                                   08510000
                                                                        08520000
           PERFORM 4330-SELECT-KCP.                                     08530021
                                                                        08540000
           PERFORM 4340-SELECT-CRI.                                     08550000
                                                                        08560000
           PERFORM 4350-SELECT-EMPDISC.                                 08570000
                                                                        08580000
      **   PERFORM 4360-SELECT-KKT.                                     08590000
                                                                        08600000
           PERFORM 4370-SELECT-SGT.                                     08610000
                                                                        08620000
           PERFORM 4380-SELECT-MKTPLC.                                  08630000
                                                                        08640000
           PERFORM 4390-SELECT-CVN.                                     08650020
                                                                        08660000
           PERFORM 4400-SELECT-CVP.                                     08670021
PAYVEN                                                                  08680005
PAYVEN     PERFORM 4410-SELECT-PPN.                                     08681005
PAYVEN                                                                  08682005
PAYVEN     PERFORM 4420-SELECT-VMN.                                     08683005
                                                                        08684005
                                                                        08690000
      ******************************************************************08700000
      *  SALES CATEGORIES                                               08710000
      ******************************************************************08720000
      *  GDS - GET KOHLS GIFT CARD SALES                                08730000
      ******************************************************************08740000
       4000-SELECT-GDS.                                                 08750000
                                                                        08760000
           EXEC SQL                                                     08770000
               SELECT SUM(CUST_CHRGD_AMT)                               08780000
                 INTO :PV-DB2-SUM                                       08790000
                 FROM TEPTRN  T                                         08800000
                     ,TEPITM  I                                         08810000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             08820000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               08830000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               08840000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               08850000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               08860000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      08870000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  08880000
                AND   T.STR_NBR          = I.STR_NBR                    08890000
                AND   T.RGST_ID          = I.RGST_ID                    08900000
                AND   T.TRN_NBR          = I.TRN_NBR                    08910000
                AND   T.STRT_TM          = I.STRT_TM                    08920000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           08930000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 08940000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   08950000
                AND   I.DEPT_NBR          = '983'                       08960000
            WITH UR                                                     08970000
           END-EXEC.                                                    08980000
                                                                        08990000
           EVALUATE TRUE                                                09000000
               WHEN SQLCODE = ZERO                                      09010000
                   MOVE PV-DB2-SUM   TO GL-WS-GDS                       09020000
                   ADD 1 TO PA-GDS-SELECT-CNT                           09030000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          09040000
               WHEN SQLCODE = PC-NULL                                   09050000
                   MOVE ZEROES       TO GL-WS-GDS                       09060000
               WHEN SQLWARN0 NOT EQUAL SPACE                            09070000
               WHEN SQLCODE NOT EQUAL ZERO                              09080000
                   MOVE SQLCODE TO PV-SQL                               09090000
                   MOVE '4000-SELECT-GDS' TO PV-PARAGRAPH-NAME          09100000
                   STRING 'ERROR SELECTING GDS - SQLCODE = '            09110000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG09120000
                   END-STRING                                           09130000
                   SET ABEND-4002-READ-ERROR TO TRUE                    09140000
                   PERFORM 9100-SQL-ABEND                               09150000
           END-EVALUATE.                                                09160000
                                                                        09170000
                                                                        09180000
      ******************************************************************09190000
      *  TPC - GET THIRD PARTY GIFT CARD SALES                          09200000
      ******************************************************************09210000
       4010-SELECT-TPC.                                                 09220000
                                                                        09230000
           EXEC SQL                                                     09240000
               SELECT SUM(CUST_CHRGD_AMT)                               09250000
                 INTO :PV-DB2-SUM                                       09260000
                 FROM TEPTRN  T                                         09270000
                     ,TEPITM  I                                         09280000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             09290000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               09300000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               09310000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               09320000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               09330000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      09340000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  09350000
                AND   T.STR_NBR          = I.STR_NBR                    09360000
                AND   T.RGST_ID          = I.RGST_ID                    09370000
                AND   T.TRN_NBR          = I.TRN_NBR                    09380000
                AND   T.STRT_TM          = I.STRT_TM                    09390000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           09400000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 09410000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   09420000
                AND   I.DEPT_NBR         IN ('833','834')               09430000
            WITH UR                                                     09440000
           END-EXEC.                                                    09450000
                                                                        09460000
           EVALUATE TRUE                                                09470000
               WHEN SQLCODE = ZERO                                      09480000
                   MOVE PV-DB2-SUM   TO GL-WS-TPC                       09490000
                   ADD 1 TO PA-TPC-SELECT-CNT                           09500000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          09510000
               WHEN SQLCODE = PC-NULL                                   09520000
                   MOVE ZEROES       TO GL-WS-TPC                       09530000
               WHEN SQLWARN0 NOT EQUAL SPACE                            09540000
               WHEN SQLCODE NOT EQUAL ZERO                              09550000
                   MOVE SQLCODE TO PV-SQL                               09560000
                   MOVE '4010-SELECT-TPC' TO PV-PARAGRAPH-NAME          09570000
                   STRING 'ERROR SELECTING TPC - SQLCODE = '            09580000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG09590000
                   END-STRING                                           09600000
                   SET ABEND-4002-READ-ERROR TO TRUE                    09610000
                   PERFORM 9100-SQL-ABEND                               09620000
           END-EVALUATE.                                                09630000
                                                                        09640000
                                                                        09650000
      ******************************************************************09660000
      *  TCC - GET THIRD PARTY GIFT CARD COMMISSIONS                    09670000
      ******************************************************************09680000
       4020-SELECT-TCC.                                                 09690000
                                                                        09700000
           EXEC SQL                                                     09710000
               SELECT SUM(UNT_COMMS_AMT * I.SLD_QTY)                    09720000
                 INTO :PV-DB2-SUM                                       09730000
                 FROM TEPTRN         T                                  09740000
                     ,TEPITM         I                                  09750000
                     ,GCT_VND_COMMS  C                                  09760000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             09770000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               09780000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               09790000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               09800000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               09810000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      09820000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  09830000
                AND   T.STR_NBR          = I.STR_NBR                    09840000
                AND   T.RGST_ID          = I.RGST_ID                    09850000
                AND   T.TRN_NBR          = I.TRN_NBR                    09860000
                AND   T.STRT_TM          = I.STRT_TM                    09870000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           09880000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 09890000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   09900000
                AND   I.DEPT_NBR         IN ('833','834')               09910000
                AND   I.UPC_NBR          = C.UPC_NBR                    09920000
                AND  (C.EFF_STRT_DTE    <= T.SLS_DTE                    09930000
                AND   C.EFF_END_DTE      > T.SLS_DTE)                   09940000
            WITH UR                                                     09950000
           END-EXEC.                                                    09960000
                                                                        09970000
           EVALUATE TRUE                                                09980000
               WHEN SQLCODE = ZERO                                      09990000
                   MOVE PV-DB2-SUM   TO GL-WS-TCC                       10000000
                   ADD 1 TO PA-TCC-SELECT-CNT                           10010000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          10020000
               WHEN SQLCODE = PC-NULL                                   10030000
                   MOVE ZEROES       TO GL-WS-TCC                       10040000
               WHEN SQLWARN0 NOT EQUAL SPACE                            10050000
               WHEN SQLCODE NOT EQUAL ZERO                              10060000
                   MOVE SQLCODE TO PV-SQL                               10070000
                   MOVE '4020-SELECT-TCC' TO PV-PARAGRAPH-NAME          10080000
                   STRING 'ERROR SELECTING TCC - SQLCODE = '            10090000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG10100000
                   END-STRING                                           10110000
                   SET ABEND-4002-READ-ERROR TO TRUE                    10120000
                   PERFORM 9100-SQL-ABEND                               10130000
           END-EVALUATE.                                                10140000
                                                                        10150000
                                                                        10160000
      ******************************************************************10170000
      *  SGS - GET SEPHORA GIFT CARD SALES                              10180000
      ******************************************************************10190000
       4030-SELECT-SGS.                                                 10200000
                                                                        10210000
           EXEC SQL                                                     10220000
               SELECT SUM(CUST_CHRGD_AMT)                               10230000
                 INTO :PV-DB2-SUM                                       10240000
                 FROM TEPTRN  T                                         10250000
                     ,TEPITM  I                                         10260000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             10270000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               10280000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               10290000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               10300000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               10310000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      10320000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  10330000
                AND   T.STR_NBR          = I.STR_NBR                    10340000
                AND   T.RGST_ID          = I.RGST_ID                    10350000
                AND   T.TRN_NBR          = I.TRN_NBR                    10360000
                AND   T.STRT_TM          = I.STRT_TM                    10370000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           10380000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 10390000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   10400000
                AND   I.DEPT_NBR          = '712'                       10410000
            WITH UR                                                     10420000
           END-EXEC.                                                    10430000
                                                                        10440000
           EVALUATE TRUE                                                10450000
               WHEN SQLCODE = ZERO                                      10460000
                   MOVE PV-DB2-SUM   TO GL-WS-SGS                       10470000
                   ADD 1 TO PA-SGS-SELECT-CNT                           10480000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          10490000
               WHEN SQLCODE = PC-NULL                                   10500000
                   MOVE ZEROES       TO GL-WS-SGS                       10510000
               WHEN SQLWARN0 NOT EQUAL SPACE                            10520000
               WHEN SQLCODE NOT EQUAL ZERO                              10530000
                   MOVE SQLCODE TO PV-SQL                               10540000
                   MOVE '4000-SELECT-SGS' TO PV-PARAGRAPH-NAME          10550000
                   STRING 'ERROR SELECTING SGS - SQLCODE = '            10560000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG10570000
                   END-STRING                                           10580000
                   SET ABEND-4002-READ-ERROR TO TRUE                    10590000
                   PERFORM 9100-SQL-ABEND                               10600000
           END-EVALUATE.                                                10610000
                                                                        10620000
                                                                        10630000
      ******************************************************************10640000
      *  BOS - GET BUY ONLINE SHIP TO STORE SALES                       10650000
      ******************************************************************10660000
       4040-SELECT-BOS.                                                 10670000
                                                                        10680000
           EXEC SQL                                                     10690000
               SELECT SUM(NET_CHRGD_AMT)                                10700000
                 INTO :PV-DB2-SUM                                       10710000
                 FROM TEPTRN  T                                         10720000
                     ,TEPITM  I                                         10730000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             10740000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               10750000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               10760000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               10770000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               10780000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      10790000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  10800000
                AND   T.STR_NBR          = I.STR_NBR                    10810000
                AND   T.RGST_ID          = I.RGST_ID                    10820000
                AND   T.TRN_NBR          = I.TRN_NBR                    10830000
                AND   T.STRT_TM          = I.STRT_TM                    10840000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           10850000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 10860000
                AND   T.OMNI_CHNL_FFLMT_TYP_CDE = 'BOS'                 10870000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   10880000
            WITH UR                                                     10890000
           END-EXEC.                                                    10900000
                                                                        10910000
           EVALUATE TRUE                                                10920000
               WHEN SQLCODE = ZERO                                      10930000
                   MOVE PV-DB2-SUM   TO GL-WS-BOS                       10940000
                   ADD 1 TO PA-BOS-SELECT-CNT                           10950000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          10960000
               WHEN SQLCODE = PC-NULL                                   10970000
                   MOVE ZEROES       TO GL-WS-BOS                       10980000
               WHEN SQLWARN0 NOT EQUAL SPACE                            10990000
               WHEN SQLCODE NOT EQUAL ZERO                              11000000
                   MOVE SQLCODE TO PV-SQL                               11010000
                   MOVE '4040-SELECT-BOS' TO PV-PARAGRAPH-NAME          11020000
                   STRING 'ERROR SELECTING BOS - SQLCODE = '            11030000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG11040000
                   END-STRING                                           11050000
                   SET ABEND-4002-READ-ERROR TO TRUE                    11060000
                   PERFORM 9100-SQL-ABEND                               11070000
           END-EVALUATE.                                                11080000
                                                                        11090000
                                                                        11100000
      ******************************************************************11110000
      *  BPS - GET BUY ONLINE PICK UP IN STORE SALES                    11120000
      ******************************************************************11130000
       4050-SELECT-BPS.                                                 11140000
                                                                        11150000
           EXEC SQL                                                     11160000
               SELECT SUM(NET_CHRGD_AMT)                                11170000
                 INTO :PV-DB2-SUM                                       11180000
                 FROM TEPTRN  T                                         11190000
                     ,TEPITM  I                                         11200000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             11210000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               11220000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               11230000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               11240000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               11250000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      11260000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  11270000
                AND   T.STR_NBR          = I.STR_NBR                    11280000
                AND   T.RGST_ID          = I.RGST_ID                    11290000
                AND   T.TRN_NBR          = I.TRN_NBR                    11300000
                AND   T.STRT_TM          = I.STRT_TM                    11310000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           11320000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 11330000
                AND   T.OMNI_CHNL_FFLMT_TYP_CDE = 'BPS'                 11340000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   11350000
            WITH UR                                                     11360000
           END-EXEC.                                                    11370000
                                                                        11380000
           EVALUATE TRUE                                                11390000
               WHEN SQLCODE = ZERO                                      11400000
                   MOVE PV-DB2-SUM   TO GL-WS-BPS                       11410000
                   ADD 1 TO PA-BPS-SELECT-CNT                           11420000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          11430000
               WHEN SQLCODE = PC-NULL                                   11440000
                   MOVE ZEROES       TO GL-WS-BPS                       11450000
               WHEN SQLWARN0 NOT EQUAL SPACE                            11460000
               WHEN SQLCODE NOT EQUAL ZERO                              11470000
                   MOVE SQLCODE TO PV-SQL                               11480000
                   MOVE '4050-SELECT-BPS' TO PV-PARAGRAPH-NAME          11490000
                   STRING 'ERROR SELECTING BPS - SQLCODE = '            11500000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG11510000
                   END-STRING                                           11520000
                   SET ABEND-4002-READ-ERROR TO TRUE                    11530000
                   PERFORM 9100-SQL-ABEND                               11540000
           END-EVALUATE.                                                11550000
                                                                        11560000
                                                                        11570000
      ******************************************************************11580000
      *  SFS - GET SHIP FROM STORES SALES                               11590000
      ******************************************************************11600000
       4060-SELECT-SFS.                                                 11610000
                                                                        11620000
           EXEC SQL                                                     11630000
               SELECT SUM(NET_CHRGD_AMT)                                11640000
                 INTO :PV-DB2-SUM                                       11650000
                 FROM TEPTRN  T                                         11660000
                     ,TEPITM  I                                         11670000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             11680000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               11690000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               11700000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               11710000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               11720000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      11730000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  11740000
                AND   T.STR_NBR          = I.STR_NBR                    11750000
                AND   T.RGST_ID          = I.RGST_ID                    11760000
                AND   T.TRN_NBR          = I.TRN_NBR                    11770000
                AND   T.STRT_TM          = I.STRT_TM                    11780000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           11790000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 11800000
                AND   T.OMNI_CHNL_FFLMT_TYP_CDE = 'SFS'                 11810000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   11820000
            WITH UR                                                     11830000
           END-EXEC.                                                    11840000
                                                                        11850000
           EVALUATE TRUE                                                11860000
               WHEN SQLCODE = ZERO                                      11870000
                   MOVE PV-DB2-SUM   TO GL-WS-SFS                       11880000
                   ADD 1 TO PA-SFS-SELECT-CNT                           11890000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          11900000
               WHEN SQLCODE = PC-NULL                                   11910000
                   MOVE ZEROES       TO GL-WS-SFS                       11920000
               WHEN SQLWARN0 NOT EQUAL SPACE                            11930000
               WHEN SQLCODE NOT EQUAL ZERO                              11940000
                   MOVE SQLCODE TO PV-SQL                               11950000
                   MOVE '4060-SELECT-SFS' TO PV-PARAGRAPH-NAME          11960000
                   STRING 'ERROR SELECTING SFS - SQLCODE = '            11970000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG11980000
                   END-STRING                                           11990000
                   SET ABEND-4002-READ-ERROR TO TRUE                    12000000
                   PERFORM 9100-SQL-ABEND                               12010000
           END-EVALUATE.                                                12020000
                                                                        12030000
                                                                        12040000
      ******************************************************************12050000
      *  SHS - GET SHIPPING SALES                                       12060000
      ******************************************************************12070000
       4070-SELECT-SHS.                                                 12080000
                                                                        12090000
           EXEC SQL                                                     12100000
               SELECT SUM(SHIP_CHRG_AMT)                                12110000
                 INTO :PV-DB2-SUM                                       12120000
                 FROM TEPTRN  T                                         12130000
                     ,TEPSHP  S                                         12140000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             12150000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               12160000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               12170000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               12180000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               12190000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      12200000
                AND   T.PARTN_NBR        = S.PARTN_NBR                  12210000
                AND   T.STR_NBR          = S.STR_NBR                    12220000
                AND   T.RGST_ID          = S.RGST_ID                    12230000
                AND   T.TRN_NBR          = S.TRN_NBR                    12240000
                AND   T.STRT_TM          = S.STRT_TM                    12250000
                AND   T.SLS_CORR_SEQ_NBR = S.SLS_CORR_SEQ_NBR           12260000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 12270000
            WITH UR                                                     12280000
           END-EXEC.                                                    12290000
                                                                        12300000
           EVALUATE TRUE                                                12310000
               WHEN SQLCODE = ZERO                                      12320000
                   MOVE PV-DB2-SUM   TO GL-WS-SHS                       12330000
                   ADD 1 TO PA-SHS-SELECT-CNT                           12340000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          12350000
               WHEN SQLCODE = PC-NULL                                   12360000
                   MOVE ZEROES       TO GL-WS-SHS                       12370000
               WHEN SQLWARN0 NOT EQUAL SPACE                            12380000
               WHEN SQLCODE NOT EQUAL ZERO                              12390000
                   MOVE SQLCODE TO PV-SQL                               12400000
                   MOVE '4070-SELECT-SHS' TO PV-PARAGRAPH-NAME          12410000
                   STRING 'ERROR SELECTING SHS - SQLCODE = '            12420000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG12430000
                   END-STRING                                           12440000
                   SET ABEND-4002-READ-ERROR TO TRUE                    12450000
                   PERFORM 9100-SQL-ABEND                               12460000
           END-EVALUATE.                                                12470000
                                                                        12480000
                                                                        12490000
      ******************************************************************12500000
      *  KMT - GET KOHLS MDSE CARDS TENDERED                            12510000
      ******************************************************************12520000
       4080-SELECT-KMT.                                                 12530000
                                                                        12540000
           EXEC SQL                                                     12550000
               SELECT SUM(N.TNDR_AMT)                                   12560000
                 INTO :PV-DB2-SUM                                       12570000
                 FROM TEPTRN  T                                         12580000
                     ,TEPTND  N                                         12590000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             12600000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               12610000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               12620000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               12630000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               12640000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      12650000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  12660000
                AND   T.STR_NBR          = N.STR_NBR                    12670000
                AND   T.RGST_ID          = N.RGST_ID                    12680000
                AND   T.TRN_NBR          = N.TRN_NBR                    12690000
                AND   T.STRT_TM          = N.STRT_TM                    12700000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           12710000
                AND   T.TRN_TYP_CDE      IN ('01','02')                 12720000
                AND   N.TNDR_TYP_CDE     = '02'                         12730000
                AND   N.TNDR_VOID_IND    = 'N'                          12740000
            WITH UR                                                     12750000
           END-EXEC.                                                    12760000
                                                                        12770000
           EVALUATE TRUE                                                12780000
               WHEN SQLCODE = ZERO                                      12790000
                   MOVE PV-DB2-SUM   TO GL-WS-KMT                       12800000
                   ADD 1 TO PA-KMT-SELECT-CNT                           12810000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          12820000
               WHEN SQLCODE = PC-NULL                                   12830000
                   MOVE ZEROES       TO GL-WS-KMT                       12840000
               WHEN SQLWARN0 NOT EQUAL SPACE                            12850000
               WHEN SQLCODE NOT EQUAL ZERO                              12860000
                   MOVE SQLCODE TO PV-SQL                               12870000
                   MOVE '4080-SELECT-KMT' TO PV-PARAGRAPH-NAME          12880000
                   STRING 'ERROR SELECTING KMT - SQLCODE = '            12890000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG12900000
                   END-STRING                                           12910000
                   SET ABEND-4002-READ-ERROR TO TRUE                    12920000
                   PERFORM 9100-SQL-ABEND                               12930000
           END-EVALUATE.                                                12940000
                                                                        12950000
                                                                        12960000
      ******************************************************************12970000
      *  RETURNS CATEGORIES                                             12980000
      ******************************************************************12990000
      *  BSR - GET BUY ONLINE SHIP TO STORE RETURNS                     13000000
      ******************************************************************13010000
       4100-SELECT-BSR.                                                 13020000
                                                                        13030000
           EXEC SQL                                                     13040000
               SELECT SUM(NET_CHRGD_AMT)                                13050000
                 INTO :PV-DB2-SUM                                       13060000
                 FROM TEPTRN  T                                         13070000
                     ,TEPITM  I                                         13080000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             13090000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               13100000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               13110000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               13120000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               13130000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      13140000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  13150000
                AND   T.STR_NBR          = I.STR_NBR                    13160000
                AND   T.RGST_ID          = I.RGST_ID                    13170000
                AND   T.TRN_NBR          = I.TRN_NBR                    13180000
                AND   T.STRT_TM          = I.STRT_TM                    13190000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           13200000
                AND   T.TRN_TYP_CDE      IN ('11','12')                 13210000
                AND   T.OMNI_CHNL_FFLMT_TYP_CDE = 'BOS'                 13220000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   13230000
            WITH UR                                                     13240000
           END-EXEC.                                                    13250000
                                                                        13260000
           EVALUATE TRUE                                                13270000
               WHEN SQLCODE = ZERO                                      13280000
                   MOVE PV-DB2-SUM   TO GL-WS-BSR                       13290000
                   ADD 1 TO PA-BSR-SELECT-CNT                           13300000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          13310000
               WHEN SQLCODE = PC-NULL                                   13320000
                   MOVE ZEROES       TO GL-WS-BSR                       13330000
               WHEN SQLWARN0 NOT EQUAL SPACE                            13340000
               WHEN SQLCODE NOT EQUAL ZERO                              13350000
                   MOVE SQLCODE TO PV-SQL                               13360000
                   MOVE '4100-SELECT-BSR' TO PV-PARAGRAPH-NAME          13370000
                   STRING 'ERROR SELECTING BSR - SQLCODE = '            13380000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG13390000
                   END-STRING                                           13400000
                   SET ABEND-4002-READ-ERROR TO TRUE                    13410000
                   PERFORM 9100-SQL-ABEND                               13420000
           END-EVALUATE.                                                13430000
                                                                        13440000
      ******************************************************************13450000
      *  BPR - GET BUY ONLINE PICK UP IN STORE RETURNS                  13460000
      ******************************************************************13470000
       4110-SELECT-BPR.                                                 13480000
                                                                        13490000
           EXEC SQL                                                     13500000
               SELECT SUM(NET_CHRGD_AMT)                                13510000
                 INTO :PV-DB2-SUM                                       13520000
                 FROM TEPTRN  T                                         13530000
                     ,TEPITM  I                                         13540000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             13550000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               13560000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               13570000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               13580000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               13590000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      13600000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  13610000
                AND   T.STR_NBR          = I.STR_NBR                    13620000
                AND   T.RGST_ID          = I.RGST_ID                    13630000
                AND   T.TRN_NBR          = I.TRN_NBR                    13640000
                AND   T.STRT_TM          = I.STRT_TM                    13650000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           13660000
                AND   T.TRN_TYP_CDE      IN ('11','12')                 13670000
                AND   T.OMNI_CHNL_FFLMT_TYP_CDE = 'BPS'                 13680000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   13690000
            WITH UR                                                     13700000
           END-EXEC.                                                    13710000
                                                                        13720000
           EVALUATE TRUE                                                13730000
               WHEN SQLCODE = ZERO                                      13740000
                   MOVE PV-DB2-SUM   TO GL-WS-BPR                       13750000
                   ADD 1 TO PA-BPR-SELECT-CNT                           13760000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          13770000
               WHEN SQLCODE = PC-NULL                                   13780000
                   MOVE ZEROES       TO GL-WS-BPR                       13790000
               WHEN SQLWARN0 NOT EQUAL SPACE                            13800000
               WHEN SQLCODE NOT EQUAL ZERO                              13810000
                   MOVE SQLCODE TO PV-SQL                               13820000
                   MOVE '4110-SELECT-BPR' TO PV-PARAGRAPH-NAME          13830000
                   STRING 'ERROR SELECTING BPR - SQLCODE = '            13840000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG13850000
                   END-STRING                                           13860000
                   SET ABEND-4002-READ-ERROR TO TRUE                    13870000
                   PERFORM 9100-SQL-ABEND                               13880000
           END-EVALUATE.                                                13890000
                                                                        13900000
                                                                        13910000
      ******************************************************************13920000
      *  ECR - GET ECOM RETURNS                                         13930000
      ******************************************************************13940000
       4120-SELECT-ECR.                                                 13950000
                                                                        13960000
           EXEC SQL                                                     13970000
               SELECT SUM(NET_CHRGD_AMT)                                13980000
                 INTO :PV-DB2-SUM                                       13990000
                 FROM TEPTRN  T                                         14000000
                     ,TEPITM  I                                         14010000
                     ,TEPIRT  R                                         14020000
                     ,XST_LOC L                                         14030000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             14040000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               14050000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               14060000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               14070000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               14080000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      14090000
                AND   T.PARTN_NBR         = I.PARTN_NBR                 14100000
                AND   T.STR_NBR           = I.STR_NBR                   14110000
                AND   T.RGST_ID           = I.RGST_ID                   14120000
                AND   T.TRN_NBR           = I.TRN_NBR                   14130000
                AND   T.STRT_TM           = I.STRT_TM                   14140000
                AND   T.SLS_CORR_SEQ_NBR  = I.SLS_CORR_SEQ_NBR          14150000
                AND   I.PARTN_NBR         = R.PARTN_NBR                 14160000
                AND   I.STR_NBR           = R.STR_NBR                   14170000
                AND   I.RGST_ID           = R.RGST_ID                   14180000
                AND   I.TRN_NBR           = R.TRN_NBR                   14190000
                AND   I.STRT_TM           = R.STRT_TM                   14200000
                AND   I.SLS_CORR_SEQ_NBR  = R.SLS_CORR_SEQ_NBR          14210000
                AND   I.LNE_ITM_SEQ_NBR   = R.LNE_ITM_SEQ_NBR           14220000
                AND   T.TRN_TYP_CDE      IN ('11','12','24','25')       14230000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   14240000
                AND   R.ORIG_STR_NBR      = L.LOC_NBR                   14250000
                AND   L.LOC_TYP_CDE       = 'DS'                        14260000
                AND  (L.E_BUS_IND         = 'Y')                        14270010
PAYVEN***        OR  (L.E_BUS_IND         = 'N'                         14280010
PAYVEN***       AND   R.ORIG_RGST_ID BETWEEN 90 AND 95))                14290010
            WITH UR                                                     14300000
           END-EXEC.                                                    14310000
                                                                        14320000
           EVALUATE TRUE                                                14330000
               WHEN SQLCODE = ZERO                                      14340000
                   MOVE PV-DB2-SUM   TO GL-WS-ECR                       14350000
                   ADD 1 TO PA-ECR-SELECT-CNT                           14360000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          14370000
               WHEN SQLCODE = PC-NULL                                   14380000
                   MOVE ZEROES       TO GL-WS-ECR                       14390000
               WHEN SQLWARN0 NOT EQUAL SPACE                            14400000
               WHEN SQLCODE NOT EQUAL ZERO                              14410000
                   MOVE SQLCODE TO PV-SQL                               14420000
                   MOVE '4120-SELECT-ECR' TO PV-PARAGRAPH-NAME          14430000
                   STRING 'ERROR SELECTING ECR - SQLCODE = '            14440000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG14450000
                   END-STRING                                           14460000
                   SET ABEND-4002-READ-ERROR TO TRUE                    14470000
                   PERFORM 9100-SQL-ABEND                               14480000
           END-EVALUATE.                                                14490000
                                                                        14500000
                                                                        14510000
      ******************************************************************14520000
      *  SHR - GET SHIPPING RETURNS                                     14530000
      ******************************************************************14540000
       4130-SELECT-SHR.                                                 14550000
                                                                        14560000
           EXEC SQL                                                     14570000
               SELECT SUM(L.SRVC_AMT)                                   14580000
                 INTO :PV-DB2-SUM                                       14590000
                 FROM TEPTRN  T                                         14600000
                     ,TEPITM  I                                         14610000
                     ,TEPLIS  L                                         14620000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             14630000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               14640000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               14650000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               14660000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               14670000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      14680000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  14690000
                AND   T.STR_NBR          = I.STR_NBR                    14700000
                AND   T.RGST_ID          = I.RGST_ID                    14710000
                AND   T.TRN_NBR          = I.TRN_NBR                    14720000
                AND   T.STRT_TM          = I.STRT_TM                    14730000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           14740000
                AND   I.PARTN_NBR        = L.PARTN_NBR                  14750000
                AND   I.STR_NBR          = L.STR_NBR                    14760000
                AND   I.RGST_ID          = L.RGST_ID                    14770000
                AND   I.TRN_NBR          = L.TRN_NBR                    14780000
                AND   I.STRT_TM          = L.STRT_TM                    14790000
                AND   I.SLS_CORR_SEQ_NBR = L.SLS_CORR_SEQ_NBR           14800000
                AND   T.TRN_TYP_CDE      IN ('11','12','24','25')       14810000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   14820000
                AND   L.SRVC_TYP_CDE      = 'S'                         14830000
            WITH UR                                                     14840000
           END-EXEC.                                                    14850000
                                                                        14860000
           EVALUATE TRUE                                                14870000
               WHEN SQLCODE = ZERO                                      14880000
                   MOVE PV-DB2-SUM   TO GL-WS-SHR                       14890000
                   ADD 1 TO PA-SHR-SELECT-CNT                           14900000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          14910000
               WHEN SQLCODE = PC-NULL                                   14920000
                   MOVE ZEROES       TO GL-WS-SHR                       14930000
               WHEN SQLWARN0 NOT EQUAL SPACE                            14940000
               WHEN SQLCODE NOT EQUAL ZERO                              14950000
                   MOVE SQLCODE TO PV-SQL                               14960000
                   MOVE '4130-SELECT-SHR' TO PV-PARAGRAPH-NAME          14970000
                   STRING 'ERROR SELECTING SHR - SQLCODE = '            14980000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG14990000
                   END-STRING                                           15000000
                   SET ABEND-4002-READ-ERROR TO TRUE                    15010000
                   PERFORM 9100-SQL-ABEND                               15020000
           END-EVALUATE.                                                15030000
                                                                        15040000
                                                                        15050000
      ******************************************************************15060000
      *  KMI - GET KOHLS MDSE CARDS ISSUED                              15070000
      ******************************************************************15080000
       4140-SELECT-KMI.                                                 15090000
                                                                        15100000
           EXEC SQL                                                     15110000
               SELECT SUM(N.TNDR_AMT)                                   15120000
                 INTO :PV-DB2-SUM                                       15130000
                 FROM TEPTRN  T                                         15140000
                     ,TEPTND  N                                         15150000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             15160000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               15170000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               15180000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               15190000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               15200000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      15210000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  15220000
                AND   T.STR_NBR          = N.STR_NBR                    15230000
                AND   T.RGST_ID          = N.RGST_ID                    15240000
                AND   T.TRN_NBR          = N.TRN_NBR                    15250000
                AND   T.STRT_TM          = N.STRT_TM                    15260000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           15270000
                AND   T.TRN_TYP_CDE      IN ('11','12','24','25')       15280000
                AND   N.TNDR_TYP_CDE     = '02'                         15290000
                AND   N.TNDR_VOID_IND    = 'N'                          15300000
            WITH UR                                                     15310000
           END-EXEC.                                                    15320000
                                                                        15330000
           EVALUATE TRUE                                                15340000
               WHEN SQLCODE = ZERO                                      15350000
                   MOVE PV-DB2-SUM   TO GL-WS-KMI                       15360000
                   ADD 1 TO PA-KMI-SELECT-CNT                           15370000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          15380000
               WHEN SQLCODE = PC-NULL                                   15390000
                   MOVE ZEROES       TO GL-WS-KMI                       15400000
               WHEN SQLWARN0 NOT EQUAL SPACE                            15410000
               WHEN SQLCODE NOT EQUAL ZERO                              15420000
                   MOVE SQLCODE TO PV-SQL                               15430000
                   MOVE '4140-SELECT-KMI' TO PV-PARAGRAPH-NAME          15440000
                   STRING 'ERROR SELECTING KMI - SQLCODE = '            15450000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG15460000
                   END-STRING                                           15470000
                   SET ABEND-4002-READ-ERROR TO TRUE                    15480000
                   PERFORM 9100-SQL-ABEND                               15490000
           END-EVALUATE.                                                15500000
                                                                        15510000
                                                                        15520000
      ******************************************************************15530000
      *  SALES AND RETURNS CATEGORIES                                   15540000
      ******************************************************************15550000
      *  KKB - GET KCK BACK TO SCHOOL SALES                             15560000
      ******************************************************************15570000
       4200-SELECT-KKB.                                                 15580000
                                                                        15590000
           EXEC SQL                                                     15600000
               SELECT SUM(NET_CHRGD_AMT)                                15610000
                 INTO :PV-DB2-SUM                                       15620000
                 FROM TEPTRN  T                                         15630000
                     ,TEPITM  I                                         15640000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             15650000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               15660000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               15670000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               15680000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               15690000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      15700000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  15710000
                AND   T.STR_NBR          = I.STR_NBR                    15720000
                AND   T.RGST_ID          = I.RGST_ID                    15730000
                AND   T.TRN_NBR          = I.TRN_NBR                    15740000
                AND   T.STRT_TM          = I.STRT_TM                    15750000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           15760000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   15770000
                AND   I.DEPT_NBR          = '830'                       15780000
                AND   I.SUB_CL_NBR        = '12'                        15790000
            WITH UR                                                     15800000
           END-EXEC.                                                    15810000
                                                                        15820000
           EVALUATE TRUE                                                15830000
               WHEN SQLCODE = ZERO                                      15840000
                   MOVE PV-DB2-SUM   TO GL-WS-KKB                       15850000
                   ADD 1 TO PA-KKB-SELECT-CNT                           15860000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          15870000
               WHEN SQLCODE = PC-NULL                                   15880000
                   MOVE ZEROES       TO GL-WS-KKB                       15890000
               WHEN SQLWARN0 NOT EQUAL SPACE                            15900000
               WHEN SQLCODE NOT EQUAL ZERO                              15910000
                   MOVE SQLCODE TO PV-SQL                               15920000
                   MOVE '4200-SELECT-KKB' TO PV-PARAGRAPH-NAME          15930000
                   STRING 'ERROR SELECTING KKB - SQLCODE = '            15940000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG15950000
                   END-STRING                                           15960000
                   SET ABEND-4002-READ-ERROR TO TRUE                    15970000
                   PERFORM 9100-SQL-ABEND                               15980000
           END-EVALUATE.                                                15990000
                                                                        16000000
                                                                        16010000
      ******************************************************************16020000
      *  KKH - GET KCK HOLIDAY SALES                                    16030000
      ******************************************************************16040000
       4210-SELECT-KKH.                                                 16050000
                                                                        16060000
           EXEC SQL                                                     16070000
               SELECT SUM(NET_CHRGD_AMT)                                16080000
                 INTO :PV-DB2-SUM                                       16090000
                 FROM TEPTRN  T                                         16100000
                     ,TEPITM  I                                         16110000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             16120000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               16130000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               16140000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               16150000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               16160000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      16170000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  16180000
                AND   T.STR_NBR          = I.STR_NBR                    16190000
                AND   T.RGST_ID          = I.RGST_ID                    16200000
                AND   T.TRN_NBR          = I.TRN_NBR                    16210000
                AND   T.STRT_TM          = I.STRT_TM                    16220000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           16230000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   16240000
                AND   I.DEPT_NBR          = '830'                       16250000
                AND   I.SUB_CL_NBR   NOT IN('11','12','14')             16260000
            WITH UR                                                     16270000
           END-EXEC.                                                    16280000
                                                                        16290000
           EVALUATE TRUE                                                16300000
               WHEN SQLCODE = ZERO                                      16310000
                   MOVE PV-DB2-SUM   TO GL-WS-KKH                       16320000
                   ADD 1 TO PA-KKH-SELECT-CNT                           16330000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          16340000
               WHEN SQLCODE = PC-NULL                                   16350000
                   MOVE ZEROES       TO GL-WS-KKH                       16360000
               WHEN SQLWARN0 NOT EQUAL SPACE                            16370000
               WHEN SQLCODE NOT EQUAL ZERO                              16380000
                   MOVE SQLCODE TO PV-SQL                               16390000
                   MOVE '4210-SELECT-KKH' TO PV-PARAGRAPH-NAME          16400000
                   STRING 'ERROR SELECTING KKH - SQLCODE = '            16410000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG16420000
                   END-STRING                                           16430000
                   SET ABEND-4002-READ-ERROR TO TRUE                    16440000
                   PERFORM 9100-SQL-ABEND                               16450000
           END-EVALUATE.                                                16460000
                                                                        16470000
                                                                        16480000
      ******************************************************************16490000
      *  KKS - GET KCK SPRING SALES                                     16500000
      ******************************************************************16510000
       4220-SELECT-KKS.                                                 16520000
                                                                        16530000
           EXEC SQL                                                     16540000
               SELECT SUM(NET_CHRGD_AMT)                                16550000
                 INTO :PV-DB2-SUM                                       16560000
                 FROM TEPTRN  T                                         16570000
                     ,TEPITM  I                                         16580000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             16590000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               16600000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               16610000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               16620000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               16630000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      16640000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  16650000
                AND   T.STR_NBR          = I.STR_NBR                    16660000
                AND   T.RGST_ID          = I.RGST_ID                    16670000
                AND   T.TRN_NBR          = I.TRN_NBR                    16680000
                AND   T.STRT_TM          = I.STRT_TM                    16690000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           16700000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   16710000
                AND   I.DEPT_NBR          = '830'                       16720000
                AND   I.SUB_CL_NBR        = '11'                        16730000
            WITH UR                                                     16740000
           END-EXEC.                                                    16750000
                                                                        16760000
           EVALUATE TRUE                                                16770000
               WHEN SQLCODE = ZERO                                      16780000
                   MOVE PV-DB2-SUM   TO GL-WS-KKS                       16790000
                   ADD 1 TO PA-KKS-SELECT-CNT                           16800000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          16810000
               WHEN SQLCODE = PC-NULL                                   16820000
                   MOVE ZEROES       TO GL-WS-KKS                       16830000
               WHEN SQLWARN0 NOT EQUAL SPACE                            16840000
               WHEN SQLCODE NOT EQUAL ZERO                              16850000
                   MOVE SQLCODE TO PV-SQL                               16860000
                   MOVE '4220-SELECT-KKS' TO PV-PARAGRAPH-NAME          16870000
                   STRING 'ERROR SELECTING KKS - SQLCODE = '            16880000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG16890000
                   END-STRING                                           16900000
                   SET ABEND-4002-READ-ERROR TO TRUE                    16910000
                   PERFORM 9100-SQL-ABEND                               16920000
           END-EVALUATE.                                                16930000
                                                                        16940000
                                                                        16950000
      ******************************************************************16960000
      *  KKU - GET KCK SUMMER SALES                                     16970000
      ******************************************************************16980000
       4230-SELECT-KKU.                                                 16990000
                                                                        17000000
           EXEC SQL                                                     17010000
               SELECT SUM(NET_CHRGD_AMT)                                17020000
                 INTO :PV-DB2-SUM                                       17030000
                 FROM TEPTRN  T                                         17040000
                     ,TEPITM  I                                         17050000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             17060000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               17070000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               17080000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               17090000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               17100000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      17110000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  17120000
                AND   T.STR_NBR          = I.STR_NBR                    17130000
                AND   T.RGST_ID          = I.RGST_ID                    17140000
                AND   T.TRN_NBR          = I.TRN_NBR                    17150000
                AND   T.STRT_TM          = I.STRT_TM                    17160000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           17170000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   17180000
                AND   I.DEPT_NBR          = '830'                       17190000
                AND   I.SUB_CL_NBR        = '14'                        17200000
            WITH UR                                                     17210000
           END-EXEC.                                                    17220000
                                                                        17230000
           EVALUATE TRUE                                                17240000
               WHEN SQLCODE = ZERO                                      17250000
                   MOVE PV-DB2-SUM   TO GL-WS-KKU                       17260000
                   ADD 1 TO PA-KKU-SELECT-CNT                           17270000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          17280000
               WHEN SQLCODE = PC-NULL                                   17290000
                   MOVE ZEROES       TO GL-WS-KKU                       17300000
               WHEN SQLWARN0 NOT EQUAL SPACE                            17310000
               WHEN SQLCODE NOT EQUAL ZERO                              17320000
                   MOVE SQLCODE TO PV-SQL                               17330000
                   MOVE '4230-SELECT-KKU' TO PV-PARAGRAPH-NAME          17340000
                   STRING 'ERROR SELECTING KKU - SQLCODE = '            17350000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG17360000
                   END-STRING                                           17370000
                   SET ABEND-4002-READ-ERROR TO TRUE                    17380000
                   PERFORM 9100-SQL-ABEND                               17390000
           END-EVALUATE.                                                17400000
                                                                        17410000
      ******************************************************************17420000
      *  FEE - GET FEES                                                 17430000
      ******************************************************************17440000
       4240-SELECT-FEE.                                                 17450000
                                                                        17460000
           EXEC SQL                                                     17470000
               SELECT SUM(L.SRVC_AMT)                                   17480000
                 INTO :PV-DB2-SUM                                       17490000
                 FROM TEPTRN  T                                         17500000
                     ,TEPITM  I                                         17510000
                     ,TEPLIS  L                                         17520000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             17530000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               17540000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               17550000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               17560000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               17570000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      17580000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  17590000
                AND   T.STR_NBR          = I.STR_NBR                    17600000
                AND   T.RGST_ID          = I.RGST_ID                    17610000
                AND   T.TRN_NBR          = I.TRN_NBR                    17620000
                AND   T.STRT_TM          = I.STRT_TM                    17630000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           17640000
                AND   I.PARTN_NBR        = L.PARTN_NBR                  17650000
                AND   I.STR_NBR          = L.STR_NBR                    17660000
                AND   I.RGST_ID          = L.RGST_ID                    17670000
                AND   I.TRN_NBR          = L.TRN_NBR                    17680000
                AND   I.STRT_TM          = L.STRT_TM                    17690000
                AND   I.SLS_CORR_SEQ_NBR = L.SLS_CORR_SEQ_NBR           17700000
                AND   I.LNE_ITM_SEQ_NBR  = L.LNE_ITM_SEQ_NBR            17710000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   17720000
                AND   L.SRVC_TYP_CDE      = 'F'                         17730000
            WITH UR                                                     17740000
           END-EXEC.                                                    17750000
                                                                        17760000
           EVALUATE TRUE                                                17770000
               WHEN SQLCODE = ZERO                                      17780000
                   MOVE PV-DB2-SUM   TO GL-WS-FEE                       17790000
                   ADD 1 TO PA-FEE-SELECT-CNT                           17800000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          17810000
               WHEN SQLCODE = PC-NULL                                   17820000
                   MOVE ZEROES       TO GL-WS-FEE                       17830000
               WHEN SQLWARN0 NOT EQUAL SPACE                            17840000
               WHEN SQLCODE NOT EQUAL ZERO                              17850000
                   MOVE SQLCODE TO PV-SQL                               17860000
                   MOVE '4240-SELECT-FEE' TO PV-PARAGRAPH-NAME          17870000
                   STRING 'ERROR SELECTING FEE - SQLCODE = '            17880000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG17890000
                   END-STRING                                           17900000
                   SET ABEND-4002-READ-ERROR TO TRUE                    17910000
                   PERFORM 9100-SQL-ABEND                               17920000
           END-EVALUATE.                                                17930000
                                                                        17940000
                                                                        17950000
      ******************************************************************17960000
      *  AEN - GET AMERICAN EXPRESS SALES AND RETURNS                   17970000
      ******************************************************************17980000
       4250-SELECT-AEN.                                                 17990000
                                                                        18000000
           EXEC SQL                                                     18010000
               SELECT SUM(N.TNDR_AMT)                                   18020000
                 INTO :PV-DB2-SUM                                       18030000
                 FROM TEPTRN  T                                         18040000
                     ,TEPTND  N                                         18050000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             18060000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               18070000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               18080000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               18090000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               18100000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      18110000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  18120000
                AND   T.STR_NBR          = N.STR_NBR                    18130000
                AND   T.RGST_ID          = N.RGST_ID                    18140000
                AND   T.TRN_NBR          = N.TRN_NBR                    18150000
                AND   T.STRT_TM          = N.STRT_TM                    18160000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           18170000
                AND   N.TNDR_TYP_CDE     = '08'                         18180000
                AND   N.TNDR_VOID_IND    = 'N'                          18190000
            WITH UR                                                     18200000
           END-EXEC.                                                    18210000
                                                                        18220000
           EVALUATE TRUE                                                18230000
               WHEN SQLCODE = ZERO                                      18240000
                   MOVE PV-DB2-SUM   TO GL-WS-AEN                       18250000
                   ADD 1 TO PA-AEN-SELECT-CNT                           18260000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          18270000
               WHEN SQLCODE = PC-NULL                                   18280000
                   MOVE ZEROES       TO GL-WS-AEN                       18290000
               WHEN SQLWARN0 NOT EQUAL SPACE                            18300000
               WHEN SQLCODE NOT EQUAL ZERO                              18310000
                   MOVE SQLCODE TO PV-SQL                               18320000
                   MOVE '4250-SELECT-AEN' TO PV-PARAGRAPH-NAME          18330000
                   STRING 'ERROR SELECTING AEN - SQLCODE = '            18340000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG18350000
                   END-STRING                                           18360000
                   SET ABEND-4002-READ-ERROR TO TRUE                    18370000
                   PERFORM 9100-SQL-ABEND                               18380000
           END-EVALUATE.                                                18390000
                                                                        18400000
                                                                        18410000
      ******************************************************************18420000
      *  BCN - GET BANK CARD SALES AND RETURNS                          18430000
      ******************************************************************18440000
       4260-SELECT-BCN.                                                 18450000
                                                                        18460000
           EXEC SQL                                                     18470000
               SELECT SUM(N.TNDR_AMT)                                   18480000
                 INTO :PV-DB2-SUM                                       18490000
                 FROM TEPTRN  T                                         18500000
                     ,TEPTND  N                                         18510000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             18520000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               18530000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               18540000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               18550000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               18560000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      18570000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  18580000
                AND   T.STR_NBR          = N.STR_NBR                    18590000
                AND   T.RGST_ID          = N.RGST_ID                    18600000
                AND   T.TRN_NBR          = N.TRN_NBR                    18610000
                AND   T.STRT_TM          = N.STRT_TM                    18620000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           18630000
                AND   N.TNDR_TYP_CDE     IN ('05','06')                 18640000
                AND   N.TNDR_VOID_IND    = 'N'                          18650000
            WITH UR                                                     18660000
           END-EXEC.                                                    18670000
                                                                        18680000
           EVALUATE TRUE                                                18690000
               WHEN SQLCODE = ZERO                                      18700000
                   MOVE PV-DB2-SUM   TO GL-WS-BCN                       18710000
                   ADD 1 TO PA-BCN-SELECT-CNT                           18720000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          18730000
               WHEN SQLCODE = PC-NULL                                   18740000
                   MOVE ZEROES       TO GL-WS-BCN                       18750000
               WHEN SQLWARN0 NOT EQUAL SPACE                            18760000
               WHEN SQLCODE NOT EQUAL ZERO                              18770000
                   MOVE SQLCODE TO PV-SQL                               18780000
                   MOVE '4260-SELECT-BCN' TO PV-PARAGRAPH-NAME          18790000
                   STRING 'ERROR SELECTING BCN - SQLCODE = '            18800000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG18810000
                   END-STRING                                           18820000
                   SET ABEND-4002-READ-ERROR TO TRUE                    18830000
                   PERFORM 9100-SQL-ABEND                               18840000
           END-EVALUATE.                                                18850000
                                                                        18860000
                                                                        18870000
      ******************************************************************18880000
      *  DBN - GET DEBIT CARD SALES AND RETURNS                         18890000
      ******************************************************************18900000
       4270-SELECT-DBN.                                                 18910000
                                                                        18920000
           EXEC SQL                                                     18930000
               SELECT SUM(N.TNDR_AMT)                                   18940000
                 INTO :PV-DB2-SUM                                       18950000
                 FROM TEPTRN  T                                         18960000
                     ,TEPTND  N                                         18970000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             18980000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               18990000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               19000000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               19010000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               19020000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      19030000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  19040000
                AND   T.STR_NBR          = N.STR_NBR                    19050000
                AND   T.RGST_ID          = N.RGST_ID                    19060000
                AND   T.TRN_NBR          = N.TRN_NBR                    19070000
                AND   T.STRT_TM          = N.STRT_TM                    19080000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           19090000
                AND   N.TNDR_TYP_CDE     = '19'                         19100000
                AND   N.TNDR_VOID_IND    = 'N'                          19110000
            WITH UR                                                     19120000
           END-EXEC.                                                    19130000
                                                                        19140000
           EVALUATE TRUE                                                19150000
               WHEN SQLCODE = ZERO                                      19160000
                   MOVE PV-DB2-SUM   TO GL-WS-DBN                       19170000
                   ADD 1 TO PA-DBN-SELECT-CNT                           19180000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          19190000
               WHEN SQLCODE = PC-NULL                                   19200000
                   MOVE ZEROES       TO GL-WS-DBN                       19210000
               WHEN SQLWARN0 NOT EQUAL SPACE                            19220000
               WHEN SQLCODE NOT EQUAL ZERO                              19230000
                   MOVE SQLCODE TO PV-SQL                               19240000
                   MOVE '4270-SELECT-DBN' TO PV-PARAGRAPH-NAME          19250000
                   STRING 'ERROR SELECTING DBN - SQLCODE = '            19260000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG19270000
                   END-STRING                                           19280000
                   SET ABEND-4002-READ-ERROR TO TRUE                    19290000
                   PERFORM 9100-SQL-ABEND                               19300000
           END-EVALUATE.                                                19310000
                                                                        19320000
      ******************************************************************19330000
      *  KCN - GET KOHL'S CHARGE SALES AND RETURNS                      19340000
COBTRL*      - EXCLUDE TRAILING TRANSACTIONS INCLUDED IN                19341016
COBTRL*        PARA 4390-SELECT-CVN.                                    19342016
      ******************************************************************19350000
       4280-SELECT-KCN.                                                 19360000
                                                                        19370000
           EXEC SQL                                                     19380000
               SELECT SUM(N.TNDR_AMT)                                   19390000
                 INTO :PV-DB2-SUM                                       19400000
                 FROM TEPTRN  T                                         19410000
                     ,TEPTND  N                                         19420000
COBTRL               ,TEPCRD  C                                         19421016
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             19430000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               19440000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               19450000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               19460000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               19470000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      19480000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  19490000
                AND   T.STR_NBR          = N.STR_NBR                    19500000
                AND   T.RGST_ID          = N.RGST_ID                    19510000
                AND   T.TRN_NBR          = N.TRN_NBR                    19520000
                AND   T.STRT_TM          = N.STRT_TM                    19530000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           19540000
COBTRL          AND   N.PARTN_NBR        = C.PARTN_NBR                  19541018
COBTRL          AND   N.STR_NBR          = C.STR_NBR                    19542018
COBTRL          AND   N.RGST_ID          = C.RGST_ID                    19543018
COBTRL          AND   N.TRN_NBR          = C.TRN_NBR                    19544018
COBTRL          AND   N.STRT_TM          = C.STRT_TM                    19545018
COBTRL          AND   N.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR           19546018
COBTRL          AND   N.TNDR_SEQ_NBR     = C.TNDR_SEQ_NBR               19547018
                AND   N.TNDR_TYP_CDE     = '04'                         19550000
                AND   N.TNDR_VOID_IND    = 'N'                          19560000
COBTRL          AND   C.TRLING_TRN_IND  <> 'Y'                          19561016
            WITH UR                                                     19570000
           END-EXEC.                                                    19580000
                                                                        19590000
           EVALUATE TRUE                                                19600000
               WHEN SQLCODE = ZERO                                      19610000
                   MOVE PV-DB2-SUM   TO GL-WS-KCN                       19620000
                   ADD 1 TO PA-KCN-SELECT-CNT                           19630000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          19640000
               WHEN SQLCODE = PC-NULL                                   19650000
                   MOVE ZEROES       TO GL-WS-KCN                       19660000
               WHEN SQLWARN0 NOT EQUAL SPACE                            19670000
               WHEN SQLCODE NOT EQUAL ZERO                              19680000
                   MOVE SQLCODE TO PV-SQL                               19690000
                   MOVE '4280-SELECT-KCN' TO PV-PARAGRAPH-NAME          19700000
                   STRING 'ERROR SELECTING KCN - SQLCODE = '            19710000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG19720000
                   END-STRING                                           19730000
                   SET ABEND-4002-READ-ERROR TO TRUE                    19740000
                   PERFORM 9100-SQL-ABEND                               19750000
           END-EVALUATE.                                                19760000
                                                                        19770000
      ******************************************************************19780000
      *  NCN - GET NOVUS (DISCOVER) SALES AND RETURNS                   19790000
      ******************************************************************19800000
       4290-SELECT-NCN.                                                 19810000
                                                                        19820000
           EXEC SQL                                                     19830000
               SELECT SUM(N.TNDR_AMT)                                   19840000
                 INTO :PV-DB2-SUM                                       19850000
                 FROM TEPTRN  T                                         19860000
                     ,TEPTND  N                                         19870000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             19880000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               19890000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               19900000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               19910000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               19920000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      19930000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  19940000
                AND   T.STR_NBR          = N.STR_NBR                    19950000
                AND   T.RGST_ID          = N.RGST_ID                    19960000
                AND   T.TRN_NBR          = N.TRN_NBR                    19970000
                AND   T.STRT_TM          = N.STRT_TM                    19980000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           19990000
                AND   N.TNDR_TYP_CDE     = '07'                         20000000
                AND   N.TNDR_VOID_IND    = 'N'                          20010000
            WITH UR                                                     20020000
           END-EXEC.                                                    20030000
                                                                        20040000
           EVALUATE TRUE                                                20050000
               WHEN SQLCODE = ZERO                                      20060000
                   MOVE PV-DB2-SUM   TO GL-WS-NCN                       20070000
                   ADD 1 TO PA-NCN-SELECT-CNT                           20080000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          20090000
               WHEN SQLCODE = PC-NULL                                   20100000
                   MOVE ZEROES       TO GL-WS-NCN                       20110000
               WHEN SQLWARN0 NOT EQUAL SPACE                            20120000
               WHEN SQLCODE NOT EQUAL ZERO                              20130000
                   MOVE SQLCODE TO PV-SQL                               20140000
                   MOVE '4290-SELECT-NCN' TO PV-PARAGRAPH-NAME          20150000
                   STRING 'ERROR SELECTING NCN - SQLCODE = '            20160000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG20170000
                   END-STRING                                           20180000
                   SET ABEND-4002-READ-ERROR TO TRUE                    20190000
                   PERFORM 9100-SQL-ABEND                               20200000
           END-EVALUATE.                                                20210000
                                                                        20220000
      ******************************************************************20230000
      *  GDT - GET KOHLS GIFT CARDS TENDERED                            20240000
      ******************************************************************20250000
       4300-SELECT-GDT.                                                 20260000
                                                                        20270000
           EXEC SQL                                                     20280000
               SELECT SUM(N.TNDR_AMT)                                   20290000
                 INTO :PV-DB2-SUM                                       20300000
                 FROM TEPTRN  T                                         20310000
                     ,TEPTND  N                                         20320000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             20330000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               20340000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               20350000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               20360000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               20370000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      20380000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  20390000
                AND   T.STR_NBR          = N.STR_NBR                    20400000
                AND   T.RGST_ID          = N.RGST_ID                    20410000
                AND   T.TRN_NBR          = N.TRN_NBR                    20420000
                AND   T.STRT_TM          = N.STRT_TM                    20430000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           20440000
                AND   N.TNDR_TYP_CDE     = '13'                         20450000
                AND   N.TNDR_ID_SRC_CDE <> '14'                         20460000
                AND   N.TNDR_VOID_IND    = 'N'                          20470000
            WITH UR                                                     20480000
           END-EXEC.                                                    20490000
                                                                        20500000
           EVALUATE TRUE                                                20510000
               WHEN SQLCODE = ZERO                                      20520000
                   MOVE PV-DB2-SUM   TO GL-WS-GDT                       20530000
                   ADD 1 TO PA-GDT-SELECT-CNT                           20540000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          20550000
               WHEN SQLCODE = PC-NULL                                   20560000
                   MOVE ZEROES       TO GL-WS-GDT                       20570000
               WHEN SQLWARN0 NOT EQUAL SPACE                            20580000
               WHEN SQLCODE NOT EQUAL ZERO                              20590000
                   MOVE SQLCODE TO PV-SQL                               20600000
                   MOVE '4300-SELECT-GDT' TO PV-PARAGRAPH-NAME          20610000
                   STRING 'ERROR SELECTING GDT - SQLCODE = '            20620000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG20630000
                   END-STRING                                           20640000
                   SET ABEND-4002-READ-ERROR TO TRUE                    20650000
                   PERFORM 9100-SQL-ABEND                               20660000
           END-EVALUATE.                                                20670000
                                                                        20680000
      ******************************************************************20690000
      *  CASH - GET CASH TENDERED                                       20700000
      ******************************************************************20710000
       4310-SELECT-CASH.                                                20720000
                                                                        20730000
           EXEC SQL                                                     20740000
               SELECT SUM(N.TNDR_AMT)                                   20750000
                 INTO :PV-DB2-SUM                                       20760000
                 FROM TEPTRN  T                                         20770000
                     ,TEPTND  N                                         20780000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             20790000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               20800000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               20810000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               20820000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               20830000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      20840000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  20850000
                AND   T.STR_NBR          = N.STR_NBR                    20860000
                AND   T.RGST_ID          = N.RGST_ID                    20870000
                AND   T.TRN_NBR          = N.TRN_NBR                    20880000
                AND   T.STRT_TM          = N.STRT_TM                    20890000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           20900000
                AND   N.TNDR_TYP_CDE     = '00'                         20910000
                AND   N.TNDR_VOID_IND    = 'N'                          20920000
            WITH UR                                                     20930000
           END-EXEC.                                                    20940000
                                                                        20950000
           EVALUATE TRUE                                                20960000
               WHEN SQLCODE = ZERO                                      20970000
                   MOVE PV-DB2-SUM   TO GL-WS-CASH                      20980000
                   ADD 1 TO PA-CASH-SELECT-CNT                          20990000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          21000000
               WHEN SQLCODE = PC-NULL                                   21010000
                   MOVE ZEROES       TO GL-WS-CASH                      21020000
               WHEN SQLWARN0 NOT EQUAL SPACE                            21030000
               WHEN SQLCODE NOT EQUAL ZERO                              21040000
                   MOVE SQLCODE TO PV-SQL                               21050000
                   MOVE '4310-SELECT-CASH' TO PV-PARAGRAPH-NAME         21060000
                   STRING 'ERROR SELECTING CASH - SQLCODE = '           21070000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG21080000
                   END-STRING                                           21090000
                   SET ABEND-4002-READ-ERROR TO TRUE                    21100000
                   PERFORM 9100-SQL-ABEND                               21110000
           END-EVALUATE.                                                21120000
                                                                        21130000
      ******************************************************************21140000
      *  CHECK - GET CHECKS TENDERED                                    21150000
      ******************************************************************21160000
       4320-SELECT-CHECK.                                               21170000
                                                                        21180000
           EXEC SQL                                                     21190000
               SELECT SUM(N.TNDR_AMT)                                   21200000
                 INTO :PV-DB2-SUM                                       21210000
                 FROM TEPTRN  T                                         21220000
                     ,TEPTND  N                                         21230000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             21240000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               21250000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               21260000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               21270000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               21280000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      21290000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  21300000
                AND   T.STR_NBR          = N.STR_NBR                    21310000
                AND   T.RGST_ID          = N.RGST_ID                    21320000
                AND   T.TRN_NBR          = N.TRN_NBR                    21330000
                AND   T.STRT_TM          = N.STRT_TM                    21340000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           21350000
                AND   N.TNDR_TYP_CDE     = '01'                         21360000
                AND   N.TNDR_VOID_IND    = 'N'                          21370000
            WITH UR                                                     21380000
           END-EXEC.                                                    21390000
                                                                        21400000
           EVALUATE TRUE                                                21410000
               WHEN SQLCODE = ZERO                                      21420000
                   MOVE PV-DB2-SUM   TO GL-WS-CHECK                     21430000
                   ADD 1 TO PA-CHECK-SELECT-CNT                         21440000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          21450000
               WHEN SQLCODE = PC-NULL                                   21460000
                   MOVE ZEROES       TO GL-WS-CHECK                     21470000
               WHEN SQLWARN0 NOT EQUAL SPACE                            21480000
               WHEN SQLCODE NOT EQUAL ZERO                              21490000
                   MOVE SQLCODE TO PV-SQL                               21500000
                   MOVE '4320-SELECT-CHECK' TO PV-PARAGRAPH-NAME        21510000
                   STRING 'ERROR SELECTING CHECK - SQLCODE = '          21520000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG21530000
                   END-STRING                                           21540000
                   SET ABEND-4002-READ-ERROR TO TRUE                    21550000
                   PERFORM 9100-SQL-ABEND                               21560000
           END-EVALUATE.                                                21570000
                                                                        21580000
      ******************************************************************21590000
      *  KCP - GET KOHLS CHARGE PAYMENTS                                21600000
COBTRL*      - EXCLUDE TRAILING TRANSACTIONS INCLUDED IN                21601017
COBTRL*        PARA 4400-SELECT-CVP.                                    21602017
      ******************************************************************21610000
       4330-SELECT-KCP.                                                 21620000
                                                                        21630000
           EXEC SQL                                                     21640000
               SELECT SUM(Y.PAYT_AMT)                                   21650000
                 INTO :PV-DB2-SUM                                       21660000
                 FROM TEPTRN  T                                         21670000
                     ,TEPPAY  Y                                         21680000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             21690000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               21700000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               21710000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               21720000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               21730000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      21740000
                AND   T.PARTN_NBR        = Y.PARTN_NBR                  21750000
                AND   T.STR_NBR          = Y.STR_NBR                    21760000
                AND   T.RGST_ID          = Y.RGST_ID                    21770000
                AND   T.TRN_NBR          = Y.TRN_NBR                    21780000
                AND   T.STRT_TM          = Y.STRT_TM                    21790000
                AND   T.SLS_CORR_SEQ_NBR = Y.SLS_CORR_SEQ_NBR           21800000
                AND   Y.COBRND_IND      <> 'Y'                          21810017
COBTRL          AND   Y.TRLING_TRN_IND   = 'N'                          21811017
            WITH UR                                                     21820000
           END-EXEC.                                                    21830000
                                                                        21840000
           EVALUATE TRUE                                                21850000
               WHEN SQLCODE = ZERO                                      21860000
                   MOVE PV-DB2-SUM   TO GL-WS-KCP                       21870000
                   ADD 1 TO PA-KCP-SELECT-CNT                           21880000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          21890000
               WHEN SQLCODE = PC-NULL                                   21900000
                   MOVE ZEROES       TO GL-WS-KCP                       21910000
               WHEN SQLWARN0 NOT EQUAL SPACE                            21920000
               WHEN SQLCODE NOT EQUAL ZERO                              21930000
                   MOVE SQLCODE TO PV-SQL                               21940000
                   MOVE '4330-SELECT-KCP' TO PV-PARAGRAPH-NAME          21950000
                   STRING 'ERROR SELECTING KCP - SQLCODE = '            21960000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG21970000
                   END-STRING                                           21980000
                   SET ABEND-4002-READ-ERROR TO TRUE                    21990000
                   PERFORM 9100-SQL-ABEND                               22000000
           END-EVALUATE.                                                22010000
                                                                        22020000
      ******************************************************************22030000
      *  CRI - GET CORPORATE REFUNDS                                    22040000
      ******************************************************************22050000
       4340-SELECT-CRI.                                                 22060000
                                                                        22070000
           EXEC SQL                                                     22080000
               SELECT SUM(X.TNDR_AMT)                                   22090000
                 INTO :PV-DB2-SUM                                       22100000
                 FROM TEPTRN  T                                         22110000
                     ,TEPRFN  Y                                         22120000
                     ,TEPTND  X                                         22130000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             22140000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               22150000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               22160000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               22170000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               22180000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      22190000
                AND   T.PARTN_NBR        = Y.PARTN_NBR                  22200000
                AND   T.STR_NBR          = Y.STR_NBR                    22210000
                AND   T.RGST_ID          = Y.RGST_ID                    22220000
                AND   T.TRN_NBR          = Y.TRN_NBR                    22230000
                AND   T.STRT_TM          = Y.STRT_TM                    22240000
                AND   T.SLS_CORR_SEQ_NBR = Y.SLS_CORR_SEQ_NBR           22250000
                AND   T.PARTN_NBR        = X.PARTN_NBR                  22260000
                AND   T.STR_NBR          = X.STR_NBR                    22270000
                AND   T.RGST_ID          = X.RGST_ID                    22280000
                AND   T.TRN_NBR          = X.TRN_NBR                    22290000
                AND   T.STRT_TM          = X.STRT_TM                    22300000
                AND   T.SLS_CORR_SEQ_NBR = X.SLS_CORR_SEQ_NBR           22310000
                AND   Y.TNDR_SEQ_NBR     = X.TNDR_SEQ_NBR               22320000
            WITH UR                                                     22330000
           END-EXEC.                                                    22340000
                                                                        22350000
           EVALUATE TRUE                                                22360000
               WHEN SQLCODE = ZERO                                      22370000
                   MOVE PV-DB2-SUM   TO GL-WS-CRI                       22380000
                   ADD 1 TO PA-CRI-SELECT-CNT                           22390000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          22400000
               WHEN SQLCODE = PC-NULL                                   22410000
                   MOVE ZEROES       TO GL-WS-CRI                       22420000
               WHEN SQLWARN0 NOT EQUAL SPACE                            22430000
               WHEN SQLCODE NOT EQUAL ZERO                              22440000
                   MOVE SQLCODE TO PV-SQL                               22450000
                   MOVE '4340-SELECT-CRI' TO PV-PARAGRAPH-NAME          22460000
                   STRING 'ERROR SELECTING CRI - SQLCODE = '            22470000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG22480000
                   END-STRING                                           22490000
                   SET ABEND-4002-READ-ERROR TO TRUE                    22500000
                   PERFORM 9100-SQL-ABEND                               22510000
           END-EVALUATE.                                                22520000
                                                                        22530000
      ******************************************************************22540000
      *  EMPDISC - GET EMPLOYEE DISCOUNTS                               22550000
      ******************************************************************22560000
       4350-SELECT-EMPDISC.                                             22570000
                                                                        22580000
           EXEC SQL                                                     22590000
               SELECT SUM(E.EMP_DISC_AMT)                               22600000
                 INTO :PV-DB2-SUM                                       22610000
                 FROM TEPTRN  T                                         22620000
                     ,TEPITM  I                                         22630000
                     ,TEPEID  E                                         22640000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             22650000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               22660000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               22670000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               22680000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               22690000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      22700000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  22710000
                AND   T.STR_NBR          = I.STR_NBR                    22720000
                AND   T.RGST_ID          = I.RGST_ID                    22730000
                AND   T.TRN_NBR          = I.TRN_NBR                    22740000
                AND   T.STRT_TM          = I.STRT_TM                    22750000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           22760000
                AND   I.PARTN_NBR        = E.PARTN_NBR                  22770000
                AND   I.STR_NBR          = E.STR_NBR                    22780000
                AND   I.RGST_ID          = E.RGST_ID                    22790000
                AND   I.TRN_NBR          = E.TRN_NBR                    22800000
                AND   I.STRT_TM          = E.STRT_TM                    22810000
                AND   I.SLS_CORR_SEQ_NBR = E.SLS_CORR_SEQ_NBR           22820000
                AND   I.LNE_ITM_SEQ_NBR  = E.LNE_ITM_SEQ_NBR            22830000
                AND   I.LIV_RSLU_CDE     IN ('+', '-')                  22840000
            WITH UR                                                     22850000
           END-EXEC.                                                    22860000
                                                                        22870000
           EVALUATE TRUE                                                22880000
               WHEN SQLCODE = ZERO                                      22890000
                   MOVE PV-DB2-SUM   TO GL-WS-EMPDISC                   22900000
                   ADD 1 TO PA-EMPDISC-SELECT-CNT                       22910000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          22920000
               WHEN SQLCODE = PC-NULL                                   22930000
                   MOVE ZEROES       TO GL-WS-EMPDISC                   22940000
               WHEN SQLWARN0 NOT EQUAL SPACE                            22950000
               WHEN SQLCODE NOT EQUAL ZERO                              22960000
                   MOVE SQLCODE TO PV-SQL                               22970000
                   MOVE '4350-SELECT-EMPDISC' TO PV-PARAGRAPH-NAME      22980000
                   STRING 'ERROR SELECTING EMPDISC - SQLCODE = '        22990000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG23000000
                   END-STRING                                           23010000
                   SET ABEND-4002-READ-ERROR TO TRUE                    23020000
                   PERFORM 9100-SQL-ABEND                               23030000
           END-EVALUATE.                                                23040000
                                                                        23050000
                                                                        23060000
      *4360-SELECT-KKT.                                                 23070000
                                                                        23080000
                                                                        23090000
      ******************************************************************23100000
      *  SGT - GET SEPHORA GIFT CARDS TENDERED                          23110000
      ******************************************************************23120000
       4370-SELECT-SGT.                                                 23130000
                                                                        23140000
           EXEC SQL                                                     23150000
               SELECT SUM(N.TNDR_AMT)                                   23160000
                 INTO :PV-DB2-SUM                                       23170000
                 FROM TEPTRN  T                                         23180000
                     ,TEPTND  N                                         23190000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             23200000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               23210000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               23220000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               23230000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               23240000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      23250000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  23260000
                AND   T.STR_NBR          = N.STR_NBR                    23270000
                AND   T.RGST_ID          = N.RGST_ID                    23280000
                AND   T.TRN_NBR          = N.TRN_NBR                    23290000
                AND   T.STRT_TM          = N.STRT_TM                    23300000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           23310000
                AND   N.TNDR_TYP_CDE     = '13'                         23320000
                AND   N.TNDR_ID_SRC_CDE  = '14'                         23330000
                AND   N.TNDR_VOID_IND    = 'N'                          23340000
            WITH UR                                                     23350000
           END-EXEC.                                                    23360000
                                                                        23370000
           EVALUATE TRUE                                                23380000
               WHEN SQLCODE = ZERO                                      23390000
                   MOVE PV-DB2-SUM   TO GL-WS-SGT                       23400000
                   ADD 1 TO PA-SGT-SELECT-CNT                           23410000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          23420000
               WHEN SQLCODE = PC-NULL                                   23430000
                   MOVE ZEROES       TO GL-WS-SGT                       23440000
               WHEN SQLWARN0 NOT EQUAL SPACE                            23450000
               WHEN SQLCODE NOT EQUAL ZERO                              23460000
                   MOVE SQLCODE TO PV-SQL                               23470000
                   MOVE '4370-SELECT-SGT' TO PV-PARAGRAPH-NAME          23480000
                   STRING 'ERROR SELECTING SGT - SQLCODE = '            23490000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG23500000
                   END-STRING                                           23510000
                   SET ABEND-4002-READ-ERROR TO TRUE                    23520000
                   PERFORM 9100-SQL-ABEND                               23530000
           END-EVALUATE.                                                23540000
                                                                        23550000
                                                                        23560000
      ******************************************************************23570000
      *  MKTPLC - GET MARKETPLACE TOTALS                                23580000
      ******************************************************************23590000
       4380-SELECT-MKTPLC.                                              23600000
                                                                        23610000
           EXEC SQL                                                     23620000
               SELECT SUM(NET_CHRGD_AMT)                                23630000
                 INTO :PV-DB2-SUM                                       23640000
                 FROM TEPTRN  T                                         23650000
                     ,TEPITM  I                                         23660000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             23670000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               23680000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               23690000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               23700000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               23710000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      23720000
                AND   T.PARTN_NBR        = I.PARTN_NBR                  23730000
                AND   T.STR_NBR          = I.STR_NBR                    23740000
                AND   T.RGST_ID          = I.RGST_ID                    23750000
                AND   T.TRN_NBR          = I.TRN_NBR                    23760000
                AND   T.STRT_TM          = I.STRT_TM                    23770000
                AND   T.SLS_CORR_SEQ_NBR = I.SLS_CORR_SEQ_NBR           23780000
                AND   I.LIV_RSLU_CDE     IN ('+','-')                   23790000
                AND   I.DEPT_NBR          = '985'                       23800000
            WITH UR                                                     23810000
           END-EXEC.                                                    23820000
                                                                        23830000
           EVALUATE TRUE                                                23840000
               WHEN SQLCODE = ZERO                                      23850000
                   MOVE PV-DB2-SUM   TO GL-WS-MKTPLC                    23860000
                   ADD 1 TO PA-MKTPLC-SELECT-CNT                        23870000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          23880000
               WHEN SQLCODE = PC-NULL                                   23890000
                   MOVE ZEROES       TO GL-WS-MKTPLC                    23900000
               WHEN SQLWARN0 NOT EQUAL SPACE                            23910000
               WHEN SQLCODE NOT EQUAL ZERO                              23920000
                   MOVE SQLCODE TO PV-SQL                               23930000
                   MOVE '4380-SELECT-MKTPLC' TO PV-PARAGRAPH-NAME       23940005
                   STRING 'ERROR SELECTING MKTPLC - SQLCODE = '         23950000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG23960000
                   END-STRING                                           23970000
                   SET ABEND-4002-READ-ERROR TO TRUE                    23980000
                   PERFORM 9100-SQL-ABEND                               23990000
           END-EVALUATE.                                                24000000
                                                                        24010000
                                                                        24020000
      ******************************************************************24030000
      *  CVN - GET COBRAND CHARGE SALES AND RETURNS                     24040000
COBTRL*      - INCLUDE KCN TRAILING TRANSACTIONS EXCLUDED IN PARA       24041016
COBTRL*        4280-SELECT-KCN.                                         24042016
      ******************************************************************24050000
       4390-SELECT-CVN.                                                 24060000
                                                                        24070000
           EXEC SQL                                                     24080000
               SELECT SUM(N.TNDR_AMT)                                   24090000
                 INTO :PV-DB2-SUM                                       24100000
                 FROM TEPTRN  T                                         24110000
                     ,TEPTND  N                                         24120000
COBTRL               ,TEPCRD  C                                         24121016
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             24130000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               24140000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               24150000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               24160000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               24170000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      24180000
                AND   T.PARTN_NBR        = N.PARTN_NBR                  24190000
                AND   T.STR_NBR          = N.STR_NBR                    24200000
                AND   T.RGST_ID          = N.RGST_ID                    24210000
                AND   T.TRN_NBR          = N.TRN_NBR                    24220000
                AND   T.STRT_TM          = N.STRT_TM                    24230000
                AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           24240000
COBTRL          AND   N.PARTN_NBR        = C.PARTN_NBR                  24241018
COBTRL          AND   N.STR_NBR          = C.STR_NBR                    24242018
COBTRL          AND   N.RGST_ID          = C.RGST_ID                    24243018
COBTRL          AND   N.TRN_NBR          = C.TRN_NBR                    24244018
COBTRL          AND   N.STRT_TM          = C.STRT_TM                    24245018
COBTRL          AND   N.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR           24246018
COBTRL          AND   N.TNDR_SEQ_NBR     = C.TNDR_SEQ_NBR               24247018
                AND   N.TNDR_VOID_IND    = 'N'                          24260000
COBTRL          AND ((N.TNDR_TYP_CDE     = '24')                        24261016
COBTRL           OR  (N.TNDR_TYP_CDE     = '04'   AND                   24262016
COBTRL                C.TRLING_TRN_IND   = 'Y'))                        24263016
            WITH UR                                                     24270000
           END-EXEC.                                                    24280000
                                                                        24290000
           EVALUATE TRUE                                                24300000
               WHEN SQLCODE = ZERO                                      24310000
                   MOVE PV-DB2-SUM   TO GL-WS-CVN                       24320000
                   ADD 1 TO PA-CVN-SELECT-CNT                           24330000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          24340000
               WHEN SQLCODE = PC-NULL                                   24350000
                   MOVE ZEROES       TO GL-WS-CVN                       24360000
               WHEN SQLWARN0 NOT EQUAL SPACE                            24370000
               WHEN SQLCODE NOT EQUAL ZERO                              24380000
                   MOVE SQLCODE TO PV-SQL                               24390000
                   MOVE '4390-SELECT-CVN' TO PV-PARAGRAPH-NAME          24400005
                   STRING 'ERROR SELECTING CVN - SQLCODE = '            24410000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG24420000
                   END-STRING                                           24430000
                   SET ABEND-4002-READ-ERROR TO TRUE                    24440000
                   PERFORM 9100-SQL-ABEND                               24450000
           END-EVALUATE.                                                24460000
                                                                        24470000
                                                                        24480000
      ******************************************************************24490000
      *  CVP - GET COBRAND CHARGE PAYMENTS                              24500000
COBTRL*      - INCLUDE KCP TRAILING TRANSACTIONS EXCLUDED IN PARA       24501017
COBTRL*        4330-SELECT-KCN.                                         24502017
      ******************************************************************24510000
       4400-SELECT-CVP.                                                 24520000
                                                                        24530000
           EXEC SQL                                                     24540000
               SELECT SUM(Y.PAYT_AMT)                                   24550000
                 INTO :PV-DB2-SUM                                       24560000
                 FROM TEPTRN  T                                         24570000
                     ,TEPPAY  Y                                         24580000
              WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             24590000
                AND   T.STR_NBR          = :EPTRN-STR-NBR               24600000
                AND   T.RGST_ID          = :EPTRN-RGST-ID               24610000
                AND   T.TRN_NBR          = :EPTRN-TRN-NBR               24620000
                AND   T.STRT_TM          = :EPTRN-STRT-TM               24630000
                AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      24640000
                AND   T.PARTN_NBR        = Y.PARTN_NBR                  24650000
                AND   T.STR_NBR          = Y.STR_NBR                    24660000
                AND   T.RGST_ID          = Y.RGST_ID                    24670000
                AND   T.TRN_NBR          = Y.TRN_NBR                    24680000
                AND   T.STRT_TM          = Y.STRT_TM                    24690000
                AND   T.SLS_CORR_SEQ_NBR = Y.SLS_CORR_SEQ_NBR           24700000
COBTRL          AND ((Y.COBRND_IND       = 'Y')  OR                     24710021
COBTRL               (Y.TRLING_TRN_IND   = 'Y'))                        24712021
            WITH UR                                                     24720000
           END-EXEC.                                                    24730000
                                                                        24740000
           EVALUATE TRUE                                                24750000
               WHEN SQLCODE = ZERO                                      24760000
                   MOVE PV-DB2-SUM   TO GL-WS-CVP                       24770000
                   ADD 1 TO PA-CVP-SELECT-CNT                           24780000
               WHEN SQLCODE = PC-ROW-NOT-FOUND                          24790000
               WHEN SQLCODE = PC-NULL                                   24800000
                   MOVE ZEROES       TO GL-WS-CVP                       24810000
               WHEN SQLWARN0 NOT EQUAL SPACE                            24820000
               WHEN SQLCODE NOT EQUAL ZERO                              24830000
                   MOVE SQLCODE TO PV-SQL                               24840000
                   MOVE '4400-SELECT-CVP' TO PV-PARAGRAPH-NAME          24850005
                   STRING 'ERROR SELECTING CVP - SQLCODE = '            24860000
                      PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG24870000
                   END-STRING                                           24880000
                   SET ABEND-4002-READ-ERROR TO TRUE                    24890000
                   PERFORM 9100-SQL-ABEND                               24900000
           END-EVALUATE.                                                24910000
                                                                        24920000
PAYVEN                                                                  24921005
PAYVEN******************************************************************24922005
PAYVEN*  PPN - GET PAYPAL CHARGE SALES AND RETURNS                      24923005
PAYVEN******************************************************************24924005
PAYVEN 4410-SELECT-PPN.                                                 24925005
PAYVEN                                                                  24926005
PAYVEN     EXEC SQL                                                     24927005
PAYVEN         SELECT SUM(N.TNDR_AMT)                                   24928005
PAYVEN           INTO :PV-DB2-SUM                                       24929005
PAYVEN           FROM TEPTRN  T                                         24929105
PAYVEN               ,TEPTND  N                                         24929205
PAYVEN        WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             24929305
PAYVEN          AND   T.STR_NBR          = :EPTRN-STR-NBR               24929405
PAYVEN          AND   T.RGST_ID          = :EPTRN-RGST-ID               24929505
PAYVEN          AND   T.TRN_NBR          = :EPTRN-TRN-NBR               24929605
PAYVEN          AND   T.STRT_TM          = :EPTRN-STRT-TM               24929705
PAYVEN          AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      24929805
PAYVEN          AND   T.PARTN_NBR        = N.PARTN_NBR                  24929905
PAYVEN          AND   T.STR_NBR          = N.STR_NBR                    24930005
PAYVEN          AND   T.RGST_ID          = N.RGST_ID                    24930105
PAYVEN          AND   T.TRN_NBR          = N.TRN_NBR                    24930205
PAYVEN          AND   T.STRT_TM          = N.STRT_TM                    24930305
PAYVEN          AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           24930405
PAYVEN          AND   N.TNDR_TYP_CDE     = '16'                         24930505
PAYVEN          AND   N.TNDR_VOID_IND    = 'N'                          24930605
PAYVEN      WITH UR                                                     24930705
PAYVEN     END-EXEC.                                                    24930805
PAYVEN                                                                  24930905
PAYVEN     EVALUATE TRUE                                                24931005
PAYVEN         WHEN SQLCODE = ZERO                                      24931105
PAYVEN             MOVE PV-DB2-SUM   TO GL-WS-PPN                       24931205
PAYVEN             ADD 1 TO PA-PPN-SELECT-CNT                           24931305
PAYVEN         WHEN SQLCODE = PC-ROW-NOT-FOUND                          24931405
PAYVEN         WHEN SQLCODE = PC-NULL                                   24931505
PAYVEN             MOVE ZEROES       TO GL-WS-PPN                       24931605
PAYVEN         WHEN SQLWARN0 NOT EQUAL SPACE                            24931705
PAYVEN         WHEN SQLCODE NOT EQUAL ZERO                              24931805
PAYVEN             MOVE SQLCODE TO PV-SQL                               24931905
PAYVEN             MOVE '4410-SELECT-PPN' TO PV-PARAGRAPH-NAME          24932005
PAYVEN             STRING 'ERROR SELECTING PPN - SQLCODE = '            24932105
PAYVEN                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG24932205
PAYVEN             END-STRING                                           24932305
PAYVEN             SET ABEND-4002-READ-ERROR TO TRUE                    24932405
PAYVEN             PERFORM 9100-SQL-ABEND                               24932505
PAYVEN     END-EVALUATE.                                                24932605
PAYVEN                                                                  24932705
PAYVEN                                                                  24932805
PAYVEN******************************************************************24932905
PAYVEN*  VMN - GET VENMO CHARGE SALES AND RETURNS                       24933005
PAYVEN******************************************************************24933105
PAYVEN 4420-SELECT-VMN.                                                 24933205
PAYVEN                                                                  24933305
PAYVEN     EXEC SQL                                                     24933405
PAYVEN         SELECT SUM(N.TNDR_AMT)                                   24933505
PAYVEN           INTO :PV-DB2-SUM                                       24933605
PAYVEN           FROM TEPTRN  T                                         24933705
PAYVEN               ,TEPTND  N                                         24933805
PAYVEN        WHERE   T.PARTN_NBR        = :EPTRN-PARTN-NBR             24933905
PAYVEN          AND   T.STR_NBR          = :EPTRN-STR-NBR               24934005
PAYVEN          AND   T.RGST_ID          = :EPTRN-RGST-ID               24934105
PAYVEN          AND   T.TRN_NBR          = :EPTRN-TRN-NBR               24934205
PAYVEN          AND   T.STRT_TM          = :EPTRN-STRT-TM               24934305
PAYVEN          AND   T.SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR      24934405
PAYVEN          AND   T.PARTN_NBR        = N.PARTN_NBR                  24934505
PAYVEN          AND   T.STR_NBR          = N.STR_NBR                    24934605
PAYVEN          AND   T.RGST_ID          = N.RGST_ID                    24934705
PAYVEN          AND   T.TRN_NBR          = N.TRN_NBR                    24934805
PAYVEN          AND   T.STRT_TM          = N.STRT_TM                    24934905
PAYVEN          AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR           24935005
PAYVEN          AND   N.TNDR_TYP_CDE     = '17'                         24935105
PAYVEN          AND   N.TNDR_VOID_IND    = 'N'                          24935205
PAYVEN      WITH UR                                                     24935305
PAYVEN     END-EXEC.                                                    24935405
PAYVEN                                                                  24935505
PAYVEN     EVALUATE TRUE                                                24935605
PAYVEN         WHEN SQLCODE = ZERO                                      24935705
PAYVEN             MOVE PV-DB2-SUM   TO GL-WS-VMN                       24935805
PAYVEN             ADD 1 TO PA-VMN-SELECT-CNT                           24935905
PAYVEN         WHEN SQLCODE = PC-ROW-NOT-FOUND                          24936005
PAYVEN         WHEN SQLCODE = PC-NULL                                   24936105
PAYVEN             MOVE ZEROES       TO GL-WS-VMN                       24936205
PAYVEN         WHEN SQLWARN0 NOT EQUAL SPACE                            24936305
PAYVEN         WHEN SQLCODE NOT EQUAL ZERO                              24936405
PAYVEN             MOVE SQLCODE TO PV-SQL                               24936505
PAYVEN             MOVE '4420-SELECT-VMN' TO PV-PARAGRAPH-NAME          24936605
PAYVEN             STRING 'ERROR SELECTING VMN - SQLCODE = '            24936705
PAYVEN                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG24936805
PAYVEN             END-STRING                                           24936905
PAYVEN             SET ABEND-4002-READ-ERROR TO TRUE                    24937005
PAYVEN             PERFORM 9100-SQL-ABEND                               24937105
PAYVEN     END-EVALUATE.                                                24937205
PAYVEN                                                                  24937305
                                                                        24938005
      ******************************************************************24940000
      * WRITE THE HEADER RECORD WITH COLUMN HEADINGS IF FIRST RECORD.   24950000
      * FORMAT THE TRANSACTION DETAIL RECORD.                           24960000
      * WRITE THE TRANSACTION DETAIL RECORD.                            24970000
      ******************************************************************24980000
       5000-WRITE-GL-RECORD.                                            24990000
                                                                        25000000
           IF PA-GL-FILE-OUT-WRITTEN = ZERO                             25010000
               WRITE LATE-GL-CSV-RECORD-OUT FROM GL-HEADER-RECORD       25020000
               ADD 1 TO PA-GL-FILE-OUT-WRITTEN                          25030000
           END-IF.                                                      25040000
                                                                        25050000
           PERFORM 5100-FORMAT-CSV-RECORD.                              25060000
           WRITE LATE-GL-CSV-RECORD-OUT FROM GL-RECORD-OUT.             25070000
           ADD 1 TO PA-GL-FILE-OUT-WRITTEN.                             25080000
                                                                        25090000
                                                                        25100000
      ******************************************************************25110000
      * STM (STATE TAXABLE MDSE) AND TMR (TOTAL MDSE RETURNS)           25120000
      * ARE CALCULATED BASED ON OTHER QUERIES.                          25130000
      * MOVE NUMERIC QUERY RESULTS TO FORMATTED CSV RECORD.             25140000
      ******************************************************************25150000
       5100-FORMAT-CSV-RECORD.                                          25160000
                                                                        25170000
           IF  EPTRN-TRN-TYP-CDE  = '01' OR '02'                        25180000
               COMPUTE GL-WS-STM          = GL-WS-SALES                 25190000
                                          - GL-WS-SFS                   25200000
                                          - GL-WS-BOS                   25210000
                                          - GL-WS-BPS                   25220000
                                          - GL-WS-KKB                   25230000
                                          - GL-WS-KKH                   25240000
                                          - GL-WS-KKS                   25250000
                                          - GL-WS-KKU                   25260000
                                          - GL-WS-SHS                   25270000
                                          - GL-WS-GDS                   25280007
                                          - GL-WS-TPC                   25290007
PAYVEN***      TPC INCLUDES TCC           - GL-WS-TCC                   25301009
                                          - GL-WS-SGS                   25310007
                                          - GL-WS-MKTPLC                25320000
                                          - GL-WS-FEE                   25330000
           ELSE                                                         25340000
               IF  EPTRN-TRN-TYP-CDE = '11' OR '12' OR '24' OR '25'     25350000
PAYVEN***          DO NOT SUBTRACT BSR OR BPR FROM ECR                  25361012
                   COMPUTE GL-WS-TMR       = GL-WS-RETURNS              25390000
                                           - GL-WS-ECR                  25400000
                                           - GL-WS-BSR                  25410000
                                           - GL-WS-BPR                  25420000
                                           - GL-WS-SHR                  25430000
PAYVEN                                     - GL-WS-MKTPLC               25431003
                                           - GL-WS-FEE                  25440000
PAYVEN                                     - GL-WS-KKB                  25441007
PAYVEN                                     - GL-WS-KKH                  25442007
PAYVEN                                     - GL-WS-KKS                  25443007
PAYVEN                                     - GL-WS-KKU                  25444007
               ELSE                                                     25450000
      **           '30' = PAYMENTS                                      25460000
                   CONTINUE                                             25470000
           END-IF.                                                      25480000
                                                                        25490000
           COMPUTE GL-WS-GDTT          = GL-WS-GDT - GL-WS-KKT.         25500000
                                                                        25500103
PAYVEN     COMPUTE GL-WS-TPC           = GL-WS-TPC - GL-WS-TCC.         25501005
                                                                        25510000
           MOVE GL-WS-PROCESS-DATE     TO   GL-PROCESS-DATE.            25520000
           MOVE GL-WS-SALES-DATE       TO   GL-SALES-DATE.              25530000
           MOVE GL-WS-STORE            TO   GL-STORE.                   25540000
           MOVE GL-WS-REGISTER         TO   GL-REGISTER.                25550000
           MOVE GL-WS-TRAN             TO   GL-TRAN.                    25560000
           MOVE GL-WS-START-TIME       TO   GL-START-TIME.              25570000
           MOVE GL-WS-CORR-SEQ-NBR     TO   GL-CORR-SEQ-NBR.            25580000
           MOVE GL-WS-PARTN-NBR        TO   GL-PARTN-NBR.               25590000
           MOVE GL-WS-STATUS           TO   GL-STATUS.                  25600000
           MOVE GL-WS-TYPE-CODE        TO   GL-TYPE-CODE.               25610000
           MOVE GL-WS-TRAN-AMT         TO   GL-TRAN-AMT.                25620000
           MOVE GL-WS-SALES            TO   GL-SALES.                   25630000
           MOVE GL-WS-RETURNS          TO   GL-RETURNS.                 25640000
           MOVE GL-WS-TAX              TO   GL-TAX.                     25650000
           MOVE GL-WS-STORE            TO   GL-STORE.                   25660000
           MOVE GL-WS-SALES            TO   GL-SALES.                   25670000
           MOVE GL-WS-GDS              TO   GL-GDS.                     25680000
           MOVE GL-WS-TPC              TO   GL-TPC.                     25690000
           MOVE GL-WS-TCC              TO   GL-TCC.                     25700000
           MOVE GL-WS-BOS              TO   GL-BOS.                     25710000
           MOVE GL-WS-BPS              TO   GL-BPS.                     25720000
           MOVE GL-WS-SFS              TO   GL-SFS.                     25730000
           MOVE GL-WS-KKB              TO   GL-KKB.                     25740000
           MOVE GL-WS-KKH              TO   GL-KKH.                     25750000
           MOVE GL-WS-KKS              TO   GL-KKS.                     25760000
           MOVE GL-WS-KKU              TO   GL-KKU.                     25770000
           MOVE GL-WS-SHS              TO   GL-SHS.                     25780000
           MOVE GL-WS-STM              TO   GL-STM.                     25790000
           MOVE GL-WS-RETURNS          TO   GL-RETURNS.                 25800000
           MOVE GL-WS-BSR              TO   GL-BSR.                     25810000
           MOVE GL-WS-BPR              TO   GL-BPR.                     25820000
           MOVE GL-WS-ECR              TO   GL-ECR.                     25830000
           MOVE GL-WS-SHR              TO   GL-SHR.                     25840000
           MOVE GL-WS-TMR              TO   GL-TMR.                     25850000
           MOVE GL-WS-TAX              TO   GL-TAX.                     25860000
           MOVE GL-WS-FEE              TO   GL-FEE.                     25870000
           MOVE GL-WS-AEN              TO   GL-AEN.                     25880000
           MOVE GL-WS-BCN              TO   GL-BCN.                     25890000
           MOVE GL-WS-DBN              TO   GL-DBN.                     25900000
           MOVE GL-WS-KCN              TO   GL-KCN.                     25910000
           MOVE GL-WS-NCN              TO   GL-NCN.                     25920000
           MOVE GL-WS-GDT              TO   GL-GDT.                     25930000
           MOVE GL-WS-KKT              TO   GL-KKT.                     25940000
           MOVE GL-WS-GDTT             TO   GL-GDTT.                    25950000
           MOVE GL-WS-KMT              TO   GL-KMT.                     25960000
           MOVE GL-WS-KMI              TO   GL-KMI.                     25970000
           MOVE GL-WS-CASH             TO   GL-CASH.                    25980000
           MOVE GL-WS-CHECK            TO   GL-CHECK.                   25990000
           MOVE GL-WS-KCP              TO   GL-KCP.                     26000000
           MOVE GL-WS-CRI              TO   GL-CRI.                     26010000
           MOVE GL-WS-EMPDISC          TO   GL-EMPDISC.                 26020000
           MOVE GL-WS-MKTPLC           TO   GL-MKTPLC.                  26030000
           MOVE GL-WS-SGS              TO   GL-SGS.                     26040000
           MOVE GL-WS-SGT              TO   GL-SGT.                     26050000
           MOVE GL-WS-CVN              TO   GL-CVN.                     26060000
           MOVE GL-WS-CVP              TO   GL-CVP.                     26070000
PAYVEN     MOVE GL-WS-PPN              TO   GL-PPN.                     26071005
PAYVEN     MOVE GL-WS-VMN              TO   GL-VMN.                     26072005
                                                                        26080000
      ******************************************************************26090000
      * ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    26100000
      ******************************************************************26110000
       9100-SQL-ABEND.                                                  26120000
                                                                        26130000
           MOVE SQLCODE    TO SQLCODE2.                                 26140000
           MOVE SQLERRD(3) TO SQLERRD3.                                 26150000
                                                                        26160000
           DISPLAY '** ABEND           ** = SQLABEND'.                  26170000
           DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              26180000
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        26190000
           DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG.     26200000
           DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 26210000
           DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 26220000
           DISPLAY '** SQLERRM         ** = ' SQLERRM.                  26230000
           DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 26240000
                                                                        26250000
      ******************************************************************26260000
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   26270000
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        26280000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     26290000
      *  FORMAT.                                                        26300000
      ******************************************************************26310000
                                                                        26320000
           COPY DPPD004.                                                26330000
                                                                        26340000
           CALL 'ILBOABN0' USING ABEND-CODE.                            26350000
                                                                        26360000
                                                                        26370000
      ******************************************************************26380000
      *  ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                     26390000
      ******************************************************************26400000
       9200-ABEND.                                                      26410000
                                                                        26420000
           PERFORM 9900-END-PROC.                                       26430000
                                                                        26440000
           DISPLAY '** ABEND           **'.                             26450000
           DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              26460000
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        26470000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       26480000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       26490000
                                                                        26500000
           CALL 'ILBOABN0' USING ABEND-CODE.                            26510000
                                                                        26520000
                                                                        26530000
      ******************************************************************26540000
      * PREFORMS TASK TERMINATION PROCESSING AND DISPLAYS COUNTS.       26550000
      ******************************************************************26560000
       9900-END-PROC.                                                   26570000
                                                                        26580000
           CLOSE LATE-GL-CSV-FILE-OUT.                                  26590000
                                                                        26600000
           DISPLAY '                    '.                              26610000
           DISPLAY '**********************'.                            26620000
           DISPLAY '   SAKUT135 CONTROLS  '.                            26630000
           DISPLAY '**********************'.                            26640000
           DISPLAY '======================'.                            26650000
           MOVE PA-LATE-CURSOR-CNT        TO PV-DISPLAY-CURSOR-COUNT.   26660000
           DISPLAY 'LATE ROWS FETCHED    = ' PV-DISPLAY-CURSOR-COUNT.   26670000
           MOVE PA-GDS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26680000
           DISPLAY 'GDS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26690000
           MOVE PA-TPC-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26700000
           DISPLAY 'TPC ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26710000
           MOVE PA-TCC-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26720000
           DISPLAY 'TCC ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26730000
           MOVE PA-BOS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26740000
           DISPLAY 'BOS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26750000
           MOVE PA-BPS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26760000
           DISPLAY 'BPS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26770000
           MOVE PA-SFS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26780000
           DISPLAY 'SFS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26790000
           MOVE PA-BSR-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26800000
           DISPLAY 'BSR ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26810000
           MOVE PA-BPR-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26820000
           DISPLAY 'BPR ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26830000
           MOVE PA-KKB-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26840000
           DISPLAY 'KKB ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26850000
           MOVE PA-KKH-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26860000
           DISPLAY 'KKH ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26870000
           MOVE PA-KKS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26880000
           DISPLAY 'KKS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26890000
           MOVE PA-KKU-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26900000
           DISPLAY 'KKU ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26910000
           MOVE PA-SHS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26920000
           DISPLAY 'SHS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26930000
           MOVE PA-ECR-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26940000
           DISPLAY 'ECR ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26950000
           MOVE PA-SHR-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26960000
           DISPLAY 'SHR ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26970000
           MOVE PA-FEE-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   26980000
           DISPLAY 'FEE ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   26990000
           MOVE PA-AEN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27000000
           DISPLAY 'AEN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27010000
           MOVE PA-BCN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27020000
           DISPLAY 'BCN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27030000
           MOVE PA-DBN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27040000
           DISPLAY 'DBN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27050000
           MOVE PA-KCN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27060000
           DISPLAY 'KCN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27070000
           MOVE PA-NCN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27080000
           DISPLAY 'NCN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27090000
           MOVE PA-GDT-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27100000
           DISPLAY 'GDT ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27110000
           MOVE PA-KMT-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27120000
           DISPLAY 'KMT ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27130000
           MOVE PA-KMI-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27140000
           DISPLAY 'KMI ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27150000
           MOVE PA-CASH-SELECT-CNT        TO PV-DISPLAY-SELECT-COUNT.   27160000
           DISPLAY 'CASH ROWS FETCHED    = ' PV-DISPLAY-SELECT-COUNT.   27170000
           MOVE PA-CHECK-SELECT-CNT       TO PV-DISPLAY-SELECT-COUNT.   27180000
           DISPLAY 'CHECK ROWS FETCHED   = ' PV-DISPLAY-SELECT-COUNT.   27190000
           MOVE PA-KCP-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27200000
           DISPLAY 'KCP ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27210000
           MOVE PA-CRI-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27220000
           DISPLAY 'CRI ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27230000
           MOVE PA-EMPDISC-SELECT-CNT     TO PV-DISPLAY-SELECT-COUNT.   27240000
           DISPLAY 'EMPDISC ROWS FETCHED = ' PV-DISPLAY-SELECT-COUNT.   27250000
           MOVE PA-KKT-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27260000
           DISPLAY 'KKT ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27270000
           MOVE PA-MKTPLC-SELECT-CNT      TO PV-DISPLAY-SELECT-COUNT.   27280000
           DISPLAY 'MKTPLC ROWS FETCHED  = ' PV-DISPLAY-SELECT-COUNT.   27290000
           MOVE PA-SGS-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27300000
           DISPLAY 'SGS ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27310000
           MOVE PA-SGT-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27320000
           DISPLAY 'SGT ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27330000
           MOVE PA-CVN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27340000
           DISPLAY 'CVN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27350000
           MOVE PA-CVP-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27360000
           DISPLAY 'CVP ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27370000
PAYVEN     MOVE PA-PPN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27371005
PAYVEN     DISPLAY 'PPN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27372005
PAYVEN     MOVE PA-VMN-SELECT-CNT         TO PV-DISPLAY-SELECT-COUNT.   27373005
PAYVEN     DISPLAY 'VMN ROWS FETCHED     = ' PV-DISPLAY-SELECT-COUNT.   27374005
           DISPLAY '                    '.                              27380000
           MOVE PA-GL-FILE-OUT-WRITTEN    TO PV-DISPLAY-SELECT-COUNT.   27390000
           DISPLAY 'GL RECORDS WRITTEN   = ' PV-DISPLAY-SELECT-COUNT.   27400000
           DISPLAY '                    '.                              27410000
                                                                        27420000
