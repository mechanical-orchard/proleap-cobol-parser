000010 IDENTIFICATION DIVISION.                                         00001000
000020*  COMMENT                                                        00002000
000030 PROGRAM-ID.         SUKUT150.                                    00003000
000040 AUTHOR.             JEAN KURK.                                   00004000
000050 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00005000
000060 DATE-WRITTEN.       AUGUST 2012.                                 00006000
000070******************************************************************00007000
000080*                  RFID CARTON DIRECTIVE PROCESSING              *00008000
000090* THIS PROGRAM WILL ALLOW DIRECTIVES TO BE CREATED FOR MULTIPLE  *00009000
000100*                                                                *00010000
000101* THIS PROGRAM IS CICS ONLY                                      *00010100
000102* 06/10/2013  SHOBHIT BAIJAL           TKID: TKMALR7             *00010209
000103*             MODIFIED FOR THE RFID PROJECT #5148B. THIS CHANGE  *00010310
000104*             IS TO REPLACE THE TABLE TKRPRPM WITH THE NEW RFID  *00010410
000105*             TABLE RIT_RFID_VRFN.                               *00010510
000108******************************************************************00010800
224787* 05/29/2019  JIM ARENDT               WR: CHG0224787            *00010920
224787*  FOR THE DELOITTE REFACTOR PROJECT, RESTAGE BECAUSE OF         *00011220
224787*  SUWS095 COPYBOOK CHANGE.                                      *00011320
224787******************************************************************00011420
000109 ENVIRONMENT DIVISION.                                            00011500
000110******************************************************************00011600
000111 CONFIGURATION SECTION.                                           00011700
000112 SOURCE-COMPUTER.    IBM-3090.                                    00011800
000113 OBJECT-COMPUTER.    IBM-3090.                                    00011900
000114                                                                  00012000
000115******************************************************************00012100
000116 DATA DIVISION.                                                   00012200
000120******************************************************************00012300
000130 WORKING-STORAGE SECTION.                                         00013000
000140******************************************************************00014000
000150 01  PS-PROGRAM-SWITCHES.                                         00015000
000160     05  PS-END-OF-CASEPK-SW         PIC X(01) VALUE 'N'.         00016000
000170         88  PS-END-OF-CASEPK                  VALUE 'Y'.         00017000
000180         88  PS-NOT-END-OF-CASEPK              VALUE 'N'.         00018000
000190     05  PS-END-OF-SMOOTH-SW         PIC X(01) VALUE 'N'.         00019000
000200         88  PS-END-OF-SMOOTH                  VALUE 'Y'.         00020000
000210         88  PS-NOT-END-OF-SMOOTH              VALUE 'N'.         00021000
000220     05  PS-END-OF-CSEPK-DEL-SW      PIC X(01) VALUE 'N'.         00022000
000230         88  PS-END-OF-CSEPK-DEL               VALUE 'Y'.         00023000
000240         88  PS-NOT-END-OF-CSEPK-DEL           VALUE 'N'.         00024000
000250     05  PS-END-OF-CSE-DEL-PREPK-SW  PIC X(01) VALUE 'N'.         00025000
000260         88  PS-END-OF-CSE-DEL-PREPK           VALUE 'Y'.         00026000
000270         88  PS-NOT-END-OF-CSE-DEL-PREPK       VALUE 'N'.         00027000
000280     05  PS-DIRECTIVE-TYPE-SW        PIC X(01) VALUE 'N'.         00028000
000290         88  PS-DIRECTIVE-ADD                  VALUE 'Y'.         00029000
000300         88  PS-DIRECTIVE-DELETE               VALUE 'N'.         00030000
000301                                                                  00030100
000302                                                                  00030200
000303 01  PC-PROGRAM-CONSTANTS.                                        00030300
000304     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'SUKUT150'.  00030400
000305                                                                  00030500
000306 01  DK-DATABASE-KEYS.                                            00030600
000307     05  DK-PO-NBR                   PIC S9(9) COMP VALUE ZERO.   00030700
000308     05  DK-REC-SEQ-NBR              PIC S9(9) COMP VALUE ZERO.   00030800
000309     05  DK-TRN-LNE-NBR              PIC S9(9) COMP VALUE ZERO.   00030900
000310     05  DK-STR-NBR                  PIC S9(4) COMP VALUE ZERO.   00031000
000320     05  DK-OPER-UNT-ID              PIC S9(4) COMP VALUE ZERO.   00032000
000330     05  DK-PREPK-ID                 PIC S9(4) COMP VALUE ZERO.   00033000
000340     05  DK-SMTHG-PRC-ID             PIC S9(9) COMP VALUE ZERO.   00034000
000341     05  DK-ACTV-IND                 PIC   X(1).                  00034100
000342     05  DK-DEPT-NBR                 PIC S9(4) COMP VALUE ZERO.   00034211
000350                                                                  00035000
000360 01  WS-DDG-PGM-NAME                 PIC X(08) VALUE              00036000
000370                                                  'SUKUT129'.     00037000
000380                                                                  00038000
000390 01  PV-DISPLAY-VARIABLES.                                        00039000
000400     05  PV-PO-NBR-DISP.                                          00040000
000410         10  PV-PO-NBR-N             PIC 9(09) VALUE ZERO.        00041000
000420     05  PV-REC-SEQ-NBR-DISP.                                     00042000
000430         10  PV-REC-SEQ-NBR-N        PIC 9(09) VALUE ZERO.        00043000
000440     05  PV-TRN-LNE-NBR-DISP.                                     00044000
000450         10  PV-TRN-LNE-NBR-N        PIC 9(09) VALUE ZERO.        00045000
000451     05  PV-STR-NBR-DISP.                                         00045100
000452         10  PV-STR-NBR-N            PIC 9(04) VALUE ZERO.        00045200
000453     05  PV-OPER-UNT-ID-DISP.                                     00045300
000454         10  PV-OPER-UNT-ID-N        PIC 9(04) VALUE ZERO.        00045400
000455                                                                  00045500
000456                                                                  00045600
000457 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.00045700
000458 01  PV-ABEND-VARIABLES.                                          00045800
000459     05  PV-SQLCODE                  PIC S9(9).                   00045900
000460     05  PV-DISPLAY-SQLCODE          PIC -------999.              00046000
000470     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT129'.  00047000
000480     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      00048000
000490     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      00049000
000500     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      00050000
000510     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      00051000
000520     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      00052000
000530     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      00053000
000540     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      00054000
000550     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      00055000
000560     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      00056000
000570     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      00057000
000580                                                                  00058000
000590******************************************************************00059000
000600*  SUKUT129 - DIRECTIVE GENERATOR REQUEST COMMUNICATION AREA      00060000
000610******************************************************************00061000
000620     COPY SUWS090.                                                00062000
000630                                                                  00063000
000640******************************************************************00064000
000650*  DB2 FORMATTED MESSAGE AREA                                     00065000
000660******************************************************************00066000
000670     COPY DPWS004.                                                00067000
000680                                                                  00068000
000690******************************************************************00069000
000700*  COMMUNICATIONS AREA FOR DB2                                    00070000
000710******************************************************************00071000
000720     EXEC SQL                                                     00072000
000730          INCLUDE SQLCA                                           00073000
000740     END-EXEC.                                                    00074000
000750                                                                  00075000
000760     COPY SQLCA2.                                                 00076000
000770                                                                  00077000
001031******************************************************************00103100
001032*  DB2 DECLARATION - WMOS ATTRIBUTE ELEMENTS                      00103200
001033*      TABLE (RIT_RFID_VRFN)                                      00103300
001034******************************************************************00103400
001035     EXEC SQL                                                     00103500
001036         INCLUDE RIT00000                                         00103600
001037     END-EXEC.                                                    00103700
001038                                                                  00103800
001040******************************************************************00104000
001050*      TABLE (SUT_OTBND_CART)                                     00105000
001060******************************************************************00106000
001070     EXEC SQL                                                     00107000
001080         INCLUDE SUT00024                                         00108000
001090     END-EXEC.                                                    00109000
001100                                                                  00110000
001110******************************************************************00111000
001120*      TABLE (SUT_OTBND_UPC)                                      00112000
001130******************************************************************00113000
001140     EXEC SQL                                                     00114000
001150         INCLUDE SUT00028                                         00115000
001160     END-EXEC.                                                    00116000
001170                                                                  00117000
001180******************************************************************00118000
001190*      TABLE (SUT_CART_DIRV_TRKG)                                 00119000
001200******************************************************************00120000
001201     EXEC SQL                                                     00120100
001202         INCLUDE SUT00102                                         00120200
001203     END-EXEC.                                                    00120300
001204                                                                  00120400
001205******************************************************************00120500
001206*      TABLE (SUT_SMOOTHING_PRC) SMOOTHING TABLE                  00120600
001207******************************************************************00120700
001208     EXEC SQL                                                     00120800
001209         INCLUDE SUT00003                                         00120900
001210     END-EXEC.                                                    00121000
001211                                                                  00121100
001212******************************************************************00121213
001213*      TABLE (TPURCHS) PO TABLE                                   00121313
001214******************************************************************00121413
001215     EXEC SQL                                                     00121513
001216         INCLUDE TPURCHS                                          00121613
001217     END-EXEC.                                                    00121713
001218                                                                  00121813
001219******************************************************************00121913
001220* THIS CURSOR WILL BE USED FOR CASEPACK - INPUT FROM CALLING     *00122013
001221* PROGRAM WILL BE PO / RCVR / LINE                                00122113
001222******************************************************************00122213
001223     EXEC SQL                                                     00122313
001224         DECLARE CASEPACK_CSR CURSOR FOR                          00122413
001225          SELECT DISTINCT                                         00122513
001226                 C.SHIPT_UNT_ID                                   00122613
001227               , C.DEST_LOC_NBR                                   00122713
001230            FROM SUT_OTBND_CART C                                 00123000
001240               , SUT_OTBND_UPC  U                                 00124000
001250               , RIT_RFID_VRFN  R                                 00125000
001270           WHERE  U.TRN_NBR            = :DK-PO-NBR               00127000
001280             AND  U.RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR          00128000
001290             AND  U.TRN_LNE_NBR        = :DK-TRN-LNE-NBR          00129000
001291             AND  C.ACTV_IND           = :DK-ACTV-IND             00129100
001300             AND  U.SHIPT_UNT_ID       = C.SHIPT_UNT_ID           00130000
001310             AND  C.DEST_LOC_NBR       = R.STR_NBR                00131000
001320             AND  C.CART_SRC_CDE       = 'CPS'                    00132000
001330             AND  R.DC_LOC_NBR         = 0                        00133000
001340             AND  R.SUB_CL_NBR         = 0                        00134000
001350             AND  R.RFID_LVL_CDE       = 'STRDPT'                 00135000
001360             AND  R.EFF_STRT_TMST <= CURRENT_TIMESTAMP            00136000
001370             AND  R.EFF_END_TMST   > CURRENT_TIMESTAMP            00137000
001380             AND  R.DEPT_NBR          = :DK-DEPT-NBR              00138011
001390           WITH UR                                                00139000
001400     END-EXEC.                                                    00140000
001410                                                                  00141000
001420******************************************************************00142000
001430* THIS CURSOR WILL BE USED FOR SMOOTHING - INPUT FROM CALLING    *00143000
001440* PROGRAM WILL BE PO / RCVR / STORE                               00144000
001450******************************************************************00145000
001460     EXEC SQL                                                     00146000
001470         DECLARE SMOOTHNG_CSR CURSOR FOR                          00147000
001480          SELECT DISTINCT                                         00148000
001490                 C.SHIPT_UNT_ID                                   00149000
001500               , C.DEST_LOC_NBR                                   00150000
001510            FROM SUT_OTBND_CART C                                 00151000
001520               , SUT_OTBND_UPC  U                                 00152000
001530               , SUT_SMOOTHING_PRC S                              00153000
001550               , RIT_RFID_VRFN  R                                 00155000
001560           WHERE  U.TRN_NBR            = :DK-PO-NBR               00156000
001570             AND  U.RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR          00157000
001580             AND  C.ACTV_IND           = 'Y'                      00158000
001590             AND  C.CART_SRC_CDE       = 'SMO'                    00159000
001600             AND  U.TRN_NBR            = S.PO_NBR                 00160000
001610             AND  U.RCVR_SEQ_NBR       = S.RCVR_SEQ_NBR           00161000
001611             AND  C.DEST_LOC_NBR       = S.STR_NBR                00161100
001612             AND  S.SMTHG_PRC_ID       = :DK-SMTHG-PRC-ID         00161200
001613             AND  U.SHIPT_UNT_ID       = C.SHIPT_UNT_ID           00161300
001614             AND  C.DEST_LOC_NBR       = R.STR_NBR                00161400
001616             AND  R.DC_LOC_NBR         = 0                        00161600
001617             AND  R.SUB_CL_NBR         = 0                        00161700
001618             AND  R.RFID_LVL_CDE       = 'STRDPT'                 00161800
001619             AND  R.EFF_STRT_TMST      <= CURRENT_TIMESTAMP       00161900
001620             AND  R.EFF_END_TMST       > CURRENT_TIMESTAMP        00162000
001621             AND  R.DEPT_NBR           = :DK-DEPT-NBR             00162111
001630           WITH UR                                                00163000
001640     END-EXEC.                                                    00164000
001650                                                                  00165000
001660******************************************************************00166000
001670* THIS CURSOR WILL BE USED FOR CASEPACK DELETES - INPUT FROM     *00167000
001680* CALLING PROGRAM WILL BE OPER UNT / PO/ RCVR                     00168000
001690******************************************************************00169000
001700     EXEC SQL                                                     00170000
001710         DECLARE CASEPK_DEL_CSR CURSOR FOR                        00171000
001720          SELECT DISTINCT                                         00172000
001721                 A.SHIPT_UNT_ID                                   00172100
001722               , A.STR_NBR                                        00172200
001723            FROM SUT_CART_DIRV_TRKG A                             00172300
001724           WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID              00172400
001725             AND  A.PO_NBR         = :DK-PO-NBR                   00172500
001726             AND  A.RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR              00172600
001727             AND  A.PO_LNE_NBR     = :DK-TRN-LNE-NBR              00172700
001728             AND  NOT EXISTS                                      00172800
001729                 (SELECT B.BRCDE_NBR                              00172900
001730                    FROM SUT_CART_DIRV_TRKG B                     00173000
001740              WHERE B.DIRV_RSN_CDE IN ('RLC', 'RLO', 'RLR')       00174000
001741                     AND B.OPER_UNT_ID    = :DK-OPER-UNT-ID       00174100
001742                     AND B.PO_NBR         = :DK-PO-NBR            00174200
001743                     AND B.RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR       00174300
001744                     AND B.PO_LNE_NBR     = :DK-TRN-LNE-NBR       00174400
001745                     AND A.BRCDE_NBR      =  B.BRCDE_NBR )        00174500
001746           WITH UR                                                00174600
001747     END-EXEC.                                                    00174700
001748                                                                  00174800
001749******************************************************************00174900
001750* THIS CURSOR WILL BE USED FOR CASEPACK DELETES WITH PREPKS,     *00175000
001751* INPUT FROM CALLING PROGRAM WILL BE OPER UNT / PO/ RCVR /PREPK   00175100
001752******************************************************************00175200
001753     EXEC SQL                                                     00175300
001754         DECLARE CSEPK_DEL_PREPK_CSR CURSOR FOR                   00175400
001755          SELECT DISTINCT                                         00175500
001756                 A.SHIPT_UNT_ID                                   00175600
001757               , A.STR_NBR                                        00175700
001758            FROM SUT_CART_DIRV_TRKG A                             00175800
001759           WHERE  A.OPER_UNT_ID        = :DK-OPER-UNT-ID          00175900
001760             AND  A.PO_NBR             = :DK-PO-NBR               00176000
001761             AND  A.RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR          00176100
001762             AND  A.PREPK_ID           = :DK-PREPK-ID             00176200
001763             AND  NOT EXISTS                                      00176300
001764                  (SELECT B.BRCDE_NBR                             00176400
001765                   FROM SUT_CART_DIRV_TRKG B                      00176500
001766                   WHERE B.DIRV_RSN_CDE IN ('RLC','RLO','RLR')    00176600
001767                   AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID          00176700
001768                   AND B.PO_NBR        = :DK-PO-NBR               00176800
001769                   AND B.RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR          00176900
001770                   AND B.PREPK_ID      = :DK-PREPK-ID             00177000
001771                   AND A.BRCDE_NBR     = B.BRCDE_NBR)             00177100
001772           WITH UR                                                00177200
001773     END-EXEC.                                                    00177300
001774                                                                  00177400
001775****************************************************************  00177500
001776                                                                  00177600
001777 LINKAGE SECTION.                                                 00177700
001778     COPY SUWS095.                                                00177800
001779                                                                  00177900
001780***************************************************************   00178000
001790 PROCEDURE DIVISION USING SU095-DIRECTIVE-COMMAREA.               00179000
001800***************************************************************   00180000
001810 0000-MAINLINE.                                                   00181000
001820                                                                  00182000
001830     SET SU095-SUCCESSFUL TO TRUE.                                00183000
001831     SET SU095-SUCCESS    TO TRUE.                                00183100
001832**GB 8/4/15                                                       00183218
001833     SET PS-NOT-END-OF-CASEPK  TO TRUE                            00183318
001834     SET PS-NOT-END-OF-SMOOTH  TO TRUE                            00183418
001835**GB 8/4/15                                                       00183518
001836                                                                  00183616
001837     PERFORM 1000-INITIALIZE.                                     00183716
001838     EVALUATE TRUE                                                00183816
001839        WHEN SU095-CSEPK-SPLIT                                    00183916
001840        WHEN SU095-CSEPK-DEL                                      00184016
001841            PERFORM 2000-CASEPACK-SPLIT                           00184116
001845        WHEN SU095-SMOOTHING                                      00184500
001846           PERFORM 2500-SMOOTHING                                 00184600
001900        WHEN OTHER                                                00190000
001910           SET SU095-INVALID-ACCESS TO TRUE                       00191000
001920     END-EVALUATE.                                                00192000
001930                                                                  00193000
001940     GOBACK.                                                      00194000
001950                                                                  00195000
001960******************************************************************00196000
001970*                                                                *00197000
001980*           1 0 0 0 - I N I T I A L I Z A T I O N                *00198000
001990*                                                                *00199000
002000******************************************************************00200000
002010 1000-INITIALIZE.                                                 00201000
002020                                                                  00202000
002030     PERFORM 1100-SELECT-DEPT-NBR.                                00203015
002031******************************************************************00203112
002032*                                                                *00203212
002033*           1 1 0 0 -                                            *00203312
002034*                                                                *00203412
002035******************************************************************00203512
002036 1100-SELECT-DEPT-NBR.                                            00203612
002040                                                                  00204000
002041     MOVE SU095-KEY-PO            TO DK-PO-NBR.                   00204112
002042                                                                  00204212
002043     EXEC SQL                                                     00204312
002044       SELECT DEPT_NBR                                            00204412
002045         INTO  :PURCHS-DEPT-NBR                                   00204512
002046         FROM   TPURCHS                                           00204612
002047       WHERE PO_NBR = :DK-PO-NBR                                  00204712
002048         AND  VER_STATUS_CDE = 'A'                                00204812
002056       WITH UR                                                    00205612
002057     END-EXEC.                                                    00205712
002058                                                                  00205812
002059                                                                  00205912
002060     EVALUATE TRUE                                                00206012
002061         WHEN SQLCODE = ZERO                                      00206112
002062              MOVE PURCHS-DEPT-NBR TO  DK-DEPT-NBR                00206212
002069         WHEN SQLCODE = +100                                      00206912
002070              MOVE +0 TO     DK-DEPT-NBR                          00207012
002071         WHEN SQLWARN0 NOT EQUAL SPACE                            00207112
002072         WHEN SQLCODE NOT EQUAL ZERO                              00207212
002073             SET SU095-SQL-ERROR  TO TRUE                         00207312
002074             MOVE SQLCODE         TO SU095-ERROR-NBR              00207412
002075             MOVE SQLCA           TO SU095-SQLCA                  00207512
002076             MOVE '1100-SELECT-DEPT-NBR '                         00207612
002077                                      TO PV-ABEND-PARAGRAPH       00207712
002078             MOVE 'ERROR 1100-SELECT-DEPT-NBR    '                00207812
002079                                      TO PV-ABEND-OPER-MESSAGE-1  00207912
002080             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00208012
002083             STRING 'PO NBR: '  DELIMITED BY SIZE                 00208312
002084                         PV-PO-NBR-N                              00208412
002085                                         DELIMITED BY SIZE        00208512
002094                                   INTO PV-ABEND-OPER-MESSAGE-2   00209412
002095             MOVE 'TPURCHS   '                                    00209512
002096                                      TO PV-ABEND-TABLE-1         00209612
002099             PERFORM 9900-DB2-ERROR                               00209912
002100     END-EVALUATE.                                                00210012
002101******************************************************************00210100
002102* PROCESS CALL FROM CASEPACK SPLIT PROGRAM                        00210200
002103******************************************************************00210300
002104 2000-CASEPACK-SPLIT.                                             00210400
002105     PERFORM 2010-OPEN-CSPK-CSR.                                  00210500
002106                                                                  00210600
002110     PERFORM 2020-PROCESS-CSPK-CSR                                00211000
002120         UNTIL PS-END-OF-CASEPK                                   00212000
002130            OR SU095-SQL-ERROR.                                   00213000
002140                                                                  00214000
002150     PERFORM 2030-CLOSE-CSPK-CSR.                                 00215000
002160                                                                  00216000
002170                                                                  00217000
002180******************************************************************00218000
002190* OPEN THE CASEPACK SPLIT CURSOR                                  00219000
002200******************************************************************00220000
002210 2010-OPEN-CSPK-CSR.                                              00221000
002220                                                                  00222000
002225                                                                  00222516
002230     MOVE SU095-KEY-PO            TO DK-PO-NBR.                   00223000
002240     MOVE SU095-KEY-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.              00224000
002250     MOVE SU095-KEY-LNE-NBR       TO DK-TRN-LNE-NBR.              00225000
002251     IF SU095-CSEPK-SPLIT                                         00225100
002252        MOVE 'Y'                  TO DK-ACTV-IND                  00225200
002253     ELSE                                                         00225300
002254        MOVE 'N'                  TO DK-ACTV-IND                  00225400
002255     END-IF                                                       00225500
002260                                                                  00226000
002270     EXEC SQL                                                     00227000
002280         OPEN CASEPACK_CSR                                        00228000
002290     END-EXEC.                                                    00229000
002300                                                                  00230000
002310     EVALUATE TRUE                                                00231000
002320         WHEN SQLCODE = +0                                        00232000
002330         WHEN SQLCODE = -904                                      00233000
002340         WHEN SQLCODE = -911                                      00234000
002350         WHEN SQLCODE = -913                                      00235000
002360             CONTINUE                                             00236000
002370         WHEN SQLWARN0 NOT EQUAL SPACE                            00237000
002380         WHEN SQLCODE NOT EQUAL ZERO                              00238000
002390             SET SU095-SQL-ERROR  TO TRUE                         00239000
002400             MOVE SQLCODE         TO SU095-ERROR-NBR              00240000
002410             MOVE SQLCA           TO SU095-SQLCA                  00241000
002420             MOVE '2010-OPEN-CSPK-CSR'                            00242000
002430                                      TO PV-ABEND-PARAGRAPH       00243000
002440             MOVE 'ERROR OPENING CASEPACK CURSOR'                 00244000
002450                                      TO PV-ABEND-OPER-MESSAGE-1  00245000
002460             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00246000
002470             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00247000
002480             MOVE DK-TRN-LNE-NBR  TO PV-TRN-LNE-NBR-N             00248000
002490             STRING 'PO NBR: '  DELIMITED BY SIZE                 00249000
002500                         PV-PO-NBR-N                              00250000
002510                                         DELIMITED BY SIZE        00251000
002520                        '   REC SEQ NBR: '                        00252000
002530                                         DELIMITED BY SIZE        00253000
002540                         PV-REC-SEQ-NBR-N                         00254000
002550                                         DELIMITED BY SIZE        00255000
002560                        '   TRN LNE NBR: '                        00256000
002561                                         DELIMITED BY SIZE        00256100
002562                         PV-TRN-LNE-NBR-N                         00256200
002563                                         DELIMITED BY SIZE        00256300
002564                                   INTO PV-ABEND-OPER-MESSAGE-2   00256400
002565             MOVE 'SUT_OTBND_CART'                                00256500
002566                                      TO PV-ABEND-TABLE-1         00256600
002567             MOVE 'SUT_OTBND_UPC'                                 00256700
002568                                      TO PV-ABEND-TABLE-2         00256800
002569             PERFORM 9900-DB2-ERROR                               00256900
002570     END-EVALUATE.                                                00257000
002580                                                                  00258000
002590                                                                  00259000
002600******************************************************************00260000
002610* FETCH A ROW FROM THE CASEPACK CURSOR.                          *00261000
002620******************************************************************00262000
002630 2020-PROCESS-CSPK-CSR.                                           00263000
002640     EXEC SQL                                                     00264000
002650          FETCH CASEPACK_CSR                                      00265000
002660           INTO :SUT00024-SHIPT-UNT-ID                            00266000
002670               ,:SUT00024-DEST-LOC-NBR                            00267000
002680     END-EXEC.                                                    00268000
002690                                                                  00269000
002700     EVALUATE TRUE                                                00270000
002710         WHEN SQLCODE = ZERO                                      00271000
002711             IF SU095-CSEPK-SPLIT                                 00271100
002720                SET PS-DIRECTIVE-ADD TO TRUE                      00272000
002721             ELSE                                                 00272100
002722                SET PS-DIRECTIVE-DELETE TO TRUE                   00272200
002723             END-IF                                               00272300
002730             PERFORM 4000-POPULATE-DIRECTIVE-RQST                 00273000
002740             PERFORM 4100-CALL-DIRECTIVE-REQUEST                  00274000
002750         WHEN SQLCODE = +100                                      00275000
002760             SET PS-END-OF-CASEPK  TO TRUE                        00276000
002770         WHEN SQLWARN0 NOT EQUAL SPACE                            00277000
002780         WHEN SQLCODE NOT EQUAL ZERO                              00278000
002790             SET SU095-SQL-ERROR  TO TRUE                         00279000
002800             MOVE SQLCODE         TO SU095-ERROR-NBR              00280000
002810             MOVE SQLCA           TO SU095-SQLCA                  00281000
002820             MOVE '2020-PROCESS-CSPK-CSR'                         00282000
002830                                      TO PV-ABEND-PARAGRAPH       00283000
002840             MOVE 'ERROR FETCHING CASEPACK CURSOR'                00284000
002850                                      TO PV-ABEND-OPER-MESSAGE-1  00285000
002860             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00286000
002870             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00287000
002880             MOVE DK-TRN-LNE-NBR  TO PV-TRN-LNE-NBR-N             00288000
002890             STRING 'PO NBR: '  DELIMITED BY SIZE                 00289000
002900                         PV-PO-NBR-N                              00290000
002910                                         DELIMITED BY SIZE        00291000
002920                        '   REC SEQ NBR: '                        00292000
002930                                         DELIMITED BY SIZE        00293000
002940                         PV-REC-SEQ-NBR-N                         00294000
002950                                         DELIMITED BY SIZE        00295000
002960                        '   TRN LNE NBR: '                        00296000
002970                                         DELIMITED BY SIZE        00297000
002980                         PV-TRN-LNE-NBR-N                         00298000
002990                                         DELIMITED BY SIZE        00299000
003000                                   INTO PV-ABEND-OPER-MESSAGE-2   00300000
003010             MOVE 'SUT_OTBND_CART'                                00301000
003020                                      TO PV-ABEND-TABLE-1         00302000
003030             MOVE 'SUT_OTBND_UPC'                                 00303000
003040                                      TO PV-ABEND-TABLE-2         00304000
003050             PERFORM 9900-DB2-ERROR                               00305000
003060     END-EVALUATE.                                                00306000
003070                                                                  00307000
003080                                                                  00308000
003090******************************************************************00309000
003100* CLOSE THE CASEPACK SPLIT CURSOR                                 00310000
003110******************************************************************00311000
003120 2030-CLOSE-CSPK-CSR.                                             00312000
003130                                                                  00313000
003140     EXEC SQL                                                     00314000
003150         CLOSE CASEPACK_CSR                                       00315000
003160     END-EXEC.                                                    00316000
003170                                                                  00317000
003180     EVALUATE TRUE                                                00318000
003190         WHEN SQLCODE = +0                                        00319000
003200         WHEN SQLCODE = -904                                      00320000
003210         WHEN SQLCODE = -911                                      00321000
003220         WHEN SQLCODE = -913                                      00322000
003230             CONTINUE                                             00323000
003240         WHEN SQLWARN0 NOT EQUAL SPACE                            00324000
003250         WHEN SQLCODE NOT EQUAL ZERO                              00325000
003260             SET SU095-SQL-ERROR  TO TRUE                         00326000
003270             MOVE SQLCODE         TO SU095-ERROR-NBR              00327000
003280             MOVE SQLCA           TO SU095-SQLCA                  00328000
003290             MOVE '2030-CLOSE-CSPK-CSR'                           00329000
003300                                      TO PV-ABEND-PARAGRAPH       00330000
003310             MOVE 'ERROR CLOSING CASEPACK CURSOR'                 00331000
003320                                      TO PV-ABEND-OPER-MESSAGE-1  00332000
003330             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00333000
003340             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00334000
003350             MOVE DK-TRN-LNE-NBR  TO PV-TRN-LNE-NBR-N             00335000
003360             STRING 'PO NBR: '  DELIMITED BY SIZE                 00336000
003370                         PV-PO-NBR-N                              00337000
003380                                         DELIMITED BY SIZE        00338000
003390                        '   REC SEQ NBR: '                        00339000
003400                                         DELIMITED BY SIZE        00340000
003410                         PV-REC-SEQ-NBR-N                         00341000
003420                                         DELIMITED BY SIZE        00342000
003430                        '   TRN LNE NBR: '                        00343000
003431                                         DELIMITED BY SIZE        00343100
003432                         PV-TRN-LNE-NBR-N                         00343200
003433                                         DELIMITED BY SIZE        00343300
003434                                   INTO PV-ABEND-OPER-MESSAGE-2   00343400
003435             MOVE 'SUT_OTBND_CART'                                00343500
003436                                      TO PV-ABEND-TABLE-1         00343600
003437             MOVE 'SUT_OTBND_UPC'                                 00343700
003438                                      TO PV-ABEND-TABLE-2         00343800
003439             PERFORM 9900-DB2-ERROR                               00343900
003440     END-EVALUATE.                                                00344000
003450                                                                  00345000
003460                                                                  00346000
003470******************************************************************00347000
003480* PROCESS CALL FROM SMOOTHING PROGRAM                             00348000
003490******************************************************************00349000
003500 2500-SMOOTHING.                                                  00350000
003510     PERFORM 2510-OPEN-SMOOTH-CSR.                                00351000
003520                                                                  00352000
003530     PERFORM 2520-PROCESS-SMOOTH-CSR                              00353000
003540         UNTIL PS-END-OF-SMOOTH                                   00354000
003550            OR SU095-SQL-ERROR.                                   00355000
003560                                                                  00356000
003570     PERFORM 2530-CLOSE-SMOOTH-CSR.                               00357000
003580                                                                  00358000
003590                                                                  00359000
003600******************************************************************00360000
003610* OPEN THE SMOOTHING CURSOR                                       00361000
003620******************************************************************00362000
003630 2510-OPEN-SMOOTH-CSR.                                            00363000
003640                                                                  00364000
003650     MOVE SU095-KEY-PO            TO DK-PO-NBR.                   00365000
003660     MOVE SU095-KEY-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.              00366000
003670     MOVE SU095-SMTHG-PRC-ID      TO DK-SMTHG-PRC-ID.             00367000
003680                                                                  00368000
003690     EXEC SQL                                                     00369000
003700         OPEN SMOOTHNG_CSR                                        00370000
003710     END-EXEC.                                                    00371000
003720                                                                  00372000
003730     EVALUATE TRUE                                                00373000
003740         WHEN SQLCODE = +0                                        00374000
003750         WHEN SQLCODE = -904                                      00375000
003760         WHEN SQLCODE = -911                                      00376000
003770         WHEN SQLCODE = -913                                      00377000
003780             CONTINUE                                             00378000
003790         WHEN SQLWARN0 NOT EQUAL SPACE                            00379000
003800         WHEN SQLCODE NOT EQUAL ZERO                              00380000
003810             SET SU095-SQL-ERROR  TO TRUE                         00381000
003820             MOVE SQLCODE         TO SU095-ERROR-NBR              00382000
003830             MOVE SQLCA           TO SU095-SQLCA                  00383000
003840             MOVE '2510-OPEN-SMOOTH-CSR'                          00384000
003850                                      TO PV-ABEND-PARAGRAPH       00385000
003860             MOVE 'ERROR OPENING SMOOTHING CURSOR'                00386000
003870                                      TO PV-ABEND-OPER-MESSAGE-1  00387000
003880             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00388000
003890             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00389000
003900             MOVE DK-STR-NBR      TO PV-STR-NBR-N                 00390000
003910             STRING 'PO NBR: '  DELIMITED BY SIZE                 00391000
003920                         PV-PO-NBR-N                              00392000
003930                                         DELIMITED BY SIZE        00393000
003940                        '   REC SEQ NBR: '                        00394000
003950                                         DELIMITED BY SIZE        00395000
003960                         PV-REC-SEQ-NBR-N                         00396000
003970                                         DELIMITED BY SIZE        00397000
003980                        '   STORE NBR: '                          00398000
003990                                         DELIMITED BY SIZE        00399000
004000                         PV-STR-NBR-N                             00400000
004010                                         DELIMITED BY SIZE        00401000
004020                                   INTO PV-ABEND-OPER-MESSAGE-2   00402000
004030             MOVE 'SUT_OTBND_CART'                                00403000
004040                                      TO PV-ABEND-TABLE-1         00404000
004050             MOVE 'SUT_OTBND_UPC'                                 00405000
004060                                      TO PV-ABEND-TABLE-2         00406000
004070             PERFORM 9900-DB2-ERROR                               00407000
004080     END-EVALUATE.                                                00408000
004090                                                                  00409000
004100                                                                  00410000
004110******************************************************************00411000
004120* FETCH A ROW FROM THE SMOOTHING CURSOR.                          00412000
004130******************************************************************00413000
004140 2520-PROCESS-SMOOTH-CSR.                                         00414000
004150     EXEC SQL                                                     00415000
004160          FETCH SMOOTHNG_CSR                                      00416000
004170           INTO :SUT00024-SHIPT-UNT-ID                            00417000
004180              , :SUT00024-DEST-LOC-NBR                            00418000
004190     END-EXEC.                                                    00419000
004200                                                                  00420000
004210     EVALUATE TRUE                                                00421000
004220         WHEN SQLCODE = ZERO                                      00422000
004230             SET PS-DIRECTIVE-ADD TO TRUE                         00423000
004240             PERFORM 4000-POPULATE-DIRECTIVE-RQST                 00424000
004250             PERFORM 4100-CALL-DIRECTIVE-REQUEST                  00425000
004260         WHEN SQLCODE = +100                                      00426000
004270             SET PS-END-OF-SMOOTH  TO TRUE                        00427000
004280         WHEN SQLWARN0 NOT EQUAL SPACE                            00428000
004290         WHEN SQLCODE NOT EQUAL ZERO                              00429000
004300             SET SU095-SQL-ERROR  TO TRUE                         00430000
004310             MOVE SQLCODE         TO SU095-ERROR-NBR              00431000
004320             MOVE SQLCA           TO SU095-SQLCA                  00432000
004330             MOVE '2520-PROCESS-SMOOTH-CSR'                       00433000
004340                                      TO PV-ABEND-PARAGRAPH       00434000
004350             MOVE 'ERROR PROCESSING SMOOTHING CURSOR'             00435000
004360                                      TO PV-ABEND-OPER-MESSAGE-1  00436000
004370             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00437000
004380             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00438000
004390             MOVE DK-STR-NBR      TO PV-STR-NBR-N                 00439000
004400             STRING 'PO NBR: '  DELIMITED BY SIZE                 00440000
004410                         PV-PO-NBR-N                              00441000
004420                                         DELIMITED BY SIZE        00442000
004430                        '   REC SEQ NBR: '                        00443000
004440                                         DELIMITED BY SIZE        00444000
004450                         PV-REC-SEQ-NBR-N                         00445000
004460                                         DELIMITED BY SIZE        00446000
004470                        '   STORE NBR: '                          00447000
004480                                         DELIMITED BY SIZE        00448000
004490                         PV-STR-NBR-N                             00449000
004500                                         DELIMITED BY SIZE        00450000
004510                                   INTO PV-ABEND-OPER-MESSAGE-2   00451000
004520             MOVE 'SUT_OTBND_CART'                                00452000
004530                                      TO PV-ABEND-TABLE-1         00453000
004540             MOVE 'SUT_OTBND_UPC'                                 00454000
004550                                      TO PV-ABEND-TABLE-2         00455000
004560             PERFORM 9900-DB2-ERROR                               00456000
004570     END-EVALUATE.                                                00457000
004580                                                                  00458000
004590                                                                  00459000
004600******************************************************************00460000
004610* CLOSE THE SMOOTHING CURSOR                                      00461000
004620******************************************************************00462000
004630 2530-CLOSE-SMOOTH-CSR.                                           00463000
004640                                                                  00464000
004650                                                                  00465000
004660     EXEC SQL                                                     00466000
004670         CLOSE SMOOTHNG_CSR                                       00467000
004680     END-EXEC.                                                    00468000
004690                                                                  00469000
004700     EVALUATE TRUE                                                00470000
004710         WHEN SQLCODE = +0                                        00471000
004720         WHEN SQLCODE = -904                                      00472000
004730         WHEN SQLCODE = -911                                      00473000
004740         WHEN SQLCODE = -913                                      00474000
004750             CONTINUE                                             00475000
004760         WHEN SQLWARN0 NOT EQUAL SPACE                            00476000
004770         WHEN SQLCODE NOT EQUAL ZERO                              00477000
004780             SET SU095-SQL-ERROR  TO TRUE                         00478000
004790             MOVE SQLCODE         TO SU095-ERROR-NBR              00479000
004800             MOVE SQLCA           TO SU095-SQLCA                  00480000
004810             MOVE '2530-CLOSE-SMOOTH-CSR'                         00481000
004820                                      TO PV-ABEND-PARAGRAPH       00482000
004830             MOVE 'ERROR CLOSING SMOOTHING CURSOR'                00483000
004840                                      TO PV-ABEND-OPER-MESSAGE-1  00484000
004850             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00485000
004860             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00486000
004870             MOVE DK-STR-NBR      TO PV-STR-NBR-N                 00487000
004880             STRING 'PO NBR: '  DELIMITED BY SIZE                 00488000
004890                         PV-PO-NBR-N                              00489000
004900                                         DELIMITED BY SIZE        00490000
004910                        '   REC SEQ NBR: '                        00491000
004920                                         DELIMITED BY SIZE        00492000
004930                         PV-REC-SEQ-NBR-N                         00493000
004940                                         DELIMITED BY SIZE        00494000
004950                        '   STORE NBR: '                          00495000
004960                                         DELIMITED BY SIZE        00496000
004970                         PV-STR-NBR-N                             00497000
004980                                         DELIMITED BY SIZE        00498000
004990                                   INTO PV-ABEND-OPER-MESSAGE-2   00499000
005000             MOVE 'SUT_OTBND_CART'                                00500000
005010                                      TO PV-ABEND-TABLE-1         00501000
005020             MOVE 'SUT_OTBND_UPC'                                 00502000
005030                                      TO PV-ABEND-TABLE-2         00503000
005040             PERFORM 9900-DB2-ERROR                               00504000
005050     END-EVALUATE.                                                00505000
005060                                                                  00506000
005070                                                                  00507000
005080******************************************************************00508000
005090* PROCESS CALL FOR CASEPK DELETES                                 00509000
005100******************************************************************00510000
005110 3000-CASEPK-DEL.                                                 00511000
005120                                                                  00512000
005130     PERFORM 3010-OPEN-CSEPK-DEL-CSR.                             00513000
005131                                                                  00513100
005132     PERFORM 3020-PROCESS-CSEPK-DEL-CSR                           00513200
005133         UNTIL PS-END-OF-CSEPK-DEL                                00513300
005134            OR SU095-SQL-ERROR.                                   00513400
005135                                                                  00513500
005136     PERFORM 3030-CLOSE-CSEPK-DEL-CSR.                            00513600
005137                                                                  00513700
005138                                                                  00513800
005139******************************************************************00513900
005140* OPEN THE CASEPK DELETE CURSOR (NO PREPK)                        00514000
005141******************************************************************00514100
005142 3010-OPEN-CSEPK-DEL-CSR.                                         00514200
005143                                                                  00514300
005144     MOVE SU095-KEY-PO            TO DK-PO-NBR.                   00514400
005145     MOVE SU095-KEY-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.              00514500
005146     MOVE SU095-KEY-OPER-UNT-ID   TO DK-OPER-UNT-ID.              00514600
005147     MOVE SU095-KEY-LNE-NBR       TO DK-TRN-LNE-NBR.              00514700
005148                                                                  00514800
005149     EXEC SQL                                                     00514900
005150         OPEN CASEPK_DEL_CSR                                      00515000
005151     END-EXEC.                                                    00515100
005152                                                                  00515200
005153     EVALUATE TRUE                                                00515300
005154         WHEN SQLCODE = +0                                        00515400
005155         WHEN SQLCODE = -904                                      00515500
005156         WHEN SQLCODE = -911                                      00515600
005157         WHEN SQLCODE = -913                                      00515700
005158             CONTINUE                                             00515800
005159         WHEN SQLWARN0 NOT EQUAL SPACE                            00515900
005160         WHEN SQLCODE NOT EQUAL ZERO                              00516000
005161             SET SU095-SQL-ERROR  TO TRUE                         00516100
005162             MOVE SQLCODE         TO SU095-ERROR-NBR              00516200
005163             MOVE SQLCA           TO SU095-SQLCA                  00516300
005164             MOVE '3010-OPEN-CSEPK-DEL-CSR'                       00516400
005165                                      TO PV-ABEND-PARAGRAPH       00516500
005166             MOVE 'ERROR OPENING CSEPK DEL CURSOR'                00516600
005167                                      TO PV-ABEND-OPER-MESSAGE-1  00516700
005168             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00516800
005169             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00516900
005170             MOVE DK-STR-NBR      TO PV-STR-NBR-N                 00517000
005171             MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N             00517100
005172             STRING 'PO NBR: '  DELIMITED BY SIZE                 00517200
005173                         PV-PO-NBR-N                              00517300
005174                                         DELIMITED BY SIZE        00517400
005175                        '   REC SEQ NBR: '                        00517500
005176                                         DELIMITED BY SIZE        00517600
005177                         PV-REC-SEQ-NBR-N                         00517700
005178                                         DELIMITED BY SIZE        00517800
005179                        '   OPER UNIT ID: '                       00517900
005180                                         DELIMITED BY SIZE        00518000
005181                         PV-OPER-UNT-ID-N                         00518100
005182                                         DELIMITED BY SIZE        00518200
005183                                   INTO PV-ABEND-OPER-MESSAGE-2   00518300
005184             MOVE 'SUT_CART_DIRV_TRKG'                            00518400
005185                                      TO PV-ABEND-TABLE-1         00518500
005186             PERFORM 9900-DB2-ERROR                               00518600
005187     END-EVALUATE.                                                00518700
005188                                                                  00518800
005189                                                                  00518900
005190******************************************************************00519000
005191* FETCH A ROW FROM THE CASEPK DEL CURSOR                          00519100
005192******************************************************************00519200
005193 3020-PROCESS-CSEPK-DEL-CSR.                                      00519300
005194                                                                  00519400
005195     EXEC SQL                                                     00519500
005196          FETCH CASEPK_DEL_CSR                                    00519600
005197           INTO :SUT00102-SHIPT-UNT-ID                            00519700
005198              , :SUT00102-STR-NBR                                 00519800
005199     END-EXEC.                                                    00519900
005200                                                                  00520000
005201     EVALUATE TRUE                                                00520100
005202         WHEN SQLCODE = ZERO                                      00520200
005203             SET PS-DIRECTIVE-DELETE TO TRUE                      00520300
005204             PERFORM 4000-POPULATE-DIRECTIVE-RQST                 00520400
005205             PERFORM 4100-CALL-DIRECTIVE-REQUEST                  00520500
005206         WHEN SQLCODE = +100                                      00520600
005207             SET PS-END-OF-CSEPK-DEL  TO TRUE                     00520700
005208         WHEN SQLWARN0 NOT EQUAL SPACE                            00520800
005209         WHEN SQLCODE NOT EQUAL ZERO                              00520900
005210             SET SU095-SQL-ERROR  TO TRUE                         00521000
005211             MOVE SQLCODE         TO SU095-ERROR-NBR              00521100
005212             MOVE SQLCA           TO SU095-SQLCA                  00521200
005213             MOVE '3020-PROCESS-CSEPK-DEL-CSR'                    00521300
005214                                      TO PV-ABEND-PARAGRAPH       00521400
005215             MOVE 'ERROR PROCESSING CSEPK DEL CURSOR'             00521500
005216                                      TO PV-ABEND-OPER-MESSAGE-1  00521600
005217             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00521700
005218             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00521800
005219             MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N             00521900
005220             STRING 'PO NBR: '  DELIMITED BY SIZE                 00522000
005221                         PV-PO-NBR-N                              00522100
005222                                         DELIMITED BY SIZE        00522200
005223                        '   REC SEQ NBR: '                        00522300
005224                                         DELIMITED BY SIZE        00522400
005225                         PV-REC-SEQ-NBR-N                         00522500
005226                                         DELIMITED BY SIZE        00522600
005227                        '   OPER UNT ID: '                        00522700
005228                                         DELIMITED BY SIZE        00522800
005229                         PV-OPER-UNT-ID-N                         00522900
005230                                         DELIMITED BY SIZE        00523000
005231                                   INTO PV-ABEND-OPER-MESSAGE-2   00523100
005232             MOVE 'SUT_CART_DIRV_TRKG'                            00523200
005233                                      TO PV-ABEND-TABLE-1         00523300
005234             PERFORM 9900-DB2-ERROR                               00523400
005235     END-EVALUATE.                                                00523500
005236                                                                  00523600
005237                                                                  00523700
005238******************************************************************00523800
005239* CLOSE THE CASEPK DEL CURSOR                                     00523900
005240******************************************************************00524000
005241 3030-CLOSE-CSEPK-DEL-CSR.                                        00524100
005242                                                                  00524200
005243                                                                  00524300
005244     EXEC SQL                                                     00524400
005245         CLOSE CASEPK_DEL_CSR                                     00524500
005246     END-EXEC.                                                    00524600
005247                                                                  00524700
005248     EVALUATE TRUE                                                00524800
005249         WHEN SQLCODE = +0                                        00524900
005250         WHEN SQLCODE = -904                                      00525000
005251         WHEN SQLCODE = -911                                      00525100
005252         WHEN SQLCODE = -913                                      00525200
005253             CONTINUE                                             00525300
005254         WHEN SQLWARN0 NOT EQUAL SPACE                            00525400
005255         WHEN SQLCODE NOT EQUAL ZERO                              00525500
005256             SET SU095-SQL-ERROR  TO TRUE                         00525600
005257             MOVE SQLCODE         TO SU095-ERROR-NBR              00525700
005258             MOVE SQLCA           TO SU095-SQLCA                  00525800
005259             MOVE '3030-CLOSE-CSEPK-DEL-CSR'                      00525900
005260                                      TO PV-ABEND-PARAGRAPH       00526000
005261             MOVE 'ERROR CLOSING CASEPK DEL CURSOR'               00526100
005262                                      TO PV-ABEND-OPER-MESSAGE-1  00526200
005263             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00526300
005264             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00526400
005265             MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N             00526500
005266             STRING 'PO NBR: '  DELIMITED BY SIZE                 00526600
005267                         PV-PO-NBR-N                              00526700
005268                                         DELIMITED BY SIZE        00526800
005269                        '   REC SEQ NBR: '                        00526900
005270                                         DELIMITED BY SIZE        00527000
005271                         PV-REC-SEQ-NBR-N                         00527100
005272                                         DELIMITED BY SIZE        00527200
005273                        '   OPER UNT ID: '                        00527300
005274                                         DELIMITED BY SIZE        00527400
005275                         PV-OPER-UNT-ID-N                         00527500
005276                                         DELIMITED BY SIZE        00527600
005277                                   INTO PV-ABEND-OPER-MESSAGE-2   00527700
005278             MOVE 'SUT_CART_DIRV_TRKG'                            00527800
005279                                      TO PV-ABEND-TABLE-1         00527900
005280             PERFORM 9900-DB2-ERROR                               00528000
005290     END-EVALUATE.                                                00529000
005291                                                                  00529100
005292                                                                  00529200
005293******************************************************************00529300
005294* PROCESS CALL FOR CASEPK PREPK DELETES                           00529400
005295******************************************************************00529500
005296 3500-CSEPK-DEL-PREPK.                                            00529600
005297                                                                  00529700
005298     PERFORM 3510-OPEN-CSEPK-DEL-PREPK-CSR.                       00529800
005299                                                                  00529900
005300     PERFORM 3520-PROC-CSE-DEL-PREPK-CSR                          00530000
005301         UNTIL PS-END-OF-CSE-DEL-PREPK                            00530100
005302            OR SU095-SQL-ERROR.                                   00530200
005303                                                                  00530300
005304     PERFORM 3530-CLOSE-CSEPK-DEL-PREPK-CSR.                      00530400
005305                                                                  00530500
005306                                                                  00530600
005307******************************************************************00530700
005308* OPEN THE CASEPK DELETE CURSOR (WITH PREPK)                      00530800
005309******************************************************************00530900
005310 3510-OPEN-CSEPK-DEL-PREPK-CSR.                                   00531000
005311                                                                  00531100
005312     MOVE SU095-KEY-PO            TO DK-PO-NBR.                   00531200
005313     MOVE SU095-KEY-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.              00531300
005314     MOVE SU095-KEY-OPER-UNT-ID   TO DK-OPER-UNT-ID.              00531400
005315                                                                  00531500
005316     EXEC SQL                                                     00531600
005317         OPEN CSEPK_DEL_PREPK_CSR                                 00531700
005318     END-EXEC.                                                    00531800
005319                                                                  00531900
005320     EVALUATE TRUE                                                00532000
005321         WHEN SQLCODE = +0                                        00532100
005322         WHEN SQLCODE = -904                                      00532200
005323         WHEN SQLCODE = -911                                      00532300
005324         WHEN SQLCODE = -913                                      00532400
005325             CONTINUE                                             00532500
005326         WHEN SQLWARN0 NOT EQUAL SPACE                            00532600
005327         WHEN SQLCODE NOT EQUAL ZERO                              00532700
005328             SET SU095-SQL-ERROR  TO TRUE                         00532800
005329             MOVE SQLCODE         TO SU095-ERROR-NBR              00532900
005330             MOVE SQLCA           TO SU095-SQLCA                  00533000
005331             MOVE '3510-OPEN-CSEPK-DEL-PREPK-CSR'                 00533100
005332                                      TO PV-ABEND-PARAGRAPH       00533200
005333             MOVE 'ERROR OPENING CSEPK DEL PREPK CURSOR'          00533300
005334                                      TO PV-ABEND-OPER-MESSAGE-1  00533400
005335             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00533500
005336             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00533600
005337             MOVE DK-STR-NBR      TO PV-STR-NBR-N                 00533700
005338             MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N             00533800
005339             STRING 'PO NBR: '  DELIMITED BY SIZE                 00533900
005340                         PV-PO-NBR-N                              00534000
005341                                         DELIMITED BY SIZE        00534100
005342                        '   REC SEQ NBR: '                        00534200
005343                                         DELIMITED BY SIZE        00534300
005344                         PV-REC-SEQ-NBR-N                         00534400
005345                                         DELIMITED BY SIZE        00534500
005346                        '   OPER UNIT ID: '                       00534600
005347                                         DELIMITED BY SIZE        00534700
005348                         PV-OPER-UNT-ID-N                         00534800
005349                                         DELIMITED BY SIZE        00534900
005350                                   INTO PV-ABEND-OPER-MESSAGE-2   00535000
005351             MOVE 'SUT_CART_DIRV_TRKG'                            00535100
005352                                      TO PV-ABEND-TABLE-1         00535200
005353             PERFORM 9900-DB2-ERROR                               00535300
005354     END-EVALUATE.                                                00535400
005355                                                                  00535500
005356                                                                  00535600
005357******************************************************************00535700
005358* FETCH A ROW FROM THE CASEPK DEL PREPK CURSOR                    00535800
005359******************************************************************00535900
005360 3520-PROC-CSE-DEL-PREPK-CSR.                                     00536000
005361                                                                  00536100
005362     EXEC SQL                                                     00536200
005363          FETCH CSEPK_DEL_PREPK_CSR                               00536300
005364           INTO :SUT00102-SHIPT-UNT-ID                            00536400
005365              , :SUT00102-STR-NBR                                 00536500
005366     END-EXEC.                                                    00536600
005367                                                                  00536700
005368     EVALUATE TRUE                                                00536800
005369         WHEN SQLCODE = ZERO                                      00536900
005370             SET PS-DIRECTIVE-DELETE TO TRUE                      00537000
005371             PERFORM 4000-POPULATE-DIRECTIVE-RQST                 00537100
005372             PERFORM 4100-CALL-DIRECTIVE-REQUEST                  00537200
005373         WHEN SQLCODE = +100                                      00537300
005374             SET PS-END-OF-CSE-DEL-PREPK  TO TRUE                 00537400
005375         WHEN SQLWARN0 NOT EQUAL SPACE                            00537500
005376         WHEN SQLCODE NOT EQUAL ZERO                              00537600
005377             SET SU095-SQL-ERROR  TO TRUE                         00537700
005378             MOVE SQLCODE         TO SU095-ERROR-NBR              00537800
005379             MOVE SQLCA           TO SU095-SQLCA                  00537900
005380             MOVE '3520-PROCESS-CSEPK-DEL-PREPK-CSR'              00538000
005381                                      TO PV-ABEND-PARAGRAPH       00538100
005382             MOVE 'ERROR PROCESSING CSEPK DEL PREPK CURSOR'       00538200
005383                                      TO PV-ABEND-OPER-MESSAGE-1  00538300
005384             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00538400
005385             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00538500
005386             MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N             00538600
005387             STRING 'PO NBR: '  DELIMITED BY SIZE                 00538700
005388                         PV-PO-NBR-N                              00538800
005389                                         DELIMITED BY SIZE        00538900
005390                        '   REC SEQ NBR: '                        00539000
005391                                         DELIMITED BY SIZE        00539100
005392                         PV-REC-SEQ-NBR-N                         00539200
005393                                         DELIMITED BY SIZE        00539300
005394                        '   OPER UNT ID: '                        00539400
005395                                         DELIMITED BY SIZE        00539500
005396                         PV-OPER-UNT-ID-N                         00539600
005397                                         DELIMITED BY SIZE        00539700
005398                                   INTO PV-ABEND-OPER-MESSAGE-2   00539800
005399             MOVE 'SUT_CART_DIRV_TRKG'                            00539900
005400                                      TO PV-ABEND-TABLE-1         00540000
005401             PERFORM 9900-DB2-ERROR                               00540100
005402     END-EVALUATE.                                                00540200
005403                                                                  00540300
005404                                                                  00540400
005405******************************************************************00540500
005406* CLOSE THE CASEPK DEL PREPK CURSOR                               00540600
005407******************************************************************00540700
005408 3530-CLOSE-CSEPK-DEL-PREPK-CSR.                                  00540800
005409                                                                  00540900
005410                                                                  00541000
005411     EXEC SQL                                                     00541100
005412         CLOSE CSEPK_DEL_PREPK_CSR                                00541200
005413     END-EXEC.                                                    00541300
005414                                                                  00541400
005415     EVALUATE TRUE                                                00541500
005416         WHEN SQLCODE = +0                                        00541600
005417         WHEN SQLCODE = -904                                      00541700
005418         WHEN SQLCODE = -911                                      00541800
005419         WHEN SQLCODE = -913                                      00541900
005420             CONTINUE                                             00542000
005421         WHEN SQLWARN0 NOT EQUAL SPACE                            00542100
005422         WHEN SQLCODE NOT EQUAL ZERO                              00542200
005423             SET SU095-SQL-ERROR  TO TRUE                         00542300
005424             MOVE SQLCODE         TO SU095-ERROR-NBR              00542400
005425             MOVE SQLCA           TO SU095-SQLCA                  00542500
005426             MOVE '3530-CLOSE-CSEPK-DEL-PREPK-CSR'                00542600
005427                                      TO PV-ABEND-PARAGRAPH       00542700
005428             MOVE 'ERROR CLOSING CASEPK DEL PREPK CURSOR'         00542800
005429                                      TO PV-ABEND-OPER-MESSAGE-1  00542900
005430             MOVE DK-PO-NBR       TO PV-PO-NBR-N                  00543000
005431             MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR-N             00543100
005432             MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N             00543200
005433             STRING 'PO NBR: '  DELIMITED BY SIZE                 00543300
005434                         PV-PO-NBR-N                              00543400
005435                                         DELIMITED BY SIZE        00543500
005436                        '   REC SEQ NBR: '                        00543600
005437                                         DELIMITED BY SIZE        00543700
005438                         PV-REC-SEQ-NBR-N                         00543800
005439                                         DELIMITED BY SIZE        00543900
005440                        '   OPER UNT ID: '                        00544000
005441                                         DELIMITED BY SIZE        00544100
005442                         PV-OPER-UNT-ID-N                         00544200
005443                                         DELIMITED BY SIZE        00544300
005444                                   INTO PV-ABEND-OPER-MESSAGE-2   00544400
005445             MOVE 'SUT_CART_DIRV_TRKG'                            00544500
005446                                      TO PV-ABEND-TABLE-1         00544600
005447             PERFORM 9900-DB2-ERROR                               00544700
005448     END-EVALUATE.                                                00544800
005449                                                                  00544900
005450                                                                  00545000
005451******************************************************************00545100
005452* 4000-POPULATE-DIRECTIVE-RQST                                   *00545200
005453*     CALL PGM SUKUT129. CHECK FOR ERRORS UPON RETURN            *00545300
005454******************************************************************00545400
005455 4000-POPULATE-DIRECTIVE-RQST.                                    00545500
005456     INITIALIZE SU090-DG-REQUEST-COMMAREA.                        00545600
005458     MOVE '00'                     TO SU090-RET-CODE.             00545800
005459     MOVE PC-CURRENT-PROGRAM-NAME  TO SU090-CALLING-PGM.          00545900
005460     MOVE 'RFD'                    TO SU090-DIRV-RSN-CDE.         00546000
005461     MOVE ' '                      TO SU090-CASI-CDE.             00546100
005462                                                                  00546200
005463     IF SU095-ASSOC-ID    >  SPACE                                00546300
005464        MOVE SU095-ASSOC-ID TO SU090-ASSOC-ID                     00546400
005465     END-IF                                                       00546500
005466                                                                  00546600
005467     SET  SU090-ONLINE             TO TRUE.                       00546700
005468     SET  SU090-CARTON-DIRECTIVE   TO TRUE.                       00546800
005469     SET  SU090-SML-BARCODE        TO TRUE.                       00546900
005470     IF PS-DIRECTIVE-ADD                                          00547000
005471         SET  SU090-ADD-ACTION     TO TRUE                        00547100
005472     ELSE                                                         00547200
005473         SET  SU090-DELETE-ACTION  TO TRUE                        00547300
005474     END-IF.                                                      00547400
005475     SET  SU090-QMNGR-CONNECTED-NO TO TRUE.                       00547500
005476     EVALUATE TRUE                                                00547600
005477        WHEN SU095-CSEPK-SPLIT                                    00547700
005478        WHEN SU095-CSEPK-DEL                                      00547800
005479           MOVE SU095-KEY-OPER-UNT-ID     TO SU090-OPER-UNT-ID    00547900
005480           MOVE SUT00024-SHIPT-UNT-ID     TO SU090-SML-BRCDE-NBR  00548000
005481           MOVE SUT00024-DEST-LOC-NBR     TO SU090-STR-NBR        00548100
005482           MOVE SU095-KEY-PO              TO SU090-PO-NBR         00548200
005483           MOVE SU095-KEY-REC-SEQ-NBR     TO SU090-RCVR-SEQ-NBR   00548300
005484           IF SU095-PREPK-ORDER-YES                               00548400
005485               MOVE 0                     TO SU090-PO-LNE-NBR     00548500
005486               MOVE SU095-KEY-PREPK-ID    TO SU090-PO-PREPK-ID    00548600
005487           ELSE                                                   00548700
005488               MOVE SU095-KEY-LNE-NBR     TO SU090-PO-LNE-NBR     00548800
005489               MOVE 0                     TO SU090-PO-PREPK-ID    00548900
005490           END-IF                                                 00549000
005491        WHEN SU095-SMOOTHING                                      00549100
005492           MOVE SU095-KEY-OPER-UNT-ID     TO SU090-OPER-UNT-ID    00549200
005493           MOVE SUT00024-SHIPT-UNT-ID     TO SU090-SML-BRCDE-NBR  00549300
005495           MOVE SUT00024-DEST-LOC-NBR     TO SU090-STR-NBR        00549500
005496           MOVE SU095-KEY-PO              TO SU090-PO-NBR         00549600
005497           MOVE SU095-KEY-REC-SEQ-NBR     TO SU090-RCVR-SEQ-NBR   00549700
005498           MOVE ZERO                      TO SU090-PO-LNE-NBR     00549800
005512        WHEN OTHER                                                00551200
005513           CONTINUE                                               00551300
005514     END-EVALUATE.                                                00551400
005515                                                                  00551500
005516                                                                  00551600
005517******************************************************************00551700
005518* 4100-CALL-DIRECTIVE-REQUEST                                    *00551800
005519*     CALL PGM SUKUT129. CHECK FOR ERRORS UPON RETURN            *00551900
005520******************************************************************00552000
005521 4100-CALL-DIRECTIVE-REQUEST.                                     00552100
005530     INSPECT SU090-DG-REQUEST-COMMAREA                            00553000
005540         REPLACING ALL LOW-VALUES BY '?'.                         00554000
005550                                                                  00555000
005560     CALL WS-DDG-PGM-NAME USING DFHEIBLK                          00556000
005570                                SU090-COMMAREA                    00557000
005580                                SU090-DG-REQUEST-COMMAREA.        00558000
005590                                                                  00559000
005600     IF SU090-SUCCESS                                             00560000
005700         SET SU095-SUCCESS TO TRUE                                00570000
005710     ELSE                                                         00571000
005720         MOVE SU090-RET-CODE      TO SU095-RET-CODE               00572000
005730         MOVE SU090-ERR-PROGRAM   TO SU095-ERR-PROGRAM            00573000
005740         MOVE SU090-ERR-PARAGRAPH TO SU095-ERR-PARAGRAPH          00574000
005750         MOVE SU090-SQLCODE       TO SU095-SQLCODE                00575000
005760         MOVE SU090-SQLCA         TO SU095-SQLCA                  00576000
005770         MOVE SU090-MQ-COND-CODE  TO SU095-MQ-COND-CODE           00577000
005780         MOVE SU090-MQ-REAS-CODE  TO SU095-MQ-REAS-CODE           00578000
005790         MOVE SU090-MQ-REAS-TXT   TO SU095-MQ-REAS-TXT            00579000
005800     END-IF.                                                      00580000
005900                                                                  00590000
006000******************************************************************00600000
006100* 9900-DB2-ERROR - PERFORMS THE DISPLAY OF THE FORMATTED DB2      00610000
006110* MESSAGE IN THE EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.  00611000
006120******************************************************************00612000
006130 9900-DB2-ERROR.                                                  00613000
006140                                                                  00614000
006150     MOVE SQLCODE    TO PV-SQLCODE.                               00615000
006160     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       00616000
006170     DISPLAY '******* START OF SUKUT150 ERROR DISPLAY *******'    00617000
006180     DISPLAY '*** DB2 ERROR ***'.                                 00618000
006190     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               00619000
006200     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 00620000
006210     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               00621000
006220     DISPLAY '*** OPERATION = ' PV-ABEND-OPER-MESSAGE-1.          00622000
006230     DISPLAY '***           = ' PV-ABEND-OPER-MESSAGE-2.          00623000
006240     DISPLAY '***           = ' PV-ABEND-OPER-MESSAGE-3.          00624000
006250     DISPLAY '***           = ' PV-ABEND-OPER-MESSAGE-4.          00625000
006260                                                                  00626000
006270     DISPLAY '***           = ' PV-ABEND-TABLE-2.                 00627000
006280     DISPLAY '***           = ' PV-ABEND-TABLE-3.                 00628000
006290     DISPLAY '***           = ' PV-ABEND-TABLE-4.                 00629000
006300                                                                  00630000
006310     DISPLAY '***'.                                               00631000
006320     DISPLAY '*** COMMUNICATION AREA ***'.                        00632000
006330     DISPLAY '*** ACCESS METHOD     = ' SU095-ACCESS-METHOD.      00633000
006340     DISPLAY '*** ACTN-CDE          = ' SU095-ACTN-CDE.           00634000
006350                                                                  00635000
006360                                                                  00636000
