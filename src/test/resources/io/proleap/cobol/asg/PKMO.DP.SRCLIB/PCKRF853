000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - FAST TOTE SCAN'.                            00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKRF853.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           JANUARY 2001.                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000* THIS PROGRAM ACCEPTS A FAST TOTE NUMBER FROM EITHER A LASER     00100000
001100* RADIO TERMINAL OR KEYED ENTRY.                                  00110000
001200                                                                  00120000
001300 ENVIRONMENT DIVISION.                                            00130000
001400 DATA DIVISION.                                                   00140000
001500                                                                  00150000
001600 WORKING-STORAGE SECTION.                                         00160000
001700******************************************************************00170000
001800*                                                                 00180000
001900 01  DK-DB2-KEYS.                                                 00190000
002000     05  DK-FR-STR-NBR                PIC  S9(04) COMP            00200000
002100                                           VALUE ZERO.            00210000
002200     05  DK-XFER-SEQ-NBR              PIC  S9(08) COMP            00220000
002300                                           VALUE ZERO.            00230000
002400     05  DK-TRN-NBR                   PIC  S9(09) COMP            00240008
002500                                           VALUE ZERO.            00250000
002600                                                                  00260000
002700 01  PC-PROGRAM-CONSTANTS.                                        00270000
002800     05  PC-TRANID                    PIC X(04)  VALUE 'E853'.    00280000
002900                                                                  00290000
003000     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF853'. 00300000
003100     05  PC-MANIFEST-NBR-MODULE       PIC X(08) VALUE 'PCKCS721'. 00310000
003200                                                                  00320000
003300                                                                  00330000
003400* ERROR MESSAGES                                                 *00340000
003500     05  PC-DB2-DATABASE-ERROR-MSG    PIC X(19) VALUE             00350000
003600                                           'DB2 ACCESS ERROR   '. 00360000
003700     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00370000
003800                                           'UNRECOGNIZED PF KEY'. 00380000
003900     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00390000
004000                                           'ENTER THROUGH MENU '. 00400000
004100     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00410000
004200                                           'TRANS NOT AVAILABLE'. 00420000
004300     05  PC-PLS-ENT-FLD-MSG           PIC X(19) VALUE             00430000
004400                                           'PLEASE ENTER FIELD '. 00440000
004500     05  PC-MUST-BE-NUM-MSG           PIC X(19) VALUE             00450000
004600                                           'MUST BE NUMERIC    '. 00460000
004700     05  PC-MUST-BE-GT-0-MSG          PIC X(19) VALUE             00470000
004800                                           'MUST BE > ZERO     '. 00480000
004900     05  PC-FIRST-1-NOT-0-MSG         PIC X(19) VALUE             00490000
005000                                           'FIRST DIGIT NOT 0  '. 00500000
005100     05  PC-TOO-MANY-DIGITS           PIC X(19) VALUE             00510000
005200                                           'TOO MANY DIGITS    '. 00520000
005300     05  PC-CICS-ERR-MSG              PIC X(19) VALUE             00530000
005400                                           'CICS ACCESS ERROR  '. 00540000
005500     05  PC-WRONG-FACILITY            PIC X(19) VALUE             00550000
005600                                           'WRG FCLTY - F2 CONF'. 00560000
005700     05  PC-MORE-DIGITS-REQD          PIC X(19) VALUE             00570000
005800                                           'MORE DIGITS REQUIRD'. 00580000
005900     05  PC-IGNORE-UPDATE-MSG         PIC X(19) VALUE             00590000
006000                                           'UPDATE NOT DONE    '. 00600000
006100                                                                  00610000
006200 01  PS-PROGRAM-SWITCHES.                                         00620000
006300     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.      00630000
006400         88  PS-ERRORS-YES                        VALUE 'Y'.      00640000
006500         88  PS-ERRORS-NO                         VALUE 'N'.      00650000
006600     05  PS-VALID-INPUT-SW            PIC  X(01)  VALUE 'N'.      00660000
006700         88  PS-VALID-INPUT                       VALUE 'Y'.      00670000
006800         88  PS-INVALID-INPUT                     VALUE 'N'.      00680000
006900     05  PS-TTFMSTR-SW                PIC X(01)   VALUE 'N'.      00690000
007000         88  PS-TTFMSTR-YES                       VALUE 'Y'.      00700000
007100         88  PS-TTFMSTR-NO                        VALUE 'N'.      00710000
007200     05  PS-CART-UPC-SW               PIC X(01)   VALUE 'N'.      00720000
007300         88  PS-CART-UPC-YES                      VALUE 'Y'.      00730000
007400         88  PS-CART-UPC-NO                       VALUE 'N'.      00740000
007500     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00750000
007600         88  PS-XCTL-E854                         VALUE 'E854'.   00760000
007700         88  PS-XCTL-E857                         VALUE 'E857'.   00770000
007800         88  PS-XCTL-E858                         VALUE 'E858'.   00780000
007900                                                                  00790000
008000*----------------------------------------------------------------*00800000
008100*  PROGRAM VARIABLES                                             *00810000
008200*----------------------------------------------------------------*00820000
008300 01  PV-PROGRAM-VARIABLES.                                        00830000
008400     05  PV-TMST                      PIC X(26).                  00840000
008500     05  PV-SUB                       PIC S9(4) COMP              00850000
008600                                                VALUE ZERO.       00860000
008700     05  PV-TRN-NBR                   PIC 9(11) VALUE ZERO.       00870008
008800     05  PV-HOLD-CHECK-DIGIT.                                     00880000
008900         10  PV-HOLD-CHECK-DIGIT-N    PIC 9(01) VALUE ZERO.       00890000
009000     05  PV-FAST-13                   PIC X(13) VALUE ZEROES.     00900011
009100     05  PV-FAST-N REDEFINES PV-FAST-13                           00910011
009200                                      PIC 9(13).                  00920011
009300                                                                  00930000
009400     05  PV-FAST-CHECKER              PIC X(13).                  00940011
009500* VALID PATTERNS                                                  00950000
009600         88  PV-VALID-FAST            VALUES                      00960000
009700             '9999-999999-9'                                      00970011
009800             '999-999999-9B'                                      00980013
009900             '999999999999B'                                      00990011
010000             '99999999999BB'                                      01000011
010100             '9999999999BBB'                                      01010011
010200             'BBBBBBBBBBBBB'                                      01020011
010300             '0000000000000'.                                     01030011
010400         88  PV-FAST-DASH-CHECK-DIGIT VALUE                       01040000
010500             '9999-999999-9'.                                     01050011
010600         88  PV-FAST-DASH-CHECK-DIG12 VALUE                       01060007
010700             '999-999999-9B'.                                     01070011
010800         88  PV-FAST-DASH-2-SPACE-TRAIL                           01080000
010900                                      VALUE                       01090000
011000             '999999999999B'.                                     01100011
011100         88  PV-FAST-DASH-3-SPACE-TRAIL                           01110009
011200                                      VALUE                       01120007
011300             '99999999999BB'.                                     01130011
011400         88  PV-FAST-DASH-2-SPACE-TRL12                           01140009
011500                                      VALUE                       01150009
011600             '9999999999BBB'.                                     01160011
011700         88  PV-FAST-BLANK-ENTRY      VALUE                       01170000
011800             'BBBBBBBBBBBBB'.                                     01180011
011900         88  PV-FAST-ZERO-ENTRY       VALUE                       01190000
012000             '0000000000000'.                                     01200011
012100                                                                  01210000
012200                                                                  01220000
012300     05  PV-FAST-EDIT-MASK REDEFINES PV-FAST-CHECKER.             01230000
012400         10  PV-FAST-CHAR             PIC X(01) OCCURS 13 TIMES.  01240012
012500                                                                  01250000
012600     05  PV-EXPAND-TO-13-WDASH.                                   01260011
012700         10  PV-EXPAND-WDASH-2        PIC X(02)   VALUE SPACES.   01270007
012800         10  PV-EXPAND-WDASH-12       PIC X(11)   VALUE SPACES.   01280012
012900     05  PV-EXPAND-TO-13-WODASH.                                  01290011
013000         10  PV-EXPAND-WODASH-10      PIC X(11)   VALUE SPACES.   01300011
013100         10  PV-EXPAND-WODASH-4       PIC X(02)   VALUE SPACES.   01310011
013200     05  PV-NULL-IND                  PIC S9(4)   VALUE ZERO      01320000
013300                                                     COMP SYNC.   01330000
013400     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        01340000
013500                                                     COMP SYNC.   01350000
013600     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    01360000
013700     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     01370000
013800                                                     COMP SYNC.   01380000
013900     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    01390000
014000     05  PV-MANIFEST-START            PIC S9(9) COMP-3.           01400000
014100     05  PV-MANIFEST-END              PIC S9(9) COMP-3.           01410000
014200 01  PV-LOG-MSG.                                                  01420000
014300     05  FILLER                       PIC X(12) VALUE             01430000
014400         ' E853 ERROR '.                                          01440000
014500     05  FILLER                       PIC X(09) VALUE             01450000
014600         'SQLCODE= '.                                             01460000
014700     05  PV-SQLCODE                   PIC -9(03).                 01470000
014800     05  FILLER                       PIC X(06) VALUE             01480000
014900         ' ERR= '.                                                01490000
015000     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       01500000
015100     05  FILLER                       PIC X(07) VALUE             01510000
015200         ' FAST= '.                                               01520000
015300     05  PV-DISPLAY-FAST              PIC X(13) VALUE ZEROES.     01530012
015400     05  FILLER                       PIC X(05) VALUE             01540000
015500         ' PO= '.                                                 01550000
015600     05  PV-DISPLAY-PO                PIC 9(09) VALUE ZEROES.     01560000
015700     05  FILLER                       PIC X(07) VALUE             01570000
015800         ' RCVR= '.                                               01580000
015900     05  PV-DISPLAY-RCVR              PIC 9(04) VALUE ZEROES.     01590000
016000     05  FILLER                       PIC X(07) VALUE             01600000
016100         ' LINE= '.                                               01610000
016200     05  PV-DISPLAY-PO-LNE-NBR        PIC 9(04) VALUE ZEROES.     01620000
016300     05  FILLER                       PIC X(06) VALUE             01630000
016400         ' STR= '.                                                01640000
016500     05  PV-DISPLAY-STORE             PIC 9(04) VALUE ZEROES.     01650000
016600                                                                  01660000
016700 01  PV-EDITING-FIELDS.                                           01670000
016800                                                                  01680000
016900     05  PV-PROGRAM-DATA.                                         01690000
017000** AS PART OF THE PO EXPANSION PROJECT, COMMENTED OUT THE NEXT    01700013
017100** 7 LINES BECAUSE THEY ARE NEVER REFERENCED IN THE PROGRAM.      01710013
017200*        10  PV-PO                    PIC X(07)  VALUE SPACE.     01720013
017300*        10  PV-PO-N REDEFINES PV-PO  PIC ZZZZZZ9.                01730013
017400*                                                                 01740000
017500*        10  PV-PO-RCVR.                                          01750013
017600*            15 PV-PO-OUT             PIC  9(07).                 01760013
017700*            15 FILLER                PIC  X(01)  VALUE '-'.      01770013
017800*            15 PV-RCVR-OUT           PIC 9(03).                  01780013
017900*                                                                 01790000
018000                                                                  01800000
018100         10  PV-PO-LINE-N             PIC 9(09).                  01810000
018200         10  PV-PO-LINE-X REDEFINES PV-PO-LINE-N.                 01820000
018300             15 FILLER                PIC X(05).                  01830000
018400             15 PV-PO-LINE-OUT        PIC X(04).                  01840000
018500                                                                  01850000
018600         10  PV-PO-LINE-LBL.                                      01860000
018700             15  PV-LINE-LBL-1        PIC 9(01).                  01870000
018800             15  PV-LINE-LBL-3        PIC 9(03).                  01880000
018900                                                                  01890000
019000/                                                                 01900000
019100* COMMAREA FOR PCRF85X SCREENS                                    01910000
019200 01  CA-COMMAREA.                                                 01920000
019300     COPY PCWS033.                                                01930000
019400*  CHECK DIGIT WORK AREA                                          01940000
019500     COPY PCWS037.                                                01950000
019600*  MAP LAYOUT                                                     01960000
019700     COPY PCKM853.                                                01970000
019800                                                                  01980000
019900* HELP SCREEN COMMAREA                                            01990000
020000     COPY PCWS192.                                                02000000
020100* HELP SCREEN WORK AREA                                           02010000
020200     COPY PCWS188.                                                02020000
020300                                                                  02030000
020400/                                                                 02040000
020500*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   02050000
020600     COPY DPWS015.                                                02060000
020700                                                                  02070000
020800*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02080000
020900     COPY DFHAID.                                                 02090000
021000                                                                  02100000
021100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               02110000
021200     COPY DPWS013.                                                02120000
021300/                                                                 02130000
021400     EXEC SQL                                                     02140000
021500         INCLUDE TTFMSTR                                          02150000
021600     END-EXEC.                                                    02160000
021700                                                                  02170000
021800     EXEC SQL                                                     02180000
021900         INCLUDE SUT00028                                         02190000
022000     END-EXEC.                                                    02200000
022100                                                                  02210000
022200     EXEC SQL                                                     02220005
022300         INCLUDE SUT00024                                         02230005
022400     END-EXEC.                                                    02240005
022500                                                                  02250005
022600     EXEC SQL                                                     02260005
022700         DECLARE CARTON-CSR CURSOR FOR                            02270005
022800             SELECT A.SHIPT_UNT_ID                                02280005
022900             FROM SUT_OTBND_UPC A                                 02290005
023000                , SUT_OTBND_CART B                                02300005
023100             WHERE A.TRN_NBR              = :DK-TRN-NBR           02310005
023200               AND A.TRN_TYP_CDE          = 'FX'                  02320005
023300               AND A.SHIPT_UNT_ID         = B.SHIPT_UNT_ID        02330005
023400               AND B.ACTV_IND             = 'Y'                   02340005
023500     END-EXEC.                                                    02350005
023600                                                                  02360005
023700     EXEC SQL                                                     02370005
023800         INCLUDE SQLCA                                            02380005
023900     END-EXEC.                                                    02390005
024000                                                                  02400005
024100 LINKAGE SECTION.                                                 02410005
024200 01  DFHCOMMAREA.                                                 02420005
024300     05  FILLER                         OCCURS  1 TO 4072 TIMES   02430005
024400                                      DEPENDING ON EIBCALEN.      02440005
024500         10  FILLER                   PIC X.                      02450005
024600/                                                                 02460005
024700 PROCEDURE DIVISION.                                              02470005
024800 0000-PROGRAM-MAINLINE.                                           02480005
024900                                                                  02490005
025000     INITIALIZE CA-COMMAREA                                       02500005
025100     MOVE DFHCOMMAREA                 TO CA-COMMAREA              02510005
025200                                                                  02520005
025300     EVALUATE TRUE                                                02530005
025400         WHEN EIBCALEN = ZERO                                     02540005
025500             MOVE PC-ENTER-THROUGH-MENU-MSG                       02550005
025600                                      TO PV-MESSAGE-AREA          02560005
025700             PERFORM 8110-RETURN                                  02570005
025800                                                                  02580005
025900         WHEN EIBTRNID = 'Z278'                                   02590005
026000             MOVE DFHCOMMAREA         TO PC192-COMMAREA           02600005
026100             MOVE PC192-HOST-SAVE-AREA                            02610005
026200                                      TO CA-COMMAREA              02620005
026300             SET PC033-PROCESS-SCREEN TO TRUE                     02630005
026400             MOVE PC192-HOST-SAVE-MAP TO PC853AO                  02640005
026500             MOVE -1                  TO AFASTL                   02650005
026600             PERFORM 8000-SEND-MAP                                02660005
026700             PERFORM 8100-RETURN-TRANID                           02670005
026800                                                                  02680005
026900         WHEN PC033-INITIALIZE-SCREEN                             02690005
027000         WHEN EIBAID = DFHCLEAR                                   02700005
027100             PERFORM 1000-INITIALIZE                              02710005
027200             PERFORM 8000-SEND-MAP                                02720005
027300             PERFORM 8100-RETURN-TRANID                           02730005
027400                                                                  02740005
027500                                                                  02750005
027600         WHEN EIBAID = DFHPF3                                     02760005
027700             MOVE 'PCKRF850'          TO PV-TRANSFER-PROGRAM      02770005
027800             PERFORM 8200-XCTL                                    02780005
027900                                                                  02790005
028000         WHEN EIBAID = DFHPF4                                     02800005
028100*            PERFORM 2000-PROCESS-SCREEN-FIELDS                   02810005
028200             MOVE 'PCKRF856'          TO PV-TRANSFER-PROGRAM      02820005
028300             PERFORM 8200-XCTL                                    02830005
028400                                                                  02840005
028500         WHEN EIBAID = DFHENTER                                   02850005
028600             PERFORM 2000-PROCESS-SCREEN-FIELDS                   02860005
028700             IF PS-ERRORS-NO                                      02870005
028800             EVALUATE TRUE                                        02880005
028900                 WHEN PS-XCTL-E854                                02890005
029000                     MOVE 'PCKRF854'  TO PV-TRANSFER-PROGRAM      02900005
029100                     PERFORM 8200-XCTL                            02910005
029200                 WHEN PS-XCTL-E857                                02920005
029300                     MOVE 'PCKRF857'  TO PV-TRANSFER-PROGRAM      02930005
029400                     PERFORM 8200-XCTL                            02940005
029500                 WHEN PS-XCTL-E858                                02950005
029600                     MOVE 'PCKRF858'  TO PV-TRANSFER-PROGRAM      02960005
029700                     PERFORM 8200-XCTL                            02970005
029800             END-EVALUATE                                         02980005
029900             ELSE                                                 02990005
030000                 PERFORM 8010-SEND-DATA-ONLY                      03000005
030100                 PERFORM 8100-RETURN-TRANID                       03010005
030200             END-IF                                               03020005
030300                                                                  03030005
030400         WHEN EIBAID = DFHPF1                                     03040005
030500             PERFORM 8020-RECEIVE-MAP                             03050005
030600             MOVE PC853AO             TO PC192-HOST-SAVE-MAP      03060005
030700             PERFORM 1200-HELP-SCREEN                             03070005
030800                                                                  03080005
030900         WHEN OTHER                                               03090005
031000             PERFORM 8020-RECEIVE-MAP                             03100005
031100             MOVE -1                  TO AFASTL                   03110005
031200             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      03120005
031300                                      TO AMSGLNO                  03130005
031400             PERFORM 8000-SEND-MAP                                03140005
031500*            PERFORM 8010-SEND-DATA-ONLY                          03150005
031600             PERFORM 8100-RETURN-TRANID                           03160005
031700     END-EVALUATE.                                                03170005
031800                                                                  03180005
031900     GOBACK.                                                      03190005
032000                                                                  03200005
032100 1000-INITIALIZE.                                                 03210005
032200                                                                  03220005
032300     INITIALIZE PC033-NBR-LABELS-REQUESTED                        03230005
032400                PC033-STR-NBR                                     03240005
032500                PC033-FIRST-CARTON                                03250005
032600                PC033-LAST-CARTON                                 03260005
032700                AFASTO                                            03270005
032800     SET PC033-PROCESS-SCREEN         TO TRUE                     03280005
032900     MOVE PC-TRANID                   TO PC033-TRAN-ID.           03290005
033000     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM       03300005
033100     MOVE -1                          TO AFASTL                   03310005
033200     IF PC033-LABEL-PRINT-COMPLETED                               03320005
033300         MOVE 'LABEL PRT COMPLETE'    TO AMSGLNO                  03330005
033400         SET PC033-LABEL-PRINT-BEGUN  TO TRUE                     03340005
033500     END-IF.                                                      03350005
033600                                                                  03360005
033700 1200-HELP-SCREEN.                                                03370005
033800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03380005
033900     MOVE 'PCKRF853'                  TO PC192-PROGRAM-NAME       03390005
034000     COPY PCPD188.                                                03400005
034100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03410005
034200     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     03420005
034300     PERFORM 8220-XCTL-TO-HELP.                                   03430005
034400                                                                  03440005
034500/                                                                 03450005
034600 2000-PROCESS-SCREEN-FIELDS.                                      03460005
034700                                                                  03470005
034800     PERFORM 8020-RECEIVE-MAP                                     03480005
034900                                                                  03490005
035000     PERFORM 2100-EDIT-INPUT.                                     03500005
035100                                                                  03510005
035200                                                                  03520005
035300     IF PS-VALID-INPUT                                            03530005
035400         SET PS-ERRORS-NO             TO TRUE                     03540005
035500     ELSE                                                         03550005
035600         PERFORM 8010-SEND-DATA-ONLY                              03560005
035700         PERFORM 8100-RETURN-TRANID                               03570005
035800     END-IF.                                                      03580005
035900                                                                  03590005
036000/                                                                 03600005
036100 2100-EDIT-INPUT.                                                 03610005
036200                                                                  03620005
036300     IF  AFASTL > ZERO                                            03630005
036400         MOVE AFASTI                  TO PV-FAST-13               03640012
036500     ELSE                                                         03650005
036600         IF AFASTA = DP015-ERASE-EOF                              03660005
036700             MOVE SPACES              TO PV-FAST-13               03670012
036800         END-IF                                                   03680005
036900     END-IF.                                                      03690005
037000                                                                  03700005
037100     PERFORM 2110-EDIT-FAST.                                      03710005
037200                                                                  03720005
037300                                                                  03730005
037400 2110-EDIT-FAST.                                                  03740005
037500                                                                  03750005
037600     MOVE PV-FAST-13                  TO PV-FAST-CHECKER          03760012
037700     SET PS-VALID-INPUT               TO TRUE                     03770005
037800* FAST NUMBER MUST INCLUDE A CHECK DIGIT NUMBER                   03780005
037900* KEYING THE DASHES IS OPTIONAL                                   03790005
038000                                                                  03800005
038100     PERFORM VARYING PV-SUB FROM 1 BY 1                           03810005
038200             UNTIL PV-SUB > 13                                    03820012
038300                                                                  03830005
038400         EVALUATE TRUE                                            03840005
038500         WHEN PV-FAST-CHAR (PV-SUB) = ZERO                        03850005
038600         WHEN PV-FAST-CHAR (PV-SUB) NUMERIC                       03860005
038700             MOVE '9'                 TO PV-FAST-CHAR             03870005
038800                                         (PV-SUB)                 03880005
038900         WHEN PV-FAST-CHAR (PV-SUB) = '-'                         03890005
039000             MOVE '-'                 TO PV-FAST-CHAR             03900005
039100                                         (PV-SUB)                 03910005
039200         WHEN PV-FAST-CHAR (PV-SUB) = SPACE OR LOW-VALUE          03920005
039300             MOVE 'B'                 TO PV-FAST-CHAR             03930005
039400                                         (PV-SUB)                 03940005
039500         WHEN OTHER                                               03950005
039600             MOVE 'X'                 TO PV-FAST-CHAR             03960005
039700                                         (PV-SUB)                 03970005
039800             MOVE PC-MUST-BE-NUM-MSG  TO AMSGLNO                  03980005
039900         END-EVALUATE                                             03990005
040000     END-PERFORM.                                                 04000005
040100                                                                  04010005
040200     IF PV-FAST-CHECKER = ZERO                                    04020005
040300        SET PV-VALID-FAST             TO TRUE                     04030005
040400     END-IF                                                       04040005
040500                                                                  04050005
040600     INITIALIZE PC033-FR-STR-NBR                                  04060005
040700                PC033-XFER-SEQ-NBR                                04070005
040800                AMSGLNO                                           04080005
040900     MOVE DP015-UNP-ALP-NOR-MDT       TO AFASTA.                  04090005
041000                                                                  04100007
041100     IF PV-VALID-FAST                                             04110007
041200        EVALUATE TRUE                                             04120007
041300        WHEN PV-FAST-DASH-CHECK-DIG12                             04130007
041400            MOVE '00'                   TO PV-EXPAND-WDASH-2      04140007
041500            MOVE PV-FAST-13 (1:12)      TO PV-EXPAND-WDASH-12     04150011
041600            MOVE PV-EXPAND-TO-13-WDASH  TO PV-FAST-13             04160011
041700        WHEN PV-FAST-DASH-2-SPACE-TRL12                           04170007
041800            MOVE PV-FAST-13 (1:10)      TO PV-EXPAND-WODASH-10    04180011
041900            MOVE 'BBBB'                 TO PV-EXPAND-WODASH-4     04190007
042000            MOVE PV-EXPAND-TO-13-WODASH TO PV-FAST-13             04200011
042100         END-EVALUATE.                                            04210007
042200                                                                  04220005
042300     IF PV-VALID-FAST                                             04230005
042400         EVALUATE TRUE                                            04240005
042500         WHEN PV-FAST-DASH-CHECK-DIGIT                            04250005
042600             MOVE PV-FAST-13 (1:04)   TO PC037-XFER-FROM-STORE-NBR04260012
042700             MOVE PV-FAST-13 (6:06)   TO PC037-XFER-SEQ-NBR       04270012
042800             MOVE PV-FAST-13 (13:1)   TO PV-HOLD-CHECK-DIGIT      04280012
042900         WHEN PV-FAST-DASH-2-SPACE-TRAIL                          04290005
043000             MOVE PV-FAST-13 (1:04)   TO PC037-XFER-FROM-STORE-NBR04300012
043100             MOVE PV-FAST-13 (5:06)   TO PC037-XFER-SEQ-NBR       04310012
043200             MOVE PV-FAST-13 (11:1)   TO PV-HOLD-CHECK-DIGIT      04320012
043300                                                                  04330010
043400             STRING PC037-XFER-FROM-STORE-NBR '-'                 04340010
043500                    PC037-XFER-SEQ-NBR '-'                        04350010
043600                    PV-HOLD-CHECK-DIGIT '-'                       04360010
043700                    DELIMITED BY SIZE                             04370010
043800                                      INTO AFASTO                 04380010
043900         WHEN PV-FAST-DASH-3-SPACE-TRAIL                          04390009
044000             MOVE PV-FAST-13 (1:04)   TO PC037-XFER-FROM-STORE-NBR04400011
044100             MOVE PV-FAST-13 (5:06)   TO PC037-XFER-SEQ-NBR       04410011
044200             MOVE PV-FAST-13 (11:1)   TO PV-HOLD-CHECK-DIGIT      04420011
044300                                                                  04430005
044400             STRING PC037-XFER-FROM-STORE-NBR '-'                 04440005
044500                    PC037-XFER-SEQ-NBR '-'                        04450005
044600                    PV-HOLD-CHECK-DIGIT '-'                       04460005
044700                    DELIMITED BY SIZE                             04470005
044800                                      INTO AFASTO                 04480005
044900         WHEN PV-FAST-DASH-2-SPACE-TRL12                          04490010
045000             MOVE PV-FAST-13 (1:03)   TO PC037-XFER-FROM-STORE-NBR04500011
045100             MOVE PV-FAST-13 (4:06)   TO PC037-XFER-SEQ-NBR       04510011
045200             MOVE PV-FAST-13 (10:1)   TO PV-HOLD-CHECK-DIGIT      04520011
045300                                                                  04530010
045400             STRING PC037-XFER-FROM-STORE-NBR '-'                 04540010
045500                    PC037-XFER-SEQ-NBR '-'                        04550010
045600                    PV-HOLD-CHECK-DIGIT '-'                       04560010
045700                    DELIMITED BY SIZE                             04570010
045800                                      INTO AFASTO                 04580010
045900         WHEN PV-FAST-BLANK-ENTRY                                 04590005
046000         WHEN PV-FAST-ZERO-ENTRY                                  04600005
046100             MOVE ZEROES              TO PC037-XFER-FROM-STORE-NBR04610005
046200                                         PC037-XFER-SEQ-NBR       04620005
046300         END-EVALUATE                                             04630005
046400                                                                  04640010
046500         MOVE PC037-XFER-FROM-STORE-NBR                           04650005
046600                                      TO PC033-FR-STR-NBR         04660005
046700         MOVE PC037-XFER-SEQ-NBR      TO PC033-XFER-SEQ-NBR       04670005
046800         PERFORM P0300-GET-CHK-DIGIT                              04680005
046900         PERFORM 2111-COMPARE-CHECK-DIGITS                        04690005
047000         IF PS-VALID-INPUT                                        04700005
047100             PERFORM 2200-CHECK-TABLES                            04710005
047200         END-IF                                                   04720005
047300     ELSE                                                         04730005
047400         SET PS-INVALID-INPUT         TO TRUE                     04740005
047500         MOVE DP015-UNP-ALP-NOR-MDT   TO AFASTA                   04750005
047600         MOVE -1                      TO AFASTL                   04760005
047700         MOVE PV-FAST-13              TO AFASTO                   04770012
047800         MOVE 'INVALID FAST NBR    '  TO AMSGLNO                  04780005
047900     END-IF.                                                      04790005
048000                                                                  04800005
048100 2111-COMPARE-CHECK-DIGITS.                                       04810005
048200     IF PV-HOLD-CHECK-DIGIT = PC037-FAST-CHECK-DIGIT              04820005
048300         CONTINUE                                                 04830005
048400     ELSE                                                         04840005
048500         SET PS-INVALID-INPUT         TO TRUE                     04850005
048600         MOVE DP015-UNP-ALP-NOR-MDT   TO AFASTA                   04860005
048700         MOVE -1                      TO AFASTL                   04870005
048800         MOVE PV-FAST-13              TO AFASTO                   04880012
048900         MOVE 'INVALID CHECK DIGIT '  TO AMSGLNO                  04890005
049000     END-IF.                                                      04900005
049100                                                                  04910005
049200*  CHECK DIGIT ROUTINE FOR FAST NUMBERS                           04920005
049300     COPY PCPD037.                                                04930005
049400                                                                  04940005
049500 2200-CHECK-TABLES.                                               04950005
049600     MOVE PC037-XFER-FROM-STORE-NBR                               04960005
049700                                      TO DK-FR-STR-NBR            04970005
049800     MOVE PC037-XFER-SEQ-NBR          TO DK-XFER-SEQ-NBR          04980005
049900     PERFORM 7000-SELECT-TTFMSTR                                  04990005
050000     IF PS-TTFMSTR-YES                                            05000005
050100         MOVE PC037-XFER-NBR          TO PV-TRN-NBR               05010005
050200         MOVE PV-TRN-NBR              TO DK-TRN-NBR               05020005
050300         MOVE TFMSTR-TO-STR-NBR       TO PC033-STR-NBR            05030005
050400         MOVE TFMSTR-XFER-DKEY-ID     TO PC033-XFER-DKEY-ID       05040005
050500         PERFORM 2300-GET-CARTON                                  05050005
050600         IF PS-CART-UPC-YES                                       05060005
050700             SET PS-XCTL-E858         TO TRUE                     05070005
050800         ELSE                                                     05080005
050900             SET PS-XCTL-E854         TO TRUE                     05090005
051000         END-IF                                                   05100005
051100     ELSE                                                         05110005
051200         SET PS-XCTL-E857             TO TRUE                     05120005
051300     END-IF.                                                      05130005
051400                                                                  05140005
051500 2300-GET-CARTON.                                                 05150005
051600     PERFORM 7100-OPEN-CARTON-CSR.                                05160005
051700     PERFORM 7110-FETCH-CARTON-CSR.                               05170005
051800     PERFORM 7120-CLOSE-CARTON-CSR.                               05180005
051900/                                                                 05190000
052000 7000-SELECT-TTFMSTR.                                             05200005
052100     EXEC SQL                                                     05210005
052200         SELECT X.XFER_DKEY_ID                                    05220005
052300           ,    X.TO_STR_NBR                                      05230005
052400         INTO :TFMSTR-XFER-DKEY-ID                                05240005
052500           ,  :TFMSTR-TO-STR-NBR                                  05250005
052600         FROM TTFMSTR X                                           05260005
052700         WHERE X.FR_STR_NBR            = :DK-FR-STR-NBR           05270005
052800                 AND  X.XFER_SEQ_NBR   = :DK-XFER-SEQ-NBR         05280005
052900     END-EXEC.                                                    05290005
053000                                                                  05300005
053100     MOVE '7000-SELECT-TTFMSTR'       TO PC033-PARAGRAPH          05310005
053200     EVALUATE TRUE                                                05320005
053300         WHEN SQLCODE = ZERO                                      05330005
053400             SET PS-TTFMSTR-YES       TO TRUE                     05340005
053500         WHEN SQLCODE = +100                                      05350005
053600             SET PS-TTFMSTR-NO        TO TRUE                     05360005
053700             INITIALIZE PC033-SKU-NBR                             05370005
053800                        PC033-XFER-DKEY-ID                        05380005
053900         WHEN SQLCODE = -904                                      05390005
054000         WHEN SQLCODE = -913                                      05400005
054100         WHEN SQLCODE = -911                                      05410005
054200             MOVE 1                   TO PV-ERROR-NBR             05420005
054300             PERFORM 9903-WRITE-CICS-LOG                          05430005
054400             PERFORM 9000-SOFT-ABORT                              05440005
054500         WHEN SQLWARN0 NOT = SPACES                               05450005
054600         WHEN SQLCODE NOT EQUAL ZERO                              05460005
054700             MOVE '7000-SELECT-TTFMSTR'                           05470005
054800                                      TO PC033-PARAGRAPH          05480005
054900             MOVE 'PCKRF853 - CHECK VALID CARTON'                 05490014
055000                                      TO PC033-MESSAGE-TEXT(1)    05500005
055100             MOVE SQLCA               TO PC033-SQLCA              05510005
055200             MOVE 'TTFMSTR'           TO PC033-DB2-TABLE-NAME(1)  05520005
055300             SET PC033-ABEND          TO TRUE                     05530005
055400             MOVE 99                  TO PC033-PGM-MSG-NBR        05540005
055500             PERFORM 8210-XCTL-ERROR-SCREEN                       05550005
055600                                                                  05560005
055700     END-EVALUATE.                                                05570005
055800/                                                                 05580005
055900 7100-OPEN-CARTON-CSR.                                            05590005
056000     MOVE '7110-FETCH-CARTON-CSR'     TO PC033-PARAGRAPH          05600005
056100     EXEC SQL                                                     05610005
056200         OPEN CARTON-CSR                                          05620005
056300     END-EXEC.                                                    05630005
056400                                                                  05640005
056500     EVALUATE TRUE                                                05650005
056600         WHEN SQLCODE = ZERO                                      05660005
056700             CONTINUE                                             05670005
056800         WHEN SQLCODE = -904                                      05680005
056900         WHEN SQLCODE = -913                                      05690005
057000         WHEN SQLCODE = -911                                      05700005
057100             MOVE 2                   TO PV-ERROR-NBR             05710005
057200             PERFORM 9903-WRITE-CICS-LOG                          05720005
057300             PERFORM 9000-SOFT-ABORT                              05730005
057400         WHEN SQLWARN0 NOT = SPACES                               05740005
057500         WHEN SQLCODE NOT EQUAL ZERO                              05750005
057600             MOVE 3                   TO PV-ERROR-NBR             05760005
057700             PERFORM 9903-WRITE-CICS-LOG                          05770005
057800             MOVE '7100-OPEN-CARTON-CSR'                          05780005
057900                                      TO PC033-PARAGRAPH          05790005
058000             MOVE 'PCKRF853 - CHECK FAST NBR UPC'                 05800005
058100                                      TO PC033-MESSAGE-TEXT(1)    05810005
058200             MOVE DK-TRN-NBR          TO PC033-MESSAGE-TEXT(2)    05820005
058300             MOVE SQLCA               TO PC033-SQLCA              05830005
058400             MOVE 'SUT00028'          TO PC033-DB2-TABLE-NAME(1)  05840005
058500             SET PC033-ABEND          TO TRUE                     05850005
058600             MOVE 99                  TO PC033-PGM-MSG-NBR        05860005
058700             PERFORM 8210-XCTL-ERROR-SCREEN                       05870005
058800     END-EVALUATE.                                                05880005
058900                                                                  05890005
059000 7110-FETCH-CARTON-CSR.                                           05900005
059100     MOVE '7110-FETCH-CARTON-CSR'     TO PC033-PARAGRAPH          05910005
059200     EXEC SQL                                                     05920005
059300         FETCH CARTON-CSR                                         05930005
059400         INTO :SUT00028-SHIPT-UNT-ID                              05940005
059500     END-EXEC.                                                    05950005
059600                                                                  05960005
059700     EVALUATE TRUE                                                05970005
059800         WHEN SQLCODE = ZERO                                      05980005
059900             MOVE SUT00028-SHIPT-UNT-ID                           05990005
060000                                      TO PC033-CARTON             06000005
060100                                         PC033-FIRST-CARTON       06010005
060200             SET PS-CART-UPC-YES      TO TRUE                     06020005
060300         WHEN SQLCODE = +100                                      06030005
060400             SET PS-CART-UPC-NO       TO TRUE                     06040005
060500         WHEN SQLCODE = -904                                      06050005
060600         WHEN SQLCODE = -913                                      06060005
060700         WHEN SQLCODE = -911                                      06070005
060800             MOVE 2                   TO PV-ERROR-NBR             06080005
060900             PERFORM 9903-WRITE-CICS-LOG                          06090005
061000             PERFORM 9000-SOFT-ABORT                              06100005
061100         WHEN SQLWARN0 NOT = SPACES                               06110005
061200         WHEN SQLCODE NOT EQUAL ZERO                              06120005
061300             MOVE 3                   TO PV-ERROR-NBR             06130005
061400             PERFORM 9903-WRITE-CICS-LOG                          06140005
061500             MOVE '7110-FETCH-CARTON-CSR'                         06150005
061600                                      TO PC033-PARAGRAPH          06160005
061700             MOVE 'PCKRF853 - CHECK FAST NBR UPC'                 06170005
061800                                      TO PC033-MESSAGE-TEXT(1)    06180005
061900             MOVE DK-TRN-NBR          TO PC033-MESSAGE-TEXT(2)    06190005
062000             MOVE SQLCA               TO PC033-SQLCA              06200005
062100             MOVE 'SUT00028'          TO PC033-DB2-TABLE-NAME(1)  06210005
062200             SET PC033-ABEND          TO TRUE                     06220005
062300             MOVE 99                  TO PC033-PGM-MSG-NBR        06230005
062400             PERFORM 8210-XCTL-ERROR-SCREEN                       06240005
062500     END-EVALUATE.                                                06250005
062600                                                                  06260005
062700 7120-CLOSE-CARTON-CSR.                                           06270005
062800     MOVE '7120-CLOSE-CARTON-CSR'     TO PC033-PARAGRAPH          06280005
062900     EXEC SQL                                                     06290005
063000         CLOSE CARTON-CSR                                         06300005
063100     END-EXEC.                                                    06310005
063200                                                                  06320005
063300     EVALUATE TRUE                                                06330005
063400         WHEN SQLCODE = ZERO                                      06340005
063500             CONTINUE                                             06350005
063600         WHEN SQLCODE = -904                                      06360005
063700         WHEN SQLCODE = -913                                      06370005
063800         WHEN SQLCODE = -911                                      06380005
063900             MOVE 2                   TO PV-ERROR-NBR             06390005
064000             PERFORM 9903-WRITE-CICS-LOG                          06400005
064100             PERFORM 9000-SOFT-ABORT                              06410005
064200         WHEN SQLWARN0 NOT = SPACES                               06420005
064300         WHEN SQLCODE NOT EQUAL ZERO                              06430005
064400             MOVE 3                   TO PV-ERROR-NBR             06440005
064500             PERFORM 9903-WRITE-CICS-LOG                          06450005
064600             MOVE '7120-CLOSE-CARTON-CSR'                         06460005
064700                                      TO PC033-PARAGRAPH          06470005
064800             MOVE 'PCKRF853 - CHECK FAST NBR UPC'                 06480005
064900                                      TO PC033-MESSAGE-TEXT(1)    06490005
065000             MOVE DK-TRN-NBR          TO PC033-MESSAGE-TEXT(2)    06500005
065100             MOVE SQLCA               TO PC033-SQLCA              06510005
065200             MOVE 'SUT00028'          TO PC033-DB2-TABLE-NAME(1)  06520005
065300             SET PC033-ABEND          TO TRUE                     06530005
065400             MOVE 99                  TO PC033-PGM-MSG-NBR        06540005
065500             PERFORM 8210-XCTL-ERROR-SCREEN                       06550005
065600     END-EVALUATE.                                                06560005
065700/                                                                 06570005
065800 8000-SEND-MAP.                                                   06580005
065900                                                                  06590005
066000     EXEC CICS                                                    06600005
066100         SEND MAP       ('PC853A')                                06610005
066200              MAPSET    ('PCKM853')                               06620005
066300              ERASE                                               06630005
066400              CURSOR                                              06640005
066500              RESP      (PV-CICS-RESPONSE)                        06650005
066600     END-EXEC.                                                    06660005
066700                                                                  06670005
066800     EVALUATE TRUE                                                06680005
066900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06690005
067000             CONTINUE                                             06700005
067100         WHEN OTHER                                               06710005
067200             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          06720005
067300             MOVE 'PCKRF853 - UNABLE TO SEND MAP'                 06730005
067400                                      TO DP013-MESSAGE-TEXT (1)   06740005
067500             SET DP013-CICS-ABEND                                 06750005
067600                 DP013-ROLLBACK       TO TRUE                     06760005
067700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06770005
067800     END-EVALUATE.                                                06780005
067900                                                                  06790005
068000 8010-SEND-DATA-ONLY.                                             06800005
068100                                                                  06810005
068200     MOVE -1                          TO AFASTL                   06820005
068300     EXEC CICS                                                    06830005
068400         SEND MAP       ('PC853A')                                06840005
068500              MAPSET    ('PCKM853')                               06850005
068600              CURSOR                                              06860005
068700              DATAONLY                                            06870005
068800              RESP      (PV-CICS-RESPONSE)                        06880005
068900     END-EXEC.                                                    06890005
069000                                                                  06900005
069100     EVALUATE TRUE                                                06910005
069200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06920005
069300             CONTINUE                                             06930005
069400         WHEN OTHER                                               06940005
069500             MOVE '8010-SEND-DATA-ONLY'                           06950005
069600                                      TO DP013-PARAGRAPH          06960005
069700             MOVE 'PCKRF853 - UNABLE TO SEND DATA'                06970005
069800                                      TO DP013-MESSAGE-TEXT (1)   06980005
069900             SET DP013-CICS-ABEND                                 06990005
070000                 DP013-ROLLBACK       TO TRUE                     07000005
070100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07010005
070200     END-EVALUATE.                                                07020005
070300                                                                  07030005
070400 8020-RECEIVE-MAP.                                                07040005
070500                                                                  07050005
070600     EXEC CICS                                                    07060005
070700         RECEIVE MAP    ('PC853A')                                07070005
070800                 MAPSET ('PCKM853')                               07080005
070900                 RESP   (PV-CICS-RESPONSE)                        07090005
071000     END-EXEC.                                                    07100005
071100                                                                  07110005
071200     EVALUATE TRUE                                                07120005
071300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07130005
071400             CONTINUE                                             07140005
071500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                07150005
071600             CONTINUE                                             07160005
071700         WHEN OTHER                                               07170005
071800            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          07180005
071900            MOVE 'PCKRF853 - UNABLE TO RECEIVE MAP'               07190005
072000                                      TO DP013-MESSAGE-TEXT (1)   07200005
072100            SET DP013-LOGIC-ABEND     TO TRUE                     07210005
072200            SET DP013-ROLLBACK        TO TRUE                     07220005
072300            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                07230005
072400     END-EVALUATE.                                                07240005
072500                                                                  07250005
072600 8100-RETURN-TRANID.                                              07260005
072700                                                                  07270005
072800     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       07280005
072900     EXEC CICS                                                    07290005
073000         RETURN TRANSID  (PC-TRANID)                              07300005
073100                COMMAREA (CA-COMMAREA)                            07310005
073200                LENGTH   (PV-COMMAREA-LENGTH)                     07320005
073300                RESP     (PV-CICS-RESPONSE)                       07330005
073400     END-EXEC.                                                    07340005
073500                                                                  07350005
073600     EVALUATE TRUE                                                07360005
073700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07370005
073800             CONTINUE                                             07380005
073900         WHEN OTHER                                               07390005
074000             MOVE '8100-RETURN-TRANIND'                           07400005
074100                                      TO DP013-PARAGRAPH          07410005
074200             MOVE 'PCKRF853 - UNABLE TO RETURN TO TRANID'         07420005
074300                                      TO DP013-MESSAGE-TEXT (1)   07430005
074400             SET DP013-CICS-ABEND     TO TRUE                     07440005
074500             SET DP013-ROLLBACK       TO TRUE                     07450005
074600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07460005
074700     END-EVALUATE.                                                07470005
074800                                                                  07480005
074900 8110-RETURN.                                                     07490005
075000                                                                  07500005
075100     EXEC CICS                                                    07510005
075200         SEND FROM (PV-MESSAGE-AREA)                              07520005
075300              LENGTH (19)                                         07530005
075400              ERASE                                               07540005
075500     END-EXEC.                                                    07550005
075600                                                                  07560005
075700     EXEC CICS                                                    07570005
075800         RETURN                                                   07580005
075900     END-EXEC.                                                    07590005
076000                                                                  07600005
076100 8200-XCTL.                                                       07610005
076200     SET PC033-INITIALIZE-SCREEN      TO TRUE.                    07620005
076300     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      07630005
076400     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       07640005
076500                                                                  07650005
076600     EXEC CICS                                                    07660005
076700         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    07670005
076800               COMMAREA  (CA-COMMAREA)                            07680005
076900               LENGTH    (PV-COMMAREA-LENGTH)                     07690005
077000               RESP      (PV-CICS-RESPONSE)                       07700005
077100     END-EXEC.                                                    07710005
077200                                                                  07720005
077300     EVALUATE TRUE                                                07730005
077400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07740005
077500             CONTINUE                                             07750005
077600         WHEN OTHER                                               07760005
077700             MOVE '8200-XCTL'         TO DP013-PARAGRAPH          07770005
077800             MOVE 'PCKRF853 - UNABLE TO XCTL TO PROGRAM: '        07780005
077900                                      TO DP013-MESSAGE-TEXT (1)   07790005
078000             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   07800005
078100             SET DP013-CICS-ABEND                                 07810005
078200                 DP013-ROLLBACK       TO TRUE                     07820005
078300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07830005
078400             MOVE PC-TRANS-UNAVAILABLE-MSG                        07840005
078500                                      TO AMSGLNO                  07850005
078600             MOVE -1                  TO AFASTL                   07860005
078700             SET PC033-PROCESS-SCREEN TO TRUE                     07870005
078800             MOVE -1                  TO AFASTL                   07880005
078900             PERFORM 8000-SEND-MAP                                07890005
079000             PERFORM 8100-RETURN-TRANID                           07900005
079100     END-EVALUATE.                                                07910005
079200                                                                  07920005
079300 8210-XCTL-ERROR-SCREEN.                                          07930005
079400     IF NOT PC033-ABEND                                           07940005
079500         SET PC033-INITIALIZE-SCREEN  TO TRUE                     07950005
079600     END-IF                                                       07960005
079700     IF PC033-PGM-MSG-NBR = ZERO                                  07970005
079800         MOVE 3                       TO PC033-PGM-MSG-NBR        07980005
079900     END-IF                                                       07990005
080000                                                                  08000005
080100     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      08010005
080200     MOVE DFHEIBLK                    TO PC033-DFHEIBLK.          08020005
080300     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       08030005
080400     MOVE 'PCKRF852'                  TO PV-TRANSFER-PROGRAM      08040005
080500                                                                  08050005
080600     EXEC CICS                                                    08060005
080700         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    08070005
080800               COMMAREA  (CA-COMMAREA)                            08080005
080900               LENGTH    (PV-COMMAREA-LENGTH)                     08090005
081000               RESP      (PV-CICS-RESPONSE)                       08100005
081100     END-EXEC.                                                    08110005
081200                                                                  08120005
081300     EVALUATE TRUE                                                08130005
081400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08140005
081500             CONTINUE                                             08150005
081600         WHEN OTHER                                               08160005
081700             MOVE '8200-XCTL'                                     08170005
081800                                      TO DP013-PARAGRAPH          08180005
081900             MOVE 'PCKRF853 - UNABLE TO XCTL TO PROGRAM: '        08190005
082000                                      TO DP013-MESSAGE-TEXT (1)   08200005
082100             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08210005
082200             SET DP013-CICS-ABEND                                 08220005
082300                 DP013-ROLLBACK       TO TRUE                     08230005
082400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08240005
082500             MOVE PC-TRANS-UNAVAILABLE-MSG                        08250005
082600                                      TO AMSGLNO                  08260005
082700             SET PC033-PROCESS-SCREEN TO TRUE                     08270005
082800             MOVE -1                  TO AFASTL                   08280005
082900             PERFORM 8000-SEND-MAP                                08290005
083000             PERFORM 8100-RETURN-TRANID                           08300005
083100     END-EVALUATE.                                                08310005
083200                                                                  08320005
083300*                                                                 08330005
083400 8220-XCTL-TO-HELP.                                               08340005
083500                                                                  08350005
083600     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       08360005
083700                                                                  08370005
083800     EXEC CICS                                                    08380005
083900         XCTL                                                     08390005
084000             PROGRAM   (PV-TRANSFER-PROGRAM)                      08400005
084100             COMMAREA  (PC192-COMMAREA)                           08410005
084200             LENGTH    (PV-COMMAREA-LENGTH)                       08420005
084300             RESP      (PV-CICS-RESPONSE)                         08430005
084400     END-EXEC.                                                    08440005
084500                                                                  08450005
084600     EVALUATE TRUE                                                08460005
084700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08470005
084800              CONTINUE                                            08480005
084900         WHEN OTHER                                               08490005
085000             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          08500005
085100             MOVE 'PCKRF853 - UNABLE TO XCTL TO PROGRAM: '        08510005
085200                                      TO DP013-MESSAGE-TEXT (1)   08520005
085300             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08530005
085400             SET DP013-CICS-ABEND                                 08540005
085500                 DP013-ROLLBACK       TO TRUE                     08550005
085600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08560005
085700             MOVE PC-TRANS-UNAVAILABLE-MSG                        08570005
085800                                      TO AMSGLNO                  08580005
085900             SET PC033-PROCESS-SCREEN TO TRUE                     08590005
086000             MOVE -1                  TO AFASTL                   08600005
086100             PERFORM 8000-SEND-MAP                                08610005
086200             PERFORM 8100-RETURN-TRANID                           08620005
086300     END-EVALUATE.                                                08630005
086400*                                                                 08640005
086500 8230-XCTL-TO-E854.                                               08650005
086600                                                                  08660005
086700     SET PC033-INITIALIZE-SCREEN      TO TRUE.                    08670005
086800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC033-LAST-PROGRAM.      08680005
086900     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       08690005
087000     MOVE 'PCKRF854'                  TO PV-TRANSFER-PROGRAM      08700005
087100                                                                  08710005
087200     EXEC CICS                                                    08720005
087300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    08730005
087400               COMMAREA  (CA-COMMAREA)                            08740005
087500               LENGTH    (PV-COMMAREA-LENGTH)                     08750005
087600               RESP      (PV-CICS-RESPONSE)                       08760005
087700     END-EXEC.                                                    08770005
087800                                                                  08780005
087900     EVALUATE TRUE                                                08790005
088000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08800005
088100             CONTINUE                                             08810005
088200         WHEN OTHER                                               08820005
088300             MOVE '8230-XCTL-TO-E854'                             08830005
088400                                      TO DP013-PARAGRAPH          08840005
088500             MOVE 'PCKRF853 - UNABLE TO XCTL TO PROGRAM: '        08850005
088600                                      TO DP013-MESSAGE-TEXT (1)   08860005
088700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   08870005
088800             SET DP013-CICS-ABEND                                 08880005
088900                 DP013-ROLLBACK       TO TRUE                     08890005
089000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08900005
089100             MOVE PC-TRANS-UNAVAILABLE-MSG                        08910005
089200                                      TO AMSGLNO                  08920005
089300             MOVE -1                  TO AFASTL                   08930005
089400             SET PC033-PROCESS-SCREEN TO TRUE                     08940005
089500             PERFORM 8000-SEND-MAP                                08950005
089600             PERFORM 8100-RETURN-TRANID                           08960005
089700     END-EVALUATE.                                                08970005
089800/                                                                 08980005
089900 9000-SOFT-ABORT.                                                 08990005
090000                                                                  09000005
090100     EXEC CICS                                                    09010005
090200         SYNCPOINT ROLLBACK                                       09020005
090300     END-EXEC                                                     09030005
090400                                                                  09040005
090500     MOVE 4                           TO PC033-PGM-MSG-NBR        09050005
090600     MOVE SQLCODE                     TO PC033-SQLCODE            09060005
090700     PERFORM 8210-XCTL-ERROR-SCREEN.                              09070005
090800                                                                  09080005
090900 9903-WRITE-CICS-LOG.                                             09090005
091000                                                                  09100005
091100     MOVE SQLCODE                     TO PV-SQLCODE               09110005
091200     STRING PC033-FR-STR-NBR '-'                                  09120005
091300            PC033-XFER-SEQ-NBR '-'                                09130005
091400            PC037-FAST-CHECK-DIGIT DELIMITED BY SIZE              09140005
091500                                      INTO PV-DISPLAY-FAST        09150005
091600     MOVE PC033-PO-NBR                TO PV-DISPLAY-PO            09160005
091700     MOVE PC033-RCVR-SEQ-NBR          TO PV-DISPLAY-RCVR          09170005
091800     MOVE PC033-PO-LINE-NBR           TO PV-DISPLAY-PO-LNE-NBR    09180005
091900     MOVE PC033-STR-NBR               TO PV-DISPLAY-STORE         09190005
092000                                                                  09200005
092100     EXEC CICS                                                    09210005
092200         WRITEQ TD                                                09220005
092300             QUEUE  ('CSSL')                                      09230005
092400             FROM   (PV-LOG-MSG)                                  09240005
092500             RESP   (PV-CICS-RESPONSE)                            09250005
092600     END-EXEC.                                                    09260005
092700                                                                  09270005
092800 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  09280005
092900                                                                  09290005
093000     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           09300005
093100     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          09310005
093200     INITIALIZE DP013-SRC-TASK-NUMBER                             09320005
093300                DP013-STACK.                                      09330005
093400     SET DP013-LINK-RETURN            TO TRUE.                    09340005
093500                                                                  09350005
093600     EXEC CICS                                                    09360005
093700         LINK                                                     09370005
093800             PROGRAM   (DP013-NAME)                               09380005
093900             COMMAREA  (DP013-PARAMETERS)                         09390005
094000             LENGTH    (DP013-LENGTH)                             09400005
094100     END-EXEC.                                                    09410005
094200                                                                  09420005
094300*----------------------------------------------------------------*09430005
094400*    ABEND PROCESSOR MODULE                                      *09440005
094500*----------------------------------------------------------------*09450005
094600                                                                  09460005
094700*    COPY DPPD014.                                                09470005
094800                                                                  09480005
