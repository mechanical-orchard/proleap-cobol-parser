000100*************************                                         00010044
000200 IDENTIFICATION DIVISION.                                         00020044
000300*************************                                         00030044
000400 PROGRAM-ID.      APKUT028.                                       00040044
000500 AUTHOR.          DARYL WOELFEL.                                  00050044
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060044
000700 DATE-WRITTEN.    06/12/96.                                       00070044
000800 DATE-COMPILED.                                                   00080044
000900****************************************************************  00090044
001000* COBOL 2 WITH SQL                                                00100044
001100*                                                                 00110044
001200* SUMMARIZE AND REFORMAT RECONCILIATION RESULTS                   00120048
001300*                                                                 00130048
001400* THIS PROGRAM WILL SUMMARIZE AND REFORMAT RECONCILIATION         00140044
001500* RESULTS INFORMATION IN A SUMMARIZED FORMAT THAT WILL BE EASY    00150044
001600* FOR THE BUYERS TO REVIEW.  THE REPORT INITIALLY WILL BE         00160044
001700* PRODUCED ON A WEEKLY BASIS FROM DATA PRODUCED OUT OF THE        00170044
001800* DAILY RECONCILIATION PROCESS.                                   00180044
001900****************************************************************  00190044
002000*   INPUT:                                                        00200048
002100*                                                                 00210048
002200*  1) RESULTS-INVOICE-FILE              (APRD263)                 00220048
002300*                                                                 00230048
002400*   OUTPUT:                                                       00240048
002500*                                                                 00250048
002600*  1) RECON-RESULTS-SUMMARY-FILE        (APRD269)                 00260048
002700*                                                                 00270048
002800****************************************************************  00280048
002900* CHANGE LOG:                                                     00290045
003000*                                                                 00300045
003100*   06/17/2002                                                    00310045
003200*     ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.         00320045
003300*   MADE BY: KEVIN CATLIN                WR#: 23500               00330045
003400*                                                                 00340045
003500*   06/20/2002                                                    00350047
003600*     ARK PO PROJECT PHASE 1.  REMOVED ALL REFERENCES TO          00360046
003700*     TABLE TPAYREQ.                                              00370046
003800*   MADE BY: KEVIN CATLIN                WR#: 23500               00380046
003900*                                                                 00390046
004000* 02/06/2003                                                      00400048
004100*    CHANGE MADE: ARKPO PHASE3 PROJECT.                           00410048
004200*    ADDED THE PROGRAM TITLE TO MATCH THE SPEC TITLE. ADDED       00420048
004300*    THE FILENAMES TO THE PROGRAM COMMENT BLOCK. INCREASED        00430048
004400*    THE SIZE OF W/S PURCHASE-ORDER TO 9 BYTES & RENAMED IT       00440048
004500*    TO PO-NBR TO FOLLOW THE NAMING STANDARDS FROM THE            00450048
004600*    COPYBOOKS.                                                   00460048
004700* MADE BY:  MIKE BESKE                          WR#: 23500  *     00470048
      *                                                                 00470149
004000* 03/11/2007                                                      00471049
004100*    CHANGE MADE: MDC PROJECT. RECOMPILE                          00472049
004700* MADE BY:  GREG WISIALOWSKI                    WR#: 21578  *     00478049
004800****************************************************************  00480048
004900*                                                                 00490046
005000 ENVIRONMENT DIVISION.                                            00500044
005100*                                                                 00510044
005200 CONFIGURATION SECTION.                                           00520044
005300 SOURCE-COMPUTER. IBM-3090.                                       00530044
005400 OBJECT-COMPUTER. IBM-3090.                                       00540044
005500*                                                                 00550044
005600 INPUT-OUTPUT SECTION.                                            00560044
005700 FILE-CONTROL.                                                    00570044
005800     SELECT RESULTS-INVOICE-FILE       ASSIGN TO UT-S-INP01.      00580044
005900     SELECT RECON-RESULTS-SUMMARY-FILE ASSIGN TO UT-S-OUT01.      00590044
006000*                                                                 00600044
006100 DATA DIVISION.                                                   00610044
006200*                                                                 00620044
006300 FILE SECTION.                                                    00630044
006400*                                                                 00640044
006500 FD  RESULTS-INVOICE-FILE                                         00650044
006600     RECORDING MODE IS F                                          00660044
006700     LABEL RECORDS ARE STANDARD                                   00670044
006800     BLOCK CONTAINS 0 RECORDS                                     00680044
006900     DATA RECORD IS RESULTS-INVOICE-RECORD.                       00690044
007000 01  RESULTS-INVOICE-RECORD.                                      00700044
007100     05  RESULTS-INVOICE-KEY          PIC  X(30).                 00710044
007200     05  FILLER                       PIC  X(90).                 00720044
007300*                                                                 00730044
007400 FD  RECON-RESULTS-SUMMARY-FILE                                   00740044
007500     RECORDING MODE F                                             00750044
007600     LABEL RECORDS ARE STANDARD                                   00760044
007700     BLOCK CONTAINS 0 RECORDS                                     00770044
007800     DATA RECORD IS RECON-RESULTS-SUMM-RECS.                      00780044
007900 01  RECON-RESULTS-SUMM-RECS          PIC X(275).                 00790044
008000*                                                                 00800044
008100 EJECT                                                            00810044
008200*                                                                 00820044
008300 WORKING-STORAGE SECTION.                                         00830044
008400*                                                                 00840044
008500 01  PV-PROGRAM-VARIABLES.                                        00850044
008600                                                                  00860044
008700     05  WS-GROSS-INVOICE-AMT         PIC 9(11)V99   VALUE 0      00870044
008800                                                     COMP-3.      00880044
008900     05  WS-RECVR-AMT                 PIC 9(11)V99   VALUE 0      00890044
009000                                                     COMP-3.      00900044
009100     05  WS-TR-CDE-12-COST            PIC 9(11)V99   VALUE 0      00910044
009200                                                     COMP-3.      00920044
009300     05  WS-TR-CDE-76-COST            PIC 9(11)V99   VALUE 0      00930044
009400                                                     COMP-3.      00940044
009500     05  WS-TR-CDE-10-COST            PIC 9(11)V99   VALUE 0      00950044
009600                                                     COMP-3.      00960044
009700     05  WS-TR-CDE-16-COST            PIC 9(11)V99   VALUE 0      00970044
009800                                                     COMP-3.      00980044
009900     05  WS-TR-CDE-36-COST            PIC 9(11)V99   VALUE 0      00990044
010000                                                     COMP-3.      01000044
010100     05  WS-TR-CDE-37-COST            PIC 9(11)V99   VALUE 0      01010044
010200                                                     COMP-3.      01020044
010300     05  WS-OPEN-OVER-COST            PIC S9(11)V999  VALUE 0     01030044
010400                                                     COMP-3.      01040044
010500     05  WS-RETRY-COUNTER             PIC 9(02)      VALUE 0.     01050044
010600     05  PV-PREV-PO-NBR               PIC 9(09)      VALUE 0.     01060048
010700*                                                                 01070044
010800 01  PS-PROGRAM-SWITCHES.                                         01080044
010900     05  PS-EOC-INVOIC-CSR            PIC X(01)      VALUE 'N'.   01090044
011000         88  EOC-INVOIC-CSR                          VALUE 'Y'.   01100044
011100         88  NOT-EOC-INVOIC-CSR                      VALUE 'N'.   01110044
011200     05  PS-INVOICE-EOF               PIC X(01)      VALUE 'N'.   01120044
011300         88  INVOICE-EOF                             VALUE 'Y'.   01130044
011400     05  NINREC-NULL-IND              PIC S9(04)     VALUE +0     01140044
011500                                                      COMP.       01150044
011600*                                                                 01160044
011700 01  ABEND-CODE                       PIC S9(04)  VALUE ZEROS     01170044
011800                                                     COMP SYNC.   01180044
011900     88  AC-BAD-DATA                                 VALUE +4003. 01190044
012000     88  AC-DB2-ERROR                                VALUE +4013. 01200044
012100*                                                                 01210044
012200 01  ABEND-AREAS.                                                 01220044
012300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01230044
012400             '*****       ABEND'.                                 01240044
012500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01250044
012600             '*****   PROGRAM: APKUT028'.                         01260044
012700     05  AA-PARAGRAPH-LIT.                                        01270044
012800         10  FILLER              PIC  X(17)  VALUE                01280044
012900             '***** PARAGRAPH: '.                                 01290044
013000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01300044
013100     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01310044
013200             '*****    DB2 ERROR'.                                01320044
013300     05  AA-DB2-OPERATION-LIT.                                    01330044
013400         10  FILLER              PIC  X(17)  VALUE                01340044
013500             '***** OPERATION: '.                                 01350044
013600         10  AA-DB2-OPERATION.                                    01360044
013700             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01370044
013800             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01380044
013900     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01390044
014000     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01400044
014100*                                                                 01410044
014200     COPY DPWS004.                                                01420044
014300*                                                                 01430044
014400* RECONCILIATION RESULTS FILE LAYOUT                              01440044
014500     COPY APRD263.                                                01450044
014600*                                                                 01460044
014700* SUMMARIZED RECONCILIATION RESULTS FILE LAYOUT                   01470044
014800     COPY APRD269.                                                01480044
014900*                                                                 01490044
015000* INVOICE TABLE                                                   01500044
015100     EXEC SQL                                                     01510044
015200         INCLUDE TINVOIC                                          01520044
015300     END-EXEC.                                                    01530044
015400 EJECT                                                            01540044
015500* NON-INVOICE RECORD TABLE                                        01550044
015600     EXEC SQL                                                     01560044
015700         INCLUDE TNINREC                                          01570044
015800     END-EXEC.                                                    01580044
015900 EJECT                                                            01590044
016000* DEPT ACCESS TABLE                                               01600044
016100     EXEC SQL                                                     01610044
016200         INCLUDE TMDSEAR                                          01620044
016300     END-EXEC.                                                    01630044
016400 EJECT                                                            01640044
016500* RESPONSIBILITY TABLE                                            01650044
016600     EXEC SQL                                                     01660044
016700         INCLUDE TRSPBAR                                          01670044
016800     END-EXEC.                                                    01680044
016900 EJECT                                                            01690044
017000* DB2 COMMUNICATION AREA                                          01700044
017100*                                                                 01710044
017200     EXEC SQL                                                     01720044
017300         INCLUDE SQLCA                                            01730044
017400     END-EXEC.                                                    01740044
017500 EJECT                                                            01750044
017600* DB2 COMMUNICATION AREA2                                         01760044
017700*                                                                 01770044
017800     COPY SQLCA2.                                                 01780044
017900 EJECT                                                            01790044
018000******************************************************************01800044
018100*  INVOICE CURSOR SELECTS THE INVOICE TYPE CODE AND SUMS THE      01810044
018200*  GROSS COST AMOUNT FROM TINVOIC FOR THE PO BEING PROCESSED.     01820046
018300******************************************************************01830044
018400     EXEC SQL                                                     01840044
018500       DECLARE INVOIC_CSR CURSOR FOR                              01850044
018600         SELECT                                                   01860044
018700                INVC_TYP_CDE                                      01870046
018800              , SUM(GRO_COST_AMT)                                 01880046
018900         FROM                                                     01890044
019000             TINVOIC                                              01900046
019100         WHERE PO_NBR        = :INVOIC-PO-NBR                     01910046
019200           AND STATUS_CDE   IN ('EN', 'RC', 'IB', 'OB')           01920046
019300           AND INVC_TYP_CDE IN ('MI', 'RI')                       01930046
019400         GROUP BY INVC_TYP_CDE                                    01940046
019500     END-EXEC.                                                    01950044
019600 EJECT                                                            01960044
019700*                                                                 01970044
019800****************************************************************  01980044
019900 PROCEDURE DIVISION.                                              01990044
020000****************************************************************  02000044
020100 A000-PROGRAM-MAINLINE.                                           02010044
020200                                                                  02020044
020300     PERFORM A100-INITIALIZATION.                                 02030044
020400                                                                  02040044
020500     PERFORM A200-PROCESS-INVOICE-FILE                            02050044
020600         UNTIL INVOICE-EOF.                                       02060044
020700                                                                  02070044
020800     PERFORM A300-END-ROUTINE.                                    02080044
020900                                                                  02090044
021000     GOBACK.                                                      02100044
021100                                                                  02110044
021200 EJECT                                                            02120044
021300*                                                                 02130044
021400****************************************************************  02140044
021500*  A100-INITIALIZATION  OPEN FILES, INITIALIZE THE NECESSARY      02150044
021600*  FIELDS, AND PROCESS THE VENDOR RECORD FOR THE FIRST PO.        02160044
021700****************************************************************  02170044
021800 A100-INITIALIZATION.                                             02180044
021900                                                                  02190044
022000     OPEN  INPUT RESULTS-INVOICE-FILE                             02200044
022100          OUTPUT RECON-RESULTS-SUMMARY-FILE.                      02210044
022200                                                                  02220044
022300     INITIALIZE AP263-RECORD                                      02230044
022400                AP269-RECORD.                                     02240044
022500                                                                  02250044
022600     PERFORM R100-READ-INVOICE-FILE.                              02260044
022700                                                                  02270044
022800     PERFORM B200-PROCESS-VENDOR-REC.                             02280044
022900*                                                                 02290044
023000****************************************************************  02300044
023100*  A200-PROCESS-INVOICE-FILE   THIS MODULE CONTROLS THE MAIN      02310044
023200*  FLOW OF THE PROGRAM.  PROCESS VENDOR RECORDS, ACCUMULATE       02320044
023300*  COSTS FOR OTHER RECORD TYPES.                                  02330044
023400****************************************************************  02340044
023500*                                                                 02350044
023600 A200-PROCESS-INVOICE-FILE.                                       02360044
023700                                                                  02370044
023800     IF VENDOR-RECORD                                             02380044
023900         IF AP263-PO-NBR NOT = PV-PREV-PO-NBR                     02390048
024000             PERFORM B100-CALCULATE-TOTALS                        02400044
024100             PERFORM W100-WRITE-OUTPUT-REC                        02410044
024200             PERFORM B200-PROCESS-VENDOR-REC                      02420044
024300         END-IF                                                   02430044
024400     ELSE                                                         02440044
024500         PERFORM B300-ACCUM-COSTS                                 02450044
024600     END-IF.                                                      02460044
024700                                                                  02470044
024800     PERFORM R100-READ-INVOICE-FILE.                              02480044
024900*                                                                 02490044
025000***************************************************************** 02500044
025100*  A300-END-ROUTINE   WRITE TOTALS FOR LAST PO AND CLOSE FILES.   02510044
025200***************************************************************** 02520044
025300*                                                                 02530044
025400 A300-END-ROUTINE.                                                02540044
025500                                                                  02550044
025600     PERFORM B100-CALCULATE-TOTALS                                02560044
025700     PERFORM W100-WRITE-OUTPUT-REC                                02570044
025800                                                                  02580044
025900     CLOSE RESULTS-INVOICE-FILE                                   02590044
026000           RECON-RESULTS-SUMMARY-FILE.                            02600044
026100 EJECT                                                            02610044
026200*                                                                 02620044
026300****************************************************************  02630044
026400*  B100-CALCULATE-TOTALS  CALCULATE AND MOVE OUT TOTAL COSTS.     02640044
026500****************************************************************  02650044
026600*                                                                 02660044
026700 B100-CALCULATE-TOTALS.                                           02670044
026800*                                                                 02680044
026900*    USE GROSS AMOUNTS.  COMMENTED CODE WAS FOR NET AMOUNTS.      02690044
027000*                                                                 02700044
027100     MOVE WS-GROSS-INVOICE-AMT TO AP269-PAID-INVC-COST.           02710044
027200*    COMPUTE AP269-PAID-INVC-COST =                               02720044
027300*                WS-GROSS-INVOICE-AMT                             02730044
027400*              - WS-TR-CDE-12-COST                                02740044
027500*              - WS-TR-CDE-10-COST                                02750044
027600*              + WS-TR-CDE-16-COST.                               02760044
027700                                                                  02770044
027800     MOVE WS-RECVR-AMT        TO AP269-JRNLD-RCV-COST.            02780044
027900*    COMPUTE AP269-JRNLD-RCV-COST =                               02790044
028000*                WS-RECVR-AMT                                     02800044
028100*              - WS-TR-CDE-76-COST                                02810044
028200*              - WS-TR-CDE-36-COST                                02820044
028300*              + WS-TR-CDE-37-COST.                               02830044
028400                                                                  02840044
028500     MOVE WS-TR-CDE-12-COST   TO AP269-TR-CDE-12-COST.            02850044
028600     MOVE WS-TR-CDE-76-COST   TO AP269-TR-CDE-76-COST.            02860044
028700     MOVE WS-TR-CDE-10-COST   TO AP269-TR-CDE-10-COST.            02870044
028800     MOVE WS-TR-CDE-16-COST   TO AP269-TR-CDE-16-COST.            02880044
028900     MOVE WS-TR-CDE-36-COST   TO AP269-TR-CDE-36-COST.            02890044
029000     MOVE WS-TR-CDE-37-COST   TO AP269-TR-CDE-37-COST.            02900044
029100                                                                  02910044
029200     MOVE ZEROS               TO WS-GROSS-INVOICE-AMT             02920044
029300                                 WS-RECVR-AMT                     02930044
029400                                 WS-TR-CDE-12-COST                02940044
029500                                 WS-TR-CDE-76-COST                02950044
029600                                 WS-TR-CDE-10-COST                02960044
029700                                 WS-TR-CDE-16-COST                02970044
029800                                 WS-TR-CDE-36-COST                02980044
029900                                 WS-TR-CDE-37-COST.               02990044
030000 EJECT                                                            03000044
030100****************************************************************  03010044
030200*  B200-PROCESS-VENDOR-REC  MOVE OUT VENDOR/DEPT/PO, PERFORM      03020044
030300*  SQL PROCESSING.                                                03030044
030400****************************************************************  03040044
030500*                                                                 03050044
030600 B200-PROCESS-VENDOR-REC.                                         03060044
030700                                                                  03070044
030800     MOVE AP263-VENDOR-NBR     TO AP269-VENDOR-NBR.               03080044
030900     MOVE AP263-VENDOR-NAME    TO AP269-VENDOR-NAME.              03090044
031000     MOVE AP263-DEPT-NBR       TO AP269-DEPT-NBR                  03100044
031100                                  MDSEAR-DEPT-NBR.                03110044
031200     MOVE AP263-PO-NBR         TO AP269-PO-NBR                    03120048
031300                                  PV-PREV-PO-NBR                  03130048
031400                                  INVOIC-PO-NBR                   03140046
031500                                  NINREC-PO-NBR.                  03150044
031600     PERFORM Y100-OPEN-INVOIC-CSR.                                03160044
031700     PERFORM R200-FETCH-INVOIC-CSR                                03170044
031800         UNTIL EOC-INVOIC-CSR.                                    03180044
031900     PERFORM Y200-CLOSE-INVOIC-CSR.                               03190044
032000     PERFORM R300-SELECT-OVERAGE.                                 03200044
032100     PERFORM R400-SELECT-DEPT-INFO.                               03210044
032200     PERFORM R500-SELECT-BUYER-NAME.                              03220044
032300     PERFORM R600-SELECT-DMM-NAME.                                03230044
032400     PERFORM R700-SELECT-GMM-NAME.                                03240044
032500 EJECT                                                            03250044
032600****************************************************************  03260044
032700*  B300-ACCUM-COSTS  ACCUMULATE COSTS.                            03270044
032800****************************************************************  03280044
032900*                                                                 03290044
033000 B300-ACCUM-COSTS.                                                03300044
033100                                                                  03310044
033200     EVALUATE TRUE                                                03320044
033300         WHEN INVOICE-RECORD                                      03330044
033400             ADD AP263-GROSS-INVOICE-AMT TO WS-GROSS-INVOICE-AMT  03340044
033500         WHEN INVOICE-ADJ-RECORD                                  03350044
033600             EVALUATE AP263-TRAN-CODE                             03360044
033700                 WHEN 10                                          03370044
033800                     ADD AP263-EXTD-COST TO WS-TR-CDE-10-COST     03380044
033900                 WHEN 12                                          03390044
034000                     ADD AP263-EXTD-COST TO WS-TR-CDE-12-COST     03400044
034100                 WHEN 16                                          03410044
034200                     ADD AP263-EXTD-COST TO WS-TR-CDE-16-COST     03420044
034300             END-EVALUATE                                         03430044
034400         WHEN RECEIVER-RECORD                                     03440044
034500             ADD AP263-RECVR-AMT         TO WS-RECVR-AMT          03450044
034600         WHEN RECEIVER-ADJ-RECORD                                 03460044
034700             EVALUATE AP263-TRAN-CODE                             03470044
034800                 WHEN 36                                          03480044
034900                     ADD AP263-EXTD-COST TO WS-TR-CDE-36-COST     03490044
035000                 WHEN 37                                          03500044
035100                     ADD AP263-EXTD-COST TO WS-TR-CDE-37-COST     03510044
035200                 WHEN 76                                          03520044
035300                     ADD AP263-EXTD-COST TO WS-TR-CDE-76-COST     03530044
035400             END-EVALUATE                                         03540044
035500     END-EVALUATE.                                                03550044
035600 EJECT                                                            03560044
035700***************************************************************** 03570044
035800*  R100-READ-INVOICE-FILE                                         03580044
035900***************************************************************** 03590044
036000*                                                                 03600044
036100 R100-READ-INVOICE-FILE.                                          03610044
036200                                                                  03620044
036300     READ RESULTS-INVOICE-FILE INTO AP263-RECORD                  03630044
036400         AT END                                                   03640044
036500            SET INVOICE-EOF TO TRUE.                              03650044
036600 EJECT                                                            03660044
036700***************************************************************** 03670044
036800*  R200-FETCH-INVOIC-CSR  FETCH SUM OF GROSS COSTS FROM           03680044
036900*  TINVOIC.  A NOT FOUND CONDITION RESULTS IN THE END OF CURSOR   03690046
037000*  SWITCH BEING SET.                                              03700046
037100***************************************************************** 03710044
037200*                                                                 03720044
037300 R200-FETCH-INVOIC-CSR.                                           03730044
037400                                                                  03740044
037500     EXEC SQL                                                     03750044
037600         FETCH INVOIC_CSR                                         03760044
037700           INTO                                                   03770044
037800             :INVOIC-INVC-TYP-CDE,                                03780044
037900             :INVOIC-GRO-COST-AMT                                 03790044
038000     END-EXEC                                                     03800044
038100                                                                  03810044
038200     EVALUATE TRUE                                                03820044
038300         WHEN SQLCODE = ZERO                                      03830044
038400             EVALUATE INVOIC-INVC-TYP-CDE                         03840044
038500                 WHEN 'MI'                                        03850044
038600                     MOVE INVOIC-GRO-COST-AMT                     03860044
038700                         TO AP269-OPEN-INVC-COST                  03870044
038800                 WHEN 'RI'                                        03880044
038900                     MOVE INVOIC-GRO-COST-AMT                     03890044
039000                         TO AP269-OPEN-SHORT-COST                 03900044
039100             END-EVALUATE                                         03910044
039200         WHEN SQLCODE = +100                                      03920044
039300             SET EOC-INVOIC-CSR TO TRUE                           03930044
039400         WHEN OTHER                                               03940044
039500             MOVE 'R200-FETCH-INVOIC-CSR'                         03950044
039600                                 TO AA-PARAGRAPH-NAME             03960044
039700             MOVE 'UNSUCCESSFUL FETCH WITH INVOIC_CSR'            03970044
039800                                 TO AA-DB2-OPERATION              03980044
039900             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                03990046
040000             MOVE SPACES         TO AA-DB2-TABLE-2                04000046
040100             PERFORM Z998-DB2-ABEND                               04010044
040200     END-EVALUATE.                                                04020044
040300                                                                  04030044
040400 EJECT                                                            04040044
040500*                                                                 04050044
040600***************************************************************** 04060044
040700*  R300-SELECT-OVERAGE  SELECT A SUM OF THE NON INVOICE UNIT      04070044
040800*  QUANTITY TIMES THE UNIT COST FROM TNINREC.                     04080044
040900***************************************************************** 04090044
041000*                                                                 04100044
041100 R300-SELECT-OVERAGE.                                             04110044
041200                                                                  04120044
041300     EXEC SQL                                                     04130044
041400         SELECT                                                   04140044
041500             SUM(NON_INVC_UNT_QTY * UNT_COST_AMT)                 04150044
041600         INTO :WS-OPEN-OVER-COST                                  04160044
041700                  :NINREC-NULL-IND                                04170044
041800         FROM TNINREC                                             04180044
041900         WHERE PO_NBR = :NINREC-PO-NBR                            04190044
042000           AND STATUS_CDE = ' '                                   04200044
042100     END-EXEC.                                                    04210044
042200                                                                  04220044
042300     EVALUATE TRUE                                                04230044
042400         WHEN SQLCODE = ZEROS                                     04240044
042500             IF NINREC-NULL-IND < +0                              04250044
042600                 MOVE ZEROS             TO AP269-OPEN-OVER-COST   04260044
042700             ELSE                                                 04270044
042800                 MOVE WS-OPEN-OVER-COST TO AP269-OPEN-OVER-COST   04280044
042900             END-IF                                               04290044
043000         WHEN OTHER                                               04300044
043100             MOVE 'R300-SELECT-OVERAGE'                           04310044
043200                               TO AA-PARAGRAPH-NAME               04320044
043300             MOVE 'UNSUCCESSFUL SELECT OVERAGE'                   04330044
043400                               TO AA-DB2-OPERATION                04340044
043500             MOVE 'TNINREC '   TO AA-DB2-TABLE-1                  04350044
043600             MOVE SPACES       TO AA-DB2-TABLE-2                  04360044
043700             PERFORM Z998-DB2-ABEND                               04370044
043800     END-EVALUATE.                                                04380044
043900                                                                  04390044
044000 EJECT                                                            04400044
044100*                                                                 04410044
044200***************************************************************** 04420044
044300*  R400-SELECT-DEPT-INFO  SELECT DEPT NAME, GMM#, DMM#, BUYER#,   04430044
044400*  AND MDSEAR-DKEY FROM TMDSEAR.                                  04440044
044500***************************************************************** 04450044
044600*                                                                 04460044
044700 R400-SELECT-DEPT-INFO.                                           04470044
044800                                                                  04480044
044900     EXEC SQL                                                     04490044
045000         SELECT GMA_NBR                                           04500044
045100              , DMA_NBR                                           04510044
045200              , BYR_NBR                                           04520044
045300              , MDSEAR_DESC                                       04530044
045400              , MDSEAR_DKEY                                       04540044
045500           INTO :MDSEAR-GMA-NBR                                   04550044
045600              , :MDSEAR-DMA-NBR                                   04560044
045700              , :MDSEAR-BYR-NBR                                   04570044
045800              , :MDSEAR-DESC                                      04580044
045900              , :MDSEAR-DKEY                                      04590044
046000         FROM TMDSEAR                                             04600044
046100         WHERE DEPT_NBR = :MDSEAR-DEPT-NBR                        04610044
046200           AND OPERCO_NBR = '03'                                  04620044
046300           AND MDSELV_CDE = 'DPT'                                 04630044
046400           AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE          04640044
046500     END-EXEC.                                                    04650044
046600                                                                  04660044
046700     EVALUATE TRUE                                                04670044
046800         WHEN SQLCODE = ZEROS                                     04680044
046900             MOVE MDSEAR-GMA-NBR TO AP269-GMM-NBR                 04690044
047000             MOVE MDSEAR-DMA-NBR TO AP269-DMM-NBR                 04700044
047100             MOVE MDSEAR-BYR-NBR TO AP269-BUYER-NBR               04710044
047200             MOVE MDSEAR-DESC    TO AP269-DEPT-NAME               04720044
047300                                                                  04730044
047400         WHEN OTHER                                               04740044
047500             MOVE 'R400-SELECT-DEPT-INFO'                         04750044
047600                               TO AA-PARAGRAPH-NAME               04760044
047700             MOVE 'UNSUCCESSFUL SELECT DEPT INFO'                 04770044
047800                               TO AA-DB2-OPERATION                04780044
047900             MOVE 'TMDSEAR '   TO AA-DB2-TABLE-1                  04790044
048000             MOVE SPACES       TO AA-DB2-TABLE-2                  04800044
048100             PERFORM Z998-DB2-ABEND                               04810044
048200     END-EVALUATE.                                                04820044
048300                                                                  04830044
048400 EJECT                                                            04840044
048500*                                                                 04850044
048600***************************************************************** 04860044
048700*  R500-SELECT-BUYER-NAME  SELECT BUYER NAME USING MDSEAR-DKEY    04870044
048800*  FROM R400-SELECT-DEPT-INFO.                                    04880044
048900***************************************************************** 04890044
049000*                                                                 04900044
049100 R500-SELECT-BUYER-NAME.                                          04910044
049200                                                                  04920044
049300     EXEC SQL                                                     04930044
049400         SELECT DISTINCT(WORKER_LAST_NAME)                        04940044
049500              , WORKER_FIR_NAME                                   04950044
049600           INTO :RSPBAR-WORKER-LAST-NAME                          04960044
049700              , :RSPBAR-WORKER-FIR-NAME                           04970044
049800         FROM TRSPBAR                                             04980044
049900         WHERE MDSEAR_DKEY = :MDSEAR-DKEY                         04990044
050000           AND RSPLVL_CDE = 'BYR'                                 05000044
050100           AND WORKER_STRT_DTE <= CURRENT DATE                    05010044
050200           AND WORKER_END_DTE >= CURRENT DATE                     05020044
050300     END-EXEC.                                                    05030044
050400                                                                  05040044
050500     EVALUATE TRUE                                                05050044
050600         WHEN SQLCODE = ZEROS                                     05060044
050700             STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' '      05070044
050800                    ' '                     DELIMITED BY SIZE     05080044
050900                    RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE     05090044
051000             INTO AP269-BUYER-NAME                                05100044
051100                                                                  05110044
051200         WHEN OTHER                                               05120044
051300             MOVE 'R500-SELECT-BUYER-NAME'                        05130044
051400                               TO AA-PARAGRAPH-NAME               05140044
051500             MOVE 'UNSUCCESSFUL SELECT BUYER NAME'                05150044
051600                               TO AA-DB2-OPERATION                05160044
051700             MOVE 'TRSPBAR '   TO AA-DB2-TABLE-1                  05170044
051800             MOVE SPACES       TO AA-DB2-TABLE-2                  05180044
051900             PERFORM Z998-DB2-ABEND                               05190044
052000     END-EVALUATE.                                                05200044
052100                                                                  05210044
052200 EJECT                                                            05220044
052300*                                                                 05230044
052400***************************************************************** 05240044
052500*  R600-SELECT-DMM-NAME  SELECT DMM NAME USING GMM# AND DMM#      05250044
052600*  FROM R400-SELECT-DEPT-INFO.                                    05260044
052700***************************************************************** 05270044
052800*                                                                 05280044
052900 R600-SELECT-DMM-NAME.                                            05290044
053000                                                                  05300044
053100     EXEC SQL                                                     05310044
053200         SELECT DISTINCT(B.WORKER_LAST_NAME)                      05320044
053300              , B.WORKER_FIR_NAME                                 05330044
053400           INTO :RSPBAR-WORKER-LAST-NAME                          05340044
053500              , :RSPBAR-WORKER-FIR-NAME                           05350044
053600         FROM TMDSEAR A,                                          05360044
053700              TRSPBAR B                                           05370044
053800         WHERE A.OPERCO_NBR = '03'                                05380044
053900           AND A.GMA_NBR = :MDSEAR-GMA-NBR                        05390044
054000           AND A.DMA_NBR = :MDSEAR-DMA-NBR                        05400044
054100           AND A.MDSELV_CDE = 'DMA'                               05410044
054200           AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                      05420044
054300           AND B.RSPLVL_CDE = 'DMM'                               05430044
054400           AND WORKER_STRT_DTE <= CURRENT DATE                    05440044
054500           AND WORKER_END_DTE >= CURRENT DATE                     05450044
054600     END-EXEC.                                                    05460044
054700                                                                  05470044
054800     EVALUATE TRUE                                                05480044
054900         WHEN SQLCODE = ZEROS                                     05490044
055000             STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' '      05500044
055100                    ' '                     DELIMITED BY SIZE     05510044
055200                    RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE     05520044
055300             INTO AP269-DMM-NAME                                  05530044
055400                                                                  05540044
055500         WHEN OTHER                                               05550044
055600             MOVE 'R600-SELECT-DMM-NAME'                          05560044
055700                               TO AA-PARAGRAPH-NAME               05570044
055800             MOVE 'UNSUCCESSFUL SELECT DMM NAME'                  05580044
055900                               TO AA-DB2-OPERATION                05590044
056000             MOVE 'TMDSEAR '   TO AA-DB2-TABLE-1                  05600044
056100             MOVE 'TRSPBAR '   TO AA-DB2-TABLE-2                  05610044
056200             PERFORM Z998-DB2-ABEND                               05620044
056300     END-EVALUATE.                                                05630044
056400                                                                  05640044
056500 EJECT                                                            05650044
056600*                                                                 05660044
056700***************************************************************** 05670044
056800*  R700-SELECT-GMM-NAME  SELECT GMM NAME USING GMM#               05680044
056900*  FROM R400-SELECT-DEPT-INFO.                                    05690044
057000***************************************************************** 05700044
057100*                                                                 05710044
057200 R700-SELECT-GMM-NAME.                                            05720044
057300                                                                  05730044
057400     EXEC SQL                                                     05740044
057500         SELECT DISTINCT(B.WORKER_LAST_NAME)                      05750044
057600              , B.WORKER_FIR_NAME                                 05760044
057700           INTO :RSPBAR-WORKER-LAST-NAME                          05770044
057800              , :RSPBAR-WORKER-FIR-NAME                           05780044
057900         FROM TMDSEAR A,                                          05790044
058000              TRSPBAR B                                           05800044
058100         WHERE A.OPERCO_NBR = '03'                                05810044
058200           AND A.GMA_NBR = :MDSEAR-GMA-NBR                        05820044
058300           AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                      05830044
058400           AND B.RSPLVL_CDE = 'GMM'                               05840044
058500           AND WORKER_STRT_DTE <= CURRENT DATE                    05850044
058600           AND WORKER_END_DTE >= CURRENT DATE                     05860044
058700     END-EXEC.                                                    05870044
058800                                                                  05880044
058900     EVALUATE TRUE                                                05890044
059000         WHEN SQLCODE = ZEROS                                     05900044
059100             STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' '      05910044
059200                    ' '                     DELIMITED BY SIZE     05920044
059300                    RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE     05930044
059400             INTO AP269-GMM-NAME                                  05940044
059500                                                                  05950044
059600         WHEN OTHER                                               05960044
059700             MOVE 'R700-SELECT-GMM-NAME'                          05970044
059800                               TO AA-PARAGRAPH-NAME               05980044
059900             MOVE 'UNSUCCESSFUL SELECT GMM NAME'                  05990044
060000                               TO AA-DB2-OPERATION                06000044
060100             MOVE 'TMDSEAR '   TO AA-DB2-TABLE-1                  06010044
060200             MOVE 'TRSPBAR '   TO AA-DB2-TABLE-2                  06020044
060300             PERFORM Z998-DB2-ABEND                               06030044
060400     END-EVALUATE.                                                06040044
060500                                                                  06050044
060600 EJECT                                                            06060044
060700*                                                                 06070044
060800***************************************************************** 06080044
060900*  W100-WRITE-OUTPUT-REC                                          06090044
061000***************************************************************** 06100044
061100*                                                                 06110044
061200 W100-WRITE-OUTPUT-REC.                                           06120044
061300                                                                  06130044
061400     WRITE RECON-RESULTS-SUMM-RECS FROM AP269-RECORD.             06140044
061500                                                                  06150044
061600     INITIALIZE AP269-RECORD.                                     06160044
061700                                                                  06170044
061800 EJECT                                                            06180044
061900*                                                                 06190044
062000***************************************************************** 06200044
062100*  Y100-OPEN-INVOIC-CURSOR  OPEN TINVOIC CURSOR.                  06210046
062200***************************************************************** 06220044
062300*                                                                 06230044
062400 Y100-OPEN-INVOIC-CSR.                                            06240044
062500                                                                  06250044
062600     EXEC SQL                                                     06260044
062700         OPEN INVOIC_CSR                                          06270044
062800     END-EXEC                                                     06280044
062900                                                                  06290044
063000     EVALUATE TRUE                                                06300044
063100         WHEN SQLCODE = ZERO                                      06310044
063200             SET NOT-EOC-INVOIC-CSR TO TRUE                       06320044
063300         WHEN OTHER                                               06330044
063400             MOVE 'Y100-OPEN-INVOIC-CSR        '                  06340044
063500                             TO AA-PARAGRAPH-NAME                 06350044
063600             MOVE 'UNSUCCESSFUL OPEN INVOIC'                      06360044
063700                             TO AA-DB2-OPERATION                  06370044
063800             MOVE 'TINVOIC ' TO AA-DB2-TABLE-1                    06380046
063900             MOVE SPACES     TO AA-DB2-TABLE-2                    06390046
064000             PERFORM Z998-DB2-ABEND                               06400044
064100     END-EVALUATE.                                                06410044
064200*                                                                 06420044
064300***************************************************************** 06430044
064400*  Y200-CLOSE-INVOIC-CSR  CLOSE TINVOIC CURSOR.                   06440046
064500***************************************************************** 06450044
064600*                                                                 06460044
064700 Y200-CLOSE-INVOIC-CSR.                                           06470044
064800                                                                  06480044
064900     EXEC SQL                                                     06490044
065000         CLOSE INVOIC_CSR                                         06500044
065100     END-EXEC                                                     06510044
065200                                                                  06520044
065300     EVALUATE TRUE                                                06530044
065400         WHEN SQLCODE = ZERO                                      06540044
065500             CONTINUE                                             06550044
065600         WHEN OTHER                                               06560044
065700             MOVE 'Y200-CLOSE-INVOIC-CSR '                        06570044
065800                              TO AA-PARAGRAPH-NAME                06580044
065900             MOVE 'UNSUCCESSFUL CLOSE  INVOIC'                    06590044
066000                              TO AA-DB2-OPERATION                 06600044
066100             MOVE 'TINVOIC '  TO AA-DB2-TABLE-1                   06610046
066200             MOVE SPACES      TO AA-DB2-TABLE-2                   06620046
066300             PERFORM Z998-DB2-ABEND                               06630044
066400     END-EVALUATE.                                                06640044
066500                                                                  06650044
066600 EJECT                                                            06660044
066700******************************************************************06670044
066800*    ABEND ROUTINE FOR DB2 ERRORS                                *06680044
066900******************************************************************06690044
067000 Z998-DB2-ABEND.                                                  06700044
067100                                                                  06710044
067200     DISPLAY AA-ABEND-LIT.                                        06720044
067300     DISPLAY AA-DB2-ERROR-LIT.                                    06730044
067400     DISPLAY AA-PROGRAM-LIT.                                      06740044
067500     DISPLAY AA-PARAGRAPH-LIT.                                    06750044
067600     DISPLAY AA-DB2-OPERATION-LIT.                                06760044
067700     DISPLAY AA-DB2-TABLE-1.                                      06770044
067800     DISPLAY AA-DB2-TABLE-2.                                      06780044
067900     DISPLAY '*****              DEPT = ' AP263-DEPT-NBR.         06790044
068000     DISPLAY '*****                PO = ' AP263-PO-NBR.           06800048
068100     SET AC-DB2-ERROR TO TRUE.                                    06810044
068200                                                                  06820044
068300     COPY DPPD004.                                                06830044
068400     CALL 'ILBOABN0' USING ABEND-CODE.                            06840044
