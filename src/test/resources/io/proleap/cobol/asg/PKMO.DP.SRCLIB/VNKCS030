000100*-----------------------*                                         00010045
000200 IDENTIFICATION DIVISION.                                         00020045
000300*-----------------------*                                         00030045
000400 PROGRAM-ID.    VNKCS030.                                         00040045
000500 AUTHOR.        JACK KRAMER.                                      00050045
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060045
000700 DATE-WRITTEN.  JANUARY 2005.                                     00070045
000800*---------------------------------------------------------------* 00080045
000900*    V030 - VENDOR CAPABILITY MAINTENANCE PROGRAM               * 00090045
001000*                                                               * 00100045
001100*    THIS PROGRAM ALLOWS A CAPABILITY TO BE ADDED TO OR EXPIRED * 00110045
001200*    FOR A VENDOR.                                              * 00120045
001300*                                                               * 00130045
001400*---------------------------------------------------------------* 00140045
001500* CHANGES MADE:                                                 * 00150047
001600*                                                               * 00160047
001700*  DATE  07/25/2005                                             * 00170047
001800*      CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES.   * 00180047
001900*      RECOMPILE FROM PRODUCTION TO INCORPORATE CHANGES TO      * 00190047
002000*      COPYBOOK VNWS007.                                        * 00200047
002100*      MADE BY: KRYSTEN LEARY           WR/IR #: WR28651        * 00210047
002200*                                                               * 00220048
002300*  DATE  03/24/2006                                             * 00230048
002400*      CHANGE MADE: VENDOR ALLOWANCE AUTOMATION PROJECT.        * 00240048
002500*      RECOMPILE FROM PRODUCTION TO INCORPORATE CHANGES TO      * 00250048
002600*      COPYBOOK VNWS007.                                        * 00260048
002700*      MADE BY: MIKE BESKE              WR/IR #: WR30028        * 00270048
002701*                                                               * 00270159
002702*  DATE  09/30/2014                                             * 00270260
002703*      CHANGE MADE:                                             * 00270360
002704*      CALLED NEW SUB-ROUTINE VNKUT054 TO DERIVE ADDITIONAL     * 00270460
002705*      AND THEN CALLED PEOPLESOFT INTERFACE SUB ROUTINE VNKUT040* 00270560
002706*      TO INSERT THE VENDOR TYPE TO PS_VENDOR_TYPE TABLE.       * 00270660
002707*      VENDOR TYPES.                                            * 00270760
002708*      MADE BY: COGNIZANT               WR/IR #: CHG0099490     * 00270860
002709*  DATE  05/17/2016                                             * 00270960
002710*      CHANGE MADE:                                             * 00271060
002720*      RECOMPILE FOR VNWS014 AND VNWS054                        * 00272060
002730*      MADE BY: ACCENTURE               WR/IR #: CHG0135353     * 00273060
002731*  DATE  03/22/2019                                              *00273161
002732*   CHANGE MADE: ADDED CHECK TO NOT CALL PEOPLESOFT CALLED       *00273261
002733*   MODULES AS PART OF THE PS REPLACEMENT TO ORACLE. *            00273361
002734*   BASED ON TKRPRPM PARAMTER LOOKUP 'ERPDTE'. IF CURRENT DATE *  00273461
002735*   IS GREATER THEN PARAMATER DATE, ASC-ERP-OIC-LIVE-YES OR *     00273561
002736*   ASC-ERP-OIC-LIVE-NO WILL BE SET AND CHECKED IN THE PROGRAM *  00273661
002737*        MADE BY: GERMAN BANDA            WR/IR #: CHG0220043 *   00273761
002731*  DATE  05/18/2020                                              *00273862
002732*   CHANGE MADE: REMOVE CALLS TO VNKUT054, VNKUT040.             *00273962
002737*        MADE BY: JEAN KURK               WR/IR #: CHG0243534 *   00274462
002731*  DATE  01/05/2023                                              *00274563
002732*   CHANGE MADE: CHANGE CALL TO DPKCS030 TO DYNAMIC.             *00274664
002737*        MADE BY: JEAN KURK               WR/IR #: CHG0277999 *   00274763
002738******************************************************************00274861
002740*---------------------------------------------------------------* 00274960
002750                                                                  00275060
002760 ENVIRONMENT DIVISION.                                            00276060
002770 DATA DIVISION.                                                   00277060
002780                                                                  00278060
002790 WORKING-STORAGE SECTION.                                         00279060
002800                                                                  00280060
002900 01  DK-DB2-KEYS.                                                 00290060
003000     15  DK-ENT-ID                      PIC S9(09)  COMP.         00300060
003100                                                                  00310060
003200 01  PC-PROGRAM-CONSTANTS.                                        00320060
003300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00330060
003400                                                    'VN030A  '.   00340060
003500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00350060
003600                                                    'VNKM030 '.   00360060
003700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00370060
003800                                                    'VNKCS030'.   00380060
003900     05  PC-VNKCS024              PIC  X(08)  VALUE 'VNKCS024'.   00390060
004100     05  PC-VNKCS023              PIC  X(08)  VALUE 'VNKCS023'.   00410060
004200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00420060
004300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00430060
004400     05  PC-INTER-APPL-CODES.                                     00440060
004500         10 PC-INTER-APPL-LIST-ADD      PIC  X(01)  VALUE '1'.    00450060
004600         10 PC-INTER-APPL-DETAIL-ADD    PIC  X(01)  VALUE '2'.    00460060
004700         10 PC-INTER-APPL-LIST-UPD      PIC  X(01)  VALUE '3'.    00470060
004800         10 PC-INTER-APPL-DETAIL-UPD    PIC  X(01)  VALUE '4'.    00480060
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00490060
005000                                                    COMP-3.       00500060
005100                                                                  00510060
005200     05  PC-TSYMSG-NUMBERS.                                       00520060
005300         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.  00530060
005400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00540060
005500         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00550060
005600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00560060
005700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00570060
005800         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00580060
006000         10  PC-TSYMSG-01886            PIC  9(05)  VALUE 01886.  00600060
006200         10  PC-TSYMSG-02645            PIC  9(05)  VALUE 02645.  00620060
006210         10  PC-TSYMSG-02646            PIC  9(05)  VALUE 02646.  00621060
006220         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00622060
006230         10  PC-TSYMSG-03368            PIC  9(05)  VALUE 03368.  00623060
006240         10  PC-TSYMSG-03367            PIC  9(05)  VALUE 03367.  00624060
006250         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00625060
006260     05  PC-MAX-DATE                    PIC  X(10)  VALUE         00626060
006270                                                    '12/31/9999'. 00627060
006280     05  PC-MAX-DATE-ISO                PIC  X(10)  VALUE         00628060
006290                                                    '9999-12-31'. 00629060
006300                                                                  00630060
006400 01  PS-PROGRAM-SWITCHES.                                         00640060
006500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00650060
006600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00660060
006700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00670060
006800                                                                  00680060
006900     05  PS-CPBLTY-SW                   PIC  X(01)  VALUE 'N'.    00690060
007000         88  PS-CPBLTY-ADD                          VALUE 'A'.    00700060
007100         88  PS-CPBLTY-DELETE                       VALUE 'D'.    00710060
007200                                                                  00720060
007600                                                                  00760060
007700     05  PS-NEED-COMMIT-IND             PIC  X(01).               00770060
007800         88  PS-NEED-COMMIT-YES                     VALUE 'Y'.    00780060
007900         88  PS-NEED-COMMIT-NO                      VALUE 'N'.    00790060
007910                                                                  00791060
007920     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'N'.    00792060
007930         88  PS-ERROR                               VALUE 'Y'.    00793060
007940         88  PS-NO-ERROR                            VALUE 'N'.    00794060
007950                                                                  00795060
007960 01  PV-PROGRAM-VARIABLES.                                        00796060
007970     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00797060
007980                                                    COMP SYNC.    00798060
007990     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00799060
008000                                                    COMP SYNC.    00800060
008100     05  PV-DUN-NBR                     PIC  X(09).               00810060
008400     05  PV-WORK-DATE.                                            00840060
008500         10  PV-WORK-MM                 PIC XX      VALUE SPACES. 00850060
008600         10  PV-SLASH1                  PIC X       VALUE '/'.    00860060
008700         10  PV-WORK-DD                 PIC XX      VALUE SPACES. 00870060
008800         10  PV-SLASH2                  PIC X       VALUE '/'.    00880060
008900         10  PV-WORK-YYYY               PIC XXXX    VALUE SPACES. 00890060
009000*---------------------------------------------------------------* 00900060
009100*  RECORD LAYOUT FOR THE VENDOR CAPABILITIES TEMP STORAGE QUEUE * 00910060
009200*---------------------------------------------------------------* 00920060
009300     COPY VNWS019.                                                00930060
009400                                                                  00940060
009770**--------------------------------------------------------------* 00977060
009780** COMMAREA FOR VNKCS024                                        * 00978060
009790**--------------------------------------------------------------* 00979060
009800 01 VN007-COMMAREA.                                               00980060
009900     COPY VNWS007.                                                00990060
010000                                                                  01000060
010100*---------------------------------------------------------------* 01010060
010200*    MAP LAYOUT                                                 * 01020060
010300*---------------------------------------------------------------* 01030060
010400     COPY VNKM030.                                                01040060
010500                                                                  01050060
010600*---------------------------------------------------------------* 01060060
010700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01070060
010800*---------------------------------------------------------------* 01080060
010900     COPY DPWS015.                                                01090060
011000                                                                  01100060
011100*---------------------------------------------------------------* 01110060
011200*    FUNCTION KEYS COPYBOOK.                                    * 01120060
011300*---------------------------------------------------------------* 01130060
011400     COPY DPWS016.                                                01140060
011500                                                                  01150060
011600*---------------------------------------------------------------* 01160060
011700*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 01170063
011800*---------------------------------------------------------------* 01180060
011900     COPY DPWS030.                                                01190060
011900     COPY DPWS930.                                                01191063
012000                                                                  01200060
012100*---------------------------------------------------------------* 01210060
012200*    STANDARD COMMAREA.                                         * 01220060
012300*---------------------------------------------------------------* 01230060
012400     COPY DPWS020.                                                01240060
012500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01250060
012600*---------------------------------------------------------------* 01260060
012700* INTER-APPLICATION COMMAREA.                                   * 01270060
012800*   VNWS018 - IS THE INPUT LAYOUT FROM THE LIST PROGRAM AND THE * 01280060
012900*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * 01290060
013000*---------------------------------------------------------------* 01300060
013100         10  INTER-APPL-COMM-AREA       PIC X(200).               01310060
013200     COPY VNWS018.                                                01320060
013300         10  ASC-SPECIFIC-COMMAREA.                               01330060
013400             15  ASC-KEYS.                                        01340060
013500                 20  ASC-KEY-ENT-ID                  PIC S9(09)   01350060
013600                                                     COMP.        01360060
013700                 20  ASC-KEY-CAPBLTY-CDE             PIC  X(03).  01370060
013800                 20  ASC-KEY-CAPBLTY-NAME            PIC  X(30).  01380060
013900                 20  ASC-KEY-VENDOR-NAME             PIC  X(30).  01390060
014000                 20  ASC-KEY-VENDOR-ID               PIC  X(09).  01400060
014100             15  ASC-INT-APPL-FORMAT-IND             PIC  X(01).  01410060
014200             15  ASC-EFF-DATE                        PIC  X(10).  01420060
014300             15  ASC-EXP-DATE                        PIC  X(10).  01430060
014400             15  ASC-DATE-ADDED                      PIC  X(10).  01440060
014500             15  ASC-LAST-UPD-ID                     PIC  X(08).  01450060
014600             15  ASC-LAST-UPD-DATE                   PIC  X(10).  01460060
014700             15  ASC-CURRENT-DATE                    PIC  X(10).  01470060
014800             15  ASC-CURRENT-DATE-ISO                PIC  X(10).  01480060
014900                                                                  01490060
015000             15  ASC-DISPLAY-ENT-ID                  PIC  9(09).  01500060
015100             15  ASC-SEL-SUB                         PIC S9(04)   01510060
015200                                                          COMP.   01520060
015300             15  ASC-SEL-ITEM                        PIC S9(04)   01530060
015400                                                          COMP.   01540060
015500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   01550060
015600                                                          COMP-3. 01560060
015700             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01570060
015800                                                          COMP-3. 01580060
015900             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  01590060
016000                                                                  01600060
016100             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  01610060
016200                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   01620060
016300             15  ASC-ROW-EXISTS-SW                   PIC  X(01).  01630060
016400                 88  ASC-NO-ROW-EXISTS               VALUE 'N'.   01640060
016500                 88  ASC-EFFECTIVE-ROW-EXISTS        VALUE 'Y'.   01650060
016600                 88  ASC-EXPIRED-ROW-EXISTS          VALUE 'X'.   01660060
016700                                                                  01670060
016800*---------------------------------------------------------------* 01680060
016900*    ABEND PROCESSING COPYBOOK.                                 * 01690060
017000*---------------------------------------------------------------* 01700060
017100     COPY DPWS013.                                                01710060
017200                                                                  01720060
017300*---------------------------------------------------------------* 01730060
017400*    DB2 AREA FOR VNT_VND_CPBL                                  * 01740060
017500*---------------------------------------------------------------* 01750060
017600     EXEC SQL                                                     01760060
017700          INCLUDE VNT00001                                        01770060
017800     END-EXEC.                                                    01780060
017900                                                                  01790060
018000*---------------------------------------------------------------* 01800060
018100*    DB2 AREA FOR TEXTENT                                       * 01810060
018200*---------------------------------------------------------------* 01820060
018300     EXEC SQL                                                     01830060
018400          INCLUDE TEXTENT                                         01840060
018500     END-EXEC.                                                    01850060
018600                                                                  01860060
018700*---------------------------------------------------------------* 01870060
018800*    DB2 AREA FOR COMMUNICATIONS                                * 01880060
018900*---------------------------------------------------------------* 01890060
019000     EXEC SQL                                                     01900060
019100          INCLUDE SQLCA                                           01910060
019200     END-EXEC.                                                    01920060
019300                                                                  01930060
019400                                                                  01940060
019500 LINKAGE SECTION.                                                 01950060
019600                                                                  01960060
019700 01  DFHCOMMAREA.                                                 01970060
019800     05  FILLER  OCCURS 1 TO 4072 TIMES                           01980060
019900                 DEPENDING ON EIBCALEN.                           01990060
020000         10  FILLER  PIC X.                                       02000060
020100                                                                  02010060
020200 PROCEDURE DIVISION.                                              02020060
020300***************************************************************** 02030060
020400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 02040060
020500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 02050060
020600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 02060060
020700***************************************************************** 02070060
020800 0000-MAIN-MODULE.                                                02080060
020900                                                                  02090060
021000     INITIALIZE DP030-CICS-API-FIELDS.                            02100060
021100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02110060
021200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02120060
021300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02130060
021400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02140060
021500     MOVE LENGTH OF VN030AI        TO DP030-MAP-LENGTH (1).       02150060
021600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02160060
021700     PERFORM 0001-CALL-CICS-ARCH-API.                             02170060
021800                                                                  02180060
021900     PERFORM 1000-CONTROL-PROCESSING                              02190060
022000                                                                  02200060
022220                                                                  02222060
022230     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02223060
022240     PERFORM 0001-CALL-CICS-ARCH-API.                             02224060
022250                                                                  02225060
022260***************************************************************** 02226060
022270**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 02227060
022280**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 02228060
022290***************************************************************** 02229060
022300 0001-CALL-CICS-ARCH-API.                                         02230060
022400                                                                  02240060
022500*    CALL 'DPKCS030' USING DFHEIBLK                               02250063
022500     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02251065
022600                           DFHCOMMAREA                            02260060
022700                           DP030-CICS-API-FIELDS                  02270060
022800                           DP020-STANDARD-COMMAREA                02280060
022900                           VN030AI.                               02290060
023000                                                                  02300060
023100     IF  DP030-RC-CALL-SUCCESSFUL                                 02310060
023200         CONTINUE                                                 02320060
023300     ELSE                                                         02330060
023400         SET DP013-NO-ROLLBACK                                    02340060
023500             DP013-XCTL-DISPLAY-RESTART                           02350060
023600             DP013-CICS-ABEND      TO TRUE                        02360060
023700         MOVE '0001-CALL-CICS-ARCH-API'                           02370060
023800                                   TO DP013-PARAGRAPH             02380060
023900*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02390063
024000*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02400063
023900         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02401063
024000-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02402063
024100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02410060
024200         PERFORM DP013-0000-PROCESS-ABEND                         02420060
024300     END-IF.                                                      02430060
024400                                                                  02440060
024500*----------------------------------------------------------------*02450060
024600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *02460060
024700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *02470060
024800*----------------------------------------------------------------*02480060
024900 1000-CONTROL-PROCESSING.                                         02490060
025000                                                                  02500060
025100     EVALUATE TRUE                                                02510060
025200         WHEN DP020-NEXT-ACT-INITIAL                              02520060
025300             INITIALIZE ASC-SPECIFIC-COMMAREA                     02530060
025400             MOVE DP020-INT-APPL-FORMAT-IND                       02540060
025500                 TO ASC-INT-APPL-FORMAT-IND                       02550060
025600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 02560060
025700             IF  PS-COMMAREA-NOT-VALID                            02570060
025800                 SET DP020-MSG-FATAL                              02580060
025900                     DP020-NEXT-ACT-APPL-ERROR                    02590060
026000                                   TO TRUE                        02600060
026100             ELSE                                                 02610060
026200                 PERFORM 4000-BUILD-INITIAL-PANEL                 02620060
026300             END-IF                                               02630060
026400                                                                  02640060
026500         WHEN DP020-NEXT-ACT-READ-MAP                             02650060
026600             PERFORM 2000-PROCESS-PANEL                           02660060
026700                                                                  02670060
026800         WHEN DP020-NEXT-ACT-RETURN                               02680060
026900             PERFORM 4000-BUILD-INITIAL-PANEL                     02690060
027000                                                                  02700060
027100         WHEN OTHER                                               02710060
027200             SET DP013-LOGIC-ABEND TO TRUE                        02720060
027300             SET DP013-NO-ROLLBACK TO TRUE                        02730060
027400             MOVE '1000-CONTROL-PROCESSING'                       02740060
027500                                   TO DP013-PARAGRAPH             02750060
027600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    02760060
027700                                   TO DP013-MESSAGE-TEXT(1)       02770060
027800             PERFORM DP013-0000-PROCESS-ABEND                     02780060
027900     END-EVALUATE.                                                02790060
028000                                                                  02800060
028100*----------------------------------------------------------------*02810060
028200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *02820060
028300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *02830060
028400*----------------------------------------------------------------*02840060
028500 1100-PROCESS-INTER-APPL-COMM.                                    02850060
028600                                                                  02860060
028700     EXEC SQL                                                     02870060
028800         SET :ASC-CURRENT-DATE    = CURRENT DATE                  02880060
028900     END-EXEC.                                                    02890060
029000     MOVE ASC-CURRENT-DATE        TO ASC-CURRENT-DATE-ISO.        02900060
029100     MOVE ASC-CURRENT-DATE(6:2)   TO PV-WORK-MM.                  02910060
029200     MOVE ASC-CURRENT-DATE(9:2)   TO PV-WORK-DD.                  02920060
029300     MOVE ASC-CURRENT-DATE(1:4)   TO PV-WORK-YYYY.                02930060
029400     MOVE PV-WORK-DATE            TO ASC-CURRENT-DATE.            02940060
029500     EVALUATE ASC-INT-APPL-FORMAT-IND                             02950060
029600         WHEN PC-INTER-APPL-LIST-ADD                              02960060
029700         WHEN PC-INTER-APPL-LIST-UPD                              02970060
029800              SET PS-COMMAREA-VALID                               02980060
029900                  ASC-USE-SELECTION-QUEUE                         02990060
030000                                   TO TRUE                        03000060
030100              MOVE VN018-ENT-ID TO ASC-KEY-ENT-ID                 03010060
030200                                   ASC-DISPLAY-ENT-ID             03020060
030300              MOVE VN018-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME      03030060
030400              MOVE VN018-VENDOR-ID    TO ASC-KEY-VENDOR-ID        03040060
030500              MOVE VN018-NUMBER-OF-SELECTED-ITEMS                 03050060
030600                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03060060
030700              MOVE VN018-NUMBER-OF-TS-ITEMS                       03070060
030800                                   TO ASC-NUMBER-OF-TS-ITEMS      03080060
030900              MOVE VN018-SEL-QUEUE-NAME                           03090060
031000                                   TO ASC-SEL-QUEUE-NAME-IN       03100060
031100              PERFORM 1120-PREPARE-LIST-ENTRY                     03110060
031200                                                                  03120060
031300         WHEN PC-INTER-APPL-DETAIL-ADD                            03130060
031400         WHEN PC-INTER-APPL-DETAIL-UPD                            03140060
031500              SET PS-COMMAREA-VALID   TO TRUE                     03150060
031600              MOVE VN018-ENT-ID       TO ASC-KEY-ENT-ID           03160060
031700                                         ASC-DISPLAY-ENT-ID       03170060
031800              MOVE VN018-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME      03180060
031900              MOVE VN018-VENDOR-ID    TO ASC-KEY-VENDOR-ID        03190060
032000              MOVE VN018-CAPBLTY-CDE  TO ASC-KEY-CAPBLTY-CDE      03200060
032100              MOVE VN018-CAPBLTY-NAME TO ASC-KEY-CAPBLTY-NAME     03210060
032200                                                                  03220060
032300         WHEN OTHER                                               03230060
032400                 MOVE PC-TSYMSG-00148                             03240060
032500                                   TO DP020-MSG-NUMBER            03250060
032600                 SET PS-COMMAREA-NOT-VALID                        03260060
032700                                   TO TRUE                        03270060
032800     END-EVALUATE.                                                03280060
032900                                                                  03290060
033000*----------------------------------------------------------------*03300060
033100*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *03310060
033200*  QUEUE PASSED FROM THE LIST.                                   *03320060
033300*----------------------------------------------------------------*03330060
033400 1120-PREPARE-LIST-ENTRY.                                         03340060
033500                                                                  03350060
033600      MOVE VN019-MAX-ITEMS TO ASC-SEL-SUB.                        03360060
033700      MOVE ZERO            TO ASC-SEL-ITEM.                       03370060
033800                                                                  03380060
033900      PERFORM 2300-GET-NEXT-MESSAGE.                              03390060
034000                                                                  03400060
034100                                                                  03410060
034200*----------------------------------------------------------------*03420060
034300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03430060
034400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03440060
034500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03450060
034600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03460060
034700* FUNCTION KEYS CAN GET THIS FAR.                                *03470060
034800*----------------------------------------------------------------*03480060
034900 2000-PROCESS-PANEL.                                              03490060
035000                                                                  03500060
035100     EVALUATE TRUE                                                03510060
035200         WHEN DP020-SRC-AID = DP016-CLEAR                         03520060
035300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03530060
035400                                                                  03540060
035500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    03550060
035600             PERFORM 4000-BUILD-INITIAL-PANEL                     03560060
035700                                                                  03570060
035800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03580060
035900             IF ASC-USE-SELECTION-QUEUE                           03590060
036000                 PERFORM 2300-GET-NEXT-MESSAGE                    03600060
036100                 PERFORM 4000-BUILD-INITIAL-PANEL                 03610060
036200             ELSE                                                 03620060
036300*                --- BOTTOM OF LIST ---                           03630060
036400                 MOVE PC-TSYMSG-00070                             03640060
036500                                   TO DP020-MSG-NUMBER            03650060
036600                 SET DP020-MSG-INFORMATIONAL                      03660060
036700                                   TO TRUE                        03670060
036800             END-IF                                               03680060
036900                                                                  03690060
037000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03700060
037100             IF ASC-USE-SELECTION-QUEUE                           03710060
037200                 PERFORM 2310-GET-PREV-MESSAGE                    03720060
037300                 PERFORM 4000-BUILD-INITIAL-PANEL                 03730060
037400             ELSE                                                 03740060
037500*                --- TOP OF LIST ---                              03750060
037600                 MOVE PC-TSYMSG-00069                             03760060
037700                                   TO DP020-MSG-NUMBER            03770060
037800                 SET DP020-MSG-INFORMATIONAL                      03780060
037900                                   TO TRUE                        03790060
038000             END-IF                                               03800060
038100                                                                  03810060
038200         WHEN OTHER                                               03820060
038300             SET DP030-CONTINUE-GO TO TRUE                        03830060
038400             PERFORM 2100-CHECK-FUNCTION-KEY                      03840060
038500     END-EVALUATE.                                                03850060
038600                                                                  03860060
038700*----------------------------------------------------------------*03870060
038800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*03880060
038900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *03890060
039000* CICS ARCHITECTURE API.                                         *03900060
039100*----------------------------------------------------------------*03910060
039200 2100-CHECK-FUNCTION-KEY.                                         03920060
039300                                                                  03930060
039400     EVALUATE TRUE                                                03940060
039500         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               03950060
039600             IF ASC-EFFECTIVE-ROW-EXISTS                          03960060
039700                 SET DP030-OVERRIDE-GO                            03970060
039800                     DP030-SET-CURSOR-TRAILER                     03980060
039900                     DP020-MSG-FATAL  TO TRUE                     03990060
040000                 MOVE PC-TSYMSG-03367 TO DP020-MSG-NUMBER         04000060
040100             ELSE                                                 04010060
040200                 MOVE ASC-KEY-ENT-ID      TO VNT00001-ENT-ID      04020060
040300                                             DK-ENT-ID            04030060
040400                 MOVE ASC-KEY-CAPBLTY-CDE TO VNT00001-VND-CPBL-CDE04040060
040500                 SET PS-CPBLTY-ADD        TO TRUE                 04050060
040600                 IF ASC-EFF-DATE = ASC-CURRENT-DATE               04060060
040700                     PERFORM 7100-UPDATE-CURRENT-CAPABILITY       04070060
040800                 ELSE                                             04080060
040900                     PERFORM 7000-ADD-CAPABILITY                  04090060
041000                 END-IF                                           04100060
041100                 PERFORM 8000-CHECK-IN-RMS                        04110060
041400                 IF EXTENT-VND-IN-RMS-IND = 'Y'                   04140060
041500                     PERFORM 8100-LINK-TO-VNKCS024                04150060
041600                 END-IF                                           04160060
041700                 IF ASC-USE-SELECTION-QUEUE                       04170060
041800                     PERFORM 9100-READ-SEL-QUEUE                  04180060
041900                     SET VN019-ADD (ASC-SEL-SUB)                  04190060
042000                                       TO TRUE                    04200060
042100                     PERFORM 9200-REWRITE-LIST-QUEUE              04210060
042200                 END-IF                                           04220060
042300                 SET DP030-CONTINUE-GO                            04230060
042400                     DP020-MSG-INFORMATIONAL                      04240060
042500                     DP030-SET-CURSOR-TRAILER TO TRUE             04250060
042600                 IF PS-ERROR                                      04260060
042700                    CONTINUE                                      04270060
042800                 ELSE                                             04280060
042900                    MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER      04290060
043000                 END-IF                                           04300060
043100                 PERFORM 4000-BUILD-INITIAL-PANEL                 04310060
043200             END-IF                                               04320060
043300                                                                  04330060
043400         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               04340060
043500         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               04350060
043600             INITIALIZE VN018-INTER-APPL-COMMAREA                 04360060
043700             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    04370060
043800                            TO VN018-NUMBER-OF-SELECTED-ITEMS     04380060
043900             MOVE ASC-KEY-ENT-ID                                  04390060
044000                            TO VN018-ENT-ID                       04400060
044100             MOVE ASC-KEY-VENDOR-NAME  TO VN018-VENDOR-NAME       04410060
044200             MOVE ASC-KEY-VENDOR-ID    TO VN018-VENDOR-ID         04420060
044300             MOVE ASC-KEY-CAPBLTY-CDE  TO VN018-CAPBLTY-CDE       04430060
044400             MOVE ASC-KEY-CAPBLTY-NAME TO VN018-CAPBLTY-NAME      04440060
044500                                                                  04450060
044600         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               04460060
044700             IF ASC-EFFECTIVE-ROW-EXISTS                          04470060
044800                 MOVE ASC-KEY-ENT-ID      TO VNT00001-ENT-ID      04480060
044900                                             DK-ENT-ID            04490060
045000                 MOVE ASC-KEY-CAPBLTY-CDE TO VNT00001-VND-CPBL-CDE04500060
045100                 SET PS-CPBLTY-DELETE     TO TRUE                 04510060
045200                 PERFORM 7200-EXPIRE-CURRENT-CAPABILITY           04520060
045300                 PERFORM 8000-CHECK-IN-RMS                        04530060
045600                 IF EXTENT-VND-IN-RMS-IND = 'Y'                   04560060
045700                     PERFORM 8100-LINK-TO-VNKCS024                04570060
045800                 END-IF                                           04580060
045900                 IF ASC-USE-SELECTION-QUEUE                       04590060
046000                     PERFORM 9100-READ-SEL-QUEUE                  04600060
046100                     SET VN019-UPD (ASC-SEL-SUB)                  04610060
046200                                       TO TRUE                    04620060
046300                     PERFORM 9200-REWRITE-LIST-QUEUE              04630060
046400                 END-IF                                           04640060
046500                 SET DP030-CONTINUE-GO                            04650060
046600                     DP020-MSG-INFORMATIONAL                      04660060
046700                     DP030-SET-CURSOR-TRAILER TO TRUE             04670060
046710                 IF PS-ERROR                                      04671060
046720                    CONTINUE                                      04672060
046730                 ELSE                                             04673060
046740                    MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER      04674060
046750                 END-IF                                           04675060
046760                 PERFORM 4000-BUILD-INITIAL-PANEL                 04676060
046770             ELSE                                                 04677060
046780                 SET DP030-OVERRIDE-GO                            04678060
046790                     DP030-SET-CURSOR-TRAILER                     04679060
046800                     DP020-MSG-FATAL  TO TRUE                     04680060
046900                 MOVE PC-TSYMSG-03368 TO DP020-MSG-NUMBER         04690060
047000             END-IF                                               04700060
047100                                                                  04710060
047200         WHEN DP020-SRC-AID = DP016-ENTER                         04720060
047300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04730060
047400                                                                  04740060
047500         WHEN OTHER                                               04750060
047600             SET DP013-NO-ROLLBACK                                04760060
047700                 DP013-XCTL-DISPLAY-RESTART                       04770060
047800                 DP013-CICS-ABEND  TO TRUE                        04780060
047900             MOVE '2100-CHECK-FUNCTION-KEY'                       04790060
048000                                   TO DP013-PARAGRAPH             04800060
048100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04810060
048200                                   TO DP013-MESSAGE-TEXT (1)      04820060
048300             PERFORM DP013-0000-PROCESS-ABEND                     04830060
048400     END-EVALUATE.                                                04840060
048500                                                                  04850060
048600******************************************************************04860060
048700* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *04870060
048800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *04880060
048900******************************************************************04890060
049000 2300-GET-NEXT-MESSAGE.                                           04900060
049100                                                                  04910060
049200     ADD +1                        TO ASC-SEL-SUB.                04920060
049300     IF ASC-SEL-SUB > VN019-MAX-ITEMS                             04930060
049400         ADD +1                    TO ASC-SEL-ITEM                04940060
049500         MOVE +1                   TO ASC-SEL-SUB                 04950060
049600     END-IF.                                                      04960060
049700     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 04970060
049800         PERFORM 9100-READ-SEL-QUEUE                              04980060
049900         IF VN019-ITEM (ASC-SEL-SUB) > ZERO                       04990060
050000             MOVE VN019-CAPBLTY-CDE (ASC-SEL-SUB)                 05000060
050100                                   TO ASC-KEY-CAPBLTY-CDE         05010060
050200             MOVE VN019-CAPBLTY-NAME (ASC-SEL-SUB)                05020060
050300                                   TO ASC-KEY-CAPBLTY-NAME        05030060
050400             SET VN019-INQ (ASC-SEL-SUB)                          05040060
050500                                   TO TRUE                        05050060
050600             PERFORM 9200-REWRITE-LIST-QUEUE                      05060060
050700         ELSE                                                     05070060
050800             SUBTRACT +1 FROM ASC-SEL-SUB                         05080060
050900*            --- BOTTOM OF LIST ---                               05090060
051000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05100060
051100             SET DP020-MSG-INFORMATIONAL                          05110060
051200                                   TO TRUE                        05120060
051300         END-IF                                                   05130060
051400     ELSE                                                         05140060
051500         SUBTRACT +1 FROM ASC-SEL-ITEM                            05150060
051600         MOVE VN019-MAX-ITEMS      TO ASC-SEL-SUB                 05160060
051700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05170060
051800         SET DP020-MSG-INFORMATIONAL                              05180060
051900                                   TO TRUE                        05190060
052000     END-IF.                                                      05200060
052100                                                                  05210060
052200******************************************************************05220060
052300* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *05230060
052400* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *05240060
052500******************************************************************05250060
052600 2310-GET-PREV-MESSAGE.                                           05260060
052700                                                                  05270060
052800     SUBTRACT +1 FROM ASC-SEL-SUB.                                05280060
052900     IF ASC-SEL-SUB < +1                                          05290060
053000         SUBTRACT +1 FROM ASC-SEL-ITEM                            05300060
053100         MOVE VN019-MAX-ITEMS      TO ASC-SEL-SUB                 05310060
053200     END-IF.                                                      05320060
053300                                                                  05330060
053400     IF ASC-SEL-ITEM > ZERO                                       05340060
053500         PERFORM 9100-READ-SEL-QUEUE                              05350060
053600         MOVE VN019-CAPBLTY-CDE (ASC-SEL-SUB)                     05360060
053700                                   TO ASC-KEY-CAPBLTY-CDE         05370060
053800         MOVE VN019-CAPBLTY-NAME (ASC-SEL-SUB)                    05380060
053900                                   TO ASC-KEY-CAPBLTY-NAME        05390060
054000     ELSE                                                         05400060
054100         MOVE +1                   TO ASC-SEL-ITEM                05410060
054200                                      ASC-SEL-SUB                 05420060
054300*        --- TOP OF LIST ---                                      05430060
054400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05440060
054500         SET DP020-MSG-INFORMATIONAL                              05450060
054600                                   TO TRUE                        05460060
054700     END-IF.                                                      05470060
054800                                                                  05480060
054900*----------------------------------------------------------------*05490060
055000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *05500060
055100*    READ THE DATABASE FOR THE MOST RECENT ACTIVITY TO DISPLAY   *05510060
055200*    DISPLAY THE PANEL TO USER.                                  *05520060
055300*----------------------------------------------------------------*05530060
055400 4000-BUILD-INITIAL-PANEL.                                        05540060
055500                                                                  05550060
055600     SET DP030-SET-CURSOR-TRAILER  TO TRUE.                       05560060
055710     PERFORM 6000-GET-MAX-DATE.                                   05571060
055800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        05580060
055900                                                                  05590060
056000*----------------------------------------------------------------*05600060
056100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *05610060
056200*----------------------------------------------------------------*05620060
056300 4400-MOVE-COMMAREA-TO-SCREEN.                                    05630060
056400                                                                  05640060
056500     MOVE ASC-KEY-VENDOR-NAME      TO AVENDO.                     05650060
056600     MOVE ASC-KEY-VENDOR-ID        TO AVNDIDO.                    05660060
056700     MOVE ASC-DISPLAY-ENT-ID       TO AENTIDO.                    05670060
056800     MOVE ASC-KEY-CAPBLTY-NAME     TO ACPBLTYO.                   05680060
056900     EVALUATE ASC-INT-APPL-FORMAT-IND                             05690060
057000         WHEN PC-INTER-APPL-LIST-ADD                              05700060
057100         WHEN PC-INTER-APPL-DETAIL-ADD                            05710060
057200             IF ASC-NO-ROW-EXISTS OR ASC-EXPIRED-ROW-EXISTS       05720060
057300                 MOVE ASC-CURRENT-DATE   TO AEFFDTO               05730060
057400                 MOVE SPACES             TO AEXPDTO               05740060
057500                                            AADDDTO               05750060
057600                                            AUPDBYO               05760060
057700                                            AUPDDTO               05770060
057800             ELSE                                                 05780060
057900                 MOVE ASC-EFF-DATE       TO AEFFDTO               05790060
058000                 MOVE ASC-EXP-DATE       TO AEXPDTO               05800060
058100                 MOVE ASC-DATE-ADDED     TO AADDDTO               05810060
058200                 MOVE ASC-LAST-UPD-ID    TO AUPDBYO               05820060
058300                 MOVE ASC-LAST-UPD-DATE  TO AUPDDTO               05830060
058400             END-IF                                               05840060
058500         WHEN OTHER                                               05850060
058600             MOVE ASC-EFF-DATE           TO AEFFDTO               05860060
058700             MOVE ASC-EXP-DATE           TO AEXPDTO               05870060
058800             MOVE ASC-DATE-ADDED         TO AADDDTO               05880060
058900             MOVE ASC-LAST-UPD-ID        TO AUPDBYO               05890060
059000             MOVE ASC-LAST-UPD-DATE      TO AUPDDTO               05900060
059100     END-EVALUATE.                                                05910060
059200                                                                  05920060
059913*----------------------------------------------------------------*05991360
059914*  CHECK FOR DUPLICATE NAME.                                      05991460
059915*----------------------------------------------------------------*05991560
059916 6000-GET-MAX-DATE.                                               05991660
059917     SET ASC-NO-ROW-EXISTS         TO TRUE.                       05991760
059918     PERFORM                                                      05991860
059920         WITH TEST AFTER                                          05992060
060000         VARYING PV-RETRY-COUNTER                                 06000060
060100         FROM 1 BY 1                                              06010060
060200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06020060
060300                   OR (SQLCODE = ZERO)                            06030060
060400                   OR (SQLCODE = +100))                           06040060
060500                                                                  06050060
060600         EXEC SQL                                                 06060060
060700             SELECT  EFF_BEG_DTE                                  06070060
060800                    ,EFF_END_DTE                                  06080060
060900                    ,CRE_DTE                                      06090060
061000                    ,LAST_UPD_TMST                                06100060
061100                    ,LAST_UPD_BY_USR_ID                           06110060
061200               INTO  :VNT00001-EFF-BEG-DTE                        06120060
061300                    ,:VNT00001-EFF-END-DTE                        06130060
061400                    ,:VNT00001-CRE-DTE                            06140060
061500                    ,:VNT00001-LAST-UPD-TMST                      06150060
061600                    ,:VNT00001-LAST-UPD-BY-USR-ID                 06160060
061700               FROM VNT_VND_CPBL A                                06170060
061800              WHERE A.ENT_ID = :ASC-KEY-ENT-ID                    06180060
061900                AND A.VND_CPBL_CDE = :ASC-KEY-CAPBLTY-CDE         06190060
062000                AND A.EFF_END_DTE =                               06200060
062100                    (SELECT MAX(B.EFF_END_DTE)                    06210060
062200                       FROM VNT_VND_CPBL B                        06220060
062300                      WHERE A.ENT_ID = B.ENT_ID                   06230060
062400                        AND A.VND_CPBL_CDE = B.VND_CPBL_CDE)      06240060
062500         END-EXEC                                                 06250060
062600                                                                  06260060
062700         EVALUATE TRUE                                            06270060
062800             WHEN SQLCODE = ZERO                                  06280060
062900             WHEN SQLCODE = +100                                  06290060
063000             WHEN SQLCODE = -904                                  06300060
063100             WHEN SQLCODE = -913                                  06310060
063200                 CONTINUE                                         06320060
063300             WHEN SQLWARN0 NOT = SPACES                           06330060
063400             WHEN SQLCODE < ZERO                                  06340060
063500             WHEN SQLCODE > ZERO                                  06350060
063600                 MOVE '6000-GET-MAX-DATE'                         06360060
063700                                   TO DP013-PARAGRAPH             06370060
063800                 MOVE 'SELECT CAPABILITY DATA FOR ENT:'           06380060
063900                                   TO DP013-MESSAGE-TEXT (1)      06390060
064000                 MOVE ASC-DISPLAY-ENT-ID                          06400060
064100                                   TO DP013-MESSAGE-TEXT (2)      06410060
064200                 MOVE SQLCA        TO DP013-SQLCA                 06420060
064300                 MOVE 'VNT_VND_CPBL'                              06430060
064400                                   TO DP013-DB2-TABLE-NAME (1)    06440060
064500                 SET DP013-DB2-ABEND                              06450060
064600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06460060
064700                 PERFORM DP013-0000-PROCESS-ABEND                 06470060
064800         END-EVALUATE                                             06480060
064900     END-PERFORM.                                                 06490060
065000                                                                  06500060
065100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06510060
065200         MOVE '6000-GET-MAX-DATE'  TO DP013-PARAGRAPH             06520060
065300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06530060
065400                                   TO DP013-MESSAGE-TEXT (1)      06540060
065500         MOVE 'CAPABILITY FOR ENT-ID'                             06550060
065600                                   TO DP013-MESSAGE-TEXT (2)      06560060
065700         MOVE ASC-DISPLAY-ENT-ID   TO DP013-MESSAGE-TEXT (3)      06570060
065800         MOVE SQLCA                TO DP013-SQLCA                 06580060
065900         MOVE 'VNT_VND_CPBL'       TO DP013-DB2-TABLE-NAME (1)    06590060
066000         SET DP013-DB2-ABEND                                      06600060
066100             DP013-XCTL-DISPLAY-RESTART                           06610060
066200                                   TO TRUE                        06620060
066300         PERFORM DP013-0000-PROCESS-ABEND                         06630060
066400     END-IF.                                                      06640060
066500                                                                  06650060
066600     IF SQLCODE = ZERO                                            06660060
066700         MOVE VNT00001-EFF-BEG-DTE(6:2)   TO PV-WORK-MM           06670060
066800         MOVE VNT00001-EFF-BEG-DTE(9:2)   TO PV-WORK-DD           06680060
066900         MOVE VNT00001-EFF-BEG-DTE(1:4)   TO PV-WORK-YYYY         06690060
067000         MOVE PV-WORK-DATE                TO ASC-EFF-DATE         06700060
067100         MOVE VNT00001-EFF-END-DTE(6:2)   TO PV-WORK-MM           06710060
067200         MOVE VNT00001-EFF-END-DTE(9:2)   TO PV-WORK-DD           06720060
067300         MOVE VNT00001-EFF-END-DTE(1:4)   TO PV-WORK-YYYY         06730060
067400         MOVE PV-WORK-DATE                TO ASC-EXP-DATE         06740060
067500         MOVE VNT00001-CRE-DTE(6:2)       TO PV-WORK-MM           06750060
067600         MOVE VNT00001-CRE-DTE(9:2)       TO PV-WORK-DD           06760060
067700         MOVE VNT00001-CRE-DTE(1:4)       TO PV-WORK-YYYY         06770060
067800         MOVE PV-WORK-DATE                TO ASC-DATE-ADDED       06780060
067900         MOVE VNT00001-LAST-UPD-TMST(6:2) TO PV-WORK-MM           06790060
068000         MOVE VNT00001-LAST-UPD-TMST(9:2) TO PV-WORK-DD           06800060
068100         MOVE VNT00001-LAST-UPD-TMST(1:4) TO PV-WORK-YYYY         06810060
068200         MOVE PV-WORK-DATE                TO ASC-LAST-UPD-DATE    06820060
068300         MOVE VNT00001-LAST-UPD-BY-USR-ID TO ASC-LAST-UPD-ID      06830060
068400         IF ASC-EXP-DATE = PC-MAX-DATE                            06840060
068500             SET ASC-EFFECTIVE-ROW-EXISTS TO TRUE                 06850060
068600         ELSE                                                     06860060
068700             SET ASC-EXPIRED-ROW-EXISTS   TO TRUE                 06870060
068800         END-IF                                                   06880060
068900     ELSE                                                         06890060
069000         MOVE SPACES                      TO ASC-EFF-DATE         06900060
069100                                             ASC-EXP-DATE         06910060
069200     END-IF.                                                      06920060
069300                                                                  06930060
069400*----------------------------------------------------------------*06940060
069500*    INSERT A CAPABILITY ROW                                     *06950060
069600*----------------------------------------------------------------*06960060
069700*                                                                 06970060
069800 7000-ADD-CAPABILITY.                                             06980060
069900                                                                  06990060
070000     PERFORM                                                      07000060
070100         WITH TEST AFTER                                          07010060
070200         VARYING PV-RETRY-COUNTER                                 07020060
070300         FROM 1 BY 1                                              07030060
070400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07040060
070500             OR (SQLCODE = +0))                                   07050060
070600                                                                  07060060
070700         EXEC SQL                                                 07070060
070800              INSERT INTO VNT_VND_CPBL                            07080060
070900                     ( ENT_ID                                     07090060
071000                      ,VND_CPBL_CDE                               07100060
071100                      ,EFF_BEG_DTE                                07110060
071200                      ,EFF_END_DTE                                07120060
071300                      ,CRE_DTE                                    07130060
071400                      ,LAST_UPD_TMST                              07140060
071500                      ,LAST_UPD_BY_USR_ID)                        07150060
071600              VALUES ( :VNT00001-ENT-ID                           07160060
071700                      ,:VNT00001-VND-CPBL-CDE                     07170060
071800                      ,CURRENT DATE                               07180060
071900                      ,:PC-MAX-DATE-ISO                           07190060
072000                      ,CURRENT DATE                               07200060
072100                      ,CURRENT TIMESTAMP                          07210060
072200                      ,:DP020-USERID)                             07220060
072300         END-EXEC                                                 07230060
072400                                                                  07240060
072500         EVALUATE TRUE                                            07250060
072600             WHEN SQLCODE = +0                                    07260060
072700             WHEN SQLCODE = -904                                  07270060
072800             WHEN SQLCODE = -913                                  07280060
072900                  CONTINUE                                        07290060
073000                                                                  07300060
073100             WHEN SQLWARN0 NOT = SPACES                           07310060
073200             WHEN SQLCODE < +0                                    07320060
073300             WHEN SQLCODE > +0                                    07330060
073400                  MOVE '7000-ADD-CAPABILITY'                      07340060
073500                                  TO DP013-PARAGRAPH              07350060
073600                  MOVE 'UNSUCCESSFUL INSERT FOR VNT_VND_CPBL'     07360060
073700                                  TO DP013-MESSAGE-TEXT (1)       07370060
073800                  MOVE SQLCA      TO DP013-SQLCA                  07380060
073900                  MOVE 'VNT_VND_CPBL'                             07390060
074000                                  TO DP013-DB2-TABLE-NAME (1)     07400060
074100                  SET DP013-DB2-ABEND                             07410060
074200                      DP013-XCTL-DISPLAY-RESTART                  07420060
074300                                  TO TRUE                         07430060
074400                  PERFORM DP013-0000-PROCESS-ABEND                07440060
074500         END-EVALUATE                                             07450060
074600     END-PERFORM.                                                 07460060
074700                                                                  07470060
074800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07480060
074900         MOVE '7000-ADD-CAPABILITY'                               07490060
075000                                  TO DP013-PARAGRAPH              07500060
075100         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON VNT_VND_CPBL'   07510060
075200                                  TO DP013-MESSAGE-TEXT (1)       07520060
075300         MOVE SQLCA               TO DP013-SQLCA                  07530060
075400         MOVE 'VNT_VND_CPBL'      TO DP013-DB2-TABLE-NAME (1)     07540060
075500         SET DP013-DB2-ABEND                                      07550060
075600             DP013-XCTL-DISPLAY-RESTART                           07560060
075700                                  TO TRUE                         07570060
075800         PERFORM DP013-0000-PROCESS-ABEND                         07580060
075900     END-IF.                                                      07590060
076000                                                                  07600060
076100*----------------------------------------------------------------*07610060
076200*   UPDATE THE MOST RECENTLY EXPIRED ROW TO BE EFFECTIVE.        *07620060
076300*   THIS IS DONE ONLY WHEN THE EFFECTIVE BEGIN DATE IS THE       *07630060
076400*   CURRENT DATE, BECAUSE EXPIRING THAT ROW AND INSERTING A NEW  *07640060
076500*   CURRENT EFFECTIVE ROW WITH CURRENT DATE AS THE EFFECTIVE DATE*07650060
076600*   WOULD RESULT IN A DUPLICATE INSERT                           *07660060
076700*----------------------------------------------------------------*07670060
076800 7100-UPDATE-CURRENT-CAPABILITY.                                  07680060
076900                                                                  07690060
077000     PERFORM                                                      07700060
077100         WITH TEST AFTER                                          07710060
077200         VARYING PV-RETRY-COUNTER                                 07720060
077300         FROM 1 BY 1                                              07730060
077400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07740060
077500             OR (SQLCODE = +0))                                   07750060
077600                                                                  07760060
077700         EXEC SQL                                                 07770060
077800              UPDATE VNT_VND_CPBL                                 07780060
077900                 SET EFF_END_DTE        = :PC-MAX-DATE-ISO        07790060
078000                    ,CRE_DTE            = CURRENT DATE            07800060
078100                    ,LAST_UPD_TMST      = CURRENT TIMESTAMP       07810060
078200                    ,LAST_UPD_BY_USR_ID = :DP020-USERID           07820060
078300               WHERE ENT_ID             = :VNT00001-ENT-ID        07830060
078400                 AND VND_CPBL_CDE       = :VNT00001-VND-CPBL-CDE  07840060
078500                 AND EFF_BEG_DTE        = CURRENT DATE            07850060
078600         END-EXEC                                                 07860060
078700                                                                  07870060
078800         EVALUATE TRUE                                            07880060
078900             WHEN SQLCODE = +0                                    07890060
079000             WHEN SQLCODE = -904                                  07900060
079100             WHEN SQLCODE = -913                                  07910060
079200                  CONTINUE                                        07920060
079300                                                                  07930060
079400             WHEN SQLWARN0 NOT = SPACES                           07940060
079500             WHEN SQLCODE < +0                                    07950060
079600             WHEN SQLCODE > +0                                    07960060
079700                  MOVE '7100-UPDATE-CURRENT-CAPABILITY'           07970060
079800                                  TO DP013-PARAGRAPH              07980060
079900                  MOVE 'UNSUCCESSFUL UPDATE FOR VNT_VND_CPBL'     07990060
080000                                  TO DP013-MESSAGE-TEXT (1)       08000060
080100                  MOVE SQLCA      TO DP013-SQLCA                  08010060
080200                  MOVE 'VNT_VND_CPBL'                             08020060
080300                                  TO DP013-DB2-TABLE-NAME (1)     08030060
080400                  SET DP013-DB2-ABEND                             08040060
080500                      DP013-XCTL-DISPLAY-RESTART                  08050060
080600                                  TO TRUE                         08060060
080700                  PERFORM DP013-0000-PROCESS-ABEND                08070060
080800         END-EVALUATE                                             08080060
080900     END-PERFORM.                                                 08090060
081000                                                                  08100060
081100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08110060
081200         MOVE '7100-UPDATE-CURRENT-CAPABILITY'                    08120060
081300                                  TO DP013-PARAGRAPH              08130060
081400         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE ON VNT_VND_CPBL'   08140060
081500                                  TO DP013-MESSAGE-TEXT (1)       08150060
081600         MOVE SQLCA               TO DP013-SQLCA                  08160060
081700         MOVE 'VNT_VND_CPBL'      TO DP013-DB2-TABLE-NAME (1)     08170060
081800         SET DP013-DB2-ABEND                                      08180060
081900             DP013-XCTL-DISPLAY-RESTART                           08190060
082000                                  TO TRUE                         08200060
082100         PERFORM DP013-0000-PROCESS-ABEND                         08210060
082200     END-IF.                                                      08220060
082300                                                                  08230060
082400*----------------------------------------------------------------*08240060
082500*   EXPIRE THE CURRENTLY EFFECTIVE ROW FOR THIS CAPABILITY.      *08250060
082600*----------------------------------------------------------------*08260060
082700 7200-EXPIRE-CURRENT-CAPABILITY.                                  08270060
082800                                                                  08280060
082900     PERFORM                                                      08290060
083000         WITH TEST AFTER                                          08300060
083100         VARYING PV-RETRY-COUNTER                                 08310060
083200         FROM 1 BY 1                                              08320060
083300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08330060
083400             OR (SQLCODE = +0))                                   08340060
083500                                                                  08350060
083600         EXEC SQL                                                 08360060
083700              UPDATE VNT_VND_CPBL                                 08370060
083800                 SET EFF_END_DTE        = CURRENT DATE            08380060
083900                    ,LAST_UPD_TMST      = CURRENT TIMESTAMP       08390060
084000                    ,LAST_UPD_BY_USR_ID = :DP020-USERID           08400060
084100               WHERE ENT_ID             = :VNT00001-ENT-ID        08410060
084200                 AND VND_CPBL_CDE       = :VNT00001-VND-CPBL-CDE  08420060
084300                 AND EFF_END_DTE        = :PC-MAX-DATE-ISO        08430060
084400         END-EXEC                                                 08440060
084500                                                                  08450060
084600         EVALUATE TRUE                                            08460060
084700             WHEN SQLCODE = +0                                    08470060
084800             WHEN SQLCODE = -904                                  08480060
084900             WHEN SQLCODE = -913                                  08490060
085000                  CONTINUE                                        08500060
085100                                                                  08510060
085200             WHEN SQLWARN0 NOT = SPACES                           08520060
085300             WHEN SQLCODE < +0                                    08530060
085400             WHEN SQLCODE > +0                                    08540060
085500                  MOVE '7200-EXPIRE-CURRENT-CAPABILITY'           08550060
085600                                  TO DP013-PARAGRAPH              08560060
085700                  MOVE 'UNSUCCESSFUL UPDATE FOR VNT_VND_CPBL'     08570060
085800                                  TO DP013-MESSAGE-TEXT (1)       08580060
085900                  MOVE SQLCA      TO DP013-SQLCA                  08590060
086000                  MOVE 'VNT_VND_CPBL'                             08600060
086100                                  TO DP013-DB2-TABLE-NAME (1)     08610060
086200                  SET DP013-DB2-ABEND                             08620060
086300                      DP013-XCTL-DISPLAY-RESTART                  08630060
086400                                  TO TRUE                         08640060
086500                  PERFORM DP013-0000-PROCESS-ABEND                08650060
086600         END-EVALUATE                                             08660060
086700     END-PERFORM.                                                 08670060
086800                                                                  08680060
086900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08690060
087000         MOVE '7200-EXPIRE-CURRENT-CAPABILITY'                    08700060
087100                                  TO DP013-PARAGRAPH              08710060
087200         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE ON VNT_VND_CPBL'   08720060
087300                                  TO DP013-MESSAGE-TEXT (1)       08730060
087400         MOVE SQLCA               TO DP013-SQLCA                  08740060
087500         MOVE 'VNT_VND_CPBL'      TO DP013-DB2-TABLE-NAME (1)     08750060
087600         SET DP013-DB2-ABEND                                      08760060
087700             DP013-XCTL-DISPLAY-RESTART                           08770060
087800                                  TO TRUE                         08780060
087900         PERFORM DP013-0000-PROCESS-ABEND                         08790060
088000     END-IF.                                                      08800060
088100                                                                  08810060
088200 8000-CHECK-IN-RMS.                                               08820060
088300                                                                  08830060
088400     PERFORM                                                      08840060
088500         WITH TEST AFTER                                          08850060
088600         VARYING PV-RETRY-COUNTER                                 08860060
088700         FROM 1 BY 1                                              08870060
088800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08880060
088900            OR (SQLCODE = +0))                                    08890060
089000                                                                  08900060
089100         EXEC SQL                                                 08910060
089200             SELECT DUN_NBR                                       08920060
089300                  , VND_IN_RMS_IND                                08930060
089400              INTO  :PV-DUN-NBR                                   08940060
089500                  , :EXTENT-VND-IN-RMS-IND                        08950060
089600              FROM  TEXTENT                                       08960060
089700              WHERE ENT_ID   = :DK-ENT-ID                         08970060
089800         END-EXEC                                                 08980060
089900                                                                  08990060
090000         EVALUATE TRUE                                            09000060
090100             WHEN SQLCODE = +0                                    09010060
090200             WHEN SQLCODE = -904                                  09020060
090300             WHEN SQLCODE = -913                                  09030060
090400                 CONTINUE                                         09040060
090500             WHEN SQLWARN0 NOT = SPACE                            09050060
090600             WHEN SQLCODE < +0                                    09060060
090700             WHEN SQLCODE > +0                                    09070060
090800                 MOVE '8000-CHECK-IN-RMS'                         09080060
090900                                 TO DP013-PARAGRAPH               09090060
091000                 MOVE 'SELECT ON VENDOR DUNS NUMBER'              09100060
091100                                 TO DP013-MESSAGE-TEXT (1)        09110060
091200                 MOVE SQLCA      TO DP013-SQLCA                   09120060
091300                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)      09130060
091400                     SET DP013-DB2-ABEND                          09140060
091500                         DP013-XCTL-DISPLAY-RESTART               09150060
091600                                 TO TRUE                          09160060
091700                 PERFORM DP013-0000-PROCESS-ABEND                 09170060
091800         END-EVALUATE                                             09180060
091900     END-PERFORM.                                                 09190060
092000                                                                  09200060
092100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09210060
092200         MOVE '8000-CHECK-IN-RMS' TO DP013-PARAGRAPH              09220060
092300         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TEXTENT'        09230060
092400                                   TO DP013-MESSAGE-TEXT (1)      09240060
092500         MOVE SQLCA                TO DP013-SQLCA                 09250060
092600         SET DP013-DB2-ABEND       TO TRUE                        09260060
092700         PERFORM DP013-0000-PROCESS-ABEND                         09270060
092800     END-IF.                                                      09280060
092900                                                                  09290060
093000 8100-LINK-TO-VNKCS024.                                           09300060
093100                                                                  09310060
093200     INITIALIZE VN007-INTERFACE-MESSAGE-PARMS.                    09320060
093300                                                                  09330060
093400     MOVE PV-DUN-NBR                TO VN007-VND-NBR.             09340060
093500     MOVE ASC-KEY-ENT-ID            TO VN007-ENT-ID.              09350060
093600     MOVE ASC-KEY-CAPBLTY-CDE       TO VN007-CPBLTY-CDE(1).       09360060
093700     IF PS-CPBLTY-ADD                                             09370060
093800         SET VN007-CPBLTY-ADD(1)    TO TRUE                       09380060
093900     ELSE                                                         09390060
094000         SET VN007-CPBLTY-DELETE(1) TO TRUE                       09400060
094100     END-IF.                                                      09410060
094200     EXEC CICS LINK PROGRAM (PC-VNKCS024)                         09420060
094300                   COMMAREA (VN007-COMMAREA)                      09430060
094400                       RESP (PV-CICS-RESP)                        09440060
094500     END-EXEC.                                                    09450060
094600                                                                  09460060
094700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       09470060
094800         CONTINUE                                                 09480060
094900     ELSE                                                         09490060
095000        MOVE VN007-PROGRAM-NAME   TO DP013-PROGRAM                09500060
095100        MOVE VN007-PARAGRAPH-NAME TO DP013-PARAGRAPH              09510060
095200        MOVE VN007-MESSAGE        TO DP013-MESSAGE-TEXT (1)       09520060
095300        MOVE VN007-REASON-CODE    TO DP013-SQLCA                  09530060
095400        SET DP013-DB2-ABEND                                       09540060
095500            DP013-ROLLBACK                                        09550060
095600            DP013-XCTL-DISPLAY-RESTART TO TRUE                    09560060
095700        PERFORM DP013-0000-PROCESS-ABEND                          09570060
095800     END-IF.                                                      09580060
095900******************************************************************09590060
096000* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *09600060
096100******************************************************************09610060
096200 9100-READ-SEL-QUEUE.                                             09620060
096300                                                                  09630060
096400     EXEC CICS                                                    09640060
096500         READQ TS                                                 09650060
096600             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        09660060
096700             INTO  (VN019-CAPABILITY-REC)                         09670060
096800             ITEM  (ASC-SEL-ITEM)                                 09680060
096900             RESP  (PV-CICS-RESP)                                 09690060
097000     END-EXEC.                                                    09700060
097100                                                                  09710060
097200     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        09720060
097300         CONTINUE                                                 09730060
097400     ELSE                                                         09740060
097500         SET DP013-LOGIC-ABEND                                    09750060
097600             DP013-NO-ROLLBACK     TO TRUE                        09760060
097700         MOVE '9100-READ-SEL-QUEUE'                               09770060
097800                                   TO DP013-PARAGRAPH             09780060
097900         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    09790060
098000                                   TO DP013-MESSAGE-TEXT (1)      09800060
098100         PERFORM DP013-0000-PROCESS-ABEND                         09810060
098200     END-IF.                                                      09820060
098300                                                                  09830060
098400******************************************************************09840060
098500* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *09850060
098600******************************************************************09860060
098700 9200-REWRITE-LIST-QUEUE.                                         09870060
098800                                                                  09880060
098900     EXEC CICS                                                    09890060
099000          WRITEQ TS                                               09900060
099100              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     09910060
099200              FROM    (VN019-CAPABILITY-REC)                      09920060
099300              ITEM    (ASC-SEL-ITEM)                              09930060
099400              RESP    (PV-CICS-RESP)                              09940060
099500              REWRITE                                             09950060
099600     END-EXEC.                                                    09960060
099700                                                                  09970060
099800     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    09980060
099900         SET DP013-CICS-ABEND                                     09990060
100000             DP013-NO-ROLLBACK     TO TRUE                        10000060
100100         MOVE '9200-REWRITE-LIST-QUEUE'                           10010060
100200                                   TO DP013-PARAGRAPH             10020060
100300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   10030060
100400                                   TO DP013-MESSAGE-TEXT (1)      10040060
100500         PERFORM DP013-0000-PROCESS-ABEND                         10050060
100600     END-IF.                                                      10060060
100700                                                                  10070060
101299*---------------------------------------------------------------- 10129960
101300*    ABEND PROCESSOR MODULE                                       10130060
101400*---------------------------------------------------------------- 10140060
101500     COPY DPPD013.                                                10150060
101600*---------------------------------------------------------------- 10160060
