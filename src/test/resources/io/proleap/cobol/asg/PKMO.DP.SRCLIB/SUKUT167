000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.    SUKUT167.                                         00040000
000500 AUTHOR.        GERMAN BANDA.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   JUNE, 2020.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*  THIS PROGRAM WILL FETCH CARTONS SCANNED AT THE STORE FOR A     00100000
001100*  THAT ARE RELATED TO A SET CODE FOR THE PREVIOUS DAY.           00110000
001110*  THE SET CODE(S) WILL BE DETERMINED BY A LOOKUP OF              00111000
001200*  INTERGRATION PARM (PKHLDSET).                                  00120000
001300*  FOR EACH OUTBOUND CARTON RETURNED FROM THE MAIN CURSOR,        00130000
001400*  A SECOND CURSOR WILL BE OPENED TO RETURN AND WRITE OUTBOUND    00140000
001500*  CARTON DETAILS.                                                00150000
001800******************************************************************00180000
001900******************************************************************00190000
002000*  CHANGE LOG                                                     00200000
002100*  DATE       CHANGED BY    DESC                                  00210000
002200*  ---------- ------------- --------------------------------------00220000
002300*  00-00-2020 GERMAN BANDA  INITIAL PROGRAM FOR PACK AND HOLD     00230000
002400*                           PROCESSING FOR INVENTORY              00240000
003100******************************************************************00310000
003200 ENVIRONMENT DIVISION.                                            00320000
003300 CONFIGURATION SECTION.                                           00330000
003400                                                                  00340000
003500 SOURCE-COMPUTER.        IBM-3090.                                00350000
003600 OBJECT-COMPUTER.        IBM-3090.                                00360000
003700                                                                  00370000
003800 INPUT-OUTPUT SECTION.                                            00380000
003900 FILE-CONTROL.                                                    00390000
003910                                                                  00391009
004000     SELECT BATCH-DATE-IN                                         00400009
004100         ASSIGN TO INP01.                                         00410009
004300                                                                  00430000
004400     SELECT CARTON-DETAIL-FILE                                    00440000
004500         ASSIGN TO OUT01.                                         00450000
004600                                                                  00460000
004900                                                                  00490000
005000******************************************************************00500000
005100 DATA DIVISION.                                                   00510000
005200 FILE SECTION.                                                    00520000
005300                                                                  00530000
005310 FD  BATCH-DATE-IN                                                00531001
005320     RECORDING MODE IS F                                          00532001
005330     LABEL RECORDS ARE STANDARD                                   00533001
005340     BLOCK CONTAINS 0 RECORDS.                                    00534001
005350                                                                  00535001
005360 01  BATCH-DATE-RECORD-IN               PIC  X(80).               00536001
006000*                                                                 00600000
006100 FD  CARTON-DETAIL-FILE                                           00610000
006200     RECORDING MODE IS F                                          00620000
006300     LABEL RECORDS ARE STANDARD                                   00630000
006400     BLOCK CONTAINS 0 RECORDS.                                    00640000
006500                                                                  00650000
006600 01  CARTON-DETAIL-RECORD    PIC  X(130).                         00660022
006700*                                                                 00670000
007500******************************************************************00750000
007600 WORKING-STORAGE SECTION.                                         00760000
007700******************************************************************00770000
008400******************************************************************00840000
008500*  CARTON OUTPUT FILE LAYOUT                                      00850000
008600******************************************************************00860000
008700     COPY SURD170.                                                00870004
008800                                                                  00880000
009500******************************************************************00950000
009600*  DB2 FORMATTED MESSAGE AREA                                     00960000
009700******************************************************************00970000
009800     COPY DPWS004.                                                00980000
009900*                                                                 00990000
010000******************************************************************01000000
010100*  COMMUNICATIONS AREA FOR DB2                                    01010000
010200******************************************************************01020000
010300     EXEC SQL                                                     01030000
010400          INCLUDE SQLCA                                           01040000
010500     END-EXEC.                                                    01050000
010600*                                                                 01060000
010700******************************************************************01070000
010800*    SUT_OTBND_STR_SCN TABLE                                      01080000
010900******************************************************************01090000
011000     EXEC SQL                                                     01100000
011100          INCLUDE SUT00121                                        01110000
011200     END-EXEC.                                                    01120000
011300                                                                  01130000
011400******************************************************************01140000
011500*    SUT_OTBND_CART TABLE                                         01150002
011600******************************************************************01160000
011700     EXEC SQL                                                     01170000
011800          INCLUDE SUT00024                                        01180002
011900     END-EXEC.                                                    01190000
012000                                                                  01200000
012010******************************************************************01201002
012020*    SUT_OTBND_UPC UPC TABLE                                      01202002
012030******************************************************************01203002
012040     EXEC SQL                                                     01204002
012050          INCLUDE SUT00028                                        01205002
012060     END-EXEC.                                                    01206002
012070                                                                  01207002
012100******************************************************************01210000
012200*    TPURCHS  TABLE                                               01220002
012300******************************************************************01230000
012400     EXEC SQL                                                     01240000
012500          INCLUDE TPURCHS                                         01250002
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
012800******************************************************************01280000
012900*    TPURITM  TABLE                                               01290002
013000******************************************************************01300000
013100     EXEC SQL                                                     01310000
013200          INCLUDE TPURITM                                         01320002
013300     END-EXEC.                                                    01330000
013400                                                                  01340000
013410******************************************************************01341009
013420*    XLT_SKU TABLE                                                01342009
013430******************************************************************01343009
013440     EXEC SQL                                                     01344009
013450          INCLUDE XLT00003                                        01345009
013460     END-EXEC.                                                    01346009
013470                                                                  01347009
013480******************************************************************01348009
013490*    XLT_UPC TABLE                                                01349009
013491******************************************************************01349109
013492     EXEC SQL                                                     01349209
013493          INCLUDE XLT00006                                        01349309
013494     END-EXEC.                                                    01349409
013495                                                                  01349509
013500******************************************************************01350000
013600*     WST_INTGRTN_TYP TABLE                                       01360002
013700******************************************************************01370000
013800     EXEC SQL                                                     01380000
013900          INCLUDE WST00008                                        01390002
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200******************************************************************01420000
014300*     WST_ATTR_DEFN TABLE                                         01430002
014400******************************************************************01440000
014500     EXEC SQL                                                     01450000
014600          INCLUDE WST00009                                        01460002
014700     END-EXEC.                                                    01470000
014800                                                                  01480000
014900******************************************************************01490000
015000*    WST_ATTR_ELEM TABLE                                          01500002
015100******************************************************************01510000
015200     EXEC SQL                                                     01520000
015300          INCLUDE WST00010                                        01530002
015400     END-EXEC.                                                    01540000
018500******************************************************************01850000
018600 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01860000
018700                                                   COMP SYNC.     01870000
018710 01  PV-INPUT-FILE.                                               01871002
018720     05  BTCH-RUN-DATE               PIC  X(10)    VALUE SPACES.  01872002
018730     05  FILLER                      PIC  X(70)    VALUE SPACES.  01873002
018740                                                                  01874002
018800                                                                  01880000
018900 01  PS-PROGRAM-SWITCHES.                                         01890000
019000     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     01900002
019100         88  PS-END-OF-CONTROL                     VALUE 'Y'.     01910002
019200         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     01920002
019300     05  PS-END-OF-SCAN-CTN-CSR-SW   PIC  X(01)    VALUE 'N'.     01930000
019400         88  PS-END-OF-SCAN-CTN-CSR                VALUE 'Y'.     01940000
019500         88  PS-NOT-END-OF-SCAN-CTN-CSR            VALUE 'N'.     01950000
019600     05  PS-END-OF-CRTN-DETL-CSR-SW  PIC  X(01)    VALUE 'N'.     01960006
019700         88  PS-END-OF-CRTN-DETL-CSR               VALUE 'Y'.     01970006
019800         88  PS-NOT-END-OF-CRTN-DETL-CSR           VALUE 'N'.     01980006
020500                                                                  02050000
020600 01  PC-PROGRAM-CONSTANTS.                                        02060000
020700     05  PC-A                        PIC  X(01)    VALUE 'A'.     02070000
020800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT167'. 02080000
020900     05  PC-CURRENT-TIMESTAMP        PIC  X(26) VALUE SPACES.     02090006
021000                                                                  02100000
021100 01  PV-PROGRAM-VARIABLES.                                        02110000
021200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  02120000
021300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  02130000
021600     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             02160000
021700     05  PV-PURGE-TIMESTAMP          PIC  X(26)    VALUE SPACE.   02170006
021800     05  PV-SEASET-YR                PIC   X(4)    VALUE SPACE.   02180006
021900     05  PV-SEASET-SHRT-NM           PIC   X(5)    VALUE SPACE.   02190006
022000     05  PV-DISPLAY-CARTON           PIC  9(18)    VALUE ZEROES.  02200009
022200                                                                  02220000
022300 01  COUNTERS.                                                    02230000
022400     05  PV-SCN-CRTN-COUNTER         PIC  S9(9) COMP-3.           02240008
022410     05  PV-SCN-DETL-COUNTER         PIC  S9(9) COMP-3.           02241008
022500     05  PV-RECORDS-WRITTEN          PIC  S9(9) COMP-3.           02250008
022600     05  PV-CARTON-COUNT             PIC  S9(9) COMP-3.           02260000
022800                                                                  02280000
022900*---------------------------------------------------------------* 02290000
023000*    SCAN-CTN CURSOR                                              02300000
023100*---------------------------------------------------------------* 02310000
023200     EXEC SQL                                                     02320000
023300        DECLARE SCAN-CTN-CSR CURSOR FOR                           02330002
023400        SELECT DISTINCT                                           02340002
023410             D.SHIPT_UNT_ID                                       02341002
023411           , E.CRE_TMST                                           02341105
023412           , E.SCN_LOC_NBR                                        02341205
023413           , E.SCN_TYP_CDE                                        02341305
023414           , A.SEASET_YR                                          02341406
023415           , A.SEASET_SHRT_NM                                     02341506
023500        FROM TPURCHS           A                                  02350002
023600           , TPURITM           B                                  02360002
023700           , SUT_OTBND_UPC     C                                  02370002
023800           , SUT_OTBND_CART    D                                  02380002
023900           , SUT_OTBND_STR_SCN E                                  02390002
023910           , WST_INTGRTN_TYP  AA                                  02391002
023920           , WST_ATTR_DEFN    BB                                  02392002
023930           , WST_ATTR_ELEM    CC                                  02393002
023940           , WST_ATTR_ELEM    DD                                  02394002
023950           , WST_ATTR_ELEM    EE                                  02395002
023960           , WST_ATTR_ELEM    FF                                  02396002
023970           , WST_ATTR_ELEM    GG                                  02397002
023980           , WST_ATTR_ELEM    HH                                  02398002
023990        WHERE A.VER_STATUS_CDE = 'A'                              02399002
023991           AND B.PO_NBR         = A.PO_NBR                        02399102
023992           AND B.VER_STATUS_CDE = 'A'                             02399202
023993           AND C.TRN_NBR        = B.PO_NBR                        02399302
023994           AND C.TRN_LNE_NBR    = B.PO_LNE_NBR                    02399402
023995           AND C.SHPD_UNT_QTY   > 0                               02399502
023996           AND D.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                  02399602
023997           AND D.SHIPT_UNT_ID   = E.SHIPT_UNT_ID                  02399702
023998           AND D.ACTV_IND       = 'Y'                             02399802
023999           AND E.SCN_TYP_CDE        <> 'SSMS'                     02399905
024000           AND DATE(E.CRE_TMST) = :BTCH-RUN-DATE                  02400016
024001           AND AA.INTGRTN_TYP_CDE   = 'PKHLDSET'                  02400102
024002           AND AA.INTGRTN_TYP_CDE   = BB.INTGRTN_TYP_CDE          02400202
024003           AND BB.ATTR_DEFN_SEQ_NBR = 1                           02400302
024004           AND BB.INTGRTN_TYP_CDE   = CC.INTGRTN_TYP_CDE          02400402
024005           AND CC.ATTR_DEFN_SEQ_NBR = 1                           02400502
024006           AND BB.INTGRTN_TYP_CDE   = DD.INTGRTN_TYP_CDE          02400602
024007           AND DD.ATTR_DEFN_SEQ_NBR = 2                           02400702
024008           AND BB.INTGRTN_TYP_CDE   = EE.INTGRTN_TYP_CDE          02400802
024009           AND EE.ATTR_DEFN_SEQ_NBR = 3                           02400902
024010           AND BB.INTGRTN_TYP_CDE   = FF.INTGRTN_TYP_CDE          02401002
024011           AND FF.ATTR_DEFN_SEQ_NBR = 4                           02401102
024012           AND BB.INTGRTN_TYP_CDE   = GG.INTGRTN_TYP_CDE          02401202
024013           AND GG.ATTR_DEFN_SEQ_NBR = 5                           02401302
024014           AND BB.INTGRTN_TYP_CDE   = HH.INTGRTN_TYP_CDE          02401402
024015           AND HH.ATTR_DEFN_SEQ_NBR = 6                           02401502
024016           AND CC.ATTR_ELEM_SEQ_NBR = DD.ATTR_ELEM_SEQ_NBR        02401602
024017           AND CC.ATTR_ELEM_SEQ_NBR = EE.ATTR_ELEM_SEQ_NBR        02401702
024018           AND CC.ATTR_ELEM_SEQ_NBR = FF.ATTR_ELEM_SEQ_NBR        02401802
024019           AND CC.ATTR_ELEM_SEQ_NBR = GG.ATTR_ELEM_SEQ_NBR        02401902
024020           AND CC.ATTR_ELEM_SEQ_NBR = HH.ATTR_ELEM_SEQ_NBR        02402002
024021           AND HH.ATTR_ELEM_TXT     = 'Y'                         02402102
024022           AND CC.ATTR_ELEM_TXT     = A.SEASET_YR                 02402202
024023           AND DD.ATTR_ELEM_TXT     = A.SEASET_SHRT_NM            02402302
024025           AND EE.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP           02402502
024026           AND FF.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP           02402602
024030        WITH UR                                                   02403000
024100     END-EXEC.                                                    02410000
024200                                                                  02420000
024300*---------------------------------------------------------------* 02430000
024400*    PO-RCVR CURSOR                                               02440000
024500*---------------------------------------------------------------* 02450000
024600     EXEC SQL                                                     02460000
024700         DECLARE CRTN-DETL-CSR CURSOR FOR                         02470006
024710         SELECT C.SEASET_YR                                       02471006
024720               , C.SEASET_SHRT_NM                                 02472006
024730               , B.DEST_LOC_NBR                                   02473006
024740               , A.TRN_NBR                                        02474006
024750               , A.RCVR_SEQ_NBR                                   02475006
024760               , E.SKU_NBR                                        02476006
024770               , A.SHPD_UNT_QTY                                   02477006
024771               , B.CART_SRC_CDE                                   02477111
024780         FROM SUT_OTBND_UPC A                                     02478006
024790            , SUT_OTBND_CART B                                    02479006
024791            , TPURCHS  C                                          02479106
024792            , XLT_UPC  D                                          02479206
024793            , XLT_SKU  E                                          02479306
024794         WHERE A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                    02479406
024795          AND  A.SHIPT_UNT_ID = :SUT00121-SHIPT-UNT-ID            02479506
024796          AND  A.SHPD_UNT_QTY > 0                                 02479606
024797          AND  B.ACTV_IND   = 'Y'                                 02479706
024798          AND  A.TRN_NBR = C.PO_NBR                               02479806
024799          AND  C.VER_STATUS_CDE  = 'A'                            02479906
024810          AND  A.UPC_NBR = D.UPC_NBR                              02481006
024900          AND  D.INTR_UPC_ID = E.INTR_UPC_ID                      02490006
026600         WITH UR                                                  02660006
026700     END-EXEC.                                                    02670000
026800                                                                  02680000
026900******************************************************************02690000
027000 PROCEDURE DIVISION.                                              02700000
027100******************************************************************02710000
027200******************************************************************02720000
027300* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02730000
027400*      PROGRAM.                                                   02740000
027500******************************************************************02750000
027600 0000-PROGRAM-MAINLINE.                                           02760000
027700                                                                  02770000
027800     DISPLAY '***** SUKUT167 STARTED *****'.                      02780000
027900                                                                  02790000
028000     PERFORM 1000-INITIALIZE.                                     02800000
028100     IF PS-NOT-END-OF-CONTROL                                     02810004
028200         PERFORM 2000-PROCESS-SCAN-CRTN-DATA                      02820004
028400     END-IF.                                                      02840000
028410                                                                  02841004
028500     PERFORM 9000-EOJ-ROUTINE.                                    02850000
028600                                                                  02860000
028700     GOBACK.                                                      02870004
028800                                                                  02880000
028900******************************************************************02890000
029000*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02900000
029100*    -- OPEN INPUT FILE - DATE FILE                               02910002
029200*    -- OPEN OUTPUT FILE                                          02920000
029400******************************************************************02940000
029500 1000-INITIALIZE.                                                 02950000
029600                                                                  02960000
029700     INITIALIZE COUNTERS.                                         02970000
029800     OPEN INPUT  BATCH-DATE-IN.                                   02980002
029900     OPEN OUTPUT CARTON-DETAIL-FILE.                              02990002
030000                                                                  03000002
030100     PERFORM 1200-READ-CONTROL-CARD.                              03010010
030300                                                                  03030000
030310******************************************************************03031002
030320*  READ INPUT CONTROL CARD TO GET THE CURRENT BATCH PROCESSING    03032002
030330*  DATE.                                                          03033002
030340******************************************************************03034002
030350 1200-READ-CONTROL-CARD.                                          03035002
030360                                                                  03036002
030370     READ BATCH-DATE-IN                                           03037002
030380         INTO PV-INPUT-FILE                                       03038002
030390             AT END                                               03039002
030391                 MOVE 'Y' TO PS-END-OF-CONTROL-SW.                03039102
030392                                                                  03039202
030393     IF PS-END-OF-CONTROL                                         03039302
030394         DISPLAY ' '                                              03039402
030395         DISPLAY ' *** NO CONTROL CARD FOUND TO PROCESS ***'      03039502
030396         DISPLAY ' '                                              03039602
030397     ELSE                                                         03039702
030398         DISPLAY 'BATCH PROCESSING CONTROL CARD DATE  = '         03039802
030399                 BTCH-RUN-DATE                                    03039902
030400     END-IF.                                                      03040002
030401                                                                  03040102
030410******************************************************************03041000
030500*  BEGIN RETRIEVING THE NECESSARY DATA                            03050000
030600******************************************************************03060000
030700 2000-PROCESS-SCAN-CRTN-DATA.                                     03070004
030800                                                                  03080000
030900     INITIALIZE SU170-EXTRACT-RECORD.                             03090004
031200                                                                  03120000
031300     SET PS-NOT-END-OF-SCAN-CTN-CSR TO TRUE.                      03130000
031400     PERFORM 2100-OPEN-SCAN-CTN-CSR.                              03140000
031500     PERFORM 2200-FETCH-SCAN-CTN-CSR.                             03150000
031600     PERFORM 2300-PROCESS-SCAN-CTN-CSR UNTIL                      03160006
031700             PS-END-OF-SCAN-CTN-CSR.                              03170000
031800     PERFORM 2400-CLOSE-SCAN-CTN-CSR.                             03180000
031900                                                                  03190000
032200                                                                  03220000
032300******************************************************************03230000
032400*  OPEN SCANNED CARTON CURSOR.                                    03240000
032500******************************************************************03250000
032600 2100-OPEN-SCAN-CTN-CSR.                                          03260000
032700                                                                  03270000
032900                                                                  03290000
033000     EXEC SQL                                                     03300000
033100         OPEN SCAN-CTN-CSR                                        03310000
033200     END-EXEC.                                                    03320000
033300                                                                  03330000
033400     EVALUATE TRUE                                                03340000
033500         WHEN SQLCODE = ZERO                                      03350000
033600             CONTINUE                                             03360000
033700         WHEN SQLWARN0 NOT = SPACES                               03370000
033800         WHEN SQLCODE < ZERO                                      03380000
033900         WHEN SQLCODE > ZERO                                      03390000
034000             MOVE '2100-OPEN-SCAN-CTN-CSR' TO PV-PARAGRAPH-NAME   03400006
034100             MOVE 'SELECT SUT_OTBND_STR_SCN '                     03410000
034200                                    TO PV-DB2-OPERATION-ATTEMPTED 03420000
034300             PERFORM 9100-SQL-ABEND                               03430000
034400     END-EVALUATE.                                                03440000
034500                                                                  03450000
034600                                                                  03460000
034700******************************************************************03470000
034800*  FETCH SCANNED CARTON CURSOR ROW.                               03480000
034900******************************************************************03490000
035000 2200-FETCH-SCAN-CTN-CSR.                                         03500000
035100     EXEC SQL                                                     03510000
035200        FETCH SCAN-CTN-CSR                                        03520000
035300         INTO  :SUT00121-SHIPT-UNT-ID                             03530000
035400             , :SUT00121-CRE-TMST                                 03540005
035500             , :SUT00121-SCN-LOC-NBR                              03550005
035600             , :SUT00121-SCN-TYP-CDE                              03560005
035610             , :PURCHS-SEASET-YR                                  03561006
035620             , :PURCHS-SEASET-SHRT-NM                             03562006
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
036000     EVALUATE TRUE                                                03600000
036100         WHEN SQLCODE = ZERO                                      03610000
036101             ADD +1 TO PV-SCN-CRTN-COUNTER                        03610108
036600         WHEN SQLCODE = +100                                      03660000
036700             SET PS-END-OF-SCAN-CTN-CSR    TO  TRUE               03670000
036800         WHEN SQLWARN0 NOT = SPACES                               03680000
036900         WHEN SQLCODE < ZERO                                      03690000
037000         WHEN SQLCODE > ZERO                                      03700000
037100             MOVE '2200-FETCH-SCAN-CTN-CSR' TO PV-PARAGRAPH-NAME  03710000
037200             MOVE 'SELECT SUT_OTBND_STR_SCN '                     03720000
037300                                   TO PV-DB2-OPERATION-ATTEMPTED  03730000
037400             PERFORM 9100-SQL-ABEND                               03740000
037500     END-EVALUATE.                                                03750000
037600                                                                  03760000
037700******************************************************************03770000
037800*  PROCESS SCANNED CARTON CURSOR ROW.                             03780000
037900*  FETCH AND WRITE CARTON DETAIL ROWS                             03790018
038200******************************************************************03820000
038300 2300-PROCESS-SCAN-CTN-CSR.                                       03830006
038301                                                                  03830106
038302                                                                  03830206
038303     SET PS-NOT-END-OF-CRTN-DETL-CSR TO TRUE                      03830306
038304     PERFORM 3100-OPEN-CRTN-DETL-CSR                              03830406
038330     PERFORM 3200-FETCH-CRTN-DETL-CSR                             03833006
038350       UNTIL PS-END-OF-CRTN-DETL-CSR.                             03835010
040700     PERFORM 3300-CLOSE-CRTN-DETL-CSR.                            04070006
040900                                                                  04090000
040910     PERFORM 2200-FETCH-SCAN-CTN-CSR.                             04091013
055200******************************************************************05520000
055300*  CLOSE SCANNED CARTON CURSOR.                                   05530000
055400******************************************************************05540000
055500 2400-CLOSE-SCAN-CTN-CSR.                                         05550000
055600     EXEC SQL                                                     05560000
055700        CLOSE SCAN-CTN-CSR                                        05570000
055800     END-EXEC.                                                    05580000
055900                                                                  05590000
056000     EVALUATE TRUE                                                05600000
056100         WHEN SQLCODE = ZERO                                      05610000
056200             CONTINUE                                             05620000
056300         WHEN SQLWARN0 NOT = SPACES                               05630000
056400         WHEN SQLCODE < ZERO                                      05640000
056500         WHEN SQLCODE > ZERO                                      05650000
056600             MOVE '2400-CLOSE-SCAN-CTN-CSR' TO PV-PARAGRAPH-NAME  05660000
056700             MOVE 'SELECT SUT_OTBND_STR_SCN'                      05670000
056800                                   TO PV-DB2-OPERATION-ATTEMPTED  05680000
056900             PERFORM 9100-SQL-ABEND                               05690000
057000     END-EVALUATE.                                                05700000
057100                                                                  05710000
057200                                                                  05720000
057300*----------------------------------------------------------------*05730000
057400* OPEN CURSOR                                                     05740000
057500*----------------------------------------------------------------*05750000
057600 3100-OPEN-CRTN-DETL-CSR.                                         05760006
057700     INITIALIZE DCLSUT00028.                                      05770000
057800     EXEC SQL                                                     05780000
057900         OPEN CRTN-DETL-CSR                                       05790006
058000     END-EXEC.                                                    05800000
058100                                                                  05810000
058200     EVALUATE TRUE                                                05820000
058300         WHEN SQLCODE = ZERO                                      05830000
058400             CONTINUE                                             05840000
058500         WHEN SQLWARN0 NOT = SPACES                               05850000
058600         WHEN SQLCODE < ZERO                                      05860000
058700         WHEN SQLCODE > ZERO                                      05870000
058800             MOVE '3100-OPEN-CRTN-DETL-CSR' TO PV-PARAGRAPH-NAME  05880006
058900             MOVE 'SELECT SUT_OTBND_UPC '                         05890000
059000                                    TO PV-DB2-OPERATION-ATTEMPTED 05900000
059100             PERFORM 9100-SQL-ABEND                               05910000
059200     END-EVALUATE.                                                05920000
059300                                                                  05930000
063400*----------------------------------------------------------------*06340000
063500* FETCH PO-RCVR CURSOR                                            06350000
063600*----------------------------------------------------------------*06360000
063700 3200-FETCH-CRTN-DETL-CSR.                                        06370006
063800     EXEC SQL                                                     06380000
063900        FETCH CRTN-DETL-CSR                                       06390006
064000         INTO   :PV-SEASET-YR                                     06400006
064100               ,:PV-SEASET-SHRT-NM                                06410006
064200               ,:SUT00024-DEST-LOC-NBR                            06420006
064300               ,:SUT00028-TRN-NBR                                 06430000
064400               ,:SUT00028-RCVR-SEQ-NBR                            06440000
064600               ,:XLT00003-SKU-NBR                                 06460000
064700               ,:SUT00028-SHPD-UNT-QTY                            06470006
064710               ,:SUT00024-CART-SRC-CDE                            06471011
064800     END-EXEC.                                                    06480000
064900                                                                  06490000
065000     EVALUATE TRUE                                                06500000
065100         WHEN SQLCODE = ZERO                                      06510000
065200              PERFORM 4000-PROCESS-CRTN-DETL                      06520006
065300              ADD +1 TO PV-SCN-DETL-COUNTER                       06530008
066200         WHEN SQLCODE = +100                                      06620000
066800             SET PS-END-OF-CRTN-DETL-CSR   TO  TRUE               06680006
066900         WHEN SQLWARN0 NOT = SPACES                               06690000
067000         WHEN SQLCODE < ZERO                                      06700000
067100         WHEN SQLCODE > ZERO                                      06710000
067200             MOVE '5200-FETCH-CRTN-DETL-CSR' TO PV-PARAGRAPH-NAME 06720006
067300             MOVE 'SELECT SUT_OTBND_UPC'                          06730000
067400                                   TO PV-DB2-OPERATION-ATTEMPTED  06740000
067410             MOVE SUT00121-SHIPT-UNT-ID TO  PV-DISPLAY-CARTON     06741009
067500             PERFORM 9100-SQL-ABEND                               06750000
067600     END-EVALUATE.                                                06760000
067700                                                                  06770000
067800*----------------------------------------------------------------*06780000
067900* CLOSE PO-RCVR CURSOR                                            06790000
068000*----------------------------------------------------------------*06800000
068100 3300-CLOSE-CRTN-DETL-CSR.                                        06810006
068200     EXEC SQL                                                     06820000
068300        CLOSE CRTN-DETL-CSR                                       06830006
068400     END-EXEC.                                                    06840000
068500                                                                  06850000
068600     EVALUATE TRUE                                                06860000
068700         WHEN SQLCODE = ZERO                                      06870000
068800             CONTINUE                                             06880000
068900         WHEN SQLWARN0 NOT = SPACES                               06890000
069000         WHEN SQLCODE < ZERO                                      06900000
069100         WHEN SQLCODE > ZERO                                      06910000
069200             MOVE '3300-CLOSE-CRTN-DETL-CSR' TO PV-PARAGRAPH-NAME 06920006
069300             MOVE 'SELECT SUT_OTBND_UPC'                          06930000
069400                                   TO PV-DB2-OPERATION-ATTEMPTED  06940000
069500             PERFORM 9100-SQL-ABEND                               06950000
069600     END-EVALUATE.                                                06960000
069700                                                                  06970000
069710******************************************************************06971006
069800 4000-PROCESS-CRTN-DETL.                                          06980006
077000******************************************************************07700000
077010                                                                  07701006
077011     MOVE SUT00121-SHIPT-UNT-ID  TO SU170-SHIPT-UNT-ID.           07701120
077012     MOVE SUT00121-SCN-LOC-NBR   TO SU170-SCN-LOC-NBR.            07701219
077013     MOVE SUT00024-DEST-LOC-NBR  TO SU170-EXP-LOC-NBR.            07701320
077014     MOVE XLT00003-SKU-NBR       TO SU170-SKU-NBR.                07701419
077015     MOVE SUT00028-SHPD-UNT-QTY  TO SU170-SKU-QTY.                07701519
077016     MOVE PURCHS-SEASET-YR       TO SU170-SEASET-YR.              07701619
077017     MOVE PURCHS-SEASET-SHRT-NM  TO SU170-SEASET-SHRT-NM.         07701719
077018     MOVE SUT00024-CART-SRC-CDE  TO SU170-CART-SRC-CDE.           07701819
077030     MOVE SUT00121-CRE-TMST      TO SU170-STR-SCAN-TMST.          07703011
077050     MOVE SUT00121-SCN-TYP-CDE   TO SU170-SCN-TYP-CDE.            07705011
077060     MOVE SUT00028-TRN-NBR       TO SU170-PO-NUMBER.              07706019
077070     MOVE SUT00028-RCVR-SEQ-NBR  TO SU170-REC-SEQ-NBR.            07707019
077080     MOVE PV-SEASET-YR           TO SU170-SEASET-YR-LNE.          07708019
077081     MOVE PV-SEASET-SHRT-NM      TO SU170-SEASET-SHRT-NM-LNE.     07708119
077082                                                                  07708206
077098     MOVE BTCH-RUN-DATE          TO SU170-BTCH-PRC-DTE.           07709814
077100                                                                  07710011
077101                                                                  07710111
077102     PERFORM 8000-WRITE-OUTPUT.                                   07710211
077103                                                                  07710311
077104                                                                  07710411
077105******************************************************************07710511
077110*  WRITE OUTPUT FILE.                                             07711000
077200******************************************************************07720000
077300 8000-WRITE-OUTPUT.                                               07730000
078200                                                                  07820000
078300     WRITE  CARTON-DETAIL-RECORD                                  07830000
078400      FROM  SU170-EXTRACT-RECORD.                                 07840006
078500     ADD    +1   TO PV-RECORDS-WRITTEN.                           07850008
078600                                                                  07860000
079600******************************************************************07960000
079700*  DISPLAY COUNTERS.                                              07970018
079800******************************************************************07980000
079900 9000-EOJ-ROUTINE.                                                07990000
080000     CLOSE BATCH-DATE-IN                                          08000006
080100           CARTON-DETAIL-FILE.                                    08010006
080300                                                                  08030000
080400     MOVE PV-SCN-CRTN-COUNTER TO PV-DISPLAY-COUNT.                08040008
080500     DISPLAY 'SCAN CARTON FETCHED : '  PV-DISPLAY-COUNT.          08050008
080510     MOVE PV-SCN-DETL-COUNTER TO PV-DISPLAY-COUNT.                08051008
080520     DISPLAY 'SCAN DETAILS FETCHED: '  PV-DISPLAY-COUNT.          08052008
080600     MOVE PV-RECORDS-WRITTEN TO PV-DISPLAY-COUNT.                 08060008
080700     DISPLAY 'TOTAL RECORDS OUT...: '  PV-DISPLAY-COUNT.          08070008
081000                                                                  08100000
081400     DISPLAY '*****  SUKUT167 ENDED  *****'.                      08140000
081500                                                                  08150000
081600******************************************************************08160000
081700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    08170000
081800*  ERROR OR WARNING CODE OCCURS.                                  08180000
081900******************************************************************08190000
082000 9100-SQL-ABEND.                                                  08200000
082100     DISPLAY '9100-SQL-ABEND'.                                    08210000
082200     DISPLAY '** ABEND     **'.                                   08220000
082300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08230000
082400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08240000
082500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     08250000
082600     DISPLAY '** CARTON ID ** = ' SUT00121-SHIPT-UNT-ID.          08260009
082700                                                                  08270000
082800******************************************************************08280000
082900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    08290000
083000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         08300000
083100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08310000
083200* FORMAT.                                                         08320000
083300******************************************************************08330000
083400     COPY DPPD004.                                                08340000
083500                                                                  08350000
083600     MOVE +4013                  TO ABEND-CODE.                   08360000
083700     CALL 'ILBOABN0' USING ABEND-CODE.                            08370000
083800                                                                  08380000
