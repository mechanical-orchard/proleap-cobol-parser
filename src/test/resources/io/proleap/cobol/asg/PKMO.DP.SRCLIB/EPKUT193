000100 IDENTIFICATION DIVISION.                                         00002000
000200 PROGRAM-ID.      EPKUT193.                                       00003000
000300 AUTHOR.          CHERI PARMLEY.                                  00004000
000400 DATE-WRITTEN.    MARCH 3, 2010.                                  00005000
000500                                                                  00006000
000600*-----------------------------------------------------------      00007000
000700*              REBATE FORM CREATOR                                00008000
000800*-----------------------------------------------------------      00009000
000900* THIS PROGRAM WILL WRITE OUT ALL THE REBATE FORM TEXT            00010000
001000* WHERE THE PRICE TYPE CODE = 'RBO'.  INPUT TO THIS PROGRAM       00020000
001000* HAS ALREADY SORTED OFF THE PRICE TYPE CODE NEEDED. QUERIES      00030000
002300* ARE THEN EXECUTED TO GET THE INFORMATION NEEDED TO CREATE       00040000
002400* FORM TEXT RECORDS THAT WILL BE SENT DOWN TO THE STORES.         00050000
002600*-----------------------------------------------------------      00060000
002700* HISTORY LOG:                                                    00070000
002800*-----------------------------------------------------------      00080000
002900* DATE: 03/03/2010                                                00090000
003000* WR/IR#: WR38172                                                 00100000
003100* PROGRAMMER: CHERI PARMLEY                                       00101000
003200* DESCRIPTION: INITIAL VERSION                                    00102000
003900*                                                                 00103000
002900* DATE: 07/30/2010                                                00103102
003000* WR/IR#: WR38172                                                 00103202
003100* PROGRAMMER: CHERI PARMLEY                                       00103302
003200* DESCRIPTION: MADE CHANGES PER SERVICE DELIVERY                  00103402
003900*                                                                 00103502
014720*----------------------------------------------------------       00104000
014800 ENVIRONMENT DIVISION.                                            00105000
014900*----------------------------------------------------------       00106000
015000 CONFIGURATION SECTION.                                           00107000
015100 SOURCE-COMPUTER.        IBM-3090.                                00108000
015200 OBJECT-COMPUTER.        IBM-3090.                                00109000
015300                                                                  00110000
015400 INPUT-OUTPUT SECTION.                                            00120000
015500                                                                  00130000
015600 FILE-CONTROL.                                                    00140000
015700                                                                  00150000
015800     SELECT PROMO-INTFC-ID-FILE                                   00160000
015900            ASSIGN TO INP01.                                      00170000
016000     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00180000
016100            ASSIGN TO INP02.                                      00190000
016200     SELECT REBATE-FILE                                           00200000
016300            ASSIGN TO OUT01.                                      00210000
016600                                                                  00220000
016700 DATA DIVISION.                                                   00230000
016800 FILE SECTION.                                                    00240000
016900                                                                  00250000
017000 FD  PROMO-INTFC-ID-FILE                                          00260000
017100     RECORDING MODE F                                             00270000
017200     BLOCK CONTAINS 0 RECORDS                                     00280000
017300     LABEL RECORDS ARE OMITTED                                    00290000
017400     DATA RECORD IS PROMO-INTFC-ID-RECORD.                        00300000
017500 01  PROMO-INTFC-ID-RECORD           PIC X(200).                  00310000
017600                                                                  00320000
017700 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00330000
017800     RECORDING MODE F                                             00340000
017900     BLOCK CONTAINS 0 RECORDS                                     00350000
018000     LABEL RECORDS ARE OMITTED                                    00360000
018100     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00370000
018200 01  CNTRL-CARD-CURR-PRICG-DTE-REC   PIC  X(80).                  00380000
018300                                                                  00390000
018400 FD  REBATE-FILE                                                  00400000
018500     RECORDING MODE F                                             00410000
018600     BLOCK CONTAINS 0 RECORDS                                     00420000
018700     LABEL RECORDS ARE OMITTED                                    00430000
018800     DATA RECORD IS REBATE-RECORD.                                00440000
018900 01  REBATE-RECORD                    PIC X(300).                 00450000
019000                                                                  00460000
019800 WORKING-STORAGE SECTION.                                         00470000
019900*-----------------------------------------------------------      00480000
020000* PS- PROGRAM SWITCHES                                            00490000
020100*-----------------------------------------------------------      00500000
020200 01  PS-PROGRAM-SWITCHES.                                         00510000
020300     05  PS-END-OF-INPUT-FILE-SW        PIC X(01) VALUE 'Y'.      00520000
020400         88  PS-END-OF-INPUT-FILE                 VALUE 'N'.      00530000
020500         88  PS-NOT-END-OF-INPUT-FILE             VALUE 'Y'.      00540000
020600     05  PS-END-OF-CURSOR-SW            PIC X(01) VALUE 'N'.      00550000
020700         88  PS-END-OF-CURSOR                     VALUE 'Y'.      00560000
020800         88  PS-NOT-END-OF-CURSOR                 VALUE 'N'.      00570000
022500     05  PS-END-OF-CNTL-CRD-SW          PIC  X(001).              00580000
022600         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      00590000
022700         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      00600000
021600     05  PS-SKIP-RECORDS-SW             PIC X(01) VALUE 'N'.      00610000
021700         88  PS-SKIP-REC                          VALUE 'Y'.      00620000
021800         88  PS-NOT-SKIP-REC                      VALUE 'N'.      00630000
021600     05  PS-STYLE-FOUND-SW              PIC X(01) VALUE 'N'.      00640000
021700         88  PS-STYLE-FOUND                       VALUE 'Y'.      00650000
021800         88  PS-NOT-STYLE-FOUND                   VALUE 'N'.      00660000
022880                                                                  00670000
022900*-----------------------------------------------------------      00680000
023000* PROGRAM CONSTANTS                                               00690000
023100*-----------------------------------------------------------      00700000
023200 01  PC-PROGRAM-CONSTANTS.                                        00710000
023300     05  PC-CURRENT-PROGRAM-NAME   PIC X(08) VALUE 'EPKUT193'.    00720000
023400     05  PC-MAX-RETRIES            PIC S9(04) VALUE +5 COMP.      00730000
026120     05  PC-NULL-VALUE             PIC X(01) VALUE '~'.           00740000
026120     05  PC-STYLE                  PIC X(03) VALUE 'STY'.         00750000
026200                                                                  00760000
026300*-----------------------------------------------------------      00770000
026400* PV- PROGRAM VARIABLES                                           00780000
026500*-----------------------------------------------------------      00790000
026600 01  PV-PROGRAM-VARAIBLES.                                        00800000
026700     05  PV-SQL-SUB                PIC S9(4) VALUE +0 COMP.       00810000
           05  PV-NUM-ROWS                 PIC S9(9) VALUE ZEROS        00820000
                                                     COMP SYNC.         00830000
                                                                        00840000
030200     05  PV-STAT-CDES.                                            00850000
030300         10  PV-SCHEDULED-STAT     PIC X(01)  VALUE 'S'.          00860000
030400         10  PV-CANCEL-STAT        PIC X(01)  VALUE 'C'.          00870000
030500         10  PV-DELETE-STAT        PIC X(01)  VALUE 'D'.          00880000
030600                                                                  00890000
030700     05  PV-NULL-INDICATORS.                                      00900000
030800         10  PV-FM-LNE-TYP-IND         PIC S9(4)  VALUE +0 COMP.  00910000
030900             88  PV-FM-LNE-TYP-NULL               VALUE -1.       00920000
031000         10  PV-EFF-END-DTE-IND        PIC S9(4)  VALUE +0 COMP.  00930000
031100             88  PV-EFF-END-DTE-NULL              VALUE -1.       00940000
032000         10  PV-STYL-ID-IND        PIC S9(4)  VALUE +0 COMP.      00950000
032100             88  PV-STYL-ID-NULL              VALUE -1.           00960000
037200                                                                  00970000
040800    05  PV-DIST-LIST-DTE.                                         00980000
040900        10  PV-LIST-CCYY           PIC X(04) VALUE SPACES.        00990000
041000        10  PV-LIST-MM             PIC X(02) VALUE SPACES.        01000000
041100        10  PV-LIST-DD             PIC X(02) VALUE SPACES.        01010000
041200                                                                  01020000
041300    05  PV-SOR-LAST-UPD-TMST-LONG.                                01030000
041400        10  PV-LAST-UPD-LONG-DTE.                                 01040000
041500            15  PV-LAST-DTE-LONG-CCYY     PIC X(04).              01050000
041600            15  FILLER                    PIC X(01).              01060000
041700            15  PV-LAST-DTE-LONG-MM       PIC X(02).              01070000
041800            15  FILLER                    PIC X(01).              01080000
041900            15  PV-LAST-DTE-LONG-DD       PIC X(02).              01090000
042000        10  FILLER                        PIC X(01).              01100000
042100        10  PV-LAST-UPD-TM.                                       01110000
042200            15  PV-LAST-TM-LONG-HH        PIC X(02).              01120000
042300            15  FILLER                    PIC X(01).              01130000
042400            15  PV-LAST-TM-LONG-MM        PIC X(02).              01140000
042500            15  FILLER                    PIC X(01).              01150000
042600            15  PV-LAST-TM-LONG-SS        PIC X(02).              01160000
042700            15  FILLER                    PIC X(01).              01170000
042800            15  PV-LAST-TM-LONG-MMSS      PIC X(06).              01180000
042900                                                                  01190000
043000    05  PV-SOR-LAST-UPD-TMST.                                     01200000
043100        10  PV-LAST-UPD-DTE.                                      01210000
043200            15  PV-LAST-DTE-CCYY          PIC X(04).              01220000
043300            15  PV-LAST-DTE-MM            PIC X(02).              01230000
043400            15  PV-LAST-DTE-DD            PIC X(02).              01240000
043500        10  PV-LAST-UPD-TM.                                       01250000
043600            15  PV-LAST-TM-HH             PIC X(02).              01260000
043700            15  PV-LAST-TM-MM             PIC X(02).              01270000
043800            15  PV-LAST-TM-SS             PIC X(02).              01280000
043900            15  PV-LAST-TM-MMSS           PIC X(06).              01290000
044000                                                                  01300000
044100    05  PV-PROMO-STRT-TMST.                                       01310000
044200        10  PV-PROMO-STRT-DTE.                                    01320000
044300            15  PV-PROMO-STRT-DTE-CCYY    PIC X(04).              01330000
044400            15  FILLER                    PIC X(01).              01340000
044500            15  PV-PROMO-STRT-DTE-MM      PIC X(02).              01350000
044600            15  FILLER                    PIC X(01).              01360000
044700            15  PV-PROMO-STRT-DTE-DD      PIC X(02).              01370000
044800        10  FILLER                        PIC X(01).              01380000
044900        10  PV-PROMO-STRT-TM.                                     01390000
045000            15  PV-PROMO-STRT-TM-HH       PIC X(02).              01400000
045100            15  FILLER                    PIC X(01).              01410000
045200            15  PV-PROMO-STRT-TM-MM       PIC X(02).              01420000
045300            15  FILLER                    PIC X(01).              01430000
045400            15  PV-PROMO-STRT-TM-SS       PIC X(02).              01440000
045500            15  FILLER                    PIC X(01).              01450000
045600            15  PV-PROMO-STRT-TM-MMSS     PIC X(06).              01460000
045700                                                                  01470000
045800    05  PV-PROMO-END-TMST.                                        01480000
045900        10  PV-PROMO-END-DTE.                                     01490000
046000            15  PV-PROMO-END-DTE-CCYY     PIC X(04).              01500000
046100            15  FILLER                    PIC X(01).              01510000
046200            15  PV-PROMO-END-DTE-MM       PIC X(02).              01520000
046300            15  FILLER                    PIC X(01).              01530000
046400            15  PV-PROMO-END-DTE-DD       PIC X(02).              01540000
046500        10  FILLER                        PIC X(01).              01550000
046600        10  PV-PROMO-END-TM.                                      01560000
046700            15  PV-PROMO-END-TM-HH        PIC X(02).              01570000
046800            15  FILLER                    PIC X(01).              01580000
046900            15  PV-PROMO-END-TM-MM        PIC X(02).              01590000
047000            15  FILLER                    PIC X(01).              01600000
047100            15  PV-PROMO-END-TM-SS        PIC X(02).              01610000
047200            15  FILLER                    PIC X(01).              01620000
047300            15  PV-PROMO-END-TM-MMSS      PIC X(06).              01630000
047400                                                                  01640000
047500    05  PV-STRT-TM.                                               01650000
047600        10  PV-STRT-TM-HH                 PIC X(02).              01660000
047700        10  FILLER                        PIC X(01) VALUE ':'.    01670000
047800        10  PV-STRT-TM-MM                 PIC X(02).              01680000
047900        10  FILLER                        PIC X(01) VALUE ':'.    01690000
048000        10  PV-STRT-TM-SS                 PIC X(02).              01700000
048100                                                                  01710000
048200    05  PV-END-TM.                                                01720000
048300        10  PV-END-TM-HH                  PIC X(02).              01730000
048400        10  FILLER                        PIC X(01) VALUE ':'.    01740000
048500        10  PV-END-TM-MM                  PIC X(02).              01750000
048600        10  FILLER                        PIC X(01) VALUE ':'.    01760000
048700        10  PV-END-TM-SS                  PIC X(02).              01770000
048800                                                                  01780000
048900    05  PV-EP111-CC-ISO-DATE              PIC  X(010)             01790000
049000                                            VALUE SPACES.         01800000
049101                                                                  01810000
050100*----------------------------------------------------------       01820000
050200* PROMO INTERFACE ID'S LAYOUT - INPUT                             01830000
050300*----------------------------------------------------------       01840000
050400     COPY EPRD072.                                                01850000
050500                                                                  01860000
050510*----------------------------------------------------------       01870000
050520* REBATE FORM TEXT LAYOUT - OUTPUT                                01880000
050530*----------------------------------------------------------       01890000
050540     COPY EPRD231.                                                01900000
050550                                                                  01910000
050600*----------------------------------------------------------       01920000
050700* DATE ROUTINE COPY MEMBERS                                       01930000
050800*----------------------------------------------------------       01940000
050900     COPY DPWS500.                                                01950000
051000                                                                  01960000
051100*-----------------------------------------------------------      01970000
051200* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01980000
051300*-----------------------------------------------------------      01990000
051400     COPY DPWS004.                                                02000000
051500                                                                  02010000
 52100*----------------------------------------------------------       02020000
052200* EPCC111 CONTROL CARD LAYOUT - CURRENT PRICING DATE              02030000
052300*----------------------------------------------------------       02040000
052400     COPY EPRD111.                                                02050000
052500                                                                  02060000
052600*-----------------------------------------------------------      02070000
052700* DB2 MESSAGE AREA                                                02080000
052800*-----------------------------------------------------------      02090000
052900     COPY SQLCA2.                                                 02100000
053000                                                                  02110000
053100*-----------------------------------------------------------      02120000
053200* PROGRAM COUNTERS                                                02130000
053300*-----------------------------------------------------------      02140000
053400 01  PC-PROGRAM-COUNTERS.                                         02150000
053600     05  PC-CNT-READ-RECS             PIC 9(09) VALUE 0.          02160000
053700     05  PC-CNT-REBATE-RECS           PIC 9(09) VALUE 0.          02170000
054400                                                                  02180000
054500*-----------------------------------------------------------      02190000
054600* ERROR HANDLING                                                  02200000
054700*-----------------------------------------------------------      02210000
054800 01  PV-MISC-ABEND-FIELDS.                                        02220000
054900     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      02230000
055000     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      02240000
055100     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      02250000
055200     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      02260000
055300 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 02270000
055500     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02280000
055900                                                                  02290000
056000*-----------------------------------------------------------      02300000
056100* DB2 COMMUNICATIONS AREA                                         02310000
056200*-----------------------------------------------------------      02320000
056300     EXEC SQL                                                     02330000
056400          INCLUDE SQLCA                                           02340000
056500     END-EXEC.                                                    02350000
056600                                                                  02360000
060900*-----------------------------------------------------------      02370000
061000* DB2 TABLE XST00130(XST_REBT_FM) - REBATE FORM TABLE             02380000
061100*-----------------------------------------------------------      02390000
061200     EXEC SQL                                                     02400000
061300          INCLUDE XST00130                                        02410000
061400     END-EXEC.                                                    02420000
061500                                                                  02430000
060900*-------------------------------------------------------------    02440000
061000* DB2 TABLE XST00131(XST_REBT_FM_TXT)- REBATE FORM TEXT TABLE     02450000
061100*-------------------------------------------------------------    02460000
061200     EXEC SQL                                                     02470000
061300          INCLUDE XST00131                                        02480000
061400     END-EXEC.                                                    02490000
061500                                                                  02500000
056610*----------------------------------------------------------------*02510000
056620* DB2 TABLE XST00013(XST_VND_STYL) - VENDOR STYLE TABLE           02520000
056630*----------------------------------------------------------------*02530000
056640     EXEC SQL                                                     02540000
056650       INCLUDE XST00013                                           02550000
056660     END-EXEC.                                                    02560000
056670                                                                  02570000
057400*-----------------------------------------------------------      02580000
057500* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       02590000
057600*-----------------------------------------------------------      02600000
057700     EXEC SQL                                                     02610000
057800          INCLUDE XST00028                                        02620000
057900     END-EXEC.                                                    02630000
058000                                                                  02640000
058800*-----------------------------------------------------------      02650000
058900* DB2 TABLE XST00030(XST_SMP_PRICG) - SIMPLE PRICING TABLE        02660000
059000*-----------------------------------------------------------      02670000
059100     EXEC SQL                                                     02680000
059200          INCLUDE XST00030                                        02690000
059300     END-EXEC.                                                    02700000
059400                                                                  02710000
061600*-----------------------------------------------------------      02720000
061700* FORM-CURSOR WILL FIND ALL RECORDS THAT CORRESPOND               02730000
061800* TO A CERTAIN PROMO INTERFACE ID AND MERCHANDISE ID.             02740000
061900*-----------------------------------------------------------      02750000
062000     EXEC SQL                                                     02760000
062100       DECLARE FORM-CURSOR CURSOR FOR                             02770000
062400            SELECT  A.REBT_FM_ID                                  02780000
062500                   ,B.FM_SECT_TYP_CDE                             02790000
062600                   ,B.FM_LNE_NBR                                  02800000
062700                   ,B.REBT_PROMO_ID                               02810000
062800                   ,B.FM_LNE_TYP_CDE                              02820000
062810                   ,B.EFF_END_DTE                                 02830000
062900                   ,B.FM_TXT                                      02840000
063700              FROM  XST_REBT_FM A                                 02850000
063800                   ,XST_REBT_FM_TXT B                             02860000
063900             WHERE  A.PROMO_INTFC_ID  = :XST00130-PROMO-INTFC-ID  02870000
064000               AND  A.MDSE_LNE_ID     = :XST00130-MDSE-LNE-ID     02880000
064000               AND  A.REBT_FM_ID      = :XST00130-REBT-FM-ID      02890000
064100               AND  A.REBT_FM_ID      = B.REBT_FM_ID              02900000
064600             ORDER BY FM_LNE_NBR                                  02910000
064700           WITH UR                                                02920000
064800     END-EXEC.                                                    02930000
064900                                                                  02940000
067700 LINKAGE SECTION.                                                 02950000
067800                                                                  02960000
067900*----------------------------------------------------------       02970000
068000 PROCEDURE DIVISION.                                              02980000
068100*----------------------------------------------------------       02990000
068200 0000-MAINLINE.                                                   03000000
068300                                                                  03010000
068400     PERFORM 1000-INITIALIZATION.                                 03020000
068500                                                                  03030000
068600     PERFORM 2000-PROCESS-RECORDS                                 03040000
068700             UNTIL PS-END-OF-INPUT-FILE.                          03050000
068800                                                                  03060000
068900     PERFORM 9999-WRAPUP.                                         03070000
069000                                                                  03080000
069100     GOBACK.                                                      03090000
069200                                                                  03100000
069300*0000-EXIT.                                                       03110000
069400 EJECT.                                                           03120000
069500                                                                  03130000
069600*----------------------------------------------------------       03140000
069700* 1000-INITIALIZATION.                                            03150000
069800*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, PPENS      03160000
069900*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      03170000
070000*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             03180000
070100*     INTERFACE ID FILE.                                          03190000
070200*----------------------------------------------------------       03200000
070300 1000-INITIALIZATION.                                             03210000
070400                                                                  03220000
070500     INITIALIZE EP072-PROMO-INTFC-RECORD.                         03230000
070600                                                                  03240000
070700     OPEN INPUT  PROMO-INTFC-ID-FILE                              03250000
070800                 CONTROL-CARD-CURR-PRICG-DTE                      03260000
070900          OUTPUT REBATE-FILE.                                     03270000
071100                                                                  03280000
071200     PERFORM 1010-READ-CURR-PRICG-DTE-CARD.                       03290000
071300     PERFORM 8000-DATE-ROUTINE.                                   03300000
071400                                                                  03310000
071500     PERFORM 9000-READ-INPUT-FILE.                                03320000
071600                                                                  03330000
071700     IF PS-END-OF-INPUT-FILE                                      03340000
071800        DISPLAY 'NO REBATE RECORDS WERE CREATED'                  03350000
072000     END-IF.                                                      03360000
072100                                                                  03370000
072200*1000-EXIT.                                                       03380000
072300 EJECT.                                                           03390000
072400                                                                  03400000
072500*----------------------------------------------------------       03410000
072600* 1010-READ-CURR-PRICG-DTE-CARD.                                  03420000
072700*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       03430000
072800*     THE CURRENT PRICING DATE.                                   03440000
072900*----------------------------------------------------------       03450000
073000 1010-READ-CURR-PRICG-DTE-CARD.                                   03460000
073100                                                                  03470000
073200     READ CONTROL-CARD-CURR-PRICG-DTE                             03480000
073300                               INTO EP111-CC-CONTROL-CARD         03490000
073400       AT END                                                     03500000
073500          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    03510000
073600                                                                  03520000
073700     IF PS-END-OF-CNTL-CRD-FILE                                   03530000
073800       DISPLAY ' '                                                03540000
073900       DISPLAY '** ABEND     **'                                  03550000
074000       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      03560000
074100       DISPLAY '** PARAGRAPH **  = 1010-READ-CURR-PRICG-DTE-CARD' 03570000
074200       DISPLAY '** CONTROL FILE IS EMPTY  '                       03580000
074300       DISPLAY ' '                                                03590000
074400       MOVE +4003 TO ABEND-CODE                                   03600000
074500       CALL 'ILBOABN0' USING ABEND-CODE                           03610000
074600     ELSE                                                         03620000
074700       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         03630000
074800       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        03640000
074900       DISPLAY ' '                                                03650000
075000     END-IF.                                                      03660000
075100                                                                  03670000
075200                                                                  03680000
075300*1010-EXIT.                                                       03690000
075400 EJECT.                                                           03700000
075500                                                                  03710000
075600*----------------------------------------------------------       03720000
075700* 2000-PROCESS-RECORDS.                                           03730000
075800*     READ THE RECORD FROM THE PROMO INTERFACE FILE AND CREATE    03740000
075900*     FORM RECORDS BASED ON THE RECORD READ.                      03750000
076000*----------------------------------------------------------       03760000
076100 2000-PROCESS-RECORDS.                                            03770000
076200                                                                  03780000
076300     INITIALIZE EP231-REBATE-INTFC-RECORD                         03790000
076600                PV-NULL-INDICATORS.                               03800000
077210                                                                  03810000
077400     MOVE EP072-PRICG-TYP-CDE     TO EP231-PRICG-TYP-CDE.         03820000
077500     MOVE EP072-BUSINESS-EVENT-ID TO EP231-BUSINESS-EVENT-ID.     03840000
077600     MOVE EP072-PROMO-INTFC-ID    TO XST00130-PROMO-INTFC-ID      03850000
                                           EP231-PROMO-INTFC-ID.        03860000
077700     MOVE EP072-MERCH-LNE-ID      TO XST00130-MDSE-LNE-ID         03880000
                                           EP231-MERCH-LNE-ID.          03890000
077800     MOVE EP072-PROMO-INTFC-SUB-ID                                03910000
077900                                  TO EP231-PROMO-INTFC-SUB-ID.    03920000
078000     MOVE EP072-SETUP-STR-GRP-TYP-CDE                             03930000
078100                                  TO EP231-SETUP-STR-GRP-TYP-CDE. 03940000
078200     MOVE EP072-SETUP-STR-GRP-ID                                  03950000
078300                                  TO EP231-SETUP-STR-GRP-ID.      03960000
078500     MOVE PV-LAST-DTE-LONG-CCYY   TO PV-LAST-DTE-CCYY.            03970000
078600     MOVE PV-LAST-DTE-LONG-MM     TO PV-LAST-DTE-MM.              03980000
078700     MOVE PV-LAST-DTE-LONG-DD     TO PV-LAST-DTE-DD.              03990000
078800     MOVE PV-LAST-TM-LONG-HH      TO PV-LAST-TM-HH.               04000000
078900     MOVE PV-LAST-TM-LONG-MM      TO PV-LAST-TM-MM.               04010000
079000     MOVE PV-LAST-TM-LONG-SS      TO PV-LAST-TM-SS.               04020000
079100     MOVE PV-LAST-TM-LONG-MMSS    TO PV-LAST-TM-MMSS.             04030000
079200     MOVE EP072-STR-GRP-PROMO-STRT-TMST                           04040000
079300                                  TO PV-PROMO-STRT-TMST           04050000
                                          EP231-STR-GRP-PROMO-STRT-TMST.04060000
079400     MOVE EP072-STR-GRP-PROMO-END-TMST                            04070000
079500                                  TO PV-PROMO-END-TMST            04080000
                                           EP231-STR-GRP-PROMO-END-TMST.04090000
002800     MOVE EP072-SOR-LAST-UPD-TMST TO EP231-SOR-LAST-UPD-TMST.     04100000
079600     MOVE PV-PROMO-STRT-TM-HH     TO PV-STRT-TM-HH.               04110000
079700     MOVE PV-PROMO-STRT-TM-MM     TO PV-STRT-TM-MM.               04120000
079800     MOVE PV-PROMO-STRT-TM-SS     TO PV-STRT-TM-SS.               04130000
079900     MOVE PV-PROMO-END-TM-HH      TO PV-END-TM-HH.                04140000
080000     MOVE PV-PROMO-END-TM-MM      TO PV-END-TM-MM.                04150000
080100     MOVE PV-PROMO-END-TM-SS      TO PV-END-TM-SS.                04160000
080200                                                                  04170000
080300     MOVE PV-PROMO-STRT-DTE-CCYY  TO PV-LIST-CCYY.                04180000
080400     MOVE PV-PROMO-STRT-DTE-MM    TO PV-LIST-MM.                  04190000
080500     MOVE PV-PROMO-STRT-DTE-DD    TO PV-LIST-DD.                  04200000
080600                                                                  04210000
092700     MOVE EP072-FILE-ACT-TYP         TO EP231-FILE-ACT-TYP.       04220000
092800     MOVE EP072-STR-SELN-HIER-CDE    TO EP231-STR-SELN-HIER-CDE.  04230000
093000     MOVE EP072-DIST-STR-GRP-TYP-CDE                              04240000
093000                                    TO EP231-DIST-STR-GRP-TYP-CDE.04250000
093100     MOVE EP072-DIST-STR-GRP-ID      TO EP231-DIST-STR-GRP-ID.    04260000
093900     MOVE EP072-APPLY-IND            TO EP231-APPLY-IND.          04270000
232700     MOVE EP072-RECORD-ACTION        TO EP231-RECORD-ACTION.      04280000
232700     MOVE EP072-PRC-SETUP-IND        TO EP231-PRC-SETUP-IND.      04290000
232700     MOVE EP072-EXCL-MDSE-ID         TO EP231-EXCL-MDSE-ID        04300000
           MOVE EP072-MDSE-INC-EXC-IND     TO EP231-MDSE-INC-EXC-IND.   04310000
                                                                        04320000
091500     PERFORM 7200-SELECT-SMPL-PRICG-DATA.                         04330000
                                                                        04340000
           IF PS-STYLE-FOUND                                            04350000
246510        IF XST00028-MDSE-HIER-CDE = PC-STYLE                      04360000
      **         DISPLAY 'MDSE-HIER-CDE = STY -CHECK STYLE-ID'          04370002
105000**         DISPLAY XST00130-PROMO-INTFC-ID ' '                    04380002
105100**                 XST00130-MDSE-LNE-ID                           04390002
246511           PERFORM 7210-LOOKUP-MDSE-HIER-INFO                     04400000
246520        END-IF                                                    04410000
              IF PS-NOT-SKIP-REC                                        04420000
181200            PERFORM 4400-OPEN-FORM-CURSOR                         04430000
181200            PERFORM 4500-FETCH-FORM-CURSOR                        04440000
                  PERFORM 4410-PROCESS                                  04450000
                       UNTIL PS-END-OF-CURSOR                           04460000
192400            PERFORM 4600-CLOSE-FORM-CURSOR                        04470000
              END-IF                                                    04480000
           END-IF.                                                      04490000
                                                                        04500000
091600     PERFORM 9000-READ-INPUT-FILE.                                04510000
091700                                                                  04520000
091800*2000-EXIT.                                                       04530000
091900 EJECT.                                                           04540000
092000                                                                  04550000
180800*----------------------------------------------------------       04560000
180900* 4400-OPEN-FORM-CURSOR.                                          04570000
181000*     GET LARGEST TIMESTAMP RECORD                                04580000
181000*     OPEN THE FORM CURSOR                                        04590000
181100*----------------------------------------------------------       04600000
181200 4400-OPEN-FORM-CURSOR.                                           04610000
181300                                                                  04620000
182100     EXEC SQL                                                     04630000
               SELECT REBT_FM_ID                                        04640000
                  INTO :XST00130-REBT-FM-ID                             04650000
                 FROM XST_REBT_FM A                                     04660000
                 WHERE A.LAST_UPD_TMST =                                04670000
                  (SELECT MAX(B.LAST_UPD_TMST) FROM XST_REBT_FM B       04680000
                   WHERE  B.PROMO_INTFC_ID  = :XST00130-PROMO-INTFC-ID  04690000
                      AND  B.MDSE_LNE_ID     = :XST00130-MDSE-LNE-ID)   04700000
           END-EXEC.                                                    04710000
                                                                        04720000
188600     EVALUATE TRUE                                                04750000
188700         WHEN SQLCODE = -904                                      04760000
188800         WHEN SQLCODE = -911                                      04770000
188900         WHEN SQLCODE = -913                                      04780000
189000             MOVE ZERO TO XST00130-REBT-FM-ID                     04800000
189100         WHEN SQLCODE = ZERO                                      04810000
273300             CONTINUE                                             04830000
189300         WHEN SQLCODE = +100                                      04840000
189000             MOVE ZERO TO XST00130-REBT-FM-ID                     04860000
189800         WHEN SQLWARN0 NOT EQUAL SPACE                            04870000
189900         WHEN SQLCODE NOT EQUAL ZERO                              04880000
190000            MOVE '4400-SELECT'                                    04890000
190100                            TO PV-PARAGRAPH-NAME                  04900000
190200            MOVE 'ERROR ON SELECT'                                04910000
190300                            TO PV-DB2-OPERATION                   04920000
190400            DISPLAY 'SQLCODE= ' SQLCODE                           04930000
190500            PERFORM 9900-SQL-ABEND-ROUTINE                        04940000
190600     END-EVALUATE.                                                04950000
                                                                        04960000
181400     PERFORM                                                      04970000
181500         WITH TEST AFTER                                          04980000
181600         VARYING PV-SQL-SUB                                       04990000
181700         FROM 1 BY 1                                              05000000
181800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05010000
181900                   OR  SQLCODE = 0)                               05020000
182000                                                                  05030000
182100         EXEC SQL                                                 05040000
182200            OPEN FORM-CURSOR                                      05050000
182300         END-EXEC                                                 05060000
182400                                                                  05070000
182500         EVALUATE TRUE                                            05080000
182600             WHEN SQLCODE = -904                                  05090000
182700             WHEN SQLCODE = -911                                  05100000
182800             WHEN SQLCODE = -913                                  05110000
182900                  CONTINUE                                        05120000
183000             WHEN SQLCODE = 0                                     05130000
183100                  SET PS-NOT-END-OF-CURSOR TO TRUE                05140000
183200             WHEN SQLWARN0 NOT EQUAL SPACE                        05150000
183300             WHEN SQLCODE NOT EQUAL ZERO                          05160000
183400                  MOVE '4400-OPEN-FORM-CURSOR'                    05170000
183500                                     TO PV-PARAGRAPH-NAME         05180000
183600                  MOVE 'ERROR ON OPEN OF FORM CURSOR'             05190000
183700                                     TO PV-DB2-OPERATION          05200000
183800                  PERFORM 9900-SQL-ABEND-ROUTINE                  05210000
183900         END-EVALUATE                                             05220000
           END-PERFORM.                                                 05230000
184100                                                                  05240000
184200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05250000
184300          MOVE '4400-OPEN-FORM-CURSOR'                            05260000
184400                                 TO  PV-PARAGRAPH-NAME            05270000
184500          MOVE 'OPEN RETRIES EXCEEDED'                            05280000
184600                                 TO  PV-DB2-OPERATION             05290000
18470           PERFORM 9900-SQL-ABEND-ROUTINE                          05300000
184800     END-IF.                                                      05310000
184900                                                                  05320000
185000*4400-EXIT.                                                       05330000
185100 EJECT.                                                           05340000
185200                                                                  05350000
       4410-PROCESS.                                                    05360000
           PERFORM 9100-FORMAT-REBATE-REC.                              05370000
           PERFORM 9200-WRITE-REBATE-REC.                               05380000
           PERFORM 4500-FETCH-FORM-CURSOR.                              05390000
185000*4410-EXIT.                                                       05400000
                                                                        05410000
185300*----------------------------------------------------------       05420000
185400* 4500-FETCH-FORM-CURSOR.                                         05430000
185500*     FETCH THE REBATES ROWS.                                     05440000
185600*----------------------------------------------------------       05450000
185700 4500-FETCH-FORM-CURSOR.                                          05460000
186600                                                                  05470000
185900     PERFORM                                                      05480000
186000         WITH TEST AFTER                                          05490000
186100         VARYING PV-SQL-SUB                                       05500000
186200         FROM 1 BY 1                                              05510000
186300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05520000
186400                   OR  SQLCODE = 0                                05530000
186500                   OR  SQLCODE = +100)                            05540000
186600                                                                  05550000
186700          EXEC SQL                                                05560000
186800             FETCH FORM-CURSOR                                    05570000
186900             INTO  :XST00131-REBT-FM-ID                           05580000
187000                  ,:XST00131-FM-SECT-TYP-CDE                      05590000
187100                  ,:XST00131-FM-LNE-NBR                           05600000
187200                  ,:XST00131-REBT-PROMO-ID                        05610000
187200                  ,:XST00131-FM-LNE-TYP-CDE :PV-FM-LNE-TYP-IND    05620000
187300                  ,:XST00131-EFF-END-DTE :PV-EFF-END-DTE-IND      05630000
187400                  ,:XST00131-FM-TXT                               05640000
188400             END-EXEC                                             05650000
188600             EVALUATE TRUE                                        05660000
188700                WHEN SQLCODE = -904                               05670000
188800                WHEN SQLCODE = -911                               05680000
188900                WHEN SQLCODE = -913                               05690000
189000                     CONTINUE                                     05700000
189100                WHEN SQLCODE = ZERO                               05710000
                           CONTINUE                                     05720000
189300                WHEN SQLCODE = +100                               05730000
189400                     SET PS-END-OF-CURSOR    TO TRUE              05740000
189800                WHEN SQLWARN0 NOT EQUAL SPACE                     05750000
189900                WHEN SQLCODE NOT EQUAL ZERO                       05760000
190000                     MOVE '4500-FETCH-FORM-CURSOR'                05770000
190100                                        TO PV-PARAGRAPH-NAME      05780000
190200                     MOVE 'ERROR ON FETCHING FORM CURSOR'         05790000
190300                                        TO PV-DB2-OPERATION       05800000
190400                     DISPLAY 'SQLCODE= ' SQLCODE                  05810000
190500                     PERFORM 9900-SQL-ABEND-ROUTINE               05820000
190600             END-EVALUATE                                         05830000
190700     END-PERFORM.                                                 05840000
190800                                                                  05850000
190900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        05860000
191000         MOVE '4500-FETCH-FORM-CURSOR'                            05870000
191100                               TO  PV-PARAGRAPH-NAME              05880000
191200         MOVE 'FETCH RETRIES EXCEEDED'                            05890000
191300                               TO  PV-DB2-OPERATION               05900000
191400         PERFORM 9900-SQL-ABEND-ROUTINE                           05910000
191500     END-IF.                                                      05920000
191700*4500-EXIT.                                                       05930000
191800 EJECT.                                                           05940000
191900                                                                  05950000
192000*-----------------------------------------------------------      05960000
192100* 4600-CLOSE-FORM-CURSOR.                                         05970000
192200*     CLOSE THE REBATE CURSOR.                                    05980000
192300*-----------------------------------------------------------      05990000
192400 4600-CLOSE-FORM-CURSOR.                                          06000000
193200                                                                  06010000
192600     PERFORM                                                      06020000
192700         WITH TEST AFTER                                          06030000
192800         VARYING PV-SQL-SUB                                       06040000
192900         FROM 1 BY 1                                              06050000
193000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06060000
193100                   OR  SQLCODE = 0)                               06070000
193200                                                                  06080000
193300         EXEC SQL                                                 06090000
193400            CLOSE FORM-CURSOR                                     06100000
193500         END-EXEC                                                 06110000
193600                                                                  06120000
193700         EVALUATE TRUE                                            06130000
193800            WHEN SQLCODE = -904                                   06140000
193900            WHEN SQLCODE = -911                                   06150000
194000            WHEN SQLCODE = -913                                   06160000
194100            WHEN SQLCODE = 0                                      06170000
194200                 CONTINUE                                         06180000
194300            WHEN SQLWARN0 NOT EQUAL SPACE                         06190000
194400            WHEN SQLCODE NOT EQUAL ZERO                           06200000
194500                 MOVE '4600-CLOSE-FORM-CURSOR'                    06210000
194600                                     TO PV-PARAGRAPH-NAME         06220000
194700                MOVE 'ERROR ON CLOSE OF FORM CURSOR'              06230000
194800                                     TO PV-DB2-OPERATION          06240000
194900                 PERFORM 9900-SQL-ABEND-ROUTINE                   06250000
195000         END-EVALUATE                                             06260000
           END-PERFORM.                                                 06270000
195200                                                                  06280000
195300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         06290000
195400        MOVE '4600-CLOSE-FORM-CURSOR'                             06300000
195500                               TO  PV-PARAGRAPH-NAME              06310000
195600        MOVE 'CLOSE RETRIES EXCEEDED'                             06320000
195700                               TO  PV-DB2-OPERATION               06330000
195800        PERFORM 9900-SQL-ABEND-ROUTINE                            06340000
195900     END-IF.                                                      06350000
                                                                        06360000
196100*4600-EXIT.                                                       06370000
196200 EJECT.                                                           06380000
196300                                                                  06390000
101100*----------------------------------------------------------       06400000
101200* 7200-SELECT-SMPL-PRICG-DATA.                                    06410000
101300*     GET THE THE MDSE-HIER-CDE - IF 'STY' LOOK FOR IT            06420000
101300*     ON XST_VNDR_STYL - IF NOT THERE DO NOT WRITE OUT FORM       06430000
101300*     (SAME AS INCENTIVE PROGRAM EPKUT111)                        06440000
101400*----------------------------------------------------------       06450000
101500 7200-SELECT-SMPL-PRICG-DATA.                                     06460000
 01600                                                                  06470000
021800     SET PS-NOT-SKIP-REC TO TRUE.                                 06480000
           SET PS-NOT-STYLE-FOUND TO TRUE.                              06490000
                                                                        06500000
101700     PERFORM                                                      06510000
101800         WITH TEST AFTER                                          06520000
101900         VARYING PV-SQL-SUB                                       06530000
102000         FROM 1 BY 1                                              06540000
102100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06550000
102200                   OR  SQLCODE = 0                                06560000
102300                   OR  SQLCODE = +100)                            06570000
102400                                                                  06580000
102500         EXEC SQL                                                 06590000
103110             SELECT  A.MDSE_HIER_CDE                              06600000
                          ,A.STYL_ID                                    06610000
104210               INTO  :XST00028-MDSE-HIER-CDE                      06620000
104100                    ,:XST00028-STYL-ID :PV-STYL-ID-IND            06630000
104800               FROM  XST_MDSE_LNE_SELN A                          06640000
104900                    ,XST_SMP_PRICG B                              06650000
105000               WHERE A.PROMO_INTFC_ID = :XST00130-PROMO-INTFC-ID  06660000
105100                 AND A.MDSE_LNE_ID    = :XST00130-MDSE-LNE-ID     06670000
105200                 AND A.PROMO_INTFC_ID = B.PROMO_INTFC_ID          06680000
105300                 AND A.MDSE_LNE_ID    = B.MDSE_LNE_ID             06690000
105400                 AND A.STAT_CDE       = B.STAT_CDE                06700000
105500                 AND ((B.STAT_CDE     = :PV-SCHEDULED-STAT)       06710000
105600                  OR  (B.STAT_CDE     = :PV-CANCEL-STAT)          06720000
105700                  OR  (B.STAT_CDE     = :PV-DELETE-STAT))         06730000
105800               WITH UR                                            06740000
105900         END-EXEC                                                 06750000
106000                                                                  06760000
106100         EVALUATE TRUE                                            06770000
106200             WHEN SQLCODE = -904                                  06780000
106300             WHEN SQLCODE = -911                                  06790000
106400             WHEN SQLCODE = -913                                  06800000
106500                  CONTINUE                                        06810000
106600             WHEN SQLCODE = 0                                     06820000
                        SET PS-STYLE-FOUND TO TRUE                      06830000
106800             WHEN SQLCODE = +100                                  06840000
106900                  SET PS-SKIP-REC TO TRUE                         06850000
                        DISPLAY 'NO MDSE-LNE-SELN/SMP-PRICG FOUND '     06860000
107000             WHEN OTHER                                           06870000
107100                  DISPLAY 'PROMO INTFC ID: '                      06880000
107200                                         XST00130-PROMO-INTFC-ID  06890000
107300                  DISPLAY 'MDSE LNE ID: ' XST00130-MDSE-LNE-ID    06900000
107400                  DISPLAY 'SQLCODE: ' SQLCODE                     06910000
107500                  MOVE '7200-SELECT-SMPL-PRICG-DATA'              06920000
107600                                TO  PV-PARAGRAPH-NAME             06930000
107700                  MOVE 'SELECT SMPL PRICG DATA'                   06940000
107800                                TO  PV-DB2-OPERATION              06950000
107900                  PERFORM 9900-SQL-ABEND-ROUTINE                  06960000
108000         END-EVALUATE                                             06970000
108100     END-PERFORM.                                                 06980000
108200                                                                  06990000
108300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07000000
108400        DISPLAY 'SQLCODE: ' SQLCODE                               07010000
108500        MOVE '7200-SELECT-SMPL-PRICG-DATA'                        07020000
108600                              TO  PV-PARAGRAPH-NAME               07030000
108700        MOVE 'SELECT RETRIES EXCEEDED'                            07040000
108800                              TO  PV-DB2-OPERATION                07050000
108900        PERFORM 9900-SQL-ABEND-ROUTINE                            07060000
109000     END-IF.                                                      07070000
109100                                                                  07080000
109200*7200-EXIT.                                                       07090000
109300 EJECT.                                                           07100000
249801*----------------------------------------------------------       07110000
249802* 7210-LOOKUP-MDSE-HIER-INFO                                      07120000
249804*     SELECT THE "PARENT" MERCHANDISE INFORMATION.                07130000
249806*----------------------------------------------------------       07140000
249810 7210-LOOKUP-MDSE-HIER-INFO.                                      07150000
           INITIALIZE PV-NUM-ROWS.                                      07170000
249811                                                                  07180000
249812     PERFORM                                                      07190000
249813         WITH TEST AFTER                                          07200000
249814         VARYING PV-SQL-SUB                                       07210000
249815         FROM 1 BY 1                                              07220000
249821         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07230000
249822                   OR  SQLCODE = +0                               07240000
249823                   OR  SQLCODE = +100)                            07250000
249824                                                                  07260000
249825         EXEC SQL                                                 07270000
249826             SELECT  COUNT(*)                                     07280000
249829               INTO :PV-NUM-ROWS                                  07290000
249832               FROM  XST_VND_STYL                                 07300000
249833               WHERE STYL_ID = :XST00028-STYL-ID                  07310000
249834               WITH UR                                            07320000
249835         END-EXEC                                                 07330000
249836                                                                  07340000
249837         EVALUATE TRUE                                            07370000
249838             WHEN SQLCODE = -904                                  07380000
249839             WHEN SQLCODE = -911                                  07390000
249840             WHEN SQLCODE = -913                                  07400000
249841                  CONTINUE                                        07410000
249842             WHEN SQLCODE = +0                                    07420000
249843                  IF PV-NUM-ROWS = 0                              07430000
                           DISPLAY 'NO STYL-ID ON XST_VNDR_STYL - SKIP' 07440000
                           ' PROMO ' XST00028-STYL-ID                   07450000
107100                     DISPLAY 'PROMO INTFC ID: '                   07460000
107200                                         XST00130-PROMO-INTFC-ID  07470000
107300                     DISPLAY 'MDSE LNE ID: ' XST00130-MDSE-LNE-ID 07480000
249845                     SET PS-SKIP-REC TO TRUE                      07490000
                        END-IF                                          07500000
249844             WHEN SQLCODE = +100                                  07510000
249845                  SET PS-SKIP-REC TO TRUE                         07520000
249847                  DISPLAY 'STYLE ID: ' XST00028-STYL-ID           07530000
249850                  DISPLAY 'SQLCODE: ' SQLCODE                     07540000
249851                  MOVE '7210-LOOKUP-MDSE-HIER-INFO'               07550000
249853                                TO  PV-PARAGRAPH-NAME             07560000
249854                  MOVE 'SELECT MDSE HIER INFO FOR STYLE LVL REC'  07570000
249855                                TO  PV-DB2-OPERATION              07580000
249856             WHEN OTHER                                           07590000
249859                  DISPLAY 'STYLE ID: ' XST00028-STYL-ID           07600000
249860                  DISPLAY 'SQLCODE: ' SQLCODE                     07610000
249861                  MOVE '7210-LOOKUP-MDSE-HIER-INFO'               07620000
249862                                TO  PV-PARAGRAPH-NAME             07630000
249863                  MOVE 'SELECT MDSE HIER INFO FOR STYLE LVL REC'  07640000
249864                                TO  PV-DB2-OPERATION              07650000
249865                  PERFORM 9900-SQL-ABEND-ROUTINE                  07660000
249866         END-EVALUATE                                             07670000
249867     END-PERFORM.                                                 07680000
249868                                                                  07690000
249869     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07700000
249870        DISPLAY 'SQLCODE: ' SQLCODE                               07710000
249871        MOVE '7210-LOOKUP-MDSE-HIER-INFO'                         07720000
249872                              TO  PV-PARAGRAPH-NAME               07730000
249873        MOVE 'SELECT RETRIES EXCEEDED'                            07740000
249874                              TO  PV-DB2-OPERATION                07750000
249875        PERFORM 9900-SQL-ABEND-ROUTINE                            07760000
249876     END-IF.                                                      07770000
249877                                                                  07780000
249878*7210-EXIT.                                                       07790000
249879 EJECT.                                                           07800000
                                                                        07810000
268140*----------------------------------------------------------       07820000
268200* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      07830000
268300* CCYYMMDD FORMAT.                                                07840000
268400*----------------------------------------------------------       07850000
268500 8000-DATE-ROUTINE.                                               07860000
268600                                                                  07870000
268700     INITIALIZE DPG51 DPG52 DPG53                                 07880000
268800                DPG54 DPG55 DPG56.                                07890000
268900                                                                  07900000
269000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      07910000
269100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      07920000
269200     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    07930000
269300                                                                  07940000
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07950000
269500                                             DPG54 DPG55 DPG56.   07960000
269600                                                                  07970000
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  07980000
269800       DISPLAY '** ABEND **'                                      07990000
269900       DISPLAY '** PROGRAM = EPKUT193'                            08000000
270000       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        08010000
270100       DISPLAY DPG54-ERROR-MESSAGE                                08020000
270200       MOVE 4019 TO ABEND-CODE                                    08030000
270300       CALL 'ILBOABN0' USING ABEND-CODE                           08040000
270400     END-IF.                                                      08050000
270500                                                                  08060000
270600     MOVE DPG55-DB2-ISO-DATE         TO PV-EP111-CC-ISO-DATE.     08070000
270700                                                                  08080000
270800*8000-EXIT.                                                       08090000
270900 EJECT.                                                           08100000
271000*----------------------------------------------------------       08110000
271100* 9000-READ-INPUT-FILE.                                           08120000
271200*     READ THE FILE INTO THE PROMO INTERFACE ID COPYBOOK.         08130000
271300*----------------------------------------------------------       08140000
271400 9000-READ-INPUT-FILE.                                            08150000
271500                                                                  08160000
271600     READ PROMO-INTFC-ID-FILE                                     08170000
271700         INTO EP072-PROMO-INTFC-RECORD                            08180000
271800         AT END                                                   08190000
271900             SET PS-END-OF-INPUT-FILE TO TRUE                     08200000
272000     END-READ.                                                    08210000
272100                                                                  08220000
272200     IF PS-NOT-END-OF-INPUT-FILE                                  08230000
272300        ADD 1 TO PC-CNT-READ-RECS                                 08240000
272400     END-IF.                                                      08250000
272500                                                                  08260000
272600*9000-EXIT.                                                       08270000
272700 EJECT.                                                           08280000
272800                                                                  08290000
272900*----------------------------------------------------------       08300000
273000* 9100-FORMAT-REBATE-REC.                                         08310000
273100*     MOVE FROM THE XST TABLE TO THE EPRD231 REC                  08320000
273200*----------------------------------------------------------       08330000
273300 9100-FORMAT-REBATE-REC.                                          08340000
186900      MOVE XST00131-REBT-FM-ID      TO EP231-REBT-FM-ID.          08350000
187000      MOVE XST00131-FM-SECT-TYP-CDE TO EP231-FM-SECT-TYP-CDE.     08360000
187100      MOVE XST00131-FM-LNE-NBR      TO EP231-FM-LNE-NBR.          08370000
187200      MOVE XST00131-REBT-PROMO-ID   TO EP231-REBT-PROMO-ID.       08380000
            IF PV-FM-LNE-TYP-NULL                                       08390000
                MOVE PC-NULL-VALUE      TO EP231-FM-LNE-TYP-CDE         08400000
            ELSE                                                        08410000
                MOVE XST00131-FM-LNE-TYP-CDE TO EP231-FM-LNE-TYP-CDE    08420000
            END-IF.                                                     08430000
            IF PV-EFF-END-DTE-NULL                                      08440000
                MOVE PC-NULL-VALUE       TO EP231-EFF-END-DTE           08450000
            ELSE                                                        08460000
                MOVE XST00131-EFF-END-DTE  TO EP231-EFF-END-DTE         08470000
            END-IF.                                                     08480000
187400      MOVE XST00131-FM-TXT           TO EP231-FM-TXT.             08490000
272600*9100-EXIT.                                                       08500000
272700 EJECT.                                                           08510000
272900*----------------------------------------------------------       08520000
273000* 9200-WRITE-REBATE-REC.                                          08530000
273100*     WRITES THE REBATE RECORD TO THE PROMO FILE.                 08540000
273200*----------------------------------------------------------       08550000
273300 9200-WRITE-REBATE-REC.                                           08560000
273400                                                                  08570000
273500     WRITE REBATE-RECORD                                          08580000
273600       FROM EP231-REBATE-INTFC-RECORD.                            08590000
273700                                                                  08600000
273800     ADD 1 TO PC-CNT-REBATE-RECS.                                 08610000
274000                                                                  08620000
274100*9200-EXIT.                                                       08630000
274200 EJECT.                                                           08640000
274300                                                                  08650000
275900*----------------------------------------------------------       08660000
276000* 9800-ABEND.                                                     08670000
276100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  08680000
276200*----------------------------------------------------------       08690000
276300 9800-ABEND.                                                      08700000
276400                                                                  08710000
276500     DISPLAY '** ABEND           **'.                             08720000
276600     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  08730000
276700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08740000
276800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08750000
276900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08760000
277000     CALL 'ILBOABN0' USING ABEND-CODE.                            08770000
277100                                                                  08780000
277200*9800-EXIT.                                                       08790000
277300 EJECT.                                                           08800000
277400                                                                  08810000
277500*----------------------------------------------------------       08820000
277600* 9900-SQL-ABEND-ROUTINE.                                         08830000
277700*     SQL ABEND ROUTINE.                                          08840000
277800*----------------------------------------------------------       08850000
277900 9900-SQL-ABEND-ROUTINE.                                          08860000
278000                                                                  08870000
278100     DISPLAY '** ABEND     **'.                                   08880000
278200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08890000
278300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08900000
278400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               08910000
278500                                                                  08920000
278600     COPY DPPD004.                                                08930000
278700     SET ABEND-4013-DB2-ERROR TO TRUE.                            08940000
278800     CALL 'ILBOABN0' USING ABEND-CODE.                            08950000
278900                                                                  08960000
279000*9900-EXIT.                                                       08970000
279100 EJECT.                                                           08980000
279200                                                                  08990000
279300*----------------------------------------------------------       09000000
279400* 9999-WRAPUP.                                                    09010000
279500*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      09020000
279600*     ANY DATA FROM THE PROGRAM.                                  09030000
279700*----------------------------------------------------------       09040000
279800 9999-WRAPUP.                                                     09050000
279900                                                                  09060000
280000     CLOSE PROMO-INTFC-ID-FILE                                    09070000
280100           CONTROL-CARD-CURR-PRICG-DTE                            09080000
280200           REBATE-FILE.                                           09090000
280400                                                                  09100000
280500     DISPLAY ' '.                                                 09110000
280600     DISPLAY '*********************************************'.     09120000
280700     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            09130000
280800     DISPLAY '*********************************************'.     09140000
280900     DISPLAY 'NUMBER OF INPUT RECS READ: ' PC-CNT-READ-RECS.      09150000
281000     DISPLAY 'NUMBER OF REBATE RECS WRITTEN: ' PC-CNT-REBATE-RECS.09160000
281300     DISPLAY '*********************************************'.     09170000
281400                                                                  09180000
281500*9999-EXIT.                                                       09190000
281600 EJECT.                                                           09200000
281700                                                                  09210000
