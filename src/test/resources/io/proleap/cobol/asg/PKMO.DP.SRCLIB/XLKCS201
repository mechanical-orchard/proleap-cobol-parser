000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.      XLKCS201.                                       00050000
000600 AUTHOR.          DENISE HAHN.                                    00060000
000700 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00070000
000800 DATE-WRITTEN.    APRIL 2003.                                     00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS DB2 CICS PROGRAM WILL RESTART ITSELF AND                  *00120000
001300* WILL CREATE MQ MESSAGES FOR VERIFIED RECEIPTS/ADJUSTMENTS      *00130000
001400* TO BE DOWNLOADED TO RMS.                                       *00140000
001401*                                                                *00140100
001402* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * **00140200
001403*                                                                *00140300
001404* CHANGED 11/15/2018 TO INCLUDE MESSAGES PREVIOUSLY PROCESSED BY *00140400
001405* THE STORED PROCEDURE (XLKSP002).  THESE ARE THE PACKSLIP CREATE*00140500
001406* AND ASN PROCESSED MESSAGES (PSLPCK & ASNPCK)                   *00140600
001407* SEPARATE CURSOR AND QUEUES FOR THESE MESSAGES                  *00140700
001408******************************************************************00140800
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00141002
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00141102
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00141202
263627******************************************************************00141302
001409                                                                  00141400
001410 ENVIRONMENT DIVISION.                                            00141500
001420******************************************************************00142000
001430                                                                  00143000
001440******************************************************************00144000
001450 DATA DIVISION.                                                   00145000
001460******************************************************************00146000
001470                                                                  00147000
001480 WORKING-STORAGE SECTION.                                         00148000
001490******************************************************************00149000
001500* DB2 KEYS                                                       *00150000
001600******************************************************************00160000
001700 01  DK-DB2-KEYS.                                                 00170000
001800     05  PV-PRC-CNTL-TMST             PIC  X(26)   VALUE SPACES.  00180000
001900                                                                  00190000
002000******************************************************************00200000
002100* PC PROGRAM CONSTANTS                                           *00210000
002200******************************************************************00220000
002300 01  PC-PROGRAM-CONSTANTS.                                        00230000
002400     05  PC-PROGRAM-NAME             PIC  X(8) VALUE 'XLKCS201'.  00240000
002500     05  PC-L201-TRANSID             PIC  X(04) VALUE 'L201'.     00250000
002600     05  PC-MAX-RETRIES              PIC S9(4) VALUE  +5          00260000
002700                                               COMP.              00270000
002800     05  PC-STAT-HOLD                PIC  X(01) VALUE 'Y'.        00280000
002900****************************************************************  00290000
003000**                                                            **  00300000
003100**     M Q   S E R I E S    W O R K I N G   S T O R A G E     **  00310000
003200**                                                            **  00320000
003300**                  M  Q    C O P Y B O O K S                 **  00330000
003400**                                                            **  00340000
003500****************************************************************  00350000
003600*** MQ - OBJECT DESCRIPTOR                                        00360000
003700 01  MQM-OBJECT-DESCRIPTOR.                                       00370000
003800     COPY CMQODV.                                                 00380000
003900                                                                  00390000
004000*** MQ - MESSAGE DESCRIPTOR                                       00400000
004100 01  MQM-MESSAGE-DESCRIPTOR.                                      00410000
004200     COPY CMQMDV.                                                 00420000
004300                                                                  00430000
004400*** MQ - PUT MESSAGE OPTIONS                                      00440000
004500 01  MQM-PUT-MESSAGE-OPTIONS.                                     00450000
004600     COPY CMQPMOV.                                                00460000
004700                                                                  00470000
004800*** MQ - GET MESSAGE OPTIONS                                      00480000
004900 01  MQM-GET-MESSAGE-OPTIONS.                                     00490000
005000     COPY CMQGMOV.                                                00500000
005100                                                                  00510000
005200*** MQ - CONSTANTS                                                00520000
005300 01  MQM-CONSTANTS.                                               00530000
005400     COPY CMQV.                                                   00540000
005500                                                                  00550000
005600****************************************************************  00560000
005700**  QUEUE MANAGER AND QUEUE NAME                                  00570000
005800****************************************************************  00580000
005900* ------------------------------------------------------------- * 00590000
006000*  CONTROL CARD 1 = QUEUE MANAGER NAME                            00600000
006100* ------------------------------------------------------------- * 00610000
006200 01  QM-CONTROL-CARD-1.                                           00620000
006300     05  QM-QMGR-NAME                PIC X(04).                   00630000
006400                                                                  00640000
006500* ------------------------------------------------------------- * 00650000
006600*  CONTROL CARD 2 = TRANSACTION QUEUE NAME                        00660000
006700* ------------------------------------------------------------- * 00670000
006800 01  QM-CONTROL-CARD-2.                                           00680000
006900     05  QM-TRANS-QUEUE-NAME         PIC X(48).                   00690000
007000     05  FILLER                      PIC X(32).                   00700000
007100                                                                  00710000
007200* ------------------------------------------------------------- * 00720000
007300*  CONTROL CARD 3 = TRANSACTION REMOTE QMGR NAME                  00730000
007400* ------------------------------------------------------------- * 00740000
007500 01  QM-CONTROL-CARD-3.                                           00750000
007600     05  QM-QMGR-NAME-REMOTE         PIC X(48).                   00760000
007700     05  FILLER                      PIC X(32).                   00770000
007800                                                                  00780000
007900* ------------------------------------------------------------- * 00790000
008000*  TRANSACTION QUEUE WORK FIELDS                                  00800000
008100* ------------------------------------------------------------- * 00810000
008200 01  QM-TRANS-QUEUE-WORK.                                         00820000
008300     05  QM-TRANS-QUEUE-WORK1        PIC X(25).                   00830000
008400     05  QM-TRANS-QUEUE-WORK2        PIC X(23).                   00840000
008500     05  FILLER                      PIC X(32).                   00850000
008600                                                                  00860000
008700 01  QM-PKSL-TRANS-QUEUE-WORK.                                    00870000
008800     05  QM-PKSL-TRANS-QUEUE-WORK1   PIC X(19).                   00880000
008900     05  QM-PKSL-TRANS-QUEUE-WORK2   PIC X(29).                   00890000
009000     05  FILLER                      PIC X(32).                   00900000
009100                                                                  00910000
009200****************************************************************  00920000
009300** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS GET AND    **  00930000
009400*  OPEN, CONNECT, DISCONNECT.                                 **  00940000
009500****************************************************************  00950000
009600 01  MQV-WORKING-STORAGE.                                         00960000
009700     05  MQV-MQCOMMIT             PIC X(08)  VALUE 'CSQCCOMM'.    00970000
009800     05  MQV-MQCONN               PIC  X(08) VALUE 'CSQCCONN'.    00980000
009900     05  MQV-MQOPEN               PIC  X(08) VALUE 'CSQCOPEN'.    00990000
010000     05  MQV-MQINQ                PIC  X(08) VALUE 'CSQCINQ'.     01000000
010100     05  MQV-MQPUT                PIC  X(08) VALUE 'CSQCPUT'.     01010000
010200     05  MQV-MQGET                PIC  X(08) VALUE 'CSQCGET'.     01020000
010300     05  MQV-MQCMIT               PIC  X(08) VALUE 'CSQCCOMM'.    01030000
010400     05  MQV-MQBACK               PIC  X(08) VALUE 'CSQCBACK'.    01040000
010500     05  MQV-MQCLOSE              PIC  X(08) VALUE 'CSQCCLOS'.    01050000
010600     05  MQV-MQDISC               PIC  X(08) VALUE 'CSQCDISC'.    01060000
010700     05  MQV-MQCHECK              PIC  X(08) VALUE 'MQR2C'.       01070000
010800     05  MQV-HCONN                PIC S9(09) BINARY VALUE 0.      01080000
010900     05  MQV-COMPLETION-CODE      PIC S9(09) BINARY.              01090000
011000     05  MQV-REASON               PIC S9(09) BINARY.              01100000
011100     05  MQV-OPEN-OPTIONS         PIC S9(09) BINARY.              01110000
011200     05  MQV-LOC-HANDLE           PIC S9(09) BINARY VALUE 0.      01120000
011300     05  MQV-ERROR-HANDLE         PIC S9(09) BINARY VALUE 0.      01130000
011400     05  MQV-REASON-TEXT          PIC  X(30) VALUE SPACES.        01140000
011500     05  MQV-MSGBUFFER            PIC  X(20000) VALUE SPACES.     01150000
011600     05  MQV-MSG                  PIC  X(20000) VALUE SPACES.     01160000
011700     05  MQV-MSG-LENGTH           PIC S9(09)                      01170000
011800                                      BINARY VALUE +20000.        01180000
011900     05  MQV-DATA-LENGTH          PIC S9(09) BINARY.              01190000
012000     05  MQV-LOGGING-MESSAGE      PIC X(80) VALUE SPACES.         01200000
012100                                                                  01210000
012200****************************************************************  01220000
012300* RETURN CODES ARE EVALUATED AND THIS SWITCH IS USED TO           01230000
012400* INDICATE ANY ERRORS (FROM WHAT I'VE SEEN THIS SWITCH IS         01240000
012500* USELESS SINCE THE PROGRAM ABENDS BEFORE IT IS USED ANYWHERE) *  01250000
012600****************************************************************  01260000
012700 01 PV-MQ-PROGRAM-SWITCHES.                                       01270000
012800     05  PS-MQ-ERROR-SW              PIC X(01) VALUE 'N'.         01280000
012900         88  PS-NO-MQ-ERROR                    VALUE 'N'.         01290000
013000         88  PS-MQ-ERROR                       VALUE 'Y'.         01300000
013100                                                                  01310000
013200****************************************************************  01320000
013300**                                                            **  01330000
013400**                     E N D   O F   M Q                      **  01340000
013500**                                                            **  01350000
013600****************************************************************  01360000
013700                                                                  01370000
013800******************************************************************01380000
013900* PV PROGRAM VARIABLES                                           *01390000
014000******************************************************************01400000
014100 01  PV-PROGRAM-VARIABLES.                                        01410000
014110     05  PV-TASK-X.                                               01411000
014120         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  01412000
014130     05  PV-CICS-MSG-AREA                PIC X(120)  VALUE SPACE. 01413000
014140     05  PV-WRITE-LENGTH                 PIC S9(04)  VALUE +0     01414000
014150                                                     COMP SYNC.   01415000
014200     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0           01420000
014300                                               COMP SYNC.         01430000
014400     05  PV-ACTION                    PIC  X(82)     VALUE SPACES.01440000
014500     05  PV-SQLCODE                   PIC S9(9).                  01450000
014600     05  PV-DISPLAY-SQLCODE           PIC -ZZ9.                   01460000
014700     05  PV-TOTAL-MQ-MSGS-SENT        PIC   9(9)     VALUE  0.    01470000
014800     05  PV-CURRENT-DATE              PIC   X(10).                01480000
014900     05  PV-CURRENT-TIME              PIC   X(08).                01490000
015000     05  PV-TRACKING-DATE             PIC   X(10).                01500000
015100     05  PV-TRACKING-TIME             PIC   X(08).                01510000
015200     05  PV-MESSAGE                   PIC   X(50)    VALUE SPACES.01520000
015300     05  PV-OFFSET-TIME               PIC   9(03).                01530000
015400     05  PV-RESTART-TIME              PIC  S9(09)    VALUE +0     01540000
015500                                                 COMP SYNC.       01550000
015600     05  PV-CICS-RESPONSE             PIC  S9(09)    VALUE ZERO   01560000
015700                                                 COMP SYNC.       01570000
015800     05  PV-COMMAREA-LENGTH           PIC  S9(04)    VALUE +0     01580000
015900                                                 COMP SYNC.       01590000
016000                                                                  01600000
016100* DMH 11/15/2018 - BEGIN                                          01610000
016200     05  PV-DISP-RESTART-SECONDS      PIC  Z(09)     VALUE ZERO.  01620000
016300     05  PV-DISP-BTCH-LOD-SEQ-ID      PIC  Z(09)    VALUE ZERO.   01630000
016400* DMH 11/15/2018 - END                                            01640000
016500                                                                  01650000
016600******************************************************************01660000
016700* PS PROGRAM SWITCHES                                            *01670000
016800******************************************************************01680000
016900 01  PS-PROGRAM-SWITCHES.                                         01690000
017000     05  PS-ABEND-SW                  PIC  X(01)     VALUE 'N'.   01700000
017100         88  PS-ABEND                                VALUE 'Y'.   01710000
017200         88  PS-NO-ABEND                             VALUE 'N'.   01720000
017300     05  PS-END-OF-CNTL-CSR-SW       PIC X(01) VALUE 'N'.         01730000
017400         88  PS-END-OF-CNTL-CSR-Y              VALUE 'Y'.         01740000
017500         88  PS-END-OF-CNTL-CSR-N              VALUE 'N'.         01750000
017600     05  PS-END-OF-XFER-CSR-SW       PIC X(01) VALUE 'N'.         01760000
017700         88  PS-END-OF-XFER-CSR-Y              VALUE 'Y'.         01770000
017800         88  PS-END-OF-XFER-CSR-N              VALUE 'N'.         01780000
017900     05  PS-DISPLAY-STATITICS        PIC X(01) VALUE 'N'.         01790000
018000         88  DISPLAY-STATISTICS                VALUE 'Y'.         01800000
018100     05  PS-DISPLAY-DEBUG            PIC X(01) VALUE 'N'.         01810000
018200         88  DISPLAY-MQ-DEBUG-MSG              VALUE 'Y'.         01820000
018300                                                                  01830000
018400* DMH 11/15/2018 - BEGIN                                          01840000
018500     05  PS-PARA-LOGGING-SW          PIC X(01) VALUE 'N'.         01850000
018600         88  PS-PARA-LOGGING-NO                VALUE 'N'.         01860000
018700         88  PS-PARA-LOGGING-YES               VALUE 'Y'.         01870000
018800     05  PS-END-OF-PKSL-CNTL-CSR-SW  PIC X(01) VALUE 'N'.         01880000
018810         88  PS-END-OF-PKSL-CNTL-CSR-Y         VALUE 'Y'.         01881000
018820         88  PS-END-OF-PKSL-CNTL-CSR-N         VALUE 'N'.         01882000
018830     05  PS-END-OF-PKSL-XFER-CSR-SW  PIC X(01) VALUE 'N'.         01883000
018840         88  PS-END-OF-PKSL-XFER-CSR-Y         VALUE 'Y'.         01884000
018850         88  PS-END-OF-PKSL-XFER-CSR-N         VALUE 'N'.         01885000
018860* DMH 11/15/2018 - END                                            01886000
018861* RPK 02/11/2019 - BEGIN                                          01886100
018862     05  PS-PKSL-PROCESSING-SW       PIC X(01) VALUE 'N'.         01886200
018863         88  PS-PKSL-PROCESSING-NO             VALUE 'N'.         01886300
018864         88  PS-PKSL-PROCESSING-YES            VALUE 'Y'.         01886400
018865* RPK 02/11/2019 - END                                            01886500
018870                                                                  01887000
018880******************************************************************01888000
018890* MSG   ERROR MESSAGE TO BE DISPLAYED IN THE STORED PROCEDURE    *01889000
018900*       ADDRESS SPACE                                            *01890000
019000******************************************************************01900000
019100 01  LE-STATUS-MESSAGE.                                           01910000
019200     05  LE-INFO-NMBR                 PIC X(12) VALUE             01920000
019300                                      '*** L201 ***'.             01930000
019400     05  FILLER                       PIC X(09) VALUE             01940000
019500         '  STATUS:'.                                             01950000
019600     05  LE-MSG                       PIC X(82) VALUE SPACES.     01960000
019700                                                                  01970000
019800******************************************************************01980000
019900* MESSAGE USED TO TRACK PROGRAM PARAGRAPH PROGRESS               *01990000
020000* ADDED - 11/15/2018                                             *02000000
020001******************************************************************02000100
020002 01  PV-TRACKING-DATA                 PIC X(103).                 02000200
020003 01  PV-TRACKING-MSG.                                             02000300
020004     05  FILLER                       PIC X(14) VALUE             02000400
020005                                      '*** L201 ***: '.           02000500
020006     05  PV-TRACKING-INFO             PIC X(103) VALUE SPACES.    02000600
020007                                                                  02000700
020008******************************************************************02000800
020009* NUMERIC EDIT LAYOUT                                            *02000900
020010* ADDED - 11/15/2018                                             *02001000
020020******************************************************************02002000
020030     COPY DPWS010I.                                               02003000
020040                                                                  02004000
020050******************************************************************02005000
020060*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *02006000
020070******************************************************************02007000
020080*    COPY DPWS004.                                                02008000
020090*                                                                 02009000
020100******************************************************************02010000
020200*    REPOSITORY LAYOUT - CAN HOLD UP TO 100 STORES OF DATA       *02020000
020300******************************************************************02030000
020400     COPY XLRD024.                                                02040000
020500                                                                  02050000
020600******************************************************************02060000
020700*    MQ LAYOUT - CAN HOLD UP TO 999 STORES OF DATA               *02070000
020800******************************************************************02080000
020900     COPY XLRD025.                                                02090000
021000                                                                  02100000
021100******************************************************************02110000
021200*    WFT00001 - WFT_LOD_CNTL DATABASE                            *02120000
021300******************************************************************02130000
021400     EXEC SQL                                                     02140000
021500         INCLUDE WFT00001                                         02150000
021600     END-EXEC.                                                    02160000
021700                                                                  02170000
021800******************************************************************02180000
021900*    WFT00002 - WFT_LOD_XFER DATABASE                            *02190000
022000******************************************************************02200000
022100     EXEC SQL                                                     02210000
022200         INCLUDE WFT00002                                         02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500******************************************************************02250000
022600*    TKRPRPM  - PARM DATABASE                                    *02260000
022700******************************************************************02270000
022800     EXEC SQL                                                     02280000
022900         INCLUDE TKRPRPM                                          02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200******************************************************************02320000
023300*    SQL COMMUNICATIONS AREA DCLGEN                              *02330000
023400******************************************************************02340000
023500     EXEC SQL                                                     02350000
023600         INCLUDE SQLCA                                            02360000
023700     END-EXEC.                                                    02370000
023800                                                                  02380000
023900******************************************************************02390000
024000* COBOL CURSOR DELCARATION TO FOR WFT_LOD_CNTL                   *02400000
024100******************************************************************02410000
024200     EXEC SQL                                                     02420000
024300       DECLARE CNTL-CSR  CURSOR WITH HOLD FOR                     02430000
024400        SELECT PRC_CNTL_TMST                                      02440000
024500             , STAT_CDE                                           02450000
024600             , STR_NBR                                            02460000
024610             , TRN_TYP_CDE                                        02461001
024700          FROM WFT_LOD_CNTL                                       02470000
024800         WHERE STR_NBR       = 999                                02480000
024900           AND STAT_CDE      = 'READY'                            02490000
025000           AND PRC_CNTL_TMST < :PV-PRC-CNTL-TMST                  02500000
025100        FOR UPDATE OF STAT_CDE                                    02510000
025200                     ,END_TMST                                    02520000
025300                     ,STR_NBR                                     02530000
025400     END-EXEC.                                                    02540000
025500******************************************************************02550000
025600* COBOL CURSOR DELCARATION TO FOR WFT_LOD_XFER                   *02560000
025700******************************************************************02570000
025800     EXEC SQL                                                     02580000
025900          DECLARE XFER-CSR CURSOR FOR                             02590000
026000          SELECT PRC_CNTL_TMST                                    02600000
026100               , LOD_DAT_TXT                                      02610000
026200               , BTCH_LOD_SEQ_ID                                  02620000
026300               , TRN_TYP_CDE                                      02630000
026400            FROM WFT_LOD_XFER                                     02640000
026500           WHERE PRC_CNTL_TMST  =  :WFT00001-PRC-CNTL-TMST        02650000
026510             AND TRN_TYP_CDE    =  :WFT00001-TRN-TYP-CDE          02651001
026600           ORDER BY BTCH_LOD_SEQ_ID                               02660000
026700     END-EXEC.                                                    02670000
026800                                                                  02680000
026900                                                                  02690000
027000                                                                  02700000
027100******************************************************************02710000
027200* PACKSLIP CREATE AND ASN PROCESSED DRIVING CURSOR-WFT_LOD_CNTL  *02720000
027210* DMH - 11/15/2018                                               *02721000
027220******************************************************************02722000
027230     EXEC SQL                                                     02723000
027240       DECLARE PKSL-ASN-CNTL-CSR  CURSOR WITH HOLD FOR            02724000
027250        SELECT PRC_CNTL_TMST                                      02725000
027260             , STAT_CDE                                           02726000
027270             , STR_NBR                                            02727000
027280          FROM WFT_LOD_CNTL                                       02728000
027290         WHERE STR_NBR       = 900                                02729000
027300           AND STAT_CDE      = 'READY'                            02730000
027301           AND PRC_CNTL_TMST < :PV-PRC-CNTL-TMST                  02730100
027302           AND TRN_TYP_CDE  IN ('PSLPCK','ASNPCK')                02730200
027303        FOR UPDATE OF STAT_CDE                                    02730300
027304                     ,END_TMST                                    02730400
027305                     ,STR_NBR                                     02730500
027306     END-EXEC.                                                    02730600
027307                                                                  02730700
027308******************************************************************02730800
027309* PACKSLIP CREATE AND ASN PROCESSED DETAIL CURSOR-WFT_LOD_XFER   *02730900
027310* DMH - 11/15/2018                                               *02731000
027311******************************************************************02731100
027312     EXEC SQL                                                     02731200
027313          DECLARE PKSL-ASN-XFER-CSR CURSOR FOR                    02731300
027314          SELECT PRC_CNTL_TMST                                    02731400
027315               , LOD_DAT_TXT                                      02731500
027316               , BTCH_LOD_SEQ_ID                                  02731600
027317               , TRN_TYP_CDE                                      02731700
027318            FROM WFT_LOD_XFER                                     02731800
027319           WHERE PRC_CNTL_TMST  =  :WFT00001-PRC-CNTL-TMST        02731900
027320             AND TRN_TYP_CDE  IN ('PSLPCK','ASNPCK')              02732000
027321           ORDER BY BTCH_LOD_SEQ_ID                               02732100
027322     END-EXEC.                                                    02732200
027323                                                                  02732300
027324                                                                  02732400
027325******************************************************************02732500
027326 LINKAGE SECTION.                                                 02732600
027327******************************************************************02732700
027328 PROCEDURE DIVISION.                                              02732800
027329                                                                  02732900
027330 0000-PROGRAM-MAINLINE.                                           02733000
027340                                                                  02734000
027350*** PLACE AN ENQ/DEQ TO PREVENT CONTENTION                        02735000
027360     EXEC CICS                                                    02736000
027370          ENQ RESOURCE(PC-STAT-HOLD) LENGTH(1)                    02737000
027380     END-EXEC.                                                    02738000
027390                                                                  02739000
027391******************************************************************02739100
027392* BEGIN - 02/11/2019 - RPK                                       *02739200
027393* ADDED LOGIC TO DISPLAY A START MESSAGE EVERY TIME THIS         *02739300
027394* PROGRAM STARTS UP.  WILL DISPLAY PROGRAM NAME, TASK NUMBER     *02739400
027395* AND CURRENT DATE/TIME.                                         *02739500
027397******************************************************************02739700
027398     EXEC SQL                                                     02739800
027399         SET :PV-CURRENT-DATE = CURRENT DATE                      02739900
027400            ,:PV-CURRENT-TIME = CURRENT TIME                      02740000
027401     END-EXEC.                                                    02740100
027402                                                                  02740200
027403     MOVE EIBTASKN               TO PV-TASK.                      02740300
027404     STRING ' XLKCS201 STARTED - TASK = ' PV-TASK-X               02740400
027405            ' DATE: ' PV-CURRENT-DATE                             02740500
027406            ' TIME: ' PV-CURRENT-TIME                             02740600
027407     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                     02740700
027408     MOVE 120 TO PV-WRITE-LENGTH.                                 02740800
027409     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     02740900
027410          LENGTH(PV-WRITE-LENGTH) NOHANDLE                        02741000
027411     END-EXEC.                                                    02741100
027412     MOVE SPACES TO PV-CICS-MSG-AREA.                             02741200
027413******************************************************************02741300
027414* END   - 02/11/2019 - RPK                                       *02741400
027418******************************************************************02741800
027419                                                                  02741900
027420     PERFORM 1000-INITIALIZE.                                     02742000
027500     SET PS-END-OF-CNTL-CSR-N  TO  TRUE.                          02750000
027600     SET PS-END-OF-XFER-CSR-N  TO  TRUE.                          02760000
027700                                                                  02770000
027800     IF PS-NO-ABEND                                               02780000
027900         PERFORM 2500-OPEN-CNTL-CSR                               02790000
028000         PERFORM 2510-FETCH-CNTL-CSR                              02800000
028100         PERFORM 2000-CNTL-PROCESSING                             02810000
028200           UNTIL PS-END-OF-CNTL-CSR-Y OR PS-ABEND                 02820000
028300         PERFORM 2520-CLOSE-CNTL-CSR                              02830000
028400     END-IF.                                                      02840000
028500                                                                  02850000
028600*CLOSE THE TRANS QUEUE.                                           02860000
028700     PERFORM 1400-MQ-QUEUE-CLOSE.                                 02870000
028800                                                                  02880000
028900*DISCONNECT FROM THE QMGR.                                        02890000
029000     PERFORM 1500-DISCONNECT-QMGR.                                02900000
029100                                                                  02910000
029200******************************************************************02920000
029300* BEGIN - 11/15/2018                                             *02930000
029310* DO THIS PROCESS ONLY IF THE PKSLPR PARM IS SET TO 'Y'.         *02931000
029400* PROCESS THE NEW CURSORS FOR THE PACKSLIP CREATE AND ASN PROCESS*02940000
029500* ROWS IN THE WFT_LOD_CNTL & WFT_LOD_XFER DATABASES.             *02950000
029600* THESE MESSAGES WILL BE WRITTEN TO A SEPARATE QUEUE.            *02960000
029700*                                                                *02970000
029800******************************************************************02980000
029900                                                                  02990000
029910     IF  PS-PKSL-PROCESSING-YES                                   02991000
030000         PERFORM 1000B-INITIALIZE                                 03000000
030100         SET PS-END-OF-PKSL-CNTL-CSR-N  TO  TRUE                  03010000
030200         SET PS-END-OF-PKSL-XFER-CSR-N  TO  TRUE                  03020000
030220         IF PS-NO-ABEND                                           03022000
030230             SET PS-END-OF-PKSL-CNTL-CSR-N                        03023000
030240                 PS-END-OF-PKSL-XFER-CSR-N     TO TRUE            03024000
030241             PERFORM 2500B-OPEN-PKSL-CNTL-CSR                     03024100
030242             PERFORM 2510B-FETCH-PKSL-CNTL-CSR                    03024200
030243             PERFORM 2000B-PKSL-CNTL-PROCESSING                   03024300
030244               UNTIL PS-END-OF-PKSL-CNTL-CSR-Y OR PS-ABEND        03024400
030245             PERFORM 2520B-CLOSE-PKSL-CNTL-CSR                    03024500
030246         END-IF                                                   03024600
030248*CLOSE THE TRANS QUEUE.                                           03024800
030249         PERFORM 1400B-MQ-QUEUE-CLOSE                             03024900
030250                                                                  03025000
030251*DISCONNECT FROM THE QMGR.                                        03025100
030252         PERFORM 1500B-DISCONNECT-QMGR                            03025200
030253     END-IF.                                                      03025300
030254                                                                  03025400
030255******************************************************************03025500
030256* END - 11/15/2018                                               *03025600
030257*                                                                *03025700
030258******************************************************************03025800
030259                                                                  03025900
030260*** CREATE DELAYED "START TRANSID".                               03026000
030261     PERFORM 1050-START-DELAYED-TRAN                              03026100
030270                                                                  03027000
030280*** PLACE AN ENQ/DEQ TO PREVENT CONTENTION                        03028000
030290     EXEC CICS                                                    03029000
030300          DEQ RESOURCE(PC-STAT-HOLD) LENGTH(1)                    03030000
030400     END-EXEC.                                                    03040000
030500                                                                  03050000
030600     IF DISPLAY-STATISTICS                                        03060000
030700         PERFORM 9100-DISPLAY-INFO.                               03070000
030800                                                                  03080000
030900     EXEC CICS                                                    03090000
031000         RETURN                                                   03100000
031100     END-EXEC.                                                    03110000
031200                                                                  03120000
031300******************************************************************03130000
031400* INITIALIZATION                                                 *03140000
031500******************************************************************03150000
031600 1000-INITIALIZE.                                                 03160000
031700                                                                  03170000
031800     PERFORM 1150-CHECK-PROGRESS-DISPLAY.                         03180000
031810     PERFORM 1155-CHECK-PKSL-PROCESSING.                          03181000
031900                                                                  03190000
032000     MOVE SPACES  TO  QM-QMGR-NAME                                03200000
032100                      QM-TRANS-QUEUE-NAME                         03210000
032200                      QM-QMGR-NAME-REMOTE.                        03220000
032300                                                                  03230000
032400     PERFORM 1100-FIND-QUEUE-BOX-NAME.                            03240000
032500     PERFORM 1110-FIND-QUEUE-NAME.                                03250000
032600     PERFORM 1120-FIND-QUEUE-MGR.                                 03260000
032700     PERFORM 1130-FIND-DISPLAY-STATISTICS.                        03270000
032800     PERFORM 1140-FIND-MQ-DEBUG-MSG.                              03280000
032900                                                                  03290000
033000* CONNECT TO QUEUE MANAGER                                        03300000
033100     PERFORM 1200-MQ-CONNECT-TO-QMGR.                             03310000
033200                                                                  03320000
033300* OPEN THE QUEUR FOR PUTS                                         03330000
033400     PERFORM 1300-MQ-QUEUE-OPEN.                                  03340000
033500                                                                  03350000
033600* FIND OFFSET TIMESTAMP FOR WFT_LOD_CNTL CURSOR                   03360000
033700     PERFORM 1350-FIND-OFFSET-TMST.                               03370000
033800                                                                  03380000
033900******************************************************************03390000
034000* INITIALIZATION - FOR PROCESSING THE PACKSLIP-ASN CURSOR        *03400000
034100* ADDED - 11/15/2018                                             *03410000
034110******************************************************************03411000
034120 1000B-INITIALIZE.                                                03412000
034130                                                                  03413000
034140     IF  PS-PARA-LOGGING-YES                                      03414000
034141         MOVE SPACES  TO  PV-TRACKING-DATA                        03414100
034142         STRING '1000B-INITIALIZE'        DELIMITED BY SIZE       03414200
034143                                      INTO PV-TRACKING-DATA       03414300
034144         PERFORM 9005-DISPLAY-TRACKING                            03414400
034145     END-IF.                                                      03414500
034146                                                                  03414600
034147     MOVE SPACES  TO  QM-QMGR-NAME                                03414700
034148                      QM-TRANS-QUEUE-NAME                         03414800
034149                      QM-QMGR-NAME-REMOTE.                        03414900
034150                                                                  03415000
034160     PERFORM 1100B-FIND-QUEUE-BOX-NAME.                           03416000
034170     PERFORM 1110B-FIND-QUEUE-NAME.                               03417000
034180     PERFORM 1120B-FIND-QUEUE-MGR.                                03418000
034190                                                                  03419000
034191* CONNECT TO QUEUE MANAGER                                        03419100
034192     PERFORM 1200B-MQ-CONNECT-TO-QMGR.                            03419200
034193                                                                  03419300
034194* OPEN THE QUEUR FOR PUTS                                         03419400
034195     PERFORM 1300B-MQ-QUEUE-OPEN.                                 03419500
034196                                                                  03419600
034197                                                                  03419700
034198******************************************************************03419800
034199*               START NEXT L201 'XX' SECONDS LATER                03419900
034200*=================================================================03420000
034300* DETERMINES WHEN THE NEXT TIME THIS PROCESS IS RUN. 'XX' SECONDS 03430000
034400* IS OBTAINED FROM THE (TKRPRPM) TABLE FOR PARM 'RCTRST'.  IF     03440000
034500* THE SECONDS OBTAINED (PV-RESTART-TIME) IS EQUAL TO 0, THE TRANS 03450000
034600* WILL NOT BE RESTARTED.                                          03460000
034700******************************************************************03470000
034800 1050-START-DELAYED-TRAN.                                         03480000
034900                                                                  03490000
035000     IF  PS-PARA-LOGGING-YES                                      03500000
035010         MOVE SPACES  TO  PV-TRACKING-DATA                        03501000
035020         STRING '1050-START-DELAYED-TRAN' DELIMITED BY SIZE       03502000
035030                                      INTO PV-TRACKING-DATA       03503000
035040         PERFORM 9005-DISPLAY-TRACKING                            03504000
035050     END-IF.                                                      03505000
035060                                                                  03506000
035070     PERFORM                                                      03507000
035080            WITH TEST AFTER                                       03508000
035090         VARYING PV-RETRY-COUNTER                                 03509000
035100            FROM 1 BY 1                                           03510000
035200           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                03520000
035300              OR SQLCODE = ZERO                                   03530000
035400              OR SQLCODE = +100                                   03540000
035500                                                                  03550000
035600         EXEC SQL                                                 03560000
035700              SELECT FUNC_QTY                                     03570000
035800                INTO :KRPRPM-FUNC-QTY                             03580000
035900                FROM TKRPRPM                                      03590000
036000               WHERE LOC_ID             =   90                    03600000
036100                 AND INTFC_SYS_CDE      =  'RMS'                  03610000
036200                 AND FUNC_PRC_STAT_CDE  =  'AC'                   03620000
036300                 AND SYS_PRC_FUNC_CDE   =  'RCTRST'               03630000
036400                 AND (CURRENT DATE                                03640000
036500                     BETWEEN DATE(FUNC_BEG_TMST) AND              03650000
036600                             DATE(FUNC_END_TMST))                 03660000
036700         END-EXEC                                                 03670000
036800                                                                  03680000
036900         EVALUATE TRUE                                            03690000
037000          WHEN SQLCODE = ZERO                                     03700000
037100               MOVE  KRPRPM-FUNC-QTY  TO  PV-RESTART-TIME         03710000
037200                                                                  03720000
037300          WHEN SQLCODE = -904                                     03730000
037400          WHEN SQLCODE = -913                                     03740000
037500          WHEN SQLCODE = -911                                     03750000
037600               CONTINUE                                           03760000
037700                                                                  03770000
037800          WHEN OTHER                                              03780000
037900               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              03790000
038000               STRING '1050-START-DELAYED-TRAN'                   03800000
038100                  ' - SQLCODE: '                                  03810000
038200                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      03820000
038300                                            INTO LE-MSG           03830000
038400                                                                  03840000
038500               PERFORM 9000-DISPLAY-SQL-ERROR                     03850000
038600         END-EVALUATE                                             03860000
038700     END-PERFORM.                                                 03870000
038800                                                                  03880000
038900     IF SQLCODE NOT = ZERO  AND                                   03890000
039000        PV-RETRY-COUNTER > PC-MAX-RETRIES                         03900000
039100               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              03910000
039200               STRING '1050-START-DELAYED-TRAN MAX RETRY'         03920000
039300                  ' - SQLCODE: '                                  03930000
039400                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      03940000
039500                                            INTO LE-MSG           03950000
039600             PERFORM 9000-DISPLAY-SQL-ERROR                       03960000
039700     END-IF.                                                      03970000
039800                                                                  03980000
039900     IF PV-RESTART-TIME > 0                                       03990000
040000         EXEC CICS                                                04000000
040100             START TRANSID(PC-L201-TRANSID)                       04010000
040200                 AFTER SECONDS (PV-RESTART-TIME)                  04020000
040300         END-EXEC.                                                04030000
040400                                                                  04040000
040500     IF  PS-PARA-LOGGING-YES                                      04050000
040600         MOVE SPACES  TO  PV-TRACKING-DATA                        04060000
040700         MOVE PV-RESTART-TIME TO PV-DISP-RESTART-SECONDS          04070000
040800         STRING ' 1050-START-DELAYED-TRAN'                        04080000
040900                ' - RESTART SECONDS:'                             04090000
040910                 PV-DISP-RESTART-SECONDS   DELIMITED BY SIZE      04091000
040920                                      INTO PV-TRACKING-DATA       04092000
040930         PERFORM 9005-DISPLAY-TRACKING                            04093000
040940     END-IF.                                                      04094000
040950                                                                  04095000
040960                                                                  04096000
040970******************************************************************04097000
040980* FIND THE MQ QUEUE NAME FROM THE PARM TABLE (TKRPRPM)           *04098000
040990*          ****    ISMQI01T    ****                              *04099000
041000******************************************************************04100000
041100 1100-FIND-QUEUE-BOX-NAME.                                        04110000
041200                                                                  04120000
041300     IF  PS-PARA-LOGGING-YES                                      04130000
041400         MOVE SPACES  TO  PV-TRACKING-DATA                        04140000
041500         STRING '1100-FIND-QUEUE-BOX-NAME'                        04150000
041510                                           DELIMITED BY SIZE      04151000
041520                                      INTO PV-TRACKING-DATA       04152000
041530         PERFORM 9005-DISPLAY-TRACKING                            04153000
041540     END-IF.                                                      04154000
041550                                                                  04155000
041560     PERFORM                                                      04156000
041570            WITH TEST AFTER                                       04157000
041580         VARYING PV-RETRY-COUNTER                                 04158000
041590            FROM 1 BY 1                                           04159000
041600           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                04160000
041700              OR SQLCODE = ZERO                                   04170000
041800              OR SQLCODE = +100                                   04180000
041900                                                                  04190000
042000         EXEC SQL                                                 04200000
042100              SELECT FUNC_TXT                                     04210000
042200                INTO :KRPRPM-FUNC-TXT                             04220000
042300                FROM TKRPRPM                                      04230000
042400               WHERE LOC_ID             =   90                    04240000
042500                 AND INTFC_SYS_CDE      =  'RMS'                  04250000
042600                 AND FUNC_PRC_STAT_CDE  =  'AC'                   04260000
042700                 AND SYS_PRC_FUNC_CDE   =  'RCTQMG'               04270000
042800                 AND (CURRENT DATE                                04280000
042900                     BETWEEN DATE(FUNC_BEG_TMST) AND              04290000
043000                             DATE(FUNC_END_TMST))                 04300000
043100         END-EXEC                                                 04310000
043200                                                                  04320000
043300         EVALUATE TRUE                                            04330000
043400          WHEN SQLCODE = ZERO                                     04340000
043500               MOVE  KRPRPM-FUNC-TXT  TO  QM-QMGR-NAME-REMOTE     04350000
043600                                                                  04360000
043700          WHEN SQLCODE = -904                                     04370000
043800          WHEN SQLCODE = -913                                     04380000
043900          WHEN SQLCODE = -911                                     04390000
044000               CONTINUE                                           04400000
044100                                                                  04410000
044200          WHEN OTHER                                              04420000
044300               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              04430000
044400               STRING '1100-FIND-QUEUE-BOX-N'                     04440000
044500                  ' - SQLCODE: '                                  04450000
044600                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      04460000
044700                                            INTO LE-MSG           04470000
044800               PERFORM 9000-DISPLAY-SQL-ERROR                     04480000
044900         END-EVALUATE                                             04490000
045000     END-PERFORM.                                                 04500000
045100                                                                  04510000
045200                                                                  04520000
045300     IF  PS-PARA-LOGGING-YES                                      04530000
045400         MOVE SPACES  TO  PV-TRACKING-DATA                        04540000
045500         STRING '1100-FIND-QUEUE-BOX-NAME'                        04550000
045600                ' - QM-QMGR-NAME-REMOTE:'  QM-QMGR-NAME-REMOTE    04560000
045700                                           DELIMITED BY SIZE      04570000
045800                                      INTO PV-TRACKING-DATA       04580000
045810         PERFORM 9005-DISPLAY-TRACKING                            04581000
045820     END-IF.                                                      04582000
045830                                                                  04583000
045840     IF SQLCODE NOT = ZERO  AND                                   04584000
045850        PV-RETRY-COUNTER > PC-MAX-RETRIES                         04585000
045860               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              04586000
045870               STRING '1100-FIND-QUEUE-BOX-N MAX RETRY'           04587000
045880                  ' - SQLCODE: '                                  04588000
045890                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      04589000
045900                                            INTO LE-MSG           04590000
046000               PERFORM 9000-DISPLAY-SQL-ERROR                     04600000
046100     END-IF.                                                      04610000
046200                                                                  04620000
046300******************************************************************04630000
046400* FIND THE MQ QUEUE NAME FROM THE PARM TABLE (TKRPRPM)           *04640000
046500* ADDED - 11/15/2018                                             *04650000
046600******************************************************************04660000
046700 1100B-FIND-QUEUE-BOX-NAME.                                       04670000
046800                                                                  04680000
046900     IF  PS-PARA-LOGGING-YES                                      04690000
047000         MOVE SPACES  TO  PV-TRACKING-DATA                        04700000
047010         PERFORM 9005-DISPLAY-TRACKING                            04701000
047020                                                                  04702000
047030         MOVE SPACES  TO  PV-TRACKING-DATA                        04703000
047040         STRING '1100B-FIND-QUEUE-BOX-NAME'                       04704000
047050                                           DELIMITED BY SIZE      04705000
047060                                      INTO PV-TRACKING-DATA       04706000
047061         PERFORM 9005-DISPLAY-TRACKING                            04706100
047062     END-IF.                                                      04706200
047063                                                                  04706300
047064     PERFORM                                                      04706400
047065            WITH TEST AFTER                                       04706500
047066         VARYING PV-RETRY-COUNTER                                 04706600
047067            FROM 1 BY 1                                           04706700
047068           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                04706800
047069              OR SQLCODE = ZERO                                   04706900
047070              OR SQLCODE = +100                                   04707000
047080                                                                  04708000
047090         EXEC SQL                                                 04709000
047091              SELECT FUNC_TXT                                     04709100
047092                INTO :KRPRPM-FUNC-TXT                             04709200
047093                FROM TKRPRPM                                      04709300
047094               WHERE LOC_ID             =   90                    04709400
047095                 AND INTFC_SYS_CDE      =  'RMS'                  04709500
047096                 AND FUNC_PRC_STAT_CDE  =  'AC'                   04709600
047097                 AND SYS_PRC_FUNC_CDE   =  'PCKQMG'               04709700
047098                 AND (CURRENT DATE                                04709800
047099                     BETWEEN DATE(FUNC_BEG_TMST) AND              04709900
047100                             DATE(FUNC_END_TMST))                 04710000
047101         END-EXEC                                                 04710100
047102                                                                  04710200
047103         EVALUATE TRUE                                            04710300
047104          WHEN SQLCODE = ZERO                                     04710400
047105               MOVE  KRPRPM-FUNC-TXT  TO  QM-QMGR-NAME-REMOTE     04710500
047106                                                                  04710600
047107          WHEN SQLCODE = -904                                     04710700
047108          WHEN SQLCODE = -913                                     04710800
047109          WHEN SQLCODE = -911                                     04710900
047110               CONTINUE                                           04711000
047111                                                                  04711100
047112          WHEN OTHER                                              04711200
047113               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              04711300
047114               STRING '1100B-FIND-QUEUE-BOX-N'                    04711400
047115                  ' - SQLCODE: '                                  04711500
047116                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      04711600
047117                                            INTO LE-MSG           04711700
047118               PERFORM 9000-DISPLAY-SQL-ERROR                     04711800
047119         END-EVALUATE                                             04711900
047120     END-PERFORM.                                                 04712000
047130                                                                  04713000
047131     IF  PS-PARA-LOGGING-YES                                      04713100
047132         MOVE SPACES  TO  PV-TRACKING-DATA                        04713200
047133         STRING '1100B-FIND-QUEUE-BOX-NAME'                       04713300
047134                ' - QM-QMGR-NAME-REMOTE:'  QM-QMGR-NAME-REMOTE    04713400
047135                                           DELIMITED BY SIZE      04713500
047136                                      INTO PV-TRACKING-DATA       04713600
047137         PERFORM 9005-DISPLAY-TRACKING                            04713700
047138     END-IF.                                                      04713800
047139                                                                  04713900
047140     IF SQLCODE NOT = ZERO  AND                                   04714000
047141        PV-RETRY-COUNTER > PC-MAX-RETRIES                         04714100
047142               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              04714200
047143               STRING '1100B-FIND-QUEUE-BOX-N MAX RETRY'          04714300
047144                  ' - SQLCODE: '                                  04714400
047145                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      04714500
047146                                            INTO LE-MSG           04714600
047147               PERFORM 9000-DISPLAY-SQL-ERROR                     04714700
047148     END-IF.                                                      04714800
047149                                                                  04714900
047150******************************************************************04715000
047160* FIND THE MQ QUEUE BOX NAME FROM THE PARM TABLE (TKRPRPM)       *04716000
047170*   ****     PO.PURCHASE.ORDER.RECEIPT.TEST.QR   ****            *04717000
047180******************************************************************04718000
047190 1110-FIND-QUEUE-NAME.                                            04719000
047200                                                                  04720000
047300     IF  PS-PARA-LOGGING-YES                                      04730000
047400         MOVE SPACES  TO  PV-TRACKING-DATA                        04740000
047500         STRING '1110-FIND-QUEUE-NAME'    DELIMITED BY SIZE       04750000
047600                                      INTO PV-TRACKING-DATA       04760000
047610         PERFORM 9005-DISPLAY-TRACKING                            04761000
047620     END-IF.                                                      04762000
047630                                                                  04763000
047640     PERFORM                                                      04764000
047650            WITH TEST AFTER                                       04765000
047660         VARYING PV-RETRY-COUNTER                                 04766000
047670            FROM 1 BY 1                                           04767000
047680           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                04768000
047690              OR SQLCODE = ZERO                                   04769000
047700              OR SQLCODE = +100                                   04770000
047800                                                                  04780000
047900         EXEC SQL                                                 04790000
048000              SELECT FUNC_TXT                                     04800000
048100                INTO :KRPRPM-FUNC-TXT                             04810000
048200                FROM TKRPRPM                                      04820000
048300               WHERE LOC_ID             =   90                    04830000
048400                 AND INTFC_SYS_CDE      =  'RMS'                  04840000
048500                 AND FUNC_PRC_STAT_CDE  =  'AC'                   04850000
048600                 AND SYS_PRC_FUNC_CDE   =  'RCTP1Q'               04860000
048700                 AND (CURRENT DATE                                04870000
048800                     BETWEEN DATE(FUNC_BEG_TMST) AND              04880000
048900                             DATE(FUNC_END_TMST))                 04890000
049000         END-EXEC                                                 04900000
049100                                                                  04910000
049200         EVALUATE TRUE                                            04920000
049300          WHEN SQLCODE = ZERO                                     04930000
049400               MOVE  KRPRPM-FUNC-TXT  TO  QM-TRANS-QUEUE-WORK1    04940000
049500                                                                  04950000
049600          WHEN SQLCODE = -904                                     04960000
049700          WHEN SQLCODE = -913                                     04970000
049800          WHEN SQLCODE = -911                                     04980000
049900               CONTINUE                                           04990000
050000                                                                  05000000
050100          WHEN OTHER                                              05010000
050200               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05020000
050300               STRING '1110-FIND-QUEUE-NAME P1'                   05030000
050400                  ' - SQLCODE: '                                  05040000
050500                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05050000
050600                                            INTO LE-MSG           05060000
050700               PERFORM 9000-DISPLAY-SQL-ERROR                     05070000
050800         END-EVALUATE                                             05080000
050900     END-PERFORM.                                                 05090000
051000                                                                  05100000
051100     IF  PS-PARA-LOGGING-YES                                      05110000
051200         MOVE SPACES  TO  PV-TRACKING-DATA                        05120000
051300         STRING '1110-FIND-QUEUE-NAME'                            05130000
051400                ' - QM-TRANS-QUEUE-WORK1:'                        05140000
051500                 QM-TRANS-QUEUE-WORK1      DELIMITED BY SIZE      05150000
051600                                      INTO PV-TRACKING-DATA       05160000
051700         PERFORM 9005-DISPLAY-TRACKING                            05170000
051800     END-IF.                                                      05180000
051810                                                                  05181000
051820     IF SQLCODE NOT = ZERO  AND                                   05182000
051830        PV-RETRY-COUNTER > PC-MAX-RETRIES                         05183000
051840               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05184000
051850               STRING '1110-FIND-QUEUE-NAME P1 MAX RETRY'         05185000
051860                  ' - SQLCODE: '                                  05186000
051870                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05187000
051880                                            INTO LE-MSG           05188000
051890               PERFORM 9000-DISPLAY-SQL-ERROR                     05189000
051900     END-IF.                                                      05190000
052000                                                                  05200000
052100     PERFORM                                                      05210000
052200            WITH TEST AFTER                                       05220000
052300         VARYING PV-RETRY-COUNTER                                 05230000
052400            FROM 1 BY 1                                           05240000
052500           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                05250000
052600              OR SQLCODE = ZERO                                   05260000
052700              OR SQLCODE = +100                                   05270000
052800                                                                  05280000
052900         EXEC SQL                                                 05290000
053000              SELECT FUNC_TXT                                     05300000
053100                INTO :KRPRPM-FUNC-TXT                             05310000
053200                FROM TKRPRPM                                      05320000
053300               WHERE LOC_ID             =   90                    05330000
053400                 AND INTFC_SYS_CDE      =  'RMS'                  05340000
053500                 AND FUNC_PRC_STAT_CDE  =  'AC'                   05350000
053600                 AND SYS_PRC_FUNC_CDE   =  'RCTP2Q'               05360000
053700                 AND (CURRENT DATE                                05370000
053800                     BETWEEN DATE(FUNC_BEG_TMST) AND              05380000
053900                             DATE(FUNC_END_TMST))                 05390000
054000         END-EXEC                                                 05400000
054100                                                                  05410000
054200         EVALUATE TRUE                                            05420000
054300          WHEN SQLCODE = ZERO                                     05430000
054400               MOVE  KRPRPM-FUNC-TXT  TO  QM-TRANS-QUEUE-WORK2    05440000
054500                                                                  05450000
054600          WHEN SQLCODE = -904                                     05460000
054700          WHEN SQLCODE = -913                                     05470000
054800          WHEN SQLCODE = -911                                     05480000
054900               CONTINUE                                           05490000
055000                                                                  05500000
055100          WHEN OTHER                                              05510000
055200               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05520000
055300               STRING '1110-FIND-QUEUE-NAME P2'                   05530000
055400                  ' - SQLCODE: '                                  05540000
055500                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05550000
055600                                            INTO LE-MSG           05560000
055700               PERFORM 9000-DISPLAY-SQL-ERROR                     05570000
055800         END-EVALUATE                                             05580000
055900     END-PERFORM.                                                 05590000
056000                                                                  05600000
056100     IF  PS-PARA-LOGGING-YES                                      05610000
056200         MOVE SPACES  TO  PV-TRACKING-DATA                        05620000
056300         STRING '1110-FIND-QUEUE-NAME'                            05630000
056400                ' - QM-TRANS-QUEUE-WORK2:'                        05640000
056500                 QM-TRANS-QUEUE-WORK2      DELIMITED BY SIZE      05650000
056600                                      INTO PV-TRACKING-DATA       05660000
056700         PERFORM 9005-DISPLAY-TRACKING                            05670000
056800     END-IF.                                                      05680000
056900                                                                  05690000
057000     IF SQLCODE NOT = ZERO  AND                                   05700000
057100        PV-RETRY-COUNTER > PC-MAX-RETRIES                         05710000
057200               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05720000
057300               STRING '1110-FIND-QUEUE-NAME P2 MAX RETRY'         05730000
057400                  ' - SQLCODE: '                                  05740000
057500                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05750000
057600                                            INTO LE-MSG           05760000
057700               PERFORM 9000-DISPLAY-SQL-ERROR                     05770000
057800     END-IF.                                                      05780000
057900                                                                  05790000
058000     MOVE  QM-TRANS-QUEUE-WORK  TO  QM-TRANS-QUEUE-NAME.          05800000
058100                                                                  05810000
058200     IF  PS-PARA-LOGGING-YES                                      05820000
058300         MOVE SPACES  TO  PV-TRACKING-DATA                        05830000
058400         STRING '1110-FIND-QUEUE-NAME'                            05840000
058500                ' - QM-TRANS-QUEUE-NAME:'                         05850000
058510                 QM-TRANS-QUEUE-NAME       DELIMITED BY SIZE      05851000
058520                                      INTO PV-TRACKING-DATA       05852000
058530         PERFORM 9005-DISPLAY-TRACKING                            05853000
058540     END-IF.                                                      05854000
058550                                                                  05855000
058560                                                                  05856000
058570******************************************************************05857000
058580* FIND THE MQ QUEUE BOX NAME FROM THE PARM TABLE (TKRPRPM)       *05858000
058590* ADDED - 11/15/2018                                             *05859000
058600******************************************************************05860000
058700 1110B-FIND-QUEUE-NAME.                                           05870000
058710                                                                  05871000
058720     IF  PS-PARA-LOGGING-YES                                      05872000
058730         MOVE SPACES  TO  PV-TRACKING-DATA                        05873000
058740         STRING '1110B-FIND-QUEUE-NAME'   DELIMITED BY SIZE       05874000
058750                                      INTO PV-TRACKING-DATA       05875000
058751         PERFORM 9005-DISPLAY-TRACKING                            05875100
058752     END-IF.                                                      05875200
058753                                                                  05875300
058754     PERFORM                                                      05875400
058755            WITH TEST AFTER                                       05875500
058756         VARYING PV-RETRY-COUNTER                                 05875600
058757            FROM 1 BY 1                                           05875700
058758           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                05875800
058759              OR SQLCODE = ZERO                                   05875900
058760              OR SQLCODE = +100                                   05876000
058770                                                                  05877000
058780         EXEC SQL                                                 05878000
058790              SELECT FUNC_TXT                                     05879000
058791                INTO :KRPRPM-FUNC-TXT                             05879100
058792                FROM TKRPRPM                                      05879200
058793               WHERE LOC_ID             =   90                    05879300
058794                 AND INTFC_SYS_CDE      =  'RMS'                  05879400
058795                 AND FUNC_PRC_STAT_CDE  =  'AC'                   05879500
058796                 AND SYS_PRC_FUNC_CDE   =  'PCKP1Q'               05879600
058797                 AND (CURRENT DATE                                05879700
058798                     BETWEEN DATE(FUNC_BEG_TMST) AND              05879800
058799                             DATE(FUNC_END_TMST))                 05879900
058800         END-EXEC                                                 05880000
058801                                                                  05880100
058802         EVALUATE TRUE                                            05880200
058803          WHEN SQLCODE = ZERO                                     05880300
058804               MOVE KRPRPM-FUNC-TXT TO QM-PKSL-TRANS-QUEUE-WORK1  05880400
058805                                                                  05880500
058806          WHEN SQLCODE = -904                                     05880600
058807          WHEN SQLCODE = -913                                     05880700
058808          WHEN SQLCODE = -911                                     05880800
058809               CONTINUE                                           05880900
058810                                                                  05881000
058811          WHEN OTHER                                              05881100
058812               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05881200
058813               STRING '1110B-FIND-QUEUE-NAME P1'                  05881300
058814                  ' - SQLCODE: '                                  05881400
058815                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05881500
058816                                            INTO LE-MSG           05881600
058817               PERFORM 9000-DISPLAY-SQL-ERROR                     05881700
058818         END-EVALUATE                                             05881800
058819     END-PERFORM.                                                 05881900
058820                                                                  05882000
058830     IF  PS-PARA-LOGGING-YES                                      05883000
058831         MOVE SPACES  TO  PV-TRACKING-DATA                        05883100
058832         STRING '1110B-FIND-QUEUE-NAME'                           05883200
058833                ' - QM-PKSL-TRANS-QUEUE-WORK1: '                  05883300
058834                 QM-PKSL-TRANS-QUEUE-WORK1 DELIMITED BY SIZE      05883400
058835                                      INTO PV-TRACKING-DATA       05883500
058836         PERFORM 9005-DISPLAY-TRACKING                            05883600
058837     END-IF.                                                      05883700
058838                                                                  05883800
058839     IF SQLCODE NOT = ZERO  AND                                   05883900
058840        PV-RETRY-COUNTER > PC-MAX-RETRIES                         05884000
058841               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05884100
058842               STRING '1110B-FIND-QUEUE-NAME P1 MAX RETRY'        05884200
058843                  ' - SQLCODE: '                                  05884300
058844                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05884400
058845                                            INTO LE-MSG           05884500
058846               PERFORM 9000-DISPLAY-SQL-ERROR                     05884600
058847     END-IF.                                                      05884700
058848                                                                  05884800
058849     PERFORM                                                      05884900
058850            WITH TEST AFTER                                       05885000
058860         VARYING PV-RETRY-COUNTER                                 05886000
058861            FROM 1 BY 1                                           05886100
058862           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                05886200
058863              OR SQLCODE = ZERO                                   05886300
058864              OR SQLCODE = +100                                   05886400
058865                                                                  05886500
058866         EXEC SQL                                                 05886600
058867              SELECT FUNC_TXT                                     05886700
058868                INTO :KRPRPM-FUNC-TXT                             05886800
058869                FROM TKRPRPM                                      05886900
058870               WHERE LOC_ID             =   90                    05887000
058871                 AND INTFC_SYS_CDE      =  'RMS'                  05887100
058872                 AND FUNC_PRC_STAT_CDE  =  'AC'                   05887200
058873                 AND SYS_PRC_FUNC_CDE   =  'PCKP2Q'               05887300
058874                 AND (CURRENT DATE                                05887400
058875                     BETWEEN DATE(FUNC_BEG_TMST) AND              05887500
058876                             DATE(FUNC_END_TMST))                 05887600
058877         END-EXEC                                                 05887700
058878                                                                  05887800
058879         EVALUATE TRUE                                            05887900
058880          WHEN SQLCODE = ZERO                                     05888000
058881               MOVE KRPRPM-FUNC-TXT TO QM-PKSL-TRANS-QUEUE-WORK2  05888100
058882                                                                  05888200
058883          WHEN SQLCODE = -904                                     05888300
058884          WHEN SQLCODE = -913                                     05888400
058885          WHEN SQLCODE = -911                                     05888500
058886               CONTINUE                                           05888600
058887                                                                  05888700
058888          WHEN OTHER                                              05888800
058889               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05888900
058890               STRING '1110B-FIND-QUEUE-NAME P2'                  05889000
058891                  ' - SQLCODE: '                                  05889100
058892                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05889200
058893                                            INTO LE-MSG           05889300
058894               PERFORM 9000-DISPLAY-SQL-ERROR                     05889400
058895         END-EVALUATE                                             05889500
058896     END-PERFORM.                                                 05889600
058897                                                                  05889700
058898     IF  PS-PARA-LOGGING-YES                                      05889800
058899         MOVE SPACES  TO  PV-TRACKING-DATA                        05889900
058900         STRING '1110B-FIND-QUEUE-NAME'                           05890000
058910                ' - QM-PKSL-TRANS-QUEUE-WORK2: '                  05891000
058911                 QM-PKSL-TRANS-QUEUE-WORK2 DELIMITED BY SIZE      05891100
058912                                      INTO PV-TRACKING-DATA       05891200
058913         PERFORM 9005-DISPLAY-TRACKING                            05891300
058914     END-IF.                                                      05891400
058915                                                                  05891500
058916     IF SQLCODE NOT = ZERO  AND                                   05891600
058917        PV-RETRY-COUNTER > PC-MAX-RETRIES                         05891700
058918               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              05891800
058919               STRING '1110B-FIND-QUEUE-NAME P2 MAX RETRY'        05891900
058920                  ' - SQLCODE: '                                  05892000
058921                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      05892100
058922                                            INTO LE-MSG           05892200
058923               PERFORM 9000-DISPLAY-SQL-ERROR                     05892300
058924     END-IF.                                                      05892400
058925                                                                  05892500
058926     MOVE QM-PKSL-TRANS-QUEUE-WORK  TO  QM-TRANS-QUEUE-NAME.      05892600
058927                                                                  05892700
058928     IF  PS-PARA-LOGGING-YES                                      05892800
058929         MOVE SPACES  TO  PV-TRACKING-DATA                        05892900
058930         STRING '1110B-FIND-QUEUE-NAME'                           05893000
058940                ' - QM-TRANS-QUEUE-WORK:'                         05894000
058941                 QM-TRANS-QUEUE-NAME       DELIMITED BY SIZE      05894100
058942                                      INTO PV-TRACKING-DATA       05894200
058943         PERFORM 9005-DISPLAY-TRACKING                            05894300
058944     END-IF.                                                      05894400
058945                                                                  05894500
058946                                                                  05894600
058947******************************************************************05894700
058948* FIND THE MQ QUEUE MANAGER FROM THE PARM TABLE (TKRPRPM)        *05894800
058949*         ***   QKST   ***   QKSQ   ***   QKSP   ***             *05894900
058950******************************************************************05895000
058960 1120-FIND-QUEUE-MGR.                                             05896000
058970                                                                  05897000
058980     IF  PS-PARA-LOGGING-YES                                      05898000
058990         MOVE SPACES  TO  PV-TRACKING-DATA                        05899000
059000         STRING '1120-FIND-QUEUE-MGR'     DELIMITED BY SIZE       05900000
059100                                      INTO PV-TRACKING-DATA       05910000
059200         PERFORM 9005-DISPLAY-TRACKING                            05920000
059210     END-IF.                                                      05921000
059220                                                                  05922000
059230     PERFORM                                                      05923000
059240            WITH TEST AFTER                                       05924000
059250         VARYING PV-RETRY-COUNTER                                 05925000
059260            FROM 1 BY 1                                           05926000
059270           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                05927000
059280              OR SQLCODE = ZERO                                   05928000
059290              OR SQLCODE = +100                                   05929000
059300                                                                  05930000
059400         EXEC SQL                                                 05940000
059500              SELECT FUNC_TXT                                     05950000
059600                INTO :KRPRPM-FUNC-TXT                             05960000
059700                FROM TKRPRPM                                      05970000
059800               WHERE LOC_ID             =   90                    05980000
059900                 AND INTFC_SYS_CDE      =  'RMS'                  05990000
060000                 AND FUNC_PRC_STAT_CDE  =  'AC'                   06000000
060100                 AND SYS_PRC_FUNC_CDE   =  'RCTQUE'               06010000
060200                 AND (CURRENT DATE                                06020000
060300                     BETWEEN DATE(FUNC_BEG_TMST) AND              06030000
060400                             DATE(FUNC_END_TMST))                 06040000
060500         END-EXEC                                                 06050000
060600                                                                  06060000
060700         EVALUATE TRUE                                            06070000
060800          WHEN SQLCODE = ZERO                                     06080000
060900               MOVE  KRPRPM-FUNC-TXT  TO  QM-QMGR-NAME            06090000
061000                                                                  06100000
061100          WHEN SQLCODE = -904                                     06110000
061200          WHEN SQLCODE = -913                                     06120000
061300          WHEN SQLCODE = -911                                     06130000
061400               CONTINUE                                           06140000
061500                                                                  06150000
061600          WHEN OTHER                                              06160000
061700               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              06170000
061800               STRING '1120-FIND-QUEUE-MGR'                       06180000
061900                  ' - SQLCODE: '                                  06190000
062000                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      06200000
062100                                            INTO LE-MSG           06210000
062200               PERFORM 9000-DISPLAY-SQL-ERROR                     06220000
062300         END-EVALUATE                                             06230000
062400     END-PERFORM.                                                 06240000
062500                                                                  06250000
062600     IF  PS-PARA-LOGGING-YES                                      06260000
062700         MOVE SPACES  TO  PV-TRACKING-DATA                        06270000
062800         STRING '1120-FIND-QUEUE-MGR  '                           06280000
062900                ' - QM-QMGR-NAME:'                                06290000
063000                 QM-QMGR-NAME              DELIMITED BY SIZE      06300000
063100                                      INTO PV-TRACKING-DATA       06310000
063200         PERFORM 9005-DISPLAY-TRACKING                            06320000
063300     END-IF.                                                      06330000
063400                                                                  06340000
063500     IF SQLCODE NOT = ZERO  AND                                   06350000
063600        PV-RETRY-COUNTER > PC-MAX-RETRIES                         06360000
063700               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              06370000
063800               STRING '1120-FIND-QUEUE-MGR MAX RETRY'             06380000
063900                  ' - SQLCODE: '                                  06390000
064000                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      06400000
064100                                            INTO LE-MSG           06410000
064200               PERFORM 9000-DISPLAY-SQL-ERROR                     06420000
064300     END-IF.                                                      06430000
064400                                                                  06440000
064500******************************************************************06450000
064600* FIND THE MQ QUEUE MANAGER FROM THE PARM TABLE (TKRPRPM)        *06460000
064700*         ***   QKST   ***   QKSQ   ***   QKSP   ***             *06470000
064710* ADDED - 11/15/2018                                             *06471000
064720******************************************************************06472000
064730 1120B-FIND-QUEUE-MGR.                                            06473000
064740                                                                  06474000
064750     IF  PS-PARA-LOGGING-YES                                      06475000
064751         MOVE SPACES  TO  PV-TRACKING-DATA                        06475100
064752         STRING '1120B-FIND-QUEUE-MGR'    DELIMITED BY SIZE       06475200
064753                                      INTO PV-TRACKING-DATA       06475300
064754         PERFORM 9005-DISPLAY-TRACKING                            06475400
064755     END-IF.                                                      06475500
064756                                                                  06475600
064757     PERFORM                                                      06475700
064758            WITH TEST AFTER                                       06475800
064759         VARYING PV-RETRY-COUNTER                                 06475900
064760            FROM 1 BY 1                                           06476000
064770           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                06477000
064780              OR SQLCODE = ZERO                                   06478000
064790              OR SQLCODE = +100                                   06479000
064791                                                                  06479100
064792         EXEC SQL                                                 06479200
064793              SELECT FUNC_TXT                                     06479300
064794                INTO :KRPRPM-FUNC-TXT                             06479400
064795                FROM TKRPRPM                                      06479500
064796               WHERE LOC_ID             =   90                    06479600
064797                 AND INTFC_SYS_CDE      =  'RMS'                  06479700
064798                 AND FUNC_PRC_STAT_CDE  =  'AC'                   06479800
064799                 AND SYS_PRC_FUNC_CDE   =  'PCKQUE'               06479900
064800                 AND (CURRENT DATE                                06480000
064801                     BETWEEN DATE(FUNC_BEG_TMST) AND              06480100
064802                             DATE(FUNC_END_TMST))                 06480200
064803         END-EXEC                                                 06480300
064804                                                                  06480400
064805         EVALUATE TRUE                                            06480500
064806          WHEN SQLCODE = ZERO                                     06480600
064807               MOVE  KRPRPM-FUNC-TXT  TO  QM-QMGR-NAME            06480700
064808                                                                  06480800
064809          WHEN SQLCODE = -904                                     06480900
064810          WHEN SQLCODE = -913                                     06481000
064811          WHEN SQLCODE = -911                                     06481100
064812               CONTINUE                                           06481200
064813                                                                  06481300
064814          WHEN OTHER                                              06481400
064815               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              06481500
064816               STRING '1120B-FIND-QUEUE-MGR'                      06481600
064817                  ' - SQLCODE: '                                  06481700
064818                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      06481800
064819                                            INTO LE-MSG           06481900
064820               PERFORM 9000-DISPLAY-SQL-ERROR                     06482000
064830         END-EVALUATE                                             06483000
064831     END-PERFORM.                                                 06483100
064832                                                                  06483200
064833     IF  PS-PARA-LOGGING-YES                                      06483300
064834         MOVE SPACES  TO  PV-TRACKING-DATA                        06483400
064835         STRING '1120B-FIND-QUEUE-MGR'                            06483500
064836                ' - QM-QMGR-NAME:'                                06483600
064837                 QM-QMGR-NAME              DELIMITED BY SIZE      06483700
064838                                      INTO PV-TRACKING-DATA       06483800
064839         PERFORM 9005-DISPLAY-TRACKING                            06483900
064840     END-IF.                                                      06484000
064841                                                                  06484100
064842     IF SQLCODE NOT = ZERO  AND                                   06484200
064843        PV-RETRY-COUNTER > PC-MAX-RETRIES                         06484300
064844               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              06484400
064845               STRING '1120B-FIND-QUEUE-MGR MAX RETRY'            06484500
064846                  ' - SQLCODE: '                                  06484600
064847                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      06484700
064848                                            INTO LE-MSG           06484800
064849               PERFORM 9000-DISPLAY-SQL-ERROR                     06484900
064850     END-IF.                                                      06485000
064860                                                                  06486000
064870******************************************************************06487000
064880* FIND THE DISPLAY STATISTICS PARM FROM   TABLE (TKRPRPM)        *06488000
064890******************************************************************06489000
064900 1130-FIND-DISPLAY-STATISTICS.                                    06490000
065000                                                                  06500000
065100     IF  PS-PARA-LOGGING-YES                                      06510000
065110         MOVE SPACES  TO  PV-TRACKING-DATA                        06511000
065120         STRING '1130-FIND-DISPLAY-STATISTICS'                    06512000
065130                                           DELIMITED BY SIZE      06513000
065140                                      INTO PV-TRACKING-DATA       06514000
065150         PERFORM 9005-DISPLAY-TRACKING                            06515000
065160     END-IF.                                                      06516000
065170                                                                  06517000
065180     PERFORM                                                      06518000
065190            WITH TEST AFTER                                       06519000
065200         VARYING PV-RETRY-COUNTER                                 06520000
065300            FROM 1 BY 1                                           06530000
065400           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                06540000
065500              OR SQLCODE = ZERO                                   06550000
065600              OR SQLCODE = +100                                   06560000
065700                                                                  06570000
065800         EXEC SQL                                                 06580000
065900              SELECT FUNC_TXT                                     06590000
066000                INTO :KRPRPM-FUNC-TXT                             06600000
066100                FROM TKRPRPM                                      06610000
066200               WHERE LOC_ID             =   90                    06620000
066300                 AND INTFC_SYS_CDE      =  'RMS'                  06630000
066400                 AND FUNC_PRC_STAT_CDE  =  'AC'                   06640000
066500                 AND FUNC_TXT           =  'Y'                    06650000
066600                 AND SYS_PRC_FUNC_CDE   =  'RCTDST'               06660000
066700                 AND (CURRENT DATE                                06670000
066800                     BETWEEN DATE(FUNC_BEG_TMST) AND              06680000
066900                             DATE(FUNC_END_TMST))                 06690000
067000         END-EXEC                                                 06700000
067100                                                                  06710000
067200         EVALUATE TRUE                                            06720000
067300          WHEN SQLCODE = ZERO                                     06730000
067400               SET DISPLAY-STATISTICS TO TRUE                     06740000
067500                                                                  06750000
067600          WHEN SQLCODE = +100                                     06760000
067700          WHEN SQLCODE = -904                                     06770000
067800          WHEN SQLCODE = -913                                     06780000
067900          WHEN SQLCODE = -911                                     06790000
068000               CONTINUE                                           06800000
068100                                                                  06810000
068200          WHEN OTHER                                              06820000
068300               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              06830000
068400               STRING '1130-FIND-DISPLAY-STATISTICS'              06840000
068500                  ' - SQLCODE: '                                  06850000
068600                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      06860000
068700                                            INTO LE-MSG           06870000
068800               PERFORM 9000-DISPLAY-SQL-ERROR                     06880000
068900         END-EVALUATE                                             06890000
069000     END-PERFORM.                                                 06900000
069100                                                                  06910000
069200     IF  PS-PARA-LOGGING-YES                                      06920000
069300         MOVE SPACES  TO  PV-TRACKING-DATA                        06930000
069400         STRING '1130-FIND-DISPLAY-STATISTICS'                    06940000
069500                ' - PS-DISPLAY-STATITICS:'                        06950000
069600                  PS-DISPLAY-STATITICS                            06960000
069610                                           DELIMITED BY SIZE      06961000
069620                                      INTO PV-TRACKING-DATA       06962000
069630         PERFORM 9005-DISPLAY-TRACKING                            06963000
069640     END-IF.                                                      06964000
069650                                                                  06965000
069660     IF SQLCODE NOT = ZERO  AND                                   06966000
069670        PV-RETRY-COUNTER > PC-MAX-RETRIES                         06967000
069680               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              06968000
069690               STRING '1130-FIND-DISPLAY-STATISTICS MAX RETRY'    06969000
069700                  ' - SQLCODE: '                                  06970000
069800                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      06980000
069900                                            INTO LE-MSG           06990000
070000               PERFORM 9000-DISPLAY-SQL-ERROR                     07000000
070100     END-IF.                                                      07010000
070200                                                                  07020000
070300******************************************************************07030000
070400* FIND THE DISPLAY MQ DEGUG MSG PARM FROM TABLE (TKRPRPM)        *07040000
070500******************************************************************07050000
070600 1140-FIND-MQ-DEBUG-MSG.                                          07060000
070700                                                                  07070000
070800     IF  PS-PARA-LOGGING-YES                                      07080000
070900         MOVE SPACES  TO  PV-TRACKING-DATA                        07090000
071000         STRING '1140-FIND-MQ-DEBUG-MSG'  DELIMITED BY SIZE       07100000
071100                                      INTO PV-TRACKING-DATA       07110000
071200         PERFORM 9005-DISPLAY-TRACKING                            07120000
071210     END-IF.                                                      07121000
071220                                                                  07122000
071230     PERFORM                                                      07123000
071240            WITH TEST AFTER                                       07124000
071250         VARYING PV-RETRY-COUNTER                                 07125000
071260            FROM 1 BY 1                                           07126000
071270           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                07127000
071280              OR SQLCODE = ZERO                                   07128000
071290              OR SQLCODE = +100                                   07129000
071300                                                                  07130000
071400         EXEC SQL                                                 07140000
071500              SELECT FUNC_TXT                                     07150000
071600                INTO :KRPRPM-FUNC-TXT                             07160000
071700                FROM TKRPRPM                                      07170000
071800               WHERE LOC_ID             =   90                    07180000
071900                 AND INTFC_SYS_CDE      =  'RMS'                  07190000
072000                 AND FUNC_PRC_STAT_CDE  =  'AC'                   07200000
072100                 AND FUNC_TXT           =  'Y'                    07210000
072200                 AND SYS_PRC_FUNC_CDE   =  'RCTDMQ'               07220000
072300                 AND (CURRENT DATE                                07230000
072400                     BETWEEN DATE(FUNC_BEG_TMST) AND              07240000
072500                             DATE(FUNC_END_TMST))                 07250000
072600         END-EXEC                                                 07260000
072700                                                                  07270000
072800         EVALUATE TRUE                                            07280000
072900          WHEN SQLCODE = ZERO                                     07290000
073000               SET DISPLAY-MQ-DEBUG-MSG TO TRUE                   07300000
073100                                                                  07310000
073200          WHEN SQLCODE = +100                                     07320000
073300          WHEN SQLCODE = -904                                     07330000
073400          WHEN SQLCODE = -913                                     07340000
073500          WHEN SQLCODE = -911                                     07350000
073600               CONTINUE                                           07360000
073700                                                                  07370000
073800          WHEN OTHER                                              07380000
073900               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              07390000
074000               STRING '1140-FIND-DISPLAY-MQ-DEBUG-MSG'            07400000
074100                  ' - SQLCODE: '                                  07410000
074200                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      07420000
074300                                            INTO LE-MSG           07430000
074400               PERFORM 9000-DISPLAY-SQL-ERROR                     07440000
074500         END-EVALUATE                                             07450000
074600     END-PERFORM.                                                 07460000
074700                                                                  07470000
074800     IF  PS-PARA-LOGGING-YES                                      07480000
074900         MOVE SPACES  TO  PV-TRACKING-DATA                        07490000
075000         STRING '1140-FIND-MQ-DEBUG-MSG'                          07500000
075100                ' - PS-DISPLAY-DEBUG:'                            07510000
075200                  PS-DISPLAY-DEBUG         DELIMITED BY SIZE      07520000
075300                                      INTO PV-TRACKING-DATA       07530000
075400         PERFORM 9005-DISPLAY-TRACKING                            07540000
075500     END-IF.                                                      07550000
075600                                                                  07560000
075700     IF SQLCODE NOT = ZERO  AND                                   07570000
075800        PV-RETRY-COUNTER > PC-MAX-RETRIES                         07580000
075900               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              07590000
076000               STRING '1140-FIND-DISPLAY-MQ-DEBUG-MSG MAX RETRY'  07600000
076100                  ' - SQLCODE: '                                  07610000
076200                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      07620000
076300                                            INTO LE-MSG           07630000
076400               PERFORM 9000-DISPLAY-SQL-ERROR                     07640000
076500     END-IF.                                                      07650000
076600                                                                  07660000
076700******************************************************************07670000
076800* CHECK TO SEE IF LOGGING IS TURNED ON TO TRACK THE PROGRESS     *07680000
076900******************************************************************07690000
076910 1150-CHECK-PROGRESS-DISPLAY.                                     07691000
076920                                                                  07692000
076930     SET PS-PARA-LOGGING-NO  TO  TRUE                             07693000
076940                                                                  07694000
076950     PERFORM                                                      07695000
076960            WITH TEST AFTER                                       07696000
076970         VARYING PV-RETRY-COUNTER                                 07697000
076980            FROM 1 BY 1                                           07698000
076990           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                07699000
076991              OR SQLCODE = ZERO                                   07699100
076992              OR SQLCODE = +100                                   07699200
076993                                                                  07699300
076994         EXEC SQL                                                 07699400
076995              SELECT FUNC_TXT                                     07699500
076996                INTO :KRPRPM-FUNC-TXT                             07699600
076997                FROM TKRPRPM                                      07699700
076998               WHERE LOC_ID             =   90                    07699800
076999                 AND INTFC_SYS_CDE      =  'KHL'                  07699900
077000                 AND FUNC_PRC_STAT_CDE  =  'AC'                   07700000
077001                 AND FUNC_TXT           =  'Y'                    07700100
077002                 AND SYS_PRC_FUNC_CDE   =  'L201LG'               07700200
077003                 AND FUNC_BEG_TMST     <=  CURRENT TIMESTAMP      07700300
077004                 AND FUNC_END_TMST     >=  CURRENT TIMESTAMP      07700400
077005         END-EXEC                                                 07700500
077006                                                                  07700600
077007         EVALUATE TRUE                                            07700700
077008          WHEN SQLCODE = ZERO                                     07700800
077009               SET PS-PARA-LOGGING-YES TO TRUE                    07700900
077010                                                                  07701000
077011          WHEN SQLCODE = +100                                     07701100
077012          WHEN SQLCODE = -904                                     07701200
077013          WHEN SQLCODE = -913                                     07701300
077014          WHEN SQLCODE = -911                                     07701400
077015               CONTINUE                                           07701500
077016                                                                  07701600
077017          WHEN OTHER                                              07701700
077018               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              07701800
077019               STRING '1150-CHECK-PROGRESS-DISPLAY'               07701900
077020                  ' - SQLCODE: '                                  07702000
077021                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      07702100
077022                                            INTO LE-MSG           07702200
077023               PERFORM 9000-DISPLAY-SQL-ERROR                     07702300
077024         END-EVALUATE                                             07702400
077025     END-PERFORM.                                                 07702500
077026                                                                  07702600
077027     IF SQLCODE NOT = ZERO  AND                                   07702700
077028        PV-RETRY-COUNTER > PC-MAX-RETRIES                         07702800
077029               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              07702900
077030               STRING '1150-CHECK-PROGRESS-DISPLAY MAX RETRY'     07703000
077040                  ' - SQLCODE: '                                  07704000
077041                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      07704100
077042                                            INTO LE-MSG           07704200
077043               PERFORM 9000-DISPLAY-SQL-ERROR                     07704300
077044     END-IF.                                                      07704400
077045                                                                  07704500
077046     IF  PS-PARA-LOGGING-YES                                      07704600
077047         MOVE SPACES  TO  PV-TRACKING-DATA                        07704700
077048         STRING '1150-CHECK-PROGRESS-DISPLAY'                     07704800
077049                ' - PS-PARA-LOGGING-SW:'                          07704900
077050                  PS-PARA-LOGGING-SW                              07705000
077060                                           DELIMITED BY SIZE      07706000
077061                                      INTO PV-TRACKING-DATA       07706100
077062         PERFORM 9005-DISPLAY-TRACKING                            07706200
077063     END-IF.                                                      07706300
077064                                                                  07706400
077065 1155-CHECK-PKSL-PROCESSING.                                      07706500
077066                                                                  07706600
077067     SET PS-PKSL-PROCESSING-NO TO TRUE.                           07706700
077068                                                                  07706800
077069     PERFORM                                                      07706900
077070            WITH TEST AFTER                                       07707000
077071         VARYING PV-RETRY-COUNTER                                 07707100
077072            FROM 1 BY 1                                           07707200
077073           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                07707300
077074              OR SQLCODE = ZERO                                   07707400
077075              OR SQLCODE = +100                                   07707500
077076                                                                  07707600
077077         EXEC SQL                                                 07707700
077078              SELECT FUNC_TXT                                     07707800
077079                INTO :KRPRPM-FUNC-TXT                             07707900
077080                FROM TKRPRPM                                      07708000
077081               WHERE LOC_ID             =   90                    07708100
077082                 AND INTFC_SYS_CDE      =  'KHL'                  07708200
077083                 AND FUNC_PRC_STAT_CDE  =  'AC'                   07708300
077084                 AND FUNC_TXT           =  'Y'                    07708400
077085                 AND SYS_PRC_FUNC_CDE   =  'PKSLPR'               07708500
077086                 AND FUNC_BEG_TMST     <=  CURRENT TIMESTAMP      07708600
077087                 AND FUNC_END_TMST     >=  CURRENT TIMESTAMP      07708700
077088         END-EXEC                                                 07708800
077089                                                                  07708900
077090         EVALUATE TRUE                                            07709000
077091          WHEN SQLCODE = ZERO                                     07709100
077092               SET PS-PKSL-PROCESSING-YES TO TRUE                 07709200
077093                                                                  07709300
077094          WHEN SQLCODE = +100                                     07709400
077095          WHEN SQLCODE = -904                                     07709500
077096          WHEN SQLCODE = -913                                     07709600
077097          WHEN SQLCODE = -911                                     07709700
077098               CONTINUE                                           07709800
077099                                                                  07709900
077100          WHEN OTHER                                              07710000
077101               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              07710100
077102               STRING '1155-CHECK-PKSL-PROCESSING'                07710200
077103                  ' - SQLCODE: '                                  07710300
077104                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      07710400
077105                                            INTO LE-MSG           07710500
077106               PERFORM 9000-DISPLAY-SQL-ERROR                     07710600
077107         END-EVALUATE                                             07710700
077108     END-PERFORM.                                                 07710800
077109                                                                  07710900
077110     IF SQLCODE NOT = ZERO  AND                                   07711000
077111        PV-RETRY-COUNTER > PC-MAX-RETRIES                         07711100
077112               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              07711200
077113               STRING '1155-CHECK-PKSL-PROCESSING MAX RETRY'      07711300
077114                  ' - SQLCODE: '                                  07711400
077115                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      07711500
077116                                            INTO LE-MSG           07711600
077117               PERFORM 9000-DISPLAY-SQL-ERROR                     07711700
077118     END-IF.                                                      07711800
077119                                                                  07711900
077120     IF  PS-PARA-LOGGING-YES                                      07712000
077121         MOVE SPACES  TO  PV-TRACKING-DATA                        07712100
077122         STRING '1155-CHECK-PKSL-PROCESSING'                      07712200
077123                ' - PS-PKSL-PROCESSING-SW: '                      07712300
077124                  PS-PKSL-PROCESSING-SW                           07712400
077127                                           DELIMITED BY SIZE      07712700
077128                                      INTO PV-TRACKING-DATA       07712800
077129         PERFORM 9005-DISPLAY-TRACKING                            07712900
077130     END-IF.                                                      07713000
077131                                                                  07713100
077132                                                                  07713200
077133****************************************************************  07713300
077134** CONNECT TO THE QUEUE MANAGER                                   07713400
077135** GET THE HANDLE TO THE QUEUE MANAGER                            07713500
077136****************************************************************  07713600
077137 1200-MQ-CONNECT-TO-QMGR.                                         07713700
077138                                                                  07713800
077139     IF  PS-PARA-LOGGING-YES                                      07713900
077140         MOVE SPACES  TO  PV-TRACKING-DATA                        07714000
077200         STRING '1200-MQ-CONNECT-TO-QMGR'                         07720000
077300                ' -  QM-QMGR-NAME:'        QM-QMGR-NAME           07730000
077400                                           DELIMITED BY SIZE      07740000
077410                                      INTO PV-TRACKING-DATA       07741000
077420         PERFORM 9005-DISPLAY-TRACKING                            07742000
077430     END-IF.                                                      07743000
077440                                                                  07744000
077450* CONNECT TO THE QUEUE                                            07745000
077460* CONTROL CARD 1 - QMGR NAME                                      07746000
077470                                                                  07747000
077480***  MOVE 'QKST'   TO QM-QMGR-NAME.                               07748000
077490                                                                  07749000
077500     CALL MQV-MQCONN USING QM-QMGR-NAME                           07750000
077600                           MQV-HCONN                              07760000
077700                           MQV-COMPLETION-CODE                    07770000
077800                           MQV-REASON.                            07780000
077900                                                                  07790000
078000*CHECK RETURN REASON CODE.                                        07800000
078100     IF  MQV-COMPLETION-CODE  =  MQCC-OK                          07810000
078200         MOVE SPACES TO PV-ACTION                                 07820000
078300         STRING 'MQCONN SUCCESSFUL TO ' QM-QMGR-NAME              07830000
078400                 DELIMITED BY SIZE INTO PV-ACTION                 07840000
078500         PERFORM 9001-LOGGING-MESSAGE                             07850000
078600         CONTINUE                                                 07860000
078700     ELSE                                                         07870000
078800         CALL MQV-MQCHECK USING MQV-REASON                        07880000
078900                                MQV-REASON-TEXT                   07890000
079000         STRING 'CONNECT - ' MQOD-OBJECTQMGRNAME                  07900000
079100                 DELIMITED BY SIZE INTO LE-MSG                    07910000
079200               PERFORM 9000-DISPLAY-SQL-ERROR                     07920000
079300     END-IF.                                                      07930000
079400                                                                  07940000
079500                                                                  07950000
079600****************************************************************  07960000
079700** CONNECT TO THE QUEUE MANAGER - PKSLIP CREATE/ASN PROCESSED     07970000
079800** GET THE HANDLE TO THE QUEUE MANAGER                            07980000
079900** ADDED = 11/15/2018                                             07990000
080000****************************************************************  08000000
080010 1200B-MQ-CONNECT-TO-QMGR.                                        08001000
080020                                                                  08002000
080030     IF  PS-PARA-LOGGING-YES                                      08003000
080040         MOVE SPACES  TO  PV-TRACKING-DATA                        08004000
080050         STRING '1200B-MQ-CONNECT-TO-QMGR'                        08005000
080051                ' - QM-QMGR-NAME:'                                08005100
080052                 QM-QMGR-NAME                                     08005200
080053                                           DELIMITED BY SIZE      08005300
080054                                      INTO PV-TRACKING-DATA       08005400
080055         PERFORM 9005-DISPLAY-TRACKING                            08005500
080056     END-IF.                                                      08005600
080057                                                                  08005700
080058* CONNECT TO THE QUEUE                                            08005800
080059* CONTROL CARD 1 - QMGR NAME                                      08005900
080060                                                                  08006000
080070***  MOVE 'QKST'   TO QM-QMGR-NAME.                               08007000
080080                                                                  08008000
080090     CALL MQV-MQCONN USING QM-QMGR-NAME                           08009000
080100                           MQV-HCONN                              08010000
080200                           MQV-COMPLETION-CODE                    08020000
080300                           MQV-REASON.                            08030000
080400                                                                  08040000
080500*CHECK RETURN REASON CODE.                                        08050000
080600     IF  MQV-COMPLETION-CODE  =  MQCC-OK                          08060000
080700         MOVE SPACES TO PV-ACTION                                 08070000
080701         STRING 'MQCONN SUCCESSFUL TO ' QM-QMGR-NAME              08070100
080702                 DELIMITED BY SIZE INTO PV-ACTION                 08070200
080703         PERFORM 9001-LOGGING-MESSAGE                             08070300
080704         CONTINUE                                                 08070400
080705     ELSE                                                         08070500
080706         CALL MQV-MQCHECK USING MQV-REASON                        08070600
080707                                MQV-REASON-TEXT                   08070700
080708         STRING 'CONNECT - ' MQOD-OBJECTQMGRNAME                  08070800
080709                 DELIMITED BY SIZE INTO LE-MSG                    08070900
080710                                                                  08071000
080720         PERFORM 9000-DISPLAY-SQL-ERROR                           08072000
080721     END-IF.                                                      08072100
080722                                                                  08072200
080723                                                                  08072300
080724****************************************************************  08072400
080725** OPEN THE QUEUE FOR 'PUT'                                       08072500
080726*  NOTE !!! IF YOU WANT TO WRITE TO A LOCAL QUEUE FOR TESTING     08072600
080727*  PURPOSES, YOU MUST MOVE THE NAME OF THE LOCAL QUEUE QMGR TO    08072700
080728*  MQOD-OBJECTQMGRNAME IN THIS OPEN CALL (INSTEAD OF MOVING THE   08072800
080729*  NAME OF THE UNIX BOX). THIS SINGLE CHANGE IS THE DIFFERENCE    08072900
080730*  BETWEEN WRITING TO THE LOCAL QUEUE AS OPPOSED TO WRITING OUT   08073000
080740*  TO THE REMOTE QUEUE (REMOTE QUEUE HAS A DIFFERENT QMGR).       08074000
080750****************************************************************  08075000
080760 1300-MQ-QUEUE-OPEN.                                              08076000
080770                                                                  08077000
080780     IF  PS-PARA-LOGGING-YES                                      08078000
080790         MOVE SPACES  TO  PV-TRACKING-DATA                        08079000
080800         PERFORM 9005-DISPLAY-TRACKING                            08080000
080900                                                                  08090000
081000         MOVE SPACES  TO  PV-TRACKING-DATA                        08100000
081010         STRING '1300-MQ-QUEUE-OPEN'                              08101000
081020                ' - '                                             08102000
081030                 QM-TRANS-QUEUE-NAME                              08103000
081040                ' - '                                             08104000
081041                 QM-QMGR-NAME-REMOTE       DELIMITED BY SIZE      08104100
081042                                      INTO PV-TRACKING-DATA       08104200
081043         PERFORM 9005-DISPLAY-TRACKING                            08104300
081044     END-IF.                                                      08104400
081045                                                                  08104500
081046* CONTROL CARD 2 - QM-TRANS-QUEUE-NAME                            08104600
081047* CONTROL CARD 3 - QMGR NAME REMOTE                               08104700
081048                                                                  08104800
081049**   MOVE 'QKST'               TO QM-QMGR-NAME.                   08104900
081050**   MOVE 'LOCAL.Q'            TO QM-TRANS-QUEUE-NAME.            08105000
081060**   MOVE 'QKST'               TO QM-QMGR-NAME-REMOTE.            08106000
081070     MOVE QM-TRANS-QUEUE-NAME  TO MQOD-OBJECTNAME.                08107000
081080     MOVE QM-QMGR-NAME-REMOTE  TO MQOD-OBJECTQMGRNAME.            08108000
081090                                                                  08109000
081100     COMPUTE MQV-OPEN-OPTIONS = MQOO-OUTPUT                       08110000
081200                             + MQOO-SET-IDENTITY-CONTEXT          08120000
081300                             + MQOO-FAIL-IF-QUIESCING.            08130000
081400                                                                  08140000
081500     CALL MQV-MQOPEN USING MQV-HCONN                              08150000
081600                           MQM-OBJECT-DESCRIPTOR                  08160000
081700                           MQV-OPEN-OPTIONS                       08170000
081800                           MQV-LOC-HANDLE                         08180000
081900                           MQV-COMPLETION-CODE                    08190000
082000                           MQV-REASON.                            08200000
082100                                                                  08210000
082200     IF  MQV-COMPLETION-CODE = MQCC-OK                            08220000
082300         MOVE SPACES TO PV-ACTION                                 08230000
082400         STRING 'MQOPEN SUCCESSFUL TO ' QM-TRANS-QUEUE-NAME       08240000
082500                 DELIMITED BY SIZE INTO PV-ACTION                 08250000
082600         PERFORM 9001-LOGGING-MESSAGE                             08260000
082700     ELSE                                                         08270000
082800         CALL MQV-MQCHECK USING MQV-REASON                        08280000
082900                                MQV-REASON-TEXT                   08290000
083000         STRING 'MQOPEN FAILED - ' QM-TRANS-QUEUE-NAME            08300000
083100                 DELIMITED BY SIZE INTO LE-MSG                    08310000
083200                                                                  08320000
083300         PERFORM 9000-DISPLAY-SQL-ERROR                           08330000
083400     END-IF.                                                      08340000
083500                                                                  08350000
083600     IF  PS-PARA-LOGGING-YES                                      08360000
083700         MOVE SPACES  TO  PV-TRACKING-DATA                        08370000
083800         PERFORM 9005-DISPLAY-TRACKING                            08380000
083900     END-IF.                                                      08390000
084000                                                                  08400000
084100                                                                  08410000
084200****************************************************************  08420000
084300** PACKSLIP CREATE / ASN PROCESSED                                08430000
084400** OPEN THE QUEUE FOR 'PUT'                                       08440000
084410*  NOTE !!! IF YOU WANT TO WRITE TO A LOCAL QUEUE FOR TESTING     08441000
084420*  PURPOSES, YOU MUST MOVE THE NAME OF THE LOCAL QUEUE QMGR TO    08442000
084430*  MQOD-OBJECTQMGRNAME IN THIS OPEN CALL (INSTEAD OF MOVING THE   08443000
084440*  NAME OF THE UNIX BOX). THIS SINGLE CHANGE IS THE DIFFERENCE    08444000
084450*  BETWEEN WRITING TO THE LOCAL QUEUE AS OPPOSED TO WRITING OUT   08445000
084460*  TO THE REMOTE QUEUE (REMOTE QUEUE HAS A DIFFERENT QMGR).       08446000
084470*                                                                 08447000
084480*  ADDED 11/15/2018                                               08448000
084490****************************************************************  08449000
084491 1300B-MQ-QUEUE-OPEN.                                             08449100
084492                                                                  08449200
084493     IF  PS-PARA-LOGGING-YES                                      08449300
084494         MOVE SPACES  TO  PV-TRACKING-DATA                        08449400
084495         PERFORM 9005-DISPLAY-TRACKING                            08449500
084496                                                                  08449600
084497         MOVE SPACES  TO  PV-TRACKING-DATA                        08449700
084498         STRING '1300B-MQ-QUEUE-OPEN'                             08449800
084499                ' - '                                             08449900
084500                 QM-TRANS-QUEUE-NAME                              08450000
084501                ' - '                                             08450100
084502                 QM-QMGR-NAME-REMOTE       DELIMITED BY SIZE      08450200
084503                                      INTO PV-TRACKING-DATA       08450300
084504         PERFORM 9005-DISPLAY-TRACKING                            08450400
084505     END-IF.                                                      08450500
084506                                                                  08450600
084507* CONTROL CARD 2 - QM-TRANS-QUEUE-NAME                            08450700
084508* CONTROL CARD 3 - QMGR NAME REMOTE                               08450800
084509                                                                  08450900
084510**   MOVE 'QKST'               TO QM-QMGR-NAME.                   08451000
084511**   MOVE 'LOCAL.Q'            TO QM-TRANS-QUEUE-NAME.            08451100
084512**   MOVE 'QKST'               TO QM-QMGR-NAME-REMOTE.            08451200
084513     MOVE QM-TRANS-QUEUE-NAME  TO MQOD-OBJECTNAME.                08451300
084514     MOVE QM-QMGR-NAME-REMOTE  TO MQOD-OBJECTQMGRNAME.            08451400
084515                                                                  08451500
084516     COMPUTE MQV-OPEN-OPTIONS = MQOO-OUTPUT                       08451600
084517                             + MQOO-SET-IDENTITY-CONTEXT          08451700
084518                             + MQOO-FAIL-IF-QUIESCING.            08451800
084519                                                                  08451900
084520     CALL MQV-MQOPEN USING MQV-HCONN                              08452000
084521                           MQM-OBJECT-DESCRIPTOR                  08452100
084522                           MQV-OPEN-OPTIONS                       08452200
084523                           MQV-LOC-HANDLE                         08452300
084524                           MQV-COMPLETION-CODE                    08452400
084525                           MQV-REASON.                            08452500
084526                                                                  08452600
084527     IF  MQV-COMPLETION-CODE = MQCC-OK                            08452700
084528         MOVE SPACES TO PV-ACTION                                 08452800
084529         STRING 'MQOPEN SUCCESSFUL TO ' QM-TRANS-QUEUE-NAME       08452900
084530                 DELIMITED BY SIZE INTO PV-ACTION                 08453000
084531         PERFORM 9001-LOGGING-MESSAGE                             08453100
084532     ELSE                                                         08453200
084533         CALL MQV-MQCHECK USING MQV-REASON                        08453300
084534                                MQV-REASON-TEXT                   08453400
084535         STRING 'MQOPEN FAILED - ' QM-TRANS-QUEUE-NAME            08453500
084536                 DELIMITED BY SIZE INTO LE-MSG                    08453600
084537                                                                  08453700
084538         PERFORM 9000-DISPLAY-SQL-ERROR                           08453800
084539     END-IF.                                                      08453900
084540                                                                  08454000
084541     IF  PS-PARA-LOGGING-YES                                      08454100
084542         MOVE SPACES  TO  PV-TRACKING-DATA                        08454200
084543         PERFORM 9005-DISPLAY-TRACKING                            08454300
084544     END-IF.                                                      08454400
084545                                                                  08454500
084546                                                                  08454600
084547******************************************************************08454700
084548* FIND THE AMOUNT OF TIME TO SUBTRACT FROM THE CURRENT TMST      *08454800
084549* TO DETERMINE WHICH ROWS TO PROCESS FROM WFT_LOD_CNTL CURSOR    *08454900
084550******************************************************************08455000
084560 1350-FIND-OFFSET-TMST.                                           08456000
084570                                                                  08457000
084580     IF  PS-PARA-LOGGING-YES                                      08458000
084590         MOVE SPACES  TO  PV-TRACKING-DATA                        08459000
084600         STRING '1350-FIND-OFFSET-TMST'   DELIMITED BY SIZE       08460000
084700                                      INTO PV-TRACKING-DATA       08470000
084800         PERFORM 9005-DISPLAY-TRACKING                            08480000
084900     END-IF.                                                      08490000
085000                                                                  08500000
085100     PERFORM                                                      08510000
085200            WITH TEST AFTER                                       08520000
085300         VARYING PV-RETRY-COUNTER                                 08530000
085400            FROM 1 BY 1                                           08540000
085500           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                08550000
085600              OR SQLCODE = ZERO                                   08560000
085700              OR SQLCODE = +100                                   08570000
085800                                                                  08580000
085900         EXEC SQL                                                 08590000
086000              SELECT (CURRENT TIMESTAMP - FUNC_QTY SECONDS)       08600000
086100                INTO :PV-PRC-CNTL-TMST                            08610000
086200                FROM TKRPRPM                                      08620000
086300               WHERE LOC_ID             =   90                    08630000
086400                 AND INTFC_SYS_CDE      =  'RMS'                  08640000
086500                 AND FUNC_PRC_STAT_CDE  =  'AC'                   08650000
086600                 AND SYS_PRC_FUNC_CDE   =  'RCTOTM'               08660000
086700                 AND (CURRENT DATE                                08670000
086800                     BETWEEN DATE(FUNC_BEG_TMST) AND              08680000
086900                             DATE(FUNC_END_TMST))                 08690000
087000         END-EXEC                                                 08700000
087100                                                                  08710000
087200         EVALUATE TRUE                                            08720000
087300          WHEN SQLCODE = ZERO                                     08730000
087400          WHEN SQLCODE = -904                                     08740000
087500          WHEN SQLCODE = -913                                     08750000
087600          WHEN SQLCODE = -911                                     08760000
087700               CONTINUE                                           08770000
087800                                                                  08780000
087900          WHEN OTHER                                              08790000
088000               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              08800000
088100               STRING '1350-FIND-OFFSET-TMST FAILED'              08810000
088200                  ' - SQLCODE: '                                  08820000
088300                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      08830000
088400                                            INTO LE-MSG           08840000
088500                                                                  08850000
088600               PERFORM 9000-DISPLAY-SQL-ERROR                     08860000
088700         END-EVALUATE                                             08870000
088800     END-PERFORM.                                                 08880000
088900                                                                  08890000
089000     IF  PS-PARA-LOGGING-YES                                      08900000
089010         MOVE SPACES  TO  PV-TRACKING-DATA                        08901000
089020         STRING '1350-FIND-OFFSET-TMST'                           08902000
089030                ' - PV-PRC-CNTL-TMST:'                            08903000
089040                  PV-PRC-CNTL-TMST         DELIMITED BY SIZE      08904000
089050                                      INTO PV-TRACKING-DATA       08905000
089060         PERFORM 9005-DISPLAY-TRACKING                            08906000
089070     END-IF.                                                      08907000
089080                                                                  08908000
089090     IF SQLCODE NOT = ZERO  AND                                   08909000
089100        PV-RETRY-COUNTER > PC-MAX-RETRIES                         08910000
089200               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              08920000
089300               STRING '1350-FIND-OFFSET-TMST MAX RETRY FAILED'    08930000
089400                  ' - SQLCODE: '                                  08940000
089500                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      08950000
089600                                            INTO LE-MSG           08960000
089700                                                                  08970000
089800               PERFORM 9000-DISPLAY-SQL-ERROR                     08980000
089900     END-IF.                                                      08990000
090000                                                                  09000000
090100****************************************************************  09010000
090200** CLOSES THE MQ QUEUE.                                           09020000
090300****************************************************************  09030000
090400 1400-MQ-QUEUE-CLOSE.                                             09040000
090500                                                                  09050000
090600     IF  PS-PARA-LOGGING-YES                                      09060000
090610         MOVE SPACES  TO  PV-TRACKING-DATA                        09061000
090620         STRING '1400-MQ-QUEUE-CLOSE'     DELIMITED BY SIZE       09062000
090630                                      INTO PV-TRACKING-DATA       09063000
090640         PERFORM 9005-DISPLAY-TRACKING                            09064000
090650     END-IF.                                                      09065000
090660                                                                  09066000
090670     CALL MQV-MQCLOSE USING MQV-HCONN                             09067000
090680                            MQV-LOC-HANDLE                        09068000
090690                            MQCO-NONE                             09069000
090700                            MQV-COMPLETION-CODE                   09070000
090800                            MQV-REASON.                           09080000
090900                                                                  09090000
091000     IF  MQV-COMPLETION-CODE = MQCC-OK                            09100000
091100         MOVE SPACES TO PV-ACTION                                 09110000
091200         STRING 'MQCLOSE SUCCESSFUL TO ' QM-TRANS-QUEUE-NAME      09120000
091300                 DELIMITED BY SIZE INTO PV-ACTION                 09130000
091400         PERFORM 9001-LOGGING-MESSAGE                             09140000
091500     ELSE                                                         09150000
091600         CALL MQV-MQCHECK USING MQV-REASON                        09160000
091700                                MQV-REASON-TEXT                   09170000
091800         STRING 'MQCLOSE FAILED - ' QM-TRANS-QUEUE-NAME           09180000
091900                 DELIMITED BY SIZE INTO LE-MSG                    09190000
092000                                                                  09200000
092100         PERFORM 9000-DISPLAY-SQL-ERROR                           09210000
092200     END-IF.                                                      09220000
092300                                                                  09230000
092400****************************************************************  09240000
092500** CLOSES THE MQ QUEUE   PKSLIP CREATE / ASN PROCESSED            09250000
092600****************************************************************  09260000
092610 1400B-MQ-QUEUE-CLOSE.                                            09261000
092620                                                                  09262000
092630     IF  PS-PARA-LOGGING-YES                                      09263000
092640         MOVE SPACES  TO  PV-TRACKING-DATA                        09264000
092641         STRING '1400B-MQ-QUEUE-CLOSE'    DELIMITED BY SIZE       09264100
092642                                      INTO PV-TRACKING-DATA       09264200
092643         PERFORM 9005-DISPLAY-TRACKING                            09264300
092644     END-IF.                                                      09264400
092645                                                                  09264500
092646     CALL MQV-MQCLOSE USING MQV-HCONN                             09264600
092647                            MQV-LOC-HANDLE                        09264700
092648                            MQCO-NONE                             09264800
092649                            MQV-COMPLETION-CODE                   09264900
092650                            MQV-REASON.                           09265000
092660                                                                  09266000
092670     IF  MQV-COMPLETION-CODE = MQCC-OK                            09267000
092680         MOVE SPACES TO PV-ACTION                                 09268000
092690         STRING 'MQCLOSE SUCCESSFUL TO ' QM-TRANS-QUEUE-NAME      09269000
092691                 DELIMITED BY SIZE INTO PV-ACTION                 09269100
092692         PERFORM 9001-LOGGING-MESSAGE                             09269200
092693     ELSE                                                         09269300
092694         CALL MQV-MQCHECK USING MQV-REASON                        09269400
092695                                MQV-REASON-TEXT                   09269500
092696         STRING 'MQCLOSE FAILED - ' QM-TRANS-QUEUE-NAME           09269600
092697                 DELIMITED BY SIZE INTO LE-MSG                    09269700
092698                                                                  09269800
092699         PERFORM 9000-DISPLAY-SQL-ERROR                           09269900
092700     END-IF.                                                      09270000
092710                                                                  09271000
092720****************************************************************  09272000
092730** DISCONNECT FROM THE QUEUE MANAGER                              09273000
092740****************************************************************  09274000
092750 1500-DISCONNECT-QMGR.                                            09275000
092760                                                                  09276000
092770     IF  PS-PARA-LOGGING-YES                                      09277000
092780         MOVE SPACES  TO  PV-TRACKING-DATA                        09278000
092790         STRING '1500-DISCONNECT-QMGR'    DELIMITED BY SIZE       09279000
092800                                      INTO PV-TRACKING-DATA       09280000
092900         PERFORM 9005-DISPLAY-TRACKING                            09290000
093000     END-IF.                                                      09300000
093100                                                                  09310000
093200* CONTROL CARD 3 - QM-QMGR-NAME-REMOTE                            09320000
093300* CONTROL CARD 1 - QM-QMGR NAME                                   09330000
093400                                                                  09340000
093500     CALL MQV-MQDISC USING MQV-HCONN                              09350000
093600                           MQV-COMPLETION-CODE                    09360000
093700                           MQV-REASON.                            09370000
093800                                                                  09380000
093900                                                                  09390000
094000     IF  MQV-COMPLETION-CODE = MQCC-OK                            09400000
094100         MOVE SPACES TO PV-ACTION                                 09410000
094200         STRING 'MQDISC SUCCESSFUL TO ' MQOD-OBJECTQMGRNAME       09420000
094300                 DELIMITED BY SIZE INTO PV-ACTION                 09430000
094400         PERFORM 9001-LOGGING-MESSAGE                             09440000
094500         CONTINUE                                                 09450000
094600     ELSE                                                         09460000
094700         CALL MQV-MQCHECK USING MQV-REASON                        09470000
094800                                MQV-REASON-TEXT                   09480000
094900         STRING 'DISCONNECT FAILED - ' MQOD-OBJECTQMGRNAME        09490000
095000                 DELIMITED BY SIZE INTO LE-MSG                    09500000
095010                                                                  09501000
095020         PERFORM 9000-DISPLAY-SQL-ERROR                           09502000
095030     END-IF.                                                      09503000
095040                                                                  09504000
095050****************************************************************  09505000
095060** DISCONNECT FROM THE QUEUE MANAGER - PKSLIP CREATE/ASN PROCESS  09506000
095070** ADDED - 11/15/2018                                             09507000
095080****************************************************************  09508000
095090 1500B-DISCONNECT-QMGR.                                           09509000
095100                                                                  09510000
095200     IF  PS-PARA-LOGGING-YES                                      09520000
095300         MOVE SPACES  TO  PV-TRACKING-DATA                        09530000
095310         STRING '1500B-DISCONNECT-QMGR'   DELIMITED BY SIZE       09531000
095320                                      INTO PV-TRACKING-DATA       09532000
095330         PERFORM 9005-DISPLAY-TRACKING                            09533000
095340     END-IF.                                                      09534000
095350                                                                  09535000
095360* CONTROL CARD 3 - QM-QMGR-NAME-REMOTE                            09536000
095370* CONTROL CARD 1 - QM-QMGR NAME                                   09537000
095380                                                                  09538000
095390     CALL MQV-MQDISC USING MQV-HCONN                              09539000
095391                           MQV-COMPLETION-CODE                    09539100
095392                           MQV-REASON.                            09539200
095393                                                                  09539300
095394                                                                  09539400
095395     IF  MQV-COMPLETION-CODE = MQCC-OK                            09539500
095396         MOVE SPACES TO PV-ACTION                                 09539600
095397         STRING 'MQDISC SUCCESSFUL TO ' MQOD-OBJECTQMGRNAME       09539700
095398                 DELIMITED BY SIZE INTO PV-ACTION                 09539800
095399         PERFORM 9001-LOGGING-MESSAGE                             09539900
095400         CONTINUE                                                 09540000
095401     ELSE                                                         09540100
095402         CALL MQV-MQCHECK USING MQV-REASON                        09540200
095403                                MQV-REASON-TEXT                   09540300
095404         STRING 'DISCONNECT FAILED - ' MQOD-OBJECTQMGRNAME        09540400
095405                 DELIMITED BY SIZE INTO LE-MSG                    09540500
095406                                                                  09540600
095407         PERFORM 9000-DISPLAY-SQL-ERROR                           09540700
095408     END-IF.                                                      09540800
095409                                                                  09540900
095410******************************************************************09541000
095420* WFT_LOD_CNTL PROCESSING                                        *09542000
095430******************************************************************09543000
095440 2000-CNTL-PROCESSING.                                            09544000
095450                                                                  09545000
095460     IF  PS-PARA-LOGGING-YES                                      09546000
095470         MOVE SPACES  TO  PV-TRACKING-DATA                        09547000
095480         STRING '2000-CNTL-PROCESSING'    DELIMITED BY SIZE       09548000
095490                                      INTO PV-TRACKING-DATA       09549000
095500         PERFORM 9005-DISPLAY-TRACKING                            09550000
095600     END-IF.                                                      09560000
095700                                                                  09570000
095800     MOVE  0               TO  RD025-STORE-COUNT.                 09580000
095900     PERFORM 4000-OPEN-XFER-CSR.                                  09590000
096000     PERFORM 3000-XFER-PROCESSING                                 09600000
096100       UNTIL PS-END-OF-XFER-CSR-Y.                                09610000
096200                                                                  09620000
096300     PERFORM 4020-CLOSE-XFER-CSR.                                 09630000
096400     IF PS-NO-ABEND                                               09640000
096500         PERFORM 4200-UPDATE-COMPLETED                            09650000
096600         PERFORM 5000-MQ-PUT-TO-QUEUE                             09660000
096700         PERFORM 8000-SYNCPOINT                                   09670000
096800     END-IF.                                                      09680000
096900                                                                  09690000
097000     SET PS-END-OF-XFER-CSR-N  TO  TRUE.                          09700000
097100     PERFORM 2510-FETCH-CNTL-CSR.                                 09710000
097200                                                                  09720000
097201                                                                  09720100
097202******************************************************************09720200
097203* PACKSLIP CREATE / ASN PROCESSED WFT_LOD_CNTL PROCESSING        *09720300
097204* ADDED - 11/15/2018                                             *09720400
097205******************************************************************09720500
097206 2000B-PKSL-CNTL-PROCESSING.                                      09720600
097207                                                                  09720700
097208     IF  PS-PARA-LOGGING-YES                                      09720800
097209         MOVE SPACES  TO  PV-TRACKING-DATA                        09720900
097210         STRING '2000B-PKSL-CNTL-PROCESSING'                      09721000
097220                                           DELIMITED BY SIZE      09722000
097230                                      INTO PV-TRACKING-DATA       09723000
097240         PERFORM 9005-DISPLAY-TRACKING                            09724000
097241     END-IF.                                                      09724100
097242                                                                  09724200
097243     SET PS-END-OF-PKSL-XFER-CSR-N  TO  TRUE.                     09724300
097244                                                                  09724400
097245     PERFORM 4000B-OPEN-PKSL-XFER-CSR.                            09724500
097246     PERFORM 3000B-PKSL-XFER-PROCESSING                           09724600
097247       UNTIL PS-END-OF-PKSL-XFER-CSR-Y.                           09724700
097248                                                                  09724800
097249     PERFORM 4020B-CLOSE-PKSL-XFER-CSR.                           09724900
097250     IF PS-NO-ABEND                                               09725000
097260         PERFORM 8000-SYNCPOINT                                   09726000
097270     END-IF.                                                      09727000
097280                                                                  09728000
097290     SET PS-END-OF-PKSL-XFER-CSR-N  TO  TRUE.                     09729000
097300     PERFORM 2510B-FETCH-PKSL-CNTL-CSR.                           09730000
097301                                                                  09730100
097302                                                                  09730200
097303******************************************************************09730300
097304*     2500-OPEN-CNTL-CSR                                         *09730400
097305******************************************************************09730500
097306 2500-OPEN-CNTL-CSR.                                              09730600
097307                                                                  09730700
097308     IF  PS-PARA-LOGGING-YES                                      09730800
097309         MOVE SPACES  TO  PV-TRACKING-DATA                        09730900
097310         PERFORM 9005-DISPLAY-TRACKING                            09731000
097320                                                                  09732000
097330         MOVE SPACES  TO  PV-TRACKING-DATA                        09733000
097340         STRING '2500-OPEN-CNTL-CSR'      DELIMITED BY SIZE       09734000
097350                                      INTO PV-TRACKING-DATA       09735000
097360         PERFORM 9005-DISPLAY-TRACKING                            09736000
097370     END-IF.                                                      09737000
097380                                                                  09738000
097390     EXEC SQL                                                     09739000
097400          OPEN CNTL-CSR                                           09740000
097500     END-EXEC.                                                    09750000
097600                                                                  09760000
097700     EVALUATE TRUE                                                09770000
097800         WHEN SQLCODE = +0                                        09780000
097900             CONTINUE                                             09790000
098000                                                                  09800000
098100         WHEN OTHER                                               09810000
098200               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              09820000
098300               STRING '2500-OPEN-CNTL-CSR'                        09830000
098400                  ' - SQLCODE: '                                  09840000
098500                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      09850000
098600                                            INTO LE-MSG           09860000
098700               PERFORM 9000-DISPLAY-SQL-ERROR                     09870000
098800     END-EVALUATE.                                                09880000
098900                                                                  09890000
099000******************************************************************09900000
099100* OPEN PACKSLIP CREATE / ASN PROCESS DRIVING CURSOR              *09910000
099200* ADDED - 11/15/2018                                             *09920000
099300******************************************************************09930000
099400 2500B-OPEN-PKSL-CNTL-CSR.                                        09940000
099500                                                                  09950000
099600     IF  PS-PARA-LOGGING-YES                                      09960000
099610         MOVE SPACES  TO  PV-TRACKING-DATA                        09961000
099620         PERFORM 9005-DISPLAY-TRACKING                            09962000
099630                                                                  09963000
099640         MOVE SPACES  TO  PV-TRACKING-DATA                        09964000
099641         STRING '2500B-OPEN-PKSL-CNTL-CSR'                        09964100
099642                                           DELIMITED BY SIZE      09964200
099643                                      INTO PV-TRACKING-DATA       09964300
099644         PERFORM 9005-DISPLAY-TRACKING                            09964400
099645     END-IF.                                                      09964500
099646                                                                  09964600
099647     EXEC SQL                                                     09964700
099648          OPEN PKSL-ASN-CNTL-CSR                                  09964800
099649     END-EXEC.                                                    09964900
099650                                                                  09965000
099660     EVALUATE TRUE                                                09966000
099670         WHEN SQLCODE = +0                                        09967000
099680             CONTINUE                                             09968000
099690                                                                  09969000
099691         WHEN OTHER                                               09969100
099692               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              09969200
099693               STRING '2500B-OPEN-PKSL-CNTL-CSR'                  09969300
099694                  ' - SQLCODE: '                                  09969400
099695                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      09969500
099696                                            INTO LE-MSG           09969600
099697                                                                  09969700
099698               PERFORM 9000-DISPLAY-SQL-ERROR                     09969800
099699     END-EVALUATE.                                                09969900
099700                                                                  09970000
099710******************************************************************09971000
099720*     2510-FETCH-CNTL-CSR                                        *09972000
099730******************************************************************09973000
099740 2510-FETCH-CNTL-CSR.                                             09974000
099750                                                                  09975000
099760     IF  PS-PARA-LOGGING-YES                                      09976000
099770         MOVE SPACES  TO  PV-TRACKING-DATA                        09977000
099780         PERFORM 9005-DISPLAY-TRACKING                            09978000
099790                                                                  09979000
099800         MOVE SPACES  TO  PV-TRACKING-DATA                        09980000
099900         STRING '2510-FETCH-CNTL-CSR'     DELIMITED BY SIZE       09990000
100000                                      INTO PV-TRACKING-DATA       10000000
100010         PERFORM 9005-DISPLAY-TRACKING                            10001000
100020     END-IF.                                                      10002000
100030                                                                  10003000
100040         EXEC SQL                                                 10004000
100050             FETCH CNTL-CSR                                       10005000
100060              INTO :WFT00001-PRC-CNTL-TMST                        10006000
100070                 , :WFT00001-STAT-CDE                             10007000
100080                 , :WFT00001-STR-NBR                              10008000
100081                 , :WFT00001-TRN-TYP-CDE                          10008101
100090         END-EXEC.                                                10009000
100100                                                                  10010000
100200         EVALUATE TRUE                                            10020000
100300             WHEN SQLCODE = +0                                    10030000
100400                  CONTINUE                                        10040000
100500                                                                  10050000
100600             WHEN SQLCODE = +100                                  10060000
100700                 SET PS-END-OF-CNTL-CSR-Y  TO  TRUE               10070000
100800             WHEN OTHER                                           10080000
100900               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              10090000
101000               STRING '2510-FETCH-CNTL-CSR'                       10100000
101100                  ' - SQLCODE: '                                  10110000
101200                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      10120000
101300                                            INTO LE-MSG           10130000
101400                                                                  10140000
101500               PERFORM 9000-DISPLAY-SQL-ERROR                     10150000
101600         END-EVALUATE.                                            10160000
101700                                                                  10170000
101800     IF  PS-PARA-LOGGING-YES                                      10180000
101900         MOVE SPACES  TO  PV-TRACKING-DATA                        10190000
102000         MOVE SQLCODE TO  PV-DISPLAY-SQLCODE                      10200000
102100         STRING '2510-FETCH-CNTL-CSR'                             10210000
102200                ' - '                                             10220000
102300                    WFT00001-PRC-CNTL-TMST                        10230000
102400                ' - '                                             10240000
102410                    WFT00001-STAT-CDE                             10241000
102420                ' SQL: ' PV-DISPLAY-SQLCODE                       10242000
102430                '  '     PS-END-OF-CNTL-CSR-SW                    10243000
102440                '  '     PS-ABEND-SW                              10244000
102441                                           DELIMITED BY SIZE      10244100
102442                                      INTO PV-TRACKING-DATA       10244200
102443         PERFORM 9005-DISPLAY-TRACKING                            10244300
102444     END-IF.                                                      10244400
102445                                                                  10244500
102446                                                                  10244600
102447******************************************************************10244700
102448* FETCH PACKSLIP CREATE / ASN PROCESS DRIVING CURSOR             *10244800
102449* ADDED - 11/15/2018                                             *10244900
102450******************************************************************10245000
102460 2510B-FETCH-PKSL-CNTL-CSR.                                       10246000
102470                                                                  10247000
102480     IF  PS-PARA-LOGGING-YES                                      10248000
102490         MOVE SPACES  TO  PV-TRACKING-DATA                        10249000
102500         PERFORM 9005-DISPLAY-TRACKING                            10250000
102510                                                                  10251000
102520         MOVE SPACES  TO  PV-TRACKING-DATA                        10252000
102530         STRING '2510B-FETCH-PKSL-CNTL-CSR'                       10253000
102540                                           DELIMITED BY SIZE      10254000
102550                                      INTO PV-TRACKING-DATA       10255000
102560         PERFORM 9005-DISPLAY-TRACKING                            10256000
102570     END-IF.                                                      10257000
102571                                                                  10257100
102572         EXEC SQL                                                 10257200
102573             FETCH PKSL-ASN-CNTL-CSR                              10257300
102574              INTO :WFT00001-PRC-CNTL-TMST                        10257400
102575                 , :WFT00001-STAT-CDE                             10257500
102576                 , :WFT00001-STR-NBR                              10257600
102577         END-EXEC.                                                10257700
102578                                                                  10257800
102579         EVALUATE TRUE                                            10257900
102580             WHEN SQLCODE = +0                                    10258000
102590                  CONTINUE                                        10259000
102591                                                                  10259100
102592             WHEN SQLCODE = +100                                  10259200
102593                 SET PS-END-OF-PKSL-CNTL-CSR-Y  TO  TRUE          10259300
102594             WHEN OTHER                                           10259400
102595               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              10259500
102596               STRING '2510B-FETCH-PKSL-CNTL-CSR'                 10259600
102597                  ' - SQLCODE: '                                  10259700
102598                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      10259800
102599                                            INTO LE-MSG           10259900
102600               EXEC CICS                                          10260000
102610                    WRITEQ TD                                     10261000
102611                     QUEUE  ('CSSL')                              10261100
102612                      FROM  (LE-STATUS-MESSAGE)                   10261200
102613                    LENGTH  (PV-COMMAREA-LENGTH)                  10261300
102614                      RESP  (PV-CICS-RESPONSE)                    10261400
102615               END-EXEC                                           10261500
102616                                                                  10261600
102617               PERFORM 9000-DISPLAY-SQL-ERROR                     10261700
102618         END-EVALUATE.                                            10261800
102619                                                                  10261900
102620     IF  PS-PARA-LOGGING-YES                                      10262000
102621         MOVE SPACES  TO  PV-TRACKING-DATA                        10262100
102622         MOVE SQLCODE TO PV-DISPLAY-SQLCODE                       10262200
102623         STRING '2510B-FETCH-PKSL-CNTL-CSR'                       10262300
102624                ' - '                                             10262400
102625                    WFT00001-PRC-CNTL-TMST                        10262500
102626                ' - '                                             10262600
102627                    WFT00001-STAT-CDE                             10262700
102628                ' SQL: '  PV-DISPLAY-SQLCODE                      10262800
102629                '  '     PS-END-OF-PKSL-CNTL-CSR-SW               10262900
102630                '  '     PS-ABEND-SW                              10263000
102631                                           DELIMITED BY SIZE      10263100
102632                                      INTO PV-TRACKING-DATA       10263200
102633         PERFORM 9005-DISPLAY-TRACKING                            10263300
102634     END-IF.                                                      10263400
102635                                                                  10263500
102636                                                                  10263600
102637******************************************************************10263700
102638*     2520-CLOSE-CNTL-CSR                                        *10263800
102639******************************************************************10263900
102640 2520-CLOSE-CNTL-CSR.                                             10264000
102650                                                                  10265000
102660     IF  PS-PARA-LOGGING-YES                                      10266000
102670         MOVE SPACES  TO  PV-TRACKING-DATA                        10267000
102680         PERFORM 9005-DISPLAY-TRACKING                            10268000
102690                                                                  10269000
102700         MOVE SPACES  TO  PV-TRACKING-DATA                        10270000
102800         STRING '2520-CLOSE-CNTL-CSR'     DELIMITED BY SIZE       10280000
102900                                      INTO PV-TRACKING-DATA       10290000
102910         PERFORM 9005-DISPLAY-TRACKING                            10291000
102920     END-IF.                                                      10292000
102930                                                                  10293000
102940     EXEC SQL                                                     10294000
102950          CLOSE CNTL-CSR                                          10295000
102960     END-EXEC.                                                    10296000
102970                                                                  10297000
102980     EVALUATE TRUE                                                10298000
102990         WHEN SQLCODE = +0                                        10299000
103000             CONTINUE                                             10300000
103100                                                                  10310000
103200         WHEN OTHER                                               10320000
103300               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              10330000
103400               STRING '2520-CLOSE-CNTL-CSR'                       10340000
103500                  ' - SQLCODE: '                                  10350000
103600                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      10360000
103700                                            INTO LE-MSG           10370000
103800               EXEC CICS                                          10380000
103900                    WRITEQ TD                                     10390000
104000                     QUEUE  ('CSSL')                              10400000
104100                      FROM  (LE-STATUS-MESSAGE)                   10410000
104200                    LENGTH  (PV-COMMAREA-LENGTH)                  10420000
104300                      RESP  (PV-CICS-RESPONSE)                    10430000
104400               END-EXEC                                           10440000
104500                                                                  10450000
104600               PERFORM 9000-DISPLAY-SQL-ERROR                     10460000
104700     END-EVALUATE.                                                10470000
104800                                                                  10480000
104810     IF  PS-PARA-LOGGING-YES                                      10481000
104820         MOVE SPACES  TO  PV-TRACKING-DATA                        10482000
104830         PERFORM 9005-DISPLAY-TRACKING                            10483000
104840     END-IF.                                                      10484000
104850                                                                  10485000
104860                                                                  10486000
104870******************************************************************10487000
104880* FETCH PACKSLIP CREATE / ASN PROCESS DRIVING CURSOR             *10488000
104890* ADDED - 11/15/2018                                             *10489000
104900******************************************************************10490000
104910 2520B-CLOSE-PKSL-CNTL-CSR.                                       10491000
104920                                                                  10492000
104930     IF  PS-PARA-LOGGING-YES                                      10493000
104940         MOVE SPACES  TO  PV-TRACKING-DATA                        10494000
104941         PERFORM 9005-DISPLAY-TRACKING                            10494100
104942                                                                  10494200
104943         MOVE SPACES  TO  PV-TRACKING-DATA                        10494300
104944         STRING '2520B-CLOSE-PKSL-CNTL-CSR'                       10494400
104945                                           DELIMITED BY SIZE      10494500
104946                                      INTO PV-TRACKING-DATA       10494600
104947         PERFORM 9005-DISPLAY-TRACKING                            10494700
104948     END-IF.                                                      10494800
104949                                                                  10494900
104950     EXEC SQL                                                     10495000
104960          CLOSE PKSL-ASN-CNTL-CSR                                 10496000
104970     END-EXEC.                                                    10497000
104980                                                                  10498000
104990     EVALUATE TRUE                                                10499000
104991         WHEN SQLCODE = +0                                        10499100
104992             CONTINUE                                             10499200
104993                                                                  10499300
104994         WHEN OTHER                                               10499400
104995               MOVE SQLCODE    TO PV-DISPLAY-SQLCODE              10499500
104996               STRING '2520B-CLOSE-PKSL-CNTL-CSR'                 10499600
104997                  ' - SQLCODE: '                                  10499700
104998                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      10499800
104999                                            INTO LE-MSG           10499900
105000               EXEC CICS                                          10500000
105001                    WRITEQ TD                                     10500100
105002                     QUEUE  ('CSSL')                              10500200
105003                      FROM  (LE-STATUS-MESSAGE)                   10500300
105004                    LENGTH  (PV-COMMAREA-LENGTH)                  10500400
105005                      RESP  (PV-CICS-RESPONSE)                    10500500
105006               END-EXEC                                           10500600
105007                                                                  10500700
105008               PERFORM 9000-DISPLAY-SQL-ERROR                     10500800
105009     END-EVALUATE.                                                10500900
105010                                                                  10501000
105011     IF  PS-PARA-LOGGING-YES                                      10501100
105012         MOVE SPACES  TO  PV-TRACKING-DATA                        10501200
105013         PERFORM 9005-DISPLAY-TRACKING                            10501300
105014     END-IF.                                                      10501400
105015                                                                  10501500
105016                                                                  10501600
105017******************************************************************10501700
105018* WFT_LOD_XFER PROCESSING                                        *10501800
105019******************************************************************10501900
105020 3000-XFER-PROCESSING.                                            10502000
105030                                                                  10503000
105040     IF  PS-PARA-LOGGING-YES                                      10504000
105050         MOVE SPACES  TO  PV-TRACKING-DATA                        10505000
105060         STRING '3000-XFER-PROCESSING'    DELIMITED BY SIZE       10506000
105070                                      INTO PV-TRACKING-DATA       10507000
105080         PERFORM 9005-DISPLAY-TRACKING                            10508000
105090     END-IF.                                                      10509000
105100                                                                  10510000
105200     PERFORM 4010-FETCH-XFER-CSR.                                 10520000
105300                                                                  10530000
105400     IF PS-END-OF-XFER-CSR-N                                      10540000
105500         PERFORM 4100-PROCESS.                                    10550000
105600                                                                  10560000
105700******************************************************************10570000
105800* PKSLIP CREATE / ASN PROCESSED WFT_LOD_XFER PROCESSING           10580000
105810******************************************************************10581000
105820 3000B-PKSL-XFER-PROCESSING.                                      10582000
105830                                                                  10583000
105840     IF  PS-PARA-LOGGING-YES                                      10584000
105841         MOVE SPACES  TO  PV-TRACKING-DATA                        10584100
105842         STRING '3000B-PKSL-XFER-PROCESSING'                      10584200
105843                                           DELIMITED BY SIZE      10584300
105844                                      INTO PV-TRACKING-DATA       10584400
105845         PERFORM 9005-DISPLAY-TRACKING                            10584500
105846     END-IF.                                                      10584600
105847                                                                  10584700
105848     PERFORM 4010B-FETCH-PKSL-XFER-CSR.                           10584800
105849                                                                  10584900
105850     IF PS-END-OF-PKSL-XFER-CSR-N                                 10585000
105860         PERFORM 4100B-PROCESS-PKSL-ASN.                          10586000
105870                                                                  10587000
105880******************************************************************10588000
105890*     4000-OPEN-XFER-CSR                                         *10589000
105900******************************************************************10590000
106000 4000-OPEN-XFER-CSR.                                              10600000
106100                                                                  10610000
106200     IF  PS-PARA-LOGGING-YES                                      10620000
106210         MOVE SPACES  TO  PV-TRACKING-DATA                        10621000
106220         STRING '4000-OPEN-XFER-CSR        '                      10622000
106230                                           DELIMITED BY SIZE      10623000
106240                                      INTO PV-TRACKING-DATA       10624000
106250         PERFORM 9005-DISPLAY-TRACKING                            10625000
106260     END-IF.                                                      10626000
106270                                                                  10627000
106280     EXEC SQL                                                     10628000
106290          OPEN XFER-CSR                                           10629000
106300     END-EXEC.                                                    10630000
106400                                                                  10640000
106500     EVALUATE TRUE                                                10650000
106600         WHEN SQLCODE = +0                                        10660000
106700             CONTINUE                                             10670000
106800                                                                  10680000
106900         WHEN OTHER                                               10690000
107000               STRING '4000-OPEN-XFER-CSR'                        10700000
107100                  ' - SQLCODE: '                                  10710000
107200                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      10720000
107300                                            INTO LE-MSG           10730000
107400               EXEC CICS                                          10740000
107500                    WRITEQ TD                                     10750000
107600                     QUEUE  ('CSSL')                              10760000
107700                      FROM  (LE-STATUS-MESSAGE)                   10770000
107800                    LENGTH  (PV-COMMAREA-LENGTH)                  10780000
107810                      RESP  (PV-CICS-RESPONSE)                    10781000
107820               END-EXEC                                           10782000
107830                                                                  10783000
107840               PERFORM 9000-DISPLAY-SQL-ERROR                     10784000
107850     END-EVALUATE.                                                10785000
107860                                                                  10786000
107870******************************************************************10787000
107880* OPEN PACKSLIP CREATE / ASN PROCESSED XFER CURSOR               *10788000
107890* ADDED - 11/15/2018                                             *10789000
107900******************************************************************10790000
108000 4000B-OPEN-PKSL-XFER-CSR.                                        10800000
108100                                                                  10810000
108110     IF  PS-PARA-LOGGING-YES                                      10811000
108120         MOVE SPACES  TO  PV-TRACKING-DATA                        10812000
108130         STRING '4000B-OPEN-PKSL-XFER-CSR  '                      10813000
108140                                           DELIMITED BY SIZE      10814000
108141                                      INTO PV-TRACKING-DATA       10814100
108142         PERFORM 9005-DISPLAY-TRACKING                            10814200
108143     END-IF.                                                      10814300
108144                                                                  10814400
108145     EXEC SQL                                                     10814500
108146          OPEN PKSL-ASN-XFER-CSR                                  10814600
108147     END-EXEC.                                                    10814700
108148                                                                  10814800
108149     EVALUATE TRUE                                                10814900
108150         WHEN SQLCODE = +0                                        10815000
108160             CONTINUE                                             10816000
108170                                                                  10817000
108180         WHEN OTHER                                               10818000
108190               STRING '4000B-OPEN-PKSL-XFER-CSR'                  10819000
108191                  ' - SQLCODE: '                                  10819100
108192                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      10819200
108193                                            INTO LE-MSG           10819300
108194               EXEC CICS                                          10819400
108195                    WRITEQ TD                                     10819500
108196                     QUEUE  ('CSSL')                              10819600
108197                      FROM  (LE-STATUS-MESSAGE)                   10819700
108198                    LENGTH  (PV-COMMAREA-LENGTH)                  10819800
108199                      RESP  (PV-CICS-RESPONSE)                    10819900
108200               END-EXEC                                           10820000
108201                                                                  10820100
108202               PERFORM 9000-DISPLAY-SQL-ERROR                     10820200
108203     END-EVALUATE.                                                10820300
108204                                                                  10820400
108205                                                                  10820500
108206******************************************************************10820600
108207*     4010-FETCH-XFER-CSR                                        *10820700
108208******************************************************************10820800
108209 4010-FETCH-XFER-CSR.                                             10820900
108210                                                                  10821000
108220     IF  PS-PARA-LOGGING-YES                                      10822000
108230         MOVE SPACES  TO  PV-TRACKING-DATA                        10823000
108240         PERFORM 9005-DISPLAY-TRACKING                            10824000
108250                                                                  10825000
108260         MOVE SPACES  TO  PV-TRACKING-DATA                        10826000
108270         STRING '4010-FETCH-XFER-CSR       '                      10827000
108280                                           DELIMITED BY SIZE      10828000
108290                                      INTO PV-TRACKING-DATA       10829000
108300         PERFORM 9005-DISPLAY-TRACKING                            10830000
108400     END-IF.                                                      10840000
108500                                                                  10850000
108600      EXEC SQL                                                    10860000
108700           FETCH  XFER-CSR                                        10870000
108800            INTO  :WFT00002-PRC-CNTL-TMST                         10880000
108900                , :WFT00002-LOD-DAT-TXT                           10890000
109000                , :WFT00002-BTCH-LOD-SEQ-ID                       10900000
109100                , :WFT00002-TRN-TYP-CDE                           10910000
109200     END-EXEC.                                                    10920000
109300                                                                  10930000
109400     EVALUATE TRUE                                                10940000
109500         WHEN SQLCODE = +0                                        10950000
109600              MOVE  WFT00002-LOD-DAT-TXT-TEXT                     10960000
109700                TO  RD024-RECEIPT-ADJUSTMENT-REC                  10970000
109800                                                                  10980000
109900         WHEN SQLCODE = +100                                      10990000
110000             SET PS-END-OF-XFER-CSR-Y  TO  TRUE                   11000000
110100         WHEN OTHER                                               11010000
110200               STRING '4010-FETCH-XFER-CSR'                       11020000
110300                  ' - SQLCODE: '                                  11030000
110400                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      11040000
110500                                            INTO LE-MSG           11050000
110600               EXEC CICS                                          11060000
110700                    WRITEQ TD                                     11070000
110800                     QUEUE  ('CSSL')                              11080000
110810                      FROM  (LE-STATUS-MESSAGE)                   11081000
110820                    LENGTH  (PV-COMMAREA-LENGTH)                  11082000
110830                      RESP  (PV-CICS-RESPONSE)                    11083000
110840               END-EXEC                                           11084000
110850                                                                  11085000
110860               PERFORM 9000-DISPLAY-SQL-ERROR                     11086000
110870     END-EVALUATE.                                                11087000
110880                                                                  11088000
110890     IF  PS-PARA-LOGGING-YES                                      11089000
110900         MOVE SPACES  TO  PV-TRACKING-DATA                        11090000
111000         MOVE WFT00002-BTCH-LOD-SEQ-ID                            11100000
111010           TO PV-DISP-BTCH-LOD-SEQ-ID                             11101000
111020         STRING '4010-FETCH-XFER-CSR       '                      11102000
111030                ' - WFT00002-PRC-CNTL-TMST:'                      11103000
111040                    WFT00002-PRC-CNTL-TMST                        11104000
111041                ' - WFT00002-LOD-DAT-TXT:'                        11104100
111042                    WFT00002-LOD-DAT-TXT                          11104200
111043                ' - WFT00002-BTCH-LOD-SEQ-ID:'                    11104300
111044                    PV-DISP-BTCH-LOD-SEQ-ID                       11104400
111045                ' - WFT00002-TRN-TYP-CDE:'                        11104500
111046                    WFT00002-TRN-TYP-CDE                          11104600
111047                                           DELIMITED BY SIZE      11104700
111048                                      INTO PV-TRACKING-DATA       11104800
111049         PERFORM 9005-DISPLAY-TRACKING                            11104900
111050     END-IF.                                                      11105000
111060                                                                  11106000
111070                                                                  11107000
111080******************************************************************11108000
111090* FETCH PACKSLIP CREATE / ASN PROCESSED XFER                     *11109000
111100* ADDED - 11/15/2018                                             *11110000
111110******************************************************************11111000
111120 4010B-FETCH-PKSL-XFER-CSR.                                       11112000
111130                                                                  11113000
111140     IF  PS-PARA-LOGGING-YES                                      11114000
111141         MOVE SPACES  TO  PV-TRACKING-DATA                        11114100
111142         PERFORM 9005-DISPLAY-TRACKING                            11114200
111143                                                                  11114300
111144         MOVE SPACES  TO  PV-TRACKING-DATA                        11114400
111145         STRING '4010B-FETCH-PKSL-XFER-CSR '                      11114500
111146                                           DELIMITED BY SIZE      11114600
111147                                      INTO PV-TRACKING-DATA       11114700
111148         PERFORM 9005-DISPLAY-TRACKING                            11114800
111149     END-IF.                                                      11114900
111150                                                                  11115000
111160      EXEC SQL                                                    11116000
111170           FETCH  PKSL-ASN-XFER-CSR                               11117000
111180            INTO  :WFT00002-PRC-CNTL-TMST                         11118000
111190                , :WFT00002-LOD-DAT-TXT                           11119000
111191                , :WFT00002-BTCH-LOD-SEQ-ID                       11119100
111192                , :WFT00002-TRN-TYP-CDE                           11119200
111193     END-EXEC.                                                    11119300
111194                                                                  11119400
111195     EVALUATE TRUE                                                11119500
111196         WHEN SQLCODE = +0                                        11119600
111197              MOVE  WFT00002-LOD-DAT-TXT-TEXT (10:50)             11119700
111198                TO  PV-MESSAGE                                    11119800
111199                                                                  11119900
111200         WHEN SQLCODE = +100                                      11120000
111201             SET PS-END-OF-PKSL-XFER-CSR-Y TO TRUE                11120100
111202         WHEN OTHER                                               11120200
111203               STRING '4010B-FETCH-PKSL-XFER-CSR'                 11120300
111204                  ' - SQLCODE: '                                  11120400
111205                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      11120500
111206                                            INTO LE-MSG           11120600
111207               EXEC CICS                                          11120700
111208                    WRITEQ TD                                     11120800
111209                     QUEUE  ('CSSL')                              11120900
111210                      FROM  (LE-STATUS-MESSAGE)                   11121000
111211                    LENGTH  (PV-COMMAREA-LENGTH)                  11121100
111212                      RESP  (PV-CICS-RESPONSE)                    11121200
111213               END-EXEC                                           11121300
111214                                                                  11121400
111215               PERFORM 9000-DISPLAY-SQL-ERROR                     11121500
111216     END-EVALUATE.                                                11121600
111217                                                                  11121700
111218     IF  PS-PARA-LOGGING-YES                                      11121800
111219         MOVE SPACES  TO  PV-TRACKING-DATA                        11121900
111220         MOVE WFT00002-BTCH-LOD-SEQ-ID                            11122000
111221           TO PV-DISP-BTCH-LOD-SEQ-ID                             11122100
111222         STRING '4010B-FETCH-PKSL-XFER-CSR '                      11122200
111223                ' - WFT00002-PRC-CNTL-TMST:'                      11122300
111224                    WFT00002-PRC-CNTL-TMST                        11122400
111225                ' - WFT00002-LOD-DAT-TXT:'                        11122500
111226                    WFT00002-LOD-DAT-TXT                          11122600
111227                ' - WFT00002-BTCH-LOD-SEQ-ID:'                    11122700
111228                    PV-DISP-BTCH-LOD-SEQ-ID                       11122800
111229                ' - WFT00002-TRN-TYP-CDE:'                        11122900
111230                    WFT00002-TRN-TYP-CDE                          11123000
111231                ' - PV-MESSAGE :'                                 11123100
111232                    PV-MESSAGE                                    11123200
111233                ':END'                                            11123300
111234                                           DELIMITED BY SIZE      11123400
111235                                      INTO PV-TRACKING-DATA       11123500
111236         PERFORM 9005-DISPLAY-TRACKING                            11123600
111237     END-IF.                                                      11123700
111238                                                                  11123800
111239                                                                  11123900
111240******************************************************************11124000
111250*     4020-CLOSE-XFER-CSR                                        *11125000
111260******************************************************************11126000
111270 4020-CLOSE-XFER-CSR.                                             11127000
111280                                                                  11128000
111290     IF  PS-PARA-LOGGING-YES                                      11129000
111300         MOVE SPACES  TO  PV-TRACKING-DATA                        11130000
111400         STRING '4020-CLOSE-XFER-CSR       '                      11140000
111500                                           DELIMITED BY SIZE      11150000
111510                                      INTO PV-TRACKING-DATA       11151000
111520         PERFORM 9005-DISPLAY-TRACKING                            11152000
111530     END-IF.                                                      11153000
111540                                                                  11154000
111550     EXEC SQL                                                     11155000
111560          CLOSE XFER-CSR                                          11156000
111570     END-EXEC.                                                    11157000
111580                                                                  11158000
111590     EVALUATE TRUE                                                11159000
111600         WHEN SQLCODE = +0                                        11160000
111700             CONTINUE                                             11170000
111800                                                                  11180000
111900         WHEN OTHER                                               11190000
112000               STRING '4020-CLOSE-XFER-CSR'                       11200000
112100                  ' - SQLCODE: '                                  11210000
112200                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      11220000
112300                                            INTO LE-MSG           11230000
112400               EXEC CICS                                          11240000
112500                    WRITEQ TD                                     11250000
112600                     QUEUE  ('CSSL')                              11260000
112700                      FROM  (LE-STATUS-MESSAGE)                   11270000
112800                    LENGTH  (PV-COMMAREA-LENGTH)                  11280000
112900                      RESP  (PV-CICS-RESPONSE)                    11290000
113000               END-EXEC                                           11300000
113100                                                                  11310000
113200               PERFORM 9000-DISPLAY-SQL-ERROR                     11320000
113300     END-EVALUATE.                                                11330000
113400                                                                  11340000
113410******************************************************************11341000
113420* CLOSE PKSLIP CREATE / ASN PROCESSED XFER CURSOR                *11342000
113421* ADDED 11/15/2018                                               *11342100
113422******************************************************************11342200
113423 4020B-CLOSE-PKSL-XFER-CSR.                                       11342300
113424                                                                  11342400
113425     IF  PS-PARA-LOGGING-YES                                      11342500
113426         MOVE SPACES  TO  PV-TRACKING-DATA                        11342600
113427         STRING '4020B-CLOSE-PKSL-XFER-CSR '                      11342700
113428                                           DELIMITED BY SIZE      11342800
113429                                      INTO PV-TRACKING-DATA       11342900
113430         PERFORM 9005-DISPLAY-TRACKING                            11343000
113440     END-IF.                                                      11344000
113450                                                                  11345000
113460     EXEC SQL                                                     11346000
113470          CLOSE PKSL-ASN-XFER-CSR                                 11347000
113480     END-EXEC.                                                    11348000
113490                                                                  11349000
113491     EVALUATE TRUE                                                11349100
113492         WHEN SQLCODE = +0                                        11349200
113493             CONTINUE                                             11349300
113494                                                                  11349400
113495         WHEN OTHER                                               11349500
113496               STRING '4020B-CLOSE-PKSL-XFER-CSR'                 11349600
113497                  ' - SQLCODE: '                                  11349700
113498                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      11349800
113499                                            INTO LE-MSG           11349900
113500               EXEC CICS                                          11350000
113501                    WRITEQ TD                                     11350100
113502                     QUEUE  ('CSSL')                              11350200
113503                      FROM  (LE-STATUS-MESSAGE)                   11350300
113504                    LENGTH  (PV-COMMAREA-LENGTH)                  11350400
113505                      RESP  (PV-CICS-RESPONSE)                    11350500
113506               END-EXEC                                           11350600
113507                                                                  11350700
113508               PERFORM 9000-DISPLAY-SQL-ERROR                     11350800
113509     END-EVALUATE.                                                11350900
113510                                                                  11351000
113520******************************************************************11352000
113530*                                                                *11353000
113540******************************************************************11354000
113550 4100-PROCESS.                                                    11355000
113560                                                                  11356000
113570     IF  PS-PARA-LOGGING-YES                                      11357000
113580         MOVE SPACES  TO  PV-TRACKING-DATA                        11358000
113590         STRING '4100-PROCESS  '                                  11359000
113600                ' - WFT00002-TRN-TYP-CDE:'                        11360000
113700                    WFT00002-TRN-TYP-CDE                          11370000
113800                                           DELIMITED BY SIZE      11380000
113810                                      INTO PV-TRACKING-DATA       11381000
113820         PERFORM 9005-DISPLAY-TRACKING                            11382000
113830     END-IF.                                                      11383000
113840                                                                  11384000
113850     IF  WFT00002-BTCH-LOD-SEQ-ID  =  1                           11385000
113860         SET RD025-IDX TO 1                                       11386000
113870                                                                  11387000
113880*** MOVE HEADER DATA TO MQ LAYOUT                                 11388000
113890                                                                  11389000
113900         IF  WFT00002-TRN-TYP-CDE  =  'PCKVER'                    11390000
114000             MOVE 'PACKVERIFY'         TO  RD025-MSG-ID           11400000
114100         ELSE                                                     11410000
114200         IF  WFT00002-TRN-TYP-CDE  =  'PCKADJ'                    11420000
114300             MOVE 'PACKADJUST'         TO  RD025-MSG-ID           11430000
114400         ELSE                                                     11440000
114500         IF  WFT00002-TRN-TYP-CDE  =  'SKUVER'                    11450000
114600             MOVE 'SKUVERIFY '         TO  RD025-MSG-ID           11460000
114700         ELSE                                                     11470000
114800         IF  WFT00002-TRN-TYP-CDE  =  'SKUADJ'                    11480000
114900             MOVE 'SKUADJUST '         TO  RD025-MSG-ID           11490000
115000         END-IF                                                   11500000
115100         END-IF                                                   11510000
115200         END-IF                                                   11520000
115300         END-IF                                                   11530000
115400                                                                  11540000
115500         MOVE  RD024-ORDER-NUMBER      TO  RD025-PO-NBR           11550000
115600         MOVE  RD024-ORDER-NUMBER      TO  RD025-ORD-NBR          11560000
115700         MOVE  'R'                     TO  RD025-MSG-TYPE         11570000
115800         MOVE  SPACES                  TO  RD025-LAST-UPD-TMST    11580000
115900         MOVE  SPACES                  TO  RD025-LAST-UPD-ID      11590000
116000         MOVE  WFT00002-PRC-CNTL-TMST  TO  RD025-SRCE-TMST        11600000
116100         MOVE  RD024-RCVR-ID           TO  RD025-RCVR-ID          11610000
116200         MOVE  RD024-DC                TO  RD025-DC               11620000
116300         MOVE  RD024-SKU               TO  RD025-SKU              11630000
116400         MOVE  RD024-VRFY-DATE         TO  RD025-VRFY-DATE        11640000
116500         MOVE  SPACES                  TO  RD025-FILLER           11650000
116600                                                                  11660000
116700         PERFORM 4110-POPULATE-STORE-DATA                         11670000
116800                 VARYING RD024-IDX FROM 1 BY 1                    11680000
116900                   UNTIL RD024-IDX >  RD024-STORE-COUNT           11690000
117000                                                                  11700000
117100         COMPUTE RD025-STORE-COUNT                                11710000
117200               = RD025-STORE-COUNT                                11720000
117300               + RD024-STORE-COUNT                                11730000
117400         END-COMPUTE                                              11740000
117500                                                                  11750000
117600     ELSE                                                         11760000
117700                                                                  11770000
117800         PERFORM 4110-POPULATE-STORE-DATA                         11780000
117900                 VARYING RD024-IDX FROM 1 BY 1                    11790000
118000                   UNTIL RD024-IDX >  RD024-STORE-COUNT           11800000
118100                                                                  11810000
118200         COMPUTE RD025-STORE-COUNT                                11820000
118300               = RD025-STORE-COUNT                                11830000
118400               + RD024-STORE-COUNT                                11840000
118500         END-COMPUTE                                              11850000
118600                                                                  11860000
118700     END-IF.                                                      11870000
118800                                                                  11880000
118900******************************************************************11890000
119000* ADDED - 11/15/2018                                             *11900000
119100******************************************************************11910000
119200 4100B-PROCESS-PKSL-ASN.                                          11920000
119300                                                                  11930000
119400     IF  PS-PARA-LOGGING-YES                                      11940000
119410         MOVE SPACES  TO  PV-TRACKING-DATA                        11941000
119420         STRING '4100B-PROCESS-PKSL-ASN    '                      11942000
119430                ' - WFT00002-TRN-TYP-CDE:'                        11943000
119440                    WFT00002-TRN-TYP-CDE                          11944000
119450                                           DELIMITED BY SIZE      11945000
119451                                      INTO PV-TRACKING-DATA       11945100
119452         PERFORM 9005-DISPLAY-TRACKING                            11945200
119453     END-IF.                                                      11945300
119454                                                                  11945400
119455* IF PACK SKU < 0 DON'T SEND                                      11945500
119456* IF PACK SKU = 0 THIS IS PO RECEIPT NOTIFICATION. THIS IS V      11945600
119457                                                                  11945700
119458     MOVE WFT00002-LOD-DAT-TXT-TEXT(52:8) TO                      11945800
119459        DP010I-UNEDITED-FIELD                                     11945900
119460     MOVE 8 TO DP010I-MAXIMUM-DIGITS                              11946000
119470     MOVE ZERO TO DP010I-MAXIMUM-DECIMALS                         11947000
119480     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      11948000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             11949102
263627          USING DP010I-NUMERIC-EDIT-AREA                          11949202
119500     IF DP010I-ERROR-DETECTED                                     11950000
119510        CONTINUE                                                  11951000
119520     ELSE                                                         11952000
119530        IF DP010I-NUMERIC-FIELD < 0                               11953000
119540           DISPLAY 'MQPUT BYPASSED '                              11954000
119541                       WFT00002-LOD-DAT-TXT-TEXT(1:60)            11954100
119542        ELSE                                                      11954200
119543           IF WFT00002-TRN-TYP-CDE  =  'ASNPCK' OR 'PSLPCK'       11954300
119544              PERFORM 5000B-PKSL-MQ-PUT-TO-QUEUE                  11954400
119545           END-IF                                                 11954500
119546        END-IF                                                    11954600
119547     END-IF                                                       11954700
119548                                                                  11954800
119549     PERFORM 4200B-UPDATE-PKSL-COMPLETED.                         11954900
119550                                                                  11955000
119551     PERFORM 4010B-FETCH-PKSL-XFER-CSR.                           11955100
119552                                                                  11955200
119553                                                                  11955300
119554******************************************************************11955400
119555*     4110-POPULATE-STORE-DATA                                   *11955500
119556******************************************************************11955600
119557 4110-POPULATE-STORE-DATA.                                        11955700
119558                                                                  11955800
119559     IF  PS-PARA-LOGGING-YES                                      11955900
119560         MOVE SPACES  TO  PV-TRACKING-DATA                        11956000
119570         STRING '4110-POPULATE-STORE-DATA  '                      11957000
119580                                           DELIMITED BY SIZE      11958000
119590                                      INTO PV-TRACKING-DATA       11959000
119600         PERFORM 9005-DISPLAY-TRACKING                            11960000
119700     END-IF.                                                      11970000
119800                                                                  11980000
119900      MOVE  RD024-STORE(RD024-IDX)                                11990000
120000        TO  RD025-STORE(RD025-IDX).                               12000000
120100                                                                  12010000
120200      MOVE  RD024-STORE-QTY(RD024-IDX)                            12020000
120300        TO  RD025-STORE-QTY(RD025-IDX).                           12030000
120400                                                                  12040000
120500      MOVE  RD024-STORE-QTY-SIGN(RD024-IDX)                       12050000
120600        TO  RD025-STORE-QTY-SIGN(RD025-IDX).                      12060000
120700                                                                  12070000
120800      SET RD025-IDX UP BY 1.                                      12080000
120900                                                                  12090000
121000******************************************************************12100000
121100*     4110-POPULATE-STORE-DATA                                   *12110000
121200******************************************************************12120000
121300 4200-UPDATE-COMPLETED.                                           12130000
121400                                                                  12140000
121410     IF  PS-PARA-LOGGING-YES                                      12141000
121420         MOVE SPACES  TO  PV-TRACKING-DATA                        12142000
121421         PERFORM 9005-DISPLAY-TRACKING                            12142100
121422                                                                  12142200
121423         MOVE SPACES  TO  PV-TRACKING-DATA                        12142300
121424         STRING '4200-UPDATE-COMPLETED  '                         12142400
121425                ' - WFT00001-PRC-CNTL-TMST:'                      12142500
121426                  WFT00001-PRC-CNTL-TMST                          12142600
121427                                           DELIMITED BY SIZE      12142700
121428                                      INTO PV-TRACKING-DATA       12142800
121429         PERFORM 9005-DISPLAY-TRACKING                            12142900
121430     END-IF.                                                      12143000
121440                                                                  12144000
121450      EXEC SQL                                                    12145000
121460           UPDATE  WFT_LOD_CNTL                                   12146000
121470              SET  STAT_CDE       =  'CMPLTD'                     12147000
121480                  ,END_TMST       =  CURRENT TIMESTAMP            12148000
121490                  ,STR_NBR        =  0                            12149000
121500            WHERE  PRC_CNTL_TMST  =  :WFT00001-PRC-CNTL-TMST      12150000
121600     END-EXEC.                                                    12160000
121700                                                                  12170000
121800     EVALUATE TRUE                                                12180000
121900         WHEN SQLCODE = +0                                        12190000
122000              CONTINUE                                            12200000
122100                                                                  12210000
122200         WHEN OTHER                                               12220000
122300               STRING '4200-UPDATE-COMPLETED'                     12230000
122400                  ' - SQLCODE: '                                  12240000
122500                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      12250000
122600                                            INTO LE-MSG           12260000
122700               EXEC CICS                                          12270000
122800                    WRITEQ TD                                     12280000
122900                     QUEUE  ('CSSL')                              12290000
123000                      FROM  (LE-STATUS-MESSAGE)                   12300000
123100                    LENGTH  (PV-COMMAREA-LENGTH)                  12310000
123200                      RESP  (PV-CICS-RESPONSE)                    12320000
123300               END-EXEC                                           12330000
123400                                                                  12340000
123500               PERFORM 9000-DISPLAY-SQL-ERROR                     12350000
123600     END-EVALUATE.                                                12360000
123700                                                                  12370000
123710******************************************************************12371000
123720* PKSLIP CREATE / ASN PROCESSED - UPDATE COMPLETE                *12372000
123721* ADDED - 11/15/2018                                              12372100
123722******************************************************************12372200
123723 4200B-UPDATE-PKSL-COMPLETED.                                     12372300
123724                                                                  12372400
123725     IF  PS-PARA-LOGGING-YES                                      12372500
123726         MOVE SPACES  TO  PV-TRACKING-DATA                        12372600
123727         PERFORM 9005-DISPLAY-TRACKING                            12372700
123728                                                                  12372800
123729         MOVE SPACES  TO  PV-TRACKING-DATA                        12372900
123730         STRING '4200B-UPDATE-PKSL-COMPLETED '                    12373000
123740                ' - WFT00001-PRC-CNTL-TMST:'                      12374000
123741                    WFT00001-PRC-CNTL-TMST                        12374100
123742                                           DELIMITED BY SIZE      12374200
123743                                      INTO PV-TRACKING-DATA       12374300
123744         PERFORM 9005-DISPLAY-TRACKING                            12374400
123745     END-IF.                                                      12374500
123746                                                                  12374600
123747      EXEC SQL                                                    12374700
123748           UPDATE  WFT_LOD_CNTL                                   12374800
123749              SET  STAT_CDE       =  'CMPLTD'                     12374900
123750                  ,END_TMST       =  CURRENT TIMESTAMP            12375000
123760            WHERE  PRC_CNTL_TMST  =  :WFT00001-PRC-CNTL-TMST      12376000
123770     END-EXEC.                                                    12377000
123780                                                                  12378000
123790     EVALUATE TRUE                                                12379000
123791         WHEN SQLCODE = +0                                        12379100
123792              CONTINUE                                            12379200
123793                                                                  12379300
123794         WHEN OTHER                                               12379400
123795               STRING '4200B-UPDATE-PKSL-COMPLETED'               12379500
123796                  ' - SQLCODE: '                                  12379600
123797                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      12379700
123798                                            INTO LE-MSG           12379800
123799               EXEC CICS                                          12379900
123800                    WRITEQ TD                                     12380000
123801                     QUEUE  ('CSSL')                              12380100
123802                      FROM  (LE-STATUS-MESSAGE)                   12380200
123803                    LENGTH  (PV-COMMAREA-LENGTH)                  12380300
123804                      RESP  (PV-CICS-RESPONSE)                    12380400
123805               END-EXEC                                           12380500
123806                                                                  12380600
123807               PERFORM 9000-DISPLAY-SQL-ERROR                     12380700
123808     END-EVALUATE.                                                12380800
123809                                                                  12380900
123810                                                                  12381000
123820******************************************************************12382000
123830*                                                                *12383000
123840*             5 0 0 0 - P U T   M Q   M E S S A G E              *12384000
123850*                                                                *12385000
123860******************************************************************12386000
123870 5000-MQ-PUT-TO-QUEUE.                                            12387000
123880                                                                  12388000
123890     IF  PS-PARA-LOGGING-YES                                      12389000
123900         MOVE SPACES  TO  PV-TRACKING-DATA                        12390000
124000         STRING '5000-MQ-PUT-TO-QUEUE  '                          12400000
124100                ' - QM-TRANS-QUEUE-NAME:'                         12410000
124200                    QM-TRANS-QUEUE-NAME                           12420000
124300                ' - QM-QMGR-NAME-REMOTE:'                         12430000
124310                    QM-QMGR-NAME-REMOTE                           12431000
124320                                           DELIMITED BY SIZE      12432000
124330                                      INTO PV-TRACKING-DATA       12433000
124340         PERFORM 9005-DISPLAY-TRACKING                            12434000
124350     END-IF.                                                      12435000
124360                                                                  12436000
124370* CONTROL CARD 1 - QM-QMGR NAME                                   12437000
124380* CONTROL CARD 2 - QM-TRANS-QUEUE-NAME                            12438000
124390* CONTROL CARD 3 - QM-QMGR-NAME-REMOTE                            12439000
124400**   MOVE 'LOCAL.Q'            TO QM-TRANS-QUEUE-NAME.            12440000
124500**   MOVE 'QKST'               TO QM-QMGR-NAME-REMOTE.            12450000
124600                                                                  12460000
124700     MOVE QM-TRANS-QUEUE-NAME  TO MQOD-OBJECTNAME                 12470000
124800     MOVE QM-QMGR-NAME-REMOTE  TO MQOD-OBJECTQMGRNAME.            12480000
124900     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    12490000
125000                                                                  12500000
125100     COMPUTE MQPMO-OPTIONS = MQPMO-FAIL-IF-QUIESCING              12510000
125200                                   + MQPMO-SYNCPOINT.             12520000
125300                                                                  12530000
125400     MOVE RD025-RECEIPT-ADJUSTMENT-REC TO MQV-MSGBUFFER.          12540000
125500                                                                  12550000
125600     COMPUTE  MQV-MSG-LENGTH                                      12560000
125700           =  151 + (17 * RD025-STORE-COUNT)                      12570000
125800     END-COMPUTE.                                                 12580000
125900                                                                  12590000
126000     CALL MQV-MQPUT USING MQV-HCONN                               12600000
126100                          MQV-LOC-HANDLE                          12610000
126200                          MQM-MESSAGE-DESCRIPTOR                  12620000
126300                          MQM-PUT-MESSAGE-OPTIONS                 12630000
126400                          MQV-MSG-LENGTH                          12640000
126500                          MQV-MSGBUFFER                           12650000
126600                          MQV-COMPLETION-CODE                     12660000
126700                          MQV-REASON.                             12670000
126800                                                                  12680000
126900*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         12690000
127000     IF  MQV-COMPLETION-CODE = MQCC-OK                            12700000
127100         ADD 1 TO PV-TOTAL-MQ-MSGS-SENT                           12710000
127200         MOVE SPACES TO PV-ACTION                                 12720000
127300         STRING 'MQPUT SUCCESSFUL:'                               12730000
127400                 QM-TRANS-QUEUE-NAME                              12740000
127500                 ' '                                              12750000
127600                 PV-TOTAL-MQ-MSGS-SENT DELIMITED BY SIZE          12760000
127700                                       INTO PV-ACTION             12770000
127800         PERFORM 9001-LOGGING-MESSAGE                             12780000
127900     ELSE                                                         12790000
128000         CALL MQV-MQCHECK USING MQV-REASON                        12800000
128100                                MQV-REASON-TEXT                   12810000
128200         STRING 'MQPUT FAILED - ' MQOD-OBJECTQMGRNAME             12820000
128300                 DELIMITED BY SIZE INTO LE-MSG                    12830000
128400               EXEC CICS                                          12840000
128500                    WRITEQ TD                                     12850000
128600                     QUEUE  ('CSSL')                              12860000
128700                      FROM  (LE-STATUS-MESSAGE)                   12870000
128710                    LENGTH  (PV-COMMAREA-LENGTH)                  12871000
128720                      RESP  (PV-CICS-RESPONSE)                    12872000
128730               END-EXEC                                           12873000
128740                                                                  12874000
128750         PERFORM 9000-DISPLAY-SQL-ERROR                           12875000
128760     END-IF.                                                      12876000
128770                                                                  12877000
128780******************************************************************12878000
128790*             5 0 0 0 - P U T   M Q   M E S S A G E              *12879000
128800* PACKSLIP CREATE / ASN PROCESSED MESSAGE                        *12880000
128900* ADDED - 11/15/2018                                             *12890000
129000******************************************************************12900000
129010 5000B-PKSL-MQ-PUT-TO-QUEUE.                                      12901000
129020                                                                  12902000
129030     IF  PS-PARA-LOGGING-YES                                      12903000
129040         MOVE SPACES  TO  PV-TRACKING-DATA                        12904000
129050         STRING '5000B-PKSL-MQ-PUT-TO-QUEUE  '                    12905000
129060                ' - QM-TRANS-QUEUE-NAME:'                         12906000
129061                    QM-TRANS-QUEUE-NAME                           12906100
129062                ' - QM-QMGR-NAME-REMOTE:'                         12906200
129063                    QM-QMGR-NAME-REMOTE                           12906300
129064                ' - PV-MESSAGE:'                                  12906400
129065                    PV-MESSAGE                                    12906500
129066                                           DELIMITED BY SIZE      12906600
129067                                      INTO PV-TRACKING-DATA       12906700
129068         PERFORM 9005-DISPLAY-TRACKING                            12906800
129069     END-IF.                                                      12906900
129070                                                                  12907000
129080* CONTROL CARD 1 - QM-QMGR NAME                                   12908000
129090* CONTROL CARD 2 - QM-TRANS-QUEUE-NAME                            12909000
129091* CONTROL CARD 3 - QM-QMGR-NAME-REMOTE                            12909100
129092**   MOVE 'LOCAL.Q'            TO QM-TRANS-QUEUE-NAME.            12909200
129093**   MOVE 'QKST'               TO QM-QMGR-NAME-REMOTE.            12909300
129094                                                                  12909400
129095     MOVE QM-TRANS-QUEUE-NAME  TO MQOD-OBJECTNAME                 12909500
129096     MOVE QM-QMGR-NAME-REMOTE  TO MQOD-OBJECTQMGRNAME.            12909600
129097     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    12909700
129098                                                                  12909800
129099     COMPUTE MQPMO-OPTIONS = MQPMO-FAIL-IF-QUIESCING              12909900
129100                                   + MQPMO-SYNCPOINT.             12910000
129101                                                                  12910100
129102     MOVE PV-MESSAGE TO MQV-MSGBUFFER.                            12910200
129103                                                                  12910300
129104     MOVE +50 TO MQV-MSG-LENGTH.                                  12910400
129105                                                                  12910500
129106     CALL MQV-MQPUT USING MQV-HCONN                               12910600
129107                          MQV-LOC-HANDLE                          12910700
129108                          MQM-MESSAGE-DESCRIPTOR                  12910800
129109                          MQM-PUT-MESSAGE-OPTIONS                 12910900
129110                          MQV-MSG-LENGTH                          12911000
129111                          MQV-MSGBUFFER                           12911100
129112                          MQV-COMPLETION-CODE                     12911200
129113                          MQV-REASON.                             12911300
129114                                                                  12911400
129115*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         12911500
129116     IF  MQV-COMPLETION-CODE = MQCC-OK                            12911600
129117         ADD 1 TO PV-TOTAL-MQ-MSGS-SENT                           12911700
129118         MOVE SPACES TO PV-ACTION                                 12911800
129119         STRING 'MQPUT SUCCESSFUL:'                               12911900
129120                 QM-TRANS-QUEUE-NAME                              12912000
129121                 ' '                                              12912100
129122                 PV-TOTAL-MQ-MSGS-SENT DELIMITED BY SIZE          12912200
129123                                       INTO PV-ACTION             12912300
129124         PERFORM 9001-LOGGING-MESSAGE                             12912400
129125     ELSE                                                         12912500
129126         CALL MQV-MQCHECK USING MQV-REASON                        12912600
129127                                MQV-REASON-TEXT                   12912700
129128         STRING 'MQPUT FAILED - ' MQOD-OBJECTQMGRNAME             12912800
129129                 DELIMITED BY SIZE INTO LE-MSG                    12912900
129130               EXEC CICS                                          12913000
129131                    WRITEQ TD                                     12913100
129132                     QUEUE  ('CSSL')                              12913200
129133                      FROM  (LE-STATUS-MESSAGE)                   12913300
129134                    LENGTH  (PV-COMMAREA-LENGTH)                  12913400
129135                      RESP  (PV-CICS-RESPONSE)                    12913500
129136               END-EXEC                                           12913600
129137                                                                  12913700
129138         PERFORM 9000-DISPLAY-SQL-ERROR                           12913800
129139     END-IF.                                                      12913900
129140                                                                  12914000
129141 8000-SYNCPOINT.                                                  12914100
129142                                                                  12914200
129143     IF  PS-PARA-LOGGING-YES                                      12914300
129144         MOVE SPACES  TO  PV-TRACKING-DATA                        12914400
129145         STRING '8000-SYNCPOINT              '                    12914500
129146                                           DELIMITED BY SIZE      12914600
129147                                      INTO PV-TRACKING-DATA       12914700
129148         PERFORM 9005-DISPLAY-TRACKING                            12914800
129149     END-IF.                                                      12914900
129150                                                                  12915000
129160     EXEC CICS                                                    12916000
129170         SYNCPOINT                                                12917000
129180     END-EXEC.                                                    12918000
129190                                                                  12919000
129200     EVALUATE TRUE                                                12920000
129300       WHEN EIBRESP = ZERO                                        12930000
129400           CONTINUE                                               12940000
129500                                                                  12950000
129600       WHEN OTHER                                                 12960000
129700           MOVE EIBRESP               TO PV-SQLCODE               12970000
129800           MOVE PV-SQLCODE            TO PV-DISPLAY-SQLCODE       12980000
129900           STRING '8000-SYNCPOINT SYNCPOINT FAILED'               12990000
130000                  ' - SQLCODE: '                                  13000000
130100                  PV-DISPLAY-SQLCODE       DELIMITED BY SIZE      13010000
130200                                            INTO LE-MSG           13020000
130300               EXEC CICS                                          13030000
130400                    WRITEQ TD                                     13040000
130500                     QUEUE  ('CSSL')                              13050000
130600                      FROM  (LE-STATUS-MESSAGE)                   13060000
130700                    LENGTH  (PV-COMMAREA-LENGTH)                  13070000
130800                      RESP  (PV-CICS-RESPONSE)                    13080000
130900               END-EXEC                                           13090000
131000                                                                  13100000
131100           PERFORM 9000-DISPLAY-SQL-ERROR                         13110000
131200     END-EVALUATE.                                                13120000
131300******************************************************************13130000
131400*     9000-DISPLAY-SQL-ERROR                                     *13140000
131500******************************************************************13150000
131600 9000-DISPLAY-SQL-ERROR.                                          13160000
131610                                                                  13161000
131620     IF  PS-PARA-LOGGING-YES                                      13162000
131630         MOVE SPACES  TO  PV-TRACKING-DATA                        13163000
131640         STRING '9000-DISPLAY-SQL-ERROR      '                    13164000
131650                                           DELIMITED BY SIZE      13165000
131660                                      INTO PV-TRACKING-DATA       13166000
131670         PERFORM 9005-DISPLAY-TRACKING                            13167000
131680     END-IF.                                                      13168000
131681                                                                  13168100
131682     MOVE LENGTH OF LE-STATUS-MESSAGE TO PV-COMMAREA-LENGTH       13168200
131683                                                                  13168300
131684     EXEC CICS                                                    13168400
131685            WRITEQ TD                                             13168500
131686            QUEUE  ('CSSL')                                       13168600
131687            FROM  (LE-STATUS-MESSAGE)                             13168700
131688            LENGTH  (PV-COMMAREA-LENGTH)                          13168800
131689            RESP  (PV-CICS-RESPONSE)                              13168900
131690     END-EXEC.                                                    13169000
131700                                                                  13170000
131800     SET  PS-ABEND                 TO TRUE.                       13180000
131900                                                                  13190000
132000******************************************************************13200000
132100*     9001-LOGGING-MESSAGE                                       *13210000
132200******************************************************************13220000
132300 9001-LOGGING-MESSAGE.                                            13230000
132400                                                                  13240000
132500     IF  PS-PARA-LOGGING-YES                                      13250000
132600         MOVE SPACES  TO  PV-TRACKING-DATA                        13260000
132700         STRING '9001-LOGGING-MESSAGE        '                    13270000
132800                                           DELIMITED BY SIZE      13280000
132900                                      INTO PV-TRACKING-DATA       13290000
133000         PERFORM 9005-DISPLAY-TRACKING                            13300000
133010     END-IF.                                                      13301000
133020                                                                  13302000
133030     IF DISPLAY-MQ-DEBUG-MSG                                      13303000
133040                                                                  13304000
133050         EXEC SQL                                                 13305000
133060             SET :PV-CURRENT-DATE = CURRENT DATE                  13306000
133070                ,:PV-CURRENT-TIME = CURRENT TIME                  13307000
133080         END-EXEC                                                 13308000
133090                                                                  13309000
133100         STRING ' ' PV-CURRENT-DATE                               13310000
133200                ' ' PV-CURRENT-TIME                               13320000
133300                ' ' PV-ACTION                                     13330000
133400         DELIMITED BY SIZE INTO LE-MSG                            13340000
133500                                                                  13350000
133600         MOVE LENGTH OF LE-STATUS-MESSAGE TO PV-COMMAREA-LENGTH   13360000
133700               EXEC CICS                                          13370000
133800                    WRITEQ TD                                     13380000
133900                     QUEUE  ('CSSL')                              13390000
134000                      FROM  (LE-STATUS-MESSAGE)                   13400000
134100                    LENGTH  (PV-COMMAREA-LENGTH)                  13410000
134200                      RESP  (PV-CICS-RESPONSE)                    13420000
134300               END-EXEC                                           13430000
134400                                                                  13440000
134500         PERFORM 9000-DISPLAY-SQL-ERROR                           13450000
134600                                                                  13460000
134700         SET  PS-NO-ABEND              TO TRUE                    13470000
134800     END-IF.                                                      13480000
134801                                                                  13480100
134802******************************************************************13480200
134803* DISPLAY TRACKING FOR PROGRAM PROGRESS                          *13480300
134804* ADDED - 11/15/2018                                             *13480400
134805******************************************************************13480500
134806 9005-DISPLAY-TRACKING.                                           13480600
134807                                                                  13480700
134808     STRING     PV-TRACKING-DATA DELIMITED BY SIZE                13480800
134809                            INTO PV-TRACKING-INFO                 13480900
134810                                                                  13481000
134820     MOVE LENGTH OF PV-TRACKING-MSG                               13482000
134830       TO PV-COMMAREA-LENGTH                                      13483000
134840                                                                  13484000
134850     EXEC CICS                                                    13485000
134860            WRITEQ TD                                             13486000
134870            QUEUE  ('CSSL')                                       13487000
134880            FROM   (PV-TRACKING-MSG)                              13488000
134890            LENGTH (PV-COMMAREA-LENGTH)                           13489000
134900            RESP   (PV-CICS-RESPONSE)                             13490000
134901     END-EXEC.                                                    13490100
134902                                                                  13490200
134903                                                                  13490300
134904******************************************************************13490400
134905*     9100-DISPLAY-INFO                                          *13490500
134906******************************************************************13490600
134907 9100-DISPLAY-INFO.                                               13490700
134908                                                                  13490800
134909     IF  PS-PARA-LOGGING-YES                                      13490900
134910         MOVE SPACES  TO  PV-TRACKING-DATA                        13491000
134920         STRING '9100-DISPLAY-INFO           '                    13492000
134930                                           DELIMITED BY SIZE      13493000
134940                                      INTO PV-TRACKING-DATA       13494000
134950         PERFORM 9005-DISPLAY-TRACKING                            13495000
134960     END-IF.                                                      13496000
134970                                                                  13497000
134980     EXEC SQL                                                     13498000
134990         SET :PV-CURRENT-DATE = CURRENT DATE                      13499000
135000            ,:PV-CURRENT-TIME = CURRENT TIME                      13500000
135100     END-EXEC.                                                    13510000
135200                                                                  13520000
135300     STRING 'STATISTICS FOR THIS RUN ON: '                        13530000
135400             PV-CURRENT-DATE                                      13540000
135500         ' ' PV-CURRENT-TIME                                      13550000
135600         ' *TOTAL MQ MSGS SENT* = '                               13560000
135700             PV-TOTAL-MQ-MSGS-SENT     DELIMITED BY SIZE          13570000
135800                                            INTO LE-MSG.          13580000
135900                                                                  13590000
136000     MOVE LENGTH OF LE-STATUS-MESSAGE TO PV-COMMAREA-LENGTH.      13600000
136100                                                                  13610000
136200     EXEC CICS                                                    13620000
136300            WRITEQ TD                                             13630000
136400            QUEUE  ('CSSL')                                       13640000
136500            FROM  (LE-STATUS-MESSAGE)                             13650000
136600            LENGTH  (PV-COMMAREA-LENGTH)                          13660000
136700            RESP  (PV-CICS-RESPONSE)                              13670000
136800     END-EXEC.                                                    13680000
136900                                                                  13690000
137000******************************************************************13700000
137100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *13710000
137200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *13720000
137300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *13730000
137400* FORMAT.                                                        *13740000
137500******************************************************************13750000
137600*    COPY DPPD004.                                                13760000
137700*                                                                 13770000
