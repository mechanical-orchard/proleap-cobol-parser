000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS244.                                         00040001
000500 AUTHOR.        DENISE HAHN                                       00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  AUGUST, 2012                                      00070001
000800 DATE-COMPILED.                                                   00080001
000900*---------------------------------------------------------------* 00090001
001000*    Y234 - DC-INTEGRATION PARM (WST_INTGRTN_TYP)  ADD OR UPDATE  00100001
001100*    THIS PROGRAM WILL PROCESS THE CODE ADD, UPDATE.              00110001
001200*    WHEN THE ASSOCIATE SELECTS F13-ADD, OR F15-UPDATE, FROM      00120001
001300*    THE CRIT SPEC SCREEN (CNKCS243)                              00130001
001500*---------------------------------------------------------------* 00150001
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00151013
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00152013
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00153013
CICS  *-----------------------------------------------------------------00154013
001600 ENVIRONMENT DIVISION.                                            00160001
001700 DATA DIVISION.                                                   00170001
001800                                                                  00180001
001900 WORKING-STORAGE SECTION.                                         00190001
002000                                                                  00200001
002100 01  DK-DB2-KEYS.                                                 00210001
002200     05  DK-PARM-CODE             PIC   X(10)       VALUE SPACES. 00220003
002300                                                                  00230001
002400 01  PC-PROGRAM-CONSTANTS.                                        00240001
002500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'CNKCS244'.  00250001
002600     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'CNK244  '.  00260008
002700     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'CNKM244 '.  00270001
002800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00280001
002900                                              COMP.               00290001
003000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00300001
003100                                              COMP.               00310001
003200     05  PC-INTER-APPL-CODES.                                     00320001
003300         10  PC-INTER-APPL-CRIT-SPEC-UPD  PIC  X(01)  VALUE '1'.  00330001
003400         10  PC-INTER-APPL-CRIT-SPEC-ADD  PIC  X(01)  VALUE '1'.  00340001
003500         10  PC-INTER-APPL-LIST-ADD       PIC  X(01)  VALUE '2'.  00350010
003600         10  PC-INTER-APPL-LIST-UPDATE    PIC  X(01)  VALUE '3'.  00360010
003700     05  PC-D                     PIC  X(01)  VALUE  'D'.         00370001
003800     05  PC-I                     PIC  X(01)  VALUE  'I'.         00380001
003900     05  PC-L                     PIC  X(01)  VALUE  'L'.         00390001
004000     05  PC-N                     PIC  X(01)  VALUE  'N'.         00400001
004100     05  PC-UPDATE                PIC  X(02)  VALUE  'UP'.        00410001
004200     05  PC-SPACE                 PIC  X(03)  VALUE  '   '.       00420001
004300     05  PC-01                    PIC  X(02)  VALUE  '01'.        00430001
004400     05  PC-DC                    PIC  X(02)  VALUE  'DC'.        00440001
004500     05  PC-DS                    PIC  X(02)  VALUE  'DS'.        00450001
004600     05  PC-SH                    PIC  X(02)  VALUE  'SH'.        00460001
004700     05  PC-DEFAULT-TIMESTAMP     PIC  X(26)                      00470001
004800                          VALUE  '9999-09-09-09.09.09.999999'.    00480001
004900                                                                  00490001
005000*----------------------------------------------------------------*00500001
005100*  SYSTEM MESSAGES                                                00510001
005200*----------------------------------------------------------------*00520001
005300*   00005 - INVALID VALUE                                         00530001
005400*   00007 - REQUIRED ENTRY                                        00540001
005500*   00008 - MUST BE NUMERIC                                       00550001
005600*   00034 - ADD SUCCESSFUL                                        00560001
005700*   00045 - INVALID FUNCTION                                      00570001
005800*   00059 - UPDATE(S) SUCCESSFUL                                  00580001
005900*   00069 - TOP OF LIST                                           00590001
006000*   00070 - BOTTOM OF LIST                                        00600001
006100*   00115 - DELETE SUCCESSFUL                                     00610001
006200*   00354 - DELETE PENDING - PRESS PF2 TO CONFIRM                 00620001
006300*   00527 - TYPE CODE DOES NOT EXIST                              00630001
006400*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00640001
006500*   02574 - UPDATE FUNCTION INVALID - DOOR IS CURRENTLY NOT DEFINE00650001
006600*   02575 - STORE ASSIGNMNT FUNCTION ONLY VALID FOR DOOR TYPES SHI00660001
006700*   02576 - UPDATING DOOR DEFINITION - PRESS F2 TO CONFIRM        00670001
006800*   02577 - CANNOT CHANGE DOOR TYPE - DOOR ASSIGNED TO A NON-STORE00680001
006900*   02578 - CANNOT CHANGE DOOR TYPE - DOOR ASSIGNED TO A NON-DC LO00690001
007000*   02579 - CANNOT CHANGE DOOR TYPE-DOOR CURRENTLY ASSIGNED TO A D00700001
007010*   02612 - YOU DO NOT HAVE AUTHORITY TO UPDATE                   00701001
007020*   02620 - DOORS SHARING SAME CONVEYOR DIVERT CANNOT HAVE SAME ST00702001
007030*   02936 - SHARED DIVERT & LANE ASSIGNMENT ONLY VALID FOR SHIPPIN00703001
007040*   03264 - LABEL SEQUENCE MUST BE UNIQUE - DOOR &VAR IS THIS SEQU00704001
007050*   03266 - DOOR LABEL SEQUENCE IS ONLY VALID FOR SHIPPING DOORS  00705001
007060*   03267 - SHIPPING DOOR LABEL SEQUENCE MUST BE GREATER THAN 0   00706001
007070*   03707 - ADD FUNCTION INVALID - FUNCTION CODE ALREADY DEFINED  00707001
007080*   03708 - UPDATE FUNCTION INVALID - FUNCTION CODE IS NOT DEFINED00708001
007090*   03709 - ADD FUNCTION INVALID - PARM CODE ALREADY DEFINED      00709001
007100*   03710 - UPDATE FUNCTION INVALID - PARM CODE IS NOT DEFINED    00710001
007200*   03721 - ADD PARM INVALID - CODE IS NOT DEFINED                00720001
007300*   03722 - UPDATE PARM INVALID - CODE IS NOT DEFINED             00730001
007400*   03724 - YOU DO NOT HAVE AUTHORITY TO ADD                      00740001
007500*   05046 - LAND ASSGNMT AND DIVERT LOCATION ID REQUIRED FOR SH   00750001
007600*   99901 - INVALID COMMAND WAS ENTERED                           00760001
007700*----------------------------------------------------------------*00770001
007800     05  PC-TSYMSG-NUMBERS.                                       00780001
007900         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00790001
008000         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00800001
008100         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00810001
008200         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00820001
008300         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00830001
008400         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00840001
008500         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00850001
008600         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00860001
008700         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00870001
008800         10  PC-TSYMSG-00354      PIC  9(05)  VALUE  00354.       00880001
008900         10  PC-TSYMSG-00527      PIC  9(05)  VALUE  00527.       00890001
009000         10  PC-TSYMSG-02571      PIC  9(05)  VALUE  02571.       00900001
009100         10  PC-TSYMSG-02574      PIC  9(05)  VALUE  02574.       00910001
009200         10  PC-TSYMSG-02575      PIC  9(05)  VALUE  02575.       00920001
009300         10  PC-TSYMSG-02576      PIC  9(05)  VALUE  02576.       00930001
009400         10  PC-TSYMSG-02577      PIC  9(05)  VALUE  02577.       00940001
009500         10  PC-TSYMSG-02578      PIC  9(05)  VALUE  02578.       00950001
009600         10  PC-TSYMSG-02579      PIC  9(05)  VALUE  02579.       00960001
009700         10  PC-TSYMSG-02612      PIC  9(05)  VALUE  02612.       00970001
009800         10  PC-TSYMSG-02620      PIC  9(05)  VALUE  02620.       00980001
009900         10  PC-TSYMSG-02936      PIC  9(05)  VALUE  02936.       00990001
010000         10  PC-TSYMSG-02937      PIC  9(05)  VALUE  02937.       01000001
010100         10  PC-TSYMSG-03046      PIC  9(05)  VALUE  03046.       01010001
010200         10  PC-TSYMSG-03264      PIC  9(05)  VALUE  03264.       01020001
010300         10  PC-TSYMSG-03266      PIC  9(05)  VALUE  03266.       01030001
010400         10  PC-TSYMSG-03267      PIC  9(05)  VALUE  03267.       01040001
010500         10  PC-TSYMSG-03707      PIC  9(05)  VALUE  03707.       01050001
010600         10  PC-TSYMSG-03708      PIC  9(05)  VALUE  03708.       01060001
010610         10  PC-TSYMSG-03709      PIC  9(05)  VALUE  03709.       01061001
010620         10  PC-TSYMSG-03710      PIC  9(05)  VALUE  03710.       01062001
010630         10  PC-TSYMSG-03721      PIC  9(05)  VALUE  03721.       01063001
010640         10  PC-TSYMSG-03722      PIC  9(05)  VALUE  03722.       01064001
010650         10  PC-TSYMSG-03724      PIC  9(05)  VALUE  03724.       01065001
010660         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01066001
010670*                                                                 01067001
010680 01  PS-PROGRAM-SWITCHES.                                         01068001
010690     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01069001
010700         88  PS-ERROR                         VALUE  'Y'.         01070001
010800         88  PS-NO-ERROR                      VALUE  'N'.         01080001
010900     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         01090001
011000         88  PS-COMMAREA-VALID                VALUE  'Y'.         01100001
011100         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         01110001
011200     05  PS-LIST-END-SW           PIC  X(01)  VALUE  'N'.         01120001
011300         88  PS-LIST-END                      VALUE  'Y'.         01130001
011400         88  PS-NO-LIST-END                   VALUE  'N'.         01140001
011500     05  PS-STORE-SW              PIC  X(01)  VALUE  'N'.         01150001
011600         88  PS-STORES-EXIST                  VALUE  'Y'.         01160001
011700         88  PS-NO-STORES-EXIST               VALUE  'N'.         01170001
011800     05  PS-DIVERT-SW             PIC  X(01)  VALUE  'N'.         01180001
011900         88  PS-DUP-DIVERT-EXIST              VALUE  'Y'.         01190001
012000         88  PS-NO-DUP-DIVERT-EXIST           VALUE  'N'.         01200001
012100     05  PS-DUPLICATE-STORE-SW    PIC  X(01)  VALUE  'N'.         01210001
012200         88  PS-DUP-STORE-ASGNMT              VALUE  'Y'.         01220001
012300         88  PS-NO-DUP-STORE-ASGNMT           VALUE  'N'.         01230001
012400     05  PS-LBL-SEQ-OPER-EXISTS-SW PIC X(01)  VALUE  'N'.         01240001
012500         88  PS-LBL-SEQ-OPER-EXISTS-YES       VALUE  'Y'.         01250001
012600         88  PS-LBL-SEQ-OPER-EXISTS-NO        VALUE  'N'.         01260001
012700     05  PS-TYPE-CHANGED-SW        PIC X(01)  VALUE  'N'.         01270001
012800         88  PS-TYPE-CHANGED-YES              VALUE  'Y'.         01280001
012900         88  PS-TYPE-CHANGED-NO               VALUE  'N'.         01290001
013000     05  PS-FUNCTION-ALLOWED-SW    PIC X(01)  VALUE  'N'.         01300001
013100         88  PS-FUNCTION-ALLOWED              VALUE  'Y'.         01310001
013200         88  PS-FUNCTION-NOT-ALLOWED         VALUE  'N'.          01320001
013300                                                                  01330001
013400 01  PV-PROGRAM-VARIABLES.                                        01340001
013500     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01350001
013600                                              COMP SYNC.          01360001
013700     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01370001
013800                                              COMP SYNC.          01380001
013900     05  PV-INPUT-SPACE-CNT       PIC S9(04)  VALUE +0            01390001
014000                                              COMP SYNC.          01400001
014100     05  PV-READ-COUNT            PIC S9(09)  VALUE +0            01410001
014200                                              COMP-3.             01420001
014300     05  PV-READ-STORES-COUNT     PIC S9(09)  VALUE +0            01430001
014400                                              COMP-3.             01440001
014500     05  PC-MAX-ITEMS             PIC S9(09)  VALUE +3            01450001
014600                                              COMP-3.             01460001
014700     05  PV-LANE-ASSGN-NUM        PIC  9(09)  VALUE ZEROES.       01470001
014800     05  PV-LABEL-SEQ             PIC S9(04) COMP.                01480001
014900     05  PV-LABEL-SEQ-COUNT       PIC S9(09)  VALUE +0            01490001
015000                                              COMP-3.             01500001
015100******************************************************************01510001
015200*PV-INP VARIABLES HOLD COMMAREA VALUES                            01520001
015300*       ONLY PV-INP VARIABLES READ FROM AND WRITE TO ASC-'S       01530001
015400******************************************************************01540001
015500     05  PV-INP-FUNCTION              PIC  X(01).                 01550001
015600     05  PV-INP-PARM-CODE             PIC  X(10).                 01560009
015700     05  PV-INP-PARM-DESC             PIC  X(50).                 01570009
015800     05  PV-INP-PARM-TYPE             PIC  X(10).                 01580009
015900                                                                  01590001
016000*----------------------------------------------------------------*01600001
016010**  SECURITY SUBROUTINE PARAMETERS                                01601001
016020*----------------------------------------------------------------*01602001
016030     COPY DPWS008.                                                01603001
016040                                                                  01604001
016050                                                                  01605001
016060*---------------------------------------------------------------* 01606001
016070* SELECTON QUEUE LAYOUT                                         * 01607001
016080*---------------------------------------------------------------* 01608001
016090     COPY CNWS024.                                                01609001
016100                                                                  01610001
016200*----------------------------------------------------------------*01620001
016300*    MAP LAYOUT                                                  *01630001
016400*----------------------------------------------------------------*01640001
016500     COPY CNKM244.                                                01650001
016600                                                                  01660001
016700*----------------------------------------------------------------*01670001
016800*    ATTRIBUTE SETTINGS COPYBOOK.                                *01680001
016900*----------------------------------------------------------------*01690001
017000     COPY DPWS015.                                                01700001
017100                                                                  01710001
017200*----------------------------------------------------------------*01720001
017300*    FUNCTION KEYS COPYBOOK                                      *01730001
017400*----------------------------------------------------------------*01740001
017500     COPY DPWS016.                                                01750001
017600                                                                  01760001
017700**--------------------------------------------------------------**01770001
017800** THE CVLLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01780001
017900** SUB-ROUTINE (DPKUT100).                                      **01790001
018000**--------------------------------------------------------------**01800001
018100     COPY DPWS010I.                                               01810001
018200                                                                  01820001
018300**--------------------------------------------------------------**01830001
018400** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*01840001
018500** APPLICATION PROGRAMMING INTERFACE MODULE.                    **01850013
018600**--------------------------------------------------------------**01860001
018700     COPY DPWS030.                                                01870001
CICS       COPY DPWS930.                                                01871013
018800                                                                  01880001
018900**--------------------------------------------------------------**01890001
019000*    STANDARD COMMAREA.                                           01900001
019100**--------------------------------------------------------------**01910001
019200     COPY DPWS020.                                                01920001
019300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01930001
019400                                                                  01940001
019500*---------------------------------------------------------------* 01950001
019600* INTER-APPLICATION COMMAREA.                                     01960001
019700*   CNWS022 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 01970001
019800*             SPEC SCREEN.                                        01980001
019900*   CNWS023 - IS THE INPUT LAYOUT THAT WILL BE PASSED FROM        01990001
020000*             THE LIST SCREEN                                     02000001
020100*---------------------------------------------------------------* 02010001
020200                                                                  02020001
020300         10  INTER-APPL-COMM-AREA PIC X(200).                     02030001
020400     COPY CNWS022.                                                02040001
020500     COPY CNWS023.                                                02050001
020600***************************************************************** 02060001
020700*    SPECIFIC COMMMAREA FOR CNKCS244.                             02070001
020800***************************************************************** 02080001
020900         10  ASC-SPECIFIC-COMMAREA.                               02090001
021000             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            02100001
021100             15  ASC-ACTION-SW          PIC X(03).                02110001
021200                 88  ASC-ADD            VALUE 'ADD'.              02120001
021300                 88  ASC-DELETE         VALUE 'DEL'.              02130001
021400                 88  ASC-UPDATE         VALUE 'UPD'.              02140001
021500             15  ASC-FUNCTION                 PIC  X(02).         02150010
021600                 88  ASC-FUNCTION-NONE             VALUE ' '.     02160001
021700                 88  ASC-ADD-INTGRTN               VALUE 'AI'.    02170010
021800                 88  ASC-UPD-INTGRTN               VALUE 'UI'.    02180010
021900                 88  ASC-ADD-DEFN                  VALUE 'AD'.    02190010
022000                 88  ASC-UPD-DEFN                  VALUE 'UD'.    02200010
022010*                                                                 02201010
022100             15  ASC-OPER-UNT-ID              PIC S9(04) COMP.    02210010
022110             15  ASC-OPER-UNT-NAME            PIC  X(25).         02211010
022120*                                                                 02212010
022130             15  ASC-PARM-NAME                PIC  X(10).         02213010
022200             15  ASC-PARM-DESC                PIC  X(50).         02220003
022300             15  ASC-PARM-FUNC                PIC  X(10).         02230006
023200*                                                                 02320001
023300             15  ASC-USE-SELECTION-QUEUE-IND                      02330001
023400                                           PIC  X(01).            02340001
023500                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02350001
023600             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02360001
023700             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02370001
023800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02380001
023900                                           PIC S9(09)  COMP-3.    02390001
024000             15  ASC-ITEM-SUB                 PIC S9(04)  COMP    02400001
024100                                                          SYNC.   02410001
024200             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02420001
024300             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02430001
024400             15  ASC-TEMP-QUEUE-UPDATE-SW  PIC  X(01).            02440001
024500                 88  ASC-UPDATE-TSQ                   VALUE 'Y'.  02450001
024600                 88  ASC-NO-TSQ-UPDATE                VALUE ' '.  02460001
024700                                                                  02470001
024800             15  ASC-WST00008-INSERTED-SW PIC  X(01).             02480002
024900                 88  ASC-WST00008-INSERTED            VALUE  'Y'. 02490002
025000                 88  ASC-WST00008-NOT-INSERTED        VALUE  'N'. 02500002
025100             15  ASC-WST00008-UPDATED-SW  PIC  X(01).             02510002
025200                 88  ASC-WST00008-UPDATED             VALUE  'Y'. 02520002
025300                 88  ASC-WST00008-NOT-UPDATED         VALUE  'N'. 02530002
025400             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02540001
025500                 88  ASC-ITEMS-LEFT-ON-DB             VALUE 'Y'.  02550001
025600                 88  ASC-NO-ITEMS-LEFT-ON-DB          VALUE 'N'.  02560001
025700             15  ASC-F2-CONFIRM-SW            PIC  X(01).         02570001
025800                 88  ASC-F2-CONFIRM-YES               VALUE 'Y'.  02580001
025900                 88  ASC-F2-CONFIRM-NO                VALUE 'N'.  02590001
026000                                                                  02600001
026100*----------------------------------------------------------------*02610001
026200*    ABEND PROCESSING COPYBOOK.                                  *02620001
026300*----------------------------------------------------------------*02630001
026400     COPY DPWS013.                                                02640001
026500                                                                  02650001
026600*----------------------------------------------------------------*02660001
026700*    DB2 TABLE FOR PARM CODE - WST00008                           02670002
026800*----------------------------------------------------------------*02680001
026900     EXEC SQL                                                     02690001
027000          INCLUDE WST00008                                        02700002
027100     END-EXEC.                                                    02710001
027200                                                                  02720001
027300                                                                  02730001
027400*----------------------------------------------------------------*02740001
027500*    DB2 AREA FOR COMMUNICATIONS                                  02750001
027600*----------------------------------------------------------------*02760001
027700     EXEC SQL                                                     02770001
027800          INCLUDE SQLCA                                           02780001
027900     END-EXEC.                                                    02790001
028000                                                                  02800001
028100*----------------------------------------------------------------*02810001
028200 LINKAGE SECTION.                                                 02820001
028300                                                                  02830001
028400 01  DFHCOMMAREA.                                                 02840001
028500     05  FILLER                         OCCURS  1 TO 4072 TIMES   02850001
028600                                        DEPENDING ON EIBCALEN.    02860001
028700         10  FILLER                     PIC X.                    02870001
028800                                                                  02880001
028900 PROCEDURE DIVISION.                                              02890001
029000***************************************************************** 02900001
029100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02910001
029200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02920001
029300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02930001
029400**                                                             ** 02940001
029500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02950001
029600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02960001
029700***************************************************************** 02970001
029800 0000-MAIN-MODULE.                                                02980001
029900     INITIALIZE DP030-CICS-API-FIELDS.                            02990001
030000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03000001
030100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03010001
030200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03020001
030300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03030001
030400     MOVE LENGTH OF CNK244I        TO DP030-MAP-LENGTH (1).       03040006
030500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03050001
030600     PERFORM 0001-CALL-CICS-ARCH-API.                             03060001
030700                                                                  03070001
030800     PERFORM 1000-CONTROL-PROCESSING                              03080001
030900                                                                  03090001
031000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03100001
031100     PERFORM 0001-CALL-CICS-ARCH-API.                             03110001
031200                                                                  03120001
031300 0001-CALL-CICS-ARCH-API.                                         03130001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03140013
031500                                    DFHCOMMAREA                   03150013
031600                                    DP030-CICS-API-FIELDS         03160013
031700                                    DP020-STANDARD-COMMAREA       03170013
031800                                    CNK244I.                      03180013
031900                                                                  03190001
032000     IF  DP030-RC-CALL-SUCCESSFUL                                 03200001
032100         CONTINUE                                                 03210001
032200     ELSE                                                         03220001
032300         SET DP013-NO-ROLLBACK                                    03230001
032400             DP013-XCTL-DISPLAY-RESTART                           03240001
032500             DP013-CICS-ABEND      TO TRUE                        03250001
032600         MOVE 'BEFORE 0000-MAIN-MODULE'                           03260001
032700                                   TO DP013-PARAGRAPH             03270001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03271013
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03272013
033000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03300001
033100         PERFORM DP013-0000-PROCESS-ABEND                         03310001
033200     END-IF.                                                      03320001
033300*                                                                 03330001
033400*----------------------------------------------------------------*03340001
033500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03350001
033600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03360001
033700*----------------------------------------------------------------*03370001
033800 1000-CONTROL-PROCESSING.                                         03380001
033900                                                                  03390001
034000     EVALUATE TRUE                                                03400001
034100         WHEN DP020-NEXT-ACT-INITIAL                              03410001
034200              INITIALIZE ASC-SPECIFIC-COMMAREA                    03420001
034300              PERFORM 1100-PROCESS-INTER-APPL-COMM                03430001
034400                                                                  03440001
034500              IF  PS-COMMAREA-NOT-VALID                           03450001
034600                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE           03460001
034700              ELSE                                                03470001
034800                  PERFORM 4000-BUILD-INITIAL-PANEL                03480001
034900                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            03490001
035000                  PERFORM 3200-RESET-ATTRIBUTES                   03500001
035100              END-IF                                              03510001
035200                                                                  03520001
035300         WHEN DP020-NEXT-ACT-READ-MAP                             03530001
035400             PERFORM 2000-PROCESS-PANEL                           03540001
035500*F3-END                                                           03550001
035600         WHEN DP020-NEXT-ACT-RETURN                               03560001
035700             PERFORM 4000-BUILD-INITIAL-PANEL                     03570001
035800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03580001
035900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03590001
036000             MOVE -1                   TO APRMNMEL                03600006
036100                                                                  03610001
036200         WHEN OTHER                                               03620001
036300             SET DP013-LOGIC-ABEND TO TRUE                        03630001
036400             SET DP013-NO-ROLLBACK TO TRUE                        03640001
036500             MOVE '1000-CONTROL-PROCESSING'                       03650001
036600                                   TO DP013-PARAGRAPH             03660001
036700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03670001
036800                                   TO DP013-MESSAGE-TEXT(1)       03680001
036900             MOVE DP020-NEXT-APPL-ACTIVITY                        03690001
037000                                   TO DP013-MESSAGE-TEXT(2)       03700001
037100             PERFORM DP013-0000-PROCESS-ABEND                     03710001
037200     END-EVALUATE.                                                03720001
037300*                                                                 03730001
037400******************************************************************03740001
037500** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03750001
037600** INTER-APPLICATION FORMAT CODE.                               **03760001
037700******************************************************************03770001
037800 1100-PROCESS-INTER-APPL-COMM.                                    03780001
037900     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03790001
038000     MOVE DP020-INT-APPL-FORMAT-IND                               03800001
038100                                   TO ASC-INT-APPL-FORMAT-IND.    03810001
038200                                                                  03820001
038300     SET PS-COMMAREA-VALID                                        03830001
038400         ASC-F2-CONFIRM-NO         TO TRUE.                       03840001
038500                                                                  03850001
038600*WHEN COMING FROM CRIT SPEC        (CNKCS243 - F13=ADD PARM)      03860010
038700*WHEN COMING FROM CRIT SPEC        (CNKCS243 - F15=UPD PARM)      03870010
038800*WHEN COMING FROM CODE LIST SCREEN (CNKCS246 - F13=ADD PARM)      03880010
038900                                                                  03890001
039000     EVALUATE ASC-INT-APPL-FORMAT-IND                             03900001
039100         WHEN PC-INTER-APPL-CRIT-SPEC-ADD                         03910001
039200         WHEN PC-INTER-APPL-CRIT-SPEC-UPD                         03920001
039300         WHEN PC-INTER-APPL-LIST-ADD                              03930001
039310             MOVE CN022-FUNCTION          TO ASC-FUNCTION         03931010
039400             MOVE CN022-OPER-UNT-ID       TO ASC-OPER-UNT-ID      03940010
039401             MOVE CN022-OPER-UNT-NAME     TO ASC-OPER-UNT-NAME    03940110
039402             MOVE CN022-PARM-NAME         TO ASC-PARM-NAME        03940210
039403             MOVE CN022-PARM-DESC         TO ASC-PARM-DESC        03940310
039404             MOVE CN022-PARM-FUNC         TO ASC-PARM-FUNC        03940410
039800             IF  ASC-UPD-INTGRTN                                  03980010
039900                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               03990001
040000             END-IF                                               04000001
040100             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   04010001
040200                                                                  04020001
040210*WHEN COMING FROM CODE LIST SCREEN (CNKCS246 - F15=UPD PARM)      04021012
040400         WHEN PC-INTER-APPL-LIST-UPDATE                           04040001
040500           IF CN023-NUMBER-OF-SELECTED-ITEMS > 0                  04050001
040600             SET ASC-USE-SELECTION-QUEUE TO TRUE                  04060001
040700             MOVE CN023-NUMBER-OF-SELECTED-ITEMS                  04070001
040800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS04080001
040900             MOVE CN023-NUMBER-OF-TS-ITEMS                        04090001
041000                                   TO ASC-NUMBER-OF-TS-ITEMS      04100001
041100             MOVE CN023-SEL-QUEUE-NAME                            04110001
041200                                   TO ASC-SEL-QUEUE-NAME          04120001
041300             MOVE CN023-FUNCTION         TO ASC-FUNCTION          04130001
041310             MOVE CN023-OPER-UNT-ID      TO ASC-OPER-UNT-ID       04131010
041320             MOVE CN023-OPER-UNT-NAME    TO ASC-OPER-UNT-NAME     04132010
041400             MOVE 'UPD' TO  ASC-ACTION-SW                         04140001
041500             PERFORM 1120-PREPARE-LIST-ENTRY                      04150001
041600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04160001
041700             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   04170001
041800         END-IF                                                   04180001
041900     END-EVALUATE.                                                04190001
042000                                                                  04200001
042100*----------------------------------------------------------------*04210001
042200* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04220001
042300* STORAGE QUEUE PASSED FROM THE LIST.                            *04230001
042400*----------------------------------------------------------------*04240001
042500 1120-PREPARE-LIST-ENTRY.                                         04250001
042600     MOVE CN024-MAX-ITEMS          TO ASC-SEL-SUB.                04260001
042700     MOVE ZERO                     TO ASC-SEL-ITEM.               04270001
042800     PERFORM 1130-GET-NEXT-RECORD.                                04280001
042900                                                                  04290001
043000*---------------------------------------------------------------- 04300001
043100*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*04310001
043200*---------------------------------------------------------------- 04320001
043300 1130-GET-NEXT-RECORD.                                            04330001
043400     ADD +1                        TO ASC-SEL-SUB.                04340001
043500                                                                  04350001
043600     SET ASC-UPDATE-TSQ TO TRUE.                                  04360001
043700                                                                  04370001
043800     IF  ASC-SEL-SUB > CN024-MAX-ITEMS                            04380001
043900         ADD +1                    TO ASC-SEL-ITEM                04390001
044000         MOVE +1                   TO ASC-SEL-SUB                 04400001
044100     END-IF.                                                      04410001
044200                                                                  04420001
044300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04430001
044400         PERFORM 9100-READ-SEL-QUEUE                              04440001
044500         IF  CN024-ITEM (ASC-SEL-SUB) > ZERO                      04450001
044600             MOVE CN024-PARM-NAME(ASC-SEL-SUB)  TO ASC-PARM-NAME  04460007
044700             MOVE CN024-PARM-DESC(ASC-SEL-SUB)  TO ASC-PARM-DESC  04470007
044800             MOVE CN024-PARM-FUNC(ASC-SEL-SUB)  TO ASC-PARM-FUNC  04480007
044900             SET CN024-INQ (ASC-SEL-SUB) TO TRUE                  04490001
045000             PERFORM 9200-REWRITE-SEL-QUEUE                       04500001
045100         ELSE                                                     04510001
045200             SUBTRACT +1 FROM ASC-SEL-SUB                         04520001
045300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04530001
045400             SET DP020-MSG-INFORMATIONAL                          04540001
045500                 PS-LIST-END       TO TRUE                        04550001
045600         END-IF                                                   04560001
045700     ELSE                                                         04570001
045800         SUBTRACT +1 FROM ASC-SEL-ITEM                            04580001
045900         MOVE CN024-MAX-ITEMS      TO ASC-SEL-SUB                 04590001
046000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04600001
046100         SET DP020-MSG-INFORMATIONAL                              04610001
046200                 PS-LIST-END       TO TRUE                        04620001
046300     END-IF.                                                      04630001
046400                                                                  04640001
046500******************************************************************04650001
046600*  GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING         04660001
046700*  PROCESSED.                                                     04670001
046800******************************************************************04680001
046900 1140-GET-PREV-RECORD.                                            04690001
047000     SUBTRACT +1 FROM ASC-SEL-SUB.                                04700001
047100                                                                  04710001
047200     IF  ASC-SEL-SUB < +1                                         04720001
047300         SUBTRACT +1 FROM ASC-SEL-ITEM                            04730001
047400         MOVE CN024-MAX-ITEMS      TO ASC-SEL-SUB                 04740001
047500     END-IF.                                                      04750001
047600                                                                  04760001
047700     IF  ASC-SEL-ITEM > ZERO                                      04770001
047800         PERFORM 9100-READ-SEL-QUEUE                              04780001
047900         IF  CN024-ITEM (ASC-SEL-SUB) > ZERO                      04790001
048000             MOVE CN024-PARM-NAME(ASC-SEL-SUB)  TO ASC-PARM-NAME  04800007
048100             MOVE CN024-PARM-DESC(ASC-SEL-SUB)  TO ASC-PARM-DESC  04810007
048200             MOVE CN024-PARM-FUNC(ASC-SEL-SUB)  TO ASC-PARM-FUNC  04820007
048300         END-IF                                                   04830001
048400                                                                  04840001
048500         SET CN024-INQ (ASC-SEL-SUB) TO TRUE                      04850001
048600         PERFORM 9200-REWRITE-SEL-QUEUE                           04860001
048700     ELSE                                                         04870001
048800         MOVE +1                   TO ASC-SEL-ITEM                04880001
048900                                      ASC-SEL-SUB                 04890001
049000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04900001
049100         SET DP020-MSG-INFORMATIONAL                              04910001
049200             PS-LIST-END             TO TRUE                      04920001
049300     END-IF.                                                      04930001
049400                                                                  04940001
049500*----------------------------------------------------------------*04950001
049600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04960001
049700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04970001
049800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04980001
049900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04990001
050000* FUNCTION KEYS CAN GET THIS FAR.                                *05000001
050100*----------------------------------------------------------------*05010001
050200 2000-PROCESS-PANEL.                                              05020001
050300                                                                  05030001
050400     EVALUATE TRUE                                                05040001
050500                                                                  05050001
050600         WHEN DP020-SRC-AID = DP016-CLEAR                         05060001
050700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05070001
050800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05080001
050900                                                                  05090001
051000*F5 REFRESH -                                                     05100001
051100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05110001
051200              SET  ASC-F2-CONFIRM-NO     TO  TRUE                 05120001
051300              PERFORM 4000-BUILD-INITIAL-PANEL                    05130001
051400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05140001
051500              PERFORM 3200-RESET-ATTRIBUTES                       05150001
051600                                                                  05160001
051700*F20-NEXT SEL                                                     05170001
051800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05180001
051900             MOVE DP020-INT-APPL-FORMAT-IND                       05190001
052000                                      TO ASC-INT-APPL-FORMAT-IND  05200001
052100             IF ASC-INT-APPL-FORMAT-IND = '2'                     05210001
052200               IF  ASC-USE-SELECTION-QUEUE                        05220001
052300                   PERFORM 1130-GET-NEXT-RECORD                   05230001
052400                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05240001
052500                   IF PS-LIST-END                                 05250001
052600                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05260001
052700                       SET PS-NO-LIST-END TO TRUE                 05270001
052800                   ELSE                                           05280001
052900                       PERFORM 4000-BUILD-INITIAL-PANEL           05290001
053000                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05300001
053100                       PERFORM 3200-RESET-ATTRIBUTES              05310001
053200                   END-IF                                         05320001
053300               ELSE                                               05330001
053400*                --- BOTTOM OF LIST ---                           05340001
053500                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER       05350001
053600                   SET DP020-MSG-INFORMATIONAL TO TRUE            05360001
053700               END-IF                                             05370001
053800           ELSE                                                   05380001
053900               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05390001
054000               SET DP020-MSG-FATAL TO TRUE                        05400001
054100           END-IF                                                 05410001
054200                                                                  05420001
054300*F19-PREV SEL                                                     05430001
054400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05440001
054500             MOVE DP020-INT-APPL-FORMAT-IND                       05450001
054600                                      TO ASC-INT-APPL-FORMAT-IND  05460001
054700             IF ASC-INT-APPL-FORMAT-IND = '2'                     05470001
054800                IF  ASC-USE-SELECTION-QUEUE                       05480001
054900                   PERFORM 1140-GET-PREV-RECORD                   05490001
055000                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05500001
055100                   IF PS-LIST-END                                 05510001
055200                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05520001
055300                       SET PS-NO-LIST-END TO TRUE                 05530001
055400                   ELSE                                           05540001
055500                       PERFORM 4000-BUILD-INITIAL-PANEL           05550001
055600                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05560001
055700                       PERFORM 3200-RESET-ATTRIBUTES              05570001
055800                   END-IF                                         05580001
055900               ELSE                                               05590001
056000                   MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER       05600001
056100                   SET DP020-MSG-INFORMATIONAL TO TRUE            05610001
056200               END-IF                                             05620001
056300           ELSE                                                   05630001
056400               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05640001
056500               SET DP020-MSG-FATAL TO TRUE                        05650001
056600           END-IF                                                 05660001
056700                                                                  05670001
056800         WHEN OTHER                                               05680001
056900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05690001
057000             PERFORM 3200-RESET-ATTRIBUTES                        05700001
057100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05710001
057200             IF PS-NO-ERROR                                       05720001
057300                 PERFORM 4500-MOVE-COMMAREA-TO-TEMP               05730001
057400                 PERFORM 2100-CHECK-FUNCTION-KEY                  05740001
057500                 IF PS-NO-ERROR                                   05750001
057600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05760001
057700                     SET DP030-CONTINUE-GO TO TRUE                05770001
057800                 ELSE                                             05780001
057900                     SET DP030-OVERRIDE-GO TO TRUE                05790001
058000                 END-IF                                           05800001
058100             ELSE                                                 05810001
058200                 SET DP030-OVERRIDE-GO TO TRUE                    05820001
058300             END-IF                                               05830001
058400     END-EVALUATE.                                                05840001
058500                                                                  05850001
058600*----------------------------------------------------------------*05860001
058700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05870001
058800* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05880001
058900* FROM THE CICS ARCHITECTURE API.                                *05890001
059000*----------------------------------------------------------------*05900001
059100 2100-CHECK-FUNCTION-KEY.                                         05910001
059200     EVALUATE TRUE                                                05920001
059300         WHEN DP020-SRC-AID = DP016-ENTER                         05930001
059400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05940001
059500                                                                  05950001
059600*-F02 = CONFIRM UPDATE                                            05960001
059700         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID)  AND              05970001
059800              ASC-F2-CONFIRM-YES                                  05980001
059900                 IF  ASC-ACTION-SW = 'UPD'                        05990001
060000                     PERFORM 9100-READ-SEL-QUEUE                  06000001
060100                     SET CN024-UPD (ASC-SEL-SUB) TO TRUE          06010001
060200                     MOVE ASC-PARM-NAME                           06020007
060300                                  TO CN024-PARM-NAME (ASC-SEL-SUB)06030007
060400                     MOVE ASC-PARM-DESC                           06040001
060500                                  TO CN024-PARM-DESC (ASC-SEL-SUB)06050007
060600                     MOVE ASC-PARM-FUNC                           06060007
060700                                 TO CN024-PARM-FUNC (ASC-SEL-SUB) 06070007
060800                     PERFORM 9200-REWRITE-SEL-QUEUE               06080001
060900                 END-IF                                           06090001
061000                                                                  06100001
061100                 IF  PS-NO-ERROR                                  06110001
061200                     PERFORM 5100-PROCESS-UPDATE                  06120001
061300                     IF  PS-NO-ERROR                              06130001
061400                         PERFORM 2110-PREPARE-INTER-APPL-COMM     06140001
061500                     END-IF                                       06150001
061600                 END-IF                                           06160001
061700                                                                  06170001
061800*-F13 = ADD PARM CODE                                             06180001
061900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06190001
061910              SET ASC-ADD-INTGRTN TO TRUE                         06191010
061920              IF  ASC-PARM-NAME  = SPACES                         06192008
061930                  SET PS-ERROR                                    06193001
061940                      DP020-MSG-FATAL         TO TRUE             06194001
061950                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06195001
061960                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA         06196006
061970                  MOVE DP015-RED              TO APRMNMEC         06197006
061980                  MOVE DP015-REVERSE          TO APRMNMEH         06198006
061990                  MOVE -1                     TO APRMNMEL         06199006
062000                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06200001
062100              END-IF                                              06210001
062200                                                                  06220001
062300              IF  ASC-PARM-DESC = SPACES                          06230001
062400                  SET PS-ERROR                                    06240001
062500                      DP020-MSG-FATAL         TO TRUE             06250001
062600                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06260001
062700                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMDSCA         06270008
062800                  MOVE DP015-RED              TO APRMDSCC         06280008
062900                  MOVE DP015-REVERSE          TO APRMDSCH         06290008
063000                  MOVE -1                     TO APRMDSCL         06300008
063100                  MOVE +1                     TO APRMNMEL         06310006
063200                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06320001
063300            END-IF                                                06330001
063400                                                                  06340001
063500            IF  ASC-PARM-FUNC  = SPACES                           06350008
063600                  SET PS-ERROR                                    06360001
063700                      DP020-MSG-FATAL         TO TRUE             06370001
063800                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06380001
063900                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMTYPA         06390008
064000                  MOVE DP015-RED              TO APRMTYPC         06400008
064100                  MOVE DP015-REVERSE          TO APRMTYPH         06410008
064200                  MOVE -1                     TO APRMTYPL         06420008
064300                  MOVE +1                     TO APRMNMEL         06430006
064400                  MOVE +1                     TO APRMDSCL         06440008
064500                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06450001
064600            END-IF                                                06460001
064700                                                                  06470001
064800            SET  PS-FUNCTION-NOT-ALLOWED  TO  TRUE                06480001
064900            MOVE 'CNACODE '              TO DP008-FUNCTION-NAME   06490001
065000            PERFORM 2105-RACF-ACCESS                              06500001
065100            IF  PS-FUNCTION-ALLOWED                               06510001
065200                CONTINUE                                          06520001
065300            ELSE                                                  06530001
065400                SET PS-ERROR                                      06540001
065500                    DP020-MSG-FATAL         TO TRUE               06550001
065510                MOVE PC-TSYMSG-03724        TO DP020-MSG-NUMBER   06551001
065520                MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA           06552006
065530                MOVE DP015-RED              TO APRMNMEC           06553006
065540                MOVE DP015-REVERSE          TO APRMNMEH           06554006
065550                MOVE -1                     TO APRMNMEL           06555006
065560                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06556001
065561            END-IF                                                06556101
065562                                                                  06556201
065563           IF  PS-NO-ERROR                                        06556301
065564               PERFORM 5000-PROCESS-ADD                           06556401
065565               IF  PS-NO-ERROR                                    06556501
065566                   PERFORM 2110-PREPARE-INTER-APPL-COMM           06556601
065567                   MOVE DP015-PRO-NOR-OFF        TO APRMNMEA      06556706
065568                                                    APRMDSCA      06556808
065569                                                    APRMTYPA      06556908
065570                   MOVE DP015-BLUE               TO APRMNMEC      06557006
065580                                                    APRMDSCC      06558008
065590                                                    APRMTYPC      06559008
065600                   MOVE DP015-HL-OFF             TO APRMNMEH      06560006
065700                                                    APRMDSCH      06570008
065800                                                    APRMTYPH      06580008
065900               END-IF                                             06590001
066000           END-IF                                                 06600001
066100                                                                  06610001
066200*-F15 = UPDATE PARM CODE                                          06620001
066300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06630001
066400              SET ASC-UPD-INTGRTN   TO TRUE                       06640010
066500              SET ASC-F2-CONFIRM-NO TO TRUE                       06650001
066600                                                                  06660001
066700              IF  ASC-PARM-NAME  = SPACES                         06670008
066800                  SET PS-ERROR                                    06680001
066900                      DP020-MSG-FATAL         TO TRUE             06690001
067000                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06700001
067100                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA         06710006
067200                  MOVE DP015-RED              TO APRMNMEC         06720006
067300                  MOVE DP015-REVERSE          TO APRMNMEH         06730006
067400                  MOVE -1                     TO APRMNMEL         06740006
067500                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06750001
067600              END-IF                                              06760001
067700                                                                  06770001
067800              IF  ASC-PARM-DESC  =  SPACES                        06780001
067900                  SET PS-ERROR                                    06790001
068000                      DP020-MSG-FATAL         TO TRUE             06800001
068100                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06810001
068200                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMDSCA         06820008
068300                  MOVE DP015-RED              TO APRMDSCC         06830008
068400                  MOVE DP015-REVERSE          TO APRMDSCH         06840008
068500                  MOVE -1                     TO APRMDSCL         06850008
068600                  MOVE +1                     TO APRMNMEL         06860006
068700                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06870001
068800              END-IF                                              06880001
068900                                                                  06890001
069000              IF  ASC-PARM-FUNC  =  SPACES                        06900008
069100                  SET PS-ERROR                                    06910001
069200                      DP020-MSG-FATAL         TO TRUE             06920001
069300                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06930001
069400                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMTYPA         06940008
069500                  MOVE DP015-RED              TO APRMTYPC         06950008
069600                  MOVE DP015-REVERSE          TO APRMTYPH         06960008
069700                  MOVE -1                     TO APRMTYPL         06970008
069800                  MOVE +1                     TO APRMNMEL         06980006
069900                  MOVE +1                     TO APRMDSCL         06990008
070000                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             07000001
070100              END-IF                                              07010001
070200                                                                  07020001
070300            SET  PS-FUNCTION-NOT-ALLOWED  TO  TRUE                07030001
070400            MOVE 'CNUCODE '              TO DP008-FUNCTION-NAME   07040001
070500            PERFORM 2105-RACF-ACCESS                              07050001
070600            IF  PS-FUNCTION-ALLOWED                               07060001
070700                CONTINUE                                          07070001
070800            ELSE                                                  07080001
070900                SET PS-ERROR                                      07090001
071000                    DP020-MSG-FATAL         TO TRUE               07100001
071010                MOVE PC-TSYMSG-02612        TO DP020-MSG-NUMBER   07101001
071020                MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA           07102006
071030                MOVE DP015-RED              TO APRMNMEC           07103006
071040                MOVE DP015-REVERSE          TO APRMNMEH           07104006
071050                MOVE -1                     TO APRMNMEL           07105006
071060                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07106001
071070            END-IF                                                07107001
071080                                                                  07108001
071090                                                                  07109001
071100             IF  PS-NO-ERROR                                      07110001
071200                 SET ASC-F2-CONFIRM-YES      TO TRUE              07120001
071300                 SET PS-ERROR                TO TRUE              07130001
071400                 SET DP020-MSG-FATAL         TO TRUE              07140001
071500                 MOVE PC-TSYMSG-02576        TO DP020-MSG-NUMBER  07150001
071600                 MOVE DP015-PRO-NOR-OFF      TO APRMNMEA          07160006
071700                 MOVE DP015-BLUE             TO APRMNMEC          07170006
071800                 MOVE -1                     TO APRMDSCL          07180008
071900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07190001
072000            END-IF                                                07200001
072100                                                                  07210001
072200*-F17 = ADD PARM -- (CNKCS235)                                    07220001
072300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07230001
072400              SET  ASC-ADD-DEFN TO TRUE                           07240010
072410              PERFORM 3040-CHECK-4-ROW-ON-WST00008                07241003
072420              IF  PS-NO-ERROR                                     07242001
072430                  PERFORM 2110-PREPARE-INTER-APPL-COMM            07243001
072440              END-IF                                              07244001
072450                                                                  07245001
072460*F24  = PARM LIST - (CNKCS237)                                    07246001
072470         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              07247001
072480              SET  ASC-FUNCTION-NONE   TO TRUE                    07248001
072490              IF  ASC-PARM-NAME  =  SPACES                        07249008
072500                  SET PS-ERROR                                    07250001
072600                      DP020-MSG-FATAL         TO TRUE             07260001
072700                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 07270001
072800                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA         07280006
072900                  MOVE DP015-RED              TO APRMNMEC         07290006
073000                  MOVE DP015-REVERSE          TO APRMNMEH         07300006
073100                  MOVE -1                     TO APRMNMEL         07310006
073200                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             07320001
073300              END-IF                                              07330001
073400                                                                  07340001
073500              IF  ASC-PARM-DESC  =  SPACES                        07350001
073600                  SET PS-ERROR                                    07360001
073700                      DP020-MSG-FATAL         TO TRUE             07370001
073800                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 07380001
073900                  MOVE DP015-UNP-ALP-BRT-OFF  TO APRMDSCA         07390008
074000                  MOVE DP015-RED              TO APRMDSCC         07400008
074100                  MOVE DP015-REVERSE          TO APRMDSCH         07410008
074200                  MOVE -1                     TO APRMDSCL         07420008
074300                  MOVE +1                     TO APRMNMEL         07430006
074400                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             07440001
074500              END-IF                                              07450001
074600                                                                  07460001
074700              IF  PS-NO-ERROR                                     07470001
074800                  PERFORM 2110-PREPARE-INTER-APPL-COMM            07480001
074900              END-IF                                              07490001
075000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07500001
075100                                                                  07510001
075200         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID) AND               07520001
075300              ASC-F2-CONFIRM-NO                                   07530001
075400                  MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER        07540001
075500                  SET DP020-MSG-FATAL TO TRUE                     07550001
075600                                                                  07560001
075700         WHEN OTHER                                               07570001
075800              SET DP013-NO-ROLLBACK                               07580001
075900                  DP013-XCTL-DISPLAY-RESTART                      07590001
076000                  DP013-CICS-ABEND      TO TRUE                   07600001
076100              MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH        07610001
076200              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     07620001
076300                                    TO DP013-MESSAGE-TEXT (1)     07630001
076400              PERFORM DP013-0000-PROCESS-ABEND                    07640001
076500                                                                  07650001
076600     END-EVALUATE.                                                07660001
076700                                                                  07670001
076800                                                                  07680001
076900*----------------------------------------------------------------*07690001
077000* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR FUNCTION       *07700001
077100*----------------------------------------------------------------*07710001
077200 2105-RACF-ACCESS.                                                07720001
077300                                                                  07730001
077400      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  07740001
077500      SET DP008-ACCESS-TYPE-USE          TO TRUE                  07750001
077600                                                                  07760001
077700      EXEC CICS                                                   07770001
077800         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 07780001
077810              COMMAREA (DP008-SECURITY-COMMAREA)                  07781001
077820              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             07782001
077830      END-EXEC                                                    07783001
077840                                                                  07784001
077850      IF DP008-CALL-SUCCESSFUL                                    07785001
077860         IF DP008-ACCESS-ALLOWED                                  07786001
077870             SET PS-FUNCTION-ALLOWED TO TRUE                      07787001
077880         ELSE                                                     07788001
077890             SET PS-FUNCTION-NOT-ALLOWED TO TRUE                  07789001
077900         END-IF                                                   07790001
077901     ELSE                                                         07790101
077902         MOVE '2105-RACF-ACCESS'                                  07790201
077903                               TO DP013-PARAGRAPH                 07790301
077904          MOVE 'UNABLE TO ACCESS CICS'                            07790401
077905                               TO DP013-MESSAGE-TEXT (1)          07790501
077906          MOVE SQLCA                 TO DP013-SQLCA               07790601
077907          SET DP013-DB2-ABEND                                     07790701
077908              DP013-XCTL-DISPLAY-RESTART                          07790801
077909                               TO TRUE                            07790901
077910          PERFORM DP013-0000-PROCESS-ABEND                        07791001
077911      END-IF.                                                     07791101
077912                                                                  07791201
077913                                                                  07791301
077914******************************************************************07791401
077915** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **07791501
077916** INTER-APPLICATION COMMAREA.                                  **07791601
077917******************************************************************07791701
077918 2110-PREPARE-INTER-APPL-COMM.                                    07791801
077919                                                                  07791901
077920     INITIALIZE CN022-INTER-APPL-COMMAREA.                        07792001
077930                                                                  07793001
077940     MOVE ASC-FUNCTION             TO CN022-FUNCTION.             07794001
077950     MOVE ASC-PARM-NAME            TO CN022-PARM-NAME.            07795006
077960     MOVE ASC-PARM-DESC            TO CN022-PARM-DESC.            07796001
077970     MOVE ASC-PARM-FUNC            TO CN022-PARM-FUNC.            07797006
077980                                                                  07798001
077990*----------------------------------------------------------------*07799001
078000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *07800001
078100* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *07810001
078200* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *07820001
078300* THIS PARAGRAPH DOES NOT USE TEMPORARY VARIABLES.               *07830001
078400*----------------------------------------------------------------*07840001
078500 2200-MOVE-SCREEN-TO-COMMAREA.                                    07850001
078600     SET  ASC-FUNCTION-NONE        TO TRUE.                       07860001
078700*PARM CODE                                                        07870001
078800     IF  APRMNMEL > ZERO                                          07880006
078900         MOVE APRMNMEI             TO ASC-PARM-NAME               07890008
079000         MOVE ASC-PARM-NAME        TO PV-INP-PARM-CODE            07900008
079100     ELSE                                                         07910001
079200         IF  APRMNMEF = DP015-ERASE-EOF                           07920006
079300             MOVE SPACES           TO ASC-PARM-NAME               07930008
079400         END-IF                                                   07940001
079500     END-IF.                                                      07950001
079600                                                                  07960001
079700*PARM DESCRIPTION                                                 07970001
079800     IF  APRMDSCL > ZERO                                          07980008
079900         MOVE APRMDSCI             TO ASC-PARM-DESC               07990008
080000     ELSE                                                         08000001
080100         IF  APRMDSCF = DP015-ERASE-EOF                           08010008
080200             MOVE SPACES           TO ASC-PARM-DESC               08020001
080300         END-IF                                                   08030001
080400     END-IF.                                                      08040001
080500                                                                  08050001
080600*PARM TYPE                                                        08060001
080700     IF  APRMTYPL > ZERO                                          08070008
080800         MOVE APRMTYPI             TO ASC-PARM-FUNC               08080008
080900     ELSE                                                         08090001
081000         IF  APRMTYPF = DP015-ERASE-EOF                           08100008
081100             MOVE SPACES           TO ASC-PARM-FUNC               08110008
081200         END-IF                                                   08120001
081300     END-IF.                                                      08130001
081400                                                                  08140001
081500                                                                  08150001
081600*----------------------------------------------------------------*08160001
081700* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *08170001
081800* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *08180001
081900* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *08190001
082000*----------------------------------------------------------------*08200001
082100 3000-EDIT-DATA-IN-COMMAREA.                                      08210001
082200                                                                  08220001
082300     IF  ASC-PARM-NAME  >  SPACES                                 08230008
082400         PERFORM 3040-CHECK-4-ROW-ON-WST00008                     08240003
082500     ELSE                                                         08250001
082600         SET PS-ERROR                                             08260001
082700             DP020-MSG-FATAL         TO TRUE                      08270001
082800         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          08280001
082900         MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA                  08290006
083000         MOVE DP015-RED              TO APRMNMEC                  08300006
083100         MOVE DP015-REVERSE          TO APRMNMEH                  08310006
083200         MOVE -1                     TO APRMNMEL                  08320006
083300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08330001
083400     END-IF.                                                      08340001
083500                                                                  08350001
083600     IF  PS-NO-ERROR                                              08360001
083700         IF  ASC-PARM-DESC  >  SPACES                             08370001
083800             CONTINUE                                             08380001
083900         ELSE                                                     08390001
084000             SET PS-ERROR                                         08400001
084100                 DP020-MSG-FATAL         TO TRUE                  08410001
084200             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08420001
084300             MOVE DP015-UNP-ALP-BRT-OFF  TO APRMDSCA              08430008
084400             MOVE DP015-RED              TO APRMDSCC              08440008
084500             MOVE DP015-REVERSE          TO APRMDSCH              08450008
084600             MOVE -1                     TO APRMDSCL              08460008
084700             MOVE +1                     TO APRMNMEL              08470006
084800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08480001
084900     END-IF.                                                      08490001
085000                                                                  08500001
085100     IF  PS-NO-ERROR                                              08510001
085200         IF  ASC-PARM-FUNC  >  SPACES                             08520008
085400             CONTINUE                                             08540008
086600         ELSE                                                     08660001
086700             SET PS-ERROR                                         08670001
086800                 DP020-MSG-FATAL         TO TRUE                  08680001
086900             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08690001
087000             MOVE DP015-UNP-ALP-BRT-OFF  TO APRMTYPA              08700008
087100             MOVE DP015-RED              TO APRMTYPC              08710008
087200             MOVE DP015-REVERSE          TO APRMTYPH              08720008
087300             MOVE -1                     TO APRMTYPL              08730008
087400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08740001
087500         END-IF.                                                  08750001
087600                                                                  08760001
087700*                                                                 08770001
087800******************************************************************08780001
087900** A ROW MUST EXIST ON WST00008.                                  08790002
088000******************************************************************08800001
088100 3040-CHECK-4-ROW-ON-WST00008.                                    08810003
088200      MOVE ASC-PARM-NAME     TO DK-PARM-CODE.                     08820008
088300                                                                  08830001
088400        EXEC SQL                                                  08840001
088500          SELECT                                                  08850001
088600                  INTGRTN_TYP_CDE                                 08860003
088700                 ,INTGRTN_TYP_DESC                                08870003
088800                 ,APPL_FUNC_DESC                                  08880003
088900            INTO                                                  08890001
089000                 :WST00008-INTGRTN-TYP-CDE                        08900003
089100                ,:WST00008-INTGRTN-TYP-DESC                       08910003
089200                ,:WST00008-APPL-FUNC-DESC                         08920003
089300            FROM  WST_INTGRTN_TYP                                 08930004
089400           WHERE  INTGRTN_TYP_CDE = :DK-PARM-CODE                 08940005
089500        END-EXEC                                                  08950001
089600                                                                  08960001
089700        EVALUATE TRUE                                             08970001
089800            WHEN SQLCODE = +0                                     08980001
089900                 IF  ASC-ADD-INTGRTN                              08990010
090000                     SET PS-ERROR                                 09000001
090100                         DP020-MSG-FATAL         TO TRUE          09010001
090200                     MOVE PC-TSYMSG-03707    TO DP020-MSG-NUMBER  09020001
090300                     MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA      09030006
090400                     MOVE DP015-RED              TO APRMNMEC      09040006
090500                     MOVE DP015-REVERSE          TO APRMNMEH      09050006
090600                     MOVE -1                     TO APRMNMEL      09060006
090700                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09070001
090800                 END-IF                                           09080001
090900                                                                  09090001
091000            WHEN SQLCODE = +100                                   09100001
091100                                                                  09110001
091200                 IF  ASC-ADD-INTGRTN OR                           09120010
091300                     ASC-FUNCTION-NONE                            09130001
091400                     CONTINUE                                     09140001
091500                 ELSE                                             09150001
091600                     SET PS-ERROR                                 09160001
091700                         DP020-MSG-FATAL         TO TRUE          09170001
091800                     EVALUATE TRUE                                09180001
091900                         WHEN ASC-ADD-DEFN                        09190010
092000                              MOVE PC-TSYMSG-03721                09200001
092100                                             TO DP020-MSG-NUMBER  09210001
092101                         WHEN OTHER                               09210101
092102                              MOVE PC-TSYMSG-03708                09210201
092103                                             TO DP020-MSG-NUMBER  09210301
092104                     END-EVALUATE                                 09210401
092105                     MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA      09210506
092106                     MOVE DP015-RED              TO APRMNMEC      09210606
092107                     MOVE DP015-REVERSE          TO APRMNMEH      09210706
092108                     MOVE -1                     TO APRMNMEL      09210806
092109                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09210901
092110                 END-IF                                           09211001
092120                                                                  09212001
092130            WHEN SQLWARN0 NOT = SPACES                            09213001
092140            WHEN SQLCODE < +0                                     09214001
092150            WHEN SQLCODE > +0                                     09215001
092160                MOVE '3040-CHECK-4-ROW-ON-WST00008'               09216003
092170                                          TO DP013-PARAGRAPH      09217001
092180                MOVE 'PROBLEM WITH RETRIEVING ROW'                09218001
092190                                    TO DP013-MESSAGE-TEXT (1)     09219001
092200                MOVE SQLCA      TO DP013-SQLCA                    09220001
092300                MOVE 'WST00008' TO DP013-DB2-TABLE-NAME (1)       09230002
092400                SET DP013-DB2-ABEND                               09240001
092500                    DP013-XCTL-DISPLAY-RESTART TO TRUE            09250001
092600                PERFORM DP013-0000-PROCESS-ABEND                  09260001
092700        END-EVALUATE.                                             09270001
092800                                                                  09280001
094700*----------------------------------------------------------------*09470001
094800* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *09480001
094900* MAP.                                                           *09490001
095000*----------------------------------------------------------------*09500001
095100 3200-RESET-ATTRIBUTES.                                           09510001
095200     IF PS-NO-ERROR                                               09520001
095300         IF ASC-FUNCTION = PC-UPDATE                              09530001
095400             MOVE DP015-PRO-NOR-OFF        TO APRMNMEA            09540006
095500             MOVE DP015-BLUE               TO APRMNMEC            09550006
095600             MOVE DP015-HL-OFF             TO APRMNMEH            09560006
095700             SET DP030-SET-CURSOR-APPL-1   TO TRUE                09570001
095800             MOVE -1                       TO APRMDSCL            09580008
095900         ELSE                                                     09590001
096000             MOVE DP015-UNP-ALP-NOR-OFF    TO APRMNMEA            09600006
096100                                              APRMDSCA            09610008
096200                                              APRMTYPA            09620008
096300             MOVE DP015-GREEN              TO APRMNMEC            09630006
096400                                              APRMDSCC            09640008
096500                                              APRMTYPC            09650008
096600             MOVE DP015-UNDERLINE          TO APRMNMEH            09660006
096700                                              APRMDSCH            09670008
096800                                              APRMTYPH            09680008
096900             SET DP030-SET-CURSOR-APPL-1   TO TRUE                09690001
097000             MOVE -1                       TO APRMNMEL            09700006
097100         END-IF                                                   09710001
097200         MOVE DP015-UNP-ALP-NOR-OFF    TO APRMDSCA                09720008
097300                                          APRMTYPA                09730008
097400         MOVE DP015-GREEN              TO APRMDSCC                09740008
097500                                          APRMTYPC                09750008
097600         MOVE DP015-UNDERLINE          TO APRMDSCH                09760008
097700                                          APRMTYPH                09770008
097800     END-IF.                                                      09780001
097900                                                                  09790001
098000*----------------------------------------------------------------*09800001
098100*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *09810001
098200*    ENTRY.                                                      *09820001
098300*----------------------------------------------------------------*09830001
098400 4000-BUILD-INITIAL-PANEL.                                        09840001
098500     IF ASC-FUNCTION = PC-UPDATE                                  09850001
098600         MOVE DP015-PRO-NOR-OFF       TO APRMNMEA                 09860006
098700                                         APRMDSCA                 09870008
098800                                         APRMTYPA                 09880008
098900         MOVE DP015-BLUE              TO APRMNMEC                 09890006
099000                                         APRMDSCC                 09900008
099100                                         APRMTYPC                 09910008
099200         MOVE DP015-HL-OFF            TO APRMNMEH                 09920006
099300                                         APRMDSCH                 09930008
099400                                         APRMTYPH                 09940008
099500         MOVE -1                      TO APRMDSCL                 09950008
099600         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     09960001
099700     ELSE                                                         09970001
099800         IF ASC-PARM-NAME  = SPACES                               09980008
099900             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 09990001
100000             MOVE -1                      TO APRMNMEL             10000006
100100         ELSE                                                     10010001
100200             IF ASC-PARM-DESC  = SPACES                           10020001
100300                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             10030001
100400                 MOVE -1                      TO APRMDSCL         10040008
100500             ELSE                                                 10050001
100600                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             10060001
100700                 MOVE -1                      TO APRMTYPL         10070008
100800             END-IF                                               10080001
100900         END-IF                                                   10090001
101000     END-IF.                                                      10100001
101001                                                                  10100111
101010     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   10101011
101020     MOVE ASC-OPER-UNT-NAME        TO AOPRNMEO.                   10102011
101100                                                                  10110001
101200                                                                  10120001
101300*----------------------------------------------------------------*10130001
101400*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10140001
101500*----------------------------------------------------------------*10150001
101600 4400-MOVE-COMMAREA-TO-SCREEN.                                    10160001
101610     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   10161011
101620     MOVE ASC-OPER-UNT-NAME        TO AOPRNMEO.                   10162011
101700     MOVE ASC-PARM-NAME            TO APRMNMEO.                   10170008
101800     MOVE ASC-PARM-DESC            TO APRMDSCO.                   10180008
101900     MOVE ASC-PARM-FUNC            TO APRMTYPO.                   10190008
102000                                                                  10200001
102100*------------------------------------------------------------     10210001
102200*  MOVE COMMAREA TO TEMP AREA                                     10220001
102300*------------------------------------------------------------     10230001
102400 4500-MOVE-COMMAREA-TO-TEMP.                                      10240001
102500     MOVE ASC-PARM-NAME           TO PV-INP-PARM-CODE.            10250008
102600     MOVE ASC-PARM-DESC           TO PV-INP-PARM-DESC.            10260001
102700     MOVE ASC-PARM-FUNC           TO PV-INP-PARM-TYPE.            10270008
102800                                                                  10280001
102900*----------------------------------------------------------------*10290001
103000* PROCESS TABLE INSERTS                                          *10300001
103100*----------------------------------------------------------------*10310001
103200 5000-PROCESS-ADD.                                                10320001
103300     MOVE SPACES         TO  PV-INP-PARM-CODE.                    10330001
103400     MOVE ASC-PARM-NAME  TO  PV-INP-PARM-CODE.                    10340008
103500                                                                  10350001
103600     PERFORM 6100-INSERT-WST00008                                 10360002
103700                                                                  10370001
103800     IF PS-NO-ERROR                                               10380001
103900         IF ASC-WST00008-INSERTED                                 10390002
104000             MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER            10400001
104100             SET DP020-MSG-INFORMATIONAL TO TRUE                  10410001
104200         END-IF                                                   10420001
104300     END-IF.                                                      10430001
104400                                                                  10440001
104500*----------------------------------------------------------------*10450001
104600* PROCESS TABLE UPDATES                                          *10460001
104700*----------------------------------------------------------------*10470001
104800 5100-PROCESS-UPDATE.                                             10480001
104900     PERFORM 7100-UPDATE-WST00008                                 10490002
105000                                                                  10500001
105100     IF ASC-WST00008-UPDATED                                      10510002
105200        SET ASC-F2-CONFIRM-NO       TO TRUE                       10520001
105300        MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER                  10530001
105400        SET DP020-MSG-INFORMATIONAL TO TRUE                       10540001
105500        MOVE DP015-PRO-NOR-OFF       TO APRMNMEA                  10550006
105600                                        APRMDSCA                  10560008
105700                                        APRMTYPA                  10570008
105800        MOVE DP015-BLUE              TO APRMNMEC                  10580006
105900                                        APRMDSCC                  10590008
106000                                        APRMTYPC                  10600008
106100        MOVE DP015-HL-OFF            TO APRMNMEH                  10610006
106200                                        APRMDSCH                  10620008
106300                                        APRMTYPH                  10630008
106400        MOVE -1                      TO APRMNMEL                  10640006
106500        SET DP030-SET-CURSOR-APPL-1  TO TRUE                      10650001
106600     END-IF.                                                      10660001
106700                                                                  10670001
106800*----------------------------------------------------------------*10680001
106900* INSERT A ROW INTO THE CONTROL DC DOOR TABLE                    *10690001
107000*----------------------------------------------------------------*10700001
107100 6100-INSERT-WST00008.                                            10710002
107200         EXEC SQL                                                 10720001
107300                 INSERT INTO WST_INTGRTN_TYP                      10730004
107400                 (                                                10740001
107500                  INTGRTN_TYP_CDE                                 10750005
107600                 ,INTGRTN_TYP_DESC                                10760005
107700                 ,APPL_FUNC_DESC                                  10770005
107800                 )                                                10780001
107900                 VALUES                                           10790001
108000                 (                                                10800001
108100                  :PV-INP-PARM-CODE                               10810001
108200                 ,:PV-INP-PARM-DESC                               10820001
108300                 ,:PV-INP-PARM-TYPE                               10830001
108400                 )                                                10840001
108500         END-EXEC.                                                10850001
108600                                                                  10860001
108700         EVALUATE TRUE                                            10870001
108800             WHEN SQLCODE = +0                                    10880001
108900                 SET ASC-WST00008-INSERTED TO TRUE                10890002
109000                 MOVE PV-INP-PARM-CODE    TO ASC-PARM-NAME        10900008
109100                 MOVE PV-INP-PARM-DESC    TO ASC-PARM-DESC        10910001
109200                 MOVE PV-INP-PARM-TYPE    TO ASC-PARM-FUNC        10920008
109300             WHEN SQLCODE = -803                                  10930001
109400                 MOVE PV-INP-PARM-CODE        TO APRMNMEO         10940006
109500                 MOVE PC-TSYMSG-03709         TO DP020-MSG-NUMBER 10950001
109600                 SET DP020-MSG-FATAL                              10960001
109700                     PS-ERROR                 TO TRUE             10970001
109800                 MOVE DP015-RED               TO APRMNMEC         10980006
109900                 MOVE DP015-REVERSE           TO APRMNMEH         10990006
110000                 MOVE -1                      TO APRMNMEL         11000006
110100                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             11010001
110200             WHEN SQLWARN0 NOT = SPACES                           11020001
110300             WHEN SQLCODE < +0                                    11030001
110400             WHEN SQLCODE > +0                                    11040001
110500                 MOVE '6100-INSERT-WST00008' TO DP013-PARAGRAPH   11050002
110600                 MOVE 'ERROR INSERTING ROW TO WST00008'           11060002
110700                                   TO DP013-MESSAGE-TEXT (1)      11070001
110800                 MOVE SQLCA        TO DP013-SQLCA                 11080001
110900                 MOVE 'WST00008'   TO DP013-DB2-TABLE-NAME (1)    11090002
111000                 SET DP013-DB2-ABEND                              11100001
111100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11110001
111200                 PERFORM DP013-0000-PROCESS-ABEND                 11120001
111300         END-EVALUATE.                                            11130001
111400                                                                  11140001
111500******************************************************************11150001
111600** UPDATE A ROW ON THE PARM CODE TABLE - WST00008                 11160002
111700******************************************************************11170001
111800 7100-UPDATE-WST00008.                                            11180002
111900     MOVE ASC-PARM-NAME    TO WST00008-INTGRTN-TYP-CDE            11190008
112000     MOVE ASC-PARM-DESC    TO WST00008-INTGRTN-TYP-DESC           11200003
112100     MOVE ASC-PARM-FUNC    TO WST00008-APPL-FUNC-DESC             11210008
112200                                                                  11220001
112300     PERFORM                                                      11230001
112400         WITH TEST AFTER                                          11240001
112500         VARYING PV-RETRY-COUNTER                                 11250001
112600         FROM 1 BY 1                                              11260001
112700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11270001
112800         OR     (SQLCODE = ZERO)                                  11280001
112900         OR     (SQLCODE = +100))                                 11290001
113000                                                                  11300001
113100         EXEC SQL                                                 11310001
113200             UPDATE WST_INTGRTN_TYP                               11320004
113300               SET                                                11330001
113500                  INTGRTN_TYP_DESC   = :WST00008-INTGRTN-TYP-DESC 11350005
113600                 ,APPL_FUNC_DESC     = :WST00008-APPL-FUNC-DESC   11360005
113610             WHERE                                                11361005
113620                  INTGRTN_TYP_CDE    = :WST00008-INTGRTN-TYP-CDE  11362005
113700         END-EXEC                                                 11370001
113800                                                                  11380001
113900         EVALUATE TRUE                                            11390001
114000             WHEN SQLCODE = +0                                    11400001
114100                 SET ASC-WST00008-UPDATED TO TRUE                 11410002
114200             WHEN SQLWARN0 NOT = SPACES                           11420001
114300             WHEN SQLCODE < +0                                    11430001
114400             WHEN SQLCODE > +0                                    11440001
114500                 MOVE '7100-UPDATE-WST00008' TO DP013-PARAGRAPH   11450002
114600                 MOVE 'ERROR UPDATING THE DC DOOR TABLE'          11460001
114700                                   TO DP013-MESSAGE-TEXT (1)      11470001
114800                 MOVE SQLCA        TO DP013-SQLCA                 11480001
114900                 MOVE 'WST00008'   TO DP013-DB2-TABLE-NAME (1)    11490002
115000                 SET DP013-DB2-ABEND                              11500001
115100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11510001
115200                 PERFORM DP013-0000-PROCESS-ABEND                 11520001
115300         END-EVALUATE                                             11530001
115400     END-PERFORM.                                                 11540001
115500                                                                  11550001
115600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11560001
115700         MOVE '7100-UPDATE-WST00008' TO DP013-PARAGRAPH           11570002
115800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     11580001
115900                                       TO DP013-MESSAGE-TEXT (1)  11590001
116000         MOVE SQLCA          TO DP013-SQLCA                       11600001
116100         MOVE 'WST00008'     TO DP013-DB2-TABLE-NAME (1)          11610002
116200         SET DP013-DB2-ABEND                                      11620001
116300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   11630001
116400         PERFORM DP013-0000-PROCESS-ABEND                         11640001
116500     END-IF.                                                      11650001
116600     MOVE +0 TO PV-RETRY-COUNTER.                                 11660001
116700                                                                  11670001
116800*----------------------------------------------------------------*11680001
116900* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11690001
117000*----------------------------------------------------------------*11700001
117100 9100-READ-SEL-QUEUE.                                             11710001
117200     EXEC CICS                                                    11720001
117300         READQ TS                                                 11730001
117400             QUEUE (ASC-SEL-QUEUE-NAME)                           11740001
117500             INTO  (CN024-SELECT-RECORD)                          11750001
117600             ITEM  (ASC-SEL-ITEM)                                 11760001
117700             RESP  (PV-CICS-RESPONSE)                             11770001
117800     END-EXEC.                                                    11780001
117900                                                                  11790001
118000     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       11800001
118100         CONTINUE                                                 11810001
118200     ELSE                                                         11820001
118300         SET DP013-LOGIC-ABEND                                    11830001
118400             DP013-NO-ROLLBACK     TO TRUE                        11840001
118500         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            11850001
118600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   11860001
118700                                   TO DP013-MESSAGE-TEXT (1)      11870001
118800         PERFORM DP013-0000-PROCESS-ABEND                         11880001
118900     END-IF.                                                      11890001
119000                                                                  11900001
119100*----------------------------------------------------------------*11910001
119200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11920001
119300*----------------------------------------------------------------*11930001
119400 9200-REWRITE-SEL-QUEUE.                                          11940001
119500     EXEC CICS                                                    11950001
119600          WRITEQ TS                                               11960001
119700              QUEUE  (ASC-SEL-QUEUE-NAME)                         11970001
119800              FROM   (CN024-SELECT-RECORD)                        11980001
119900              ITEM   (ASC-SEL-ITEM)                               11990001
120000              RESP   (PV-CICS-RESPONSE)                           12000001
120100              REWRITE                                             12010001
120200     END-EXEC.                                                    12020001
120300                                                                  12030001
120400     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   12040001
120500         SET DP013-CICS-ABEND                                     12050001
120600             DP013-NO-ROLLBACK     TO TRUE                        12060001
120700         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        12070001
120800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   12080001
120900                                   TO DP013-MESSAGE-TEXT (1)      12090001
121000         PERFORM DP013-0000-PROCESS-ABEND                         12100001
121100     END-IF.                                                      12110001
121200                                                                  12120001
121300     COPY DPPD013.                                                12130001
121400*----------------------------------------------------------------*12140001
121500*    ABEND PROCESSOR MODULE                                      *12150001
121600*----------------------------------------------------------------*12160001
