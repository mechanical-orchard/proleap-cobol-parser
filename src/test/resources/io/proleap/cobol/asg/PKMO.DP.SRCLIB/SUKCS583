000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.             SUKCS583.                                00040000
000500 AUTHOR.                 LARRY SCHLEICHER.                        00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060000
000700 DATE-WRITTEN            NOV, 2001.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090006
001000* THIS PROGRAM WILL DETERMINE IF A CARTON NEED TO BE AUDITED      00100000
001100* USING THE PARAMETERS SET UP FOR THE VENDOR.                     00110000
001101******************************************************************00110100
001102* 11/05/2013  CHERI PARMLEY                                      *00110200
001103*             INCLUDE THE PACKING TYPE THE SELECT OF THE         *00110300
001104*             SUT_PO_AUD_REQ TABLE.                              *00110400
001105* 01/06/2014  GERMAN BANDA                                       *00110500
001106*             INCLUDE THE FOLLOWING LINE IN CURSOR FOR 8410-     *00110600
001107*             AND  CART_PRMPT_CDE NOT IN ('D','F')                00110700
001108*                                                                *00110800
001109*             PARA 8410- AND 8420- WERE ADDED TO SEE IF THERE    *00110900
001110*             WAS AN RFID AUDIT DONE, AND THEN POPULATE THE      *00111000
001111*             REWORK # IF THE RFID AUDIT ALSO REFERS TO THE QC   *00111100
001112*             AUDIT (COMBO)                                      *00111200
001113*                                                                *00111300
001114*             INTRODUCE NEW AUDIT TYPE - SUT00014-AUD-TYP-CDE = R*00111400
001115*             THIS IS USED IN THE PO EXCEPTION LOGIC REGARDLESS  *00111500
001116*             IF ITS RFID, IT WILL CHECK IF PO EXCEPTION AND IF  *00111600
001117*             FOUND SEND % BACK TO RECEIVING PROGRAMS FOR 100%   *00111700
001118*             AUDIT REQUIRED. LOGIC IN 1700-                     *00111800
001119******************************************************************00111900
001120 ENVIRONMENT DIVISION.                                            00112000
001121 DATA DIVISION.                                                   00112100
001122******************************************************************00112200
001123 WORKING-STORAGE SECTION.                                         00112300
001124                                                                  00112400
001125 01  DK-DB2-KEYS.                                                 00112500
001126     05  DK-PO-NBR                PIC S9(09)  COMP.               00112600
001127     05  DK-PO-LINE-NBR           PIC S9(09)  COMP.               00112700
001128     05  DK-PO-DRIVER-LINE        PIC S9(09)  COMP.               00112800
001129     05  DK-SHUUPC-LNE-NBR        PIC S9(09)  COMP.               00112900
001130     05  DK-PREPK-ID              PIC S9(04)  COMP.               00113000
001140     05  DK-OPER-UNT-ID           PIC S9(04)  COMP.               00114000
001150     05  DK-INBND-TRIP-ID         PIC S9(09)  COMP.               00115000
001160     05  DK-RCVR-SEQ-NBR          PIC S9(09)  COMP.               00116000
001170     05  DK-SHIPT-UNT-ID          PIC S9(18)V COMP-3.             00117000
001180     05  DK-ENT-ID                PIC S9(09)  COMP.               00118000
001190     05  DK-DEPT-NBR              PIC S9(04)  COMP-4.             00119000
001200     05  DK-PKGNG-TYP-CDE         PIC  X(02).                     00120000
001300     05  DK-AUDIT-CNTL-NBR        PIC S9(09) COMP.                00130000
001400     05  DK-RFID-AUD-CNTL-NBR     PIC S9(09) COMP.                00140000
001410     05  DK-BYPASS-PO-NBR         PIC S9(09)  COMP.               00141049
001420     05  DK-BYPASS-REC-SEQ-NBR    PIC S9(09)  COMP.               00142049
001500                                                                  00150000
001600 01  DN-DB2-NULL-INDICATORS.                                      00160000
001700     05  DN-SUM-NULL                PIC S9(04) COMP VALUE ZEROES. 00170000
001800     05  DN-SUM-NULL-UPC            PIC S9(04) COMP VALUE ZEROES. 00180000
001900*                                                                 00190000
002000*----------------------------------------------------------------*00200000
002100* COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00210000
002200*----------------------------------------------------------------*00220000
002300     COPY SURD021.                                                00230006
002400                                                                  00240000
002500******************************************************************00250000
002600*  RANDOM NUMBER AREA.                                            00260000
002700******************************************************************00270000
002800     COPY DPWS902.                                                00280000
002900                                                                  00290000
003000******************************************************************00300000
003100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00310000
003200******************************************************************00320000
003300     COPY DPWS013.                                                00330000
003400                                                                  00340000
003500*----------------------------------------------------------------*00350000
003600*  PROGRAM CONSTANTS                                             *00360000
003700*----------------------------------------------------------------*00370000
003800 01  PC-PROGRAM-CONSTANTS.                                        00380000
003900     05  PC-F                     PIC  X(01)  VALUE 'F'.          00390000
004000     05  PC-P                     PIC  X(01)  VALUE 'P'.          00400000
004100     05  PC-I                     PIC  X(01)  VALUE 'I'.          00410000
004200     05  PC-N                     PIC  X(01)  VALUE 'N'.          00420000
004300     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          00430000
004400     05  PC-A                     PIC  X(01)  VALUE 'A'.          00440000
004500     05  PC-D                     PIC  X(01)  VALUE 'D'.          00450000
004600     05  PC-C                     PIC  X(01)  VALUE 'C'.          00460000
004700     05  PC-R                     PIC  X(01)  VALUE 'R'.          00470000
004800     05  PC-Q                     PIC  X(01)  VALUE 'Q'.          00480000
004900     05  PC-IP                    PIC  X(02)  VALUE 'IP'.         00490000
005000     05  PC-02                    PIC  X(02)  VALUE '02'.         00500000
005100     05  PC-DEFAULT               PIC  X(06)  VALUE 'DEFALT'.     00510000
005200     05  PC-DEFAULT-DATE          PIC  X(26)  VALUE               00520000
005300                                  '9999-09-09-09.09.09.999999'.   00530000
005400     05  PC-RANDOM-NBR-GENERATOR  PIC  X(08)  VALUE 'DPKUT902'.   00540000
005500     05  PC-LOG-QUEUE             PIC  X(04)  VALUE 'CSSL'.       00550000
005510     05  PC-LOG-QUEUE-2           PIC  X(04)  VALUE 'CSSL'.       00551037
005600     05  PC-MSG-TABLE-SIZE            PIC S9(03) COMP-3 VALUE 200.00560000
005700     05  PC-100                       PIC  9(03)V99     VALUE 100.00570000
005800     05  PC-LOGON-TRAN-ID                PIC  X(04)  VALUE 'Z028'.00580000
005900                                                                  00590000
006000*----------------------------------------------------------------*00600000
006100*  PROGRAM SWITCHES                                              *00610000
006200*----------------------------------------------------------------*00620000
006300 01  PS-PROGRAM-SWITCHES.                                         00630000
006400     05  PS-CARTON-ALREADY-EXISTS-SW     PIC  X(01)  VALUE 'N'.   00640000
006500         88  PS-CARTON-ALREADY-EXISTS                VALUE 'Y'.   00650000
006600         88  PS-CARTON-DOESNT-EXIST                  VALUE 'N'.   00660000
006700     05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   00670000
006800         88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   00680000
006900         88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   00690000
007000     05  PS-REQ-REC-FOUND-SW             PIC  X(01)  VALUE 'N'.   00700000
007100         88  PS-REQ-REC-FOUND                        VALUE 'Y'.   00710000
007200         88  PS-NO-REQ-REC-FOUND                     VALUE 'N'.   00720000
007300     05  PS-RFID-REC-FOUND-SW            PIC  X(01)  VALUE 'N'.   00730000
007400         88  PS-RFID-REC-FOUND                       VALUE 'Y'.   00740000
007500         88  PS-NO-RFID-REC-FOUND                    VALUE 'N'.   00750000
007600     05  PS-NO-AUDIT-STARTED-SW          PIC  X(01)  VALUE 'N'.   00760000
007700         88  PS-AUDIT-STARTED                        VALUE 'Y'.   00770000
007800         88  PS-NO-AUDIT-STARTED                     VALUE 'N'.   00780000
007900     05  PS-DEPT-RANK-FOUND-SW           PIC  X(01)  VALUE 'N'.   00790000
008000         88  PS-DEPT-RANK-FOUND                      VALUE 'Y'.   00800000
008100         88  PS-NO-DEPT-RANK-FOUND                   VALUE 'N'.   00810000
008200     05  PS-PASSED-AUDITS-FOUND-SW       PIC  X(01)  VALUE 'N'.   00820000
008300         88  PS-PASSED-AUDITS-FOUND                  VALUE 'Y'.   00830000
008400         88  PS-NO-PASSED-AUDITS-FOUND               VALUE 'N'.   00840000
008500     05  PS-FAILED-AUDITS-FOUND-SW       PIC  X(01)  VALUE 'N'.   00850000
008600         88  PS-FAILED-AUDITS-FOUND                  VALUE 'Y'.   00860000
008700         88  PS-NO-FAILED-AUDITS-FOUND               VALUE 'N'.   00870000
008800     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   00880000
008900         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   00890000
009000         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   00900000
009100     05  PS-VEND-RANK-FOUND-SW           PIC  X(01)  VALUE 'N'.   00910000
009200         88  PS-VEND-RANK-FOUND                      VALUE 'Y'.   00920000
009300         88  PS-NO-VEND-RANK-FOUND                   VALUE 'N'.   00930000
009400     05  PS-DEFAULT-RANK-FOUND-SW        PIC  X(01)  VALUE 'N'.   00940000
009500         88  PS-DEFAULT-RANK-FOUND                   VALUE 'Y'.   00950000
009600         88  PS-NO-DEFAULT-RANK-FOUND                VALUE 'N'.   00960000
009700     05  PS-PO-INFO-FOUND-SW             PIC  X(01)  VALUE 'N'.   00970000
009800         88  PS-PO-INFO-FOUND                        VALUE 'Y'.   00980000
009900         88  PS-NO-PO-INFO-FOUND                     VALUE 'N'.   00990000
010000     05  PS-LINE-LEVEL-FOUND-SW          PIC  X(01)  VALUE 'N'.   01000000
010100         88  PS-LINE-LEVEL-FOUND                     VALUE 'Y'.   01010000
010200         88  PS-NO-LINE-LEVEL-FOUND                  VALUE 'N'.   01020000
010300     05  PS-PO-LEVEL-FOUND-SW            PIC  X(01)  VALUE 'N'.   01030000
010400         88  PS-PO-LEVEL-FOUND                       VALUE 'Y'.   01040000
010500         88  PS-NO-PO-LEVEL-FOUND                    VALUE 'N'.   01050000
010600     05  PS-AUDIT-IS-REQUIRED-SW         PIC  X(01)  VALUE 'N'.   01060000
010700         88  PS-AUDIT-IS-REQUIRED                    VALUE 'Y'.   01070000
010800         88  PS-AUDIT-IS-NOT-REQUIRED                VALUE 'N'.   01080000
010900     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   01090000
011000         88  PS-ERROR                                VALUE 'Y'.   01100000
011100         88  PS-ERROR-NO                             VALUE 'N'.   01110000
011200     05  PS-DUMP-TO-LOG-SW               PIC X(01)   VALUE 'N'.   01120000
011300         88  PS-DONT-DUMP-TO-LOG                     VALUE 'N'.   01130000
011400         88  PS-DUMP-TO-LOG                          VALUE 'Y'.   01140000
011410     05  PS-BLD-INTERNAL-TABLE-SW     PIC  X(01) VALUE 'N'.       01141009
011420         88  PS-BLD-INTERNAL-TABLE-YES           VALUE 'Y'.       01142009
011430         88  PS-BLD-INTERNAL-TABLE-NO            VALUE 'N'.       01143009
011440     05  PS-BYPASS-PROMPT-AUDIT-SW       PIC  X(01)  VALUE 'N'.   01144049
011450         88  PS-BYPASS-PROMPT-AUDIT                  VALUE 'Y'.   01145049
011460         88  PS-BYPASS-PROMPT-AUDIT-NO               VALUE 'N'.   01146049
011500                                                                  01150000
011600*----------------------------------------------------------------*01160000
011700*  PROGRAM VARIABLES                                             *01170000
011800*----------------------------------------------------------------*01180000
011900 01  PV-PROGRAM-VARIABLES.                                        01190000
012000                                                                  01200000
012100     05  PV-DISPLAY-AUDIT                PIC 9(09).               01210024
012110     05  PV-DISPLAY-PO-NBR               PIC 9(09).               01211024
012200     05  PV-DISPLAY-PO-LINE-NBR          PIC 9(04).               01220001
012300     05  PV-DISPLAY-PREPK-ID             PIC 9(04).               01230000
012310     05  PV-DISPLAY-PREPK                PIC 9(04).               01231024
012400     05  PV-DISPLAY-OPER-UNT-ID          PIC 9(04).               01240000
012410     05  PV-DISPLAY-OPER                 PIC 9(04).               01241024
012500     05  PV-DISPLAY-INBND-TRIP-ID        PIC 9(09).               01250000
012600     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 9(09).               01260000
012700     05  PV-DISPLAY-SHIPT-UNT-ID         PIC 9(18).               01270000
012800     05  PV-DISPLAY-ENT-ID               PIC 9(09).               01280000
012900     05  PV-DISPLAY-DEPT-NBR             PIC 9(04).               01290000
013000     05  PV-DISPLAY-CK-AFT-DAY-QTY       PIC 9(04).               01300000
013100     05  PV-DISPLAY-LIMIT-DAYS           PIC 9(09).               01310000
013200     05  PV-DISPLAY-TASK                 PIC 9(07).               01320000
013300     05  PV-DISPLAY-MSG-NBR              PIC 9(03).               01330000
013400                                                                  01340000
013500     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACES.01350000
013501     05  PV-CICS-MSG-AREA-3              PIC  X(125) VALUE SPACES.01350114
013502                                                                  01350214
013503     05  PV-DISP-OPER                    PIC 9(04).               01350314
013504     05  PV-DISP-PO                      PIC 9(09).               01350414
013505     05  PV-DISP-RCVR                    PIC 9(04).               01350514
013506     05  PV-DISP-LINE                    PIC 9(04).               01350614
013507     05  PV-DISP-PREPK                   PIC 9(04).               01350714
013508     05  PV-DISP-SQL                     PIC -999.                01350814
013509     05  PV-DISP-SSCC                    PIC 9(18).               01350914
013510     05  PV-DISP-ENTID                   PIC 9(09).               01351014
013511     05  PV-DISP-DEPT                    PIC 9(04).               01351114
013512     05  PV-DISP-TRIP                    PIC 9(04).               01351214
013520     05  PV-CICS-MSG-AREA-D              PIC  X(120) VALUE SPACES.01352004
013600                                                                  01360000
013700     05  PV-PASSED-COUNT                 PIC S9(4)  COMP.         01370000
013800     05  PV-PROMPTED-CNT                 PIC S9(4)  COMP.         01380000
013900     05  PV-DB2-COUNT-EXP-SCN            PIC S9(4)  VALUE +0      01390000
014000                                                    COMP.         01400000
014100     05  PV-CARTONS-TO-AUDIT             PIC S9(9)  VALUE +0      01410000
014200                                                    COMP.         01420000
014300     05  PV-UNITS-TO-AUDIT               PIC S9(9)  VALUE +0      01430000
014400                                                    COMP.         01440000
014500     05  PV-TOTAL-CARTONS                PIC S9(9)  VALUE +0      01450000
014600                                                    COMP.         01460000
014700     05  PV-CHECK-IN-COUNT               PIC S9(9)  VALUE +0      01470000
014800                                                    COMP.         01480000
014900     05  PV-TOTAL-UNITS                  PIC S9(9)  VALUE +0      01490000
015000                                                    COMP.         01500000
015100     05  PV-SUM-EXPTD-ALLOC              PIC S9(9)  VALUE +0      01510000
015200                                                    COMP.         01520000
015300     05  PV-SUM-OF-ALL-LINES             PIC S9(9)  VALUE +0      01530000
015400                                                    COMP.         01540000
015500     05  PV-AUDIT-CNTL-NBR-X             PIC  X(09) VALUE SPACE.  01550000
015600     05  PV-AUDIT-CNTL-NBR  REDEFINES                             01560000
015700         PV-AUDIT-CNTL-NBR-X             PIC  9(09).              01570000
015800     05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         01580000
015900     05  PV-SHPD-QTY-SUM                 PIC S9(09) COMP-3.       01590000
016000     05  PV-CARTON-COUNT                 PIC S9(09) COMP.         01600000
016100     05  PV-CICS-MSG-AREA                PIC  X(125) VALUE SPACE. 01610041
016200     05  PV-CICS-RESPONSE                PIC S9(08) VALUE ZEROS   01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-EIBTASKN                     PIC Z(06)9.              01640000
016500     05  PV-PREV-SEQUENCE                PIC S9(05) COMP-3        01650000
016600                                                     VALUE ZERO.  01660000
016700     05  PV-NEXT-SEQUENCE                PIC S9(05) COMP-3        01670000
016800                                                     VALUE ZERO.  01680000
016900     05  PV-UNT-QTY                      PIC  9(05)V99.           01690000
017000     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01700000
017100     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01710000
017200                                                     COMP.        01720000
017300     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01730000
017400                                                     COMP SYNC.   01740000
017410     05  PV-CSSL-PARA                    PIC  X(04) VALUE SPACES. 01741008
017420     05  PV-PARM-SECONDS                 PIC S9(09) COMP VALUE 0. 01742008
017421                                                                  01742130
017422     05  PV-INIT-TIMESTAMP               PIC  X(26) VALUE SPACES. 01742230
017423     05  PV-INIT-TIMESTAMP-R REDEFINES PV-INIT-TIMESTAMP.         01742330
017424         10  FILLER                      PIC  X(11).              01742430
017425         10  PV-INIT-HH                  PIC  9(02).              01742530
017426         10  FILLER                      PIC  X(01).              01742630
017427         10  PV-INIT-MM                  PIC  9(02).              01742730
017428         10  FILLER                      PIC  X(01).              01742830
017429         10  PV-INIT-SS                  PIC  9(02).              01742930
017430         10  FILLER                      PIC  X(07).              01743030
017431     05  PV-INIT-TIME-KEY.                                        01743130
017432         10  PV-INIT-KEY-HH              PIC  9(02).              01743230
017433         10  PV-INIT-KEY-MM              PIC  9(02).              01743330
017434         10  PV-INIT-KEY-SS              PIC  9(02).              01743430
017497     05  PV-DURATION-SEC                 PIC S9(09) COMP VALUE 0. 01749708
017498     05  PV-DISP-DURATION                PIC  9(09)   VALUE ZEROS.01749808
017499     05  PV-DISP-PARM-SECONDS            PIC  9(09)   VALUE ZEROS.01749908
017500     05  PV-DURATION-NANO-SEC            PIC S9(10) COMP VALUE 0. 01750008
017501     05  PV-WORK-NANO-SEC                PIC  9(10) VALUE ZEROES. 01750108
017502     05  PV-WORK-NANO-SEC-REDEF REDEFINES PV-WORK-NANO-SEC.       01750208
017503         10  PV-WORK-NANO-MIN-1-2        PIC  9(02).              01750308
017504         10  PV-WORK-NANO-SEC-3-4        PIC  9(02).              01750408
017505         10  PV-WORK-NANO-MICRO-5-10     PIC  9(06).              01750508
017506     05  PV-DISP-NANO-SEC                PIC  X(12).              01750608
017507     05  PV-DISP-NANO-SEC-REDEF REDEFINES PV-DISP-NANO-SEC.       01750708
017508         10  PV-DISP-NANO-MIN-1-2        PIC  9(02).              01750808
017509         10  PV-DISP-NANO-DASH-1         PIC  X(01).              01750908
017510         10  PV-DISP-NANO-SEC-3-4        PIC  9(02).              01751008
017511         10  PV-DISP-NANO-DASH-2         PIC  X(01).              01751108
017512         10  PV-DISP-NANO-MICRO-5-10     PIC  9(06).              01751208
017513     05  PV-CURRENT-PARA-TMST            PIC  X(26).              01751308
017514                                                                  01751411
017517     05  PV-DISP-DRVR-LINE               PIC  9(04) value zeros.  01751711
017523     05  PV-DISP-AUDIT                   PIC  9(09) value zeros.  01752311
017524     05  PV-DISP-RFID-AUDIT              PIC  9(09) value zeros.  01752411
017525     05  PV-DISP-SQLCODE                 PIC  -999  value zeros.  01752511
017530                                                                  01753011
017531                                                                  01753111
017532*----------------------------------------------------------------*01753211
017533* PARAGRAPH TRACKING TABLE - USED FOR DEBUGGING                  *01753311
017534* WILL TRACK PARAGRAPHS IN THIS TABLE - IF WE SEE TRANSACTION    *01753411
017535* IF TAKING LONGER THEN X SECONDS TO RESPOND, WILL DUMP THE      *01753511
017536* TABLE TO CSSL                                                  *01753611
017537* PARM PATIM5                                                    *01753717
017538*----------------------------------------------------------------*01753811
017539 01  PT-PARA-TRACKING-TABLE.                                      01753911
017540     05  PT-ENTRIES               OCCURS 1500 TIMES               01754011
017541                                  INDEXED BY PT-TRACK-IDX.        01754111
017542         10 PT-TRACK-ENTRY.                                       01754237
017543             15 FILLER            PIC  X(01) VALUE SPACE.         01754337
017544             15 PT-PROGRAM        PIC  X(08) VALUE 'SUKCS771'.    01754437
017545             15 FILLER            PIC  X(01) VALUE SPACE.         01754537
017546             15 pt-dc             PIC  9(04) VALUE zeroes.        01754637
017547             15 filler            PIC  X(01) VALUE '-'.           01754737
017548             15 PT-sscc           PIC  9(18) VALUE zeroes.        01754837
017549             15 filler            PIC  X(01) VALUE '-'.           01754937
017550             15 pt-start-hhmmss   PIC  9(06) VALUE zeroes.        01755037
017551             15 FILLER            PIC  X(01) VALUE SPACE.         01755137
017552             15 PT-INDEX-NBR      PIC  9(05) VALUE ZEROES.        01755237
017553             15 FILLER            PIC  X(01) VALUE SPACE.         01755337
017554             15 PT-paragraph      PIC  X(04) VALUE SPACE.         01755437
017555             15 FILLER            PIC  X(01) VALUE SPACE.         01755537
017556             15 PT-TIMESTAMP      PIC  X(26) VALUE SPACE.         01755637
017557             15 FILLER            PIC  X(01) VALUE SPACE.         01755737
017558             15 PT-DURATION       PIC  9(09) VALUE ZEROES.        01755837
017559             15 FILLER            PIC  X(01) VALUE SPACE.         01755937
017560             15 PT-nano-sec       PIC  x(12) VALUE ZEROES.        01756037
017561     05  PT-MAX-PARA-ENTRIES      PIC  9(04) VALUE 1500.          01756137
017562     05  PT-CURR-ENTRIES          PIC  9(04) VALUE ZEROES.        01756237
017563     05  PT-CURR-PARA             PIC  X(04) VALUE SPACES.        01756337
017564                                                                  01756437
017565                                                                  01756537
017566                                                                  01756637
017567                                                                  01756737
017570/                                                                 01757011
017600 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  01760000
017700     05  TS-INFO-QUEUE-NAME.                                      01770000
017800         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 01780000
017900         10  FILLER                      PIC  X(04)  VALUE 'INFO'.01790000
018000                                                                  01800000
018100/                                                                 01810000
018200 01  PT-MSG-TABLE.                                                01820000
018300     05  PT-MSG-LINES OCCURS 200 TIMES                            01830000
018400                              INDEXED BY PT-MSG-IDX.              01840000
018500         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       01850000
018600         10  PT-MSG-LINE                 PIC X(69).               01860000
018700                                                                  01870000
018800     05  PV-COMMAREA-LENGTH              PIC S9(04)  COMP         01880000
018900                                                     VALUE ZERO.  01890000
019000     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  01900000
019100                                                     COMP SYNC.   01910000
019200                                                                  01920000
019300*                                                                 01930000
019400     COPY DPWS026.                                                01940000
019500                                                                  01950000
019600*---------------------------------------------------------------* 01960000
019700*    DB2 AREA FOR THE RECEIVER HEADER TABLE                     * 01970049
019800*---------------------------------------------------------------* 01980000
019900     EXEC SQL                                                     01990000
020000          INCLUDE TRECEIV                                         02000049
020100     END-EXEC.                                                    02010000
020110*---------------------------------------------------------------* 02011049
020120*    DB2 AREA FOR THE PURCHASE TABLE                            * 02012049
020130*---------------------------------------------------------------* 02013049
020140     EXEC SQL                                                     02014049
020150          INCLUDE TPURCHS                                         02015049
020160     END-EXEC.                                                    02016049
020200*---------------------------------------------------------------* 02020000
020300*    DB2 AREA FOR SHIPMENT PO TABLE                             * 02030000
020400*---------------------------------------------------------------* 02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE TSHPTPO                                         02060000
020700     END-EXEC.                                                    02070000
020800*---------------------------------------------------------------* 02080000
020900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      02090000
021000*  (TSHPUNT)                                                      02100000
021100*---------------------------------------------------------------* 02110000
021200     EXEC SQL                                                     02120000
021300         INCLUDE TSHPUNT                                          02130000
021400     END-EXEC.                                                    02140000
021500                                                                  02150000
021600*---------------------------------------------------------------* 02160000
021700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CARTON LOCATION    02170000
021800*  (TSHUNLO)                                                      02180000
021900*---------------------------------------------------------------* 02190000
022000     EXEC SQL                                                     02200000
022100         INCLUDE TSHUNLO                                          02210000
022200     END-EXEC.                                                    02220000
022300                                                                  02230000
022400*---------------------------------------------------------------* 02240000
022500*    DB2 AREA FOR THE INPKSU TABLE                                02250000
022600*---------------------------------------------------------------* 02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE TINPKSU                                         02280000
022900     END-EXEC.                                                    02290000
023000*---------------------------------------------------------------* 02300000
023100*    DB2 AREA FOR THE PACKSLIP TABLE                            * 02310000
023200*---------------------------------------------------------------* 02320000
023300     EXEC SQL                                                     02330000
023400          INCLUDE TPKSLIP                                         02340000
023500     END-EXEC.                                                    02350000
023600*---------------------------------------------------------------* 02360000
023700*    DB2 AREA FOR THE SHIPPING UNIT AUDIT TABLE                 * 02370000
023800*---------------------------------------------------------------* 02380000
023900     EXEC SQL                                                     02390000
024000         INCLUDE TSUNAUD                                          02400000
024100     END-EXEC.                                                    02410000
024200*---------------------------------------------------------------* 02420000
024300*    DB2 AREA FOR THE SHIPPING UNIT AUDIT TRANSACTION TABLE     * 02430000
024400*---------------------------------------------------------------* 02440000
024500     EXEC SQL                                                     02450000
024600         INCLUDE TSUATRN                                          02460000
024700     END-EXEC.                                                    02470000
024800*---------------------------------------------------------------* 02480000
024900*    DB2 AREA FOR THE PO AUDIT EXC TABLE (SUT_PO_AUD_EXC)       * 02490000
025000*---------------------------------------------------------------* 02500000
025100     EXEC SQL                                                     02510000
025200         INCLUDE SUT00014                                         02520000
025300     END-EXEC.                                                    02530000
025400*---------------------------------------------------------------* 02540000
025500*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 02550000
025600*---------------------------------------------------------------* 02560000
025700     EXEC SQL                                                     02570000
025800         INCLUDE SUT00015                                         02580000
025900     END-EXEC.                                                    02590000
026000*---------------------------------------------------------------* 02600000
026100*    DB2 AREA FOR THE VENDOR AUDIT PARM TABLE (SUT_PO_AUD_PARM) * 02610000
026200*---------------------------------------------------------------* 02620000
026300     EXEC SQL                                                     02630000
026400         INCLUDE SUT00017                                         02640000
026500     END-EXEC.                                                    02650000
026600*---------------------------------------------------------------* 02660000
026700*    DB2 AREA FOR THE VENDOR DEPT RANKING TBL (SUT_VND_DEPT_RNKG) 02670000
026800*---------------------------------------------------------------* 02680000
026900     EXEC SQL                                                     02690000
027000         INCLUDE SUT00018                                         02700000
027100     END-EXEC.                                                    02710000
027200*---------------------------------------------------------------* 02720000
027300*    DB2 AREA FOR THE VENDOR RANKING TABLE (SUT_VND_RNKG)       * 02730000
027400*---------------------------------------------------------------* 02740000
027500     EXEC SQL                                                     02750000
027600         INCLUDE SUT00019                                         02760000
027700     END-EXEC.                                                    02770000
027800*---------------------------------------------------------------* 02780000
027900*    DB2 AREA FOR THE DISTRIBUTION HEADER TABLE                 * 02790000
028000*---------------------------------------------------------------* 02800000
028100     EXEC SQL                                                     02810000
028200          INCLUDE TDISTHD                                         02820000
028300     END-EXEC.                                                    02830000
028400*---------------------------------------------------------------* 02840000
028500*    DB2 AREA FOR THE DISTRIBUTION DETAIL TABLE                 * 02850000
028600*---------------------------------------------------------------* 02860000
028700     EXEC SQL                                                     02870000
028800          INCLUDE TDISTDT                                         02880000
028900     END-EXEC.                                                    02890000
029000*---------------------------------------------------------------* 02900000
029100*    DB2 AREA FOR THE RECEIVER ITEM TABLE                       * 02910000
029200*---------------------------------------------------------------* 02920000
029300     EXEC SQL                                                     02930000
029400          INCLUDE TRECITM                                         02940000
029500     END-EXEC.                                                    02950000
029600*---------------------------------------------------------------* 02960000
029700*    DB2 AREA FOR THE PURCHASE ITEM TABLE                       * 02970000
029800*---------------------------------------------------------------* 02980000
029900     EXEC SQL                                                     02990000
030000          INCLUDE TPURITM                                         03000000
030100     END-EXEC.                                                    03010000
030200*---------------------------------------------------------------* 03020000
030300*    DB2 AREA FOR THE SHIPPING UPC TABLE                        * 03030000
030400*---------------------------------------------------------------* 03040000
030500     EXEC SQL                                                     03050000
030600          INCLUDE TSHUUPC                                         03060000
030700     END-EXEC.                                                    03070000
030800*---------------------------------------------------------------* 03080000
030900*    DB2 AREA FOR THE RECEIVING SYSTEM PARM TABLE               * 03090000
031000*---------------------------------------------------------------* 03100000
031100     EXEC SQL                                                     03110000
031200         INCLUDE TKRPRPM                                          03120000
031300     END-EXEC.                                                    03130000
031400*----------------------------------------------------------------*03140000
031500*  COMMUNICATIONS AREA FOR DB2                                   *03150000
031600*----------------------------------------------------------------*03160000
031700     EXEC SQL                                                     03170000
031800         INCLUDE SQLCA                                            03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100                                                                  03210000
032200******************************************************************03220000
032300 LINKAGE SECTION.                                                 03230000
032400******************************************************************03240000
032500 01  DFHCOMMAREA.                                                 03250000
032600     05  FILLER                         OCCURS  1 TO 4072 TIMES   03260000
032700                                      DEPENDING ON EIBCALEN.      03270000
032800         10  FILLER                   PIC X.                      03280000
032900                                                                  03290000
033000******************************************************************03300000
033100 PROCEDURE DIVISION.                                              03310000
033200******************************************************************03320000
033300 0000-PROGRAM-MAINLINE.                                           03330000
033400     MOVE EIBTASKN                 TO  PV-EIBTASKN.               03340000
033500     INITIALIZE                        SU021-CARTON-AUDIT-RECORD. 03350000
033600     MOVE DFHCOMMAREA              TO  SU021-CARTON-AUDIT-RECORD. 03360000
033700                                                                  03370000
033701     PERFORM 9125-GET-START-TMST.                                 03370129
033702                                                                  03370229
033703     SET PS-BLD-INTERNAL-TABLE-NO  TO  TRUE.                      03370306
033704     MOVE 999999999                TO  PV-PARM-SECONDS.           03370417
033710                                                                  03371006
033800     MOVE SPACES                   TO PV-CICS-MSG-AREA.           03380000
033900     INITIALIZE PT-MSG-TABLE.                                     03390000
034000     MOVE 1                        TO PT-MSG-SEQ (PT-MSG-IDX).    03400000
034100                                                                  03410000
034200     IF SU021-PRINT-APPLY                                         03420000
034300        MOVE SU021-OPER-UNT-ID TO DP026-LOCATION-NBR              03430000
034400     ELSE                                                         03440000
034500        PERFORM 0500-FIND-SYSTEM-ID                               03450000
034600        PERFORM 0700-FIND-LOGON-INFO                              03460000
034700     END-IF.                                                      03470000
034800                                                                  03480000
034900     IF DP026-LOCATION-NBR = 90                                   03490000
035000         MOVE SU021-OPER-UNT-ID        TO DK-OPER-UNT-ID          03500000
035100     ELSE                                                         03510000
035200         IF DP026-LOCATION-NBR NOT = SU021-OPER-UNT-ID            03520000
035300             SET SU021-AUDIT-IS-COMPLETE TO TRUE                  03530000
035400             PERFORM 9998-RETURN                                  03540000
035500         ELSE                                                     03550000
035600             MOVE SU021-OPER-UNT-ID        TO DK-OPER-UNT-ID      03560000
035700         END-IF                                                   03570000
035800     END-IF.                                                      03580000
035900     PERFORM 8850-SELECT-TKRPRPM.                                 03590000
035901                                                                  03590129
035910     PERFORM 9100-CHECK-PARA-TRACK-SEC.                           03591028
035920                                                                  03592029
036000     STRING ' SUKCS583 - '                                        03600000
036010            ' PS-SHOW-DEBUG-SW= ' PS-SHOW-DEBUG-SW                03601000
036100         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  03610000
036200     PERFORM 9990-WRITE-CICS.                                     03620000
036300                                                                  03630000
036400* RESERVE THE LOG QUEUE FOR THE EXCLUSIVE USE OF THIS TRANSACTION 03640000
036500* TO KEEP OTHER TRANSACTIONS FROM INTERUPTING THE DISPLAY.        03650000
036600* THIS IS DONE ONLY IF THE DEBUGGING FLAG FOR THE DC IS           03660000
036700* SWITCHED ON.  IF AN ERROR OCCURS WHEN THE FLAG IS OFF,          03670000
036800* WE WILL ENQ THE LOG BEFORE DUMPING THE MESSAGE TABLE.           03680000
036900                                                                  03690000
037000     IF PS-SHOW-DEBUG-INFO                                        03700000
037100         EXEC CICS ENQ                                            03710000
037200             RESOURCE(PC-LOG-QUEUE)                               03720000
037300         END-EXEC                                                 03730000
037400     END-IF.                                                      03740000
037500                                                                  03750000
037520                                                                  03752037
037600     IF SU021-CARTON-CHECK-IN                                     03760000
037700         SET PS-AUDIT-IS-NOT-REQUIRED TO TRUE                     03770000
037800         PERFORM 1000-DETERMINE-IF-AUDIT-REQ                      03780000
037900     ELSE                                                         03790000
038000         IF SU021-CARTON-AUDIT                                    03800000
038100             PERFORM 2000-AUDIT-CARTON-DATA                       03810000
038200         ELSE                                                     03820000
038300             SET SU021-INVALID-REQUEST TO TRUE                    03830000
038400         END-IF                                                   03840000
038500     END-IF.                                                      03850000
038600                                                                  03860000
038601                                                                  03860138
038608                                                                  03860826
038699                                                                  03869931
038700                                                                  03870031
038701                                                                  03870131
038710*                                                                 03871000
038800 0500-FIND-SYSTEM-ID.                                             03880000
038830                                                                  03883006
038900     EXEC CICS                                                    03890000
039000         INQUIRE                                                  03900000
039100             TRANSACTION   (PC-LOGON-TRAN-ID)                     03910000
039200             REMOTESYSTEM  (PV-SYSID)                             03920000
039300             RESP          (PV-CICS-RESPONSE)                     03930000
039400     END-EXEC.                                                    03940000
039500                                                                  03950000
039600     EVALUATE TRUE                                                03960000
039700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03970000
039800             CONTINUE                                             03980000
039900         WHEN OTHER                                               03990000
040000             MOVE '0500-FIND-SYSTEM-ID'                           04000000
040100                 TO DP013-PARAGRAPH                               04010000
040200             MOVE 'UNABLE TO DETERMINE SYSTEM ID'                 04020000
040300                 TO DP013-MESSAGE-TEXT (1)                        04030000
040400             SET DP013-CICS-ABEND      TO  TRUE                   04040000
040500             SET DP013-NO-ROLLBACK     TO  TRUE                   04050000
040600             PERFORM 9999-WRITE-CICS-LOG-MSG                      04060000
040700             SET PS-DUMP-TO-LOG       TO TRUE                     04070000
040800     END-EVALUATE.                                                04080000
040900*                                                                 04090000
041000 0700-FIND-LOGON-INFO.                                            04100000
041050                                                                  04105006
041100     MOVE LENGTH OF DP026-SIGN-ON-INFO                            04110000
041200                    TO  PV-SIGN-ON-INFO-LENGTH.                   04120000
041300     MOVE EIBTRMID  TO  TS-INFO-QUEUE-TERMINAL.                   04130000
041400     MOVE +1        TO  PV-TS-ITEM.                               04140000
041500                                                                  04150000
041600     IF PV-SYSID = SPACES                                         04160000
041700         EXEC CICS                                                04170000
041800             READQ TS                                             04180000
041900                 QUEUE  (TS-INFO-QUEUE-NAME)                      04190000
042000                 ITEM   (PV-TS-ITEM)                              04200000
042100                 INTO   (DP026-SIGN-ON-INFO)                      04210000
042200                 RESP   (PV-CICS-RESPONSE)                        04220000
042300         END-EXEC                                                 04230000
042400     ELSE                                                         04240000
042500         EXEC CICS                                                04250000
042600             READQ TS                                             04260000
042700                 QUEUE   (TS-INFO-QUEUE-NAME)                     04270000
042800                 SYSID   (PV-SYSID)                               04280000
042900                 ITEM    (PV-TS-ITEM)                             04290000
043000                 INTO    (DP026-SIGN-ON-INFO)                     04300000
043100                 LENGTH  (PV-SIGN-ON-INFO-LENGTH)                 04310000
043200                 RESP    (PV-CICS-RESPONSE)                       04320000
043300         END-EXEC                                                 04330000
043400     END-IF.                                                      04340000
043500                                                                  04350000
043600     EVALUATE TRUE                                                04360000
043700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04370000
043800             CONTINUE                                             04380000
043900         WHEN OTHER                                               04390000
044000             MOVE '0700-FIND-LOGON-INFO'                          04400000
044100                 TO DP013-PARAGRAPH                               04410000
044200             MOVE 'UNABLE TO READ LOGON TSQ'                      04420000
044300                 TO DP013-MESSAGE-TEXT (1)                        04430000
044400             MOVE SU021-PO-NUMBER    TO PV-DISPLAY-PO-NBR         04440000
044500             MOVE SU021-LINE-NBR     TO PV-DISPLAY-PO-LINE-NBR    04450000
044600             MOVE SU021-OPER-UNT-ID  TO PV-DISPLAY-OPER-UNT-ID    04460000
044700             MOVE SU021-SHIPT-UNT-ID TO PV-DISPLAY-SHIPT-UNT-ID   04470000
044710             STRING ' SUKCS583 - '                                04471000
044800                    ' PO = '                                      04480000
044900               PV-DISPLAY-PO-NBR                                  04490000
045000               ' LINE = '                                         04500000
045100               PV-DISPLAY-PO-LINE-NBR                             04510000
045110               ' OPER = '                                         04511000
045111               PV-DISPLAY-OPER-UNT-ID                             04511100
045112               DELIMITED BY SIZE                                  04511200
045113               INTO DP013-MESSAGE-TEXT (2)                        04511300
045114             STRING ' SUKCS583 - '                                04511400
045115                    ' CARTON = '                                  04511500
045116               PV-DISPLAY-SHIPT-UNT-ID                            04511600
045117               DELIMITED BY SIZE                                  04511700
045118               INTO DP013-MESSAGE-TEXT (3)                        04511800
045119             SET DP013-CICS-ABEND     TO TRUE                     04511900
045120             SET DP013-NO-ROLLBACK    TO TRUE                     04512000
045121             PERFORM 9999-WRITE-CICS-LOG-MSG                      04512100
045130     END-EVALUATE.                                                04513000
045140*-----------------------------------------------------------------04514000
045150*DETERMINE IF AN AUDIT IS NEEDED FOR THIS PO                      04515000
045160*-----------------------------------------------------------------04516000
045170 1000-DETERMINE-IF-AUDIT-REQ.                                     04517000
045171                                                                  04517106
045172     IF  PS-BLD-INTERNAL-TABLE-YES                                04517206
045173         MOVE '1000'  TO  PV-CSSL-PARA                            04517306
045174         PERFORM 9120-INTERNAL-TABLE                              04517406
045175     END-IF.                                                      04517506
045176                                                                  04517606
045177     STRING ' SUKCS583 - '                                        04517700
045180            ' 1000-DETERMINE-IF-AUDIT-REQ'                        04518000
045190         DELIMITED BY SIZE                                        04519000
045200         INTO PV-CICS-MSG-AREA.                                   04520000
045300     PERFORM 9990-WRITE-CICS.                                     04530000
045400     MOVE SU021-CARTON-AUDIT-RECORD                               04540000
045500           TO PV-CICS-MSG-AREA.                                   04550000
045600     PERFORM 9990-WRITE-CICS.                                     04560000
045700     MOVE SU021-PO-NUMBER         TO DK-PO-NBR.                   04570000
045800     IF SU021-PACKAGE-TYPE-CODE = 'BC'                            04580000
045900         MOVE SU021-LINE-NBR          TO DK-PO-LINE-NBR           04590000
046000     ELSE                                                         04600000
046100         MOVE 0                       TO DK-PO-LINE-NBR           04610000
046200     END-IF.                                                      04620000
046300     IF SU021-PACKAGE-TYPE-CODE = 'PP'                            04630000
046400         MOVE SU021-PRE-PACK-ID       TO DK-PREPK-ID              04640000
046500     ELSE                                                         04650000
046600         MOVE 0                       TO DK-PREPK-ID              04660000
046700     END-IF.                                                      04670000
046800     MOVE SU021-REC-SEQ-NBR       TO DK-RCVR-SEQ-NBR.             04680000
046900     MOVE SU021-INBOUND-TRIP-ID   TO DK-INBND-TRIP-ID.            04690000
047000     MOVE SU021-SHIPT-UNT-ID      TO DK-SHIPT-UNT-ID.             04700000
047100*  CHECK IF SUT_PO_AUD_REQ RECORDS EXIST                          04710000
047200     PERFORM 7000-SELECT-REQ-INFO.                                04720000
047300                                                                  04730000
047400     IF PS-REQ-REC-FOUND                                          04740000
047500         MOVE SUT00015-AUD-CNTL-NBR   TO SU021-AUDIT-NUMBER       04750000
047600         PERFORM 9000-SELECT-CARTON                               04760000
047700     END-IF.                                                      04770000
047800*   CHECK IF AUDIT IS ALREADY DONE                                04780000
047900     IF NOT SU021-DB2-ERROR AND                                   04790000
048000        PS-REQ-REC-FOUND AND                                      04800000
048100        (SUT00015-CART-PRMPT-CDE = 'D' OR                         04810000
048200         SUT00015-CART-PRMPT-CDE = 'F')                           04820000
048300         IF SUT00015-CART-PRMPT-CDE = 'D'                         04830000
048400             IF SUT00015-AUD-STAT-CDE = 'P' OR                    04840000
048500                SUT00015-AUD-STAT-CDE = 'N'                       04850000
048600                 SET SU021-AUDIT-IS-COMPLETE TO TRUE              04860000
048700             ELSE                                                 04870000
048800                 IF SUT00015-AUD-STAT-CDE = 'F'                   04880000
048900                     SET SU021-REWORK  TO TRUE                    04890000
049000                 ELSE                                             04900000
049100***    SUT00015-AUD-STAT-CDE = 'I'                                04910000
049200                     SET SU021-AUDIT-PENDING TO TRUE              04920000
049300                 END-IF                                           04930000
049400             END-IF                                               04940000
049500         ELSE                                                     04950000
049600             SET SU021-REWORK TO TRUE                             04960000
049700     ELSE                                                         04970000
049800       IF NOT SU021-DB2-ERROR                                     04980000
049900*   IF NO SUT_PO_AUD_REQ FOUND, GET DEPT AND ENT-ID               04990000
050000         IF PS-NO-REQ-REC-FOUND                                   05000000
050100             PERFORM 7150-RETREIVE-PO-INFO                        05010000
050200             MOVE PURCHS-DEPT-NBR         TO DK-DEPT-NBR          05020000
050300             MOVE PURCHS-ENT-ID           TO DK-ENT-ID            05030000
050400         ELSE                                                     05040000
050500             MOVE SUT00015-DEPT-NBR       TO DK-DEPT-NBR          05050000
050600             MOVE SUT00015-ENT-ID         TO DK-ENT-ID            05060000
050700             SET PS-PO-INFO-FOUND TO TRUE                         05070000
050800         END-IF                                                   05080000
050900         IF PS-PO-INFO-FOUND                                      05090000
051000*DMH         PERFORM 1100-RETREIVE-VENDOR-RANKING                 05100000
051100*DMH         IF SUT00017-AUD-PCT = 0                              05110000
051200*DMH             SET SU021-AUDIT-IS-COMPLETE TO TRUE              05120000
051300*DMH         ELSE                                                 05130000
051400*DMH           PERFORM 7850-SELECT-DC-PASSED                      05140000
051500*DMH           IF PV-PASSED-COUNT > 0                             05150000
051600*DMH             SET SU021-AUDIT-IS-COMPLETE TO TRUE              05160000
051700*DMH           ELSE                                               05170000
051800*DMH             PERFORM 1200-CHECK-PO-AUDIT-EXC                  05180000
051900*                                                                 05190000
052000* DMH BEGIN 03/07/02                                              05200000
052100             IF PS-REQ-REC-FOUND                                  05210000
052200                PERFORM 7190-RETREIVE-PO-AUD-PARM                 05220000
052300             ELSE                                                 05230000
052400                PERFORM 1100-RETREIVE-VENDOR-RANKING              05240000
052500             END-IF                                               05250000
052501             MOVE SU021-PO-NUMBER TO                              05250150
052502                  DK-BYPASS-PO-NBR                                05250250
052503             MOVE SU021-REC-SEQ-NBR TO                            05250350
052504                  DK-BYPASS-REC-SEQ-NBR                           05250450
052600             PERFORM 1200-CHECK-PO-AUDIT-EXC                      05260000
052610             PERFORM 7100-CHECK-FOR-BYPASS                        05261051
052700             IF  SUT00017-AUD-PCT = 0   AND                       05270000
052800                 PS-NO-LINE-LEVEL-FOUND AND                       05280000
052900                 PS-NO-PO-LEVEL-FOUND                             05290000
053000                 IF PS-NO-REQ-REC-FOUND                           05300000
053100                     SET SU021-AUDIT-IS-COMPLETE TO TRUE          05310000
053200                 ELSE                                             05320000
053300                     PERFORM 1430-DETERMINE-STAT-CDE              05330000
053400                 END-IF                                           05340000
053500             ELSE                                                 05350000
053600               PERFORM 1400-CHECK-FOR-IN-PROCES-AUDIT             05360000
053700*   AUDIT HAS BEEN STARTED FOR THIS DC                            05370000
053800               IF PS-AUDIT-STARTED                                05380000
053900                 PERFORM 1430-DETERMINE-STAT-CDE                  05390000
054000               ELSE                                               05400000
054100                 PERFORM 7850-SELECT-DC-PASSED                    05410000
054200                 IF  PV-PASSED-COUNT > 0    AND                   05420000
054300                     PS-NO-LINE-LEVEL-FOUND AND                   05430000
054400                     PS-NO-PO-LEVEL-FOUND                         05440000
054500                     SET SU021-AUDIT-IS-COMPLETE TO TRUE          05450000
054600                 ELSE                                             05460000
054700* DMH END 03/07/02                                                05470000
054800                                                                  05480000
054900*   NO RECORDS EXIST IN THE SUT_PO_AUD_EXC TABLE                  05490000
055000                   IF PS-NO-LINE-LEVEL-FOUND AND                  05500000
055100                      PS-NO-PO-LEVEL-FOUND                        05510000
055200                     PERFORM 1300-CHECK-PO-AUDIT-REQ              05520000
055300                     PERFORM 1410-CHECK-PROMPTED-LINES            05530000
055400*   SOME FAILED AUDITS HAVE BEEN FOUND                            05540000
055500                     IF PS-FAILED-AUDITS-FOUND                    05550000
055600                         SET SU021-AUDIT-REQUIRED TO TRUE         05560000
055700                         PERFORM 1500-CALCULATE-QUANTITIES        05570000
055800                         PERFORM 1600-INSERT-INTO-TABLES          05580000
055900                     ELSE                                         05590000
056000*   SOME PASSED AUDITS HAVE BEEN FOUND FOR THIS ITEM              05600000
056100                       IF PS-PASSED-AUDITS-FOUND                  05610000
056200                         IF SUT00017-CKD-DC-QTY > PV-PASSED-COUNT 05620000
056300*        CHECK THE NUMBER OF LINES FOR THE PO-RCVR PROMPTED       05630000
056400                             IF  PV-PROMPTED-CNT >=               05640000
056500                                 SUT00017-MAX-PO-LNE-QTY AND      05650000
056600                                 SUT00017-MAX-PO-LNE-QTY > 0      05660000
056700                                   SET SU021-AUDIT-IS-COMPLETE    05670000
056800                                       TO TRUE                    05680000
056900                             ELSE                                 05690000
057000                                 SET SU021-AUDIT-REQUIRED         05700000
057100                                     TO TRUE                      05710000
057200                                 PERFORM                          05720000
057300                                     1500-CALCULATE-QUANTITIES    05730000
057400                                 PERFORM                          05740000
057500                                      1600-INSERT-INTO-TABLES     05750000
057600                             END-IF                               05760000
057700                         ELSE                                     05770000
057800                             SET SU021-AUDIT-IS-COMPLETE TO TRUE  05780000
057900                         END-IF                                   05790000
058000*    NO FAILED OR PASSED AUDITS HAVE BEEN FOUND                   05800000
058100                       ELSE                                       05810000
058200*        CHECK THE NUMBER OF LINES FOR THE PO-RCVR PROMPTED       05820000
058300                         IF  PV-PROMPTED-CNT >=                   05830000
058400                             SUT00017-MAX-PO-LNE-QTY  AND         05840000
058500                             SUT00017-MAX-PO-LNE-QTY > 0          05850000
058600                               SET SU021-AUDIT-IS-COMPLETE        05860000
058700                                       TO TRUE                    05870000
058800                         ELSE                                     05880000
058900                             SET SU021-AUDIT-REQUIRED TO TRUE     05890000
059000                             PERFORM 1500-CALCULATE-QUANTITIES    05900000
059100                             PERFORM 1600-INSERT-INTO-TABLES      05910000
059200                         END-IF                                   05920000
059300                       END-IF                                     05930000
059400                     END-IF                                       05940000
059500*   A RECORD EXIST IN THE SUT_PO_AUD_EXC TABLE                    05950000
059600                   ELSE                                           05960000
059700                     PERFORM 1700-RETURN-WITH-EXC-VALUES          05970000
059800                   END-IF                                         05980000
059900                 END-IF                                           05990000
060000               END-IF                                             06000000
060100             END-IF                                               06010000
060200         ELSE                                                     06020000
060300             SET SU021-DB2-ERROR TO TRUE                          06030000
060400         END-IF                                                   06040000
060500       END-IF                                                     06050000
060600     END-IF.                                                      06060000
060700                                                                  06070000
060800     PERFORM 9998-RETURN.                                         06080000
060900                                                                  06090000
061000*-----------------------------------------------------------------06100000
061100*RETRIEVE THE VENDOR RANKING FOR THE PO                           06110000
061200*-----------------------------------------------------------------06120000
061300 1100-RETREIVE-VENDOR-RANKING.                                    06130000
061301                                                                  06130106
061302     IF  PS-BLD-INTERNAL-TABLE-YES                                06130206
061303         MOVE '1100'  TO  PV-CSSL-PARA                            06130306
061304         PERFORM 9120-INTERNAL-TABLE                              06130406
061305     END-IF.                                                      06130506
061306                                                                  06130606
061310     STRING ' SUKCS583 - '                                        06131000
061400            ' 1100-RETREIVE-VENDOR-RANKING'                       06140000
061500         DELIMITED BY SIZE                                        06150000
061600         INTO PV-CICS-MSG-AREA.                                   06160000
061700     PERFORM 9990-WRITE-CICS.                                     06170000
061800     MOVE SU021-PACKAGE-TYPE-CODE TO DK-PKGNG-TYP-CDE.            06180000
061900     IF PS-REQ-REC-FOUND                                          06190000
062000         PERFORM 7200-RETREIVE-VENDOR-DEPT                        06200000
062100         IF PS-NO-DEPT-RANK-FOUND                                 06210000
062200             PERFORM 7300-RETREIVE-VENDOR-RANK                    06220000
062300             IF PS-NO-VEND-RANK-FOUND                             06230000
062400                 PERFORM 7400-RETREIVE-DEFAULT-RANK               06240000
062500                 IF PS-DEFAULT-RANK-FOUND                         06250000
062600                     MOVE 'DEFAULT RANK FOUND '                   06260000
062700                                     TO PV-CICS-MSG-AREA          06270000
062800                     PERFORM 9990-WRITE-CICS                      06280000
062900                     MOVE SUT00017-CK-AFT-DAY-QTY                 06290000
063000                          TO PV-DISPLAY-CK-AFT-DAY-QTY            06300000
063010                     STRING ' SUKCS583 - '                        06301000
063100                            'CHECK AFTER DAYS = '                 06310000
063200                                   DELIMITED BY SIZE              06320000
063300                             PV-DISPLAY-CK-AFT-DAY-QTY            06330000
063400                                   DELIMITED BY SIZE              06340000
063500                                   INTO PV-CICS-MSG-AREA          06350000
063600                     PERFORM 9990-WRITE-CICS                      06360000
063700                     MOVE PV-LIMIT-DAYS                           06370000
063800                               TO PV-DISPLAY-LIMIT-DAYS           06380000
063810                     STRING ' SUKCS583 - '                        06381000
063900                            'PV-LIMIT-DAYS  = '                   06390000
064000                                   DELIMITED BY SIZE              06400000
064100                            PV-DISPLAY-LIMIT-DAYS                 06410000
064200                                   DELIMITED BY SIZE              06420000
064300                                   INTO PV-CICS-MSG-AREA          06430000
064400                     PERFORM 9990-WRITE-CICS                      06440000
064500                 END-IF                                           06450000
064600             ELSE                                                 06460000
064700                 MOVE 'VEND RANK FOUND '                          06470000
064800                                 TO PV-CICS-MSG-AREA              06480000
064900                 PERFORM 9990-WRITE-CICS                          06490000
065000                 MOVE SUT00017-CK-AFT-DAY-QTY                     06500000
065100                      TO PV-DISPLAY-CK-AFT-DAY-QTY                06510000
065110                 STRING ' SUKCS583 - '                            06511000
065200                        'CHECK AFTER DAYS = '                     06520000
065300                               DELIMITED BY SIZE                  06530000
065400                         PV-DISPLAY-CK-AFT-DAY-QTY                06540000
065500                               DELIMITED BY SIZE                  06550000
065600                               INTO PV-CICS-MSG-AREA              06560000
065700                 PERFORM 9990-WRITE-CICS                          06570000
065800                 MOVE PV-LIMIT-DAYS                               06580000
065900                           TO PV-DISPLAY-LIMIT-DAYS               06590000
065910                 STRING ' SUKCS583 - '                            06591000
066000                        'PV-LIMIT-DAYS  = '                       06600000
066100                               DELIMITED BY SIZE                  06610000
066200                        PV-DISPLAY-LIMIT-DAYS                     06620000
066300                               DELIMITED BY SIZE                  06630000
066400                               INTO PV-CICS-MSG-AREA              06640000
066500                 PERFORM 9990-WRITE-CICS                          06650000
066600             END-IF                                               06660000
066700         ELSE                                                     06670000
066800             MOVE 'DEPT RANK FOUND '                              06680000
066900                                 TO PV-CICS-MSG-AREA              06690000
067000             PERFORM 9990-WRITE-CICS                              06700000
067100             MOVE SUT00017-CK-AFT-DAY-QTY                         06710000
067200                  TO PV-DISPLAY-CK-AFT-DAY-QTY                    06720000
067210             STRING ' SUKCS583 - '                                06721000
067300                    'CHECK AFTER DAYS = '                         06730000
067400                           DELIMITED BY SIZE                      06740000
067500                     PV-DISPLAY-CK-AFT-DAY-QTY                    06750000
067600                           DELIMITED BY SIZE                      06760000
067700                           INTO PV-CICS-MSG-AREA                  06770000
067800             PERFORM 9990-WRITE-CICS                              06780000
067900             MOVE PV-LIMIT-DAYS                                   06790000
068000                       TO PV-DISPLAY-LIMIT-DAYS                   06800000
068010             STRING ' SUKCS583 - '                                06801000
068100                    'PV-LIMIT-DAYS  = '                           06810000
068200                           DELIMITED BY SIZE                      06820000
068300                    PV-DISPLAY-LIMIT-DAYS                         06830000
068400                           DELIMITED BY SIZE                      06840000
068500                           INTO PV-CICS-MSG-AREA                  06850000
068600             PERFORM 9990-WRITE-CICS                              06860000
068700         END-IF                                                   06870000
068800     ELSE                                                         06880000
068900         PERFORM 7250-RETREIVE-VENDOR-DEPT                        06890000
069000         IF PS-NO-DEPT-RANK-FOUND                                 06900000
069100             PERFORM 7350-RETREIVE-VENDOR-RANK                    06910000
069200             IF PS-NO-VEND-RANK-FOUND                             06920000
069300                 PERFORM 7450-RETREIVE-DEFAULT-RANK               06930000
069400                 IF PS-DEFAULT-RANK-FOUND                         06940000
069500                     MOVE 'DEFAULT RANK FOUND '                   06950000
069600                                     TO PV-CICS-MSG-AREA          06960000
069700                     PERFORM 9990-WRITE-CICS                      06970000
069800                     MOVE SUT00017-CK-AFT-DAY-QTY                 06980000
069900                          TO PV-DISPLAY-CK-AFT-DAY-QTY            06990000
069910                     STRING ' SUKCS583 - '                        06991000
070000                            'CHECK AFTER DAYS = '                 07000000
070100                                   DELIMITED BY SIZE              07010000
070200                             PV-DISPLAY-CK-AFT-DAY-QTY            07020000
070300                                   DELIMITED BY SIZE              07030000
070400                                   INTO PV-CICS-MSG-AREA          07040000
070500                     PERFORM 9990-WRITE-CICS                      07050000
070600                     MOVE PV-LIMIT-DAYS                           07060000
070700                               TO PV-DISPLAY-LIMIT-DAYS           07070000
070710                     STRING ' SUKCS583 - '                        07071000
070800                            'PV-LIMIT-DAYS  = '                   07080000
070900                                   DELIMITED BY SIZE              07090000
071000                            PV-DISPLAY-LIMIT-DAYS                 07100000
071100                                   DELIMITED BY SIZE              07110000
071200                                   INTO PV-CICS-MSG-AREA          07120000
071300                     PERFORM 9990-WRITE-CICS                      07130000
071400                 END-IF                                           07140000
071500             ELSE                                                 07150000
071600                 MOVE 'VEND RANK FOUND '                          07160000
071700                                 TO PV-CICS-MSG-AREA              07170000
071800                 PERFORM 9990-WRITE-CICS                          07180000
071900                 MOVE SUT00017-CK-AFT-DAY-QTY                     07190000
072000                      TO PV-DISPLAY-CK-AFT-DAY-QTY                07200000
072010                 STRING ' SUKCS583 - '                            07201000
072100                        'CHECK AFTER DAYS = '                     07210000
072200                               DELIMITED BY SIZE                  07220000
072300                         PV-DISPLAY-CK-AFT-DAY-QTY                07230000
072400                               DELIMITED BY SIZE                  07240000
072500                               INTO PV-CICS-MSG-AREA              07250000
072600                 PERFORM 9990-WRITE-CICS                          07260000
072700                 MOVE PV-LIMIT-DAYS                               07270000
072800                           TO PV-DISPLAY-LIMIT-DAYS               07280000
072810                 STRING ' SUKCS583 - '                            07281000
072900                        'PV-LIMIT-DAYS  = '                       07290000
073000                               DELIMITED BY SIZE                  07300000
073100                        PV-DISPLAY-LIMIT-DAYS                     07310000
073200                               DELIMITED BY SIZE                  07320000
073300                               INTO PV-CICS-MSG-AREA              07330000
073400                 PERFORM 9990-WRITE-CICS                          07340000
073500             END-IF                                               07350000
073600         ELSE                                                     07360000
073700             MOVE 'DEPT RANK FOUND '                              07370000
073800                                 TO PV-CICS-MSG-AREA              07380000
073900             PERFORM 9990-WRITE-CICS                              07390000
074000             MOVE SUT00017-CK-AFT-DAY-QTY                         07400000
074100                  TO PV-DISPLAY-CK-AFT-DAY-QTY                    07410000
074110             STRING ' SUKCS583 - '                                07411000
074200                    'CHECK AFTER DAYS = '                         07420000
074300                           DELIMITED BY SIZE                      07430000
074400                     PV-DISPLAY-CK-AFT-DAY-QTY                    07440000
074500                           DELIMITED BY SIZE                      07450000
074600                           INTO PV-CICS-MSG-AREA                  07460000
074700             PERFORM 9990-WRITE-CICS                              07470000
074800             MOVE PV-LIMIT-DAYS                                   07480000
074900                       TO PV-DISPLAY-LIMIT-DAYS                   07490000
074910             STRING ' SUKCS583 - '                                07491000
075000                    'PV-LIMIT-DAYS  = '                           07500000
075100                           DELIMITED BY SIZE                      07510000
075200                    PV-DISPLAY-LIMIT-DAYS                         07520000
075300                           DELIMITED BY SIZE                      07530000
075400                           INTO PV-CICS-MSG-AREA                  07540000
075500             PERFORM 9990-WRITE-CICS                              07550000
075600         END-IF                                                   07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900*-----------------------------------------------------------------07590000
076000*CHECK TO SEE IF THE PO NEEDS TO BE AUDITED                       07600000
076100*-----------------------------------------------------------------07610000
076200 1200-CHECK-PO-AUDIT-EXC.                                         07620000
076201                                                                  07620106
076202     IF  PS-BLD-INTERNAL-TABLE-YES                                07620206
076203         MOVE '1200'  TO  PV-CSSL-PARA                            07620306
076204         PERFORM 9120-INTERNAL-TABLE                              07620406
076205     END-IF.                                                      07620506
076206                                                                  07620606
076210     STRING ' SUKCS583 - '                                        07621000
076300            ' 1200-CHECK-PO-AUDIT-EXC'                            07630000
076400         DELIMITED BY SIZE                                        07640000
076500         INTO PV-CICS-MSG-AREA.                                   07650000
076600     PERFORM 9990-WRITE-CICS.                                     07660000
076700*  FOR PRE-PAC 'PP' OR BULK 'BC' ORDERS, PERFORM THE LINE OR PACK 07670000
076800*  ID CHECK                                                       07680000
076900     SET PS-NO-LINE-LEVEL-FOUND                                   07690000
077000         PS-NO-PO-LEVEL-FOUND    TO TRUE.                         07700000
077100     IF SU021-PACKAGE-TYPE-CODE = 'BC'                            07710000
077200         PERFORM 7500-SELECT-BULK                                 07720000
077300     ELSE                                                         07730000
077400         IF SU021-PACKAGE-TYPE-CODE = 'PP'                        07740000
077500             PERFORM 7550-SELECT-PRE-PACK                         07750000
077600         END-IF                                                   07760000
077700     END-IF.                                                      07770000
077800     IF PS-NO-LINE-LEVEL-FOUND                                    07780000
077900         PERFORM 7600-SELECT-PO-LEVEL                             07790000
078000     END-IF.                                                      07800000
078100                                                                  07810000
078200*-----------------------------------------------------------------07820000
078300*CHECK TO SEE IF THE PO NEEDS TO BE AUDITED                       07830000
078400*-----------------------------------------------------------------07840000
078500 1300-CHECK-PO-AUDIT-REQ.                                         07850000
078501                                                                  07850106
078502     IF  PS-BLD-INTERNAL-TABLE-YES                                07850206
078503         MOVE '1300'  TO  PV-CSSL-PARA                            07850306
078504         PERFORM 9120-INTERNAL-TABLE                              07850406
078505     END-IF.                                                      07850506
078506                                                                  07850606
078510     STRING ' SUKCS583 - '                                        07851000
078600            ' 1300-CHECK-PO-AUDIT-REQ'                            07860000
078700         DELIMITED BY SIZE                                        07870000
078800         INTO PV-CICS-MSG-AREA.                                   07880000
078900     PERFORM 9990-WRITE-CICS.                                     07890000
079000     SET PS-NO-FAILED-AUDITS-FOUND                                07900000
079100         PS-NO-PASSED-AUDITS-FOUND    TO TRUE.                    07910000
079200     PERFORM 7700-SELECT-FAILED.                                  07920000
079300     IF PS-NO-FAILED-AUDITS-FOUND                                 07930000
079400         PERFORM 7800-SELECT-PASSED                               07940000
079500     END-IF.                                                      07950000
079600                                                                  07960000
079700*  AN AUDIT FOR THIS PO (LINE OR PREPACK-ID) HAS FAILED, SO       07970000
079800*  THIS CARTON MUST BE AUDITED                                    07980000
079900                                                                  07990000
080000     IF PS-FAILED-AUDITS-FOUND                                    08000000
080100         SET PS-AUDIT-IS-REQUIRED TO TRUE                         08010000
080200     END-IF.                                                      08020000
080300                                                                  08030000
080400                                                                  08040000
080500*-----------------------------------------------------------------08050000
080600*                                                                 08060000
080700*                                                                 08070000
080800*-----------------------------------------------------------------08080000
080900 1400-CHECK-FOR-IN-PROCES-AUDIT.                                  08090000
080901                                                                  08090106
080902     IF  PS-BLD-INTERNAL-TABLE-YES                                08090206
080903         MOVE '1400'  TO  PV-CSSL-PARA                            08090306
080904         PERFORM 9120-INTERNAL-TABLE                              08090406
080905     END-IF.                                                      08090506
080906                                                                  08090606
080910     STRING ' SUKCS583 - '                                        08091000
081000            ' 1400-CHECK-FOR-IN-PROCES-AUDIT'                     08100000
081100         DELIMITED BY SIZE                                        08110000
081200         INTO PV-CICS-MSG-AREA.                                   08120000
081300     PERFORM 9990-WRITE-CICS.                                     08130000
081400     PERFORM 7900-SELECT-THIS-FACILITY.                           08140000
081500                                                                  08150000
081600                                                                  08160000
081700*-----------------------------------------------------------------08170000
081800*                                                                 08180000
081900*                                                                 08190000
082000*-----------------------------------------------------------------08200000
082100 1410-CHECK-PROMPTED-LINES.                                       08210000
082101                                                                  08210106
082102     IF  PS-BLD-INTERNAL-TABLE-YES                                08210206
082103         MOVE '1410'  TO  PV-CSSL-PARA                            08210306
082104         PERFORM 9120-INTERNAL-TABLE                              08210406
082105     END-IF.                                                      08210506
082106                                                                  08210606
082110     STRING ' SUKCS583 - '                                        08211000
082200            ' 1410-CHECK-PROMPTED-LINES'                          08220000
082300         DELIMITED BY SIZE                                        08230000
082400         INTO PV-CICS-MSG-AREA.                                   08240000
082500     PERFORM 9990-WRITE-CICS.                                     08250000
082600     PERFORM 7950-SELECT-PROMPTED-LINES.                          08260000
082700                                                                  08270000
082800                                                                  08280000
082900*-----------------------------------------------------------------08290000
083000*                                                                 08300000
083100*                                                                 08310000
083200*-----------------------------------------------------------------08320000
083300 1430-DETERMINE-STAT-CDE.                                         08330000
083301                                                                  08330106
083302     IF  PS-BLD-INTERNAL-TABLE-YES                                08330206
083303         MOVE '1430'  TO  PV-CSSL-PARA                            08330306
083304         PERFORM 9120-INTERNAL-TABLE                              08330406
083305     END-IF.                                                      08330506
083306                                                                  08330606
083310     STRING ' SUKCS583 - '                                        08331000
083400            ' 1430-DETERMINE-STAT-CDE'                            08340000
083500         DELIMITED BY SIZE                                        08350000
083600         INTO PV-CICS-MSG-AREA.                                   08360000
083700     PERFORM 9990-WRITE-CICS.                                     08370000
083800**    AUDIT IS NO LONGER NEEDED OR HAS PASSED AN AUDIT            08380000
083900     IF SUT00015-AUD-STAT-CDE = PC-N OR                           08390000
084000        SUT00015-AUD-STAT-CDE = PC-P                              08400000
084100         SET SU021-AUDIT-IS-COMPLETE TO TRUE                      08410000
084200     ELSE                                                         08420000
084300**    HAS FAILED AN AUDIT                                         08430000
084400         IF SUT00015-AUD-STAT-CDE = PC-F                          08440000
084500             SET SU021-REWORK TO TRUE                             08450000
084600         ELSE                                                     08460000
084700**    AN AUDIT IS IN-PROCESS                                      08470000
084800             IF SUT00015-AUD-STAT-CDE = PC-I                      08480000
084900                 MOVE SUT00015-AUD-CNTL-NBR  TO PV-AUDIT-CNTL-NBR 08490000
085000                                                DK-AUDIT-CNTL-NBR 08500000
085100*  IF THIS CARTON HAS ALREADY BEEN SCANNED, GO THROUGH THE LOGIC  08510000
085200*  THIS FAR TO DETERMINBE THE RETURN STATUS - DO NOT DO ANY       08520000
085300*  INSERTS OR UPDATES ON THE DATABASES.                           08530000
085400                 IF PS-CARTON-ALREADY-EXISTS AND                  08540000
085500                    SUT00015-AUD-CNTL-NBR = SUATRN-AUD-CNTL-NBR   08550000
085600                     SET SU021-AUDIT-PENDING  TO TRUE             08560000
085700                 ELSE                                             08570000
085800                     PERFORM 1460-CHECK-IF-PROMPTING-DONE         08580000
085900                 END-IF                                           08590000
086000             END-IF                                               08600000
086100         END-IF                                                   08610000
086200     END-IF.                                                      08620000
086300                                                                  08630000
086400 1460-CHECK-IF-PROMPTING-DONE.                                    08640000
086401                                                                  08640106
086402     IF  PS-BLD-INTERNAL-TABLE-YES                                08640206
086403         MOVE '1460'  TO  PV-CSSL-PARA                            08640306
086404         PERFORM 9120-INTERNAL-TABLE                              08640406
086405     END-IF.                                                      08640506
086406                                                                  08640606
086410     STRING ' SUKCS583 - '                                        08641000
086500            ' 1460-CHECK-IF-PROMPTING-DONE'                       08650000
086600         DELIMITED BY SIZE                                        08660000
086700         INTO PV-CICS-MSG-AREA.                                   08670000
086800     PERFORM 9990-WRITE-CICS.                                     08680000
086900*    DETERMINE UNIT COUNT                                         08690000
087000     IF SU021-PACKAGE-TYPE-CODE = 'BC'                            08700000
087100         PERFORM 8100-SUM-PROMPTED-UNITS                          08710000
087200         PERFORM 8150-SELECT-CURRENT-CARTON                       08720000
087300         PERFORM 1660-BUILD-TSUATRN                               08730000
087400         IF PS-DUMP-TO-LOG                                        08740000
087500             CONTINUE                                             08750000
087600         ELSE                                                     08760000
087700             IF SUT00015-UNT-QTY >                                08770000
087800                          (SHUUPC-SHPD-QTY + PV-SHPD-QTY-SUM)     08780000
087900                 PERFORM 8200-SUM-CARTONS                         08790000
088000                 IF SUT00015-CART-QTY > PV-CARTON-COUNT           08800000
088100                     CONTINUE                                     08810000
088200                 ELSE                                             08820000
088300                     PERFORM 1490-UPDATE-REQ-BY-TYPE              08830000
088400                 END-IF                                           08840000
088500             ELSE                                                 08850000
088600                 PERFORM 1490-UPDATE-REQ-BY-TYPE                  08860000
088700             END-IF                                               08870000
088800             SET SU021-AUDIT-REQUIRED TO TRUE                     08880000
088900         END-IF                                                   08890000
089000     ELSE                                                         08900000
089100         IF SU021-PACKAGE-TYPE-CODE = 'PP'                        08910000
089200             MOVE SU021-DRIVER-LINE-NBR TO DK-PO-DRIVER-LINE      08920000
089300             PERFORM 8900-SUM-PP-PROMPTED-UNITS                   08930000
089400             PERFORM 8950-SELECT-CURRENT-PP-CARTON                08940000
089500             PERFORM 1660-BUILD-TSUATRN                           08950000
089600             IF PS-DUMP-TO-LOG                                    08960000
089700                 CONTINUE                                         08970000
089800             ELSE                                                 08980000
089900                 IF SUT00015-UNT-QTY >                            08990000
090000                          (SHUUPC-SHPD-QTY + PV-SHPD-QTY-SUM)     09000000
090100                     PERFORM 8200-SUM-CARTONS                     09010000
090200                     IF SUT00015-CART-QTY > PV-CARTON-COUNT       09020000
090300                         CONTINUE                                 09030000
090400                     ELSE                                         09040000
090500                         PERFORM 1490-UPDATE-REQ-BY-TYPE          09050000
090600                     END-IF                                       09060000
090700                 ELSE                                             09070000
090800                     PERFORM 1490-UPDATE-REQ-BY-TYPE              09080000
090900                 END-IF                                           09090000
091000                 SET SU021-AUDIT-REQUIRED TO TRUE                 09100000
091100             END-IF                                               09110000
091200         ELSE                                                     09120000
091300*    DETERMINE CARTON COUNT                                       09130000
091400             PERFORM 1660-BUILD-TSUATRN                           09140000
091500             IF PS-DUMP-TO-LOG                                    09150000
091600                 CONTINUE                                         09160000
091700             ELSE                                                 09170000
091800                 PERFORM 8200-SUM-CARTONS                         09180000
091900                 IF SUT00015-CART-QTY > PV-CARTON-COUNT           09190000
092000                     CONTINUE                                     09200000
092100                 ELSE                                             09210000
092200                     PERFORM 1490-UPDATE-REQ-BY-TYPE              09220000
092300                 END-IF                                           09230000
092400                 SET SU021-AUDIT-REQUIRED TO TRUE                 09240000
092500             END-IF                                               09250000
092600         END-IF                                                   09260000
092700     END-IF.                                                      09270000
092800                                                                  09280000
092900 1490-UPDATE-REQ-BY-TYPE.                                         09290000
092901                                                                  09290106
092902     IF  PS-BLD-INTERNAL-TABLE-YES                                09290206
092903         MOVE '1490'  TO  PV-CSSL-PARA                            09290306
092904         PERFORM 9120-INTERNAL-TABLE                              09290406
092905     END-IF.                                                      09290506
092906                                                                  09290606
092910     STRING ' SUKCS583 - '                                        09291000
093000            ' 1490-UPDATE-REQ-BY-TYPE'                            09300000
093100         DELIMITED BY SIZE                                        09310000
093200         INTO PV-CICS-MSG-AREA.                                   09320000
093300     PERFORM 9990-WRITE-CICS.                                     09330000
093400     PERFORM 8700-UPDATE-SUT-PO-AUD-REQ.                          09340000
093500                                                                  09350000
093600*-----------------------------------------------------------------09360000
093700*DETERMINE THE NUMBER OF CARTONS OR UNITS TO BE AUDITED.          09370000
093800*-----------------------------------------------------------------09380000
093900 1500-CALCULATE-QUANTITIES.                                       09390000
093901                                                                  09390106
093902     IF  PS-BLD-INTERNAL-TABLE-YES                                09390206
093903         MOVE '1500'  TO  PV-CSSL-PARA                            09390306
093904         PERFORM 9120-INTERNAL-TABLE                              09390406
093905     END-IF.                                                      09390506
093906                                                                  09390606
093910     STRING ' SUKCS583 - '                                        09391000
094000            ' 1500-CALCULATE-QUANTITIES'                          09400000
094100         DELIMITED BY SIZE                                        09410000
094200         INTO PV-CICS-MSG-AREA.                                   09420000
094300     PERFORM 9990-WRITE-CICS.                                     09430000
094400     IF SU021-PACKAGE-TYPE-CODE = 'PS'                            09440000
094500         PERFORM 1530-CALCULATE-PACK-BY-STORE                     09450000
094600     ELSE                                                         09460000
094700         IF SU021-PACKAGE-TYPE-CODE = 'BC'                        09470000
094800             PERFORM 1560-CALCULATE-BULK                          09480000
094900         ELSE                                                     09490000
095000             IF SU021-PACKAGE-TYPE-CODE = 'PP'                    09500000
095100                     PERFORM 1590-CALCULATE-PRE-PACK              09510000
095200             END-IF                                               09520000
095300         END-IF                                                   09530000
095400     END-IF.                                                      09540000
095500                                                                  09550000
095600 1530-CALCULATE-PACK-BY-STORE.                                    09560000
095601                                                                  09560106
095602     IF  PS-BLD-INTERNAL-TABLE-YES                                09560206
095603         MOVE '1530'  TO  PV-CSSL-PARA                            09560306
095604         PERFORM 9120-INTERNAL-TABLE                              09560406
095605     END-IF.                                                      09560506
095606                                                                  09560606
095610     STRING ' SUKCS583 - '                                        09561000
095700            ' 1530-CALCULATE-PACK-BY-STORE'                       09570000
095800         DELIMITED BY SIZE                                        09580000
095900         INTO PV-CICS-MSG-AREA.                                   09590000
096000     PERFORM 9990-WRITE-CICS.                                     09600000
096100     MOVE ZERO                 TO PV-UNITS-TO-AUDIT.              09610000
096200     PERFORM 8250-SELECT-EXPECTD-CNT.                             09620000
096300**  ADD 1 CARTON BECAUSE THE SUBSELECT IN THE 8250- PARA          09630000
096400**  REMOVED THE CURRENT CARTON THAT IS BEING PROCESSED            09640000
096500     COMPUTE PV-DB2-COUNT-EXP-SCN =                               09650000
096600             PV-DB2-COUNT-EXP-SCN + 1.                            09660000
096700     IF SUT00017-AUD-PCT > 0 AND                                  09670000
096800        PV-DB2-COUNT-EXP-SCN > 0                                  09680000
096900         COMPUTE PV-CARTONS-TO-AUDIT ROUNDED =                    09690000
097000           (PV-DB2-COUNT-EXP-SCN * (SUT00017-AUD-PCT / 100))      09700000
097100         IF PV-CARTONS-TO-AUDIT < 1                               09710000
097200             MOVE 1 TO    PV-CARTONS-TO-AUDIT                     09720000
097300         END-IF                                                   09730000
097400     ELSE                                                         09740000
097500         MOVE PV-DB2-COUNT-EXP-SCN TO PV-CARTONS-TO-AUDIT         09750000
097600     END-IF.                                                      09760000
097700     IF PV-CARTONS-TO-AUDIT < SUT00017-MIN-CART-CKD-QTY AND       09770000
097800        PV-DB2-COUNT-EXP-SCN > SUT00017-MIN-CART-CKD-QTY          09780000
097900         MOVE SUT00017-MIN-CART-CKD-QTY TO PV-CARTONS-TO-AUDIT    09790000
098000     ELSE                                                         09800000
098100         IF PV-CARTONS-TO-AUDIT > SUT00017-MAX-CART-CKD-QTY       09810000
098200             MOVE SUT00017-MAX-CART-CKD-QTY                       09820000
098300                                        TO PV-CARTONS-TO-AUDIT    09830000
098400         END-IF                                                   09840000
098500     END-IF.                                                      09850000
098600                                                                  09860000
098700 1560-CALCULATE-BULK.                                             09870000
098701                                                                  09870106
098702     IF  PS-BLD-INTERNAL-TABLE-YES                                09870206
098703         MOVE '1560'  TO  PV-CSSL-PARA                            09870306
098704         PERFORM 9120-INTERNAL-TABLE                              09870406
098705     END-IF.                                                      09870506
098706                                                                  09870606
098710     STRING ' SUKCS583 - '                                        09871000
098800            ' 1560-CALCULATE-BULK'                                09880000
098900         DELIMITED BY SIZE                                        09890000
099000         INTO PV-CICS-MSG-AREA.                                   09900000
099100     PERFORM 9990-WRITE-CICS.                                     09910000
099200     PERFORM 8450-SELECT-DIST-HEAD.                               09920000
099300     IF DISTHD-OTPK-UNT-QTY = 0                                   09930000
099400         PERFORM 8500-SUM-DISTRO-DETAIL                           09940000
099500         MOVE PV-SUM-EXPTD-ALLOC   TO PV-TOTAL-UNITS              09950000
099600     ELSE                                                         09960000
099700         COMPUTE PV-TOTAL-UNITS =                                 09970000
099800              DISTHD-TOT-CART-CNT * DISTHD-OTPK-UNT-QTY           09980000
099900     END-IF.                                                      09990000
100000     IF SUT00017-AUD-PCT > 0 AND                                  10000000
100100        PV-TOTAL-UNITS > 0                                        10010000
100200         COMPUTE PV-UNITS-TO-AUDIT ROUNDED =                      10020000
100300           (PV-TOTAL-UNITS * (SUT00017-AUD-PCT / 100))            10030000
100400         IF PV-UNITS-TO-AUDIT = 0                                 10040000
100500             MOVE 1              TO PV-UNITS-TO-AUDIT             10050000
100600         END-IF                                                   10060000
100700     ELSE                                                         10070000
100800         MOVE PV-TOTAL-UNITS TO PV-UNITS-TO-AUDIT                 10080000
100900     END-IF.                                                      10090000
101000                                                                  10100000
101100     MOVE DK-PO-LINE-NBR            TO DK-SHUUPC-LNE-NBR.         10110000
101200     PERFORM 8800-COUNT-CHECKED-IN-CRTNS.                         10120000
101300**  ADD 1 TO THE TOTAL-CARTON-TO-AUDIT BECAUSE THE CARTON WE ARE  10130000
101400**  PROCESSING  WOULD HAVE BEEN INCLUDED IN THE COUNT COMING      10140000
101500**  FROM THE 8800- PARA - AND WE ARE SUBTRACTING THAT COUNT       10150000
101600     COMPUTE DISTHD-TOT-CART-CNT =                                10160000
101700            (DISTHD-TOT-CART-CNT + 1) - PV-CHECK-IN-COUNT.        10170000
101800     IF DISTHD-TOT-CART-CNT > SUT00017-MAX-CART-CKD-QTY           10180000
101900         MOVE SUT00017-MAX-CART-CKD-QTY                           10190000
102000                                    TO PV-CARTONS-TO-AUDIT        10200000
102100     ELSE                                                         10210000
102200         MOVE DISTHD-TOT-CART-CNT   TO PV-CARTONS-TO-AUDIT        10220000
102300     END-IF.                                                      10230000
102400                                                                  10240000
102500                                                                  10250000
102600 1590-CALCULATE-PRE-PACK.                                         10260000
102601                                                                  10260106
102602     IF  PS-BLD-INTERNAL-TABLE-YES                                10260206
102603         MOVE '1590'  TO  PV-CSSL-PARA                            10260306
102604         PERFORM 9120-INTERNAL-TABLE                              10260406
102605     END-IF.                                                      10260506
102606                                                                  10260606
102610     STRING ' SUKCS583 - '                                        10261000
102700            ' 1590-CALCULATE-PRE-PACK'                            10270000
102800         DELIMITED BY SIZE                                        10280000
102900         INTO PV-CICS-MSG-AREA.                                   10290000
103000     PERFORM 9990-WRITE-CICS.                                     10300000
103100     MOVE SU021-DRIVER-LINE-NBR TO DK-PO-DRIVER-LINE.             10310000
103200     PERFORM 8600-SELECT-DRIVER-LINE-QTY.                         10320000
103300     PERFORM 8650-SUM-PRE-PACK-DETAIL.                            10330000
103400     IF SUT00017-AUD-PCT > 0 AND                                  10340000
103500        PV-SUM-OF-ALL-LINES > 0                                   10350000
103600         COMPUTE PV-UNITS-TO-AUDIT ROUNDED =                      10360000
103700           (PV-SUM-OF-ALL-LINES * (SUT00017-AUD-PCT / 100))       10370000
103800         IF PV-UNITS-TO-AUDIT = 0                                 10380000
103900             MOVE 1              TO PV-UNITS-TO-AUDIT             10390000
104000         END-IF                                                   10400000
104100     ELSE                                                         10410000
104200         MOVE PV-SUM-OF-ALL-LINES       TO PV-UNITS-TO-AUDIT      10420000
104300     END-IF.                                                      10430000
104400                                                                  10440000
104500     MOVE DK-PO-DRIVER-LINE         TO DK-SHUUPC-LNE-NBR.         10450000
104600     PERFORM 8800-COUNT-CHECKED-IN-CRTNS.                         10460000
104700**  ADD 1 TO THE TOTAL-CARTON-TO-AUDIT BECAUSE THE CARTON WE ARE  10470000
104800**  PROCESSING  WOULD HAVE BEEN INCLUDED IN THE COUNT COMING      10480000
104900**  FROM THE 8800- PARA - AND WE ARE SUBTRACTING THAT COUNT       10490000
105000     COMPUTE DISTHD-TOT-CART-CNT =                                10500000
105100            (DISTHD-TOT-CART-CNT + 1) - PV-CHECK-IN-COUNT.        10510000
105200     IF DISTHD-TOT-CART-CNT > SUT00017-MAX-CART-CKD-QTY           10520000
105300         MOVE SUT00017-MAX-CART-CKD-QTY                           10530000
105400                                    TO PV-CARTONS-TO-AUDIT        10540000
105500     ELSE                                                         10550000
105600         MOVE DISTHD-TOT-CART-CNT TO PV-CARTONS-TO-AUDIT          10560000
105700     END-IF.                                                      10570000
105800                                                                  10580000
105900 1600-INSERT-INTO-TABLES.                                         10590000
105901                                                                  10590106
105902     IF  PS-BLD-INTERNAL-TABLE-YES                                10590206
105903         MOVE '1600'  TO  PV-CSSL-PARA                            10590306
105904         PERFORM 9120-INTERNAL-TABLE                              10590406
105905     END-IF.                                                      10590506
105906                                                                  10590606
105910     STRING ' SUKCS583 - '                                        10591000
106000            ' 1600-INSERT-INTO-TABLES'                            10600000
106100         DELIMITED BY SIZE                                        10610000
106200         INTO PV-CICS-MSG-AREA.                                   10620000
106300     PERFORM 9990-WRITE-CICS.                                     10630000
106400     SET PS-AUDIT-NBR-EXISTS  TO TRUE.                            10640000
106500                                                                  10650000
106600     PERFORM UNTIL PS-AUDIT-NBR-NOT-EXISTS                        10660000
106700         PERFORM 1620-CREATE-RANDOM-NBR                           10670000
106800                                                                  10680000
106900         MOVE DP902-RANDOM-NUMBER TO PV-AUDIT-CNTL-NBR            10690000
107000         PERFORM 8550-VALIDATE-AUDIT-NBR                          10700000
107100     END-PERFORM.                                                 10710000
107200                                                                  10720000
107300     MOVE PV-AUDIT-CNTL-NBR       TO SU021-AUDIT-NUMBER.          10730000
107400     PERFORM 1640-BUILD-TSUNAUD.                                  10740000
107500     IF PS-DUMP-TO-LOG                                            10750000
107600         CONTINUE                                                 10760000
107700     ELSE                                                         10770000
107800         PERFORM 1660-BUILD-TSUATRN                               10780000
107900         IF PS-DUMP-TO-LOG                                        10790000
108000             CONTINUE                                             10800000
108100         ELSE                                                     10810000
108200             PERFORM 1680-BUILD-SUT-PO-AUD-REQ                    10820000
108300         END-IF                                                   10830000
108400     END-IF.                                                      10840000
108500******************************************************************10850000
108600*  1620-CREATE-RANDOM-NBR                                        *10860000
108700*  THIS PARAGRAPH WILL RANDOMLY CREATE A NEW AUDIT CNTL NUMBER   *10870000
108800******************************************************************10880000
108900 1620-CREATE-RANDOM-NBR.                                          10890000
108910                                                                  10891006
108920     IF  PS-BLD-INTERNAL-TABLE-YES                                10892006
108930         MOVE '1620'  TO  PV-CSSL-PARA                            10893006
108940         PERFORM 9120-INTERNAL-TABLE                              10894006
108950     END-IF.                                                      10895006
108960                                                                  10896006
109010     STRING ' SUKCS583 - '                                        10901000
109100            ' 1620-CREATE-RANDOM-NBR'                             10910000
109200         DELIMITED BY SIZE                                        10920000
109300         INTO PV-CICS-MSG-AREA.                                   10930000
109400     PERFORM 9990-WRITE-CICS.                                     10940000
109500     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     10950000
109600     CALL PC-RANDOM-NBR-GENERATOR USING                           10960000
109700                            DFHEIBLK                              10970000
109800                            DFHCOMMAREA                           10980000
109900                            DP902-RANDNBR-ROUTINE-FIELDS.         10990000
110000                                                                  11000000
110100     IF DP902-SUCCESSFUL                                          11010000
110200         CONTINUE                                                 11020000
110300     ELSE                                                         11030000
110400         SET SU021-DB2-ERROR TO TRUE                              11040000
110500         SET PS-ERROR TO TRUE                                     11050000
110600     END-IF.                                                      11060000
110700                                                                  11070000
110800 1640-BUILD-TSUNAUD.                                              11080000
110801                                                                  11080106
110802     IF  PS-BLD-INTERNAL-TABLE-YES                                11080206
110803         MOVE '1640'  TO  PV-CSSL-PARA                            11080306
110804         PERFORM 9120-INTERNAL-TABLE                              11080406
110805     END-IF.                                                      11080506
110806                                                                  11080606
110810     STRING ' SUKCS583 - '                                        11081000
110900            ' 1640-BUILD-TSUNAUD'                                 11090000
111000         DELIMITED BY SIZE                                        11100000
111100         INTO PV-CICS-MSG-AREA.                                   11110000
111200     PERFORM 9990-WRITE-CICS.                                     11120000
111300     INITIALIZE DCLTSUNAUD.                                       11130000
111400                                                                  11140000
111500     MOVE PV-AUDIT-CNTL-NBR       TO SUNAUD-AUD-CNTL-NBR.         11150000
111600     MOVE +0                      TO SUNAUD-AUD-PSPND-MNIT-QTY    11160000
111700                                     SUNAUD-AUD-CLO-MNIT-QTY.     11170000
111800     MOVE SU021-USER-ID           TO SUNAUD-AUD-USR-ID.           11180000
111900     MOVE SU021-OPER-UNT-ID       TO SUNAUD-OPER-UNT-ID.          11190000
112000     MOVE 1                       TO SUNAUD-FCLTY-ID.             11200000
112100     MOVE 'RECV  '                TO SUNAUD-PRC-FCLTY-AREA-ID.    11210000
112200                                                                  11220000
112300     MOVE PC-IP                   TO SUNAUD-AUD-STAT-CDE.         11230000
112400     MOVE PC-02                   TO SUNAUD-AUD-TYP-CDE.          11240000
112500     MOVE PC-C                    TO SUNAUD-AUD-CAT-CDE.          11250000
112600     MOVE PC-N                    TO SUNAUD-DEST-TYP-CDE.         11260000
112700     PERFORM 8300-INSERT-TSUNAUD.                                 11270000
112800                                                                  11280000
112900 1660-BUILD-TSUATRN.                                              11290000
112910                                                                  11291006
112920     IF  PS-BLD-INTERNAL-TABLE-YES                                11292006
112930         MOVE '1660'  TO  PV-CSSL-PARA                            11293006
112940         PERFORM 9120-INTERNAL-TABLE                              11294006
112950     END-IF.                                                      11295006
112960                                                                  11296006
113010     STRING ' SUKCS583 - '                                        11301000
113100            ' 1660-BUILD-TSUATRN'                                 11310000
113200         DELIMITED BY SIZE                                        11320000
113300         INTO PV-CICS-MSG-AREA.                                   11330000
113400     PERFORM 9990-WRITE-CICS.                                     11340000
113500     INITIALIZE DCLTSUATRN.                                       11350000
113600     MOVE SU021-SHIPT-UNT-ID      TO DK-SHIPT-UNT-ID.             11360000
113700     PERFORM 8000-SELECT-SHPUNT.                                  11370000
113800     MOVE PV-AUDIT-CNTL-NBR       TO SUATRN-AUD-CNTL-NBR.         11380000
113900     MOVE SU021-SHIPT-UNT-ID      TO SUATRN-SHIPT-UNT-ID.         11390000
114000     MOVE SPACES                  TO SUATRN-UNT-AUD-USR-ID.       11400000
114100     MOVE PC-IP                   TO SUATRN-UNT-AUD-STAT-CDE.     11410000
114200     MOVE SU021-PO-NUMBER         TO SUATRN-TRN-NBR.              11420000
114300     MOVE SU021-REC-SEQ-NBR       TO SUATRN-REC-SEQ-NBR.          11430000
114400     MOVE SHPUNT-DEST-OPER-UNT-ID TO SUATRN-DEST-OPER-UNT-ID.     11440000
114500     MOVE PC-N                    TO SUATRN-UNT-AUD-ERR-IND.      11450000
114600     PERFORM 8350-INSERT-TSUATRN.                                 11460000
114700                                                                  11470000
114800 1680-BUILD-SUT-PO-AUD-REQ.                                       11480000
114810                                                                  11481006
114820     IF  PS-BLD-INTERNAL-TABLE-YES                                11482006
114830         MOVE '1680'  TO  PV-CSSL-PARA                            11483006
114840         PERFORM 9120-INTERNAL-TABLE                              11484006
114850     END-IF.                                                      11485006
114860                                                                  11486006
114910     STRING ' SUKCS583 - '                                        11491000
115000            ' 1680-BUILD-SUT-PO-AUD-REQ'                          11500000
115100         DELIMITED BY SIZE                                        11510000
115200         INTO PV-CICS-MSG-AREA.                                   11520000
115300     PERFORM 9990-WRITE-CICS.                                     11530000
115400     INITIALIZE DCLSUT00015.                                      11540000
115500     MOVE SU021-PO-NUMBER         TO SUT00015-PO-NBR.             11550000
115600     IF SU021-PACKAGE-TYPE-CODE = 'BC'                            11560000
115700         MOVE SU021-LINE-NBR          TO SUT00015-PO-LNE-NBR      11570000
115800     ELSE                                                         11580000
115900         MOVE 0                       TO SUT00015-PO-LNE-NBR      11590000
116000     END-IF.                                                      11600000
116100     IF SU021-PACKAGE-TYPE-CODE = 'PP'                            11610000
116200         MOVE SU021-PRE-PACK-ID       TO SUT00015-PO-PREPK-ID     11620000
116300     ELSE                                                         11630000
116400         MOVE 0                       TO SUT00015-PO-PREPK-ID     11640000
116500     END-IF.                                                      11650000
116600     MOVE SU021-OPER-UNT-ID       TO SUT00015-OPER-UNT-ID.        11660000
116700     MOVE SU021-INBOUND-TRIP-ID   TO SUT00015-INBND-TRIP-ID.      11670000
116800     MOVE SU021-REC-SEQ-NBR       TO SUT00015-RCVR-SEQ-NBR.       11680000
116900     MOVE PV-AUDIT-CNTL-NBR       TO SUT00015-AUD-CNTL-NBR.       11690000
117000     MOVE SUT00017-VND-RNKG-CDE   TO SUT00015-VND-RNKG-CDE.       11700000
117100     MOVE SUT00017-PKGNG-TYP-CDE  TO SUT00015-PKGNG-TYP-CDE.      11710000
117200     MOVE SUT00017-EFF-BEG-TMST   TO SUT00015-EFF-BEG-TMST.       11720000
117300     MOVE PV-CARTONS-TO-AUDIT     TO SUT00015-CART-QTY.           11730000
117400     IF PV-UNITS-TO-AUDIT > 0 AND                                 11740000
117500        SUT00017-CKD-PCT > 0                                      11750000
117600         COMPUTE PV-UNT-QTY ROUNDED =                             11760000
117700                 (PV-UNITS-TO-AUDIT *                             11770000
117800                 ((PC-100 - SUT00017-CKD-PCT) / 100))             11780000
117900         IF PV-UNT-QTY < 1                                        11790000
118000             MOVE 1              TO SUT00015-UNT-QTY              11800000
118100         ELSE                                                     11810000
118200             COMPUTE SUT00015-UNT-QTY ROUNDED =                   11820000
118300                        PV-UNT-QTY * 1                            11830000
118400         END-IF                                                   11840000
118500     ELSE                                                         11850000
118600         MOVE PV-UNITS-TO-AUDIT  TO SUT00015-UNT-QTY              11860000
118700     END-IF.                                                      11870000
118800     MOVE +0                      TO SUT00015-AUD-UNT-QTY.        11880000
118900     MOVE +0                      TO SUT00015-AUD-CART-QTY.       11890000
119000     MOVE PC-I                    TO SUT00015-AUD-STAT-CDE.       11900000
119100     IF SU021-DEFERRED-AUDIT-IND = 'Y'                            11910000
119200         MOVE 'N'                 TO SUT00015-DFRD-AUD-IND        11920000
119300     ELSE                                                         11930000
119400         MOVE 'Y'                 TO SUT00015-DFRD-AUD-IND        11940000
119500     END-IF.                                                      11950000
119600     MOVE ZERO                    TO SUT00015-AUD-ERR-PCT.        11960000
119700*   GET THE NUMBER OF UNITS IN THIS CARTON FOR BULK AND PRE-PACK  11970000
119800     IF SU021-PACKAGE-TYPE-CODE = 'BC'                            11980000
119900         PERFORM 8150-SELECT-CURRENT-CARTON                       11990000
120000     ELSE                                                         12000000
120100         IF SU021-PACKAGE-TYPE-CODE = 'PP'                        12010000
120200             PERFORM 8950-SELECT-CURRENT-PP-CARTON                12020000
120300         ELSE                                                     12030000
120400             MOVE +0              TO SHUUPC-SHPD-QTY              12040000
120500         END-IF                                                   12050000
120600     END-IF.                                                      12060000
120700     IF PV-CARTONS-TO-AUDIT = 1                                   12070000
120800         MOVE PC-D                TO SUT00015-CART-PRMPT-CDE      12080000
120900     ELSE                                                         12090000
121000         IF SU021-PACKAGE-TYPE-CODE = 'BC' OR                     12100000
121100            SU021-PACKAGE-TYPE-CODE = 'PP'                        12110000
121200             IF SHUUPC-SHPD-QTY > SUT00015-UNT-QTY OR             12120000
121300                SHUUPC-SHPD-QTY = SUT00015-UNT-QTY                12130000
121400                 MOVE PC-D            TO SUT00015-CART-PRMPT-CDE  12140000
121500             ELSE                                                 12150000
121600                 MOVE PC-C            TO SUT00015-CART-PRMPT-CDE  12160000
121700             END-IF                                               12170000
121800         ELSE                                                     12180000
121900             MOVE PC-C            TO SUT00015-CART-PRMPT-CDE      12190000
122000         END-IF                                                   12200000
122100     END-IF.                                                      12210000
122200     MOVE PURCHS-ENT-ID           TO SUT00015-ENT-ID.             12220000
122300     MOVE PURCHS-DEPT-NBR         TO SUT00015-DEPT-NBR.           12230000
122400     PERFORM 8400-INSERT-PO-AUD-REQ.                              12240000
122401*CLP 11/05/13 - START                                             12240100
122402     PERFORM 8410-CHK-IF-RFID-AUDIT-EXISTS.                       12240200
122403     IF PS-RFID-REC-FOUND                                         12240300
122404*        NEED TO PUT THE RFID AUDIT # IN THE RWK FIELD            12240400
122405         PERFORM 8420-UPDATE-RWK-NO                               12240500
122406     END-IF.                                                      12240600
122407*CLP 11/05/13 - END                                               12240700
122408                                                                  12240800
122409 1700-RETURN-WITH-EXC-VALUES.                                     12240900
122410     STRING ' SUKCS583 - '                                        12241000
122411            ' 1700-RETURN-WITH-EXC-VALUES'                        12241100
122420         DELIMITED BY SIZE                                        12242000
122430         INTO PV-CICS-MSG-AREA.                                   12243000
122440     PERFORM 9990-WRITE-CICS.                                     12244000
122450     IF SUT00014-AUD-TYP-CDE = PC-N                               12245000
122460         SET SU021-AUDIT-IS-COMPLETE TO TRUE                      12246000
122470     ELSE                                                         12247000
122480*CLP 12/04/13 START                                               12248000
122490*        PC-R IS FOR RFID - NEEDED FOR PO EXECEPTION              12249000
122500*                           EVEN THOUGH IN QC MODULE              12250000
122600         IF SUT00014-AUD-TYP-CDE = PC-A OR PC-Q OR PC-R           12260000
122700             SET SU021-100-PC-AUDIT-REQD TO TRUE                  12270000
122800         ELSE                                                     12280000
122900             SET SU021-DB2-ERROR TO TRUE                          12290000
123000         END-IF                                                   12300000
123100*CLP 12/04/13 END                                                 12310000
123200     END-IF.                                                      12320000
123300                                                                  12330000
123400 2000-AUDIT-CARTON-DATA.                                          12340000
123401                                                                  12340106
123402     IF  PS-BLD-INTERNAL-TABLE-YES                                12340206
123403         MOVE '2000'  TO  PV-CSSL-PARA                            12340306
123404         PERFORM 9120-INTERNAL-TABLE                              12340406
123405     END-IF.                                                      12340506
123406                                                                  12340606
123410     STRING ' SUKCS583 - '                                        12341000
123500            ' 2000-AUDIT-CARTON-DATA'                             12350000
123600         DELIMITED BY SIZE                                        12360000
123700         INTO PV-CICS-MSG-AREA.                                   12370000
123800     PERFORM 9990-WRITE-CICS.                                     12380000
123900                                                                  12390000
124000 7000-SELECT-REQ-INFO.                                            12400000
124001                                                                  12400106
124002     IF  PS-BLD-INTERNAL-TABLE-YES                                12400206
124003         MOVE '7000'  TO  PV-CSSL-PARA                            12400306
124004         PERFORM 9120-INTERNAL-TABLE                              12400406
124005     END-IF.                                                      12400506
124006                                                                  12400606
124010     STRING ' SUKCS583 - '                                        12401000
124100            ' 7000-SELECT-REQ-INFO'                               12410000
124200         DELIMITED BY SIZE                                        12420000
124300         INTO PV-CICS-MSG-AREA.                                   12430000
124400     PERFORM 9990-WRITE-CICS.                                     12440000
124500                                                                  12450000
124600     INITIALIZE DCLSUT00015.                                      12460000
124700                                                                  12470000
124800     EXEC SQL                                                     12480000
124900          SELECT AUD_CNTL_NBR                                     12490000
125000             ,   VND_RNKG_CDE                                     12500000
125100             ,   PKGNG_TYP_CDE                                    12510000
125200             ,   EFF_BEG_TMST                                     12520000
125300             ,   AUD_STAT_CDE                                     12530000
125400             ,   CART_PRMPT_CDE                                   12540000
125500             ,   ENT_ID                                           12550000
125600             ,   DEPT_NBR                                         12560000
125700          INTO   :SUT00015-AUD-CNTL-NBR                           12570000
125800             ,   :SUT00015-VND-RNKG-CDE                           12580000
125900             ,   :SUT00015-PKGNG-TYP-CDE                          12590000
126000             ,   :SUT00015-EFF-BEG-TMST                           12600000
126100             ,   :SUT00015-AUD-STAT-CDE                           12610000
126200             ,   :SUT00015-CART-PRMPT-CDE                         12620000
126300             ,   :SUT00015-ENT-ID                                 12630000
126400             ,   :SUT00015-DEPT-NBR                               12640000
126500          FROM   SUT_PO_AUD_REQ                                   12650000
126600          WHERE  PO_NBR         = :DK-PO-NBR                      12660000
126700            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 12670000
126800            AND  PO_PREPK_ID    = :DK-PREPK-ID                    12680000
126900            AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                12690000
127000            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 12700000
127100*CLP 11/05/13 START                                               12710000
127200            AND  PKGNG_TYP_CDE  <> 'RF'                           12720000
127300*CLP 11/05/13 END                                                 12730000
127400     END-EXEC.                                                    12740000
127500                                                                  12750000
127600     EVALUATE TRUE                                                12760000
127700         WHEN SQLCODE = ZERO                                      12770000
127800         WHEN SQLCODE = -811                                      12780000
127900             SET PS-REQ-REC-FOUND TO TRUE                         12790000
128000         WHEN SQLCODE = +100                                      12800000
128100             SET PS-NO-REQ-REC-FOUND TO TRUE                      12810000
128200         WHEN SQLWARN0 NOT = SPACES                               12820000
128300         WHEN SQLCODE NOT EQUAL ZERO                              12830000
128310              MOVE '7000'  TO  PV-CSSL-PARA                       12831012
128320              PERFORM 9110-WRITE-SURD021-TO-CSSL                  12832012
128330                                                                  12833012
128340             MOVE '7000-SELECT-REQ-INFO'                          12834018
128350                             TO DP013-PARAGRAPH                   12835018
128360             MOVE 'SUKCS583 - GET BULK REQ RECS'                  12836018
128370                             TO DP013-MESSAGE-TEXT(1)             12837018
128371             MOVE DK-OPER-UNT-ID  TO PV-DISPLAY-OPER              12837121
128380             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            12838021
128381             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      12838121
128382             MOVE DK-PO-LINE-NBR  TO PV-DISPLAY-PO-LINE-NBR       12838221
128383             MOVE DK-PREPK-ID     TO PV-DISPLAY-PREPK             12838321
128390             STRING 'PO:'            PV-DISPLAY-OPER              12839021
128391                    '-'              PV-DISPLAY-PO-NBR            12839121
128392                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      12839221
128393                    '-'              PV-DISPLAY-PO-LINE-NBR       12839321
128394                    ' PREPK:'        PV-DISPLAY-PREPK             12839421
128400                                     DELIMITED BY SIZE            12840021
128500                           INTO DP013-MESSAGE-TEXT(2)             12850018
129600             MOVE SQLCA      TO DP013-SQLCA                       12960018
129700             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           12970018
129800             SET DP013-DB2-ABEND                                  12980018
129900                             TO TRUE                              12990018
130000             SET DP013-NO-ROLLBACK                                13000018
130100                             TO TRUE                              13010018
130200             PERFORM 9999-WRITE-CICS-LOG-MSG                      13020018
130300             SET PS-DUMP-TO-LOG       TO TRUE                     13030018
130400             SET SU021-DB2-ERROR TO TRUE                          13040018
131100     END-EVALUATE.                                                13110000
131200                                                                  13120000
131202******************************************************************13120250
131203*  7100-CHECK-FOR-BYPASS                                         *13120350
131204*  USING THE PO/RECEIVER FROM THE COMM AREA, RUN THIS SQL TO     *13120450
131205*  SEE IF THE OPER_UNT_ID FROM TRECEIV MAY BE SET UP ON THE      *13120550
131206*  PARM TABLE FOR PARM BYQAUD TO SEE IF WE ARE TO BYPASS         *13120650
131207*  PROMPTING AN AUDIT FOR MERCHANDISE BEING WORKED FOR THAT      *13120750
131208*  OPER UNIT ID.                                                 *13120850
131209*  FYI - IF A ROW IS FOUND IN THIS SQL, THAT MEANS THE DC IS     *13120950
131210*  SET UP TO BYPASS AUDIT PROMPTING - WHEN THAT IS THE CASE,     *13121050
131211*  THE PROGRAM WILL CHECK TO SEE IF SOMETHING HAD BEEN FOUND IN  *13121151
131212*  THE 1200-CHECK-PO-AUDIT-EXC PARAGRAPH AND IF NOT, THEN THE    *13121251
131213*  PROGRAM WILL SET THE PS-PO-LEVEL-FOUND TO TRUE AND MOVE A     *13121351
131214*  VALUE OF 'N' TO THE SUT00014-AUD-TYP-CDE FIELD SO THAT THE    *13121451
131215*  PROGRAM WILL NOW PROCESS THIS AUDIT CHECK AS IF THE RECEIVER  *13121551
131216*  WAS SET TO NO PROMPT FOR AUDITS.  IF AN EXCEPTION HAD BEEN    *13121651
131217*  FOUND IN THE 1200-CHECK-PO-AUDIT-EXC CALL, THEN NOTHING MORE  *13121751
131218*  WILL BE DONE AS THE PROGRAM WILL NOT PROMPT FOR AN AUDIT      *13121851
131219*  BECAUSE OF THE AUDIT EXCEPTION FOUND WHICH HAS PRIORITY OVER  *13121951
131220*  AUDIT PROMPTING.                                              *13122051
131221******************************************************************13122151
131222 7100-CHECK-FOR-BYPASS.                                           13122251
131223                                                                  13122351
131230     IF  PS-BLD-INTERNAL-TABLE-YES                                13123050
131240         MOVE '7100'  TO  PV-CSSL-PARA                            13124050
131250         PERFORM 9120-INTERNAL-TABLE                              13125050
131260     END-IF.                                                      13126050
131270                                                                  13127050
131280     STRING ' SUKCS583 - '                                        13128050
131290            ' 7100-CHECK-FOR-BYPASS'                              13129050
131291         DELIMITED BY SIZE                                        13129150
131292         INTO PV-CICS-MSG-AREA.                                   13129250
131293     PERFORM 9990-WRITE-CICS.                                     13129350
131294     EXEC SQL                                                     13129450
131295          SELECT A.OPER_UNT_ID                                    13129550
131297          INTO   :RECEIV-OPER-UNT-ID                              13129750
131299          FROM   TRECEIV A                                        13129950
131300             ,   TKRPRPM B                                        13130050
131301          WHERE  A.ORD_NBR           = :DK-BYPASS-PO-NBR          13130150
131302            AND  A.REC_SEQ_NBR       = :DK-BYPASS-REC-SEQ-NBR     13130250
131303            AND  B.LOC_ID            = A.OPER_UNT_ID              13130350
131304            AND  B.INTFC_SYS_CDE     = 'AUD'                      13130450
131305            AND  B.SYS_PRC_FUNC_CDE  = 'BYQAUD'                   13130550
131306            AND  B.FUNC_TXT          = 'Y'                        13130650
131307            AND  B.FUNC_BEG_TMST    <= CURRENT TIMESTAMP          13130750
131308            AND  B.FUNC_END_TMST    >= CURRENT TIMESTAMP          13130850
131309            AND  B.FUNC_PRC_STAT_CDE = 'AC'                       13130950
131310           WITH UR                                                13131050
131311     END-EXEC.                                                    13131150
131312                                                                  13131250
131313     EVALUATE TRUE                                                13131350
131314         WHEN SQLCODE = ZERO                                      13131450
131315             SET PS-BYPASS-PROMPT-AUDIT TO TRUE                   13131550
131316             IF  PS-NO-LINE-LEVEL-FOUND                           13131651
131317             AND PS-NO-PO-LEVEL-FOUND                             13131751
131318                 SET PS-PO-LEVEL-FOUND TO TRUE                    13131851
131319                 MOVE 'N' TO SUT00014-AUD-TYP-CDE                 13131951
131320             END-IF                                               13132051
131321         WHEN SQLCODE = +100                                      13132150
131322             SET PS-BYPASS-PROMPT-AUDIT-NO TO TRUE                13132252
131323         WHEN SQLWARN0 NOT = SPACES                               13132350
131324         WHEN SQLCODE NOT EQUAL ZERO                              13132450
131325              MOVE '7100'  TO  PV-CSSL-PARA                       13132550
131326              PERFORM 9110-WRITE-SURD021-TO-CSSL                  13132650
131327                                                                  13132750
131328             MOVE '7100-CHECK-FOR-BYPASS '                        13132850
131329                             TO DP013-PARAGRAPH                   13132950
131330             MOVE 'SUKCS583 - CHECK FOR BYPASS OF AUDIT '         13133050
131331                             TO DP013-MESSAGE-TEXT(1)             13133150
131332             MOVE DK-BYPASS-PO-NBR  TO PV-DISPLAY-PO-NBR          13133250
131333             MOVE DK-BYPASS-REC-SEQ-NBR TO                        13133350
131334                  PV-DISPLAY-RCVR-SEQ-NBR                         13133450
131335             STRING 'PO/REC: '      PV-DISPLAY-PO-NBR             13133550
131336                    ' - '           PV-DISPLAY-RCVR-SEQ-NBR       13133650
131337              DELIMITED BY SIZE                                   13133750
131338                           INTO DP013-MESSAGE-TEXT(2)             13133850
131339             MOVE SQLCA      TO DP013-SQLCA                       13133950
131340             MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME(1)           13134050
131341             MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(2)           13134150
131342             SET DP013-DB2-ABEND                                  13134250
131343                             TO TRUE                              13134350
131344             SET DP013-NO-ROLLBACK                                13134450
131345                             TO TRUE                              13134550
131346             PERFORM 9999-WRITE-CICS-LOG-MSG                      13134650
131347             SET PS-DUMP-TO-LOG       TO TRUE                     13134750
131348             SET SU021-DB2-ERROR TO TRUE                          13134850
131349     END-EVALUATE.                                                13134950
131350                                                                  13135000
131400 7150-RETREIVE-PO-INFO.                                           13140000
131410                                                                  13141006
131420     IF  PS-BLD-INTERNAL-TABLE-YES                                13142006
131430         MOVE '7150'  TO  PV-CSSL-PARA                            13143006
131440         PERFORM 9120-INTERNAL-TABLE                              13144006
131450     END-IF.                                                      13145006
131460                                                                  13146006
131510     STRING ' SUKCS583 - '                                        13151000
131600            ' 7150-RETREIVE-PO-INFO'                              13160000
131700         DELIMITED BY SIZE                                        13170000
131800         INTO PV-CICS-MSG-AREA.                                   13180000
131900     PERFORM 9990-WRITE-CICS.                                     13190000
132000     EXEC SQL                                                     13200000
132100          SELECT DEPT_NBR                                         13210000
132200              ,  ENT_ID                                           13220000
132300          INTO   :PURCHS-DEPT-NBR                                 13230000
132400              ,  :PURCHS-ENT-ID                                   13240000
132500          FROM   TPURCHS                                          13250000
132600          WHERE  PO_NBR   = :DK-PO-NBR                            13260000
132700            AND  VER_STATUS_CDE = 'A'                             13270000
132710           WITH UR                                                13271005
132800     END-EXEC.                                                    13280000
132900                                                                  13290000
133000     EVALUATE TRUE                                                13300000
133100         WHEN SQLCODE = ZERO                                      13310000
133200             SET PS-PO-INFO-FOUND TO TRUE                         13320000
133300         WHEN SQLCODE = +100                                      13330000
133400             SET PS-NO-PO-INFO-FOUND TO TRUE                      13340000
133500         WHEN SQLWARN0 NOT = SPACES                               13350000
133600         WHEN SQLCODE NOT EQUAL ZERO                              13360000
133610              MOVE '7150'  TO  PV-CSSL-PARA                       13361012
133620              PERFORM 9110-WRITE-SURD021-TO-CSSL                  13362012
133630                                                                  13363012
133640             MOVE '7150-RETREIVE-PO-INFO'                         13364018
133650                             TO DP013-PARAGRAPH                   13365018
133660             MOVE 'SUKCS583 - GET PO INFO '                       13366018
133670                             TO DP013-MESSAGE-TEXT(1)             13367018
133680             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 13368018
133690             STRING 'PO:'       PV-DISPLAY-PO-NBR                 13369022
133700              DELIMITED BY SIZE                                   13370022
133800                           INTO DP013-MESSAGE-TEXT(2)             13380018
133900             MOVE SQLCA      TO DP013-SQLCA                       13390018
134000             MOVE 'TPURCHS'  TO DP013-DB2-TABLE-NAME(1)           13400018
134100             SET DP013-DB2-ABEND                                  13410018
134200                             TO TRUE                              13420018
134300             SET DP013-NO-ROLLBACK                                13430018
134400                             TO TRUE                              13440018
134500             PERFORM 9999-WRITE-CICS-LOG-MSG                      13450018
134600             SET PS-DUMP-TO-LOG       TO TRUE                     13460018
134700             SET PS-NO-PO-INFO-FOUND TO TRUE                      13470018
134800             SET SU021-DB2-ERROR TO TRUE                          13480018
135500     END-EVALUATE.                                                13550000
135600                                                                  13560000
135700 7190-RETREIVE-PO-AUD-PARM.                                       13570000
135710                                                                  13571006
135720     IF  PS-BLD-INTERNAL-TABLE-YES                                13572006
135730         MOVE '7190'  TO  PV-CSSL-PARA                            13573006
135740         PERFORM 9120-INTERNAL-TABLE                              13574006
135750     END-IF.                                                      13575006
135760                                                                  13576006
135810     STRING ' SUKCS583 - '                                        13581000
135900            ' 7190-RETREIVE-PO-AUD-PARM'                          13590000
136000         DELIMITED BY SIZE                                        13600000
136100         INTO PV-CICS-MSG-AREA.                                   13610000
136200     PERFORM 9990-WRITE-CICS.                                     13620000
136300     EXEC SQL                                                     13630000
136400          SELECT VND_RNKG_CDE                                     13640000
136500              ,  PKGNG_TYP_CDE                                    13650000
136600              ,  EFF_BEG_TMST                                     13660000
136700              ,  AUD_PCT                                          13670000
136800              ,  CKD_PCT                                          13680000
136900              ,  MAX_CKD_QTY                                      13690000
137000              ,  MAX_CART_CKD_QTY                                 13700000
137100              ,  MIN_CART_CKD_QTY                                 13710000
137200              ,  CKD_DC_QTY                                       13720000
137300              ,  MAX_PO_LNE_QTY                                   13730000
137400              ,  CK_AFT_DAY_QTY                                   13740000
137500              ,  CK_AFT_RCVR_QTY                                  13750000
137600              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         13760000
137700          INTO   :SUT00017-VND-RNKG-CDE                           13770000
137800              ,  :SUT00017-PKGNG-TYP-CDE                          13780000
137900              ,  :SUT00017-EFF-BEG-TMST                           13790000
138000              ,  :SUT00017-AUD-PCT                                13800000
138100              ,  :SUT00017-CKD-PCT                                13810000
138200              ,  :SUT00017-MAX-CKD-QTY                            13820000
138300              ,  :SUT00017-MAX-CART-CKD-QTY                       13830000
138400              ,  :SUT00017-MIN-CART-CKD-QTY                       13840000
138500              ,  :SUT00017-CKD-DC-QTY                             13850000
138600              ,  :SUT00017-MAX-PO-LNE-QTY                         13860000
138700              ,  :SUT00017-CK-AFT-DAY-QTY                         13870000
138800              ,  :SUT00017-CK-AFT-RCVR-QTY                        13880000
138900              ,  :PV-LIMIT-DAYS                                   13890000
139000          FROM   SUT_PO_AUD_PARM A                                13900000
139100          WHERE  A.VND_RNKG_CDE  = :SUT00015-VND-RNKG-CDE         13910000
139200            AND  A.PKGNG_TYP_CDE = :SUT00015-PKGNG-TYP-CDE        13920000
139300            AND  A.EFF_BEG_TMST  = :SUT00015-EFF-BEG-TMST         13930000
139310           WITH UR                                                13931005
139400     END-EXEC.                                                    13940000
139500                                                                  13950000
139600     EVALUATE TRUE                                                13960000
139700         WHEN SQLCODE = ZERO                                      13970000
139800             CONTINUE                                             13980000
139900         WHEN SQLWARN0 NOT = SPACES                               13990000
140000         WHEN SQLCODE NOT EQUAL ZERO                              14000000
140010              MOVE '7190'  TO  PV-CSSL-PARA                       14001012
140020              PERFORM 9110-WRITE-SURD021-TO-CSSL                  14002012
140030                                                                  14003012
140040             MOVE '7190-RETREIVE-PO-AUD-PARM'                     14004018
140050                             TO DP013-PARAGRAPH                   14005018
140060             MOVE 'SUKCS583 - GET AUD PARM DATA '                 14006018
140070                             TO DP013-MESSAGE-TEXT(1)             14007018
140091             STRING 'RANK:'     SUT00015-VND-RNKG-CDE             14009122
140092                    ' PKG TYP:' SUT00015-PKGNG-TYP-CDE            14009222
140093                    ' BEG:'     SUT00015-EFF-BEG-TMST             14009322
140100                                DELIMITED BY SIZE                 14010022
140200                           INTO DP013-MESSAGE-TEXT(2)             14020018
141000             MOVE SQLCA      TO DP013-SQLCA                       14100018
141100             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(1)           14110018
141200             SET DP013-DB2-ABEND                                  14120018
141300                             TO TRUE                              14130018
141400             SET DP013-NO-ROLLBACK                                14140018
141500                             TO TRUE                              14150018
141600             PERFORM 9999-WRITE-CICS-LOG-MSG                      14160018
141700             SET PS-DUMP-TO-LOG       TO TRUE                     14170018
141800             SET PS-NO-PO-INFO-FOUND TO TRUE                      14180018
141900             SET SU021-DB2-ERROR TO TRUE                          14190018
142600     END-EVALUATE.                                                14260000
142700                                                                  14270000
142800 7200-RETREIVE-VENDOR-DEPT.                                       14280000
142810                                                                  14281006
142820     IF  PS-BLD-INTERNAL-TABLE-YES                                14282006
142830         MOVE '7200'  TO  PV-CSSL-PARA                            14283006
142840         PERFORM 9120-INTERNAL-TABLE                              14284006
142850     END-IF.                                                      14285006
142860                                                                  14286006
142910     STRING ' SUKCS583 - '                                        14291000
143000            ' 7200-RETREIVE-VENDOR-DEPT'                          14300000
143100         DELIMITED BY SIZE                                        14310000
143200         INTO PV-CICS-MSG-AREA.                                   14320000
143300     PERFORM 9990-WRITE-CICS.                                     14330000
143400     EXEC SQL                                                     14340000
143500          SELECT B.VND_RNKG_CDE                                   14350000
143600              ,  B.PKGNG_TYP_CDE                                  14360000
143700              ,  EFF_BEG_TMST                                     14370000
143800              ,  AUD_PCT                                          14380000
143900              ,  CKD_PCT                                          14390000
144000              ,  MAX_CKD_QTY                                      14400000
144100              ,  MAX_CART_CKD_QTY                                 14410000
144200              ,  MIN_CART_CKD_QTY                                 14420000
144300              ,  CKD_DC_QTY                                       14430000
144400              ,  MAX_PO_LNE_QTY                                   14440000
144410              ,  CK_AFT_DAY_QTY                                   14441000
144420              ,  CK_AFT_RCVR_QTY                                  14442000
144430              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         14443000
144440          INTO   :SUT00017-VND-RNKG-CDE                           14444000
144450              ,  :SUT00017-PKGNG-TYP-CDE                          14445000
144460              ,  :SUT00017-EFF-BEG-TMST                           14446000
144470              ,  :SUT00017-AUD-PCT                                14447000
144480              ,  :SUT00017-CKD-PCT                                14448000
144490              ,  :SUT00017-MAX-CKD-QTY                            14449000
144500              ,  :SUT00017-MAX-CART-CKD-QTY                       14450000
144501              ,  :SUT00017-MIN-CART-CKD-QTY                       14450100
144502              ,  :SUT00017-CKD-DC-QTY                             14450200
144503              ,  :SUT00017-MAX-PO-LNE-QTY                         14450300
144504              ,  :SUT00017-CK-AFT-DAY-QTY                         14450400
144505              ,  :SUT00017-CK-AFT-RCVR-QTY                        14450500
144506              ,  :PV-LIMIT-DAYS                                   14450600
144507          FROM   SUT_VND_DEPT_RNKG A                              14450700
144508             ,   SUT_PO_AUD_PARM   B                              14450800
144509          WHERE  A.ENT_ID        = :DK-ENT-ID                     14450900
144510            AND  A.DEPT_NBR      = :DK-DEPT-NBR                   14451000
144511            AND  A.PKGNG_TYP_CDE = :DK-PKGNG-TYP-CDE              14451100
144512            AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                 14451200
144513            AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                14451300
144514            AND  B.EFF_BEG_TMST  = :SUT00015-EFF-BEG-TMST         14451400
144515           WITH UR                                                14451505
144516     END-EXEC.                                                    14451600
144517                                                                  14451700
144518     EVALUATE TRUE                                                14451800
144519         WHEN SQLCODE = ZERO                                      14451900
144520             SET PS-DEPT-RANK-FOUND TO TRUE                       14452000
144521         WHEN SQLCODE = +100                                      14452100
144522             SET PS-NO-DEPT-RANK-FOUND TO TRUE                    14452200
144523         WHEN SQLWARN0 NOT = SPACES                               14452300
144524         WHEN SQLCODE NOT EQUAL ZERO                              14452400
144525              MOVE '7200'  TO  PV-CSSL-PARA                       14452512
144526              PERFORM 9110-WRITE-SURD021-TO-CSSL                  14452612
144528                                                                  14452812
144534             MOVE '7200-RETREIVE-VENDOR-DEPT'                     14453422
144535                             TO DP013-PARAGRAPH                   14453522
144540             MOVE 'SUKCS583 - GET VENDOR DEPT'                    14454018
144550                             TO DP013-MESSAGE-TEXT(1)             14455018
144560             MOVE DK-ENT-ID   TO PV-DISPLAY-ENT-ID                14456018
144561             MOVE DK-DEPT-NBR TO PV-DISPLAY-DEPT-NBR              14456122
144570             STRING 'ENT:'       PV-DISPLAY-ENT-ID                14457022
144571                    ' DEPT:'     PV-DISPLAY-DEPT-NBR              14457122
144572                    ' TYP:'      DK-PKGNG-TYP-CDE                 14457222
144573                    ' '          SUT00015-EFF-BEG-TMST            14457322
144580                                 DELIMITED BY SIZE                14458022
144590                           INTO DP013-MESSAGE-TEXT(2)             14459018
144598             MOVE SQLCA      TO DP013-SQLCA                       14459818
144599             MOVE 'SUT00018' TO DP013-DB2-TABLE-NAME(1)           14459918
144600             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           14460018
144601             SET DP013-DB2-ABEND                                  14460118
144602                             TO TRUE                              14460218
144603             SET DP013-NO-ROLLBACK                                14460318
144604                             TO TRUE                              14460418
144605             PERFORM 9999-WRITE-CICS-LOG-MSG                      14460518
144606             SET PS-DUMP-TO-LOG       TO TRUE                     14460618
144607             SET PS-NO-PO-INFO-FOUND TO TRUE                      14460718
144608             SET SU021-DB2-ERROR TO TRUE                          14460818
144609     END-EVALUATE.                                                14460900
144610                                                                  14461000
144611 7250-RETREIVE-VENDOR-DEPT.                                       14461100
144612                                                                  14461206
144613     IF  PS-BLD-INTERNAL-TABLE-YES                                14461306
144614         MOVE '7250'  TO  PV-CSSL-PARA                            14461406
144615         PERFORM 9120-INTERNAL-TABLE                              14461506
144616     END-IF.                                                      14461606
144617                                                                  14461706
144618     STRING ' SUKCS583 - '                                        14461800
144619            ' 7250-RETREIVE-VENDOR-DEPT'                          14461900
144620         DELIMITED BY SIZE                                        14462000
144621         INTO PV-CICS-MSG-AREA.                                   14462100
144622     PERFORM 9990-WRITE-CICS.                                     14462200
144623     EXEC SQL                                                     14462300
144624          SELECT B.VND_RNKG_CDE                                   14462400
144625              ,  B.PKGNG_TYP_CDE                                  14462500
144626              ,  EFF_BEG_TMST                                     14462600
144627              ,  AUD_PCT                                          14462700
144628              ,  CKD_PCT                                          14462800
144630              ,  MAX_CKD_QTY                                      14463000
144700              ,  MAX_CART_CKD_QTY                                 14470000
144800              ,  MIN_CART_CKD_QTY                                 14480000
144900              ,  CKD_DC_QTY                                       14490000
145000              ,  MAX_PO_LNE_QTY                                   14500000
145100              ,  CK_AFT_DAY_QTY                                   14510000
145200              ,  CK_AFT_RCVR_QTY                                  14520000
145300              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         14530000
145400          INTO   :SUT00017-VND-RNKG-CDE                           14540000
145500              ,  :SUT00017-PKGNG-TYP-CDE                          14550000
145600              ,  :SUT00017-EFF-BEG-TMST                           14560000
145700              ,  :SUT00017-AUD-PCT                                14570000
145800              ,  :SUT00017-CKD-PCT                                14580000
145900              ,  :SUT00017-MAX-CKD-QTY                            14590000
146000              ,  :SUT00017-MAX-CART-CKD-QTY                       14600000
146100              ,  :SUT00017-MIN-CART-CKD-QTY                       14610000
146200              ,  :SUT00017-CKD-DC-QTY                             14620000
146300              ,  :SUT00017-MAX-PO-LNE-QTY                         14630000
146400              ,  :SUT00017-CK-AFT-DAY-QTY                         14640000
146500              ,  :SUT00017-CK-AFT-RCVR-QTY                        14650000
146600              ,  :PV-LIMIT-DAYS                                   14660000
146700          FROM   SUT_VND_DEPT_RNKG A                              14670000
146800             ,   SUT_PO_AUD_PARM   B                              14680000
146900          WHERE  A.ENT_ID        = :DK-ENT-ID                     14690000
147000            AND  A.DEPT_NBR      = :DK-DEPT-NBR                   14700000
147100            AND  A.PKGNG_TYP_CDE = :DK-PKGNG-TYP-CDE              14710000
147200            AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                 14720000
147300            AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                14730000
147400            AND  B.EFF_BEG_TMST  =                                14740000
147500             (SELECT MAX(C.EFF_BEG_TMST)                          14750000
147600              FROM   SUT_PO_AUD_PARM C                            14760000
147700              WHERE  B.VND_RNKG_CDE  = C.VND_RNKG_CDE             14770000
147800                AND  B.PKGNG_TYP_CDE = C.PKGNG_TYP_CDE)           14780000
147810           WITH UR                                                14781005
147900     END-EXEC.                                                    14790000
148000                                                                  14800000
148100     EVALUATE TRUE                                                14810000
148200         WHEN SQLCODE = ZERO                                      14820000
148300             SET PS-DEPT-RANK-FOUND TO TRUE                       14830000
148400         WHEN SQLCODE = +100                                      14840000
148500             SET PS-NO-DEPT-RANK-FOUND TO TRUE                    14850000
148600         WHEN SQLWARN0 NOT = SPACES                               14860000
148700         WHEN SQLCODE NOT EQUAL ZERO                              14870000
148710              MOVE '7250'  TO  PV-CSSL-PARA                       14871012
148720              PERFORM 9110-WRITE-SURD021-TO-CSSL                  14872012
148730                                                                  14873012
148740             MOVE '7250-RETREIVE-VENDOR-DEPT'                     14874018
148750                             TO DP013-PARAGRAPH                   14875018
148760             MOVE 'SUKCS583 - GET VENDOR DEPT'                    14876018
148770                             TO DP013-MESSAGE-TEXT(1)             14877018
148780             MOVE DK-ENT-ID   TO PV-DISPLAY-ENT-ID                14878018
148781             MOVE DK-DEPT-NBR TO PV-DISPLAY-DEPT-NBR              14878122
148790             STRING 'ENT:'       PV-DISPLAY-ENT-ID                14879022
148791                    ' DEPT:'     PV-DISPLAY-DEPT-NBR              14879122
148792                    ' PKG TYP:'  DK-PKGNG-TYP-CDE                 14879222
148800                                 DELIMITED BY SIZE                14880022
148900                           INTO DP013-MESSAGE-TEXT(2)             14890018
149700             MOVE SQLCA      TO DP013-SQLCA                       14970018
149800             MOVE 'SUT00018' TO DP013-DB2-TABLE-NAME(1)           14980018
149900             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           14990018
150000             SET DP013-DB2-ABEND                                  15000018
150100                             TO TRUE                              15010018
150200             SET DP013-NO-ROLLBACK                                15020018
150300                             TO TRUE                              15030018
150400             PERFORM 9999-WRITE-CICS-LOG-MSG                      15040018
150500             SET PS-DUMP-TO-LOG       TO TRUE                     15050018
150600             SET PS-NO-PO-INFO-FOUND TO TRUE                      15060018
150700             SET SU021-DB2-ERROR TO TRUE                          15070018
151400     END-EVALUATE.                                                15140000
151500                                                                  15150000
151600 7300-RETREIVE-VENDOR-RANK.                                       15160000
151610                                                                  15161006
151620     IF  PS-BLD-INTERNAL-TABLE-YES                                15162006
151630         MOVE '7300'  TO  PV-CSSL-PARA                            15163006
151640         PERFORM 9120-INTERNAL-TABLE                              15164006
151650     END-IF.                                                      15165006
151660                                                                  15166006
151710     STRING ' SUKCS583 - '                                        15171000
151800            ' 7300-RETREIVE-VENDOR-RANK'                          15180000
151900         DELIMITED BY SIZE                                        15190000
152000         INTO PV-CICS-MSG-AREA.                                   15200000
152100     PERFORM 9990-WRITE-CICS.                                     15210000
152200     EXEC SQL                                                     15220000
152300          SELECT B.VND_RNKG_CDE                                   15230000
152400              ,  B.PKGNG_TYP_CDE                                  15240000
152500              ,  EFF_BEG_TMST                                     15250000
152600              ,  AUD_PCT                                          15260000
152700              ,  CKD_PCT                                          15270000
152800              ,  MAX_CKD_QTY                                      15280000
152900              ,  MAX_CART_CKD_QTY                                 15290000
153000              ,  MIN_CART_CKD_QTY                                 15300000
153100              ,  CKD_DC_QTY                                       15310000
153200              ,  MAX_PO_LNE_QTY                                   15320000
153300              ,  CK_AFT_DAY_QTY                                   15330000
153400              ,  CK_AFT_RCVR_QTY                                  15340000
153500              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         15350000
153600          INTO   :SUT00017-VND-RNKG-CDE                           15360000
153700              ,  :SUT00017-PKGNG-TYP-CDE                          15370000
153800              ,  :SUT00017-EFF-BEG-TMST                           15380000
153900              ,  :SUT00017-AUD-PCT                                15390000
154000              ,  :SUT00017-CKD-PCT                                15400000
154100              ,  :SUT00017-MAX-CKD-QTY                            15410000
154200              ,  :SUT00017-MAX-CART-CKD-QTY                       15420000
154300              ,  :SUT00017-MIN-CART-CKD-QTY                       15430000
154400              ,  :SUT00017-CKD-DC-QTY                             15440000
154500              ,  :SUT00017-MAX-PO-LNE-QTY                         15450000
154600              ,  :SUT00017-CK-AFT-DAY-QTY                         15460000
154700              ,  :SUT00017-CK-AFT-RCVR-QTY                        15470000
154800              ,  :PV-LIMIT-DAYS                                   15480000
154900          FROM   SUT_VND_RNKG      A                              15490000
155000             ,   SUT_PO_AUD_PARM   B                              15500000
155100          WHERE  A.ENT_ID        = :DK-ENT-ID                     15510000
155200            AND  A.PKGNG_TYP_CDE = :DK-PKGNG-TYP-CDE              15520000
155300            AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                 15530000
155400            AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                15540000
155500            AND  B.EFF_BEG_TMST  = :SUT00015-EFF-BEG-TMST         15550000
155510           WITH UR                                                15551005
155600     END-EXEC.                                                    15560000
155700                                                                  15570000
155800     EVALUATE TRUE                                                15580000
155900         WHEN SQLCODE = ZERO                                      15590000
156000             SET PS-VEND-RANK-FOUND TO TRUE                       15600000
156100         WHEN SQLCODE = +100                                      15610000
156200             SET PS-NO-VEND-RANK-FOUND TO TRUE                    15620000
156300         WHEN SQLWARN0 NOT = SPACES                               15630000
156400         WHEN SQLCODE NOT EQUAL ZERO                              15640000
156410              MOVE '7300'  TO  PV-CSSL-PARA                       15641012
156420              PERFORM 9110-WRITE-SURD021-TO-CSSL                  15642012
156430                                                                  15643012
156440             MOVE '7300-RETREIVE-VENDOR-RANK'                     15644018
156450                             TO DP013-PARAGRAPH                   15645018
156460             MOVE 'SUKCS583 - GET VENDOR RANK'                    15646018
156470                             TO DP013-MESSAGE-TEXT(1)             15647018
156480             MOVE DK-ENT-ID   TO PV-DISPLAY-ENT-ID                15648018
156490             STRING 'ENT:'       PV-DISPLAY-ENT-ID                15649022
156491                    ' PKG TYP:'  DK-PKGNG-TYP-CDE                 15649124
156492                    ' '          SUT00015-EFF-BEG-TMST            15649222
156500                                 DELIMITED BY SIZE                15650022
156600                           INTO DP013-MESSAGE-TEXT(2)             15660018
157300             MOVE SQLCA      TO DP013-SQLCA                       15730018
157400             MOVE 'SUT00019' TO DP013-DB2-TABLE-NAME(1)           15740018
157500             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           15750018
157600             SET DP013-DB2-ABEND                                  15760018
157700                             TO TRUE                              15770018
157800             SET DP013-NO-ROLLBACK                                15780018
157900                             TO TRUE                              15790018
158000             PERFORM 9999-WRITE-CICS-LOG-MSG                      15800018
158100             SET PS-DUMP-TO-LOG       TO TRUE                     15810018
158200             SET PS-NO-PO-INFO-FOUND TO TRUE                      15820018
158300             SET SU021-DB2-ERROR TO TRUE                          15830018
159000     END-EVALUATE.                                                15900000
159100                                                                  15910000
159200 7350-RETREIVE-VENDOR-RANK.                                       15920000
159210                                                                  15921006
159220     IF  PS-BLD-INTERNAL-TABLE-YES                                15922006
159230         MOVE '7350'  TO  PV-CSSL-PARA                            15923006
159240         PERFORM 9120-INTERNAL-TABLE                              15924006
159250     END-IF.                                                      15925006
159260                                                                  15926006
159310     STRING ' SUKCS583 - '                                        15931000
159400            ' 7350-RETREIVE-VENDOR-RANK'                          15940000
159500         DELIMITED BY SIZE                                        15950000
159600         INTO PV-CICS-MSG-AREA.                                   15960000
159700     PERFORM 9990-WRITE-CICS.                                     15970000
159800     EXEC SQL                                                     15980000
159900          SELECT B.VND_RNKG_CDE                                   15990000
160000              ,  B.PKGNG_TYP_CDE                                  16000000
160100              ,  EFF_BEG_TMST                                     16010000
160200              ,  AUD_PCT                                          16020000
160300              ,  CKD_PCT                                          16030000
160400              ,  MAX_CKD_QTY                                      16040000
160500              ,  MAX_CART_CKD_QTY                                 16050000
160600              ,  MIN_CART_CKD_QTY                                 16060000
160700              ,  CKD_DC_QTY                                       16070000
160800              ,  MAX_PO_LNE_QTY                                   16080000
160900              ,  CK_AFT_DAY_QTY                                   16090000
161000              ,  CK_AFT_RCVR_QTY                                  16100000
161100              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         16110000
161200          INTO   :SUT00017-VND-RNKG-CDE                           16120000
161300              ,  :SUT00017-PKGNG-TYP-CDE                          16130000
161400              ,  :SUT00017-EFF-BEG-TMST                           16140000
161500              ,  :SUT00017-AUD-PCT                                16150000
161600              ,  :SUT00017-CKD-PCT                                16160000
161700              ,  :SUT00017-MAX-CKD-QTY                            16170000
161800              ,  :SUT00017-MAX-CART-CKD-QTY                       16180000
161900              ,  :SUT00017-MIN-CART-CKD-QTY                       16190000
162000              ,  :SUT00017-CKD-DC-QTY                             16200000
162100              ,  :SUT00017-MAX-PO-LNE-QTY                         16210000
162200              ,  :SUT00017-CK-AFT-DAY-QTY                         16220000
162300              ,  :SUT00017-CK-AFT-RCVR-QTY                        16230000
162400              ,  :PV-LIMIT-DAYS                                   16240000
162500          FROM   SUT_VND_RNKG      A                              16250000
162600             ,   SUT_PO_AUD_PARM   B                              16260000
162700          WHERE  A.ENT_ID        = :DK-ENT-ID                     16270000
162800            AND  A.PKGNG_TYP_CDE = :DK-PKGNG-TYP-CDE              16280000
162900            AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                 16290000
163000            AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                16300000
163100            AND  B.EFF_BEG_TMST  =                                16310000
163200             (SELECT MAX(C.EFF_BEG_TMST)                          16320000
163300              FROM   SUT_PO_AUD_PARM   C                          16330000
163400              WHERE  B.VND_RNKG_CDE  = C.VND_RNKG_CDE             16340000
163500                AND  B.PKGNG_TYP_CDE = C.PKGNG_TYP_CDE)           16350000
163510           WITH UR                                                16351005
163600     END-EXEC.                                                    16360000
163700                                                                  16370000
163800     EVALUATE TRUE                                                16380000
163900         WHEN SQLCODE = ZERO                                      16390000
164000             SET PS-VEND-RANK-FOUND TO TRUE                       16400000
164100         WHEN SQLCODE = +100                                      16410000
164200             SET PS-NO-VEND-RANK-FOUND TO TRUE                    16420000
164300         WHEN SQLWARN0 NOT = SPACES                               16430000
164400         WHEN SQLCODE NOT EQUAL ZERO                              16440000
164410              MOVE '7350'  TO  PV-CSSL-PARA                       16441012
164420              PERFORM 9110-WRITE-SURD021-TO-CSSL                  16442012
164430                                                                  16443012
164440             MOVE '7350-RETREIVE-VENDOR-RANK'                     16444018
164450                             TO DP013-PARAGRAPH                   16445018
164460             MOVE 'SUKCS583 - GET VENDOR RANK'                    16446018
164470                             TO DP013-MESSAGE-TEXT(1)             16447018
164480             MOVE DK-ENT-ID   TO PV-DISPLAY-ENT-ID                16448018
164490             STRING 'ENT:'       PV-DISPLAY-ENT-ID                16449022
164491                    ' PKG TYP:'  DK-PKGNG-TYP-CDE                 16449122
164500                                 DELIMITED BY SIZE                16450022
164600                           INTO DP013-MESSAGE-TEXT(2)             16460018
165000             MOVE SQLCA      TO DP013-SQLCA                       16500018
165100             MOVE 'SUT00019' TO DP013-DB2-TABLE-NAME(1)           16510018
165200             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           16520018
165300             SET DP013-DB2-ABEND                                  16530018
165400                             TO TRUE                              16540018
165500             SET DP013-NO-ROLLBACK                                16550018
165600                             TO TRUE                              16560018
165700             PERFORM 9999-WRITE-CICS-LOG-MSG                      16570018
165800             SET PS-DUMP-TO-LOG       TO TRUE                     16580018
165900             SET PS-NO-PO-INFO-FOUND TO TRUE                      16590018
166000             SET SU021-DB2-ERROR TO TRUE                          16600018
166700     END-EVALUATE.                                                16670000
166800                                                                  16680000
166900 7400-RETREIVE-DEFAULT-RANK.                                      16690000
166910                                                                  16691006
166920     IF  PS-BLD-INTERNAL-TABLE-YES                                16692006
166930         MOVE '7400'  TO  PV-CSSL-PARA                            16693006
166940         PERFORM 9120-INTERNAL-TABLE                              16694006
166950     END-IF.                                                      16695006
166960                                                                  16696006
167010     STRING ' SUKCS583 - '                                        16701000
167100            ' 7400-RETREIVE-DEFAULT-RANK'                         16710000
167200         DELIMITED BY SIZE                                        16720000
167300         INTO PV-CICS-MSG-AREA.                                   16730000
167400     PERFORM 9990-WRITE-CICS.                                     16740000
167500                                                                  16750000
167600     EXEC SQL                                                     16760000
167700          SELECT VND_RNKG_CDE                                     16770000
167800              ,  PKGNG_TYP_CDE                                    16780000
167900              ,  EFF_BEG_TMST                                     16790000
168000              ,  AUD_PCT                                          16800000
168100              ,  CKD_PCT                                          16810000
168200              ,  MAX_CKD_QTY                                      16820000
168300              ,  MAX_CART_CKD_QTY                                 16830000
168400              ,  MIN_CART_CKD_QTY                                 16840000
168500              ,  CKD_DC_QTY                                       16850000
168600              ,  MAX_PO_LNE_QTY                                   16860000
168700              ,  CK_AFT_DAY_QTY                                   16870000
168800              ,  CK_AFT_RCVR_QTY                                  16880000
168900              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         16890000
169000          INTO   :SUT00017-VND-RNKG-CDE                           16900000
169100              ,  :SUT00017-PKGNG-TYP-CDE                          16910000
169200              ,  :SUT00017-EFF-BEG-TMST                           16920000
169300              ,  :SUT00017-AUD-PCT                                16930000
169400              ,  :SUT00017-CKD-PCT                                16940000
169500              ,  :SUT00017-MAX-CKD-QTY                            16950000
169600              ,  :SUT00017-MAX-CART-CKD-QTY                       16960000
169700              ,  :SUT00017-MIN-CART-CKD-QTY                       16970000
169800              ,  :SUT00017-CKD-DC-QTY                             16980000
169900              ,  :SUT00017-MAX-PO-LNE-QTY                         16990000
170000              ,  :SUT00017-CK-AFT-DAY-QTY                         17000000
170100              ,  :SUT00017-CK-AFT-RCVR-QTY                        17010000
170200              ,  :PV-LIMIT-DAYS                                   17020000
170300          FROM   SUT_PO_AUD_PARM                                  17030000
170400          WHERE  PKGNG_TYP_CDE   = :DK-PKGNG-TYP-CDE              17040000
170500            AND  VND_RNKG_CDE    = :PC-DEFAULT                    17050000
170600            AND  EFF_BEG_TMST    = :SUT00015-EFF-BEG-TMST         17060000
170610           WITH UR                                                17061005
170700     END-EXEC.                                                    17070000
170800                                                                  17080000
170900     EVALUATE TRUE                                                17090000
171000         WHEN SQLCODE = ZERO                                      17100000
171100             SET PS-DEFAULT-RANK-FOUND TO TRUE                    17110000
171200         WHEN SQLCODE = +100                                      17120000
171300             SET PS-NO-DEFAULT-RANK-FOUND TO TRUE                 17130000
171400         WHEN SQLWARN0 NOT = SPACES                               17140000
171500         WHEN SQLCODE NOT EQUAL ZERO                              17150000
171510              MOVE '7400'  TO  PV-CSSL-PARA                       17151012
171520              PERFORM 9110-WRITE-SURD021-TO-CSSL                  17152012
171530                                                                  17153012
171540             MOVE '7400-RETREIVE-DEFAULT-RANK'                    17154018
171550                             TO DP013-PARAGRAPH                   17155018
171560             MOVE 'SUKCS583 - GET DEFAULT RANK'                   17156018
171570                             TO DP013-MESSAGE-TEXT(1)             17157018
171590             STRING 'PKG TYP:'  DK-PKGNG-TYP-CDE                  17159022
171591                    ' DFLT:'    PC-DEFAULT                        17159122
171592                    ' '         SUT00015-EFF-BEG-TMST             17159222
171600                                DELIMITED BY SIZE                 17160022
171700                           INTO DP013-MESSAGE-TEXT(2)             17170018
172400             MOVE SQLCA      TO DP013-SQLCA                       17240018
172500             MOVE 'SUT00019' TO DP013-DB2-TABLE-NAME(1)           17250018
172600             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           17260018
172700             SET DP013-DB2-ABEND                                  17270018
172800                             TO TRUE                              17280018
172900             SET DP013-NO-ROLLBACK                                17290018
173000                             TO TRUE                              17300018
173100             PERFORM 9999-WRITE-CICS-LOG-MSG                      17310018
173200             SET PS-DUMP-TO-LOG       TO TRUE                     17320018
173300             SET PS-NO-PO-INFO-FOUND TO TRUE                      17330018
173400             SET SU021-DB2-ERROR TO TRUE                          17340018
174100     END-EVALUATE.                                                17410000
174200                                                                  17420000
174300 7450-RETREIVE-DEFAULT-RANK.                                      17430000
174310                                                                  17431006
174320     IF  PS-BLD-INTERNAL-TABLE-YES                                17432006
174330         MOVE '7450'  TO  PV-CSSL-PARA                            17433006
174340         PERFORM 9120-INTERNAL-TABLE                              17434006
174350     END-IF.                                                      17435006
174360                                                                  17436006
174410     STRING ' SUKCS583 - '                                        17441000
174500            ' 7450-RETREIVE-DEFAULT-RANK'                         17450000
174600         DELIMITED BY SIZE                                        17460000
174700         INTO PV-CICS-MSG-AREA.                                   17470000
174800     PERFORM 9990-WRITE-CICS.                                     17480000
174900     EXEC SQL                                                     17490000
175000          SELECT VND_RNKG_CDE                                     17500000
175100              ,  PKGNG_TYP_CDE                                    17510000
175200              ,  EFF_BEG_TMST                                     17520000
175300              ,  AUD_PCT                                          17530000
175400              ,  CKD_PCT                                          17540000
175500              ,  MAX_CKD_QTY                                      17550000
175600              ,  MAX_CART_CKD_QTY                                 17560000
175700              ,  MIN_CART_CKD_QTY                                 17570000
175800              ,  CKD_DC_QTY                                       17580000
175900              ,  MAX_PO_LNE_QTY                                   17590000
176000              ,  CK_AFT_DAY_QTY                                   17600000
176100              ,  CK_AFT_RCVR_QTY                                  17610000
176200              ,  DAYS(CURRENT DATE) - (CK_AFT_DAY_QTY +1)         17620000
176300          INTO   :SUT00017-VND-RNKG-CDE                           17630000
176400              ,  :SUT00017-PKGNG-TYP-CDE                          17640000
176500              ,  :SUT00017-EFF-BEG-TMST                           17650000
176600              ,  :SUT00017-AUD-PCT                                17660000
176700              ,  :SUT00017-CKD-PCT                                17670000
176800              ,  :SUT00017-MAX-CKD-QTY                            17680000
176900              ,  :SUT00017-MAX-CART-CKD-QTY                       17690000
177000              ,  :SUT00017-MIN-CART-CKD-QTY                       17700000
177100              ,  :SUT00017-CKD-DC-QTY                             17710000
177200              ,  :SUT00017-MAX-PO-LNE-QTY                         17720000
177300              ,  :SUT00017-CK-AFT-DAY-QTY                         17730000
177400              ,  :SUT00017-CK-AFT-RCVR-QTY                        17740000
177500              ,  :PV-LIMIT-DAYS                                   17750000
177600          FROM   SUT_PO_AUD_PARM A                                17760000
177700          WHERE  A.PKGNG_TYP_CDE = :DK-PKGNG-TYP-CDE              17770000
177800            AND  A.VND_RNKG_CDE  = :PC-DEFAULT                    17780000
177900            AND  A.EFF_BEG_TMST  =                                17790000
178000             (SELECT MAX(B.EFF_BEG_TMST)                          17800000
178100              FROM   SUT_PO_AUD_PARM   B                          17810000
178200              WHERE  A.VND_RNKG_CDE  = B.VND_RNKG_CDE             17820000
178300                AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE)           17830000
178310           WITH UR                                                17831005
178400     END-EXEC.                                                    17840000
178500                                                                  17850000
178600     EVALUATE TRUE                                                17860000
178700         WHEN SQLCODE = ZERO                                      17870000
178800             SET PS-DEFAULT-RANK-FOUND TO TRUE                    17880000
178900         WHEN SQLCODE = +100                                      17890000
179000             SET PS-NO-DEFAULT-RANK-FOUND TO TRUE                 17900000
179100         WHEN SQLWARN0 NOT = SPACES                               17910000
179200         WHEN SQLCODE NOT EQUAL ZERO                              17920000
179210              MOVE '7450'  TO  PV-CSSL-PARA                       17921012
179220              PERFORM 9110-WRITE-SURD021-TO-CSSL                  17922012
179230                                                                  17923012
179240             MOVE '7450-RETREIVE-DEFAULT-RANK'                    17924018
179250                             TO DP013-PARAGRAPH                   17925018
179260             MOVE 'SUKCS583 - GET DEFAULT RANK'                   17926018
179270                             TO DP013-MESSAGE-TEXT(1)             17927018
179271             STRING 'PKG TYP:'  DK-PKGNG-TYP-CDE                  17927122
179272                    ' DFLT:'    PC-DEFAULT                        17927222
179300                                DELIMITED BY SIZE                 17930022
179400                           INTO DP013-MESSAGE-TEXT(2)             17940018
179800             MOVE SQLCA      TO DP013-SQLCA                       17980018
179900             MOVE 'SUT00019' TO DP013-DB2-TABLE-NAME(1)           17990018
180000             MOVE 'SUT00017' TO DP013-DB2-TABLE-NAME(2)           18000018
180100             SET DP013-DB2-ABEND                                  18010018
180200                             TO TRUE                              18020018
180300             SET DP013-NO-ROLLBACK                                18030018
180400                             TO TRUE                              18040018
180500             PERFORM 9999-WRITE-CICS-LOG-MSG                      18050018
180600             SET PS-DUMP-TO-LOG       TO TRUE                     18060018
180700             SET PS-NO-PO-INFO-FOUND TO TRUE                      18070018
180800             SET SU021-DB2-ERROR TO TRUE                          18080018
181500     END-EVALUATE.                                                18150000
181600                                                                  18160000
181700 7500-SELECT-BULK.                                                18170000
181710                                                                  18171006
181720     IF  PS-BLD-INTERNAL-TABLE-YES                                18172006
181730         MOVE '7500'  TO  PV-CSSL-PARA                            18173006
181740         PERFORM 9120-INTERNAL-TABLE                              18174006
181750     END-IF.                                                      18175006
181760                                                                  18176006
181810     STRING ' SUKCS583 - '                                        18181000
181900            ' 7500-SELECT-BULK'                                   18190000
182000         DELIMITED BY SIZE                                        18200000
182100         INTO PV-CICS-MSG-AREA.                                   18210000
182200     PERFORM 9990-WRITE-CICS.                                     18220000
182300     EXEC SQL                                                     18230000
182400          SELECT AUD_TYP_CDE                                      18240000
182500              ,  CRE_TMST                                         18250000
182600              ,  LAST_UPD_TMST                                    18260000
182700              ,  LAST_UPD_BY_USR_ID                               18270000
182800          INTO   :SUT00014-AUD-TYP-CDE                            18280000
182900              ,  :SUT00014-CRE-TMST                               18290000
183000              ,  :SUT00014-LAST-UPD-TMST                          18300000
183100              ,  :SUT00014-LAST-UPD-BY-USR-ID                     18310000
183200          FROM   SUT_PO_AUD_EXC                                   18320000
183300          WHERE  PO_NBR        = :DK-PO-NBR                       18330000
183400            AND  PO_LNE_NBR    = :DK-PO-LINE-NBR                  18340000
183500            AND  OPER_UNT_ID   = :DK-OPER-UNT-ID                  18350000
183510           WITH UR                                                18351005
183600     END-EXEC.                                                    18360000
183700                                                                  18370000
183800     EVALUATE TRUE                                                18380000
183900         WHEN SQLCODE = ZERO                                      18390000
184000             SET PS-LINE-LEVEL-FOUND  TO TRUE                     18400000
184100             MOVE 'PS-LINE-LEVEL-FOUND ' TO PV-CICS-MSG-AREA      18410000
184200             PERFORM 9990-WRITE-CICS                              18420000
184300         WHEN SQLCODE = +100                                      18430000
184400             CONTINUE                                             18440000
184500         WHEN SQLWARN0 NOT = SPACES                               18450000
184600         WHEN SQLCODE NOT EQUAL ZERO                              18460000
184610              MOVE '7500'  TO  PV-CSSL-PARA                       18461012
184620              PERFORM 9110-WRITE-SURD021-TO-CSSL                  18462012
184630                                                                  18463012
184640             MOVE '7500-SELECT-BULK'                              18464018
184650                             TO DP013-PARAGRAPH                   18465018
184660             MOVE 'SUKCS583 - GET PRE-PACK'                       18466018
184670                             TO DP013-MESSAGE-TEXT(1)             18467018
184671             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        18467122
184680             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             18468022
184681             MOVE DK-PO-LINE-NBR TO PV-DISPLAY-PO-LINE-NBR        18468122
184690             STRING 'PO:'           PV-DISPLAY-OPER-UNT-ID        18469022
184700                    '-'             PV-DISPLAY-PO-NBR             18470022
184701                    ' lne:'         PV-DISPLAY-PO-LINE-NBR        18470122
184710                                    DELIMITED BY SIZE             18471022
184800                           INTO DP013-MESSAGE-TEXT(2)             18480018
185700             MOVE SQLCA      TO DP013-SQLCA                       18570018
185800             MOVE 'SUT00014' TO DP013-DB2-TABLE-NAME(1)           18580018
185900             SET DP013-DB2-ABEND                                  18590018
186000                             TO TRUE                              18600018
186100             SET DP013-NO-ROLLBACK                                18610018
186200                             TO TRUE                              18620018
186300             PERFORM 9999-WRITE-CICS-LOG-MSG                      18630018
186400             SET PS-DUMP-TO-LOG       TO TRUE                     18640018
186500             SET PS-NO-PO-INFO-FOUND TO TRUE                      18650018
186600             SET SU021-DB2-ERROR TO TRUE                          18660018
187300     END-EVALUATE.                                                18730000
187400                                                                  18740000
187500 7550-SELECT-PRE-PACK.                                            18750000
187510                                                                  18751006
187520     IF  PS-BLD-INTERNAL-TABLE-YES                                18752006
187530         MOVE '7550'  TO  PV-CSSL-PARA                            18753006
187540         PERFORM 9120-INTERNAL-TABLE                              18754006
187550     END-IF.                                                      18755006
187560                                                                  18756006
187610     STRING ' SUKCS583 - '                                        18761000
187700            ' 7550-SELECT-PRE-PACK'                               18770000
187800         DELIMITED BY SIZE                                        18780000
187900         INTO PV-CICS-MSG-AREA.                                   18790000
188000     PERFORM 9990-WRITE-CICS.                                     18800000
188100     EXEC SQL                                                     18810000
188200          SELECT AUD_TYP_CDE                                      18820000
188300              ,  CRE_TMST                                         18830000
188400              ,  LAST_UPD_TMST                                    18840000
188500              ,  LAST_UPD_BY_USR_ID                               18850000
188600          INTO   :SUT00014-AUD-TYP-CDE                            18860000
188700              ,  :SUT00014-CRE-TMST                               18870000
188800              ,  :SUT00014-LAST-UPD-TMST                          18880000
188900              ,  :SUT00014-LAST-UPD-BY-USR-ID                     18890000
189000          FROM   SUT_PO_AUD_EXC                                   18900000
189100          WHERE  PO_NBR        = :DK-PO-NBR                       18910000
189200            AND  PO_PREPK_ID   = :DK-PREPK-ID                     18920000
189300            AND  OPER_UNT_ID   = :DK-OPER-UNT-ID                  18930000
189310           WITH UR                                                18931005
189400     END-EXEC.                                                    18940000
189500                                                                  18950000
189600     EVALUATE TRUE                                                18960000
189700         WHEN SQLCODE = ZERO                                      18970000
189800             SET PS-LINE-LEVEL-FOUND  TO TRUE                     18980000
189900             MOVE 'PS-LINE-LEVEL-FOUND ' TO PV-CICS-MSG-AREA      18990000
190000             PERFORM 9990-WRITE-CICS                              19000000
190100         WHEN SQLCODE = +100                                      19010000
190200             CONTINUE                                             19020000
190300         WHEN SQLWARN0 NOT = SPACES                               19030000
190400         WHEN SQLCODE NOT EQUAL ZERO                              19040000
190410              MOVE '7550'  TO  PV-CSSL-PARA                       19041012
190420              PERFORM 9110-WRITE-SURD021-TO-CSSL                  19042012
190430                                                                  19043012
190440             MOVE '7550-SELECT-PRE-PACK'                          19044018
190450                             TO DP013-PARAGRAPH                   19045018
190460             MOVE 'SUKCS583 - GET PRE-PACK'                       19046018
190470                             TO DP013-MESSAGE-TEXT(1)             19047018
190471             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        19047122
190480             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             19048022
190481             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           19048122
190490             STRING 'PO:'           PV-DISPLAY-OPER-UNT-ID        19049022
190500                    '-'             PV-DISPLAY-PO-NBR             19050022
190501                    ' PREPK:'       PV-DISPLAY-PREPK-ID           19050122
190510                                    DELIMITED BY SIZE             19051022
190600                           INTO DP013-MESSAGE-TEXT(2)             19060018
191500             MOVE SQLCA      TO DP013-SQLCA                       19150018
191600             MOVE 'SUT00014' TO DP013-DB2-TABLE-NAME(1)           19160018
191700             SET DP013-DB2-ABEND                                  19170018
191800                             TO TRUE                              19180018
191900             SET DP013-NO-ROLLBACK                                19190018
192000                             TO TRUE                              19200018
192100             PERFORM 9999-WRITE-CICS-LOG-MSG                      19210018
192200             SET PS-DUMP-TO-LOG       TO TRUE                     19220018
192300             SET PS-NO-PO-INFO-FOUND TO TRUE                      19230018
192400             SET SU021-DB2-ERROR TO TRUE                          19240018
193100     END-EVALUATE.                                                19310000
193200                                                                  19320000
193300 7600-SELECT-PO-LEVEL.                                            19330000
193310                                                                  19331006
193320     IF  PS-BLD-INTERNAL-TABLE-YES                                19332006
193330         MOVE '7600'  TO  PV-CSSL-PARA                            19333006
193340         PERFORM 9120-INTERNAL-TABLE                              19334006
193350     END-IF.                                                      19335006
193360                                                                  19336006
193410     STRING ' SUKCS583 - '                                        19341000
193500            ' 7600-SELECT-PO-LEVEL'                               19350000
193600         DELIMITED BY SIZE                                        19360000
193700         INTO PV-CICS-MSG-AREA.                                   19370000
193800     PERFORM 9990-WRITE-CICS.                                     19380000
193900     EXEC SQL                                                     19390000
194000          SELECT AUD_TYP_CDE                                      19400000
194100              ,  CRE_TMST                                         19410000
194200              ,  LAST_UPD_TMST                                    19420000
194300              ,  LAST_UPD_BY_USR_ID                               19430000
194400          INTO   :SUT00014-AUD-TYP-CDE                            19440000
194500              ,  :SUT00014-CRE-TMST                               19450000
194600              ,  :SUT00014-LAST-UPD-TMST                          19460000
194700              ,  :SUT00014-LAST-UPD-BY-USR-ID                     19470000
194800          FROM   SUT_PO_AUD_EXC                                   19480000
194900          WHERE  PO_NBR        = :DK-PO-NBR                       19490000
195000            AND  PO_LNE_NBR    = 0                                19500000
195100            AND  PO_PREPK_ID   = 0                                19510000
195200            AND  OPER_UNT_ID   = :DK-OPER-UNT-ID                  19520000
195210           WITH UR                                                19521005
195300     END-EXEC.                                                    19530000
195400                                                                  19540000
195500     EVALUATE TRUE                                                19550000
195600         WHEN SQLCODE = ZERO                                      19560000
195700             SET PS-PO-LEVEL-FOUND  TO TRUE                       19570000
195800             MOVE 'PS-PO-LEVEL-FOUND ' TO PV-CICS-MSG-AREA        19580000
195900             PERFORM 9990-WRITE-CICS                              19590000
196000         WHEN SQLCODE = +100                                      19600000
196100             CONTINUE                                             19610000
196200         WHEN SQLWARN0 NOT = SPACES                               19620000
196300         WHEN SQLCODE NOT EQUAL ZERO                              19630000
196310              MOVE '7600'  TO  PV-CSSL-PARA                       19631012
196320              PERFORM 9110-WRITE-SURD021-TO-CSSL                  19632012
196330                                                                  19633012
196340             MOVE '7600-SELECT-PO-LEVEL'                          19634018
196350                             TO DP013-PARAGRAPH                   19635018
196360             MOVE 'SUKCS583 - GET PRE-PACK'                       19636018
196370                             TO DP013-MESSAGE-TEXT(1)             19637018
196371             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        19637122
196380             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             19638022
196390             STRING 'PO:'           PV-DISPLAY-OPER-UNT-ID        19639022
196400                    '-'             PV-DISPLAY-PO-NBR             19640022
196410                                    DELIMITED BY SIZE             19641022
196500                           INTO DP013-MESSAGE-TEXT(2)             19650018
196600             MOVE SQLCA      TO DP013-SQLCA                       19660018
196700             MOVE 'SUT00014' TO DP013-DB2-TABLE-NAME(1)           19670018
196800             SET DP013-DB2-ABEND                                  19680018
196900                             TO TRUE                              19690018
197000             SET DP013-NO-ROLLBACK                                19700018
197100                             TO TRUE                              19710018
197200             PERFORM 9999-WRITE-CICS-LOG-MSG                      19720018
197300             SET PS-DUMP-TO-LOG       TO TRUE                     19730018
197400             SET PS-NO-PO-INFO-FOUND TO TRUE                      19740018
197500             SET SU021-DB2-ERROR TO TRUE                          19750018
198200     END-EVALUATE.                                                19820000
198300                                                                  19830000
198400 7700-SELECT-FAILED.                                              19840000
198410                                                                  19841006
198420     IF  PS-BLD-INTERNAL-TABLE-YES                                19842006
198430         MOVE '7700'  TO  PV-CSSL-PARA                            19843006
198440         PERFORM 9120-INTERNAL-TABLE                              19844006
198450     END-IF.                                                      19845006
198460                                                                  19846006
198510     STRING ' SUKCS583 - '                                        19851000
198600            ' 7700-SELECT-FAILED'                                 19860000
198700         DELIMITED BY SIZE                                        19870000
198800         INTO PV-CICS-MSG-AREA.                                   19880000
198900     PERFORM 9990-WRITE-CICS.                                     19890000
199000     EXEC SQL                                                     19900000
199100          SELECT AUD_CNTL_NBR                                     19910000
199200              ,  UNT_QTY                                          19920000
199300          INTO   :SUT00015-AUD-CNTL-NBR                           19930000
199400              ,  :SUT00015-UNT-QTY                                19940000
199500          FROM   SUT_PO_AUD_REQ                                   19950000
199600          WHERE  PO_NBR         = :DK-PO-NBR                      19960000
199700            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 19970000
199800            AND  PO_PREPK_ID    = :DK-PREPK-ID                    19980000
199900            AND  AUD_STAT_CDE   = :PC-F                           19990000
200000            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  20000000
200100*CLP 11/05/13 START                                               20010000
200200            AND  PKGNG_TYP_CDE  <> 'RF'                           20020000
200300*CLP 11/05/13 END                                                 20030000
200400     END-EXEC.                                                    20040000
200500                                                                  20050000
200600     EVALUATE TRUE                                                20060000
200700         WHEN SQLCODE = ZERO                                      20070000
200800         WHEN SQLCODE = -811                                      20080000
200900             SET PS-FAILED-AUDITS-FOUND TO TRUE                   20090000
201000             MOVE 'PS-FAILED-AUDITS-FOUND ' TO PV-CICS-MSG-AREA   20100000
201100             PERFORM 9990-WRITE-CICS                              20110000
201200         WHEN SQLCODE = +100                                      20120000
201300             CONTINUE                                             20130000
201400         WHEN SQLWARN0 NOT = SPACES                               20140000
201500         WHEN SQLCODE NOT EQUAL ZERO                              20150000
201510              MOVE '7700'  TO  PV-CSSL-PARA                       20151012
201520              PERFORM 9110-WRITE-SURD021-TO-CSSL                  20152012
201530                                                                  20153012
201540             MOVE '7700-SELECT-FAILED'                            20154018
201550                             TO DP013-PARAGRAPH                   20155018
201560             MOVE 'SUKCS583 - GET FAILED AUDITS'                  20156018
201570                             TO DP013-MESSAGE-TEXT(1)             20157018
201580             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             20158022
201581             MOVE DK-PO-LINE-NBR TO PV-DISPLAY-PO-LINE-NBR        20158122
201582             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           20158222
201590             STRING 'PO:'           PV-DISPLAY-PO-NBR             20159022
201591                    ' LNE:'         PV-DISPLAY-PO-LINE-NBR        20159122
201592                    ' PREPK:'       PV-DISPLAY-PREPK-ID           20159222
201600                                       DELIMITED BY SIZE          20160022
201700                           INTO DP013-MESSAGE-TEXT(2)             20170018
202200             MOVE SQLCA      TO DP013-SQLCA                       20220018
202300             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           20230018
202400             SET DP013-DB2-ABEND                                  20240018
202500                             TO TRUE                              20250018
202600             SET DP013-NO-ROLLBACK                                20260018
202700                             TO TRUE                              20270018
202800             PERFORM 9999-WRITE-CICS-LOG-MSG                      20280018
202900             SET PS-DUMP-TO-LOG       TO TRUE                     20290018
203000             SET SU021-DB2-ERROR TO TRUE                          20300018
203700     END-EVALUATE.                                                20370000
203800                                                                  20380000
203900 7800-SELECT-PASSED.                                              20390000
203910                                                                  20391006
203920     IF  PS-BLD-INTERNAL-TABLE-YES                                20392006
203930         MOVE '7800'  TO  PV-CSSL-PARA                            20393006
203940         PERFORM 9120-INTERNAL-TABLE                              20394006
203950     END-IF.                                                      20395006
203960                                                                  20396006
204010     STRING ' SUKCS583 - '                                        20401000
204100            ' 7700-SELECT-BC-PASSED'                              20410000
204200         DELIMITED BY SIZE                                        20420000
204300         INTO PV-CICS-MSG-AREA.                                   20430000
204400     PERFORM 9990-WRITE-CICS.                                     20440000
204500     MOVE 0         TO PV-PASSED-COUNT.                           20450000
204600     EXEC SQL                                                     20460000
204700          SELECT COUNT(DISTINCT OPER_UNT_ID)                      20470000
204800          INTO   :PV-PASSED-COUNT                                 20480000
204900          FROM   SUT_PO_AUD_REQ                                   20490000
205000          WHERE  PO_NBR         = :DK-PO-NBR                      20500000
205100            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 20510000
205200            AND  PO_PREPK_ID    = :DK-PREPK-ID                    20520000
205300            AND  AUD_STAT_CDE   = :PC-P                           20530000
205400            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  20540000
205410*CLP 11/05/13 START                                               20541000
205420            AND  PKGNG_TYP_CDE  <> 'RF'                           20542000
205430*CLP 11/05/13 END                                                 20543000
205440     END-EXEC.                                                    20544000
205450                                                                  20545000
205460     EVALUATE TRUE                                                20546000
205470         WHEN SQLCODE = ZERO                                      20547000
205480             IF PV-PASSED-COUNT > 0                               20548000
205490                 SET PS-PASSED-AUDITS-FOUND TO TRUE               20549000
205500                 MOVE 'PS-PASSED-AUDITS-FOUND '                   20550000
205600                                              TO PV-CICS-MSG-AREA 20560000
205700                 PERFORM 9990-WRITE-CICS                          20570000
205800             END-IF                                               20580000
205900         WHEN SQLWARN0 NOT = SPACES                               20590000
206000         WHEN SQLCODE NOT EQUAL ZERO                              20600000
206010              MOVE '7800'  TO  PV-CSSL-PARA                       20601012
206020              PERFORM 9110-WRITE-SURD021-TO-CSSL                  20602012
206030                                                                  20603012
206040             MOVE '7800-SELECT-PASSED'                            20604018
206050                             TO DP013-PARAGRAPH                   20605018
206060             MOVE 'SUKCS583 - GET PASSED AUDITS'                  20606018
206070                             TO DP013-MESSAGE-TEXT(1)             20607018
206080             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             20608022
206081             MOVE DK-PO-LINE-NBR TO PV-DISPLAY-PO-LINE-NBR        20608122
206082             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           20608222
206090             STRING 'PO:'           PV-DISPLAY-PO-NBR             20609022
206091                    ' LNE:'         PV-DISPLAY-PO-LINE-NBR        20609122
206092                    ' PREPK:'       PV-DISPLAY-PREPK-ID           20609222
206100                  DELIMITED BY SIZE                               20610022
206200                           INTO DP013-MESSAGE-TEXT(2)             20620018
206700             MOVE SQLCA      TO DP013-SQLCA                       20670018
206800             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           20680018
206900             SET DP013-DB2-ABEND                                  20690018
207000                             TO TRUE                              20700018
207100             SET DP013-NO-ROLLBACK                                20710018
207200                             TO TRUE                              20720018
207300             PERFORM 9999-WRITE-CICS-LOG-MSG                      20730018
207400             SET PS-DUMP-TO-LOG       TO TRUE                     20740018
207500             SET SU021-DB2-ERROR TO TRUE                          20750018
208200     END-EVALUATE.                                                20820000
208300                                                                  20830000
208400                                                                  20840000
208500 7850-SELECT-DC-PASSED.                                           20850000
208510                                                                  20851006
208520     IF  PS-BLD-INTERNAL-TABLE-YES                                20852006
208530         MOVE '7850'  TO  PV-CSSL-PARA                            20853006
208540         PERFORM 9120-INTERNAL-TABLE                              20854006
208550     END-IF.                                                      20855006
208560                                                                  20856006
208610     STRING ' SUKCS583 - '                                        20861000
208700            ' 7850-SELECT-DC-PASSED'                              20870000
208800         DELIMITED BY SIZE                                        20880000
208900         INTO PV-CICS-MSG-AREA.                                   20890000
209000     PERFORM 9990-WRITE-CICS.                                     20900000
209100     MOVE 0         TO PV-PASSED-COUNT.                           20910000
209200     EXEC SQL                                                     20920000
209300          SELECT COUNT(*)                                         20930000
209400          INTO   :PV-PASSED-COUNT                                 20940000
209500          FROM   SUT_PO_AUD_REQ                                   20950000
209600          WHERE  PO_NBR         = :DK-PO-NBR                      20960000
209700            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 20970000
209800            AND  PO_PREPK_ID    = :DK-PREPK-ID                    20980000
209900            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 20990000
210000            AND  AUD_STAT_CDE   = :PC-P                           21000000
210100            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  21010000
210200*CLP 11/05/13 START                                               21020000
210300            AND  PKGNG_TYP_CDE  <> 'RF'                           21030000
210400*CLP 11/05/13 END                                                 21040000
210500     END-EXEC.                                                    21050000
210600                                                                  21060000
210700     EVALUATE TRUE                                                21070000
210800         WHEN SQLCODE = ZERO                                      21080000
210900             CONTINUE                                             21090000
211000         WHEN SQLWARN0 NOT = SPACES                               21100000
211100         WHEN SQLCODE NOT EQUAL ZERO                              21110000
211110              MOVE '7850'  TO  PV-CSSL-PARA                       21111012
211120              PERFORM 9110-WRITE-SURD021-TO-CSSL                  21112012
211130                                                                  21113012
211200             MOVE '7850-SELECT-PASSED'                            21120001
211400                             TO DP013-PARAGRAPH                   21140018
211500             MOVE 'SUKCS583 - GET PASSED AUDITS'                  21150018
211600                             TO DP013-MESSAGE-TEXT(1)             21160018
211610             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        21161022
211700             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             21170022
211710             MOVE DK-PO-LINE-NBR TO PV-DISPLAY-PO-LINE-NBR        21171022
211720             MOVE DK-PREPK-ID    TO PV-DISPLAY-PREPK-ID           21172022
211800             STRING 'PO NBR: '      PV-DISPLAY-OPER-UNT-ID        21180022
211810                    '-'             PV-DISPLAY-PO-NBR             21181022
211820                    ' LNE:'         PV-DISPLAY-PO-LINE-NBR        21182022
211830                    ' PREPK:'       PV-DISPLAY-PREPK-ID           21183023
211900                                    DELIMITED BY SIZE             21190022
212000                           INTO DP013-MESSAGE-TEXT(2)             21200018
212500             MOVE SQLCA      TO DP013-SQLCA                       21250018
212600             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           21260018
212700             SET DP013-DB2-ABEND                                  21270018
212800                             TO TRUE                              21280018
212900             SET DP013-NO-ROLLBACK                                21290018
213000                             TO TRUE                              21300018
213100             PERFORM 9999-WRITE-CICS-LOG-MSG                      21310018
213200             SET PS-DUMP-TO-LOG       TO TRUE                     21320018
213210             SET SU021-DB2-ERROR TO TRUE                          21321018
213300     END-EVALUATE.                                                21330000
213400                                                                  21340000
213500                                                                  21350000
213600                                                                  21360000
213700 7900-SELECT-THIS-FACILITY.                                       21370000
213710                                                                  21371006
213720     IF  PS-BLD-INTERNAL-TABLE-YES                                21372006
213730         MOVE '7900'  TO  PV-CSSL-PARA                            21373006
213740         PERFORM 9120-INTERNAL-TABLE                              21374006
213750     END-IF.                                                      21375006
213760                                                                  21376006
213810     STRING ' SUKCS583 - '                                        21381000
213900            ' 7900-SELECT-THIS-FACILITY'                          21390000
214000         DELIMITED BY SIZE                                        21400000
214100         INTO PV-CICS-MSG-AREA.                                   21410000
214200     PERFORM 9990-WRITE-CICS.                                     21420000
214300     EXEC SQL                                                     21430000
214400          SELECT AUD_CNTL_NBR                                     21440000
214500             ,   AUD_STAT_CDE                                     21450000
214600             ,   CART_QTY                                         21460000
214700             ,   UNT_QTY                                          21470000
214800          INTO   :SUT00015-AUD-CNTL-NBR                           21480000
214900             ,   :SUT00015-AUD-STAT-CDE                           21490000
215000             ,   :SUT00015-CART-QTY                               21500000
215100             ,   :SUT00015-UNT-QTY                                21510000
215200          FROM   SUT_PO_AUD_REQ                                   21520000
215300          WHERE  PO_NBR         = :DK-PO-NBR                      21530000
215400            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 21540000
215500            AND  PO_PREPK_ID    = :DK-PREPK-ID                    21550000
215600            AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                21560000
215700            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 21570000
215800*CLP 11/05/13 START                                               21580000
215900            AND  PKGNG_TYP_CDE  <> 'RF'                           21590000
216000*CLP 11/05/13 END                                                 21600000
216100     END-EXEC.                                                    21610000
216200                                                                  21620000
216300     EVALUATE TRUE                                                21630000
216400         WHEN SQLCODE = ZERO                                      21640000
216500             SET PS-AUDIT-STARTED TO TRUE                         21650000
216600             MOVE 'PS-BC-AUDIT-STARTED    '   TO PV-CICS-MSG-AREA 21660000
216700             PERFORM 9990-WRITE-CICS                              21670000
216800         WHEN SQLCODE = +100                                      21680000
216900             SET PS-NO-AUDIT-STARTED TO TRUE                      21690000
217000             MOVE 'PS-NO-BC-AUDIT-STARTED '   TO PV-CICS-MSG-AREA 21700000
217100             PERFORM 9990-WRITE-CICS                              21710000
217200         WHEN SQLWARN0 NOT = SPACES                               21720000
217300         WHEN SQLCODE NOT EQUAL ZERO                              21730000
217310              MOVE '7900'  TO  PV-CSSL-PARA                       21731012
217320              PERFORM 9110-WRITE-SURD021-TO-CSSL                  21732012
217330                                                                  21733012
217340             MOVE '7900-SELECT-THIS-FACILITY'                     21734018
217350                             TO DP013-PARAGRAPH                   21735018
217360             MOVE 'SUKCS583 - GET AUDITS FOR THIS FACILITY'       21736018
217370                             TO DP013-MESSAGE-TEXT(1)             21737018
217371             MOVE DK-OPER-UNT-ID  TO PV-DISPLAY-OPER-UNT-ID       21737122
217380             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            21738022
217381             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      21738122
217383             MOVE DK-PO-LINE-NBR  TO PV-DISPLAY-PO-LINE-NBR       21738322
217384             MOVE DK-PREPK-ID     TO PV-DISPLAY-PREPK-ID          21738422
217390             STRING 'po:'            PV-DISPLAY-OPER-UNT-ID       21739022
217391                    '-'              PV-DISPLAY-PO-NBR            21739122
217392                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      21739222
217393                    ' LNE:'          PV-DISPLAY-PO-LINE-NBR       21739322
217394                    ' PREPK:'        PV-DISPLAY-PREPK-ID          21739422
217400                                       DELIMITED BY SIZE          21740022
217500                           INTO DP013-MESSAGE-TEXT(2)             21750018
218600             MOVE SQLCA      TO DP013-SQLCA                       21860018
218700             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           21870018
218800             SET DP013-DB2-ABEND                                  21880018
218900                             TO TRUE                              21890018
219000             SET DP013-NO-ROLLBACK                                21900018
219100                             TO TRUE                              21910018
219200             PERFORM 9999-WRITE-CICS-LOG-MSG                      21920018
219300             SET PS-DUMP-TO-LOG       TO TRUE                     21930018
219400             SET SU021-DB2-ERROR TO TRUE                          21940018
220100     END-EVALUATE.                                                22010000
220200                                                                  22020000
220300                                                                  22030000
220400*----------------------------------------------------------------*22040000
220500* COUNT THE NUMBER OF LINES ALREADY PROMPTED FOR THIS PO-RCVR    *22050000
220600*----------------------------------------------------------------*22060000
220700 7950-SELECT-PROMPTED-LINES.                                      22070000
220710                                                                  22071006
220720     IF  PS-BLD-INTERNAL-TABLE-YES                                22072006
220730         MOVE '7950'  TO  PV-CSSL-PARA                            22073006
220740         PERFORM 9120-INTERNAL-TABLE                              22074006
220750     END-IF.                                                      22075006
220760                                                                  22076006
220810     STRING ' SUKCS583 - '                                        22081000
220900            ' 7950-SELECT-PROMPTED-LINES'                         22090000
221000         DELIMITED BY SIZE                                        22100000
221100         INTO PV-CICS-MSG-AREA.                                   22110000
221200     PERFORM 9990-WRITE-CICS.                                     22120000
221300                                                                  22130000
221400     EXEC SQL                                                     22140000
221500          SELECT COUNT(*)                                         22150000
221600          INTO   :PV-PROMPTED-CNT                                 22160000
221700          FROM   SUT_PO_AUD_REQ                                   22170000
221800          WHERE  PO_NBR         = :DK-PO-NBR                      22180000
221900            AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                22190000
222000*CLP 11/05/13 START                                               22200000
222100            AND  PKGNG_TYP_CDE  <> 'RF'                           22210000
222200*CLP 11/05/13 END                                                 22220000
222300     END-EXEC.                                                    22230000
222400                                                                  22240000
222500     EVALUATE TRUE                                                22250000
222600         WHEN SQLCODE = ZERO                                      22260000
222700         WHEN SQLCODE = +100                                      22270000
222800             CONTINUE                                             22280000
222900         WHEN SQLWARN0 NOT = SPACES                               22290000
223000         WHEN SQLCODE NOT EQUAL ZERO                              22300000
223010              MOVE '7950'  TO  PV-CSSL-PARA                       22301012
223020              PERFORM 9110-WRITE-SURD021-TO-CSSL                  22302012
223030                                                                  22303012
223040             MOVE '7950-SELECT-PROMPTED-LINES'                    22304018
223050                                        TO DP013-PARAGRAPH        22305018
223060             MOVE 'SUKCS583 - GET LINE COUNT FOR PO-RCVR  '       22306018
223070                                        TO DP013-MESSAGE-TEXT(1)  22307018
223080             MOVE DK-PO-NBR             TO PV-DISPLAY-PO-NBR      22308018
223090             MOVE DK-RCVR-SEQ-NBR       TO PV-DISPLAY-RCVR-SEQ-NBR22309018
223100             STRING 'PO:'                  PV-DISPLAY-PO-NBR      22310022
223200                    '-'                    PV-DISPLAY-RCVR-SEQ-NBR22320022
223300                                           DELIMITED BY SIZE      22330022
223400                                      INTO DP013-MESSAGE-TEXT(2)  22340018
223500             MOVE SQLCA      TO DP013-SQLCA                       22350018
223600             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           22360018
223700             SET DP013-DB2-ABEND                                  22370018
223800                             TO TRUE                              22380018
223900             SET DP013-NO-ROLLBACK                                22390018
224000                             TO TRUE                              22400018
224100             PERFORM 9999-WRITE-CICS-LOG-MSG                      22410018
224200             SET PS-DUMP-TO-LOG       TO TRUE                     22420018
224300             SET SU021-DB2-ERROR TO TRUE                          22430018
225000     END-EVALUATE.                                                22500000
225100                                                                  22510000
225200******************************************************************22520000
225300* 8000-SELECT-SHPUNT                                              22530000
225400*    GET THE STORE NUMBER FROM THE SHIPPING UNIT TABLE            22540000
225500******************************************************************22550000
225600 8000-SELECT-SHPUNT.                                              22560000
225610                                                                  22561006
225620     IF  PS-BLD-INTERNAL-TABLE-YES                                22562006
225630         MOVE '8000'  TO  PV-CSSL-PARA                            22563006
225640         PERFORM 9120-INTERNAL-TABLE                              22564006
225650     END-IF.                                                      22565006
225660                                                                  22566006
225800     EXEC SQL                                                     22580000
225900         SELECT A.DEST_OPER_UNT_ID                                22590000
226000              , A.ACTV_IND                                        22600000
226100         INTO   :SHPUNT-DEST-OPER-UNT-ID                          22610000
226200              , :SHPUNT-ACTV-IND                                  22620000
226300          FROM  TSHPUNT A                                         22630000
226400          WHERE A.SHIPT_UNT_ID      = :DK-SHIPT-UNT-ID            22640000
226410           WITH UR                                                22641005
226500     END-EXEC.                                                    22650000
226600                                                                  22660000
226700     EVALUATE TRUE                                                22670000
226800        WHEN SQLCODE = ZERO                                       22680000
226900             IF SHPUNT-ACTV-IND  = 'I'                            22690000
227000                 MOVE ZEROS        TO SHPUNT-DEST-OPER-UNT-ID     22700000
227100             END-IF                                               22710000
227200        WHEN SQLCODE = +100                                       22720000
227300             MOVE ZEROS         TO SHPUNT-DEST-OPER-UNT-ID        22730000
227400         WHEN SQLWARN0 NOT = SPACES                               22740000
227500         WHEN SQLCODE NOT EQUAL ZERO                              22750000
227510              MOVE '8000'  TO  PV-CSSL-PARA                       22751012
227520              PERFORM 9110-WRITE-SURD021-TO-CSSL                  22752012
227530                                                                  22753012
227540             MOVE '8000-SELECT-SHPUNT'                            22754018
227550                             TO DP013-PARAGRAPH                   22755018
227560             MOVE 'SUKCS583 - GET DEST OPER UNIT'                 22756018
227570                             TO DP013-MESSAGE-TEXT(1)             22757018
227580             MOVE DK-SHIPT-UNT-ID TO PV-DISPLAY-SHIPT-UNT-ID      22758018
227590             STRING 'SSCC:'          PV-DISPLAY-SHIPT-UNT-ID      22759022
227600                                     DELIMITED BY SIZE            22760022
227700                           INTO DP013-MESSAGE-TEXT(2)             22770018
227800             MOVE SQLCA      TO DP013-SQLCA                       22780018
227900             MOVE 'TSHPUNT ' TO DP013-DB2-TABLE-NAME(1)           22790018
228000             SET DP013-DB2-ABEND                                  22800018
228100                             TO TRUE                              22810018
228200             SET DP013-NO-ROLLBACK                                22820018
228300                             TO TRUE                              22830018
228400             PERFORM 9999-WRITE-CICS-LOG-MSG                      22840018
228500             SET PS-DUMP-TO-LOG       TO TRUE                     22850018
228600             SET SU021-DB2-ERROR TO TRUE                          22860018
229300     END-EVALUATE.                                                22930000
229400                                                                  22940000
229500                                                                  22950000
229600 8100-SUM-PROMPTED-UNITS.                                         22960000
229610                                                                  22961006
229620     IF  PS-BLD-INTERNAL-TABLE-YES                                22962006
229630         MOVE '8100'  TO  PV-CSSL-PARA                            22963006
229640         PERFORM 9120-INTERNAL-TABLE                              22964006
229650     END-IF.                                                      22965006
229660                                                                  22966006
229710     STRING ' SUKCS583 - '                                        22971000
229800            ' 8100-SUM-PROMPTED-UNITS'                            22980000
229900         DELIMITED BY SIZE                                        22990000
230000         INTO PV-CICS-MSG-AREA.                                   23000000
230100     PERFORM 9990-WRITE-CICS.                                     23010000
230200     EXEC SQL                                                     23020000
230300         SELECT SUM(B.SHPD_QTY)                                   23030000
230400           INTO :PV-SHPD-QTY-SUM :DN-SUM-NULL                     23040000
230500           FROM TSUATRN A                                         23050000
230600             ,  TSHUUPC B                                         23060000
230700         WHERE A.AUD_CNTL_NBR    = :DK-AUDIT-CNTL-NBR             23070000
230800           AND A.SHIPT_UNT_ID    = B.SHIPT_UNT_ID                 23080000
230810          with ur                                                 23081016
230900     END-EXEC.                                                    23090000
231000                                                                  23100000
231100     EVALUATE TRUE                                                23110000
231200         WHEN SQLCODE = ZERO                                      23120000
231300             IF DN-SUM-NULL = -1                                  23130000
231400                 MOVE 0     TO PV-SHPD-QTY-SUM                    23140000
231500             END-IF                                               23150000
231600         WHEN SQLWARN0 NOT = SPACES                               23160000
231700         WHEN SQLCODE NOT EQUAL ZERO                              23170000
231710              MOVE '8100'  TO  PV-CSSL-PARA                       23171012
231720              PERFORM 9110-WRITE-SURD021-TO-CSSL                  23172012
231730                                                                  23173012
231740             MOVE '8100-SUM-PROMPTED-UNITS'                       23174018
231750                             TO DP013-PARAGRAPH                   23175018
231760             MOVE 'SUM THE PROMPTED CARTONS'                      23176018
231770                             TO DP013-MESSAGE-TEXT(1)             23177018
231771             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISPLAY-AUDIT        23177122
231772             MOVE SUATRN-SHIPT-UNT-ID  TO PV-DISPLAY-SHIPT-UNT-ID 23177222
231780             STRING 'AUDIT:'              PV-DISPLAY-AUDIT        23178025
231790                    ' SSCC:'              PV-DISPLAY-SHIPT-UNT-ID 23179022
231791                                          DELIMITED BY SIZE       23179122
231800                                       INTO DP013-MESSAGE-TEXT (2)23180018
232300             MOVE SQLCA      TO DP013-SQLCA                       23230018
232400             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           23240018
232500             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(2)           23250022
232600             SET DP013-DB2-ABEND                                  23260018
232700                             TO TRUE                              23270018
232800             SET DP013-NO-ROLLBACK                                23280018
232900                             TO TRUE                              23290018
233000             PERFORM 9999-WRITE-CICS-LOG-MSG                      23300018
233100             SET PS-DUMP-TO-LOG       TO TRUE                     23310018
233200             SET SU021-DB2-ERROR TO TRUE                          23320018
233900     END-EVALUATE.                                                23390000
234000                                                                  23400000
234100                                                                  23410000
234200 8150-SELECT-CURRENT-CARTON.                                      23420000
234210                                                                  23421006
234220     IF  PS-BLD-INTERNAL-TABLE-YES                                23422006
234230         MOVE '8150'  TO  PV-CSSL-PARA                            23423006
234240         PERFORM 9120-INTERNAL-TABLE                              23424006
234250     END-IF.                                                      23425006
234260                                                                  23426006
234310     STRING ' SUKCS583 - '                                        23431000
234400            ' 8150-SELECT-CURRENT-CARTON'                         23440000
234500         DELIMITED BY SIZE                                        23450000
234600         INTO PV-CICS-MSG-AREA.                                   23460000
234700     PERFORM 9990-WRITE-CICS.                                     23470000
234800     EXEC SQL                                                     23480000
234900         SELECT SUM(SHPD_QTY)                                     23490000
235000           INTO :SHUUPC-SHPD-QTY  :DN-SUM-NULL-UPC                23500000
235100           FROM TSHUUPC                                           23510000
235200         WHERE SHIPT_UNT_ID      = :DK-SHIPT-UNT-ID               23520000
235300           AND TRN_NBR           = :DK-PO-NBR                     23530000
235400           AND TRN_LNE_NBR       = :DK-PO-LINE-NBR                23540000
235410          WITH UR                                                 23541005
235500     END-EXEC.                                                    23550000
235600                                                                  23560000
235700     EVALUATE TRUE                                                23570000
235800         WHEN SQLCODE = ZERO                                      23580000
235900             IF DN-SUM-NULL-UPC = -1                              23590000
236000                 MOVE 0     TO SHUUPC-SHPD-QTY                    23600000
236100             END-IF                                               23610000
236200         WHEN SQLWARN0 NOT = SPACES                               23620000
236300         WHEN SQLCODE NOT EQUAL ZERO                              23630000
236310              MOVE '8150'  TO  PV-CSSL-PARA                       23631012
236320              PERFORM 9110-WRITE-SURD021-TO-CSSL                  23632012
236330                                                                  23633012
236340             MOVE '8100-SUM-PROMPTED-UNITS'                       23634018
236350                             TO DP013-PARAGRAPH                   23635018
236360             MOVE 'SUM THE PROMPTED CARTONS'                      23636018
236370                             TO DP013-MESSAGE-TEXT(1)             23637018
236500             MOVE DK-SHIPT-UNT-ID   TO PV-DISPLAY-SHIPT-UNT-ID    23650022
236510             MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR          23651022
236511             MOVE DK-PO-LINE-NBR    TO PV-DISPLAY-PO-LINE-NBR     23651122
236600             STRING 'SSCC:'             PV-DISPLAY-SHIPT-UNT-ID   23660023
236610                    ' PO:'              PV-DISPLAY-PO-NBR         23661022
236620                    ' LNE:'             PV-DISPLAY-PO-LINE-NBR    23662022
236700                                        DELIMITED BY SIZE         23670022
236800                                   INTO DP013-MESSAGE-TEXT (2)    23680022
236900             MOVE SQLCA      TO DP013-SQLCA                       23690018
237100             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           23710018
237200             SET DP013-DB2-ABEND                                  23720018
237300                             TO TRUE                              23730018
237400             SET DP013-NO-ROLLBACK                                23740018
237500                             TO TRUE                              23750018
237600             PERFORM 9999-WRITE-CICS-LOG-MSG                      23760018
237700             SET PS-DUMP-TO-LOG       TO TRUE                     23770018
237800             SET SU021-DB2-ERROR TO TRUE                          23780018
238100     END-EVALUATE.                                                23810000
238200                                                                  23820000
238300                                                                  23830000
238400 8200-SUM-CARTONS.                                                23840000
238410                                                                  23841006
238420     IF  PS-BLD-INTERNAL-TABLE-YES                                23842006
238430         MOVE '8200'  TO  PV-CSSL-PARA                            23843006
238440         PERFORM 9120-INTERNAL-TABLE                              23844006
238450     END-IF.                                                      23845006
238460                                                                  23846006
238510     STRING ' SUKCS583 - '                                        23851000
238600            ' 8200-SUM-CARTONS'                                   23860000
238700         DELIMITED BY SIZE                                        23870000
238800         INTO PV-CICS-MSG-AREA.                                   23880000
238900     PERFORM 9990-WRITE-CICS.                                     23890000
239000     EXEC SQL                                                     23900000
239100         SELECT COUNT(*)                                          23910000
239200           INTO :PV-CARTON-COUNT                                  23920000
239300           FROM TSUATRN                                           23930000
239400         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             23940000
239500     END-EXEC.                                                    23950000
239600                                                                  23960000
239700     EVALUATE TRUE                                                23970000
239800         WHEN SQLCODE = ZERO                                      23980000
239900             CONTINUE                                             23990000
240000         WHEN SQLWARN0 NOT = SPACES                               24000000
240100         WHEN SQLCODE NOT EQUAL ZERO                              24010000
240110              MOVE '8200'  TO  PV-CSSL-PARA                       24011012
240120              PERFORM 9110-WRITE-SURD021-TO-CSSL                  24012012
240130                                                                  24013012
240140             MOVE '8200-SUM-CARTONS'                              24014018
240150                             TO DP013-PARAGRAPH                   24015018
240160             MOVE 'SUM THE PROMPTED CARTONS'                      24016018
240170                             TO DP013-MESSAGE-TEXT(1)             24017018
240171             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISPLAY-AUDIT        24017122
240180             STRING 'AUDIT:'              PV-DISPLAY-AUDIt        24018022
240190                                          DELIMITED BY SIZE       24019022
240200                                     INTO DP013-MESSAGE-TEXT (2)  24020022
240700             MOVE SQLCA      TO DP013-SQLCA                       24070018
240800             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           24080018
240900             SET DP013-DB2-ABEND                                  24090018
241000                             TO TRUE                              24100018
241100             SET DP013-NO-ROLLBACK                                24110018
241200                             TO TRUE                              24120018
241300             PERFORM 9999-WRITE-CICS-LOG-MSG                      24130018
241400             SET PS-DUMP-TO-LOG       TO TRUE                     24140018
241500             SET SU021-DB2-ERROR TO TRUE                          24150018
242200     END-EVALUATE.                                                24220000
242300                                                                  24230000
242400                                                                  24240000
242500 8250-SELECT-EXPECTD-CNT.                                         24250000
242510                                                                  24251006
242520     IF  PS-BLD-INTERNAL-TABLE-YES                                24252006
242530         MOVE '8250'  TO  PV-CSSL-PARA                            24253006
242540         PERFORM 9120-INTERNAL-TABLE                              24254006
242550     END-IF.                                                      24255006
242560                                                                  24256006
242610     STRING ' SUKCS583 - '                                        24261000
242700            ' 8250-SELECT-EXPECTD-CNT'                            24270000
242800         DELIMITED BY SIZE                                        24280000
242900         INTO PV-CICS-MSG-AREA.                                   24290000
243000     PERFORM 9990-WRITE-CICS.                                     24300000
243100     INITIALIZE        PV-DB2-COUNT-EXP-SCN.                      24310000
243200                                                                  24320000
243300     EXEC SQL                                                     24330000
243400          SELECT  COUNT(*)                                        24340000
243500          INTO  :PV-DB2-COUNT-EXP-SCN                             24350000
243600          FROM   TSHPTPO B                                        24360000
243700                ,TPKSLIP C                                        24370000
243800                ,TINPKSU D                                        24380000
243900          WHERE B.PO_NBR         = :DK-PO-NBR                     24390000
244000            AND B.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR               24400000
244100            AND B.PO_NBR         = C.PO_NBR                       24410000
244200            AND B.REC_SEQ_NBR    = C.REC_SEQ_NBR                  24420000
244300            AND B.PRIM_SHIPT_IND = 'Y'                            24430000
244400            AND C.VER_STAT_CDE   = 'A'                            24440000
244500            AND B.PO_NBR         = D.PO_NBR                       24450000
244600            AND D.SEQ_NBR        = C.SEQ_NBR                      24460000
244700            AND NOT EXISTS                                        24470000
244800             (SELECT *                                            24480000
244900                FROM TSHUNLO E                                    24490000
245000               WHERE  E.SHIPT_UNT_ID   = D.SHIPT_UNT_ID           24500000
245100                 AND  E.ACTV_CDE       = 'A'                      24510000
245200                 AND  E.SCN_LOC_ID     = 'RECV')                  24520000
245210           with ur                                                24521016
245300     END-EXEC                                                     24530000
245400                                                                  24540000
245500                                                                  24550000
245600     EVALUATE TRUE                                                24560000
245700         WHEN SQLCODE = ZERO                                      24570000
245800         WHEN SQLCODE = +100                                      24580000
245900              CONTINUE                                            24590000
246000         WHEN SQLWARN0 NOT = SPACE                                24600000
246100         WHEN SQLCODE NOT = ZERO                                  24610000
246110              MOVE '8250'  TO  PV-CSSL-PARA                       24611012
246120              PERFORM 9110-WRITE-SURD021-TO-CSSL                  24612012
246130                                                                  24613012
246140             MOVE '8250-SELECT-EXPECTD-CNT'                       24614018
246150                               TO DP013-PARAGRAPH                 24615018
246160             MOVE 'SUKCS583 - GET PO EXPECTED COUNT'              24616018
246170                             TO DP013-MESSAGE-TEXT(1)             24617018
246171             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            24617122
246180             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      24618022
246200             STRING 'PO:'            PV-DISPLAY-PO-NBR            24620022
246300                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      24630022
246400                                       DELIMITED BY SIZE          24640018
246500                           INTO DP013-MESSAGE-TEXT(2)             24650018
247600             MOVE SQLCA      TO DP013-SQLCA                       24760018
247700             MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME(1)           24770018
247800             MOVE 'TPKSLIP'  TO DP013-DB2-TABLE-NAME(2)           24780018
247900             MOVE 'TINPKSU'  TO DP013-DB2-TABLE-NAME(3)           24790018
248000             SET DP013-DB2-ABEND                                  24800018
248100                             TO TRUE                              24810018
248200             SET DP013-NO-ROLLBACK                                24820018
248300                             TO TRUE                              24830018
248400             PERFORM 9999-WRITE-CICS-LOG-MSG                      24840018
248500             SET PS-DUMP-TO-LOG       TO TRUE                     24850018
248600             SET SU021-DB2-ERROR TO TRUE                          24860018
249300     END-EVALUATE.                                                24930000
249400                                                                  24940000
249500                                                                  24950000
249600****************************************************************  24960000
249700* 8300-INSERT-TSUNAUD.                                         *  24970000
249800*   INSERT A NEW SHIPPING UNIT AUDIT RECORD                    *  24980000
249900****************************************************************  24990000
250000 8300-INSERT-TSUNAUD.                                             25000000
250010                                                                  25001006
250020     IF  PS-BLD-INTERNAL-TABLE-YES                                25002006
250030         MOVE '8300'  TO  PV-CSSL-PARA                            25003006
250040         PERFORM 9120-INTERNAL-TABLE                              25004006
250050     END-IF.                                                      25005006
250060                                                                  25006006
250110     STRING ' SUKCS583 - '                                        25011000
250200            ' 8300-INSERT-TSUNAUD'                                25020000
250300         DELIMITED BY SIZE                                        25030000
250400         INTO PV-CICS-MSG-AREA.                                   25040000
250500     PERFORM 9990-WRITE-CICS.                                     25050000
250600     EXEC SQL                                                     25060000
250700         INSERT INTO TSUNAUD                                      25070000
250800               (AUD_CNTL_NBR                                      25080000
250900             ,  AUD_STRT_TMST                                     25090000
251000             ,  AUD_STP_TMST                                      25100000
251100             ,  AUD_PSPND_MNIT_QTY                                25110000
251200             ,  AUD_CLO_MNIT_QTY                                  25120000
251300             ,  AUD_USR_ID                                        25130000
251400             ,  OPER_UNT_ID                                       25140000
251500             ,  FCLTY_ID                                          25150000
251600             ,  PRC_FCLTY_AREA_ID                                 25160000
251700             ,  AUD_STAT_CDE                                      25170000
251800             ,  AUD_TYP_CDE                                       25180000
251900             ,  AUD_CAT_CDE                                       25190000
252000             ,  DEST_TYP_CDE)                                     25200000
252100        VALUES (:SUNAUD-AUD-CNTL-NBR                              25210000
252200             ,  '9999-09-09-09.09.09.999999'                      25220000
252300             ,  '9999-09-09-09.09.09.999999'                      25230000
252400             ,  :SUNAUD-AUD-PSPND-MNIT-QTY                        25240000
252500             ,  :SUNAUD-AUD-CLO-MNIT-QTY                          25250000
252600             ,  :SUNAUD-AUD-USR-ID                                25260000
252700             ,  :SUNAUD-OPER-UNT-ID                               25270000
252800             ,  :SUNAUD-FCLTY-ID                                  25280000
252900             ,  :SUNAUD-PRC-FCLTY-AREA-ID                         25290000
253000             ,  :SUNAUD-AUD-STAT-CDE                              25300000
253100             ,  :SUNAUD-AUD-TYP-CDE                               25310000
253200             ,  :SUNAUD-AUD-CAT-CDE                               25320000
253300             ,  :SUNAUD-DEST-TYP-CDE)                             25330000
253400     END-EXEC.                                                    25340000
253500                                                                  25350000
253600     EVALUATE TRUE                                                25360000
253700         WHEN SQLCODE = ZERO                                      25370000
253800              CONTINUE                                            25380000
253900         WHEN SQLWARN0 NOT = SPACES                               25390000
254000         WHEN SQLCODE < ZERO                                      25400000
254100         WHEN SQLCODE > ZERO                                      25410000
254110              MOVE '8300'  TO  PV-CSSL-PARA                       25411012
254120              PERFORM 9110-WRITE-SURD021-TO-CSSL                  25412012
254130                                                                  25413012
254140             MOVE '8300-INSERT-TSUNAUD'  TO DP013-PARAGRAPH       25414018
254150             MOVE 'INSERT TSUNADU'       TO DP013-MESSAGE-TEXT (1)25415018
254151             MOVE SUNAUD-AUD-CNTL-NBR  TO PV-DISPLAY-AUDIT        25415122
254160             STRING 'AUDIT:'              PV-DISPLAY-AUDIT        25416022
254170                                          DELIMITED BY SIZE       25417022
254180                                     INTO DP013-MESSAGE-TEXT (2)  25418022
254190             MOVE SQLCA                TO DP013-SQLCA             25419022
254200             MOVE 'TSUNAUD'            TO DP013-DB2-TABLE-NAME (1)25420018
254300             SET DP013-DB2-ABEND                                  25430018
254400                             TO TRUE                              25440018
254500             SET DP013-NO-ROLLBACK                                25450018
254600                             TO TRUE                              25460018
254700             PERFORM 9999-WRITE-CICS-LOG-MSG                      25470018
254800             SET PS-DUMP-TO-LOG       TO TRUE                     25480018
254900             SET SU021-DB2-ERROR TO TRUE                          25490018
255600     END-EVALUATE.                                                25560000
255700                                                                  25570000
255800                                                                  25580000
255900 8350-INSERT-TSUATRN.                                             25590000
255910                                                                  25591006
255920     IF  PS-BLD-INTERNAL-TABLE-YES                                25592006
255930         MOVE '8350'  TO  PV-CSSL-PARA                            25593006
255940         PERFORM 9120-INTERNAL-TABLE                              25594006
255950     END-IF.                                                      25595006
255960                                                                  25596006
256010     STRING ' SUKCS583 - '                                        25601000
256100            ' 8350-INSERT-TSUATRN'                                25610000
256200         DELIMITED BY SIZE                                        25620000
256300         INTO PV-CICS-MSG-AREA.                                   25630000
256400     PERFORM 9990-WRITE-CICS.                                     25640000
256500     EXEC SQL                                                     25650000
256600         INSERT INTO TSUATRN                                      25660000
256700               (AUD_CNTL_NBR                                      25670000
256800             ,  SHIPT_UNT_ID                                      25680000
256900             ,  UNT_AUD_STRT_TMST                                 25690000
257000             ,  UNT_AUD_STP_TMST                                  25700000
257100             ,  UNT_PSPND_MNIT_QTY                                25710000
257200             ,  UNT_CLO_MNIT_QTY                                  25720000
257300             ,  UNT_AUD_USR_ID                                    25730000
257400             ,  UNT_AUD_STAT_CDE                                  25740000
257500             ,  TRN_NBR                                           25750000
257600             ,  REC_SEQ_NBR                                       25760000
257700             ,  DEST_OPER_UNT_ID                                  25770000
257800             ,  DEST_FCLTY_ID                                     25780000
257900             ,  UNT_AUD_ERR_IND)                                  25790000
258000        VALUES (:SUATRN-AUD-CNTL-NBR                              25800000
258100             ,  :SUATRN-SHIPT-UNT-ID                              25810000
258200             ,  :PC-DEFAULT-DATE                                  25820000
258300             ,  :PC-DEFAULT-DATE                                  25830000
258400             ,   0                                                25840000
258500             ,   0                                                25850000
258600             ,  :SUATRN-UNT-AUD-USR-ID                            25860000
258700             ,  :SUATRN-UNT-AUD-STAT-CDE                          25870000
258800             ,  :SUATRN-TRN-NBR                                   25880000
258900             ,  :SUATRN-REC-SEQ-NBR                               25890000
259000             ,  :SUATRN-DEST-OPER-UNT-ID                          25900000
259100             ,  1                                                 25910000
259200             ,  :SUATRN-UNT-AUD-ERR-IND)                          25920000
259300     END-EXEC.                                                    25930000
259400                                                                  25940000
259500     EVALUATE TRUE                                                25950000
259600         WHEN SQLCODE = ZERO                                      25960000
259700             CONTINUE                                             25970000
259800         WHEN SQLWARN0 NOT = SPACES                               25980000
259900         WHEN SQLCODE NOT EQUAL ZERO                              25990000
259910              MOVE '8350'  TO  PV-CSSL-PARA                       25991012
259920              PERFORM 9110-WRITE-SURD021-TO-CSSL                  25992012
259930                                                                  25993012
259940             MOVE '8350-INSERT-TSUATRN'                           25994018
259950                             TO DP013-PARAGRAPH                   25995018
259960             MOVE 'INSERT AUDIT RECORD'                           25996018
259970                             TO DP013-MESSAGE-TEXT(1)             25997018
259971             MOVE SUATRN-AUD-CNTL-NBR TO PV-DISPLAY-AUDIT         25997122
259972             MOVE SUATRN-SHIPT-UNT-ID TO PV-DISPLAY-SHIPT-UNT-ID  25997222
259980             STRING 'AUDIT:'             PV-DISPLAY-AUDIT         25998022
259990                    ' SSCC:'             PV-DISPLAY-SHIPT-UNT-ID  25999022
259991                                         DELIMITED BY SIZE        25999122
260000                                    INTO DP013-MESSAGE-TEXT (2)   26000022
260500             MOVE SQLCA      TO DP013-SQLCA                       26050018
260600             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           26060018
260700             SET DP013-DB2-ABEND                                  26070018
260800                             TO TRUE                              26080018
260900             SET DP013-NO-ROLLBACK                                26090018
261000                             TO TRUE                              26100018
261100             PERFORM 9999-WRITE-CICS-LOG-MSG                      26110018
261200             SET PS-DUMP-TO-LOG       TO TRUE                     26120018
261300             SET SU021-DB2-ERROR TO TRUE                          26130018
262000     END-EVALUATE.                                                26200000
262100                                                                  26210000
262200                                                                  26220000
262300 8400-INSERT-PO-AUD-REQ.                                          26230000
262310                                                                  26231006
262320     IF  PS-BLD-INTERNAL-TABLE-YES                                26232006
262330         MOVE '8400'  TO  PV-CSSL-PARA                            26233006
262340         PERFORM 9120-INTERNAL-TABLE                              26234006
262350     END-IF.                                                      26235006
262360                                                                  26236006
262400                                                                  26240000
262410     STRING ' SUKCS583 - '                                        26241000
262500            ' 8400-INSERT-PO-AUD-REQ'                             26250000
262600         DELIMITED BY SIZE                                        26260000
262700         INTO PV-CICS-MSG-AREA.                                   26270000
262800     PERFORM 9990-WRITE-CICS.                                     26280000
262900     EXEC SQL                                                     26290000
263000         INSERT INTO SUT_PO_AUD_REQ                               26300000
263100               (PO_NBR                                            26310000
263200             ,  PO_LNE_NBR                                        26320000
263300             ,  PO_PREPK_ID                                       26330000
263400             ,  OPER_UNT_ID                                       26340000
263500             ,  INBND_TRIP_ID                                     26350000
263600             ,  RCVR_SEQ_NBR                                      26360000
263700             ,  AUD_CNTL_NBR                                      26370000
263800             ,  VND_RNKG_CDE                                      26380000
263900             ,  PKGNG_TYP_CDE                                     26390000
264000             ,  EFF_BEG_TMST                                      26400000
264100             ,  CART_QTY                                          26410000
264200             ,  UNT_QTY                                           26420000
264300             ,  AUD_CART_QTY                                      26430000
264400             ,  AUD_UNT_QTY                                       26440000
264500             ,  AUD_STAT_CDE                                      26450000
264600             ,  DFRD_AUD_IND                                      26460000
264700             ,  AUD_ERR_PCT                                       26470000
264800             ,  CRE_TMST                                          26480000
264900             ,  CART_PRMPT_CDE                                    26490000
265000             ,  ENT_ID                                            26500000
265100             ,  DEPT_NBR)                                         26510000
265200        VALUES (:SUT00015-PO-NBR                                  26520000
265300             ,  :SUT00015-PO-LNE-NBR                              26530000
265400             ,  :SUT00015-PO-PREPK-ID                             26540000
265500             ,  :SUT00015-OPER-UNT-ID                             26550000
265600             ,  :SUT00015-INBND-TRIP-ID                           26560000
265700             ,  :SUT00015-RCVR-SEQ-NBR                            26570000
265800             ,  :SUT00015-AUD-CNTL-NBR                            26580000
265900             ,  :SUT00015-VND-RNKG-CDE                            26590000
266000             ,  :SUT00015-PKGNG-TYP-CDE                           26600000
266100             ,  :SUT00015-EFF-BEG-TMST                            26610000
266200             ,  :SUT00015-CART-QTY                                26620000
266300             ,  :SUT00015-UNT-QTY                                 26630000
266400             ,  :SUT00015-AUD-CART-QTY                            26640000
266500             ,  :SUT00015-AUD-UNT-QTY                             26650000
266600             ,  :SUT00015-AUD-STAT-CDE                            26660000
266700             ,  :SUT00015-DFRD-AUD-IND                            26670000
266800             ,  :SUT00015-AUD-ERR-PCT                             26680000
266900             ,  CURRENT TIMESTAMP                                 26690000
267000             ,  :SUT00015-CART-PRMPT-CDE                          26700000
267100             ,  :SUT00015-ENT-ID                                  26710000
267200             ,  :SUT00015-DEPT-NBR)                               26720000
267300     END-EXEC.                                                    26730000
267400                                                                  26740000
267500     EVALUATE TRUE                                                26750000
267600         WHEN SQLCODE = ZERO                                      26760000
267700             CONTINUE                                             26770000
267800         WHEN SQLWARN0 NOT = SPACES                               26780000
267900         WHEN SQLCODE NOT EQUAL ZERO                              26790000
267910              MOVE '8400'  TO  PV-CSSL-PARA                       26791012
267920              PERFORM 9110-WRITE-SURD021-TO-CSSL                  26792012
267930                                                                  26793012
267940             MOVE '8400-INSERT-PO-AUD-REQ'                        26794018
267950                             TO DP013-PARAGRAPH                   26795018
267960             MOVE 'INSERT PO-AUD-REQ'                             26796018
267970                             TO DP013-MESSAGE-TEXT(1)             26797018
267980             MOVE SUT00015-OPER-UNT-ID  to PV-DISPLAY-OPER-UNT-ID 26798022
267981             MOVE SUT00015-PO-NBR       TO PV-DISPLAY-PO-NBR      26798122
267982             MOVE SUT00015-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR26798222
267983             MOVE SUT00015-PO-LNE-NBR   TO PV-DISPLAY-PO-LINE-NBR 26798322
267990             STRING 'PO:'                  PV-DISPLAY-OPER-UNT-ID 26799024
268000                    '-'                    PV-DISPLAY-PO-NBR      26800022
268010                    '-'                    PV-DISPLAY-RCVR-SEQ-NBR26801022
268020                    '-'                    PV-DISPLAY-PO-LINE-NBR 26802022
268030                                           DELIMITED BY SIZE      26803022
268100                                      INTO DP013-MESSAGE-TEXT(2)  26810022
268600             MOVE SQLCA      TO DP013-SQLCA                       26860018
268700             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           26870018
268800             SET DP013-DB2-ABEND                                  26880018
268900                             TO TRUE                              26890018
269000             SET DP013-NO-ROLLBACK                                26900018
269100                             TO TRUE                              26910018
269200             PERFORM 9999-WRITE-CICS-LOG-MSG                      26920018
269300             SET PS-DUMP-TO-LOG       TO TRUE                     26930018
269400             SET SU021-DB2-ERROR TO TRUE                          26940018
270100     END-EVALUATE.                                                27010000
270200                                                                  27020000
270300*CLP 11/05/13 - START                                             27030000
270301**************************************************************    27030100
270302*  CHECK IF RFID AUDIT EXISTS IF SO UPDATE THE QC AUDIT WITH      27030200
270303*  THE RFID AUDIT # IN THE WORK NO.                               27030300
270304**************************************************************    27030400
270305                                                                  27030500
270306 8410-CHK-IF-RFID-AUDIT-EXISTS.                                   27030600
270307                                                                  27030706
270308     IF  PS-BLD-INTERNAL-TABLE-YES                                27030806
270309         MOVE '8410'  TO  PV-CSSL-PARA                            27030906
270310         PERFORM 9120-INTERNAL-TABLE                              27031006
270311     END-IF.                                                      27031106
270312                                                                  27031206
270313     SET PS-NO-RFID-REC-FOUND     TO TRUE.                        27031300
270314     MOVE SU021-PO-NUMBER         TO DK-PO-NBR.                   27031400
270315     MOVE 0                       TO DK-PO-LINE-NBR.              27031500
270316                                                                  27031600
270320     MOVE -9999                   TO DK-PREPK-ID.                 27032000
270330                                                                  27033000
270340     MOVE SU021-REC-SEQ-NBR       TO DK-RCVR-SEQ-NBR.             27034000
270350     INITIALIZE DCLSUT00015.                                      27035000
270360                                                                  27036000
270370     EXEC SQL                                                     27037000
270380          SELECT AUD_CNTL_NBR                                     27038000
270390          INTO   :DK-RFID-AUD-CNTL-NBR                            27039000
270400          FROM   SUT_PO_AUD_REQ                                   27040000
270410          WHERE  PO_NBR         = :DK-PO-NBR                      27041000
270411            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 27041100
270412            AND  PO_PREPK_ID    = :DK-PREPK-ID                    27041200
270413            AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                27041300
270414            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 27041400
270415            AND  PKGNG_TYP_CDE  = 'RF'                            27041500
270416*GB 01/06/14 START                                                27041600
270417            AND  CART_PRMPT_CDE NOT IN ('D','F')                  27041700
270418*GB 01/06/14 END                                                  27041800
270419     END-EXEC.                                                    27041900
270420                                                                  27042000
270421     EVALUATE TRUE                                                27042100
270422         WHEN SQLCODE = ZERO                                      27042200
270423             SET PS-RFID-REC-FOUND TO TRUE                        27042300
270424         WHEN SQLCODE = -811                                      27042400
270425             SET PS-NO-RFID-REC-FOUND TO TRUE                     27042500
270426         WHEN SQLCODE = +100                                      27042600
270427             SET PS-NO-RFID-REC-FOUND TO TRUE                     27042700
270428         WHEN SQLWARN0 NOT = SPACES                               27042800
270429         WHEN SQLCODE NOT EQUAL ZERO                              27042900
270430              MOVE '8410'  TO  PV-CSSL-PARA                       27043012
270431              PERFORM 9110-WRITE-SURD021-TO-CSSL                  27043112
270432                                                                  27043212
270433             MOVE '8410-CHK-IF-RFID-AUDIT-EXISTS'                 27043318
270434                             TO DP013-PARAGRAPH                   27043418
270435             MOVE 'SUKCS583 - CHK RFID         '                  27043518
270436                             TO DP013-MESSAGE-TEXT(1)             27043618
270437             MOVE DK-OPER-UNT-ID  to PV-DISPLAY-OPER-UNT-ID       27043722
270438             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            27043822
270439             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      27043922
270440             MOVE DK-PO-LINE-NBR  TO PV-DISPLAY-PO-LINE-NBR       27044022
270441             MOVE DK-PREPK-ID     TO PV-DISPLAY-PREPK-ID          27044122
270442                                                                  27044222
270443             STRING 'PO:'            PV-DISPLAY-OPER-UNT-ID       27044322
270444                    '-'              PV-DISPLAY-PO-NBR            27044422
270445                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      27044522
270446                    '-'              PV-DISPLAY-PO-LINE-NBR       27044622
270447                    ' prepk:'        PV-DISPLAY-PREPK-ID          27044722
270448                                     DELIMITED BY SIZE            27044822
270449                                INTO DP013-MESSAGE-TEXT(2)        27044922
270496             MOVE SQLCA      TO DP013-SQLCA                       27049618
270497             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           27049718
270498             SET DP013-DB2-ABEND                                  27049818
270499                             TO TRUE                              27049918
270500             SET DP013-NO-ROLLBACK                                27050018
270501                             TO TRUE                              27050118
270502             PERFORM 9999-WRITE-CICS-LOG-MSG                      27050218
270503             SET PS-DUMP-TO-LOG       TO TRUE                     27050318
270504             SET SU021-RFID-DB2-ERROR TO TRUE                     27050418
270505     END-EVALUATE.                                                27050502
270506                                                                  27050602
270507****************************************************************  27050702
270508* QC AUDIT ROW - PUT THE RFID AUDIT NUMBER IN THE              *  27050802
270509* RWRK_AUD_CNTL_NBR                                            *  27050902
270510****************************************************************  27051002
270511 8420-UPDATE-RWK-NO.                                              27051103
270512                                                                  27051206
270513     IF  PS-BLD-INTERNAL-TABLE-YES                                27051306
270514         MOVE '8420'  TO  PV-CSSL-PARA                            27051406
270515         PERFORM 9120-INTERNAL-TABLE                              27051506
270516     END-IF.                                                      27051606
270517                                                                  27051706
270518*    AUDIT # IS UNIQUE WITHIN PO                                  27051802
270519                                                                  27051902
270520     MOVE PV-AUDIT-CNTL-NBR   TO  DK-AUDIT-CNTL-NBR.              27052002
270521     EXEC SQL                                                     27052102
270522          UPDATE SUT_PO_AUD_REQ                                   27052202
270523          SET    RWRK_AUD_CNTL_NBR = :DK-RFID-AUD-CNTL-NBR        27052302
270524          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR              27052402
270525            AND  PO_NBR         = :DK-PO-NBR                      27052502
270526            AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                27052602
270527            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 27052702
270528     END-EXEC.                                                    27052802
270529                                                                  27052902
270530     EVALUATE TRUE                                                27053002
270531         WHEN SQLCODE = ZERO                                      27053102
270532             CONTINUE                                             27053202
270533         WHEN SQLCODE = +100                                      27053302
270534             MOVE '8420- NO RF AUDIT EXISTS'  TO PV-CICS-MSG-AREA 27053402
270535             PERFORM 9990-WRITE-CICS                              27053502
270536         WHEN SQLWARN0 NOT = SPACES                               27053602
270537         WHEN SQLCODE NOT EQUAL ZERO                              27053702
270538              MOVE '8420'  TO  PV-CSSL-PARA                       27053812
270539              PERFORM 9110-WRITE-SURD021-TO-CSSL                  27053912
270540                                                                  27054012
270550             MOVE '8420-UPDATE-RWK-NO'                            27055018
270560                             TO DP013-PARAGRAPH                   27056018
270570             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT           27057022
270571             MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR          27057122
270572             MOVE DK-RCVR-SEQ-NBR   TO PV-DISPLAY-RCVR-SEQ-NBR    27057222
270580             MOVE DK-OPER-UNT-ID    TO PV-DISPLAY-PO-LINE-NBR     27058022
270590             STRING 'AUDIT:'           PV-DISPLAY-AUDIT           27059022
270591                    ' PO:'             PV-DISPLAY-PO-NBR          27059122
270592                    '-'                PV-DISPLAY-RCVR-SEQ-NBR    27059222
270593                    '-'                PV-DISPLAY-PO-LINE-NBR     27059322
270594                                       DELIMITED BY SIZE          27059422
270596                           INTO DP013-MESSAGE-TEXT(1)             27059622
270613             MOVE SQLCA      TO DP013-SQLCA                       27061322
270614             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           27061422
270615             SET DP013-DB2-ABEND                                  27061522
270616                             TO TRUE                              27061622
270617             SET DP013-NO-ROLLBACK                                27061722
270618                             TO TRUE                              27061822
270619             PERFORM 9999-WRITE-CICS-LOG-MSG                      27061922
270620             SET PS-DUMP-TO-LOG       TO TRUE                     27062022
270621             SET SU021-RFID-DB2-ERROR TO TRUE                     27062122
270622     END-EVALUATE.                                                27062222
270623*CLP 11/05/13 - END                                               27062322
270624******************************************************************27062422
270625*  READ THE DISTRIBUTION TRANSACTION HEADER FOR MODULE AND        27062522
270626*  CARTON DATA.                                                   27062622
270627******************************************************************27062722
270628 8450-SELECT-DIST-HEAD.                                           27062822
270629                                                                  27062922
270630     IF  PS-BLD-INTERNAL-TABLE-YES                                27063022
270631         MOVE '8450'  TO  PV-CSSL-PARA                            27063122
270632         PERFORM 9120-INTERNAL-TABLE                              27063222
270633     END-IF.                                                      27063322
270634                                                                  27063422
270635     STRING ' SUKCS583 - '                                        27063522
270636            ' 8450-SELECT-DIST-HEAD'                              27063622
270637         DELIMITED BY SIZE                                        27063722
270638         INTO PV-CICS-MSG-AREA.                                   27063822
270639     PERFORM 9990-WRITE-CICS.                                     27063922
270640     INITIALIZE DCLTDISTHD.                                       27064022
270641                                                                  27064122
270642     EXEC SQL                                                     27064222
270643         SELECT  TOT_CART_CNT                                     27064322
270644              ,  OTPK_UNT_QTY                                     27064422
270645           INTO  :DISTHD-TOT-CART-CNT                             27064522
270650              ,  :DISTHD-OTPK-UNT-QTY                             27065000
270700           FROM  TDISTHD                                          27070000
270800          WHERE  ORD_NBR         = :DK-PO-NBR                     27080000
270900            AND  RCVR_SEQ_NBR    = :DK-RCVR-SEQ-NBR               27090000
271000            AND  ORD_LNE_NBR     = :DK-PO-LINE-NBR                27100000
271010           WITH UR                                                27101005
271100     END-EXEC.                                                    27110000
271200                                                                  27120000
271300     EVALUATE TRUE                                                27130000
271400         WHEN SQLCODE = ZERO                                      27140000
271500             CONTINUE                                             27150000
271600         WHEN SQLWARN0 NOT = SPACES                               27160000
271700         WHEN SQLCODE NOT EQUAL ZERO                              27170000
271710              MOVE '8450'  TO  PV-CSSL-PARA                       27171012
271720              PERFORM 9110-WRITE-SURD021-TO-CSSL                  27172012
271730                                                                  27173012
271740             MOVE '8450-SELECT-DIST-HEAD'                         27174018
271750                             TO DP013-PARAGRAPH                   27175018
271760             MOVE 'SELECT DIST HEADER'                            27176018
271770                             TO DP013-MESSAGE-TEXT(1)             27177018
271780             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            27178018
271781             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      27178122
271783             MOVE DK-PO-LINE-NBR  TO PV-DISPLAY-PO-LINE-NBR       27178322
271790             STRING 'PO:'            PV-DISPLAY-PO-NBR            27179022
271800                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      27180022
271801                    '-'              PV-DISPLAY-PO-LINE-NBR       27180122
271810                                     DELIMITED BY SIZE            27181022
271900                                INTO DP013-MESSAGE-TEXT(2)        27190022
273000             MOVE SQLCA      TO DP013-SQLCA                       27300018
273100             MOVE 'TDISTHD'  TO DP013-DB2-TABLE-NAME(1)           27310018
273200             SET DP013-DB2-ABEND                                  27320018
273300                             TO TRUE                              27330018
273400             SET DP013-NO-ROLLBACK                                27340018
273500                             TO TRUE                              27350018
273600             PERFORM 9999-WRITE-CICS-LOG-MSG                      27360018
273700             SET PS-DUMP-TO-LOG       TO TRUE                     27370018
273800             SET SU021-DB2-ERROR TO TRUE                          27380018
274500     END-EVALUATE.                                                27450000
274600                                                                  27460000
274700******************************************************************27470000
274800 8500-SUM-DISTRO-DETAIL.                                          27480000
274810                                                                  27481007
274820     IF  PS-BLD-INTERNAL-TABLE-YES                                27482007
274830         MOVE '8500'  TO  PV-CSSL-PARA                            27483007
274840         PERFORM 9120-INTERNAL-TABLE                              27484007
274850     END-IF.                                                      27485007
274860                                                                  27486007
274910     STRING ' SUKCS583 - '                                        27491000
275000            ' 8500-SUM-DISTRO-DETAIL'                             27500000
275100         DELIMITED BY SIZE                                        27510000
275200         INTO PV-CICS-MSG-AREA.                                   27520000
275300     PERFORM 9990-WRITE-CICS.                                     27530000
275400     INITIALIZE DCLTDISTDT.                                       27540000
275500                                                                  27550000
275600     EXEC SQL                                                     27560000
275700         SELECT  SUM(EXPTED_ALLOC_QTY)                            27570000
275800           INTO  :PV-SUM-EXPTD-ALLOC :DN-SUM-NULL                 27580000
275900           FROM  TDISTDT                                          27590000
276000          WHERE  ORD_NBR         = :DK-PO-NBR                     27600000
276100            AND  RCVR_SEQ_NBR    = :DK-RCVR-SEQ-NBR               27610000
276200            AND  ORD_LNE_NBR     = :DK-PO-LINE-NBR                27620000
276210           WITH UR                                                27621005
276300     END-EXEC.                                                    27630000
276400                                                                  27640000
276500     EVALUATE TRUE                                                27650000
276600         WHEN SQLCODE = ZERO                                      27660000
276700             IF DN-SUM-NULL = -1                                  27670000
276800                 MOVE 0     TO PV-SUM-EXPTD-ALLOC                 27680000
276900             END-IF                                               27690000
277000         WHEN SQLWARN0 NOT = SPACES                               27700000
277100         WHEN SQLCODE NOT EQUAL ZERO                              27710000
277110              MOVE '8500'  TO  PV-CSSL-PARA                       27711012
277120              PERFORM 9110-WRITE-SURD021-TO-CSSL                  27712012
277130                                                                  27713012
277140             MOVE '8500-SUM-DISTRO-DETAIL'                        27714018
277150                             TO DP013-PARAGRAPH                   27715018
277160             MOVE 'SUM DISTRO DETAIL'                             27716018
277170                             TO DP013-MESSAGE-TEXT(1)             27717018
277180             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            27718018
277181             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      27718122
277183             MOVE DK-PO-LINE-NBR  TO PV-DISPLAY-PO-LINE-NBR       27718322
277190             STRING 'PO:'            PV-DISPLAY-PO-NBR            27719022
277200                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      27720022
277201                    '-'              PV-DISPLAY-PO-LINE-NBR       27720122
277210                                     DELIMITED BY SIZE            27721022
277300                                INTO DP013-MESSAGE-TEXT(2)        27730022
278400             MOVE SQLCA      TO DP013-SQLCA                       27840018
278500             MOVE 'TDISTDT'  TO DP013-DB2-TABLE-NAME(1)           27850018
278600             SET DP013-DB2-ABEND                                  27860018
278700                             TO TRUE                              27870018
278800             SET DP013-NO-ROLLBACK                                27880018
278900                             TO TRUE                              27890018
279000             PERFORM 9999-WRITE-CICS-LOG-MSG                      27900018
279100             SET PS-DUMP-TO-LOG       TO TRUE                     27910018
279200             SET SU021-DB2-ERROR TO TRUE                          27920018
279900     END-EVALUATE.                                                27990000
280000                                                                  28000000
280100****************************************************************  28010000
280200* 8550-VALIDATE-AUDIT-NBR                                      *  28020000
280300*      CHECK THE USER ENTERED AUDIT CONTROL NUMBER - VALIDATE  *  28030000
280400*      EXISTENCE BY GETTING THE AUDIT STATUS                   *  28040000
280500****************************************************************  28050000
280600 8550-VALIDATE-AUDIT-NBR.                                         28060000
280610                                                                  28061007
280620     IF  PS-BLD-INTERNAL-TABLE-YES                                28062007
280630         MOVE '8550'  TO  PV-CSSL-PARA                            28063007
280640         PERFORM 9120-INTERNAL-TABLE                              28064007
280650     END-IF.                                                      28065007
280660                                                                  28066007
280710     STRING ' SUKCS583 - '                                        28071000
280800            ' 8550-VALIDATE-AUDIT-NBR'                            28080000
280900         DELIMITED BY SIZE                                        28090000
281000         INTO PV-CICS-MSG-AREA.                                   28100000
281100     PERFORM 9990-WRITE-CICS.                                     28110000
281200     INITIALIZE DCLTSUNAUD.                                       28120000
281300                                                                  28130000
281400     MOVE PV-AUDIT-CNTL-NBR   TO  DK-AUDIT-CNTL-NBR.              28140000
281500                                                                  28150000
281600     EXEC SQL                                                     28160000
281700         SELECT  AUD_TYP_CDE                                      28170000
281800              ,  AUD_STAT_CDE                                     28180000
281900              ,  PRC_FCLTY_AREA_ID                                28190000
282000           INTO  :SUNAUD-AUD-TYP-CDE                              28200000
282100             ,   :SUNAUD-AUD-STAT-CDE                             28210000
282200             ,   :SUNAUD-PRC-FCLTY-AREA-ID                        28220000
282300           FROM  TSUNAUD                                          28230000
282400          WHERE  AUD_CNTL_NBR      =  :DK-AUDIT-CNTL-NBR          28240000
282500     END-EXEC.                                                    28250000
282600                                                                  28260000
282700     EVALUATE TRUE                                                28270000
282800         WHEN SQLCODE = ZERO                                      28280000
282900             SET PS-AUDIT-NBR-EXISTS  TO TRUE                     28290000
283000             MOVE 'PS-AUDIT-NBR-EXISTS    '   TO PV-CICS-MSG-AREA 28300000
283100             PERFORM 9990-WRITE-CICS                              28310000
283200         WHEN SQLCODE = +100                                      28320000
283300             SET PS-AUDIT-NBR-NOT-EXISTS TO TRUE                  28330000
283400             MOVE 'PS-AUDIT-NBR-NOT-EXISTS'   TO PV-CICS-MSG-AREA 28340000
283500             PERFORM 9990-WRITE-CICS                              28350000
283600         WHEN SQLWARN0 NOT = SPACES                               28360000
283700         WHEN SQLCODE < ZERO                                      28370000
283800         WHEN SQLCODE > ZERO                                      28380000
283810              MOVE '8550'  TO  PV-CSSL-PARA                       28381012
283820              PERFORM 9110-WRITE-SURD021-TO-CSSL                  28382012
283830                                                                  28383012
283840             MOVE '8550-VALIDATE-AUDIT-NBR.'                      28384018
283850                 TO DP013-PARAGRAPH                               28385018
283860             MOVE 'SELECT OF TSUNAUD TABLE'                       28386018
283870                 TO DP013-MESSAGE-TEXT (1)                        28387018
283871             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT           28387122
283880             STRING 'AUDIT:'           PV-DISPLAY-AUDIT           28388022
283881                                       DELIMITED BY SIZE          28388122
283890                                  INTO DP013-MESSAGE-TEXT (2)     28389022
283900             MOVE SQLCA            TO DP013-SQLCA                 28390018
284000             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    28400018
284100             SET DP013-DB2-ABEND                                  28410018
284200                             TO TRUE                              28420018
284300             SET DP013-NO-ROLLBACK                                28430018
284400                             TO TRUE                              28440018
284500             PERFORM 9999-WRITE-CICS-LOG-MSG                      28450018
284600             SET PS-DUMP-TO-LOG       TO TRUE                     28460018
284700             SET SU021-DB2-ERROR TO TRUE                          28470018
285400     END-EVALUATE.                                                28540000
285500                                                                  28550000
285600******************************************************************28560000
285700*  READ THE DISTRIBUTION TRANSACTION HEADER FOR MODULE AND        28570000
285800*  CARTON DATA.                                                   28580000
285900******************************************************************28590000
286000 8600-SELECT-DRIVER-LINE-QTY.                                     28600000
286010                                                                  28601007
286020     IF  PS-BLD-INTERNAL-TABLE-YES                                28602007
286030         MOVE '8600'  TO  PV-CSSL-PARA                            28603007
286040         PERFORM 9120-INTERNAL-TABLE                              28604007
286050     END-IF.                                                      28605007
286060                                                                  28606007
286110     STRING ' SUKCS583 - '                                        28611000
286200            ' 8600-SELECT-DRIVER-LINE-QTY'                        28620000
286300         DELIMITED BY SIZE                                        28630000
286400         INTO PV-CICS-MSG-AREA.                                   28640000
286500     PERFORM 9990-WRITE-CICS.                                     28650000
286600     INITIALIZE DCLTDISTHD.                                       28660000
286700                                                                  28670000
286800     EXEC SQL                                                     28680000
286900         SELECT  TOT_CART_CNT                                     28690000
287000              ,  OTPK_UNT_QTY                                     28700000
287100           INTO  :DISTHD-TOT-CART-CNT                             28710000
287200              ,  :DISTHD-OTPK-UNT-QTY                             28720000
287300           FROM  TDISTHD                                          28730000
287400          WHERE  ORD_NBR           = :DK-PO-NBR                   28740000
287500            AND  RCVR_SEQ_NBR      = :DK-RCVR-SEQ-NBR             28750000
287600            AND  ORD_LNE_NBR       = :DK-PO-DRIVER-LINE           28760000
287700            AND  PREPK_LNE_PRC_CDE = :PC-D                        28770000
287710           WITH UR                                                28771005
287800     END-EXEC.                                                    28780000
287900                                                                  28790000
288000     EVALUATE TRUE                                                28800000
288100         WHEN SQLCODE = ZERO                                      28810000
288200             CONTINUE                                             28820000
288300         WHEN SQLWARN0 NOT = SPACES                               28830000
288400         WHEN SQLCODE NOT EQUAL ZERO                              28840000
288410              MOVE '8600'  TO  PV-CSSL-PARA                       28841012
288420              PERFORM 9110-WRITE-SURD021-TO-CSSL                  28842012
288430                                                                  28843012
288440             MOVE '8600-SELECT-DRIVER-LINE-QTY'                   28844018
288450                             TO DP013-PARAGRAPH                   28845018
288460             MOVE 'SELECT DIST HEADER'                            28846018
288470                             TO DP013-MESSAGE-TEXT(1)             28847018
288480             MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR          28848022
288481             MOVE DK-RCVR-SEQ-NBR   TO PV-DISPLAY-RCVR-SEQ-NBR    28848122
288483             MOVE DK-PO-DRIVER-LINE TO PV-DISPLAY-PO-LINE-NBR     28848322
288490             STRING 'PO:'              PV-DISPLAY-PO-NBR          28849022
288491                    '-'                PV-DISPLAY-RCVR-SEQ-NBR    28849122
288492                    '-'                PV-DISPLAY-PO-LINE-NBR     28849222
288500                                       DELIMITED BY SIZE          28850022
288600                                  INTO DP013-MESSAGE-TEXT(2)      28860022
289700             MOVE SQLCA      TO DP013-SQLCA                       28970018
289800             MOVE 'TDISTHD'  TO DP013-DB2-TABLE-NAME(1)           28980018
289900             SET DP013-DB2-ABEND                                  28990018
290000                             TO TRUE                              29000018
290100             SET DP013-NO-ROLLBACK                                29010018
290200                             TO TRUE                              29020018
290300             PERFORM 9999-WRITE-CICS-LOG-MSG                      29030018
290400             SET PS-DUMP-TO-LOG       TO TRUE                     29040018
290500             SET SU021-DB2-ERROR TO TRUE                          29050018
291200     END-EVALUATE.                                                29120000
291300                                                                  29130000
291400 8650-SUM-PRE-PACK-DETAIL.                                        29140000
291401                                                                  29140107
291402     IF  PS-BLD-INTERNAL-TABLE-YES                                29140207
291403         MOVE '8650'  TO  PV-CSSL-PARA                            29140307
291404         PERFORM 9120-INTERNAL-TABLE                              29140407
291405     END-IF.                                                      29140507
291406                                                                  29140607
291410     STRING ' SUKCS583 - '                                        29141000
291500            ' 8650-SUM-PRE-PACK-DETAIL'                           29150000
291600         DELIMITED BY SIZE                                        29160000
291700         INTO PV-CICS-MSG-AREA.                                   29170000
291800     PERFORM 9990-WRITE-CICS.                                     29180000
291900     EXEC SQL                                                     29190000
292000          SELECT SUM(D.EXPTED_ALLOC_QTY)                          29200000
292100           INTO  :PV-SUM-OF-ALL-LINES  :DN-SUM-NULL               29210000
292200            FROM TRECITM A                                        29220000
292300                ,TPURITM B                                        29230000
292400                ,TDISTHD C                                        29240000
292500                ,TDISTDT D                                        29250000
292600           WHERE A.ORD_NBR           = :DK-PO-NBR                 29260000
292700             AND A.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR           29270000
292800             AND A.PREPK_ID          = :DK-PREPK-ID               29280000
292900             AND A.ORD_NBR           = B.PO_NBR                   29290000
293000             AND A.ORD_LNE_NBR       = B.APP_PO_LNE_NBR           29300000
293100             AND A.VER_STATUS_CDE    = :PC-A                      29310000
293200             AND A.PO_VER_NBR        = B.VER_NBR                  29320000
293300             AND C.ORD_NBR           = A.ORD_NBR                  29330000
293400             AND C.RCVR_SEQ_NBR      = A.REC_SEQ_NBR              29340000
293500             AND C.ORD_LNE_NBR       = A.ORD_LNE_NBR              29350000
293600             AND D.ORD_NBR           = C.ORD_NBR                  29360000
293700             AND D.RCVR_SEQ_NBR      = C.RCVR_SEQ_NBR             29370000
293800             AND D.ORD_LNE_NBR       = C.ORD_LNE_NBR              29380000
293810            WITH UR                                               29381005
293900     END-EXEC.                                                    29390000
294000                                                                  29400000
294100     EVALUATE TRUE                                                29410000
294200         WHEN SQLCODE = ZERO                                      29420000
294300             IF DN-SUM-NULL = -1                                  29430000
294400                 MOVE 0     TO PV-SUM-OF-ALL-LINES                29440000
294500             END-IF                                               29450000
294600         WHEN SQLWARN0 NOT = SPACES                               29460000
294700         WHEN SQLCODE NOT EQUAL ZERO                              29470000
294710              MOVE '8650'  TO  PV-CSSL-PARA                       29471012
294720              PERFORM 9110-WRITE-SURD021-TO-CSSL                  29472012
294730                                                                  29473012
294740             MOVE '8650-SUM-PRE-PACK-DETAIL'                      29474018
294750                             TO DP013-PARAGRAPH                   29475018
294760             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            29476022
294761             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      29476122
294762             MOVE DK-PREPK-ID     TO PV-DISPLAY-PREPK-ID          29476222
294770             STRING 'PO:'            PV-DISPLAY-PO-NBR            29477022
294771                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      29477122
294772                    ' PREPK:'        PV-DISPLAY-PREPK-ID          29477222
294780                                       DELIMITED BY SIZE          29478022
294790                           INTO DP013-MESSAGE-TEXT(1)             29479018
295800             MOVE SQLCA      TO DP013-SQLCA                       29580018
295900             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME(1)           29590018
296000             MOVE 'TPURITM'  TO DP013-DB2-TABLE-NAME(2)           29600018
296100             MOVE 'TDISTHD'  TO DP013-DB2-TABLE-NAME(3)           29610018
296200             MOVE 'TDISTDT'  TO DP013-DB2-TABLE-NAME(4)           29620018
296300             SET DP013-DB2-ABEND                                  29630018
296400                             TO TRUE                              29640018
296500             SET DP013-NO-ROLLBACK                                29650018
296600                             TO TRUE                              29660018
296700             PERFORM 9999-WRITE-CICS-LOG-MSG                      29670018
296800             SET PS-DUMP-TO-LOG       TO TRUE                     29680018
296900             SET SU021-DB2-ERROR TO TRUE                          29690018
297600     END-EVALUATE.                                                29760000
297700                                                                  29770000
297800 8700-UPDATE-SUT-PO-AUD-REQ.                                      29780000
297810                                                                  29781007
297820     IF  PS-BLD-INTERNAL-TABLE-YES                                29782007
297830         MOVE '8700'  TO  PV-CSSL-PARA                            29783007
297840         PERFORM 9120-INTERNAL-TABLE                              29784007
297850     END-IF.                                                      29785007
297860                                                                  29786007
297910     STRING ' SUKCS583 - '                                        29791000
298000            ' 8700-UPDATE-SUT-PO-AUD-REQ'                         29800000
298100         DELIMITED BY SIZE                                        29810000
298200         INTO PV-CICS-MSG-AREA.                                   29820000
298300     PERFORM 9990-WRITE-CICS.                                     29830000
298400     EXEC SQL                                                     29840000
298500          UPDATE SUT_PO_AUD_REQ                                   29850000
298600          SET    CART_PRMPT_CDE = :PC-D                           29860000
298700          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR              29870000
298800            AND  PO_NBR         = :DK-PO-NBR                      29880000
298900            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 29890000
299000            AND  PO_PREPK_ID    = :DK-PREPK-ID                    29900000
299100            AND  RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                29910000
299200            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 29920000
299300     END-EXEC.                                                    29930000
299400                                                                  29940000
299500     EVALUATE TRUE                                                29950000
299600         WHEN SQLCODE = ZERO                                      29960000
299700             CONTINUE                                             29970000
299800         WHEN SQLWARN0 NOT = SPACES                               29980000
299900         WHEN SQLCODE NOT EQUAL ZERO                              29990000
299910              MOVE '8700'  TO  PV-CSSL-PARA                       29991012
299920              PERFORM 9110-WRITE-SURD021-TO-CSSL                  29992012
299930                                                                  29993012
299940             MOVE '8700-UPDATE-SUT-PO-AUD-REQ'                    29994018
299950                             TO DP013-PARAGRAPH                   29995018
299951             MOVE DK-OPER-UNT-ID    TO PV-DISPLAY-OPER-UNT-ID     29995122
299960             MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR          29996022
299961             MOVE DK-RCVR-SEQ-NBR   TO PV-DISPLAY-RCVR-SEQ-NBR    29996122
299970             MOVE DK-PO-LINE-NBR    TO PV-DISPLAY-PO-LINE-NBR     29997022
299971             MOVE DK-PREPK-ID       TO PV-DISPLAY-PREPK-ID        29997122
299972             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT           29997222
299980             STRING 'PO:'              PV-DISPLAY-OPER-UNT-ID     29998022
299990                    '-'                PV-DISPLAY-PO-NBR          29999022
300000                    '-'                PV-DISPLAY-RCVR-SEQ-NBR    30000022
300010                    '-'                PV-DISPLAY-PO-LINE-NBR     30001022
300100                                       DELIMITED BY SIZE          30010022
300200                           INTO DP013-MESSAGE-TEXT(1)             30020018
300500             STRING 'PREPK:'           PV-DISPLAY-PREPK-ID        30050022
300510                    ' AUDIT:'          PV-DISPLAY-AUDIT           30051022
300700                                       DELIMITED BY SIZE          30070018
300800                           INTO DP013-MESSAGE-TEXT(2)             30080018
301900             MOVE SQLCA      TO DP013-SQLCA                       30190018
302000             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(1)           30200018
302100             SET DP013-DB2-ABEND                                  30210018
302200                             TO TRUE                              30220018
302300             SET DP013-NO-ROLLBACK                                30230018
302400                             TO TRUE                              30240018
302500             PERFORM 9999-WRITE-CICS-LOG-MSG                      30250018
302600             SET PS-DUMP-TO-LOG       TO TRUE                     30260018
302700             SET SU021-DB2-ERROR TO TRUE                          30270018
303400     END-EVALUATE.                                                30340000
303500                                                                  30350000
303600 8800-COUNT-CHECKED-IN-CRTNS.                                     30360000
303610                                                                  30361007
303620     IF  PS-BLD-INTERNAL-TABLE-YES                                30362007
303630         MOVE '8800'  TO  PV-CSSL-PARA                            30363007
303640         PERFORM 9120-INTERNAL-TABLE                              30364007
303650     END-IF.                                                      30365007
303660                                                                  30366007
303710     STRING ' SUKCS583 - '                                        30371000
303800            ' 8800-COUNT-CHECKED-IN-CRTNS'                        30380000
303900         DELIMITED BY SIZE                                        30390000
304000         INTO PV-CICS-MSG-AREA.                                   30400000
304100     PERFORM 9990-WRITE-CICS.                                     30410000
304200                                                                  30420000
304300     EXEC SQL                                                     30430000
304400          SELECT   COUNT (DISTINCT C.SHIPT_UNT_ID)                30440000
304500            INTO  :PV-CHECK-IN-COUNT                              30450000
304600            FROM  TPKSLIP A                                       30460000
304700               ,  TINPKSU B                                       30470000
304800               ,  TSHUUPC C                                       30480000
304900               ,  TSHUNLO D                                       30490000
305000           WHERE  A.PO_NBR         = :DK-PO-NBR                   30500000
305100             AND  A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR             30510000
305200             AND  A.VER_STAT_CDE   = 'A'                          30520000
305300             AND  A.PKSL_STAT_CDE  = 'AC'                         30530000
305400             AND  B.PO_NBR         = A.PO_NBR                     30540000
305500             AND  B.SEQ_NBR        = A.SEQ_NBR                    30550000
305600             AND  C.SHIPT_UNT_ID   = B.SHIPT_UNT_ID               30560000
305700             AND  C.TRN_NBR        = B.PO_NBR                     30570000
305800             AND  C.TRN_LNE_NBR    = :DK-SHUUPC-LNE-NBR           30580000
305900             AND  C.SHIPT_UNT_ID   = D.SHIPT_UNT_ID               30590000
306000             AND  D.ACTV_CDE       = 'A'                          30600000
306100             AND  D.SCN_LOC_ID     = 'RECV'                       30610000
306200     END-EXEC.                                                    30620000
306300                                                                  30630000
306400     EVALUATE TRUE                                                30640000
306500         WHEN SQLCODE = ZERO                                      30650000
306600             CONTINUE                                             30660000
306700         WHEN SQLWARN0 NOT = SPACES                               30670000
306800         WHEN SQLCODE NOT EQUAL ZERO                              30680000
306810              MOVE '8800'  TO  PV-CSSL-PARA                       30681012
306820              PERFORM 9110-WRITE-SURD021-TO-CSSL                  30682012
306830                                                                  30683012
306840             MOVE '8800-COUNT-CHECKED-IN-CRTNS'                   30684020
306850                             TO DP013-PARAGRAPH                   30685020
306860             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR            30686022
306870             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      30687022
306890             STRING 'PO:'            PV-DISPLAY-PO-NBR            30689022
306900                    '-'              PV-DISPLAY-RCVR-SEQ-NBR      30690022
307200                                     DELIMITED BY SIZE            30720022
307300                                INTO DP013-MESSAGE-TEXT(1)        30730022
307400             MOVE SQLCA      TO DP013-SQLCA                       30740020
307500             MOVE 'TPKSLIP ' TO DP013-DB2-TABLE-NAME(1)           30750020
307600             MOVE 'TINPKSU ' TO DP013-DB2-TABLE-NAME(1)           30760020
307700             MOVE 'TSHUUPC ' TO DP013-DB2-TABLE-NAME(1)           30770020
307800             MOVE 'TSHUNLO ' TO DP013-DB2-TABLE-NAME(1)           30780020
307900             SET DP013-DB2-ABEND                                  30790020
308000                             TO TRUE                              30800020
308100             SET DP013-NO-ROLLBACK                                30810020
308200                             TO TRUE                              30820020
308300             PERFORM 9999-WRITE-CICS-LOG-MSG                      30830020
308400             SET PS-DUMP-TO-LOG       TO TRUE                     30840020
308500             SET SU021-DB2-ERROR TO TRUE                          30850020
309200     END-EVALUATE.                                                30920000
309400                                                                  30940000
309500                                                                  30950000
309600 8850-SELECT-TKRPRPM.                                             30960000
309610                                                                  30961007
309620     IF  PS-BLD-INTERNAL-TABLE-YES                                30962007
309630         MOVE '8850'  TO  PV-CSSL-PARA                            30963007
309640         PERFORM 9120-INTERNAL-TABLE                              30964007
309650     END-IF.                                                      30965007
309660                                                                  30966007
309710     STRING ' SUKCS583 - '                                        30971000
309800            ' 8850-SELECT-TKRPRPM'                                30980000
309900         DELIMITED BY SIZE                                        30990000
310000         INTO PV-CICS-MSG-AREA.                                   31000000
310100     PERFORM 9990-WRITE-CICS.                                     31010000
310200                                                                  31020000
310300     EXEC SQL                                                     31030000
310400          SELECT FUNC_TXT                                         31040000
310500            INTO :KRPRPM-FUNC-TXT                                 31050000
310600            FROM TKRPRPM                                          31060000
310700           WHERE LOC_ID            = :DK-OPER-UNT-ID              31070000
310800             AND INTFC_SYS_CDE    = 'AUD'                         31080000
310900             AND SYS_PRC_FUNC_CDE = 'DMPAUD'                      31090000
311000             AND FUNC_PRC_STAT_CDE = 'AC'                         31100000
311010            WITH UR                                               31101005
311100     END-EXEC.                                                    31110000
311200                                                                  31120000
311300     EVALUATE TRUE                                                31130000
311400         WHEN SQLCODE = ZERO                                      31140000
311500             IF KRPRPM-FUNC-TXT = 'Y'                             31150000
311600                 SET PS-SHOW-DEBUG-INFO                           31160000
311700                                      TO TRUE                     31170000
311800             ELSE                                                 31180000
311900                 SET PS-DONT-SHOW-DEBUG-INFO                      31190000
312000                                      TO TRUE                     31200000
312100             END-IF                                               31210000
312200         WHEN SQLWARN0 NOT = SPACES                               31220000
312300         WHEN SQLCODE NOT EQUAL ZERO                              31230000
312310              MOVE '8850'  TO  PV-CSSL-PARA                       31231012
312320              PERFORM 9110-WRITE-SURD021-TO-CSSL                  31232012
312330                                                                  31233012
312340             MOVE '8850-SELECT-TKRPRPM'                           31234018
312350                             TO DP013-PARAGRAPH                   31235018
312360             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        31236018
312370             STRING 'OPER:'         PV-DISPLAY-OPER-UNT-ID        31237022
312380                                    DELIMITED BY SIZE             31238022
312390                               INTO DP013-MESSAGE-TEXT(1)         31239022
312400             MOVE SQLCA      TO DP013-SQLCA                       31240018
312500             MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME(1)           31250018
312600             SET DP013-DB2-ABEND                                  31260018
312700                             TO TRUE                              31270018
312800             SET DP013-NO-ROLLBACK                                31280018
312900                             TO TRUE                              31290018
313000             PERFORM 9999-WRITE-CICS-LOG-MSG                      31300018
313100             SET PS-DUMP-TO-LOG       TO TRUE                     31310018
313200             SET SU021-DB2-ERROR TO TRUE                          31320018
313900     END-EVALUATE.                                                31390000
314000                                                                  31400000
314100 8900-SUM-PP-PROMPTED-UNITS.                                      31410000
314110                                                                  31411007
314120     IF  PS-BLD-INTERNAL-TABLE-YES                                31412007
314130         MOVE '8900'  TO  PV-CSSL-PARA                            31413007
314140         PERFORM 9120-INTERNAL-TABLE                              31414007
314150     END-IF.                                                      31415007
314160                                                                  31416007
314210     STRING ' SUKCS583 - '                                        31421000
314300            ' 8900-SUM-PP-PROMPTED-UNITS'                         31430000
314400         DELIMITED BY SIZE                                        31440000
314500         INTO PV-CICS-MSG-AREA.                                   31450000
314600     PERFORM 9990-WRITE-CICS.                                     31460000
314700     EXEC SQL                                                     31470000
314800         SELECT SUM(B.SHPD_QTY)                                   31480000
314900           INTO :PV-SHPD-QTY-SUM :DN-SUM-NULL                     31490000
315000           FROM TSUATRN A                                         31500000
315100             ,  TSHUUPC B                                         31510000
315200         WHERE A.AUD_CNTL_NBR    = :DK-AUDIT-CNTL-NBR             31520000
315300           AND A.SHIPT_UNT_ID    = B.SHIPT_UNT_ID                 31530000
315400           AND B.TRN_NBR         = :DK-PO-NBR                     31540000
315500           AND B.TRN_LNE_NBR     = :DK-PO-DRIVER-LINE             31550000
315600     END-EXEC.                                                    31560000
315700                                                                  31570000
315800     EVALUATE TRUE                                                31580000
315900         WHEN SQLCODE = ZERO                                      31590000
316000             IF DN-SUM-NULL = -1                                  31600000
316100                 MOVE 0     TO PV-SHPD-QTY-SUM                    31610000
316200             END-IF                                               31620000
316300         WHEN SQLWARN0 NOT = SPACES                               31630000
316400         WHEN SQLCODE NOT EQUAL ZERO                              31640000
316410              MOVE '8900'  TO  PV-CSSL-PARA                       31641012
316420              PERFORM 9110-WRITE-SURD021-TO-CSSL                  31642012
316430                                                                  31643012
316440             MOVE '8900-SUM-PP-PROMPTED-UNITS'                    31644018
316450                             TO DP013-PARAGRAPH                   31645018
316460             MOVE 'SUM THE PROMPTED CARTONS'                      31646018
316470                             TO DP013-MESSAGE-TEXT(1)             31647018
316471             MOVE DK-AUDIT-CNTL-NBR TO PV-DISPLAY-AUDIT           31647122
316472             MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR          31647222
316474             MOVE DK-PO-DRIVER-LINE TO PV-DISPLAY-PO-LINE-NBR     31647422
316480             STRING 'AUDIT:'           PV-DISPLAY-AUDIT           31648022
316490                    ' PO:'             PV-DISPLAY-PO-NBR          31649022
316491                    ' LNE:'            PV-DISPLAY-PO-LINE-NBR     31649122
316492                                       DELIMITED BY SIZE          31649222
316500                                  INTO DP013-MESSAGE-TEXT (2)     31650022
317000             MOVE SQLCA      TO DP013-SQLCA                       31700018
317100             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           31710018
317200             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           31720018
317300             SET DP013-DB2-ABEND                                  31730018
317400                             TO TRUE                              31740018
317500             SET DP013-NO-ROLLBACK                                31750018
317600                             TO TRUE                              31760018
317700             PERFORM 9999-WRITE-CICS-LOG-MSG                      31770018
317800             SET PS-DUMP-TO-LOG       TO TRUE                     31780018
317900             SET SU021-DB2-ERROR TO TRUE                          31790018
318600     END-EVALUATE.                                                31860000
318700                                                                  31870000
318800 8950-SELECT-CURRENT-PP-CARTON.                                   31880000
318810                                                                  31881007
318820     IF  PS-BLD-INTERNAL-TABLE-YES                                31882007
318830         MOVE '8950'  TO  PV-CSSL-PARA                            31883007
318840         PERFORM 9120-INTERNAL-TABLE                              31884007
318850     END-IF.                                                      31885007
318860                                                                  31886007
318910     STRING ' SUKCS583 - '                                        31891000
319000            ' 8950-SELECT-CURRENT-PP-CARTON'                      31900000
319100         DELIMITED BY SIZE                                        31910000
319200         INTO PV-CICS-MSG-AREA.                                   31920000
319300     PERFORM 9990-WRITE-CICS.                                     31930000
319400     EXEC SQL                                                     31940000
319500         SELECT SUM(SHPD_QTY)                                     31950000
319600           INTO :SHUUPC-SHPD-QTY :DN-SUM-NULL-UPC                 31960000
319700           FROM TSHUUPC                                           31970000
319800         WHERE SHIPT_UNT_ID      = :DK-SHIPT-UNT-ID               31980000
319900           AND TRN_NBR           = :DK-PO-NBR                     31990000
320000           AND TRN_LNE_NBR       = :DK-PO-DRIVER-LINE             32000000
320010          WITH UR                                                 32001005
320100     END-EXEC.                                                    32010000
320200                                                                  32020000
320300     EVALUATE TRUE                                                32030000
320400         WHEN SQLCODE = ZERO                                      32040000
320500             IF DN-SUM-NULL-UPC = -1                              32050000
320600                 MOVE 0     TO SHUUPC-SHPD-QTY                    32060000
320700             END-IF                                               32070000
320800         WHEN SQLWARN0 NOT = SPACES                               32080000
320900         WHEN SQLCODE NOT EQUAL ZERO                              32090000
320910              MOVE '8950'  TO  PV-CSSL-PARA                       32091012
320920              PERFORM 9110-WRITE-SURD021-TO-CSSL                  32092012
320930                                                                  32093012
320940             MOVE '8950-SELECT-CURRENT-PP-CARTON'                 32094018
320950                             TO DP013-PARAGRAPH                   32095018
320960             MOVE 'SELECT THE UNIT QTY - THIS CARTON'             32096018
320970                             TO DP013-MESSAGE-TEXT(1)             32097018
320980             MOVE DK-SHIPT-UNT-ID   TO PV-DISPLAY-SHIPT-UNT-ID    32098022
320982             MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR          32098222
320983             MOVE DK-PO-DRIVER-LINE TO PV-DISPLAY-PO-LINE-NBR     32098322
320990             STRING 'SSCC:'            PV-DISPLAY-SHIPT-UNT-ID    32099022
321000                    ' PO:'             PV-DISPLAY-PO-NBR          32100022
321010                    ' LNE:'            PV-DISPLAY-PO-LINE-NBR     32101022
321020                                       DELIMITED BY SIZE          32102022
321100                                  INTO DP013-MESSAGE-TEXT(2)      32110022
321200             MOVE SQLCA      TO DP013-SQLCA                       32120018
321300             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           32130018
321400             SET DP013-DB2-ABEND                                  32140018
321500                             TO TRUE                              32150018
321600             SET DP013-NO-ROLLBACK                                32160018
321700                             TO TRUE                              32170018
321800             PERFORM 9999-WRITE-CICS-LOG-MSG                      32180018
321900             SET PS-DUMP-TO-LOG       TO TRUE                     32190018
322000             SET SU021-DB2-ERROR TO TRUE                          32200018
322700     END-EVALUATE.                                                32270000
322800                                                                  32280000
322900                                                                  32290000
323000 9000-SELECT-CARTON.                                              32300000
323010                                                                  32301007
323020     IF  PS-BLD-INTERNAL-TABLE-YES                                32302007
323030         MOVE '9000'  TO  PV-CSSL-PARA                            32303007
323040         PERFORM 9120-INTERNAL-TABLE                              32304007
323050     END-IF.                                                      32305007
323060                                                                  32306007
323110     STRING ' SUKCS583 - '                                        32311000
323200            ' 9000-SELECT-CARTON'                                 32320000
323300         DELIMITED BY SIZE                                        32330000
323400         INTO PV-CICS-MSG-AREA.                                   32340000
323500     PERFORM 9990-WRITE-CICS.                                     32350000
323600                                                                  32360000
323700     EXEC SQL                                                     32370000
323800         SELECT A.AUD_CNTL_NBR                                    32380000
323900           INTO :SUATRN-AUD-CNTL-NBR                              32390000
324000           FROM TSUATRN A                                         32400000
324100             ,  SUT_PO_AUD_REQ B                                  32410000
324200         WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                32420000
324300           AND  A.AUD_CNTL_NBR  = B.AUD_CNTL_NBR                  32430000
324400*CLP 11/05/13 START                                               32440000
324500           AND  B.PKGNG_TYP_CDE <> 'RF'                           32450000
324600*CLP 11/05/13 END                                                 32460000
324700           WITH UR                                                32470000
324800     END-EXEC.                                                    32480000
324900                                                                  32490000
325000     EVALUATE TRUE                                                32500000
325100         WHEN SQLCODE = ZERO                                      32510000
325200             SET PS-CARTON-ALREADY-EXISTS TO TRUE                 32520000
325300         WHEN SQLCODE = -811                                      32530000
325400             PERFORM 9010-SELECT-CARTON-2                         32540000
325500         WHEN SQLCODE = +100                                      32550000
325600             SET PS-CARTON-DOESNT-EXIST   TO TRUE                 32560000
325700         WHEN SQLWARN0 NOT = SPACES                               32570000
325800         WHEN SQLCODE NOT EQUAL ZERO                              32580000
325810              MOVE '9000'  TO  PV-CSSL-PARA                       32581012
325820              PERFORM 9110-WRITE-SURD021-TO-CSSL                  32582012
325830                                                                  32583012
325840             MOVE '9000-SELECT-CARTON'                            32584018
325850                             TO DP013-PARAGRAPH                   32585018
325860             MOVE 'SELECT THE CARTON'                             32586018
325870                             TO DP013-MESSAGE-TEXT(1)             32587018
325880             MOVE DK-SHIPT-UNT-ID TO PV-DISPLAY-SHIPT-UNT-ID      32588018
325890             STRING 'SSCC:'          PV-DISPLAY-SHIPT-UNT-ID      32589022
325900                                     DELIMITED BY SIZE            32590022
326000                                INTO DP013-MESSAGE-TEXT(2)        32600022
326100             MOVE SQLCA      TO DP013-SQLCA                       32610018
326200             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           32620018
326300             SET DP013-DB2-ABEND                                  32630018
326400                             TO TRUE                              32640018
326500             SET DP013-NO-ROLLBACK                                32650018
326600                             TO TRUE                              32660018
326700             PERFORM 9999-WRITE-CICS-LOG-MSG                      32670018
326800             SET PS-DUMP-TO-LOG       TO TRUE                     32680018
326900             SET SU021-DB2-ERROR TO TRUE                          32690018
327600     END-EVALUATE.                                                32760000
327700                                                                  32770000
327710                                                                  32771006
327945 9010-SELECT-CARTON-2.                                            32794500
327946                                                                  32794607
327947     IF  PS-BLD-INTERNAL-TABLE-YES                                32794707
327948         MOVE '9010'  TO  PV-CSSL-PARA                            32794807
327949         PERFORM 9120-INTERNAL-TABLE                              32794907
327950     END-IF.                                                      32795007
327951                                                                  32795107
327952                                                                  32795200
327960     STRING ' SUKCS583 - '                                        32796000
328000            ' 9010-SELECT-CARTON-2'                               32800000
328100         DELIMITED BY SIZE                                        32810000
328200         INTO PV-CICS-MSG-AREA.                                   32820000
328300     PERFORM 9990-WRITE-CICS.                                     32830000
328400                                                                  32840000
328500     EXEC SQL                                                     32850000
328600         SELECT A.AUD_CNTL_NBR                                    32860000
328700           INTO :SUATRN-AUD-CNTL-NBR                              32870000
328800           FROM TSUATRN A                                         32880000
328900             ,  SUT_PO_AUD_REQ B                                  32890000
329000         WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                32900000
329100           AND  A.AUD_CNTL_NBR  = B.AUD_CNTL_NBR                  32910000
329200           AND  A.REC_SEQ_NBR   = :DK-RCVR-SEQ-NBR                32920000
329300           AND  B.OPER_UNT_ID   = :DK-OPER-UNT-ID                 32930000
329400*CLP 11/05/13 START                                               32940000
329500           AND  B.PKGNG_TYP_CDE <> 'RF'                           32950000
329600*CLP 11/05/13 END                                                 32960000
329700           WITH UR                                                32970000
329800     END-EXEC.                                                    32980000
329900                                                                  32990000
330000     EVALUATE TRUE                                                33000000
330100         WHEN SQLCODE = ZERO                                      33010000
330200         WHEN SQLCODE = -811                                      33020000
330300             SET PS-CARTON-ALREADY-EXISTS TO TRUE                 33030000
330400         WHEN SQLCODE = +100                                      33040000
330500             SET PS-CARTON-DOESNT-EXIST   TO TRUE                 33050000
330600         WHEN SQLWARN0 NOT = SPACES                               33060000
330700         WHEN SQLCODE NOT EQUAL ZERO                              33070000
330710              MOVE '9010'  TO  PV-CSSL-PARA                       33071012
330720              PERFORM 9110-WRITE-SURD021-TO-CSSL                  33072012
330730                                                                  33073012
330740             MOVE '9010-SELECT-CARTON-2'                          33074018
330750                             TO DP013-PARAGRAPH                   33075018
330760             MOVE 'SELECT THE CARTON'                             33076018
330770                             TO DP013-MESSAGE-TEXT(1)             33077018
330780             MOVE DK-SHIPT-UNT-ID TO PV-DISPLAY-SHIPT-UNT-ID      33078018
330781             MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR      33078122
330782             MOVE DK-OPER-UNT-ID  TO PV-DISPLAY-OPER-UNT-ID       33078222
330790             STRING 'SSCC:'          PV-DISPLAY-SHIPT-UNT-ID      33079022
330800                    ' RCVR:'         PV-DISPLAY-RCVR-SEQ-NBR      33080022
330810                    ' OPER:'         PV-DISPLAY-OPER-UNT-ID       33081022
330820                                     DELIMITED BY SIZE            33082022
330900                                INTO DP013-MESSAGE-TEXT(2)        33090022
331000             MOVE SQLCA      TO DP013-SQLCA                       33100018
331100             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           33110018
331110             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME(2)           33111022
331200             SET DP013-DB2-ABEND                                  33120018
331300                             TO TRUE                              33130018
331400             SET DP013-NO-ROLLBACK                                33140018
331500                             TO TRUE                              33150018
331600             PERFORM 9999-WRITE-CICS-LOG-MSG                      33160018
331700             SET PS-DUMP-TO-LOG       TO TRUE                     33170018
331800             SET SU021-DB2-ERROR TO TRUE                          33180018
332500     END-EVALUATE.                                                33250000
332600                                                                  33260000
332601                                                                  33260106
332610*---------------------------------------------------------------* 33261006
332620* check parm table (TKRPRPM) to check for logging to CSSL       * 33262006
332630* IF PROGRAM IS TAKING TOO LONG TO RESPOND.  THE VALUE WILL     * 33263006
332640* BE seconds AND WILL BE USED TO DETERMINE IF WE SHOULD WRITE   * 33264006
332650* pt-pARA-tRACKING TABLE TO CSSL                                * 33265006
332660* check parm table (TKRPRPM) to check if will be building the   * 33266006
332670* internal table during processing.  this will be used when     * 33267006
332680* dc's report long resonse times                                * 33268006
332690*  2015-01-29 - DMH                                             * 33269006
332691*---------------------------------------------------------------* 33269106
332692 9100-CHECK-PARA-TRACK-SEC.                                       33269206
332693                                                                  33269306
332694     IF  PS-BLD-INTERNAL-TABLE-YES                                33269406
332695         MOVE  '9100'  TO  PV-CSSL-PARA                           33269542
332696         PERFORM 9120-INTERNAL-TABLE                              33269606
332697     END-IF.                                                      33269706
332698                                                                  33269806
332699     STRING ' SUKCS583 - '                                        33269938
332700            ' 9100-CHECK-PARA-TRACK-SEC '                         33270038
332701         DELIMITED BY SIZE                                        33270138
332702         INTO PV-CICS-MSG-AREA.                                   33270238
332703                                                                  33270338
332704     EXEC SQL                                                     33270406
332705          SELECT  FUNC_QTY                                        33270506
332706               ,  FUNC_txt                                        33270606
332707            INTO :PV-PARM-seconds                                 33270706
332708               , :PS-BLD-INTERNAL-TABLE-SW                        33270806
332709            FROM  TKRPRPM                                         33270906
332710           WHERE  LOC_ID            = :DK-OPER-UNT-ID             33271006
332711             AND  INTFC_SYS_CDE     = 'KHL'                       33271119
332712             AND  SYS_PRC_FUNC_CDE  = 'PATIM5'                    33271206
332713             AND  FUNC_PRC_STAT_CDE = 'AC'                        33271306
332714             AND  fUNC_BEG_TMST    <=  current timestamp          33271406
332715             AND  fUNC_END_TMST    >=  current timestamp          33271506
332716            WITH UR                                               33271606
332717     END-EXEC.                                                    33271706
332718                                                                  33271806
332719     EVALUATE TRUE                                                33271906
332720         WHEN SQLCODE = ZERO                                      33272006
332721              CONTINUE                                            33272148
332722                                                                  33272206
332723         WHEN SQLCODE = +100                                      33272306
332724              MOVE 999999999  TO  PV-PARM-SECONDS                 33272406
332725              SET  PS-BLD-INTERNAL-TABLE-NO   TO TRUE             33272506
332726                                                                  33272606
332727         WHEN SQLWARN0 NOT = SPACES                               33272706
332728         WHEN SQLCODE NOT EQUAL ZERO                              33272806
332729              MOVE '9100'  TO  PV-CSSL-PARA                       33272906
332730              PERFORM 9110-WRITE-SURD021-TO-CSSL                  33273006
332731                                                                  33273106
332732              SET PS-BLD-INTERNAL-TABLE-NO   TO  TRUE             33273206
332733              MOVE  SQLCODE           TO pv-disp-sqlcode          33273313
332734                                                                  33273414
332735             MOVE '9100-CHECK-PARA-TRACK-SEC'                     33273514
332736                             TO DP013-PARAGRAPH                   33273614
332737             MOVE DK-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT-ID        33273714
332738             STRING ' SUKCS583 9100'                              33273814
332739                    ' OPER:'         PV-DISPLAY-OPER-UNT-ID       33273914
332740                    ' sql:'          PV-DISP-sqlcode              33274018
332741                                     DELIMITED BY SIZE            33274118
332742                                INTO DP013-MESSAGE-TEXT(1)        33274218
332743             MOVE SQLCA      TO DP013-SQLCA                       33274318
332744             MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME(1)           33274418
332750                                                                  33275018
332770                                                                  33277014
332771             SET DP013-DB2-ABEND                                  33277114
332772                             TO TRUE                              33277214
332773             SET DP013-NO-ROLLBACK                                33277314
332774                             TO TRUE                              33277414
332775             PERFORM 9999-WRITE-CICS-LOG-MSG                      33277514
332776             SET PS-DUMP-TO-LOG       TO TRUE                     33277614
332777             SET SU021-DB2-ERROR TO TRUE                          33277714
332778     END-EVALUATE.                                                33277814
332792                                                                  33279206
332795                                                                  33279506
332796*---------------------------------------------------------------* 33279606
332797* WRITE COMMAREA TO CSSL                                        * 33279706
332798* DMH - 01/29/15                                                * 33279806
332799*---------------------------------------------------------------* 33279906
332800 9110-WRITE-SURD021-TO-CSSL.                                      33280006
332801                                                                  33280147
332802     IF  PS-BLD-INTERNAL-TABLE-YES                                33280247
332803         MOVE  '9110'  TO  PV-CSSL-PARA                           33280347
332804         PERFORM 9120-INTERNAL-TABLE                              33280447
332805     END-IF.                                                      33280547
332806                                                                  33280606
332807     INITIALIZE PV-CICS-MSG-AREA-3                                33280706
332808     MOVE SU021-PO-NUMBER          TO PV-DISP-PO                  33280811
332809     MOVE SU021-LINE-NBR           TO PV-DISP-LINE                33280911
332810     MOVE SU021-DRIVER-LINE-NBR    TO PV-DISP-DRVR-LINE           33281011
332811     MOVE SU021-PRE-PACK-ID        TO PV-DISP-PREPK               33281111
332812     MOVE SU021-OPER-UNT-ID        TO PV-DISP-OPER                33281211
332813     MOVE SU021-REC-SEQ-NBR        TO PV-DISP-RCVR                33281311
332814     MOVE SU021-INBOUND-TRIP-ID    TO PV-DISP-TRIP                33281411
332815     MOVE SU021-SHIPT-UNT-ID       TO PV-DISP-SSCC                33281511
332816     MOVE SU021-AUDIT-NUMBER       TO PV-DISP-AUDIT               33281611
332817     MOVE SU021-RFID-AUDIT-NUMBER  TO PV-DISP-RFID-AUDIT          33281711
332818     MOVE SQLCODE                  TO PV-DISP-SQLCODE             33281806
332819                                                                  33281906
332820     STRING  ' SUKCS583 '   PV-CSSL-PARA                          33282011
332821             ' TYPE:'       SU021-AUDIT-REQUEST-TYPE              33282111
332822             ' PO:'         PV-DISP-PO                            33282211
332823             ' LINE:'       PV-DISP-LINE                          33282311
332824             ' DR LINE:'    PV-DISP-DRVR-LINE                     33282411
332825             ' PREPK:'      PV-DISP-PREPK                         33282511
332826             ' OPER:'       PV-DISP-OPER                          33282611
332827             ' RCVR:'       PV-DISP-RCVR                          33282711
332828             ' SQL:'        pv-disp-sqlcode                       33282812
332829                            DELIMITED BY SIZE                     33282912
332830                       INTO PV-CICS-MSG-AREA                      33283029
332831                                                                  33283112
332832     PERFORM 9997-WRITE-TO-CSSL                                   33283212
332833                                                                  33283312
332834     INITIALIZE PV-CICS-MSG-AREA                                  33283429
332835     STRING  ' SUKCS583 '                                         33283512
332836             ' TRIP:'      PV-DISP-TRIP                           33283612
332837             ' SSCC:'      PV-DISP-SSCC                           33283712
332838             ' USR:'       SU021-USER-ID                          33283812
332839             ' DEF AUD:'   SU021-DEFERRED-AUDIT-IND               33283912
332840             ' AUD REQ:'   SU021-AUDIT-REQUIRED-SW                33284012
332841             ' AUDIT:'     PV-DISP-AUDIT                          33284112
332842                           DELIMITED BY SIZE                      33284212
332843                      INTO PV-CICS-MSG-AREA                       33284329
332844                                                                  33284412
332845     PERFORM 9997-WRITE-TO-CSSL                                   33284512
332846                                                                  33284612
332847     INITIALIZE PV-CICS-MSG-AREA                                  33284729
332848     STRING  ' SUKCS583 '                                         33284812
332849             ' VALID:'      SU021-AUDIT-VALIDATION-SW             33284912
332850             ' PNA:'        SU021-PRINT-APPLY-SW                  33285012
332851             ' RFID:'       SU021-RFID-AUDIT-REQUIRED-SW          33285112
332852             ' RFID AUD:'   PV-DISP-RFID-AUDIT                    33285212
332853             ' RFID VALID:' SU021-RFID-AUDIT-VALIDATION-SW        33285312
332854                           DELIMITED BY SIZE                      33285406
332855                      INTO PV-CICS-MSG-AREA                       33285529
332856                                                                  33285606
332857     PERFORM 9997-WRITE-TO-CSSL.                                  33285706
332858                                                                  33285806
332859                                                                  33285906
332860*---------------------------------------------------------------* 33286006
332861* BUILD INTERNAL TABLE WITN PARAGRAPH TRACKING                  * 33286106
332862* DMH - 01/29/15                                                * 33286206
332863*---------------------------------------------------------------* 33286306
332864 9120-INTERNAL-TABLE.                                             33286406
332865                                                                  33286506
332866     PERFORM 9130-GET-CURRENT-TMST.                               33286606
332867     ADD  +1  TO  PT-CURR-ENTRIES.                                33286706
332868     SET  PT-TRACK-IDX to PT-CURR-ENTRIES                         33286806
332869                                                                  33286906
332870     MOVE 'SUKCS583'           TO PT-PROGRAM(PT-TRACK-IDX).       33287006
332871     MOVE PT-CURR-ENTRIES      TO PT-INDEX-NBR(PT-TRACK-IDX).     33287106
332872     MOVE PV-CSSL-PARA         TO PT-PARAGRAPH(PT-TRACK-IDX).     33287242
332873     MOVE PV-CURRENT-PARA-TMST TO PT-TIMESTAMP(PT-TRACK-IDX).     33287306
332874     MOVE PV-DURATION-SEC      TO PT-DURATION(PT-TRACK-IDX).      33287406
332875                                                                  33287506
332876     MOVE PV-DURATION-NANO-SEC    TO PV-WORK-NANO-SEC.            33287606
332877     MOVE PV-WORK-NANO-MIN-1-2    TO PV-DISP-NANO-MIN-1-2.        33287706
332878     MOVE '-'                     TO PV-DISP-NANO-DASH-1.         33287806
332879     MOVE PV-WORK-NANO-SEC-3-4    TO PV-DISP-NANO-SEC-3-4.        33287906
332880     MOVE '-'                     TO PV-DISP-NANO-DASH-2.         33288006
332881     MOVE PV-WORK-NANO-MICRO-5-10 TO PV-DISP-NANO-MICRO-5-10.     33288106
332882     MOVE PV-DISP-NANO-SEC     TO PT-NANO-SEC(PT-TRACK-IDX).      33288206
332883                                                                  33288306
332884     MOVE SU021-OPER-UNT-ID     tO PT-DC(PT-TRACK-IDX).           33288415
332885     MOVE SU021-SHIPT-UNT-ID    tO PT-sscc(PT-TRACK-IDX).         33288515
332886     MOVE PV-INIT-TIME-KEY      TO PT-START-HHMMSS(PT-TRACK-IDX). 33288606
332887                                                                  33288706
332914                                                                  33291437
332915                                                                  33291506
332916*---------------------------------------------------------------* 33291606
332917*                                                               * 33291706
332918* DMH - 01/29/15                                                * 33291806
332919*---------------------------------------------------------------* 33291906
332920 9125-GET-START-TMST.                                             33292029
332921                                                                  33292129
332922         EXEC SQL                                                 33292229
332923             SET :PV-INIT-TIMESTAMP  =  CURRENT TIMESTAMP         33292329
332924         END-EXEC.                                                33292429
332925                                                                  33292529
332926     MOVE  PV-INIT-HH    TO  PV-INIT-KEY-HH.                      33292629
332927     MOVE  PV-INIT-MM    TO  PV-INIT-KEY-MM.                      33292729
332928     MOVE  PV-INIT-SS    TO  PV-INIT-KEY-SS.                      33292829
332929                                                                  33292906
332930                                                                  33293006
332931*---------------------------------------------------------------* 33293129
332932*                                                               * 33293229
332933* DMH - 01/29/15                                                * 33293329
332934*---------------------------------------------------------------* 33293429
332935 9130-GET-CURRENT-TMST.                                           33293529
332936     EXEC SQL                                                     33293629
332937          SET :PV-CURRENT-PARA-TMST = CURRENT TIMESTAMP           33293729
332938     END-EXEC.                                                    33293829
332939                                                                  33293929
332940     EXEC SQL                                                     33294029
332941          SELECT                                                  33294129
332942                 TIMESTAMPDIFF( 2 ,CHAR(:PV-CURRENT-PARA-TMST     33294229
332943                   - TIMESTAMP(:PV-INIT-TIMESTAMP)))              33294330
332944               , TIMESTAMPDIFF( 1 ,CHAR(:PV-CURRENT-PARA-TMST     33294429
332945                   - TIMESTAMP(:PV-INIT-TIMESTAMP)))              33294530
332946            INTO :PV-DURATION-SEC                                 33294629
332947               , :PV-DURATION-nano-sec                            33294729
332948            FROM  SYSIBM.SYSDUMMY1                                33294829
332949     END-EXEC.                                                    33294929
332950                                                                  33295029
332951                                                                  33295129
332952*---------------------------------------------------------------* 33295206
332953*                                                               * 33295306
332954* DMH - 01/29/15                                                * 33295406
332955*---------------------------------------------------------------* 33295506
332956 9140-DUMP-TABLE-TO-CSSL.                                         33295606
332957                                                                  33295706
332958     INITIALIZE PV-CICS-MSG-AREA                                  33295806
332959                                                                  33295906
332960     MOVE PT-ENTRIES(PT-TRACK-IDX)  TO PV-CICS-MSG-AREA           33296006
332961                                                                  33296106
332963     EXEC CICS                                                    33296337
332964         WRITEQ TD                                                33296437
332965         QUEUE(PC-LOG-QUEUE-2)                                    33296537
332966         FROM(PV-CICS-MSG-AREA)                                   33296637
332967         RESP(PV-CICS-RESPONSE)                                   33296737
332968     END-EXEC.                                                    33296837
332969                                                                  33296937
332971                                                                  33297106
332972                                                                  33297206
332973*---------------------------------------------------------------* 33297306
332974*                                                               * 33297406
332975* DMH - 01/29/15                                                * 33297506
332976*---------------------------------------------------------------* 33297606
332977 9150-CLEAR-TABLE.                                                33297706
332978                                                                  33297806
332979     MOVE  SPACES  TO  PT-PROGRAM(PT-TRACK-IDX).                  33297906
332980     MOVE  ZEROES  TO  PT-INDEX-NBR(PT-TRACK-IDX).                33298006
332981     MOVE  SPACES  TO  PT-PARAGRAPH(PT-TRACK-IDX).                33298106
332982     MOVE  SPACES  TO  PT-TIMESTAMP(PT-TRACK-IDX).                33298206
332983     MOVE  ZEROES  TO  PT-DURATION(PT-TRACK-IDX).                 33298306
332984                                                                  33298406
332985                                                                  33298506
332986 9990-WRITE-CICS.                                                 33298600
332987                                                                  33298700
332990* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  33299000
333000* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       33300000
333100* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 33310000
333200* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     33320000
333300* WRAPPED AROUND.                                                 33330000
333400                                                                  33340000
333500     EVALUATE TRUE                                                33350000
333600     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          33360000
333700         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 33370000
333800         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         33380000
333900         SET PT-MSG-IDX UP BY 1                                   33390000
334000     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          33400000
334100         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 33410000
334200         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         33420000
334300         SET PT-MSG-IDX               TO 1                        33430000
334400     END-EVALUATE                                                 33440000
334500                                                                  33450000
334600     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1              33460000
334700     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX)  33470000
334800                                                                  33480000
334900                                                                  33490000
335000*  IF THE DC HAS TRACE PROCESSING TURNED ON, ALL MESSAGES WILL    33500000
335100*  BE DISPLAYED AS THEY OCCUR.  DUMPING THE MESSAGE TABLE WILL    33510000
335200*  BE UNNECESSARY BECAUSE OF THE REAL-TIME DISPLAYS.              33520000
335300*                                                                 33530000
335400     IF PS-SHOW-DEBUG-INFO                                        33540000
335500         PERFORM 9991-WRITEQ                                      33550000
335600     END-IF                                                       33560000
335700     MOVE SPACES                      TO PV-CICS-MSG-AREA.        33570000
335800                                                                  33580000
335900                                                                  33590000
336000 9991-WRITEQ.                                                     33600000
336100     EXEC CICS                                                    33610000
336200         WRITEQ TD                                                33620000
336300         QUEUE(PC-LOG-QUEUE)                                      33630000
336400         FROM(PV-CICS-MSG-AREA)                                   33640000
336500         RESP(PV-CICS-RESPONSE)                                   33650000
336600     END-EXEC.                                                    33660000
336700                                                                  33670000
336710                                                                  33671001
336720 9995-WRITE-CICS-CSSL.                                            33672001
336721                                                                  33672101
336730     EXEC CICS                                                    33673001
336740         WRITEQ TD                                                33674001
336750         QUEUE('CSSL')                                            33675001
336760         FROM(PV-CICS-MSG-AREA-D)                                 33676001
336770         RESP(PV-CICS-RESPONSE)                                   33677001
336780     END-EXEC.                                                    33678001
336790                                                                  33679001
336791     MOVE SPACES TO PV-CICS-MSG-AREA-D.                           33679101
336792                                                                  33679201
336794                                                                  33679414
336795*-----------------------------------------------------------------33679514
336796 9997-WRITE-TO-CSSL.                                              33679614
336797*-----------------------------------------------------------------33679714
336798     MOVE LENGTH OF PV-CICS-MSG-AREA    TO PV-COMMAREA-LENGTH.    33679829
336799                                                                  33679914
336800     EXEC CICS                                                    33680037
336801          WRITEQ TD                                               33680137
336802          QUEUE(PC-LOG-QUEUE-2)                                   33680237
336803          FROM(PV-CICS-MSG-AREA)                                  33680337
336804          RESP(PV-CICS-RESPONSE)                                  33680437
336805      END-EXEC.                                                   33680537
336806                                                                  33680637
336815                                                                  33681514
336820*-----------------------------------------------------------------33682000
336900*  RETURN TO CALLING PROGRAM                                      33690000
337000*-----------------------------------------------------------------33700000
337100 9998-RETURN.                                                     33710000
337200                                                                  33720000
337210     STRING ' SUKCS583 - '                                        33721000
337300            ' 9998-RETURN'                                        33730000
337400         DELIMITED BY SIZE                                        33740000
337500         INTO PV-CICS-MSG-AREA.                                   33750000
337600     PERFORM 9990-WRITE-CICS.                                     33760000
337610                                                                  33761039
337611* 02/01/15 begin                                                  33761139
337612     IF  PS-BLD-INTERNAL-TABLE-YES  and                           33761239
337613         PV-DURATION-SEC     >=  PV-PARM-SECONDS                  33761339
337615                                                                  33761539
337616         move '9998'  to  PV-CSSL-PARA                            33761647
337617         move spaces to  pv-ciCS-MSG-AREA                         33761739
337618         PERFORM 9997-WRITE-TO-CSSL                               33761839
337619                                                                  33761939
337620         perform 9110-WRITE-SURD021-TO-CSSL                       33762039
337621                                                                  33762139
337622         move spaces to  pv-ciCS-MSG-AREA                         33762239
337623         PERFORM 9997-WRITE-TO-CSSL                               33762339
337624                                                                  33762439
337625         STRING ' SUKCS583-DID NOT MEET SLA'                      33762539
337626                ' OPER:'       PV-DISP-OPER                       33762639
337627                ' PO:'         PV-DISP-PO                         33762739
337628                '-'            PV-DISP-RCVR                       33762839
337629                ' LINE:'       PV-DISP-LINE                       33762939
337630                ' DR LINE:'    PV-DISP-DRVR-LINE                  33763039
337631                ' PREPK:'      PV-DISP-PREPK                      33763139
337632                ' SSCC:'      PV-DISP-SSCC                        33763239
337633                              DELIMITED BY SIZE                   33763339
337634                         INTO PV-CICS-MSG-AREA                    33763439
337635         PERFORM 9997-WRITE-TO-CSSL                               33763539
337638                                                                  33763842
337639         move spaces to  pv-ciCS-MSG-AREA                         33763946
337640         move PV-DURATION-SEC  to PV-DISP-DURATION                33764044
337641                                                                  33764142
337642         STRING ' SUKCS583 '                                      33764245
337643                ' INIT:'       PV-INIT-TIMESTAMP                  33764342
337644                ' CURR:'       PV-CURRENT-PARA-TMST               33764442
337645                ' DURA:'       PV-DISP-DURATION                   33764543
337646                ' NANO:'       PV-DISP-NANO-SEC                   33764642
337649                              DELIMITED BY SIZE                   33764942
337650                         INTO PV-CICS-MSG-AREA                    33765042
337651         PERFORM 9997-WRITE-TO-CSSL                               33765142
337652                                                                  33765246
337653         move spaces to  pv-ciCS-MSG-AREA                         33765346
337654         PERFORM 9997-WRITE-TO-CSSL                               33765446
337655                                                                  33765542
337657         PERFORM 9140-DUMP-TABLE-TO-CSSL                          33765739
337658         VARYING PT-TRACK-IDX                                     33765839
337659            FROM 1 BY 1                                           33765939
337660           UNTIL PT-TRACK-IDX >=  PT-CURR-ENTRIES                 33766039
337661              OR PT-TRACK-IDX >=  PT-MAX-PARA-ENTRIES             33766139
337662                                                                  33766239
337663         PERFORM 9150-CLEAR-TABLE                                 33766339
337664         VARYING PT-TRACK-IDX                                     33766439
337665            FROM 1 BY 1                                           33766539
337666            UNTIL PT-TRACK-IDX >=  PT-CURR-ENTRIES                33766639
337667               OR PT-TRACK-IDX >=  PT-MAX-PARA-ENTRIES            33766739
337668                                                                  33766839
337669         MOVE ZEROES TO PT-CURR-ENTRIES                           33766939
337670         SET  PT-TRACK-IDX  to  PT-CURR-ENTRIES                   33767039
337671                                                                  33767139
337672         INITIALIZE PV-CICS-MSG-AREA                              33767239
337673         MOVE PV-DURATION-SEC TO  PV-DISP-DURATION                33767339
337674         STRING ' SUKCS583-DID NOT MEET SLA'                      33767442
337675                ' OPER:'       PV-DISP-OPER                       33767539
337676                ' PO:'         PV-DISP-PO                         33767639
337677                '-'            PV-DISP-RCVR                       33767739
337678                ' LINE:'       PV-DISP-LINE                       33767839
337679                ' DR LINE:'    PV-DISP-DRVR-LINE                  33767939
337680                ' PREPK:'      PV-DISP-PREPK                      33768039
337681                ' SSCC:'      PV-DISP-SSCC                        33768139
337682                ' DONE'                                           33768239
337683                              DELIMITED BY SIZE                   33768339
337684                         INTO PV-CICS-MSG-AREA                    33768439
337685         PERFORM 9997-WRITE-TO-CSSL                               33768539
337686                                                                  33768639
337687         move spaces to  pv-ciCS-MSG-AREA                         33768739
337688         PERFORM 9997-WRITE-TO-CSSL                               33768840
337689     end-if.                                                      33768939
337690                                                                  33769039
337691* 02/01/15 end                                                    33769139
337692                                                                  33769239
337693                                                                  33769339
337700     MOVE SU021-CARTON-AUDIT-RECORD     TO DFHCOMMAREA.           33770000
337800                                                                  33780000
337900     EXEC CICS                                                    33790000
338000          RETURN                                                  33800000
338100     END-EXEC.                                                    33810000
338200                                                                  33820000
338300                                                                  33830000
338400 9999-WRITE-TO-CSSL.                                              33840000
338410     STRING ' SUKCS583 - '                                        33841000
338500            ' 9999-WRITE-TO-CSSL'                                 33850000
338600         DELIMITED BY SIZE                                        33860000
338700         INTO PV-CICS-MSG-AREA.                                   33870000
338800     PERFORM 9990-WRITE-CICS.                                     33880000
338900     MOVE LENGTH OF PV-CICS-MSG-AREA2                             33890000
339000       TO PV-COMMAREA-LENGTH                                      33900000
339100     EXEC CICS                                                    33910000
339200          WRITEQ TD                                               33920000
339300           QUEUE   ('CSSL')                                       33930000
339400            FROM   (PV-CICS-MSG-AREA2)                            33940000
339500          LENGTH   (PV-COMMAREA-LENGTH)                           33950000
339600            RESP   (PV-CICS-RESP)                                 33960000
339700     END-EXEC.                                                    33970000
339800                                                                  33980000
339900*                                                                 33990000
340000 9999-WRITE-CICS-LOG-MSG.                                         34000000
340010     STRING ' SUKCS583 - '                                        34001000
340100            ' 9999-WRITE-CICS-LOG-MSG'                            34010000
340200         DELIMITED BY SIZE                                        34020000
340300         INTO PV-CICS-MSG-AREA.                                   34030000
340400     PERFORM 9990-WRITE-CICS.                                     34040000
340500     MOVE 'SUKCS583'                 TO DP013-PROGRAM.            34050000
340600     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           34060000
340700     INITIALIZE DP013-SRC-TASK-NUMBER                             34070000
340800                DP013-STACK.                                      34080000
340900     SET DP013-LINK-RETURN           TO TRUE.                     34090000
341000                                                                  34100000
341100     EXEC CICS                                                    34110000
341200         LINK                                                     34120000
341300             PROGRAM   (DP013-NAME)                               34130000
341400             COMMAREA  (DP013-PARAMETERS)                         34140000
341500             LENGTH    (DP013-LENGTH)                             34150000
341600     END-EXEC.                                                    34160000
341700                                                                  34170000
341800                                                                  34180000
341900 9999-FINAL-DUMP.                                                 34190000
342000*  IF AN ERROR HAS OCCURRED, DUMP THE MESSAGE TABLE WHICH WILL    34200000
342100*  CONTAIN THE LAST 200 TRACE DISPLAYS.  IF THE TABLE EVER        34210000
342200*  OVERFLOW, YOU WILL SEE THE SEQUENCE NUMBERS WRAP.  UNUSED      34220000
342300*  OCCRENCES ARE NOT DISPLAYED.                                   34230000
342400*                                                                 34240000
342500                                                                  34250000
342510     STRING ' SUKCS583 - '                                        34251000
342600            ' 9999-FINAL-DUMP'                                    34260000
342700         DELIMITED BY SIZE                                        34270000
342800         INTO PV-CICS-MSG-AREA                                    34280000
342900     PERFORM 9990-WRITE-CICS.                                     34290000
343000                                                                  34300000
343100     EXEC CICS ENQ                                                34310000
343200         RESOURCE(PC-LOG-QUEUE)                                   34320000
343300     END-EXEC                                                     34330000
343400                                                                  34340000
343500     MOVE PV-EIBTASKN             TO PV-DISPLAY-TASK.             34350000
343600     PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 34360000
343700                     PT-MSG-IDX > PC-MSG-TABLE-SIZE               34370000
343800         IF PT-MSG-SEQ (PT-MSG-IDX) > ZERO                        34380000
343900             MOVE PT-MSG-SEQ (PT-MSG-IDX)                         34390000
344000                                  TO PV-DISPLAY-MSG-NBR           34400000
344010             STRING ' SUKCS583 - '                                34401000
344100                    ' ' PV-DISPLAY-TASK ' '                       34410000
344200                  PV-DISPLAY-MSG-NBR ' '                          34420000
344300                  PT-MSG-LINE (PT-MSG-IDX)                        34430000
344400                  DELIMITED BY SIZE                               34440000
344500                                INTO PV-CICS-MSG-AREA             34450000
344600             PERFORM 9991-WRITEQ                                  34460000
344700         END-IF                                                   34470000
344800     END-PERFORM.                                                 34480000
344900                                                                  34490000
345000     SET PT-MSG-IDX               TO 1.                           34500000
345100     SET PS-DONT-DUMP-TO-LOG      TO TRUE.                        34510000
345200                                                                  34520000
345300     EXEC CICS DEQ                                                34530000
345400         RESOURCE(PC-LOG-QUEUE)                                   34540000
345500     END-EXEC.                                                    34550000
345600                                                                  34560000
